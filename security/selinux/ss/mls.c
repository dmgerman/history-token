multiline_comment|/*&n; * Implementation of the multi-level security (MLS) policy.&n; *&n; * Author : Stephen Smalley, &lt;sds@epoch.ncsc.mil&gt;&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &quot;mls.h&quot;
macro_line|#include &quot;policydb.h&quot;
macro_line|#include &quot;services.h&quot;
multiline_comment|/*&n; * Remove any permissions from `allowed&squot; that are&n; * denied by the MLS policy.&n; */
DECL|function|mls_compute_av
r_void
id|mls_compute_av
c_func
(paren
r_struct
id|context
op_star
id|scontext
comma
r_struct
id|context
op_star
id|tcontext
comma
r_struct
id|class_datum
op_star
id|tclass
comma
id|u32
op_star
id|allowed
)paren
(brace
r_int
r_int
id|rel
(braket
l_int|2
)braket
suffix:semicolon
r_int
id|l
suffix:semicolon
r_for
c_loop
(paren
id|l
op_assign
l_int|0
suffix:semicolon
id|l
OL
l_int|2
suffix:semicolon
id|l
op_increment
)paren
id|rel
(braket
id|l
)braket
op_assign
id|mls_level_relation
c_func
(paren
id|scontext-&gt;range.level
(braket
id|l
)braket
comma
id|tcontext-&gt;range.level
(braket
id|l
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rel
(braket
l_int|1
)braket
op_ne
id|MLS_RELATION_EQ
)paren
(brace
r_if
c_cond
(paren
id|rel
(braket
l_int|1
)braket
op_ne
id|MLS_RELATION_DOM
op_logical_and
op_logical_neg
id|ebitmap_get_bit
c_func
(paren
op_amp
id|policydb.trustedreaders
comma
id|scontext-&gt;type
op_minus
l_int|1
)paren
op_logical_and
op_logical_neg
id|ebitmap_get_bit
c_func
(paren
op_amp
id|policydb.trustedobjects
comma
id|tcontext-&gt;type
op_minus
l_int|1
)paren
)paren
(brace
multiline_comment|/* read(s,t) = (s.high &gt;= t.high) = False */
op_star
id|allowed
op_assign
(paren
op_star
id|allowed
)paren
op_amp
op_complement
(paren
id|tclass-&gt;mlsperms.read
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rel
(braket
l_int|1
)braket
op_ne
id|MLS_RELATION_DOMBY
op_logical_and
op_logical_neg
id|ebitmap_get_bit
c_func
(paren
op_amp
id|policydb.trustedreaders
comma
id|tcontext-&gt;type
op_minus
l_int|1
)paren
op_logical_and
op_logical_neg
id|ebitmap_get_bit
c_func
(paren
op_amp
id|policydb.trustedobjects
comma
id|scontext-&gt;type
op_minus
l_int|1
)paren
)paren
(brace
multiline_comment|/* readby(s,t) = read(t,s) = False */
op_star
id|allowed
op_assign
(paren
op_star
id|allowed
)paren
op_amp
op_complement
(paren
id|tclass-&gt;mlsperms.readby
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
(paren
id|rel
(braket
l_int|0
)braket
op_ne
id|MLS_RELATION_DOMBY
op_logical_and
id|rel
(braket
l_int|0
)braket
op_ne
id|MLS_RELATION_EQ
)paren
op_logical_or
(paren
(paren
op_logical_neg
id|mls_level_eq
c_func
(paren
id|tcontext-&gt;range.level
(braket
l_int|0
)braket
comma
id|tcontext-&gt;range.level
(braket
l_int|1
)braket
)paren
)paren
op_logical_and
(paren
id|rel
(braket
l_int|1
)braket
op_ne
id|MLS_RELATION_DOM
op_logical_and
id|rel
(braket
l_int|1
)braket
op_ne
id|MLS_RELATION_EQ
)paren
)paren
)paren
op_logical_and
op_logical_neg
id|ebitmap_get_bit
c_func
(paren
op_amp
id|policydb.trustedwriters
comma
id|scontext-&gt;type
op_minus
l_int|1
)paren
op_logical_and
op_logical_neg
id|ebitmap_get_bit
c_func
(paren
op_amp
id|policydb.trustedobjects
comma
id|tcontext-&gt;type
op_minus
l_int|1
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * write(s,t) = ((s.low &lt;= t.low = t.high) or (s.low&n;&t;&t; * &lt;= t.low &lt;= t.high &lt;= s.high)) = False&n;&t;&t; */
op_star
id|allowed
op_assign
(paren
op_star
id|allowed
)paren
op_amp
op_complement
(paren
id|tclass-&gt;mlsperms.write
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|rel
(braket
l_int|0
)braket
op_ne
id|MLS_RELATION_DOM
op_logical_and
id|rel
(braket
l_int|0
)braket
op_ne
id|MLS_RELATION_EQ
)paren
op_logical_or
(paren
(paren
op_logical_neg
id|mls_level_eq
c_func
(paren
id|scontext-&gt;range.level
(braket
l_int|0
)braket
comma
id|scontext-&gt;range.level
(braket
l_int|1
)braket
)paren
)paren
op_logical_and
(paren
id|rel
(braket
l_int|1
)braket
op_ne
id|MLS_RELATION_DOMBY
op_logical_and
id|rel
(braket
l_int|1
)braket
op_ne
id|MLS_RELATION_EQ
)paren
)paren
)paren
op_logical_and
op_logical_neg
id|ebitmap_get_bit
c_func
(paren
op_amp
id|policydb.trustedwriters
comma
id|tcontext-&gt;type
op_minus
l_int|1
)paren
op_logical_and
op_logical_neg
id|ebitmap_get_bit
c_func
(paren
op_amp
id|policydb.trustedobjects
comma
id|scontext-&gt;type
op_minus
l_int|1
)paren
)paren
(brace
multiline_comment|/* writeby(s,t) = write(t,s) = False */
op_star
id|allowed
op_assign
(paren
op_star
id|allowed
)paren
op_amp
op_complement
(paren
id|tclass-&gt;mlsperms.writeby
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Return the length in bytes for the MLS fields of the&n; * security context string representation of `context&squot;.&n; */
DECL|function|mls_compute_context_len
r_int
id|mls_compute_context_len
c_func
(paren
r_struct
id|context
op_star
id|context
)paren
(brace
r_int
id|i
comma
id|l
comma
id|len
suffix:semicolon
id|len
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|l
op_assign
l_int|0
suffix:semicolon
id|l
OL
l_int|2
suffix:semicolon
id|l
op_increment
)paren
(brace
id|len
op_add_assign
id|strlen
c_func
(paren
id|policydb.p_sens_val_to_name
(braket
id|context-&gt;range.level
(braket
id|l
)braket
dot
id|sens
op_minus
l_int|1
)braket
)paren
op_plus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|ebitmap_length
c_func
(paren
op_amp
id|context-&gt;range.level
(braket
id|l
)braket
dot
id|cat
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|ebitmap_get_bit
c_func
(paren
op_amp
id|context-&gt;range.level
(braket
id|l
)braket
dot
id|cat
comma
id|i
op_minus
l_int|1
)paren
)paren
id|len
op_add_assign
id|strlen
c_func
(paren
id|policydb.p_cat_val_to_name
(braket
id|i
op_minus
l_int|1
)braket
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|mls_level_relation
c_func
(paren
id|context-&gt;range.level
(braket
l_int|0
)braket
comma
id|context-&gt;range.level
(braket
l_int|1
)braket
)paren
op_eq
id|MLS_RELATION_EQ
)paren
r_break
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
multiline_comment|/*&n; * Write the security context string representation of&n; * the MLS fields of `context&squot; into the string `*scontext&squot;.&n; * Update `*scontext&squot; to point to the end of the MLS fields.&n; */
DECL|function|mls_sid_to_context
r_int
id|mls_sid_to_context
c_func
(paren
r_struct
id|context
op_star
id|context
comma
r_char
op_star
op_star
id|scontext
)paren
(brace
r_char
op_star
id|scontextp
suffix:semicolon
r_int
id|i
comma
id|l
suffix:semicolon
id|scontextp
op_assign
op_star
id|scontext
suffix:semicolon
r_for
c_loop
(paren
id|l
op_assign
l_int|0
suffix:semicolon
id|l
OL
l_int|2
suffix:semicolon
id|l
op_increment
)paren
(brace
id|strcpy
c_func
(paren
id|scontextp
comma
id|policydb.p_sens_val_to_name
(braket
id|context-&gt;range.level
(braket
id|l
)braket
dot
id|sens
op_minus
l_int|1
)braket
)paren
suffix:semicolon
id|scontextp
op_add_assign
id|strlen
c_func
(paren
id|policydb.p_sens_val_to_name
(braket
id|context-&gt;range.level
(braket
id|l
)braket
dot
id|sens
op_minus
l_int|1
)braket
)paren
suffix:semicolon
op_star
id|scontextp
op_assign
l_char|&squot;:&squot;
suffix:semicolon
id|scontextp
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|ebitmap_length
c_func
(paren
op_amp
id|context-&gt;range.level
(braket
id|l
)braket
dot
id|cat
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|ebitmap_get_bit
c_func
(paren
op_amp
id|context-&gt;range.level
(braket
id|l
)braket
dot
id|cat
comma
id|i
op_minus
l_int|1
)paren
)paren
(brace
id|strcpy
c_func
(paren
id|scontextp
comma
id|policydb.p_cat_val_to_name
(braket
id|i
op_minus
l_int|1
)braket
)paren
suffix:semicolon
id|scontextp
op_add_assign
id|strlen
c_func
(paren
id|policydb.p_cat_val_to_name
(braket
id|i
op_minus
l_int|1
)braket
)paren
suffix:semicolon
op_star
id|scontextp
op_assign
l_char|&squot;,&squot;
suffix:semicolon
id|scontextp
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mls_level_relation
c_func
(paren
id|context-&gt;range.level
(braket
l_int|0
)braket
comma
id|context-&gt;range.level
(braket
l_int|1
)braket
)paren
op_ne
id|MLS_RELATION_EQ
)paren
(brace
id|scontextp
op_decrement
suffix:semicolon
id|sprintf
c_func
(paren
id|scontextp
comma
l_string|&quot;-&quot;
)paren
suffix:semicolon
id|scontextp
op_increment
suffix:semicolon
)brace
r_else
(brace
r_break
suffix:semicolon
)brace
)brace
op_star
id|scontext
op_assign
id|scontextp
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Return 1 if the MLS fields in the security context&n; * structure `c&squot; are valid.  Return 0 otherwise.&n; */
DECL|function|mls_context_isvalid
r_int
id|mls_context_isvalid
c_func
(paren
r_struct
id|policydb
op_star
id|p
comma
r_struct
id|context
op_star
id|c
)paren
(brace
r_int
r_int
id|relation
suffix:semicolon
r_struct
id|level_datum
op_star
id|levdatum
suffix:semicolon
r_struct
id|user_datum
op_star
id|usrdatum
suffix:semicolon
r_struct
id|mls_range_list
op_star
id|rnode
suffix:semicolon
r_int
id|i
comma
id|l
suffix:semicolon
multiline_comment|/*&n;&t; * MLS range validity checks: high must dominate low, low level must&n;&t; * be valid (category set &lt;-&gt; sensitivity check), and high level must&n;&t; * be valid (category set &lt;-&gt; sensitivity check)&n;&t; */
id|relation
op_assign
id|mls_level_relation
c_func
(paren
id|c-&gt;range.level
(braket
l_int|1
)braket
comma
id|c-&gt;range.level
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|relation
op_amp
(paren
id|MLS_RELATION_DOM
op_or
id|MLS_RELATION_EQ
)paren
)paren
)paren
multiline_comment|/* High does not dominate low. */
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|l
op_assign
l_int|0
suffix:semicolon
id|l
OL
l_int|2
suffix:semicolon
id|l
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|c-&gt;range.level
(braket
id|l
)braket
dot
id|sens
op_logical_or
id|c-&gt;range.level
(braket
id|l
)braket
dot
id|sens
OG
id|p-&gt;p_levels.nprim
)paren
r_return
l_int|0
suffix:semicolon
id|levdatum
op_assign
id|hashtab_search
c_func
(paren
id|p-&gt;p_levels.table
comma
id|p-&gt;p_sens_val_to_name
(braket
id|c-&gt;range.level
(braket
id|l
)braket
dot
id|sens
op_minus
l_int|1
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|levdatum
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|ebitmap_length
c_func
(paren
op_amp
id|c-&gt;range.level
(braket
id|l
)braket
dot
id|cat
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ebitmap_get_bit
c_func
(paren
op_amp
id|c-&gt;range.level
(braket
id|l
)braket
dot
id|cat
comma
id|i
op_minus
l_int|1
)paren
)paren
(brace
r_if
c_cond
(paren
id|i
OG
id|p-&gt;p_cats.nprim
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ebitmap_get_bit
c_func
(paren
op_amp
id|levdatum-&gt;level-&gt;cat
comma
id|i
op_minus
l_int|1
)paren
)paren
multiline_comment|/*&n;&t;&t;&t;&t;&t; * Category may not be associated with&n;&t;&t;&t;&t;&t; * sensitivity in low level.&n;&t;&t;&t;&t;&t; */
r_return
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|c-&gt;role
op_eq
id|OBJECT_R_VAL
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * User must be authorized for the MLS range.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|c-&gt;user
op_logical_or
id|c-&gt;user
OG
id|p-&gt;p_users.nprim
)paren
r_return
l_int|0
suffix:semicolon
id|usrdatum
op_assign
id|p-&gt;user_val_to_struct
(braket
id|c-&gt;user
op_minus
l_int|1
)braket
suffix:semicolon
r_for
c_loop
(paren
id|rnode
op_assign
id|usrdatum-&gt;ranges
suffix:semicolon
id|rnode
suffix:semicolon
id|rnode
op_assign
id|rnode-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|mls_range_contains
c_func
(paren
id|rnode-&gt;range
comma
id|c-&gt;range
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|rnode
)paren
multiline_comment|/* user may not be associated with range */
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * Set the MLS fields in the security context structure&n; * `context&squot; based on the string representation in&n; * the string `*scontext&squot;.  Update `*scontext&squot; to&n; * point to the end of the string representation of&n; * the MLS fields.&n; *&n; * This function modifies the string in place, inserting&n; * NULL characters to terminate the MLS fields.&n; */
DECL|function|mls_context_to_sid
r_int
id|mls_context_to_sid
c_func
(paren
r_char
id|oldc
comma
r_char
op_star
op_star
id|scontext
comma
r_struct
id|context
op_star
id|context
)paren
(brace
r_char
id|delim
suffix:semicolon
r_char
op_star
id|scontextp
comma
op_star
id|p
suffix:semicolon
r_struct
id|level_datum
op_star
id|levdatum
suffix:semicolon
r_struct
id|cat_datum
op_star
id|catdatum
suffix:semicolon
r_int
id|l
comma
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|oldc
)paren
(brace
multiline_comment|/* No MLS component to the security context.  Try&n;&t;&t;   to use a default &squot;unclassified&squot; value. */
id|levdatum
op_assign
id|hashtab_search
c_func
(paren
id|policydb.p_levels.table
comma
l_string|&quot;unclassified&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|levdatum
)paren
r_goto
id|out
suffix:semicolon
id|context-&gt;range.level
(braket
l_int|0
)braket
dot
id|sens
op_assign
id|levdatum-&gt;level-&gt;sens
suffix:semicolon
id|context-&gt;range.level
(braket
l_int|1
)braket
dot
id|sens
op_assign
id|context-&gt;range.level
(braket
l_int|0
)braket
dot
id|sens
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Extract low sensitivity. */
id|scontextp
op_assign
id|p
op_assign
op_star
id|scontext
suffix:semicolon
r_while
c_loop
(paren
op_star
id|p
op_logical_and
op_star
id|p
op_ne
l_char|&squot;:&squot;
op_logical_and
op_star
id|p
op_ne
l_char|&squot;-&squot;
)paren
id|p
op_increment
suffix:semicolon
id|delim
op_assign
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|delim
op_ne
l_int|0
)paren
op_star
id|p
op_increment
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|l
op_assign
l_int|0
suffix:semicolon
id|l
OL
l_int|2
suffix:semicolon
id|l
op_increment
)paren
(brace
id|levdatum
op_assign
id|hashtab_search
c_func
(paren
id|policydb.p_levels.table
comma
id|scontextp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|levdatum
)paren
r_goto
id|out
suffix:semicolon
id|context-&gt;range.level
(braket
id|l
)braket
dot
id|sens
op_assign
id|levdatum-&gt;level-&gt;sens
suffix:semicolon
r_if
c_cond
(paren
id|delim
op_eq
l_char|&squot;:&squot;
)paren
(brace
multiline_comment|/* Extract low category set. */
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|scontextp
op_assign
id|p
suffix:semicolon
r_while
c_loop
(paren
op_star
id|p
op_logical_and
op_star
id|p
op_ne
l_char|&squot;,&squot;
op_logical_and
op_star
id|p
op_ne
l_char|&squot;-&squot;
)paren
id|p
op_increment
suffix:semicolon
id|delim
op_assign
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|delim
op_ne
l_int|0
)paren
op_star
id|p
op_increment
op_assign
l_int|0
suffix:semicolon
id|catdatum
op_assign
id|hashtab_search
c_func
(paren
id|policydb.p_cats.table
comma
id|scontextp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|catdatum
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
id|ebitmap_set_bit
c_func
(paren
op_amp
id|context-&gt;range.level
(braket
id|l
)braket
dot
id|cat
comma
id|catdatum-&gt;value
op_minus
l_int|1
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|delim
op_ne
l_char|&squot;,&squot;
)paren
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|delim
op_eq
l_char|&squot;-&squot;
)paren
(brace
multiline_comment|/* Extract high sensitivity. */
id|scontextp
op_assign
id|p
suffix:semicolon
r_while
c_loop
(paren
op_star
id|p
op_logical_and
op_star
id|p
op_ne
l_char|&squot;:&squot;
)paren
id|p
op_increment
suffix:semicolon
id|delim
op_assign
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|delim
op_ne
l_int|0
)paren
op_star
id|p
op_increment
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|l
op_eq
l_int|0
)paren
(brace
id|context-&gt;range.level
(braket
l_int|1
)braket
dot
id|sens
op_assign
id|context-&gt;range.level
(braket
l_int|0
)braket
dot
id|sens
suffix:semicolon
id|rc
op_assign
id|ebitmap_cpy
c_func
(paren
op_amp
id|context-&gt;range.level
(braket
l_int|1
)braket
dot
id|cat
comma
op_amp
id|context-&gt;range.level
(braket
l_int|0
)braket
dot
id|cat
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
)brace
op_star
id|scontext
op_assign
op_increment
id|p
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * Copies the MLS range from `src&squot; into `dst&squot;.&n; */
DECL|function|mls_copy_context
r_static
r_inline
r_int
id|mls_copy_context
c_func
(paren
r_struct
id|context
op_star
id|dst
comma
r_struct
id|context
op_star
id|src
)paren
(brace
r_int
id|l
comma
id|rc
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Copy the MLS range from the source context */
r_for
c_loop
(paren
id|l
op_assign
l_int|0
suffix:semicolon
id|l
OL
l_int|2
suffix:semicolon
id|l
op_increment
)paren
(brace
id|dst-&gt;range.level
(braket
id|l
)braket
dot
id|sens
op_assign
id|src-&gt;range.level
(braket
id|l
)braket
dot
id|sens
suffix:semicolon
id|rc
op_assign
id|ebitmap_cpy
c_func
(paren
op_amp
id|dst-&gt;range.level
(braket
id|l
)braket
dot
id|cat
comma
op_amp
id|src-&gt;range.level
(braket
id|l
)braket
dot
id|cat
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_break
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * Convert the MLS fields in the security context&n; * structure `c&squot; from the values specified in the&n; * policy `oldp&squot; to the values specified in the policy `newp&squot;.&n; */
DECL|function|mls_convert_context
r_int
id|mls_convert_context
c_func
(paren
r_struct
id|policydb
op_star
id|oldp
comma
r_struct
id|policydb
op_star
id|newp
comma
r_struct
id|context
op_star
id|c
)paren
(brace
r_struct
id|level_datum
op_star
id|levdatum
suffix:semicolon
r_struct
id|cat_datum
op_star
id|catdatum
suffix:semicolon
r_struct
id|ebitmap
id|bitmap
suffix:semicolon
r_int
id|l
comma
id|i
suffix:semicolon
r_for
c_loop
(paren
id|l
op_assign
l_int|0
suffix:semicolon
id|l
OL
l_int|2
suffix:semicolon
id|l
op_increment
)paren
(brace
id|levdatum
op_assign
id|hashtab_search
c_func
(paren
id|newp-&gt;p_levels.table
comma
id|oldp-&gt;p_sens_val_to_name
(braket
id|c-&gt;range.level
(braket
id|l
)braket
dot
id|sens
op_minus
l_int|1
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|levdatum
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|c-&gt;range.level
(braket
id|l
)braket
dot
id|sens
op_assign
id|levdatum-&gt;level-&gt;sens
suffix:semicolon
id|ebitmap_init
c_func
(paren
op_amp
id|bitmap
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
op_le
id|ebitmap_length
c_func
(paren
op_amp
id|c-&gt;range.level
(braket
id|l
)braket
dot
id|cat
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ebitmap_get_bit
c_func
(paren
op_amp
id|c-&gt;range.level
(braket
id|l
)braket
dot
id|cat
comma
id|i
op_minus
l_int|1
)paren
)paren
(brace
r_int
id|rc
suffix:semicolon
id|catdatum
op_assign
id|hashtab_search
c_func
(paren
id|newp-&gt;p_cats.table
comma
id|oldp-&gt;p_cat_val_to_name
(braket
id|i
op_minus
l_int|1
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|catdatum
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|rc
op_assign
id|ebitmap_set_bit
c_func
(paren
op_amp
id|bitmap
comma
id|catdatum-&gt;value
op_minus
l_int|1
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
)brace
)brace
id|ebitmap_destroy
c_func
(paren
op_amp
id|c-&gt;range.level
(braket
id|l
)braket
dot
id|cat
)paren
suffix:semicolon
id|c-&gt;range.level
(braket
id|l
)braket
dot
id|cat
op_assign
id|bitmap
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mls_compute_sid
r_int
id|mls_compute_sid
c_func
(paren
r_struct
id|context
op_star
id|scontext
comma
r_struct
id|context
op_star
id|tcontext
comma
id|u16
id|tclass
comma
id|u32
id|specified
comma
r_struct
id|context
op_star
id|newcontext
)paren
(brace
r_switch
c_cond
(paren
id|specified
)paren
(brace
r_case
id|AVTAB_TRANSITION
suffix:colon
r_case
id|AVTAB_CHANGE
suffix:colon
multiline_comment|/* Use the process MLS attributes. */
r_return
id|mls_copy_context
c_func
(paren
id|newcontext
comma
id|scontext
)paren
suffix:semicolon
r_case
id|AVTAB_MEMBER
suffix:colon
multiline_comment|/* Only polyinstantiate the MLS attributes if&n;&t;&t;   the type is being polyinstantiated */
r_if
c_cond
(paren
id|newcontext-&gt;type
op_ne
id|tcontext-&gt;type
)paren
(brace
multiline_comment|/* Use the process MLS attributes. */
r_return
id|mls_copy_context
c_func
(paren
id|newcontext
comma
id|scontext
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Use the related object MLS attributes. */
r_return
id|mls_copy_context
c_func
(paren
id|newcontext
comma
id|tcontext
)paren
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|mls_user_destroy
r_void
id|mls_user_destroy
c_func
(paren
r_struct
id|user_datum
op_star
id|usrdatum
)paren
(brace
r_struct
id|mls_range_list
op_star
id|rnode
comma
op_star
id|rtmp
suffix:semicolon
id|rnode
op_assign
id|usrdatum-&gt;ranges
suffix:semicolon
r_while
c_loop
(paren
id|rnode
)paren
(brace
id|rtmp
op_assign
id|rnode
suffix:semicolon
id|rnode
op_assign
id|rnode-&gt;next
suffix:semicolon
id|ebitmap_destroy
c_func
(paren
op_amp
id|rtmp-&gt;range.level
(braket
l_int|0
)braket
dot
id|cat
)paren
suffix:semicolon
id|ebitmap_destroy
c_func
(paren
op_amp
id|rtmp-&gt;range.level
(braket
l_int|1
)braket
dot
id|cat
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|rtmp
)paren
suffix:semicolon
)brace
)brace
DECL|function|mls_read_perm
r_int
id|mls_read_perm
c_func
(paren
r_struct
id|perm_datum
op_star
id|perdatum
comma
r_void
op_star
id|fp
)paren
(brace
id|u32
id|buf
(braket
l_int|1
)braket
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|perdatum-&gt;base_perms
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Read a MLS level structure from a policydb binary&n; * representation file.&n; */
DECL|function|mls_read_level
r_struct
id|mls_level
op_star
id|mls_read_level
c_func
(paren
r_void
op_star
id|fp
)paren
(brace
r_struct
id|mls_level
op_star
id|l
suffix:semicolon
id|u32
id|buf
(braket
l_int|1
)braket
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|l
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|l
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|l
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security: mls: out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|l
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|l
)paren
)paren
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security: mls: truncated level&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|l-&gt;sens
op_assign
id|cpu_to_le32
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ebitmap_read
c_func
(paren
op_amp
id|l-&gt;cat
comma
id|fp
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security: mls:  error reading level &quot;
l_string|&quot;categories&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
r_return
id|l
suffix:semicolon
id|bad
suffix:colon
id|kfree
c_func
(paren
id|l
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * Read a MLS range structure from a policydb binary&n; * representation file.&n; */
DECL|function|mls_read_range_helper
r_static
r_int
id|mls_read_range_helper
c_func
(paren
r_struct
id|mls_range
op_star
id|r
comma
r_void
op_star
id|fp
)paren
(brace
id|u32
id|buf
(braket
l_int|2
)braket
comma
id|items
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|items
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|items
OG
id|ARRAY_SIZE
c_func
(paren
id|buf
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security: mls:  range overflow&bslash;n&quot;
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
op_star
id|items
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security: mls:  truncated range&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|r-&gt;level
(braket
l_int|0
)braket
dot
id|sens
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|items
OG
l_int|1
)paren
(brace
id|r-&gt;level
(braket
l_int|1
)braket
dot
id|sens
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
id|r-&gt;level
(braket
l_int|1
)braket
dot
id|sens
op_assign
id|r-&gt;level
(braket
l_int|0
)braket
dot
id|sens
suffix:semicolon
)brace
id|rc
op_assign
id|ebitmap_read
c_func
(paren
op_amp
id|r-&gt;level
(braket
l_int|0
)braket
dot
id|cat
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security: mls:  error reading low &quot;
l_string|&quot;categories&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|items
OG
l_int|1
)paren
(brace
id|rc
op_assign
id|ebitmap_read
c_func
(paren
op_amp
id|r-&gt;level
(braket
l_int|1
)braket
dot
id|cat
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security: mls:  error reading high &quot;
l_string|&quot;categories&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|bad_high
suffix:semicolon
)brace
)brace
r_else
(brace
id|rc
op_assign
id|ebitmap_cpy
c_func
(paren
op_amp
id|r-&gt;level
(braket
l_int|1
)braket
dot
id|cat
comma
op_amp
id|r-&gt;level
(braket
l_int|0
)braket
dot
id|cat
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security: mls:  out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|bad_high
suffix:semicolon
)brace
)brace
id|rc
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|bad_high
suffix:colon
id|ebitmap_destroy
c_func
(paren
op_amp
id|r-&gt;level
(braket
l_int|0
)braket
dot
id|cat
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|mls_read_range
r_int
id|mls_read_range
c_func
(paren
r_struct
id|context
op_star
id|c
comma
r_void
op_star
id|fp
)paren
(brace
r_return
id|mls_read_range_helper
c_func
(paren
op_amp
id|c-&gt;range
comma
id|fp
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Read a MLS perms structure from a policydb binary&n; * representation file.&n; */
DECL|function|mls_read_class
r_int
id|mls_read_class
c_func
(paren
r_struct
id|class_datum
op_star
id|cladatum
comma
r_void
op_star
id|fp
)paren
(brace
r_struct
id|mls_perms
op_star
id|p
op_assign
op_amp
id|cladatum-&gt;mlsperms
suffix:semicolon
id|u32
id|buf
(braket
l_int|4
)braket
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security: mls:  truncated mls permissions&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|p-&gt;read
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|p-&gt;readby
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|p-&gt;write
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|p-&gt;writeby
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mls_read_user
r_int
id|mls_read_user
c_func
(paren
r_struct
id|user_datum
op_star
id|usrdatum
comma
r_void
op_star
id|fp
)paren
(brace
r_struct
id|mls_range_list
op_star
id|r
comma
op_star
id|l
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|u32
id|nel
comma
id|i
suffix:semicolon
id|u32
id|buf
(braket
l_int|1
)braket
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|nel
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|l
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nel
suffix:semicolon
id|i
op_increment
)paren
(brace
id|r
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|r
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|r
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|r
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|r
)paren
)paren
suffix:semicolon
id|rc
op_assign
id|mls_read_range_helper
c_func
(paren
op_amp
id|r-&gt;range
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|kfree
c_func
(paren
id|r
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|l
)paren
id|l-&gt;next
op_assign
id|r
suffix:semicolon
r_else
id|usrdatum-&gt;ranges
op_assign
id|r
suffix:semicolon
id|l
op_assign
id|r
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|mls_read_nlevels
r_int
id|mls_read_nlevels
c_func
(paren
r_struct
id|policydb
op_star
id|p
comma
r_void
op_star
id|fp
)paren
(brace
id|u32
id|buf
(braket
l_int|1
)braket
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|p-&gt;nlevels
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mls_read_trusted
r_int
id|mls_read_trusted
c_func
(paren
r_struct
id|policydb
op_star
id|p
comma
r_void
op_star
id|fp
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|rc
op_assign
id|ebitmap_read
c_func
(paren
op_amp
id|p-&gt;trustedreaders
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
id|rc
op_assign
id|ebitmap_read
c_func
(paren
op_amp
id|p-&gt;trustedwriters
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
id|rc
op_assign
id|ebitmap_read
c_func
(paren
op_amp
id|p-&gt;trustedobjects
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad2
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|bad2
suffix:colon
id|ebitmap_destroy
c_func
(paren
op_amp
id|p-&gt;trustedwriters
)paren
suffix:semicolon
id|bad
suffix:colon
id|ebitmap_destroy
c_func
(paren
op_amp
id|p-&gt;trustedreaders
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|sens_index
r_int
id|sens_index
c_func
(paren
r_void
op_star
id|key
comma
r_void
op_star
id|datum
comma
r_void
op_star
id|datap
)paren
(brace
r_struct
id|policydb
op_star
id|p
suffix:semicolon
r_struct
id|level_datum
op_star
id|levdatum
suffix:semicolon
id|levdatum
op_assign
id|datum
suffix:semicolon
id|p
op_assign
id|datap
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|levdatum-&gt;isalias
)paren
id|p-&gt;p_sens_val_to_name
(braket
id|levdatum-&gt;level-&gt;sens
op_minus
l_int|1
)braket
op_assign
id|key
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cat_index
r_int
id|cat_index
c_func
(paren
r_void
op_star
id|key
comma
r_void
op_star
id|datum
comma
r_void
op_star
id|datap
)paren
(brace
r_struct
id|policydb
op_star
id|p
suffix:semicolon
r_struct
id|cat_datum
op_star
id|catdatum
suffix:semicolon
id|catdatum
op_assign
id|datum
suffix:semicolon
id|p
op_assign
id|datap
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|catdatum-&gt;isalias
)paren
id|p-&gt;p_cat_val_to_name
(braket
id|catdatum-&gt;value
op_minus
l_int|1
)braket
op_assign
id|key
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sens_destroy
r_int
id|sens_destroy
c_func
(paren
r_void
op_star
id|key
comma
r_void
op_star
id|datum
comma
r_void
op_star
id|p
)paren
(brace
r_struct
id|level_datum
op_star
id|levdatum
suffix:semicolon
id|kfree
c_func
(paren
id|key
)paren
suffix:semicolon
id|levdatum
op_assign
id|datum
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|levdatum-&gt;isalias
)paren
(brace
id|ebitmap_destroy
c_func
(paren
op_amp
id|levdatum-&gt;level-&gt;cat
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|levdatum-&gt;level
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|datum
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cat_destroy
r_int
id|cat_destroy
c_func
(paren
r_void
op_star
id|key
comma
r_void
op_star
id|datum
comma
r_void
op_star
id|p
)paren
(brace
id|kfree
c_func
(paren
id|key
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|datum
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sens_read
r_int
id|sens_read
c_func
(paren
r_struct
id|policydb
op_star
id|p
comma
r_struct
id|hashtab
op_star
id|h
comma
r_void
op_star
id|fp
)paren
(brace
r_char
op_star
id|key
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|level_datum
op_star
id|levdatum
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|u32
id|buf
(braket
l_int|2
)braket
comma
id|len
suffix:semicolon
id|levdatum
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|levdatum
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|levdatum
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|levdatum
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|levdatum
)paren
)paren
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|len
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|levdatum-&gt;isalias
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|key
op_assign
id|kmalloc
c_func
(paren
id|len
op_plus
l_int|1
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|key
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|key
comma
id|fp
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|key
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
id|levdatum-&gt;level
op_assign
id|mls_read_level
c_func
(paren
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|levdatum-&gt;level
)paren
(brace
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|hashtab_insert
c_func
(paren
id|h
comma
id|key
comma
id|levdatum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|bad
suffix:colon
id|sens_destroy
c_func
(paren
id|key
comma
id|levdatum
comma
l_int|NULL
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|cat_read
r_int
id|cat_read
c_func
(paren
r_struct
id|policydb
op_star
id|p
comma
r_struct
id|hashtab
op_star
id|h
comma
r_void
op_star
id|fp
)paren
(brace
r_char
op_star
id|key
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|cat_datum
op_star
id|catdatum
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|u32
id|buf
(braket
l_int|3
)braket
comma
id|len
suffix:semicolon
id|catdatum
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|catdatum
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|catdatum
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|catdatum
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|catdatum
)paren
)paren
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|len
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|catdatum-&gt;value
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|catdatum-&gt;isalias
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|key
op_assign
id|kmalloc
c_func
(paren
id|len
op_plus
l_int|1
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|key
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|key
comma
id|fp
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|key
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
id|rc
op_assign
id|hashtab_insert
c_func
(paren
id|h
comma
id|key
comma
id|catdatum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|bad
suffix:colon
id|cat_destroy
c_func
(paren
id|key
comma
id|catdatum
comma
l_int|NULL
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
eof
