multiline_comment|/*&n; * Implementation of the policy database.&n; *&n; * Author : Stephen Smalley, &lt;sds@epoch.ncsc.mil&gt;&n; */
multiline_comment|/*&n; * Updated: Trusted Computer Solutions, Inc. &lt;dgoeddel@trustedcs.com&gt;&n; *&n; *&t;Support for enhanced MLS infrastructure.&n; *&n; * Updated: Frank Mayer &lt;mayerf@tresys.com&gt; and Karl MacMillan &lt;kmacmillan@tresys.com&gt;&n; *&n; * &t;Added conditional policy language extensions&n; *&n; * Copyright (C) 2004-2005 Trusted Computer Solutions, Inc.&n; * Copyright (C) 2003 - 2004 Tresys Technology, LLC&n; *&t;This program is free software; you can redistribute it and/or modify&n; *  &t;it under the terms of the GNU General Public License as published by&n; *&t;the Free Software Foundation, version 2.&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &quot;security.h&quot;
macro_line|#include &quot;policydb.h&quot;
macro_line|#include &quot;conditional.h&quot;
macro_line|#include &quot;mls.h&quot;
DECL|macro|_DEBUG_HASHES
mdefine_line|#define _DEBUG_HASHES
macro_line|#ifdef DEBUG_HASHES
DECL|variable|symtab_name
r_static
r_char
op_star
id|symtab_name
(braket
id|SYM_NUM
)braket
op_assign
(brace
l_string|&quot;common prefixes&quot;
comma
l_string|&quot;classes&quot;
comma
l_string|&quot;roles&quot;
comma
l_string|&quot;types&quot;
comma
l_string|&quot;users&quot;
comma
l_string|&quot;bools&quot;
comma
l_string|&quot;levels&quot;
comma
l_string|&quot;categories&quot;
comma
)brace
suffix:semicolon
macro_line|#endif
DECL|variable|selinux_mls_enabled
r_int
id|selinux_mls_enabled
op_assign
l_int|0
suffix:semicolon
DECL|variable|symtab_sizes
r_static
r_int
r_int
id|symtab_sizes
(braket
id|SYM_NUM
)braket
op_assign
(brace
l_int|2
comma
l_int|32
comma
l_int|16
comma
l_int|512
comma
l_int|128
comma
l_int|16
comma
l_int|16
comma
l_int|16
comma
)brace
suffix:semicolon
DECL|struct|policydb_compat_info
r_struct
id|policydb_compat_info
(brace
DECL|member|version
r_int
id|version
suffix:semicolon
DECL|member|sym_num
r_int
id|sym_num
suffix:semicolon
DECL|member|ocon_num
r_int
id|ocon_num
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* These need to be updated if SYM_NUM or OCON_NUM changes */
DECL|variable|policydb_compat
r_static
r_struct
id|policydb_compat_info
id|policydb_compat
(braket
)braket
op_assign
(brace
(brace
dot
id|version
op_assign
id|POLICYDB_VERSION_BASE
comma
dot
id|sym_num
op_assign
id|SYM_NUM
op_minus
l_int|3
comma
dot
id|ocon_num
op_assign
id|OCON_NUM
op_minus
l_int|1
comma
)brace
comma
(brace
dot
id|version
op_assign
id|POLICYDB_VERSION_BOOL
comma
dot
id|sym_num
op_assign
id|SYM_NUM
op_minus
l_int|2
comma
dot
id|ocon_num
op_assign
id|OCON_NUM
op_minus
l_int|1
comma
)brace
comma
(brace
dot
id|version
op_assign
id|POLICYDB_VERSION_IPV6
comma
dot
id|sym_num
op_assign
id|SYM_NUM
op_minus
l_int|2
comma
dot
id|ocon_num
op_assign
id|OCON_NUM
comma
)brace
comma
(brace
dot
id|version
op_assign
id|POLICYDB_VERSION_NLCLASS
comma
dot
id|sym_num
op_assign
id|SYM_NUM
op_minus
l_int|2
comma
dot
id|ocon_num
op_assign
id|OCON_NUM
comma
)brace
comma
(brace
dot
id|version
op_assign
id|POLICYDB_VERSION_MLS
comma
dot
id|sym_num
op_assign
id|SYM_NUM
comma
dot
id|ocon_num
op_assign
id|OCON_NUM
comma
)brace
comma
)brace
suffix:semicolon
DECL|function|policydb_lookup_compat
r_static
r_struct
id|policydb_compat_info
op_star
id|policydb_lookup_compat
c_func
(paren
r_int
id|version
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|policydb_compat_info
op_star
id|info
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|policydb_compat
)paren
op_div
r_sizeof
(paren
op_star
id|info
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|policydb_compat
(braket
id|i
)braket
dot
id|version
op_eq
id|version
)paren
(brace
id|info
op_assign
op_amp
id|policydb_compat
(braket
id|i
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
id|info
suffix:semicolon
)brace
multiline_comment|/*&n; * Initialize the role table.&n; */
DECL|function|roles_init
r_int
id|roles_init
c_func
(paren
r_struct
id|policydb
op_star
id|p
)paren
(brace
r_char
op_star
id|key
op_assign
l_int|NULL
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_struct
id|role_datum
op_star
id|role
suffix:semicolon
id|role
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|role
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|role
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|role
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|role
)paren
)paren
suffix:semicolon
id|role-&gt;value
op_assign
op_increment
id|p-&gt;p_roles.nprim
suffix:semicolon
r_if
c_cond
(paren
id|role-&gt;value
op_ne
id|OBJECT_R_VAL
)paren
(brace
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out_free_role
suffix:semicolon
)brace
id|key
op_assign
id|kmalloc
c_func
(paren
id|strlen
c_func
(paren
id|OBJECT_R
)paren
op_plus
l_int|1
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|key
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out_free_role
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|key
comma
id|OBJECT_R
)paren
suffix:semicolon
id|rc
op_assign
id|hashtab_insert
c_func
(paren
id|p-&gt;p_roles.table
comma
id|key
comma
id|role
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out_free_key
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|out_free_key
suffix:colon
id|kfree
c_func
(paren
id|key
)paren
suffix:semicolon
id|out_free_role
suffix:colon
id|kfree
c_func
(paren
id|role
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/*&n; * Initialize a policy database structure.&n; */
DECL|function|policydb_init
r_int
id|policydb_init
c_func
(paren
r_struct
id|policydb
op_star
id|p
)paren
(brace
r_int
id|i
comma
id|rc
suffix:semicolon
id|memset
c_func
(paren
id|p
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|p
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SYM_NUM
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rc
op_assign
id|symtab_init
c_func
(paren
op_amp
id|p-&gt;symtab
(braket
id|i
)braket
comma
id|symtab_sizes
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out_free_symtab
suffix:semicolon
)brace
id|rc
op_assign
id|avtab_init
c_func
(paren
op_amp
id|p-&gt;te_avtab
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out_free_symtab
suffix:semicolon
id|rc
op_assign
id|roles_init
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out_free_avtab
suffix:semicolon
id|rc
op_assign
id|cond_policydb_init
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out_free_avtab
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|out_free_avtab
suffix:colon
id|avtab_destroy
c_func
(paren
op_amp
id|p-&gt;te_avtab
)paren
suffix:semicolon
id|out_free_symtab
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SYM_NUM
suffix:semicolon
id|i
op_increment
)paren
id|hashtab_destroy
c_func
(paren
id|p-&gt;symtab
(braket
id|i
)braket
dot
id|table
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/*&n; * The following *_index functions are used to&n; * define the val_to_name and val_to_struct arrays&n; * in a policy database structure.  The val_to_name&n; * arrays are used when converting security context&n; * structures into string representations.  The&n; * val_to_struct arrays are used when the attributes&n; * of a class, role, or user are needed.&n; */
DECL|function|common_index
r_static
r_int
id|common_index
c_func
(paren
r_void
op_star
id|key
comma
r_void
op_star
id|datum
comma
r_void
op_star
id|datap
)paren
(brace
r_struct
id|policydb
op_star
id|p
suffix:semicolon
r_struct
id|common_datum
op_star
id|comdatum
suffix:semicolon
id|comdatum
op_assign
id|datum
suffix:semicolon
id|p
op_assign
id|datap
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|comdatum-&gt;value
op_logical_or
id|comdatum-&gt;value
OG
id|p-&gt;p_commons.nprim
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|p-&gt;p_common_val_to_name
(braket
id|comdatum-&gt;value
op_minus
l_int|1
)braket
op_assign
id|key
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|class_index
r_static
r_int
id|class_index
c_func
(paren
r_void
op_star
id|key
comma
r_void
op_star
id|datum
comma
r_void
op_star
id|datap
)paren
(brace
r_struct
id|policydb
op_star
id|p
suffix:semicolon
r_struct
id|class_datum
op_star
id|cladatum
suffix:semicolon
id|cladatum
op_assign
id|datum
suffix:semicolon
id|p
op_assign
id|datap
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cladatum-&gt;value
op_logical_or
id|cladatum-&gt;value
OG
id|p-&gt;p_classes.nprim
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|p-&gt;p_class_val_to_name
(braket
id|cladatum-&gt;value
op_minus
l_int|1
)braket
op_assign
id|key
suffix:semicolon
id|p-&gt;class_val_to_struct
(braket
id|cladatum-&gt;value
op_minus
l_int|1
)braket
op_assign
id|cladatum
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|role_index
r_static
r_int
id|role_index
c_func
(paren
r_void
op_star
id|key
comma
r_void
op_star
id|datum
comma
r_void
op_star
id|datap
)paren
(brace
r_struct
id|policydb
op_star
id|p
suffix:semicolon
r_struct
id|role_datum
op_star
id|role
suffix:semicolon
id|role
op_assign
id|datum
suffix:semicolon
id|p
op_assign
id|datap
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|role-&gt;value
op_logical_or
id|role-&gt;value
OG
id|p-&gt;p_roles.nprim
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|p-&gt;p_role_val_to_name
(braket
id|role-&gt;value
op_minus
l_int|1
)braket
op_assign
id|key
suffix:semicolon
id|p-&gt;role_val_to_struct
(braket
id|role-&gt;value
op_minus
l_int|1
)braket
op_assign
id|role
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|type_index
r_static
r_int
id|type_index
c_func
(paren
r_void
op_star
id|key
comma
r_void
op_star
id|datum
comma
r_void
op_star
id|datap
)paren
(brace
r_struct
id|policydb
op_star
id|p
suffix:semicolon
r_struct
id|type_datum
op_star
id|typdatum
suffix:semicolon
id|typdatum
op_assign
id|datum
suffix:semicolon
id|p
op_assign
id|datap
suffix:semicolon
r_if
c_cond
(paren
id|typdatum-&gt;primary
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|typdatum-&gt;value
op_logical_or
id|typdatum-&gt;value
OG
id|p-&gt;p_types.nprim
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|p-&gt;p_type_val_to_name
(braket
id|typdatum-&gt;value
op_minus
l_int|1
)braket
op_assign
id|key
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|user_index
r_static
r_int
id|user_index
c_func
(paren
r_void
op_star
id|key
comma
r_void
op_star
id|datum
comma
r_void
op_star
id|datap
)paren
(brace
r_struct
id|policydb
op_star
id|p
suffix:semicolon
r_struct
id|user_datum
op_star
id|usrdatum
suffix:semicolon
id|usrdatum
op_assign
id|datum
suffix:semicolon
id|p
op_assign
id|datap
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|usrdatum-&gt;value
op_logical_or
id|usrdatum-&gt;value
OG
id|p-&gt;p_users.nprim
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|p-&gt;p_user_val_to_name
(braket
id|usrdatum-&gt;value
op_minus
l_int|1
)braket
op_assign
id|key
suffix:semicolon
id|p-&gt;user_val_to_struct
(braket
id|usrdatum-&gt;value
op_minus
l_int|1
)braket
op_assign
id|usrdatum
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sens_index
r_static
r_int
id|sens_index
c_func
(paren
r_void
op_star
id|key
comma
r_void
op_star
id|datum
comma
r_void
op_star
id|datap
)paren
(brace
r_struct
id|policydb
op_star
id|p
suffix:semicolon
r_struct
id|level_datum
op_star
id|levdatum
suffix:semicolon
id|levdatum
op_assign
id|datum
suffix:semicolon
id|p
op_assign
id|datap
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|levdatum-&gt;isalias
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|levdatum-&gt;level-&gt;sens
op_logical_or
id|levdatum-&gt;level-&gt;sens
OG
id|p-&gt;p_levels.nprim
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|p-&gt;p_sens_val_to_name
(braket
id|levdatum-&gt;level-&gt;sens
op_minus
l_int|1
)braket
op_assign
id|key
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cat_index
r_static
r_int
id|cat_index
c_func
(paren
r_void
op_star
id|key
comma
r_void
op_star
id|datum
comma
r_void
op_star
id|datap
)paren
(brace
r_struct
id|policydb
op_star
id|p
suffix:semicolon
r_struct
id|cat_datum
op_star
id|catdatum
suffix:semicolon
id|catdatum
op_assign
id|datum
suffix:semicolon
id|p
op_assign
id|datap
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|catdatum-&gt;isalias
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|catdatum-&gt;value
op_logical_or
id|catdatum-&gt;value
OG
id|p-&gt;p_cats.nprim
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|p-&gt;p_cat_val_to_name
(braket
id|catdatum-&gt;value
op_minus
l_int|1
)braket
op_assign
id|key
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|index_f
r_static
r_int
(paren
op_star
id|index_f
(braket
id|SYM_NUM
)braket
)paren
(paren
r_void
op_star
id|key
comma
r_void
op_star
id|datum
comma
r_void
op_star
id|datap
)paren
op_assign
(brace
id|common_index
comma
id|class_index
comma
id|role_index
comma
id|type_index
comma
id|user_index
comma
id|cond_index_bool
comma
id|sens_index
comma
id|cat_index
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Define the common val_to_name array and the class&n; * val_to_name and val_to_struct arrays in a policy&n; * database structure.&n; *&n; * Caller must clean up upon failure.&n; */
DECL|function|policydb_index_classes
r_int
id|policydb_index_classes
c_func
(paren
r_struct
id|policydb
op_star
id|p
)paren
(brace
r_int
id|rc
suffix:semicolon
id|p-&gt;p_common_val_to_name
op_assign
id|kmalloc
c_func
(paren
id|p-&gt;p_commons.nprim
op_star
r_sizeof
(paren
r_char
op_star
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;p_common_val_to_name
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
id|hashtab_map
c_func
(paren
id|p-&gt;p_commons.table
comma
id|common_index
comma
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
id|p-&gt;class_val_to_struct
op_assign
id|kmalloc
c_func
(paren
id|p-&gt;p_classes.nprim
op_star
r_sizeof
(paren
op_star
(paren
id|p-&gt;class_val_to_struct
)paren
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;class_val_to_struct
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|p-&gt;p_class_val_to_name
op_assign
id|kmalloc
c_func
(paren
id|p-&gt;p_classes.nprim
op_star
r_sizeof
(paren
r_char
op_star
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;p_class_val_to_name
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
id|hashtab_map
c_func
(paren
id|p-&gt;p_classes.table
comma
id|class_index
comma
id|p
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
macro_line|#ifdef DEBUG_HASHES
DECL|function|symtab_hash_eval
r_static
r_void
id|symtab_hash_eval
c_func
(paren
r_struct
id|symtab
op_star
id|s
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SYM_NUM
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|hashtab
op_star
id|h
op_assign
id|s
(braket
id|i
)braket
dot
id|table
suffix:semicolon
r_struct
id|hashtab_info
id|info
suffix:semicolon
id|hashtab_stat
c_func
(paren
id|h
comma
op_amp
id|info
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s:  %d entries and %d/%d buckets used, &quot;
l_string|&quot;longest chain length %d&bslash;n&quot;
comma
id|symtab_name
(braket
id|i
)braket
comma
id|h-&gt;nel
comma
id|info.slots_used
comma
id|h-&gt;size
comma
id|info.max_chain_len
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/*&n; * Define the other val_to_name and val_to_struct arrays&n; * in a policy database structure.&n; *&n; * Caller must clean up on failure.&n; */
DECL|function|policydb_index_others
r_int
id|policydb_index_others
c_func
(paren
r_struct
id|policydb
op_star
id|p
)paren
(brace
r_int
id|i
comma
id|rc
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;security:  %d users, %d roles, %d types, %d bools&quot;
comma
id|p-&gt;p_users.nprim
comma
id|p-&gt;p_roles.nprim
comma
id|p-&gt;p_types.nprim
comma
id|p-&gt;p_bools.nprim
)paren
suffix:semicolon
r_if
c_cond
(paren
id|selinux_mls_enabled
)paren
id|printk
c_func
(paren
l_string|&quot;, %d sens, %d cats&quot;
comma
id|p-&gt;p_levels.nprim
comma
id|p-&gt;p_cats.nprim
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;security:  %d classes, %d rules&bslash;n&quot;
comma
id|p-&gt;p_classes.nprim
comma
id|p-&gt;te_avtab.nel
)paren
suffix:semicolon
macro_line|#ifdef DEBUG_HASHES
id|avtab_hash_eval
c_func
(paren
op_amp
id|p-&gt;te_avtab
comma
l_string|&quot;rules&quot;
)paren
suffix:semicolon
id|symtab_hash_eval
c_func
(paren
id|p-&gt;symtab
)paren
suffix:semicolon
macro_line|#endif
id|p-&gt;role_val_to_struct
op_assign
id|kmalloc
c_func
(paren
id|p-&gt;p_roles.nprim
op_star
r_sizeof
(paren
op_star
(paren
id|p-&gt;role_val_to_struct
)paren
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;role_val_to_struct
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|p-&gt;user_val_to_struct
op_assign
id|kmalloc
c_func
(paren
id|p-&gt;p_users.nprim
op_star
r_sizeof
(paren
op_star
(paren
id|p-&gt;user_val_to_struct
)paren
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;user_val_to_struct
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cond_init_bool_indexes
c_func
(paren
id|p
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
id|SYM_ROLES
suffix:semicolon
id|i
OL
id|SYM_NUM
suffix:semicolon
id|i
op_increment
)paren
(brace
id|p-&gt;sym_val_to_name
(braket
id|i
)braket
op_assign
id|kmalloc
c_func
(paren
id|p-&gt;symtab
(braket
id|i
)braket
dot
id|nprim
op_star
r_sizeof
(paren
r_char
op_star
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;sym_val_to_name
(braket
id|i
)braket
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
id|hashtab_map
c_func
(paren
id|p-&gt;symtab
(braket
id|i
)braket
dot
id|table
comma
id|index_f
(braket
id|i
)braket
comma
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * The following *_destroy functions are used to&n; * free any memory allocated for each kind of&n; * symbol data in the policy database.&n; */
DECL|function|perm_destroy
r_static
r_int
id|perm_destroy
c_func
(paren
r_void
op_star
id|key
comma
r_void
op_star
id|datum
comma
r_void
op_star
id|p
)paren
(brace
id|kfree
c_func
(paren
id|key
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|datum
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|common_destroy
r_static
r_int
id|common_destroy
c_func
(paren
r_void
op_star
id|key
comma
r_void
op_star
id|datum
comma
r_void
op_star
id|p
)paren
(brace
r_struct
id|common_datum
op_star
id|comdatum
suffix:semicolon
id|kfree
c_func
(paren
id|key
)paren
suffix:semicolon
id|comdatum
op_assign
id|datum
suffix:semicolon
id|hashtab_map
c_func
(paren
id|comdatum-&gt;permissions.table
comma
id|perm_destroy
comma
l_int|NULL
)paren
suffix:semicolon
id|hashtab_destroy
c_func
(paren
id|comdatum-&gt;permissions.table
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|datum
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|class_destroy
r_static
r_int
id|class_destroy
c_func
(paren
r_void
op_star
id|key
comma
r_void
op_star
id|datum
comma
r_void
op_star
id|p
)paren
(brace
r_struct
id|class_datum
op_star
id|cladatum
suffix:semicolon
r_struct
id|constraint_node
op_star
id|constraint
comma
op_star
id|ctemp
suffix:semicolon
r_struct
id|constraint_expr
op_star
id|e
comma
op_star
id|etmp
suffix:semicolon
id|kfree
c_func
(paren
id|key
)paren
suffix:semicolon
id|cladatum
op_assign
id|datum
suffix:semicolon
id|hashtab_map
c_func
(paren
id|cladatum-&gt;permissions.table
comma
id|perm_destroy
comma
l_int|NULL
)paren
suffix:semicolon
id|hashtab_destroy
c_func
(paren
id|cladatum-&gt;permissions.table
)paren
suffix:semicolon
id|constraint
op_assign
id|cladatum-&gt;constraints
suffix:semicolon
r_while
c_loop
(paren
id|constraint
)paren
(brace
id|e
op_assign
id|constraint-&gt;expr
suffix:semicolon
r_while
c_loop
(paren
id|e
)paren
(brace
id|ebitmap_destroy
c_func
(paren
op_amp
id|e-&gt;names
)paren
suffix:semicolon
id|etmp
op_assign
id|e
suffix:semicolon
id|e
op_assign
id|e-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|etmp
)paren
suffix:semicolon
)brace
id|ctemp
op_assign
id|constraint
suffix:semicolon
id|constraint
op_assign
id|constraint-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|ctemp
)paren
suffix:semicolon
)brace
id|constraint
op_assign
id|cladatum-&gt;validatetrans
suffix:semicolon
r_while
c_loop
(paren
id|constraint
)paren
(brace
id|e
op_assign
id|constraint-&gt;expr
suffix:semicolon
r_while
c_loop
(paren
id|e
)paren
(brace
id|ebitmap_destroy
c_func
(paren
op_amp
id|e-&gt;names
)paren
suffix:semicolon
id|etmp
op_assign
id|e
suffix:semicolon
id|e
op_assign
id|e-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|etmp
)paren
suffix:semicolon
)brace
id|ctemp
op_assign
id|constraint
suffix:semicolon
id|constraint
op_assign
id|constraint-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|ctemp
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|cladatum-&gt;comkey
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|datum
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|role_destroy
r_static
r_int
id|role_destroy
c_func
(paren
r_void
op_star
id|key
comma
r_void
op_star
id|datum
comma
r_void
op_star
id|p
)paren
(brace
r_struct
id|role_datum
op_star
id|role
suffix:semicolon
id|kfree
c_func
(paren
id|key
)paren
suffix:semicolon
id|role
op_assign
id|datum
suffix:semicolon
id|ebitmap_destroy
c_func
(paren
op_amp
id|role-&gt;dominates
)paren
suffix:semicolon
id|ebitmap_destroy
c_func
(paren
op_amp
id|role-&gt;types
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|datum
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|type_destroy
r_static
r_int
id|type_destroy
c_func
(paren
r_void
op_star
id|key
comma
r_void
op_star
id|datum
comma
r_void
op_star
id|p
)paren
(brace
id|kfree
c_func
(paren
id|key
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|datum
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|user_destroy
r_static
r_int
id|user_destroy
c_func
(paren
r_void
op_star
id|key
comma
r_void
op_star
id|datum
comma
r_void
op_star
id|p
)paren
(brace
r_struct
id|user_datum
op_star
id|usrdatum
suffix:semicolon
id|kfree
c_func
(paren
id|key
)paren
suffix:semicolon
id|usrdatum
op_assign
id|datum
suffix:semicolon
id|ebitmap_destroy
c_func
(paren
op_amp
id|usrdatum-&gt;roles
)paren
suffix:semicolon
id|ebitmap_destroy
c_func
(paren
op_amp
id|usrdatum-&gt;range.level
(braket
l_int|0
)braket
dot
id|cat
)paren
suffix:semicolon
id|ebitmap_destroy
c_func
(paren
op_amp
id|usrdatum-&gt;range.level
(braket
l_int|1
)braket
dot
id|cat
)paren
suffix:semicolon
id|ebitmap_destroy
c_func
(paren
op_amp
id|usrdatum-&gt;dfltlevel.cat
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|datum
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sens_destroy
r_static
r_int
id|sens_destroy
c_func
(paren
r_void
op_star
id|key
comma
r_void
op_star
id|datum
comma
r_void
op_star
id|p
)paren
(brace
r_struct
id|level_datum
op_star
id|levdatum
suffix:semicolon
id|kfree
c_func
(paren
id|key
)paren
suffix:semicolon
id|levdatum
op_assign
id|datum
suffix:semicolon
id|ebitmap_destroy
c_func
(paren
op_amp
id|levdatum-&gt;level-&gt;cat
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|levdatum-&gt;level
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|datum
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cat_destroy
r_static
r_int
id|cat_destroy
c_func
(paren
r_void
op_star
id|key
comma
r_void
op_star
id|datum
comma
r_void
op_star
id|p
)paren
(brace
id|kfree
c_func
(paren
id|key
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|datum
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|destroy_f
r_static
r_int
(paren
op_star
id|destroy_f
(braket
id|SYM_NUM
)braket
)paren
(paren
r_void
op_star
id|key
comma
r_void
op_star
id|datum
comma
r_void
op_star
id|datap
)paren
op_assign
(brace
id|common_destroy
comma
id|class_destroy
comma
id|role_destroy
comma
id|type_destroy
comma
id|user_destroy
comma
id|cond_destroy_bool
comma
id|sens_destroy
comma
id|cat_destroy
comma
)brace
suffix:semicolon
DECL|function|ocontext_destroy
r_void
id|ocontext_destroy
c_func
(paren
r_struct
id|ocontext
op_star
id|c
comma
r_int
id|i
)paren
(brace
id|context_destroy
c_func
(paren
op_amp
id|c-&gt;context
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|context_destroy
c_func
(paren
op_amp
id|c-&gt;context
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|OCON_ISID
op_logical_or
id|i
op_eq
id|OCON_FS
op_logical_or
id|i
op_eq
id|OCON_NETIF
op_logical_or
id|i
op_eq
id|OCON_FSUSE
)paren
id|kfree
c_func
(paren
id|c-&gt;u.name
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|c
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Free any memory allocated by a policy database structure.&n; */
DECL|function|policydb_destroy
r_void
id|policydb_destroy
c_func
(paren
r_struct
id|policydb
op_star
id|p
)paren
(brace
r_struct
id|ocontext
op_star
id|c
comma
op_star
id|ctmp
suffix:semicolon
r_struct
id|genfs
op_star
id|g
comma
op_star
id|gtmp
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SYM_NUM
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hashtab_map
c_func
(paren
id|p-&gt;symtab
(braket
id|i
)braket
dot
id|table
comma
id|destroy_f
(braket
id|i
)braket
comma
l_int|NULL
)paren
suffix:semicolon
id|hashtab_destroy
c_func
(paren
id|p-&gt;symtab
(braket
id|i
)braket
dot
id|table
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SYM_NUM
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;sym_val_to_name
(braket
id|i
)braket
)paren
id|kfree
c_func
(paren
id|p-&gt;sym_val_to_name
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;class_val_to_struct
)paren
id|kfree
c_func
(paren
id|p-&gt;class_val_to_struct
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;role_val_to_struct
)paren
id|kfree
c_func
(paren
id|p-&gt;role_val_to_struct
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;user_val_to_struct
)paren
id|kfree
c_func
(paren
id|p-&gt;user_val_to_struct
)paren
suffix:semicolon
id|avtab_destroy
c_func
(paren
op_amp
id|p-&gt;te_avtab
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|OCON_NUM
suffix:semicolon
id|i
op_increment
)paren
(brace
id|c
op_assign
id|p-&gt;ocontexts
(braket
id|i
)braket
suffix:semicolon
r_while
c_loop
(paren
id|c
)paren
(brace
id|ctmp
op_assign
id|c
suffix:semicolon
id|c
op_assign
id|c-&gt;next
suffix:semicolon
id|ocontext_destroy
c_func
(paren
id|ctmp
comma
id|i
)paren
suffix:semicolon
)brace
)brace
id|g
op_assign
id|p-&gt;genfs
suffix:semicolon
r_while
c_loop
(paren
id|g
)paren
(brace
id|kfree
c_func
(paren
id|g-&gt;fstype
)paren
suffix:semicolon
id|c
op_assign
id|g-&gt;head
suffix:semicolon
r_while
c_loop
(paren
id|c
)paren
(brace
id|ctmp
op_assign
id|c
suffix:semicolon
id|c
op_assign
id|c-&gt;next
suffix:semicolon
id|ocontext_destroy
c_func
(paren
id|ctmp
comma
id|OCON_FSUSE
)paren
suffix:semicolon
)brace
id|gtmp
op_assign
id|g
suffix:semicolon
id|g
op_assign
id|g-&gt;next
suffix:semicolon
id|kfree
c_func
(paren
id|gtmp
)paren
suffix:semicolon
)brace
id|cond_policydb_destroy
c_func
(paren
id|p
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * Load the initial SIDs specified in a policy database&n; * structure into a SID table.&n; */
DECL|function|policydb_load_isids
r_int
id|policydb_load_isids
c_func
(paren
r_struct
id|policydb
op_star
id|p
comma
r_struct
id|sidtab
op_star
id|s
)paren
(brace
r_struct
id|ocontext
op_star
id|head
comma
op_star
id|c
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|sidtab_init
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security:  out of memory on SID table init&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|head
op_assign
id|p-&gt;ocontexts
(braket
id|OCON_ISID
)braket
suffix:semicolon
r_for
c_loop
(paren
id|c
op_assign
id|head
suffix:semicolon
id|c
suffix:semicolon
id|c
op_assign
id|c-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|c-&gt;context
(braket
l_int|0
)braket
dot
id|user
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security:  SID %s was never &quot;
l_string|&quot;defined.&bslash;n&quot;
comma
id|c-&gt;u.name
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sidtab_insert
c_func
(paren
id|s
comma
id|c-&gt;sid
(braket
l_int|0
)braket
comma
op_amp
id|c-&gt;context
(braket
l_int|0
)braket
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security:  unable to load initial &quot;
l_string|&quot;SID %s.&bslash;n&quot;
comma
id|c-&gt;u.name
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * Return 1 if the fields in the security context&n; * structure `c&squot; are valid.  Return 0 otherwise.&n; */
DECL|function|policydb_context_isvalid
r_int
id|policydb_context_isvalid
c_func
(paren
r_struct
id|policydb
op_star
id|p
comma
r_struct
id|context
op_star
id|c
)paren
(brace
r_struct
id|role_datum
op_star
id|role
suffix:semicolon
r_struct
id|user_datum
op_star
id|usrdatum
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c-&gt;role
op_logical_or
id|c-&gt;role
OG
id|p-&gt;p_roles.nprim
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c-&gt;user
op_logical_or
id|c-&gt;user
OG
id|p-&gt;p_users.nprim
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c-&gt;type
op_logical_or
id|c-&gt;type
OG
id|p-&gt;p_types.nprim
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;role
op_ne
id|OBJECT_R_VAL
)paren
(brace
multiline_comment|/*&n;&t;&t; * Role must be authorized for the type.&n;&t;&t; */
id|role
op_assign
id|p-&gt;role_val_to_struct
(braket
id|c-&gt;role
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ebitmap_get_bit
c_func
(paren
op_amp
id|role-&gt;types
comma
id|c-&gt;type
op_minus
l_int|1
)paren
)paren
multiline_comment|/* role may not be associated with type */
r_return
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t;&t; * User must be authorized for the role.&n;&t;&t; */
id|usrdatum
op_assign
id|p-&gt;user_val_to_struct
(braket
id|c-&gt;user
op_minus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|usrdatum
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ebitmap_get_bit
c_func
(paren
op_amp
id|usrdatum-&gt;roles
comma
id|c-&gt;role
op_minus
l_int|1
)paren
)paren
multiline_comment|/* user may not be associated with role */
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|mls_context_isvalid
c_func
(paren
id|p
comma
id|c
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * Read a MLS range structure from a policydb binary&n; * representation file.&n; */
DECL|function|mls_read_range_helper
r_static
r_int
id|mls_read_range_helper
c_func
(paren
r_struct
id|mls_range
op_star
id|r
comma
r_void
op_star
id|fp
)paren
(brace
id|u32
id|buf
(braket
l_int|2
)braket
comma
id|items
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|items
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|items
OG
id|ARRAY_SIZE
c_func
(paren
id|buf
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security: mls:  range overflow&bslash;n&quot;
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
op_star
id|items
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security: mls:  truncated range&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|r-&gt;level
(braket
l_int|0
)braket
dot
id|sens
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|items
OG
l_int|1
)paren
id|r-&gt;level
(braket
l_int|1
)braket
dot
id|sens
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_else
id|r-&gt;level
(braket
l_int|1
)braket
dot
id|sens
op_assign
id|r-&gt;level
(braket
l_int|0
)braket
dot
id|sens
suffix:semicolon
id|rc
op_assign
id|ebitmap_read
c_func
(paren
op_amp
id|r-&gt;level
(braket
l_int|0
)braket
dot
id|cat
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security: mls:  error reading low &quot;
l_string|&quot;categories&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|items
OG
l_int|1
)paren
(brace
id|rc
op_assign
id|ebitmap_read
c_func
(paren
op_amp
id|r-&gt;level
(braket
l_int|1
)braket
dot
id|cat
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security: mls:  error reading high &quot;
l_string|&quot;categories&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|bad_high
suffix:semicolon
)brace
)brace
r_else
(brace
id|rc
op_assign
id|ebitmap_cpy
c_func
(paren
op_amp
id|r-&gt;level
(braket
l_int|1
)braket
dot
id|cat
comma
op_amp
id|r-&gt;level
(braket
l_int|0
)braket
dot
id|cat
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security: mls:  out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|bad_high
suffix:semicolon
)brace
)brace
id|rc
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|bad_high
suffix:colon
id|ebitmap_destroy
c_func
(paren
op_amp
id|r-&gt;level
(braket
l_int|0
)braket
dot
id|cat
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/*&n; * Read and validate a security context structure&n; * from a policydb binary representation file.&n; */
DECL|function|context_read_and_validate
r_static
r_int
id|context_read_and_validate
c_func
(paren
r_struct
id|context
op_star
id|c
comma
r_struct
id|policydb
op_star
id|p
comma
r_void
op_star
id|fp
)paren
(brace
id|u32
id|buf
(braket
l_int|3
)braket
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security: context truncated&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|c-&gt;user
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|c-&gt;role
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|c-&gt;type
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;policyvers
op_ge
id|POLICYDB_VERSION_MLS
)paren
(brace
r_if
c_cond
(paren
id|mls_read_range_helper
c_func
(paren
op_amp
id|c-&gt;range
comma
id|fp
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security: error reading MLS range of &quot;
l_string|&quot;context&bslash;n&quot;
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|policydb_context_isvalid
c_func
(paren
id|p
comma
id|c
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security:  invalid security context&bslash;n&quot;
)paren
suffix:semicolon
id|context_destroy
c_func
(paren
id|c
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * The following *_read functions are used to&n; * read the symbol data from a policy database&n; * binary representation file.&n; */
DECL|function|perm_read
r_static
r_int
id|perm_read
c_func
(paren
r_struct
id|policydb
op_star
id|p
comma
r_struct
id|hashtab
op_star
id|h
comma
r_void
op_star
id|fp
)paren
(brace
r_char
op_star
id|key
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|perm_datum
op_star
id|perdatum
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|u32
id|buf
(braket
l_int|2
)braket
comma
id|len
suffix:semicolon
id|perdatum
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|perdatum
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|perdatum
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|perdatum
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|perdatum
)paren
)paren
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|len
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|perdatum-&gt;value
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|key
op_assign
id|kmalloc
c_func
(paren
id|len
op_plus
l_int|1
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|key
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|key
comma
id|fp
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|key
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
id|rc
op_assign
id|hashtab_insert
c_func
(paren
id|h
comma
id|key
comma
id|perdatum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|bad
suffix:colon
id|perm_destroy
c_func
(paren
id|key
comma
id|perdatum
comma
l_int|NULL
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|common_read
r_static
r_int
id|common_read
c_func
(paren
r_struct
id|policydb
op_star
id|p
comma
r_struct
id|hashtab
op_star
id|h
comma
r_void
op_star
id|fp
)paren
(brace
r_char
op_star
id|key
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|common_datum
op_star
id|comdatum
suffix:semicolon
id|u32
id|buf
(braket
l_int|4
)braket
comma
id|len
comma
id|nel
suffix:semicolon
r_int
id|i
comma
id|rc
suffix:semicolon
id|comdatum
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|comdatum
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|comdatum
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|comdatum
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|comdatum
)paren
)paren
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|len
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|comdatum-&gt;value
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|rc
op_assign
id|symtab_init
c_func
(paren
op_amp
id|comdatum-&gt;permissions
comma
id|PERM_SYMTAB_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
id|comdatum-&gt;permissions.nprim
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|nel
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|key
op_assign
id|kmalloc
c_func
(paren
id|len
op_plus
l_int|1
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|key
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|key
comma
id|fp
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|key
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nel
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rc
op_assign
id|perm_read
c_func
(paren
id|p
comma
id|comdatum-&gt;permissions.table
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|hashtab_insert
c_func
(paren
id|h
comma
id|key
comma
id|comdatum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|bad
suffix:colon
id|common_destroy
c_func
(paren
id|key
comma
id|comdatum
comma
l_int|NULL
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|read_cons_helper
r_static
r_int
id|read_cons_helper
c_func
(paren
r_struct
id|constraint_node
op_star
op_star
id|nodep
comma
r_int
id|ncons
comma
r_int
id|allowxtarget
comma
r_void
op_star
id|fp
)paren
(brace
r_struct
id|constraint_node
op_star
id|c
comma
op_star
id|lc
suffix:semicolon
r_struct
id|constraint_expr
op_star
id|e
comma
op_star
id|le
suffix:semicolon
id|u32
id|buf
(braket
l_int|3
)braket
comma
id|nexpr
suffix:semicolon
r_int
id|rc
comma
id|i
comma
id|j
comma
id|depth
suffix:semicolon
id|lc
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ncons
suffix:semicolon
id|i
op_increment
)paren
(brace
id|c
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|c
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|c
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|c
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lc
)paren
(brace
id|lc-&gt;next
op_assign
id|c
suffix:semicolon
)brace
r_else
(brace
op_star
id|nodep
op_assign
id|c
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
(paren
r_sizeof
(paren
id|u32
)paren
op_star
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_return
id|rc
suffix:semicolon
id|c-&gt;permissions
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|nexpr
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|le
op_assign
l_int|NULL
suffix:semicolon
id|depth
op_assign
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|nexpr
suffix:semicolon
id|j
op_increment
)paren
(brace
id|e
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|e
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|e
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|e
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|e
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|le
)paren
(brace
id|le-&gt;next
op_assign
id|e
suffix:semicolon
)brace
r_else
(brace
id|c-&gt;expr
op_assign
id|e
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
(paren
r_sizeof
(paren
id|u32
)paren
op_star
l_int|3
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_return
id|rc
suffix:semicolon
id|e-&gt;expr_type
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|e-&gt;attr
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|e-&gt;op
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|e-&gt;expr_type
)paren
(brace
r_case
id|CEXPR_NOT
suffix:colon
r_if
c_cond
(paren
id|depth
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CEXPR_AND
suffix:colon
r_case
id|CEXPR_OR
suffix:colon
r_if
c_cond
(paren
id|depth
OL
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|depth
op_decrement
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CEXPR_ATTR
suffix:colon
r_if
c_cond
(paren
id|depth
op_eq
(paren
id|CEXPR_MAXDEPTH
op_minus
l_int|1
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|depth
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CEXPR_NAMES
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|allowxtarget
op_logical_and
(paren
id|e-&gt;attr
op_amp
id|CEXPR_XTARGET
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|depth
op_eq
(paren
id|CEXPR_MAXDEPTH
op_minus
l_int|1
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|depth
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|ebitmap_read
c_func
(paren
op_amp
id|e-&gt;names
comma
id|fp
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|le
op_assign
id|e
suffix:semicolon
)brace
r_if
c_cond
(paren
id|depth
op_ne
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|lc
op_assign
id|c
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|class_read
r_static
r_int
id|class_read
c_func
(paren
r_struct
id|policydb
op_star
id|p
comma
r_struct
id|hashtab
op_star
id|h
comma
r_void
op_star
id|fp
)paren
(brace
r_char
op_star
id|key
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|class_datum
op_star
id|cladatum
suffix:semicolon
id|u32
id|buf
(braket
l_int|6
)braket
comma
id|len
comma
id|len2
comma
id|ncons
comma
id|nel
suffix:semicolon
r_int
id|i
comma
id|rc
suffix:semicolon
id|cladatum
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|cladatum
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cladatum
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|cladatum
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|cladatum
)paren
)paren
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
op_star
l_int|6
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|len
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|len2
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|cladatum-&gt;value
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|rc
op_assign
id|symtab_init
c_func
(paren
op_amp
id|cladatum-&gt;permissions
comma
id|PERM_SYMTAB_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
id|cladatum-&gt;permissions.nprim
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|nel
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|ncons
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|key
op_assign
id|kmalloc
c_func
(paren
id|len
op_plus
l_int|1
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|key
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|key
comma
id|fp
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|key
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|len2
)paren
(brace
id|cladatum-&gt;comkey
op_assign
id|kmalloc
c_func
(paren
id|len2
op_plus
l_int|1
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cladatum-&gt;comkey
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|cladatum-&gt;comkey
comma
id|fp
comma
id|len2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|cladatum-&gt;comkey
(braket
id|len2
)braket
op_assign
l_int|0
suffix:semicolon
id|cladatum-&gt;comdatum
op_assign
id|hashtab_search
c_func
(paren
id|p-&gt;p_commons.table
comma
id|cladatum-&gt;comkey
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cladatum-&gt;comdatum
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security:  unknown common %s&bslash;n&quot;
comma
id|cladatum-&gt;comkey
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nel
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rc
op_assign
id|perm_read
c_func
(paren
id|p
comma
id|cladatum-&gt;permissions.table
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|read_cons_helper
c_func
(paren
op_amp
id|cladatum-&gt;constraints
comma
id|ncons
comma
l_int|0
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;policyvers
op_ge
id|POLICYDB_VERSION_VALIDATETRANS
)paren
(brace
multiline_comment|/* grab the validatetrans rules */
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|ncons
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|rc
op_assign
id|read_cons_helper
c_func
(paren
op_amp
id|cladatum-&gt;validatetrans
comma
id|ncons
comma
l_int|1
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|hashtab_insert
c_func
(paren
id|h
comma
id|key
comma
id|cladatum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|bad
suffix:colon
id|class_destroy
c_func
(paren
id|key
comma
id|cladatum
comma
l_int|NULL
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|role_read
r_static
r_int
id|role_read
c_func
(paren
r_struct
id|policydb
op_star
id|p
comma
r_struct
id|hashtab
op_star
id|h
comma
r_void
op_star
id|fp
)paren
(brace
r_char
op_star
id|key
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|role_datum
op_star
id|role
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|u32
id|buf
(braket
l_int|2
)braket
comma
id|len
suffix:semicolon
id|role
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|role
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|role
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|role
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|role
)paren
)paren
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|len
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|role-&gt;value
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|key
op_assign
id|kmalloc
c_func
(paren
id|len
op_plus
l_int|1
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|key
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|key
comma
id|fp
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|key
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
id|rc
op_assign
id|ebitmap_read
c_func
(paren
op_amp
id|role-&gt;dominates
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
id|rc
op_assign
id|ebitmap_read
c_func
(paren
op_amp
id|role-&gt;types
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|key
comma
id|OBJECT_R
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|role-&gt;value
op_ne
id|OBJECT_R_VAL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Role %s has wrong value %d&bslash;n&quot;
comma
id|OBJECT_R
comma
id|role-&gt;value
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
l_int|0
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|hashtab_insert
c_func
(paren
id|h
comma
id|key
comma
id|role
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|bad
suffix:colon
id|role_destroy
c_func
(paren
id|key
comma
id|role
comma
l_int|NULL
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|type_read
r_static
r_int
id|type_read
c_func
(paren
r_struct
id|policydb
op_star
id|p
comma
r_struct
id|hashtab
op_star
id|h
comma
r_void
op_star
id|fp
)paren
(brace
r_char
op_star
id|key
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|type_datum
op_star
id|typdatum
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|u32
id|buf
(braket
l_int|3
)braket
comma
id|len
suffix:semicolon
id|typdatum
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|typdatum
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|typdatum
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|memset
c_func
(paren
id|typdatum
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|typdatum
)paren
)paren
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|len
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|typdatum-&gt;value
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|typdatum-&gt;primary
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|key
op_assign
id|kmalloc
c_func
(paren
id|len
op_plus
l_int|1
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|key
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|key
comma
id|fp
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|key
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
id|rc
op_assign
id|hashtab_insert
c_func
(paren
id|h
comma
id|key
comma
id|typdatum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|bad
suffix:colon
id|type_destroy
c_func
(paren
id|key
comma
id|typdatum
comma
l_int|NULL
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/*&n; * Read a MLS level structure from a policydb binary&n; * representation file.&n; */
DECL|function|mls_read_level
r_static
r_int
id|mls_read_level
c_func
(paren
r_struct
id|mls_level
op_star
id|lp
comma
r_void
op_star
id|fp
)paren
(brace
id|u32
id|buf
(braket
l_int|1
)braket
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|memset
c_func
(paren
id|lp
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|lp
)paren
)paren
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security: mls: truncated level&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|lp-&gt;sens
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ebitmap_read
c_func
(paren
op_amp
id|lp-&gt;cat
comma
id|fp
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security: mls:  error reading level &quot;
l_string|&quot;categories&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|bad
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|user_read
r_static
r_int
id|user_read
c_func
(paren
r_struct
id|policydb
op_star
id|p
comma
r_struct
id|hashtab
op_star
id|h
comma
r_void
op_star
id|fp
)paren
(brace
r_char
op_star
id|key
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|user_datum
op_star
id|usrdatum
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|u32
id|buf
(braket
l_int|2
)braket
comma
id|len
suffix:semicolon
id|usrdatum
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|usrdatum
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|usrdatum
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|usrdatum
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|usrdatum
)paren
)paren
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|len
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|usrdatum-&gt;value
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|key
op_assign
id|kmalloc
c_func
(paren
id|len
op_plus
l_int|1
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|key
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|key
comma
id|fp
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|key
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
id|rc
op_assign
id|ebitmap_read
c_func
(paren
op_amp
id|usrdatum-&gt;roles
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;policyvers
op_ge
id|POLICYDB_VERSION_MLS
)paren
(brace
id|rc
op_assign
id|mls_read_range_helper
c_func
(paren
op_amp
id|usrdatum-&gt;range
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
id|rc
op_assign
id|mls_read_level
c_func
(paren
op_amp
id|usrdatum-&gt;dfltlevel
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|hashtab_insert
c_func
(paren
id|h
comma
id|key
comma
id|usrdatum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|bad
suffix:colon
id|user_destroy
c_func
(paren
id|key
comma
id|usrdatum
comma
l_int|NULL
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|sens_read
r_static
r_int
id|sens_read
c_func
(paren
r_struct
id|policydb
op_star
id|p
comma
r_struct
id|hashtab
op_star
id|h
comma
r_void
op_star
id|fp
)paren
(brace
r_char
op_star
id|key
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|level_datum
op_star
id|levdatum
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|u32
id|buf
(braket
l_int|2
)braket
comma
id|len
suffix:semicolon
id|levdatum
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|levdatum
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|levdatum
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|levdatum
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|levdatum
)paren
)paren
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|len
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|levdatum-&gt;isalias
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|key
op_assign
id|kmalloc
c_func
(paren
id|len
op_plus
l_int|1
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|key
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|key
comma
id|fp
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|key
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
id|levdatum-&gt;level
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|mls_level
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|levdatum-&gt;level
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mls_read_level
c_func
(paren
id|levdatum-&gt;level
comma
id|fp
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|hashtab_insert
c_func
(paren
id|h
comma
id|key
comma
id|levdatum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|bad
suffix:colon
id|sens_destroy
c_func
(paren
id|key
comma
id|levdatum
comma
l_int|NULL
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|cat_read
r_static
r_int
id|cat_read
c_func
(paren
r_struct
id|policydb
op_star
id|p
comma
r_struct
id|hashtab
op_star
id|h
comma
r_void
op_star
id|fp
)paren
(brace
r_char
op_star
id|key
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|cat_datum
op_star
id|catdatum
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|u32
id|buf
(braket
l_int|3
)braket
comma
id|len
suffix:semicolon
id|catdatum
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|catdatum
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|catdatum
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|memset
c_func
(paren
id|catdatum
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|catdatum
)paren
)paren
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|len
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|catdatum-&gt;value
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|catdatum-&gt;isalias
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|key
op_assign
id|kmalloc
c_func
(paren
id|len
op_plus
l_int|1
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|key
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|key
comma
id|fp
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|key
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
id|rc
op_assign
id|hashtab_insert
c_func
(paren
id|h
comma
id|key
comma
id|catdatum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|bad
suffix:colon
id|cat_destroy
c_func
(paren
id|key
comma
id|catdatum
comma
l_int|NULL
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|variable|read_f
r_static
r_int
(paren
op_star
id|read_f
(braket
id|SYM_NUM
)braket
)paren
(paren
r_struct
id|policydb
op_star
id|p
comma
r_struct
id|hashtab
op_star
id|h
comma
r_void
op_star
id|fp
)paren
op_assign
(brace
id|common_read
comma
id|class_read
comma
id|role_read
comma
id|type_read
comma
id|user_read
comma
id|cond_read_bool
comma
id|sens_read
comma
id|cat_read
comma
)brace
suffix:semicolon
r_extern
r_int
id|ss_initialized
suffix:semicolon
multiline_comment|/*&n; * Read the configuration data from a policy database binary&n; * representation file into a policy database structure.&n; */
DECL|function|policydb_read
r_int
id|policydb_read
c_func
(paren
r_struct
id|policydb
op_star
id|p
comma
r_void
op_star
id|fp
)paren
(brace
r_struct
id|role_allow
op_star
id|ra
comma
op_star
id|lra
suffix:semicolon
r_struct
id|role_trans
op_star
id|tr
comma
op_star
id|ltr
suffix:semicolon
r_struct
id|ocontext
op_star
id|l
comma
op_star
id|c
comma
op_star
id|newc
suffix:semicolon
r_struct
id|genfs
op_star
id|genfs_p
comma
op_star
id|genfs
comma
op_star
id|newgenfs
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|rc
suffix:semicolon
id|u32
id|buf
(braket
l_int|8
)braket
comma
id|len
comma
id|len2
comma
id|config
comma
id|nprim
comma
id|nel
comma
id|nel2
suffix:semicolon
r_char
op_star
id|policydb_str
suffix:semicolon
r_struct
id|policydb_compat_info
op_star
id|info
suffix:semicolon
r_struct
id|range_trans
op_star
id|rt
comma
op_star
id|lrt
suffix:semicolon
id|config
op_assign
l_int|0
suffix:semicolon
id|rc
op_assign
id|policydb_init
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Read the magic number and string length. */
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
op_star
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
id|buf
(braket
id|i
)braket
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf
(braket
l_int|0
)braket
op_ne
id|POLICYDB_MAGIC
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security:  policydb magic number 0x%x does &quot;
l_string|&quot;not match expected magic number 0x%x&bslash;n&quot;
comma
id|buf
(braket
l_int|0
)braket
comma
id|POLICYDB_MAGIC
)paren
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|len
op_assign
id|buf
(braket
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|len
op_ne
id|strlen
c_func
(paren
id|POLICYDB_STRING
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security:  policydb string length %d does not &quot;
l_string|&quot;match expected length %Zu&bslash;n&quot;
comma
id|len
comma
id|strlen
c_func
(paren
id|POLICYDB_STRING
)paren
)paren
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|policydb_str
op_assign
id|kmalloc
c_func
(paren
id|len
op_plus
l_int|1
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|policydb_str
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security:  unable to allocate memory for policydb &quot;
l_string|&quot;string of length %d&bslash;n&quot;
comma
id|len
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|policydb_str
comma
id|fp
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security:  truncated policydb string identifier&bslash;n&quot;
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|policydb_str
)paren
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|policydb_str
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|policydb_str
comma
id|POLICYDB_STRING
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security:  policydb string %s does not match &quot;
l_string|&quot;my string %s&bslash;n&quot;
comma
id|policydb_str
comma
id|POLICYDB_STRING
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|policydb_str
)paren
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
multiline_comment|/* Done with policydb_str. */
id|kfree
c_func
(paren
id|policydb_str
)paren
suffix:semicolon
id|policydb_str
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Read the version, config, and table sizes. */
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
op_star
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|buf
(braket
id|i
)braket
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
id|i
)braket
)paren
suffix:semicolon
id|p-&gt;policyvers
op_assign
id|buf
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;policyvers
template_param
id|POLICYDB_VERSION_MAX
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security:  policydb version %d does not match &quot;
l_string|&quot;my version range %d-%d&bslash;n&quot;
comma
id|buf
(braket
l_int|0
)braket
comma
id|POLICYDB_VERSION_MIN
comma
id|POLICYDB_VERSION_MAX
)paren
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|buf
(braket
l_int|1
)braket
op_amp
id|POLICYDB_CONFIG_MLS
)paren
)paren
(brace
r_if
c_cond
(paren
id|ss_initialized
op_logical_and
op_logical_neg
id|selinux_mls_enabled
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Cannot switch between non-MLS and MLS &quot;
l_string|&quot;policies&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|selinux_mls_enabled
op_assign
l_int|1
suffix:semicolon
id|config
op_or_assign
id|POLICYDB_CONFIG_MLS
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;policyvers
OL
id|POLICYDB_VERSION_MLS
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security policydb version %d (MLS) &quot;
l_string|&quot;not backwards compatible&bslash;n&quot;
comma
id|p-&gt;policyvers
)paren
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|ss_initialized
op_logical_and
id|selinux_mls_enabled
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Cannot switch between MLS and non-MLS &quot;
l_string|&quot;policies&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
)brace
id|info
op_assign
id|policydb_lookup_compat
c_func
(paren
id|p-&gt;policyvers
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|info
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security:  unable to find policy compat info &quot;
l_string|&quot;for version %d&bslash;n&quot;
comma
id|p-&gt;policyvers
)paren
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
r_if
c_cond
(paren
id|buf
(braket
l_int|2
)braket
op_ne
id|info-&gt;sym_num
op_logical_or
id|buf
(braket
l_int|3
)braket
op_ne
id|info-&gt;ocon_num
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security:  policydb table sizes (%d,%d) do &quot;
l_string|&quot;not match mine (%d,%d)&bslash;n&quot;
comma
id|buf
(braket
l_int|2
)braket
comma
id|buf
(braket
l_int|3
)braket
comma
id|info-&gt;sym_num
comma
id|info-&gt;ocon_num
)paren
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|info-&gt;sym_num
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
op_star
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|nprim
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|nel
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|nel
suffix:semicolon
id|j
op_increment
)paren
(brace
id|rc
op_assign
id|read_f
(braket
id|i
)braket
(paren
id|p
comma
id|p-&gt;symtab
(braket
id|i
)braket
dot
id|table
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
)brace
id|p-&gt;symtab
(braket
id|i
)braket
dot
id|nprim
op_assign
id|nprim
suffix:semicolon
)brace
id|rc
op_assign
id|avtab_read
c_func
(paren
op_amp
id|p-&gt;te_avtab
comma
id|fp
comma
id|config
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;policyvers
op_ge
id|POLICYDB_VERSION_BOOL
)paren
(brace
id|rc
op_assign
id|cond_read_list
c_func
(paren
id|p
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|nel
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|ltr
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nel
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tr
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|tr
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tr
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|memset
c_func
(paren
id|tr
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|tr
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ltr
)paren
(brace
id|ltr-&gt;next
op_assign
id|tr
suffix:semicolon
)brace
r_else
(brace
id|p-&gt;role_tr
op_assign
id|tr
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
op_star
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|tr-&gt;role
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|tr-&gt;type
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|tr-&gt;new_role
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|ltr
op_assign
id|tr
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|nel
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|lra
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nel
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ra
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|ra
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ra
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|memset
c_func
(paren
id|ra
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|ra
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lra
)paren
(brace
id|lra-&gt;next
op_assign
id|ra
suffix:semicolon
)brace
r_else
(brace
id|p-&gt;role_allow
op_assign
id|ra
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
op_star
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|ra-&gt;role
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|ra-&gt;new_role
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|lra
op_assign
id|ra
suffix:semicolon
)brace
id|rc
op_assign
id|policydb_index_classes
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
id|rc
op_assign
id|policydb_index_others
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|info-&gt;ocon_num
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|nel
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|l
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|nel
suffix:semicolon
id|j
op_increment
)paren
(brace
id|c
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|c
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|memset
c_func
(paren
id|c
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|c
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l
)paren
(brace
id|l-&gt;next
op_assign
id|c
suffix:semicolon
)brace
r_else
(brace
id|p-&gt;ocontexts
(braket
id|i
)braket
op_assign
id|c
suffix:semicolon
)brace
id|l
op_assign
id|c
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_switch
c_cond
(paren
id|i
)paren
(brace
r_case
id|OCON_ISID
suffix:colon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|c-&gt;sid
(braket
l_int|0
)braket
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|rc
op_assign
id|context_read_and_validate
c_func
(paren
op_amp
id|c-&gt;context
(braket
l_int|0
)braket
comma
id|p
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OCON_FS
suffix:colon
r_case
id|OCON_NETIF
suffix:colon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|len
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|c-&gt;u.name
op_assign
id|kmalloc
c_func
(paren
id|len
op_plus
l_int|1
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c-&gt;u.name
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|c-&gt;u.name
comma
id|fp
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|c-&gt;u.name
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
id|rc
op_assign
id|context_read_and_validate
c_func
(paren
op_amp
id|c-&gt;context
(braket
l_int|0
)braket
comma
id|p
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
id|rc
op_assign
id|context_read_and_validate
c_func
(paren
op_amp
id|c-&gt;context
(braket
l_int|1
)braket
comma
id|p
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OCON_PORT
suffix:colon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
op_star
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|c-&gt;u.port.protocol
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|c-&gt;u.port.low_port
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|c-&gt;u.port.high_port
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|rc
op_assign
id|context_read_and_validate
c_func
(paren
op_amp
id|c-&gt;context
(braket
l_int|0
)braket
comma
id|p
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OCON_NODE
suffix:colon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
op_star
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|c-&gt;u.node.addr
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|c-&gt;u.node.mask
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|rc
op_assign
id|context_read_and_validate
c_func
(paren
op_amp
id|c-&gt;context
(braket
l_int|0
)braket
comma
id|p
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OCON_FSUSE
suffix:colon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
op_star
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|c-&gt;v.behavior
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;v.behavior
OG
id|SECURITY_FS_USE_NONE
)paren
r_goto
id|bad
suffix:semicolon
id|len
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|c-&gt;u.name
op_assign
id|kmalloc
c_func
(paren
id|len
op_plus
l_int|1
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c-&gt;u.name
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|c-&gt;u.name
comma
id|fp
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|c-&gt;u.name
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
id|rc
op_assign
id|context_read_and_validate
c_func
(paren
op_amp
id|c-&gt;context
(braket
l_int|0
)braket
comma
id|p
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OCON_NODE6
suffix:colon
(brace
r_int
id|k
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
op_star
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
l_int|4
suffix:semicolon
id|k
op_increment
)paren
id|c-&gt;u.node6.addr
(braket
id|k
)braket
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
id|k
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
l_int|4
suffix:semicolon
id|k
op_increment
)paren
id|c-&gt;u.node6.mask
(braket
id|k
)braket
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
id|k
op_plus
l_int|4
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|context_read_and_validate
c_func
(paren
op_amp
id|c-&gt;context
(braket
l_int|0
)braket
comma
id|p
comma
id|fp
)paren
)paren
r_goto
id|bad
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|nel
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|genfs_p
op_assign
l_int|NULL
suffix:semicolon
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nel
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|len
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|newgenfs
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|newgenfs
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|newgenfs
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|memset
c_func
(paren
id|newgenfs
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|newgenfs
)paren
)paren
suffix:semicolon
id|newgenfs-&gt;fstype
op_assign
id|kmalloc
c_func
(paren
id|len
op_plus
l_int|1
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|newgenfs-&gt;fstype
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|kfree
c_func
(paren
id|newgenfs
)paren
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|newgenfs-&gt;fstype
comma
id|fp
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|newgenfs-&gt;fstype
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|newgenfs
)paren
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|newgenfs-&gt;fstype
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|genfs_p
op_assign
l_int|NULL
comma
id|genfs
op_assign
id|p-&gt;genfs
suffix:semicolon
id|genfs
suffix:semicolon
id|genfs_p
op_assign
id|genfs
comma
id|genfs
op_assign
id|genfs-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|newgenfs-&gt;fstype
comma
id|genfs-&gt;fstype
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security:  dup genfs &quot;
l_string|&quot;fstype %s&bslash;n&quot;
comma
id|newgenfs-&gt;fstype
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|newgenfs-&gt;fstype
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|newgenfs
)paren
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|newgenfs-&gt;fstype
comma
id|genfs-&gt;fstype
)paren
OL
l_int|0
)paren
r_break
suffix:semicolon
)brace
id|newgenfs-&gt;next
op_assign
id|genfs
suffix:semicolon
r_if
c_cond
(paren
id|genfs_p
)paren
id|genfs_p-&gt;next
op_assign
id|newgenfs
suffix:semicolon
r_else
id|p-&gt;genfs
op_assign
id|newgenfs
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|nel2
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|nel2
suffix:semicolon
id|j
op_increment
)paren
(brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|len
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|newc
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|newc
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|newc
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|memset
c_func
(paren
id|newc
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|newc
)paren
)paren
suffix:semicolon
id|newc-&gt;u.name
op_assign
id|kmalloc
c_func
(paren
id|len
op_plus
l_int|1
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|newc-&gt;u.name
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad_newc
suffix:semicolon
)brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|newc-&gt;u.name
comma
id|fp
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad_newc
suffix:semicolon
id|newc-&gt;u.name
(braket
id|len
)braket
op_assign
l_int|0
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad_newc
suffix:semicolon
id|newc-&gt;v.sclass
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|context_read_and_validate
c_func
(paren
op_amp
id|newc-&gt;context
(braket
l_int|0
)braket
comma
id|p
comma
id|fp
)paren
)paren
r_goto
id|bad_newc
suffix:semicolon
r_for
c_loop
(paren
id|l
op_assign
l_int|NULL
comma
id|c
op_assign
id|newgenfs-&gt;head
suffix:semicolon
id|c
suffix:semicolon
id|l
op_assign
id|c
comma
id|c
op_assign
id|c-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|newc-&gt;u.name
comma
id|c-&gt;u.name
)paren
op_logical_and
(paren
op_logical_neg
id|c-&gt;v.sclass
op_logical_or
op_logical_neg
id|newc-&gt;v.sclass
op_logical_or
id|newc-&gt;v.sclass
op_eq
id|c-&gt;v.sclass
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;security:  dup genfs &quot;
l_string|&quot;entry (%s,%s)&bslash;n&quot;
comma
id|newgenfs-&gt;fstype
comma
id|c-&gt;u.name
)paren
suffix:semicolon
r_goto
id|bad_newc
suffix:semicolon
)brace
id|len
op_assign
id|strlen
c_func
(paren
id|newc-&gt;u.name
)paren
suffix:semicolon
id|len2
op_assign
id|strlen
c_func
(paren
id|c-&gt;u.name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|len2
)paren
r_break
suffix:semicolon
)brace
id|newc-&gt;next
op_assign
id|c
suffix:semicolon
r_if
c_cond
(paren
id|l
)paren
id|l-&gt;next
op_assign
id|newc
suffix:semicolon
r_else
id|newgenfs-&gt;head
op_assign
id|newc
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|p-&gt;policyvers
op_ge
id|POLICYDB_VERSION_MLS
)paren
(brace
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|nel
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|lrt
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nel
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rt
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|rt
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rt
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|bad
suffix:semicolon
)brace
id|memset
c_func
(paren
id|rt
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|rt
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lrt
)paren
id|lrt-&gt;next
op_assign
id|rt
suffix:semicolon
r_else
id|p-&gt;range_tr
op_assign
id|rt
suffix:semicolon
id|rc
op_assign
id|next_entry
c_func
(paren
id|buf
comma
id|fp
comma
(paren
r_sizeof
(paren
id|u32
)paren
op_star
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|bad
suffix:semicolon
id|rt-&gt;dom
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|rt-&gt;type
op_assign
id|le32_to_cpu
c_func
(paren
id|buf
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|rc
op_assign
id|mls_read_range_helper
c_func
(paren
op_amp
id|rt-&gt;range
comma
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|bad
suffix:semicolon
id|lrt
op_assign
id|rt
suffix:semicolon
)brace
)brace
id|rc
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
id|bad_newc
suffix:colon
id|ocontext_destroy
c_func
(paren
id|newc
comma
id|OCON_FSUSE
)paren
suffix:semicolon
id|bad
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|policydb_destroy
c_func
(paren
id|p
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
eof
