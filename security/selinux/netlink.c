multiline_comment|/*&n; * Netlink event notifications for SELinux.&n; *&n; * Author: James Morris &lt;jmorris@redhat.com&gt;&n; *&n; * Copyright (C) 2004 Red Hat, Inc., James Morris &lt;jmorris@redhat.com&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2,&n; * as published by the Free Software Foundation.&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/stddef.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/netlink.h&gt;
macro_line|#include &lt;linux/selinux_netlink.h&gt;
DECL|variable|selnl
r_static
r_struct
id|sock
op_star
id|selnl
suffix:semicolon
DECL|function|selnl_msglen
r_static
r_int
id|selnl_msglen
c_func
(paren
r_int
id|msgtype
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|msgtype
)paren
(brace
r_case
id|SELNL_MSG_SETENFORCE
suffix:colon
id|ret
op_assign
r_sizeof
(paren
r_struct
id|selnl_msg_setenforce
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SELNL_MSG_POLICYLOAD
suffix:colon
id|ret
op_assign
r_sizeof
(paren
r_struct
id|selnl_msg_policyload
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|selnl_add_payload
r_static
r_void
id|selnl_add_payload
c_func
(paren
r_struct
id|nlmsghdr
op_star
id|nlh
comma
r_int
id|len
comma
r_int
id|msgtype
comma
r_void
op_star
id|data
)paren
(brace
r_switch
c_cond
(paren
id|msgtype
)paren
(brace
r_case
id|SELNL_MSG_SETENFORCE
suffix:colon
(brace
r_struct
id|selnl_msg_setenforce
op_star
id|msg
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
id|memset
c_func
(paren
id|msg
comma
l_int|0
comma
id|len
)paren
suffix:semicolon
id|msg-&gt;val
op_assign
op_star
(paren
(paren
r_int
op_star
)paren
id|data
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|SELNL_MSG_POLICYLOAD
suffix:colon
(brace
r_struct
id|selnl_msg_policyload
op_star
id|msg
op_assign
id|NLMSG_DATA
c_func
(paren
id|nlh
)paren
suffix:semicolon
id|memset
c_func
(paren
id|msg
comma
l_int|0
comma
id|len
)paren
suffix:semicolon
id|msg-&gt;seqno
op_assign
op_star
(paren
(paren
id|u32
op_star
)paren
id|data
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|selnl_notify
r_static
r_void
id|selnl_notify
c_func
(paren
r_int
id|msgtype
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|len
suffix:semicolon
r_int
r_char
op_star
id|tmp
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|nlmsghdr
op_star
id|nlh
suffix:semicolon
id|len
op_assign
id|selnl_msglen
c_func
(paren
id|msgtype
)paren
suffix:semicolon
id|skb
op_assign
id|alloc_skb
c_func
(paren
id|NLMSG_SPACE
c_func
(paren
id|len
)paren
comma
id|GFP_USER
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_goto
id|oom
suffix:semicolon
id|tmp
op_assign
id|skb-&gt;tail
suffix:semicolon
id|nlh
op_assign
id|NLMSG_PUT
c_func
(paren
id|skb
comma
l_int|0
comma
l_int|0
comma
id|msgtype
comma
id|len
)paren
suffix:semicolon
id|selnl_add_payload
c_func
(paren
id|nlh
comma
id|len
comma
id|msgtype
comma
id|data
)paren
suffix:semicolon
id|nlh-&gt;nlmsg_len
op_assign
id|skb-&gt;tail
op_minus
id|tmp
suffix:semicolon
id|netlink_broadcast
c_func
(paren
id|selnl
comma
id|skb
comma
l_int|0
comma
id|SELNL_GRP_AVC
comma
id|GFP_USER
)paren
suffix:semicolon
id|out
suffix:colon
r_return
suffix:semicolon
id|nlmsg_failure
suffix:colon
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|oom
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;SELinux:  OOM in %s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
DECL|function|selnl_notify_setenforce
r_void
id|selnl_notify_setenforce
c_func
(paren
r_int
id|val
)paren
(brace
id|selnl_notify
c_func
(paren
id|SELNL_MSG_SETENFORCE
comma
op_amp
id|val
)paren
suffix:semicolon
)brace
DECL|function|selnl_notify_policyload
r_void
id|selnl_notify_policyload
c_func
(paren
id|u32
id|seqno
)paren
(brace
id|selnl_notify
c_func
(paren
id|SELNL_MSG_POLICYLOAD
comma
op_amp
id|seqno
)paren
suffix:semicolon
)brace
DECL|function|selnl_init
r_static
r_int
id|__init
id|selnl_init
c_func
(paren
r_void
)paren
(brace
id|selnl
op_assign
id|netlink_kernel_create
c_func
(paren
id|NETLINK_SELINUX
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|selnl
op_eq
l_int|NULL
)paren
id|panic
c_func
(paren
l_string|&quot;SELinux:  Cannot create netlink socket.&quot;
)paren
suffix:semicolon
id|netlink_set_nonroot
c_func
(paren
id|NETLINK_SELINUX
comma
id|NL_NONROOT_RECV
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|selnl_init
id|__initcall
c_func
(paren
id|selnl_init
)paren
suffix:semicolon
eof
