multiline_comment|/*&n; *  NSA Security-Enhanced Linux (SELinux) security module&n; *&n; *  This file contains the SELinux hook function implementations.&n; *&n; *  Authors:  Stephen Smalley, &lt;sds@epoch.ncsc.mil&gt;&n; *            Chris Vance, &lt;cvance@nai.com&gt;&n; *            Wayne Salamon, &lt;wsalamon@nai.com&gt;&n; *            James Morris &lt;jmorris@redhat.com&gt;&n; *&n; *  Copyright (C) 2001,2002 Networks Associates Technology, Inc.&n; *  Copyright (C) 2003 Red Hat, Inc., James Morris &lt;jmorris@redhat.com&gt;&n; *&n; *&t;This program is free software; you can redistribute it and/or modify&n; *&t;it under the terms of the GNU General Public License version 2,&n; *      as published by the Free Software Foundation.&n; */
DECL|macro|XATTR_SECURITY_PREFIX
mdefine_line|#define XATTR_SECURITY_PREFIX &quot;security.&quot;
DECL|macro|XATTR_SELINUX_SUFFIX
mdefine_line|#define XATTR_SELINUX_SUFFIX &quot;selinux&quot;
DECL|macro|XATTR_NAME_SELINUX
mdefine_line|#define XATTR_NAME_SELINUX XATTR_SECURITY_PREFIX XATTR_SELINUX_SUFFIX
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/security.h&gt;
macro_line|#include &lt;linux/xattr.h&gt;
macro_line|#include &lt;linux/capability.h&gt;
macro_line|#include &lt;linux/unistd.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/mman.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/pagemap.h&gt;
macro_line|#include &lt;linux/swap.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/file.h&gt;
macro_line|#include &lt;linux/namei.h&gt;
macro_line|#include &lt;linux/mount.h&gt;
macro_line|#include &lt;linux/ext2_fs.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/kd.h&gt;
macro_line|#include &lt;net/icmp.h&gt;
macro_line|#include &lt;net/ip.h&gt;&t;&t;/* for sysctl_local_port_range[] */
macro_line|#include &lt;net/tcp.h&gt;&t;&t;/* struct or_callable used in sock_rcv_skb */
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/semaphore.h&gt;
macro_line|#include &lt;asm/ioctls.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;&t;/* for network interface checks */
macro_line|#include &lt;linux/netlink.h&gt;
macro_line|#include &lt;linux/tcp.h&gt;
macro_line|#include &lt;linux/quota.h&gt;
macro_line|#include &lt;linux/un.h&gt;&t;&t;/* for Unix socket types */
macro_line|#include &lt;net/af_unix.h&gt;&t;/* for Unix socket types */
macro_line|#include &quot;avc.h&quot;
macro_line|#include &quot;objsec.h&quot;
macro_line|#ifdef CONFIG_SECURITY_SELINUX_DEVELOP
DECL|variable|selinux_enforcing
r_int
id|selinux_enforcing
op_assign
l_int|0
suffix:semicolon
DECL|function|enforcing_setup
r_static
r_int
id|__init
id|enforcing_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
id|selinux_enforcing
op_assign
id|simple_strtol
c_func
(paren
id|str
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;enforcing=&quot;
comma
id|enforcing_setup
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Original (dummy) security module. */
DECL|variable|original_ops
r_static
r_struct
id|security_operations
op_star
id|original_ops
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Minimal support for a secondary security module,&n;   just to allow the use of the dummy or capability modules.&n;   The owlsm module can alternatively be used as a secondary&n;   module as long as CONFIG_OWLSM_FD is not enabled. */
DECL|variable|secondary_ops
r_static
r_struct
id|security_operations
op_star
id|secondary_ops
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Lists of inode and superblock security structures initialized&n;   before the policy was loaded. */
r_static
id|LIST_HEAD
c_func
(paren
id|inode_security_head
)paren
suffix:semicolon
DECL|variable|inode_security_lock
r_static
id|spinlock_t
id|inode_security_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|superblock_security_head
)paren
suffix:semicolon
DECL|variable|sb_security_lock
r_static
id|spinlock_t
id|sb_security_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
multiline_comment|/* Allocate and free functions for each kind of security blob. */
DECL|function|task_alloc_security
r_static
r_int
id|task_alloc_security
c_func
(paren
r_struct
id|task_struct
op_star
id|task
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
id|tsec
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|task_security_struct
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tsec
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|tsec
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|task_security_struct
)paren
)paren
suffix:semicolon
id|tsec-&gt;magic
op_assign
id|SELINUX_MAGIC
suffix:semicolon
id|tsec-&gt;task
op_assign
id|task
suffix:semicolon
id|tsec-&gt;osid
op_assign
id|tsec-&gt;sid
op_assign
id|SECINITSID_UNLABELED
suffix:semicolon
id|task-&gt;security
op_assign
id|tsec
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|task_free_security
r_static
r_void
id|task_free_security
c_func
(paren
r_struct
id|task_struct
op_star
id|task
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
op_assign
id|task-&gt;security
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tsec
op_logical_or
id|tsec-&gt;magic
op_ne
id|SELINUX_MAGIC
)paren
r_return
suffix:semicolon
id|task-&gt;security
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|tsec
)paren
suffix:semicolon
)brace
DECL|function|inode_alloc_security
r_static
r_int
id|inode_alloc_security
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
r_struct
id|inode_security_struct
op_star
id|isec
suffix:semicolon
id|isec
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|inode_security_struct
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isec
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|isec
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|inode_security_struct
)paren
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|isec-&gt;sem
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|isec-&gt;list
)paren
suffix:semicolon
id|isec-&gt;magic
op_assign
id|SELINUX_MAGIC
suffix:semicolon
id|isec-&gt;inode
op_assign
id|inode
suffix:semicolon
id|isec-&gt;sid
op_assign
id|SECINITSID_UNLABELED
suffix:semicolon
id|isec-&gt;sclass
op_assign
id|SECCLASS_FILE
suffix:semicolon
r_if
c_cond
(paren
id|tsec
op_logical_and
id|tsec-&gt;magic
op_eq
id|SELINUX_MAGIC
)paren
id|isec-&gt;task_sid
op_assign
id|tsec-&gt;sid
suffix:semicolon
r_else
id|isec-&gt;task_sid
op_assign
id|SECINITSID_UNLABELED
suffix:semicolon
id|inode-&gt;i_security
op_assign
id|isec
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|inode_free_security
r_static
r_void
id|inode_free_security
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
r_struct
id|inode_security_struct
op_star
id|isec
op_assign
id|inode-&gt;i_security
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isec
op_logical_or
id|isec-&gt;magic
op_ne
id|SELINUX_MAGIC
)paren
r_return
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|inode_security_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|isec-&gt;list
)paren
)paren
id|list_del_init
c_func
(paren
op_amp
id|isec-&gt;list
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|inode_security_lock
)paren
suffix:semicolon
id|inode-&gt;i_security
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|isec
)paren
suffix:semicolon
)brace
DECL|function|file_alloc_security
r_static
r_int
id|file_alloc_security
c_func
(paren
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
r_struct
id|file_security_struct
op_star
id|fsec
suffix:semicolon
id|fsec
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|file_security_struct
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fsec
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|fsec
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|file_security_struct
)paren
)paren
suffix:semicolon
id|fsec-&gt;magic
op_assign
id|SELINUX_MAGIC
suffix:semicolon
id|fsec-&gt;file
op_assign
id|file
suffix:semicolon
r_if
c_cond
(paren
id|tsec
op_logical_and
id|tsec-&gt;magic
op_eq
id|SELINUX_MAGIC
)paren
(brace
id|fsec-&gt;sid
op_assign
id|tsec-&gt;sid
suffix:semicolon
id|fsec-&gt;fown_sid
op_assign
id|tsec-&gt;sid
suffix:semicolon
)brace
r_else
(brace
id|fsec-&gt;sid
op_assign
id|SECINITSID_UNLABELED
suffix:semicolon
id|fsec-&gt;fown_sid
op_assign
id|SECINITSID_UNLABELED
suffix:semicolon
)brace
id|file-&gt;f_security
op_assign
id|fsec
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|file_free_security
r_static
r_void
id|file_free_security
c_func
(paren
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|file_security_struct
op_star
id|fsec
op_assign
id|file-&gt;f_security
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fsec
op_logical_or
id|fsec-&gt;magic
op_ne
id|SELINUX_MAGIC
)paren
r_return
suffix:semicolon
id|file-&gt;f_security
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|fsec
)paren
suffix:semicolon
)brace
DECL|function|superblock_alloc_security
r_static
r_int
id|superblock_alloc_security
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_struct
id|superblock_security_struct
op_star
id|sbsec
suffix:semicolon
id|sbsec
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|superblock_security_struct
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sbsec
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|sbsec
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|superblock_security_struct
)paren
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|sbsec-&gt;sem
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|sbsec-&gt;list
)paren
suffix:semicolon
id|sbsec-&gt;magic
op_assign
id|SELINUX_MAGIC
suffix:semicolon
id|sbsec-&gt;sb
op_assign
id|sb
suffix:semicolon
id|sbsec-&gt;sid
op_assign
id|SECINITSID_UNLABELED
suffix:semicolon
id|sb-&gt;s_security
op_assign
id|sbsec
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|superblock_free_security
r_static
r_void
id|superblock_free_security
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_struct
id|superblock_security_struct
op_star
id|sbsec
op_assign
id|sb-&gt;s_security
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sbsec
op_logical_or
id|sbsec-&gt;magic
op_ne
id|SELINUX_MAGIC
)paren
r_return
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|sb_security_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|sbsec-&gt;list
)paren
)paren
id|list_del_init
c_func
(paren
op_amp
id|sbsec-&gt;list
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|sb_security_lock
)paren
suffix:semicolon
id|sb-&gt;s_security
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|sbsec
)paren
suffix:semicolon
)brace
multiline_comment|/* The security server must be initialized before&n;   any labeling or access decisions can be provided. */
r_extern
r_int
id|ss_initialized
suffix:semicolon
multiline_comment|/* The file system&squot;s label must be initialized prior to use. */
DECL|variable|labeling_behaviors
r_static
r_char
op_star
id|labeling_behaviors
(braket
l_int|5
)braket
op_assign
(brace
l_string|&quot;uses xattr&quot;
comma
l_string|&quot;uses transition SIDs&quot;
comma
l_string|&quot;uses task SIDs&quot;
comma
l_string|&quot;uses genfs_contexts&quot;
comma
l_string|&quot;not configured for labeling&quot;
)brace
suffix:semicolon
r_static
r_int
id|inode_doinit_with_dentry
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|dentry
op_star
id|opt_dentry
)paren
suffix:semicolon
DECL|function|inode_doinit
r_static
r_inline
r_int
id|inode_doinit
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
r_return
id|inode_doinit_with_dentry
c_func
(paren
id|inode
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|superblock_doinit
r_static
r_int
id|superblock_doinit
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_struct
id|superblock_security_struct
op_star
id|sbsec
op_assign
id|sb-&gt;s_security
suffix:semicolon
r_struct
id|dentry
op_star
id|root
op_assign
id|sb-&gt;s_root
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|root-&gt;d_inode
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|sbsec-&gt;sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sbsec-&gt;initialized
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ss_initialized
)paren
(brace
multiline_comment|/* Defer initialization until selinux_complete_init,&n;&t;&t;   after the initial policy is loaded and the security&n;&t;&t;   server is ready to handle calls. */
id|spin_lock
c_func
(paren
op_amp
id|sb_security_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|sbsec-&gt;list
)paren
)paren
id|list_add
c_func
(paren
op_amp
id|sbsec-&gt;list
comma
op_amp
id|superblock_security_head
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|sb_security_lock
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Determine the labeling behavior to use for this filesystem type. */
id|rc
op_assign
id|security_fs_use
c_func
(paren
id|sb-&gt;s_type-&gt;name
comma
op_amp
id|sbsec-&gt;behavior
comma
op_amp
id|sbsec-&gt;sid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s:  security_fs_use(%s) returned %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|sb-&gt;s_type-&gt;name
comma
id|rc
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sbsec-&gt;behavior
op_eq
id|SECURITY_FS_USE_XATTR
)paren
(brace
multiline_comment|/* Make sure that the xattr handler exists and that no&n;&t;&t;   error other than -ENODATA is returned by getxattr on&n;&t;&t;   the root directory.  -ENODATA is ok, as this may be&n;&t;&t;   the first boot of the SELinux kernel before we have&n;&t;&t;   assigned xattr values to the filesystem. */
r_if
c_cond
(paren
op_logical_neg
id|inode-&gt;i_op-&gt;getxattr
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;SELinux: (dev %s, type %s) has no &quot;
l_string|&quot;xattr support&bslash;n&quot;
comma
id|sb-&gt;s_id
comma
id|sb-&gt;s_type-&gt;name
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
id|inode-&gt;i_op
op_member_access_from_pointer
id|getxattr
c_func
(paren
id|root
comma
id|XATTR_NAME_SELINUX
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
op_logical_and
id|rc
op_ne
op_minus
id|ENODATA
)paren
(brace
r_if
c_cond
(paren
id|rc
op_eq
op_minus
id|EOPNOTSUPP
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;SELinux: (dev %s, type &quot;
l_string|&quot;%s) has no security xattr handler&bslash;n&quot;
comma
id|sb-&gt;s_id
comma
id|sb-&gt;s_type-&gt;name
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;SELinux: (dev %s, type &quot;
l_string|&quot;%s) getxattr errno %d&bslash;n&quot;
comma
id|sb-&gt;s_id
comma
id|sb-&gt;s_type-&gt;name
comma
op_minus
id|rc
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|sb-&gt;s_type-&gt;name
comma
l_string|&quot;proc&quot;
)paren
op_eq
l_int|0
)paren
id|sbsec-&gt;proc
op_assign
l_int|1
suffix:semicolon
id|sbsec-&gt;initialized
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;SELinux: initialized (dev %s, type %s), %s&bslash;n&quot;
comma
id|sb-&gt;s_id
comma
id|sb-&gt;s_type-&gt;name
comma
id|labeling_behaviors
(braket
id|sbsec-&gt;behavior
op_minus
l_int|1
)braket
)paren
suffix:semicolon
multiline_comment|/* Initialize the root inode. */
id|rc
op_assign
id|inode_doinit_with_dentry
c_func
(paren
id|sb-&gt;s_root-&gt;d_inode
comma
id|sb-&gt;s_root
)paren
suffix:semicolon
id|out
suffix:colon
id|up
c_func
(paren
op_amp
id|sbsec-&gt;sem
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|inode_mode_to_security_class
r_static
r_inline
id|u16
id|inode_mode_to_security_class
c_func
(paren
id|umode_t
id|mode
)paren
(brace
r_switch
c_cond
(paren
id|mode
op_amp
id|S_IFMT
)paren
(brace
r_case
id|S_IFSOCK
suffix:colon
r_return
id|SECCLASS_SOCK_FILE
suffix:semicolon
r_case
id|S_IFLNK
suffix:colon
r_return
id|SECCLASS_LNK_FILE
suffix:semicolon
r_case
id|S_IFREG
suffix:colon
r_return
id|SECCLASS_FILE
suffix:semicolon
r_case
id|S_IFBLK
suffix:colon
r_return
id|SECCLASS_BLK_FILE
suffix:semicolon
r_case
id|S_IFDIR
suffix:colon
r_return
id|SECCLASS_DIR
suffix:semicolon
r_case
id|S_IFCHR
suffix:colon
r_return
id|SECCLASS_CHR_FILE
suffix:semicolon
r_case
id|S_IFIFO
suffix:colon
r_return
id|SECCLASS_FIFO_FILE
suffix:semicolon
)brace
r_return
id|SECCLASS_FILE
suffix:semicolon
)brace
DECL|function|socket_type_to_security_class
r_static
r_inline
id|u16
id|socket_type_to_security_class
c_func
(paren
r_int
id|family
comma
r_int
id|type
)paren
(brace
r_switch
c_cond
(paren
id|family
)paren
(brace
r_case
id|PF_UNIX
suffix:colon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|SOCK_STREAM
suffix:colon
r_return
id|SECCLASS_UNIX_STREAM_SOCKET
suffix:semicolon
r_case
id|SOCK_DGRAM
suffix:colon
r_return
id|SECCLASS_UNIX_DGRAM_SOCKET
suffix:semicolon
)brace
r_case
id|PF_INET
suffix:colon
r_case
id|PF_INET6
suffix:colon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|SOCK_STREAM
suffix:colon
r_return
id|SECCLASS_TCP_SOCKET
suffix:semicolon
r_case
id|SOCK_DGRAM
suffix:colon
r_return
id|SECCLASS_UDP_SOCKET
suffix:semicolon
r_case
id|SOCK_RAW
suffix:colon
r_return
id|SECCLASS_RAWIP_SOCKET
suffix:semicolon
)brace
r_case
id|PF_NETLINK
suffix:colon
r_return
id|SECCLASS_NETLINK_SOCKET
suffix:semicolon
r_case
id|PF_PACKET
suffix:colon
r_return
id|SECCLASS_PACKET_SOCKET
suffix:semicolon
r_case
id|PF_KEY
suffix:colon
r_return
id|SECCLASS_KEY_SOCKET
suffix:semicolon
)brace
r_return
id|SECCLASS_SOCKET
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PROC_FS
DECL|function|selinux_proc_get_sid
r_static
r_int
id|selinux_proc_get_sid
c_func
(paren
r_struct
id|proc_dir_entry
op_star
id|de
comma
id|u16
id|tclass
comma
id|u32
op_star
id|sid
)paren
(brace
r_int
id|buflen
comma
id|rc
suffix:semicolon
r_char
op_star
id|buffer
comma
op_star
id|path
comma
op_star
id|end
suffix:semicolon
id|buffer
op_assign
(paren
r_char
op_star
)paren
id|__get_free_page
c_func
(paren
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|buflen
op_assign
id|PAGE_SIZE
suffix:semicolon
id|end
op_assign
id|buffer
op_plus
id|buflen
suffix:semicolon
op_star
op_decrement
id|end
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|buflen
op_decrement
suffix:semicolon
id|path
op_assign
id|end
op_minus
l_int|1
suffix:semicolon
op_star
id|path
op_assign
l_char|&squot;/&squot;
suffix:semicolon
r_while
c_loop
(paren
id|de
op_logical_and
id|de
op_ne
id|de-&gt;parent
)paren
(brace
id|buflen
op_sub_assign
id|de-&gt;namelen
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|buflen
OL
l_int|0
)paren
r_break
suffix:semicolon
id|end
op_sub_assign
id|de-&gt;namelen
suffix:semicolon
id|memcpy
c_func
(paren
id|end
comma
id|de-&gt;name
comma
id|de-&gt;namelen
)paren
suffix:semicolon
op_star
op_decrement
id|end
op_assign
l_char|&squot;/&squot;
suffix:semicolon
id|path
op_assign
id|end
suffix:semicolon
id|de
op_assign
id|de-&gt;parent
suffix:semicolon
)brace
id|rc
op_assign
id|security_genfs_sid
c_func
(paren
l_string|&quot;proc&quot;
comma
id|path
comma
id|tclass
comma
id|sid
)paren
suffix:semicolon
id|free_page
c_func
(paren
(paren
r_int
r_int
)paren
id|buffer
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
macro_line|#else
DECL|function|selinux_proc_get_sid
r_static
r_int
id|selinux_proc_get_sid
c_func
(paren
r_struct
id|proc_dir_entry
op_star
id|de
comma
id|u16
id|tclass
comma
id|u32
op_star
id|sid
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* The inode&squot;s security attributes must be initialized before first use. */
DECL|function|inode_doinit_with_dentry
r_static
r_int
id|inode_doinit_with_dentry
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|dentry
op_star
id|opt_dentry
)paren
(brace
r_struct
id|superblock_security_struct
op_star
id|sbsec
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|inode_security_struct
op_star
id|isec
op_assign
id|inode-&gt;i_security
suffix:semicolon
id|u32
id|sid
suffix:semicolon
r_struct
id|dentry
op_star
id|dentry
suffix:semicolon
DECL|macro|INITCONTEXTLEN
mdefine_line|#define INITCONTEXTLEN 255
r_char
op_star
id|context
op_assign
l_int|NULL
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_int
id|hold_sem
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|isec-&gt;initialized
)paren
r_goto
id|out
suffix:semicolon
id|down
c_func
(paren
op_amp
id|isec-&gt;sem
)paren
suffix:semicolon
id|hold_sem
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|isec-&gt;initialized
)paren
r_goto
id|out
suffix:semicolon
id|sbsec
op_assign
id|inode-&gt;i_sb-&gt;s_security
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sbsec
op_logical_or
op_logical_neg
id|sbsec-&gt;initialized
)paren
(brace
multiline_comment|/* Defer initialization until selinux_complete_init,&n;&t;&t;   after the initial policy is loaded and the security&n;&t;&t;   server is ready to handle calls. */
id|spin_lock
c_func
(paren
op_amp
id|inode_security_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
op_amp
id|isec-&gt;list
)paren
)paren
id|list_add
c_func
(paren
op_amp
id|isec-&gt;list
comma
op_amp
id|inode_security_head
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|inode_security_lock
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|sbsec-&gt;behavior
)paren
(brace
r_case
id|SECURITY_FS_USE_XATTR
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|inode-&gt;i_op-&gt;getxattr
)paren
(brace
id|isec-&gt;sid
op_assign
id|SECINITSID_FILE
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Need a dentry, since the xattr API requires one.&n;&t;&t;   Life would be simpler if we could just pass the inode. */
r_if
c_cond
(paren
id|opt_dentry
)paren
(brace
multiline_comment|/* Called from d_instantiate or d_splice_alias. */
id|dentry
op_assign
id|dget
c_func
(paren
id|opt_dentry
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Called from selinux_complete_init, try to find a dentry. */
id|dentry
op_assign
id|d_find_alias
c_func
(paren
id|inode
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|dentry
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s:  no dentry for dev=%s &quot;
l_string|&quot;ino=%ld&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|inode-&gt;i_sb-&gt;s_id
comma
id|inode-&gt;i_ino
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|len
op_assign
id|INITCONTEXTLEN
suffix:semicolon
id|context
op_assign
id|kmalloc
c_func
(paren
id|len
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|context
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|dput
c_func
(paren
id|dentry
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
id|inode-&gt;i_op
op_member_access_from_pointer
id|getxattr
c_func
(paren
id|dentry
comma
id|XATTR_NAME_SELINUX
comma
id|context
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
op_minus
id|ERANGE
)paren
(brace
multiline_comment|/* Need a larger buffer.  Query for the right size. */
id|rc
op_assign
id|inode-&gt;i_op
op_member_access_from_pointer
id|getxattr
c_func
(paren
id|dentry
comma
id|XATTR_NAME_SELINUX
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
(brace
id|dput
c_func
(paren
id|dentry
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|context
)paren
suffix:semicolon
id|len
op_assign
id|rc
suffix:semicolon
id|context
op_assign
id|kmalloc
c_func
(paren
id|len
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|context
)paren
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|dput
c_func
(paren
id|dentry
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|rc
op_assign
id|inode-&gt;i_op
op_member_access_from_pointer
id|getxattr
c_func
(paren
id|dentry
comma
id|XATTR_NAME_SELINUX
comma
id|context
comma
id|len
)paren
suffix:semicolon
)brace
id|dput
c_func
(paren
id|dentry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|rc
op_ne
op_minus
id|ENODATA
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s:  getxattr returned &quot;
l_string|&quot;%d for dev=%s ino=%ld&bslash;n&quot;
comma
id|__FUNCTION__
comma
op_minus
id|rc
comma
id|inode-&gt;i_sb-&gt;s_id
comma
id|inode-&gt;i_ino
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|context
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* Map ENODATA to the default file SID */
id|sid
op_assign
id|SECINITSID_FILE
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|rc
op_assign
id|security_context_to_sid
c_func
(paren
id|context
comma
id|rc
comma
op_amp
id|sid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s:  context_to_sid(%s) &quot;
l_string|&quot;returned %d for dev=%s ino=%ld&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|context
comma
op_minus
id|rc
comma
id|inode-&gt;i_sb-&gt;s_id
comma
id|inode-&gt;i_ino
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|context
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|kfree
c_func
(paren
id|context
)paren
suffix:semicolon
id|isec-&gt;sid
op_assign
id|sid
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SECURITY_FS_USE_TASK
suffix:colon
id|isec-&gt;sid
op_assign
id|isec-&gt;task_sid
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SECURITY_FS_USE_TRANS
suffix:colon
multiline_comment|/* Default to the fs SID. */
id|isec-&gt;sid
op_assign
id|sbsec-&gt;sid
suffix:semicolon
multiline_comment|/* Try to obtain a transition SID. */
id|isec-&gt;sclass
op_assign
id|inode_mode_to_security_class
c_func
(paren
id|inode-&gt;i_mode
)paren
suffix:semicolon
id|rc
op_assign
id|security_transition_sid
c_func
(paren
id|isec-&gt;task_sid
comma
id|sbsec-&gt;sid
comma
id|isec-&gt;sclass
comma
op_amp
id|sid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
id|isec-&gt;sid
op_assign
id|sid
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* Default to the fs SID. */
id|isec-&gt;sid
op_assign
id|sbsec-&gt;sid
suffix:semicolon
r_if
c_cond
(paren
id|sbsec-&gt;proc
)paren
(brace
r_struct
id|proc_inode
op_star
id|proci
op_assign
id|PROC_I
c_func
(paren
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|proci-&gt;pde
)paren
(brace
id|isec-&gt;sclass
op_assign
id|inode_mode_to_security_class
c_func
(paren
id|inode-&gt;i_mode
)paren
suffix:semicolon
id|rc
op_assign
id|selinux_proc_get_sid
c_func
(paren
id|proci-&gt;pde
comma
id|isec-&gt;sclass
comma
op_amp
id|sid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_goto
id|out
suffix:semicolon
id|isec-&gt;sid
op_assign
id|sid
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
)brace
id|isec-&gt;initialized
op_assign
l_int|1
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
id|inode-&gt;i_sock
)paren
(brace
r_struct
id|socket
op_star
id|sock
op_assign
id|SOCKET_I
c_func
(paren
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sock-&gt;sk
)paren
(brace
id|isec-&gt;sclass
op_assign
id|socket_type_to_security_class
c_func
(paren
id|sock-&gt;sk-&gt;sk_family
comma
id|sock-&gt;sk-&gt;sk_type
)paren
suffix:semicolon
)brace
r_else
(brace
id|isec-&gt;sclass
op_assign
id|SECCLASS_SOCKET
suffix:semicolon
)brace
)brace
r_else
(brace
id|isec-&gt;sclass
op_assign
id|inode_mode_to_security_class
c_func
(paren
id|inode-&gt;i_mode
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hold_sem
)paren
id|up
c_func
(paren
op_amp
id|isec-&gt;sem
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* Convert a Linux signal to an access vector. */
DECL|function|signal_to_av
r_static
r_inline
id|u32
id|signal_to_av
c_func
(paren
r_int
id|sig
)paren
(brace
id|u32
id|perm
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|sig
)paren
(brace
r_case
id|SIGCHLD
suffix:colon
multiline_comment|/* Commonly granted from child to parent. */
id|perm
op_assign
id|PROCESS__SIGCHLD
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIGKILL
suffix:colon
multiline_comment|/* Cannot be caught or ignored */
id|perm
op_assign
id|PROCESS__SIGKILL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SIGSTOP
suffix:colon
multiline_comment|/* Cannot be caught or ignored */
id|perm
op_assign
id|PROCESS__SIGSTOP
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* All other signals. */
id|perm
op_assign
id|PROCESS__SIGNAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|perm
suffix:semicolon
)brace
multiline_comment|/* Check permission betweeen a pair of tasks, e.g. signal checks,&n;   fork check, ptrace check, etc. */
DECL|function|task_has_perm
r_int
id|task_has_perm
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk1
comma
r_struct
id|task_struct
op_star
id|tsk2
comma
id|u32
id|perms
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec1
comma
op_star
id|tsec2
suffix:semicolon
id|tsec1
op_assign
id|tsk1-&gt;security
suffix:semicolon
id|tsec2
op_assign
id|tsk2-&gt;security
suffix:semicolon
r_return
id|avc_has_perm
c_func
(paren
id|tsec1-&gt;sid
comma
id|tsec2-&gt;sid
comma
id|SECCLASS_PROCESS
comma
id|perms
comma
op_amp
id|tsec2-&gt;avcr
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/* Check whether a task is allowed to use a capability. */
DECL|function|task_has_capability
r_int
id|task_has_capability
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
comma
r_int
id|cap
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
id|tsec
op_assign
id|tsk-&gt;security
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|CAP
)paren
suffix:semicolon
id|ad.tsk
op_assign
id|tsk
suffix:semicolon
id|ad.u.cap
op_assign
id|cap
suffix:semicolon
r_return
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|tsec-&gt;sid
comma
id|SECCLASS_CAPABILITY
comma
id|CAP_TO_MASK
c_func
(paren
id|cap
)paren
comma
l_int|NULL
comma
op_amp
id|ad
)paren
suffix:semicolon
)brace
multiline_comment|/* Check whether a task is allowed to use a system operation. */
DECL|function|task_has_system
r_int
id|task_has_system
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
comma
id|u32
id|perms
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
id|tsec
op_assign
id|tsk-&gt;security
suffix:semicolon
r_return
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|SECINITSID_KERNEL
comma
id|SECCLASS_SYSTEM
comma
id|perms
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/* Check whether a task has a particular permission to an inode.&n;   The &squot;aeref&squot; parameter is optional and allows other AVC&n;   entry references to be passed (e.g. the one in the struct file).&n;   The &squot;adp&squot; parameter is optional and allows other audit&n;   data to be passed (e.g. the dentry). */
DECL|function|inode_has_perm
r_int
id|inode_has_perm
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
comma
r_struct
id|inode
op_star
id|inode
comma
id|u32
id|perms
comma
r_struct
id|avc_entry_ref
op_star
id|aeref
comma
r_struct
id|avc_audit_data
op_star
id|adp
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|inode_security_struct
op_star
id|isec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
id|tsec
op_assign
id|tsk-&gt;security
suffix:semicolon
id|isec
op_assign
id|inode-&gt;i_security
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|adp
)paren
(brace
id|adp
op_assign
op_amp
id|ad
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|FS
)paren
suffix:semicolon
id|ad.u.fs.inode
op_assign
id|inode
suffix:semicolon
)brace
r_return
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|isec-&gt;sclass
comma
id|perms
comma
id|aeref
ques
c_cond
id|aeref
suffix:colon
op_amp
id|isec-&gt;avcr
comma
id|adp
)paren
suffix:semicolon
)brace
multiline_comment|/* Same as inode_has_perm, but pass explicit audit data containing&n;   the dentry to help the auditing code to more easily generate the&n;   pathname if needed. */
DECL|function|dentry_has_perm
r_static
r_inline
r_int
id|dentry_has_perm
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
comma
r_struct
id|vfsmount
op_star
id|mnt
comma
r_struct
id|dentry
op_star
id|dentry
comma
id|u32
id|av
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|dentry-&gt;d_inode
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|FS
)paren
suffix:semicolon
id|ad.u.fs.mnt
op_assign
id|mnt
suffix:semicolon
id|ad.u.fs.dentry
op_assign
id|dentry
suffix:semicolon
r_return
id|inode_has_perm
c_func
(paren
id|tsk
comma
id|inode
comma
id|av
comma
l_int|NULL
comma
op_amp
id|ad
)paren
suffix:semicolon
)brace
multiline_comment|/* Check whether a task can use an open file descriptor to&n;   access an inode in a given way.  Check access to the&n;   descriptor itself, and then use dentry_has_perm to&n;   check a particular permission to the file.&n;   Access to the descriptor is implicitly granted if it&n;   has the same SID as the process.  If av is zero, then&n;   access to the file is not checked, e.g. for cases&n;   where only the descriptor is affected like seek. */
DECL|function|file_has_perm
r_static
r_inline
r_int
id|file_has_perm
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
comma
r_struct
id|file
op_star
id|file
comma
id|u32
id|av
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
op_assign
id|tsk-&gt;security
suffix:semicolon
r_struct
id|file_security_struct
op_star
id|fsec
op_assign
id|file-&gt;f_security
suffix:semicolon
r_struct
id|vfsmount
op_star
id|mnt
op_assign
id|file-&gt;f_vfsmnt
suffix:semicolon
r_struct
id|dentry
op_star
id|dentry
op_assign
id|file-&gt;f_dentry
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|dentry-&gt;d_inode
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|FS
)paren
suffix:semicolon
id|ad.u.fs.mnt
op_assign
id|mnt
suffix:semicolon
id|ad.u.fs.dentry
op_assign
id|dentry
suffix:semicolon
r_if
c_cond
(paren
id|tsec-&gt;sid
op_ne
id|fsec-&gt;sid
)paren
(brace
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|fsec-&gt;sid
comma
id|SECCLASS_FD
comma
id|FD__USE
comma
op_amp
id|fsec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* av is zero if only checking access to the descriptor. */
r_if
c_cond
(paren
id|av
)paren
r_return
id|inode_has_perm
c_func
(paren
id|tsk
comma
id|inode
comma
id|av
comma
op_amp
id|fsec-&gt;inode_avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Check whether a task can create a file. */
DECL|function|may_create
r_static
r_int
id|may_create
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
comma
id|u16
id|tclass
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|inode_security_struct
op_star
id|dsec
suffix:semicolon
r_struct
id|superblock_security_struct
op_star
id|sbsec
suffix:semicolon
id|u32
id|newsid
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|dsec
op_assign
id|dir-&gt;i_security
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|FS
)paren
suffix:semicolon
id|ad.u.fs.dentry
op_assign
id|dentry
suffix:semicolon
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|dsec-&gt;sid
comma
id|SECCLASS_DIR
comma
id|DIR__ADD_NAME
op_or
id|DIR__SEARCH
comma
op_amp
id|dsec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
r_if
c_cond
(paren
id|tsec-&gt;create_sid
)paren
(brace
id|newsid
op_assign
id|tsec-&gt;create_sid
suffix:semicolon
)brace
r_else
(brace
id|rc
op_assign
id|security_transition_sid
c_func
(paren
id|tsec-&gt;sid
comma
id|dsec-&gt;sid
comma
id|tclass
comma
op_amp
id|newsid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
)brace
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|newsid
comma
id|tclass
comma
id|FILE__CREATE
comma
l_int|NULL
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|sbsec
op_assign
id|dir-&gt;i_sb-&gt;s_security
suffix:semicolon
r_return
id|avc_has_perm
c_func
(paren
id|newsid
comma
id|sbsec-&gt;sid
comma
id|SECCLASS_FILESYSTEM
comma
id|FILESYSTEM__ASSOCIATE
comma
l_int|NULL
comma
op_amp
id|ad
)paren
suffix:semicolon
)brace
DECL|macro|MAY_LINK
mdefine_line|#define MAY_LINK   0
DECL|macro|MAY_UNLINK
mdefine_line|#define MAY_UNLINK 1
DECL|macro|MAY_RMDIR
mdefine_line|#define MAY_RMDIR  2
multiline_comment|/* Check whether a task can link, unlink, or rmdir a file/directory. */
DECL|function|may_link
r_static
r_int
id|may_link
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
comma
r_int
id|kind
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|inode_security_struct
op_star
id|dsec
comma
op_star
id|isec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
id|u32
id|av
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|dsec
op_assign
id|dir-&gt;i_security
suffix:semicolon
id|isec
op_assign
id|dentry-&gt;d_inode-&gt;i_security
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|FS
)paren
suffix:semicolon
id|ad.u.fs.dentry
op_assign
id|dentry
suffix:semicolon
id|av
op_assign
id|DIR__SEARCH
suffix:semicolon
id|av
op_or_assign
(paren
id|kind
ques
c_cond
id|DIR__REMOVE_NAME
suffix:colon
id|DIR__ADD_NAME
)paren
suffix:semicolon
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|dsec-&gt;sid
comma
id|SECCLASS_DIR
comma
id|av
comma
op_amp
id|dsec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
r_switch
c_cond
(paren
id|kind
)paren
(brace
r_case
id|MAY_LINK
suffix:colon
id|av
op_assign
id|FILE__LINK
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MAY_UNLINK
suffix:colon
id|av
op_assign
id|FILE__UNLINK
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MAY_RMDIR
suffix:colon
id|av
op_assign
id|DIR__RMDIR
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;may_link:  unrecognized kind %d&bslash;n&quot;
comma
id|kind
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|isec-&gt;sclass
comma
id|av
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|may_rename
r_static
r_inline
r_int
id|may_rename
c_func
(paren
r_struct
id|inode
op_star
id|old_dir
comma
r_struct
id|dentry
op_star
id|old_dentry
comma
r_struct
id|inode
op_star
id|new_dir
comma
r_struct
id|dentry
op_star
id|new_dentry
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|inode_security_struct
op_star
id|old_dsec
comma
op_star
id|new_dsec
comma
op_star
id|old_isec
comma
op_star
id|new_isec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
id|u32
id|av
suffix:semicolon
r_int
id|old_is_dir
comma
id|new_is_dir
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|old_dsec
op_assign
id|old_dir-&gt;i_security
suffix:semicolon
id|old_isec
op_assign
id|old_dentry-&gt;d_inode-&gt;i_security
suffix:semicolon
id|old_is_dir
op_assign
id|S_ISDIR
c_func
(paren
id|old_dentry-&gt;d_inode-&gt;i_mode
)paren
suffix:semicolon
id|new_dsec
op_assign
id|new_dir-&gt;i_security
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|FS
)paren
suffix:semicolon
id|ad.u.fs.dentry
op_assign
id|old_dentry
suffix:semicolon
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|old_dsec-&gt;sid
comma
id|SECCLASS_DIR
comma
id|DIR__REMOVE_NAME
op_or
id|DIR__SEARCH
comma
op_amp
id|old_dsec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|old_isec-&gt;sid
comma
id|old_isec-&gt;sclass
comma
id|FILE__RENAME
comma
op_amp
id|old_isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
r_if
c_cond
(paren
id|old_is_dir
op_logical_and
id|new_dir
op_ne
id|old_dir
)paren
(brace
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|old_isec-&gt;sid
comma
id|old_isec-&gt;sclass
comma
id|DIR__REPARENT
comma
op_amp
id|old_isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
)brace
id|ad.u.fs.dentry
op_assign
id|new_dentry
suffix:semicolon
id|av
op_assign
id|DIR__ADD_NAME
op_or
id|DIR__SEARCH
suffix:semicolon
r_if
c_cond
(paren
id|new_dentry-&gt;d_inode
)paren
id|av
op_or_assign
id|DIR__REMOVE_NAME
suffix:semicolon
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|new_dsec-&gt;sid
comma
id|SECCLASS_DIR
comma
id|av
comma
op_amp
id|new_dsec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
r_if
c_cond
(paren
id|new_dentry-&gt;d_inode
)paren
(brace
id|new_isec
op_assign
id|new_dentry-&gt;d_inode-&gt;i_security
suffix:semicolon
id|new_is_dir
op_assign
id|S_ISDIR
c_func
(paren
id|new_dentry-&gt;d_inode-&gt;i_mode
)paren
suffix:semicolon
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|new_isec-&gt;sid
comma
id|new_isec-&gt;sclass
comma
(paren
id|new_is_dir
ques
c_cond
id|DIR__RMDIR
suffix:colon
id|FILE__UNLINK
)paren
comma
op_amp
id|new_isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Check whether a task can perform a filesystem operation. */
DECL|function|superblock_has_perm
r_int
id|superblock_has_perm
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
comma
r_struct
id|super_block
op_star
id|sb
comma
id|u32
id|perms
comma
r_struct
id|avc_audit_data
op_star
id|ad
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|superblock_security_struct
op_star
id|sbsec
suffix:semicolon
id|tsec
op_assign
id|tsk-&gt;security
suffix:semicolon
id|sbsec
op_assign
id|sb-&gt;s_security
suffix:semicolon
r_return
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|sbsec-&gt;sid
comma
id|SECCLASS_FILESYSTEM
comma
id|perms
comma
l_int|NULL
comma
id|ad
)paren
suffix:semicolon
)brace
multiline_comment|/* Convert a Linux mode and permission mask to an access vector. */
DECL|function|file_mask_to_av
r_static
r_inline
id|u32
id|file_mask_to_av
c_func
(paren
r_int
id|mode
comma
r_int
id|mask
)paren
(brace
id|u32
id|av
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mode
op_amp
id|S_IFMT
)paren
op_ne
id|S_IFDIR
)paren
(brace
r_if
c_cond
(paren
id|mask
op_amp
id|MAY_EXEC
)paren
id|av
op_or_assign
id|FILE__EXECUTE
suffix:semicolon
r_if
c_cond
(paren
id|mask
op_amp
id|MAY_READ
)paren
id|av
op_or_assign
id|FILE__READ
suffix:semicolon
r_if
c_cond
(paren
id|mask
op_amp
id|MAY_APPEND
)paren
id|av
op_or_assign
id|FILE__APPEND
suffix:semicolon
r_else
r_if
c_cond
(paren
id|mask
op_amp
id|MAY_WRITE
)paren
id|av
op_or_assign
id|FILE__WRITE
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|mask
op_amp
id|MAY_EXEC
)paren
id|av
op_or_assign
id|DIR__SEARCH
suffix:semicolon
r_if
c_cond
(paren
id|mask
op_amp
id|MAY_WRITE
)paren
id|av
op_or_assign
id|DIR__WRITE
suffix:semicolon
r_if
c_cond
(paren
id|mask
op_amp
id|MAY_READ
)paren
id|av
op_or_assign
id|DIR__READ
suffix:semicolon
)brace
r_return
id|av
suffix:semicolon
)brace
multiline_comment|/* Convert a Linux file to an access vector. */
DECL|function|file_to_av
r_static
r_inline
id|u32
id|file_to_av
c_func
(paren
r_struct
id|file
op_star
id|file
)paren
(brace
id|u32
id|av
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|av
op_or_assign
id|FILE__READ
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_APPEND
)paren
id|av
op_or_assign
id|FILE__APPEND
suffix:semicolon
r_else
id|av
op_or_assign
id|FILE__WRITE
suffix:semicolon
)brace
r_return
id|av
suffix:semicolon
)brace
multiline_comment|/* Set an inode&squot;s SID to a specified value. */
DECL|function|inode_security_set_sid
r_int
id|inode_security_set_sid
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
id|u32
id|sid
)paren
(brace
r_struct
id|inode_security_struct
op_star
id|isec
op_assign
id|inode-&gt;i_security
suffix:semicolon
id|down
c_func
(paren
op_amp
id|isec-&gt;sem
)paren
suffix:semicolon
id|isec-&gt;sclass
op_assign
id|inode_mode_to_security_class
c_func
(paren
id|inode-&gt;i_mode
)paren
suffix:semicolon
id|isec-&gt;sid
op_assign
id|sid
suffix:semicolon
id|isec-&gt;initialized
op_assign
l_int|1
suffix:semicolon
id|up
c_func
(paren
op_amp
id|isec-&gt;sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Set the security attributes on a newly created file. */
DECL|function|post_create
r_static
r_int
id|post_create
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_struct
id|inode_security_struct
op_star
id|dsec
suffix:semicolon
r_struct
id|superblock_security_struct
op_star
id|sbsec
suffix:semicolon
id|u32
id|newsid
suffix:semicolon
r_char
op_star
id|context
suffix:semicolon
r_int
r_int
id|len
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|dsec
op_assign
id|dir-&gt;i_security
suffix:semicolon
id|inode
op_assign
id|dentry-&gt;d_inode
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
(brace
multiline_comment|/* Some file system types (e.g. NFS) may not instantiate&n;&t;&t;   a dentry for all create operations (e.g. symlink),&n;&t;&t;   so we have to check to see if the inode is non-NULL. */
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;post_create:  no inode, dir (dev=%s, &quot;
l_string|&quot;ino=%ld)&bslash;n&quot;
comma
id|dir-&gt;i_sb-&gt;s_id
comma
id|dir-&gt;i_ino
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tsec-&gt;create_sid
)paren
(brace
id|newsid
op_assign
id|tsec-&gt;create_sid
suffix:semicolon
)brace
r_else
(brace
id|rc
op_assign
id|security_transition_sid
c_func
(paren
id|tsec-&gt;sid
comma
id|dsec-&gt;sid
comma
id|inode_mode_to_security_class
c_func
(paren
id|inode-&gt;i_mode
)paren
comma
op_amp
id|newsid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;post_create:  &quot;
l_string|&quot;security_transition_sid failed, rc=%d (dev=%s &quot;
l_string|&quot;ino=%ld)&bslash;n&quot;
comma
op_minus
id|rc
comma
id|inode-&gt;i_sb-&gt;s_id
comma
id|inode-&gt;i_ino
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
)brace
id|rc
op_assign
id|inode_security_set_sid
c_func
(paren
id|inode
comma
id|newsid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;post_create:  inode_security_set_sid &quot;
l_string|&quot;failed, rc=%d (dev=%s ino=%ld)&bslash;n&quot;
comma
op_minus
id|rc
comma
id|inode-&gt;i_sb-&gt;s_id
comma
id|inode-&gt;i_ino
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|sbsec
op_assign
id|dir-&gt;i_sb-&gt;s_security
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sbsec
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sbsec-&gt;behavior
op_eq
id|SECURITY_FS_USE_XATTR
op_logical_and
id|inode-&gt;i_op-&gt;setxattr
)paren
(brace
multiline_comment|/* Use extended attributes. */
id|rc
op_assign
id|security_sid_to_context
c_func
(paren
id|newsid
comma
op_amp
id|context
comma
op_amp
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;post_create:  sid_to_context &quot;
l_string|&quot;failed, rc=%d (dev=%s ino=%ld)&bslash;n&quot;
comma
op_minus
id|rc
comma
id|inode-&gt;i_sb-&gt;s_id
comma
id|inode-&gt;i_ino
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|inode-&gt;i_sem
)paren
suffix:semicolon
id|rc
op_assign
id|inode-&gt;i_op
op_member_access_from_pointer
id|setxattr
c_func
(paren
id|dentry
comma
id|XATTR_NAME_SELINUX
comma
id|context
comma
id|len
comma
l_int|0
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|inode-&gt;i_sem
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|context
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;post_create:  setxattr failed, &quot;
l_string|&quot;rc=%d (dev=%s ino=%ld)&bslash;n&quot;
comma
op_minus
id|rc
comma
id|inode-&gt;i_sb-&gt;s_id
comma
id|inode-&gt;i_ino
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Hook functions begin here. */
DECL|function|selinux_ptrace
r_static
r_int
id|selinux_ptrace
c_func
(paren
r_struct
id|task_struct
op_star
id|parent
comma
r_struct
id|task_struct
op_star
id|child
)paren
(brace
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|secondary_ops
op_member_access_from_pointer
id|ptrace
c_func
(paren
id|parent
comma
id|child
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
r_return
id|task_has_perm
c_func
(paren
id|parent
comma
id|child
comma
id|PROCESS__PTRACE
)paren
suffix:semicolon
)brace
DECL|function|selinux_capget
r_static
r_int
id|selinux_capget
c_func
(paren
r_struct
id|task_struct
op_star
id|target
comma
id|kernel_cap_t
op_star
id|effective
comma
id|kernel_cap_t
op_star
id|inheritable
comma
id|kernel_cap_t
op_star
id|permitted
)paren
(brace
r_int
id|error
suffix:semicolon
id|error
op_assign
id|task_has_perm
c_func
(paren
id|current
comma
id|target
comma
id|PROCESS__GETCAP
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
r_return
id|secondary_ops
op_member_access_from_pointer
id|capget
c_func
(paren
id|target
comma
id|effective
comma
id|inheritable
comma
id|permitted
)paren
suffix:semicolon
)brace
DECL|function|selinux_capset_check
r_static
r_int
id|selinux_capset_check
c_func
(paren
r_struct
id|task_struct
op_star
id|target
comma
id|kernel_cap_t
op_star
id|effective
comma
id|kernel_cap_t
op_star
id|inheritable
comma
id|kernel_cap_t
op_star
id|permitted
)paren
(brace
r_int
id|error
suffix:semicolon
id|error
op_assign
id|task_has_perm
c_func
(paren
id|current
comma
id|target
comma
id|PROCESS__SETCAP
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
r_return
id|secondary_ops
op_member_access_from_pointer
id|capset_check
c_func
(paren
id|target
comma
id|effective
comma
id|inheritable
comma
id|permitted
)paren
suffix:semicolon
)brace
DECL|function|selinux_capset_set
r_static
r_void
id|selinux_capset_set
c_func
(paren
r_struct
id|task_struct
op_star
id|target
comma
id|kernel_cap_t
op_star
id|effective
comma
id|kernel_cap_t
op_star
id|inheritable
comma
id|kernel_cap_t
op_star
id|permitted
)paren
(brace
r_int
id|error
suffix:semicolon
id|error
op_assign
id|task_has_perm
c_func
(paren
id|current
comma
id|target
comma
id|PROCESS__SETCAP
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
suffix:semicolon
r_return
id|secondary_ops
op_member_access_from_pointer
id|capset_set
c_func
(paren
id|target
comma
id|effective
comma
id|inheritable
comma
id|permitted
)paren
suffix:semicolon
)brace
DECL|function|selinux_capable
r_static
r_int
id|selinux_capable
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
comma
r_int
id|cap
)paren
(brace
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|secondary_ops
op_member_access_from_pointer
id|capable
c_func
(paren
id|tsk
comma
id|cap
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
r_return
id|task_has_capability
c_func
(paren
id|tsk
comma
id|cap
)paren
suffix:semicolon
)brace
DECL|function|selinux_sysctl
r_static
r_int
id|selinux_sysctl
c_func
(paren
id|ctl_table
op_star
id|table
comma
r_int
id|op
)paren
(brace
r_int
id|error
op_assign
l_int|0
suffix:semicolon
id|u32
id|av
suffix:semicolon
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
id|u32
id|tsid
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|rc
op_assign
id|selinux_proc_get_sid
c_func
(paren
id|table-&gt;de
comma
(paren
id|op
op_eq
l_int|001
)paren
ques
c_cond
id|SECCLASS_DIR
suffix:colon
id|SECCLASS_FILE
comma
op_amp
id|tsid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
multiline_comment|/* Default to the well-defined sysctl SID. */
id|tsid
op_assign
id|SECINITSID_SYSCTL
suffix:semicolon
)brace
multiline_comment|/* The op values are &quot;defined&quot; in sysctl.c, thereby creating&n;&t; * a bad coupling between this module and sysctl.c */
r_if
c_cond
(paren
id|op
op_eq
l_int|001
)paren
(brace
id|error
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|tsid
comma
id|SECCLASS_DIR
comma
id|DIR__SEARCH
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_else
(brace
id|av
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|op
op_amp
l_int|004
)paren
id|av
op_or_assign
id|FILE__READ
suffix:semicolon
r_if
c_cond
(paren
id|op
op_amp
l_int|002
)paren
id|av
op_or_assign
id|FILE__WRITE
suffix:semicolon
r_if
c_cond
(paren
id|av
)paren
id|error
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|tsid
comma
id|SECCLASS_FILE
comma
id|av
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_return
id|error
suffix:semicolon
)brace
DECL|function|selinux_quotactl
r_static
r_int
id|selinux_quotactl
c_func
(paren
r_int
id|cmds
comma
r_int
id|type
comma
r_int
id|id
comma
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sb
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|cmds
)paren
(brace
r_case
id|Q_SYNC
suffix:colon
r_case
id|Q_QUOTAON
suffix:colon
r_case
id|Q_QUOTAOFF
suffix:colon
r_case
id|Q_SETINFO
suffix:colon
r_case
id|Q_SETQUOTA
suffix:colon
id|rc
op_assign
id|superblock_has_perm
c_func
(paren
id|current
comma
id|sb
comma
id|FILESYSTEM__QUOTAMOD
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|Q_GETFMT
suffix:colon
r_case
id|Q_GETINFO
suffix:colon
r_case
id|Q_GETQUOTA
suffix:colon
id|rc
op_assign
id|superblock_has_perm
c_func
(paren
id|current
comma
id|sb
comma
id|FILESYSTEM__QUOTAGET
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|rc
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* let the kernel handle invalid cmds */
r_break
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
DECL|function|selinux_quota_on
r_static
r_int
id|selinux_quota_on
c_func
(paren
r_struct
id|file
op_star
id|f
)paren
(brace
r_return
id|file_has_perm
c_func
(paren
id|current
comma
id|f
comma
id|FILE__QUOTAON
)paren
suffix:semicolon
suffix:semicolon
)brace
DECL|function|selinux_syslog
r_static
r_int
id|selinux_syslog
c_func
(paren
r_int
id|type
)paren
(brace
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|secondary_ops
op_member_access_from_pointer
id|syslog
c_func
(paren
id|type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
l_int|3
suffix:colon
multiline_comment|/* Read last kernel messages */
id|rc
op_assign
id|task_has_system
c_func
(paren
id|current
comma
id|SYSTEM__SYSLOG_READ
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|6
suffix:colon
multiline_comment|/* Disable logging to console */
r_case
l_int|7
suffix:colon
multiline_comment|/* Enable logging to console */
r_case
l_int|8
suffix:colon
multiline_comment|/* Set level of messages printed to console */
id|rc
op_assign
id|task_has_system
c_func
(paren
id|current
comma
id|SYSTEM__SYSLOG_CONSOLE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0
suffix:colon
multiline_comment|/* Close log */
r_case
l_int|1
suffix:colon
multiline_comment|/* Open log */
r_case
l_int|2
suffix:colon
multiline_comment|/* Read from log */
r_case
l_int|4
suffix:colon
multiline_comment|/* Read/clear last kernel messages */
r_case
l_int|5
suffix:colon
multiline_comment|/* Clear ring buffer */
r_default
suffix:colon
id|rc
op_assign
id|task_has_system
c_func
(paren
id|current
comma
id|SYSTEM__SYSLOG_MOD
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * Check that a process has enough memory to allocate a new virtual&n; * mapping. 0 means there is enough memory for the allocation to&n; * succeed and -ENOMEM implies there is not.&n; *&n; * We currently support three overcommit policies, which are set via the&n; * vm.overcommit_memory sysctl.  See Documentation/vm/overcommit-acounting&n; *&n; * Strict overcommit modes added 2002 Feb 26 by Alan Cox.&n; * Additional code 2002 Jul 20 by Robert Love.&n; */
DECL|function|selinux_vm_enough_memory
r_static
r_int
id|selinux_vm_enough_memory
c_func
(paren
r_int
id|pages
)paren
(brace
r_int
r_int
id|free
comma
id|allowed
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_struct
id|task_security_struct
op_star
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|vm_acct_memory
c_func
(paren
id|pages
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Sometimes we want to use more memory than we have&n;&t; */
r_if
c_cond
(paren
id|sysctl_overcommit_memory
op_eq
l_int|1
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sysctl_overcommit_memory
op_eq
l_int|0
)paren
(brace
id|free
op_assign
id|get_page_cache_size
c_func
(paren
)paren
suffix:semicolon
id|free
op_add_assign
id|nr_free_pages
c_func
(paren
)paren
suffix:semicolon
id|free
op_add_assign
id|nr_swap_pages
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Any slabs which are created with the&n;&t;&t; * SLAB_RECLAIM_ACCOUNT flag claim to have contents&n;&t;&t; * which are reclaimable, under pressure.  The dentry&n;&t;&t; * cache and most inode caches should fall into this&n;&t;&t; */
id|free
op_add_assign
id|atomic_read
c_func
(paren
op_amp
id|slab_reclaim_pages
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Leave the last 3% for privileged processes.&n;&t;&t; * Don&squot;t audit the check, as it is applied to all processes&n;&t;&t; * that allocate mappings.&n;&t;&t; */
id|rc
op_assign
id|secondary_ops
op_member_access_from_pointer
id|capable
c_func
(paren
id|current
comma
id|CAP_SYS_ADMIN
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
(brace
id|rc
op_assign
id|avc_has_perm_noaudit
c_func
(paren
id|tsec-&gt;sid
comma
id|tsec-&gt;sid
comma
id|SECCLASS_CAPABILITY
comma
id|CAP_TO_MASK
c_func
(paren
id|CAP_SYS_ADMIN
)paren
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rc
)paren
id|free
op_sub_assign
id|free
op_div
l_int|32
suffix:semicolon
r_if
c_cond
(paren
id|free
OG
id|pages
)paren
r_return
l_int|0
suffix:semicolon
id|vm_unacct_memory
c_func
(paren
id|pages
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|allowed
op_assign
id|totalram_pages
op_star
id|sysctl_overcommit_ratio
op_div
l_int|100
suffix:semicolon
id|allowed
op_add_assign
id|total_swap_pages
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|vm_committed_space
)paren
OL
id|allowed
)paren
r_return
l_int|0
suffix:semicolon
id|vm_unacct_memory
c_func
(paren
id|pages
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
DECL|function|selinux_netlink_send
r_static
r_int
id|selinux_netlink_send
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_if
c_cond
(paren
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
id|cap_raise
(paren
id|NETLINK_CB
(paren
id|skb
)paren
dot
id|eff_cap
comma
id|CAP_NET_ADMIN
)paren
suffix:semicolon
r_else
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|eff_cap
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_netlink_recv
r_static
r_int
id|selinux_netlink_recv
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cap_raised
c_func
(paren
id|NETLINK_CB
c_func
(paren
id|skb
)paren
dot
id|eff_cap
comma
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* binprm security operations */
DECL|function|selinux_bprm_alloc_security
r_static
r_int
id|selinux_bprm_alloc_security
c_func
(paren
r_struct
id|linux_binprm
op_star
id|bprm
)paren
(brace
r_int
id|rc
suffix:semicolon
multiline_comment|/* Make sure that the secondary module doesn&squot;t use the&n;&t;   bprm-&gt;security field, since we do not yet support chaining&n;&t;   of multiple security structures on the field.  Neither&n;&t;   the dummy nor the capability module use the field.  The owlsm&n;&t;   module uses the field if CONFIG_OWLSM_FD is enabled. */
id|rc
op_assign
id|secondary_ops
op_member_access_from_pointer
id|bprm_alloc_security
c_func
(paren
id|bprm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
r_if
c_cond
(paren
id|bprm-&gt;security
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: no support yet for chaining on the &quot;
l_string|&quot;security field by secondary modules.&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
multiline_comment|/* Release the secondary module&squot;s security object. */
id|secondary_ops
op_member_access_from_pointer
id|bprm_free_security
c_func
(paren
id|bprm
)paren
suffix:semicolon
multiline_comment|/* Unregister the secondary module to prevent problems&n;&t;&t;   with subsequent binprm hooks. This will revert to the&n;&t;&t;   original (dummy) module for the secondary operations. */
id|rc
op_assign
id|security_ops
op_member_access_from_pointer
id|unregister_security
c_func
(paren
l_string|&quot;unknown&quot;
comma
id|secondary_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: Unregistered the secondary security &quot;
l_string|&quot;module.&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
)brace
id|bprm-&gt;security
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_bprm_set_security
r_static
r_int
id|selinux_bprm_set_security
c_func
(paren
r_struct
id|linux_binprm
op_star
id|bprm
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|bprm-&gt;file-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_struct
id|inode_security_struct
op_star
id|isec
suffix:semicolon
id|u32
id|newsid
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|secondary_ops
op_member_access_from_pointer
id|bprm_set_security
c_func
(paren
id|bprm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
r_if
c_cond
(paren
id|bprm-&gt;sh_bang
op_logical_or
id|bprm-&gt;security
)paren
multiline_comment|/* The security field should already be set properly. */
r_return
l_int|0
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|isec
op_assign
id|inode-&gt;i_security
suffix:semicolon
multiline_comment|/* Default to the current task SID. */
id|bprm-&gt;security
op_assign
(paren
r_void
op_star
)paren
id|tsec-&gt;sid
suffix:semicolon
multiline_comment|/* Reset create SID on execve. */
id|tsec-&gt;create_sid
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tsec-&gt;exec_sid
)paren
(brace
id|newsid
op_assign
id|tsec-&gt;exec_sid
suffix:semicolon
multiline_comment|/* Reset exec SID on execve. */
id|tsec-&gt;exec_sid
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Check for a default transition on this program. */
id|rc
op_assign
id|security_transition_sid
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|SECCLASS_PROCESS
comma
op_amp
id|newsid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
)brace
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|FS
)paren
suffix:semicolon
id|ad.u.fs.mnt
op_assign
id|bprm-&gt;file-&gt;f_vfsmnt
suffix:semicolon
id|ad.u.fs.dentry
op_assign
id|bprm-&gt;file-&gt;f_dentry
suffix:semicolon
r_if
c_cond
(paren
id|bprm-&gt;file-&gt;f_vfsmnt-&gt;mnt_flags
op_amp
id|MNT_NOSUID
)paren
id|newsid
op_assign
id|tsec-&gt;sid
suffix:semicolon
r_if
c_cond
(paren
id|tsec-&gt;sid
op_eq
id|newsid
)paren
(brace
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|SECCLASS_FILE
comma
id|FILE__EXECUTE_NO_TRANS
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Check permissions for the transition. */
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|newsid
comma
id|SECCLASS_PROCESS
comma
id|PROCESS__TRANSITION
comma
l_int|NULL
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|newsid
comma
id|isec-&gt;sid
comma
id|SECCLASS_FILE
comma
id|FILE__ENTRYPOINT
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
multiline_comment|/* Set the security field to the new SID. */
id|bprm-&gt;security
op_assign
(paren
r_void
op_star
)paren
id|newsid
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_bprm_check_security
r_static
r_int
id|selinux_bprm_check_security
(paren
r_struct
id|linux_binprm
op_star
id|bprm
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_bprm_secureexec
r_static
r_int
id|selinux_bprm_secureexec
(paren
r_struct
id|linux_binprm
op_star
id|bprm
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
r_int
id|atsecure
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tsec-&gt;osid
op_ne
id|tsec-&gt;sid
)paren
(brace
multiline_comment|/* Enable secure mode for SIDs transitions unless&n;&t;&t;   the noatsecure permission is granted between&n;&t;&t;   the two SIDs, i.e. ahp returns 0. */
id|atsecure
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;osid
comma
id|tsec-&gt;sid
comma
id|SECCLASS_PROCESS
comma
id|PROCESS__NOATSECURE
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/* Note that we must include the legacy uid/gid test below&n;&t;   to retain it, as the new userland will simply use the&n;&t;   value passed by AT_SECURE to decide whether to enable&n;&t;   secure mode. */
r_return
(paren
id|atsecure
op_logical_or
id|current-&gt;euid
op_ne
id|current-&gt;uid
op_logical_or
id|current-&gt;egid
op_ne
id|current-&gt;gid
)paren
suffix:semicolon
)brace
DECL|function|selinux_bprm_free_security
r_static
r_void
id|selinux_bprm_free_security
c_func
(paren
r_struct
id|linux_binprm
op_star
id|bprm
)paren
(brace
multiline_comment|/* Nothing to do - not dynamically allocated. */
r_return
suffix:semicolon
)brace
multiline_comment|/* Derived from fs/exec.c:flush_old_files. */
DECL|function|flush_unauthorized_files
r_static
r_inline
r_void
id|flush_unauthorized_files
c_func
(paren
r_struct
id|files_struct
op_star
id|files
)paren
(brace
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
r_struct
id|file
op_star
id|file
suffix:semicolon
r_int
id|j
op_assign
op_minus
l_int|1
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|FS
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|files-&gt;file_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_int
r_int
id|set
comma
id|i
suffix:semicolon
id|j
op_increment
suffix:semicolon
id|i
op_assign
id|j
op_star
id|__NFDBITS
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|files-&gt;max_fds
op_logical_or
id|i
op_ge
id|files-&gt;max_fdset
)paren
r_break
suffix:semicolon
id|set
op_assign
id|files-&gt;open_fds-&gt;fds_bits
(braket
id|j
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|set
)paren
r_continue
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|files-&gt;file_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|set
suffix:semicolon
id|i
op_increment
comma
id|set
op_rshift_assign
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|set
op_amp
l_int|1
)paren
(brace
id|file
op_assign
id|fget
c_func
(paren
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|file
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|file_has_perm
c_func
(paren
id|current
comma
id|file
comma
id|file_to_av
c_func
(paren
id|file
)paren
)paren
)paren
id|sys_close
c_func
(paren
id|i
)paren
suffix:semicolon
id|fput
c_func
(paren
id|file
)paren
suffix:semicolon
)brace
)brace
id|spin_lock
c_func
(paren
op_amp
id|files-&gt;file_lock
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|files-&gt;file_lock
)paren
suffix:semicolon
)brace
DECL|function|selinux_bprm_compute_creds
r_static
r_void
id|selinux_bprm_compute_creds
c_func
(paren
r_struct
id|linux_binprm
op_star
id|bprm
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
comma
op_star
id|psec
suffix:semicolon
id|u32
id|sid
suffix:semicolon
r_struct
id|av_decision
id|avd
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|secondary_ops
op_member_access_from_pointer
id|bprm_compute_creds
c_func
(paren
id|bprm
)paren
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|sid
op_assign
(paren
id|u32
)paren
id|bprm-&gt;security
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sid
)paren
id|sid
op_assign
id|tsec-&gt;sid
suffix:semicolon
id|tsec-&gt;osid
op_assign
id|tsec-&gt;sid
suffix:semicolon
r_if
c_cond
(paren
id|tsec-&gt;sid
op_ne
id|sid
)paren
(brace
multiline_comment|/* Check for shared state.  If not ok, leave SID&n;&t;&t;   unchanged and kill. */
r_if
c_cond
(paren
(paren
id|atomic_read
c_func
(paren
op_amp
id|current-&gt;fs-&gt;count
)paren
OG
l_int|1
op_logical_or
id|atomic_read
c_func
(paren
op_amp
id|current-&gt;files-&gt;count
)paren
OG
l_int|1
op_logical_or
id|atomic_read
c_func
(paren
op_amp
id|current-&gt;sighand-&gt;count
)paren
OG
l_int|1
)paren
)paren
(brace
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|sid
comma
id|SECCLASS_PROCESS
comma
id|PROCESS__SHARE
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|force_sig_specific
c_func
(paren
id|SIGKILL
comma
id|current
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
multiline_comment|/* Check for ptracing, and update the task SID if ok.&n;&t;&t;   Otherwise, leave SID unchanged and kill. */
id|task_lock
c_func
(paren
id|current
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;ptrace
op_amp
id|PT_PTRACED
)paren
(brace
id|psec
op_assign
id|current-&gt;parent-&gt;security
suffix:semicolon
id|rc
op_assign
id|avc_has_perm_noaudit
c_func
(paren
id|psec-&gt;sid
comma
id|sid
comma
id|SECCLASS_PROCESS
comma
id|PROCESS__PTRACE
comma
l_int|NULL
comma
op_amp
id|avd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
id|tsec-&gt;sid
op_assign
id|sid
suffix:semicolon
id|task_unlock
c_func
(paren
id|current
)paren
suffix:semicolon
id|avc_audit
c_func
(paren
id|psec-&gt;sid
comma
id|sid
comma
id|SECCLASS_PROCESS
comma
id|PROCESS__PTRACE
comma
op_amp
id|avd
comma
id|rc
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|force_sig_specific
c_func
(paren
id|SIGKILL
comma
id|current
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_else
(brace
id|tsec-&gt;sid
op_assign
id|sid
suffix:semicolon
id|task_unlock
c_func
(paren
id|current
)paren
suffix:semicolon
)brace
multiline_comment|/* Close files for which the new task SID is not authorized. */
id|flush_unauthorized_files
c_func
(paren
id|current-&gt;files
)paren
suffix:semicolon
multiline_comment|/* Wake up the parent if it is waiting so that it can&n;&t;&t;   recheck wait permission to the new task SID. */
id|wake_up_interruptible
c_func
(paren
op_amp
id|current-&gt;parent-&gt;wait_chldexit
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* superblock security operations */
DECL|function|selinux_sb_alloc_security
r_static
r_int
id|selinux_sb_alloc_security
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_return
id|superblock_alloc_security
c_func
(paren
id|sb
)paren
suffix:semicolon
)brace
DECL|function|selinux_sb_free_security
r_static
r_void
id|selinux_sb_free_security
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
id|superblock_free_security
c_func
(paren
id|sb
)paren
suffix:semicolon
)brace
DECL|function|selinux_sb_kern_mount
r_static
r_int
id|selinux_sb_kern_mount
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|superblock_doinit
c_func
(paren
id|sb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|FS
)paren
suffix:semicolon
id|ad.u.fs.dentry
op_assign
id|sb-&gt;s_root
suffix:semicolon
r_return
id|superblock_has_perm
c_func
(paren
id|current
comma
id|sb
comma
id|FILESYSTEM__MOUNT
comma
op_amp
id|ad
)paren
suffix:semicolon
)brace
DECL|function|selinux_sb_statfs
r_static
r_int
id|selinux_sb_statfs
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|FS
)paren
suffix:semicolon
id|ad.u.fs.dentry
op_assign
id|sb-&gt;s_root
suffix:semicolon
r_return
id|superblock_has_perm
c_func
(paren
id|current
comma
id|sb
comma
id|FILESYSTEM__GETATTR
comma
op_amp
id|ad
)paren
suffix:semicolon
)brace
DECL|function|selinux_mount
r_static
r_int
id|selinux_mount
c_func
(paren
r_char
op_star
id|dev_name
comma
r_struct
id|nameidata
op_star
id|nd
comma
r_char
op_star
id|type
comma
r_int
r_int
id|flags
comma
r_void
op_star
id|data
)paren
(brace
r_if
c_cond
(paren
id|flags
op_amp
id|MS_REMOUNT
)paren
r_return
id|superblock_has_perm
c_func
(paren
id|current
comma
id|nd-&gt;mnt-&gt;mnt_sb
comma
id|FILESYSTEM__REMOUNT
comma
l_int|NULL
)paren
suffix:semicolon
r_else
r_return
id|dentry_has_perm
c_func
(paren
id|current
comma
id|nd-&gt;mnt
comma
id|nd-&gt;dentry
comma
id|FILE__MOUNTON
)paren
suffix:semicolon
)brace
DECL|function|selinux_umount
r_static
r_int
id|selinux_umount
c_func
(paren
r_struct
id|vfsmount
op_star
id|mnt
comma
r_int
id|flags
)paren
(brace
r_return
id|superblock_has_perm
c_func
(paren
id|current
comma
id|mnt-&gt;mnt_sb
comma
id|FILESYSTEM__UNMOUNT
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/* inode security operations */
DECL|function|selinux_inode_alloc_security
r_static
r_int
id|selinux_inode_alloc_security
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
r_return
id|inode_alloc_security
c_func
(paren
id|inode
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_free_security
r_static
r_void
id|selinux_inode_free_security
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
id|inode_free_security
c_func
(paren
id|inode
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_create
r_static
r_int
id|selinux_inode_create
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
comma
r_int
id|mask
)paren
(brace
r_return
id|may_create
c_func
(paren
id|dir
comma
id|dentry
comma
id|SECCLASS_FILE
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_post_create
r_static
r_void
id|selinux_inode_post_create
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
comma
r_int
id|mask
)paren
(brace
id|post_create
c_func
(paren
id|dir
comma
id|dentry
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_link
r_static
r_int
id|selinux_inode_link
c_func
(paren
r_struct
id|dentry
op_star
id|old_dentry
comma
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|new_dentry
)paren
(brace
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|secondary_ops
op_member_access_from_pointer
id|inode_link
c_func
(paren
id|old_dentry
comma
id|dir
comma
id|new_dentry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
r_return
id|may_link
c_func
(paren
id|dir
comma
id|old_dentry
comma
id|MAY_LINK
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_post_link
r_static
r_void
id|selinux_inode_post_link
c_func
(paren
r_struct
id|dentry
op_star
id|old_dentry
comma
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|dentry
op_star
id|new_dentry
)paren
(brace
r_return
suffix:semicolon
)brace
DECL|function|selinux_inode_unlink
r_static
r_int
id|selinux_inode_unlink
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_return
id|may_link
c_func
(paren
id|dir
comma
id|dentry
comma
id|MAY_UNLINK
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_symlink
r_static
r_int
id|selinux_inode_symlink
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
comma
r_const
r_char
op_star
id|name
)paren
(brace
r_return
id|may_create
c_func
(paren
id|dir
comma
id|dentry
comma
id|SECCLASS_LNK_FILE
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_post_symlink
r_static
r_void
id|selinux_inode_post_symlink
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
comma
r_const
r_char
op_star
id|name
)paren
(brace
id|post_create
c_func
(paren
id|dir
comma
id|dentry
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_mkdir
r_static
r_int
id|selinux_inode_mkdir
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
comma
r_int
id|mask
)paren
(brace
r_return
id|may_create
c_func
(paren
id|dir
comma
id|dentry
comma
id|SECCLASS_DIR
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_post_mkdir
r_static
r_void
id|selinux_inode_post_mkdir
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
comma
r_int
id|mask
)paren
(brace
id|post_create
c_func
(paren
id|dir
comma
id|dentry
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_rmdir
r_static
r_int
id|selinux_inode_rmdir
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_return
id|may_link
c_func
(paren
id|dir
comma
id|dentry
comma
id|MAY_RMDIR
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_mknod
r_static
r_int
id|selinux_inode_mknod
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
comma
r_int
id|mode
comma
id|dev_t
id|dev
)paren
(brace
r_return
id|may_create
c_func
(paren
id|dir
comma
id|dentry
comma
id|inode_mode_to_security_class
c_func
(paren
id|mode
)paren
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_post_mknod
r_static
r_void
id|selinux_inode_post_mknod
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
comma
r_int
id|mode
comma
id|dev_t
id|dev
)paren
(brace
id|post_create
c_func
(paren
id|dir
comma
id|dentry
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_rename
r_static
r_int
id|selinux_inode_rename
c_func
(paren
r_struct
id|inode
op_star
id|old_inode
comma
r_struct
id|dentry
op_star
id|old_dentry
comma
r_struct
id|inode
op_star
id|new_inode
comma
r_struct
id|dentry
op_star
id|new_dentry
)paren
(brace
r_return
id|may_rename
c_func
(paren
id|old_inode
comma
id|old_dentry
comma
id|new_inode
comma
id|new_dentry
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_post_rename
r_static
r_void
id|selinux_inode_post_rename
c_func
(paren
r_struct
id|inode
op_star
id|old_inode
comma
r_struct
id|dentry
op_star
id|old_dentry
comma
r_struct
id|inode
op_star
id|new_inode
comma
r_struct
id|dentry
op_star
id|new_dentry
)paren
(brace
r_return
suffix:semicolon
)brace
DECL|function|selinux_inode_readlink
r_static
r_int
id|selinux_inode_readlink
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_return
id|dentry_has_perm
c_func
(paren
id|current
comma
l_int|NULL
comma
id|dentry
comma
id|FILE__READ
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_follow_link
r_static
r_int
id|selinux_inode_follow_link
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_struct
id|nameidata
op_star
id|nameidata
)paren
(brace
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|secondary_ops
op_member_access_from_pointer
id|inode_follow_link
c_func
(paren
id|dentry
comma
id|nameidata
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
r_return
id|dentry_has_perm
c_func
(paren
id|current
comma
l_int|NULL
comma
id|dentry
comma
id|FILE__READ
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_permission
r_static
r_int
id|selinux_inode_permission
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|mask
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|mask
)paren
(brace
multiline_comment|/* No permission to check.  Existence test. */
r_return
l_int|0
suffix:semicolon
)brace
r_return
id|inode_has_perm
c_func
(paren
id|current
comma
id|inode
comma
id|file_mask_to_av
c_func
(paren
id|inode-&gt;i_mode
comma
id|mask
)paren
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_setattr
r_static
r_int
id|selinux_inode_setattr
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_struct
id|iattr
op_star
id|iattr
)paren
(brace
r_if
c_cond
(paren
id|iattr-&gt;ia_valid
op_amp
(paren
id|ATTR_MODE
op_or
id|ATTR_UID
op_or
id|ATTR_GID
op_or
id|ATTR_ATIME_SET
op_or
id|ATTR_MTIME_SET
)paren
)paren
r_return
id|dentry_has_perm
c_func
(paren
id|current
comma
l_int|NULL
comma
id|dentry
comma
id|FILE__SETATTR
)paren
suffix:semicolon
r_return
id|dentry_has_perm
c_func
(paren
id|current
comma
l_int|NULL
comma
id|dentry
comma
id|FILE__WRITE
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_getattr
r_static
r_int
id|selinux_inode_getattr
c_func
(paren
r_struct
id|vfsmount
op_star
id|mnt
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_return
id|dentry_has_perm
c_func
(paren
id|current
comma
id|mnt
comma
id|dentry
comma
id|FILE__GETATTR
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_setxattr
r_static
r_int
id|selinux_inode_setxattr
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_char
op_star
id|name
comma
r_void
op_star
id|value
comma
r_int
id|size
comma
r_int
id|flags
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|dentry-&gt;d_inode
suffix:semicolon
r_struct
id|inode_security_struct
op_star
id|isec
op_assign
id|inode-&gt;i_security
suffix:semicolon
r_struct
id|superblock_security_struct
op_star
id|sbsec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
id|u32
id|newsid
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|name
comma
id|XATTR_NAME_SELINUX
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|name
comma
id|XATTR_SECURITY_PREFIX
comma
r_sizeof
id|XATTR_SECURITY_PREFIX
op_minus
l_int|1
)paren
op_logical_and
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
(brace
multiline_comment|/* A different attribute in the security namespace.&n;&t;&t;&t;   Restrict to administrator. */
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
multiline_comment|/* Not an attribute we recognize, so just check the&n;&t;&t;   ordinary setattr permission. */
r_return
id|dentry_has_perm
c_func
(paren
id|current
comma
l_int|NULL
comma
id|dentry
comma
id|FILE__SETATTR
)paren
suffix:semicolon
)brace
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|FS
)paren
suffix:semicolon
id|ad.u.fs.dentry
op_assign
id|dentry
suffix:semicolon
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|isec-&gt;sclass
comma
id|FILE__RELABELFROM
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|rc
op_assign
id|security_context_to_sid
c_func
(paren
id|value
comma
id|size
comma
op_amp
id|newsid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|newsid
comma
id|isec-&gt;sclass
comma
id|FILE__RELABELTO
comma
l_int|NULL
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|sbsec
op_assign
id|inode-&gt;i_sb-&gt;s_security
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sbsec
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|avc_has_perm
c_func
(paren
id|newsid
comma
id|sbsec-&gt;sid
comma
id|SECCLASS_FILESYSTEM
comma
id|FILESYSTEM__ASSOCIATE
comma
l_int|NULL
comma
op_amp
id|ad
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_post_setxattr
r_static
r_void
id|selinux_inode_post_setxattr
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_char
op_star
id|name
comma
r_void
op_star
id|value
comma
r_int
id|size
comma
r_int
id|flags
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|dentry-&gt;d_inode
suffix:semicolon
r_struct
id|inode_security_struct
op_star
id|isec
op_assign
id|inode-&gt;i_security
suffix:semicolon
id|u32
id|newsid
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|name
comma
id|XATTR_NAME_SELINUX
)paren
)paren
(brace
multiline_comment|/* Not an attribute we recognize, so nothing to do. */
r_return
suffix:semicolon
)brace
id|rc
op_assign
id|security_context_to_sid
c_func
(paren
id|value
comma
id|size
comma
op_amp
id|newsid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s:  unable to obtain SID for context &quot;
l_string|&quot;%s, rc=%d&bslash;n&quot;
comma
id|__FUNCTION__
comma
(paren
r_char
op_star
)paren
id|value
comma
op_minus
id|rc
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|isec-&gt;sid
op_assign
id|newsid
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|selinux_inode_getxattr
r_static
r_int
id|selinux_inode_getxattr
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_char
op_star
id|name
)paren
(brace
r_return
id|dentry_has_perm
c_func
(paren
id|current
comma
l_int|NULL
comma
id|dentry
comma
id|FILE__GETATTR
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_listxattr
r_static
r_int
id|selinux_inode_listxattr
(paren
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_return
id|dentry_has_perm
c_func
(paren
id|current
comma
l_int|NULL
comma
id|dentry
comma
id|FILE__GETATTR
)paren
suffix:semicolon
)brace
DECL|function|selinux_inode_removexattr
r_static
r_int
id|selinux_inode_removexattr
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_char
op_star
id|name
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|name
comma
id|XATTR_NAME_SELINUX
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|name
comma
id|XATTR_SECURITY_PREFIX
comma
r_sizeof
id|XATTR_SECURITY_PREFIX
op_minus
l_int|1
)paren
op_logical_and
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
(brace
multiline_comment|/* A different attribute in the security namespace.&n;&t;&t;&t;   Restrict to administrator. */
r_return
op_minus
id|EPERM
suffix:semicolon
)brace
multiline_comment|/* Not an attribute we recognize, so just check the&n;&t;&t;   ordinary setattr permission. Might want a separate&n;&t;&t;   permission for removexattr. */
r_return
id|dentry_has_perm
c_func
(paren
id|current
comma
l_int|NULL
comma
id|dentry
comma
id|FILE__SETATTR
)paren
suffix:semicolon
)brace
multiline_comment|/* No one is allowed to remove a SELinux security label.&n;&t;   You can change the label, but all data must be labeled. */
r_return
op_minus
id|EACCES
suffix:semicolon
)brace
DECL|function|selinux_inode_getsecurity
r_static
r_int
id|selinux_inode_getsecurity
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_const
r_char
op_star
id|name
comma
r_void
op_star
id|buffer
comma
r_int
id|size
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|dentry-&gt;d_inode
suffix:semicolon
r_struct
id|inode_security_struct
op_star
id|isec
op_assign
id|inode-&gt;i_security
suffix:semicolon
r_char
op_star
id|context
suffix:semicolon
r_int
id|len
suffix:semicolon
r_int
id|rc
suffix:semicolon
multiline_comment|/* Permission check handled by selinux_inode_getxattr hook.*/
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|name
comma
id|XATTR_SELINUX_SUFFIX
)paren
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
id|rc
op_assign
id|security_sid_to_context
c_func
(paren
id|isec-&gt;sid
comma
op_amp
id|context
comma
op_amp
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
op_logical_or
op_logical_neg
id|size
)paren
(brace
id|kfree
c_func
(paren
id|context
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
OL
id|len
)paren
(brace
id|kfree
c_func
(paren
id|context
)paren
suffix:semicolon
r_return
op_minus
id|ERANGE
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|buffer
comma
id|context
comma
id|len
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|context
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|selinux_inode_setsecurity
r_static
r_int
id|selinux_inode_setsecurity
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_const
r_char
op_star
id|name
comma
r_const
r_void
op_star
id|value
comma
r_int
id|size
comma
r_int
id|flags
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|dentry-&gt;d_inode
suffix:semicolon
r_struct
id|inode_security_struct
op_star
id|isec
op_assign
id|inode-&gt;i_security
suffix:semicolon
id|u32
id|newsid
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|name
comma
id|XATTR_SELINUX_SUFFIX
)paren
)paren
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
id|size
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
id|rc
op_assign
id|security_context_to_sid
c_func
(paren
(paren
r_void
op_star
)paren
id|value
comma
id|size
comma
op_amp
id|newsid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|isec-&gt;sid
op_assign
id|newsid
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_inode_listsecurity
r_static
r_int
id|selinux_inode_listsecurity
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_char
op_star
id|buffer
)paren
(brace
r_const
r_int
id|len
op_assign
r_sizeof
(paren
id|XATTR_NAME_SELINUX
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buffer
)paren
id|memcpy
c_func
(paren
id|buffer
comma
id|XATTR_NAME_SELINUX
comma
id|len
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
multiline_comment|/* file security operations */
DECL|function|selinux_file_permission
r_static
r_int
id|selinux_file_permission
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_int
id|mask
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|file-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mask
)paren
(brace
multiline_comment|/* No permission to check.  Existence test. */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* file_mask_to_av won&squot;t add FILE__WRITE if MAY_APPEND is set */
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_APPEND
)paren
op_logical_and
(paren
id|mask
op_amp
id|MAY_WRITE
)paren
)paren
id|mask
op_or_assign
id|MAY_APPEND
suffix:semicolon
r_return
id|file_has_perm
c_func
(paren
id|current
comma
id|file
comma
id|file_mask_to_av
c_func
(paren
id|inode-&gt;i_mode
comma
id|mask
)paren
)paren
suffix:semicolon
)brace
DECL|function|selinux_file_alloc_security
r_static
r_int
id|selinux_file_alloc_security
c_func
(paren
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
id|file_alloc_security
c_func
(paren
id|file
)paren
suffix:semicolon
)brace
DECL|function|selinux_file_free_security
r_static
r_void
id|selinux_file_free_security
c_func
(paren
r_struct
id|file
op_star
id|file
)paren
(brace
id|file_free_security
c_func
(paren
id|file
)paren
suffix:semicolon
)brace
DECL|function|selinux_file_ioctl
r_static
r_int
id|selinux_file_ioctl
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
id|error
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|FIONREAD
suffix:colon
multiline_comment|/* fall through */
r_case
id|FIBMAP
suffix:colon
multiline_comment|/* fall through */
r_case
id|FIGETBSZ
suffix:colon
multiline_comment|/* fall through */
r_case
id|EXT2_IOC_GETFLAGS
suffix:colon
multiline_comment|/* fall through */
r_case
id|EXT2_IOC_GETVERSION
suffix:colon
id|error
op_assign
id|file_has_perm
c_func
(paren
id|current
comma
id|file
comma
id|FILE__GETATTR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EXT2_IOC_SETFLAGS
suffix:colon
multiline_comment|/* fall through */
r_case
id|EXT2_IOC_SETVERSION
suffix:colon
id|error
op_assign
id|file_has_perm
c_func
(paren
id|current
comma
id|file
comma
id|FILE__SETATTR
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* sys_ioctl() checks */
r_case
id|FIONBIO
suffix:colon
multiline_comment|/* fall through */
r_case
id|FIOASYNC
suffix:colon
id|error
op_assign
id|file_has_perm
c_func
(paren
id|current
comma
id|file
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KDSKBENT
suffix:colon
r_case
id|KDSKBSENT
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_TTY_CONFIG
)paren
)paren
id|error
op_assign
op_minus
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* default case assumes that the command will go&n;&t;&t; * to the file&squot;s ioctl() function.&n;&t;&t; */
r_default
suffix:colon
id|error
op_assign
id|file_has_perm
c_func
(paren
id|current
comma
id|file
comma
id|FILE__IOCTL
)paren
suffix:semicolon
)brace
r_return
id|error
suffix:semicolon
)brace
DECL|function|selinux_file_mmap
r_static
r_int
id|selinux_file_mmap
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|prot
comma
r_int
r_int
id|flags
)paren
(brace
id|u32
id|av
suffix:semicolon
r_if
c_cond
(paren
id|file
)paren
(brace
multiline_comment|/* read access is always possible with a mapping */
id|av
op_assign
id|FILE__READ
suffix:semicolon
multiline_comment|/* write access only matters if the mapping is shared */
r_if
c_cond
(paren
(paren
id|flags
op_amp
id|MAP_TYPE
)paren
op_eq
id|MAP_SHARED
op_logical_and
(paren
id|prot
op_amp
id|PROT_WRITE
)paren
)paren
id|av
op_or_assign
id|FILE__WRITE
suffix:semicolon
r_if
c_cond
(paren
id|prot
op_amp
id|PROT_EXEC
)paren
id|av
op_or_assign
id|FILE__EXECUTE
suffix:semicolon
r_return
id|file_has_perm
c_func
(paren
id|current
comma
id|file
comma
id|av
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_file_mprotect
r_static
r_int
id|selinux_file_mprotect
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_int
r_int
id|prot
)paren
(brace
r_return
id|selinux_file_mmap
c_func
(paren
id|vma-&gt;vm_file
comma
id|prot
comma
id|vma-&gt;vm_flags
)paren
suffix:semicolon
)brace
DECL|function|selinux_file_lock
r_static
r_int
id|selinux_file_lock
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
)paren
(brace
r_return
id|file_has_perm
c_func
(paren
id|current
comma
id|file
comma
id|FILE__LOCK
)paren
suffix:semicolon
)brace
DECL|function|selinux_file_fcntl
r_static
r_int
id|selinux_file_fcntl
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|F_SETFL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|file-&gt;f_dentry
op_logical_or
op_logical_neg
id|file-&gt;f_dentry-&gt;d_inode
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_APPEND
)paren
op_logical_and
op_logical_neg
(paren
id|arg
op_amp
id|O_APPEND
)paren
)paren
(brace
id|err
op_assign
id|file_has_perm
c_func
(paren
id|current
comma
id|file
comma
id|FILE__WRITE
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* fall through */
r_case
id|F_SETOWN
suffix:colon
r_case
id|F_SETSIG
suffix:colon
r_case
id|F_GETFL
suffix:colon
r_case
id|F_GETOWN
suffix:colon
r_case
id|F_GETSIG
suffix:colon
multiline_comment|/* Just check FD__USE permission */
id|err
op_assign
id|file_has_perm
c_func
(paren
id|current
comma
id|file
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|F_GETLK
suffix:colon
r_case
id|F_SETLK
suffix:colon
r_case
id|F_SETLKW
suffix:colon
r_case
id|F_GETLK64
suffix:colon
r_case
id|F_SETLK64
suffix:colon
r_case
id|F_SETLKW64
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|file-&gt;f_dentry
op_logical_or
op_logical_neg
id|file-&gt;f_dentry-&gt;d_inode
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err
op_assign
id|file_has_perm
c_func
(paren
id|current
comma
id|file
comma
id|FILE__LOCK
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|selinux_file_set_fowner
r_static
r_int
id|selinux_file_set_fowner
c_func
(paren
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|file_security_struct
op_star
id|fsec
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|fsec
op_assign
id|file-&gt;f_security
suffix:semicolon
id|fsec-&gt;fown_sid
op_assign
id|tsec-&gt;sid
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_file_send_sigiotask
r_static
r_int
id|selinux_file_send_sigiotask
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
comma
r_struct
id|fown_struct
op_star
id|fown
comma
r_int
id|fd
comma
r_int
id|reason
)paren
(brace
r_struct
id|file
op_star
id|file
suffix:semicolon
id|u32
id|perm
suffix:semicolon
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|file_security_struct
op_star
id|fsec
suffix:semicolon
multiline_comment|/* struct fown_struct is never outside the context of a struct file */
id|file
op_assign
(paren
r_struct
id|file
op_star
)paren
(paren
(paren
r_int
)paren
id|fown
op_minus
m_offsetof
(paren
r_struct
id|file
comma
id|f_owner
)paren
)paren
suffix:semicolon
id|tsec
op_assign
id|tsk-&gt;security
suffix:semicolon
id|fsec
op_assign
id|file-&gt;f_security
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fown-&gt;signum
)paren
id|perm
op_assign
id|signal_to_av
c_func
(paren
id|SIGIO
)paren
suffix:semicolon
multiline_comment|/* as per send_sigio_to_task */
r_else
id|perm
op_assign
id|signal_to_av
c_func
(paren
id|fown-&gt;signum
)paren
suffix:semicolon
r_return
id|avc_has_perm
c_func
(paren
id|fsec-&gt;fown_sid
comma
id|tsec-&gt;sid
comma
id|SECCLASS_PROCESS
comma
id|perm
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|selinux_file_receive
r_static
r_int
id|selinux_file_receive
c_func
(paren
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
id|file_has_perm
c_func
(paren
id|current
comma
id|file
comma
id|file_to_av
c_func
(paren
id|file
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* task security operations */
DECL|function|selinux_task_create
r_static
r_int
id|selinux_task_create
c_func
(paren
r_int
r_int
id|clone_flags
)paren
(brace
r_return
id|task_has_perm
c_func
(paren
id|current
comma
id|current
comma
id|PROCESS__FORK
)paren
suffix:semicolon
)brace
DECL|function|selinux_task_alloc_security
r_static
r_int
id|selinux_task_alloc_security
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec1
comma
op_star
id|tsec2
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|tsec1
op_assign
id|current-&gt;security
suffix:semicolon
id|rc
op_assign
id|task_alloc_security
c_func
(paren
id|tsk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|tsec2
op_assign
id|tsk-&gt;security
suffix:semicolon
id|tsec2-&gt;osid
op_assign
id|tsec1-&gt;osid
suffix:semicolon
id|tsec2-&gt;sid
op_assign
id|tsec1-&gt;sid
suffix:semicolon
multiline_comment|/* Retain the exec and create SIDs across fork */
id|tsec2-&gt;exec_sid
op_assign
id|tsec1-&gt;exec_sid
suffix:semicolon
id|tsec2-&gt;create_sid
op_assign
id|tsec1-&gt;create_sid
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_task_free_security
r_static
r_void
id|selinux_task_free_security
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
)paren
(brace
id|task_free_security
c_func
(paren
id|tsk
)paren
suffix:semicolon
)brace
DECL|function|selinux_task_setuid
r_static
r_int
id|selinux_task_setuid
c_func
(paren
id|uid_t
id|id0
comma
id|uid_t
id|id1
comma
id|uid_t
id|id2
comma
r_int
id|flags
)paren
(brace
multiline_comment|/* Since setuid only affects the current process, and&n;&t;   since the SELinux controls are not based on the Linux&n;&t;   identity attributes, SELinux does not need to control&n;&t;   this operation.  However, SELinux does control the use&n;&t;   of the CAP_SETUID and CAP_SETGID capabilities using the&n;&t;   capable hook. */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_task_post_setuid
r_static
r_int
id|selinux_task_post_setuid
c_func
(paren
id|uid_t
id|id0
comma
id|uid_t
id|id1
comma
id|uid_t
id|id2
comma
r_int
id|flags
)paren
(brace
r_return
id|secondary_ops
op_member_access_from_pointer
id|task_post_setuid
c_func
(paren
id|id0
comma
id|id1
comma
id|id2
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|selinux_task_setgid
r_static
r_int
id|selinux_task_setgid
c_func
(paren
id|gid_t
id|id0
comma
id|gid_t
id|id1
comma
id|gid_t
id|id2
comma
r_int
id|flags
)paren
(brace
multiline_comment|/* See the comment for setuid above. */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_task_setpgid
r_static
r_int
id|selinux_task_setpgid
c_func
(paren
r_struct
id|task_struct
op_star
id|p
comma
id|pid_t
id|pgid
)paren
(brace
r_return
id|task_has_perm
c_func
(paren
id|current
comma
id|p
comma
id|PROCESS__SETPGID
)paren
suffix:semicolon
)brace
DECL|function|selinux_task_getpgid
r_static
r_int
id|selinux_task_getpgid
c_func
(paren
r_struct
id|task_struct
op_star
id|p
)paren
(brace
r_return
id|task_has_perm
c_func
(paren
id|current
comma
id|p
comma
id|PROCESS__GETPGID
)paren
suffix:semicolon
)brace
DECL|function|selinux_task_getsid
r_static
r_int
id|selinux_task_getsid
c_func
(paren
r_struct
id|task_struct
op_star
id|p
)paren
(brace
r_return
id|task_has_perm
c_func
(paren
id|current
comma
id|p
comma
id|PROCESS__GETSESSION
)paren
suffix:semicolon
)brace
DECL|function|selinux_task_setgroups
r_static
r_int
id|selinux_task_setgroups
c_func
(paren
r_int
id|gidsetsize
comma
id|gid_t
op_star
id|grouplist
)paren
(brace
multiline_comment|/* See the comment for setuid above. */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_task_setnice
r_static
r_int
id|selinux_task_setnice
c_func
(paren
r_struct
id|task_struct
op_star
id|p
comma
r_int
id|nice
)paren
(brace
r_return
id|task_has_perm
c_func
(paren
id|current
comma
id|p
comma
id|PROCESS__SETSCHED
)paren
suffix:semicolon
)brace
DECL|function|selinux_task_setrlimit
r_static
r_int
id|selinux_task_setrlimit
c_func
(paren
r_int
r_int
id|resource
comma
r_struct
id|rlimit
op_star
id|new_rlim
)paren
(brace
multiline_comment|/* SELinux does not currently provide a process&n;&t;   resource limit policy based on security contexts.&n;&t;   It does control the use of the CAP_SYS_RESOURCE capability&n;&t;   using the capable hook. */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_task_setscheduler
r_static
r_int
id|selinux_task_setscheduler
c_func
(paren
r_struct
id|task_struct
op_star
id|p
comma
r_int
id|policy
comma
r_struct
id|sched_param
op_star
id|lp
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec1
comma
op_star
id|tsec2
suffix:semicolon
id|tsec1
op_assign
id|current-&gt;security
suffix:semicolon
id|tsec2
op_assign
id|p-&gt;security
suffix:semicolon
multiline_comment|/* No auditing from the setscheduler hook, since the runqueue lock&n;&t;   is held and the system will deadlock if we try to log an audit&n;&t;   message. */
r_return
id|avc_has_perm_noaudit
c_func
(paren
id|tsec1-&gt;sid
comma
id|tsec2-&gt;sid
comma
id|SECCLASS_PROCESS
comma
id|PROCESS__SETSCHED
comma
op_amp
id|tsec2-&gt;avcr
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|selinux_task_getscheduler
r_static
r_int
id|selinux_task_getscheduler
c_func
(paren
r_struct
id|task_struct
op_star
id|p
)paren
(brace
r_return
id|task_has_perm
c_func
(paren
id|current
comma
id|p
comma
id|PROCESS__GETSCHED
)paren
suffix:semicolon
)brace
DECL|function|selinux_task_kill
r_static
r_int
id|selinux_task_kill
c_func
(paren
r_struct
id|task_struct
op_star
id|p
comma
r_struct
id|siginfo
op_star
id|info
comma
r_int
id|sig
)paren
(brace
id|u32
id|perm
suffix:semicolon
r_if
c_cond
(paren
id|info
op_logical_and
(paren
(paren
r_int
r_int
)paren
id|info
op_eq
l_int|1
op_logical_or
(paren
r_int
r_int
)paren
id|info
op_eq
l_int|2
op_logical_or
id|SI_FROMKERNEL
c_func
(paren
id|info
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sig
)paren
id|perm
op_assign
id|PROCESS__SIGNULL
suffix:semicolon
multiline_comment|/* null signal; existence test */
r_else
id|perm
op_assign
id|signal_to_av
c_func
(paren
id|sig
)paren
suffix:semicolon
r_return
id|task_has_perm
c_func
(paren
id|current
comma
id|p
comma
id|perm
)paren
suffix:semicolon
)brace
DECL|function|selinux_task_prctl
r_static
r_int
id|selinux_task_prctl
c_func
(paren
r_int
id|option
comma
r_int
r_int
id|arg2
comma
r_int
r_int
id|arg3
comma
r_int
r_int
id|arg4
comma
r_int
r_int
id|arg5
)paren
(brace
multiline_comment|/* The current prctl operations do not appear to require&n;&t;   any SELinux controls since they merely observe or modify&n;&t;   the state of the current process. */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_task_wait
r_static
r_int
id|selinux_task_wait
c_func
(paren
r_struct
id|task_struct
op_star
id|p
)paren
(brace
id|u32
id|perm
suffix:semicolon
id|perm
op_assign
id|signal_to_av
c_func
(paren
id|p-&gt;exit_signal
)paren
suffix:semicolon
r_return
id|task_has_perm
c_func
(paren
id|p
comma
id|current
comma
id|perm
)paren
suffix:semicolon
)brace
DECL|function|selinux_task_reparent_to_init
r_static
r_void
id|selinux_task_reparent_to_init
c_func
(paren
r_struct
id|task_struct
op_star
id|p
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
id|secondary_ops
op_member_access_from_pointer
id|task_reparent_to_init
c_func
(paren
id|p
)paren
suffix:semicolon
id|tsec
op_assign
id|p-&gt;security
suffix:semicolon
id|tsec-&gt;osid
op_assign
id|tsec-&gt;sid
suffix:semicolon
id|tsec-&gt;sid
op_assign
id|SECINITSID_KERNEL
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|selinux_task_to_inode
r_static
r_void
id|selinux_task_to_inode
c_func
(paren
r_struct
id|task_struct
op_star
id|p
comma
r_struct
id|inode
op_star
id|inode
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
op_assign
id|p-&gt;security
suffix:semicolon
r_struct
id|inode_security_struct
op_star
id|isec
op_assign
id|inode-&gt;i_security
suffix:semicolon
id|isec-&gt;sid
op_assign
id|tsec-&gt;sid
suffix:semicolon
id|isec-&gt;initialized
op_assign
l_int|1
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SECURITY_NETWORK
multiline_comment|/* socket security operations */
DECL|function|socket_has_perm
r_static
r_int
id|socket_has_perm
c_func
(paren
r_struct
id|task_struct
op_star
id|task
comma
r_struct
id|socket
op_star
id|sock
comma
id|u32
id|perms
)paren
(brace
r_struct
id|inode_security_struct
op_star
id|isec
suffix:semicolon
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
r_int
id|err
suffix:semicolon
id|tsec
op_assign
id|task-&gt;security
suffix:semicolon
id|isec
op_assign
id|SOCK_INODE
c_func
(paren
id|sock
)paren
op_member_access_from_pointer
id|i_security
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|NET
)paren
suffix:semicolon
id|ad.u.net.sk
op_assign
id|sock-&gt;sk
suffix:semicolon
id|err
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|isec-&gt;sclass
comma
id|perms
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|selinux_socket_create
r_static
r_int
id|selinux_socket_create
c_func
(paren
r_int
id|family
comma
r_int
id|type
comma
r_int
id|protocol
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|err
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|tsec-&gt;sid
comma
id|socket_type_to_security_class
c_func
(paren
id|family
comma
id|type
)paren
comma
id|SOCKET__CREATE
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|selinux_socket_post_create
r_static
r_void
id|selinux_socket_post_create
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|family
comma
r_int
id|type
comma
r_int
id|protocol
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|inode_security_struct
op_star
id|isec
suffix:semicolon
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
id|err
op_assign
id|inode_doinit
c_func
(paren
id|SOCK_INODE
c_func
(paren
id|sock
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
suffix:semicolon
id|isec
op_assign
id|SOCK_INODE
c_func
(paren
id|sock
)paren
op_member_access_from_pointer
id|i_security
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|isec-&gt;sclass
op_assign
id|socket_type_to_security_class
c_func
(paren
id|family
comma
id|type
)paren
suffix:semicolon
id|isec-&gt;sid
op_assign
id|tsec-&gt;sid
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Range of port numbers used to automatically bind.&n;   Need to determine whether we should perform a name_bind&n;   permission check between the socket and the port number. */
DECL|macro|ip_local_port_range_0
mdefine_line|#define ip_local_port_range_0 sysctl_local_port_range[0]
DECL|macro|ip_local_port_range_1
mdefine_line|#define ip_local_port_range_1 sysctl_local_port_range[1]
DECL|function|selinux_socket_bind
r_static
r_int
id|selinux_socket_bind
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|address
comma
r_int
id|addrlen
)paren
(brace
r_int
id|err
suffix:semicolon
id|err
op_assign
id|socket_has_perm
c_func
(paren
id|current
comma
id|sock
comma
id|SOCKET__BIND
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/*&n;&t; * If PF_INET, check name_bind permission for the port.&n;&t; */
r_if
c_cond
(paren
id|sock-&gt;sk-&gt;sk_family
op_eq
id|PF_INET
)paren
(brace
r_struct
id|inode_security_struct
op_star
id|isec
suffix:semicolon
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
r_struct
id|sockaddr_in
op_star
id|addr
op_assign
(paren
r_struct
id|sockaddr_in
op_star
)paren
id|address
suffix:semicolon
r_int
r_int
id|snum
op_assign
id|ntohs
c_func
(paren
id|addr-&gt;sin_port
)paren
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
id|u32
id|sid
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|isec
op_assign
id|SOCK_INODE
c_func
(paren
id|sock
)paren
op_member_access_from_pointer
id|i_security
suffix:semicolon
r_if
c_cond
(paren
id|snum
op_logical_and
(paren
id|snum
template_param
id|ip_local_port_range_1
)paren
)paren
(brace
id|err
op_assign
id|security_port_sid
c_func
(paren
id|sk-&gt;sk_family
comma
id|sk-&gt;sk_type
comma
id|sk-&gt;sk_protocol
comma
id|snum
comma
op_amp
id|sid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|NET
)paren
suffix:semicolon
id|ad.u.net.port
op_assign
id|snum
suffix:semicolon
id|err
op_assign
id|avc_has_perm
c_func
(paren
id|isec-&gt;sid
comma
id|sid
comma
id|isec-&gt;sclass
comma
id|SOCKET__NAME_BIND
comma
l_int|NULL
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_socket_connect
r_static
r_int
id|selinux_socket_connect
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|sockaddr
op_star
id|address
comma
r_int
id|addrlen
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|sock
op_star
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|inode_security_struct
op_star
id|isec
suffix:semicolon
id|isec
op_assign
id|SOCK_INODE
c_func
(paren
id|sock
)paren
op_member_access_from_pointer
id|i_security
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|NET
)paren
suffix:semicolon
id|ad.u.net.sk
op_assign
id|sk
suffix:semicolon
id|err
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|isec-&gt;sclass
comma
id|SOCKET__CONNECT
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_socket_listen
r_static
r_int
id|selinux_socket_listen
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|backlog
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|inode_security_struct
op_star
id|isec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|isec
op_assign
id|SOCK_INODE
c_func
(paren
id|sock
)paren
op_member_access_from_pointer
id|i_security
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|NET
)paren
suffix:semicolon
id|ad.u.net.sk
op_assign
id|sock-&gt;sk
suffix:semicolon
id|err
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|isec-&gt;sclass
comma
id|SOCKET__LISTEN
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_socket_accept
r_static
r_int
id|selinux_socket_accept
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|socket
op_star
id|newsock
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|inode_security_struct
op_star
id|isec
suffix:semicolon
r_struct
id|inode_security_struct
op_star
id|newisec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|isec
op_assign
id|SOCK_INODE
c_func
(paren
id|sock
)paren
op_member_access_from_pointer
id|i_security
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|NET
)paren
suffix:semicolon
id|ad.u.net.sk
op_assign
id|sock-&gt;sk
suffix:semicolon
id|err
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|isec-&gt;sclass
comma
id|SOCKET__ACCEPT
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|err
op_assign
id|inode_doinit
c_func
(paren
id|SOCK_INODE
c_func
(paren
id|newsock
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|newisec
op_assign
id|SOCK_INODE
c_func
(paren
id|newsock
)paren
op_member_access_from_pointer
id|i_security
suffix:semicolon
id|newisec-&gt;sclass
op_assign
id|isec-&gt;sclass
suffix:semicolon
id|newisec-&gt;sid
op_assign
id|isec-&gt;sid
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_socket_sendmsg
r_static
r_int
id|selinux_socket_sendmsg
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|size
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|inode_security_struct
op_star
id|isec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
r_struct
id|sock
op_star
id|sk
suffix:semicolon
r_int
id|err
suffix:semicolon
id|isec
op_assign
id|SOCK_INODE
c_func
(paren
id|sock
)paren
op_member_access_from_pointer
id|i_security
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|sk
op_assign
id|sock-&gt;sk
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|NET
)paren
suffix:semicolon
id|ad.u.net.sk
op_assign
id|sk
suffix:semicolon
id|err
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|isec-&gt;sclass
comma
id|SOCKET__WRITE
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_socket_recvmsg
r_static
r_int
id|selinux_socket_recvmsg
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|msghdr
op_star
id|msg
comma
r_int
id|size
comma
r_int
id|flags
)paren
(brace
r_struct
id|inode_security_struct
op_star
id|isec
suffix:semicolon
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
r_int
id|err
suffix:semicolon
id|isec
op_assign
id|SOCK_INODE
c_func
(paren
id|sock
)paren
op_member_access_from_pointer
id|i_security
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|NET
)paren
suffix:semicolon
id|ad.u.net.sk
op_assign
id|sock-&gt;sk
suffix:semicolon
id|err
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|isec-&gt;sclass
comma
id|SOCKET__READ
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_socket_getsockname
r_static
r_int
id|selinux_socket_getsockname
c_func
(paren
r_struct
id|socket
op_star
id|sock
)paren
(brace
r_struct
id|inode_security_struct
op_star
id|isec
suffix:semicolon
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
r_int
id|err
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|isec
op_assign
id|SOCK_INODE
c_func
(paren
id|sock
)paren
op_member_access_from_pointer
id|i_security
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|NET
)paren
suffix:semicolon
id|ad.u.net.sk
op_assign
id|sock-&gt;sk
suffix:semicolon
id|err
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|isec-&gt;sclass
comma
id|SOCKET__GETATTR
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_socket_getpeername
r_static
r_int
id|selinux_socket_getpeername
c_func
(paren
r_struct
id|socket
op_star
id|sock
)paren
(brace
r_struct
id|inode_security_struct
op_star
id|isec
suffix:semicolon
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
r_int
id|err
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|isec
op_assign
id|SOCK_INODE
c_func
(paren
id|sock
)paren
op_member_access_from_pointer
id|i_security
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|NET
)paren
suffix:semicolon
id|ad.u.net.sk
op_assign
id|sock-&gt;sk
suffix:semicolon
id|err
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|isec-&gt;sclass
comma
id|SOCKET__GETATTR
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_socket_setsockopt
r_static
r_int
id|selinux_socket_setsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
)paren
(brace
r_return
id|socket_has_perm
c_func
(paren
id|current
comma
id|sock
comma
id|SOCKET__SETOPT
)paren
suffix:semicolon
)brace
DECL|function|selinux_socket_getsockopt
r_static
r_int
id|selinux_socket_getsockopt
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|level
comma
r_int
id|optname
)paren
(brace
r_return
id|socket_has_perm
c_func
(paren
id|current
comma
id|sock
comma
id|SOCKET__GETOPT
)paren
suffix:semicolon
)brace
DECL|function|selinux_socket_shutdown
r_static
r_int
id|selinux_socket_shutdown
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_int
id|how
)paren
(brace
r_return
id|socket_has_perm
c_func
(paren
id|current
comma
id|sock
comma
id|SOCKET__SHUTDOWN
)paren
suffix:semicolon
)brace
DECL|function|selinux_socket_unix_stream_connect
r_static
r_int
id|selinux_socket_unix_stream_connect
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|socket
op_star
id|other
comma
r_struct
id|sock
op_star
id|newsk
)paren
(brace
r_struct
id|inode_security_struct
op_star
id|isec
suffix:semicolon
r_struct
id|inode_security_struct
op_star
id|other_isec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
r_int
id|err
suffix:semicolon
id|isec
op_assign
id|SOCK_INODE
c_func
(paren
id|sock
)paren
op_member_access_from_pointer
id|i_security
suffix:semicolon
id|other_isec
op_assign
id|SOCK_INODE
c_func
(paren
id|other
)paren
op_member_access_from_pointer
id|i_security
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|NET
)paren
suffix:semicolon
id|ad.u.net.sk
op_assign
id|other-&gt;sk
suffix:semicolon
id|err
op_assign
id|avc_has_perm
c_func
(paren
id|isec-&gt;sid
comma
id|other_isec-&gt;sid
comma
id|isec-&gt;sclass
comma
id|UNIX_STREAM_SOCKET__CONNECTTO
comma
op_amp
id|other_isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_socket_unix_may_send
r_static
r_int
id|selinux_socket_unix_may_send
c_func
(paren
r_struct
id|socket
op_star
id|sock
comma
r_struct
id|socket
op_star
id|other
)paren
(brace
r_struct
id|inode_security_struct
op_star
id|isec
suffix:semicolon
r_struct
id|inode_security_struct
op_star
id|other_isec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
r_int
id|err
suffix:semicolon
id|isec
op_assign
id|SOCK_INODE
c_func
(paren
id|sock
)paren
op_member_access_from_pointer
id|i_security
suffix:semicolon
id|other_isec
op_assign
id|SOCK_INODE
c_func
(paren
id|other
)paren
op_member_access_from_pointer
id|i_security
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|NET
)paren
suffix:semicolon
id|ad.u.net.sk
op_assign
id|other-&gt;sk
suffix:semicolon
id|err
op_assign
id|avc_has_perm
c_func
(paren
id|isec-&gt;sid
comma
id|other_isec-&gt;sid
comma
id|isec-&gt;sclass
comma
id|SOCKET__SENDTO
comma
op_amp
id|other_isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|function|ipc_alloc_security
r_static
r_int
id|ipc_alloc_security
c_func
(paren
r_struct
id|task_struct
op_star
id|task
comma
r_struct
id|kern_ipc_perm
op_star
id|perm
comma
id|u16
id|sclass
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
op_assign
id|task-&gt;security
suffix:semicolon
r_struct
id|ipc_security_struct
op_star
id|isec
suffix:semicolon
id|isec
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|ipc_security_struct
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isec
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|isec
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|ipc_security_struct
)paren
)paren
suffix:semicolon
id|isec-&gt;magic
op_assign
id|SELINUX_MAGIC
suffix:semicolon
id|isec-&gt;sclass
op_assign
id|sclass
suffix:semicolon
id|isec-&gt;ipc_perm
op_assign
id|perm
suffix:semicolon
r_if
c_cond
(paren
id|tsec
)paren
(brace
id|isec-&gt;sid
op_assign
id|tsec-&gt;sid
suffix:semicolon
)brace
r_else
(brace
id|isec-&gt;sid
op_assign
id|SECINITSID_UNLABELED
suffix:semicolon
)brace
id|perm-&gt;security
op_assign
id|isec
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ipc_free_security
r_static
r_void
id|ipc_free_security
c_func
(paren
r_struct
id|kern_ipc_perm
op_star
id|perm
)paren
(brace
r_struct
id|ipc_security_struct
op_star
id|isec
op_assign
id|perm-&gt;security
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isec
op_logical_or
id|isec-&gt;magic
op_ne
id|SELINUX_MAGIC
)paren
r_return
suffix:semicolon
id|perm-&gt;security
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|isec
)paren
suffix:semicolon
)brace
DECL|function|msg_msg_alloc_security
r_static
r_int
id|msg_msg_alloc_security
c_func
(paren
r_struct
id|msg_msg
op_star
id|msg
)paren
(brace
r_struct
id|msg_security_struct
op_star
id|msec
suffix:semicolon
id|msec
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|msg_security_struct
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|msec
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|msec
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|msg_security_struct
)paren
)paren
suffix:semicolon
id|msec-&gt;magic
op_assign
id|SELINUX_MAGIC
suffix:semicolon
id|msec-&gt;msg
op_assign
id|msg
suffix:semicolon
id|msec-&gt;sid
op_assign
id|SECINITSID_UNLABELED
suffix:semicolon
id|msg-&gt;security
op_assign
id|msec
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|msg_msg_free_security
r_static
r_void
id|msg_msg_free_security
c_func
(paren
r_struct
id|msg_msg
op_star
id|msg
)paren
(brace
r_struct
id|msg_security_struct
op_star
id|msec
op_assign
id|msg-&gt;security
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|msec
op_logical_or
id|msec-&gt;magic
op_ne
id|SELINUX_MAGIC
)paren
r_return
suffix:semicolon
id|msg-&gt;security
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|msec
)paren
suffix:semicolon
)brace
DECL|function|ipc_has_perm
r_static
r_int
id|ipc_has_perm
c_func
(paren
r_struct
id|kern_ipc_perm
op_star
id|ipc_perms
comma
id|u16
id|sclass
comma
id|u32
id|perms
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|ipc_security_struct
op_star
id|isec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|isec
op_assign
id|ipc_perms-&gt;security
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|IPC
)paren
suffix:semicolon
id|ad.u.ipc_id
op_assign
id|ipc_perms-&gt;key
suffix:semicolon
r_return
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|sclass
comma
id|perms
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
)brace
DECL|function|selinux_msg_msg_alloc_security
r_static
r_int
id|selinux_msg_msg_alloc_security
c_func
(paren
r_struct
id|msg_msg
op_star
id|msg
)paren
(brace
r_return
id|msg_msg_alloc_security
c_func
(paren
id|msg
)paren
suffix:semicolon
)brace
DECL|function|selinux_msg_msg_free_security
r_static
r_void
id|selinux_msg_msg_free_security
c_func
(paren
r_struct
id|msg_msg
op_star
id|msg
)paren
(brace
r_return
id|msg_msg_free_security
c_func
(paren
id|msg
)paren
suffix:semicolon
)brace
multiline_comment|/* message queue security operations */
DECL|function|selinux_msg_queue_alloc_security
r_static
r_int
id|selinux_msg_queue_alloc_security
c_func
(paren
r_struct
id|msg_queue
op_star
id|msq
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|ipc_security_struct
op_star
id|isec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|ipc_alloc_security
c_func
(paren
id|current
comma
op_amp
id|msq-&gt;q_perm
comma
id|SECCLASS_MSGQ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|isec
op_assign
id|msq-&gt;q_perm.security
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|IPC
)paren
suffix:semicolon
id|ad.u.ipc_id
op_assign
id|msq-&gt;q_perm.key
suffix:semicolon
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|SECCLASS_MSGQ
comma
id|MSGQ__CREATE
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|ipc_free_security
c_func
(paren
op_amp
id|msq-&gt;q_perm
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_msg_queue_free_security
r_static
r_void
id|selinux_msg_queue_free_security
c_func
(paren
r_struct
id|msg_queue
op_star
id|msq
)paren
(brace
id|ipc_free_security
c_func
(paren
op_amp
id|msq-&gt;q_perm
)paren
suffix:semicolon
)brace
DECL|function|selinux_msg_queue_associate
r_static
r_int
id|selinux_msg_queue_associate
c_func
(paren
r_struct
id|msg_queue
op_star
id|msq
comma
r_int
id|msqflg
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|ipc_security_struct
op_star
id|isec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|isec
op_assign
id|msq-&gt;q_perm.security
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|IPC
)paren
suffix:semicolon
id|ad.u.ipc_id
op_assign
id|msq-&gt;q_perm.key
suffix:semicolon
r_return
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|SECCLASS_MSGQ
comma
id|MSGQ__ASSOCIATE
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
)brace
DECL|function|selinux_msg_queue_msgctl
r_static
r_int
id|selinux_msg_queue_msgctl
c_func
(paren
r_struct
id|msg_queue
op_star
id|msq
comma
r_int
id|cmd
)paren
(brace
r_int
id|err
suffix:semicolon
r_int
id|perms
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|IPC_INFO
suffix:colon
r_case
id|MSG_INFO
suffix:colon
multiline_comment|/* No specific object, just general system-wide information. */
r_return
id|task_has_system
c_func
(paren
id|current
comma
id|SYSTEM__IPC_INFO
)paren
suffix:semicolon
r_case
id|IPC_STAT
suffix:colon
r_case
id|MSG_STAT
suffix:colon
id|perms
op_assign
id|MSGQ__GETATTR
op_or
id|MSGQ__ASSOCIATE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPC_SET
suffix:colon
id|perms
op_assign
id|MSGQ__SETATTR
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPC_RMID
suffix:colon
id|perms
op_assign
id|MSGQ__DESTROY
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
id|err
op_assign
id|ipc_has_perm
c_func
(paren
op_amp
id|msq-&gt;q_perm
comma
id|SECCLASS_MSGQ
comma
id|perms
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|selinux_msg_queue_msgsnd
r_static
r_int
id|selinux_msg_queue_msgsnd
c_func
(paren
r_struct
id|msg_queue
op_star
id|msq
comma
r_struct
id|msg_msg
op_star
id|msg
comma
r_int
id|msqflg
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|ipc_security_struct
op_star
id|isec
suffix:semicolon
r_struct
id|msg_security_struct
op_star
id|msec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|isec
op_assign
id|msq-&gt;q_perm.security
suffix:semicolon
id|msec
op_assign
id|msg-&gt;security
suffix:semicolon
multiline_comment|/*&n;&t; * First time through, need to assign label to the message&n;&t; */
r_if
c_cond
(paren
id|msec-&gt;sid
op_eq
id|SECINITSID_UNLABELED
)paren
(brace
multiline_comment|/*&n;&t;&t; * Compute new sid based on current process and&n;&t;&t; * message queue this message will be stored in&n;&t;&t; */
id|rc
op_assign
id|security_transition_sid
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|SECCLASS_MSG
comma
op_amp
id|msec-&gt;sid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
)brace
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|IPC
)paren
suffix:semicolon
id|ad.u.ipc_id
op_assign
id|msq-&gt;q_perm.key
suffix:semicolon
multiline_comment|/* Can this process write to the queue? */
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|SECCLASS_MSGQ
comma
id|MSGQ__WRITE
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
multiline_comment|/* Can this process send the message */
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|msec-&gt;sid
comma
id|SECCLASS_MSG
comma
id|MSG__SEND
comma
op_amp
id|msec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
multiline_comment|/* Can the message be put in the queue? */
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|msec-&gt;sid
comma
id|isec-&gt;sid
comma
id|SECCLASS_MSGQ
comma
id|MSGQ__ENQUEUE
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|selinux_msg_queue_msgrcv
r_static
r_int
id|selinux_msg_queue_msgrcv
c_func
(paren
r_struct
id|msg_queue
op_star
id|msq
comma
r_struct
id|msg_msg
op_star
id|msg
comma
r_struct
id|task_struct
op_star
id|target
comma
r_int
id|type
comma
r_int
id|mode
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|ipc_security_struct
op_star
id|isec
suffix:semicolon
r_struct
id|msg_security_struct
op_star
id|msec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|tsec
op_assign
id|target-&gt;security
suffix:semicolon
id|isec
op_assign
id|msq-&gt;q_perm.security
suffix:semicolon
id|msec
op_assign
id|msg-&gt;security
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|IPC
)paren
suffix:semicolon
id|ad.u.ipc_id
op_assign
id|msq-&gt;q_perm.key
suffix:semicolon
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|SECCLASS_MSGQ
comma
id|MSGQ__READ
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|msec-&gt;sid
comma
id|SECCLASS_MSG
comma
id|MSG__RECEIVE
comma
op_amp
id|msec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* Shared Memory security operations */
DECL|function|selinux_shm_alloc_security
r_static
r_int
id|selinux_shm_alloc_security
c_func
(paren
r_struct
id|shmid_kernel
op_star
id|shp
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|ipc_security_struct
op_star
id|isec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|ipc_alloc_security
c_func
(paren
id|current
comma
op_amp
id|shp-&gt;shm_perm
comma
id|SECCLASS_SHM
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|isec
op_assign
id|shp-&gt;shm_perm.security
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|IPC
)paren
suffix:semicolon
id|ad.u.ipc_id
op_assign
id|shp-&gt;shm_perm.key
suffix:semicolon
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|SECCLASS_SHM
comma
id|SHM__CREATE
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|ipc_free_security
c_func
(paren
op_amp
id|shp-&gt;shm_perm
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_shm_free_security
r_static
r_void
id|selinux_shm_free_security
c_func
(paren
r_struct
id|shmid_kernel
op_star
id|shp
)paren
(brace
id|ipc_free_security
c_func
(paren
op_amp
id|shp-&gt;shm_perm
)paren
suffix:semicolon
)brace
DECL|function|selinux_shm_associate
r_static
r_int
id|selinux_shm_associate
c_func
(paren
r_struct
id|shmid_kernel
op_star
id|shp
comma
r_int
id|shmflg
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|ipc_security_struct
op_star
id|isec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|isec
op_assign
id|shp-&gt;shm_perm.security
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|IPC
)paren
suffix:semicolon
id|ad.u.ipc_id
op_assign
id|shp-&gt;shm_perm.key
suffix:semicolon
r_return
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|SECCLASS_SHM
comma
id|SHM__ASSOCIATE
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
)brace
multiline_comment|/* Note, at this point, shp is locked down */
DECL|function|selinux_shm_shmctl
r_static
r_int
id|selinux_shm_shmctl
c_func
(paren
r_struct
id|shmid_kernel
op_star
id|shp
comma
r_int
id|cmd
)paren
(brace
r_int
id|perms
suffix:semicolon
r_int
id|err
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|IPC_INFO
suffix:colon
r_case
id|SHM_INFO
suffix:colon
multiline_comment|/* No specific object, just general system-wide information. */
r_return
id|task_has_system
c_func
(paren
id|current
comma
id|SYSTEM__IPC_INFO
)paren
suffix:semicolon
r_case
id|IPC_STAT
suffix:colon
r_case
id|SHM_STAT
suffix:colon
id|perms
op_assign
id|SHM__GETATTR
op_or
id|SHM__ASSOCIATE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPC_SET
suffix:colon
id|perms
op_assign
id|SHM__SETATTR
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SHM_LOCK
suffix:colon
r_case
id|SHM_UNLOCK
suffix:colon
id|perms
op_assign
id|SHM__LOCK
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPC_RMID
suffix:colon
id|perms
op_assign
id|SHM__DESTROY
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
id|err
op_assign
id|ipc_has_perm
c_func
(paren
op_amp
id|shp-&gt;shm_perm
comma
id|SECCLASS_SHM
comma
id|perms
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|selinux_shm_shmat
r_static
r_int
id|selinux_shm_shmat
c_func
(paren
r_struct
id|shmid_kernel
op_star
id|shp
comma
r_char
op_star
id|shmaddr
comma
r_int
id|shmflg
)paren
(brace
id|u32
id|perms
suffix:semicolon
r_if
c_cond
(paren
id|shmflg
op_amp
id|SHM_RDONLY
)paren
id|perms
op_assign
id|SHM__READ
suffix:semicolon
r_else
id|perms
op_assign
id|SHM__READ
op_or
id|SHM__WRITE
suffix:semicolon
r_return
id|ipc_has_perm
c_func
(paren
op_amp
id|shp-&gt;shm_perm
comma
id|SECCLASS_SHM
comma
id|perms
)paren
suffix:semicolon
)brace
multiline_comment|/* Semaphore security operations */
DECL|function|selinux_sem_alloc_security
r_static
r_int
id|selinux_sem_alloc_security
c_func
(paren
r_struct
id|sem_array
op_star
id|sma
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|ipc_security_struct
op_star
id|isec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|ipc_alloc_security
c_func
(paren
id|current
comma
op_amp
id|sma-&gt;sem_perm
comma
id|SECCLASS_SEM
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_return
id|rc
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|isec
op_assign
id|sma-&gt;sem_perm.security
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|IPC
)paren
suffix:semicolon
id|ad.u.ipc_id
op_assign
id|sma-&gt;sem_perm.key
suffix:semicolon
id|rc
op_assign
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|SECCLASS_SEM
comma
id|SEM__CREATE
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|ipc_free_security
c_func
(paren
op_amp
id|sma-&gt;sem_perm
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_sem_free_security
r_static
r_void
id|selinux_sem_free_security
c_func
(paren
r_struct
id|sem_array
op_star
id|sma
)paren
(brace
id|ipc_free_security
c_func
(paren
op_amp
id|sma-&gt;sem_perm
)paren
suffix:semicolon
)brace
DECL|function|selinux_sem_associate
r_static
r_int
id|selinux_sem_associate
c_func
(paren
r_struct
id|sem_array
op_star
id|sma
comma
r_int
id|semflg
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
r_struct
id|ipc_security_struct
op_star
id|isec
suffix:semicolon
r_struct
id|avc_audit_data
id|ad
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|isec
op_assign
id|sma-&gt;sem_perm.security
suffix:semicolon
id|AVC_AUDIT_DATA_INIT
c_func
(paren
op_amp
id|ad
comma
id|IPC
)paren
suffix:semicolon
id|ad.u.ipc_id
op_assign
id|sma-&gt;sem_perm.key
suffix:semicolon
r_return
id|avc_has_perm
c_func
(paren
id|tsec-&gt;sid
comma
id|isec-&gt;sid
comma
id|SECCLASS_SEM
comma
id|SEM__ASSOCIATE
comma
op_amp
id|isec-&gt;avcr
comma
op_amp
id|ad
)paren
suffix:semicolon
)brace
multiline_comment|/* Note, at this point, sma is locked down */
DECL|function|selinux_sem_semctl
r_static
r_int
id|selinux_sem_semctl
c_func
(paren
r_struct
id|sem_array
op_star
id|sma
comma
r_int
id|cmd
)paren
(brace
r_int
id|err
suffix:semicolon
id|u32
id|perms
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|IPC_INFO
suffix:colon
r_case
id|SEM_INFO
suffix:colon
multiline_comment|/* No specific object, just general system-wide information. */
r_return
id|task_has_system
c_func
(paren
id|current
comma
id|SYSTEM__IPC_INFO
)paren
suffix:semicolon
r_case
id|GETPID
suffix:colon
r_case
id|GETNCNT
suffix:colon
r_case
id|GETZCNT
suffix:colon
id|perms
op_assign
id|SEM__GETATTR
suffix:semicolon
r_break
suffix:semicolon
r_case
id|GETVAL
suffix:colon
r_case
id|GETALL
suffix:colon
id|perms
op_assign
id|SEM__READ
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SETVAL
suffix:colon
r_case
id|SETALL
suffix:colon
id|perms
op_assign
id|SEM__WRITE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPC_RMID
suffix:colon
id|perms
op_assign
id|SEM__DESTROY
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPC_SET
suffix:colon
id|perms
op_assign
id|SEM__SETATTR
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPC_STAT
suffix:colon
r_case
id|SEM_STAT
suffix:colon
id|perms
op_assign
id|SEM__GETATTR
op_or
id|SEM__ASSOCIATE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
id|err
op_assign
id|ipc_has_perm
c_func
(paren
op_amp
id|sma-&gt;sem_perm
comma
id|SECCLASS_SEM
comma
id|perms
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|selinux_sem_semop
r_static
r_int
id|selinux_sem_semop
c_func
(paren
r_struct
id|sem_array
op_star
id|sma
comma
r_struct
id|sembuf
op_star
id|sops
comma
r_int
id|nsops
comma
r_int
id|alter
)paren
(brace
id|u32
id|perms
suffix:semicolon
r_if
c_cond
(paren
id|alter
)paren
id|perms
op_assign
id|SEM__READ
op_or
id|SEM__WRITE
suffix:semicolon
r_else
id|perms
op_assign
id|SEM__READ
suffix:semicolon
r_return
id|ipc_has_perm
c_func
(paren
op_amp
id|sma-&gt;sem_perm
comma
id|SECCLASS_SEM
comma
id|perms
)paren
suffix:semicolon
)brace
DECL|function|selinux_ipc_permission
r_static
r_int
id|selinux_ipc_permission
c_func
(paren
r_struct
id|kern_ipc_perm
op_star
id|ipcp
comma
r_int
id|flag
)paren
(brace
r_struct
id|ipc_security_struct
op_star
id|isec
op_assign
id|ipcp-&gt;security
suffix:semicolon
id|u16
id|sclass
op_assign
id|SECCLASS_IPC
suffix:semicolon
id|u32
id|av
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|isec
op_logical_and
id|isec-&gt;magic
op_eq
id|SELINUX_MAGIC
)paren
id|sclass
op_assign
id|isec-&gt;sclass
suffix:semicolon
id|av
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|flag
op_amp
id|S_IRUGO
)paren
id|av
op_or_assign
id|IPC__UNIX_READ
suffix:semicolon
r_if
c_cond
(paren
id|flag
op_amp
id|S_IWUGO
)paren
id|av
op_or_assign
id|IPC__UNIX_WRITE
suffix:semicolon
r_if
c_cond
(paren
id|av
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|ipc_has_perm
c_func
(paren
id|ipcp
comma
id|sclass
comma
id|av
)paren
suffix:semicolon
)brace
multiline_comment|/* module stacking operations */
DECL|function|selinux_register_security
r_int
id|selinux_register_security
(paren
r_const
r_char
op_star
id|name
comma
r_struct
id|security_operations
op_star
id|ops
)paren
(brace
r_if
c_cond
(paren
id|secondary_ops
op_ne
id|original_ops
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s:  There is already a secondary security &quot;
l_string|&quot;module registered.&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|secondary_ops
op_assign
id|ops
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s:  Registering secondary module %s&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_unregister_security
r_int
id|selinux_unregister_security
(paren
r_const
r_char
op_star
id|name
comma
r_struct
id|security_operations
op_star
id|ops
)paren
(brace
r_if
c_cond
(paren
id|ops
op_ne
id|secondary_ops
)paren
(brace
id|printk
(paren
id|KERN_INFO
l_string|&quot;%s:  trying to unregister a security module &quot;
l_string|&quot;that is not registered.&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|secondary_ops
op_assign
id|original_ops
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_d_instantiate
r_static
r_void
id|selinux_d_instantiate
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_struct
id|inode
op_star
id|inode
)paren
(brace
r_if
c_cond
(paren
id|inode
)paren
id|inode_doinit_with_dentry
c_func
(paren
id|inode
comma
id|dentry
)paren
suffix:semicolon
)brace
DECL|function|selinux_getprocattr
r_static
r_int
id|selinux_getprocattr
c_func
(paren
r_struct
id|task_struct
op_star
id|p
comma
r_char
op_star
id|name
comma
r_void
op_star
id|value
comma
r_int
id|size
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
id|u32
id|sid
suffix:semicolon
r_char
op_star
id|context
suffix:semicolon
r_int
id|len
suffix:semicolon
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
id|current
op_ne
id|p
)paren
(brace
id|error
op_assign
id|task_has_perm
c_func
(paren
id|current
comma
id|p
comma
id|PROCESS__GETATTR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|size
)paren
r_return
op_minus
id|ERANGE
suffix:semicolon
id|tsec
op_assign
id|p-&gt;security
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;current&quot;
)paren
)paren
id|sid
op_assign
id|tsec-&gt;sid
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;prev&quot;
)paren
)paren
id|sid
op_assign
id|tsec-&gt;osid
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;exec&quot;
)paren
)paren
id|sid
op_assign
id|tsec-&gt;exec_sid
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;fscreate&quot;
)paren
)paren
id|sid
op_assign
id|tsec-&gt;create_sid
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sid
)paren
r_return
l_int|0
suffix:semicolon
id|error
op_assign
id|security_sid_to_context
c_func
(paren
id|sid
comma
op_amp
id|context
comma
op_amp
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|size
)paren
(brace
id|kfree
c_func
(paren
id|context
)paren
suffix:semicolon
r_return
op_minus
id|ERANGE
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|value
comma
id|context
comma
id|len
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|context
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|selinux_setprocattr
r_static
r_int
id|selinux_setprocattr
c_func
(paren
r_struct
id|task_struct
op_star
id|p
comma
r_char
op_star
id|name
comma
r_void
op_star
id|value
comma
r_int
id|size
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
id|u32
id|sid
op_assign
l_int|0
suffix:semicolon
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
id|current
op_ne
id|p
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;current&quot;
)paren
)paren
(brace
multiline_comment|/* SELinux only allows a process to change its own&n;&t;&t;   security attributes, and it only allows the process&n;&t;&t;   current SID to change via exec. */
r_return
op_minus
id|EACCES
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Basic control over ability to set these attributes at all.&n;&t; * current == p, but we&squot;ll pass them separately in case the&n;&t; * above restriction is ever removed.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;exec&quot;
)paren
)paren
id|error
op_assign
id|task_has_perm
c_func
(paren
id|current
comma
id|p
comma
id|PROCESS__SETEXEC
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;fscreate&quot;
)paren
)paren
id|error
op_assign
id|task_has_perm
c_func
(paren
id|current
comma
id|p
comma
id|PROCESS__SETFSCREATE
)paren
suffix:semicolon
r_else
id|error
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
multiline_comment|/* Obtain a SID for the context, if one was specified. */
r_if
c_cond
(paren
id|size
)paren
(brace
r_int
id|error
suffix:semicolon
id|error
op_assign
id|security_context_to_sid
c_func
(paren
id|value
comma
id|size
comma
op_amp
id|sid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/* Permission checking based on the specified context is&n;&t;   performed during the actual operation (execve,&n;&t;   open/mkdir/...), when we know the full context of the&n;&t;   operation.  See selinux_bprm_set_security for the execve&n;&t;   checks and may_create for the file creation checks. The&n;&t;   operation will then fail if the context is not permitted. */
id|tsec
op_assign
id|p-&gt;security
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;exec&quot;
)paren
)paren
id|tsec-&gt;exec_sid
op_assign
id|sid
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|name
comma
l_string|&quot;fscreate&quot;
)paren
)paren
id|tsec-&gt;create_sid
op_assign
id|sid
suffix:semicolon
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|size
suffix:semicolon
)brace
DECL|variable|selinux_ops
r_struct
id|security_operations
id|selinux_ops
op_assign
(brace
dot
id|ptrace
op_assign
id|selinux_ptrace
comma
dot
id|capget
op_assign
id|selinux_capget
comma
dot
id|capset_check
op_assign
id|selinux_capset_check
comma
dot
id|capset_set
op_assign
id|selinux_capset_set
comma
dot
id|sysctl
op_assign
id|selinux_sysctl
comma
dot
id|capable
op_assign
id|selinux_capable
comma
dot
id|quotactl
op_assign
id|selinux_quotactl
comma
dot
id|quota_on
op_assign
id|selinux_quota_on
comma
dot
id|syslog
op_assign
id|selinux_syslog
comma
dot
id|vm_enough_memory
op_assign
id|selinux_vm_enough_memory
comma
dot
id|netlink_send
op_assign
id|selinux_netlink_send
comma
dot
id|netlink_recv
op_assign
id|selinux_netlink_recv
comma
dot
id|bprm_alloc_security
op_assign
id|selinux_bprm_alloc_security
comma
dot
id|bprm_free_security
op_assign
id|selinux_bprm_free_security
comma
dot
id|bprm_compute_creds
op_assign
id|selinux_bprm_compute_creds
comma
dot
id|bprm_set_security
op_assign
id|selinux_bprm_set_security
comma
dot
id|bprm_check_security
op_assign
id|selinux_bprm_check_security
comma
dot
id|bprm_secureexec
op_assign
id|selinux_bprm_secureexec
comma
dot
id|sb_alloc_security
op_assign
id|selinux_sb_alloc_security
comma
dot
id|sb_free_security
op_assign
id|selinux_sb_free_security
comma
dot
id|sb_kern_mount
op_assign
id|selinux_sb_kern_mount
comma
dot
id|sb_statfs
op_assign
id|selinux_sb_statfs
comma
dot
id|sb_mount
op_assign
id|selinux_mount
comma
dot
id|sb_umount
op_assign
id|selinux_umount
comma
dot
id|inode_alloc_security
op_assign
id|selinux_inode_alloc_security
comma
dot
id|inode_free_security
op_assign
id|selinux_inode_free_security
comma
dot
id|inode_create
op_assign
id|selinux_inode_create
comma
dot
id|inode_post_create
op_assign
id|selinux_inode_post_create
comma
dot
id|inode_link
op_assign
id|selinux_inode_link
comma
dot
id|inode_post_link
op_assign
id|selinux_inode_post_link
comma
dot
id|inode_unlink
op_assign
id|selinux_inode_unlink
comma
dot
id|inode_symlink
op_assign
id|selinux_inode_symlink
comma
dot
id|inode_post_symlink
op_assign
id|selinux_inode_post_symlink
comma
dot
id|inode_mkdir
op_assign
id|selinux_inode_mkdir
comma
dot
id|inode_post_mkdir
op_assign
id|selinux_inode_post_mkdir
comma
dot
id|inode_rmdir
op_assign
id|selinux_inode_rmdir
comma
dot
id|inode_mknod
op_assign
id|selinux_inode_mknod
comma
dot
id|inode_post_mknod
op_assign
id|selinux_inode_post_mknod
comma
dot
id|inode_rename
op_assign
id|selinux_inode_rename
comma
dot
id|inode_post_rename
op_assign
id|selinux_inode_post_rename
comma
dot
id|inode_readlink
op_assign
id|selinux_inode_readlink
comma
dot
id|inode_follow_link
op_assign
id|selinux_inode_follow_link
comma
dot
id|inode_permission
op_assign
id|selinux_inode_permission
comma
dot
id|inode_setattr
op_assign
id|selinux_inode_setattr
comma
dot
id|inode_getattr
op_assign
id|selinux_inode_getattr
comma
dot
id|inode_setxattr
op_assign
id|selinux_inode_setxattr
comma
dot
id|inode_post_setxattr
op_assign
id|selinux_inode_post_setxattr
comma
dot
id|inode_getxattr
op_assign
id|selinux_inode_getxattr
comma
dot
id|inode_listxattr
op_assign
id|selinux_inode_listxattr
comma
dot
id|inode_removexattr
op_assign
id|selinux_inode_removexattr
comma
dot
id|inode_getsecurity
op_assign
id|selinux_inode_getsecurity
comma
dot
id|inode_setsecurity
op_assign
id|selinux_inode_setsecurity
comma
dot
id|inode_listsecurity
op_assign
id|selinux_inode_listsecurity
comma
dot
id|file_permission
op_assign
id|selinux_file_permission
comma
dot
id|file_alloc_security
op_assign
id|selinux_file_alloc_security
comma
dot
id|file_free_security
op_assign
id|selinux_file_free_security
comma
dot
id|file_ioctl
op_assign
id|selinux_file_ioctl
comma
dot
id|file_mmap
op_assign
id|selinux_file_mmap
comma
dot
id|file_mprotect
op_assign
id|selinux_file_mprotect
comma
dot
id|file_lock
op_assign
id|selinux_file_lock
comma
dot
id|file_fcntl
op_assign
id|selinux_file_fcntl
comma
dot
id|file_set_fowner
op_assign
id|selinux_file_set_fowner
comma
dot
id|file_send_sigiotask
op_assign
id|selinux_file_send_sigiotask
comma
dot
id|file_receive
op_assign
id|selinux_file_receive
comma
dot
id|task_create
op_assign
id|selinux_task_create
comma
dot
id|task_alloc_security
op_assign
id|selinux_task_alloc_security
comma
dot
id|task_free_security
op_assign
id|selinux_task_free_security
comma
dot
id|task_setuid
op_assign
id|selinux_task_setuid
comma
dot
id|task_post_setuid
op_assign
id|selinux_task_post_setuid
comma
dot
id|task_setgid
op_assign
id|selinux_task_setgid
comma
dot
id|task_setpgid
op_assign
id|selinux_task_setpgid
comma
dot
id|task_getpgid
op_assign
id|selinux_task_getpgid
comma
dot
id|task_getsid
op_assign
id|selinux_task_getsid
comma
dot
id|task_setgroups
op_assign
id|selinux_task_setgroups
comma
dot
id|task_setnice
op_assign
id|selinux_task_setnice
comma
dot
id|task_setrlimit
op_assign
id|selinux_task_setrlimit
comma
dot
id|task_setscheduler
op_assign
id|selinux_task_setscheduler
comma
dot
id|task_getscheduler
op_assign
id|selinux_task_getscheduler
comma
dot
id|task_kill
op_assign
id|selinux_task_kill
comma
dot
id|task_wait
op_assign
id|selinux_task_wait
comma
dot
id|task_prctl
op_assign
id|selinux_task_prctl
comma
dot
id|task_reparent_to_init
op_assign
id|selinux_task_reparent_to_init
comma
dot
id|task_to_inode
op_assign
id|selinux_task_to_inode
comma
dot
id|ipc_permission
op_assign
id|selinux_ipc_permission
comma
dot
id|msg_msg_alloc_security
op_assign
id|selinux_msg_msg_alloc_security
comma
dot
id|msg_msg_free_security
op_assign
id|selinux_msg_msg_free_security
comma
dot
id|msg_queue_alloc_security
op_assign
id|selinux_msg_queue_alloc_security
comma
dot
id|msg_queue_free_security
op_assign
id|selinux_msg_queue_free_security
comma
dot
id|msg_queue_associate
op_assign
id|selinux_msg_queue_associate
comma
dot
id|msg_queue_msgctl
op_assign
id|selinux_msg_queue_msgctl
comma
dot
id|msg_queue_msgsnd
op_assign
id|selinux_msg_queue_msgsnd
comma
dot
id|msg_queue_msgrcv
op_assign
id|selinux_msg_queue_msgrcv
comma
dot
id|shm_alloc_security
op_assign
id|selinux_shm_alloc_security
comma
dot
id|shm_free_security
op_assign
id|selinux_shm_free_security
comma
dot
id|shm_associate
op_assign
id|selinux_shm_associate
comma
dot
id|shm_shmctl
op_assign
id|selinux_shm_shmctl
comma
dot
id|shm_shmat
op_assign
id|selinux_shm_shmat
comma
dot
id|sem_alloc_security
op_assign
id|selinux_sem_alloc_security
comma
dot
id|sem_free_security
op_assign
id|selinux_sem_free_security
comma
dot
id|sem_associate
op_assign
id|selinux_sem_associate
comma
dot
id|sem_semctl
op_assign
id|selinux_sem_semctl
comma
dot
id|sem_semop
op_assign
id|selinux_sem_semop
comma
dot
id|register_security
op_assign
id|selinux_register_security
comma
dot
id|unregister_security
op_assign
id|selinux_unregister_security
comma
dot
id|d_instantiate
op_assign
id|selinux_d_instantiate
comma
dot
id|getprocattr
op_assign
id|selinux_getprocattr
comma
dot
id|setprocattr
op_assign
id|selinux_setprocattr
comma
macro_line|#ifdef CONFIG_SECURITY_NETWORK
dot
id|unix_stream_connect
op_assign
id|selinux_socket_unix_stream_connect
comma
dot
id|unix_may_send
op_assign
id|selinux_socket_unix_may_send
comma
dot
id|socket_create
op_assign
id|selinux_socket_create
comma
dot
id|socket_post_create
op_assign
id|selinux_socket_post_create
comma
dot
id|socket_bind
op_assign
id|selinux_socket_bind
comma
dot
id|socket_connect
op_assign
id|selinux_socket_connect
comma
dot
id|socket_listen
op_assign
id|selinux_socket_listen
comma
dot
id|socket_accept
op_assign
id|selinux_socket_accept
comma
dot
id|socket_sendmsg
op_assign
id|selinux_socket_sendmsg
comma
dot
id|socket_recvmsg
op_assign
id|selinux_socket_recvmsg
comma
dot
id|socket_getsockname
op_assign
id|selinux_socket_getsockname
comma
dot
id|socket_getpeername
op_assign
id|selinux_socket_getpeername
comma
dot
id|socket_getsockopt
op_assign
id|selinux_socket_getsockopt
comma
dot
id|socket_setsockopt
op_assign
id|selinux_socket_setsockopt
comma
dot
id|socket_shutdown
op_assign
id|selinux_socket_shutdown
comma
macro_line|#endif
)brace
suffix:semicolon
DECL|function|selinux_init
id|__init
r_int
id|selinux_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|task_security_struct
op_star
id|tsec
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;SELinux:  Initializing.&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Set the security state for the initial task. */
r_if
c_cond
(paren
id|task_alloc_security
c_func
(paren
id|current
)paren
)paren
id|panic
c_func
(paren
l_string|&quot;SELinux:  Failed to initialize initial task.&bslash;n&quot;
)paren
suffix:semicolon
id|tsec
op_assign
id|current-&gt;security
suffix:semicolon
id|tsec-&gt;osid
op_assign
id|tsec-&gt;sid
op_assign
id|SECINITSID_KERNEL
suffix:semicolon
id|avc_init
c_func
(paren
)paren
suffix:semicolon
id|original_ops
op_assign
id|secondary_ops
op_assign
id|security_ops
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|secondary_ops
)paren
id|panic
(paren
l_string|&quot;SELinux: No initial security operations&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|register_security
(paren
op_amp
id|selinux_ops
)paren
)paren
id|panic
c_func
(paren
l_string|&quot;SELinux: Unable to register with kernel.&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|selinux_enforcing
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;SELinux:  Starting in enforcing mode&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;SELinux:  Starting in permissive mode&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|selinux_complete_init
r_void
id|selinux_complete_init
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;SELinux:  Completing initialization.&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Set up any superblocks initialized prior to the policy load. */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;SELinux:  Setting up existing superblocks.&bslash;n&quot;
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|sb_security_lock
)paren
suffix:semicolon
id|next_sb
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|superblock_security_head
)paren
)paren
(brace
r_struct
id|superblock_security_struct
op_star
id|sbsec
op_assign
id|list_entry
c_func
(paren
id|superblock_security_head.next
comma
r_struct
id|superblock_security_struct
comma
id|list
)paren
suffix:semicolon
r_struct
id|super_block
op_star
id|sb
op_assign
id|sbsec-&gt;sb
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|sb_lock
)paren
suffix:semicolon
id|sb-&gt;s_count
op_increment
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|sb_lock
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|sb_security_lock
)paren
suffix:semicolon
id|down_read
c_func
(paren
op_amp
id|sb-&gt;s_umount
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb-&gt;s_root
)paren
id|superblock_doinit
c_func
(paren
id|sb
)paren
suffix:semicolon
id|drop_super
c_func
(paren
id|sb
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|sb_security_lock
)paren
suffix:semicolon
id|list_del_init
c_func
(paren
op_amp
id|sbsec-&gt;list
)paren
suffix:semicolon
r_goto
id|next_sb
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|sb_security_lock
)paren
suffix:semicolon
multiline_comment|/* Set up any inodes initialized prior to the policy load. */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;SELinux:  Setting up existing inodes.&bslash;n&quot;
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|inode_security_lock
)paren
suffix:semicolon
id|next_inode
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|inode_security_head
)paren
)paren
(brace
r_struct
id|inode_security_struct
op_star
id|isec
op_assign
id|list_entry
c_func
(paren
id|inode_security_head.next
comma
r_struct
id|inode_security_struct
comma
id|list
)paren
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|isec-&gt;inode
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|inode_security_lock
)paren
suffix:semicolon
id|inode
op_assign
id|igrab
c_func
(paren
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inode
)paren
(brace
id|inode_doinit
c_func
(paren
id|inode
)paren
suffix:semicolon
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
)brace
id|spin_lock
c_func
(paren
op_amp
id|inode_security_lock
)paren
suffix:semicolon
id|list_del_init
c_func
(paren
op_amp
id|isec-&gt;list
)paren
suffix:semicolon
r_goto
id|next_inode
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|inode_security_lock
)paren
suffix:semicolon
)brace
multiline_comment|/* SELinux requires early initialization in order to label&n;   all processes and objects when they are created. */
DECL|variable|selinux_init
id|security_initcall
c_func
(paren
id|selinux_init
)paren
suffix:semicolon
eof
