multiline_comment|/*&n; * Netlink message type permission tables, for user generated messages.&n; *&n; * Author: James Morris &lt;jmorris@redhat.com&gt;&n; *&n; * Copyright (C) 2004 Red Hat, Inc., James Morris &lt;jmorris@redhat.com&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2,&n; * as published by the Free Software Foundation.&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/netlink.h&gt;
macro_line|#include &lt;linux/rtnetlink.h&gt;
macro_line|#include &lt;linux/if.h&gt;
macro_line|#include &lt;linux/netfilter_ipv4/ip_queue.h&gt;
macro_line|#include &lt;linux/tcp_diag.h&gt;
macro_line|#include &lt;linux/xfrm.h&gt;
macro_line|#include &lt;linux/audit.h&gt;
macro_line|#include &quot;flask.h&quot;
macro_line|#include &quot;av_permissions.h&quot;
DECL|struct|nlmsg_perm
r_struct
id|nlmsg_perm
(brace
DECL|member|nlmsg_type
id|u16
id|nlmsg_type
suffix:semicolon
DECL|member|perm
id|u32
id|perm
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|nlmsg_route_perms
r_static
r_struct
id|nlmsg_perm
id|nlmsg_route_perms
(braket
)braket
op_assign
(brace
(brace
id|RTM_NEWLINK
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|RTM_DELLINK
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|RTM_GETLINK
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_READ
)brace
comma
(brace
id|RTM_SETLINK
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|RTM_NEWADDR
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|RTM_DELADDR
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|RTM_GETADDR
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_READ
)brace
comma
(brace
id|RTM_NEWROUTE
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|RTM_DELROUTE
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|RTM_GETROUTE
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_READ
)brace
comma
(brace
id|RTM_NEWNEIGH
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|RTM_DELNEIGH
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|RTM_GETNEIGH
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_READ
)brace
comma
(brace
id|RTM_NEWRULE
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|RTM_DELRULE
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|RTM_GETRULE
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_READ
)brace
comma
(brace
id|RTM_NEWQDISC
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|RTM_DELQDISC
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|RTM_GETQDISC
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_READ
)brace
comma
(brace
id|RTM_NEWTCLASS
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|RTM_DELTCLASS
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|RTM_GETTCLASS
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_READ
)brace
comma
(brace
id|RTM_NEWTFILTER
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|RTM_DELTFILTER
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|RTM_GETTFILTER
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_READ
)brace
comma
(brace
id|RTM_NEWACTION
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|RTM_DELACTION
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|RTM_GETACTION
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_READ
)brace
comma
(brace
id|RTM_NEWPREFIX
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|RTM_GETPREFIX
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_READ
)brace
comma
(brace
id|RTM_GETMULTICAST
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_READ
)brace
comma
(brace
id|RTM_GETANYCAST
comma
id|NETLINK_ROUTE_SOCKET__NLMSG_READ
)brace
comma
)brace
suffix:semicolon
DECL|variable|nlmsg_firewall_perms
r_static
r_struct
id|nlmsg_perm
id|nlmsg_firewall_perms
(braket
)braket
op_assign
(brace
(brace
id|IPQM_MODE
comma
id|NETLINK_FIREWALL_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|IPQM_VERDICT
comma
id|NETLINK_FIREWALL_SOCKET__NLMSG_WRITE
)brace
comma
)brace
suffix:semicolon
DECL|variable|nlmsg_tcpdiag_perms
r_static
r_struct
id|nlmsg_perm
id|nlmsg_tcpdiag_perms
(braket
)braket
op_assign
(brace
(brace
id|TCPDIAG_GETSOCK
comma
id|NETLINK_TCPDIAG_SOCKET__NLMSG_READ
)brace
comma
)brace
suffix:semicolon
DECL|variable|nlmsg_xfrm_perms
r_static
r_struct
id|nlmsg_perm
id|nlmsg_xfrm_perms
(braket
)braket
op_assign
(brace
(brace
id|XFRM_MSG_NEWSA
comma
id|NETLINK_XFRM_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|XFRM_MSG_DELSA
comma
id|NETLINK_XFRM_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|XFRM_MSG_GETSA
comma
id|NETLINK_XFRM_SOCKET__NLMSG_READ
)brace
comma
(brace
id|XFRM_MSG_NEWPOLICY
comma
id|NETLINK_XFRM_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|XFRM_MSG_DELPOLICY
comma
id|NETLINK_XFRM_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|XFRM_MSG_GETPOLICY
comma
id|NETLINK_XFRM_SOCKET__NLMSG_READ
)brace
comma
(brace
id|XFRM_MSG_ALLOCSPI
comma
id|NETLINK_XFRM_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|XFRM_MSG_UPDPOLICY
comma
id|NETLINK_XFRM_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|XFRM_MSG_UPDSA
comma
id|NETLINK_XFRM_SOCKET__NLMSG_WRITE
)brace
comma
)brace
suffix:semicolon
DECL|variable|nlmsg_audit_perms
r_static
r_struct
id|nlmsg_perm
id|nlmsg_audit_perms
(braket
)braket
op_assign
(brace
(brace
id|AUDIT_GET
comma
id|NETLINK_AUDIT_SOCKET__NLMSG_READ
)brace
comma
(brace
id|AUDIT_SET
comma
id|NETLINK_AUDIT_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|AUDIT_LIST
comma
id|NETLINK_AUDIT_SOCKET__NLMSG_READ
)brace
comma
(brace
id|AUDIT_ADD
comma
id|NETLINK_AUDIT_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|AUDIT_DEL
comma
id|NETLINK_AUDIT_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|AUDIT_USER
comma
id|NETLINK_AUDIT_SOCKET__NLMSG_WRITE
)brace
comma
(brace
id|AUDIT_LOGIN
comma
id|NETLINK_AUDIT_SOCKET__NLMSG_WRITE
)brace
comma
)brace
suffix:semicolon
DECL|function|nlmsg_perm
r_static
r_int
id|nlmsg_perm
c_func
(paren
id|u16
id|nlmsg_type
comma
id|u32
op_star
id|perm
comma
r_struct
id|nlmsg_perm
op_star
id|tab
comma
r_int
id|tabsize
)paren
(brace
r_int
id|i
comma
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|tabsize
op_div
r_sizeof
(paren
r_struct
id|nlmsg_perm
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|nlmsg_type
op_eq
id|tab
(braket
id|i
)braket
dot
id|nlmsg_type
)paren
(brace
op_star
id|perm
op_assign
id|tab
(braket
id|i
)braket
dot
id|perm
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|selinux_nlmsg_lookup
r_int
id|selinux_nlmsg_lookup
c_func
(paren
id|u16
id|sclass
comma
id|u16
id|nlmsg_type
comma
id|u32
op_star
id|perm
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|sclass
)paren
(brace
r_case
id|SECCLASS_NETLINK_ROUTE_SOCKET
suffix:colon
id|err
op_assign
id|nlmsg_perm
c_func
(paren
id|nlmsg_type
comma
id|perm
comma
id|nlmsg_route_perms
comma
r_sizeof
(paren
id|nlmsg_route_perms
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SECCLASS_NETLINK_FIREWALL_SOCKET
suffix:colon
r_case
id|NETLINK_IP6_FW
suffix:colon
id|err
op_assign
id|nlmsg_perm
c_func
(paren
id|nlmsg_type
comma
id|perm
comma
id|nlmsg_firewall_perms
comma
r_sizeof
(paren
id|nlmsg_firewall_perms
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SECCLASS_NETLINK_TCPDIAG_SOCKET
suffix:colon
id|err
op_assign
id|nlmsg_perm
c_func
(paren
id|nlmsg_type
comma
id|perm
comma
id|nlmsg_tcpdiag_perms
comma
r_sizeof
(paren
id|nlmsg_tcpdiag_perms
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SECCLASS_NETLINK_XFRM_SOCKET
suffix:colon
id|err
op_assign
id|nlmsg_perm
c_func
(paren
id|nlmsg_type
comma
id|perm
comma
id|nlmsg_xfrm_perms
comma
r_sizeof
(paren
id|nlmsg_xfrm_perms
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SECCLASS_NETLINK_AUDIT_SOCKET
suffix:colon
id|err
op_assign
id|nlmsg_perm
c_func
(paren
id|nlmsg_type
comma
id|perm
comma
id|nlmsg_audit_perms
comma
r_sizeof
(paren
id|nlmsg_audit_perms
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* No messaging from userspace, or class unknown/unhandled */
r_default
suffix:colon
id|err
op_assign
op_minus
id|ENOENT
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
eof
