multiline_comment|/*&n; * mips32_cache.h&n; *&n; * Carsten Langgaard, carstenl@mips.com&n; * Copyright (C) 2000 MIPS Technologies, Inc.  All rights reserved.&n; *&n; * ########################################################################&n; *&n; *  This program is free software; you can distribute it and/or modify it&n; *  under the terms of the GNU General Public License (Version 2) as&n; *  published by the Free Software Foundation.&n; *&n; *  This program is distributed in the hope it will be useful, but WITHOUT&n; *  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or&n; *  FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License&n; *  for more details.&n; *&n; *  You should have received a copy of the GNU General Public License along&n; *  with this program; if not, write to the Free Software Foundation, Inc.,&n; *  59 Temple Place - Suite 330, Boston MA 02111-1307, USA.&n; *&n; * ########################################################################&n; *&n; * Inline assembly cache operations.&n; * &n; * This file is the original r4cache.c file with modification that makes the&n; * cache handling more generic.&n; *&n; * FIXME: Handle split L2 caches.&n; *&n; */
macro_line|#ifndef _MIPS_R4KCACHE_H
DECL|macro|_MIPS_R4KCACHE_H
mdefine_line|#define _MIPS_R4KCACHE_H
macro_line|#include &lt;asm/asm.h&gt;
macro_line|#include &lt;asm/cacheops.h&gt;
DECL|function|flush_icache_line_indexed
r_extern
r_inline
r_void
id|flush_icache_line_indexed
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;.set noreorder&bslash;n&bslash;t&quot;
l_string|&quot;.set mips3&bslash;n&bslash;t&quot;
l_string|&quot;cache %1, (%0)&bslash;n&bslash;t&quot;
l_string|&quot;.set mips0&bslash;n&bslash;t&quot;
l_string|&quot;.set reorder&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
)paren
comma
l_string|&quot;i&quot;
(paren
id|Index_Invalidate_I
)paren
)paren
suffix:semicolon
)brace
DECL|function|flush_dcache_line_indexed
r_extern
r_inline
r_void
id|flush_dcache_line_indexed
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;.set noreorder&bslash;n&bslash;t&quot;
l_string|&quot;.set mips3&bslash;n&bslash;t&quot;
l_string|&quot;cache %1, (%0)&bslash;n&bslash;t&quot;
l_string|&quot;.set mips0&bslash;n&bslash;t&quot;
l_string|&quot;.set reorder&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
)paren
comma
l_string|&quot;i&quot;
(paren
id|Index_Writeback_Inv_D
)paren
)paren
suffix:semicolon
)brace
DECL|function|flush_scache_line_indexed
r_extern
r_inline
r_void
id|flush_scache_line_indexed
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;.set noreorder&bslash;n&bslash;t&quot;
l_string|&quot;.set mips3&bslash;n&bslash;t&quot;
l_string|&quot;cache %1, (%0)&bslash;n&bslash;t&quot;
l_string|&quot;.set mips0&bslash;n&bslash;t&quot;
l_string|&quot;.set reorder&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
)paren
comma
l_string|&quot;i&quot;
(paren
id|Index_Writeback_Inv_SD
)paren
)paren
suffix:semicolon
)brace
DECL|function|flush_icache_line
r_extern
r_inline
r_void
id|flush_icache_line
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;.set noreorder&bslash;n&bslash;t&quot;
l_string|&quot;.set mips3&bslash;n&bslash;t&quot;
l_string|&quot;cache %1, (%0)&bslash;n&bslash;t&quot;
l_string|&quot;.set mips0&bslash;n&bslash;t&quot;
l_string|&quot;.set reorder&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
)paren
comma
l_string|&quot;i&quot;
(paren
id|Hit_Invalidate_I
)paren
)paren
suffix:semicolon
)brace
DECL|function|flush_dcache_line
r_extern
r_inline
r_void
id|flush_dcache_line
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;.set noreorder&bslash;n&bslash;t&quot;
l_string|&quot;.set mips3&bslash;n&bslash;t&quot;
l_string|&quot;cache %1, (%0)&bslash;n&bslash;t&quot;
l_string|&quot;.set mips0&bslash;n&bslash;t&quot;
l_string|&quot;.set reorder&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
)paren
comma
l_string|&quot;i&quot;
(paren
id|Hit_Writeback_Inv_D
)paren
)paren
suffix:semicolon
)brace
DECL|function|invalidate_dcache_line
r_extern
r_inline
r_void
id|invalidate_dcache_line
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;.set noreorder&bslash;n&bslash;t&quot;
l_string|&quot;.set mips3&bslash;n&bslash;t&quot;
l_string|&quot;cache %1, (%0)&bslash;n&bslash;t&quot;
l_string|&quot;.set mips0&bslash;n&bslash;t&quot;
l_string|&quot;.set reorder&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
)paren
comma
l_string|&quot;i&quot;
(paren
id|Hit_Invalidate_D
)paren
)paren
suffix:semicolon
)brace
DECL|function|invalidate_scache_line
r_extern
r_inline
r_void
id|invalidate_scache_line
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;.set noreorder&bslash;n&bslash;t&quot;
l_string|&quot;.set mips3&bslash;n&bslash;t&quot;
l_string|&quot;cache %1, (%0)&bslash;n&bslash;t&quot;
l_string|&quot;.set mips0&bslash;n&bslash;t&quot;
l_string|&quot;.set reorder&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
)paren
comma
l_string|&quot;i&quot;
(paren
id|Hit_Invalidate_SD
)paren
)paren
suffix:semicolon
)brace
DECL|function|flush_scache_line
r_extern
r_inline
r_void
id|flush_scache_line
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;.set noreorder&bslash;n&bslash;t&quot;
l_string|&quot;.set mips3&bslash;n&bslash;t&quot;
l_string|&quot;cache %1, (%0)&bslash;n&bslash;t&quot;
l_string|&quot;.set mips0&bslash;n&bslash;t&quot;
l_string|&quot;.set reorder&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
)paren
comma
l_string|&quot;i&quot;
(paren
id|Hit_Writeback_Inv_SD
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * The next two are for badland addresses like signal trampolines.&n; */
DECL|function|protected_flush_icache_line
r_extern
r_inline
r_void
id|protected_flush_icache_line
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;.set noreorder&bslash;n&bslash;t&quot;
l_string|&quot;.set mips3&bslash;n&quot;
l_string|&quot;1:&bslash;tcache %1,(%0)&bslash;n&quot;
l_string|&quot;2:&bslash;t.set mips0&bslash;n&bslash;t&quot;
l_string|&quot;.set reorder&bslash;n&bslash;t&quot;
l_string|&quot;.section&bslash;t__ex_table,&bslash;&quot;a&bslash;&quot;&bslash;n&bslash;t&quot;
id|STR
c_func
(paren
id|PTR
)paren
l_string|&quot;&bslash;t1b,2b&bslash;n&bslash;t&quot;
l_string|&quot;.previous&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
)paren
comma
l_string|&quot;i&quot;
(paren
id|Hit_Invalidate_I
)paren
)paren
suffix:semicolon
)brace
DECL|function|protected_writeback_dcache_line
r_extern
r_inline
r_void
id|protected_writeback_dcache_line
c_func
(paren
r_int
r_int
id|addr
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;.set noreorder&bslash;n&bslash;t&quot;
l_string|&quot;.set mips3&bslash;n&quot;
l_string|&quot;1:&bslash;tcache %1,(%0)&bslash;n&quot;
l_string|&quot;2:&bslash;t.set mips0&bslash;n&bslash;t&quot;
l_string|&quot;.set reorder&bslash;n&bslash;t&quot;
l_string|&quot;.section&bslash;t__ex_table,&bslash;&quot;a&bslash;&quot;&bslash;n&bslash;t&quot;
id|STR
c_func
(paren
id|PTR
)paren
l_string|&quot;&bslash;t1b,2b&bslash;n&bslash;t&quot;
l_string|&quot;.previous&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
)paren
comma
l_string|&quot;i&quot;
(paren
id|Hit_Writeback_D
)paren
)paren
suffix:semicolon
)brace
DECL|macro|cache_unroll
mdefine_line|#define cache_unroll(base,op)&t;        &t;&bslash;&n;&t;__asm__ __volatile__(&quot;&t;         &t;&bslash;&n;&t;&t;.set noreorder;&t;&t;        &bslash;&n;&t;&t;.set mips3;&t;&t;        &bslash;&n;                cache %1, (%0);&t;                &bslash;&n;&t;&t;.set mips0;&t;&t;&t;&bslash;&n;&t;&t;.set reorder&quot;&t;&t;&t;&bslash;&n;&t;&t;:&t;&t;&t;&t;&bslash;&n;&t;&t;: &quot;r&quot; (base),&t;&t;&t;&bslash;&n;&t;&t;  &quot;i&quot; (op));
DECL|function|blast_dcache
r_extern
r_inline
r_void
id|blast_dcache
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|start
op_assign
id|KSEG0
suffix:semicolon
r_int
r_int
id|end
op_assign
(paren
id|start
op_plus
id|dcache_size
)paren
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|cache_unroll
c_func
(paren
id|start
comma
id|Index_Writeback_Inv_D
)paren
suffix:semicolon
id|start
op_add_assign
id|dc_lsize
suffix:semicolon
)brace
)brace
DECL|function|blast_dcache_page
r_extern
r_inline
r_void
id|blast_dcache_page
c_func
(paren
r_int
r_int
id|page
)paren
(brace
r_int
r_int
id|start
op_assign
id|page
suffix:semicolon
r_int
r_int
id|end
op_assign
(paren
id|start
op_plus
id|PAGE_SIZE
)paren
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|cache_unroll
c_func
(paren
id|start
comma
id|Hit_Writeback_Inv_D
)paren
suffix:semicolon
id|start
op_add_assign
id|dc_lsize
suffix:semicolon
)brace
)brace
DECL|function|blast_dcache_page_indexed
r_extern
r_inline
r_void
id|blast_dcache_page_indexed
c_func
(paren
r_int
r_int
id|page
)paren
(brace
r_int
r_int
id|start
op_assign
id|page
suffix:semicolon
r_int
r_int
id|end
op_assign
(paren
id|start
op_plus
id|PAGE_SIZE
)paren
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|cache_unroll
c_func
(paren
id|start
comma
id|Index_Writeback_Inv_D
)paren
suffix:semicolon
id|start
op_add_assign
id|dc_lsize
suffix:semicolon
)brace
)brace
DECL|function|blast_icache
r_extern
r_inline
r_void
id|blast_icache
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|start
op_assign
id|KSEG0
suffix:semicolon
r_int
r_int
id|end
op_assign
(paren
id|start
op_plus
id|icache_size
)paren
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|cache_unroll
c_func
(paren
id|start
comma
id|Index_Invalidate_I
)paren
suffix:semicolon
id|start
op_add_assign
id|ic_lsize
suffix:semicolon
)brace
)brace
DECL|function|blast_icache_page
r_extern
r_inline
r_void
id|blast_icache_page
c_func
(paren
r_int
r_int
id|page
)paren
(brace
r_int
r_int
id|start
op_assign
id|page
suffix:semicolon
r_int
r_int
id|end
op_assign
(paren
id|start
op_plus
id|PAGE_SIZE
)paren
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|cache_unroll
c_func
(paren
id|start
comma
id|Hit_Invalidate_I
)paren
suffix:semicolon
id|start
op_add_assign
id|ic_lsize
suffix:semicolon
)brace
)brace
DECL|function|blast_icache_page_indexed
r_extern
r_inline
r_void
id|blast_icache_page_indexed
c_func
(paren
r_int
r_int
id|page
)paren
(brace
r_int
r_int
id|start
op_assign
id|page
suffix:semicolon
r_int
r_int
id|end
op_assign
(paren
id|start
op_plus
id|PAGE_SIZE
)paren
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|cache_unroll
c_func
(paren
id|start
comma
id|Index_Invalidate_I
)paren
suffix:semicolon
id|start
op_add_assign
id|ic_lsize
suffix:semicolon
)brace
)brace
DECL|function|blast_scache
r_extern
r_inline
r_void
id|blast_scache
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|start
op_assign
id|KSEG0
suffix:semicolon
r_int
r_int
id|end
op_assign
id|KSEG0
op_plus
id|scache_size
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|cache_unroll
c_func
(paren
id|start
comma
id|Index_Writeback_Inv_SD
)paren
suffix:semicolon
id|start
op_add_assign
id|sc_lsize
suffix:semicolon
)brace
)brace
DECL|function|blast_scache_page
r_extern
r_inline
r_void
id|blast_scache_page
c_func
(paren
r_int
r_int
id|page
)paren
(brace
r_int
r_int
id|start
op_assign
id|page
suffix:semicolon
r_int
r_int
id|end
op_assign
id|page
op_plus
id|PAGE_SIZE
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|cache_unroll
c_func
(paren
id|start
comma
id|Hit_Writeback_Inv_SD
)paren
suffix:semicolon
id|start
op_add_assign
id|sc_lsize
suffix:semicolon
)brace
)brace
DECL|function|blast_scache_page_indexed
r_extern
r_inline
r_void
id|blast_scache_page_indexed
c_func
(paren
r_int
r_int
id|page
)paren
(brace
r_int
r_int
id|start
op_assign
id|page
suffix:semicolon
r_int
r_int
id|end
op_assign
id|page
op_plus
id|PAGE_SIZE
suffix:semicolon
r_while
c_loop
(paren
id|start
OL
id|end
)paren
(brace
id|cache_unroll
c_func
(paren
id|start
comma
id|Index_Writeback_Inv_SD
)paren
suffix:semicolon
id|start
op_add_assign
id|sc_lsize
suffix:semicolon
)brace
)brace
macro_line|#endif /* !(_MIPS_R4KCACHE_H) */
eof
