multiline_comment|/* Hook for machine specific memory setup.&n; *&n; * This is included late in kernel/setup.c so that it can make use of all of&n; * the static functions. */
DECL|macro|MB
mdefine_line|#define MB (1024 * 1024)
DECL|variable|sgivwfb_mem_phys
r_int
r_int
id|sgivwfb_mem_phys
suffix:semicolon
DECL|variable|sgivwfb_mem_size
r_int
r_int
id|sgivwfb_mem_size
suffix:semicolon
DECL|variable|__initdata
r_int
r_int
id|mem_size
id|__initdata
op_assign
l_int|0
suffix:semicolon
DECL|function|machine_specific_memory_setup
r_static
r_inline
r_char
op_star
id|__init
id|machine_specific_memory_setup
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|gfx_mem_size
op_assign
l_int|8
op_star
id|MB
suffix:semicolon
id|mem_size
op_assign
id|ALT_MEM_K
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem_size
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Bootloader didn&squot;t set memory size, upgrade it !&bslash;n&quot;
)paren
suffix:semicolon
id|mem_size
op_assign
l_int|128
op_star
id|MB
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * this hardcodes the graphics memory to 8 MB&n;&t; * it really should be sized dynamically (or at least&n;&t; * set as a boot param)&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|sgivwfb_mem_size
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Defaulting to 8 MB framebuffer size&bslash;n&quot;
)paren
suffix:semicolon
id|sgivwfb_mem_size
op_assign
l_int|8
op_star
id|MB
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Trim to nearest MB&n;&t; */
id|sgivwfb_mem_size
op_and_assign
op_complement
(paren
(paren
l_int|1
op_lshift
l_int|20
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|sgivwfb_mem_phys
op_assign
id|mem_size
op_minus
id|gfx_mem_size
suffix:semicolon
id|add_memory_region
c_func
(paren
l_int|0
comma
id|LOWMEMSIZE
c_func
(paren
)paren
comma
id|E820_RAM
)paren
suffix:semicolon
id|add_memory_region
c_func
(paren
id|HIGH_MEMORY
comma
id|mem_size
op_minus
id|sgivwfb_mem_size
op_minus
id|HIGH_MEMORY
comma
id|E820_RAM
)paren
suffix:semicolon
id|add_memory_region
c_func
(paren
id|sgivwfb_mem_phys
comma
id|sgivwfb_mem_size
comma
id|E820_RESERVED
)paren
suffix:semicolon
r_return
l_string|&quot;PROM&quot;
suffix:semicolon
multiline_comment|/* Remove gcc warnings */
(paren
r_void
)paren
id|sanitize_e820_map
c_func
(paren
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
(paren
r_void
)paren
id|copy_e820_map
c_func
(paren
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
eof
