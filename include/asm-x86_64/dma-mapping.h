macro_line|#ifndef _X8664_DMA_MAPPING_H
DECL|macro|_X8664_DMA_MAPPING_H
mdefine_line|#define _X8664_DMA_MAPPING_H 1
multiline_comment|/*&n; * IOMMU interface. See Documentation/DMA-mapping.txt and DMA-API.txt for&n; * documentation.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/device.h&gt;
macro_line|#include &lt;asm/scatterlist.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/swiotlb.h&gt;
r_extern
id|dma_addr_t
id|bad_dma_address
suffix:semicolon
DECL|macro|dma_mapping_error
mdefine_line|#define dma_mapping_error(x) &bslash;&n;&t;(swiotlb ? swiotlb_dma_mapping_error(x) : ((x) == bad_dma_address))
r_void
op_star
id|dma_alloc_coherent
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
id|size
comma
id|dma_addr_t
op_star
id|dma_handle
comma
r_int
id|gfp
)paren
suffix:semicolon
r_void
id|dma_free_coherent
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_int
id|size
comma
r_void
op_star
id|vaddr
comma
id|dma_addr_t
id|dma_handle
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_GART_IOMMU
r_extern
id|dma_addr_t
id|dma_map_single
c_func
(paren
r_struct
id|device
op_star
id|hwdev
comma
r_void
op_star
id|ptr
comma
r_int
id|size
comma
r_int
id|direction
)paren
suffix:semicolon
r_extern
r_void
id|dma_unmap_single
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|dma_addr_t
id|addr
comma
r_int
id|size
comma
r_int
id|direction
)paren
suffix:semicolon
macro_line|#else
multiline_comment|/* No IOMMU */
DECL|function|dma_map_single
r_static
r_inline
id|dma_addr_t
id|dma_map_single
c_func
(paren
r_struct
id|device
op_star
id|hwdev
comma
r_void
op_star
id|ptr
comma
r_int
id|size
comma
r_int
id|direction
)paren
(brace
id|dma_addr_t
id|addr
suffix:semicolon
r_if
c_cond
(paren
id|direction
op_eq
id|DMA_NONE
)paren
id|out_of_line_bug
c_func
(paren
)paren
suffix:semicolon
id|addr
op_assign
id|virt_to_bus
c_func
(paren
id|ptr
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|addr
op_plus
id|size
)paren
op_amp
op_complement
op_star
id|hwdev-&gt;dma_mask
)paren
id|out_of_line_bug
c_func
(paren
)paren
suffix:semicolon
r_return
id|addr
suffix:semicolon
)brace
DECL|function|dma_unmap_single
r_static
r_inline
r_void
id|dma_unmap_single
c_func
(paren
r_struct
id|device
op_star
id|hwdev
comma
id|dma_addr_t
id|dma_addr
comma
r_int
id|size
comma
r_int
id|direction
)paren
(brace
r_if
c_cond
(paren
id|direction
op_eq
id|DMA_NONE
)paren
id|out_of_line_bug
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Nothing to do */
)brace
macro_line|#endif
DECL|macro|dma_map_page
mdefine_line|#define dma_map_page(dev,page,offset,size,dir) &bslash;&n;&t;dma_map_single((dev), page_address(page)+(offset), (size), (dir))
DECL|function|dma_sync_single_for_cpu
r_static
r_inline
r_void
id|dma_sync_single_for_cpu
c_func
(paren
r_struct
id|device
op_star
id|hwdev
comma
id|dma_addr_t
id|dma_handle
comma
r_int
id|size
comma
r_int
id|direction
)paren
(brace
r_if
c_cond
(paren
id|direction
op_eq
id|DMA_NONE
)paren
id|out_of_line_bug
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|swiotlb
)paren
r_return
id|swiotlb_sync_single_for_cpu
c_func
(paren
id|hwdev
comma
id|dma_handle
comma
id|size
comma
id|direction
)paren
suffix:semicolon
id|flush_write_buffers
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|dma_sync_single_for_device
r_static
r_inline
r_void
id|dma_sync_single_for_device
c_func
(paren
r_struct
id|device
op_star
id|hwdev
comma
id|dma_addr_t
id|dma_handle
comma
r_int
id|size
comma
r_int
id|direction
)paren
(brace
r_if
c_cond
(paren
id|direction
op_eq
id|DMA_NONE
)paren
id|out_of_line_bug
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|swiotlb
)paren
r_return
id|swiotlb_sync_single_for_device
c_func
(paren
id|hwdev
comma
id|dma_handle
comma
id|size
comma
id|direction
)paren
suffix:semicolon
id|flush_write_buffers
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|dma_sync_sg_for_cpu
r_static
r_inline
r_void
id|dma_sync_sg_for_cpu
c_func
(paren
r_struct
id|device
op_star
id|hwdev
comma
r_struct
id|scatterlist
op_star
id|sg
comma
r_int
id|nelems
comma
r_int
id|direction
)paren
(brace
r_if
c_cond
(paren
id|direction
op_eq
id|DMA_NONE
)paren
id|out_of_line_bug
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|swiotlb
)paren
r_return
id|swiotlb_sync_sg_for_cpu
c_func
(paren
id|hwdev
comma
id|sg
comma
id|nelems
comma
id|direction
)paren
suffix:semicolon
id|flush_write_buffers
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|dma_sync_sg_for_device
r_static
r_inline
r_void
id|dma_sync_sg_for_device
c_func
(paren
r_struct
id|device
op_star
id|hwdev
comma
r_struct
id|scatterlist
op_star
id|sg
comma
r_int
id|nelems
comma
r_int
id|direction
)paren
(brace
r_if
c_cond
(paren
id|direction
op_eq
id|DMA_NONE
)paren
id|out_of_line_bug
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|swiotlb
)paren
r_return
id|swiotlb_sync_sg_for_device
c_func
(paren
id|hwdev
comma
id|sg
comma
id|nelems
comma
id|direction
)paren
suffix:semicolon
id|flush_write_buffers
c_func
(paren
)paren
suffix:semicolon
)brace
r_extern
r_int
id|dma_map_sg
c_func
(paren
r_struct
id|device
op_star
id|hwdev
comma
r_struct
id|scatterlist
op_star
id|sg
comma
r_int
id|nents
comma
r_int
id|direction
)paren
suffix:semicolon
r_extern
r_void
id|dma_unmap_sg
c_func
(paren
r_struct
id|device
op_star
id|hwdev
comma
r_struct
id|scatterlist
op_star
id|sg
comma
r_int
id|nents
comma
r_int
id|direction
)paren
suffix:semicolon
DECL|macro|dma_unmap_page
mdefine_line|#define dma_unmap_page dma_unmap_single
r_extern
r_int
id|dma_supported
c_func
(paren
r_struct
id|device
op_star
id|hwdev
comma
id|u64
id|mask
)paren
suffix:semicolon
r_extern
r_int
id|dma_get_cache_alignment
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|macro|dma_is_consistent
mdefine_line|#define dma_is_consistent(h) 1
DECL|function|dma_set_mask
r_static
r_inline
r_int
id|dma_set_mask
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|u64
id|mask
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;dma_mask
op_logical_or
op_logical_neg
id|dma_supported
c_func
(paren
id|dev
comma
id|mask
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
op_star
id|dev-&gt;dma_mask
op_assign
id|mask
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dma_cache_sync
r_static
r_inline
r_void
id|dma_cache_sync
c_func
(paren
r_void
op_star
id|vaddr
comma
r_int
id|size
comma
r_enum
id|dma_data_direction
id|dir
)paren
(brace
id|flush_write_buffers
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
eof
