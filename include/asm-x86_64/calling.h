multiline_comment|/* Some macros to handle stack frames */
dot
id|macro
id|SAVE_ARGS
id|pushq
op_mod
id|rdi
id|pushq
op_mod
id|rsi
id|pushq
op_mod
id|rdx
id|pushq
op_mod
id|rcx
id|pushq
op_mod
id|rax
id|pushq
op_mod
id|r8
id|pushq
op_mod
id|r9
id|pushq
op_mod
id|r10
id|pushq
op_mod
id|r11
dot
id|endm
dot
id|macro
id|RESTORE_ARGS
id|popq
op_mod
id|r11
id|popq
op_mod
id|r10
id|popq
op_mod
id|r9
id|popq
op_mod
id|r8
id|popq
op_mod
id|rax
id|popq
op_mod
id|rcx
id|popq
op_mod
id|rdx
id|popq
op_mod
id|rsi
id|popq
op_mod
id|rdi
dot
id|endm
dot
id|macro
id|LOAD_ARGS
id|offset
id|movq
"&bslash;"
id|offset
c_func
(paren
op_mod
id|rsp
)paren
comma
op_mod
id|r11
id|movq
"&bslash;"
id|offset
op_plus
l_int|8
(paren
op_mod
id|rsp
)paren
comma
op_mod
id|r10
id|movq
"&bslash;"
id|offset
op_plus
l_int|16
(paren
op_mod
id|rsp
)paren
comma
op_mod
id|r9
id|movq
"&bslash;"
id|offset
op_plus
l_int|24
(paren
op_mod
id|rsp
)paren
comma
op_mod
id|r8
id|movq
"&bslash;"
id|offset
op_plus
l_int|40
(paren
op_mod
id|rsp
)paren
comma
op_mod
id|rcx
id|movq
"&bslash;"
id|offset
op_plus
l_int|48
(paren
op_mod
id|rsp
)paren
comma
op_mod
id|rdx
id|movq
"&bslash;"
id|offset
op_plus
l_int|56
(paren
op_mod
id|rsp
)paren
comma
op_mod
id|rsi
id|movq
"&bslash;"
id|offset
op_plus
l_int|64
(paren
op_mod
id|rsp
)paren
comma
op_mod
id|rdi
id|movq
"&bslash;"
id|offset
op_plus
l_int|72
(paren
op_mod
id|rsp
)paren
comma
op_mod
id|rax
dot
id|endm
dot
id|macro
id|SAVE_REST
id|pushq
op_mod
id|rbx
id|pushq
op_mod
id|rbp
id|pushq
op_mod
id|r12
id|pushq
op_mod
id|r13
id|pushq
op_mod
id|r14
id|pushq
op_mod
id|r15
dot
id|endm
dot
id|macro
id|RESTORE_REST
id|popq
op_mod
id|r15
id|popq
op_mod
id|r14
id|popq
op_mod
id|r13
id|popq
op_mod
id|r12
id|popq
op_mod
id|rbp
id|popq
op_mod
id|rbx
dot
id|endm
dot
id|macro
id|SAVE_ALL
id|SAVE_ARGS
id|SAVE_REST
dot
id|endm
dot
id|macro
id|RESTORE_ALL
id|RESTORE_REST
id|RESTORE_ARGS
dot
id|endm
id|R15
op_assign
l_int|0
id|R14
op_assign
l_int|8
id|R13
op_assign
l_int|16
id|R12
op_assign
l_int|24
id|RBP
op_assign
l_int|36
id|RBX
op_assign
l_int|40
multiline_comment|/* arguments: interrupts/non tracing syscalls only save upto here*/
id|R11
op_assign
l_int|48
id|R10
op_assign
l_int|56
id|R9
op_assign
l_int|64
id|R8
op_assign
l_int|72
id|RAX
op_assign
l_int|80
id|RCX
op_assign
l_int|88
id|RDX
op_assign
l_int|96
id|RSI
op_assign
l_int|104
id|RDI
op_assign
l_int|112
id|ORIG_RAX
op_assign
l_int|120
multiline_comment|/* = ERROR */
multiline_comment|/* end of arguments */
multiline_comment|/* cpu exception frame or undefined in case of fast syscall. */
id|RIP
op_assign
l_int|128
id|CS
op_assign
l_int|136
id|EFLAGS
op_assign
l_int|144
id|RSP
op_assign
l_int|152
id|SS
op_assign
l_int|160
id|ARGOFFSET
op_assign
id|R11
dot
id|macro
id|SYSRET32
dot
id|byte
l_int|0x0f
comma
l_int|0x07
dot
id|endm
dot
id|macro
id|SYSRET64
DECL|variable|x0f
dot
id|byte
l_int|0x48
comma
l_int|0x0f
comma
l_int|0x07
dot
id|endm
eof
