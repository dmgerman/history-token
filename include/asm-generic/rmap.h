macro_line|#ifndef _GENERIC_RMAP_H
DECL|macro|_GENERIC_RMAP_H
mdefine_line|#define _GENERIC_RMAP_H
multiline_comment|/*&n; * linux/include/asm-generic/rmap.h&n; *&n; * Architecture dependent parts of the reverse mapping code,&n; * this version should work for most architectures with a&n; * &squot;normal&squot; page table layout.&n; *&n; * We use the struct page of the page table page to find out&n; * the process and full address of a page table entry:&n; * - page-&gt;mapping points to the process&squot; mm_struct&n; * - page-&gt;index has the high bits of the address&n; * - the lower bits of the address are calculated from the&n; *   offset of the page table entry within the page table page&n; *&n; * For CONFIG_HIGHPTE, we need to represent the address of a pte in a&n; * scalar pte_addr_t.  The pfn of the pte&squot;s page is shifted left by PAGE_SIZE&n; * bits and is then ORed with the byte offset of the pte within its page.&n; *&n; * For CONFIG_HIGHMEM4G, the pte_addr_t is 32 bits.  20 for the pfn, 12 for&n; * the offset.&n; *&n; * For CONFIG_HIGHMEM64G, the pte_addr_t is 64 bits.  52 for the pfn, 12 for&n; * the offset.&n; */
macro_line|#include &lt;linux/mm.h&gt;
DECL|function|pgtable_add_rmap
r_static
r_inline
r_void
id|pgtable_add_rmap
c_func
(paren
r_struct
id|page
op_star
id|page
comma
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|address
)paren
(brace
macro_line|#ifdef BROKEN_PPC_PTE_ALLOC_ONE
multiline_comment|/* OK, so PPC calls pte_alloc() before mem_map[] is setup ... ;( */
r_extern
r_int
id|mem_init_done
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mem_init_done
)paren
r_return
suffix:semicolon
macro_line|#endif
id|page-&gt;mapping
op_assign
(paren
r_void
op_star
)paren
id|mm
suffix:semicolon
id|page-&gt;index
op_assign
id|address
op_amp
op_complement
(paren
(paren
id|PTRS_PER_PTE
op_star
id|PAGE_SIZE
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|inc_page_state
c_func
(paren
id|nr_page_table_pages
)paren
suffix:semicolon
)brace
DECL|function|pgtable_remove_rmap
r_static
r_inline
r_void
id|pgtable_remove_rmap
c_func
(paren
r_struct
id|page
op_star
id|page
)paren
(brace
id|page-&gt;mapping
op_assign
l_int|NULL
suffix:semicolon
id|page-&gt;index
op_assign
l_int|0
suffix:semicolon
id|dec_page_state
c_func
(paren
id|nr_page_table_pages
)paren
suffix:semicolon
)brace
DECL|function|ptep_to_mm
r_static
r_inline
r_struct
id|mm_struct
op_star
id|ptep_to_mm
c_func
(paren
id|pte_t
op_star
id|ptep
)paren
(brace
r_struct
id|page
op_star
id|page
op_assign
id|kmap_atomic_to_page
c_func
(paren
id|ptep
)paren
suffix:semicolon
r_return
(paren
r_struct
id|mm_struct
op_star
)paren
id|page-&gt;mapping
suffix:semicolon
)brace
DECL|function|ptep_to_address
r_static
r_inline
r_int
r_int
id|ptep_to_address
c_func
(paren
id|pte_t
op_star
id|ptep
)paren
(brace
r_struct
id|page
op_star
id|page
op_assign
id|kmap_atomic_to_page
c_func
(paren
id|ptep
)paren
suffix:semicolon
r_int
r_int
id|low_bits
suffix:semicolon
id|low_bits
op_assign
(paren
(paren
r_int
r_int
)paren
id|ptep
op_amp
op_complement
id|PAGE_MASK
)paren
op_star
id|PTRS_PER_PTE
suffix:semicolon
r_return
id|page-&gt;index
op_plus
id|low_bits
suffix:semicolon
)brace
macro_line|#if CONFIG_HIGHPTE
DECL|function|ptep_to_paddr
r_static
r_inline
id|pte_addr_t
id|ptep_to_paddr
c_func
(paren
id|pte_t
op_star
id|ptep
)paren
(brace
id|pte_addr_t
id|paddr
suffix:semicolon
id|paddr
op_assign
(paren
(paren
id|pte_addr_t
)paren
id|page_to_pfn
c_func
(paren
id|kmap_atomic_to_page
c_func
(paren
id|ptep
)paren
)paren
)paren
op_lshift
id|PAGE_SHIFT
suffix:semicolon
r_return
id|paddr
op_plus
(paren
id|pte_addr_t
)paren
(paren
(paren
r_int
r_int
)paren
id|ptep
op_amp
op_complement
id|PAGE_MASK
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|function|ptep_to_paddr
r_static
r_inline
id|pte_addr_t
id|ptep_to_paddr
c_func
(paren
id|pte_t
op_star
id|ptep
)paren
(brace
r_return
(paren
id|pte_addr_t
)paren
id|ptep
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifndef CONFIG_HIGHPTE
DECL|function|rmap_ptep_map
r_static
r_inline
id|pte_t
op_star
id|rmap_ptep_map
c_func
(paren
id|pte_addr_t
id|pte_paddr
)paren
(brace
r_return
(paren
id|pte_t
op_star
)paren
id|pte_paddr
suffix:semicolon
)brace
DECL|function|rmap_ptep_unmap
r_static
r_inline
r_void
id|rmap_ptep_unmap
c_func
(paren
id|pte_t
op_star
id|pte
)paren
(brace
r_return
suffix:semicolon
)brace
macro_line|#endif
macro_line|#endif /* _GENERIC_RMAP_H */
eof
