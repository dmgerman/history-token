macro_line|#ifndef __MACIO_ASIC_H__
DECL|macro|__MACIO_ASIC_H__
mdefine_line|#define __MACIO_ASIC_H__
macro_line|#include &lt;asm/of_device.h&gt;
r_extern
r_struct
id|bus_type
id|macio_bus_type
suffix:semicolon
multiline_comment|/* MacIO device driver is defined later */
r_struct
id|macio_driver
suffix:semicolon
r_struct
id|macio_chip
suffix:semicolon
DECL|macro|MACIO_DEV_COUNT_RESOURCES
mdefine_line|#define MACIO_DEV_COUNT_RESOURCES&t;8
DECL|macro|MACIO_DEV_COUNT_IRQS
mdefine_line|#define MACIO_DEV_COUNT_IRQS&t;&t;8
multiline_comment|/*&n; * the macio_bus structure is used to describe a &quot;virtual&quot; bus&n; * within a MacIO ASIC. It&squot;s typically provided by a macio_pci_asic&n; * PCI device, but could be provided differently as well (nubus&n; * machines using a fake OF tree).&n; *&n; * The pdev field can be NULL on non-PCI machines&n; */
DECL|struct|macio_bus
r_struct
id|macio_bus
(brace
DECL|member|chip
r_struct
id|macio_chip
op_star
id|chip
suffix:semicolon
multiline_comment|/* macio_chip (private use) */
DECL|member|index
r_int
id|index
suffix:semicolon
multiline_comment|/* macio chip index in system */
macro_line|#ifdef CONFIG_PCI
DECL|member|pdev
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
multiline_comment|/* PCI device hosting this bus */
macro_line|#endif
)brace
suffix:semicolon
multiline_comment|/*&n; * the macio_dev structure is used to describe a device&n; * within an Apple MacIO ASIC.&n; */
DECL|struct|macio_dev
r_struct
id|macio_dev
(brace
DECL|member|bus
r_struct
id|macio_bus
op_star
id|bus
suffix:semicolon
multiline_comment|/* macio bus this device is on */
DECL|member|media_bay
r_struct
id|macio_dev
op_star
id|media_bay
suffix:semicolon
multiline_comment|/* Device is part of a media bay */
DECL|member|ofdev
r_struct
id|of_device
id|ofdev
suffix:semicolon
DECL|member|n_resources
r_int
id|n_resources
suffix:semicolon
DECL|member|resource
r_struct
id|resource
id|resource
(braket
id|MACIO_DEV_COUNT_RESOURCES
)braket
suffix:semicolon
DECL|member|n_interrupts
r_int
id|n_interrupts
suffix:semicolon
DECL|member|interrupt
r_struct
id|resource
id|interrupt
(braket
id|MACIO_DEV_COUNT_IRQS
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|to_macio_device
mdefine_line|#define&t;to_macio_device(d) container_of(d, struct macio_dev, ofdev.dev)
DECL|macro|of_to_macio_device
mdefine_line|#define&t;of_to_macio_device(d) container_of(d, struct macio_dev, ofdev)
r_extern
r_struct
id|macio_dev
op_star
id|macio_dev_get
c_func
(paren
r_struct
id|macio_dev
op_star
id|dev
)paren
suffix:semicolon
r_extern
r_void
id|macio_dev_put
c_func
(paren
r_struct
id|macio_dev
op_star
id|dev
)paren
suffix:semicolon
multiline_comment|/*&n; * Accessors to resources &amp; interrupts and other device&n; * fields&n; */
DECL|function|macio_resource_count
r_static
r_inline
r_int
id|macio_resource_count
c_func
(paren
r_struct
id|macio_dev
op_star
id|dev
)paren
(brace
r_return
id|dev-&gt;n_resources
suffix:semicolon
)brace
DECL|function|macio_resource_start
r_static
r_inline
r_int
r_int
id|macio_resource_start
c_func
(paren
r_struct
id|macio_dev
op_star
id|dev
comma
r_int
id|resource_no
)paren
(brace
r_return
id|dev-&gt;resource
(braket
id|resource_no
)braket
dot
id|start
suffix:semicolon
)brace
DECL|function|macio_resource_end
r_static
r_inline
r_int
r_int
id|macio_resource_end
c_func
(paren
r_struct
id|macio_dev
op_star
id|dev
comma
r_int
id|resource_no
)paren
(brace
r_return
id|dev-&gt;resource
(braket
id|resource_no
)braket
dot
id|end
suffix:semicolon
)brace
DECL|function|macio_resource_len
r_static
r_inline
r_int
r_int
id|macio_resource_len
c_func
(paren
r_struct
id|macio_dev
op_star
id|dev
comma
r_int
id|resource_no
)paren
(brace
r_struct
id|resource
op_star
id|res
op_assign
op_amp
id|dev-&gt;resource
(braket
id|resource_no
)braket
suffix:semicolon
r_if
c_cond
(paren
id|res-&gt;start
op_eq
l_int|0
op_logical_or
id|res-&gt;end
op_eq
l_int|0
op_logical_or
id|res-&gt;end
OL
id|res-&gt;start
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|res-&gt;end
op_minus
id|res-&gt;start
op_plus
l_int|1
suffix:semicolon
)brace
r_extern
r_int
id|macio_request_resource
c_func
(paren
r_struct
id|macio_dev
op_star
id|dev
comma
r_int
id|resource_no
comma
r_const
r_char
op_star
id|name
)paren
suffix:semicolon
r_extern
r_void
id|macio_release_resource
c_func
(paren
r_struct
id|macio_dev
op_star
id|dev
comma
r_int
id|resource_no
)paren
suffix:semicolon
r_extern
r_int
id|macio_request_resources
c_func
(paren
r_struct
id|macio_dev
op_star
id|dev
comma
r_const
r_char
op_star
id|name
)paren
suffix:semicolon
r_extern
r_void
id|macio_release_resources
c_func
(paren
r_struct
id|macio_dev
op_star
id|dev
)paren
suffix:semicolon
DECL|function|macio_irq_count
r_static
r_inline
r_int
id|macio_irq_count
c_func
(paren
r_struct
id|macio_dev
op_star
id|dev
)paren
(brace
r_return
id|dev-&gt;n_interrupts
suffix:semicolon
)brace
DECL|function|macio_irq
r_static
r_inline
r_int
id|macio_irq
c_func
(paren
r_struct
id|macio_dev
op_star
id|dev
comma
r_int
id|irq_no
)paren
(brace
r_return
id|dev-&gt;interrupt
(braket
id|irq_no
)braket
dot
id|start
suffix:semicolon
)brace
DECL|function|macio_set_drvdata
r_static
r_inline
r_void
id|macio_set_drvdata
c_func
(paren
r_struct
id|macio_dev
op_star
id|dev
comma
r_void
op_star
id|data
)paren
(brace
id|dev_set_drvdata
c_func
(paren
op_amp
id|dev-&gt;ofdev.dev
comma
id|data
)paren
suffix:semicolon
)brace
DECL|function|macio_get_drvdata
r_static
r_inline
r_void
op_star
id|macio_get_drvdata
c_func
(paren
r_struct
id|macio_dev
op_star
id|dev
)paren
(brace
r_return
id|dev_get_drvdata
c_func
(paren
op_amp
id|dev-&gt;ofdev.dev
)paren
suffix:semicolon
)brace
DECL|function|macio_get_of_node
r_static
r_inline
r_struct
id|device_node
op_star
id|macio_get_of_node
c_func
(paren
r_struct
id|macio_dev
op_star
id|mdev
)paren
(brace
r_return
id|mdev-&gt;ofdev.node
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PCI
DECL|function|macio_get_pci_dev
r_static
r_inline
r_struct
id|pci_dev
op_star
id|macio_get_pci_dev
c_func
(paren
r_struct
id|macio_dev
op_star
id|mdev
)paren
(brace
r_return
id|mdev-&gt;bus-&gt;pdev
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * A driver for a mac-io chip based device&n; */
DECL|struct|macio_driver
r_struct
id|macio_driver
(brace
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|match_table
r_struct
id|of_match
op_star
id|match_table
suffix:semicolon
DECL|member|owner
r_struct
id|module
op_star
id|owner
suffix:semicolon
DECL|member|probe
r_int
(paren
op_star
id|probe
)paren
(paren
r_struct
id|macio_dev
op_star
id|dev
comma
r_const
r_struct
id|of_match
op_star
id|match
)paren
suffix:semicolon
DECL|member|remove
r_int
(paren
op_star
id|remove
)paren
(paren
r_struct
id|macio_dev
op_star
id|dev
)paren
suffix:semicolon
DECL|member|suspend
r_int
(paren
op_star
id|suspend
)paren
(paren
r_struct
id|macio_dev
op_star
id|dev
comma
id|u32
id|state
)paren
suffix:semicolon
DECL|member|resume
r_int
(paren
op_star
id|resume
)paren
(paren
r_struct
id|macio_dev
op_star
id|dev
)paren
suffix:semicolon
DECL|member|shutdown
r_int
(paren
op_star
id|shutdown
)paren
(paren
r_struct
id|macio_dev
op_star
id|dev
)paren
suffix:semicolon
DECL|member|driver
r_struct
id|device_driver
id|driver
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|to_macio_driver
mdefine_line|#define&t;to_macio_driver(drv) container_of(drv,struct macio_driver, driver)
r_extern
r_int
id|macio_register_driver
c_func
(paren
r_struct
id|macio_driver
op_star
)paren
suffix:semicolon
r_extern
r_void
id|macio_unregister_driver
c_func
(paren
r_struct
id|macio_driver
op_star
)paren
suffix:semicolon
macro_line|#endif /* __MACIO_ASIC_H__ */
eof
