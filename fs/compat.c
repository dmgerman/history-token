multiline_comment|/*&n; *  linux/fs/compat.c&n; *&n; *  Kernel compatibililty routines for e.g. 32 bit syscall support&n; *  on 64 bit kernels.&n; *&n; *  Copyright (C) 2002 Stephen Rothwell, IBM Corporation&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License version 2 as&n; *  published by the Free Software Foundation.&n; */
macro_line|#include &lt;linux/linkage.h&gt;
macro_line|#include &lt;linux/compat.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/time.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
multiline_comment|/*&n; * Not all architectures have sys_utime, so implement this in terms&n; * of sys_utimes.&n; */
DECL|function|compat_sys_utime
id|asmlinkage
r_int
id|compat_sys_utime
c_func
(paren
r_char
op_star
id|filename
comma
r_struct
id|compat_utimbuf
op_star
id|t
)paren
(brace
r_struct
id|timeval
id|tv
(braket
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
id|t
)paren
(brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|tv
(braket
l_int|0
)braket
dot
id|tv_sec
comma
op_amp
id|t-&gt;actime
)paren
op_logical_or
id|get_user
c_func
(paren
id|tv
(braket
l_int|1
)braket
dot
id|tv_sec
comma
op_amp
id|t-&gt;modtime
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|tv
(braket
l_int|0
)braket
dot
id|tv_usec
op_assign
l_int|0
suffix:semicolon
id|tv
(braket
l_int|1
)braket
dot
id|tv_usec
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|do_utimes
c_func
(paren
id|filename
comma
id|t
ques
c_cond
id|tv
suffix:colon
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|compat_sys_newstat
id|asmlinkage
r_int
id|compat_sys_newstat
c_func
(paren
r_char
op_star
id|filename
comma
r_struct
id|compat_stat
op_star
id|statbuf
)paren
(brace
r_struct
id|kstat
id|stat
suffix:semicolon
r_int
id|error
op_assign
id|vfs_stat
c_func
(paren
id|filename
comma
op_amp
id|stat
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
id|error
op_assign
id|cp_compat_stat
c_func
(paren
op_amp
id|stat
comma
id|statbuf
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|compat_sys_newlstat
id|asmlinkage
r_int
id|compat_sys_newlstat
c_func
(paren
r_char
op_star
id|filename
comma
r_struct
id|compat_stat
op_star
id|statbuf
)paren
(brace
r_struct
id|kstat
id|stat
suffix:semicolon
r_int
id|error
op_assign
id|vfs_lstat
c_func
(paren
id|filename
comma
op_amp
id|stat
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
id|error
op_assign
id|cp_compat_stat
c_func
(paren
op_amp
id|stat
comma
id|statbuf
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|compat_sys_newfstat
id|asmlinkage
r_int
id|compat_sys_newfstat
c_func
(paren
r_int
r_int
id|fd
comma
r_struct
id|compat_stat
op_star
id|statbuf
)paren
(brace
r_struct
id|kstat
id|stat
suffix:semicolon
r_int
id|error
op_assign
id|vfs_fstat
c_func
(paren
id|fd
comma
op_amp
id|stat
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
id|error
op_assign
id|cp_compat_stat
c_func
(paren
op_amp
id|stat
comma
id|statbuf
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|get_compat_flock
r_int
id|get_compat_flock
c_func
(paren
r_struct
id|flock
op_star
id|kfl
comma
r_struct
id|compat_flock
op_star
id|ufl
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_READ
comma
id|ufl
comma
r_sizeof
(paren
op_star
id|ufl
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|err
op_assign
id|__get_user
c_func
(paren
id|kfl-&gt;l_type
comma
op_amp
id|ufl-&gt;l_type
)paren
suffix:semicolon
id|err
op_or_assign
id|__get_user
c_func
(paren
id|kfl-&gt;l_whence
comma
op_amp
id|ufl-&gt;l_whence
)paren
suffix:semicolon
id|err
op_or_assign
id|__get_user
c_func
(paren
id|kfl-&gt;l_start
comma
op_amp
id|ufl-&gt;l_start
)paren
suffix:semicolon
id|err
op_or_assign
id|__get_user
c_func
(paren
id|kfl-&gt;l_len
comma
op_amp
id|ufl-&gt;l_len
)paren
suffix:semicolon
id|err
op_or_assign
id|__get_user
c_func
(paren
id|kfl-&gt;l_pid
comma
op_amp
id|ufl-&gt;l_pid
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|put_compat_flock
r_int
id|put_compat_flock
c_func
(paren
r_struct
id|flock
op_star
id|kfl
comma
r_struct
id|compat_flock
op_star
id|ufl
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|ufl
comma
r_sizeof
(paren
op_star
id|ufl
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|err
op_assign
id|__put_user
c_func
(paren
id|kfl-&gt;l_type
comma
op_amp
id|ufl-&gt;l_type
)paren
suffix:semicolon
id|err
op_or_assign
id|__put_user
c_func
(paren
id|kfl-&gt;l_whence
comma
op_amp
id|ufl-&gt;l_whence
)paren
suffix:semicolon
id|err
op_or_assign
id|__put_user
c_func
(paren
id|kfl-&gt;l_start
comma
op_amp
id|ufl-&gt;l_start
)paren
suffix:semicolon
id|err
op_or_assign
id|__put_user
c_func
(paren
id|kfl-&gt;l_len
comma
op_amp
id|ufl-&gt;l_len
)paren
suffix:semicolon
id|err
op_or_assign
id|__put_user
c_func
(paren
id|kfl-&gt;l_pid
comma
op_amp
id|ufl-&gt;l_pid
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
eof
