multiline_comment|/*&n; * JFFS2 -- Journalling Flash File System, Version 2.&n; *&n; * Copyright (C) 2002 Red Hat, Inc.&n; *&n; * Created by David Woodhouse &lt;dwmw2@cambridge.redhat.com&gt;&n; *&n; * The original JFFS, from which the design for JFFS2 was derived,&n; * was designed and implemented by Axis Communications AB.&n; *&n; * The contents of this file are subject to the Red Hat eCos Public&n; * License Version 1.1 (the &quot;Licence&quot;); you may not use this file&n; * except in compliance with the Licence.  You may obtain a copy of&n; * the Licence at http://www.redhat.com/&n; *&n; * Software distributed under the Licence is distributed on an &quot;AS IS&quot;&n; * basis, WITHOUT WARRANTY OF ANY KIND, either express or implied.&n; * See the Licence for the specific language governing rights and&n; * limitations under the Licence.&n; *&n; * The Original Code is JFFS2 - Journalling Flash File System, version 2&n; *&n; * Alternatively, the contents of this file may be used under the&n; * terms of the GNU General Public License version 2 (the &quot;GPL&quot;), in&n; * which case the provisions of the GPL are applicable instead of the&n; * above.  If you wish to allow the use of your version of this file&n; * only under the terms of the GPL and not to allow others to use your&n; * version of this file under the RHEPL, indicate your decision by&n; * deleting the provisions above and replace them with the notice and&n; * other provisions required by the GPL.  If you do not delete the&n; * provisions above, a recipient may use your version of this file&n; * under either the RHEPL or the GPL.&n; *&n; * $Id: os-linux.h,v 1.16 2002/03/17 10:18:42 dwmw2 Exp $&n; *&n; */
macro_line|#ifndef __JFFS2_OS_LINUX_H__
DECL|macro|__JFFS2_OS_LINUX_H__
mdefine_line|#define __JFFS2_OS_LINUX_H__
macro_line|#include &lt;linux/version.h&gt;
macro_line|#if LINUX_VERSION_CODE &gt; KERNEL_VERSION(2,5,2)
DECL|macro|JFFS2_INODE_INFO
mdefine_line|#define JFFS2_INODE_INFO(i) (list_entry(i, struct jffs2_inode_info, vfs_inode))
DECL|macro|OFNI_EDONI_2SFFJ
mdefine_line|#define OFNI_EDONI_2SFFJ(f)  (&amp;(f)-&gt;vfs_inode)
DECL|macro|JFFS2_SB_INFO
mdefine_line|#define JFFS2_SB_INFO(sb) (sb-&gt;u.generic_sbp)
DECL|macro|OFNI_BS_2SFFJ
mdefine_line|#define OFNI_BS_2SFFJ(c)  ((struct super_block *)c-&gt;os_priv)
macro_line|#elif defined(JFFS2_OUT_OF_KERNEL)
DECL|macro|JFFS2_INODE_INFO
mdefine_line|#define JFFS2_INODE_INFO(i) ((struct jffs2_inode_info *) &amp;(i)-&gt;u)
DECL|macro|OFNI_EDONI_2SFFJ
mdefine_line|#define OFNI_EDONI_2SFFJ(f)  ((struct inode *) ( ((char *)f) - ((char *)(&amp;((struct inode *)NULL)-&gt;u)) ) )
DECL|macro|JFFS2_SB_INFO
mdefine_line|#define JFFS2_SB_INFO(sb) ((struct jffs2_sb_info *) &amp;(sb)-&gt;u)
DECL|macro|OFNI_BS_2SFFJ
mdefine_line|#define OFNI_BS_2SFFJ(c)  ((struct super_block *) ( ((char *)c) - ((char *)(&amp;((struct super_block *)NULL)-&gt;u)) ) )
macro_line|#else
DECL|macro|JFFS2_INODE_INFO
mdefine_line|#define JFFS2_INODE_INFO(i) (&amp;i-&gt;u.jffs2_i)
DECL|macro|OFNI_EDONI_2SFFJ
mdefine_line|#define OFNI_EDONI_2SFFJ(f)  ((struct inode *) ( ((char *)f) - ((char *)(&amp;((struct inode *)NULL)-&gt;u)) ) )
DECL|macro|JFFS2_SB_INFO
mdefine_line|#define JFFS2_SB_INFO(sb) (&amp;sb-&gt;u.jffs2_sb)
DECL|macro|OFNI_BS_2SFFJ
mdefine_line|#define OFNI_BS_2SFFJ(c)  ((struct super_block *) ( ((char *)c) - ((char *)(&amp;((struct super_block *)NULL)-&gt;u)) ) )
macro_line|#endif
DECL|macro|JFFS2_F_I_SIZE
mdefine_line|#define JFFS2_F_I_SIZE(f) (OFNI_EDONI_2SFFJ(f)-&gt;i_size)
DECL|macro|JFFS2_F_I_MODE
mdefine_line|#define JFFS2_F_I_MODE(f) (OFNI_EDONI_2SFFJ(f)-&gt;i_mode)
DECL|macro|JFFS2_F_I_UID
mdefine_line|#define JFFS2_F_I_UID(f) (OFNI_EDONI_2SFFJ(f)-&gt;i_uid)
DECL|macro|JFFS2_F_I_GID
mdefine_line|#define JFFS2_F_I_GID(f) (OFNI_EDONI_2SFFJ(f)-&gt;i_gid)
DECL|macro|JFFS2_F_I_CTIME
mdefine_line|#define JFFS2_F_I_CTIME(f) (OFNI_EDONI_2SFFJ(f)-&gt;i_ctime)
DECL|macro|JFFS2_F_I_MTIME
mdefine_line|#define JFFS2_F_I_MTIME(f) (OFNI_EDONI_2SFFJ(f)-&gt;i_mtime)
DECL|macro|JFFS2_F_I_ATIME
mdefine_line|#define JFFS2_F_I_ATIME(f) (OFNI_EDONI_2SFFJ(f)-&gt;i_atime)
macro_line|#if LINUX_VERSION_CODE &gt; KERNEL_VERSION(2,5,1)
DECL|macro|JFFS2_F_I_RDEV_MIN
mdefine_line|#define JFFS2_F_I_RDEV_MIN(f) (minor(OFNI_EDONI_2SFFJ(f)-&gt;i_rdev))
DECL|macro|JFFS2_F_I_RDEV_MAJ
mdefine_line|#define JFFS2_F_I_RDEV_MAJ(f) (major(OFNI_EDONI_2SFFJ(f)-&gt;i_rdev))
macro_line|#else
DECL|macro|JFFS2_F_I_RDEV_MIN
mdefine_line|#define JFFS2_F_I_RDEV_MIN(f) (MINOR(to_kdev_t(OFNI_EDONI_2SFFJ(f)-&gt;i_rdev)))
DECL|macro|JFFS2_F_I_RDEV_MAJ
mdefine_line|#define JFFS2_F_I_RDEV_MAJ(f) (MAJOR(to_kdev_t(OFNI_EDONI_2SFFJ(f)-&gt;i_rdev)))
macro_line|#endif
DECL|function|jffs2_init_inode_info
r_static
r_inline
r_void
id|jffs2_init_inode_info
c_func
(paren
r_struct
id|jffs2_inode_info
op_star
id|f
)paren
(brace
macro_line|#if LINUX_VERSION_CODE &gt; KERNEL_VERSION(2,5,2)
id|f-&gt;highest_version
op_assign
l_int|0
suffix:semicolon
id|f-&gt;fraglist
op_assign
l_int|NULL
suffix:semicolon
id|f-&gt;metadata
op_assign
l_int|NULL
suffix:semicolon
id|f-&gt;dents
op_assign
l_int|NULL
suffix:semicolon
id|f-&gt;flags
op_assign
l_int|0
suffix:semicolon
id|f-&gt;usercompr
op_assign
l_int|0
suffix:semicolon
macro_line|#else
id|memset
c_func
(paren
id|f
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|f
)paren
)paren
suffix:semicolon
id|init_MUTEX_LOCKED
c_func
(paren
op_amp
id|f-&gt;sem
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|macro|jffs2_is_readonly
mdefine_line|#define jffs2_is_readonly(c) (OFNI_BS_2SFFJ(c)-&gt;s_flags &amp; MS_RDONLY)
macro_line|#ifndef CONFIG_JFFS2_FS_NAND
DECL|macro|jffs2_can_mark_obsolete
mdefine_line|#define jffs2_can_mark_obsolete(c) (1)
DECL|macro|jffs2_cleanmarker_oob
mdefine_line|#define jffs2_cleanmarker_oob(c) (0)
DECL|macro|jffs2_write_nand_cleanmarker
mdefine_line|#define jffs2_write_nand_cleanmarker(c,jeb) (-EIO)
DECL|macro|jffs2_flash_write
mdefine_line|#define jffs2_flash_write(c, ofs, len, retlen, buf) ((c)-&gt;mtd-&gt;write((c)-&gt;mtd, ofs, len, retlen, buf))
DECL|macro|jffs2_flash_read
mdefine_line|#define jffs2_flash_read(c, ofs, len, retlen, buf) ((c)-&gt;mtd-&gt;read((c)-&gt;mtd, ofs, len, retlen, buf))
DECL|macro|jffs2_flush_wbuf
mdefine_line|#define jffs2_flush_wbuf(c, flag) do { ; } while(0)
DECL|macro|jffs2_nand_read_failcnt
mdefine_line|#define jffs2_nand_read_failcnt(c,jeb) do { ; } while(0)
DECL|macro|jffs2_write_nand_badblock
mdefine_line|#define jffs2_write_nand_badblock(c,jeb) do { ; } while(0)
DECL|macro|jffs2_flash_writev
mdefine_line|#define jffs2_flash_writev jffs2_flash_direct_writev
macro_line|#else /* NAND support present */
DECL|macro|jffs2_can_mark_obsolete
mdefine_line|#define jffs2_can_mark_obsolete(c) (c-&gt;mtd-&gt;type == MTD_NORFLASH || c-&gt;mtd-&gt;type == MTD_RAM)
DECL|macro|jffs2_cleanmarker_oob
mdefine_line|#define jffs2_cleanmarker_oob(c) (c-&gt;mtd-&gt;type == MTD_NANDFLASH)
DECL|macro|jffs2_flash_write_oob
mdefine_line|#define jffs2_flash_write_oob(c, ofs, len, retlen, buf) ((c)-&gt;mtd-&gt;write_oob((c)-&gt;mtd, ofs, len, retlen, buf))
DECL|macro|jffs2_flash_read_oob
mdefine_line|#define jffs2_flash_read_oob(c, ofs, len, retlen, buf) ((c)-&gt;mtd-&gt;read_oob((c)-&gt;mtd, ofs, len, retlen, buf))
multiline_comment|/* wbuf.c */
r_int
id|jffs2_flash_writev
c_func
(paren
r_struct
id|jffs2_sb_info
op_star
id|c
comma
r_const
r_struct
id|iovec
op_star
id|vecs
comma
r_int
r_int
id|count
comma
id|loff_t
id|to
comma
r_int
op_star
id|retlen
)paren
suffix:semicolon
r_int
id|jffs2_flash_write
c_func
(paren
r_struct
id|jffs2_sb_info
op_star
id|c
comma
id|loff_t
id|ofs
comma
r_int
id|len
comma
r_int
op_star
id|retlen
comma
r_const
id|u_char
op_star
id|buf
)paren
suffix:semicolon
r_int
id|jffs2_flash_read
c_func
(paren
r_struct
id|jffs2_sb_info
op_star
id|c
comma
id|loff_t
id|ofs
comma
r_int
id|len
comma
r_int
op_star
id|retlen
comma
id|u_char
op_star
id|buf
)paren
suffix:semicolon
r_int
id|jffs2_check_oob_empty
c_func
(paren
r_struct
id|jffs2_sb_info
op_star
id|c
comma
r_struct
id|jffs2_eraseblock
op_star
id|jeb
comma
r_int
id|mode
)paren
suffix:semicolon
r_int
id|jffs2_check_nand_cleanmarker
c_func
(paren
r_struct
id|jffs2_sb_info
op_star
id|c
comma
r_struct
id|jffs2_eraseblock
op_star
id|jeb
)paren
suffix:semicolon
r_int
id|jffs2_write_nand_cleanmarker
c_func
(paren
r_struct
id|jffs2_sb_info
op_star
id|c
comma
r_struct
id|jffs2_eraseblock
op_star
id|jeb
)paren
suffix:semicolon
r_int
id|jffs2_write_nand_badblock
c_func
(paren
r_struct
id|jffs2_sb_info
op_star
id|c
comma
r_struct
id|jffs2_eraseblock
op_star
id|jeb
)paren
suffix:semicolon
macro_line|#endif /* NAND */
multiline_comment|/* background.c */
r_int
id|jffs2_start_garbage_collect_thread
c_func
(paren
r_struct
id|jffs2_sb_info
op_star
id|c
)paren
suffix:semicolon
r_void
id|jffs2_stop_garbage_collect_thread
c_func
(paren
r_struct
id|jffs2_sb_info
op_star
id|c
)paren
suffix:semicolon
r_void
id|jffs2_garbage_collect_trigger
c_func
(paren
r_struct
id|jffs2_sb_info
op_star
id|c
)paren
suffix:semicolon
multiline_comment|/* dir.c */
r_extern
r_struct
id|file_operations
id|jffs2_dir_operations
suffix:semicolon
r_extern
r_struct
id|inode_operations
id|jffs2_dir_inode_operations
suffix:semicolon
multiline_comment|/* file.c */
r_extern
r_struct
id|file_operations
id|jffs2_file_operations
suffix:semicolon
r_extern
r_struct
id|inode_operations
id|jffs2_file_inode_operations
suffix:semicolon
r_extern
r_struct
id|address_space_operations
id|jffs2_file_address_operations
suffix:semicolon
r_int
id|jffs2_fsync
c_func
(paren
r_struct
id|file
op_star
comma
r_struct
id|dentry
op_star
comma
r_int
)paren
suffix:semicolon
r_int
id|jffs2_setattr
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_struct
id|iattr
op_star
id|iattr
)paren
suffix:semicolon
r_int
id|jffs2_do_readpage_nolock
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|page
op_star
id|pg
)paren
suffix:semicolon
r_int
id|jffs2_do_readpage_unlock
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|page
op_star
id|pg
)paren
suffix:semicolon
r_int
id|jffs2_readpage
(paren
r_struct
id|file
op_star
comma
r_struct
id|page
op_star
)paren
suffix:semicolon
r_int
id|jffs2_prepare_write
(paren
r_struct
id|file
op_star
comma
r_struct
id|page
op_star
comma
r_int
comma
r_int
)paren
suffix:semicolon
r_int
id|jffs2_commit_write
(paren
r_struct
id|file
op_star
comma
r_struct
id|page
op_star
comma
r_int
comma
r_int
)paren
suffix:semicolon
multiline_comment|/* ioctl.c */
r_int
id|jffs2_ioctl
c_func
(paren
r_struct
id|inode
op_star
comma
r_struct
id|file
op_star
comma
r_int
r_int
comma
r_int
r_int
)paren
suffix:semicolon
multiline_comment|/* symlink.c */
r_extern
r_struct
id|inode_operations
id|jffs2_symlink_inode_operations
suffix:semicolon
multiline_comment|/* fs.c */
r_void
id|jffs2_read_inode
(paren
r_struct
id|inode
op_star
)paren
suffix:semicolon
r_void
id|jffs2_clear_inode
(paren
r_struct
id|inode
op_star
)paren
suffix:semicolon
r_struct
id|inode
op_star
id|jffs2_new_inode
(paren
r_struct
id|inode
op_star
id|dir_i
comma
r_int
id|mode
comma
r_struct
id|jffs2_raw_inode
op_star
id|ri
)paren
suffix:semicolon
r_int
id|jffs2_statfs
(paren
r_struct
id|super_block
op_star
comma
r_struct
id|statfs
op_star
)paren
suffix:semicolon
r_void
id|jffs2_write_super
(paren
r_struct
id|super_block
op_star
)paren
suffix:semicolon
r_int
id|jffs2_remount_fs
(paren
r_struct
id|super_block
op_star
comma
r_int
op_star
comma
r_char
op_star
)paren
suffix:semicolon
r_int
id|jffs2_do_fill_super
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_void
op_star
id|data
comma
r_int
id|silent
)paren
suffix:semicolon
multiline_comment|/* writev.c */
r_int
id|jffs2_flash_direct_writev
c_func
(paren
r_struct
id|jffs2_sb_info
op_star
id|c
comma
r_const
r_struct
id|iovec
op_star
id|vecs
comma
r_int
r_int
id|count
comma
id|loff_t
id|to
comma
r_int
op_star
id|retlen
)paren
suffix:semicolon
multiline_comment|/* super.c */
macro_line|#endif /* __JFFS2_OS_LINUX_H__ */
eof
