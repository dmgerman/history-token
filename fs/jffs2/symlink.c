multiline_comment|/*&n; * JFFS2 -- Journalling Flash File System, Version 2.&n; *&n; * Copyright (C) 2001, 2002 Red Hat, Inc.&n; *&n; * Created by David Woodhouse &lt;dwmw2@cambridge.redhat.com&gt;&n; *&n; * The original JFFS, from which the design for JFFS2 was derived,&n; * was designed and implemented by Axis Communications AB.&n; *&n; * The contents of this file are subject to the Red Hat eCos Public&n; * License Version 1.1 (the &quot;Licence&quot;); you may not use this file&n; * except in compliance with the Licence.  You may obtain a copy of&n; * the Licence at http://www.redhat.com/&n; *&n; * Software distributed under the Licence is distributed on an &quot;AS IS&quot;&n; * basis, WITHOUT WARRANTY OF ANY KIND, either express or implied.&n; * See the Licence for the specific language governing rights and&n; * limitations under the Licence.&n; *&n; * The Original Code is JFFS2 - Journalling Flash File System, version 2&n; *&n; * Alternatively, the contents of this file may be used under the&n; * terms of the GNU General Public License version 2 (the &quot;GPL&quot;), in&n; * which case the provisions of the GPL are applicable instead of the&n; * above.  If you wish to allow the use of your version of this file&n; * only under the terms of the GPL and not to allow others to use your&n; * version of this file under the RHEPL, indicate your decision by&n; * deleting the provisions above and replace them with the notice and&n; * other provisions required by the GPL.  If you do not delete the&n; * provisions above, a recipient may use your version of this file&n; * under either the RHEPL or the GPL.&n; *&n; * $Id: symlink.c,v 1.5.2.1 2002/01/15 10:39:06 dwmw2 Exp $&n; *&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/jffs2.h&gt;
macro_line|#include &quot;nodelist.h&quot;
r_int
id|jffs2_readlink
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_char
op_star
id|buffer
comma
r_int
id|buflen
)paren
suffix:semicolon
r_int
id|jffs2_follow_link
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_struct
id|nameidata
op_star
id|nd
)paren
suffix:semicolon
DECL|variable|jffs2_symlink_inode_operations
r_struct
id|inode_operations
id|jffs2_symlink_inode_operations
op_assign
(brace
id|readlink
suffix:colon
id|jffs2_readlink
comma
id|follow_link
suffix:colon
id|jffs2_follow_link
comma
id|setattr
suffix:colon
id|jffs2_setattr
)brace
suffix:semicolon
DECL|function|jffs2_getlink
r_static
r_char
op_star
id|jffs2_getlink
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
r_struct
id|jffs2_inode_info
op_star
id|f
op_assign
id|JFFS2_INODE_INFO
c_func
(paren
id|dentry-&gt;d_inode
)paren
suffix:semicolon
r_char
op_star
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|down
c_func
(paren
op_amp
id|f-&gt;sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|f-&gt;metadata
)paren
(brace
id|up
c_func
(paren
op_amp
id|f-&gt;sem
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;No metadata for symlink inode #%lu&bslash;n&quot;
comma
id|dentry-&gt;d_inode-&gt;i_ino
)paren
suffix:semicolon
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
)brace
id|buf
op_assign
id|kmalloc
c_func
(paren
id|f-&gt;metadata-&gt;size
op_plus
l_int|1
comma
id|GFP_USER
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
(brace
id|up
c_func
(paren
op_amp
id|f-&gt;sem
)paren
suffix:semicolon
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
)brace
id|buf
(braket
id|f-&gt;metadata-&gt;size
)braket
op_assign
l_int|0
suffix:semicolon
id|ret
op_assign
id|jffs2_read_dnode
c_func
(paren
id|JFFS2_SB_INFO
c_func
(paren
id|dentry-&gt;d_inode-&gt;i_sb
)paren
comma
id|f-&gt;metadata
comma
id|buf
comma
l_int|0
comma
id|f-&gt;metadata-&gt;size
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|f-&gt;sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|kfree
c_func
(paren
id|buf
)paren
suffix:semicolon
r_return
id|ERR_PTR
c_func
(paren
id|ret
)paren
suffix:semicolon
)brace
r_return
id|buf
suffix:semicolon
)brace
DECL|function|jffs2_readlink
r_int
id|jffs2_readlink
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_char
op_star
id|buffer
comma
r_int
id|buflen
)paren
(brace
r_int
r_char
op_star
id|kbuf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|kbuf
op_assign
id|jffs2_getlink
c_func
(paren
id|dentry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|kbuf
)paren
)paren
r_return
id|PTR_ERR
c_func
(paren
id|kbuf
)paren
suffix:semicolon
id|ret
op_assign
id|vfs_readlink
c_func
(paren
id|dentry
comma
id|buffer
comma
id|buflen
comma
id|kbuf
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|kbuf
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|jffs2_follow_link
r_int
id|jffs2_follow_link
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_struct
id|nameidata
op_star
id|nd
)paren
(brace
r_int
r_char
op_star
id|buf
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|buf
op_assign
id|jffs2_getlink
c_func
(paren
id|dentry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|buf
)paren
)paren
r_return
id|PTR_ERR
c_func
(paren
id|buf
)paren
suffix:semicolon
id|ret
op_assign
id|vfs_follow_link
c_func
(paren
id|nd
comma
id|buf
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|buf
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
eof
