multiline_comment|/*&n; * linux/fs/ext3/xattr.c&n; *&n; * Copyright (C) 2001-2003 Andreas Gruenbacher, &lt;agruen@suse.de&gt;&n; *&n; * Fix by Harrison Xing &lt;harrison@mountainviewdata.com&gt;.&n; * Ext3 code with a lot of help from Eric Jarman &lt;ejarman@acm.org&gt;.&n; * Extended attributes for symlinks and special files added per&n; *  suggestion of Luka Renko &lt;luka.renko@hermes.si&gt;.&n; * xattr consolidation Copyright (c) 2004 James Morris &lt;jmorris@redhat.com&gt;,&n; *  Red Hat Inc.&n; * ea-in-inode support by Alex Tomas &lt;alex@clusterfs.com&gt; aka bzzz&n; *  and Andreas Gruenbacher &lt;agruen@suse.de&gt;.&n; */
multiline_comment|/*&n; * Extended attributes are stored directly in inodes (on file systems with&n; * inodes bigger than 128 bytes) and on additional disk blocks. The i_file_acl&n; * field contains the block number if an inode uses an additional block. All&n; * attributes must fit in the inode and one additional block. Blocks that&n; * contain the identical set of attributes may be shared among several inodes.&n; * Identical blocks are detected by keeping a cache of blocks that have&n; * recently been accessed.&n; *&n; * The attributes in inodes and on blocks have a different header; the entries&n; * are stored in the same format:&n; *&n; *   +------------------+&n; *   | header           |&n; *   | entry 1          | |&n; *   | entry 2          | | growing downwards&n; *   | entry 3          | v&n; *   | four null bytes  |&n; *   | . . .            |&n; *   | value 1          | ^&n; *   | value 3          | | growing upwards&n; *   | value 2          | |&n; *   +------------------+&n; *&n; * The header is followed by multiple entry descriptors. In disk blocks, the&n; * entry descriptors are kept sorted. In inodes, they are unsorted. The&n; * attribute values are aligned to the end of the block in no specific order.&n; *&n; * Locking strategy&n; * ----------------&n; * EXT3_I(inode)-&gt;i_file_acl is protected by EXT3_I(inode)-&gt;xattr_sem.&n; * EA blocks are only changed if they are exclusive to an inode, so&n; * holding xattr_sem also means that nothing but the EA block&squot;s reference&n; * count can change. Multiple writers to the same block are synchronized&n; * by the buffer lock.&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/ext3_jbd.h&gt;
macro_line|#include &lt;linux/ext3_fs.h&gt;
macro_line|#include &lt;linux/mbcache.h&gt;
macro_line|#include &lt;linux/quotaops.h&gt;
macro_line|#include &lt;linux/rwsem.h&gt;
macro_line|#include &quot;xattr.h&quot;
macro_line|#include &quot;acl.h&quot;
DECL|macro|BHDR
mdefine_line|#define BHDR(bh) ((struct ext3_xattr_header *)((bh)-&gt;b_data))
DECL|macro|ENTRY
mdefine_line|#define ENTRY(ptr) ((struct ext3_xattr_entry *)(ptr))
DECL|macro|BFIRST
mdefine_line|#define BFIRST(bh) ENTRY(BHDR(bh)+1)
DECL|macro|IS_LAST_ENTRY
mdefine_line|#define IS_LAST_ENTRY(entry) (*(__u32 *)(entry) == 0)
DECL|macro|IHDR
mdefine_line|#define IHDR(inode, raw_inode) &bslash;&n;&t;((struct ext3_xattr_ibody_header *) &bslash;&n;&t;&t;((void *)raw_inode + &bslash;&n;&t;&t; EXT3_GOOD_OLD_INODE_SIZE + &bslash;&n;&t;&t; EXT3_I(inode)-&gt;i_extra_isize))
DECL|macro|IFIRST
mdefine_line|#define IFIRST(hdr) ((struct ext3_xattr_entry *)((hdr)+1))
macro_line|#ifdef EXT3_XATTR_DEBUG
DECL|macro|ea_idebug
macro_line|# define ea_idebug(inode, f...) do { &bslash;&n;&t;&t;printk(KERN_DEBUG &quot;inode %s:%ld: &quot;, &bslash;&n;&t;&t;&t;inode-&gt;i_sb-&gt;s_id, inode-&gt;i_ino); &bslash;&n;&t;&t;printk(f); &bslash;&n;&t;&t;printk(&quot;&bslash;n&quot;); &bslash;&n;&t;} while (0)
DECL|macro|ea_bdebug
macro_line|# define ea_bdebug(bh, f...) do { &bslash;&n;&t;&t;char b[BDEVNAME_SIZE]; &bslash;&n;&t;&t;printk(KERN_DEBUG &quot;block %s:%lu: &quot;, &bslash;&n;&t;&t;&t;bdevname(bh-&gt;b_bdev, b), &bslash;&n;&t;&t;&t;(unsigned long) bh-&gt;b_blocknr); &bslash;&n;&t;&t;printk(f); &bslash;&n;&t;&t;printk(&quot;&bslash;n&quot;); &bslash;&n;&t;} while (0)
macro_line|#else
DECL|macro|ea_idebug
macro_line|# define ea_idebug(f...)
DECL|macro|ea_bdebug
macro_line|# define ea_bdebug(f...)
macro_line|#endif
r_static
r_void
id|ext3_xattr_cache_insert
c_func
(paren
r_struct
id|buffer_head
op_star
)paren
suffix:semicolon
r_static
r_struct
id|buffer_head
op_star
id|ext3_xattr_cache_find
c_func
(paren
r_struct
id|inode
op_star
comma
r_struct
id|ext3_xattr_header
op_star
comma
r_struct
id|mb_cache_entry
op_star
op_star
)paren
suffix:semicolon
r_static
r_void
id|ext3_xattr_rehash
c_func
(paren
r_struct
id|ext3_xattr_header
op_star
comma
r_struct
id|ext3_xattr_entry
op_star
)paren
suffix:semicolon
DECL|variable|ext3_xattr_cache
r_static
r_struct
id|mb_cache
op_star
id|ext3_xattr_cache
suffix:semicolon
DECL|variable|ext3_xattr_handler_map
r_static
r_struct
id|xattr_handler
op_star
id|ext3_xattr_handler_map
(braket
)braket
op_assign
(brace
(braket
id|EXT3_XATTR_INDEX_USER
)braket
op_assign
op_amp
id|ext3_xattr_user_handler
comma
macro_line|#ifdef CONFIG_EXT3_FS_POSIX_ACL
(braket
id|EXT3_XATTR_INDEX_POSIX_ACL_ACCESS
)braket
op_assign
op_amp
id|ext3_xattr_acl_access_handler
comma
(braket
id|EXT3_XATTR_INDEX_POSIX_ACL_DEFAULT
)braket
op_assign
op_amp
id|ext3_xattr_acl_default_handler
comma
macro_line|#endif
(braket
id|EXT3_XATTR_INDEX_TRUSTED
)braket
op_assign
op_amp
id|ext3_xattr_trusted_handler
comma
macro_line|#ifdef CONFIG_EXT3_FS_SECURITY
(braket
id|EXT3_XATTR_INDEX_SECURITY
)braket
op_assign
op_amp
id|ext3_xattr_security_handler
comma
macro_line|#endif
)brace
suffix:semicolon
DECL|variable|ext3_xattr_handlers
r_struct
id|xattr_handler
op_star
id|ext3_xattr_handlers
(braket
)braket
op_assign
(brace
op_amp
id|ext3_xattr_user_handler
comma
op_amp
id|ext3_xattr_trusted_handler
comma
macro_line|#ifdef CONFIG_EXT3_FS_POSIX_ACL
op_amp
id|ext3_xattr_acl_access_handler
comma
op_amp
id|ext3_xattr_acl_default_handler
comma
macro_line|#endif
macro_line|#ifdef CONFIG_EXT3_FS_SECURITY
op_amp
id|ext3_xattr_security_handler
comma
macro_line|#endif
l_int|NULL
)brace
suffix:semicolon
r_static
r_inline
r_struct
id|xattr_handler
op_star
DECL|function|ext3_xattr_handler
id|ext3_xattr_handler
c_func
(paren
r_int
id|name_index
)paren
(brace
r_struct
id|xattr_handler
op_star
id|handler
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|name_index
OG
l_int|0
op_logical_and
id|name_index
OL
id|ARRAY_SIZE
c_func
(paren
id|ext3_xattr_handler_map
)paren
)paren
id|handler
op_assign
id|ext3_xattr_handler_map
(braket
id|name_index
)braket
suffix:semicolon
r_return
id|handler
suffix:semicolon
)brace
multiline_comment|/*&n; * Inode operation listxattr()&n; *&n; * dentry-&gt;d_inode-&gt;i_sem: don&squot;t care&n; */
id|ssize_t
DECL|function|ext3_listxattr
id|ext3_listxattr
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_char
op_star
id|buffer
comma
r_int
id|size
)paren
(brace
r_return
id|ext3_xattr_list
c_func
(paren
id|dentry-&gt;d_inode
comma
id|buffer
comma
id|size
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|ext3_xattr_check_names
id|ext3_xattr_check_names
c_func
(paren
r_struct
id|ext3_xattr_entry
op_star
id|entry
comma
r_void
op_star
id|end
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
id|IS_LAST_ENTRY
c_func
(paren
id|entry
)paren
)paren
(brace
r_struct
id|ext3_xattr_entry
op_star
id|next
op_assign
id|EXT3_XATTR_NEXT
c_func
(paren
id|entry
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
r_void
op_star
)paren
id|next
op_ge
id|end
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|entry
op_assign
id|next
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|ext3_xattr_check_block
id|ext3_xattr_check_block
c_func
(paren
r_struct
id|buffer_head
op_star
id|bh
)paren
(brace
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
id|BHDR
c_func
(paren
id|bh
)paren
op_member_access_from_pointer
id|h_magic
op_ne
id|cpu_to_le32
c_func
(paren
id|EXT3_XATTR_MAGIC
)paren
op_logical_or
id|BHDR
c_func
(paren
id|bh
)paren
op_member_access_from_pointer
id|h_blocks
op_ne
id|cpu_to_le32
c_func
(paren
l_int|1
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|error
op_assign
id|ext3_xattr_check_names
c_func
(paren
id|BFIRST
c_func
(paren
id|bh
)paren
comma
id|bh-&gt;b_data
op_plus
id|bh-&gt;b_size
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|ext3_xattr_check_entry
id|ext3_xattr_check_entry
c_func
(paren
r_struct
id|ext3_xattr_entry
op_star
id|entry
comma
r_int
id|size
)paren
(brace
r_int
id|value_size
op_assign
id|le32_to_cpu
c_func
(paren
id|entry-&gt;e_value_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;e_value_block
op_ne
l_int|0
op_logical_or
id|value_size
OG
id|size
op_logical_or
id|le16_to_cpu
c_func
(paren
id|entry-&gt;e_value_offs
)paren
op_plus
id|value_size
OG
id|size
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|ext3_xattr_find_entry
id|ext3_xattr_find_entry
c_func
(paren
r_struct
id|ext3_xattr_entry
op_star
op_star
id|pentry
comma
r_int
id|name_index
comma
r_const
r_char
op_star
id|name
comma
r_int
id|size
comma
r_int
id|sorted
)paren
(brace
r_struct
id|ext3_xattr_entry
op_star
id|entry
suffix:semicolon
r_int
id|name_len
suffix:semicolon
r_int
id|cmp
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|name
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|name_len
op_assign
id|strlen
c_func
(paren
id|name
)paren
suffix:semicolon
id|entry
op_assign
op_star
id|pentry
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
op_logical_neg
id|IS_LAST_ENTRY
c_func
(paren
id|entry
)paren
suffix:semicolon
id|entry
op_assign
id|EXT3_XATTR_NEXT
c_func
(paren
id|entry
)paren
)paren
(brace
id|cmp
op_assign
id|name_index
op_minus
id|entry-&gt;e_name_index
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cmp
)paren
id|cmp
op_assign
id|name_len
op_minus
id|entry-&gt;e_name_len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cmp
)paren
id|cmp
op_assign
id|memcmp
c_func
(paren
id|name
comma
id|entry-&gt;e_name
comma
id|name_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmp
op_le
l_int|0
op_logical_and
(paren
id|sorted
op_logical_or
id|cmp
op_eq
l_int|0
)paren
)paren
r_break
suffix:semicolon
)brace
op_star
id|pentry
op_assign
id|entry
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cmp
op_logical_and
id|ext3_xattr_check_entry
c_func
(paren
id|entry
comma
id|size
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
id|cmp
ques
c_cond
op_minus
id|ENODATA
suffix:colon
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|ext3_xattr_block_get
id|ext3_xattr_block_get
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|name_index
comma
r_const
r_char
op_star
id|name
comma
r_void
op_star
id|buffer
comma
r_int
id|buffer_size
)paren
(brace
r_struct
id|buffer_head
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|ext3_xattr_entry
op_star
id|entry
suffix:semicolon
r_int
id|size
suffix:semicolon
r_int
id|error
suffix:semicolon
id|ea_idebug
c_func
(paren
id|inode
comma
l_string|&quot;name=%d.%s, buffer=%p, buffer_size=%ld&quot;
comma
id|name_index
comma
id|name
comma
id|buffer
comma
(paren
r_int
)paren
id|buffer_size
)paren
suffix:semicolon
id|error
op_assign
op_minus
id|ENODATA
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_file_acl
)paren
r_goto
id|cleanup
suffix:semicolon
id|ea_idebug
c_func
(paren
id|inode
comma
l_string|&quot;reading block %d&quot;
comma
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_file_acl
)paren
suffix:semicolon
id|bh
op_assign
id|sb_bread
c_func
(paren
id|inode-&gt;i_sb
comma
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_file_acl
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bh
)paren
r_goto
id|cleanup
suffix:semicolon
id|ea_bdebug
c_func
(paren
id|bh
comma
l_string|&quot;b_count=%d, refcount=%d&quot;
comma
id|atomic_read
c_func
(paren
op_amp
(paren
id|bh-&gt;b_count
)paren
)paren
comma
id|le32_to_cpu
c_func
(paren
id|BHDR
c_func
(paren
id|bh
)paren
op_member_access_from_pointer
id|h_refcount
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ext3_xattr_check_block
c_func
(paren
id|bh
)paren
)paren
(brace
id|bad_block
suffix:colon
id|ext3_error
c_func
(paren
id|inode-&gt;i_sb
comma
id|__FUNCTION__
comma
l_string|&quot;inode %ld: bad block %d&quot;
comma
id|inode-&gt;i_ino
comma
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_file_acl
)paren
suffix:semicolon
id|error
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
id|ext3_xattr_cache_insert
c_func
(paren
id|bh
)paren
suffix:semicolon
id|entry
op_assign
id|BFIRST
c_func
(paren
id|bh
)paren
suffix:semicolon
id|error
op_assign
id|ext3_xattr_find_entry
c_func
(paren
op_amp
id|entry
comma
id|name_index
comma
id|name
comma
id|bh-&gt;b_size
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_eq
op_minus
id|EIO
)paren
r_goto
id|bad_block
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|cleanup
suffix:semicolon
id|size
op_assign
id|le32_to_cpu
c_func
(paren
id|entry-&gt;e_value_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buffer
)paren
(brace
id|error
op_assign
op_minus
id|ERANGE
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|buffer_size
)paren
r_goto
id|cleanup
suffix:semicolon
id|memcpy
c_func
(paren
id|buffer
comma
id|bh-&gt;b_data
op_plus
id|le16_to_cpu
c_func
(paren
id|entry-&gt;e_value_offs
)paren
comma
id|size
)paren
suffix:semicolon
)brace
id|error
op_assign
id|size
suffix:semicolon
id|cleanup
suffix:colon
id|brelse
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_static
r_int
DECL|function|ext3_xattr_ibody_get
id|ext3_xattr_ibody_get
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|name_index
comma
r_const
r_char
op_star
id|name
comma
r_void
op_star
id|buffer
comma
r_int
id|buffer_size
)paren
(brace
r_struct
id|ext3_xattr_ibody_header
op_star
id|header
suffix:semicolon
r_struct
id|ext3_xattr_entry
op_star
id|entry
suffix:semicolon
r_struct
id|ext3_inode
op_star
id|raw_inode
suffix:semicolon
r_struct
id|ext3_iloc
id|iloc
suffix:semicolon
r_int
id|size
suffix:semicolon
r_void
op_star
id|end
suffix:semicolon
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
id|EXT3_SB
c_func
(paren
id|inode-&gt;i_sb
)paren
op_member_access_from_pointer
id|s_inode_size
op_le
id|EXT3_GOOD_OLD_INODE_SIZE
op_logical_or
op_logical_neg
(paren
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_state
op_amp
id|EXT3_STATE_XATTR
)paren
)paren
r_return
op_minus
id|ENODATA
suffix:semicolon
id|error
op_assign
id|ext3_get_inode_loc
c_func
(paren
id|inode
comma
op_amp
id|iloc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
id|raw_inode
op_assign
id|ext3_raw_inode
c_func
(paren
op_amp
id|iloc
)paren
suffix:semicolon
id|header
op_assign
id|IHDR
c_func
(paren
id|inode
comma
id|raw_inode
)paren
suffix:semicolon
id|entry
op_assign
id|IFIRST
c_func
(paren
id|header
)paren
suffix:semicolon
id|end
op_assign
(paren
r_void
op_star
)paren
id|raw_inode
op_plus
id|EXT3_SB
c_func
(paren
id|inode-&gt;i_sb
)paren
op_member_access_from_pointer
id|s_inode_size
suffix:semicolon
id|error
op_assign
id|ext3_xattr_check_names
c_func
(paren
id|entry
comma
id|end
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|cleanup
suffix:semicolon
id|error
op_assign
id|ext3_xattr_find_entry
c_func
(paren
op_amp
id|entry
comma
id|name_index
comma
id|name
comma
id|end
op_minus
(paren
r_void
op_star
)paren
id|entry
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|cleanup
suffix:semicolon
id|size
op_assign
id|le32_to_cpu
c_func
(paren
id|entry-&gt;e_value_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buffer
)paren
(brace
id|error
op_assign
op_minus
id|ERANGE
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|buffer_size
)paren
r_goto
id|cleanup
suffix:semicolon
id|memcpy
c_func
(paren
id|buffer
comma
(paren
r_void
op_star
)paren
id|IFIRST
c_func
(paren
id|header
)paren
op_plus
id|le16_to_cpu
c_func
(paren
id|entry-&gt;e_value_offs
)paren
comma
id|size
)paren
suffix:semicolon
)brace
id|error
op_assign
id|size
suffix:semicolon
id|cleanup
suffix:colon
id|brelse
c_func
(paren
id|iloc.bh
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/*&n; * ext3_xattr_get()&n; *&n; * Copy an extended attribute into the buffer&n; * provided, or compute the buffer size required.&n; * Buffer is NULL to compute the size of the buffer required.&n; *&n; * Returns a negative error number on failure, or the number of bytes&n; * used / required on success.&n; */
r_int
DECL|function|ext3_xattr_get
id|ext3_xattr_get
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|name_index
comma
r_const
r_char
op_star
id|name
comma
r_void
op_star
id|buffer
comma
r_int
id|buffer_size
)paren
(brace
r_int
id|error
suffix:semicolon
id|down_read
c_func
(paren
op_amp
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|xattr_sem
)paren
suffix:semicolon
id|error
op_assign
id|ext3_xattr_ibody_get
c_func
(paren
id|inode
comma
id|name_index
comma
id|name
comma
id|buffer
comma
id|buffer_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_eq
op_minus
id|ENODATA
)paren
id|error
op_assign
id|ext3_xattr_block_get
c_func
(paren
id|inode
comma
id|name_index
comma
id|name
comma
id|buffer
comma
id|buffer_size
)paren
suffix:semicolon
id|up_read
c_func
(paren
op_amp
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|xattr_sem
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_static
r_int
DECL|function|ext3_xattr_list_entries
id|ext3_xattr_list_entries
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|ext3_xattr_entry
op_star
id|entry
comma
r_char
op_star
id|buffer
comma
r_int
id|buffer_size
)paren
(brace
r_int
id|rest
op_assign
id|buffer_size
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
op_logical_neg
id|IS_LAST_ENTRY
c_func
(paren
id|entry
)paren
suffix:semicolon
id|entry
op_assign
id|EXT3_XATTR_NEXT
c_func
(paren
id|entry
)paren
)paren
(brace
r_struct
id|xattr_handler
op_star
id|handler
op_assign
id|ext3_xattr_handler
c_func
(paren
id|entry-&gt;e_name_index
)paren
suffix:semicolon
r_if
c_cond
(paren
id|handler
)paren
(brace
r_int
id|size
op_assign
id|handler
op_member_access_from_pointer
id|list
c_func
(paren
id|inode
comma
id|buffer
comma
id|rest
comma
id|entry-&gt;e_name
comma
id|entry-&gt;e_name_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buffer
)paren
(brace
r_if
c_cond
(paren
id|size
OG
id|rest
)paren
r_return
op_minus
id|ERANGE
suffix:semicolon
id|buffer
op_add_assign
id|size
suffix:semicolon
)brace
id|rest
op_sub_assign
id|size
suffix:semicolon
)brace
)brace
r_return
id|buffer_size
op_minus
id|rest
suffix:semicolon
)brace
r_int
DECL|function|ext3_xattr_block_list
id|ext3_xattr_block_list
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_char
op_star
id|buffer
comma
r_int
id|buffer_size
)paren
(brace
r_struct
id|buffer_head
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
r_int
id|error
suffix:semicolon
id|ea_idebug
c_func
(paren
id|inode
comma
l_string|&quot;buffer=%p, buffer_size=%ld&quot;
comma
id|buffer
comma
(paren
r_int
)paren
id|buffer_size
)paren
suffix:semicolon
id|error
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_file_acl
)paren
r_goto
id|cleanup
suffix:semicolon
id|ea_idebug
c_func
(paren
id|inode
comma
l_string|&quot;reading block %d&quot;
comma
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_file_acl
)paren
suffix:semicolon
id|bh
op_assign
id|sb_bread
c_func
(paren
id|inode-&gt;i_sb
comma
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_file_acl
)paren
suffix:semicolon
id|error
op_assign
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bh
)paren
r_goto
id|cleanup
suffix:semicolon
id|ea_bdebug
c_func
(paren
id|bh
comma
l_string|&quot;b_count=%d, refcount=%d&quot;
comma
id|atomic_read
c_func
(paren
op_amp
(paren
id|bh-&gt;b_count
)paren
)paren
comma
id|le32_to_cpu
c_func
(paren
id|BHDR
c_func
(paren
id|bh
)paren
op_member_access_from_pointer
id|h_refcount
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ext3_xattr_check_block
c_func
(paren
id|bh
)paren
)paren
(brace
id|ext3_error
c_func
(paren
id|inode-&gt;i_sb
comma
id|__FUNCTION__
comma
l_string|&quot;inode %ld: bad block %d&quot;
comma
id|inode-&gt;i_ino
comma
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_file_acl
)paren
suffix:semicolon
id|error
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
id|ext3_xattr_cache_insert
c_func
(paren
id|bh
)paren
suffix:semicolon
id|error
op_assign
id|ext3_xattr_list_entries
c_func
(paren
id|inode
comma
id|BFIRST
c_func
(paren
id|bh
)paren
comma
id|buffer
comma
id|buffer_size
)paren
suffix:semicolon
id|cleanup
suffix:colon
id|brelse
c_func
(paren
id|bh
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_static
r_int
DECL|function|ext3_xattr_ibody_list
id|ext3_xattr_ibody_list
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_char
op_star
id|buffer
comma
r_int
id|buffer_size
)paren
(brace
r_struct
id|ext3_xattr_ibody_header
op_star
id|header
suffix:semicolon
r_struct
id|ext3_inode
op_star
id|raw_inode
suffix:semicolon
r_struct
id|ext3_iloc
id|iloc
suffix:semicolon
r_void
op_star
id|end
suffix:semicolon
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
id|EXT3_SB
c_func
(paren
id|inode-&gt;i_sb
)paren
op_member_access_from_pointer
id|s_inode_size
op_le
id|EXT3_GOOD_OLD_INODE_SIZE
op_logical_or
op_logical_neg
(paren
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_state
op_amp
id|EXT3_STATE_XATTR
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|error
op_assign
id|ext3_get_inode_loc
c_func
(paren
id|inode
comma
op_amp
id|iloc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
id|raw_inode
op_assign
id|ext3_raw_inode
c_func
(paren
op_amp
id|iloc
)paren
suffix:semicolon
id|header
op_assign
id|IHDR
c_func
(paren
id|inode
comma
id|raw_inode
)paren
suffix:semicolon
id|end
op_assign
(paren
r_void
op_star
)paren
id|raw_inode
op_plus
id|EXT3_SB
c_func
(paren
id|inode-&gt;i_sb
)paren
op_member_access_from_pointer
id|s_inode_size
suffix:semicolon
id|error
op_assign
id|ext3_xattr_check_names
c_func
(paren
id|IFIRST
c_func
(paren
id|header
)paren
comma
id|end
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|cleanup
suffix:semicolon
id|error
op_assign
id|ext3_xattr_list_entries
c_func
(paren
id|inode
comma
id|IFIRST
c_func
(paren
id|header
)paren
comma
id|buffer
comma
id|buffer_size
)paren
suffix:semicolon
id|cleanup
suffix:colon
id|brelse
c_func
(paren
id|iloc.bh
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/*&n; * ext3_xattr_list()&n; *&n; * Copy a list of attribute names into the buffer&n; * provided, or compute the buffer size required.&n; * Buffer is NULL to compute the size of the buffer required.&n; *&n; * Returns a negative error number on failure, or the number of bytes&n; * used / required on success.&n; */
r_int
DECL|function|ext3_xattr_list
id|ext3_xattr_list
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_char
op_star
id|buffer
comma
r_int
id|buffer_size
)paren
(brace
r_int
id|i_error
comma
id|b_error
suffix:semicolon
id|down_read
c_func
(paren
op_amp
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|xattr_sem
)paren
suffix:semicolon
id|i_error
op_assign
id|ext3_xattr_ibody_list
c_func
(paren
id|inode
comma
id|buffer
comma
id|buffer_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i_error
OL
l_int|0
)paren
(brace
id|b_error
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|buffer
)paren
(brace
id|buffer
op_add_assign
id|i_error
suffix:semicolon
id|buffer_size
op_sub_assign
id|i_error
suffix:semicolon
)brace
id|b_error
op_assign
id|ext3_xattr_block_list
c_func
(paren
id|inode
comma
id|buffer
comma
id|buffer_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|b_error
OL
l_int|0
)paren
id|i_error
op_assign
l_int|0
suffix:semicolon
)brace
id|up_read
c_func
(paren
op_amp
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|xattr_sem
)paren
suffix:semicolon
r_return
id|i_error
op_plus
id|b_error
suffix:semicolon
)brace
multiline_comment|/*&n; * If the EXT3_FEATURE_COMPAT_EXT_ATTR feature of this file system is&n; * not set, set it.&n; */
DECL|function|ext3_xattr_update_super_block
r_static
r_void
id|ext3_xattr_update_super_block
c_func
(paren
id|handle_t
op_star
id|handle
comma
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_if
c_cond
(paren
id|EXT3_HAS_COMPAT_FEATURE
c_func
(paren
id|sb
comma
id|EXT3_FEATURE_COMPAT_EXT_ATTR
)paren
)paren
r_return
suffix:semicolon
id|lock_super
c_func
(paren
id|sb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ext3_journal_get_write_access
c_func
(paren
id|handle
comma
id|EXT3_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_sbh
)paren
op_eq
l_int|0
)paren
(brace
id|EXT3_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_es-&gt;s_feature_compat
op_or_assign
id|cpu_to_le32
c_func
(paren
id|EXT3_FEATURE_COMPAT_EXT_ATTR
)paren
suffix:semicolon
id|sb-&gt;s_dirt
op_assign
l_int|1
suffix:semicolon
id|ext3_journal_dirty_metadata
c_func
(paren
id|handle
comma
id|EXT3_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_sbh
)paren
suffix:semicolon
)brace
id|unlock_super
c_func
(paren
id|sb
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Release the xattr block BH: If the reference count is &gt; 1, decrement&n; * it; otherwise free the block.&n; */
r_static
r_void
DECL|function|ext3_xattr_release_block
id|ext3_xattr_release_block
c_func
(paren
id|handle_t
op_star
id|handle
comma
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|buffer_head
op_star
id|bh
)paren
(brace
r_struct
id|mb_cache_entry
op_star
id|ce
op_assign
l_int|NULL
suffix:semicolon
id|ce
op_assign
id|mb_cache_entry_get
c_func
(paren
id|ext3_xattr_cache
comma
id|bh-&gt;b_bdev
comma
id|bh-&gt;b_blocknr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|BHDR
c_func
(paren
id|bh
)paren
op_member_access_from_pointer
id|h_refcount
op_eq
id|cpu_to_le32
c_func
(paren
l_int|1
)paren
)paren
(brace
id|ea_bdebug
c_func
(paren
id|bh
comma
l_string|&quot;refcount now=0; freeing&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ce
)paren
id|mb_cache_entry_free
c_func
(paren
id|ce
)paren
suffix:semicolon
id|ext3_free_blocks
c_func
(paren
id|handle
comma
id|inode
comma
id|bh-&gt;b_blocknr
comma
l_int|1
)paren
suffix:semicolon
id|get_bh
c_func
(paren
id|bh
)paren
suffix:semicolon
id|ext3_forget
c_func
(paren
id|handle
comma
l_int|1
comma
id|inode
comma
id|bh
comma
id|bh-&gt;b_blocknr
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ext3_journal_get_write_access
c_func
(paren
id|handle
comma
id|bh
)paren
op_eq
l_int|0
)paren
(brace
id|lock_buffer
c_func
(paren
id|bh
)paren
suffix:semicolon
id|BHDR
c_func
(paren
id|bh
)paren
op_member_access_from_pointer
id|h_refcount
op_assign
id|cpu_to_le32
c_func
(paren
id|le32_to_cpu
c_func
(paren
id|BHDR
c_func
(paren
id|bh
)paren
op_member_access_from_pointer
id|h_refcount
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|ext3_journal_dirty_metadata
c_func
(paren
id|handle
comma
id|bh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_SYNC
c_func
(paren
id|inode
)paren
)paren
id|handle-&gt;h_sync
op_assign
l_int|1
suffix:semicolon
id|DQUOT_FREE_BLOCK
c_func
(paren
id|inode
comma
l_int|1
)paren
suffix:semicolon
id|unlock_buffer
c_func
(paren
id|bh
)paren
suffix:semicolon
id|ea_bdebug
c_func
(paren
id|bh
comma
l_string|&quot;refcount now=%d; releasing&quot;
comma
id|le32_to_cpu
c_func
(paren
id|BHDR
c_func
(paren
id|bh
)paren
op_member_access_from_pointer
id|h_refcount
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ce
)paren
id|mb_cache_entry_release
c_func
(paren
id|ce
)paren
suffix:semicolon
)brace
)brace
DECL|struct|ext3_xattr_info
r_struct
id|ext3_xattr_info
(brace
DECL|member|name_index
r_int
id|name_index
suffix:semicolon
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|value
r_const
r_void
op_star
id|value
suffix:semicolon
DECL|member|value_len
r_int
id|value_len
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|ext3_xattr_search
r_struct
id|ext3_xattr_search
(brace
DECL|member|first
r_struct
id|ext3_xattr_entry
op_star
id|first
suffix:semicolon
DECL|member|base
r_void
op_star
id|base
suffix:semicolon
DECL|member|end
r_void
op_star
id|end
suffix:semicolon
DECL|member|here
r_struct
id|ext3_xattr_entry
op_star
id|here
suffix:semicolon
DECL|member|not_found
r_int
id|not_found
suffix:semicolon
)brace
suffix:semicolon
r_static
r_int
DECL|function|ext3_xattr_set_entry
id|ext3_xattr_set_entry
c_func
(paren
r_struct
id|ext3_xattr_info
op_star
id|i
comma
r_struct
id|ext3_xattr_search
op_star
id|s
)paren
(brace
r_struct
id|ext3_xattr_entry
op_star
id|last
suffix:semicolon
r_int
id|free
comma
id|min_offs
op_assign
id|s-&gt;end
op_minus
id|s-&gt;base
comma
id|name_len
op_assign
id|strlen
c_func
(paren
id|i-&gt;name
)paren
suffix:semicolon
multiline_comment|/* Compute min_offs and last. */
id|last
op_assign
id|s-&gt;first
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
op_logical_neg
id|IS_LAST_ENTRY
c_func
(paren
id|last
)paren
suffix:semicolon
id|last
op_assign
id|EXT3_XATTR_NEXT
c_func
(paren
id|last
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|last-&gt;e_value_block
op_logical_and
id|last-&gt;e_value_size
)paren
(brace
r_int
id|offs
op_assign
id|le16_to_cpu
c_func
(paren
id|last-&gt;e_value_offs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|offs
OL
id|min_offs
)paren
id|min_offs
op_assign
id|offs
suffix:semicolon
)brace
)brace
id|free
op_assign
id|min_offs
op_minus
(paren
(paren
r_void
op_star
)paren
id|last
op_minus
id|s-&gt;base
)paren
op_minus
r_sizeof
(paren
id|__u32
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;not_found
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;here-&gt;e_value_block
op_logical_and
id|s-&gt;here-&gt;e_value_size
)paren
(brace
r_int
id|size
op_assign
id|le32_to_cpu
c_func
(paren
id|s-&gt;here-&gt;e_value_size
)paren
suffix:semicolon
id|free
op_add_assign
id|EXT3_XATTR_SIZE
c_func
(paren
id|size
)paren
suffix:semicolon
)brace
id|free
op_add_assign
id|EXT3_XATTR_LEN
c_func
(paren
id|name_len
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i-&gt;value
)paren
(brace
r_if
c_cond
(paren
id|free
OL
id|EXT3_XATTR_SIZE
c_func
(paren
id|i-&gt;value_len
)paren
op_logical_or
id|free
OL
id|EXT3_XATTR_LEN
c_func
(paren
id|name_len
)paren
op_plus
id|EXT3_XATTR_SIZE
c_func
(paren
id|i-&gt;value_len
)paren
)paren
r_return
op_minus
id|ENOSPC
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i-&gt;value
op_logical_and
id|s-&gt;not_found
)paren
(brace
multiline_comment|/* Insert the new name. */
r_int
id|size
op_assign
id|EXT3_XATTR_LEN
c_func
(paren
id|name_len
)paren
suffix:semicolon
r_int
id|rest
op_assign
(paren
r_void
op_star
)paren
id|last
op_minus
(paren
r_void
op_star
)paren
id|s-&gt;here
op_plus
r_sizeof
(paren
id|__u32
)paren
suffix:semicolon
id|memmove
c_func
(paren
(paren
r_void
op_star
)paren
id|s-&gt;here
op_plus
id|size
comma
id|s-&gt;here
comma
id|rest
)paren
suffix:semicolon
id|memset
c_func
(paren
id|s-&gt;here
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
id|s-&gt;here-&gt;e_name_index
op_assign
id|i-&gt;name_index
suffix:semicolon
id|s-&gt;here-&gt;e_name_len
op_assign
id|name_len
suffix:semicolon
id|memcpy
c_func
(paren
id|s-&gt;here-&gt;e_name
comma
id|i-&gt;name
comma
id|name_len
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;here-&gt;e_value_block
op_logical_and
id|s-&gt;here-&gt;e_value_size
)paren
(brace
r_void
op_star
id|first_val
op_assign
id|s-&gt;base
op_plus
id|min_offs
suffix:semicolon
r_int
id|offs
op_assign
id|le16_to_cpu
c_func
(paren
id|s-&gt;here-&gt;e_value_offs
)paren
suffix:semicolon
r_void
op_star
id|val
op_assign
id|s-&gt;base
op_plus
id|offs
suffix:semicolon
r_int
id|size
op_assign
id|EXT3_XATTR_SIZE
c_func
(paren
id|le32_to_cpu
c_func
(paren
id|s-&gt;here-&gt;e_value_size
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i-&gt;value
op_logical_and
id|size
op_eq
id|EXT3_XATTR_SIZE
c_func
(paren
id|i-&gt;value_len
)paren
)paren
(brace
multiline_comment|/* The old and the new value have the same&n;&t;&t;&t;&t;   size. Just replace. */
id|s-&gt;here-&gt;e_value_size
op_assign
id|cpu_to_le32
c_func
(paren
id|i-&gt;value_len
)paren
suffix:semicolon
id|memset
c_func
(paren
id|val
op_plus
id|size
op_minus
id|EXT3_XATTR_PAD
comma
l_int|0
comma
id|EXT3_XATTR_PAD
)paren
suffix:semicolon
multiline_comment|/* Clear pad bytes. */
id|memcpy
c_func
(paren
id|val
comma
id|i-&gt;value
comma
id|i-&gt;value_len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Remove the old value. */
id|memmove
c_func
(paren
id|first_val
op_plus
id|size
comma
id|first_val
comma
id|val
op_minus
id|first_val
)paren
suffix:semicolon
id|memset
c_func
(paren
id|first_val
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
id|s-&gt;here-&gt;e_value_size
op_assign
l_int|0
suffix:semicolon
id|s-&gt;here-&gt;e_value_offs
op_assign
l_int|0
suffix:semicolon
id|min_offs
op_add_assign
id|size
suffix:semicolon
multiline_comment|/* Adjust all value offsets. */
id|last
op_assign
id|s-&gt;first
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|IS_LAST_ENTRY
c_func
(paren
id|last
)paren
)paren
(brace
r_int
id|o
op_assign
id|le16_to_cpu
c_func
(paren
id|last-&gt;e_value_offs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|last-&gt;e_value_block
op_logical_and
id|last-&gt;e_value_size
op_logical_and
id|o
OL
id|offs
)paren
id|last-&gt;e_value_offs
op_assign
id|cpu_to_le16
c_func
(paren
id|o
op_plus
id|size
)paren
suffix:semicolon
id|last
op_assign
id|EXT3_XATTR_NEXT
c_func
(paren
id|last
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|i-&gt;value
)paren
(brace
multiline_comment|/* Remove the old name. */
r_int
id|size
op_assign
id|EXT3_XATTR_LEN
c_func
(paren
id|name_len
)paren
suffix:semicolon
id|last
op_assign
id|ENTRY
c_func
(paren
(paren
r_void
op_star
)paren
id|last
op_minus
id|size
)paren
suffix:semicolon
id|memmove
c_func
(paren
id|s-&gt;here
comma
(paren
r_void
op_star
)paren
id|s-&gt;here
op_plus
id|size
comma
(paren
r_void
op_star
)paren
id|last
op_minus
(paren
r_void
op_star
)paren
id|s-&gt;here
op_plus
r_sizeof
(paren
id|__u32
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|last
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i-&gt;value
)paren
(brace
multiline_comment|/* Insert the new value. */
id|s-&gt;here-&gt;e_value_size
op_assign
id|cpu_to_le32
c_func
(paren
id|i-&gt;value_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i-&gt;value_len
)paren
(brace
r_int
id|size
op_assign
id|EXT3_XATTR_SIZE
c_func
(paren
id|i-&gt;value_len
)paren
suffix:semicolon
r_void
op_star
id|val
op_assign
id|s-&gt;base
op_plus
id|min_offs
op_minus
id|size
suffix:semicolon
id|s-&gt;here-&gt;e_value_offs
op_assign
id|cpu_to_le16
c_func
(paren
id|min_offs
op_minus
id|size
)paren
suffix:semicolon
id|memset
c_func
(paren
id|val
op_plus
id|size
op_minus
id|EXT3_XATTR_PAD
comma
l_int|0
comma
id|EXT3_XATTR_PAD
)paren
suffix:semicolon
multiline_comment|/* Clear the pad bytes. */
id|memcpy
c_func
(paren
id|val
comma
id|i-&gt;value
comma
id|i-&gt;value_len
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|struct|ext3_xattr_block_find
r_struct
id|ext3_xattr_block_find
(brace
DECL|member|s
r_struct
id|ext3_xattr_search
id|s
suffix:semicolon
DECL|member|bh
r_struct
id|buffer_head
op_star
id|bh
suffix:semicolon
)brace
suffix:semicolon
r_int
DECL|function|ext3_xattr_block_find
id|ext3_xattr_block_find
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|ext3_xattr_info
op_star
id|i
comma
r_struct
id|ext3_xattr_block_find
op_star
id|bs
)paren
(brace
r_struct
id|super_block
op_star
id|sb
op_assign
id|inode-&gt;i_sb
suffix:semicolon
r_int
id|error
suffix:semicolon
id|ea_idebug
c_func
(paren
id|inode
comma
l_string|&quot;name=%d.%s, value=%p, value_len=%ld&quot;
comma
id|i-&gt;name_index
comma
id|i-&gt;name
comma
id|i-&gt;value
comma
(paren
r_int
)paren
id|i-&gt;value_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_file_acl
)paren
(brace
multiline_comment|/* The inode already has an extended attribute block. */
id|bs-&gt;bh
op_assign
id|sb_bread
c_func
(paren
id|sb
comma
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_file_acl
)paren
suffix:semicolon
id|error
op_assign
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bs-&gt;bh
)paren
r_goto
id|cleanup
suffix:semicolon
id|ea_bdebug
c_func
(paren
id|bs-&gt;bh
comma
l_string|&quot;b_count=%d, refcount=%d&quot;
comma
id|atomic_read
c_func
(paren
op_amp
(paren
id|bs-&gt;bh-&gt;b_count
)paren
)paren
comma
id|le32_to_cpu
c_func
(paren
id|BHDR
c_func
(paren
id|bs-&gt;bh
)paren
op_member_access_from_pointer
id|h_refcount
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ext3_xattr_check_block
c_func
(paren
id|bs-&gt;bh
)paren
)paren
(brace
id|ext3_error
c_func
(paren
id|sb
comma
id|__FUNCTION__
comma
l_string|&quot;inode %ld: bad block %d&quot;
comma
id|inode-&gt;i_ino
comma
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_file_acl
)paren
suffix:semicolon
id|error
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
multiline_comment|/* Find the named attribute. */
id|bs-&gt;s.base
op_assign
id|BHDR
c_func
(paren
id|bs-&gt;bh
)paren
suffix:semicolon
id|bs-&gt;s.first
op_assign
id|BFIRST
c_func
(paren
id|bs-&gt;bh
)paren
suffix:semicolon
id|bs-&gt;s.end
op_assign
id|bs-&gt;bh-&gt;b_data
op_plus
id|bs-&gt;bh-&gt;b_size
suffix:semicolon
id|bs-&gt;s.here
op_assign
id|bs-&gt;s.first
suffix:semicolon
id|error
op_assign
id|ext3_xattr_find_entry
c_func
(paren
op_amp
id|bs-&gt;s.here
comma
id|i-&gt;name_index
comma
id|i-&gt;name
comma
id|bs-&gt;bh-&gt;b_size
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_logical_and
id|error
op_ne
op_minus
id|ENODATA
)paren
r_goto
id|cleanup
suffix:semicolon
id|bs-&gt;s.not_found
op_assign
id|error
suffix:semicolon
)brace
id|error
op_assign
l_int|0
suffix:semicolon
id|cleanup
suffix:colon
r_return
id|error
suffix:semicolon
)brace
r_static
r_int
DECL|function|ext3_xattr_block_set
id|ext3_xattr_block_set
c_func
(paren
id|handle_t
op_star
id|handle
comma
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|ext3_xattr_info
op_star
id|i
comma
r_struct
id|ext3_xattr_block_find
op_star
id|bs
)paren
(brace
r_struct
id|super_block
op_star
id|sb
op_assign
id|inode-&gt;i_sb
suffix:semicolon
r_struct
id|buffer_head
op_star
id|new_bh
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|ext3_xattr_search
op_star
id|s
op_assign
op_amp
id|bs-&gt;s
suffix:semicolon
r_struct
id|mb_cache_entry
op_star
id|ce
op_assign
l_int|NULL
suffix:semicolon
r_int
id|error
suffix:semicolon
DECL|macro|header
mdefine_line|#define header(x) ((struct ext3_xattr_header *)(x))
r_if
c_cond
(paren
id|i-&gt;value
op_logical_and
id|i-&gt;value_len
OG
id|sb-&gt;s_blocksize
)paren
r_return
op_minus
id|ENOSPC
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;base
)paren
(brace
id|ce
op_assign
id|mb_cache_entry_get
c_func
(paren
id|ext3_xattr_cache
comma
id|bs-&gt;bh-&gt;b_bdev
comma
id|bs-&gt;bh-&gt;b_blocknr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|header
c_func
(paren
id|s-&gt;base
)paren
op_member_access_from_pointer
id|h_refcount
op_eq
id|cpu_to_le32
c_func
(paren
l_int|1
)paren
)paren
(brace
r_if
c_cond
(paren
id|ce
)paren
(brace
id|mb_cache_entry_free
c_func
(paren
id|ce
)paren
suffix:semicolon
id|ce
op_assign
l_int|NULL
suffix:semicolon
)brace
id|ea_bdebug
c_func
(paren
id|bs-&gt;bh
comma
l_string|&quot;modifying in-place&quot;
)paren
suffix:semicolon
id|error
op_assign
id|ext3_journal_get_write_access
c_func
(paren
id|handle
comma
id|bs-&gt;bh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|cleanup
suffix:semicolon
id|lock_buffer
c_func
(paren
id|bs-&gt;bh
)paren
suffix:semicolon
id|error
op_assign
id|ext3_xattr_set_entry
c_func
(paren
id|i
comma
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|IS_LAST_ENTRY
c_func
(paren
id|s-&gt;first
)paren
)paren
id|ext3_xattr_rehash
c_func
(paren
id|header
c_func
(paren
id|s-&gt;base
)paren
comma
id|s-&gt;here
)paren
suffix:semicolon
id|ext3_xattr_cache_insert
c_func
(paren
id|bs-&gt;bh
)paren
suffix:semicolon
)brace
id|unlock_buffer
c_func
(paren
id|bs-&gt;bh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_eq
op_minus
id|EIO
)paren
r_goto
id|bad_block
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
id|error
op_assign
id|ext3_journal_dirty_metadata
c_func
(paren
id|handle
comma
id|bs-&gt;bh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|cleanup
suffix:semicolon
r_goto
id|inserted
suffix:semicolon
)brace
r_else
(brace
r_int
id|offset
op_assign
(paren
r_char
op_star
)paren
id|s-&gt;here
op_minus
id|bs-&gt;bh-&gt;b_data
suffix:semicolon
r_if
c_cond
(paren
id|ce
)paren
(brace
id|mb_cache_entry_release
c_func
(paren
id|ce
)paren
suffix:semicolon
id|ce
op_assign
l_int|NULL
suffix:semicolon
)brace
id|ea_bdebug
c_func
(paren
id|bs-&gt;bh
comma
l_string|&quot;cloning&quot;
)paren
suffix:semicolon
id|s-&gt;base
op_assign
id|kmalloc
c_func
(paren
id|bs-&gt;bh-&gt;b_size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|error
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;base
op_eq
l_int|NULL
)paren
r_goto
id|cleanup
suffix:semicolon
id|memcpy
c_func
(paren
id|s-&gt;base
comma
id|BHDR
c_func
(paren
id|bs-&gt;bh
)paren
comma
id|bs-&gt;bh-&gt;b_size
)paren
suffix:semicolon
id|s-&gt;first
op_assign
id|ENTRY
c_func
(paren
id|header
c_func
(paren
id|s-&gt;base
)paren
op_plus
l_int|1
)paren
suffix:semicolon
id|header
c_func
(paren
id|s-&gt;base
)paren
op_member_access_from_pointer
id|h_refcount
op_assign
id|cpu_to_le32
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|s-&gt;here
op_assign
id|ENTRY
c_func
(paren
id|s-&gt;base
op_plus
id|offset
)paren
suffix:semicolon
id|s-&gt;end
op_assign
id|s-&gt;base
op_plus
id|bs-&gt;bh-&gt;b_size
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* Allocate a buffer where we construct the new block. */
id|s-&gt;base
op_assign
id|kmalloc
c_func
(paren
id|sb-&gt;s_blocksize
comma
id|GFP_KERNEL
)paren
suffix:semicolon
multiline_comment|/* assert(header == s-&gt;base) */
id|error
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;base
op_eq
l_int|NULL
)paren
r_goto
id|cleanup
suffix:semicolon
id|memset
c_func
(paren
id|s-&gt;base
comma
l_int|0
comma
id|sb-&gt;s_blocksize
)paren
suffix:semicolon
id|header
c_func
(paren
id|s-&gt;base
)paren
op_member_access_from_pointer
id|h_magic
op_assign
id|cpu_to_le32
c_func
(paren
id|EXT3_XATTR_MAGIC
)paren
suffix:semicolon
id|header
c_func
(paren
id|s-&gt;base
)paren
op_member_access_from_pointer
id|h_blocks
op_assign
id|cpu_to_le32
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|header
c_func
(paren
id|s-&gt;base
)paren
op_member_access_from_pointer
id|h_refcount
op_assign
id|cpu_to_le32
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|s-&gt;first
op_assign
id|ENTRY
c_func
(paren
id|header
c_func
(paren
id|s-&gt;base
)paren
op_plus
l_int|1
)paren
suffix:semicolon
id|s-&gt;here
op_assign
id|ENTRY
c_func
(paren
id|header
c_func
(paren
id|s-&gt;base
)paren
op_plus
l_int|1
)paren
suffix:semicolon
id|s-&gt;end
op_assign
id|s-&gt;base
op_plus
id|sb-&gt;s_blocksize
suffix:semicolon
)brace
id|error
op_assign
id|ext3_xattr_set_entry
c_func
(paren
id|i
comma
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_eq
op_minus
id|EIO
)paren
r_goto
id|bad_block
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|cleanup
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_LAST_ENTRY
c_func
(paren
id|s-&gt;first
)paren
)paren
id|ext3_xattr_rehash
c_func
(paren
id|header
c_func
(paren
id|s-&gt;base
)paren
comma
id|s-&gt;here
)paren
suffix:semicolon
id|inserted
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|IS_LAST_ENTRY
c_func
(paren
id|s-&gt;first
)paren
)paren
(brace
id|new_bh
op_assign
id|ext3_xattr_cache_find
c_func
(paren
id|inode
comma
id|header
c_func
(paren
id|s-&gt;base
)paren
comma
op_amp
id|ce
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_bh
)paren
(brace
multiline_comment|/* We found an identical block in the cache. */
r_if
c_cond
(paren
id|new_bh
op_eq
id|bs-&gt;bh
)paren
id|ea_bdebug
c_func
(paren
id|new_bh
comma
l_string|&quot;keeping&quot;
)paren
suffix:semicolon
r_else
(brace
multiline_comment|/* The old block is released after updating&n;&t;&t;&t;&t;   the inode. */
id|error
op_assign
op_minus
id|EDQUOT
suffix:semicolon
r_if
c_cond
(paren
id|DQUOT_ALLOC_BLOCK
c_func
(paren
id|inode
comma
l_int|1
)paren
)paren
r_goto
id|cleanup
suffix:semicolon
id|error
op_assign
id|ext3_journal_get_write_access
c_func
(paren
id|handle
comma
id|new_bh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|cleanup
suffix:semicolon
id|lock_buffer
c_func
(paren
id|new_bh
)paren
suffix:semicolon
id|BHDR
c_func
(paren
id|new_bh
)paren
op_member_access_from_pointer
id|h_refcount
op_assign
id|cpu_to_le32
c_func
(paren
l_int|1
op_plus
id|le32_to_cpu
c_func
(paren
id|BHDR
c_func
(paren
id|new_bh
)paren
op_member_access_from_pointer
id|h_refcount
)paren
)paren
suffix:semicolon
id|ea_bdebug
c_func
(paren
id|new_bh
comma
l_string|&quot;reusing; refcount now=%d&quot;
comma
id|le32_to_cpu
c_func
(paren
id|BHDR
c_func
(paren
id|new_bh
)paren
op_member_access_from_pointer
id|h_refcount
)paren
)paren
suffix:semicolon
id|unlock_buffer
c_func
(paren
id|new_bh
)paren
suffix:semicolon
id|error
op_assign
id|ext3_journal_dirty_metadata
c_func
(paren
id|handle
comma
id|new_bh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|cleanup
suffix:semicolon
)brace
id|mb_cache_entry_release
c_func
(paren
id|ce
)paren
suffix:semicolon
id|ce
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bs-&gt;bh
op_logical_and
id|s-&gt;base
op_eq
id|bs-&gt;bh-&gt;b_data
)paren
(brace
multiline_comment|/* We were modifying this block in-place. */
id|ea_bdebug
c_func
(paren
id|bs-&gt;bh
comma
l_string|&quot;keeping this block&quot;
)paren
suffix:semicolon
id|new_bh
op_assign
id|bs-&gt;bh
suffix:semicolon
id|get_bh
c_func
(paren
id|new_bh
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* We need to allocate a new block */
r_int
id|goal
op_assign
id|le32_to_cpu
c_func
(paren
id|EXT3_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_es-&gt;s_first_data_block
)paren
op_plus
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_block_group
op_star
id|EXT3_BLOCKS_PER_GROUP
c_func
(paren
id|sb
)paren
suffix:semicolon
r_int
id|block
op_assign
id|ext3_new_block
c_func
(paren
id|handle
comma
id|inode
comma
id|goal
comma
op_amp
id|error
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|cleanup
suffix:semicolon
id|ea_idebug
c_func
(paren
id|inode
comma
l_string|&quot;creating block %d&quot;
comma
id|block
)paren
suffix:semicolon
id|new_bh
op_assign
id|sb_getblk
c_func
(paren
id|sb
comma
id|block
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|new_bh
)paren
(brace
id|getblk_failed
suffix:colon
id|ext3_free_blocks
c_func
(paren
id|handle
comma
id|inode
comma
id|block
comma
l_int|1
)paren
suffix:semicolon
id|error
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
id|lock_buffer
c_func
(paren
id|new_bh
)paren
suffix:semicolon
id|error
op_assign
id|ext3_journal_get_create_access
c_func
(paren
id|handle
comma
id|new_bh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
id|unlock_buffer
c_func
(paren
id|new_bh
)paren
suffix:semicolon
r_goto
id|getblk_failed
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|new_bh-&gt;b_data
comma
id|s-&gt;base
comma
id|new_bh-&gt;b_size
)paren
suffix:semicolon
id|set_buffer_uptodate
c_func
(paren
id|new_bh
)paren
suffix:semicolon
id|unlock_buffer
c_func
(paren
id|new_bh
)paren
suffix:semicolon
id|ext3_xattr_cache_insert
c_func
(paren
id|new_bh
)paren
suffix:semicolon
id|error
op_assign
id|ext3_journal_dirty_metadata
c_func
(paren
id|handle
comma
id|new_bh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|cleanup
suffix:semicolon
)brace
)brace
multiline_comment|/* Update the inode. */
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_file_acl
op_assign
id|new_bh
ques
c_cond
id|new_bh-&gt;b_blocknr
suffix:colon
l_int|0
suffix:semicolon
multiline_comment|/* Drop the previous xattr block. */
r_if
c_cond
(paren
id|bs-&gt;bh
op_logical_and
id|bs-&gt;bh
op_ne
id|new_bh
)paren
id|ext3_xattr_release_block
c_func
(paren
id|handle
comma
id|inode
comma
id|bs-&gt;bh
)paren
suffix:semicolon
id|error
op_assign
l_int|0
suffix:semicolon
id|cleanup
suffix:colon
r_if
c_cond
(paren
id|ce
)paren
id|mb_cache_entry_release
c_func
(paren
id|ce
)paren
suffix:semicolon
id|brelse
c_func
(paren
id|new_bh
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|bs-&gt;bh
op_logical_and
id|s-&gt;base
op_eq
id|bs-&gt;bh-&gt;b_data
)paren
)paren
id|kfree
c_func
(paren
id|s-&gt;base
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
id|bad_block
suffix:colon
id|ext3_error
c_func
(paren
id|inode-&gt;i_sb
comma
id|__FUNCTION__
comma
l_string|&quot;inode %ld: bad block %d&quot;
comma
id|inode-&gt;i_ino
comma
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_file_acl
)paren
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
DECL|macro|header
macro_line|#undef header
)brace
DECL|struct|ext3_xattr_ibody_find
r_struct
id|ext3_xattr_ibody_find
(brace
DECL|member|s
r_struct
id|ext3_xattr_search
id|s
suffix:semicolon
DECL|member|iloc
r_struct
id|ext3_iloc
id|iloc
suffix:semicolon
)brace
suffix:semicolon
r_int
DECL|function|ext3_xattr_ibody_find
id|ext3_xattr_ibody_find
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|ext3_xattr_info
op_star
id|i
comma
r_struct
id|ext3_xattr_ibody_find
op_star
id|is
)paren
(brace
r_struct
id|ext3_xattr_ibody_header
op_star
id|header
suffix:semicolon
r_struct
id|ext3_inode
op_star
id|raw_inode
suffix:semicolon
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
id|EXT3_SB
c_func
(paren
id|inode-&gt;i_sb
)paren
op_member_access_from_pointer
id|s_inode_size
op_le
id|EXT3_GOOD_OLD_INODE_SIZE
)paren
r_return
l_int|0
suffix:semicolon
id|raw_inode
op_assign
id|ext3_raw_inode
c_func
(paren
op_amp
id|is-&gt;iloc
)paren
suffix:semicolon
id|header
op_assign
id|IHDR
c_func
(paren
id|inode
comma
id|raw_inode
)paren
suffix:semicolon
id|is-&gt;s.base
op_assign
id|is-&gt;s.first
op_assign
id|IFIRST
c_func
(paren
id|header
)paren
suffix:semicolon
id|is-&gt;s.here
op_assign
id|is-&gt;s.first
suffix:semicolon
id|is-&gt;s.end
op_assign
(paren
r_void
op_star
)paren
id|raw_inode
op_plus
id|EXT3_SB
c_func
(paren
id|inode-&gt;i_sb
)paren
op_member_access_from_pointer
id|s_inode_size
suffix:semicolon
r_if
c_cond
(paren
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_state
op_amp
id|EXT3_STATE_XATTR
)paren
(brace
id|error
op_assign
id|ext3_xattr_check_names
c_func
(paren
id|IFIRST
c_func
(paren
id|header
)paren
comma
id|is-&gt;s.end
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
multiline_comment|/* Find the named attribute. */
id|error
op_assign
id|ext3_xattr_find_entry
c_func
(paren
op_amp
id|is-&gt;s.here
comma
id|i-&gt;name_index
comma
id|i-&gt;name
comma
id|is-&gt;s.end
op_minus
(paren
r_void
op_star
)paren
id|is-&gt;s.base
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_logical_and
id|error
op_ne
op_minus
id|ENODATA
)paren
r_return
id|error
suffix:semicolon
id|is-&gt;s.not_found
op_assign
id|error
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|ext3_xattr_ibody_set
id|ext3_xattr_ibody_set
c_func
(paren
id|handle_t
op_star
id|handle
comma
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|ext3_xattr_info
op_star
id|i
comma
r_struct
id|ext3_xattr_ibody_find
op_star
id|is
)paren
(brace
r_struct
id|ext3_xattr_ibody_header
op_star
id|header
suffix:semicolon
r_struct
id|ext3_xattr_search
op_star
id|s
op_assign
op_amp
id|is-&gt;s
suffix:semicolon
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
id|EXT3_SB
c_func
(paren
id|inode-&gt;i_sb
)paren
op_member_access_from_pointer
id|s_inode_size
op_le
id|EXT3_GOOD_OLD_INODE_SIZE
)paren
r_return
op_minus
id|ENOSPC
suffix:semicolon
id|error
op_assign
id|ext3_xattr_set_entry
c_func
(paren
id|i
comma
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
id|header
op_assign
id|IHDR
c_func
(paren
id|inode
comma
id|ext3_raw_inode
c_func
(paren
op_amp
id|is-&gt;iloc
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_LAST_ENTRY
c_func
(paren
id|s-&gt;first
)paren
)paren
(brace
id|header-&gt;h_magic
op_assign
id|cpu_to_le32
c_func
(paren
id|EXT3_XATTR_MAGIC
)paren
suffix:semicolon
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_state
op_or_assign
id|EXT3_STATE_XATTR
suffix:semicolon
)brace
r_else
(brace
id|header-&gt;h_magic
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_state
op_and_assign
op_complement
id|EXT3_STATE_XATTR
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * ext3_xattr_set_handle()&n; *&n; * Create, replace or remove an extended attribute for this inode. Buffer&n; * is NULL to remove an existing extended attribute, and non-NULL to&n; * either replace an existing extended attribute, or create a new extended&n; * attribute. The flags XATTR_REPLACE and XATTR_CREATE&n; * specify that an extended attribute must exist and must not exist&n; * previous to the call, respectively.&n; *&n; * Returns 0, or a negative error number on failure.&n; */
r_int
DECL|function|ext3_xattr_set_handle
id|ext3_xattr_set_handle
c_func
(paren
id|handle_t
op_star
id|handle
comma
r_struct
id|inode
op_star
id|inode
comma
r_int
id|name_index
comma
r_const
r_char
op_star
id|name
comma
r_const
r_void
op_star
id|value
comma
r_int
id|value_len
comma
r_int
id|flags
)paren
(brace
r_struct
id|ext3_xattr_info
id|i
op_assign
(brace
dot
id|name_index
op_assign
id|name_index
comma
dot
id|name
op_assign
id|name
comma
dot
id|value
op_assign
id|value
comma
dot
id|value_len
op_assign
id|value_len
comma
)brace
suffix:semicolon
r_struct
id|ext3_xattr_ibody_find
id|is
op_assign
(brace
dot
id|s
op_assign
(brace
dot
id|not_found
op_assign
op_minus
id|ENODATA
comma
)brace
comma
)brace
suffix:semicolon
r_struct
id|ext3_xattr_block_find
id|bs
op_assign
(brace
dot
id|s
op_assign
(brace
dot
id|not_found
op_assign
op_minus
id|ENODATA
comma
)brace
comma
)brace
suffix:semicolon
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
id|IS_RDONLY
c_func
(paren
id|inode
)paren
)paren
r_return
op_minus
id|EROFS
suffix:semicolon
r_if
c_cond
(paren
id|IS_IMMUTABLE
c_func
(paren
id|inode
)paren
op_logical_or
id|IS_APPEND
c_func
(paren
id|inode
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|name
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|name
)paren
OG
l_int|255
)paren
r_return
op_minus
id|ERANGE
suffix:semicolon
id|down_write
c_func
(paren
op_amp
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|xattr_sem
)paren
suffix:semicolon
id|error
op_assign
id|ext3_get_inode_loc
c_func
(paren
id|inode
comma
op_amp
id|is.iloc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|cleanup
suffix:semicolon
id|error
op_assign
id|ext3_xattr_ibody_find
c_func
(paren
id|inode
comma
op_amp
id|i
comma
op_amp
id|is
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|cleanup
suffix:semicolon
r_if
c_cond
(paren
id|is.s.not_found
)paren
id|error
op_assign
id|ext3_xattr_block_find
c_func
(paren
id|inode
comma
op_amp
id|i
comma
op_amp
id|bs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|cleanup
suffix:semicolon
r_if
c_cond
(paren
id|is.s.not_found
op_logical_and
id|bs.s.not_found
)paren
(brace
id|error
op_assign
op_minus
id|ENODATA
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|XATTR_REPLACE
)paren
r_goto
id|cleanup
suffix:semicolon
id|error
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|value
)paren
r_goto
id|cleanup
suffix:semicolon
)brace
r_else
(brace
id|error
op_assign
op_minus
id|EEXIST
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|XATTR_CREATE
)paren
r_goto
id|cleanup
suffix:semicolon
)brace
id|error
op_assign
id|ext3_journal_get_write_access
c_func
(paren
id|handle
comma
id|is.iloc.bh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|cleanup
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|value
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|is.s.not_found
)paren
id|error
op_assign
id|ext3_xattr_ibody_set
c_func
(paren
id|handle
comma
id|inode
comma
op_amp
id|i
comma
op_amp
id|is
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|bs.s.not_found
)paren
id|error
op_assign
id|ext3_xattr_block_set
c_func
(paren
id|handle
comma
id|inode
comma
op_amp
id|i
comma
op_amp
id|bs
)paren
suffix:semicolon
)brace
r_else
(brace
id|error
op_assign
id|ext3_xattr_ibody_set
c_func
(paren
id|handle
comma
id|inode
comma
op_amp
id|i
comma
op_amp
id|is
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
op_logical_and
op_logical_neg
id|bs.s.not_found
)paren
(brace
id|i.value
op_assign
l_int|NULL
suffix:semicolon
id|error
op_assign
id|ext3_xattr_block_set
c_func
(paren
id|handle
comma
id|inode
comma
op_amp
id|i
comma
op_amp
id|bs
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|error
op_eq
op_minus
id|ENOSPC
)paren
(brace
id|error
op_assign
id|ext3_xattr_block_set
c_func
(paren
id|handle
comma
id|inode
comma
op_amp
id|i
comma
op_amp
id|bs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|cleanup
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is.s.not_found
)paren
(brace
id|i.value
op_assign
l_int|NULL
suffix:semicolon
id|error
op_assign
id|ext3_xattr_ibody_set
c_func
(paren
id|handle
comma
id|inode
comma
op_amp
id|i
comma
op_amp
id|is
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
(brace
id|ext3_xattr_update_super_block
c_func
(paren
id|handle
comma
id|inode-&gt;i_sb
)paren
suffix:semicolon
id|inode-&gt;i_ctime
op_assign
id|CURRENT_TIME_SEC
suffix:semicolon
id|error
op_assign
id|ext3_mark_iloc_dirty
c_func
(paren
id|handle
comma
id|inode
comma
op_amp
id|is.iloc
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * The bh is consumed by ext3_mark_iloc_dirty, even with&n;&t;&t; * error != 0.&n;&t;&t; */
id|is.iloc.bh
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|IS_SYNC
c_func
(paren
id|inode
)paren
)paren
id|handle-&gt;h_sync
op_assign
l_int|1
suffix:semicolon
)brace
id|cleanup
suffix:colon
id|brelse
c_func
(paren
id|is.iloc.bh
)paren
suffix:semicolon
id|brelse
c_func
(paren
id|bs.bh
)paren
suffix:semicolon
id|up_write
c_func
(paren
op_amp
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|xattr_sem
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/*&n; * ext3_xattr_set()&n; *&n; * Like ext3_xattr_set_handle, but start from an inode. This extended&n; * attribute modification is a filesystem transaction by itself.&n; *&n; * Returns 0, or a negative error number on failure.&n; */
r_int
DECL|function|ext3_xattr_set
id|ext3_xattr_set
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|name_index
comma
r_const
r_char
op_star
id|name
comma
r_const
r_void
op_star
id|value
comma
r_int
id|value_len
comma
r_int
id|flags
)paren
(brace
id|handle_t
op_star
id|handle
suffix:semicolon
r_int
id|error
comma
id|retries
op_assign
l_int|0
suffix:semicolon
id|retry
suffix:colon
id|handle
op_assign
id|ext3_journal_start
c_func
(paren
id|inode
comma
id|EXT3_DATA_TRANS_BLOCKS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|handle
)paren
)paren
(brace
id|error
op_assign
id|PTR_ERR
c_func
(paren
id|handle
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|error2
suffix:semicolon
id|error
op_assign
id|ext3_xattr_set_handle
c_func
(paren
id|handle
comma
id|inode
comma
id|name_index
comma
id|name
comma
id|value
comma
id|value_len
comma
id|flags
)paren
suffix:semicolon
id|error2
op_assign
id|ext3_journal_stop
c_func
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_eq
op_minus
id|ENOSPC
op_logical_and
id|ext3_should_retry_alloc
c_func
(paren
id|inode-&gt;i_sb
comma
op_amp
id|retries
)paren
)paren
r_goto
id|retry
suffix:semicolon
r_if
c_cond
(paren
id|error
op_eq
l_int|0
)paren
id|error
op_assign
id|error2
suffix:semicolon
)brace
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/*&n; * ext3_xattr_delete_inode()&n; *&n; * Free extended attribute resources associated with this inode. This&n; * is called immediately before an inode is freed. We have exclusive&n; * access to the inode.&n; */
r_void
DECL|function|ext3_xattr_delete_inode
id|ext3_xattr_delete_inode
c_func
(paren
id|handle_t
op_star
id|handle
comma
r_struct
id|inode
op_star
id|inode
)paren
(brace
r_struct
id|buffer_head
op_star
id|bh
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_file_acl
)paren
r_goto
id|cleanup
suffix:semicolon
id|bh
op_assign
id|sb_bread
c_func
(paren
id|inode-&gt;i_sb
comma
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_file_acl
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bh
)paren
(brace
id|ext3_error
c_func
(paren
id|inode-&gt;i_sb
comma
id|__FUNCTION__
comma
l_string|&quot;inode %ld: block %d read error&quot;
comma
id|inode-&gt;i_ino
comma
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_file_acl
)paren
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
r_if
c_cond
(paren
id|BHDR
c_func
(paren
id|bh
)paren
op_member_access_from_pointer
id|h_magic
op_ne
id|cpu_to_le32
c_func
(paren
id|EXT3_XATTR_MAGIC
)paren
op_logical_or
id|BHDR
c_func
(paren
id|bh
)paren
op_member_access_from_pointer
id|h_blocks
op_ne
id|cpu_to_le32
c_func
(paren
l_int|1
)paren
)paren
(brace
id|ext3_error
c_func
(paren
id|inode-&gt;i_sb
comma
id|__FUNCTION__
comma
l_string|&quot;inode %ld: bad block %d&quot;
comma
id|inode-&gt;i_ino
comma
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_file_acl
)paren
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
id|ext3_xattr_release_block
c_func
(paren
id|handle
comma
id|inode
comma
id|bh
)paren
suffix:semicolon
id|EXT3_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|i_file_acl
op_assign
l_int|0
suffix:semicolon
id|cleanup
suffix:colon
id|brelse
c_func
(paren
id|bh
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ext3_xattr_put_super()&n; *&n; * This is called when a file system is unmounted.&n; */
r_void
DECL|function|ext3_xattr_put_super
id|ext3_xattr_put_super
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
id|mb_cache_shrink
c_func
(paren
id|ext3_xattr_cache
comma
id|sb-&gt;s_bdev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ext3_xattr_cache_insert()&n; *&n; * Create a new entry in the extended attribute cache, and insert&n; * it unless such an entry is already in the cache.&n; *&n; * Returns 0, or a negative error number on failure.&n; */
r_static
r_void
DECL|function|ext3_xattr_cache_insert
id|ext3_xattr_cache_insert
c_func
(paren
r_struct
id|buffer_head
op_star
id|bh
)paren
(brace
id|__u32
id|hash
op_assign
id|le32_to_cpu
c_func
(paren
id|BHDR
c_func
(paren
id|bh
)paren
op_member_access_from_pointer
id|h_hash
)paren
suffix:semicolon
r_struct
id|mb_cache_entry
op_star
id|ce
suffix:semicolon
r_int
id|error
suffix:semicolon
id|ce
op_assign
id|mb_cache_entry_alloc
c_func
(paren
id|ext3_xattr_cache
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ce
)paren
(brace
id|ea_bdebug
c_func
(paren
id|bh
comma
l_string|&quot;out of memory&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|error
op_assign
id|mb_cache_entry_insert
c_func
(paren
id|ce
comma
id|bh-&gt;b_bdev
comma
id|bh-&gt;b_blocknr
comma
op_amp
id|hash
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
id|mb_cache_entry_free
c_func
(paren
id|ce
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_eq
op_minus
id|EBUSY
)paren
(brace
id|ea_bdebug
c_func
(paren
id|bh
comma
l_string|&quot;already in cache&quot;
)paren
suffix:semicolon
id|error
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
id|ea_bdebug
c_func
(paren
id|bh
comma
l_string|&quot;inserting [%x]&quot;
comma
(paren
r_int
)paren
id|hash
)paren
suffix:semicolon
id|mb_cache_entry_release
c_func
(paren
id|ce
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * ext3_xattr_cmp()&n; *&n; * Compare two extended attribute blocks for equality.&n; *&n; * Returns 0 if the blocks are equal, 1 if they differ, and&n; * a negative error number on errors.&n; */
r_static
r_int
DECL|function|ext3_xattr_cmp
id|ext3_xattr_cmp
c_func
(paren
r_struct
id|ext3_xattr_header
op_star
id|header1
comma
r_struct
id|ext3_xattr_header
op_star
id|header2
)paren
(brace
r_struct
id|ext3_xattr_entry
op_star
id|entry1
comma
op_star
id|entry2
suffix:semicolon
id|entry1
op_assign
id|ENTRY
c_func
(paren
id|header1
op_plus
l_int|1
)paren
suffix:semicolon
id|entry2
op_assign
id|ENTRY
c_func
(paren
id|header2
op_plus
l_int|1
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|IS_LAST_ENTRY
c_func
(paren
id|entry1
)paren
)paren
(brace
r_if
c_cond
(paren
id|IS_LAST_ENTRY
c_func
(paren
id|entry2
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|entry1-&gt;e_hash
op_ne
id|entry2-&gt;e_hash
op_logical_or
id|entry1-&gt;e_name_len
op_ne
id|entry2-&gt;e_name_len
op_logical_or
id|entry1-&gt;e_value_size
op_ne
id|entry2-&gt;e_value_size
op_logical_or
id|memcmp
c_func
(paren
id|entry1-&gt;e_name
comma
id|entry2-&gt;e_name
comma
id|entry1-&gt;e_name_len
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|entry1-&gt;e_value_block
op_ne
l_int|0
op_logical_or
id|entry2-&gt;e_value_block
op_ne
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
(paren
r_char
op_star
)paren
id|header1
op_plus
id|le16_to_cpu
c_func
(paren
id|entry1-&gt;e_value_offs
)paren
comma
(paren
r_char
op_star
)paren
id|header2
op_plus
id|le16_to_cpu
c_func
(paren
id|entry2-&gt;e_value_offs
)paren
comma
id|le32_to_cpu
c_func
(paren
id|entry1-&gt;e_value_size
)paren
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|entry1
op_assign
id|EXT3_XATTR_NEXT
c_func
(paren
id|entry1
)paren
suffix:semicolon
id|entry2
op_assign
id|EXT3_XATTR_NEXT
c_func
(paren
id|entry2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|IS_LAST_ENTRY
c_func
(paren
id|entry2
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * ext3_xattr_cache_find()&n; *&n; * Find an identical extended attribute block.&n; *&n; * Returns a pointer to the block found, or NULL if such a block was&n; * not found or an error occurred.&n; */
r_static
r_struct
id|buffer_head
op_star
DECL|function|ext3_xattr_cache_find
id|ext3_xattr_cache_find
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|ext3_xattr_header
op_star
id|header
comma
r_struct
id|mb_cache_entry
op_star
op_star
id|pce
)paren
(brace
id|__u32
id|hash
op_assign
id|le32_to_cpu
c_func
(paren
id|header-&gt;h_hash
)paren
suffix:semicolon
r_struct
id|mb_cache_entry
op_star
id|ce
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|header-&gt;h_hash
)paren
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* never share */
id|ea_idebug
c_func
(paren
id|inode
comma
l_string|&quot;looking for cached blocks [%x]&quot;
comma
(paren
r_int
)paren
id|hash
)paren
suffix:semicolon
id|again
suffix:colon
id|ce
op_assign
id|mb_cache_entry_find_first
c_func
(paren
id|ext3_xattr_cache
comma
l_int|0
comma
id|inode-&gt;i_sb-&gt;s_bdev
comma
id|hash
)paren
suffix:semicolon
r_while
c_loop
(paren
id|ce
)paren
(brace
r_struct
id|buffer_head
op_star
id|bh
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|ce
)paren
)paren
(brace
r_if
c_cond
(paren
id|PTR_ERR
c_func
(paren
id|ce
)paren
op_eq
op_minus
id|EAGAIN
)paren
r_goto
id|again
suffix:semicolon
r_break
suffix:semicolon
)brace
id|bh
op_assign
id|sb_bread
c_func
(paren
id|inode-&gt;i_sb
comma
id|ce-&gt;e_block
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bh
)paren
(brace
id|ext3_error
c_func
(paren
id|inode-&gt;i_sb
comma
id|__FUNCTION__
comma
l_string|&quot;inode %ld: block %ld read error&quot;
comma
id|inode-&gt;i_ino
comma
(paren
r_int
r_int
)paren
id|ce-&gt;e_block
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|le32_to_cpu
c_func
(paren
id|BHDR
c_func
(paren
id|bh
)paren
op_member_access_from_pointer
id|h_refcount
)paren
op_ge
id|EXT3_XATTR_REFCOUNT_MAX
)paren
(brace
id|ea_idebug
c_func
(paren
id|inode
comma
l_string|&quot;block %ld refcount %d&gt;=%d&quot;
comma
(paren
r_int
r_int
)paren
id|ce-&gt;e_block
comma
id|le32_to_cpu
c_func
(paren
id|BHDR
c_func
(paren
id|bh
)paren
op_member_access_from_pointer
id|h_refcount
)paren
comma
id|EXT3_XATTR_REFCOUNT_MAX
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ext3_xattr_cmp
c_func
(paren
id|header
comma
id|BHDR
c_func
(paren
id|bh
)paren
)paren
op_eq
l_int|0
)paren
(brace
op_star
id|pce
op_assign
id|ce
suffix:semicolon
r_return
id|bh
suffix:semicolon
)brace
id|brelse
c_func
(paren
id|bh
)paren
suffix:semicolon
id|ce
op_assign
id|mb_cache_entry_find_next
c_func
(paren
id|ce
comma
l_int|0
comma
id|inode-&gt;i_sb-&gt;s_bdev
comma
id|hash
)paren
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|macro|NAME_HASH_SHIFT
mdefine_line|#define NAME_HASH_SHIFT 5
DECL|macro|VALUE_HASH_SHIFT
mdefine_line|#define VALUE_HASH_SHIFT 16
multiline_comment|/*&n; * ext3_xattr_hash_entry()&n; *&n; * Compute the hash of an extended attribute.&n; */
DECL|function|ext3_xattr_hash_entry
r_static
r_inline
r_void
id|ext3_xattr_hash_entry
c_func
(paren
r_struct
id|ext3_xattr_header
op_star
id|header
comma
r_struct
id|ext3_xattr_entry
op_star
id|entry
)paren
(brace
id|__u32
id|hash
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|name
op_assign
id|entry-&gt;e_name
suffix:semicolon
r_int
id|n
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|entry-&gt;e_name_len
suffix:semicolon
id|n
op_increment
)paren
(brace
id|hash
op_assign
(paren
id|hash
op_lshift
id|NAME_HASH_SHIFT
)paren
op_xor
(paren
id|hash
op_rshift
(paren
l_int|8
op_star
r_sizeof
(paren
id|hash
)paren
op_minus
id|NAME_HASH_SHIFT
)paren
)paren
op_xor
op_star
id|name
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|entry-&gt;e_value_block
op_eq
l_int|0
op_logical_and
id|entry-&gt;e_value_size
op_ne
l_int|0
)paren
(brace
id|__le32
op_star
id|value
op_assign
(paren
id|__le32
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|header
op_plus
id|le16_to_cpu
c_func
(paren
id|entry-&gt;e_value_offs
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
(paren
id|le32_to_cpu
c_func
(paren
id|entry-&gt;e_value_size
)paren
op_plus
id|EXT3_XATTR_ROUND
)paren
op_rshift
id|EXT3_XATTR_PAD_BITS
suffix:semicolon
id|n
suffix:semicolon
id|n
op_decrement
)paren
(brace
id|hash
op_assign
(paren
id|hash
op_lshift
id|VALUE_HASH_SHIFT
)paren
op_xor
(paren
id|hash
op_rshift
(paren
l_int|8
op_star
r_sizeof
(paren
id|hash
)paren
op_minus
id|VALUE_HASH_SHIFT
)paren
)paren
op_xor
id|le32_to_cpu
c_func
(paren
op_star
id|value
op_increment
)paren
suffix:semicolon
)brace
)brace
id|entry-&gt;e_hash
op_assign
id|cpu_to_le32
c_func
(paren
id|hash
)paren
suffix:semicolon
)brace
DECL|macro|NAME_HASH_SHIFT
macro_line|#undef NAME_HASH_SHIFT
DECL|macro|VALUE_HASH_SHIFT
macro_line|#undef VALUE_HASH_SHIFT
DECL|macro|BLOCK_HASH_SHIFT
mdefine_line|#define BLOCK_HASH_SHIFT 16
multiline_comment|/*&n; * ext3_xattr_rehash()&n; *&n; * Re-compute the extended attribute hash value after an entry has changed.&n; */
DECL|function|ext3_xattr_rehash
r_static
r_void
id|ext3_xattr_rehash
c_func
(paren
r_struct
id|ext3_xattr_header
op_star
id|header
comma
r_struct
id|ext3_xattr_entry
op_star
id|entry
)paren
(brace
r_struct
id|ext3_xattr_entry
op_star
id|here
suffix:semicolon
id|__u32
id|hash
op_assign
l_int|0
suffix:semicolon
id|ext3_xattr_hash_entry
c_func
(paren
id|header
comma
id|entry
)paren
suffix:semicolon
id|here
op_assign
id|ENTRY
c_func
(paren
id|header
op_plus
l_int|1
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|IS_LAST_ENTRY
c_func
(paren
id|here
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|here-&gt;e_hash
)paren
(brace
multiline_comment|/* Block is not shared if an entry&squot;s hash value == 0 */
id|hash
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|hash
op_assign
(paren
id|hash
op_lshift
id|BLOCK_HASH_SHIFT
)paren
op_xor
(paren
id|hash
op_rshift
(paren
l_int|8
op_star
r_sizeof
(paren
id|hash
)paren
op_minus
id|BLOCK_HASH_SHIFT
)paren
)paren
op_xor
id|le32_to_cpu
c_func
(paren
id|here-&gt;e_hash
)paren
suffix:semicolon
id|here
op_assign
id|EXT3_XATTR_NEXT
c_func
(paren
id|here
)paren
suffix:semicolon
)brace
id|header-&gt;h_hash
op_assign
id|cpu_to_le32
c_func
(paren
id|hash
)paren
suffix:semicolon
)brace
DECL|macro|BLOCK_HASH_SHIFT
macro_line|#undef BLOCK_HASH_SHIFT
r_int
id|__init
DECL|function|init_ext3_xattr
id|init_ext3_xattr
c_func
(paren
r_void
)paren
(brace
id|ext3_xattr_cache
op_assign
id|mb_cache_create
c_func
(paren
l_string|&quot;ext3_xattr&quot;
comma
l_int|NULL
comma
r_sizeof
(paren
r_struct
id|mb_cache_entry
)paren
op_plus
r_sizeof
(paren
(paren
(paren
r_struct
id|mb_cache_entry
op_star
)paren
l_int|0
)paren
op_member_access_from_pointer
id|e_indexes
(braket
l_int|0
)braket
)paren
comma
l_int|1
comma
l_int|6
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ext3_xattr_cache
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|exit_ext3_xattr
id|exit_ext3_xattr
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|ext3_xattr_cache
)paren
id|mb_cache_destroy
c_func
(paren
id|ext3_xattr_cache
)paren
suffix:semicolon
id|ext3_xattr_cache
op_assign
l_int|NULL
suffix:semicolon
)brace
eof
