multiline_comment|/*&n; *  fs/nfs/nfs4xdr.c&n; *&n; *  Server-side XDR for NFSv4&n; *&n; *  Copyright (c) 2002 The Regents of the University of Michigan.&n; *  All rights reserved.&n; *&n; *  Kendrick Smith &lt;kmsmith@umich.edu&gt;&n; *  Andy Adamson   &lt;andros@umich.edu&gt;&n; *&n; *  Redistribution and use in source and binary forms, with or without&n; *  modification, are permitted provided that the following conditions&n; *  are met:&n; *&n; *  1. Redistributions of source code must retain the above copyright&n; *     notice, this list of conditions and the following disclaimer.&n; *  2. Redistributions in binary form must reproduce the above copyright&n; *     notice, this list of conditions and the following disclaimer in the&n; *     documentation and/or other materials provided with the distribution.&n; *  3. Neither the name of the University nor the names of its&n; *     contributors may be used to endorse or promote products derived&n; *     from this software without specific prior written permission.&n; *&n; *  THIS SOFTWARE IS PROVIDED ``AS IS&squot;&squot; AND ANY EXPRESS OR IMPLIED&n; *  WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF&n; *  MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE&n; *  DISCLAIMED. IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE&n; *  FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR&n; *  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF&n; *  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR&n; *  BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF&n; *  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING&n; *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS&n; *  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.&n; *&n; * TODO: Neil Brown made the following observation:  We currently&n; * initially reserve NFSD_BUFSIZE space on the transmit queue and&n; * never release any of that until the request is complete.&n; * It would be good to calculate a new maximum response size while&n; * decoding the COMPOUND, and call svc_reserve with this number&n; * at the end of nfs4svc_decode_compoundargs.&n; */
macro_line|#include &lt;linux/param.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/namei.h&gt;
macro_line|#include &lt;linux/vfs.h&gt;
macro_line|#include &lt;linux/sunrpc/xdr.h&gt;
macro_line|#include &lt;linux/sunrpc/svc.h&gt;
macro_line|#include &lt;linux/sunrpc/clnt.h&gt;
macro_line|#include &lt;linux/nfsd/nfsd.h&gt;
macro_line|#include &lt;linux/nfsd/state.h&gt;
macro_line|#include &lt;linux/nfsd/xdr4.h&gt;
macro_line|#include &lt;linux/nfsd_idmap.h&gt;
macro_line|#include &lt;linux/nfs4.h&gt;
macro_line|#include &lt;linux/nfs4_acl.h&gt;
DECL|macro|NFSDDBG_FACILITY
mdefine_line|#define NFSDDBG_FACILITY&t;&t;NFSDDBG_XDR
DECL|variable|utf8_byte_len
r_static
r_const
r_char
id|utf8_byte_len
(braket
l_int|256
)braket
op_assign
(brace
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|2
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|4
comma
l_int|4
comma
l_int|4
comma
l_int|4
comma
l_int|4
comma
l_int|4
comma
l_int|4
comma
l_int|4
comma
l_int|5
comma
l_int|5
comma
l_int|5
comma
l_int|5
comma
l_int|6
comma
l_int|6
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
r_static
r_inline
r_int
DECL|function|is_legal_utf8_sequence
id|is_legal_utf8_sequence
c_func
(paren
r_int
r_char
op_star
id|source
comma
r_int
id|length
)paren
(brace
r_int
r_char
op_star
id|ptr
suffix:semicolon
r_int
r_char
id|c
suffix:semicolon
r_if
c_cond
(paren
id|length
op_eq
l_int|1
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/* Check for overlong sequence, and check second byte */
id|c
op_assign
op_star
(paren
id|source
op_plus
l_int|1
)paren
suffix:semicolon
r_switch
c_cond
(paren
op_star
id|source
)paren
(brace
r_case
l_int|0xE0
suffix:colon
multiline_comment|/* 3 bytes */
r_if
c_cond
(paren
id|c
OL
l_int|0xA0
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xF0
suffix:colon
multiline_comment|/* 4 bytes */
r_if
c_cond
(paren
id|c
OL
l_int|0x90
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xF8
suffix:colon
multiline_comment|/* 5 bytes */
r_if
c_cond
(paren
id|c
OL
l_int|0xC8
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xFC
suffix:colon
multiline_comment|/* 6 bytes */
r_if
c_cond
(paren
id|c
OL
l_int|0x84
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
(paren
id|c
op_amp
l_int|0xC0
)paren
op_ne
l_int|0x80
)paren
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Check that trailing bytes look like 10xxxxxx */
r_for
c_loop
(paren
id|ptr
op_assign
id|source
op_increment
op_plus
id|length
op_minus
l_int|1
suffix:semicolon
id|ptr
OG
id|source
suffix:semicolon
id|ptr
op_decrement
)paren
r_if
c_cond
(paren
(paren
(paren
op_star
id|ptr
)paren
op_amp
l_int|0xC0
)paren
op_ne
l_int|0x80
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* This does some screening on disallowed unicode characters.  It is NOT&n; * comprehensive.&n; */
r_static
r_int
DECL|function|is_allowed_utf8_char
id|is_allowed_utf8_char
c_func
(paren
r_int
r_char
op_star
id|source
comma
r_int
id|length
)paren
(brace
multiline_comment|/* We assume length and source point to a valid utf8 sequence */
r_int
r_char
id|c
suffix:semicolon
multiline_comment|/* Disallow F0000 and up (in utf8, F3B08080) */
r_if
c_cond
(paren
op_star
id|source
OG
l_int|0xF3
)paren
r_return
l_int|0
suffix:semicolon
id|c
op_assign
op_star
(paren
id|source
op_plus
l_int|1
)paren
suffix:semicolon
r_switch
c_cond
(paren
op_star
id|source
)paren
(brace
r_case
l_int|0xF3
suffix:colon
r_if
c_cond
(paren
id|c
op_ge
l_int|0xB0
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* Disallow D800-F8FF (in utf8, EDA080-EFA3BF */
r_case
l_int|0xED
suffix:colon
r_if
c_cond
(paren
id|c
op_ge
l_int|0xA0
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xEE
suffix:colon
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xEF
suffix:colon
r_if
c_cond
(paren
id|c
op_le
l_int|0xA3
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Disallow FFF9-FFFF (EFBFB9-EFBFBF) */
r_if
c_cond
(paren
id|c
op_eq
l_int|0xBF
)paren
multiline_comment|/* Don&squot;t need to check &lt;=0xBF, since valid utf8 */
r_if
c_cond
(paren
op_star
(paren
id|source
op_plus
l_int|2
)paren
op_ge
l_int|0xB9
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* This routine should really check to see that the proper stringprep&n; * mappings have been applied.  Instead, we do a simple screen of some&n; * of the more obvious illegal values by calling is_allowed_utf8_char.&n; * This will allow many illegal strings through, but if a client behaves,&n; * it will get full functionality.  The other option (apart from full&n; * stringprep checking) is to limit everything to an easily handled subset,&n; * such as 7-bit ascii.&n; *&n; * Note - currently calling routines ignore return value except as boolean.&n; */
r_static
r_int
DECL|function|check_utf8
id|check_utf8
c_func
(paren
r_char
op_star
id|str
comma
r_int
id|len
)paren
(brace
r_int
r_char
op_star
id|chunk
comma
op_star
id|sourceend
suffix:semicolon
r_int
id|chunklen
suffix:semicolon
id|chunk
op_assign
id|str
suffix:semicolon
id|sourceend
op_assign
id|str
op_plus
id|len
suffix:semicolon
r_while
c_loop
(paren
id|chunk
OL
id|sourceend
)paren
(brace
id|chunklen
op_assign
id|utf8_byte_len
(braket
op_star
id|chunk
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chunklen
)paren
r_return
id|nfserr_inval
suffix:semicolon
r_if
c_cond
(paren
id|chunk
op_plus
id|chunklen
OG
id|sourceend
)paren
r_return
id|nfserr_inval
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_legal_utf8_sequence
c_func
(paren
id|chunk
comma
id|chunklen
)paren
)paren
r_return
id|nfserr_inval
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_allowed_utf8_char
c_func
(paren
id|chunk
comma
id|chunklen
)paren
)paren
r_return
id|nfserr_inval
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chunklen
op_eq
l_int|1
)paren
op_logical_and
(paren
op_logical_neg
op_star
id|chunk
)paren
)paren
r_return
id|nfserr_inval
suffix:semicolon
multiline_comment|/* Disallow embedded nulls */
id|chunk
op_add_assign
id|chunklen
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|check_filename
id|check_filename
c_func
(paren
r_char
op_star
id|str
comma
r_int
id|len
comma
r_int
id|err
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|len
op_eq
l_int|0
)paren
r_return
id|nfserr_inval
suffix:semicolon
r_if
c_cond
(paren
id|isdotent
c_func
(paren
id|str
comma
id|len
)paren
)paren
r_return
id|err
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|str
(braket
id|i
)braket
op_eq
l_char|&squot;/&squot;
)paren
r_return
id|err
suffix:semicolon
r_return
id|check_utf8
c_func
(paren
id|str
comma
id|len
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * START OF &quot;GENERIC&quot; DECODE ROUTINES.&n; *   These may look a little ugly since they are imported from a &quot;generic&quot;&n; * set of XDR encode/decode routines which are intended to be shared by&n; * all of our NFSv4 implementations (OpenBSD, MacOS X...).&n; *&n; * If the pain of reading these is too great, it should be a straightforward&n; * task to translate them into Linux-specific versions which are more&n; * consistent with the style used in NFSv2/v3...&n; */
DECL|macro|DECODE_HEAD
mdefine_line|#define DECODE_HEAD&t;&t;&t;&t;&bslash;&n;&t;u32 *p;&t;&t;&t;&t;&t;&bslash;&n;&t;int status
DECL|macro|DECODE_TAIL
mdefine_line|#define DECODE_TAIL&t;&t;&t;&t;&bslash;&n;&t;status = 0;&t;&t;&t;&t;&bslash;&n;out:&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return status;&t;&t;&t;&t;&bslash;&n;xdr_error:&t;&t;&t;&t;&t;&bslash;&n;&t;printk(KERN_NOTICE &quot;xdr error! (%s:%d)&bslash;n&quot;, __FILE__, __LINE__);&t;&bslash;&n;&t;status = nfserr_bad_xdr;&t;&t;&bslash;&n;&t;goto out
DECL|macro|READ32
mdefine_line|#define READ32(x)         (x) = ntohl(*p++)
DECL|macro|READ64
mdefine_line|#define READ64(x)         do {&t;&t;&t;&bslash;&n;&t;(x) = (u64)ntohl(*p++) &lt;&lt; 32;&t;&t;&bslash;&n;&t;(x) |= ntohl(*p++);&t;&t;&t;&bslash;&n;} while (0)
DECL|macro|READTIME
mdefine_line|#define READTIME(x)       do {&t;&t;&t;&bslash;&n;&t;p++;&t;&t;&t;&t;&t;&bslash;&n;&t;(x) = ntohl(*p++);&t;&t;&t;&bslash;&n;&t;p++;&t;&t;&t;&t;&t;&bslash;&n;} while (0)
DECL|macro|READMEM
mdefine_line|#define READMEM(x,nbytes) do {&t;&t;&t;&bslash;&n;&t;x = (char *)p;&t;&t;&t;&t;&bslash;&n;&t;p += XDR_QUADLEN(nbytes);&t;&t;&bslash;&n;} while (0)
DECL|macro|SAVEMEM
mdefine_line|#define SAVEMEM(x,nbytes) do {&t;&t;&t;&bslash;&n;&t;if (!(x = (p==argp-&gt;tmp || p == argp-&gt;tmpp) ? &bslash;&n; &t;&t;savemem(argp, p, nbytes) :&t;&bslash;&n; &t;&t;(char *)p)) {&t;&t;&t;&bslash;&n;&t;&t;printk(KERN_NOTICE &quot;xdr error! (%s:%d)&bslash;n&quot;, __FILE__, __LINE__); &bslash;&n;&t;&t;goto xdr_error;&t;&t;&t;&bslash;&n;&t;&t;}&t;&t;&t;&t;&bslash;&n;&t;p += XDR_QUADLEN(nbytes);&t;&t;&bslash;&n;} while (0)
DECL|macro|COPYMEM
mdefine_line|#define COPYMEM(x,nbytes) do {&t;&t;&t;&bslash;&n;&t;memcpy((x), p, nbytes);&t;&t;&t;&bslash;&n;&t;p += XDR_QUADLEN(nbytes);&t;&t;&bslash;&n;} while (0)
multiline_comment|/* READ_BUF, read_buf(): nbytes must be &lt;= PAGE_SIZE */
DECL|macro|READ_BUF
mdefine_line|#define READ_BUF(nbytes)  do {&t;&t;&t;&bslash;&n;&t;if (nbytes &lt;= (u32)((char *)argp-&gt;end - (char *)argp-&gt;p)) {&t;&bslash;&n;&t;&t;p = argp-&gt;p;&t;&t;&t;&bslash;&n;&t;&t;argp-&gt;p += XDR_QUADLEN(nbytes);&t;&bslash;&n;&t;} else if (!(p = read_buf(argp, nbytes))) { &bslash;&n;&t;&t;printk(KERN_NOTICE &quot;xdr error! (%s:%d)&bslash;n&quot;, __FILE__, __LINE__); &bslash;&n;&t;&t;goto xdr_error;&t;&t;&t;&bslash;&n;&t;}&t;&t;&t;&t;&t;&bslash;&n;} while (0)
DECL|function|read_buf
id|u32
op_star
id|read_buf
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_int
id|nbytes
)paren
(brace
multiline_comment|/* We want more bytes than seem to be available.&n;&t; * Maybe we need a new page, maybe we have just run out&n;&t; */
r_int
id|avail
op_assign
(paren
r_char
op_star
)paren
id|argp-&gt;end
op_minus
(paren
r_char
op_star
)paren
id|argp-&gt;p
suffix:semicolon
id|u32
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|avail
op_plus
id|argp-&gt;pagelen
OL
id|nbytes
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|avail
op_plus
id|PAGE_SIZE
OL
id|nbytes
)paren
multiline_comment|/* need more than a page !! */
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* ok, we can do it with the current plus the next page */
r_if
c_cond
(paren
id|nbytes
op_le
r_sizeof
(paren
id|argp-&gt;tmp
)paren
)paren
id|p
op_assign
id|argp-&gt;tmp
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|argp-&gt;tmpp
)paren
id|kfree
c_func
(paren
id|argp-&gt;tmpp
)paren
suffix:semicolon
id|p
op_assign
id|argp-&gt;tmpp
op_assign
id|kmalloc
c_func
(paren
id|nbytes
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
l_int|NULL
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|p
comma
id|argp-&gt;p
comma
id|avail
)paren
suffix:semicolon
multiline_comment|/* step to next page */
id|argp-&gt;p
op_assign
id|page_address
c_func
(paren
id|argp-&gt;pagelist
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|argp-&gt;pagelist
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|argp-&gt;pagelen
OL
id|PAGE_SIZE
)paren
(brace
id|argp-&gt;end
op_assign
id|p
op_plus
(paren
id|argp-&gt;pagelen
op_rshift
l_int|2
)paren
suffix:semicolon
id|argp-&gt;pagelen
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|argp-&gt;end
op_assign
id|p
op_plus
(paren
id|PAGE_SIZE
op_rshift
l_int|2
)paren
suffix:semicolon
id|argp-&gt;pagelen
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
id|memcpy
c_func
(paren
(paren
(paren
r_char
op_star
)paren
id|p
)paren
op_plus
id|avail
comma
id|argp-&gt;p
comma
(paren
id|nbytes
op_minus
id|avail
)paren
)paren
suffix:semicolon
id|argp-&gt;p
op_add_assign
id|XDR_QUADLEN
c_func
(paren
id|nbytes
op_minus
id|avail
)paren
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
r_static
r_int
DECL|function|defer_free
id|defer_free
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_void
(paren
op_star
id|release
)paren
(paren
r_const
r_void
op_star
)paren
comma
r_void
op_star
id|p
)paren
(brace
r_struct
id|tmpbuf
op_star
id|tb
suffix:semicolon
id|tb
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|tb
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tb
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|tb-&gt;buf
op_assign
id|p
suffix:semicolon
id|tb-&gt;release
op_assign
id|release
suffix:semicolon
id|tb-&gt;next
op_assign
id|argp-&gt;to_free
suffix:semicolon
id|argp-&gt;to_free
op_assign
id|tb
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|savemem
r_char
op_star
id|savemem
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
id|u32
op_star
id|p
comma
r_int
id|nbytes
)paren
(brace
r_void
op_star
r_new
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|p
op_eq
id|argp-&gt;tmp
)paren
(brace
r_new
op_assign
id|kmalloc
c_func
(paren
id|nbytes
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
r_new
)paren
r_return
l_int|NULL
suffix:semicolon
id|p
op_assign
r_new
suffix:semicolon
id|memcpy
c_func
(paren
id|p
comma
id|argp-&gt;tmp
comma
id|nbytes
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|p
op_ne
id|argp-&gt;tmpp
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|argp-&gt;tmpp
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|defer_free
c_func
(paren
id|argp
comma
id|kfree
comma
id|p
)paren
)paren
(brace
id|kfree
c_func
(paren
r_new
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_else
r_return
(paren
r_char
op_star
)paren
id|p
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_bitmap
id|nfsd4_decode_bitmap
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
id|u32
op_star
id|bmval
)paren
(brace
id|u32
id|bmlen
suffix:semicolon
id|DECODE_HEAD
suffix:semicolon
id|bmval
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|bmval
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|bmlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmlen
OG
l_int|1000
)paren
r_goto
id|xdr_error
suffix:semicolon
id|READ_BUF
c_func
(paren
id|bmlen
op_lshift
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmlen
OG
l_int|0
)paren
id|READ32
c_func
(paren
id|bmval
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmlen
OG
l_int|1
)paren
id|READ32
c_func
(paren
id|bmval
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_fattr
id|nfsd4_decode_fattr
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
id|u32
op_star
id|bmval
comma
r_struct
id|iattr
op_star
id|iattr
comma
r_struct
id|nfs4_acl
op_star
op_star
id|acl
)paren
(brace
r_int
id|expected_len
comma
id|len
op_assign
l_int|0
suffix:semicolon
id|u32
id|dummy32
suffix:semicolon
r_char
op_star
id|buf
suffix:semicolon
id|DECODE_HEAD
suffix:semicolon
id|iattr-&gt;ia_valid
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|nfsd4_decode_bitmap
c_func
(paren
id|argp
comma
id|bmval
)paren
)paren
)paren
r_return
id|status
suffix:semicolon
multiline_comment|/*&n;&t; * According to spec, unsupported attributes return ERR_NOTSUPP;&n;&t; * read-only attributes return ERR_INVAL.&n;&t; */
r_if
c_cond
(paren
(paren
id|bmval
(braket
l_int|0
)braket
op_amp
op_complement
id|NFSD_SUPPORTED_ATTRS_WORD0
)paren
op_logical_or
(paren
id|bmval
(braket
l_int|1
)braket
op_amp
op_complement
id|NFSD_SUPPORTED_ATTRS_WORD1
)paren
)paren
r_return
id|nfserr_attrnotsupp
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bmval
(braket
l_int|0
)braket
op_amp
op_complement
id|NFSD_WRITEABLE_ATTRS_WORD0
)paren
op_logical_or
(paren
id|bmval
(braket
l_int|1
)braket
op_amp
op_complement
id|NFSD_WRITEABLE_ATTRS_WORD1
)paren
)paren
r_return
id|nfserr_inval
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|expected_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmval
(braket
l_int|0
)braket
op_amp
id|FATTR4_WORD0_SIZE
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|len
op_add_assign
l_int|8
suffix:semicolon
id|READ64
c_func
(paren
id|iattr-&gt;ia_size
)paren
suffix:semicolon
id|iattr-&gt;ia_valid
op_or_assign
id|ATTR_SIZE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval
(braket
l_int|0
)braket
op_amp
id|FATTR4_WORD0_ACL
)paren
(brace
r_int
id|nace
comma
id|i
suffix:semicolon
r_struct
id|nfs4_ace
id|ace
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|len
op_add_assign
l_int|4
suffix:semicolon
id|READ32
c_func
(paren
id|nace
)paren
suffix:semicolon
op_star
id|acl
op_assign
id|nfs4_acl_new
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|acl
op_eq
l_int|NULL
)paren
(brace
id|status
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out_nfserr
suffix:semicolon
)brace
id|defer_free
c_func
(paren
id|argp
comma
(paren
r_void
(paren
op_star
)paren
(paren
r_const
r_void
op_star
)paren
)paren
id|nfs4_acl_free
comma
op_star
id|acl
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nace
suffix:semicolon
id|i
op_increment
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|16
)paren
suffix:semicolon
id|len
op_add_assign
l_int|16
suffix:semicolon
id|READ32
c_func
(paren
id|ace.type
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|ace.flag
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|ace.access_mask
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|dummy32
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|dummy32
)paren
suffix:semicolon
id|len
op_add_assign
id|XDR_QUADLEN
c_func
(paren
id|dummy32
)paren
op_lshift
l_int|2
suffix:semicolon
id|READMEM
c_func
(paren
id|buf
comma
id|dummy32
)paren
suffix:semicolon
r_if
c_cond
(paren
id|check_utf8
c_func
(paren
id|buf
comma
id|dummy32
)paren
)paren
r_return
id|nfserr_inval
suffix:semicolon
id|ace.whotype
op_assign
id|nfs4_acl_get_whotype
c_func
(paren
id|buf
comma
id|dummy32
)paren
suffix:semicolon
id|status
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ace.whotype
op_ne
id|NFS4_ACL_WHO_NAMED
)paren
id|ace.who
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|ace.flag
op_amp
id|NFS4_ACE_IDENTIFIER_GROUP
)paren
id|status
op_assign
id|nfsd_map_name_to_gid
c_func
(paren
id|argp-&gt;rqstp
comma
id|buf
comma
id|dummy32
comma
op_amp
id|ace.who
)paren
suffix:semicolon
r_else
id|status
op_assign
id|nfsd_map_name_to_uid
c_func
(paren
id|argp-&gt;rqstp
comma
id|buf
comma
id|dummy32
comma
op_amp
id|ace.who
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out_nfserr
suffix:semicolon
r_if
c_cond
(paren
id|nfs4_acl_add_ace
c_func
(paren
op_star
id|acl
comma
id|ace.type
comma
id|ace.flag
comma
id|ace.access_mask
comma
id|ace.whotype
comma
id|ace.who
)paren
op_ne
l_int|0
)paren
(brace
id|status
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out_nfserr
suffix:semicolon
)brace
)brace
)brace
r_else
op_star
id|acl
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|bmval
(braket
l_int|1
)braket
op_amp
id|FATTR4_WORD1_MODE
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|len
op_add_assign
l_int|4
suffix:semicolon
id|READ32
c_func
(paren
id|iattr-&gt;ia_mode
)paren
suffix:semicolon
id|iattr-&gt;ia_mode
op_and_assign
(paren
id|S_IFMT
op_or
id|S_IALLUGO
)paren
suffix:semicolon
id|iattr-&gt;ia_valid
op_or_assign
id|ATTR_MODE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval
(braket
l_int|1
)braket
op_amp
id|FATTR4_WORD1_OWNER
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|len
op_add_assign
l_int|4
suffix:semicolon
id|READ32
c_func
(paren
id|dummy32
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|dummy32
)paren
suffix:semicolon
id|len
op_add_assign
(paren
id|XDR_QUADLEN
c_func
(paren
id|dummy32
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
id|READMEM
c_func
(paren
id|buf
comma
id|dummy32
)paren
suffix:semicolon
r_if
c_cond
(paren
id|check_utf8
c_func
(paren
id|buf
comma
id|dummy32
)paren
)paren
r_return
id|nfserr_inval
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|nfsd_map_name_to_uid
c_func
(paren
id|argp-&gt;rqstp
comma
id|buf
comma
id|dummy32
comma
op_amp
id|iattr-&gt;ia_uid
)paren
)paren
)paren
r_goto
id|out_nfserr
suffix:semicolon
id|iattr-&gt;ia_valid
op_or_assign
id|ATTR_UID
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval
(braket
l_int|1
)braket
op_amp
id|FATTR4_WORD1_OWNER_GROUP
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|len
op_add_assign
l_int|4
suffix:semicolon
id|READ32
c_func
(paren
id|dummy32
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|dummy32
)paren
suffix:semicolon
id|len
op_add_assign
(paren
id|XDR_QUADLEN
c_func
(paren
id|dummy32
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
id|READMEM
c_func
(paren
id|buf
comma
id|dummy32
)paren
suffix:semicolon
r_if
c_cond
(paren
id|check_utf8
c_func
(paren
id|buf
comma
id|dummy32
)paren
)paren
r_return
id|nfserr_inval
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|nfsd_map_name_to_gid
c_func
(paren
id|argp-&gt;rqstp
comma
id|buf
comma
id|dummy32
comma
op_amp
id|iattr-&gt;ia_gid
)paren
)paren
)paren
r_goto
id|out_nfserr
suffix:semicolon
id|iattr-&gt;ia_valid
op_or_assign
id|ATTR_GID
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval
(braket
l_int|1
)braket
op_amp
id|FATTR4_WORD1_TIME_ACCESS_SET
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|len
op_add_assign
l_int|4
suffix:semicolon
id|READ32
c_func
(paren
id|dummy32
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|dummy32
)paren
(brace
r_case
id|NFS4_SET_TO_CLIENT_TIME
suffix:colon
multiline_comment|/* We require the high 32 bits of &squot;seconds&squot; to be 0, and we ignore&n;&t;&t;&t;   all 32 bits of &squot;nseconds&squot;. */
id|READ_BUF
c_func
(paren
l_int|12
)paren
suffix:semicolon
id|len
op_add_assign
l_int|12
suffix:semicolon
id|READ32
c_func
(paren
id|dummy32
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dummy32
)paren
r_return
id|nfserr_inval
suffix:semicolon
id|READ32
c_func
(paren
id|iattr-&gt;ia_atime.tv_sec
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|iattr-&gt;ia_atime.tv_nsec
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iattr-&gt;ia_atime.tv_nsec
op_ge
(paren
id|u32
)paren
l_int|1000000000
)paren
r_return
id|nfserr_inval
suffix:semicolon
id|iattr-&gt;ia_valid
op_or_assign
(paren
id|ATTR_ATIME
op_or
id|ATTR_ATIME_SET
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NFS4_SET_TO_SERVER_TIME
suffix:colon
id|iattr-&gt;ia_valid
op_or_assign
id|ATTR_ATIME
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|xdr_error
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|bmval
(braket
l_int|1
)braket
op_amp
id|FATTR4_WORD1_TIME_METADATA
)paren
(brace
multiline_comment|/* We require the high 32 bits of &squot;seconds&squot; to be 0, and we ignore&n;&t;&t;   all 32 bits of &squot;nseconds&squot;. */
id|READ_BUF
c_func
(paren
l_int|12
)paren
suffix:semicolon
id|len
op_add_assign
l_int|12
suffix:semicolon
id|READ32
c_func
(paren
id|dummy32
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dummy32
)paren
r_return
id|nfserr_inval
suffix:semicolon
id|READ32
c_func
(paren
id|iattr-&gt;ia_ctime.tv_sec
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|iattr-&gt;ia_ctime.tv_nsec
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iattr-&gt;ia_ctime.tv_nsec
op_ge
(paren
id|u32
)paren
l_int|1000000000
)paren
r_return
id|nfserr_inval
suffix:semicolon
id|iattr-&gt;ia_valid
op_or_assign
id|ATTR_CTIME
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval
(braket
l_int|1
)braket
op_amp
id|FATTR4_WORD1_TIME_MODIFY_SET
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|len
op_add_assign
l_int|4
suffix:semicolon
id|READ32
c_func
(paren
id|dummy32
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|dummy32
)paren
(brace
r_case
id|NFS4_SET_TO_CLIENT_TIME
suffix:colon
multiline_comment|/* We require the high 32 bits of &squot;seconds&squot; to be 0, and we ignore&n;&t;&t;&t;   all 32 bits of &squot;nseconds&squot;. */
id|READ_BUF
c_func
(paren
l_int|12
)paren
suffix:semicolon
id|len
op_add_assign
l_int|12
suffix:semicolon
id|READ32
c_func
(paren
id|dummy32
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dummy32
)paren
r_return
id|nfserr_inval
suffix:semicolon
id|READ32
c_func
(paren
id|iattr-&gt;ia_mtime.tv_sec
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|iattr-&gt;ia_mtime.tv_nsec
)paren
suffix:semicolon
r_if
c_cond
(paren
id|iattr-&gt;ia_mtime.tv_nsec
op_ge
(paren
id|u32
)paren
l_int|1000000000
)paren
r_return
id|nfserr_inval
suffix:semicolon
id|iattr-&gt;ia_valid
op_or_assign
(paren
id|ATTR_MTIME
op_or
id|ATTR_MTIME_SET
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NFS4_SET_TO_SERVER_TIME
suffix:colon
id|iattr-&gt;ia_valid
op_or_assign
id|ATTR_MTIME
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|xdr_error
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|len
op_ne
id|expected_len
)paren
r_goto
id|xdr_error
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
id|out_nfserr
suffix:colon
id|status
op_assign
id|nfserrno
c_func
(paren
id|status
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_access
id|nfsd4_decode_access
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_access
op_star
id|access
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|access-&gt;ac_req_access
)paren
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_close
id|nfsd4_decode_close
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_close
op_star
id|close
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|close-&gt;cl_stateowner
op_assign
l_int|NULL
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|4
op_plus
r_sizeof
(paren
id|stateid_t
)paren
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|close-&gt;cl_seqid
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|close-&gt;cl_stateid.si_generation
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
op_amp
id|close-&gt;cl_stateid.si_opaque
comma
r_sizeof
(paren
id|stateid_opaque_t
)paren
)paren
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_commit
id|nfsd4_decode_commit
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_commit
op_star
id|commit
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|12
)paren
suffix:semicolon
id|READ64
c_func
(paren
id|commit-&gt;co_offset
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|commit-&gt;co_count
)paren
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_create
id|nfsd4_decode_create
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_create
op_star
id|create
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|create-&gt;cr_type
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|create-&gt;cr_type
)paren
(brace
r_case
id|NF4LNK
suffix:colon
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|create-&gt;cr_linklen
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|create-&gt;cr_linklen
)paren
suffix:semicolon
id|SAVEMEM
c_func
(paren
id|create-&gt;cr_linkname
comma
id|create-&gt;cr_linklen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|check_utf8
c_func
(paren
id|create-&gt;cr_linkname
comma
id|create-&gt;cr_linklen
)paren
)paren
r_return
id|nfserr_inval
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NF4BLK
suffix:colon
r_case
id|NF4CHR
suffix:colon
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|create-&gt;cr_specdata1
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|create-&gt;cr_specdata2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NF4SOCK
suffix:colon
r_case
id|NF4FIFO
suffix:colon
r_case
id|NF4DIR
suffix:colon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|create-&gt;cr_namelen
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|create-&gt;cr_namelen
)paren
suffix:semicolon
id|SAVEMEM
c_func
(paren
id|create-&gt;cr_name
comma
id|create-&gt;cr_namelen
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|check_filename
c_func
(paren
id|create-&gt;cr_name
comma
id|create-&gt;cr_namelen
comma
id|nfserr_inval
)paren
)paren
)paren
r_return
id|status
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|nfsd4_decode_fattr
c_func
(paren
id|argp
comma
id|create-&gt;cr_bmval
comma
op_amp
id|create-&gt;cr_iattr
comma
op_amp
id|create-&gt;cr_acl
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|nfsd4_decode_delegreturn
id|nfsd4_decode_delegreturn
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_delegreturn
op_star
id|dr
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|READ_BUF
c_func
(paren
r_sizeof
(paren
id|stateid_t
)paren
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|dr-&gt;dr_stateid.si_generation
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
op_amp
id|dr-&gt;dr_stateid.si_opaque
comma
r_sizeof
(paren
id|stateid_opaque_t
)paren
)paren
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|nfsd4_decode_getattr
id|nfsd4_decode_getattr
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_getattr
op_star
id|getattr
)paren
(brace
r_return
id|nfsd4_decode_bitmap
c_func
(paren
id|argp
comma
id|getattr-&gt;ga_bmval
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_link
id|nfsd4_decode_link
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_link
op_star
id|link
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|link-&gt;li_namelen
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|link-&gt;li_namelen
)paren
suffix:semicolon
id|SAVEMEM
c_func
(paren
id|link-&gt;li_name
comma
id|link-&gt;li_namelen
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|check_filename
c_func
(paren
id|link-&gt;li_name
comma
id|link-&gt;li_namelen
comma
id|nfserr_inval
)paren
)paren
)paren
r_return
id|status
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_lock
id|nfsd4_decode_lock
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_lock
op_star
id|lock
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|lock-&gt;lk_stateowner
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;&t;* type, reclaim(boolean), offset, length, new_lock_owner(boolean)&n;&t;*/
id|READ_BUF
c_func
(paren
l_int|28
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|lock-&gt;lk_type
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|lock-&gt;lk_type
OL
id|NFS4_READ_LT
)paren
op_logical_or
(paren
id|lock-&gt;lk_type
OG
id|NFS4_WRITEW_LT
)paren
)paren
r_goto
id|xdr_error
suffix:semicolon
id|READ32
c_func
(paren
id|lock-&gt;lk_reclaim
)paren
suffix:semicolon
id|READ64
c_func
(paren
id|lock-&gt;lk_offset
)paren
suffix:semicolon
id|READ64
c_func
(paren
id|lock-&gt;lk_length
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|lock-&gt;lk_is_new
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lock-&gt;lk_is_new
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|36
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|lock-&gt;lk_new_open_seqid
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|lock-&gt;lk_new_open_stateid.si_generation
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
op_amp
id|lock-&gt;lk_new_open_stateid.si_opaque
comma
r_sizeof
(paren
id|stateid_opaque_t
)paren
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|lock-&gt;lk_new_lock_seqid
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
op_amp
id|lock-&gt;lk_new_clientid
comma
r_sizeof
(paren
id|clientid_t
)paren
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|lock-&gt;lk_new_owner.len
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|lock-&gt;lk_new_owner.len
)paren
suffix:semicolon
id|READMEM
c_func
(paren
id|lock-&gt;lk_new_owner.data
comma
id|lock-&gt;lk_new_owner.len
)paren
suffix:semicolon
)brace
r_else
(brace
id|READ_BUF
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|lock-&gt;lk_old_lock_stateid.si_generation
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
op_amp
id|lock-&gt;lk_old_lock_stateid.si_opaque
comma
r_sizeof
(paren
id|stateid_opaque_t
)paren
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|lock-&gt;lk_old_lock_seqid
)paren
suffix:semicolon
)brace
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_lockt
id|nfsd4_decode_lockt
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_lockt
op_star
id|lockt
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|32
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|lockt-&gt;lt_type
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|lockt-&gt;lt_type
OL
id|NFS4_READ_LT
)paren
op_logical_or
(paren
id|lockt-&gt;lt_type
OG
id|NFS4_WRITEW_LT
)paren
)paren
(brace
r_goto
id|xdr_error
suffix:semicolon
)brace
id|READ64
c_func
(paren
id|lockt-&gt;lt_offset
)paren
suffix:semicolon
id|READ64
c_func
(paren
id|lockt-&gt;lt_length
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
op_amp
id|lockt-&gt;lt_clientid
comma
l_int|8
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|lockt-&gt;lt_owner.len
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|lockt-&gt;lt_owner.len
)paren
suffix:semicolon
id|READMEM
c_func
(paren
id|lockt-&gt;lt_owner.data
comma
id|lockt-&gt;lt_owner.len
)paren
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_locku
id|nfsd4_decode_locku
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_locku
op_star
id|locku
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|locku-&gt;lu_stateowner
op_assign
l_int|NULL
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|24
op_plus
r_sizeof
(paren
id|stateid_t
)paren
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|locku-&gt;lu_type
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|locku-&gt;lu_type
OL
id|NFS4_READ_LT
)paren
op_logical_or
(paren
id|locku-&gt;lu_type
OG
id|NFS4_WRITEW_LT
)paren
)paren
r_goto
id|xdr_error
suffix:semicolon
id|READ32
c_func
(paren
id|locku-&gt;lu_seqid
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|locku-&gt;lu_stateid.si_generation
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
op_amp
id|locku-&gt;lu_stateid.si_opaque
comma
r_sizeof
(paren
id|stateid_opaque_t
)paren
)paren
suffix:semicolon
id|READ64
c_func
(paren
id|locku-&gt;lu_offset
)paren
suffix:semicolon
id|READ64
c_func
(paren
id|locku-&gt;lu_length
)paren
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_lookup
id|nfsd4_decode_lookup
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_lookup
op_star
id|lookup
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|lookup-&gt;lo_len
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|lookup-&gt;lo_len
)paren
suffix:semicolon
id|SAVEMEM
c_func
(paren
id|lookup-&gt;lo_name
comma
id|lookup-&gt;lo_len
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|check_filename
c_func
(paren
id|lookup-&gt;lo_name
comma
id|lookup-&gt;lo_len
comma
id|nfserr_noent
)paren
)paren
)paren
r_return
id|status
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_open
id|nfsd4_decode_open
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_open
op_star
id|open
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|memset
c_func
(paren
id|open-&gt;op_bmval
comma
l_int|0
comma
r_sizeof
(paren
id|open-&gt;op_bmval
)paren
)paren
suffix:semicolon
id|open-&gt;op_iattr.ia_valid
op_assign
l_int|0
suffix:semicolon
id|open-&gt;op_stateowner
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* seqid, share_access, share_deny, clientid, ownerlen */
id|READ_BUF
c_func
(paren
l_int|16
op_plus
r_sizeof
(paren
id|clientid_t
)paren
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|open-&gt;op_seqid
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|open-&gt;op_share_access
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|open-&gt;op_share_deny
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
op_amp
id|open-&gt;op_clientid
comma
r_sizeof
(paren
id|clientid_t
)paren
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|open-&gt;op_owner.len
)paren
suffix:semicolon
multiline_comment|/* owner, open_flag */
id|READ_BUF
c_func
(paren
id|open-&gt;op_owner.len
op_plus
l_int|4
)paren
suffix:semicolon
id|SAVEMEM
c_func
(paren
id|open-&gt;op_owner.data
comma
id|open-&gt;op_owner.len
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|open-&gt;op_create
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|open-&gt;op_create
)paren
(brace
r_case
id|NFS4_OPEN_NOCREATE
suffix:colon
r_break
suffix:semicolon
r_case
id|NFS4_OPEN_CREATE
suffix:colon
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|open-&gt;op_createmode
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|open-&gt;op_createmode
)paren
(brace
r_case
id|NFS4_CREATE_UNCHECKED
suffix:colon
r_case
id|NFS4_CREATE_GUARDED
suffix:colon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|nfsd4_decode_fattr
c_func
(paren
id|argp
comma
id|open-&gt;op_bmval
comma
op_amp
id|open-&gt;op_iattr
comma
op_amp
id|open-&gt;op_acl
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NFS4_CREATE_EXCLUSIVE
suffix:colon
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
id|open-&gt;op_verf.data
comma
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|xdr_error
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|xdr_error
suffix:semicolon
)brace
multiline_comment|/* open_claim */
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|open-&gt;op_claim_type
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|open-&gt;op_claim_type
)paren
(brace
r_case
id|NFS4_OPEN_CLAIM_NULL
suffix:colon
r_case
id|NFS4_OPEN_CLAIM_DELEGATE_PREV
suffix:colon
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|open-&gt;op_fname.len
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|open-&gt;op_fname.len
)paren
suffix:semicolon
id|SAVEMEM
c_func
(paren
id|open-&gt;op_fname.data
comma
id|open-&gt;op_fname.len
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|check_filename
c_func
(paren
id|open-&gt;op_fname.data
comma
id|open-&gt;op_fname.len
comma
id|nfserr_inval
)paren
)paren
)paren
r_return
id|status
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NFS4_OPEN_CLAIM_PREVIOUS
suffix:colon
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|open-&gt;op_delegate_type
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NFS4_OPEN_CLAIM_DELEGATE_CUR
suffix:colon
id|READ_BUF
c_func
(paren
r_sizeof
(paren
id|stateid_t
)paren
op_plus
l_int|4
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
op_amp
id|open-&gt;op_delegate_stateid
comma
r_sizeof
(paren
id|stateid_t
)paren
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|open-&gt;op_fname.len
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|open-&gt;op_fname.len
)paren
suffix:semicolon
id|SAVEMEM
c_func
(paren
id|open-&gt;op_fname.data
comma
id|open-&gt;op_fname.len
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|check_filename
c_func
(paren
id|open-&gt;op_fname.data
comma
id|open-&gt;op_fname.len
comma
id|nfserr_inval
)paren
)paren
)paren
r_return
id|status
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|xdr_error
suffix:semicolon
)brace
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_open_confirm
id|nfsd4_decode_open_confirm
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_open_confirm
op_star
id|open_conf
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|open_conf-&gt;oc_stateowner
op_assign
l_int|NULL
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|4
op_plus
r_sizeof
(paren
id|stateid_t
)paren
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|open_conf-&gt;oc_req_stateid.si_generation
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
op_amp
id|open_conf-&gt;oc_req_stateid.si_opaque
comma
r_sizeof
(paren
id|stateid_opaque_t
)paren
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|open_conf-&gt;oc_seqid
)paren
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_open_downgrade
id|nfsd4_decode_open_downgrade
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_open_downgrade
op_star
id|open_down
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|open_down-&gt;od_stateowner
op_assign
l_int|NULL
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|12
op_plus
r_sizeof
(paren
id|stateid_t
)paren
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|open_down-&gt;od_stateid.si_generation
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
op_amp
id|open_down-&gt;od_stateid.si_opaque
comma
r_sizeof
(paren
id|stateid_opaque_t
)paren
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|open_down-&gt;od_seqid
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|open_down-&gt;od_share_access
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|open_down-&gt;od_share_deny
)paren
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_putfh
id|nfsd4_decode_putfh
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_putfh
op_star
id|putfh
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|putfh-&gt;pf_fhlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|putfh-&gt;pf_fhlen
OG
id|NFS4_FHSIZE
)paren
r_goto
id|xdr_error
suffix:semicolon
id|READ_BUF
c_func
(paren
id|putfh-&gt;pf_fhlen
)paren
suffix:semicolon
id|SAVEMEM
c_func
(paren
id|putfh-&gt;pf_fhval
comma
id|putfh-&gt;pf_fhlen
)paren
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_read
id|nfsd4_decode_read
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_read
op_star
id|read
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|READ_BUF
c_func
(paren
r_sizeof
(paren
id|stateid_t
)paren
op_plus
l_int|12
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|read-&gt;rd_stateid.si_generation
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
op_amp
id|read-&gt;rd_stateid.si_opaque
comma
r_sizeof
(paren
id|stateid_opaque_t
)paren
)paren
suffix:semicolon
id|READ64
c_func
(paren
id|read-&gt;rd_offset
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|read-&gt;rd_length
)paren
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_readdir
id|nfsd4_decode_readdir
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_readdir
op_star
id|readdir
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|24
)paren
suffix:semicolon
id|READ64
c_func
(paren
id|readdir-&gt;rd_cookie
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
id|readdir-&gt;rd_verf.data
comma
r_sizeof
(paren
id|readdir-&gt;rd_verf.data
)paren
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|readdir-&gt;rd_dircount
)paren
suffix:semicolon
multiline_comment|/* just in case you needed a useless field... */
id|READ32
c_func
(paren
id|readdir-&gt;rd_maxcount
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|nfsd4_decode_bitmap
c_func
(paren
id|argp
comma
id|readdir-&gt;rd_bmval
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_remove
id|nfsd4_decode_remove
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_remove
op_star
id|remove
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|remove-&gt;rm_namelen
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|remove-&gt;rm_namelen
)paren
suffix:semicolon
id|SAVEMEM
c_func
(paren
id|remove-&gt;rm_name
comma
id|remove-&gt;rm_namelen
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|check_filename
c_func
(paren
id|remove-&gt;rm_name
comma
id|remove-&gt;rm_namelen
comma
id|nfserr_noent
)paren
)paren
)paren
r_return
id|status
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_rename
id|nfsd4_decode_rename
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_rename
op_star
id|rename
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|rename-&gt;rn_snamelen
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|rename-&gt;rn_snamelen
op_plus
l_int|4
)paren
suffix:semicolon
id|SAVEMEM
c_func
(paren
id|rename-&gt;rn_sname
comma
id|rename-&gt;rn_snamelen
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|rename-&gt;rn_tnamelen
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|rename-&gt;rn_tnamelen
)paren
suffix:semicolon
id|SAVEMEM
c_func
(paren
id|rename-&gt;rn_tname
comma
id|rename-&gt;rn_tnamelen
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|check_filename
c_func
(paren
id|rename-&gt;rn_sname
comma
id|rename-&gt;rn_snamelen
comma
id|nfserr_noent
)paren
)paren
)paren
r_return
id|status
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|check_filename
c_func
(paren
id|rename-&gt;rn_tname
comma
id|rename-&gt;rn_tnamelen
comma
id|nfserr_inval
)paren
)paren
)paren
r_return
id|status
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_renew
id|nfsd4_decode_renew
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
id|clientid_t
op_star
id|clientid
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|READ_BUF
c_func
(paren
r_sizeof
(paren
id|clientid_t
)paren
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
id|clientid
comma
r_sizeof
(paren
id|clientid_t
)paren
)paren
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_setattr
id|nfsd4_decode_setattr
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_setattr
op_star
id|setattr
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|READ_BUF
c_func
(paren
r_sizeof
(paren
id|stateid_t
)paren
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|setattr-&gt;sa_stateid.si_generation
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
op_amp
id|setattr-&gt;sa_stateid.si_opaque
comma
r_sizeof
(paren
id|stateid_opaque_t
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|nfsd4_decode_fattr
c_func
(paren
id|argp
comma
id|setattr-&gt;sa_bmval
comma
op_amp
id|setattr-&gt;sa_iattr
comma
op_amp
id|setattr-&gt;sa_acl
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_setclientid
id|nfsd4_decode_setclientid
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_setclientid
op_star
id|setclientid
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|12
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
id|setclientid-&gt;se_verf.data
comma
l_int|8
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|setclientid-&gt;se_namelen
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|setclientid-&gt;se_namelen
op_plus
l_int|8
)paren
suffix:semicolon
id|SAVEMEM
c_func
(paren
id|setclientid-&gt;se_name
comma
id|setclientid-&gt;se_namelen
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|setclientid-&gt;se_callback_prog
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|setclientid-&gt;se_callback_netid_len
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|setclientid-&gt;se_callback_netid_len
op_plus
l_int|4
)paren
suffix:semicolon
id|SAVEMEM
c_func
(paren
id|setclientid-&gt;se_callback_netid_val
comma
id|setclientid-&gt;se_callback_netid_len
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|setclientid-&gt;se_callback_addr_len
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|setclientid-&gt;se_callback_addr_len
op_plus
l_int|4
)paren
suffix:semicolon
id|SAVEMEM
c_func
(paren
id|setclientid-&gt;se_callback_addr_val
comma
id|setclientid-&gt;se_callback_addr_len
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|setclientid-&gt;se_callback_ident
)paren
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_setclientid_confirm
id|nfsd4_decode_setclientid_confirm
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_setclientid_confirm
op_star
id|scd_c
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|8
op_plus
r_sizeof
(paren
id|nfs4_verifier
)paren
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
op_amp
id|scd_c-&gt;sc_clientid
comma
l_int|8
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
op_amp
id|scd_c-&gt;sc_confirm
comma
r_sizeof
(paren
id|nfs4_verifier
)paren
)paren
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
multiline_comment|/* Also used for NVERIFY */
r_static
r_int
DECL|function|nfsd4_decode_verify
id|nfsd4_decode_verify
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_verify
op_star
id|verify
)paren
(brace
macro_line|#if 0
r_struct
id|nfsd4_compoundargs
id|save
op_assign
(brace
dot
id|p
op_assign
id|argp-&gt;p
comma
dot
id|end
op_assign
id|argp-&gt;end
comma
dot
id|rqstp
op_assign
id|argp-&gt;rqstp
comma
)brace
suffix:semicolon
id|u32
id|ve_bmval
(braket
l_int|2
)braket
suffix:semicolon
r_struct
id|iattr
id|ve_iattr
suffix:semicolon
multiline_comment|/* request */
r_struct
id|nfs4_acl
op_star
id|ve_acl
suffix:semicolon
multiline_comment|/* request */
macro_line|#endif
id|DECODE_HEAD
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|nfsd4_decode_bitmap
c_func
(paren
id|argp
comma
id|verify-&gt;ve_bmval
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* For convenience&squot;s sake, we compare raw xdr&squot;d attributes in&n;&t; * nfsd4_proc_verify; however we still decode here just to return&n;&t; * correct error in case of bad xdr. */
macro_line|#if 0
id|status
op_assign
id|nfsd4_decode_fattr
c_func
(paren
id|ve_bmval
comma
op_amp
id|ve_iattr
comma
op_amp
id|ve_acl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
id|nfserr_inval
)paren
(brace
id|status
op_assign
id|nfserrno
c_func
(paren
id|status
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
macro_line|#endif
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|verify-&gt;ve_attrlen
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|verify-&gt;ve_attrlen
)paren
suffix:semicolon
id|SAVEMEM
c_func
(paren
id|verify-&gt;ve_attrval
comma
id|verify-&gt;ve_attrlen
)paren
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_write
id|nfsd4_decode_write
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_write
op_star
id|write
)paren
(brace
r_int
id|avail
suffix:semicolon
r_int
id|v
suffix:semicolon
r_int
id|len
suffix:semicolon
id|DECODE_HEAD
suffix:semicolon
id|READ_BUF
c_func
(paren
r_sizeof
(paren
id|stateid_opaque_t
)paren
op_plus
l_int|20
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|write-&gt;wr_stateid.si_generation
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
op_amp
id|write-&gt;wr_stateid.si_opaque
comma
r_sizeof
(paren
id|stateid_opaque_t
)paren
)paren
suffix:semicolon
id|READ64
c_func
(paren
id|write-&gt;wr_offset
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|write-&gt;wr_stable_how
)paren
suffix:semicolon
r_if
c_cond
(paren
id|write-&gt;wr_stable_how
OG
l_int|2
)paren
r_goto
id|xdr_error
suffix:semicolon
id|READ32
c_func
(paren
id|write-&gt;wr_buflen
)paren
suffix:semicolon
multiline_comment|/* Sorry .. no magic macros for this.. *&n;&t; * READ_BUF(write-&gt;wr_buflen);&n;&t; * SAVEMEM(write-&gt;wr_buf, write-&gt;wr_buflen);&n;&t; */
id|avail
op_assign
(paren
r_char
op_star
)paren
id|argp-&gt;end
op_minus
(paren
r_char
op_star
)paren
id|argp-&gt;p
suffix:semicolon
r_if
c_cond
(paren
id|avail
op_plus
id|argp-&gt;pagelen
OL
id|write-&gt;wr_buflen
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;xdr error! (%s:%d)&bslash;n&quot;
comma
id|__FILE__
comma
id|__LINE__
)paren
suffix:semicolon
r_goto
id|xdr_error
suffix:semicolon
)brace
id|write-&gt;wr_vec
(braket
l_int|0
)braket
dot
id|iov_base
op_assign
id|p
suffix:semicolon
id|write-&gt;wr_vec
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
id|avail
suffix:semicolon
id|v
op_assign
l_int|0
suffix:semicolon
id|len
op_assign
id|write-&gt;wr_buflen
suffix:semicolon
r_while
c_loop
(paren
id|len
OG
id|write-&gt;wr_vec
(braket
id|v
)braket
dot
id|iov_len
)paren
(brace
id|len
op_sub_assign
id|write-&gt;wr_vec
(braket
id|v
)braket
dot
id|iov_len
suffix:semicolon
id|v
op_increment
suffix:semicolon
id|write-&gt;wr_vec
(braket
id|v
)braket
dot
id|iov_base
op_assign
id|page_address
c_func
(paren
id|argp-&gt;pagelist
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|argp-&gt;pagelist
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|argp-&gt;pagelen
op_ge
id|PAGE_SIZE
)paren
(brace
id|write-&gt;wr_vec
(braket
id|v
)braket
dot
id|iov_len
op_assign
id|PAGE_SIZE
suffix:semicolon
id|argp-&gt;pagelen
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
r_else
(brace
id|write-&gt;wr_vec
(braket
id|v
)braket
dot
id|iov_len
op_assign
id|argp-&gt;pagelen
suffix:semicolon
id|argp-&gt;pagelen
op_sub_assign
id|len
suffix:semicolon
)brace
)brace
id|argp-&gt;end
op_assign
(paren
id|u32
op_star
)paren
(paren
id|write-&gt;wr_vec
(braket
id|v
)braket
dot
id|iov_base
op_plus
id|write-&gt;wr_vec
(braket
id|v
)braket
dot
id|iov_len
)paren
suffix:semicolon
id|argp-&gt;p
op_assign
(paren
id|u32
op_star
)paren
(paren
id|write-&gt;wr_vec
(braket
id|v
)braket
dot
id|iov_base
op_plus
(paren
id|XDR_QUADLEN
c_func
(paren
id|len
)paren
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|write-&gt;wr_vec
(braket
id|v
)braket
dot
id|iov_len
op_assign
id|len
suffix:semicolon
id|write-&gt;wr_vlen
op_assign
id|v
op_plus
l_int|1
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_release_lockowner
id|nfsd4_decode_release_lockowner
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
comma
r_struct
id|nfsd4_release_lockowner
op_star
id|rlockowner
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|12
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
op_amp
id|rlockowner-&gt;rl_clientid
comma
r_sizeof
(paren
id|clientid_t
)paren
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|rlockowner-&gt;rl_owner.len
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|rlockowner-&gt;rl_owner.len
)paren
suffix:semicolon
id|READMEM
c_func
(paren
id|rlockowner-&gt;rl_owner.data
comma
id|rlockowner-&gt;rl_owner.len
)paren
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_decode_compound
id|nfsd4_decode_compound
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|argp
)paren
(brace
id|DECODE_HEAD
suffix:semicolon
r_struct
id|nfsd4_op
op_star
id|op
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/*&n;&t; * XXX: According to spec, we should check the tag&n;&t; * for UTF-8 compliance.  I&squot;m postponing this for&n;&t; * now because it seems that some clients do use&n;&t; * binary tags.&n;&t; */
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|argp-&gt;taglen
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|argp-&gt;taglen
op_plus
l_int|8
)paren
suffix:semicolon
id|SAVEMEM
c_func
(paren
id|argp-&gt;tag
comma
id|argp-&gt;taglen
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|argp-&gt;minorversion
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|argp-&gt;opcnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|argp-&gt;taglen
OG
id|NFSD4_MAX_TAGLEN
)paren
r_goto
id|xdr_error
suffix:semicolon
r_if
c_cond
(paren
id|argp-&gt;opcnt
OG
l_int|100
)paren
r_goto
id|xdr_error
suffix:semicolon
r_if
c_cond
(paren
id|argp-&gt;opcnt
OG
r_sizeof
(paren
id|argp-&gt;iops
)paren
op_div
r_sizeof
(paren
id|argp-&gt;iops
(braket
l_int|0
)braket
)paren
)paren
(brace
id|argp-&gt;ops
op_assign
id|kmalloc
c_func
(paren
id|argp-&gt;opcnt
op_star
r_sizeof
(paren
op_star
id|argp-&gt;ops
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|argp-&gt;ops
)paren
(brace
id|argp-&gt;ops
op_assign
id|argp-&gt;iops
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;nfsd: couldn&squot;t allocate room for COMPOUND&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|xdr_error
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|argp-&gt;opcnt
suffix:semicolon
id|i
op_increment
)paren
(brace
id|op
op_assign
op_amp
id|argp-&gt;ops
(braket
id|i
)braket
suffix:semicolon
id|op-&gt;replay
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;&t;&t; * We can&squot;t use READ_BUF() here because we need to handle&n;&t;&t; * a missing opcode as an OP_WRITE + 1. So we need to check&n;&t;&t; * to see if we&squot;re truly at the end of our buffer or if there&n;&t;&t; * is another page we need to flip to.&n;&t;&t; */
r_if
c_cond
(paren
id|argp-&gt;p
op_eq
id|argp-&gt;end
)paren
(brace
r_if
c_cond
(paren
id|argp-&gt;pagelen
OL
l_int|4
)paren
(brace
multiline_comment|/* There isn&squot;t an opcode still on the wire */
id|op-&gt;opnum
op_assign
id|OP_WRITE
op_plus
l_int|1
suffix:semicolon
id|op-&gt;status
op_assign
id|nfserr_bad_xdr
suffix:semicolon
id|argp-&gt;opcnt
op_assign
id|i
op_plus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t; * False alarm. We just hit a page boundary, but there&n;&t;&t;&t; * is still data available.  Move pointer across page&n;&t;&t;&t; * boundary.  *snip from READ_BUF*&n;&t;&t;&t; */
id|argp-&gt;p
op_assign
id|page_address
c_func
(paren
id|argp-&gt;pagelist
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|argp-&gt;pagelist
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|argp-&gt;pagelen
OL
id|PAGE_SIZE
)paren
(brace
id|argp-&gt;end
op_assign
id|p
op_plus
(paren
id|argp-&gt;pagelen
op_rshift
l_int|2
)paren
suffix:semicolon
id|argp-&gt;pagelen
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|argp-&gt;end
op_assign
id|p
op_plus
(paren
id|PAGE_SIZE
op_rshift
l_int|2
)paren
suffix:semicolon
id|argp-&gt;pagelen
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
id|op-&gt;opnum
op_assign
id|ntohl
c_func
(paren
op_star
id|argp-&gt;p
op_increment
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|op-&gt;opnum
)paren
(brace
r_case
l_int|2
suffix:colon
multiline_comment|/* Reserved operation */
id|op-&gt;opnum
op_assign
id|OP_ILLEGAL
suffix:semicolon
r_if
c_cond
(paren
id|argp-&gt;minorversion
op_eq
l_int|0
)paren
id|op-&gt;status
op_assign
id|nfserr_op_illegal
suffix:semicolon
r_else
id|op-&gt;status
op_assign
id|nfserr_minor_vers_mismatch
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_ACCESS
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_access
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.access
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_CLOSE
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_close
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.close
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_COMMIT
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_commit
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.commit
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_CREATE
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_create
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.create
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_DELEGRETURN
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_delegreturn
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.delegreturn
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_GETATTR
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_getattr
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.getattr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_GETFH
suffix:colon
id|op-&gt;status
op_assign
id|nfs_ok
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_LINK
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_link
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.link
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_LOCK
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_lock
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.lock
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_LOCKT
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_lockt
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.lockt
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_LOCKU
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_locku
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.locku
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_LOOKUP
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_lookup
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.lookup
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_LOOKUPP
suffix:colon
id|op-&gt;status
op_assign
id|nfs_ok
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_NVERIFY
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_verify
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.nverify
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_OPEN
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_open
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.open
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_OPEN_CONFIRM
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_open_confirm
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.open_confirm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_OPEN_DOWNGRADE
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_open_downgrade
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.open_downgrade
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_PUTFH
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_putfh
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.putfh
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_PUTROOTFH
suffix:colon
id|op-&gt;status
op_assign
id|nfs_ok
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_READ
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_read
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.read
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_READDIR
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_readdir
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.readdir
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_READLINK
suffix:colon
id|op-&gt;status
op_assign
id|nfs_ok
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_REMOVE
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_remove
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.remove
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_RENAME
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_rename
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.rename
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_RESTOREFH
suffix:colon
id|op-&gt;status
op_assign
id|nfs_ok
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_RENEW
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_renew
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.renew
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_SAVEFH
suffix:colon
id|op-&gt;status
op_assign
id|nfs_ok
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_SETATTR
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_setattr
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.setattr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_SETCLIENTID
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_setclientid
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.setclientid
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_SETCLIENTID_CONFIRM
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_setclientid_confirm
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.setclientid_confirm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_VERIFY
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_verify
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.verify
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_WRITE
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_write
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.write
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_RELEASE_LOCKOWNER
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_decode_release_lockowner
c_func
(paren
id|argp
comma
op_amp
id|op-&gt;u.release_lockowner
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|op-&gt;opnum
op_assign
id|OP_ILLEGAL
suffix:semicolon
id|op-&gt;status
op_assign
id|nfserr_op_illegal
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|op-&gt;status
)paren
(brace
id|argp-&gt;opcnt
op_assign
id|i
op_plus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|DECODE_TAIL
suffix:semicolon
)brace
multiline_comment|/*&n; * END OF &quot;GENERIC&quot; DECODE ROUTINES.&n; */
multiline_comment|/*&n; * START OF &quot;GENERIC&quot; ENCODE ROUTINES.&n; *   These may look a little ugly since they are imported from a &quot;generic&quot;&n; * set of XDR encode/decode routines which are intended to be shared by&n; * all of our NFSv4 implementations (OpenBSD, MacOS X...).&n; *&n; * If the pain of reading these is too great, it should be a straightforward&n; * task to translate them into Linux-specific versions which are more&n; * consistent with the style used in NFSv2/v3...&n; */
DECL|macro|ENCODE_HEAD
mdefine_line|#define ENCODE_HEAD              u32 *p
DECL|macro|WRITE32
mdefine_line|#define WRITE32(n)               *p++ = htonl(n)
DECL|macro|WRITE64
mdefine_line|#define WRITE64(n)               do {&t;&t;&t;&t;&bslash;&n;&t;*p++ = htonl((u32)((n) &gt;&gt; 32));&t;&t;&t;&t;&bslash;&n;&t;*p++ = htonl((u32)(n));&t;&t;&t;&t;&t;&bslash;&n;} while (0)
DECL|macro|WRITEMEM
mdefine_line|#define WRITEMEM(ptr,nbytes)     do {&t;&t;&t;&t;&bslash;&n;&t;*(p + XDR_QUADLEN(nbytes) -1) = 0;                      &bslash;&n;&t;memcpy(p, ptr, nbytes);&t;&t;&t;&t;&t;&bslash;&n;&t;p += XDR_QUADLEN(nbytes);&t;&t;&t;&t;&bslash;&n;} while (0)
DECL|macro|WRITECINFO
mdefine_line|#define WRITECINFO(c)&t;&t;do {&t;&t;&t;&t;&bslash;&n;&t;*p++ = htonl(c.atomic);&t;&t;&t;&t;&t;&bslash;&n;&t;*p++ = htonl(c.before_ctime_sec);&t;&t;&t;&t;&bslash;&n;&t;*p++ = htonl(c.before_ctime_nsec);&t;&t;&t;&t;&bslash;&n;&t;*p++ = htonl(c.after_ctime_sec);&t;&t;&t;&t;&bslash;&n;&t;*p++ = htonl(c.after_ctime_nsec);&t;&t;&t;&t;&bslash;&n;} while (0)
DECL|macro|RESERVE_SPACE
mdefine_line|#define RESERVE_SPACE(nbytes)&t;do {&t;&t;&t;&t;&bslash;&n;&t;p = resp-&gt;p;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;BUG_ON(p + XDR_QUADLEN(nbytes) &gt; resp-&gt;end);&t;&t;&bslash;&n;} while (0)
DECL|macro|ADJUST_ARGS
mdefine_line|#define ADJUST_ARGS()&t;&t;resp-&gt;p = p
multiline_comment|/*&n; * Header routine to setup seqid operation replay cache&n; */
DECL|macro|ENCODE_SEQID_OP_HEAD
mdefine_line|#define ENCODE_SEQID_OP_HEAD&t;&t;&t;&t;&t;&bslash;&n;&t;u32 *p;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;u32 *save;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;save = resp-&gt;p;
multiline_comment|/*&n; * Routine for encoding the result of a&n; * &quot;seqid-mutating&quot; NFSv4 operation.  This is&n; * where seqids are incremented, and the&n; * replay cache is filled.&n; */
DECL|macro|ENCODE_SEQID_OP_TAIL
mdefine_line|#define ENCODE_SEQID_OP_TAIL(stateowner) do {&t;&t;&t;&bslash;&n;&t;if (seqid_mutating_err(nfserr) &amp;&amp; stateowner) { &t;&bslash;&n;&t;&t;if (stateowner-&gt;so_confirmed)&t;&t;&t;&bslash;&n;&t;&t;&t;stateowner-&gt;so_seqid++;&t;&t;&t;&bslash;&n;&t;&t;stateowner-&gt;so_replay.rp_status = nfserr;   &t;&bslash;&n;&t;&t;stateowner-&gt;so_replay.rp_buflen = &t;&t;&bslash;&n;&t;&t;&t;  (((char *)(resp)-&gt;p - (char *)save)); &bslash;&n;&t;&t;memcpy(stateowner-&gt;so_replay.rp_buf, save,      &bslash;&n; &t;&t;&t;stateowner-&gt;so_replay.rp_buflen); &t;&bslash;&n;&t;} } while (0);
DECL|variable|nfs4_ftypes
r_static
id|u32
id|nfs4_ftypes
(braket
l_int|16
)braket
op_assign
(brace
id|NF4BAD
comma
id|NF4FIFO
comma
id|NF4CHR
comma
id|NF4BAD
comma
id|NF4DIR
comma
id|NF4BAD
comma
id|NF4BLK
comma
id|NF4BAD
comma
id|NF4REG
comma
id|NF4BAD
comma
id|NF4LNK
comma
id|NF4BAD
comma
id|NF4SOCK
comma
id|NF4BAD
comma
id|NF4LNK
comma
id|NF4BAD
comma
)brace
suffix:semicolon
r_static
r_int
DECL|function|nfsd4_encode_name
id|nfsd4_encode_name
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
r_int
id|whotype
comma
id|uid_t
id|id
comma
r_int
id|group
comma
id|u32
op_star
op_star
id|p
comma
r_int
op_star
id|buflen
)paren
(brace
r_int
id|status
suffix:semicolon
r_if
c_cond
(paren
op_star
id|buflen
OL
(paren
id|XDR_QUADLEN
c_func
(paren
id|IDMAP_NAMESZ
)paren
op_lshift
l_int|2
)paren
op_plus
l_int|4
)paren
r_return
id|nfserr_resource
suffix:semicolon
r_if
c_cond
(paren
id|whotype
op_ne
id|NFS4_ACL_WHO_NAMED
)paren
id|status
op_assign
id|nfs4_acl_write_who
c_func
(paren
id|whotype
comma
(paren
id|u8
op_star
)paren
(paren
op_star
id|p
op_plus
l_int|1
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|group
)paren
id|status
op_assign
id|nfsd_map_gid_to_name
c_func
(paren
id|rqstp
comma
id|id
comma
(paren
id|u8
op_star
)paren
(paren
op_star
id|p
op_plus
l_int|1
)paren
)paren
suffix:semicolon
r_else
id|status
op_assign
id|nfsd_map_uid_to_name
c_func
(paren
id|rqstp
comma
id|id
comma
(paren
id|u8
op_star
)paren
(paren
op_star
id|p
op_plus
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
OL
l_int|0
)paren
r_return
id|nfserrno
c_func
(paren
id|status
)paren
suffix:semicolon
op_star
id|p
op_assign
id|xdr_encode_opaque
c_func
(paren
op_star
id|p
comma
l_int|NULL
comma
id|status
)paren
suffix:semicolon
op_star
id|buflen
op_sub_assign
(paren
id|XDR_QUADLEN
c_func
(paren
id|status
)paren
op_lshift
l_int|2
)paren
op_plus
l_int|4
suffix:semicolon
id|BUG_ON
c_func
(paren
op_star
id|buflen
OL
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|nfsd4_encode_user
id|nfsd4_encode_user
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|uid_t
id|uid
comma
id|u32
op_star
op_star
id|p
comma
r_int
op_star
id|buflen
)paren
(brace
r_return
id|nfsd4_encode_name
c_func
(paren
id|rqstp
comma
id|NFS4_ACL_WHO_NAMED
comma
id|uid
comma
l_int|0
comma
id|p
comma
id|buflen
)paren
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|nfsd4_encode_group
id|nfsd4_encode_group
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|uid_t
id|gid
comma
id|u32
op_star
op_star
id|p
comma
r_int
op_star
id|buflen
)paren
(brace
r_return
id|nfsd4_encode_name
c_func
(paren
id|rqstp
comma
id|NFS4_ACL_WHO_NAMED
comma
id|gid
comma
l_int|1
comma
id|p
comma
id|buflen
)paren
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|nfsd4_encode_aclname
id|nfsd4_encode_aclname
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
r_int
id|whotype
comma
id|uid_t
id|id
comma
r_int
id|group
comma
id|u32
op_star
op_star
id|p
comma
r_int
op_star
id|buflen
)paren
(brace
r_return
id|nfsd4_encode_name
c_func
(paren
id|rqstp
comma
id|whotype
comma
id|id
comma
id|group
comma
id|p
comma
id|buflen
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Note: @fhp can be NULL; in this case, we might have to compose the filehandle&n; * ourselves.&n; *&n; * @countp is the buffer size in _words_; upon successful return this becomes&n; * replaced with the number of words written.&n; */
r_int
DECL|function|nfsd4_encode_fattr
id|nfsd4_encode_fattr
c_func
(paren
r_struct
id|svc_fh
op_star
id|fhp
comma
r_struct
id|svc_export
op_star
id|exp
comma
r_struct
id|dentry
op_star
id|dentry
comma
id|u32
op_star
id|buffer
comma
r_int
op_star
id|countp
comma
id|u32
op_star
id|bmval
comma
r_struct
id|svc_rqst
op_star
id|rqstp
)paren
(brace
id|u32
id|bmval0
op_assign
id|bmval
(braket
l_int|0
)braket
suffix:semicolon
id|u32
id|bmval1
op_assign
id|bmval
(braket
l_int|1
)braket
suffix:semicolon
r_struct
id|kstat
id|stat
suffix:semicolon
r_struct
id|svc_fh
id|tempfh
suffix:semicolon
r_struct
id|kstatfs
id|statfs
suffix:semicolon
r_int
id|buflen
op_assign
op_star
id|countp
op_lshift
l_int|2
suffix:semicolon
id|u32
op_star
id|attrlenp
suffix:semicolon
id|u32
id|dummy
suffix:semicolon
id|u64
id|dummy64
suffix:semicolon
id|u32
op_star
id|p
op_assign
id|buffer
suffix:semicolon
r_int
id|status
suffix:semicolon
r_int
id|aclsupport
op_assign
l_int|0
suffix:semicolon
r_struct
id|nfs4_acl
op_star
id|acl
op_assign
l_int|NULL
suffix:semicolon
id|BUG_ON
c_func
(paren
id|bmval1
op_amp
id|NFSD_WRITEONLY_ATTRS_WORD1
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|bmval0
op_amp
op_complement
id|NFSD_SUPPORTED_ATTRS_WORD0
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|bmval1
op_amp
op_complement
id|NFSD_SUPPORTED_ATTRS_WORD1
)paren
suffix:semicolon
id|status
op_assign
id|vfs_getattr
c_func
(paren
id|exp-&gt;ex_mnt
comma
id|dentry
comma
op_amp
id|stat
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out_nfserr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bmval0
op_amp
(paren
id|FATTR4_WORD0_FILES_FREE
op_or
id|FATTR4_WORD0_FILES_TOTAL
)paren
)paren
op_logical_or
(paren
id|bmval1
op_amp
(paren
id|FATTR4_WORD1_SPACE_AVAIL
op_or
id|FATTR4_WORD1_SPACE_FREE
op_or
id|FATTR4_WORD1_SPACE_TOTAL
)paren
)paren
)paren
(brace
id|status
op_assign
id|vfs_statfs
c_func
(paren
id|dentry-&gt;d_inode-&gt;i_sb
comma
op_amp
id|statfs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out_nfserr
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bmval0
op_amp
(paren
id|FATTR4_WORD0_FILEHANDLE
op_or
id|FATTR4_WORD0_FSID
)paren
)paren
op_logical_and
op_logical_neg
id|fhp
)paren
(brace
id|fh_init
c_func
(paren
op_amp
id|tempfh
comma
id|NFS4_FHSIZE
)paren
suffix:semicolon
id|status
op_assign
id|fh_compose
c_func
(paren
op_amp
id|tempfh
comma
id|exp
comma
id|dentry
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|fhp
op_assign
op_amp
id|tempfh
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
(paren
id|FATTR4_WORD0_ACL
op_or
id|FATTR4_WORD0_ACLSUPPORT
op_or
id|FATTR4_WORD0_SUPPORTED_ATTRS
)paren
)paren
(brace
id|status
op_assign
id|nfsd4_get_nfs4_acl
c_func
(paren
id|rqstp
comma
id|dentry
comma
op_amp
id|acl
)paren
suffix:semicolon
id|aclsupport
op_assign
(paren
id|status
op_eq
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_ACL
)paren
(brace
r_if
c_cond
(paren
id|status
op_eq
op_minus
id|EOPNOTSUPP
)paren
id|bmval0
op_and_assign
op_complement
id|FATTR4_WORD0_ACL
suffix:semicolon
r_else
r_if
c_cond
(paren
id|status
op_ne
l_int|0
)paren
r_goto
id|out_nfserr
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|16
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|bmval0
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|bmval1
)paren
suffix:semicolon
id|attrlenp
op_assign
id|p
op_increment
suffix:semicolon
multiline_comment|/* to be backfilled later */
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_SUPPORTED_ATTRS
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|12
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|aclsupport
ques
c_cond
id|NFSD_SUPPORTED_ATTRS_WORD0
suffix:colon
id|NFSD_SUPPORTED_ATTRS_WORD0
op_amp
op_complement
id|FATTR4_WORD0_ACL
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|NFSD_SUPPORTED_ATTRS_WORD1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_TYPE
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|dummy
op_assign
id|nfs4_ftypes
(braket
(paren
id|stat.mode
op_amp
id|S_IFMT
)paren
op_rshift
l_int|12
)braket
suffix:semicolon
r_if
c_cond
(paren
id|dummy
op_eq
id|NF4BAD
)paren
r_goto
id|out_serverfault
suffix:semicolon
id|WRITE32
c_func
(paren
id|dummy
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_FH_EXPIRE_TYPE
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
id|NFS4_FH_NOEXPIRE_WITH_OPEN
op_or
id|NFS4_FH_VOL_RENAME
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_CHANGE
)paren
(brace
multiline_comment|/*&n;&t;&t; * Note: This _must_ be consistent with the scheme for writing&n;&t;&t; * change_info, so any changes made here must be reflected there&n;&t;&t; * as well.  (See xdr4.h:set_change_info() and the WRITECINFO()&n;&t;&t; * macro above.)&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|8
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
id|stat.ctime.tv_sec
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|stat.ctime.tv_nsec
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_SIZE
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|8
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE64
c_func
(paren
id|stat.size
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_LINK_SUPPORT
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_SYMLINK_SUPPORT
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_NAMED_ATTR
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_FSID
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|16
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
r_if
c_cond
(paren
id|is_fsid
c_func
(paren
id|fhp
comma
id|rqstp-&gt;rq_reffh
)paren
)paren
(brace
id|WRITE64
c_func
(paren
(paren
id|u64
)paren
id|exp-&gt;ex_fsid
)paren
suffix:semicolon
id|WRITE64
c_func
(paren
(paren
id|u64
)paren
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|MAJOR
c_func
(paren
id|stat.dev
)paren
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|MINOR
c_func
(paren
id|stat.dev
)paren
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_UNIQUE_HANDLES
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_LEASE_TIME
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
id|NFSD_LEASE_TIME
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_RDATTR_ERROR
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_ACL
)paren
(brace
r_struct
id|nfs4_ace
op_star
id|ace
suffix:semicolon
r_struct
id|list_head
op_star
id|h
suffix:semicolon
r_if
c_cond
(paren
id|acl
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_goto
id|out_acl
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
id|acl-&gt;naces
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|h
comma
op_amp
id|acl-&gt;ace_head
)paren
(brace
id|ace
op_assign
id|list_entry
c_func
(paren
id|h
comma
r_struct
id|nfs4_ace
comma
id|l_ace
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
op_star
l_int|3
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
id|ace-&gt;type
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|ace-&gt;flag
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|ace-&gt;access_mask
op_amp
id|NFS4_ACE_MASK_ALL
)paren
suffix:semicolon
id|status
op_assign
id|nfsd4_encode_aclname
c_func
(paren
id|rqstp
comma
id|ace-&gt;whotype
comma
id|ace-&gt;who
comma
id|ace-&gt;flag
op_amp
id|NFS4_ACE_IDENTIFIER_GROUP
comma
op_amp
id|p
comma
op_amp
id|buflen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
id|nfserr_resource
)paren
r_goto
id|out_resource
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
)brace
)brace
id|out_acl
suffix:colon
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_ACLSUPPORT
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
id|aclsupport
ques
c_cond
id|ACL4_SUPPORT_ALLOW_ACL
op_or
id|ACL4_SUPPORT_DENY_ACL
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_CANSETTIME
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_CASE_INSENSITIVE
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_CASE_PRESERVING
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_CHOWN_RESTRICTED
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_FILEHANDLE
)paren
(brace
id|buflen
op_sub_assign
(paren
id|XDR_QUADLEN
c_func
(paren
id|fhp-&gt;fh_handle.fh_size
)paren
op_lshift
l_int|2
)paren
op_plus
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|buflen
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
id|fhp-&gt;fh_handle.fh_size
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
op_amp
id|fhp-&gt;fh_handle.fh_base
comma
id|fhp-&gt;fh_handle.fh_size
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_FILEID
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|8
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE64
c_func
(paren
(paren
id|u64
)paren
id|stat.ino
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_FILES_AVAIL
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|8
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE64
c_func
(paren
(paren
id|u64
)paren
id|statfs.f_ffree
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_FILES_FREE
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|8
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE64
c_func
(paren
(paren
id|u64
)paren
id|statfs.f_ffree
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_FILES_TOTAL
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|8
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE64
c_func
(paren
(paren
id|u64
)paren
id|statfs.f_files
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_HOMOGENEOUS
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_MAXFILESIZE
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|8
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE64
c_func
(paren
op_complement
(paren
id|u64
)paren
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_MAXLINK
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|255
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_MAXNAME
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
op_complement
(paren
id|u32
)paren
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_MAXREAD
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|8
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE64
c_func
(paren
(paren
id|u64
)paren
id|NFSSVC_MAXBLKSIZE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_MAXWRITE
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|8
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE64
c_func
(paren
(paren
id|u64
)paren
id|NFSSVC_MAXBLKSIZE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_MODE
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
id|stat.mode
op_amp
id|S_IALLUGO
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_NO_TRUNC
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_NUMLINKS
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|4
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
id|stat.nlink
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_OWNER
)paren
(brace
id|status
op_assign
id|nfsd4_encode_user
c_func
(paren
id|rqstp
comma
id|stat.uid
comma
op_amp
id|p
comma
op_amp
id|buflen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
id|nfserr_resource
)paren
r_goto
id|out_resource
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_OWNER_GROUP
)paren
(brace
id|status
op_assign
id|nfsd4_encode_group
c_func
(paren
id|rqstp
comma
id|stat.gid
comma
op_amp
id|p
comma
op_amp
id|buflen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
id|nfserr_resource
)paren
r_goto
id|out_resource
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_RAWDEV
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|8
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
(paren
id|u32
)paren
id|MAJOR
c_func
(paren
id|stat.rdev
)paren
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
(paren
id|u32
)paren
id|MINOR
c_func
(paren
id|stat.rdev
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_SPACE_AVAIL
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|8
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|dummy64
op_assign
(paren
id|u64
)paren
id|statfs.f_bavail
op_star
(paren
id|u64
)paren
id|statfs.f_bsize
suffix:semicolon
id|WRITE64
c_func
(paren
id|dummy64
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_SPACE_FREE
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|8
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|dummy64
op_assign
(paren
id|u64
)paren
id|statfs.f_bfree
op_star
(paren
id|u64
)paren
id|statfs.f_bsize
suffix:semicolon
id|WRITE64
c_func
(paren
id|dummy64
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_SPACE_TOTAL
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|8
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|dummy64
op_assign
(paren
id|u64
)paren
id|statfs.f_blocks
op_star
(paren
id|u64
)paren
id|statfs.f_bsize
suffix:semicolon
id|WRITE64
c_func
(paren
id|dummy64
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_SPACE_USED
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|8
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|dummy64
op_assign
(paren
id|u64
)paren
id|stat.blocks
op_lshift
l_int|9
suffix:semicolon
id|WRITE64
c_func
(paren
id|dummy64
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_TIME_ACCESS
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|12
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|stat.atime.tv_sec
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|stat.atime.tv_nsec
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_TIME_DELTA
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|12
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_TIME_METADATA
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|12
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|stat.ctime.tv_sec
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|stat.ctime.tv_nsec
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_TIME_MODIFY
)paren
(brace
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|12
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|stat.mtime.tv_sec
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|stat.mtime.tv_nsec
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_MOUNTED_ON_FILEID
)paren
(brace
r_struct
id|dentry
op_star
id|mnt_pnt
comma
op_star
id|mnt_root
suffix:semicolon
r_if
c_cond
(paren
(paren
id|buflen
op_sub_assign
l_int|8
)paren
OL
l_int|0
)paren
r_goto
id|out_resource
suffix:semicolon
id|mnt_root
op_assign
id|exp-&gt;ex_mnt-&gt;mnt_root
suffix:semicolon
r_if
c_cond
(paren
id|mnt_root-&gt;d_inode
op_eq
id|dentry-&gt;d_inode
)paren
(brace
id|mnt_pnt
op_assign
id|exp-&gt;ex_mnt-&gt;mnt_mountpoint
suffix:semicolon
id|WRITE64
c_func
(paren
(paren
id|u64
)paren
id|mnt_pnt-&gt;d_inode-&gt;i_ino
)paren
suffix:semicolon
)brace
r_else
id|WRITE64
c_func
(paren
(paren
id|u64
)paren
id|stat.ino
)paren
suffix:semicolon
)brace
op_star
id|attrlenp
op_assign
id|htonl
c_func
(paren
(paren
r_char
op_star
)paren
id|p
op_minus
(paren
r_char
op_star
)paren
id|attrlenp
op_minus
l_int|4
)paren
suffix:semicolon
op_star
id|countp
op_assign
id|p
op_minus
id|buffer
suffix:semicolon
id|status
op_assign
id|nfs_ok
suffix:semicolon
id|out
suffix:colon
id|nfs4_acl_free
c_func
(paren
id|acl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fhp
op_eq
op_amp
id|tempfh
)paren
id|fh_put
c_func
(paren
op_amp
id|tempfh
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
id|out_nfserr
suffix:colon
id|status
op_assign
id|nfserrno
c_func
(paren
id|status
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
id|out_resource
suffix:colon
op_star
id|countp
op_assign
l_int|0
suffix:semicolon
id|status
op_assign
id|nfserr_resource
suffix:semicolon
r_goto
id|out
suffix:semicolon
id|out_serverfault
suffix:colon
id|status
op_assign
id|nfserr_serverfault
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_encode_dirent_fattr
id|nfsd4_encode_dirent_fattr
c_func
(paren
r_struct
id|nfsd4_readdir
op_star
id|cd
comma
r_const
r_char
op_star
id|name
comma
r_int
id|namlen
comma
id|u32
op_star
id|p
comma
r_int
op_star
id|buflen
)paren
(brace
r_struct
id|svc_export
op_star
id|exp
op_assign
id|cd-&gt;rd_fhp-&gt;fh_export
suffix:semicolon
r_struct
id|dentry
op_star
id|dentry
suffix:semicolon
r_int
id|nfserr
suffix:semicolon
id|dentry
op_assign
id|lookup_one_len
c_func
(paren
id|name
comma
id|cd-&gt;rd_fhp-&gt;fh_dentry
comma
id|namlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|dentry
)paren
)paren
r_return
id|nfserrno
c_func
(paren
id|PTR_ERR
c_func
(paren
id|dentry
)paren
)paren
suffix:semicolon
id|exp_get
c_func
(paren
id|exp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d_mountpoint
c_func
(paren
id|dentry
)paren
)paren
(brace
r_if
c_cond
(paren
id|nfsd_cross_mnt
c_func
(paren
id|cd-&gt;rd_rqstp
comma
op_amp
id|dentry
comma
op_amp
id|exp
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * -EAGAIN is the only error returned from&n;&t;&t; * nfsd_cross_mnt() and it indicates that an&n;&t;&t; * up-call has  been initiated to fill in the export&n;&t;&t; * options on exp.  When the answer comes back,&n;&t;&t; * this call will be retried.&n;&t;&t; */
id|nfserr
op_assign
id|nfserr_dropit
suffix:semicolon
r_goto
id|out_put
suffix:semicolon
)brace
)brace
id|nfserr
op_assign
id|nfsd4_encode_fattr
c_func
(paren
l_int|NULL
comma
id|exp
comma
id|dentry
comma
id|p
comma
id|buflen
comma
id|cd-&gt;rd_bmval
comma
id|cd-&gt;rd_rqstp
)paren
suffix:semicolon
id|out_put
suffix:colon
id|dput
c_func
(paren
id|dentry
)paren
suffix:semicolon
id|exp_put
c_func
(paren
id|exp
)paren
suffix:semicolon
r_return
id|nfserr
suffix:semicolon
)brace
r_static
id|u32
op_star
DECL|function|nfsd4_encode_rdattr_error
id|nfsd4_encode_rdattr_error
c_func
(paren
id|u32
op_star
id|p
comma
r_int
id|buflen
comma
r_int
id|nfserr
)paren
(brace
id|u32
op_star
id|attrlenp
suffix:semicolon
r_if
c_cond
(paren
id|buflen
OL
l_int|6
)paren
r_return
l_int|NULL
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
l_int|2
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|FATTR4_WORD0_RDATTR_ERROR
)paren
suffix:semicolon
multiline_comment|/* bmval0 */
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* bmval1 */
id|attrlenp
op_assign
id|p
op_increment
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|nfserr
suffix:semicolon
multiline_comment|/* no htonl */
op_star
id|attrlenp
op_assign
id|htonl
c_func
(paren
(paren
r_char
op_star
)paren
id|p
op_minus
(paren
r_char
op_star
)paren
id|attrlenp
op_minus
l_int|4
)paren
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_encode_dirent
id|nfsd4_encode_dirent
c_func
(paren
r_struct
id|readdir_cd
op_star
id|ccd
comma
r_const
r_char
op_star
id|name
comma
r_int
id|namlen
comma
id|loff_t
id|offset
comma
id|ino_t
id|ino
comma
r_int
r_int
id|d_type
)paren
(brace
r_struct
id|nfsd4_readdir
op_star
id|cd
op_assign
id|container_of
c_func
(paren
id|ccd
comma
r_struct
id|nfsd4_readdir
comma
id|common
)paren
suffix:semicolon
r_int
id|buflen
suffix:semicolon
id|u32
op_star
id|p
op_assign
id|cd-&gt;buffer
suffix:semicolon
r_int
id|nfserr
op_assign
id|nfserr_toosmall
suffix:semicolon
multiline_comment|/* In nfsv4, &quot;.&quot; and &quot;..&quot; never make it onto the wire.. */
r_if
c_cond
(paren
id|name
op_logical_and
id|isdotent
c_func
(paren
id|name
comma
id|namlen
)paren
)paren
(brace
id|cd-&gt;common.err
op_assign
id|nfs_ok
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cd-&gt;offset
)paren
id|xdr_encode_hyper
c_func
(paren
id|cd-&gt;offset
comma
(paren
id|u64
)paren
id|offset
)paren
suffix:semicolon
id|buflen
op_assign
id|cd-&gt;buflen
op_minus
l_int|4
op_minus
id|XDR_QUADLEN
c_func
(paren
id|namlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buflen
OL
l_int|0
)paren
r_goto
id|fail
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* mark entry present */
id|cd-&gt;offset
op_assign
id|p
suffix:semicolon
multiline_comment|/* remember pointer */
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|NFS_OFFSET_MAX
)paren
suffix:semicolon
multiline_comment|/* offset of next entry */
id|p
op_assign
id|xdr_encode_array
c_func
(paren
id|p
comma
id|name
comma
id|namlen
)paren
suffix:semicolon
multiline_comment|/* name length &amp; name */
id|nfserr
op_assign
id|nfsd4_encode_dirent_fattr
c_func
(paren
id|cd
comma
id|name
comma
id|namlen
comma
id|p
comma
op_amp
id|buflen
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|nfserr
)paren
(brace
r_case
id|nfs_ok
suffix:colon
id|p
op_add_assign
id|buflen
suffix:semicolon
r_break
suffix:semicolon
r_case
id|nfserr_resource
suffix:colon
id|nfserr
op_assign
id|nfserr_toosmall
suffix:semicolon
r_goto
id|fail
suffix:semicolon
r_case
id|nfserr_dropit
suffix:colon
r_goto
id|fail
suffix:semicolon
r_default
suffix:colon
(brace
)brace
multiline_comment|/*&n;&t;&t; * If the client requested the RDATTR_ERROR attribute,&n;&t;&t; * we stuff the error code into this attribute&n;&t;&t; * and continue.  If this attribute was not requested,&n;&t;&t; * then in accordance with the spec, we fail the&n;&t;&t; * entire READDIR operation(!)&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|cd-&gt;rd_bmval
(braket
l_int|0
)braket
op_amp
id|FATTR4_WORD0_RDATTR_ERROR
)paren
)paren
r_goto
id|fail
suffix:semicolon
id|nfserr
op_assign
id|nfserr_toosmall
suffix:semicolon
id|p
op_assign
id|nfsd4_encode_rdattr_error
c_func
(paren
id|p
comma
id|buflen
comma
id|nfserr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
op_eq
l_int|NULL
)paren
r_goto
id|fail
suffix:semicolon
)brace
id|cd-&gt;buflen
op_sub_assign
(paren
id|p
op_minus
id|cd-&gt;buffer
)paren
suffix:semicolon
id|cd-&gt;buffer
op_assign
id|p
suffix:semicolon
id|cd-&gt;common.err
op_assign
id|nfs_ok
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|fail
suffix:colon
id|cd-&gt;common.err
op_assign
id|nfserr
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfsd4_encode_access
id|nfsd4_encode_access
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_int
id|nfserr
comma
r_struct
id|nfsd4_access
op_star
id|access
)paren
(brace
id|ENCODE_HEAD
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nfserr
)paren
(brace
id|RESERVE_SPACE
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|access-&gt;ac_supported
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|access-&gt;ac_resp_access
)paren
suffix:semicolon
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|nfsd4_encode_close
id|nfsd4_encode_close
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_int
id|nfserr
comma
r_struct
id|nfsd4_close
op_star
id|close
)paren
(brace
id|ENCODE_SEQID_OP_HEAD
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nfserr
)paren
(brace
id|RESERVE_SPACE
c_func
(paren
r_sizeof
(paren
id|stateid_t
)paren
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|close-&gt;cl_stateid.si_generation
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
op_amp
id|close-&gt;cl_stateid.si_opaque
comma
r_sizeof
(paren
id|stateid_opaque_t
)paren
)paren
suffix:semicolon
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
)brace
id|ENCODE_SEQID_OP_TAIL
c_func
(paren
id|close-&gt;cl_stateowner
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfsd4_encode_commit
id|nfsd4_encode_commit
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_int
id|nfserr
comma
r_struct
id|nfsd4_commit
op_star
id|commit
)paren
(brace
id|ENCODE_HEAD
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nfserr
)paren
(brace
id|RESERVE_SPACE
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|commit-&gt;co_verf.data
comma
l_int|8
)paren
suffix:semicolon
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|nfsd4_encode_create
id|nfsd4_encode_create
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_int
id|nfserr
comma
r_struct
id|nfsd4_create
op_star
id|create
)paren
(brace
id|ENCODE_HEAD
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nfserr
)paren
(brace
id|RESERVE_SPACE
c_func
(paren
l_int|32
)paren
suffix:semicolon
id|WRITECINFO
c_func
(paren
id|create-&gt;cr_cinfo
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|create-&gt;cr_bmval
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|create-&gt;cr_bmval
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|nfsd4_encode_getattr
id|nfsd4_encode_getattr
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_int
id|nfserr
comma
r_struct
id|nfsd4_getattr
op_star
id|getattr
)paren
(brace
r_struct
id|svc_fh
op_star
id|fhp
op_assign
id|getattr-&gt;ga_fhp
suffix:semicolon
r_int
id|buflen
suffix:semicolon
r_if
c_cond
(paren
id|nfserr
)paren
r_return
id|nfserr
suffix:semicolon
id|buflen
op_assign
id|resp-&gt;end
op_minus
id|resp-&gt;p
op_minus
(paren
id|COMPOUND_ERR_SLACK_SPACE
op_rshift
l_int|2
)paren
suffix:semicolon
id|nfserr
op_assign
id|nfsd4_encode_fattr
c_func
(paren
id|fhp
comma
id|fhp-&gt;fh_export
comma
id|fhp-&gt;fh_dentry
comma
id|resp-&gt;p
comma
op_amp
id|buflen
comma
id|getattr-&gt;ga_bmval
comma
id|resp-&gt;rqstp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nfserr
)paren
id|resp-&gt;p
op_add_assign
id|buflen
suffix:semicolon
r_return
id|nfserr
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfsd4_encode_getfh
id|nfsd4_encode_getfh
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_int
id|nfserr
comma
r_struct
id|svc_fh
op_star
id|fhp
)paren
(brace
r_int
r_int
id|len
suffix:semicolon
id|ENCODE_HEAD
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nfserr
)paren
(brace
id|len
op_assign
id|fhp-&gt;fh_handle.fh_size
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
id|len
op_plus
l_int|4
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|len
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
op_amp
id|fhp-&gt;fh_handle.fh_base
comma
id|len
)paren
suffix:semicolon
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;* Including all fields other than the name, a LOCK4denied structure requires&n;*   8(clientid) + 4(namelen) + 8(offset) + 8(length) + 4(type) = 32 bytes.&n;*/
r_static
r_void
DECL|function|nfsd4_encode_lock_denied
id|nfsd4_encode_lock_denied
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_struct
id|nfsd4_lock_denied
op_star
id|ld
)paren
(brace
id|ENCODE_HEAD
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|32
op_plus
id|XDR_LEN
c_func
(paren
id|ld-&gt;ld_sop
ques
c_cond
id|ld-&gt;ld_sop-&gt;so_owner.len
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
id|WRITE64
c_func
(paren
id|ld-&gt;ld_start
)paren
suffix:semicolon
id|WRITE64
c_func
(paren
id|ld-&gt;ld_length
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|ld-&gt;ld_type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ld-&gt;ld_sop
)paren
(brace
id|WRITEMEM
c_func
(paren
op_amp
id|ld-&gt;ld_clientid
comma
l_int|8
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|ld-&gt;ld_sop-&gt;so_owner.len
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|ld-&gt;ld_sop-&gt;so_owner.data
comma
id|ld-&gt;ld_sop-&gt;so_owner.len
)paren
suffix:semicolon
id|kref_put
c_func
(paren
op_amp
id|ld-&gt;ld_sop-&gt;so_ref
comma
id|nfs4_free_stateowner
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* non - nfsv4 lock in conflict, no clientid nor owner */
id|WRITE64
c_func
(paren
(paren
id|u64
)paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* clientid */
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* length of owner name */
)brace
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfsd4_encode_lock
id|nfsd4_encode_lock
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_int
id|nfserr
comma
r_struct
id|nfsd4_lock
op_star
id|lock
)paren
(brace
id|ENCODE_SEQID_OP_HEAD
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nfserr
)paren
(brace
id|RESERVE_SPACE
c_func
(paren
l_int|4
op_plus
r_sizeof
(paren
id|stateid_t
)paren
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|lock-&gt;lk_resp_stateid.si_generation
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
op_amp
id|lock-&gt;lk_resp_stateid.si_opaque
comma
r_sizeof
(paren
id|stateid_opaque_t
)paren
)paren
suffix:semicolon
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|nfserr
op_eq
id|nfserr_denied
)paren
id|nfsd4_encode_lock_denied
c_func
(paren
id|resp
comma
op_amp
id|lock-&gt;lk_denied
)paren
suffix:semicolon
id|ENCODE_SEQID_OP_TAIL
c_func
(paren
id|lock-&gt;lk_stateowner
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfsd4_encode_lockt
id|nfsd4_encode_lockt
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_int
id|nfserr
comma
r_struct
id|nfsd4_lockt
op_star
id|lockt
)paren
(brace
r_if
c_cond
(paren
id|nfserr
op_eq
id|nfserr_denied
)paren
id|nfsd4_encode_lock_denied
c_func
(paren
id|resp
comma
op_amp
id|lockt-&gt;lt_denied
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfsd4_encode_locku
id|nfsd4_encode_locku
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_int
id|nfserr
comma
r_struct
id|nfsd4_locku
op_star
id|locku
)paren
(brace
id|ENCODE_SEQID_OP_HEAD
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nfserr
)paren
(brace
id|RESERVE_SPACE
c_func
(paren
r_sizeof
(paren
id|stateid_t
)paren
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|locku-&gt;lu_stateid.si_generation
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
op_amp
id|locku-&gt;lu_stateid.si_opaque
comma
r_sizeof
(paren
id|stateid_opaque_t
)paren
)paren
suffix:semicolon
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
)brace
id|ENCODE_SEQID_OP_TAIL
c_func
(paren
id|locku-&gt;lu_stateowner
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfsd4_encode_link
id|nfsd4_encode_link
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_int
id|nfserr
comma
r_struct
id|nfsd4_link
op_star
id|link
)paren
(brace
id|ENCODE_HEAD
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nfserr
)paren
(brace
id|RESERVE_SPACE
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|WRITECINFO
c_func
(paren
id|link-&gt;li_cinfo
)paren
suffix:semicolon
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|nfsd4_encode_open
id|nfsd4_encode_open
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_int
id|nfserr
comma
r_struct
id|nfsd4_open
op_star
id|open
)paren
(brace
id|ENCODE_SEQID_OP_HEAD
suffix:semicolon
r_if
c_cond
(paren
id|nfserr
)paren
r_goto
id|out
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|36
op_plus
r_sizeof
(paren
id|stateid_t
)paren
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|open-&gt;op_stateid.si_generation
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
op_amp
id|open-&gt;op_stateid.si_opaque
comma
r_sizeof
(paren
id|stateid_opaque_t
)paren
)paren
suffix:semicolon
id|WRITECINFO
c_func
(paren
id|open-&gt;op_cinfo
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|open-&gt;op_rflags
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|open-&gt;op_bmval
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|open-&gt;op_bmval
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|open-&gt;op_delegate_type
)paren
suffix:semicolon
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|open-&gt;op_delegate_type
)paren
(brace
r_case
id|NFS4_OPEN_DELEGATE_NONE
suffix:colon
r_break
suffix:semicolon
r_case
id|NFS4_OPEN_DELEGATE_READ
suffix:colon
id|RESERVE_SPACE
c_func
(paren
l_int|20
op_plus
r_sizeof
(paren
id|stateid_t
)paren
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
op_amp
id|open-&gt;op_delegate_stateid
comma
r_sizeof
(paren
id|stateid_t
)paren
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * TODO: ACE&squot;s in delegations&n;&t;&t; */
id|WRITE32
c_func
(paren
id|NFS4_ACE_ACCESS_ALLOWED_ACE_TYPE
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* XXX: is NULL principal ok? */
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NFS4_OPEN_DELEGATE_WRITE
suffix:colon
id|RESERVE_SPACE
c_func
(paren
l_int|32
op_plus
r_sizeof
(paren
id|stateid_t
)paren
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
op_amp
id|open-&gt;op_delegate_stateid
comma
r_sizeof
(paren
id|stateid_t
)paren
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * TODO: space_limit&squot;s in delegations&n;&t;&t; */
id|WRITE32
c_func
(paren
id|NFS4_LIMIT_SIZE
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
op_complement
(paren
id|u32
)paren
l_int|0
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
op_complement
(paren
id|u32
)paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * TODO: ACE&squot;s in delegations&n;&t;&t; */
id|WRITE32
c_func
(paren
id|NFS4_ACE_ACCESS_ALLOWED_ACE_TYPE
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* XXX: is NULL principal ok? */
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* XXX save filehandle here */
id|out
suffix:colon
id|ENCODE_SEQID_OP_TAIL
c_func
(paren
id|open-&gt;op_stateowner
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfsd4_encode_open_confirm
id|nfsd4_encode_open_confirm
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_int
id|nfserr
comma
r_struct
id|nfsd4_open_confirm
op_star
id|oc
)paren
(brace
id|ENCODE_SEQID_OP_HEAD
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nfserr
)paren
(brace
id|RESERVE_SPACE
c_func
(paren
r_sizeof
(paren
id|stateid_t
)paren
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|oc-&gt;oc_resp_stateid.si_generation
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
op_amp
id|oc-&gt;oc_resp_stateid.si_opaque
comma
r_sizeof
(paren
id|stateid_opaque_t
)paren
)paren
suffix:semicolon
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
)brace
id|ENCODE_SEQID_OP_TAIL
c_func
(paren
id|oc-&gt;oc_stateowner
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfsd4_encode_open_downgrade
id|nfsd4_encode_open_downgrade
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_int
id|nfserr
comma
r_struct
id|nfsd4_open_downgrade
op_star
id|od
)paren
(brace
id|ENCODE_SEQID_OP_HEAD
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nfserr
)paren
(brace
id|RESERVE_SPACE
c_func
(paren
r_sizeof
(paren
id|stateid_t
)paren
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|od-&gt;od_stateid.si_generation
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
op_amp
id|od-&gt;od_stateid.si_opaque
comma
r_sizeof
(paren
id|stateid_opaque_t
)paren
)paren
suffix:semicolon
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
)brace
id|ENCODE_SEQID_OP_TAIL
c_func
(paren
id|od-&gt;od_stateowner
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_encode_read
id|nfsd4_encode_read
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_int
id|nfserr
comma
r_struct
id|nfsd4_read
op_star
id|read
)paren
(brace
id|u32
id|eof
suffix:semicolon
r_int
id|v
comma
id|pn
suffix:semicolon
r_int
r_int
id|maxcount
suffix:semicolon
r_int
id|len
suffix:semicolon
id|ENCODE_HEAD
suffix:semicolon
r_if
c_cond
(paren
id|nfserr
)paren
r_return
id|nfserr
suffix:semicolon
r_if
c_cond
(paren
id|resp-&gt;xbuf-&gt;page_len
)paren
r_return
id|nfserr_resource
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|8
)paren
suffix:semicolon
multiline_comment|/* eof flag and byte count */
id|maxcount
op_assign
id|NFSSVC_MAXBLKSIZE
suffix:semicolon
r_if
c_cond
(paren
id|maxcount
OG
id|read-&gt;rd_length
)paren
id|maxcount
op_assign
id|read-&gt;rd_length
suffix:semicolon
id|len
op_assign
id|maxcount
suffix:semicolon
id|v
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|len
OG
l_int|0
)paren
(brace
id|pn
op_assign
id|resp-&gt;rqstp-&gt;rq_resused
suffix:semicolon
id|svc_take_page
c_func
(paren
id|resp-&gt;rqstp
)paren
suffix:semicolon
id|read-&gt;rd_iov
(braket
id|v
)braket
dot
id|iov_base
op_assign
id|page_address
c_func
(paren
id|resp-&gt;rqstp-&gt;rq_respages
(braket
id|pn
)braket
)paren
suffix:semicolon
id|read-&gt;rd_iov
(braket
id|v
)braket
dot
id|iov_len
op_assign
id|len
OL
id|PAGE_SIZE
ques
c_cond
id|len
suffix:colon
id|PAGE_SIZE
suffix:semicolon
id|v
op_increment
suffix:semicolon
id|len
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
id|read-&gt;rd_vlen
op_assign
id|v
suffix:semicolon
id|nfserr
op_assign
id|nfsd_read
c_func
(paren
id|read-&gt;rd_rqstp
comma
id|read-&gt;rd_fhp
comma
id|read-&gt;rd_offset
comma
id|read-&gt;rd_iov
comma
id|read-&gt;rd_vlen
comma
op_amp
id|maxcount
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nfserr
op_eq
id|nfserr_symlink
)paren
id|nfserr
op_assign
id|nfserr_inval
suffix:semicolon
r_if
c_cond
(paren
id|nfserr
)paren
r_return
id|nfserr
suffix:semicolon
id|eof
op_assign
(paren
id|read-&gt;rd_offset
op_plus
id|maxcount
op_ge
id|read-&gt;rd_fhp-&gt;fh_dentry-&gt;d_inode-&gt;i_size
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|eof
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|maxcount
)paren
suffix:semicolon
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
id|resp-&gt;xbuf-&gt;head
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
(paren
(paren
r_char
op_star
)paren
id|resp-&gt;p
)paren
op_minus
(paren
r_char
op_star
)paren
id|resp-&gt;xbuf-&gt;head
(braket
l_int|0
)braket
dot
id|iov_base
suffix:semicolon
id|resp-&gt;xbuf-&gt;page_len
op_assign
id|maxcount
suffix:semicolon
multiline_comment|/* read zero bytes -&gt; don&squot;t set up tail */
r_if
c_cond
(paren
op_logical_neg
id|maxcount
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* set up page for remaining responses */
id|svc_take_page
c_func
(paren
id|resp-&gt;rqstp
)paren
suffix:semicolon
id|resp-&gt;xbuf-&gt;tail
(braket
l_int|0
)braket
dot
id|iov_base
op_assign
id|page_address
c_func
(paren
id|resp-&gt;rqstp-&gt;rq_respages
(braket
id|resp-&gt;rqstp-&gt;rq_resused
op_minus
l_int|1
)braket
)paren
suffix:semicolon
id|resp-&gt;rqstp-&gt;rq_restailpage
op_assign
id|resp-&gt;rqstp-&gt;rq_resused
op_minus
l_int|1
suffix:semicolon
id|resp-&gt;xbuf-&gt;tail
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
l_int|0
suffix:semicolon
id|resp-&gt;p
op_assign
id|resp-&gt;xbuf-&gt;tail
(braket
l_int|0
)braket
dot
id|iov_base
suffix:semicolon
id|resp-&gt;end
op_assign
id|resp-&gt;p
op_plus
id|PAGE_SIZE
op_div
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|maxcount
op_amp
l_int|3
)paren
(brace
op_star
(paren
id|resp-&gt;p
)paren
op_increment
op_assign
l_int|0
suffix:semicolon
id|resp-&gt;xbuf-&gt;tail
(braket
l_int|0
)braket
dot
id|iov_base
op_add_assign
id|maxcount
op_amp
l_int|3
suffix:semicolon
id|resp-&gt;xbuf-&gt;tail
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
l_int|4
op_minus
(paren
id|maxcount
op_amp
l_int|3
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_encode_readlink
id|nfsd4_encode_readlink
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_int
id|nfserr
comma
r_struct
id|nfsd4_readlink
op_star
id|readlink
)paren
(brace
r_int
id|maxcount
suffix:semicolon
r_char
op_star
id|page
suffix:semicolon
id|ENCODE_HEAD
suffix:semicolon
r_if
c_cond
(paren
id|nfserr
)paren
r_return
id|nfserr
suffix:semicolon
r_if
c_cond
(paren
id|resp-&gt;xbuf-&gt;page_len
)paren
r_return
id|nfserr_resource
suffix:semicolon
id|svc_take_page
c_func
(paren
id|resp-&gt;rqstp
)paren
suffix:semicolon
id|page
op_assign
id|page_address
c_func
(paren
id|resp-&gt;rqstp-&gt;rq_respages
(braket
id|resp-&gt;rqstp-&gt;rq_resused
op_minus
l_int|1
)braket
)paren
suffix:semicolon
id|maxcount
op_assign
id|PAGE_SIZE
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|4
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * XXX: By default, the -&gt;readlink() VFS op will truncate symlinks&n;&t; * if they would overflow the buffer.  Is this kosher in NFSv4?  If&n;&t; * not, one easy fix is: if -&gt;readlink() precisely fills the buffer,&n;&t; * assume that truncation occurred, and return NFS4ERR_RESOURCE.&n;&t; */
id|nfserr
op_assign
id|nfsd_readlink
c_func
(paren
id|readlink-&gt;rl_rqstp
comma
id|readlink-&gt;rl_fhp
comma
id|page
comma
op_amp
id|maxcount
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nfserr
op_eq
id|nfserr_isdir
)paren
r_return
id|nfserr_inval
suffix:semicolon
r_if
c_cond
(paren
id|nfserr
)paren
r_return
id|nfserr
suffix:semicolon
id|WRITE32
c_func
(paren
id|maxcount
)paren
suffix:semicolon
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
id|resp-&gt;xbuf-&gt;head
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
(paren
(paren
r_char
op_star
)paren
id|resp-&gt;p
)paren
op_minus
(paren
r_char
op_star
)paren
id|resp-&gt;xbuf-&gt;head
(braket
l_int|0
)braket
dot
id|iov_base
suffix:semicolon
id|svc_take_page
c_func
(paren
id|resp-&gt;rqstp
)paren
suffix:semicolon
id|resp-&gt;xbuf-&gt;tail
(braket
l_int|0
)braket
dot
id|iov_base
op_assign
id|page_address
c_func
(paren
id|resp-&gt;rqstp-&gt;rq_respages
(braket
id|resp-&gt;rqstp-&gt;rq_resused
op_minus
l_int|1
)braket
)paren
suffix:semicolon
id|resp-&gt;rqstp-&gt;rq_restailpage
op_assign
id|resp-&gt;rqstp-&gt;rq_resused
op_minus
l_int|1
suffix:semicolon
id|resp-&gt;xbuf-&gt;tail
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
l_int|0
suffix:semicolon
id|resp-&gt;p
op_assign
id|resp-&gt;xbuf-&gt;tail
(braket
l_int|0
)braket
dot
id|iov_base
suffix:semicolon
id|resp-&gt;end
op_assign
id|resp-&gt;p
op_plus
id|PAGE_SIZE
op_div
l_int|4
suffix:semicolon
id|resp-&gt;xbuf-&gt;page_len
op_assign
id|maxcount
suffix:semicolon
r_if
c_cond
(paren
id|maxcount
op_amp
l_int|3
)paren
(brace
op_star
(paren
id|resp-&gt;p
)paren
op_increment
op_assign
l_int|0
suffix:semicolon
id|resp-&gt;xbuf-&gt;tail
(braket
l_int|0
)braket
dot
id|iov_base
op_add_assign
id|maxcount
op_amp
l_int|3
suffix:semicolon
id|resp-&gt;xbuf-&gt;tail
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
l_int|4
op_minus
(paren
id|maxcount
op_amp
l_int|3
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfsd4_encode_readdir
id|nfsd4_encode_readdir
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_int
id|nfserr
comma
r_struct
id|nfsd4_readdir
op_star
id|readdir
)paren
(brace
r_int
id|maxcount
suffix:semicolon
id|loff_t
id|offset
suffix:semicolon
id|u32
op_star
id|page
comma
op_star
id|savep
suffix:semicolon
id|ENCODE_HEAD
suffix:semicolon
r_if
c_cond
(paren
id|nfserr
)paren
r_return
id|nfserr
suffix:semicolon
r_if
c_cond
(paren
id|resp-&gt;xbuf-&gt;page_len
)paren
r_return
id|nfserr_resource
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|8
)paren
suffix:semicolon
multiline_comment|/* verifier */
id|savep
op_assign
id|p
suffix:semicolon
multiline_comment|/* XXX: Following NFSv3, we ignore the READDIR verifier for now. */
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
id|resp-&gt;xbuf-&gt;head
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
(paren
(paren
r_char
op_star
)paren
id|resp-&gt;p
)paren
op_minus
(paren
r_char
op_star
)paren
id|resp-&gt;xbuf-&gt;head
(braket
l_int|0
)braket
dot
id|iov_base
suffix:semicolon
id|maxcount
op_assign
id|PAGE_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|maxcount
OG
id|readdir-&gt;rd_maxcount
)paren
id|maxcount
op_assign
id|readdir-&gt;rd_maxcount
suffix:semicolon
multiline_comment|/*&n;&t; * Convert from bytes to words, account for the two words already&n;&t; * written, make sure to leave two words at the end for the next&n;&t; * pointer and eof field.&n;&t; */
id|maxcount
op_assign
(paren
id|maxcount
op_rshift
l_int|2
)paren
op_minus
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|maxcount
OL
l_int|0
)paren
(brace
id|nfserr
op_assign
id|nfserr_toosmall
suffix:semicolon
r_goto
id|err_no_verf
suffix:semicolon
)brace
id|svc_take_page
c_func
(paren
id|resp-&gt;rqstp
)paren
suffix:semicolon
id|page
op_assign
id|page_address
c_func
(paren
id|resp-&gt;rqstp-&gt;rq_respages
(braket
id|resp-&gt;rqstp-&gt;rq_resused
op_minus
l_int|1
)braket
)paren
suffix:semicolon
id|readdir-&gt;common.err
op_assign
l_int|0
suffix:semicolon
id|readdir-&gt;buflen
op_assign
id|maxcount
suffix:semicolon
id|readdir-&gt;buffer
op_assign
id|page
suffix:semicolon
id|readdir-&gt;offset
op_assign
l_int|NULL
suffix:semicolon
id|offset
op_assign
id|readdir-&gt;rd_cookie
suffix:semicolon
id|nfserr
op_assign
id|nfsd_readdir
c_func
(paren
id|readdir-&gt;rd_rqstp
comma
id|readdir-&gt;rd_fhp
comma
op_amp
id|offset
comma
op_amp
id|readdir-&gt;common
comma
id|nfsd4_encode_dirent
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nfserr
op_eq
id|nfs_ok
op_logical_and
id|readdir-&gt;common.err
op_eq
id|nfserr_toosmall
op_logical_and
id|readdir-&gt;buffer
op_eq
id|page
)paren
id|nfserr
op_assign
id|nfserr_toosmall
suffix:semicolon
r_if
c_cond
(paren
id|nfserr
op_eq
id|nfserr_symlink
)paren
id|nfserr
op_assign
id|nfserr_notdir
suffix:semicolon
r_if
c_cond
(paren
id|nfserr
)paren
r_goto
id|err_no_verf
suffix:semicolon
r_if
c_cond
(paren
id|readdir-&gt;offset
)paren
id|xdr_encode_hyper
c_func
(paren
id|readdir-&gt;offset
comma
id|offset
)paren
suffix:semicolon
id|p
op_assign
id|readdir-&gt;buffer
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* no more entries */
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|readdir-&gt;common.err
op_eq
id|nfserr_eof
)paren
suffix:semicolon
id|resp-&gt;xbuf-&gt;page_len
op_assign
(paren
(paren
r_char
op_star
)paren
id|p
)paren
op_minus
(paren
r_char
op_star
)paren
id|page_address
c_func
(paren
id|resp-&gt;rqstp-&gt;rq_respages
(braket
id|resp-&gt;rqstp-&gt;rq_resused
op_minus
l_int|1
)braket
)paren
suffix:semicolon
multiline_comment|/* allocate a page for the tail */
id|svc_take_page
c_func
(paren
id|resp-&gt;rqstp
)paren
suffix:semicolon
id|resp-&gt;xbuf-&gt;tail
(braket
l_int|0
)braket
dot
id|iov_base
op_assign
id|page_address
c_func
(paren
id|resp-&gt;rqstp-&gt;rq_respages
(braket
id|resp-&gt;rqstp-&gt;rq_resused
op_minus
l_int|1
)braket
)paren
suffix:semicolon
id|resp-&gt;rqstp-&gt;rq_restailpage
op_assign
id|resp-&gt;rqstp-&gt;rq_resused
op_minus
l_int|1
suffix:semicolon
id|resp-&gt;xbuf-&gt;tail
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
l_int|0
suffix:semicolon
id|resp-&gt;p
op_assign
id|resp-&gt;xbuf-&gt;tail
(braket
l_int|0
)braket
dot
id|iov_base
suffix:semicolon
id|resp-&gt;end
op_assign
id|resp-&gt;p
op_plus
id|PAGE_SIZE
op_div
l_int|4
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_no_verf
suffix:colon
id|p
op_assign
id|savep
suffix:semicolon
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
r_return
id|nfserr
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfsd4_encode_remove
id|nfsd4_encode_remove
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_int
id|nfserr
comma
r_struct
id|nfsd4_remove
op_star
id|remove
)paren
(brace
id|ENCODE_HEAD
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nfserr
)paren
(brace
id|RESERVE_SPACE
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|WRITECINFO
c_func
(paren
id|remove-&gt;rm_cinfo
)paren
suffix:semicolon
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|nfsd4_encode_rename
id|nfsd4_encode_rename
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_int
id|nfserr
comma
r_struct
id|nfsd4_rename
op_star
id|rename
)paren
(brace
id|ENCODE_HEAD
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nfserr
)paren
(brace
id|RESERVE_SPACE
c_func
(paren
l_int|40
)paren
suffix:semicolon
id|WRITECINFO
c_func
(paren
id|rename-&gt;rn_sinfo
)paren
suffix:semicolon
id|WRITECINFO
c_func
(paren
id|rename-&gt;rn_tinfo
)paren
suffix:semicolon
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * The SETATTR encode routine is special -- it always encodes a bitmap,&n; * regardless of the error status.&n; */
r_static
r_void
DECL|function|nfsd4_encode_setattr
id|nfsd4_encode_setattr
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_int
id|nfserr
comma
r_struct
id|nfsd4_setattr
op_star
id|setattr
)paren
(brace
id|ENCODE_HEAD
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|12
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nfserr
)paren
(brace
id|WRITE32
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|WRITE32
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|setattr-&gt;sa_bmval
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|setattr-&gt;sa_bmval
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfsd4_encode_setclientid
id|nfsd4_encode_setclientid
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_int
id|nfserr
comma
r_struct
id|nfsd4_setclientid
op_star
id|scd
)paren
(brace
id|ENCODE_HEAD
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nfserr
)paren
(brace
id|RESERVE_SPACE
c_func
(paren
l_int|8
op_plus
r_sizeof
(paren
id|nfs4_verifier
)paren
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
op_amp
id|scd-&gt;se_clientid
comma
l_int|8
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
op_amp
id|scd-&gt;se_confirm
comma
r_sizeof
(paren
id|nfs4_verifier
)paren
)paren
suffix:semicolon
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|nfserr
op_eq
id|nfserr_clid_inuse
)paren
(brace
id|RESERVE_SPACE
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|nfsd4_encode_write
id|nfsd4_encode_write
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_int
id|nfserr
comma
r_struct
id|nfsd4_write
op_star
id|write
)paren
(brace
id|ENCODE_HEAD
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nfserr
)paren
(brace
id|RESERVE_SPACE
c_func
(paren
l_int|16
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|write-&gt;wr_bytes_written
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|write-&gt;wr_how_written
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|write-&gt;wr_verifier.data
comma
l_int|8
)paren
suffix:semicolon
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|nfsd4_encode_operation
id|nfsd4_encode_operation
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_struct
id|nfsd4_op
op_star
id|op
)paren
(brace
id|u32
op_star
id|statp
suffix:semicolon
id|ENCODE_HEAD
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|op-&gt;opnum
)paren
suffix:semicolon
id|statp
op_assign
id|p
op_increment
suffix:semicolon
multiline_comment|/* to be backfilled at the end */
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|op-&gt;opnum
)paren
(brace
r_case
id|OP_ACCESS
suffix:colon
id|nfsd4_encode_access
c_func
(paren
id|resp
comma
id|op-&gt;status
comma
op_amp
id|op-&gt;u.access
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_CLOSE
suffix:colon
id|nfsd4_encode_close
c_func
(paren
id|resp
comma
id|op-&gt;status
comma
op_amp
id|op-&gt;u.close
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_COMMIT
suffix:colon
id|nfsd4_encode_commit
c_func
(paren
id|resp
comma
id|op-&gt;status
comma
op_amp
id|op-&gt;u.commit
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_CREATE
suffix:colon
id|nfsd4_encode_create
c_func
(paren
id|resp
comma
id|op-&gt;status
comma
op_amp
id|op-&gt;u.create
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_DELEGRETURN
suffix:colon
r_break
suffix:semicolon
r_case
id|OP_GETATTR
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_encode_getattr
c_func
(paren
id|resp
comma
id|op-&gt;status
comma
op_amp
id|op-&gt;u.getattr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_GETFH
suffix:colon
id|nfsd4_encode_getfh
c_func
(paren
id|resp
comma
id|op-&gt;status
comma
id|op-&gt;u.getfh
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_LINK
suffix:colon
id|nfsd4_encode_link
c_func
(paren
id|resp
comma
id|op-&gt;status
comma
op_amp
id|op-&gt;u.link
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_LOCK
suffix:colon
id|nfsd4_encode_lock
c_func
(paren
id|resp
comma
id|op-&gt;status
comma
op_amp
id|op-&gt;u.lock
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_LOCKT
suffix:colon
id|nfsd4_encode_lockt
c_func
(paren
id|resp
comma
id|op-&gt;status
comma
op_amp
id|op-&gt;u.lockt
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_LOCKU
suffix:colon
id|nfsd4_encode_locku
c_func
(paren
id|resp
comma
id|op-&gt;status
comma
op_amp
id|op-&gt;u.locku
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_LOOKUP
suffix:colon
r_break
suffix:semicolon
r_case
id|OP_LOOKUPP
suffix:colon
r_break
suffix:semicolon
r_case
id|OP_NVERIFY
suffix:colon
r_break
suffix:semicolon
r_case
id|OP_OPEN
suffix:colon
id|nfsd4_encode_open
c_func
(paren
id|resp
comma
id|op-&gt;status
comma
op_amp
id|op-&gt;u.open
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_OPEN_CONFIRM
suffix:colon
id|nfsd4_encode_open_confirm
c_func
(paren
id|resp
comma
id|op-&gt;status
comma
op_amp
id|op-&gt;u.open_confirm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_OPEN_DOWNGRADE
suffix:colon
id|nfsd4_encode_open_downgrade
c_func
(paren
id|resp
comma
id|op-&gt;status
comma
op_amp
id|op-&gt;u.open_downgrade
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_PUTFH
suffix:colon
r_break
suffix:semicolon
r_case
id|OP_PUTROOTFH
suffix:colon
r_break
suffix:semicolon
r_case
id|OP_READ
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_encode_read
c_func
(paren
id|resp
comma
id|op-&gt;status
comma
op_amp
id|op-&gt;u.read
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_READDIR
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_encode_readdir
c_func
(paren
id|resp
comma
id|op-&gt;status
comma
op_amp
id|op-&gt;u.readdir
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_READLINK
suffix:colon
id|op-&gt;status
op_assign
id|nfsd4_encode_readlink
c_func
(paren
id|resp
comma
id|op-&gt;status
comma
op_amp
id|op-&gt;u.readlink
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_REMOVE
suffix:colon
id|nfsd4_encode_remove
c_func
(paren
id|resp
comma
id|op-&gt;status
comma
op_amp
id|op-&gt;u.remove
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_RENAME
suffix:colon
id|nfsd4_encode_rename
c_func
(paren
id|resp
comma
id|op-&gt;status
comma
op_amp
id|op-&gt;u.rename
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_RENEW
suffix:colon
r_break
suffix:semicolon
r_case
id|OP_RESTOREFH
suffix:colon
r_break
suffix:semicolon
r_case
id|OP_SAVEFH
suffix:colon
r_break
suffix:semicolon
r_case
id|OP_SETATTR
suffix:colon
id|nfsd4_encode_setattr
c_func
(paren
id|resp
comma
id|op-&gt;status
comma
op_amp
id|op-&gt;u.setattr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_SETCLIENTID
suffix:colon
id|nfsd4_encode_setclientid
c_func
(paren
id|resp
comma
id|op-&gt;status
comma
op_amp
id|op-&gt;u.setclientid
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_SETCLIENTID_CONFIRM
suffix:colon
r_break
suffix:semicolon
r_case
id|OP_VERIFY
suffix:colon
r_break
suffix:semicolon
r_case
id|OP_WRITE
suffix:colon
id|nfsd4_encode_write
c_func
(paren
id|resp
comma
id|op-&gt;status
comma
op_amp
id|op-&gt;u.write
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_RELEASE_LOCKOWNER
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Note: We write the status directly, instead of using WRITE32(),&n;&t; * since it is already in network byte order.&n;&t; */
op_star
id|statp
op_assign
id|op-&gt;status
suffix:semicolon
)brace
multiline_comment|/* &n; * Encode the reply stored in the stateowner reply cache &n; * &n; * XDR note: do not encode rp-&gt;rp_buflen: the buffer contains the&n; * previously sent already encoded operation.&n; *&n; * called with nfs4_lock_state() held&n; */
r_void
DECL|function|nfsd4_encode_replay
id|nfsd4_encode_replay
c_func
(paren
r_struct
id|nfsd4_compoundres
op_star
id|resp
comma
r_struct
id|nfsd4_op
op_star
id|op
)paren
(brace
id|ENCODE_HEAD
suffix:semicolon
r_struct
id|nfs4_replay
op_star
id|rp
op_assign
id|op-&gt;replay
suffix:semicolon
id|BUG_ON
c_func
(paren
op_logical_neg
id|rp
)paren
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|op-&gt;opnum
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|rp-&gt;rp_status
suffix:semicolon
multiline_comment|/* already xdr&squot;ed */
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
id|rp-&gt;rp_buflen
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|rp-&gt;rp_buf
comma
id|rp-&gt;rp_buflen
)paren
suffix:semicolon
id|ADJUST_ARGS
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * END OF &quot;GENERIC&quot; ENCODE ROUTINES.&n; */
r_int
DECL|function|nfs4svc_encode_voidres
id|nfs4svc_encode_voidres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_void
op_star
id|dummy
)paren
(brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
DECL|function|nfsd4_release_compoundargs
r_void
id|nfsd4_release_compoundargs
c_func
(paren
r_struct
id|nfsd4_compoundargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
id|args-&gt;ops
op_ne
id|args-&gt;iops
)paren
(brace
id|kfree
c_func
(paren
id|args-&gt;ops
)paren
suffix:semicolon
id|args-&gt;ops
op_assign
id|args-&gt;iops
suffix:semicolon
)brace
r_if
c_cond
(paren
id|args-&gt;tmpp
)paren
(brace
id|kfree
c_func
(paren
id|args-&gt;tmpp
)paren
suffix:semicolon
id|args-&gt;tmpp
op_assign
l_int|NULL
suffix:semicolon
)brace
r_while
c_loop
(paren
id|args-&gt;to_free
)paren
(brace
r_struct
id|tmpbuf
op_star
id|tb
op_assign
id|args-&gt;to_free
suffix:semicolon
id|args-&gt;to_free
op_assign
id|tb-&gt;next
suffix:semicolon
id|tb
op_member_access_from_pointer
id|release
c_func
(paren
id|tb-&gt;buf
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|tb
)paren
suffix:semicolon
)brace
)brace
r_int
DECL|function|nfs4svc_decode_compoundargs
id|nfs4svc_decode_compoundargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd4_compoundargs
op_star
id|args
)paren
(brace
r_int
id|status
suffix:semicolon
id|args-&gt;p
op_assign
id|p
suffix:semicolon
id|args-&gt;end
op_assign
id|rqstp-&gt;rq_arg.head
(braket
l_int|0
)braket
dot
id|iov_base
op_plus
id|rqstp-&gt;rq_arg.head
(braket
l_int|0
)braket
dot
id|iov_len
suffix:semicolon
id|args-&gt;pagelist
op_assign
id|rqstp-&gt;rq_arg.pages
suffix:semicolon
id|args-&gt;pagelen
op_assign
id|rqstp-&gt;rq_arg.page_len
suffix:semicolon
id|args-&gt;tmpp
op_assign
l_int|NULL
suffix:semicolon
id|args-&gt;to_free
op_assign
l_int|NULL
suffix:semicolon
id|args-&gt;ops
op_assign
id|args-&gt;iops
suffix:semicolon
id|args-&gt;rqstp
op_assign
id|rqstp
suffix:semicolon
id|status
op_assign
id|nfsd4_decode_compound
c_func
(paren
id|args
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
id|nfsd4_release_compoundargs
c_func
(paren
id|args
)paren
suffix:semicolon
)brace
r_return
op_logical_neg
id|status
suffix:semicolon
)brace
r_int
DECL|function|nfs4svc_encode_compoundres
id|nfs4svc_encode_compoundres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd4_compoundres
op_star
id|resp
)paren
(brace
multiline_comment|/*&n;&t; * All that remains is to write the tag and operation count...&n;&t; */
r_struct
id|kvec
op_star
id|iov
suffix:semicolon
id|p
op_assign
id|resp-&gt;tagp
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;taglen
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|p
comma
id|resp-&gt;tag
comma
id|resp-&gt;taglen
)paren
suffix:semicolon
id|p
op_add_assign
id|XDR_QUADLEN
c_func
(paren
id|resp-&gt;taglen
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;opcnt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rqstp-&gt;rq_res.page_len
)paren
id|iov
op_assign
op_amp
id|rqstp-&gt;rq_res.tail
(braket
l_int|0
)braket
suffix:semicolon
r_else
id|iov
op_assign
op_amp
id|rqstp-&gt;rq_res.head
(braket
l_int|0
)braket
suffix:semicolon
id|iov-&gt;iov_len
op_assign
(paren
(paren
r_char
op_star
)paren
id|resp-&gt;p
)paren
op_minus
(paren
r_char
op_star
)paren
id|iov-&gt;iov_base
suffix:semicolon
id|BUG_ON
c_func
(paren
id|iov-&gt;iov_len
OG
id|PAGE_SIZE
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * Local variables:&n; *  c-basic-offset: 8&n; * End:&n; */
eof
