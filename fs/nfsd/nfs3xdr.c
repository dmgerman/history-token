multiline_comment|/*&n; * linux/fs/nfsd/nfs3xdr.c&n; *&n; * XDR support for nfsd/protocol version 3.&n; *&n; * Copyright (C) 1995, 1996, 1997 Olaf Kirch &lt;okir@monad.swb.de&gt;&n; *&n; * 2003-08-09 Jamie Lokier: Use htonl() for nanoseconds, not htons()!&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/time.h&gt;
macro_line|#include &lt;linux/nfs3.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/dcache.h&gt;
macro_line|#include &lt;linux/namei.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/vfs.h&gt;
macro_line|#include &lt;linux/sunrpc/xdr.h&gt;
macro_line|#include &lt;linux/sunrpc/svc.h&gt;
macro_line|#include &lt;linux/nfsd/nfsd.h&gt;
macro_line|#include &lt;linux/nfsd/xdr3.h&gt;
DECL|macro|NFSDDBG_FACILITY
mdefine_line|#define NFSDDBG_FACILITY&t;&t;NFSDDBG_XDR
macro_line|#ifdef NFSD_OPTIMIZE_SPACE
DECL|macro|inline
macro_line|# define inline
macro_line|#endif
multiline_comment|/*&n; * Mapping of S_IF* types to NFS file types&n; */
DECL|variable|nfs3_ftypes
r_static
id|u32
id|nfs3_ftypes
(braket
)braket
op_assign
(brace
id|NF3NON
comma
id|NF3FIFO
comma
id|NF3CHR
comma
id|NF3BAD
comma
id|NF3DIR
comma
id|NF3BAD
comma
id|NF3BLK
comma
id|NF3BAD
comma
id|NF3REG
comma
id|NF3BAD
comma
id|NF3LNK
comma
id|NF3BAD
comma
id|NF3SOCK
comma
id|NF3BAD
comma
id|NF3LNK
comma
id|NF3BAD
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * XDR functions for basic NFS types&n; */
r_static
r_inline
id|u32
op_star
DECL|function|encode_time3
id|encode_time3
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|timespec
op_star
id|time
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|time-&gt;tv_sec
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|time-&gt;tv_nsec
)paren
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|decode_time3
id|decode_time3
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|timespec
op_star
id|time
)paren
(brace
id|time-&gt;tv_sec
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|time-&gt;tv_nsec
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|decode_fh
id|decode_fh
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|svc_fh
op_star
id|fhp
)paren
(brace
r_int
r_int
id|size
suffix:semicolon
id|fh_init
c_func
(paren
id|fhp
comma
id|NFS3_FHSIZE
)paren
suffix:semicolon
id|size
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
id|NFS3_FHSIZE
)paren
r_return
l_int|NULL
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|fhp-&gt;fh_handle.fh_base
comma
id|p
comma
id|size
)paren
suffix:semicolon
id|fhp-&gt;fh_handle.fh_size
op_assign
id|size
suffix:semicolon
r_return
id|p
op_plus
id|XDR_QUADLEN
c_func
(paren
id|size
)paren
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|encode_fh
id|encode_fh
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|svc_fh
op_star
id|fhp
)paren
(brace
r_int
r_int
id|size
op_assign
id|fhp-&gt;fh_handle.fh_size
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
)paren
id|p
(braket
id|XDR_QUADLEN
c_func
(paren
id|size
)paren
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|p
comma
op_amp
id|fhp-&gt;fh_handle.fh_base
comma
id|size
)paren
suffix:semicolon
r_return
id|p
op_plus
id|XDR_QUADLEN
c_func
(paren
id|size
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode a file name and make sure that the path contains&n; * no slashes or null bytes.&n; */
r_static
r_inline
id|u32
op_star
DECL|function|decode_filename
id|decode_filename
c_func
(paren
id|u32
op_star
id|p
comma
r_char
op_star
op_star
id|namp
comma
r_int
op_star
id|lenp
)paren
(brace
r_char
op_star
id|name
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
id|xdr_decode_string_inplace
c_func
(paren
id|p
comma
id|namp
comma
id|lenp
comma
id|NFS3_MAXNAMLEN
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|name
op_assign
op_star
id|namp
suffix:semicolon
id|i
OL
op_star
id|lenp
suffix:semicolon
id|i
op_increment
comma
id|name
op_increment
)paren
(brace
r_if
c_cond
(paren
op_star
id|name
op_eq
l_char|&squot;&bslash;0&squot;
op_logical_or
op_star
id|name
op_eq
l_char|&squot;/&squot;
)paren
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|decode_sattr3
id|decode_sattr3
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|iattr
op_star
id|iap
)paren
(brace
id|u32
id|tmp
suffix:semicolon
id|iap-&gt;ia_valid
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_star
id|p
op_increment
)paren
(brace
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_MODE
suffix:semicolon
id|iap-&gt;ia_mode
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|p
op_increment
)paren
(brace
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_UID
suffix:semicolon
id|iap-&gt;ia_uid
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|p
op_increment
)paren
(brace
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_GID
suffix:semicolon
id|iap-&gt;ia_gid
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|p
op_increment
)paren
(brace
id|u64
id|newsize
suffix:semicolon
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_SIZE
suffix:semicolon
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|newsize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|newsize
op_le
id|NFS_OFFSET_MAX
)paren
id|iap-&gt;ia_size
op_assign
id|newsize
suffix:semicolon
r_else
id|iap-&gt;ia_size
op_assign
id|NFS_OFFSET_MAX
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tmp
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
)paren
op_eq
l_int|1
)paren
(brace
multiline_comment|/* set to server time */
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_ATIME
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tmp
op_eq
l_int|2
)paren
(brace
multiline_comment|/* set to client time */
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_ATIME
op_or
id|ATTR_ATIME_SET
suffix:semicolon
id|iap-&gt;ia_atime.tv_sec
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|iap-&gt;ia_atime.tv_nsec
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tmp
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
)paren
op_eq
l_int|1
)paren
(brace
multiline_comment|/* set to server time */
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_MTIME
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tmp
op_eq
l_int|2
)paren
(brace
multiline_comment|/* set to client time */
id|iap-&gt;ia_valid
op_or_assign
id|ATTR_MTIME
op_or
id|ATTR_MTIME_SET
suffix:semicolon
id|iap-&gt;ia_mtime.tv_sec
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|iap-&gt;ia_mtime.tv_nsec
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
)brace
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|encode_fattr3
id|encode_fattr3
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|svc_fh
op_star
id|fhp
)paren
(brace
r_struct
id|vfsmount
op_star
id|mnt
op_assign
id|fhp-&gt;fh_export-&gt;ex_mnt
suffix:semicolon
r_struct
id|dentry
op_star
id|dentry
op_assign
id|fhp-&gt;fh_dentry
suffix:semicolon
r_struct
id|kstat
id|stat
suffix:semicolon
r_struct
id|timespec
id|time
suffix:semicolon
id|vfs_getattr
c_func
(paren
id|mnt
comma
id|dentry
comma
op_amp
id|stat
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|nfs3_ftypes
(braket
(paren
id|stat.mode
op_amp
id|S_IFMT
)paren
op_rshift
l_int|12
)braket
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|stat.mode
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|stat.nlink
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|nfsd_ruid
c_func
(paren
id|rqstp
comma
id|stat.uid
)paren
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|nfsd_rgid
c_func
(paren
id|rqstp
comma
id|stat.gid
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|S_ISLNK
c_func
(paren
id|stat.mode
)paren
op_logical_and
id|stat.size
OG
id|NFS3_MAXPATHLEN
)paren
(brace
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|NFS3_MAXPATHLEN
)paren
suffix:semicolon
)brace
r_else
(brace
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|stat.size
)paren
suffix:semicolon
)brace
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
(paren
id|u64
)paren
id|stat.blocks
)paren
op_lshift
l_int|9
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|MAJOR
c_func
(paren
id|stat.rdev
)paren
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|MINOR
c_func
(paren
id|stat.rdev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is_fsid
c_func
(paren
id|fhp
comma
id|rqstp-&gt;rq_reffh
)paren
)paren
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|fhp-&gt;fh_export-&gt;ex_fsid
)paren
suffix:semicolon
r_else
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|huge_encode_dev
c_func
(paren
id|stat.dev
)paren
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|stat.ino
)paren
suffix:semicolon
id|p
op_assign
id|encode_time3
c_func
(paren
id|p
comma
op_amp
id|stat.atime
)paren
suffix:semicolon
id|lease_get_mtime
c_func
(paren
id|dentry-&gt;d_inode
comma
op_amp
id|time
)paren
suffix:semicolon
id|p
op_assign
id|encode_time3
c_func
(paren
id|p
comma
op_amp
id|time
)paren
suffix:semicolon
id|p
op_assign
id|encode_time3
c_func
(paren
id|p
comma
op_amp
id|stat.ctime
)paren
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|encode_saved_post_attr
id|encode_saved_post_attr
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|svc_fh
op_star
id|fhp
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|fhp-&gt;fh_dentry-&gt;d_inode
suffix:semicolon
multiline_comment|/* Attributes to follow */
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|nfs3_ftypes
(braket
(paren
id|fhp-&gt;fh_post_mode
op_amp
id|S_IFMT
)paren
op_rshift
l_int|12
)braket
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|fhp-&gt;fh_post_mode
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|fhp-&gt;fh_post_nlink
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|nfsd_ruid
c_func
(paren
id|rqstp
comma
id|fhp-&gt;fh_post_uid
)paren
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
(paren
id|u32
)paren
id|nfsd_rgid
c_func
(paren
id|rqstp
comma
id|fhp-&gt;fh_post_gid
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|S_ISLNK
c_func
(paren
id|fhp-&gt;fh_post_mode
)paren
op_logical_and
id|fhp-&gt;fh_post_size
OG
id|NFS3_MAXPATHLEN
)paren
(brace
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|NFS3_MAXPATHLEN
)paren
suffix:semicolon
)brace
r_else
(brace
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|fhp-&gt;fh_post_size
)paren
suffix:semicolon
)brace
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
(paren
id|u64
)paren
id|fhp-&gt;fh_post_blocks
)paren
op_lshift
l_int|9
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|fhp-&gt;fh_post_rdev
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|fhp-&gt;fh_post_rdev
(braket
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|is_fsid
c_func
(paren
id|fhp
comma
id|rqstp-&gt;rq_reffh
)paren
)paren
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|fhp-&gt;fh_export-&gt;ex_fsid
)paren
suffix:semicolon
r_else
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|huge_encode_dev
c_func
(paren
id|inode-&gt;i_sb-&gt;s_dev
)paren
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|inode-&gt;i_ino
)paren
suffix:semicolon
id|p
op_assign
id|encode_time3
c_func
(paren
id|p
comma
op_amp
id|fhp-&gt;fh_post_atime
)paren
suffix:semicolon
id|p
op_assign
id|encode_time3
c_func
(paren
id|p
comma
op_amp
id|fhp-&gt;fh_post_mtime
)paren
suffix:semicolon
id|p
op_assign
id|encode_time3
c_func
(paren
id|p
comma
op_amp
id|fhp-&gt;fh_post_ctime
)paren
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode post-operation attributes.&n; * The inode may be NULL if the call failed because of a stale file&n; * handle. In this case, no attributes are returned.&n; */
r_static
id|u32
op_star
DECL|function|encode_post_op_attr
id|encode_post_op_attr
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|svc_fh
op_star
id|fhp
)paren
(brace
r_struct
id|dentry
op_star
id|dentry
op_assign
id|fhp-&gt;fh_dentry
suffix:semicolon
r_if
c_cond
(paren
id|dentry
op_logical_and
id|dentry-&gt;d_inode
op_ne
l_int|NULL
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* attributes follow */
r_return
id|encode_fattr3
c_func
(paren
id|rqstp
comma
id|p
comma
id|fhp
)paren
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
multiline_comment|/*&n; * Enocde weak cache consistency data&n; */
r_static
id|u32
op_star
DECL|function|encode_wcc_data
id|encode_wcc_data
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|svc_fh
op_star
id|fhp
)paren
(brace
r_struct
id|dentry
op_star
id|dentry
op_assign
id|fhp-&gt;fh_dentry
suffix:semicolon
r_if
c_cond
(paren
id|dentry
op_logical_and
id|dentry-&gt;d_inode
op_logical_and
id|fhp-&gt;fh_post_saved
)paren
(brace
r_if
c_cond
(paren
id|fhp-&gt;fh_pre_saved
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
(paren
id|u64
)paren
id|fhp-&gt;fh_pre_size
)paren
suffix:semicolon
id|p
op_assign
id|encode_time3
c_func
(paren
id|p
comma
op_amp
id|fhp-&gt;fh_pre_mtime
)paren
suffix:semicolon
id|p
op_assign
id|encode_time3
c_func
(paren
id|p
comma
op_amp
id|fhp-&gt;fh_pre_ctime
)paren
suffix:semicolon
)brace
r_else
(brace
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
)brace
r_return
id|encode_saved_post_attr
c_func
(paren
id|rqstp
comma
id|p
comma
id|fhp
)paren
suffix:semicolon
)brace
multiline_comment|/* no pre- or post-attrs */
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
r_return
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
id|fhp
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * XDR decode functions&n; */
r_int
DECL|function|nfs3svc_decode_fhandle
id|nfs3svc_decode_fhandle
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd_fhandle
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_sattrargs
id|nfs3svc_decode_sattrargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_sattrargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_sattr3
c_func
(paren
id|p
comma
op_amp
id|args-&gt;attrs
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|args-&gt;check_guard
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
)paren
op_ne
l_int|0
)paren
(brace
r_struct
id|timespec
id|time
suffix:semicolon
id|p
op_assign
id|decode_time3
c_func
(paren
id|p
comma
op_amp
id|time
)paren
suffix:semicolon
id|args-&gt;guardtime
op_assign
id|time.tv_sec
suffix:semicolon
)brace
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_diropargs
id|nfs3svc_decode_diropargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_diropargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;name
comma
op_amp
id|args-&gt;len
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_accessargs
id|nfs3svc_decode_accessargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_accessargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|args-&gt;access
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_readargs
id|nfs3svc_decode_readargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_readargs
op_star
id|args
)paren
(brace
r_int
r_int
id|len
suffix:semicolon
r_int
id|v
comma
id|pn
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|args-&gt;offset
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|len
op_assign
id|args-&gt;count
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|NFSSVC_MAXBLKSIZE
)paren
id|len
op_assign
id|NFSSVC_MAXBLKSIZE
suffix:semicolon
multiline_comment|/* set up the kvec */
id|v
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|len
OG
l_int|0
)paren
(brace
id|pn
op_assign
id|rqstp-&gt;rq_resused
suffix:semicolon
id|svc_take_page
c_func
(paren
id|rqstp
)paren
suffix:semicolon
id|args-&gt;vec
(braket
id|v
)braket
dot
id|iov_base
op_assign
id|page_address
c_func
(paren
id|rqstp-&gt;rq_respages
(braket
id|pn
)braket
)paren
suffix:semicolon
id|args-&gt;vec
(braket
id|v
)braket
dot
id|iov_len
op_assign
id|len
OL
id|PAGE_SIZE
ques
c_cond
id|len
suffix:colon
id|PAGE_SIZE
suffix:semicolon
id|len
op_sub_assign
id|args-&gt;vec
(braket
id|v
)braket
dot
id|iov_len
suffix:semicolon
id|v
op_increment
suffix:semicolon
)brace
id|args-&gt;vlen
op_assign
id|v
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_writeargs
id|nfs3svc_decode_writeargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_writeargs
op_star
id|args
)paren
(brace
r_int
r_int
id|len
comma
id|v
comma
id|hdr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|args-&gt;offset
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|args-&gt;count
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|args-&gt;stable
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|len
op_assign
id|args-&gt;len
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|hdr
op_assign
(paren
r_void
op_star
)paren
id|p
op_minus
id|rqstp-&gt;rq_arg.head
(braket
l_int|0
)braket
dot
id|iov_base
suffix:semicolon
r_if
c_cond
(paren
id|rqstp-&gt;rq_arg.len
OL
id|len
op_plus
id|hdr
)paren
r_return
l_int|0
suffix:semicolon
id|args-&gt;vec
(braket
l_int|0
)braket
dot
id|iov_base
op_assign
(paren
r_void
op_star
)paren
id|p
suffix:semicolon
id|args-&gt;vec
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
id|rqstp-&gt;rq_arg.head
(braket
l_int|0
)braket
dot
id|iov_len
op_minus
id|hdr
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|NFSSVC_MAXBLKSIZE
)paren
id|len
op_assign
id|NFSSVC_MAXBLKSIZE
suffix:semicolon
id|v
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|len
OG
id|args-&gt;vec
(braket
id|v
)braket
dot
id|iov_len
)paren
(brace
id|len
op_sub_assign
id|args-&gt;vec
(braket
id|v
)braket
dot
id|iov_len
suffix:semicolon
id|v
op_increment
suffix:semicolon
id|args-&gt;vec
(braket
id|v
)braket
dot
id|iov_base
op_assign
id|page_address
c_func
(paren
id|rqstp-&gt;rq_argpages
(braket
id|v
)braket
)paren
suffix:semicolon
id|args-&gt;vec
(braket
id|v
)braket
dot
id|iov_len
op_assign
id|PAGE_SIZE
suffix:semicolon
)brace
id|args-&gt;vec
(braket
id|v
)braket
dot
id|iov_len
op_assign
id|len
suffix:semicolon
id|args-&gt;vlen
op_assign
id|v
op_plus
l_int|1
suffix:semicolon
r_return
id|args-&gt;count
op_eq
id|args-&gt;len
op_logical_and
id|args-&gt;vec
(braket
l_int|0
)braket
dot
id|iov_len
OG
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_createargs
id|nfs3svc_decode_createargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_createargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;name
comma
op_amp
id|args-&gt;len
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|args-&gt;createmode
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
)paren
(brace
r_case
id|NFS3_CREATE_UNCHECKED
suffix:colon
r_case
id|NFS3_CREATE_GUARDED
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_sattr3
c_func
(paren
id|p
comma
op_amp
id|args-&gt;attrs
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NFS3_CREATE_EXCLUSIVE
suffix:colon
id|args-&gt;verf
op_assign
id|p
suffix:semicolon
id|p
op_add_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_mkdirargs
id|nfs3svc_decode_mkdirargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_createargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;name
comma
op_amp
id|args-&gt;len
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_sattr3
c_func
(paren
id|p
comma
op_amp
id|args-&gt;attrs
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_symlinkargs
id|nfs3svc_decode_symlinkargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_symlinkargs
op_star
id|args
)paren
(brace
r_int
r_int
id|len
suffix:semicolon
r_int
id|avail
suffix:semicolon
r_char
op_star
id|old
comma
op_star
r_new
suffix:semicolon
r_struct
id|kvec
op_star
id|vec
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;ffh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fname
comma
op_amp
id|args-&gt;flen
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_sattr3
c_func
(paren
id|p
comma
op_amp
id|args-&gt;attrs
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* now decode the pathname, which might be larger than the first page.&n;&t; * As we have to check for nul&squot;s anyway, we copy it into a new page&n;&t; * This page appears in the rq_res.pages list, but as pages_len is always&n;&t; * 0, it won&squot;t get in the way&n;&t; */
id|svc_take_page
c_func
(paren
id|rqstp
)paren
suffix:semicolon
id|len
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_eq
l_int|0
op_logical_or
id|len
OG
id|NFS3_MAXPATHLEN
op_logical_or
id|len
op_ge
id|PAGE_SIZE
)paren
r_return
l_int|0
suffix:semicolon
id|args-&gt;tname
op_assign
r_new
op_assign
id|page_address
c_func
(paren
id|rqstp-&gt;rq_respages
(braket
id|rqstp-&gt;rq_resused
op_minus
l_int|1
)braket
)paren
suffix:semicolon
id|args-&gt;tlen
op_assign
id|len
suffix:semicolon
multiline_comment|/* first copy and check from the first page */
id|old
op_assign
(paren
r_char
op_star
)paren
id|p
suffix:semicolon
id|vec
op_assign
op_amp
id|rqstp-&gt;rq_arg.head
(braket
l_int|0
)braket
suffix:semicolon
id|avail
op_assign
id|vec-&gt;iov_len
op_minus
(paren
id|old
op_minus
(paren
r_char
op_star
)paren
id|vec-&gt;iov_base
)paren
suffix:semicolon
r_while
c_loop
(paren
id|len
op_logical_and
id|avail
op_logical_and
op_star
id|old
)paren
(brace
op_star
r_new
op_increment
op_assign
op_star
id|old
op_increment
suffix:semicolon
id|len
op_decrement
suffix:semicolon
id|avail
op_decrement
suffix:semicolon
)brace
multiline_comment|/* now copy next page if there is one */
r_if
c_cond
(paren
id|len
op_logical_and
op_logical_neg
id|avail
op_logical_and
id|rqstp-&gt;rq_arg.page_len
)paren
(brace
id|avail
op_assign
id|rqstp-&gt;rq_arg.page_len
suffix:semicolon
r_if
c_cond
(paren
id|avail
OG
id|PAGE_SIZE
)paren
id|avail
op_assign
id|PAGE_SIZE
suffix:semicolon
id|old
op_assign
id|page_address
c_func
(paren
id|rqstp-&gt;rq_arg.pages
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|len
op_logical_and
id|avail
op_logical_and
op_star
id|old
)paren
(brace
op_star
r_new
op_increment
op_assign
op_star
id|old
op_increment
suffix:semicolon
id|len
op_decrement
suffix:semicolon
id|avail
op_decrement
suffix:semicolon
)brace
op_star
r_new
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
id|len
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_mknodargs
id|nfs3svc_decode_mknodargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_mknodargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;name
comma
op_amp
id|args-&gt;len
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|args-&gt;ftype
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|args-&gt;ftype
op_eq
id|NF3BLK
op_logical_or
id|args-&gt;ftype
op_eq
id|NF3CHR
op_logical_or
id|args-&gt;ftype
op_eq
id|NF3SOCK
op_logical_or
id|args-&gt;ftype
op_eq
id|NF3FIFO
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_sattr3
c_func
(paren
id|p
comma
op_amp
id|args-&gt;attrs
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|args-&gt;ftype
op_eq
id|NF3BLK
op_logical_or
id|args-&gt;ftype
op_eq
id|NF3CHR
)paren
(brace
id|args-&gt;major
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|args-&gt;minor
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
)brace
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_renameargs
id|nfs3svc_decode_renameargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_renameargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;ffh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fname
comma
op_amp
id|args-&gt;flen
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;tfh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;tname
comma
op_amp
id|args-&gt;tlen
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_readlinkargs
id|nfs3svc_decode_readlinkargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_readlinkargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|svc_take_page
c_func
(paren
id|rqstp
)paren
suffix:semicolon
id|args-&gt;buffer
op_assign
id|page_address
c_func
(paren
id|rqstp-&gt;rq_respages
(braket
id|rqstp-&gt;rq_resused
op_minus
l_int|1
)braket
)paren
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_linkargs
id|nfs3svc_decode_linkargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_linkargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;ffh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;tfh
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|p
op_assign
id|decode_filename
c_func
(paren
id|p
comma
op_amp
id|args-&gt;tname
comma
op_amp
id|args-&gt;tlen
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_readdirargs
id|nfs3svc_decode_readdirargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_readdirargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|args-&gt;cookie
)paren
suffix:semicolon
id|args-&gt;verf
op_assign
id|p
suffix:semicolon
id|p
op_add_assign
l_int|2
suffix:semicolon
id|args-&gt;dircount
op_assign
op_complement
l_int|0
suffix:semicolon
id|args-&gt;count
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|args-&gt;count
OG
id|PAGE_SIZE
)paren
id|args-&gt;count
op_assign
id|PAGE_SIZE
suffix:semicolon
id|svc_take_page
c_func
(paren
id|rqstp
)paren
suffix:semicolon
id|args-&gt;buffer
op_assign
id|page_address
c_func
(paren
id|rqstp-&gt;rq_respages
(braket
id|rqstp-&gt;rq_resused
op_minus
l_int|1
)braket
)paren
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_readdirplusargs
id|nfs3svc_decode_readdirplusargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_readdirargs
op_star
id|args
)paren
(brace
r_int
id|len
comma
id|pn
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|args-&gt;cookie
)paren
suffix:semicolon
id|args-&gt;verf
op_assign
id|p
suffix:semicolon
id|p
op_add_assign
l_int|2
suffix:semicolon
id|args-&gt;dircount
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|args-&gt;count
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|len
op_assign
(paren
id|args-&gt;count
OG
id|NFSSVC_MAXBLKSIZE
)paren
ques
c_cond
id|NFSSVC_MAXBLKSIZE
suffix:colon
id|args-&gt;count
suffix:semicolon
id|args-&gt;count
op_assign
id|len
suffix:semicolon
r_while
c_loop
(paren
id|len
OG
l_int|0
)paren
(brace
id|pn
op_assign
id|rqstp-&gt;rq_resused
suffix:semicolon
id|svc_take_page
c_func
(paren
id|rqstp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|args-&gt;buffer
)paren
id|args-&gt;buffer
op_assign
id|page_address
c_func
(paren
id|rqstp-&gt;rq_respages
(braket
id|pn
)braket
)paren
suffix:semicolon
id|len
op_sub_assign
id|PAGE_SIZE
suffix:semicolon
)brace
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_decode_commitargs
id|nfs3svc_decode_commitargs
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_commitargs
op_star
id|args
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|p
op_assign
id|decode_fh
c_func
(paren
id|p
comma
op_amp
id|args-&gt;fh
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|args-&gt;offset
)paren
suffix:semicolon
id|args-&gt;count
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * XDR encode functions&n; */
multiline_comment|/*&n; * There must be an encoding function for void results so svc_process&n; * will work properly.&n; */
r_int
DECL|function|nfs3svc_encode_voidres
id|nfs3svc_encode_voidres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_void
op_star
id|dummy
)paren
(brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* GETATTR */
r_int
DECL|function|nfs3svc_encode_attrstat
id|nfs3svc_encode_attrstat
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_attrstat
op_star
id|resp
)paren
(brace
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
id|p
op_assign
id|encode_fattr3
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* SETATTR, REMOVE, RMDIR */
r_int
DECL|function|nfs3svc_encode_wccstat
id|nfs3svc_encode_wccstat
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_attrstat
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_wcc_data
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* LOOKUP */
r_int
DECL|function|nfs3svc_encode_diropres
id|nfs3svc_encode_diropres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_diropres
op_star
id|resp
)paren
(brace
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
id|p
op_assign
id|encode_fh
c_func
(paren
id|p
comma
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
)brace
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;dirfh
)paren
suffix:semicolon
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* ACCESS */
r_int
DECL|function|nfs3svc_encode_accessres
id|nfs3svc_encode_accessres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_accessres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;access
)paren
suffix:semicolon
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* READLINK */
r_int
DECL|function|nfs3svc_encode_readlinkres
id|nfs3svc_encode_readlinkres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_readlinkres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;len
)paren
suffix:semicolon
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
id|rqstp-&gt;rq_res.page_len
op_assign
id|resp-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|resp-&gt;len
op_amp
l_int|3
)paren
(brace
multiline_comment|/* need to pad the tail */
id|rqstp-&gt;rq_restailpage
op_assign
l_int|0
suffix:semicolon
id|rqstp-&gt;rq_res.tail
(braket
l_int|0
)braket
dot
id|iov_base
op_assign
id|p
suffix:semicolon
op_star
id|p
op_assign
l_int|0
suffix:semicolon
id|rqstp-&gt;rq_res.tail
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
l_int|4
op_minus
(paren
id|resp-&gt;len
op_amp
l_int|3
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
r_else
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* READ */
r_int
DECL|function|nfs3svc_encode_readres
id|nfs3svc_encode_readres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_readres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;count
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;eof
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;count
)paren
suffix:semicolon
multiline_comment|/* xdr opaque count */
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
multiline_comment|/* now update rqstp-&gt;rq_res to reflect data aswell */
id|rqstp-&gt;rq_res.page_len
op_assign
id|resp-&gt;count
suffix:semicolon
r_if
c_cond
(paren
id|resp-&gt;count
op_amp
l_int|3
)paren
(brace
multiline_comment|/* need to pad the tail */
id|rqstp-&gt;rq_restailpage
op_assign
l_int|0
suffix:semicolon
id|rqstp-&gt;rq_res.tail
(braket
l_int|0
)braket
dot
id|iov_base
op_assign
id|p
suffix:semicolon
op_star
id|p
op_assign
l_int|0
suffix:semicolon
id|rqstp-&gt;rq_res.tail
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
l_int|4
op_minus
(paren
id|resp-&gt;count
op_amp
l_int|3
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
r_else
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* WRITE */
r_int
DECL|function|nfs3svc_encode_writeres
id|nfs3svc_encode_writeres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_writeres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_wcc_data
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;count
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;committed
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|nfssvc_boot.tv_sec
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|nfssvc_boot.tv_usec
)paren
suffix:semicolon
)brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* CREATE, MKDIR, SYMLINK, MKNOD */
r_int
DECL|function|nfs3svc_encode_createres
id|nfs3svc_encode_createres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_diropres
op_star
id|resp
)paren
(brace
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
id|p
op_assign
id|encode_fh
c_func
(paren
id|p
comma
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
)brace
id|p
op_assign
id|encode_wcc_data
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;dirfh
)paren
suffix:semicolon
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* RENAME */
r_int
DECL|function|nfs3svc_encode_renameres
id|nfs3svc_encode_renameres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_renameres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_wcc_data
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;ffh
)paren
suffix:semicolon
id|p
op_assign
id|encode_wcc_data
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;tfh
)paren
suffix:semicolon
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* LINK */
r_int
DECL|function|nfs3svc_encode_linkres
id|nfs3svc_encode_linkres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_linkres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
id|p
op_assign
id|encode_wcc_data
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;tfh
)paren
suffix:semicolon
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* READDIR */
r_int
DECL|function|nfs3svc_encode_readdirres
id|nfs3svc_encode_readdirres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_readdirres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
multiline_comment|/* stupid readdir cookie */
id|memcpy
c_func
(paren
id|p
comma
id|resp-&gt;verf
comma
l_int|8
)paren
suffix:semicolon
id|p
op_add_assign
l_int|2
suffix:semicolon
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rqstp-&gt;rq_res.head
(braket
l_int|0
)braket
dot
id|iov_len
op_plus
(paren
l_int|2
op_lshift
l_int|2
)paren
OG
id|PAGE_SIZE
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/*No room for trailer */
id|rqstp-&gt;rq_res.page_len
op_assign
(paren
id|resp-&gt;count
)paren
op_lshift
l_int|2
suffix:semicolon
multiline_comment|/* add the &squot;tail&squot; to the end of the &squot;head&squot; page - page 0. */
id|rqstp-&gt;rq_restailpage
op_assign
l_int|0
suffix:semicolon
id|rqstp-&gt;rq_res.tail
(braket
l_int|0
)braket
dot
id|iov_base
op_assign
id|p
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* no more entries */
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;common.err
op_eq
id|nfserr_eof
)paren
suffix:semicolon
id|rqstp-&gt;rq_res.tail
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
l_int|2
op_lshift
l_int|2
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_else
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|encode_entry_baggage
id|encode_entry_baggage
c_func
(paren
r_struct
id|nfsd3_readdirres
op_star
id|cd
comma
id|u32
op_star
id|p
comma
r_const
r_char
op_star
id|name
comma
r_int
id|namlen
comma
id|ino_t
id|ino
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* mark entry present */
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|ino
)paren
suffix:semicolon
multiline_comment|/* file id */
id|p
op_assign
id|xdr_encode_array
c_func
(paren
id|p
comma
id|name
comma
id|namlen
)paren
suffix:semicolon
multiline_comment|/* name length &amp; name */
id|cd-&gt;offset
op_assign
id|p
suffix:semicolon
multiline_comment|/* remember pointer */
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|NFS_OFFSET_MAX
)paren
suffix:semicolon
multiline_comment|/* offset of next entry */
r_return
id|p
suffix:semicolon
)brace
r_static
r_inline
id|u32
op_star
DECL|function|encode_entryplus_baggage
id|encode_entryplus_baggage
c_func
(paren
r_struct
id|nfsd3_readdirres
op_star
id|cd
comma
id|u32
op_star
id|p
comma
r_struct
id|svc_fh
op_star
id|fhp
)paren
(brace
id|p
op_assign
id|encode_post_op_attr
c_func
(paren
id|cd-&gt;rqstp
comma
id|p
comma
id|fhp
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* yes, a file handle follows */
id|p
op_assign
id|encode_fh
c_func
(paren
id|p
comma
id|fhp
)paren
suffix:semicolon
id|fh_put
c_func
(paren
id|fhp
)paren
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
r_static
r_int
DECL|function|compose_entry_fh
id|compose_entry_fh
c_func
(paren
r_struct
id|nfsd3_readdirres
op_star
id|cd
comma
r_struct
id|svc_fh
op_star
id|fhp
comma
r_const
r_char
op_star
id|name
comma
r_int
id|namlen
)paren
(brace
r_struct
id|svc_export
op_star
id|exp
suffix:semicolon
r_struct
id|dentry
op_star
id|dparent
comma
op_star
id|dchild
suffix:semicolon
r_int
id|rv
op_assign
l_int|0
suffix:semicolon
id|dparent
op_assign
id|cd-&gt;fh.fh_dentry
suffix:semicolon
id|exp
op_assign
id|cd-&gt;fh.fh_export
suffix:semicolon
id|fh_init
c_func
(paren
id|fhp
comma
id|NFS3_FHSIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isdotent
c_func
(paren
id|name
comma
id|namlen
)paren
)paren
(brace
r_if
c_cond
(paren
id|namlen
op_eq
l_int|2
)paren
(brace
id|dchild
op_assign
id|dget_parent
c_func
(paren
id|dparent
)paren
suffix:semicolon
)brace
r_else
id|dchild
op_assign
id|dget
c_func
(paren
id|dparent
)paren
suffix:semicolon
)brace
r_else
id|dchild
op_assign
id|lookup_one_len
c_func
(paren
id|name
comma
id|dparent
comma
id|namlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|dchild
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|d_mountpoint
c_func
(paren
id|dchild
)paren
op_logical_or
id|fh_compose
c_func
(paren
id|fhp
comma
id|exp
comma
id|dchild
comma
op_amp
id|cd-&gt;fh
)paren
op_ne
l_int|0
op_logical_or
op_logical_neg
id|dchild-&gt;d_inode
)paren
id|rv
op_assign
l_int|1
suffix:semicolon
id|dput
c_func
(paren
id|dchild
)paren
suffix:semicolon
r_return
id|rv
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode a directory entry. This one works for both normal readdir&n; * and readdirplus.&n; * The normal readdir reply requires 2 (fileid) + 1 (stringlen)&n; * + string + 2 (cookie) + 1 (next) words, i.e. 6 + strlen.&n; * &n; * The readdirplus baggage is 1+21 words for post_op_attr, plus the&n; * file handle.&n; */
DECL|macro|NFS3_ENTRY_BAGGAGE
mdefine_line|#define NFS3_ENTRY_BAGGAGE&t;(2 + 1 + 2 + 1)
DECL|macro|NFS3_ENTRYPLUS_BAGGAGE
mdefine_line|#define NFS3_ENTRYPLUS_BAGGAGE&t;(1 + 21 + 1 + (NFS3_FHSIZE &gt;&gt; 2))
r_static
r_int
DECL|function|encode_entry
id|encode_entry
c_func
(paren
r_struct
id|readdir_cd
op_star
id|ccd
comma
r_const
r_char
op_star
id|name
comma
r_int
id|namlen
comma
id|off_t
id|offset
comma
id|ino_t
id|ino
comma
r_int
r_int
id|d_type
comma
r_int
id|plus
)paren
(brace
r_struct
id|nfsd3_readdirres
op_star
id|cd
op_assign
id|container_of
c_func
(paren
id|ccd
comma
r_struct
id|nfsd3_readdirres
comma
id|common
)paren
suffix:semicolon
id|u32
op_star
id|p
op_assign
id|cd-&gt;buffer
suffix:semicolon
id|caddr_t
id|curr_page_addr
op_assign
l_int|NULL
suffix:semicolon
r_int
id|pn
suffix:semicolon
multiline_comment|/* current page number */
r_int
id|slen
suffix:semicolon
multiline_comment|/* string (name) length */
r_int
id|elen
suffix:semicolon
multiline_comment|/* estimated entry length in words */
r_int
id|num_entry_words
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* actual number of words */
r_if
c_cond
(paren
id|cd-&gt;offset
)paren
(brace
id|u64
id|offset64
op_assign
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|cd-&gt;offset1
)paren
)paren
(brace
multiline_comment|/* we ended up with offset on a page boundary */
op_star
id|cd-&gt;offset
op_assign
id|htonl
c_func
(paren
id|offset64
op_rshift
l_int|32
)paren
suffix:semicolon
op_star
id|cd-&gt;offset1
op_assign
id|htonl
c_func
(paren
id|offset64
op_amp
l_int|0xffffffff
)paren
suffix:semicolon
id|cd-&gt;offset1
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|xdr_encode_hyper
c_func
(paren
id|cd-&gt;offset
comma
(paren
id|u64
)paren
id|offset
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t;dprintk(&quot;encode_entry(%.*s @%ld%s)&bslash;n&quot;,&n;&t;&t;namlen, name, (long) offset, plus? &quot; plus&quot; : &quot;&quot;);&n;&t; */
multiline_comment|/* truncate filename if too long */
r_if
c_cond
(paren
id|namlen
OG
id|NFS3_MAXNAMLEN
)paren
id|namlen
op_assign
id|NFS3_MAXNAMLEN
suffix:semicolon
id|slen
op_assign
id|XDR_QUADLEN
c_func
(paren
id|namlen
)paren
suffix:semicolon
id|elen
op_assign
id|slen
op_plus
id|NFS3_ENTRY_BAGGAGE
op_plus
(paren
id|plus
ques
c_cond
id|NFS3_ENTRYPLUS_BAGGAGE
suffix:colon
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cd-&gt;buflen
OL
id|elen
)paren
(brace
id|cd-&gt;common.err
op_assign
id|nfserr_toosmall
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* determine which page in rq_respages[] we are currently filling */
r_for
c_loop
(paren
id|pn
op_assign
l_int|1
suffix:semicolon
id|pn
OL
id|cd-&gt;rqstp-&gt;rq_resused
suffix:semicolon
id|pn
op_increment
)paren
(brace
id|curr_page_addr
op_assign
id|page_address
c_func
(paren
id|cd-&gt;rqstp-&gt;rq_respages
(braket
id|pn
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|caddr_t
)paren
id|cd-&gt;buffer
op_ge
id|curr_page_addr
)paren
op_logical_and
(paren
(paren
id|caddr_t
)paren
id|cd-&gt;buffer
OL
id|curr_page_addr
op_plus
id|PAGE_SIZE
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|caddr_t
)paren
(paren
id|cd-&gt;buffer
op_plus
id|elen
)paren
OL
(paren
id|curr_page_addr
op_plus
id|PAGE_SIZE
)paren
)paren
(brace
multiline_comment|/* encode entry in current page */
id|p
op_assign
id|encode_entry_baggage
c_func
(paren
id|cd
comma
id|p
comma
id|name
comma
id|namlen
comma
id|ino
)paren
suffix:semicolon
multiline_comment|/* throw in readdirplus baggage */
r_if
c_cond
(paren
id|plus
)paren
(brace
r_struct
id|svc_fh
id|fh
suffix:semicolon
r_if
c_cond
(paren
id|compose_entry_fh
c_func
(paren
id|cd
comma
op_amp
id|fh
comma
id|name
comma
id|namlen
)paren
OG
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
l_int|0
suffix:semicolon
op_star
id|p
op_increment
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|p
op_assign
id|encode_entryplus_baggage
c_func
(paren
id|cd
comma
id|p
comma
op_amp
id|fh
)paren
suffix:semicolon
)brace
id|num_entry_words
op_assign
id|p
op_minus
id|cd-&gt;buffer
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cd-&gt;rqstp-&gt;rq_respages
(braket
id|pn
op_plus
l_int|1
)braket
op_ne
l_int|NULL
)paren
(brace
multiline_comment|/* temporarily encode entry into next page, then move back to&n;&t;&t; * current and next page in rq_respages[] */
id|u32
op_star
id|p1
comma
op_star
id|tmp
suffix:semicolon
r_int
id|len1
comma
id|len2
suffix:semicolon
multiline_comment|/* grab next page for temporary storage of entry */
id|p1
op_assign
id|tmp
op_assign
id|page_address
c_func
(paren
id|cd-&gt;rqstp-&gt;rq_respages
(braket
id|pn
op_plus
l_int|1
)braket
)paren
suffix:semicolon
id|p1
op_assign
id|encode_entry_baggage
c_func
(paren
id|cd
comma
id|p1
comma
id|name
comma
id|namlen
comma
id|ino
)paren
suffix:semicolon
multiline_comment|/* throw in readdirplus baggage */
r_if
c_cond
(paren
id|plus
)paren
(brace
r_struct
id|svc_fh
id|fh
suffix:semicolon
r_if
c_cond
(paren
id|compose_entry_fh
c_func
(paren
id|cd
comma
op_amp
id|fh
comma
id|name
comma
id|namlen
)paren
OG
l_int|0
)paren
(brace
multiline_comment|/* zero out the filehandle */
op_star
id|p1
op_increment
op_assign
l_int|0
suffix:semicolon
op_star
id|p1
op_increment
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|p1
op_assign
id|encode_entryplus_baggage
c_func
(paren
id|cd
comma
id|p1
comma
op_amp
id|fh
)paren
suffix:semicolon
)brace
multiline_comment|/* determine entry word length and lengths to go in pages */
id|num_entry_words
op_assign
id|p1
op_minus
id|tmp
suffix:semicolon
id|len1
op_assign
id|curr_page_addr
op_plus
id|PAGE_SIZE
op_minus
(paren
id|caddr_t
)paren
id|cd-&gt;buffer
suffix:semicolon
r_if
c_cond
(paren
(paren
id|num_entry_words
op_lshift
l_int|2
)paren
OL
id|len1
)paren
(brace
multiline_comment|/* the actual number of words in the entry is less&n;&t;&t;&t; * than elen and can still fit in the current page&n;&t;&t;&t; */
id|memmove
c_func
(paren
id|p
comma
id|tmp
comma
id|num_entry_words
op_lshift
l_int|2
)paren
suffix:semicolon
id|p
op_add_assign
id|num_entry_words
suffix:semicolon
multiline_comment|/* update offset */
id|cd-&gt;offset
op_assign
id|cd-&gt;buffer
op_plus
(paren
id|cd-&gt;offset
op_minus
id|tmp
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
r_int
id|offset_r
op_assign
(paren
id|cd-&gt;offset
op_minus
id|tmp
)paren
op_lshift
l_int|2
suffix:semicolon
multiline_comment|/* update pointer to offset location.&n;&t;&t;&t; * This is a 64bit quantity, so we need to&n;&t;&t;&t; * deal with 3 cases:&n;&t;&t;&t; *  -&t;entirely in first page&n;&t;&t;&t; *  -&t;entirely in second page&n;&t;&t;&t; *  -&t;4 bytes in each page&n;&t;&t;&t; */
r_if
c_cond
(paren
id|offset_r
op_plus
l_int|8
op_le
id|len1
)paren
(brace
id|cd-&gt;offset
op_assign
id|p
op_plus
(paren
id|cd-&gt;offset
op_minus
id|tmp
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|offset_r
op_ge
id|len1
)paren
(brace
id|cd-&gt;offset
op_sub_assign
id|len1
op_rshift
l_int|2
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* sitting on the fence */
id|BUG_ON
c_func
(paren
id|offset_r
op_ne
id|len1
op_minus
l_int|4
)paren
suffix:semicolon
id|cd-&gt;offset
op_assign
id|p
op_plus
(paren
id|cd-&gt;offset
op_minus
id|tmp
)paren
suffix:semicolon
id|cd-&gt;offset1
op_assign
id|tmp
suffix:semicolon
)brace
id|len2
op_assign
(paren
id|num_entry_words
op_lshift
l_int|2
)paren
op_minus
id|len1
suffix:semicolon
multiline_comment|/* move from temp page to current and next pages */
id|memmove
c_func
(paren
id|p
comma
id|tmp
comma
id|len1
)paren
suffix:semicolon
id|memmove
c_func
(paren
id|tmp
comma
(paren
id|caddr_t
)paren
id|tmp
op_plus
id|len1
comma
id|len2
)paren
suffix:semicolon
id|p
op_assign
id|tmp
op_plus
(paren
id|len2
op_rshift
l_int|2
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|cd-&gt;common.err
op_assign
id|nfserr_toosmall
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|cd-&gt;buflen
op_sub_assign
id|num_entry_words
suffix:semicolon
id|cd-&gt;buffer
op_assign
id|p
suffix:semicolon
id|cd-&gt;common.err
op_assign
id|nfs_ok
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_encode_entry
id|nfs3svc_encode_entry
c_func
(paren
r_struct
id|readdir_cd
op_star
id|cd
comma
r_const
r_char
op_star
id|name
comma
r_int
id|namlen
comma
id|loff_t
id|offset
comma
id|ino_t
id|ino
comma
r_int
r_int
id|d_type
)paren
(brace
r_return
id|encode_entry
c_func
(paren
id|cd
comma
id|name
comma
id|namlen
comma
id|offset
comma
id|ino
comma
id|d_type
comma
l_int|0
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_encode_entry_plus
id|nfs3svc_encode_entry_plus
c_func
(paren
r_struct
id|readdir_cd
op_star
id|cd
comma
r_const
r_char
op_star
id|name
comma
r_int
id|namlen
comma
id|loff_t
id|offset
comma
id|ino_t
id|ino
comma
r_int
r_int
id|d_type
)paren
(brace
r_return
id|encode_entry
c_func
(paren
id|cd
comma
id|name
comma
id|namlen
comma
id|offset
comma
id|ino
comma
id|d_type
comma
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* FSSTAT */
r_int
DECL|function|nfs3svc_encode_fsstatres
id|nfs3svc_encode_fsstatres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_fsstatres
op_star
id|resp
)paren
(brace
r_struct
id|kstatfs
op_star
id|s
op_assign
op_amp
id|resp-&gt;stats
suffix:semicolon
id|u64
id|bs
op_assign
id|s-&gt;f_bsize
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
multiline_comment|/* no post_op_attr */
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|bs
op_star
id|s-&gt;f_blocks
)paren
suffix:semicolon
multiline_comment|/* total bytes */
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|bs
op_star
id|s-&gt;f_bfree
)paren
suffix:semicolon
multiline_comment|/* free bytes */
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|bs
op_star
id|s-&gt;f_bavail
)paren
suffix:semicolon
multiline_comment|/* user available bytes */
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|s-&gt;f_files
)paren
suffix:semicolon
multiline_comment|/* total inodes */
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|s-&gt;f_ffree
)paren
suffix:semicolon
multiline_comment|/* free inodes */
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|s-&gt;f_ffree
)paren
suffix:semicolon
multiline_comment|/* user available inodes */
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;invarsec
)paren
suffix:semicolon
multiline_comment|/* mean unchanged time */
)brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* FSINFO */
r_int
DECL|function|nfs3svc_encode_fsinfores
id|nfs3svc_encode_fsinfores
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_fsinfores
op_star
id|resp
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
multiline_comment|/* no post_op_attr */
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_rtmax
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_rtpref
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_rtmult
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_wtmax
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_wtpref
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_wtmult
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_dtpref
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|resp-&gt;f_maxfilesize
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;f_properties
)paren
suffix:semicolon
)brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* PATHCONF */
r_int
DECL|function|nfs3svc_encode_pathconfres
id|nfs3svc_encode_pathconfres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_pathconfres
op_star
id|resp
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
multiline_comment|/* no post_op_attr */
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;p_link_max
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;p_name_max
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;p_no_trunc
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;p_chown_restricted
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;p_case_insensitive
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|resp-&gt;p_case_preserving
)paren
suffix:semicolon
)brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* COMMIT */
r_int
DECL|function|nfs3svc_encode_commitres
id|nfs3svc_encode_commitres
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_commitres
op_star
id|resp
)paren
(brace
id|p
op_assign
id|encode_wcc_data
c_func
(paren
id|rqstp
comma
id|p
comma
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
multiline_comment|/* Write verifier */
r_if
c_cond
(paren
id|resp-&gt;status
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|nfssvc_boot.tv_sec
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|nfssvc_boot.tv_usec
)paren
suffix:semicolon
)brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * XDR release functions&n; */
r_int
DECL|function|nfs3svc_release_fhandle
id|nfs3svc_release_fhandle
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_attrstat
op_star
id|resp
)paren
(brace
id|fh_put
c_func
(paren
op_amp
id|resp-&gt;fh
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_int
DECL|function|nfs3svc_release_fhandle2
id|nfs3svc_release_fhandle2
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
id|u32
op_star
id|p
comma
r_struct
id|nfsd3_fhandle_pair
op_star
id|resp
)paren
(brace
id|fh_put
c_func
(paren
op_amp
id|resp-&gt;fh1
)paren
suffix:semicolon
id|fh_put
c_func
(paren
op_amp
id|resp-&gt;fh2
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
eof
