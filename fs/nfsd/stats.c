multiline_comment|/*&n; * linux/fs/nfsd/stats.c&n; *&n; * procfs-based user access to knfsd statistics&n; *&n; * /proc/net/rpc/nfsd&n; *&n; * Format:&n; *&t;rc &lt;hits&gt; &lt;misses&gt; &lt;nocache&gt;&n; *&t;&t;&t;Statistsics for the reply cache&n; *&t;fh &lt;stale&gt; &lt;total-lookups&gt; &lt;anonlookups&gt; &lt;dir-not-in-dcache&gt; &lt;nondir-not-in-dcache&gt;&n; *&t;&t;&t;statistics for filehandle lookup&n; *&t;io &lt;bytes-read&gt; &lt;bytes-writtten&gt;&n; *&t;&t;&t;statistics for IO throughput&n; *&t;th &lt;threads&gt; &lt;fullcnt&gt; &lt;10%-20%&gt; &lt;20%-30%&gt; ... &lt;90%-100%&gt; &lt;100%&gt; &n; *&t;&t;&t;time (seconds) when nfsd thread usage above thresholds&n; *&t;&t;&t;and number of times that all threads were in use&n; *&t;ra cache-size  &lt;10%  &lt;20%  &lt;30% ... &lt;100% not-found&n; *&t;&t;&t;number of times that read-ahead entry was found that deep in&n; *&t;&t;&t;the cache.&n; *&t;plus generic RPC stats (see net/sunrpc/stats.c)&n; *&n; * Copyright (C) 1995, 1996, 1997 Olaf Kirch &lt;okir@monad.swb.de&gt;&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/time.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/sunrpc/svc.h&gt;
macro_line|#include &lt;linux/sunrpc/stats.h&gt;
macro_line|#include &lt;linux/nfsd/nfsd.h&gt;
macro_line|#include &lt;linux/nfsd/stats.h&gt;
DECL|variable|nfsdstats
r_struct
id|nfsd_stats
id|nfsdstats
suffix:semicolon
DECL|variable|nfsd_svcstats
r_struct
id|svc_stat
id|nfsd_svcstats
op_assign
(brace
dot
id|program
op_assign
op_amp
id|nfsd_program
comma
)brace
suffix:semicolon
DECL|function|nfsd_proc_show
r_static
r_int
id|nfsd_proc_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|v
)paren
(brace
r_int
id|i
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;rc %u %u %u&bslash;nfh %u %u %u %u %u&bslash;nio %u %u&bslash;n&quot;
comma
id|nfsdstats.rchits
comma
id|nfsdstats.rcmisses
comma
id|nfsdstats.rcnocache
comma
id|nfsdstats.fh_stale
comma
id|nfsdstats.fh_lookup
comma
id|nfsdstats.fh_anon
comma
id|nfsdstats.fh_nocache_dir
comma
id|nfsdstats.fh_nocache_nondir
comma
id|nfsdstats.io_read
comma
id|nfsdstats.io_write
)paren
suffix:semicolon
multiline_comment|/* thread usage: */
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;th %u %u&quot;
comma
id|nfsdstats.th_cnt
comma
id|nfsdstats.th_fullcnt
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|jifs
op_assign
id|nfsdstats.th_usage
(braket
id|i
)braket
suffix:semicolon
r_int
r_int
id|sec
op_assign
id|jifs
op_div
id|HZ
comma
id|msec
op_assign
(paren
id|jifs
op_mod
id|HZ
)paren
op_star
l_int|1000
op_div
id|HZ
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot; %u.%03u&quot;
comma
id|sec
comma
id|msec
)paren
suffix:semicolon
)brace
multiline_comment|/* newline and ra-cache */
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;&bslash;nra %u&quot;
comma
id|nfsdstats.ra_size
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|11
suffix:semicolon
id|i
op_increment
)paren
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot; %u&quot;
comma
id|nfsdstats.ra_depth
(braket
id|i
)braket
)paren
suffix:semicolon
id|seq_putc
c_func
(paren
id|seq
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
multiline_comment|/* show my rpc info */
id|svc_seq_show
c_func
(paren
id|seq
comma
op_amp
id|nfsd_svcstats
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|nfsd_proc_open
r_static
r_int
id|nfsd_proc_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
id|single_open
c_func
(paren
id|file
comma
id|nfsd_proc_show
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|nfsd_proc_fops
r_static
r_struct
id|file_operations
id|nfsd_proc_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|nfsd_proc_open
comma
dot
id|read
op_assign
id|seq_read
comma
dot
id|llseek
op_assign
id|seq_lseek
comma
dot
id|release
op_assign
id|single_release
comma
)brace
suffix:semicolon
r_void
DECL|function|nfsd_stat_init
id|nfsd_stat_init
c_func
(paren
r_void
)paren
(brace
id|svc_proc_register
c_func
(paren
op_amp
id|nfsd_svcstats
comma
op_amp
id|nfsd_proc_fops
)paren
suffix:semicolon
)brace
r_void
DECL|function|nfsd_stat_shutdown
id|nfsd_stat_shutdown
c_func
(paren
r_void
)paren
(brace
id|svc_proc_unregister
c_func
(paren
l_string|&quot;nfsd&quot;
)paren
suffix:semicolon
)brace
eof
