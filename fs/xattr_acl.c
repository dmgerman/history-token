multiline_comment|/*&n; * linux/fs/xattr_acl.c&n; *&n; * Almost all from linux/fs/ext2/acl.c:&n; * Copyright (C) 2001 by Andreas Gruenbacher, &lt;a.gruenbacher@computer.org&gt;&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/posix_acl_xattr.h&gt;
multiline_comment|/*&n; * Convert from extended attribute to in-memory representation.&n; */
r_struct
id|posix_acl
op_star
DECL|function|posix_acl_from_xattr
id|posix_acl_from_xattr
c_func
(paren
r_const
r_void
op_star
id|value
comma
r_int
id|size
)paren
(brace
id|posix_acl_xattr_header
op_star
id|header
op_assign
(paren
id|posix_acl_xattr_header
op_star
)paren
id|value
suffix:semicolon
id|posix_acl_xattr_entry
op_star
id|entry
op_assign
(paren
id|posix_acl_xattr_entry
op_star
)paren
(paren
id|header
op_plus
l_int|1
)paren
comma
op_star
id|end
suffix:semicolon
r_int
id|count
suffix:semicolon
r_struct
id|posix_acl
op_star
id|acl
suffix:semicolon
r_struct
id|posix_acl_entry
op_star
id|acl_e
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|value
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|size
OL
r_sizeof
(paren
id|posix_acl_xattr_header
)paren
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|header-&gt;a_version
op_ne
id|cpu_to_le32
c_func
(paren
id|POSIX_ACL_XATTR_VERSION
)paren
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EOPNOTSUPP
)paren
suffix:semicolon
id|count
op_assign
id|posix_acl_xattr_count
c_func
(paren
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|0
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
r_return
l_int|NULL
suffix:semicolon
id|acl
op_assign
id|posix_acl_alloc
c_func
(paren
id|count
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acl
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
id|acl_e
op_assign
id|acl-&gt;a_entries
suffix:semicolon
r_for
c_loop
(paren
id|end
op_assign
id|entry
op_plus
id|count
suffix:semicolon
id|entry
op_ne
id|end
suffix:semicolon
id|acl_e
op_increment
comma
id|entry
op_increment
)paren
(brace
id|acl_e-&gt;e_tag
op_assign
id|le16_to_cpu
c_func
(paren
id|entry-&gt;e_tag
)paren
suffix:semicolon
id|acl_e-&gt;e_perm
op_assign
id|le16_to_cpu
c_func
(paren
id|entry-&gt;e_perm
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|acl_e-&gt;e_tag
)paren
(brace
r_case
id|ACL_USER_OBJ
suffix:colon
r_case
id|ACL_GROUP_OBJ
suffix:colon
r_case
id|ACL_MASK
suffix:colon
r_case
id|ACL_OTHER
suffix:colon
id|acl_e-&gt;e_id
op_assign
id|ACL_UNDEFINED_ID
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACL_USER
suffix:colon
r_case
id|ACL_GROUP
suffix:colon
id|acl_e-&gt;e_id
op_assign
id|le32_to_cpu
c_func
(paren
id|entry-&gt;e_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|fail
suffix:semicolon
)brace
)brace
r_return
id|acl
suffix:semicolon
id|fail
suffix:colon
id|posix_acl_release
c_func
(paren
id|acl
)paren
suffix:semicolon
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
)brace
DECL|variable|posix_acl_from_xattr
id|EXPORT_SYMBOL
(paren
id|posix_acl_from_xattr
)paren
suffix:semicolon
multiline_comment|/*&n; * Convert from in-memory to extended attribute representation.&n; */
r_int
DECL|function|posix_acl_to_xattr
id|posix_acl_to_xattr
c_func
(paren
r_const
r_struct
id|posix_acl
op_star
id|acl
comma
r_void
op_star
id|buffer
comma
r_int
id|size
)paren
(brace
id|posix_acl_xattr_header
op_star
id|ext_acl
op_assign
(paren
id|posix_acl_xattr_header
op_star
)paren
id|buffer
suffix:semicolon
id|posix_acl_xattr_entry
op_star
id|ext_entry
op_assign
id|ext_acl-&gt;a_entries
suffix:semicolon
r_int
id|real_size
comma
id|n
suffix:semicolon
id|real_size
op_assign
id|posix_acl_xattr_size
c_func
(paren
id|acl-&gt;a_count
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
r_return
id|real_size
suffix:semicolon
r_if
c_cond
(paren
id|real_size
OG
id|size
)paren
r_return
op_minus
id|ERANGE
suffix:semicolon
id|ext_acl-&gt;a_version
op_assign
id|cpu_to_le32
c_func
(paren
id|POSIX_ACL_XATTR_VERSION
)paren
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|acl-&gt;a_count
suffix:semicolon
id|n
op_increment
comma
id|ext_entry
op_increment
)paren
(brace
id|ext_entry-&gt;e_tag
op_assign
id|cpu_to_le16
c_func
(paren
id|acl-&gt;a_entries
(braket
id|n
)braket
dot
id|e_tag
)paren
suffix:semicolon
id|ext_entry-&gt;e_perm
op_assign
id|cpu_to_le16
c_func
(paren
id|acl-&gt;a_entries
(braket
id|n
)braket
dot
id|e_perm
)paren
suffix:semicolon
id|ext_entry-&gt;e_id
op_assign
id|cpu_to_le32
c_func
(paren
id|acl-&gt;a_entries
(braket
id|n
)braket
dot
id|e_id
)paren
suffix:semicolon
)brace
r_return
id|real_size
suffix:semicolon
)brace
DECL|variable|posix_acl_to_xattr
id|EXPORT_SYMBOL
(paren
id|posix_acl_to_xattr
)paren
suffix:semicolon
eof
