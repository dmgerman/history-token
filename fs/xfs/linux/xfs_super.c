multiline_comment|/*&n; * Copyright (c) 2000-2002 Silicon Graphics, Inc.  All Rights Reserved.&n; *&n; * This program is free software; you can redistribute it and/or modify it&n; * under the terms of version 2 of the GNU General Public License as&n; * published by the Free Software Foundation.&n; *&n; * This program is distributed in the hope that it would be useful, but&n; * WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&n; *&n; * Further, this software is distributed without any warranty that it is&n; * free of the rightful claim of any third person regarding infringement&n; * or the like.&t; Any license provided herein, whether implied or&n; * otherwise, applies only to this software file.  Patent licenses, if&n; * any, provided herein do not apply to combinations of this program with&n; * other software, or any other product whatsoever.&n; *&n; * You should have received a copy of the GNU General Public License along&n; * with this program; if not, write the Free Software Foundation, Inc., 59&n; * Temple Place - Suite 330, Boston MA 02111-1307, USA.&n; *&n; * Contact information: Silicon Graphics, Inc., 1600 Amphitheatre Pkwy,&n; * Mountain View, CA  94043, or:&n; *&n; * http://www.sgi.com&n; *&n; * For further information regarding this notice, see:&n; *&n; * http://oss.sgi.com/projects/GenInfo/SGIGPLNoticeExplan/&n; */
macro_line|#include &lt;xfs.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;linux/blkdev.h&gt;
macro_line|#include &lt;linux/namei.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &quot;xfs_version.h&quot;
multiline_comment|/* xfs_vfs[ops].c */
r_extern
r_int
id|xfs_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|xfs_cleanup
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/* For kernels which have the s_maxbytes field - set it */
macro_line|#ifdef MAX_NON_LFS
DECL|macro|set_max_bytes
macro_line|# define set_max_bytes(sb)&t;((sb)-&gt;s_maxbytes = XFS_MAX_FILE_OFFSET)
macro_line|#else
DECL|macro|set_max_bytes
macro_line|# define set_max_bytes(sb)&t;do { } while (0)
macro_line|#endif
macro_line|#ifdef CONFIG_FS_POSIX_ACL
DECL|macro|set_posix_acl
macro_line|# define set_posix_acl(sb)&t;((sb)-&gt;s_flags |= MS_POSIXACL)
macro_line|#else
DECL|macro|set_posix_acl
macro_line|# define set_posix_acl(sb)&t;do { } while (0)
macro_line|#endif
macro_line|#ifdef CONFIG_XFS_QUOTA
DECL|variable|linvfs_qops
r_static
r_struct
id|quotactl_ops
id|linvfs_qops
op_assign
(brace
dot
id|get_xstate
op_assign
id|linvfs_getxstate
comma
dot
id|set_xstate
op_assign
id|linvfs_setxstate
comma
dot
id|get_xquota
op_assign
id|linvfs_getxquota
comma
dot
id|set_xquota
op_assign
id|linvfs_setxquota
comma
)brace
suffix:semicolon
DECL|macro|set_quota_ops
macro_line|# define set_quota_ops(sb)&t;((sb)-&gt;s_qcop = &amp;linvfs_qops)
macro_line|#else
DECL|macro|set_quota_ops
macro_line|# define set_quota_ops(sb)&t;do { } while (0)
macro_line|#endif
macro_line|#ifdef CONFIG_XFS_DMAPI
r_int
id|dmapi_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|dmapi_uninit
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#else
DECL|macro|dmapi_init
mdefine_line|#define dmapi_init()
DECL|macro|dmapi_uninit
mdefine_line|#define dmapi_uninit()
macro_line|#endif
DECL|variable|linvfs_sops
r_static
r_struct
id|super_operations
id|linvfs_sops
suffix:semicolon
DECL|variable|linvfs_export_ops
r_static
r_struct
id|export_operations
id|linvfs_export_ops
suffix:semicolon
DECL|macro|MNTOPT_LOGBUFS
mdefine_line|#define MNTOPT_LOGBUFS&t;&quot;logbufs&quot;&t;/* number of XFS log buffers */
DECL|macro|MNTOPT_LOGBSIZE
mdefine_line|#define MNTOPT_LOGBSIZE &quot;logbsize&quot;&t;/* size of XFS log buffers */
DECL|macro|MNTOPT_LOGDEV
mdefine_line|#define MNTOPT_LOGDEV&t;&quot;logdev&quot;&t;/* log device */
DECL|macro|MNTOPT_RTDEV
mdefine_line|#define MNTOPT_RTDEV&t;&quot;rtdev&quot;&t;&t;/* realtime I/O device */
DECL|macro|MNTOPT_DMAPI
mdefine_line|#define MNTOPT_DMAPI&t;&quot;dmapi&quot;&t;&t;/* DMI enabled (DMAPI / XDSM) */
DECL|macro|MNTOPT_XDSM
mdefine_line|#define MNTOPT_XDSM&t;&quot;xdsm&quot;&t;&t;/* DMI enabled (DMAPI / XDSM) */
DECL|macro|MNTOPT_BIOSIZE
mdefine_line|#define MNTOPT_BIOSIZE&t;&quot;biosize&quot;&t;/* log2 of preferred buffered io size */
DECL|macro|MNTOPT_WSYNC
mdefine_line|#define MNTOPT_WSYNC&t;&quot;wsync&quot;&t;&t;/* safe-mode nfs compatible mount */
DECL|macro|MNTOPT_INO64
mdefine_line|#define MNTOPT_INO64&t;&quot;ino64&quot;&t;&t;/* force inodes into 64-bit range */
DECL|macro|MNTOPT_NOALIGN
mdefine_line|#define MNTOPT_NOALIGN&t;&quot;noalign&quot;&t;/* turn off stripe alignment */
DECL|macro|MNTOPT_SUNIT
mdefine_line|#define MNTOPT_SUNIT&t;&quot;sunit&quot;&t;&t;/* data volume stripe unit */
DECL|macro|MNTOPT_SWIDTH
mdefine_line|#define MNTOPT_SWIDTH&t;&quot;swidth&quot;&t;/* data volume stripe width */
DECL|macro|MNTOPT_NORECOVERY
mdefine_line|#define MNTOPT_NORECOVERY &quot;norecovery&quot;&t;/* don&squot;t run XFS recovery */
DECL|macro|MNTOPT_OSYNCISDSYNC
mdefine_line|#define MNTOPT_OSYNCISDSYNC &quot;osyncisdsync&quot; /* o_sync == o_dsync on this fs */
multiline_comment|/* (this is now the default!) */
DECL|macro|MNTOPT_OSYNCISOSYNC
mdefine_line|#define MNTOPT_OSYNCISOSYNC &quot;osyncisosync&quot; /* o_sync is REALLY o_sync */
DECL|macro|MNTOPT_QUOTA
mdefine_line|#define MNTOPT_QUOTA&t;&quot;quota&quot;&t;&t;/* disk quotas */
DECL|macro|MNTOPT_MRQUOTA
mdefine_line|#define MNTOPT_MRQUOTA&t;&quot;mrquota&quot;&t;/* don&squot;t turnoff if SB has quotas on */
DECL|macro|MNTOPT_NOQUOTA
mdefine_line|#define MNTOPT_NOQUOTA&t;&quot;noquota&quot;&t;/* no quotas */
DECL|macro|MNTOPT_UQUOTA
mdefine_line|#define MNTOPT_UQUOTA&t;&quot;usrquota&quot;&t;/* user quota enabled */
DECL|macro|MNTOPT_GQUOTA
mdefine_line|#define MNTOPT_GQUOTA&t;&quot;grpquota&quot;&t;/* group quota enabled */
DECL|macro|MNTOPT_UQUOTANOENF
mdefine_line|#define MNTOPT_UQUOTANOENF &quot;uqnoenforce&quot;/* user quota limit enforcement */
DECL|macro|MNTOPT_GQUOTANOENF
mdefine_line|#define MNTOPT_GQUOTANOENF &quot;gqnoenforce&quot;/* group quota limit enforcement */
DECL|macro|MNTOPT_QUOTANOENF
mdefine_line|#define MNTOPT_QUOTANOENF  &quot;qnoenforce&quot; /* same as uqnoenforce */
DECL|macro|MNTOPT_NOUUID
mdefine_line|#define MNTOPT_NOUUID&t;&quot;nouuid&quot;&t;/* Ignore FS uuid */
DECL|macro|MNTOPT_IRIXSGID
mdefine_line|#define MNTOPT_IRIXSGID &quot;irixsgid&quot;&t;/* Irix-style sgid inheritance */
DECL|macro|MNTOPT_NOLOGFLUSH
mdefine_line|#define MNTOPT_NOLOGFLUSH  &quot;nologflush&quot;&t;/* Don&squot;t use hard flushes in&n;&t;&t;&t;&t;&t;   log writing */
DECL|macro|MNTOPT_MTPT
mdefine_line|#define MNTOPT_MTPT&t;&quot;mtpt&quot;&t;&t;/* filesystem mount point */
id|STATIC
r_int
DECL|function|xfs_parseargs
id|xfs_parseargs
c_func
(paren
r_char
op_star
id|options
comma
r_int
id|flags
comma
r_struct
id|xfs_mount_args
op_star
id|args
)paren
(brace
r_char
op_star
id|this_char
comma
op_star
id|value
comma
op_star
id|eov
suffix:semicolon
r_int
id|logbufs
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
id|logbufsize
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
id|dsunit
comma
id|dswidth
comma
id|vol_dsunit
comma
id|vol_dswidth
suffix:semicolon
r_int
id|iosize
suffix:semicolon
r_int
id|rval
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* failure is default */
id|iosize
op_assign
id|dsunit
op_assign
id|dswidth
op_assign
id|vol_dsunit
op_assign
id|vol_dswidth
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|args
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|xfs_mount_args
)paren
)paren
suffix:semicolon
id|args-&gt;slcount
op_assign
id|args-&gt;stimeout
op_assign
id|args-&gt;ctimeout
op_assign
op_minus
l_int|1
suffix:semicolon
id|args-&gt;mtpt
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
multiline_comment|/* Copy the already-parsed mount(2) flags we&squot;re interested in */
r_if
c_cond
(paren
id|flags
op_amp
id|MS_NOATIME
)paren
id|args-&gt;flags
op_or_assign
id|XFSMNT_NOATIME
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
)paren
(brace
id|args-&gt;logbufs
op_assign
id|logbufs
suffix:semicolon
id|args-&gt;logbufsize
op_assign
id|logbufsize
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|this_char
op_assign
id|strsep
(paren
op_amp
id|options
comma
l_string|&quot;,&quot;
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
op_star
id|this_char
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|value
op_assign
id|strchr
(paren
id|this_char
comma
l_char|&squot;=&squot;
)paren
)paren
op_ne
l_int|NULL
)paren
op_star
id|value
op_increment
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_LOGBUFS
)paren
)paren
(brace
id|logbufs
op_assign
id|simple_strtoul
c_func
(paren
id|value
comma
op_amp
id|eov
comma
l_int|10
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_LOGBSIZE
)paren
)paren
(brace
r_int
id|in_kilobytes
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|toupper
c_func
(paren
id|value
(braket
id|strlen
c_func
(paren
id|value
)paren
op_minus
l_int|1
)braket
)paren
op_eq
l_char|&squot;K&squot;
)paren
(brace
id|in_kilobytes
op_assign
l_int|1
suffix:semicolon
id|value
(braket
id|strlen
c_func
(paren
id|value
)paren
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
id|logbufsize
op_assign
id|simple_strtoul
c_func
(paren
id|value
comma
op_amp
id|eov
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_kilobytes
)paren
id|logbufsize
op_assign
id|logbufsize
op_star
l_int|1024
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_LOGDEV
)paren
)paren
(brace
id|strncpy
c_func
(paren
id|args-&gt;logname
comma
id|value
comma
id|MAXNAMELEN
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_MTPT
)paren
)paren
(brace
id|strncpy
c_func
(paren
id|args-&gt;mtpt
comma
id|value
comma
id|MAXNAMELEN
)paren
suffix:semicolon
macro_line|#if CONFIG_XFS_DMAPI
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_DMAPI
)paren
)paren
(brace
id|args-&gt;flags
op_or_assign
id|XFSMNT_DMAPI
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_XDSM
)paren
)paren
(brace
id|args-&gt;flags
op_or_assign
id|XFSMNT_DMAPI
suffix:semicolon
macro_line|#else
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_DMAPI
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_XDSM
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;XFS: this kernel does not support dmapi/xdsm.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|rval
suffix:semicolon
macro_line|#endif
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_RTDEV
)paren
)paren
(brace
id|strncpy
c_func
(paren
id|args-&gt;rtname
comma
id|value
comma
id|MAXNAMELEN
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_BIOSIZE
)paren
)paren
(brace
id|iosize
op_assign
id|simple_strtoul
c_func
(paren
id|value
comma
op_amp
id|eov
comma
l_int|10
)paren
suffix:semicolon
id|args-&gt;flags
op_or_assign
id|XFSMNT_IOSIZE
suffix:semicolon
id|args-&gt;iosizelog
op_assign
(paren
r_uint8
)paren
id|iosize
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_WSYNC
)paren
)paren
(brace
id|args-&gt;flags
op_or_assign
id|XFSMNT_WSYNC
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_OSYNCISDSYNC
)paren
)paren
(brace
multiline_comment|/* no-op, this is now the default */
id|printk
c_func
(paren
l_string|&quot;XFS: osyncisdsync is now the default, and will soon be deprecated.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_OSYNCISOSYNC
)paren
)paren
(brace
id|args-&gt;flags
op_or_assign
id|XFSMNT_OSYNCISOSYNC
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_NORECOVERY
)paren
)paren
(brace
id|args-&gt;flags
op_or_assign
id|XFSMNT_NORECOVERY
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_INO64
)paren
)paren
(brace
macro_line|#ifdef XFS_BIG_FILESYSTEMS
id|args-&gt;flags
op_or_assign
id|XFSMNT_INO64
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
l_string|&quot;XFS: ino64 option not allowed on this system&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|rval
suffix:semicolon
macro_line|#endif
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_UQUOTA
)paren
)paren
(brace
id|args-&gt;flags
op_or_assign
id|XFSMNT_UQUOTA
op_or
id|XFSMNT_UQUOTAENF
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_QUOTA
)paren
)paren
(brace
id|args-&gt;flags
op_or_assign
id|XFSMNT_UQUOTA
op_or
id|XFSMNT_UQUOTAENF
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_UQUOTANOENF
)paren
)paren
(brace
id|args-&gt;flags
op_or_assign
id|XFSMNT_UQUOTA
suffix:semicolon
id|args-&gt;flags
op_and_assign
op_complement
id|XFSMNT_UQUOTAENF
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_QUOTANOENF
)paren
)paren
(brace
id|args-&gt;flags
op_or_assign
id|XFSMNT_UQUOTA
suffix:semicolon
id|args-&gt;flags
op_and_assign
op_complement
id|XFSMNT_UQUOTAENF
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_GQUOTA
)paren
)paren
(brace
id|args-&gt;flags
op_or_assign
id|XFSMNT_GQUOTA
op_or
id|XFSMNT_GQUOTAENF
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_GQUOTANOENF
)paren
)paren
(brace
id|args-&gt;flags
op_or_assign
id|XFSMNT_GQUOTA
suffix:semicolon
id|args-&gt;flags
op_and_assign
op_complement
id|XFSMNT_GQUOTAENF
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_NOALIGN
)paren
)paren
(brace
id|args-&gt;flags
op_or_assign
id|XFSMNT_NOALIGN
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_SUNIT
)paren
)paren
(brace
id|dsunit
op_assign
id|simple_strtoul
c_func
(paren
id|value
comma
op_amp
id|eov
comma
l_int|10
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_SWIDTH
)paren
)paren
(brace
id|dswidth
op_assign
id|simple_strtoul
c_func
(paren
id|value
comma
op_amp
id|eov
comma
l_int|10
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_NOUUID
)paren
)paren
(brace
id|args-&gt;flags
op_or_assign
id|XFSMNT_NOUUID
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_IRIXSGID
)paren
)paren
(brace
id|args-&gt;flags
op_or_assign
id|XFSMNT_IRIXSGID
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|this_char
comma
id|MNTOPT_NOLOGFLUSH
)paren
)paren
(brace
id|args-&gt;flags
op_or_assign
id|XFSMNT_NOLOGFLUSH
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;XFS: unknown mount option [%s].&bslash;n&quot;
comma
id|this_char
)paren
suffix:semicolon
r_return
id|rval
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|args-&gt;flags
op_amp
id|XFSMNT_NORECOVERY
)paren
(brace
r_if
c_cond
(paren
(paren
id|flags
op_amp
id|MS_RDONLY
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;XFS: no-recovery mounts must be read-only.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|rval
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|args-&gt;flags
op_amp
id|XFSMNT_NOALIGN
)paren
op_logical_and
(paren
id|dsunit
op_logical_or
id|dswidth
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;XFS: sunit and swidth options incompatible with the noalign option&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|rval
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dsunit
op_logical_and
op_logical_neg
id|dswidth
)paren
op_logical_or
(paren
op_logical_neg
id|dsunit
op_logical_and
id|dswidth
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;XFS: sunit and swidth must be specified together&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|rval
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dsunit
op_logical_and
(paren
id|dswidth
op_mod
id|dsunit
op_ne
l_int|0
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;XFS: stripe width (%d) must be a multiple of the stripe unit (%d)&bslash;n&quot;
comma
id|dswidth
comma
id|dsunit
)paren
suffix:semicolon
r_return
id|rval
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|args-&gt;flags
op_amp
id|XFSMNT_NOALIGN
)paren
op_ne
id|XFSMNT_NOALIGN
)paren
(brace
r_if
c_cond
(paren
id|dsunit
)paren
(brace
id|args-&gt;sunit
op_assign
id|dsunit
suffix:semicolon
id|args-&gt;flags
op_or_assign
id|XFSMNT_RETERR
suffix:semicolon
)brace
r_else
id|args-&gt;sunit
op_assign
id|vol_dsunit
suffix:semicolon
id|dswidth
ques
c_cond
(paren
id|args-&gt;swidth
op_assign
id|dswidth
)paren
suffix:colon
(paren
id|args-&gt;swidth
op_assign
id|vol_dswidth
)paren
suffix:semicolon
)brace
r_else
id|args-&gt;sunit
op_assign
id|args-&gt;swidth
op_assign
l_int|0
suffix:semicolon
id|args-&gt;logbufs
op_assign
id|logbufs
suffix:semicolon
id|args-&gt;logbufsize
op_assign
id|logbufsize
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Convert one device special file to a dev_t.&n; * Helper routine, used only by spectodevs below.&n; */
id|STATIC
r_int
DECL|function|spectodev
id|spectodev
c_func
(paren
r_const
r_char
op_star
id|name
comma
r_const
r_char
op_star
id|id
comma
id|dev_t
op_star
id|dev
)paren
(brace
r_struct
id|nameidata
id|nd
suffix:semicolon
r_int
id|error
suffix:semicolon
id|error
op_assign
id|path_lookup
c_func
(paren
id|name
comma
id|LOOKUP_FOLLOW
comma
op_amp
id|nd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
op_star
id|dev
op_assign
id|kdev_t_to_nr
c_func
(paren
id|nd.dentry-&gt;d_inode-&gt;i_rdev
)paren
suffix:semicolon
id|path_release
c_func
(paren
op_amp
id|nd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Convert device special files to dev_t for data, log, realtime.&n; */
r_int
DECL|function|spectodevs
id|spectodevs
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|xfs_mount_args
op_star
id|args
comma
id|dev_t
op_star
id|ddevp
comma
id|dev_t
op_star
id|logdevp
comma
id|dev_t
op_star
id|rtdevp
)paren
(brace
r_int
id|rval
op_assign
l_int|0
suffix:semicolon
op_star
id|ddevp
op_assign
id|sb-&gt;s_dev
suffix:semicolon
r_if
c_cond
(paren
id|args-&gt;logname
(braket
l_int|0
)braket
)paren
id|rval
op_assign
id|spectodev
c_func
(paren
id|args-&gt;logname
comma
l_string|&quot;log&quot;
comma
id|logdevp
)paren
suffix:semicolon
r_else
op_star
id|logdevp
op_assign
id|sb-&gt;s_dev
suffix:semicolon
r_if
c_cond
(paren
id|args-&gt;rtname
(braket
l_int|0
)braket
op_logical_and
op_logical_neg
id|rval
)paren
id|rval
op_assign
id|spectodev
c_func
(paren
id|args-&gt;rtname
comma
l_string|&quot;realtime&quot;
comma
id|rtdevp
)paren
suffix:semicolon
r_else
op_star
id|rtdevp
op_assign
l_int|0
suffix:semicolon
r_return
id|rval
suffix:semicolon
)brace
DECL|variable|linvfs_inode_cachep
r_static
id|kmem_cache_t
op_star
id|linvfs_inode_cachep
suffix:semicolon
DECL|function|gfp_mask
r_static
id|__inline__
r_int
r_int
id|gfp_mask
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* If we&squot;re not in a transaction, FS activity is ok */
r_if
c_cond
(paren
id|current-&gt;flags
op_amp
id|PF_FSTRANS
)paren
r_return
id|GFP_NOFS
suffix:semicolon
r_return
id|GFP_KERNEL
suffix:semicolon
)brace
DECL|function|linvfs_alloc_inode
r_static
r_struct
id|inode
op_star
id|linvfs_alloc_inode
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
id|vnode_t
op_star
id|vp
suffix:semicolon
id|vp
op_assign
(paren
id|vnode_t
op_star
)paren
id|kmem_cache_alloc
c_func
(paren
id|linvfs_inode_cachep
comma
id|gfp_mask
c_func
(paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vp
)paren
r_return
l_int|NULL
suffix:semicolon
r_return
id|LINVFS_GET_IP
c_func
(paren
id|vp
)paren
suffix:semicolon
)brace
DECL|function|linvfs_destroy_inode
r_static
r_void
id|linvfs_destroy_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
id|kmem_cache_free
c_func
(paren
id|linvfs_inode_cachep
comma
id|LINVFS_GET_VP
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
)brace
DECL|function|init_once
r_static
r_void
id|init_once
c_func
(paren
r_void
op_star
id|foo
comma
id|kmem_cache_t
op_star
id|cachep
comma
r_int
r_int
id|flags
)paren
(brace
id|vnode_t
op_star
id|vp
op_assign
(paren
id|vnode_t
op_star
)paren
id|foo
suffix:semicolon
r_if
c_cond
(paren
(paren
id|flags
op_amp
(paren
id|SLAB_CTOR_VERIFY
op_or
id|SLAB_CTOR_CONSTRUCTOR
)paren
)paren
op_eq
id|SLAB_CTOR_CONSTRUCTOR
)paren
id|inode_init_once
c_func
(paren
id|LINVFS_GET_IP
c_func
(paren
id|vp
)paren
)paren
suffix:semicolon
)brace
DECL|function|init_inodecache
r_static
r_int
id|init_inodecache
c_func
(paren
r_void
)paren
(brace
id|linvfs_inode_cachep
op_assign
id|kmem_cache_create
c_func
(paren
l_string|&quot;linvfs_icache&quot;
comma
r_sizeof
(paren
id|vnode_t
)paren
comma
l_int|0
comma
id|SLAB_HWCACHE_ALIGN
comma
id|init_once
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|linvfs_inode_cachep
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|destroy_inodecache
r_static
r_void
id|destroy_inodecache
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|kmem_cache_destroy
c_func
(paren
id|linvfs_inode_cachep
)paren
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;linvfs_inode_cache: not all structures were freed&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|linvfs_fill_super
id|linvfs_fill_super
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_void
op_star
id|data
comma
r_int
id|silent
)paren
(brace
id|vfs_t
op_star
id|vfsp
suffix:semicolon
id|vfsops_t
op_star
id|vfsops
suffix:semicolon
id|vnode_t
op_star
id|rootvp
suffix:semicolon
r_struct
id|inode
op_star
id|ip
suffix:semicolon
r_struct
id|xfs_mount_args
op_star
id|args
suffix:semicolon
r_struct
id|statfs
id|statvfs
suffix:semicolon
r_int
id|error
op_assign
id|EINVAL
suffix:semicolon
id|args
op_assign
(paren
r_struct
id|xfs_mount_args
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|xfs_mount_args
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|args
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|strncpy
c_func
(paren
id|args-&gt;fsname
comma
id|sb-&gt;s_id
comma
id|MAXNAMELEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xfs_parseargs
c_func
(paren
(paren
r_char
op_star
)paren
id|data
comma
id|sb-&gt;s_flags
comma
id|args
)paren
)paren
(brace
r_goto
id|out_null
suffix:semicolon
)brace
id|strncpy
c_func
(paren
id|args-&gt;fsname
comma
id|bdevname
c_func
(paren
id|sb-&gt;s_bdev
)paren
comma
id|MAXNAMELEN
)paren
suffix:semicolon
multiline_comment|/* args-&gt;rtdev and args-&gt;logdev done in xfs_parseargs */
multiline_comment|/*  Kludge in XFS until we have other VFS/VNODE FSs  */
id|vfsops
op_assign
op_amp
id|xfs_vfsops
suffix:semicolon
multiline_comment|/*  Set up the vfs_t structure&t;*/
id|vfsp
op_assign
id|vfs_allocate
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vfsp
)paren
(brace
id|error
op_assign
id|ENOMEM
suffix:semicolon
r_goto
id|out_null
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sb-&gt;s_flags
op_amp
id|MS_RDONLY
)paren
id|vfsp-&gt;vfs_flag
op_or_assign
id|VFS_RDONLY
suffix:semicolon
id|vfsp-&gt;vfs_super
op_assign
id|sb
suffix:semicolon
id|set_blocksize
c_func
(paren
id|sb-&gt;s_bdev
comma
id|BBSIZE
)paren
suffix:semicolon
id|set_max_bytes
c_func
(paren
id|sb
)paren
suffix:semicolon
id|set_quota_ops
c_func
(paren
id|sb
)paren
suffix:semicolon
id|sb-&gt;s_op
op_assign
op_amp
id|linvfs_sops
suffix:semicolon
id|sb-&gt;s_export_op
op_assign
op_amp
id|linvfs_export_ops
suffix:semicolon
id|LINVFS_SET_VFS
c_func
(paren
id|sb
comma
id|vfsp
)paren
suffix:semicolon
id|VFSOPS_MOUNT
c_func
(paren
id|vfsops
comma
id|vfsp
comma
id|args
comma
l_int|NULL
comma
id|error
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|fail_vfsop
suffix:semicolon
id|VFS_STATVFS
c_func
(paren
id|vfsp
comma
op_amp
id|statvfs
comma
l_int|NULL
comma
id|error
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|fail_unmount
suffix:semicolon
id|sb-&gt;s_magic
op_assign
id|XFS_SB_MAGIC
suffix:semicolon
id|sb-&gt;s_dirt
op_assign
l_int|1
suffix:semicolon
id|sb-&gt;s_blocksize
op_assign
id|statvfs.f_bsize
suffix:semicolon
id|sb-&gt;s_blocksize_bits
op_assign
id|ffs
c_func
(paren
id|statvfs.f_bsize
)paren
op_minus
l_int|1
suffix:semicolon
id|VFS_ROOT
c_func
(paren
id|vfsp
comma
op_amp
id|rootvp
comma
id|error
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|fail_unmount
suffix:semicolon
id|ip
op_assign
id|LINVFS_GET_IP
c_func
(paren
id|rootvp
)paren
suffix:semicolon
id|linvfs_revalidate_core
c_func
(paren
id|ip
comma
id|ATTR_COMM
)paren
suffix:semicolon
id|sb-&gt;s_root
op_assign
id|d_alloc_root
c_func
(paren
id|ip
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sb-&gt;s_root
)paren
r_goto
id|fail_vnrele
suffix:semicolon
r_if
c_cond
(paren
id|is_bad_inode
c_func
(paren
id|sb-&gt;s_root-&gt;d_inode
)paren
)paren
r_goto
id|fail_vnrele
suffix:semicolon
multiline_comment|/* Don&squot;t set the VFS_DMI flag until here because we don&squot;t want&n;&t; * to send events while replaying the log.&n;&t; */
r_if
c_cond
(paren
id|args-&gt;flags
op_amp
id|XFSMNT_DMAPI
)paren
(brace
id|vfsp-&gt;vfs_flag
op_or_assign
id|VFS_DMI
suffix:semicolon
id|VFSOPS_DMAPI_MOUNT
c_func
(paren
id|vfsops
comma
id|vfsp
comma
id|args-&gt;mtpt
comma
id|args-&gt;fsname
comma
id|error
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|sb-&gt;s_active
)paren
op_eq
l_int|1
)paren
id|vfsp-&gt;vfs_flag
op_and_assign
op_complement
id|VFS_DMI
suffix:semicolon
r_goto
id|fail_vnrele
suffix:semicolon
)brace
)brace
id|set_posix_acl
c_func
(paren
id|sb
)paren
suffix:semicolon
id|vn_trace_exit
c_func
(paren
id|rootvp
comma
l_string|&quot;linvfs_read_super&quot;
comma
(paren
id|inst_t
op_star
)paren
id|__return_address
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|args
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|fail_vnrele
suffix:colon
r_if
c_cond
(paren
id|sb-&gt;s_root
)paren
(brace
id|dput
c_func
(paren
id|sb-&gt;s_root
)paren
suffix:semicolon
id|sb-&gt;s_root
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|VN_RELE
c_func
(paren
id|rootvp
)paren
suffix:semicolon
)brace
id|fail_unmount
suffix:colon
id|VFS_UNMOUNT
c_func
(paren
id|vfsp
comma
l_int|0
comma
l_int|NULL
comma
id|error
)paren
suffix:semicolon
id|fail_vfsop
suffix:colon
id|vfs_deallocate
c_func
(paren
id|vfsp
)paren
suffix:semicolon
id|out_null
suffix:colon
id|kfree
c_func
(paren
id|args
)paren
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
r_void
DECL|function|linvfs_set_inode_ops
id|linvfs_set_inode_ops
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
id|vnode_t
op_star
id|vp
op_assign
id|LINVFS_GET_VP
c_func
(paren
id|inode
)paren
suffix:semicolon
id|inode-&gt;i_mode
op_assign
id|VTTOIF
c_func
(paren
id|vp-&gt;v_type
)paren
suffix:semicolon
multiline_comment|/* If this isn&squot;t a new inode, nothing to do */
r_if
c_cond
(paren
op_logical_neg
(paren
id|inode-&gt;i_state
op_amp
id|I_NEW
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;v_type
op_eq
id|VNON
)paren
(brace
id|make_bad_inode
c_func
(paren
id|inode
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|S_ISREG
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
(brace
id|inode-&gt;i_op
op_assign
op_amp
id|linvfs_file_inode_operations
suffix:semicolon
id|inode-&gt;i_fop
op_assign
op_amp
id|linvfs_file_operations
suffix:semicolon
id|inode-&gt;i_mapping-&gt;a_ops
op_assign
op_amp
id|linvfs_aops
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|S_ISDIR
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
(brace
id|inode-&gt;i_op
op_assign
op_amp
id|linvfs_dir_inode_operations
suffix:semicolon
id|inode-&gt;i_fop
op_assign
op_amp
id|linvfs_dir_operations
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|S_ISLNK
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
(brace
id|inode-&gt;i_op
op_assign
op_amp
id|linvfs_symlink_inode_operations
suffix:semicolon
r_if
c_cond
(paren
id|inode-&gt;i_blocks
)paren
id|inode-&gt;i_mapping-&gt;a_ops
op_assign
op_amp
id|linvfs_aops
suffix:semicolon
)brace
r_else
(brace
id|inode-&gt;i_op
op_assign
op_amp
id|linvfs_file_inode_operations
suffix:semicolon
id|init_special_inode
c_func
(paren
id|inode
comma
id|inode-&gt;i_mode
comma
id|kdev_t_to_nr
c_func
(paren
id|inode-&gt;i_rdev
)paren
)paren
suffix:semicolon
)brace
id|unlock_new_inode
c_func
(paren
id|inode
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * We do not actually write the inode here, just mark the&n; * super block dirty so that sync_supers calls us and&n; * forces the flush.&n; */
r_void
DECL|function|linvfs_write_inode
id|linvfs_write_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|sync
)paren
(brace
id|vnode_t
op_star
id|vp
op_assign
id|LINVFS_GET_VP
c_func
(paren
id|inode
)paren
suffix:semicolon
r_int
id|error
comma
id|flags
op_assign
id|FLUSH_INODE
suffix:semicolon
r_if
c_cond
(paren
id|vp
)paren
(brace
id|vn_trace_entry
c_func
(paren
id|vp
comma
l_string|&quot;linvfs_write_inode&quot;
comma
(paren
id|inst_t
op_star
)paren
id|__return_address
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sync
)paren
id|flags
op_or_assign
id|FLUSH_SYNC
suffix:semicolon
id|VOP_IFLUSH
c_func
(paren
id|vp
comma
id|flags
comma
id|error
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_eq
id|EAGAIN
)paren
id|inode-&gt;i_sb-&gt;s_dirt
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_void
DECL|function|linvfs_clear_inode
id|linvfs_clear_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
id|vnode_t
op_star
id|vp
op_assign
id|LINVFS_GET_VP
c_func
(paren
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp
)paren
(brace
id|vn_rele
c_func
(paren
id|vp
)paren
suffix:semicolon
id|vn_trace_entry
c_func
(paren
id|vp
comma
l_string|&quot;linvfs_clear_inode&quot;
comma
(paren
id|inst_t
op_star
)paren
id|__return_address
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Do all our cleanup, and remove this vnode.&n;&t;&t; */
id|vp-&gt;v_flag
op_or_assign
id|VPURGE
suffix:semicolon
id|vn_remove
c_func
(paren
id|vp
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|linvfs_put_inode
id|linvfs_put_inode
c_func
(paren
r_struct
id|inode
op_star
id|ip
)paren
(brace
id|vnode_t
op_star
id|vp
op_assign
id|LINVFS_GET_VP
c_func
(paren
id|ip
)paren
suffix:semicolon
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
id|vp
op_logical_and
id|vp-&gt;v_fbhv
op_logical_and
(paren
id|atomic_read
c_func
(paren
op_amp
id|ip-&gt;i_count
)paren
op_eq
l_int|1
)paren
)paren
id|VOP_RELEASE
c_func
(paren
id|vp
comma
id|error
)paren
suffix:semicolon
)brace
r_void
DECL|function|linvfs_put_super
id|linvfs_put_super
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_int
id|error
suffix:semicolon
r_int
id|sector_size
suffix:semicolon
id|vfs_t
op_star
id|vfsp
op_assign
id|LINVFS_GET_VFS
c_func
(paren
id|sb
)paren
suffix:semicolon
id|VFS_DOUNMOUNT
c_func
(paren
id|vfsp
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
comma
id|error
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;XFS unmount got error %d&bslash;n&quot;
comma
id|error
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;linvfs_put_super: vfsp/0x%p left dangling!&bslash;n&quot;
comma
id|vfsp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|vfs_deallocate
c_func
(paren
id|vfsp
)paren
suffix:semicolon
multiline_comment|/* Reset device block size */
id|sector_size
op_assign
id|bdev_hardsect_size
c_func
(paren
id|sb-&gt;s_bdev
)paren
suffix:semicolon
id|set_blocksize
c_func
(paren
id|sb-&gt;s_bdev
comma
id|sector_size
)paren
suffix:semicolon
)brace
r_void
DECL|function|linvfs_write_super
id|linvfs_write_super
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
id|vfs_t
op_star
id|vfsp
op_assign
id|LINVFS_GET_VFS
c_func
(paren
id|sb
)paren
suffix:semicolon
r_int
id|error
suffix:semicolon
id|sb-&gt;s_dirt
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sb-&gt;s_flags
op_amp
id|MS_RDONLY
)paren
r_return
suffix:semicolon
id|VFS_SYNC
c_func
(paren
id|vfsp
comma
id|SYNC_FSDATA
op_or
id|SYNC_BDFLUSH
op_or
id|SYNC_ATTR
comma
l_int|NULL
comma
id|error
)paren
suffix:semicolon
)brace
r_int
DECL|function|linvfs_statfs
id|linvfs_statfs
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|statfs
op_star
id|statp
)paren
(brace
id|vfs_t
op_star
id|vfsp
op_assign
id|LINVFS_GET_VFS
c_func
(paren
id|sb
)paren
suffix:semicolon
r_int
id|error
suffix:semicolon
id|VFS_STATVFS
c_func
(paren
id|vfsp
comma
id|statp
comma
l_int|NULL
comma
id|error
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_int
DECL|function|linvfs_remount
id|linvfs_remount
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_int
op_star
id|flags
comma
r_char
op_star
id|options
)paren
(brace
r_struct
id|xfs_mount_args
op_star
id|args
suffix:semicolon
id|vfs_t
op_star
id|vfsp
suffix:semicolon
id|xfs_mount_t
op_star
id|mp
suffix:semicolon
r_int
id|error
op_assign
l_int|0
suffix:semicolon
id|args
op_assign
(paren
r_struct
id|xfs_mount_args
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|xfs_mount_args
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|args
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|vfsp
op_assign
id|LINVFS_GET_VFS
c_func
(paren
id|sb
)paren
suffix:semicolon
id|mp
op_assign
id|XFS_BHVTOM
c_func
(paren
id|vfsp-&gt;vfs_fbhv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|xfs_parseargs
c_func
(paren
id|options
comma
op_star
id|flags
comma
id|args
)paren
)paren
(brace
id|error
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|set_posix_acl
c_func
(paren
id|sb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|args-&gt;flags
op_amp
id|XFSMNT_NOATIME
)paren
id|mp-&gt;m_flags
op_or_assign
id|XFS_MOUNT_NOATIME
suffix:semicolon
r_else
id|mp-&gt;m_flags
op_and_assign
op_complement
id|XFS_MOUNT_NOATIME
suffix:semicolon
id|linvfs_write_super
c_func
(paren
id|sb
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|flags
op_amp
id|MS_RDONLY
)paren
op_eq
(paren
id|sb-&gt;s_flags
op_amp
id|MS_RDONLY
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
op_star
id|flags
op_amp
id|MS_RDONLY
)paren
(brace
id|sb-&gt;s_flags
op_or_assign
id|MS_RDONLY
suffix:semicolon
id|XFS_log_write_unmount_ro
c_func
(paren
id|vfsp-&gt;vfs_fbhv
)paren
suffix:semicolon
id|vfsp-&gt;vfs_flag
op_or_assign
id|VFS_RDONLY
suffix:semicolon
)brace
r_else
(brace
id|vfsp-&gt;vfs_flag
op_and_assign
op_complement
id|VFS_RDONLY
suffix:semicolon
)brace
id|out
suffix:colon
id|kfree
c_func
(paren
id|args
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_void
DECL|function|linvfs_freeze_fs
id|linvfs_freeze_fs
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
id|vfs_t
op_star
id|vfsp
suffix:semicolon
id|vnode_t
op_star
id|vp
suffix:semicolon
r_int
id|error
suffix:semicolon
id|vfsp
op_assign
id|LINVFS_GET_VFS
c_func
(paren
id|sb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb-&gt;s_flags
op_amp
id|MS_RDONLY
)paren
r_return
suffix:semicolon
id|VFS_ROOT
c_func
(paren
id|vfsp
comma
op_amp
id|vp
comma
id|error
)paren
suffix:semicolon
id|VOP_IOCTL
c_func
(paren
id|vp
comma
id|LINVFS_GET_IP
c_func
(paren
id|vp
)paren
comma
l_int|NULL
comma
id|XFS_IOC_FREEZE
comma
l_int|0
comma
id|error
)paren
suffix:semicolon
id|VN_RELE
c_func
(paren
id|vp
)paren
suffix:semicolon
)brace
r_void
DECL|function|linvfs_unfreeze_fs
id|linvfs_unfreeze_fs
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
id|vfs_t
op_star
id|vfsp
suffix:semicolon
id|vnode_t
op_star
id|vp
suffix:semicolon
r_int
id|error
suffix:semicolon
id|vfsp
op_assign
id|LINVFS_GET_VFS
c_func
(paren
id|sb
)paren
suffix:semicolon
id|VFS_ROOT
c_func
(paren
id|vfsp
comma
op_amp
id|vp
comma
id|error
)paren
suffix:semicolon
id|VOP_IOCTL
c_func
(paren
id|vp
comma
id|LINVFS_GET_IP
c_func
(paren
id|vp
)paren
comma
l_int|NULL
comma
id|XFS_IOC_THAW
comma
l_int|0
comma
id|error
)paren
suffix:semicolon
id|VN_RELE
c_func
(paren
id|vp
)paren
suffix:semicolon
)brace
DECL|function|linvfs_get_parent
r_struct
id|dentry
op_star
id|linvfs_get_parent
c_func
(paren
r_struct
id|dentry
op_star
id|child
)paren
(brace
r_int
id|error
suffix:semicolon
id|vnode_t
op_star
id|vp
comma
op_star
id|cvp
suffix:semicolon
r_struct
id|dentry
op_star
id|parent
suffix:semicolon
r_struct
id|inode
op_star
id|ip
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|dentry
id|dotdot
suffix:semicolon
id|dotdot.d_name.name
op_assign
l_string|&quot;..&quot;
suffix:semicolon
id|dotdot.d_name.len
op_assign
l_int|2
suffix:semicolon
id|dotdot.d_inode
op_assign
l_int|0
suffix:semicolon
id|cvp
op_assign
l_int|NULL
suffix:semicolon
id|vp
op_assign
id|LINVFS_GET_VP
c_func
(paren
id|child-&gt;d_inode
)paren
suffix:semicolon
id|VOP_LOOKUP
c_func
(paren
id|vp
comma
op_amp
id|dotdot
comma
op_amp
id|cvp
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
comma
id|error
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
(brace
id|ASSERT
c_func
(paren
id|cvp
)paren
suffix:semicolon
id|ip
op_assign
id|LINVFS_GET_IP
c_func
(paren
id|cvp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ip
)paren
(brace
id|VN_RELE
c_func
(paren
id|cvp
)paren
suffix:semicolon
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EACCES
)paren
suffix:semicolon
)brace
id|error
op_assign
op_minus
id|linvfs_revalidate_core
c_func
(paren
id|ip
comma
id|ATTR_COMM
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|error
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|error
)paren
suffix:semicolon
id|parent
op_assign
id|d_alloc_anon
c_func
(paren
id|ip
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|parent
)paren
(brace
id|VN_RELE
c_func
(paren
id|cvp
)paren
suffix:semicolon
id|parent
op_assign
id|ERR_PTR
c_func
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
)brace
r_return
id|parent
suffix:semicolon
)brace
DECL|function|linvfs_get_sb
r_static
r_struct
id|super_block
op_star
id|linvfs_get_sb
c_func
(paren
r_struct
id|file_system_type
op_star
id|fs_type
comma
r_int
id|flags
comma
r_char
op_star
id|dev_name
comma
r_void
op_star
id|data
)paren
(brace
r_return
id|get_sb_bdev
c_func
(paren
id|fs_type
comma
id|flags
comma
id|dev_name
comma
id|data
comma
id|linvfs_fill_super
)paren
suffix:semicolon
)brace
DECL|variable|linvfs_export_ops
r_static
r_struct
id|export_operations
id|linvfs_export_ops
op_assign
(brace
dot
id|get_parent
op_assign
id|linvfs_get_parent
comma
)brace
suffix:semicolon
r_int
DECL|function|linvfs_show_options
id|linvfs_show_options
c_func
(paren
r_struct
id|seq_file
op_star
id|m
comma
r_struct
id|vfsmount
op_star
id|mnt
)paren
(brace
id|vfs_t
op_star
id|vfsp
suffix:semicolon
id|xfs_mount_t
op_star
id|mp
suffix:semicolon
r_static
r_struct
id|proc_xfs_info
(brace
r_int
id|flag
suffix:semicolon
r_char
op_star
id|str
suffix:semicolon
)brace
id|xfs_info
(braket
)braket
op_assign
(brace
multiline_comment|/* the few simple ones we can get from the mount struct */
(brace
id|XFS_MOUNT_NOALIGN
comma
l_string|&quot;,noalign&quot;
)brace
comma
(brace
id|XFS_MOUNT_NORECOVERY
comma
l_string|&quot;,norecovery&quot;
)brace
comma
(brace
id|XFS_MOUNT_OSYNCISOSYNC
comma
l_string|&quot;,osyncisosync&quot;
)brace
comma
(brace
id|XFS_MOUNT_NOUUID
comma
l_string|&quot;,nouuid&quot;
)brace
comma
(brace
id|XFS_MOUNT_IRIXSGID
comma
l_string|&quot;,irixsgid&quot;
)brace
comma
(brace
l_int|0
comma
l_int|NULL
)brace
)brace
suffix:semicolon
r_struct
id|proc_xfs_info
op_star
id|xfs_infop
suffix:semicolon
id|vfsp
op_assign
id|LINVFS_GET_VFS
c_func
(paren
id|mnt-&gt;mnt_sb
)paren
suffix:semicolon
id|mp
op_assign
id|XFS_BHVTOM
c_func
(paren
id|vfsp-&gt;vfs_fbhv
)paren
suffix:semicolon
r_for
c_loop
(paren
id|xfs_infop
op_assign
id|xfs_info
suffix:semicolon
id|xfs_infop-&gt;flag
suffix:semicolon
id|xfs_infop
op_increment
)paren
(brace
r_if
c_cond
(paren
id|mp-&gt;m_flags
op_amp
id|xfs_infop-&gt;flag
)paren
id|seq_puts
c_func
(paren
id|m
comma
id|xfs_infop-&gt;str
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mp-&gt;m_qflags
op_amp
id|XFS_UQUOTA_ACCT
)paren
(brace
id|seq_puts
c_func
(paren
id|m
comma
l_string|&quot;,uquota&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mp-&gt;m_qflags
op_amp
id|XFS_UQUOTA_ENFD
)paren
)paren
id|seq_puts
c_func
(paren
id|m
comma
l_string|&quot;,uqnoenforce&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mp-&gt;m_qflags
op_amp
id|XFS_GQUOTA_ACCT
)paren
(brace
id|seq_puts
c_func
(paren
id|m
comma
l_string|&quot;,gquota&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mp-&gt;m_qflags
op_amp
id|XFS_GQUOTA_ENFD
)paren
)paren
id|seq_puts
c_func
(paren
id|m
comma
l_string|&quot;,gqnoenforce&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mp-&gt;m_flags
op_amp
id|XFS_MOUNT_DFLT_IOSIZE
)paren
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;,biosize=%d&quot;
comma
id|mp-&gt;m_writeio_log
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mp-&gt;m_logbufs
OG
l_int|0
)paren
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;,logbufs=%d&quot;
comma
id|mp-&gt;m_logbufs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mp-&gt;m_logbsize
OG
l_int|0
)paren
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;,logbsize=%d&quot;
comma
id|mp-&gt;m_logbsize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mp-&gt;m_ddev_targp-&gt;pbr_dev
op_ne
id|mp-&gt;m_logdev_targp-&gt;pbr_dev
)paren
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;,logdev=%s&quot;
comma
id|bdevname
c_func
(paren
id|mp-&gt;m_logdev_targp-&gt;pbr_bdev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mp-&gt;m_rtdev_targp
op_logical_and
id|mp-&gt;m_ddev_targp-&gt;pbr_dev
op_ne
id|mp-&gt;m_rtdev_targp-&gt;pbr_dev
)paren
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;,rtdev=%s&quot;
comma
id|bdevname
c_func
(paren
id|mp-&gt;m_rtdev_targp-&gt;pbr_bdev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mp-&gt;m_dalign
OG
l_int|0
)paren
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;,sunit=%d&quot;
comma
(paren
r_int
)paren
id|XFS_FSB_TO_BB
c_func
(paren
id|mp
comma
id|mp-&gt;m_dalign
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mp-&gt;m_swidth
OG
l_int|0
)paren
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;,swidth=%d&quot;
comma
(paren
r_int
)paren
id|XFS_FSB_TO_BB
c_func
(paren
id|mp
comma
id|mp-&gt;m_swidth
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vfsp-&gt;vfs_flag
op_amp
id|VFS_DMI
)paren
id|seq_puts
c_func
(paren
id|m
comma
l_string|&quot;,dmapi&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|linvfs_sops
r_static
r_struct
id|super_operations
id|linvfs_sops
op_assign
(brace
dot
id|alloc_inode
op_assign
id|linvfs_alloc_inode
comma
dot
id|destroy_inode
op_assign
id|linvfs_destroy_inode
comma
dot
id|write_inode
op_assign
id|linvfs_write_inode
comma
dot
id|put_inode
op_assign
id|linvfs_put_inode
comma
dot
id|clear_inode
op_assign
id|linvfs_clear_inode
comma
dot
id|put_super
op_assign
id|linvfs_put_super
comma
dot
id|write_super
op_assign
id|linvfs_write_super
comma
dot
id|write_super_lockfs
op_assign
id|linvfs_freeze_fs
comma
dot
id|unlockfs
op_assign
id|linvfs_unfreeze_fs
comma
dot
id|statfs
op_assign
id|linvfs_statfs
comma
dot
id|remount_fs
op_assign
id|linvfs_remount
comma
dot
id|show_options
op_assign
id|linvfs_show_options
comma
)brace
suffix:semicolon
DECL|variable|xfs_fs_type
r_static
r_struct
id|file_system_type
id|xfs_fs_type
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;xfs&quot;
comma
dot
id|get_sb
op_assign
id|linvfs_get_sb
comma
dot
id|kill_sb
op_assign
id|kill_block_super
comma
dot
id|fs_flags
op_assign
id|FS_REQUIRES_DEV
comma
)brace
suffix:semicolon
DECL|function|init_xfs_fs
r_static
r_int
id|__init
id|init_xfs_fs
c_func
(paren
r_void
)paren
(brace
r_int
id|error
suffix:semicolon
r_struct
id|sysinfo
id|si
suffix:semicolon
r_static
r_char
id|message
(braket
)braket
id|__initdata
op_assign
id|KERN_INFO
l_string|&quot;SGI XFS &quot;
id|XFS_VERSION_STRING
l_string|&quot; with &quot;
id|XFS_BUILD_OPTIONS
l_string|&quot; enabled&bslash;n&quot;
suffix:semicolon
id|error
op_assign
id|init_inodecache
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
OL
l_int|0
)paren
r_return
id|error
suffix:semicolon
id|error
op_assign
id|pagebuf_init
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
OL
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|si_meminfo
c_func
(paren
op_amp
id|si
)paren
suffix:semicolon
id|xfs_physmem
op_assign
id|si.totalram
suffix:semicolon
id|printk
c_func
(paren
id|message
)paren
suffix:semicolon
id|vn_init
c_func
(paren
)paren
suffix:semicolon
id|xfs_init
c_func
(paren
)paren
suffix:semicolon
id|dmapi_init
c_func
(paren
)paren
suffix:semicolon
id|error
op_assign
id|register_filesystem
c_func
(paren
op_amp
id|xfs_fs_type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|out
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out
suffix:colon
id|destroy_inodecache
c_func
(paren
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|exit_xfs_fs
r_static
r_void
id|__exit
id|exit_xfs_fs
c_func
(paren
r_void
)paren
(brace
id|dmapi_uninit
c_func
(paren
)paren
suffix:semicolon
id|xfs_cleanup
c_func
(paren
)paren
suffix:semicolon
id|unregister_filesystem
c_func
(paren
op_amp
id|xfs_fs_type
)paren
suffix:semicolon
id|pagebuf_terminate
c_func
(paren
)paren
suffix:semicolon
id|destroy_inodecache
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|init_xfs_fs
id|module_init
c_func
(paren
id|init_xfs_fs
)paren
suffix:semicolon
DECL|variable|exit_xfs_fs
id|module_exit
c_func
(paren
id|exit_xfs_fs
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;SGI &lt;sgi.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;SGI XFS &quot;
id|XFS_VERSION_STRING
l_string|&quot; with &quot;
id|XFS_BUILD_OPTIONS
l_string|&quot; enabled&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
