multiline_comment|/*&n; * Copyright (c) 2000-2003 Silicon Graphics, Inc.  All Rights Reserved.&n; *&n; * This program is free software; you can redistribute it and/or modify it&n; * under the terms of version 2 of the GNU General Public License as&n; * published by the Free Software Foundation.&n; *&n; * This program is distributed in the hope that it would be useful, but&n; * WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&n; *&n; * Further, this software is distributed without any warranty that it is&n; * free of the rightful claim of any third person regarding infringement&n; * or the like.  Any license provided herein, whether implied or&n; * otherwise, applies only to this software file.  Patent licenses, if&n; * any, provided herein do not apply to combinations of this program with&n; * other software, or any other product whatsoever.&n; *&n; * You should have received a copy of the GNU General Public License along&n; * with this program; if not, write the Free Software Foundation, Inc., 59&n; * Temple Place - Suite 330, Boston MA 02111-1307, USA.&n; *&n; * Contact information: Silicon Graphics, Inc., 1600 Amphitheatre Pkwy,&n; * Mountain View, CA  94043, or:&n; *&n; * http://www.sgi.com&n; *&n; * For further information regarding this notice, see:&n; *&n; * http://oss.sgi.com/projects/GenInfo/SGIGPLNoticeExplan/&n; */
macro_line|#include &quot;xfs.h&quot;
macro_line|#include &quot;xfs_fs.h&quot;
macro_line|#include &quot;xfs_inum.h&quot;
macro_line|#include &quot;xfs_log.h&quot;
macro_line|#include &quot;xfs_trans.h&quot;
macro_line|#include &quot;xfs_sb.h&quot;
macro_line|#include &quot;xfs_dir.h&quot;
macro_line|#include &quot;xfs_dir2.h&quot;
macro_line|#include &quot;xfs_alloc.h&quot;
macro_line|#include &quot;xfs_dmapi.h&quot;
macro_line|#include &quot;xfs_mount.h&quot;
macro_line|#include &quot;xfs_alloc_btree.h&quot;
macro_line|#include &quot;xfs_bmap_btree.h&quot;
macro_line|#include &quot;xfs_ialloc_btree.h&quot;
macro_line|#include &quot;xfs_btree.h&quot;
macro_line|#include &quot;xfs_ialloc.h&quot;
macro_line|#include &quot;xfs_attr_sf.h&quot;
macro_line|#include &quot;xfs_dir_sf.h&quot;
macro_line|#include &quot;xfs_dir2_sf.h&quot;
macro_line|#include &quot;xfs_dinode.h&quot;
macro_line|#include &quot;xfs_inode.h&quot;
macro_line|#include &quot;xfs_bmap.h&quot;
macro_line|#include &quot;xfs_bit.h&quot;
macro_line|#include &quot;xfs_rtalloc.h&quot;
macro_line|#include &quot;xfs_error.h&quot;
macro_line|#include &quot;xfs_itable.h&quot;
macro_line|#include &quot;xfs_rw.h&quot;
macro_line|#include &quot;xfs_acl.h&quot;
macro_line|#include &quot;xfs_cap.h&quot;
macro_line|#include &quot;xfs_mac.h&quot;
macro_line|#include &quot;xfs_attr.h&quot;
macro_line|#include &quot;xfs_buf_item.h&quot;
macro_line|#include &quot;xfs_utils.h&quot;
macro_line|#include &quot;xfs_dfrag.h&quot;
macro_line|#include &quot;xfs_fsops.h&quot;
macro_line|#include &lt;linux/dcache.h&gt;
macro_line|#include &lt;linux/mount.h&gt;
macro_line|#include &lt;linux/namei.h&gt;
macro_line|#include &lt;linux/pagemap.h&gt;
multiline_comment|/*&n; * xfs_find_handle maps from userspace xfs_fsop_handlereq structure to&n; * a file or fs handle.&n; *&n; * XFS_IOC_PATH_TO_FSHANDLE&n; *    returns fs handle for a mount point or path within that mount point&n; * XFS_IOC_FD_TO_HANDLE&n; *    returns full handle for a FD opened in user space&n; * XFS_IOC_PATH_TO_HANDLE&n; *    returns full handle for a path&n; */
id|STATIC
r_int
DECL|function|xfs_find_handle
id|xfs_find_handle
c_func
(paren
r_int
r_int
id|cmd
comma
r_void
id|__user
op_star
id|arg
)paren
(brace
r_int
id|hsize
suffix:semicolon
id|xfs_handle_t
id|handle
suffix:semicolon
id|xfs_fsop_handlereq_t
id|hreq
suffix:semicolon
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_struct
id|vnode
op_star
id|vp
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|hreq
comma
id|arg
comma
r_sizeof
(paren
id|hreq
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
id|memset
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|handle
comma
l_int|0
comma
r_sizeof
(paren
id|handle
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|XFS_IOC_PATH_TO_FSHANDLE
suffix:colon
r_case
id|XFS_IOC_PATH_TO_HANDLE
suffix:colon
(brace
r_struct
id|nameidata
id|nd
suffix:semicolon
r_int
id|error
suffix:semicolon
id|error
op_assign
id|user_path_walk_link
c_func
(paren
(paren
r_const
r_char
id|__user
op_star
)paren
id|hreq.path
comma
op_amp
id|nd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
id|ASSERT
c_func
(paren
id|nd.dentry
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|nd.dentry-&gt;d_inode
)paren
suffix:semicolon
id|inode
op_assign
id|igrab
c_func
(paren
id|nd.dentry-&gt;d_inode
)paren
suffix:semicolon
id|path_release
c_func
(paren
op_amp
id|nd
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|XFS_IOC_FD_TO_HANDLE
suffix:colon
(brace
r_struct
id|file
op_star
id|file
suffix:semicolon
id|file
op_assign
id|fget
c_func
(paren
id|hreq.fd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|file
)paren
r_return
op_minus
id|EBADF
suffix:semicolon
id|ASSERT
c_func
(paren
id|file-&gt;f_dentry
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode
)paren
suffix:semicolon
id|inode
op_assign
id|igrab
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode
)paren
suffix:semicolon
id|fput
c_func
(paren
id|file
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
id|ASSERT
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|inode-&gt;i_sb-&gt;s_magic
op_ne
id|XFS_SB_MAGIC
)paren
(brace
multiline_comment|/* we&squot;re not in XFS anymore, Toto */
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
multiline_comment|/* we need the vnode */
id|vp
op_assign
id|LINVFS_GET_VP
c_func
(paren
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;v_type
op_ne
id|VREG
op_logical_and
id|vp-&gt;v_type
op_ne
id|VDIR
op_logical_and
id|vp-&gt;v_type
op_ne
id|VLNK
)paren
(brace
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EBADF
)paren
suffix:semicolon
)brace
multiline_comment|/* now we can grab the fsid */
id|memcpy
c_func
(paren
op_amp
id|handle.ha_fsid
comma
id|vp-&gt;v_vfsp-&gt;vfs_altfsid
comma
r_sizeof
(paren
id|xfs_fsid_t
)paren
)paren
suffix:semicolon
id|hsize
op_assign
r_sizeof
(paren
id|xfs_fsid_t
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_ne
id|XFS_IOC_PATH_TO_FSHANDLE
)paren
(brace
id|xfs_inode_t
op_star
id|ip
suffix:semicolon
id|bhv_desc_t
op_star
id|bhv
suffix:semicolon
r_int
id|lock_mode
suffix:semicolon
multiline_comment|/* need to get access to the xfs_inode to read the generation */
id|bhv
op_assign
id|vn_bhv_lookup_unlocked
c_func
(paren
id|VN_BHV_HEAD
c_func
(paren
id|vp
)paren
comma
op_amp
id|xfs_vnodeops
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|bhv
)paren
suffix:semicolon
id|ip
op_assign
id|XFS_BHVTOI
c_func
(paren
id|bhv
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|ip
)paren
suffix:semicolon
id|lock_mode
op_assign
id|xfs_ilock_map_shared
c_func
(paren
id|ip
)paren
suffix:semicolon
multiline_comment|/* fill in fid section of handle from inode */
id|handle.ha_fid.xfs_fid_len
op_assign
r_sizeof
(paren
id|xfs_fid_t
)paren
op_minus
r_sizeof
(paren
id|handle.ha_fid.xfs_fid_len
)paren
suffix:semicolon
id|handle.ha_fid.xfs_fid_pad
op_assign
l_int|0
suffix:semicolon
id|handle.ha_fid.xfs_fid_gen
op_assign
id|ip-&gt;i_d.di_gen
suffix:semicolon
id|handle.ha_fid.xfs_fid_ino
op_assign
id|ip-&gt;i_ino
suffix:semicolon
id|xfs_iunlock_map_shared
c_func
(paren
id|ip
comma
id|lock_mode
)paren
suffix:semicolon
id|hsize
op_assign
id|XFS_HSIZE
c_func
(paren
id|handle
)paren
suffix:semicolon
)brace
multiline_comment|/* now copy our handle into the user buffer &amp; write out the size */
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|hreq.ohandle
comma
op_amp
id|handle
comma
id|hsize
)paren
op_logical_or
id|copy_to_user
c_func
(paren
id|hreq.ohandlen
comma
op_amp
id|hsize
comma
r_sizeof
(paren
id|__s32
)paren
)paren
)paren
(brace
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
)brace
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Convert userspace handle data into vnode (and inode).&n; * We [ab]use the fact that all the fsop_handlereq ioctl calls&n; * have a data structure argument whose first component is always&n; * a xfs_fsop_handlereq_t, so we can cast to and from this type.&n; * This allows us to optimise the copy_from_user calls and gives&n; * a handy, shared routine.&n; *&n; * If no error, caller must always VN_RELE the returned vp.&n; */
id|STATIC
r_int
DECL|function|xfs_vget_fsop_handlereq
id|xfs_vget_fsop_handlereq
c_func
(paren
id|xfs_mount_t
op_star
id|mp
comma
r_struct
id|inode
op_star
id|parinode
comma
multiline_comment|/* parent inode pointer    */
r_int
id|cap
comma
multiline_comment|/* capability level for op */
r_void
id|__user
op_star
id|arg
comma
multiline_comment|/* userspace data pointer  */
r_int
r_int
id|size
comma
multiline_comment|/* size of expected struct */
multiline_comment|/* output arguments */
id|xfs_fsop_handlereq_t
op_star
id|hreq
comma
id|vnode_t
op_star
op_star
id|vp
comma
r_struct
id|inode
op_star
op_star
id|inode
)paren
(brace
r_void
id|__user
op_star
id|hanp
suffix:semicolon
r_int
id|hlen
suffix:semicolon
id|xfs_fid_t
op_star
id|xfid
suffix:semicolon
id|xfs_handle_t
op_star
id|handlep
suffix:semicolon
id|xfs_handle_t
id|handle
suffix:semicolon
id|xfs_inode_t
op_star
id|ip
suffix:semicolon
r_struct
id|inode
op_star
id|inodep
suffix:semicolon
id|vnode_t
op_star
id|vpp
suffix:semicolon
id|xfs_ino_t
id|ino
suffix:semicolon
id|__u32
id|igen
suffix:semicolon
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|cap
)paren
)paren
r_return
id|XFS_ERROR
c_func
(paren
id|EPERM
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Only allow handle opens under a directory.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|S_ISDIR
c_func
(paren
id|parinode-&gt;i_mode
)paren
)paren
r_return
id|XFS_ERROR
c_func
(paren
id|ENOTDIR
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Copy the handle down from the user and validate&n;&t; * that it looks to be in the correct format.&n;&t; */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|hreq
comma
id|arg
comma
id|size
)paren
)paren
r_return
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
id|hanp
op_assign
id|hreq-&gt;ihandle
suffix:semicolon
id|hlen
op_assign
id|hreq-&gt;ihandlen
suffix:semicolon
id|handlep
op_assign
op_amp
id|handle
suffix:semicolon
r_if
c_cond
(paren
id|hlen
template_param
r_sizeof
(paren
op_star
id|handlep
)paren
)paren
r_return
id|XFS_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|handlep
comma
id|hanp
comma
id|hlen
)paren
)paren
r_return
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hlen
OL
r_sizeof
(paren
op_star
id|handlep
)paren
)paren
id|memset
c_func
(paren
(paren
(paren
r_char
op_star
)paren
id|handlep
)paren
op_plus
id|hlen
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|handlep
)paren
op_minus
id|hlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hlen
OG
r_sizeof
(paren
id|handlep-&gt;ha_fsid
)paren
)paren
(brace
r_if
c_cond
(paren
id|handlep-&gt;ha_fid.xfs_fid_len
op_ne
(paren
id|hlen
op_minus
r_sizeof
(paren
id|handlep-&gt;ha_fsid
)paren
op_minus
r_sizeof
(paren
id|handlep-&gt;ha_fid.xfs_fid_len
)paren
)paren
op_logical_or
id|handlep-&gt;ha_fid.xfs_fid_pad
)paren
r_return
id|XFS_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Crack the handle, obtain the inode # &amp; generation #&n;&t; */
id|xfid
op_assign
(paren
r_struct
id|xfs_fid
op_star
)paren
op_amp
id|handlep-&gt;ha_fid
suffix:semicolon
r_if
c_cond
(paren
id|xfid-&gt;xfs_fid_len
op_eq
r_sizeof
(paren
op_star
id|xfid
)paren
op_minus
r_sizeof
(paren
id|xfid-&gt;xfs_fid_len
)paren
)paren
(brace
id|ino
op_assign
id|xfid-&gt;xfs_fid_ino
suffix:semicolon
id|igen
op_assign
id|xfid-&gt;xfs_fid_gen
suffix:semicolon
)brace
r_else
(brace
r_return
id|XFS_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Get the XFS inode, building a vnode to go with it.&n;&t; */
id|error
op_assign
id|xfs_iget
c_func
(paren
id|mp
comma
l_int|NULL
comma
id|ino
comma
l_int|0
comma
id|XFS_ILOCK_SHARED
comma
op_amp
id|ip
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
r_if
c_cond
(paren
id|ip
op_eq
l_int|NULL
)paren
r_return
id|XFS_ERROR
c_func
(paren
id|EIO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ip-&gt;i_d.di_mode
op_eq
l_int|0
op_logical_or
id|ip-&gt;i_d.di_gen
op_ne
id|igen
)paren
(brace
id|xfs_iput_new
c_func
(paren
id|ip
comma
id|XFS_ILOCK_SHARED
)paren
suffix:semicolon
r_return
id|XFS_ERROR
c_func
(paren
id|ENOENT
)paren
suffix:semicolon
)brace
id|vpp
op_assign
id|XFS_ITOV
c_func
(paren
id|ip
)paren
suffix:semicolon
id|inodep
op_assign
id|LINVFS_GET_IP
c_func
(paren
id|vpp
)paren
suffix:semicolon
id|xfs_iunlock
c_func
(paren
id|ip
comma
id|XFS_ILOCK_SHARED
)paren
suffix:semicolon
op_star
id|vp
op_assign
id|vpp
suffix:semicolon
op_star
id|inode
op_assign
id|inodep
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|STATIC
r_int
DECL|function|xfs_open_by_handle
id|xfs_open_by_handle
c_func
(paren
id|xfs_mount_t
op_star
id|mp
comma
r_void
id|__user
op_star
id|arg
comma
r_struct
id|file
op_star
id|parfilp
comma
r_struct
id|inode
op_star
id|parinode
)paren
(brace
r_int
id|error
suffix:semicolon
r_int
id|new_fd
suffix:semicolon
r_int
id|permflag
suffix:semicolon
r_struct
id|file
op_star
id|filp
suffix:semicolon
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_struct
id|dentry
op_star
id|dentry
suffix:semicolon
id|vnode_t
op_star
id|vp
suffix:semicolon
id|xfs_fsop_handlereq_t
id|hreq
suffix:semicolon
id|error
op_assign
id|xfs_vget_fsop_handlereq
c_func
(paren
id|mp
comma
id|parinode
comma
id|CAP_SYS_ADMIN
comma
id|arg
comma
r_sizeof
(paren
id|xfs_fsop_handlereq_t
)paren
comma
op_amp
id|hreq
comma
op_amp
id|vp
comma
op_amp
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
op_minus
id|error
suffix:semicolon
multiline_comment|/* Restrict xfs_open_by_handle to directories &amp; regular files. */
r_if
c_cond
(paren
op_logical_neg
(paren
id|S_ISREG
c_func
(paren
id|inode-&gt;i_mode
)paren
op_logical_or
id|S_ISDIR
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
)paren
(brace
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
macro_line|#if BITS_PER_LONG != 32
id|hreq.oflags
op_or_assign
id|O_LARGEFILE
suffix:semicolon
macro_line|#endif
multiline_comment|/* Put open permission in namei format. */
id|permflag
op_assign
id|hreq.oflags
suffix:semicolon
r_if
c_cond
(paren
(paren
id|permflag
op_plus
l_int|1
)paren
op_amp
id|O_ACCMODE
)paren
id|permflag
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|permflag
op_amp
id|O_TRUNC
)paren
id|permflag
op_or_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
(paren
id|permflag
op_amp
id|O_APPEND
)paren
op_logical_or
(paren
id|permflag
op_amp
id|O_TRUNC
)paren
)paren
op_logical_and
(paren
id|permflag
op_amp
id|FMODE_WRITE
)paren
op_logical_and
id|IS_APPEND
c_func
(paren
id|inode
)paren
)paren
(brace
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EPERM
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|permflag
op_amp
id|FMODE_WRITE
)paren
op_logical_and
id|IS_IMMUTABLE
c_func
(paren
id|inode
)paren
)paren
(brace
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EACCES
)paren
suffix:semicolon
)brace
multiline_comment|/* Can&squot;t write directories. */
r_if
c_cond
(paren
id|S_ISDIR
c_func
(paren
id|inode-&gt;i_mode
)paren
op_logical_and
(paren
id|permflag
op_amp
id|FMODE_WRITE
)paren
)paren
(brace
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EISDIR
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|new_fd
op_assign
id|get_unused_fd
c_func
(paren
)paren
)paren
OL
l_int|0
)paren
(brace
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
id|new_fd
suffix:semicolon
)brace
id|dentry
op_assign
id|d_alloc_anon
c_func
(paren
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dentry
op_eq
l_int|NULL
)paren
(brace
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
id|put_unused_fd
c_func
(paren
id|new_fd
)paren
suffix:semicolon
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|ENOMEM
)paren
suffix:semicolon
)brace
multiline_comment|/* Ensure umount returns EBUSY on umounts while this file is open. */
id|mntget
c_func
(paren
id|parfilp-&gt;f_vfsmnt
)paren
suffix:semicolon
multiline_comment|/* Create file pointer. */
id|filp
op_assign
id|dentry_open
c_func
(paren
id|dentry
comma
id|parfilp-&gt;f_vfsmnt
comma
id|hreq.oflags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|filp
)paren
)paren
(brace
id|put_unused_fd
c_func
(paren
id|new_fd
)paren
suffix:semicolon
r_return
op_minus
id|XFS_ERROR
c_func
(paren
op_minus
id|PTR_ERR
c_func
(paren
id|filp
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|inode-&gt;i_mode
op_amp
id|S_IFREG
)paren
id|filp-&gt;f_op
op_assign
op_amp
id|linvfs_invis_file_operations
suffix:semicolon
id|fd_install
c_func
(paren
id|new_fd
comma
id|filp
)paren
suffix:semicolon
r_return
id|new_fd
suffix:semicolon
)brace
id|STATIC
r_int
DECL|function|xfs_readlink_by_handle
id|xfs_readlink_by_handle
c_func
(paren
id|xfs_mount_t
op_star
id|mp
comma
r_void
id|__user
op_star
id|arg
comma
r_struct
id|file
op_star
id|parfilp
comma
r_struct
id|inode
op_star
id|parinode
)paren
(brace
r_int
id|error
suffix:semicolon
r_struct
id|iovec
id|aiov
suffix:semicolon
r_struct
id|uio
id|auio
suffix:semicolon
r_struct
id|inode
op_star
id|inode
suffix:semicolon
id|xfs_fsop_handlereq_t
id|hreq
suffix:semicolon
id|vnode_t
op_star
id|vp
suffix:semicolon
id|__u32
id|olen
suffix:semicolon
id|error
op_assign
id|xfs_vget_fsop_handlereq
c_func
(paren
id|mp
comma
id|parinode
comma
id|CAP_SYS_ADMIN
comma
id|arg
comma
r_sizeof
(paren
id|xfs_fsop_handlereq_t
)paren
comma
op_amp
id|hreq
comma
op_amp
id|vp
comma
op_amp
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
op_minus
id|error
suffix:semicolon
multiline_comment|/* Restrict this handle operation to symlinks only. */
r_if
c_cond
(paren
id|vp-&gt;v_type
op_ne
id|VLNK
)paren
(brace
id|VN_RELE
c_func
(paren
id|vp
)paren
suffix:semicolon
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|olen
comma
id|hreq.ohandlen
comma
r_sizeof
(paren
id|__u32
)paren
)paren
)paren
(brace
id|VN_RELE
c_func
(paren
id|vp
)paren
suffix:semicolon
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
)brace
id|aiov.iov_len
op_assign
id|olen
suffix:semicolon
id|aiov.iov_base
op_assign
id|hreq.ohandle
suffix:semicolon
id|auio.uio_iov
op_assign
op_amp
id|aiov
suffix:semicolon
id|auio.uio_iovcnt
op_assign
l_int|1
suffix:semicolon
id|auio.uio_offset
op_assign
l_int|0
suffix:semicolon
id|auio.uio_segflg
op_assign
id|UIO_USERSPACE
suffix:semicolon
id|auio.uio_resid
op_assign
id|olen
suffix:semicolon
id|VOP_READLINK
c_func
(paren
id|vp
comma
op_amp
id|auio
comma
id|IO_INVIS
comma
l_int|NULL
comma
id|error
)paren
suffix:semicolon
id|VN_RELE
c_func
(paren
id|vp
)paren
suffix:semicolon
r_return
(paren
id|olen
op_minus
id|auio.uio_resid
)paren
suffix:semicolon
)brace
id|STATIC
r_int
DECL|function|xfs_fssetdm_by_handle
id|xfs_fssetdm_by_handle
c_func
(paren
id|xfs_mount_t
op_star
id|mp
comma
r_void
id|__user
op_star
id|arg
comma
r_struct
id|file
op_star
id|parfilp
comma
r_struct
id|inode
op_star
id|parinode
)paren
(brace
r_int
id|error
suffix:semicolon
r_struct
id|fsdmidata
id|fsd
suffix:semicolon
id|xfs_fsop_setdm_handlereq_t
id|dmhreq
suffix:semicolon
r_struct
id|inode
op_star
id|inode
suffix:semicolon
id|bhv_desc_t
op_star
id|bdp
suffix:semicolon
id|vnode_t
op_star
id|vp
suffix:semicolon
id|error
op_assign
id|xfs_vget_fsop_handlereq
c_func
(paren
id|mp
comma
id|parinode
comma
id|CAP_MKNOD
comma
id|arg
comma
r_sizeof
(paren
id|xfs_fsop_setdm_handlereq_t
)paren
comma
(paren
id|xfs_fsop_handlereq_t
op_star
)paren
op_amp
id|dmhreq
comma
op_amp
id|vp
comma
op_amp
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
op_minus
id|error
suffix:semicolon
r_if
c_cond
(paren
id|IS_IMMUTABLE
c_func
(paren
id|inode
)paren
op_logical_or
id|IS_APPEND
c_func
(paren
id|inode
)paren
)paren
(brace
id|VN_RELE
c_func
(paren
id|vp
)paren
suffix:semicolon
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EPERM
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|fsd
comma
id|dmhreq.data
comma
r_sizeof
(paren
id|fsd
)paren
)paren
)paren
(brace
id|VN_RELE
c_func
(paren
id|vp
)paren
suffix:semicolon
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
)brace
id|bdp
op_assign
id|bhv_base_unlocked
c_func
(paren
id|VN_BHV_HEAD
c_func
(paren
id|vp
)paren
)paren
suffix:semicolon
id|error
op_assign
id|xfs_set_dmattrs
c_func
(paren
id|bdp
comma
id|fsd.fsd_dmevmask
comma
id|fsd.fsd_dmstate
comma
l_int|NULL
)paren
suffix:semicolon
id|VN_RELE
c_func
(paren
id|vp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
op_minus
id|error
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|STATIC
r_int
DECL|function|xfs_attrlist_by_handle
id|xfs_attrlist_by_handle
c_func
(paren
id|xfs_mount_t
op_star
id|mp
comma
r_void
id|__user
op_star
id|arg
comma
r_struct
id|file
op_star
id|parfilp
comma
r_struct
id|inode
op_star
id|parinode
)paren
(brace
r_int
id|error
suffix:semicolon
id|attrlist_cursor_kern_t
op_star
id|cursor
suffix:semicolon
id|xfs_fsop_attrlist_handlereq_t
id|al_hreq
suffix:semicolon
r_struct
id|inode
op_star
id|inode
suffix:semicolon
id|vnode_t
op_star
id|vp
suffix:semicolon
id|error
op_assign
id|xfs_vget_fsop_handlereq
c_func
(paren
id|mp
comma
id|parinode
comma
id|CAP_SYS_ADMIN
comma
id|arg
comma
r_sizeof
(paren
id|xfs_fsop_attrlist_handlereq_t
)paren
comma
(paren
id|xfs_fsop_handlereq_t
op_star
)paren
op_amp
id|al_hreq
comma
op_amp
id|vp
comma
op_amp
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
op_minus
id|error
suffix:semicolon
id|cursor
op_assign
(paren
id|attrlist_cursor_kern_t
op_star
)paren
op_amp
id|al_hreq.pos
suffix:semicolon
id|VOP_ATTR_LIST
c_func
(paren
id|vp
comma
id|al_hreq.buffer
comma
id|al_hreq.buflen
comma
id|al_hreq.flags
comma
id|cursor
comma
l_int|NULL
comma
id|error
)paren
suffix:semicolon
id|VN_RELE
c_func
(paren
id|vp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
op_minus
id|error
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|STATIC
r_int
DECL|function|xfs_attrmulti_by_handle
id|xfs_attrmulti_by_handle
c_func
(paren
id|xfs_mount_t
op_star
id|mp
comma
r_void
id|__user
op_star
id|arg
comma
r_struct
id|file
op_star
id|parfilp
comma
r_struct
id|inode
op_star
id|parinode
)paren
(brace
r_int
id|error
suffix:semicolon
id|xfs_attr_multiop_t
op_star
id|ops
suffix:semicolon
id|xfs_fsop_attrmulti_handlereq_t
id|am_hreq
suffix:semicolon
r_struct
id|inode
op_star
id|inode
suffix:semicolon
id|vnode_t
op_star
id|vp
suffix:semicolon
r_int
id|i
comma
id|size
suffix:semicolon
id|error
op_assign
id|xfs_vget_fsop_handlereq
c_func
(paren
id|mp
comma
id|parinode
comma
id|CAP_SYS_ADMIN
comma
id|arg
comma
r_sizeof
(paren
id|xfs_fsop_attrmulti_handlereq_t
)paren
comma
(paren
id|xfs_fsop_handlereq_t
op_star
)paren
op_amp
id|am_hreq
comma
op_amp
id|vp
comma
op_amp
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
op_minus
id|error
suffix:semicolon
id|size
op_assign
id|am_hreq.opcount
op_star
r_sizeof
(paren
id|attr_multiop_t
)paren
suffix:semicolon
id|ops
op_assign
(paren
id|xfs_attr_multiop_t
op_star
)paren
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ops
)paren
(brace
id|VN_RELE
c_func
(paren
id|vp
)paren
suffix:semicolon
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|ENOMEM
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|ops
comma
id|am_hreq.ops
comma
id|size
)paren
)paren
(brace
id|kfree
c_func
(paren
id|ops
)paren
suffix:semicolon
id|VN_RELE
c_func
(paren
id|vp
)paren
suffix:semicolon
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|am_hreq.opcount
suffix:semicolon
id|i
op_increment
)paren
(brace
r_switch
c_cond
(paren
id|ops
(braket
id|i
)braket
dot
id|am_opcode
)paren
(brace
r_case
id|ATTR_OP_GET
suffix:colon
id|VOP_ATTR_GET
c_func
(paren
id|vp
comma
id|ops
(braket
id|i
)braket
dot
id|am_attrname
comma
id|ops
(braket
id|i
)braket
dot
id|am_attrvalue
comma
op_amp
id|ops
(braket
id|i
)braket
dot
id|am_length
comma
id|ops
(braket
id|i
)braket
dot
id|am_flags
comma
l_int|NULL
comma
id|ops
(braket
id|i
)braket
dot
id|am_error
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATTR_OP_SET
suffix:colon
r_if
c_cond
(paren
id|IS_IMMUTABLE
c_func
(paren
id|inode
)paren
op_logical_or
id|IS_APPEND
c_func
(paren
id|inode
)paren
)paren
(brace
id|ops
(braket
id|i
)braket
dot
id|am_error
op_assign
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|VOP_ATTR_SET
c_func
(paren
id|vp
comma
id|ops
(braket
id|i
)braket
dot
id|am_attrname
comma
id|ops
(braket
id|i
)braket
dot
id|am_attrvalue
comma
id|ops
(braket
id|i
)braket
dot
id|am_length
comma
id|ops
(braket
id|i
)braket
dot
id|am_flags
comma
l_int|NULL
comma
id|ops
(braket
id|i
)braket
dot
id|am_error
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATTR_OP_REMOVE
suffix:colon
r_if
c_cond
(paren
id|IS_IMMUTABLE
c_func
(paren
id|inode
)paren
op_logical_or
id|IS_APPEND
c_func
(paren
id|inode
)paren
)paren
(brace
id|ops
(braket
id|i
)braket
dot
id|am_error
op_assign
id|EPERM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|VOP_ATTR_REMOVE
c_func
(paren
id|vp
comma
id|ops
(braket
id|i
)braket
dot
id|am_attrname
comma
id|ops
(braket
id|i
)braket
dot
id|am_flags
comma
l_int|NULL
comma
id|ops
(braket
id|i
)braket
dot
id|am_error
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ops
(braket
id|i
)braket
dot
id|am_error
op_assign
id|EINVAL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|am_hreq.ops
comma
id|ops
comma
id|size
)paren
)paren
id|error
op_assign
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ops
)paren
suffix:semicolon
id|VN_RELE
c_func
(paren
id|vp
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/* prototypes for a few of the stack-hungry cases that have&n; * their own functions.  Functions are defined after their use&n; * so gcc doesn&squot;t get fancy and inline them with -03 */
id|STATIC
r_int
id|xfs_ioc_space
c_func
(paren
id|bhv_desc_t
op_star
id|bdp
comma
id|vnode_t
op_star
id|vp
comma
r_struct
id|file
op_star
id|filp
comma
r_int
id|flags
comma
r_int
r_int
id|cmd
comma
r_void
id|__user
op_star
id|arg
)paren
suffix:semicolon
id|STATIC
r_int
id|xfs_ioc_bulkstat
c_func
(paren
id|xfs_mount_t
op_star
id|mp
comma
r_int
r_int
id|cmd
comma
r_void
id|__user
op_star
id|arg
)paren
suffix:semicolon
id|STATIC
r_int
id|xfs_ioc_fsgeometry_v1
c_func
(paren
id|xfs_mount_t
op_star
id|mp
comma
r_void
id|__user
op_star
id|arg
)paren
suffix:semicolon
id|STATIC
r_int
id|xfs_ioc_fsgeometry
c_func
(paren
id|xfs_mount_t
op_star
id|mp
comma
r_void
id|__user
op_star
id|arg
)paren
suffix:semicolon
id|STATIC
r_int
id|xfs_ioc_xattr
c_func
(paren
id|vnode_t
op_star
id|vp
comma
id|xfs_inode_t
op_star
id|ip
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_void
id|__user
op_star
id|arg
)paren
suffix:semicolon
id|STATIC
r_int
id|xfs_ioc_getbmap
c_func
(paren
id|bhv_desc_t
op_star
id|bdp
comma
r_struct
id|file
op_star
id|filp
comma
r_int
id|flags
comma
r_int
r_int
id|cmd
comma
r_void
id|__user
op_star
id|arg
)paren
suffix:semicolon
id|STATIC
r_int
id|xfs_ioc_getbmapx
c_func
(paren
id|bhv_desc_t
op_star
id|bdp
comma
r_void
id|__user
op_star
id|arg
)paren
suffix:semicolon
r_int
DECL|function|xfs_ioctl
id|xfs_ioctl
c_func
(paren
id|bhv_desc_t
op_star
id|bdp
comma
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
comma
r_int
id|ioflags
comma
r_int
r_int
id|cmd
comma
r_void
id|__user
op_star
id|arg
)paren
(brace
r_int
id|error
suffix:semicolon
id|vnode_t
op_star
id|vp
suffix:semicolon
id|xfs_inode_t
op_star
id|ip
suffix:semicolon
id|xfs_mount_t
op_star
id|mp
suffix:semicolon
id|vp
op_assign
id|LINVFS_GET_VP
c_func
(paren
id|inode
)paren
suffix:semicolon
id|vn_trace_entry
c_func
(paren
id|vp
comma
l_string|&quot;xfs_ioctl&quot;
comma
(paren
id|inst_t
op_star
)paren
id|__return_address
)paren
suffix:semicolon
id|ip
op_assign
id|XFS_BHVTOI
c_func
(paren
id|bdp
)paren
suffix:semicolon
id|mp
op_assign
id|ip-&gt;i_mount
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|XFS_IOC_ALLOCSP
suffix:colon
r_case
id|XFS_IOC_FREESP
suffix:colon
r_case
id|XFS_IOC_RESVSP
suffix:colon
r_case
id|XFS_IOC_UNRESVSP
suffix:colon
r_case
id|XFS_IOC_ALLOCSP64
suffix:colon
r_case
id|XFS_IOC_FREESP64
suffix:colon
r_case
id|XFS_IOC_RESVSP64
suffix:colon
r_case
id|XFS_IOC_UNRESVSP64
suffix:colon
multiline_comment|/*&n;&t;&t; * Only allow the sys admin to reserve space unless&n;&t;&t; * unwritten extents are enabled.&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|XFS_SB_VERSION_HASEXTFLGBIT
c_func
(paren
op_amp
id|mp-&gt;m_sb
)paren
op_logical_and
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_return
id|xfs_ioc_space
c_func
(paren
id|bdp
comma
id|vp
comma
id|filp
comma
id|ioflags
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_case
id|XFS_IOC_DIOINFO
suffix:colon
(brace
r_struct
id|dioattr
id|da
suffix:semicolon
id|xfs_buftarg_t
op_star
id|target
op_assign
(paren
id|ip-&gt;i_d.di_flags
op_amp
id|XFS_DIFLAG_REALTIME
)paren
ques
c_cond
id|mp-&gt;m_rtdev_targp
suffix:colon
id|mp-&gt;m_ddev_targp
suffix:semicolon
id|da.d_mem
op_assign
id|da.d_miniosz
op_assign
l_int|1
op_lshift
id|target-&gt;pbr_sshift
suffix:semicolon
multiline_comment|/* The size dio will do in one go */
id|da.d_maxiosz
op_assign
l_int|64
op_star
id|PAGE_CACHE_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|da
comma
r_sizeof
(paren
id|da
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|XFS_IOC_FSBULKSTAT_SINGLE
suffix:colon
r_case
id|XFS_IOC_FSBULKSTAT
suffix:colon
r_case
id|XFS_IOC_FSINUMBERS
suffix:colon
r_return
id|xfs_ioc_bulkstat
c_func
(paren
id|mp
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_case
id|XFS_IOC_FSGEOMETRY_V1
suffix:colon
r_return
id|xfs_ioc_fsgeometry_v1
c_func
(paren
id|mp
comma
id|arg
)paren
suffix:semicolon
r_case
id|XFS_IOC_FSGEOMETRY
suffix:colon
r_return
id|xfs_ioc_fsgeometry
c_func
(paren
id|mp
comma
id|arg
)paren
suffix:semicolon
r_case
id|XFS_IOC_GETVERSION
suffix:colon
r_case
id|XFS_IOC_GETXFLAGS
suffix:colon
r_case
id|XFS_IOC_SETXFLAGS
suffix:colon
r_case
id|XFS_IOC_FSGETXATTR
suffix:colon
r_case
id|XFS_IOC_FSSETXATTR
suffix:colon
r_case
id|XFS_IOC_FSGETXATTRA
suffix:colon
r_return
id|xfs_ioc_xattr
c_func
(paren
id|vp
comma
id|ip
comma
id|filp
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_case
id|XFS_IOC_FSSETDM
suffix:colon
(brace
r_struct
id|fsdmidata
id|dmi
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|dmi
comma
id|arg
comma
r_sizeof
(paren
id|dmi
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
id|error
op_assign
id|xfs_set_dmattrs
c_func
(paren
id|bdp
comma
id|dmi.fsd_dmevmask
comma
id|dmi.fsd_dmstate
comma
l_int|NULL
)paren
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
r_case
id|XFS_IOC_GETBMAP
suffix:colon
r_case
id|XFS_IOC_GETBMAPA
suffix:colon
r_return
id|xfs_ioc_getbmap
c_func
(paren
id|bdp
comma
id|filp
comma
id|ioflags
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_case
id|XFS_IOC_GETBMAPX
suffix:colon
r_return
id|xfs_ioc_getbmapx
c_func
(paren
id|bdp
comma
id|arg
)paren
suffix:semicolon
r_case
id|XFS_IOC_FD_TO_HANDLE
suffix:colon
r_case
id|XFS_IOC_PATH_TO_HANDLE
suffix:colon
r_case
id|XFS_IOC_PATH_TO_FSHANDLE
suffix:colon
r_return
id|xfs_find_handle
c_func
(paren
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_case
id|XFS_IOC_OPEN_BY_HANDLE
suffix:colon
r_return
id|xfs_open_by_handle
c_func
(paren
id|mp
comma
id|arg
comma
id|filp
comma
id|inode
)paren
suffix:semicolon
r_case
id|XFS_IOC_FSSETDM_BY_HANDLE
suffix:colon
r_return
id|xfs_fssetdm_by_handle
c_func
(paren
id|mp
comma
id|arg
comma
id|filp
comma
id|inode
)paren
suffix:semicolon
r_case
id|XFS_IOC_READLINK_BY_HANDLE
suffix:colon
r_return
id|xfs_readlink_by_handle
c_func
(paren
id|mp
comma
id|arg
comma
id|filp
comma
id|inode
)paren
suffix:semicolon
r_case
id|XFS_IOC_ATTRLIST_BY_HANDLE
suffix:colon
r_return
id|xfs_attrlist_by_handle
c_func
(paren
id|mp
comma
id|arg
comma
id|filp
comma
id|inode
)paren
suffix:semicolon
r_case
id|XFS_IOC_ATTRMULTI_BY_HANDLE
suffix:colon
r_return
id|xfs_attrmulti_by_handle
c_func
(paren
id|mp
comma
id|arg
comma
id|filp
comma
id|inode
)paren
suffix:semicolon
r_case
id|XFS_IOC_SWAPEXT
suffix:colon
(brace
id|error
op_assign
id|xfs_swapext
c_func
(paren
(paren
r_struct
id|xfs_swapext
id|__user
op_star
)paren
id|arg
)paren
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
r_case
id|XFS_IOC_FSCOUNTS
suffix:colon
(brace
id|xfs_fsop_counts_t
id|out
suffix:semicolon
id|error
op_assign
id|xfs_fs_counts
c_func
(paren
id|mp
comma
op_amp
id|out
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
op_minus
id|error
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|out
comma
r_sizeof
(paren
id|out
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|XFS_IOC_SET_RESBLKS
suffix:colon
(brace
id|xfs_fsop_resblks_t
id|inout
suffix:semicolon
id|__uint64_t
id|in
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|inout
comma
id|arg
comma
r_sizeof
(paren
id|inout
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
multiline_comment|/* input parameter is passed in resblks field of structure */
id|in
op_assign
id|inout.resblks
suffix:semicolon
id|error
op_assign
id|xfs_reserve_blocks
c_func
(paren
id|mp
comma
op_amp
id|in
comma
op_amp
id|inout
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
op_minus
id|error
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|inout
comma
r_sizeof
(paren
id|inout
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|XFS_IOC_GET_RESBLKS
suffix:colon
(brace
id|xfs_fsop_resblks_t
id|out
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|error
op_assign
id|xfs_reserve_blocks
c_func
(paren
id|mp
comma
l_int|NULL
comma
op_amp
id|out
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
op_minus
id|error
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|out
comma
r_sizeof
(paren
id|out
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|XFS_IOC_FSGROWFSDATA
suffix:colon
(brace
id|xfs_growfs_data_t
id|in
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|in
comma
id|arg
comma
r_sizeof
(paren
id|in
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
id|error
op_assign
id|xfs_growfs_data
c_func
(paren
id|mp
comma
op_amp
id|in
)paren
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
r_case
id|XFS_IOC_FSGROWFSLOG
suffix:colon
(brace
id|xfs_growfs_log_t
id|in
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|in
comma
id|arg
comma
r_sizeof
(paren
id|in
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
id|error
op_assign
id|xfs_growfs_log
c_func
(paren
id|mp
comma
op_amp
id|in
)paren
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
r_case
id|XFS_IOC_FSGROWFSRT
suffix:colon
(brace
id|xfs_growfs_rt_t
id|in
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|in
comma
id|arg
comma
r_sizeof
(paren
id|in
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
id|error
op_assign
id|xfs_growfs_rt
c_func
(paren
id|mp
comma
op_amp
id|in
)paren
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
r_case
id|XFS_IOC_FREEZE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|inode-&gt;i_sb-&gt;s_frozen
op_eq
id|SB_UNFROZEN
)paren
id|freeze_bdev
c_func
(paren
id|inode-&gt;i_sb-&gt;s_bdev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|XFS_IOC_THAW
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|inode-&gt;i_sb-&gt;s_frozen
op_ne
id|SB_UNFROZEN
)paren
id|thaw_bdev
c_func
(paren
id|inode-&gt;i_sb-&gt;s_bdev
comma
id|inode-&gt;i_sb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|XFS_IOC_GOINGDOWN
suffix:colon
(brace
id|__uint32_t
id|in
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|in
comma
(paren
id|__uint32_t
id|__user
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
id|error
op_assign
id|xfs_fs_goingdown
c_func
(paren
id|mp
comma
id|in
)paren
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
r_case
id|XFS_IOC_ERROR_INJECTION
suffix:colon
(brace
id|xfs_error_injection_t
id|in
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|in
comma
id|arg
comma
r_sizeof
(paren
id|in
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
id|error
op_assign
id|xfs_errortag_add
c_func
(paren
id|in.errtag
comma
id|mp
)paren
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
r_case
id|XFS_IOC_ERROR_CLEARALL
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
id|error
op_assign
id|xfs_errortag_clearall
c_func
(paren
id|mp
)paren
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENOTTY
suffix:semicolon
)brace
)brace
id|STATIC
r_int
DECL|function|xfs_ioc_space
id|xfs_ioc_space
c_func
(paren
id|bhv_desc_t
op_star
id|bdp
comma
id|vnode_t
op_star
id|vp
comma
r_struct
id|file
op_star
id|filp
comma
r_int
id|ioflags
comma
r_int
r_int
id|cmd
comma
r_void
id|__user
op_star
id|arg
)paren
(brace
id|xfs_flock64_t
id|bf
suffix:semicolon
r_int
id|attr_flags
op_assign
l_int|0
suffix:semicolon
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;v_inode.i_flags
op_amp
(paren
id|S_IMMUTABLE
op_or
id|S_APPEND
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EPERM
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|filp-&gt;f_flags
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EBADF
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vp-&gt;v_type
op_ne
id|VREG
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|bf
comma
id|arg
comma
r_sizeof
(paren
id|bf
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|filp-&gt;f_flags
op_amp
(paren
id|O_NDELAY
op_or
id|O_NONBLOCK
)paren
)paren
id|attr_flags
op_or_assign
id|ATTR_NONBLOCK
suffix:semicolon
r_if
c_cond
(paren
id|ioflags
op_amp
id|IO_INVIS
)paren
id|attr_flags
op_or_assign
id|ATTR_DMI
suffix:semicolon
id|error
op_assign
id|xfs_change_file_space
c_func
(paren
id|bdp
comma
id|cmd
comma
op_amp
id|bf
comma
id|filp-&gt;f_pos
comma
l_int|NULL
comma
id|attr_flags
)paren
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
id|STATIC
r_int
DECL|function|xfs_ioc_bulkstat
id|xfs_ioc_bulkstat
c_func
(paren
id|xfs_mount_t
op_star
id|mp
comma
r_int
r_int
id|cmd
comma
r_void
id|__user
op_star
id|arg
)paren
(brace
id|xfs_fsop_bulkreq_t
id|bulkreq
suffix:semicolon
r_int
id|count
suffix:semicolon
multiline_comment|/* # of records returned */
id|xfs_ino_t
id|inlast
suffix:semicolon
multiline_comment|/* last inode number */
r_int
id|done
suffix:semicolon
r_int
id|error
suffix:semicolon
multiline_comment|/* done = 1 if there are more stats to get and if bulkstat */
multiline_comment|/* should be called again (unused here, but used in dmapi) */
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_SYS_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|XFS_FORCED_SHUTDOWN
c_func
(paren
id|mp
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EIO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|bulkreq
comma
id|arg
comma
r_sizeof
(paren
id|xfs_fsop_bulkreq_t
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|inlast
comma
id|bulkreq.lastip
comma
r_sizeof
(paren
id|__s64
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|count
op_assign
id|bulkreq.icount
)paren
op_le
l_int|0
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|XFS_IOC_FSINUMBERS
)paren
id|error
op_assign
id|xfs_inumbers
c_func
(paren
id|mp
comma
op_amp
id|inlast
comma
op_amp
id|count
comma
id|bulkreq.ubuffer
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|cmd
op_eq
id|XFS_IOC_FSBULKSTAT_SINGLE
)paren
id|error
op_assign
id|xfs_bulkstat_single
c_func
(paren
id|mp
comma
op_amp
id|inlast
comma
id|bulkreq.ubuffer
comma
op_amp
id|done
)paren
suffix:semicolon
r_else
(brace
multiline_comment|/* XFS_IOC_FSBULKSTAT */
r_if
c_cond
(paren
id|count
op_eq
l_int|1
op_logical_and
id|inlast
op_ne
l_int|0
)paren
(brace
id|inlast
op_increment
suffix:semicolon
id|error
op_assign
id|xfs_bulkstat_single
c_func
(paren
id|mp
comma
op_amp
id|inlast
comma
id|bulkreq.ubuffer
comma
op_amp
id|done
)paren
suffix:semicolon
)brace
r_else
(brace
id|error
op_assign
id|xfs_bulkstat
c_func
(paren
id|mp
comma
op_amp
id|inlast
comma
op_amp
id|count
comma
(paren
id|bulkstat_one_pf
)paren
id|xfs_bulkstat_one
comma
l_int|NULL
comma
r_sizeof
(paren
id|xfs_bstat_t
)paren
comma
id|bulkreq.ubuffer
comma
id|BULKSTAT_FG_QUICK
comma
op_amp
id|done
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|error
)paren
r_return
op_minus
id|error
suffix:semicolon
r_if
c_cond
(paren
id|bulkreq.ocount
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|bulkreq.lastip
comma
op_amp
id|inlast
comma
r_sizeof
(paren
id|xfs_ino_t
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|bulkreq.ocount
comma
op_amp
id|count
comma
r_sizeof
(paren
id|count
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
id|STATIC
r_int
DECL|function|xfs_ioc_fsgeometry_v1
id|xfs_ioc_fsgeometry_v1
c_func
(paren
id|xfs_mount_t
op_star
id|mp
comma
r_void
id|__user
op_star
id|arg
)paren
(brace
id|xfs_fsop_geom_v1_t
id|fsgeo
suffix:semicolon
r_int
id|error
suffix:semicolon
id|error
op_assign
id|xfs_fs_geometry
c_func
(paren
id|mp
comma
(paren
id|xfs_fsop_geom_t
op_star
)paren
op_amp
id|fsgeo
comma
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
op_minus
id|error
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|fsgeo
comma
r_sizeof
(paren
id|fsgeo
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|STATIC
r_int
DECL|function|xfs_ioc_fsgeometry
id|xfs_ioc_fsgeometry
c_func
(paren
id|xfs_mount_t
op_star
id|mp
comma
r_void
id|__user
op_star
id|arg
)paren
(brace
id|xfs_fsop_geom_t
id|fsgeo
suffix:semicolon
r_int
id|error
suffix:semicolon
id|error
op_assign
id|xfs_fs_geometry
c_func
(paren
id|mp
comma
op_amp
id|fsgeo
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
op_minus
id|error
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|fsgeo
comma
r_sizeof
(paren
id|fsgeo
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Linux extended inode flags interface.&n; */
DECL|macro|LINUX_XFLAG_SYNC
mdefine_line|#define LINUX_XFLAG_SYNC&t;0x00000008 /* Synchronous updates */
DECL|macro|LINUX_XFLAG_IMMUTABLE
mdefine_line|#define LINUX_XFLAG_IMMUTABLE&t;0x00000010 /* Immutable file */
DECL|macro|LINUX_XFLAG_APPEND
mdefine_line|#define LINUX_XFLAG_APPEND&t;0x00000020 /* writes to file may only append */
DECL|macro|LINUX_XFLAG_NODUMP
mdefine_line|#define LINUX_XFLAG_NODUMP&t;0x00000040 /* do not dump file */
DECL|macro|LINUX_XFLAG_NOATIME
mdefine_line|#define LINUX_XFLAG_NOATIME&t;0x00000080 /* do not update atime */
id|STATIC
r_int
r_int
DECL|function|xfs_merge_ioc_xflags
id|xfs_merge_ioc_xflags
c_func
(paren
r_int
r_int
id|flags
comma
r_int
r_int
id|start
)paren
(brace
r_int
r_int
id|xflags
op_assign
id|start
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|LINUX_XFLAG_IMMUTABLE
)paren
id|xflags
op_or_assign
id|XFS_XFLAG_IMMUTABLE
suffix:semicolon
r_else
id|xflags
op_and_assign
op_complement
id|XFS_XFLAG_IMMUTABLE
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|LINUX_XFLAG_APPEND
)paren
id|xflags
op_or_assign
id|XFS_XFLAG_APPEND
suffix:semicolon
r_else
id|xflags
op_and_assign
op_complement
id|XFS_XFLAG_APPEND
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|LINUX_XFLAG_SYNC
)paren
id|xflags
op_or_assign
id|XFS_XFLAG_SYNC
suffix:semicolon
r_else
id|xflags
op_and_assign
op_complement
id|XFS_XFLAG_SYNC
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|LINUX_XFLAG_NOATIME
)paren
id|xflags
op_or_assign
id|XFS_XFLAG_NOATIME
suffix:semicolon
r_else
id|xflags
op_and_assign
op_complement
id|XFS_XFLAG_NOATIME
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|LINUX_XFLAG_NODUMP
)paren
id|xflags
op_or_assign
id|XFS_XFLAG_NODUMP
suffix:semicolon
r_else
id|xflags
op_and_assign
op_complement
id|XFS_XFLAG_NODUMP
suffix:semicolon
r_return
id|xflags
suffix:semicolon
)brace
id|STATIC
r_int
r_int
DECL|function|xfs_di2lxflags
id|xfs_di2lxflags
c_func
(paren
id|__uint16_t
id|di_flags
)paren
(brace
r_int
r_int
id|flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|di_flags
op_amp
id|XFS_DIFLAG_IMMUTABLE
)paren
id|flags
op_or_assign
id|LINUX_XFLAG_IMMUTABLE
suffix:semicolon
r_if
c_cond
(paren
id|di_flags
op_amp
id|XFS_DIFLAG_APPEND
)paren
id|flags
op_or_assign
id|LINUX_XFLAG_APPEND
suffix:semicolon
r_if
c_cond
(paren
id|di_flags
op_amp
id|XFS_DIFLAG_SYNC
)paren
id|flags
op_or_assign
id|LINUX_XFLAG_SYNC
suffix:semicolon
r_if
c_cond
(paren
id|di_flags
op_amp
id|XFS_DIFLAG_NOATIME
)paren
id|flags
op_or_assign
id|LINUX_XFLAG_NOATIME
suffix:semicolon
r_if
c_cond
(paren
id|di_flags
op_amp
id|XFS_DIFLAG_NODUMP
)paren
id|flags
op_or_assign
id|LINUX_XFLAG_NODUMP
suffix:semicolon
r_return
id|flags
suffix:semicolon
)brace
id|STATIC
r_int
DECL|function|xfs_ioc_xattr
id|xfs_ioc_xattr
c_func
(paren
id|vnode_t
op_star
id|vp
comma
id|xfs_inode_t
op_star
id|ip
comma
r_struct
id|file
op_star
id|filp
comma
r_int
r_int
id|cmd
comma
r_void
id|__user
op_star
id|arg
)paren
(brace
r_struct
id|fsxattr
id|fa
suffix:semicolon
id|vattr_t
id|va
suffix:semicolon
r_int
id|error
suffix:semicolon
r_int
id|attr_flags
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|XFS_IOC_FSGETXATTR
suffix:colon
(brace
id|va.va_mask
op_assign
id|XFS_AT_XFLAGS
op_or
id|XFS_AT_EXTSIZE
op_or
id|XFS_AT_NEXTENTS
suffix:semicolon
id|VOP_GETATTR
c_func
(paren
id|vp
comma
op_amp
id|va
comma
l_int|0
comma
l_int|NULL
comma
id|error
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
op_minus
id|error
suffix:semicolon
id|fa.fsx_xflags
op_assign
id|va.va_xflags
suffix:semicolon
id|fa.fsx_extsize
op_assign
id|va.va_extsize
suffix:semicolon
id|fa.fsx_nextents
op_assign
id|va.va_nextents
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|fa
comma
r_sizeof
(paren
id|fa
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|XFS_IOC_FSSETXATTR
suffix:colon
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|fa
comma
id|arg
comma
r_sizeof
(paren
id|fa
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
id|attr_flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|filp-&gt;f_flags
op_amp
(paren
id|O_NDELAY
op_or
id|O_NONBLOCK
)paren
)paren
id|attr_flags
op_or_assign
id|ATTR_NONBLOCK
suffix:semicolon
id|va.va_mask
op_assign
id|XFS_AT_XFLAGS
op_or
id|XFS_AT_EXTSIZE
suffix:semicolon
id|va.va_xflags
op_assign
id|fa.fsx_xflags
suffix:semicolon
id|va.va_extsize
op_assign
id|fa.fsx_extsize
suffix:semicolon
id|VOP_SETATTR
c_func
(paren
id|vp
comma
op_amp
id|va
comma
id|attr_flags
comma
l_int|NULL
comma
id|error
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
id|vn_revalidate
c_func
(paren
id|vp
)paren
suffix:semicolon
multiline_comment|/* update Linux inode flags */
r_return
op_minus
id|error
suffix:semicolon
)brace
r_case
id|XFS_IOC_FSGETXATTRA
suffix:colon
(brace
id|va.va_mask
op_assign
id|XFS_AT_XFLAGS
op_or
id|XFS_AT_EXTSIZE
op_or
id|XFS_AT_ANEXTENTS
suffix:semicolon
id|VOP_GETATTR
c_func
(paren
id|vp
comma
op_amp
id|va
comma
l_int|0
comma
l_int|NULL
comma
id|error
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
op_minus
id|error
suffix:semicolon
id|fa.fsx_xflags
op_assign
id|va.va_xflags
suffix:semicolon
id|fa.fsx_extsize
op_assign
id|va.va_extsize
suffix:semicolon
id|fa.fsx_nextents
op_assign
id|va.va_anextents
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|fa
comma
r_sizeof
(paren
id|fa
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|XFS_IOC_GETXFLAGS
suffix:colon
(brace
id|flags
op_assign
id|xfs_di2lxflags
c_func
(paren
id|ip-&gt;i_d.di_flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|flags
comma
r_sizeof
(paren
id|flags
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|XFS_IOC_SETXFLAGS
suffix:colon
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|flags
comma
id|arg
comma
r_sizeof
(paren
id|flags
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
op_complement
(paren
id|LINUX_XFLAG_IMMUTABLE
op_or
id|LINUX_XFLAG_APPEND
op_or
"&bslash;"
id|LINUX_XFLAG_NOATIME
op_or
id|LINUX_XFLAG_NODUMP
op_or
"&bslash;"
id|LINUX_XFLAG_SYNC
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EOPNOTSUPP
)paren
suffix:semicolon
id|attr_flags
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|filp-&gt;f_flags
op_amp
(paren
id|O_NDELAY
op_or
id|O_NONBLOCK
)paren
)paren
id|attr_flags
op_or_assign
id|ATTR_NONBLOCK
suffix:semicolon
id|va.va_mask
op_assign
id|XFS_AT_XFLAGS
suffix:semicolon
id|va.va_xflags
op_assign
id|xfs_merge_ioc_xflags
c_func
(paren
id|flags
comma
id|xfs_dic2xflags
c_func
(paren
op_amp
id|ip-&gt;i_d
comma
id|ARCH_NOCONVERT
)paren
)paren
suffix:semicolon
id|VOP_SETATTR
c_func
(paren
id|vp
comma
op_amp
id|va
comma
id|attr_flags
comma
l_int|NULL
comma
id|error
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
id|vn_revalidate
c_func
(paren
id|vp
)paren
suffix:semicolon
multiline_comment|/* update Linux inode flags */
r_return
op_minus
id|error
suffix:semicolon
)brace
r_case
id|XFS_IOC_GETVERSION
suffix:colon
(brace
id|flags
op_assign
id|LINVFS_GET_IP
c_func
(paren
id|vp
)paren
op_member_access_from_pointer
id|i_generation
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|flags
comma
r_sizeof
(paren
id|flags
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|ENOTTY
suffix:semicolon
)brace
)brace
id|STATIC
r_int
DECL|function|xfs_ioc_getbmap
id|xfs_ioc_getbmap
c_func
(paren
id|bhv_desc_t
op_star
id|bdp
comma
r_struct
id|file
op_star
id|filp
comma
r_int
id|ioflags
comma
r_int
r_int
id|cmd
comma
r_void
id|__user
op_star
id|arg
)paren
(brace
r_struct
id|getbmap
id|bm
suffix:semicolon
r_int
id|iflags
suffix:semicolon
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|bm
comma
id|arg
comma
r_sizeof
(paren
id|bm
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bm.bmv_count
OL
l_int|2
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
id|iflags
op_assign
(paren
id|cmd
op_eq
id|XFS_IOC_GETBMAPA
ques
c_cond
id|BMV_IF_ATTRFORK
suffix:colon
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ioflags
op_amp
id|IO_INVIS
)paren
id|iflags
op_or_assign
id|BMV_IF_NO_DMAPI_READ
suffix:semicolon
id|error
op_assign
id|xfs_getbmap
c_func
(paren
id|bdp
comma
op_amp
id|bm
comma
(paren
r_struct
id|getbmap
id|__user
op_star
)paren
id|arg
op_plus
l_int|1
comma
id|iflags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
op_minus
id|error
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|bm
comma
r_sizeof
(paren
id|bm
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|STATIC
r_int
DECL|function|xfs_ioc_getbmapx
id|xfs_ioc_getbmapx
c_func
(paren
id|bhv_desc_t
op_star
id|bdp
comma
r_void
id|__user
op_star
id|arg
)paren
(brace
r_struct
id|getbmapx
id|bmx
suffix:semicolon
r_struct
id|getbmap
id|bm
suffix:semicolon
r_int
id|iflags
suffix:semicolon
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|bmx
comma
id|arg
comma
r_sizeof
(paren
id|bmx
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmx.bmv_count
OL
l_int|2
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Map input getbmapx structure to a getbmap&n;&t; * structure for xfs_getbmap.&n;&t; */
id|GETBMAP_CONVERT
c_func
(paren
id|bmx
comma
id|bm
)paren
suffix:semicolon
id|iflags
op_assign
id|bmx.bmv_iflags
suffix:semicolon
r_if
c_cond
(paren
id|iflags
op_amp
(paren
op_complement
id|BMV_IF_VALID
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EINVAL
)paren
suffix:semicolon
id|iflags
op_or_assign
id|BMV_IF_EXTENDED
suffix:semicolon
id|error
op_assign
id|xfs_getbmap
c_func
(paren
id|bdp
comma
op_amp
id|bm
comma
(paren
r_struct
id|getbmapx
id|__user
op_star
)paren
id|arg
op_plus
l_int|1
comma
id|iflags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
op_minus
id|error
suffix:semicolon
id|GETBMAP_CONVERT
c_func
(paren
id|bm
comma
id|bmx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|bmx
comma
r_sizeof
(paren
id|bmx
)paren
)paren
)paren
r_return
op_minus
id|XFS_ERROR
c_func
(paren
id|EFAULT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
