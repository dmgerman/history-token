multiline_comment|/*&n; * Copyright (c) 2000-2001 Silicon Graphics, Inc.  All Rights Reserved.&n; *&n; * This program is free software; you can redistribute it and/or modify it&n; * under the terms of version 2 of the GNU General Public License as&n; * published by the Free Software Foundation.&n; *&n; * This program is distributed in the hope that it would be useful, but&n; * WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&n; *&n; * Further, this software is distributed without any warranty that it is&n; * free of the rightful claim of any third person regarding infringement&n; * or the like.&t; Any license provided herein, whether implied or&n; * otherwise, applies only to this software file.  Patent licenses, if&n; * any, provided herein do not apply to combinations of this program with&n; * other software, or any other product whatsoever.&n; *&n; * You should have received a copy of the GNU General Public License along&n; * with this program; if not, write the Free Software Foundation, Inc., 59&n; * Temple Place - Suite 330, Boston MA 02111-1307, USA.&n; *&n; * Contact information: Silicon Graphics, Inc., 1600 Amphitheatre Pkwy,&n; * Mountain View, CA  94043, or:&n; *&n; * http://www.sgi.com&n; *&n; * For further information regarding this notice, see:&n; *&n; * http://oss.sgi.com/projects/GenInfo/SGIGPLNoticeExplan/&n; */
macro_line|#include &lt;xfs.h&gt;
macro_line|#ifdef DEBUG
DECL|variable|xfs_bmbt_trace_buf
id|ktrace_t
op_star
id|xfs_bmbt_trace_buf
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; * Prototypes for internal btree functions.&n; */
id|STATIC
r_int
id|xfs_bmbt_killroot
c_func
(paren
id|xfs_btree_cur_t
op_star
comma
r_int
)paren
suffix:semicolon
id|STATIC
r_void
id|xfs_bmbt_log_keys
c_func
(paren
id|xfs_btree_cur_t
op_star
comma
id|xfs_buf_t
op_star
comma
r_int
comma
r_int
)paren
suffix:semicolon
id|STATIC
r_void
id|xfs_bmbt_log_ptrs
c_func
(paren
id|xfs_btree_cur_t
op_star
comma
id|xfs_buf_t
op_star
comma
r_int
comma
r_int
)paren
suffix:semicolon
id|STATIC
r_int
id|xfs_bmbt_lshift
c_func
(paren
id|xfs_btree_cur_t
op_star
comma
r_int
comma
r_int
op_star
)paren
suffix:semicolon
id|STATIC
r_int
id|xfs_bmbt_rshift
c_func
(paren
id|xfs_btree_cur_t
op_star
comma
r_int
comma
r_int
op_star
)paren
suffix:semicolon
id|STATIC
r_int
id|xfs_bmbt_split
c_func
(paren
id|xfs_btree_cur_t
op_star
comma
r_int
comma
id|xfs_fsblock_t
op_star
comma
id|xfs_bmbt_key_t
op_star
comma
id|xfs_btree_cur_t
op_star
op_star
comma
r_int
op_star
)paren
suffix:semicolon
id|STATIC
r_int
id|xfs_bmbt_updkey
c_func
(paren
id|xfs_btree_cur_t
op_star
comma
id|xfs_bmbt_key_t
op_star
comma
r_int
)paren
suffix:semicolon
macro_line|#if defined(XFS_BMBT_TRACE)
multiline_comment|/*&n; * Add a trace buffer entry for the arguments given to the routine,&n; * generic form.&n; */
id|STATIC
r_void
DECL|function|xfs_bmbt_trace_enter
id|xfs_bmbt_trace_enter
c_func
(paren
r_char
op_star
id|func
comma
id|xfs_btree_cur_t
op_star
id|cur
comma
r_char
op_star
id|s
comma
r_int
id|type
comma
r_int
id|line
comma
id|__psunsigned_t
id|a0
comma
id|__psunsigned_t
id|a1
comma
id|__psunsigned_t
id|a2
comma
id|__psunsigned_t
id|a3
comma
id|__psunsigned_t
id|a4
comma
id|__psunsigned_t
id|a5
comma
id|__psunsigned_t
id|a6
comma
id|__psunsigned_t
id|a7
comma
id|__psunsigned_t
id|a8
comma
id|__psunsigned_t
id|a9
comma
id|__psunsigned_t
id|a10
)paren
(brace
id|xfs_inode_t
op_star
id|ip
suffix:semicolon
r_int
id|whichfork
suffix:semicolon
id|ip
op_assign
id|cur-&gt;bc_private.b.ip
suffix:semicolon
id|whichfork
op_assign
id|cur-&gt;bc_private.b.whichfork
suffix:semicolon
id|ktrace_enter
c_func
(paren
id|xfs_bmbt_trace_buf
comma
(paren
r_void
op_star
)paren
(paren
(paren
id|__psint_t
)paren
id|type
op_or
(paren
id|whichfork
op_lshift
l_int|8
)paren
op_or
(paren
id|line
op_lshift
l_int|16
)paren
)paren
comma
(paren
r_void
op_star
)paren
id|func
comma
(paren
r_void
op_star
)paren
id|s
comma
(paren
r_void
op_star
)paren
id|ip
comma
(paren
r_void
op_star
)paren
id|cur
comma
(paren
r_void
op_star
)paren
id|a0
comma
(paren
r_void
op_star
)paren
id|a1
comma
(paren
r_void
op_star
)paren
id|a2
comma
(paren
r_void
op_star
)paren
id|a3
comma
(paren
r_void
op_star
)paren
id|a4
comma
(paren
r_void
op_star
)paren
id|a5
comma
(paren
r_void
op_star
)paren
id|a6
comma
(paren
r_void
op_star
)paren
id|a7
comma
(paren
r_void
op_star
)paren
id|a8
comma
(paren
r_void
op_star
)paren
id|a9
comma
(paren
r_void
op_star
)paren
id|a10
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|ip-&gt;i_btrace
)paren
suffix:semicolon
id|ktrace_enter
c_func
(paren
id|ip-&gt;i_btrace
comma
(paren
r_void
op_star
)paren
(paren
(paren
id|__psint_t
)paren
id|type
op_or
(paren
id|whichfork
op_lshift
l_int|8
)paren
op_or
(paren
id|line
op_lshift
l_int|16
)paren
)paren
comma
(paren
r_void
op_star
)paren
id|func
comma
(paren
r_void
op_star
)paren
id|s
comma
(paren
r_void
op_star
)paren
id|ip
comma
(paren
r_void
op_star
)paren
id|cur
comma
(paren
r_void
op_star
)paren
id|a0
comma
(paren
r_void
op_star
)paren
id|a1
comma
(paren
r_void
op_star
)paren
id|a2
comma
(paren
r_void
op_star
)paren
id|a3
comma
(paren
r_void
op_star
)paren
id|a4
comma
(paren
r_void
op_star
)paren
id|a5
comma
(paren
r_void
op_star
)paren
id|a6
comma
(paren
r_void
op_star
)paren
id|a7
comma
(paren
r_void
op_star
)paren
id|a8
comma
(paren
r_void
op_star
)paren
id|a9
comma
(paren
r_void
op_star
)paren
id|a10
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Add a trace buffer entry for arguments, for a buffer &amp; 1 integer arg.&n; */
id|STATIC
r_void
DECL|function|xfs_bmbt_trace_argbi
id|xfs_bmbt_trace_argbi
c_func
(paren
r_char
op_star
id|func
comma
id|xfs_btree_cur_t
op_star
id|cur
comma
id|xfs_buf_t
op_star
id|b
comma
r_int
id|i
comma
r_int
id|line
)paren
(brace
id|xfs_bmbt_trace_enter
c_func
(paren
id|func
comma
id|cur
comma
id|ARGS
comma
id|XFS_BMBT_KTRACE_ARGBI
comma
id|line
comma
(paren
id|__psunsigned_t
)paren
id|b
comma
id|i
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Add a trace buffer entry for arguments, for a buffer &amp; 2 integer args.&n; */
id|STATIC
r_void
DECL|function|xfs_bmbt_trace_argbii
id|xfs_bmbt_trace_argbii
c_func
(paren
r_char
op_star
id|func
comma
id|xfs_btree_cur_t
op_star
id|cur
comma
id|xfs_buf_t
op_star
id|b
comma
r_int
id|i0
comma
r_int
id|i1
comma
r_int
id|line
)paren
(brace
id|xfs_bmbt_trace_enter
c_func
(paren
id|func
comma
id|cur
comma
id|ARGS
comma
id|XFS_BMBT_KTRACE_ARGBII
comma
id|line
comma
(paren
id|__psunsigned_t
)paren
id|b
comma
id|i0
comma
id|i1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Add a trace buffer entry for arguments, for 3 block-length args&n; * and an integer arg.&n; */
id|STATIC
r_void
DECL|function|xfs_bmbt_trace_argfffi
id|xfs_bmbt_trace_argfffi
c_func
(paren
r_char
op_star
id|func
comma
id|xfs_btree_cur_t
op_star
id|cur
comma
id|xfs_dfiloff_t
id|o
comma
id|xfs_dfsbno_t
id|b
comma
id|xfs_dfilblks_t
id|i
comma
r_int
id|j
comma
r_int
id|line
)paren
(brace
id|xfs_bmbt_trace_enter
c_func
(paren
id|func
comma
id|cur
comma
id|ARGS
comma
id|XFS_BMBT_KTRACE_ARGFFFI
comma
id|line
comma
id|o
op_rshift
l_int|32
comma
(paren
r_int
)paren
id|o
comma
id|b
op_rshift
l_int|32
comma
(paren
r_int
)paren
id|b
comma
id|i
op_rshift
l_int|32
comma
(paren
r_int
)paren
id|i
comma
(paren
r_int
)paren
id|j
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Add a trace buffer entry for arguments, for one integer arg.&n; */
id|STATIC
r_void
DECL|function|xfs_bmbt_trace_argi
id|xfs_bmbt_trace_argi
c_func
(paren
r_char
op_star
id|func
comma
id|xfs_btree_cur_t
op_star
id|cur
comma
r_int
id|i
comma
r_int
id|line
)paren
(brace
id|xfs_bmbt_trace_enter
c_func
(paren
id|func
comma
id|cur
comma
id|ARGS
comma
id|XFS_BMBT_KTRACE_ARGI
comma
id|line
comma
id|i
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Add a trace buffer entry for arguments, for int, fsblock, key.&n; */
id|STATIC
r_void
DECL|function|xfs_bmbt_trace_argifk
id|xfs_bmbt_trace_argifk
c_func
(paren
r_char
op_star
id|func
comma
id|xfs_btree_cur_t
op_star
id|cur
comma
r_int
id|i
comma
id|xfs_fsblock_t
id|f
comma
id|xfs_bmbt_key_t
op_star
id|k
comma
r_int
id|line
)paren
(brace
id|xfs_dfsbno_t
id|d
suffix:semicolon
id|xfs_dfiloff_t
id|o
suffix:semicolon
id|d
op_assign
(paren
id|xfs_dfsbno_t
)paren
id|f
suffix:semicolon
id|o
op_assign
id|INT_GET
c_func
(paren
id|k-&gt;br_startoff
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
id|xfs_bmbt_trace_enter
c_func
(paren
id|func
comma
id|cur
comma
id|ARGS
comma
id|XFS_BMBT_KTRACE_ARGIFK
comma
id|line
comma
id|i
comma
id|d
op_rshift
l_int|32
comma
(paren
r_int
)paren
id|d
comma
id|o
op_rshift
l_int|32
comma
(paren
r_int
)paren
id|o
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Add a trace buffer entry for arguments, for int, fsblock, rec.&n; */
id|STATIC
r_void
DECL|function|xfs_bmbt_trace_argifr
id|xfs_bmbt_trace_argifr
c_func
(paren
r_char
op_star
id|func
comma
id|xfs_btree_cur_t
op_star
id|cur
comma
r_int
id|i
comma
id|xfs_fsblock_t
id|f
comma
id|xfs_bmbt_rec_t
op_star
id|r
comma
r_int
id|line
)paren
(brace
id|xfs_dfsbno_t
id|b
suffix:semicolon
id|xfs_dfilblks_t
id|c
suffix:semicolon
id|xfs_dfsbno_t
id|d
suffix:semicolon
id|xfs_dfiloff_t
id|o
suffix:semicolon
id|xfs_bmbt_irec_t
id|s
suffix:semicolon
id|d
op_assign
(paren
id|xfs_dfsbno_t
)paren
id|f
suffix:semicolon
id|xfs_bmbt_disk_get_all
c_func
(paren
id|r
comma
op_amp
id|s
)paren
suffix:semicolon
id|o
op_assign
(paren
id|xfs_dfiloff_t
)paren
id|s.br_startoff
suffix:semicolon
id|b
op_assign
(paren
id|xfs_dfsbno_t
)paren
id|s.br_startblock
suffix:semicolon
id|c
op_assign
id|s.br_blockcount
suffix:semicolon
id|xfs_bmbt_trace_enter
c_func
(paren
id|func
comma
id|cur
comma
id|ARGS
comma
id|XFS_BMBT_KTRACE_ARGIFR
comma
id|line
comma
id|i
comma
id|d
op_rshift
l_int|32
comma
(paren
r_int
)paren
id|d
comma
id|o
op_rshift
l_int|32
comma
(paren
r_int
)paren
id|o
comma
id|b
op_rshift
l_int|32
comma
(paren
r_int
)paren
id|b
comma
id|c
op_rshift
l_int|32
comma
(paren
r_int
)paren
id|c
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Add a trace buffer entry for arguments, for int, key.&n; */
id|STATIC
r_void
DECL|function|xfs_bmbt_trace_argik
id|xfs_bmbt_trace_argik
c_func
(paren
r_char
op_star
id|func
comma
id|xfs_btree_cur_t
op_star
id|cur
comma
r_int
id|i
comma
id|xfs_bmbt_key_t
op_star
id|k
comma
r_int
id|line
)paren
(brace
id|xfs_dfiloff_t
id|o
suffix:semicolon
id|o
op_assign
id|INT_GET
c_func
(paren
id|k-&gt;br_startoff
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
id|xfs_bmbt_trace_enter
c_func
(paren
id|func
comma
id|cur
comma
id|ARGS
comma
id|XFS_BMBT_KTRACE_ARGIFK
comma
id|line
comma
id|i
comma
id|o
op_rshift
l_int|32
comma
(paren
r_int
)paren
id|o
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Add a trace buffer entry for the cursor/operation.&n; */
id|STATIC
r_void
DECL|function|xfs_bmbt_trace_cursor
id|xfs_bmbt_trace_cursor
c_func
(paren
r_char
op_star
id|func
comma
id|xfs_btree_cur_t
op_star
id|cur
comma
r_char
op_star
id|s
comma
r_int
id|line
)paren
(brace
id|xfs_bmbt_rec_t
id|r
suffix:semicolon
id|xfs_bmbt_set_all
c_func
(paren
op_amp
id|r
comma
op_amp
id|cur-&gt;bc_rec.b
)paren
suffix:semicolon
id|xfs_bmbt_trace_enter
c_func
(paren
id|func
comma
id|cur
comma
id|s
comma
id|XFS_BMBT_KTRACE_CUR
comma
id|line
comma
(paren
id|cur-&gt;bc_nlevels
op_lshift
l_int|24
)paren
op_or
(paren
id|cur-&gt;bc_private.b.flags
op_lshift
l_int|16
)paren
op_or
id|cur-&gt;bc_private.b.allocated
comma
id|INT_GET
c_func
(paren
id|r.l0
comma
id|ARCH_CONVERT
)paren
op_rshift
l_int|32
comma
(paren
r_int
)paren
id|INT_GET
c_func
(paren
id|r.l0
comma
id|ARCH_CONVERT
)paren
comma
id|INT_GET
c_func
(paren
id|r.l1
comma
id|ARCH_CONVERT
)paren
op_rshift
l_int|32
comma
(paren
r_int
)paren
id|INT_GET
c_func
(paren
id|r.l1
comma
id|ARCH_CONVERT
)paren
comma
(paren
r_int
r_int
)paren
id|cur-&gt;bc_bufs
(braket
l_int|0
)braket
comma
(paren
r_int
r_int
)paren
id|cur-&gt;bc_bufs
(braket
l_int|1
)braket
comma
(paren
r_int
r_int
)paren
id|cur-&gt;bc_bufs
(braket
l_int|2
)braket
comma
(paren
r_int
r_int
)paren
id|cur-&gt;bc_bufs
(braket
l_int|3
)braket
comma
(paren
id|cur-&gt;bc_ptrs
(braket
l_int|0
)braket
op_lshift
l_int|16
)paren
op_or
id|cur-&gt;bc_ptrs
(braket
l_int|1
)braket
comma
(paren
id|cur-&gt;bc_ptrs
(braket
l_int|2
)braket
op_lshift
l_int|16
)paren
op_or
id|cur-&gt;bc_ptrs
(braket
l_int|3
)braket
)paren
suffix:semicolon
)brace
DECL|macro|XFS_BMBT_TRACE_ARGBI
mdefine_line|#define XFS_BMBT_TRACE_ARGBI(c,b,i)&t;&bslash;&n;&t;xfs_bmbt_trace_argbi(fname, c, b, i, __LINE__)
DECL|macro|XFS_BMBT_TRACE_ARGBII
mdefine_line|#define XFS_BMBT_TRACE_ARGBII(c,b,i,j)&t;&bslash;&n;&t;xfs_bmbt_trace_argbii(fname, c, b, i, j, __LINE__)
DECL|macro|XFS_BMBT_TRACE_ARGFFFI
mdefine_line|#define XFS_BMBT_TRACE_ARGFFFI(c,o,b,i,j)&t;&bslash;&n;&t;xfs_bmbt_trace_argfffi(fname, c, o, b, i, j, __LINE__)
DECL|macro|XFS_BMBT_TRACE_ARGI
mdefine_line|#define XFS_BMBT_TRACE_ARGI(c,i)&t;&bslash;&n;&t;xfs_bmbt_trace_argi(fname, c, i, __LINE__)
DECL|macro|XFS_BMBT_TRACE_ARGIFK
mdefine_line|#define XFS_BMBT_TRACE_ARGIFK(c,i,f,k)&t;&bslash;&n;&t;xfs_bmbt_trace_argifk(fname, c, i, f, k, __LINE__)
DECL|macro|XFS_BMBT_TRACE_ARGIFR
mdefine_line|#define XFS_BMBT_TRACE_ARGIFR(c,i,f,r)&t;&bslash;&n;&t;xfs_bmbt_trace_argifr(fname, c, i, f, r, __LINE__)
DECL|macro|XFS_BMBT_TRACE_ARGIK
mdefine_line|#define XFS_BMBT_TRACE_ARGIK(c,i,k)&t;&bslash;&n;&t;xfs_bmbt_trace_argik(fname, c, i, k, __LINE__)
DECL|macro|XFS_BMBT_TRACE_CURSOR
mdefine_line|#define XFS_BMBT_TRACE_CURSOR(c,s)&t;&bslash;&n;&t;xfs_bmbt_trace_cursor(fname, c, s, __LINE__)
DECL|variable|ARGS
r_static
r_char
id|ARGS
(braket
)braket
op_assign
l_string|&quot;args&quot;
suffix:semicolon
DECL|variable|ENTRY
r_static
r_char
id|ENTRY
(braket
)braket
op_assign
l_string|&quot;entry&quot;
suffix:semicolon
DECL|variable|ERROR
r_static
r_char
id|ERROR
(braket
)braket
op_assign
l_string|&quot;error&quot;
suffix:semicolon
DECL|macro|EXIT
macro_line|#undef EXIT
DECL|variable|EXIT
r_static
r_char
id|EXIT
(braket
)braket
op_assign
l_string|&quot;exit&quot;
suffix:semicolon
macro_line|#else
DECL|macro|XFS_BMBT_TRACE_ARGBI
mdefine_line|#define XFS_BMBT_TRACE_ARGBI(c,b,i)
DECL|macro|XFS_BMBT_TRACE_ARGBII
mdefine_line|#define XFS_BMBT_TRACE_ARGBII(c,b,i,j)
DECL|macro|XFS_BMBT_TRACE_ARGFFFI
mdefine_line|#define XFS_BMBT_TRACE_ARGFFFI(c,o,b,i,j)
DECL|macro|XFS_BMBT_TRACE_ARGI
mdefine_line|#define XFS_BMBT_TRACE_ARGI(c,i)
DECL|macro|XFS_BMBT_TRACE_ARGIFK
mdefine_line|#define XFS_BMBT_TRACE_ARGIFK(c,i,f,k)
DECL|macro|XFS_BMBT_TRACE_ARGIFR
mdefine_line|#define XFS_BMBT_TRACE_ARGIFR(c,i,f,r)
DECL|macro|XFS_BMBT_TRACE_ARGIK
mdefine_line|#define XFS_BMBT_TRACE_ARGIK(c,i,k)
DECL|macro|XFS_BMBT_TRACE_CURSOR
mdefine_line|#define XFS_BMBT_TRACE_CURSOR(c,s)
macro_line|#endif&t;/* XFS_BMBT_TRACE */
multiline_comment|/*&n; * Internal functions.&n; */
multiline_comment|/*&n; * Delete record pointed to by cur/level.&n; */
id|STATIC
r_int
multiline_comment|/* error */
DECL|function|xfs_bmbt_delrec
id|xfs_bmbt_delrec
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
r_int
id|level
comma
r_int
id|async
comma
multiline_comment|/* deletion can be async */
r_int
op_star
id|stat
)paren
multiline_comment|/* success/failure */
(brace
id|xfs_bmbt_block_t
op_star
id|block
suffix:semicolon
multiline_comment|/* bmap btree block */
id|xfs_fsblock_t
id|bno
suffix:semicolon
multiline_comment|/* fs-relative block number */
id|xfs_buf_t
op_star
id|bp
suffix:semicolon
multiline_comment|/* buffer for block */
r_int
id|error
suffix:semicolon
multiline_comment|/* error return value */
macro_line|#ifdef XFS_BMBT_TRACE
r_static
r_char
id|fname
(braket
)braket
op_assign
l_string|&quot;xfs_bmbt_delrec&quot;
suffix:semicolon
macro_line|#endif
r_int
id|i
suffix:semicolon
multiline_comment|/* loop counter */
r_int
id|j
suffix:semicolon
multiline_comment|/* temp state */
id|xfs_bmbt_key_t
id|key
suffix:semicolon
multiline_comment|/* bmap btree key */
id|xfs_bmbt_key_t
op_star
id|kp
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* pointer to bmap btree key */
id|xfs_fsblock_t
id|lbno
suffix:semicolon
multiline_comment|/* left sibling block number */
id|xfs_buf_t
op_star
id|lbp
suffix:semicolon
multiline_comment|/* left buffer pointer */
id|xfs_bmbt_block_t
op_star
id|left
suffix:semicolon
multiline_comment|/* left btree block */
id|xfs_bmbt_key_t
op_star
id|lkp
suffix:semicolon
multiline_comment|/* left btree key */
id|xfs_bmbt_ptr_t
op_star
id|lpp
suffix:semicolon
multiline_comment|/* left address pointer */
r_int
id|lrecs
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* left record count */
id|xfs_bmbt_rec_t
op_star
id|lrp
suffix:semicolon
multiline_comment|/* left record pointer */
id|xfs_mount_t
op_star
id|mp
suffix:semicolon
multiline_comment|/* file system mount point */
id|xfs_bmbt_ptr_t
op_star
id|pp
suffix:semicolon
multiline_comment|/* pointer to bmap block addr */
r_int
id|ptr
suffix:semicolon
multiline_comment|/* key/record index */
id|xfs_fsblock_t
id|rbno
suffix:semicolon
multiline_comment|/* right sibling block number */
id|xfs_buf_t
op_star
id|rbp
suffix:semicolon
multiline_comment|/* right buffer pointer */
id|xfs_bmbt_block_t
op_star
id|right
suffix:semicolon
multiline_comment|/* right btree block */
id|xfs_bmbt_key_t
op_star
id|rkp
suffix:semicolon
multiline_comment|/* right btree key */
id|xfs_bmbt_rec_t
op_star
id|rp
suffix:semicolon
multiline_comment|/* pointer to bmap btree rec */
id|xfs_bmbt_ptr_t
op_star
id|rpp
suffix:semicolon
multiline_comment|/* right address pointer */
id|xfs_bmbt_block_t
op_star
id|rrblock
suffix:semicolon
multiline_comment|/* right-right btree block */
id|xfs_buf_t
op_star
id|rrbp
suffix:semicolon
multiline_comment|/* right-right buffer pointer */
r_int
id|rrecs
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* right record count */
id|xfs_bmbt_rec_t
op_star
id|rrp
suffix:semicolon
multiline_comment|/* right record pointer */
id|xfs_btree_cur_t
op_star
id|tcur
suffix:semicolon
multiline_comment|/* temporary btree cursor */
r_int
id|numrecs
suffix:semicolon
multiline_comment|/* temporary numrec count */
r_int
id|numlrecs
comma
id|numrrecs
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ENTRY
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_ARGI
c_func
(paren
id|cur
comma
id|level
)paren
suffix:semicolon
id|ptr
op_assign
id|cur-&gt;bc_ptrs
(braket
id|level
)braket
suffix:semicolon
id|tcur
op_assign
(paren
id|xfs_btree_cur_t
op_star
)paren
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ptr
op_eq
l_int|0
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|block
op_assign
id|xfs_bmbt_get_block
c_func
(paren
id|cur
comma
id|level
comma
op_amp
id|bp
)paren
suffix:semicolon
id|numrecs
op_assign
id|INT_GET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|block
comma
id|level
comma
id|bp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|ptr
OG
id|numrecs
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|XFS_STATS_INC
c_func
(paren
id|xfsstats.xs_bmbt_delrec
)paren
suffix:semicolon
r_if
c_cond
(paren
id|level
OG
l_int|0
)paren
(brace
id|kp
op_assign
id|XFS_BMAP_KEY_IADDR
c_func
(paren
id|block
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|pp
op_assign
id|XFS_BMAP_PTR_IADDR
c_func
(paren
id|block
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_for
c_loop
(paren
id|i
op_assign
id|ptr
suffix:semicolon
id|i
OL
id|numrecs
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lptr
c_func
(paren
id|cur
comma
id|INT_GET
c_func
(paren
id|pp
(braket
id|i
)braket
comma
id|ARCH_CONVERT
)paren
comma
id|level
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
id|ptr
OL
id|numrecs
)paren
(brace
id|memmove
c_func
(paren
op_amp
id|kp
(braket
id|ptr
op_minus
l_int|1
)braket
comma
op_amp
id|kp
(braket
id|ptr
)braket
comma
(paren
id|numrecs
op_minus
id|ptr
)paren
op_star
r_sizeof
(paren
op_star
id|kp
)paren
)paren
suffix:semicolon
id|memmove
c_func
(paren
op_amp
id|pp
(braket
id|ptr
op_minus
l_int|1
)braket
comma
op_amp
id|pp
(braket
id|ptr
)braket
comma
multiline_comment|/* INT_: direct copy */
(paren
id|numrecs
op_minus
id|ptr
)paren
op_star
r_sizeof
(paren
op_star
id|pp
)paren
)paren
suffix:semicolon
id|xfs_bmbt_log_ptrs
c_func
(paren
id|cur
comma
id|bp
comma
id|ptr
comma
id|numrecs
op_minus
l_int|1
)paren
suffix:semicolon
id|xfs_bmbt_log_keys
c_func
(paren
id|cur
comma
id|bp
comma
id|ptr
comma
id|numrecs
op_minus
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|rp
op_assign
id|XFS_BMAP_REC_IADDR
c_func
(paren
id|block
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr
OL
id|numrecs
)paren
(brace
id|memmove
c_func
(paren
op_amp
id|rp
(braket
id|ptr
op_minus
l_int|1
)braket
comma
op_amp
id|rp
(braket
id|ptr
)braket
comma
(paren
id|numrecs
op_minus
id|ptr
)paren
op_star
r_sizeof
(paren
op_star
id|rp
)paren
)paren
suffix:semicolon
id|xfs_bmbt_log_recs
c_func
(paren
id|cur
comma
id|bp
comma
id|ptr
comma
id|numrecs
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ptr
op_eq
l_int|1
)paren
(brace
id|INT_SET
c_func
(paren
id|key.br_startoff
comma
id|ARCH_CONVERT
comma
id|xfs_bmbt_disk_get_startoff
c_func
(paren
id|rp
)paren
)paren
suffix:semicolon
id|kp
op_assign
op_amp
id|key
suffix:semicolon
)brace
)brace
id|numrecs
op_decrement
suffix:semicolon
id|INT_SET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
comma
id|numrecs
)paren
suffix:semicolon
id|xfs_bmbt_log_block
c_func
(paren
id|cur
comma
id|bp
comma
id|XFS_BB_NUMRECS
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * We&squot;re at the root level.&n;&t; * First, shrink the root block in-memory.&n;&t; * Try to get rid of the next level down.&n;&t; * If we can&squot;t then there&squot;s nothing left to do.&n;&t; */
r_if
c_cond
(paren
id|level
op_eq
id|cur-&gt;bc_nlevels
op_minus
l_int|1
)paren
(brace
id|xfs_iroot_realloc
c_func
(paren
id|cur-&gt;bc_private.b.ip
comma
op_minus
l_int|1
comma
id|cur-&gt;bc_private.b.whichfork
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_bmbt_killroot
c_func
(paren
id|cur
comma
id|async
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|level
OG
l_int|0
op_logical_and
(paren
id|error
op_assign
id|xfs_bmbt_decrement
c_func
(paren
id|cur
comma
id|level
comma
op_amp
id|j
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ptr
op_eq
l_int|1
op_logical_and
(paren
id|error
op_assign
id|xfs_bmbt_updkey
c_func
(paren
id|cur
comma
id|kp
comma
id|level
op_plus
l_int|1
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|numrecs
op_ge
id|XFS_BMAP_BLOCK_IMINRECS
c_func
(paren
id|level
comma
id|cur
)paren
)paren
(brace
r_if
c_cond
(paren
id|level
OG
l_int|0
op_logical_and
(paren
id|error
op_assign
id|xfs_bmbt_decrement
c_func
(paren
id|cur
comma
id|level
comma
op_amp
id|j
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|rbno
op_assign
id|INT_GET
c_func
(paren
id|block-&gt;bb_rightsib
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
id|lbno
op_assign
id|INT_GET
c_func
(paren
id|block-&gt;bb_leftsib
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * One child of root, need to get a chance to copy its contents&n;&t; * into the root and delete it. Can&squot;t go up to next level,&n;&t; * there&squot;s nothing to delete there.&n;&t; */
r_if
c_cond
(paren
id|lbno
op_eq
id|NULLFSBLOCK
op_logical_and
id|rbno
op_eq
id|NULLFSBLOCK
op_logical_and
id|level
op_eq
id|cur-&gt;bc_nlevels
op_minus
l_int|2
)paren
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_bmbt_killroot
c_func
(paren
id|cur
comma
id|async
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|level
OG
l_int|0
op_logical_and
(paren
id|error
op_assign
id|xfs_bmbt_decrement
c_func
(paren
id|cur
comma
id|level
comma
op_amp
id|i
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ASSERT
c_func
(paren
id|rbno
op_ne
id|NULLFSBLOCK
op_logical_or
id|lbno
op_ne
id|NULLFSBLOCK
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_dup_cursor
c_func
(paren
id|cur
comma
op_amp
id|tcur
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
id|bno
op_assign
id|NULLFSBLOCK
suffix:semicolon
r_if
c_cond
(paren
id|rbno
op_ne
id|NULLFSBLOCK
)paren
(brace
id|i
op_assign
id|xfs_btree_lastrec
c_func
(paren
id|tcur
comma
id|level
)paren
suffix:semicolon
id|XFS_WANT_CORRUPTED_GOTO
c_func
(paren
id|i
op_eq
l_int|1
comma
id|error0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_bmbt_increment
c_func
(paren
id|tcur
comma
id|level
comma
op_amp
id|i
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
id|XFS_WANT_CORRUPTED_GOTO
c_func
(paren
id|i
op_eq
l_int|1
comma
id|error0
)paren
suffix:semicolon
id|i
op_assign
id|xfs_btree_lastrec
c_func
(paren
id|tcur
comma
id|level
)paren
suffix:semicolon
id|XFS_WANT_CORRUPTED_GOTO
c_func
(paren
id|i
op_eq
l_int|1
comma
id|error0
)paren
suffix:semicolon
id|rbp
op_assign
id|tcur-&gt;bc_bufs
(braket
id|level
)braket
suffix:semicolon
id|right
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
id|rbp
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|right
comma
id|level
comma
id|rbp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
macro_line|#endif
id|bno
op_assign
id|INT_GET
c_func
(paren
id|right-&gt;bb_leftsib
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_minus
l_int|1
op_ge
id|XFS_BMAP_BLOCK_IMINRECS
c_func
(paren
id|level
comma
id|cur
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_bmbt_lshift
c_func
(paren
id|tcur
comma
id|level
comma
op_amp
id|i
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
)paren
(brace
id|ASSERT
c_func
(paren
id|INT_GET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_ge
id|XFS_BMAP_BLOCK_IMINRECS
c_func
(paren
id|level
comma
id|tcur
)paren
)paren
suffix:semicolon
id|xfs_btree_del_cursor
c_func
(paren
id|tcur
comma
id|XFS_BTREE_NOERROR
)paren
suffix:semicolon
id|tcur
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|level
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_bmbt_decrement
c_func
(paren
id|cur
comma
id|level
comma
op_amp
id|i
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
)brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|rrecs
op_assign
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lbno
op_ne
id|NULLFSBLOCK
)paren
(brace
id|i
op_assign
id|xfs_btree_firstrec
c_func
(paren
id|tcur
comma
id|level
)paren
suffix:semicolon
id|XFS_WANT_CORRUPTED_GOTO
c_func
(paren
id|i
op_eq
l_int|1
comma
id|error0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_bmbt_decrement
c_func
(paren
id|tcur
comma
id|level
comma
op_amp
id|i
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
id|XFS_WANT_CORRUPTED_GOTO
c_func
(paren
id|i
op_eq
l_int|1
comma
id|error0
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|lbno
op_ne
id|NULLFSBLOCK
)paren
(brace
id|i
op_assign
id|xfs_btree_firstrec
c_func
(paren
id|tcur
comma
id|level
)paren
suffix:semicolon
id|XFS_WANT_CORRUPTED_GOTO
c_func
(paren
id|i
op_eq
l_int|1
comma
id|error0
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * decrement to last in block&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_bmbt_decrement
c_func
(paren
id|tcur
comma
id|level
comma
op_amp
id|i
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
id|i
op_assign
id|xfs_btree_firstrec
c_func
(paren
id|tcur
comma
id|level
)paren
suffix:semicolon
id|XFS_WANT_CORRUPTED_GOTO
c_func
(paren
id|i
op_eq
l_int|1
comma
id|error0
)paren
suffix:semicolon
id|lbp
op_assign
id|tcur-&gt;bc_bufs
(braket
id|level
)braket
suffix:semicolon
id|left
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
id|lbp
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|left
comma
id|level
comma
id|lbp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
macro_line|#endif
id|bno
op_assign
id|INT_GET
c_func
(paren
id|left-&gt;bb_rightsib
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|INT_GET
c_func
(paren
id|left-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_minus
l_int|1
op_ge
id|XFS_BMAP_BLOCK_IMINRECS
c_func
(paren
id|level
comma
id|cur
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_bmbt_rshift
c_func
(paren
id|tcur
comma
id|level
comma
op_amp
id|i
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
)paren
(brace
id|ASSERT
c_func
(paren
id|INT_GET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_ge
id|XFS_BMAP_BLOCK_IMINRECS
c_func
(paren
id|level
comma
id|tcur
)paren
)paren
suffix:semicolon
id|xfs_btree_del_cursor
c_func
(paren
id|tcur
comma
id|XFS_BTREE_NOERROR
)paren
suffix:semicolon
id|tcur
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|level
op_eq
l_int|0
)paren
id|cur-&gt;bc_ptrs
(braket
l_int|0
)braket
op_increment
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|lrecs
op_assign
id|INT_GET
c_func
(paren
id|left-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
)brace
id|xfs_btree_del_cursor
c_func
(paren
id|tcur
comma
id|XFS_BTREE_NOERROR
)paren
suffix:semicolon
id|tcur
op_assign
l_int|NULL
suffix:semicolon
id|mp
op_assign
id|cur-&gt;bc_mp
suffix:semicolon
id|ASSERT
c_func
(paren
id|bno
op_ne
id|NULLFSBLOCK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lbno
op_ne
id|NULLFSBLOCK
op_logical_and
id|lrecs
op_plus
id|INT_GET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_le
id|XFS_BMAP_BLOCK_IMAXRECS
c_func
(paren
id|level
comma
id|cur
)paren
)paren
(brace
id|rbno
op_assign
id|bno
suffix:semicolon
id|right
op_assign
id|block
suffix:semicolon
id|rbp
op_assign
id|bp
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_read_bufl
c_func
(paren
id|mp
comma
id|cur-&gt;bc_tp
comma
id|lbno
comma
l_int|0
comma
op_amp
id|lbp
comma
id|XFS_BMAP_BTREE_REF
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
id|left
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
id|lbp
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|left
comma
id|level
comma
id|lbp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|rbno
op_ne
id|NULLFSBLOCK
op_logical_and
id|rrecs
op_plus
id|INT_GET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_le
id|XFS_BMAP_BLOCK_IMAXRECS
c_func
(paren
id|level
comma
id|cur
)paren
)paren
(brace
id|lbno
op_assign
id|bno
suffix:semicolon
id|left
op_assign
id|block
suffix:semicolon
id|lbp
op_assign
id|bp
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_read_bufl
c_func
(paren
id|mp
comma
id|cur-&gt;bc_tp
comma
id|rbno
comma
l_int|0
comma
op_amp
id|rbp
comma
id|XFS_BMAP_BTREE_REF
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
id|right
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
id|rbp
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|right
comma
id|level
comma
id|rbp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
id|lrecs
op_assign
id|INT_GET
c_func
(paren
id|left-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|level
OG
l_int|0
op_logical_and
(paren
id|error
op_assign
id|xfs_bmbt_decrement
c_func
(paren
id|cur
comma
id|level
comma
op_amp
id|i
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|numlrecs
op_assign
id|INT_GET
c_func
(paren
id|left-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
id|numrrecs
op_assign
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|level
OG
l_int|0
)paren
(brace
id|lkp
op_assign
id|XFS_BMAP_KEY_IADDR
c_func
(paren
id|left
comma
id|numlrecs
op_plus
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|lpp
op_assign
id|XFS_BMAP_PTR_IADDR
c_func
(paren
id|left
comma
id|numlrecs
op_plus
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|rkp
op_assign
id|XFS_BMAP_KEY_IADDR
c_func
(paren
id|right
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|rpp
op_assign
id|XFS_BMAP_PTR_IADDR
c_func
(paren
id|right
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|numrrecs
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lptr
c_func
(paren
id|cur
comma
id|INT_GET
c_func
(paren
id|rpp
(braket
id|i
)braket
comma
id|ARCH_CONVERT
)paren
comma
id|level
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
)brace
macro_line|#endif
id|memcpy
c_func
(paren
id|lkp
comma
id|rkp
comma
id|numrrecs
op_star
r_sizeof
(paren
op_star
id|lkp
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|lpp
comma
id|rpp
comma
id|numrrecs
op_star
r_sizeof
(paren
op_star
id|lpp
)paren
)paren
suffix:semicolon
id|xfs_bmbt_log_keys
c_func
(paren
id|cur
comma
id|lbp
comma
id|numlrecs
op_plus
l_int|1
comma
id|numlrecs
op_plus
id|numrrecs
)paren
suffix:semicolon
id|xfs_bmbt_log_ptrs
c_func
(paren
id|cur
comma
id|lbp
comma
id|numlrecs
op_plus
l_int|1
comma
id|numlrecs
op_plus
id|numrrecs
)paren
suffix:semicolon
)brace
r_else
(brace
id|lrp
op_assign
id|XFS_BMAP_REC_IADDR
c_func
(paren
id|left
comma
id|numlrecs
op_plus
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|rrp
op_assign
id|XFS_BMAP_REC_IADDR
c_func
(paren
id|right
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|lrp
comma
id|rrp
comma
id|numrrecs
op_star
r_sizeof
(paren
op_star
id|lrp
)paren
)paren
suffix:semicolon
id|xfs_bmbt_log_recs
c_func
(paren
id|cur
comma
id|lbp
comma
id|numlrecs
op_plus
l_int|1
comma
id|numlrecs
op_plus
id|numrrecs
)paren
suffix:semicolon
)brace
id|INT_MOD
c_func
(paren
id|left-&gt;bb_numrecs
comma
id|ARCH_CONVERT
comma
id|numrrecs
)paren
suffix:semicolon
id|left-&gt;bb_rightsib
op_assign
id|right-&gt;bb_rightsib
suffix:semicolon
multiline_comment|/* INT_: direct copy */
id|xfs_bmbt_log_block
c_func
(paren
id|cur
comma
id|lbp
comma
id|XFS_BB_RIGHTSIB
op_or
id|XFS_BB_NUMRECS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|INT_GET
c_func
(paren
id|left-&gt;bb_rightsib
comma
id|ARCH_CONVERT
)paren
op_ne
id|NULLDFSBNO
)paren
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_read_bufl
c_func
(paren
id|mp
comma
id|cur-&gt;bc_tp
comma
id|INT_GET
c_func
(paren
id|left-&gt;bb_rightsib
comma
id|ARCH_CONVERT
)paren
comma
l_int|0
comma
op_amp
id|rrbp
comma
id|XFS_BMAP_BTREE_REF
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
id|rrblock
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
id|rrbp
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|rrblock
comma
id|level
comma
id|rrbp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
id|INT_SET
c_func
(paren
id|rrblock-&gt;bb_leftsib
comma
id|ARCH_CONVERT
comma
id|lbno
)paren
suffix:semicolon
id|xfs_bmbt_log_block
c_func
(paren
id|cur
comma
id|rrbp
comma
id|XFS_BB_LEFTSIB
)paren
suffix:semicolon
)brace
id|xfs_bmap_add_free
c_func
(paren
id|XFS_DADDR_TO_FSB
c_func
(paren
id|mp
comma
id|XFS_BUF_ADDR
c_func
(paren
id|rbp
)paren
)paren
comma
l_int|1
comma
id|cur-&gt;bc_private.b.flist
comma
id|mp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|async
)paren
id|xfs_trans_set_sync
c_func
(paren
id|cur-&gt;bc_tp
)paren
suffix:semicolon
id|cur-&gt;bc_private.b.ip-&gt;i_d.di_nblocks
op_decrement
suffix:semicolon
id|xfs_trans_log_inode
c_func
(paren
id|cur-&gt;bc_tp
comma
id|cur-&gt;bc_private.b.ip
comma
id|XFS_ILOG_CORE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|XFS_IS_QUOTA_ON
c_func
(paren
id|mp
)paren
op_logical_and
id|cur-&gt;bc_private.b.ip-&gt;i_ino
op_ne
id|mp-&gt;m_sb.sb_uquotino
op_logical_and
id|cur-&gt;bc_private.b.ip-&gt;i_ino
op_ne
id|mp-&gt;m_sb.sb_gquotino
)paren
id|xfs_trans_mod_dquot_byino
c_func
(paren
id|cur-&gt;bc_tp
comma
id|cur-&gt;bc_private.b.ip
comma
id|XFS_TRANS_DQ_BCOUNT
comma
op_minus
l_int|1L
)paren
suffix:semicolon
id|xfs_trans_binval
c_func
(paren
id|cur-&gt;bc_tp
comma
id|rbp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bp
op_ne
id|lbp
)paren
(brace
id|cur-&gt;bc_bufs
(braket
id|level
)braket
op_assign
id|lbp
suffix:semicolon
id|cur-&gt;bc_ptrs
(braket
id|level
)braket
op_add_assign
id|lrecs
suffix:semicolon
id|cur-&gt;bc_ra
(braket
id|level
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_bmbt_increment
c_func
(paren
id|cur
comma
id|level
op_plus
l_int|1
comma
op_amp
id|i
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|level
OG
l_int|0
)paren
id|cur-&gt;bc_ptrs
(braket
id|level
)braket
op_decrement
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|2
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|error0
suffix:colon
r_if
c_cond
(paren
id|tcur
)paren
id|xfs_btree_del_cursor
c_func
(paren
id|tcur
comma
id|XFS_BTREE_ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#ifdef XFSDEBUG
multiline_comment|/*&n; * Get the data from the pointed-to record.&n; */
r_int
DECL|function|xfs_bmbt_get_rec
id|xfs_bmbt_get_rec
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
id|xfs_fileoff_t
op_star
id|off
comma
id|xfs_fsblock_t
op_star
id|bno
comma
id|xfs_filblks_t
op_star
id|len
comma
id|xfs_exntst_t
op_star
id|state
comma
r_int
op_star
id|stat
)paren
(brace
id|xfs_bmbt_block_t
op_star
id|block
suffix:semicolon
id|xfs_buf_t
op_star
id|bp
suffix:semicolon
macro_line|#ifdef DEBUG
r_int
id|error
suffix:semicolon
macro_line|#endif
r_int
id|ptr
suffix:semicolon
id|xfs_bmbt_rec_t
op_star
id|rp
suffix:semicolon
id|block
op_assign
id|xfs_bmbt_get_block
c_func
(paren
id|cur
comma
l_int|0
comma
op_amp
id|bp
)paren
suffix:semicolon
id|ptr
op_assign
id|cur-&gt;bc_ptrs
(braket
l_int|0
)braket
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|block
comma
l_int|0
comma
id|bp
)paren
)paren
)paren
r_return
id|error
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ptr
OG
id|INT_GET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_logical_or
id|ptr
op_le
l_int|0
)paren
(brace
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|rp
op_assign
id|XFS_BMAP_REC_IADDR
c_func
(paren
id|block
comma
id|ptr
comma
id|cur
)paren
suffix:semicolon
op_star
id|off
op_assign
id|xfs_bmbt_disk_get_startoff
c_func
(paren
id|rp
)paren
suffix:semicolon
op_star
id|bno
op_assign
id|xfs_bmbt_disk_get_startblock
c_func
(paren
id|rp
)paren
suffix:semicolon
op_star
id|len
op_assign
id|xfs_bmbt_disk_get_blockcount
c_func
(paren
id|rp
)paren
suffix:semicolon
op_star
id|state
op_assign
id|xfs_bmbt_disk_get_state
c_func
(paren
id|rp
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * Insert one record/level.  Return information to the caller&n; * allowing the next level up to proceed if necessary.&n; */
id|STATIC
r_int
multiline_comment|/* error */
DECL|function|xfs_bmbt_insrec
id|xfs_bmbt_insrec
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
r_int
id|level
comma
id|xfs_fsblock_t
op_star
id|bnop
comma
id|xfs_bmbt_rec_t
op_star
id|recp
comma
id|xfs_btree_cur_t
op_star
op_star
id|curp
comma
r_int
op_star
id|stat
)paren
multiline_comment|/* no-go/done/continue */
(brace
id|xfs_bmbt_block_t
op_star
id|block
suffix:semicolon
multiline_comment|/* bmap btree block */
id|xfs_buf_t
op_star
id|bp
suffix:semicolon
multiline_comment|/* buffer for block */
r_int
id|error
suffix:semicolon
multiline_comment|/* error return value */
macro_line|#ifdef XFS_BMBT_TRACE
r_static
r_char
id|fname
(braket
)braket
op_assign
l_string|&quot;xfs_bmbt_insrec&quot;
suffix:semicolon
macro_line|#endif
r_int
id|i
suffix:semicolon
multiline_comment|/* loop index */
id|xfs_bmbt_key_t
id|key
suffix:semicolon
multiline_comment|/* bmap btree key */
id|xfs_bmbt_key_t
op_star
id|kp
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* pointer to bmap btree key */
r_int
id|logflags
suffix:semicolon
multiline_comment|/* inode logging flags */
id|xfs_fsblock_t
id|nbno
suffix:semicolon
multiline_comment|/* new block number */
r_struct
id|xfs_btree_cur
op_star
id|ncur
suffix:semicolon
multiline_comment|/* new btree cursor */
id|xfs_bmbt_key_t
id|nkey
suffix:semicolon
multiline_comment|/* new btree key value */
id|xfs_bmbt_rec_t
id|nrec
suffix:semicolon
multiline_comment|/* new record count */
r_int
id|optr
suffix:semicolon
multiline_comment|/* old key/record index */
id|xfs_bmbt_ptr_t
op_star
id|pp
suffix:semicolon
multiline_comment|/* pointer to bmap block addr */
r_int
id|ptr
suffix:semicolon
multiline_comment|/* key/record index */
id|xfs_bmbt_rec_t
op_star
id|rp
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* pointer to bmap btree rec */
r_int
id|numrecs
suffix:semicolon
id|ASSERT
c_func
(paren
id|level
OL
id|cur-&gt;bc_nlevels
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ENTRY
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_ARGIFR
c_func
(paren
id|cur
comma
id|level
comma
op_star
id|bnop
comma
id|recp
)paren
suffix:semicolon
id|ncur
op_assign
(paren
id|xfs_btree_cur_t
op_star
)paren
l_int|0
suffix:semicolon
id|INT_SET
c_func
(paren
id|key.br_startoff
comma
id|ARCH_CONVERT
comma
id|xfs_bmbt_disk_get_startoff
c_func
(paren
id|recp
)paren
)paren
suffix:semicolon
id|optr
op_assign
id|ptr
op_assign
id|cur-&gt;bc_ptrs
(braket
id|level
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ptr
op_eq
l_int|0
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|XFS_STATS_INC
c_func
(paren
id|xfsstats.xs_bmbt_insrec
)paren
suffix:semicolon
id|block
op_assign
id|xfs_bmbt_get_block
c_func
(paren
id|cur
comma
id|level
comma
op_amp
id|bp
)paren
suffix:semicolon
id|numrecs
op_assign
id|INT_GET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|block
comma
id|level
comma
id|bp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ptr
op_le
id|numrecs
)paren
(brace
r_if
c_cond
(paren
id|level
op_eq
l_int|0
)paren
(brace
id|rp
op_assign
id|XFS_BMAP_REC_IADDR
c_func
(paren
id|block
comma
id|ptr
comma
id|cur
)paren
suffix:semicolon
id|xfs_btree_check_rec
c_func
(paren
id|XFS_BTNUM_BMAP
comma
id|recp
comma
id|rp
)paren
suffix:semicolon
)brace
r_else
(brace
id|kp
op_assign
id|XFS_BMAP_KEY_IADDR
c_func
(paren
id|block
comma
id|ptr
comma
id|cur
)paren
suffix:semicolon
id|xfs_btree_check_key
c_func
(paren
id|XFS_BTNUM_BMAP
comma
op_amp
id|key
comma
id|kp
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
id|nbno
op_assign
id|NULLFSBLOCK
suffix:semicolon
r_if
c_cond
(paren
id|numrecs
op_eq
id|XFS_BMAP_BLOCK_IMAXRECS
c_func
(paren
id|level
comma
id|cur
)paren
)paren
(brace
r_if
c_cond
(paren
id|numrecs
OL
id|XFS_BMAP_BLOCK_DMAXRECS
c_func
(paren
id|level
comma
id|cur
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * A root block, that can be made bigger.&n;&t;&t;&t; */
id|xfs_iroot_realloc
c_func
(paren
id|cur-&gt;bc_private.b.ip
comma
l_int|1
comma
id|cur-&gt;bc_private.b.whichfork
)paren
suffix:semicolon
id|block
op_assign
id|xfs_bmbt_get_block
c_func
(paren
id|cur
comma
id|level
comma
op_amp
id|bp
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|level
op_eq
id|cur-&gt;bc_nlevels
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_bmbt_newroot
c_func
(paren
id|cur
comma
op_amp
id|logflags
comma
id|stat
)paren
)paren
op_logical_or
op_star
id|stat
op_eq
l_int|0
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|xfs_trans_log_inode
c_func
(paren
id|cur-&gt;bc_tp
comma
id|cur-&gt;bc_private.b.ip
comma
id|logflags
)paren
suffix:semicolon
id|block
op_assign
id|xfs_bmbt_get_block
c_func
(paren
id|cur
comma
id|level
comma
op_amp
id|bp
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_bmbt_rshift
c_func
(paren
id|cur
comma
id|level
comma
op_amp
id|i
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
)paren
(brace
multiline_comment|/* nothing */
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_bmbt_lshift
c_func
(paren
id|cur
comma
id|level
comma
op_amp
id|i
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
)paren
(brace
id|optr
op_assign
id|ptr
op_assign
id|cur-&gt;bc_ptrs
(braket
id|level
)braket
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_bmbt_split
c_func
(paren
id|cur
comma
id|level
comma
op_amp
id|nbno
comma
op_amp
id|nkey
comma
op_amp
id|ncur
comma
op_amp
id|i
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
)paren
(brace
id|block
op_assign
id|xfs_bmbt_get_block
c_func
(paren
id|cur
comma
id|level
comma
op_amp
id|bp
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|block
comma
id|level
comma
id|bp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#endif
id|ptr
op_assign
id|cur-&gt;bc_ptrs
(braket
id|level
)braket
suffix:semicolon
id|xfs_bmbt_disk_set_allf
c_func
(paren
op_amp
id|nrec
comma
id|nkey.br_startoff
comma
l_int|0
comma
l_int|0
comma
id|XFS_EXT_NORM
)paren
suffix:semicolon
)brace
r_else
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
id|numrecs
op_assign
id|INT_GET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|level
OG
l_int|0
)paren
(brace
id|kp
op_assign
id|XFS_BMAP_KEY_IADDR
c_func
(paren
id|block
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|pp
op_assign
id|XFS_BMAP_PTR_IADDR
c_func
(paren
id|block
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_for
c_loop
(paren
id|i
op_assign
id|numrecs
suffix:semicolon
id|i
op_ge
id|ptr
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lptr
c_func
(paren
id|cur
comma
id|INT_GET
c_func
(paren
id|pp
(braket
id|i
op_minus
l_int|1
)braket
comma
id|ARCH_CONVERT
)paren
comma
id|level
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
)brace
macro_line|#endif
id|memmove
c_func
(paren
op_amp
id|kp
(braket
id|ptr
)braket
comma
op_amp
id|kp
(braket
id|ptr
op_minus
l_int|1
)braket
comma
(paren
id|numrecs
op_minus
id|ptr
op_plus
l_int|1
)paren
op_star
r_sizeof
(paren
op_star
id|kp
)paren
)paren
suffix:semicolon
id|memmove
c_func
(paren
op_amp
id|pp
(braket
id|ptr
)braket
comma
op_amp
id|pp
(braket
id|ptr
op_minus
l_int|1
)braket
comma
multiline_comment|/* INT_: direct copy */
(paren
id|numrecs
op_minus
id|ptr
op_plus
l_int|1
)paren
op_star
r_sizeof
(paren
op_star
id|pp
)paren
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lptr
c_func
(paren
id|cur
comma
(paren
id|xfs_bmbt_ptr_t
)paren
op_star
id|bnop
comma
id|level
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#endif
id|kp
(braket
id|ptr
op_minus
l_int|1
)braket
op_assign
id|key
suffix:semicolon
id|INT_SET
c_func
(paren
id|pp
(braket
id|ptr
op_minus
l_int|1
)braket
comma
id|ARCH_CONVERT
comma
op_star
id|bnop
)paren
suffix:semicolon
id|numrecs
op_increment
suffix:semicolon
id|INT_SET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
comma
id|numrecs
)paren
suffix:semicolon
id|xfs_bmbt_log_keys
c_func
(paren
id|cur
comma
id|bp
comma
id|ptr
comma
id|numrecs
)paren
suffix:semicolon
id|xfs_bmbt_log_ptrs
c_func
(paren
id|cur
comma
id|bp
comma
id|ptr
comma
id|numrecs
)paren
suffix:semicolon
)brace
r_else
(brace
id|rp
op_assign
id|XFS_BMAP_REC_IADDR
c_func
(paren
id|block
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|memmove
c_func
(paren
op_amp
id|rp
(braket
id|ptr
)braket
comma
op_amp
id|rp
(braket
id|ptr
op_minus
l_int|1
)braket
comma
(paren
id|numrecs
op_minus
id|ptr
op_plus
l_int|1
)paren
op_star
r_sizeof
(paren
op_star
id|rp
)paren
)paren
suffix:semicolon
id|rp
(braket
id|ptr
op_minus
l_int|1
)braket
op_assign
op_star
id|recp
suffix:semicolon
id|numrecs
op_increment
suffix:semicolon
id|INT_SET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
comma
id|numrecs
)paren
suffix:semicolon
id|xfs_bmbt_log_recs
c_func
(paren
id|cur
comma
id|bp
comma
id|ptr
comma
id|numrecs
)paren
suffix:semicolon
)brace
id|xfs_bmbt_log_block
c_func
(paren
id|cur
comma
id|bp
comma
id|XFS_BB_NUMRECS
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|ptr
OL
id|numrecs
)paren
(brace
r_if
c_cond
(paren
id|level
op_eq
l_int|0
)paren
id|xfs_btree_check_rec
c_func
(paren
id|XFS_BTNUM_BMAP
comma
id|rp
op_plus
id|ptr
op_minus
l_int|1
comma
id|rp
op_plus
id|ptr
)paren
suffix:semicolon
r_else
id|xfs_btree_check_key
c_func
(paren
id|XFS_BTNUM_BMAP
comma
id|kp
op_plus
id|ptr
op_minus
l_int|1
comma
id|kp
op_plus
id|ptr
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|optr
op_eq
l_int|1
op_logical_and
(paren
id|error
op_assign
id|xfs_bmbt_updkey
c_func
(paren
id|cur
comma
op_amp
id|key
comma
id|level
op_plus
l_int|1
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
op_star
id|bnop
op_assign
id|nbno
suffix:semicolon
r_if
c_cond
(paren
id|nbno
op_ne
id|NULLFSBLOCK
)paren
(brace
op_star
id|recp
op_assign
id|nrec
suffix:semicolon
op_star
id|curp
op_assign
id|ncur
suffix:semicolon
)brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|STATIC
r_int
DECL|function|xfs_bmbt_killroot
id|xfs_bmbt_killroot
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
r_int
id|async
)paren
(brace
id|xfs_bmbt_block_t
op_star
id|block
suffix:semicolon
id|xfs_bmbt_block_t
op_star
id|cblock
suffix:semicolon
id|xfs_buf_t
op_star
id|cbp
suffix:semicolon
id|xfs_bmbt_key_t
op_star
id|ckp
suffix:semicolon
id|xfs_bmbt_ptr_t
op_star
id|cpp
suffix:semicolon
macro_line|#ifdef DEBUG
r_int
id|error
suffix:semicolon
macro_line|#endif
macro_line|#ifdef XFS_BMBT_TRACE
r_static
r_char
id|fname
(braket
)braket
op_assign
l_string|&quot;xfs_bmbt_killroot&quot;
suffix:semicolon
macro_line|#endif
r_int
id|i
suffix:semicolon
id|xfs_bmbt_key_t
op_star
id|kp
suffix:semicolon
id|xfs_inode_t
op_star
id|ip
suffix:semicolon
id|xfs_ifork_t
op_star
id|ifp
suffix:semicolon
r_int
id|level
suffix:semicolon
id|xfs_bmbt_ptr_t
op_star
id|pp
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ENTRY
)paren
suffix:semicolon
id|level
op_assign
id|cur-&gt;bc_nlevels
op_minus
l_int|1
suffix:semicolon
id|ASSERT
c_func
(paren
id|level
op_ge
l_int|1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Don&squot;t deal with the root block needs to be a leaf case.&n;&t; * We&squot;re just going to turn the thing back into extents anyway.&n;&t; */
r_if
c_cond
(paren
id|level
op_eq
l_int|1
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|block
op_assign
id|xfs_bmbt_get_block
c_func
(paren
id|cur
comma
id|level
comma
op_amp
id|cbp
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Give up if the root has multiple children.&n;&t; */
r_if
c_cond
(paren
id|INT_GET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_ne
l_int|1
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Only do this if the next level will fit.&n;&t; * Then the data must be copied up to the inode,&n;&t; * instead of freeing the root you free the next level.&n;&t; */
id|cbp
op_assign
id|cur-&gt;bc_bufs
(braket
id|level
op_minus
l_int|1
)braket
suffix:semicolon
id|cblock
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
id|cbp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|INT_GET
c_func
(paren
id|cblock-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
OG
id|XFS_BMAP_BLOCK_DMAXRECS
c_func
(paren
id|level
comma
id|cur
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ASSERT
c_func
(paren
id|INT_GET
c_func
(paren
id|cblock-&gt;bb_leftsib
comma
id|ARCH_CONVERT
)paren
op_eq
id|NULLDFSBNO
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|INT_GET
c_func
(paren
id|cblock-&gt;bb_rightsib
comma
id|ARCH_CONVERT
)paren
op_eq
id|NULLDFSBNO
)paren
suffix:semicolon
id|ip
op_assign
id|cur-&gt;bc_private.b.ip
suffix:semicolon
id|ifp
op_assign
id|XFS_IFORK_PTR
c_func
(paren
id|ip
comma
id|cur-&gt;bc_private.b.whichfork
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|XFS_BMAP_BLOCK_IMAXRECS
c_func
(paren
id|level
comma
id|cur
)paren
op_eq
id|XFS_BMAP_BROOT_MAXRECS
c_func
(paren
id|ifp-&gt;if_broot_bytes
)paren
)paren
suffix:semicolon
id|i
op_assign
(paren
r_int
)paren
(paren
id|INT_GET
c_func
(paren
id|cblock-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_minus
id|XFS_BMAP_BLOCK_IMAXRECS
c_func
(paren
id|level
comma
id|cur
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
(brace
id|xfs_iroot_realloc
c_func
(paren
id|ip
comma
id|i
comma
id|cur-&gt;bc_private.b.whichfork
)paren
suffix:semicolon
id|block
op_assign
id|ifp-&gt;if_broot
suffix:semicolon
)brace
id|INT_MOD
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
comma
id|i
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|INT_GET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_eq
id|INT_GET
c_func
(paren
id|cblock-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
)paren
suffix:semicolon
id|kp
op_assign
id|XFS_BMAP_KEY_IADDR
c_func
(paren
id|block
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|ckp
op_assign
id|XFS_BMAP_KEY_IADDR
c_func
(paren
id|cblock
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|kp
comma
id|ckp
comma
id|INT_GET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_star
r_sizeof
(paren
op_star
id|kp
)paren
)paren
suffix:semicolon
id|pp
op_assign
id|XFS_BMAP_PTR_IADDR
c_func
(paren
id|block
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|cpp
op_assign
id|XFS_BMAP_PTR_IADDR
c_func
(paren
id|cblock
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|INT_GET
c_func
(paren
id|cblock-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lptr
c_func
(paren
id|cur
comma
id|INT_GET
c_func
(paren
id|cpp
(braket
id|i
)braket
comma
id|ARCH_CONVERT
)paren
comma
id|level
op_minus
l_int|1
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
)brace
macro_line|#endif
id|memcpy
c_func
(paren
id|pp
comma
id|cpp
comma
id|INT_GET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_star
r_sizeof
(paren
op_star
id|pp
)paren
)paren
suffix:semicolon
id|xfs_bmap_add_free
c_func
(paren
id|XFS_DADDR_TO_FSB
c_func
(paren
id|cur-&gt;bc_mp
comma
id|XFS_BUF_ADDR
c_func
(paren
id|cbp
)paren
)paren
comma
l_int|1
comma
id|cur-&gt;bc_private.b.flist
comma
id|cur-&gt;bc_mp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|async
)paren
id|xfs_trans_set_sync
c_func
(paren
id|cur-&gt;bc_tp
)paren
suffix:semicolon
id|ip-&gt;i_d.di_nblocks
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|XFS_IS_QUOTA_ON
c_func
(paren
id|cur-&gt;bc_mp
)paren
op_logical_and
id|ip-&gt;i_ino
op_ne
id|cur-&gt;bc_mp-&gt;m_sb.sb_uquotino
op_logical_and
id|ip-&gt;i_ino
op_ne
id|cur-&gt;bc_mp-&gt;m_sb.sb_gquotino
)paren
id|xfs_trans_mod_dquot_byino
c_func
(paren
id|cur-&gt;bc_tp
comma
id|ip
comma
id|XFS_TRANS_DQ_BCOUNT
comma
op_minus
l_int|1L
)paren
suffix:semicolon
id|xfs_trans_binval
c_func
(paren
id|cur-&gt;bc_tp
comma
id|cbp
)paren
suffix:semicolon
id|cur-&gt;bc_bufs
(braket
id|level
op_minus
l_int|1
)braket
op_assign
l_int|NULL
suffix:semicolon
id|INT_MOD
c_func
(paren
id|block-&gt;bb_level
comma
id|ARCH_CONVERT
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|xfs_trans_log_inode
c_func
(paren
id|cur-&gt;bc_tp
comma
id|ip
comma
id|XFS_ILOG_CORE
op_or
id|XFS_ILOG_FBROOT
c_func
(paren
id|cur-&gt;bc_private.b.whichfork
)paren
)paren
suffix:semicolon
id|cur-&gt;bc_nlevels
op_decrement
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Log key values from the btree block.&n; */
id|STATIC
r_void
DECL|function|xfs_bmbt_log_keys
id|xfs_bmbt_log_keys
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
id|xfs_buf_t
op_star
id|bp
comma
r_int
id|kfirst
comma
r_int
id|klast
)paren
(brace
macro_line|#ifdef XFS_BMBT_TRACE
r_static
r_char
id|fname
(braket
)braket
op_assign
l_string|&quot;xfs_bmbt_log_keys&quot;
suffix:semicolon
macro_line|#endif
id|xfs_trans_t
op_star
id|tp
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ENTRY
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_ARGBII
c_func
(paren
id|cur
comma
id|bp
comma
id|kfirst
comma
id|klast
)paren
suffix:semicolon
id|tp
op_assign
id|cur-&gt;bc_tp
suffix:semicolon
r_if
c_cond
(paren
id|bp
)paren
(brace
id|xfs_bmbt_block_t
op_star
id|block
suffix:semicolon
r_int
id|first
suffix:semicolon
id|xfs_bmbt_key_t
op_star
id|kp
suffix:semicolon
r_int
id|last
suffix:semicolon
id|block
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
id|bp
)paren
suffix:semicolon
id|kp
op_assign
id|XFS_BMAP_KEY_DADDR
c_func
(paren
id|block
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|first
op_assign
(paren
r_int
)paren
(paren
(paren
id|xfs_caddr_t
)paren
op_amp
id|kp
(braket
id|kfirst
op_minus
l_int|1
)braket
op_minus
(paren
id|xfs_caddr_t
)paren
id|block
)paren
suffix:semicolon
id|last
op_assign
(paren
r_int
)paren
(paren
(paren
(paren
id|xfs_caddr_t
)paren
op_amp
id|kp
(braket
id|klast
)braket
op_minus
l_int|1
)paren
op_minus
(paren
id|xfs_caddr_t
)paren
id|block
)paren
suffix:semicolon
id|xfs_trans_log_buf
c_func
(paren
id|tp
comma
id|bp
comma
id|first
comma
id|last
)paren
suffix:semicolon
)brace
r_else
(brace
id|xfs_inode_t
op_star
id|ip
suffix:semicolon
id|ip
op_assign
id|cur-&gt;bc_private.b.ip
suffix:semicolon
id|xfs_trans_log_inode
c_func
(paren
id|tp
comma
id|ip
comma
id|XFS_ILOG_FBROOT
c_func
(paren
id|cur-&gt;bc_private.b.whichfork
)paren
)paren
suffix:semicolon
)brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Log pointer values from the btree block.&n; */
id|STATIC
r_void
DECL|function|xfs_bmbt_log_ptrs
id|xfs_bmbt_log_ptrs
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
id|xfs_buf_t
op_star
id|bp
comma
r_int
id|pfirst
comma
r_int
id|plast
)paren
(brace
macro_line|#ifdef XFS_BMBT_TRACE
r_static
r_char
id|fname
(braket
)braket
op_assign
l_string|&quot;xfs_bmbt_log_ptrs&quot;
suffix:semicolon
macro_line|#endif
id|xfs_trans_t
op_star
id|tp
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ENTRY
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_ARGBII
c_func
(paren
id|cur
comma
id|bp
comma
id|pfirst
comma
id|plast
)paren
suffix:semicolon
id|tp
op_assign
id|cur-&gt;bc_tp
suffix:semicolon
r_if
c_cond
(paren
id|bp
)paren
(brace
id|xfs_bmbt_block_t
op_star
id|block
suffix:semicolon
r_int
id|first
suffix:semicolon
r_int
id|last
suffix:semicolon
id|xfs_bmbt_ptr_t
op_star
id|pp
suffix:semicolon
id|block
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
id|bp
)paren
suffix:semicolon
id|pp
op_assign
id|XFS_BMAP_PTR_DADDR
c_func
(paren
id|block
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|first
op_assign
(paren
r_int
)paren
(paren
(paren
id|xfs_caddr_t
)paren
op_amp
id|pp
(braket
id|pfirst
op_minus
l_int|1
)braket
op_minus
(paren
id|xfs_caddr_t
)paren
id|block
)paren
suffix:semicolon
id|last
op_assign
(paren
r_int
)paren
(paren
(paren
(paren
id|xfs_caddr_t
)paren
op_amp
id|pp
(braket
id|plast
)braket
op_minus
l_int|1
)paren
op_minus
(paren
id|xfs_caddr_t
)paren
id|block
)paren
suffix:semicolon
id|xfs_trans_log_buf
c_func
(paren
id|tp
comma
id|bp
comma
id|first
comma
id|last
)paren
suffix:semicolon
)brace
r_else
(brace
id|xfs_inode_t
op_star
id|ip
suffix:semicolon
id|ip
op_assign
id|cur-&gt;bc_private.b.ip
suffix:semicolon
id|xfs_trans_log_inode
c_func
(paren
id|tp
comma
id|ip
comma
id|XFS_ILOG_FBROOT
c_func
(paren
id|cur-&gt;bc_private.b.whichfork
)paren
)paren
suffix:semicolon
)brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Lookup the record.  The cursor is made to point to it, based on dir.&n; */
id|STATIC
r_int
multiline_comment|/* error */
DECL|function|xfs_bmbt_lookup
id|xfs_bmbt_lookup
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
id|xfs_lookup_t
id|dir
comma
r_int
op_star
id|stat
)paren
multiline_comment|/* success/failure */
(brace
id|xfs_bmbt_block_t
op_star
id|block
op_assign
l_int|NULL
suffix:semicolon
id|xfs_buf_t
op_star
id|bp
suffix:semicolon
id|xfs_daddr_t
id|d
suffix:semicolon
id|xfs_sfiloff_t
id|diff
suffix:semicolon
r_int
id|error
suffix:semicolon
multiline_comment|/* error return value */
macro_line|#ifdef XFS_BMBT_TRACE
r_static
r_char
id|fname
(braket
)braket
op_assign
l_string|&quot;xfs_bmbt_lookup&quot;
suffix:semicolon
macro_line|#endif
id|xfs_fsblock_t
id|fsbno
op_assign
l_int|0
suffix:semicolon
r_int
id|high
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|keyno
op_assign
l_int|0
suffix:semicolon
id|xfs_bmbt_key_t
op_star
id|kkbase
op_assign
l_int|NULL
suffix:semicolon
id|xfs_bmbt_key_t
op_star
id|kkp
suffix:semicolon
id|xfs_bmbt_rec_t
op_star
id|krbase
op_assign
l_int|NULL
suffix:semicolon
id|xfs_bmbt_rec_t
op_star
id|krp
suffix:semicolon
r_int
id|level
suffix:semicolon
r_int
id|low
suffix:semicolon
id|xfs_mount_t
op_star
id|mp
suffix:semicolon
id|xfs_bmbt_ptr_t
op_star
id|pp
suffix:semicolon
id|xfs_bmbt_irec_t
op_star
id|rp
suffix:semicolon
id|xfs_fileoff_t
id|startoff
suffix:semicolon
id|xfs_trans_t
op_star
id|tp
suffix:semicolon
id|XFS_STATS_INC
c_func
(paren
id|xfsstats.xs_bmbt_lookup
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ENTRY
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_ARGI
c_func
(paren
id|cur
comma
(paren
r_int
)paren
id|dir
)paren
suffix:semicolon
id|tp
op_assign
id|cur-&gt;bc_tp
suffix:semicolon
id|mp
op_assign
id|cur-&gt;bc_mp
suffix:semicolon
id|rp
op_assign
op_amp
id|cur-&gt;bc_rec.b
suffix:semicolon
r_for
c_loop
(paren
id|level
op_assign
id|cur-&gt;bc_nlevels
op_minus
l_int|1
comma
id|diff
op_assign
l_int|1
suffix:semicolon
id|level
op_ge
l_int|0
suffix:semicolon
id|level
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|level
OL
id|cur-&gt;bc_nlevels
op_minus
l_int|1
)paren
(brace
id|d
op_assign
id|XFS_FSB_TO_DADDR
c_func
(paren
id|mp
comma
id|fsbno
)paren
suffix:semicolon
id|bp
op_assign
id|cur-&gt;bc_bufs
(braket
id|level
)braket
suffix:semicolon
r_if
c_cond
(paren
id|bp
op_logical_and
id|XFS_BUF_ADDR
c_func
(paren
id|bp
)paren
op_ne
id|d
)paren
id|bp
op_assign
(paren
id|xfs_buf_t
op_star
)paren
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bp
)paren
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_read_bufl
c_func
(paren
id|mp
comma
id|tp
comma
id|fsbno
comma
l_int|0
comma
op_amp
id|bp
comma
id|XFS_BMAP_BTREE_REF
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|xfs_btree_setbuf
c_func
(paren
id|cur
comma
id|level
comma
id|bp
)paren
suffix:semicolon
id|block
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
id|bp
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|block
comma
id|level
comma
id|bp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
)brace
r_else
id|block
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
id|bp
)paren
suffix:semicolon
)brace
r_else
id|block
op_assign
id|xfs_bmbt_get_block
c_func
(paren
id|cur
comma
id|level
comma
op_amp
id|bp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|diff
op_eq
l_int|0
)paren
id|keyno
op_assign
l_int|1
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|level
OG
l_int|0
)paren
id|kkbase
op_assign
id|XFS_BMAP_KEY_IADDR
c_func
(paren
id|block
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
r_else
id|krbase
op_assign
id|XFS_BMAP_REC_IADDR
c_func
(paren
id|block
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|low
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|high
op_assign
id|INT_GET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
)paren
)paren
(brace
id|ASSERT
c_func
(paren
id|level
op_eq
l_int|0
)paren
suffix:semicolon
id|cur-&gt;bc_ptrs
(braket
l_int|0
)braket
op_assign
id|dir
op_ne
id|XFS_LOOKUP_LE
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
id|low
op_le
id|high
)paren
(brace
id|XFS_STATS_INC
c_func
(paren
id|xfsstats.xs_bmbt_compare
)paren
suffix:semicolon
id|keyno
op_assign
(paren
id|low
op_plus
id|high
)paren
op_rshift
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|level
OG
l_int|0
)paren
(brace
id|kkp
op_assign
id|kkbase
op_plus
id|keyno
op_minus
l_int|1
suffix:semicolon
id|startoff
op_assign
id|INT_GET
c_func
(paren
id|kkp-&gt;br_startoff
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
)brace
r_else
(brace
id|krp
op_assign
id|krbase
op_plus
id|keyno
op_minus
l_int|1
suffix:semicolon
id|startoff
op_assign
id|xfs_bmbt_disk_get_startoff
c_func
(paren
id|krp
)paren
suffix:semicolon
)brace
id|diff
op_assign
(paren
id|xfs_sfiloff_t
)paren
(paren
id|startoff
op_minus
id|rp-&gt;br_startoff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|diff
OL
l_int|0
)paren
id|low
op_assign
id|keyno
op_plus
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|diff
OG
l_int|0
)paren
id|high
op_assign
id|keyno
op_minus
l_int|1
suffix:semicolon
r_else
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|level
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|diff
OG
l_int|0
op_logical_and
op_decrement
id|keyno
OL
l_int|1
)paren
id|keyno
op_assign
l_int|1
suffix:semicolon
id|pp
op_assign
id|XFS_BMAP_PTR_IADDR
c_func
(paren
id|block
comma
id|keyno
comma
id|cur
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lptr
c_func
(paren
id|cur
comma
id|INT_GET
c_func
(paren
op_star
id|pp
comma
id|ARCH_CONVERT
)paren
comma
id|level
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#endif
id|fsbno
op_assign
id|INT_GET
c_func
(paren
op_star
id|pp
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
id|cur-&gt;bc_ptrs
(braket
id|level
)braket
op_assign
id|keyno
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|dir
op_ne
id|XFS_LOOKUP_LE
op_logical_and
id|diff
OL
l_int|0
)paren
(brace
id|keyno
op_increment
suffix:semicolon
multiline_comment|/*&n;&t;&t; * If ge search and we went off the end of the block, but it&squot;s&n;&t;&t; * not the last block, we&squot;re in the wrong block.&n;&t;&t; */
r_if
c_cond
(paren
id|dir
op_eq
id|XFS_LOOKUP_GE
op_logical_and
id|keyno
OG
id|INT_GET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_logical_and
id|INT_GET
c_func
(paren
id|block-&gt;bb_rightsib
comma
id|ARCH_CONVERT
)paren
op_ne
id|NULLDFSBNO
)paren
(brace
id|cur-&gt;bc_ptrs
(braket
l_int|0
)braket
op_assign
id|keyno
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_bmbt_increment
c_func
(paren
id|cur
comma
l_int|0
comma
op_amp
id|i
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|XFS_WANT_CORRUPTED_RETURN
c_func
(paren
id|i
op_eq
l_int|1
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|dir
op_eq
id|XFS_LOOKUP_LE
op_logical_and
id|diff
OG
l_int|0
)paren
id|keyno
op_decrement
suffix:semicolon
id|cur-&gt;bc_ptrs
(braket
l_int|0
)braket
op_assign
id|keyno
suffix:semicolon
r_if
c_cond
(paren
id|keyno
op_eq
l_int|0
op_logical_or
id|keyno
OG
id|INT_GET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
(paren
(paren
id|dir
op_ne
id|XFS_LOOKUP_EQ
)paren
op_logical_or
(paren
id|diff
op_eq
l_int|0
)paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Move 1 record left from cur/level if possible.&n; * Update cur to reflect the new path.&n; */
id|STATIC
r_int
multiline_comment|/* error */
DECL|function|xfs_bmbt_lshift
id|xfs_bmbt_lshift
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
r_int
id|level
comma
r_int
op_star
id|stat
)paren
multiline_comment|/* success/failure */
(brace
r_int
id|error
suffix:semicolon
multiline_comment|/* error return value */
macro_line|#ifdef XFS_BMBT_TRACE
r_static
r_char
id|fname
(braket
)braket
op_assign
l_string|&quot;xfs_bmbt_lshift&quot;
suffix:semicolon
macro_line|#endif
macro_line|#ifdef DEBUG
r_int
id|i
suffix:semicolon
multiline_comment|/* loop counter */
macro_line|#endif
id|xfs_bmbt_key_t
id|key
suffix:semicolon
multiline_comment|/* bmap btree key */
id|xfs_buf_t
op_star
id|lbp
suffix:semicolon
multiline_comment|/* left buffer pointer */
id|xfs_bmbt_block_t
op_star
id|left
suffix:semicolon
multiline_comment|/* left btree block */
id|xfs_bmbt_key_t
op_star
id|lkp
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* left btree key */
id|xfs_bmbt_ptr_t
op_star
id|lpp
suffix:semicolon
multiline_comment|/* left address pointer */
r_int
id|lrecs
suffix:semicolon
multiline_comment|/* left record count */
id|xfs_bmbt_rec_t
op_star
id|lrp
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* left record pointer */
id|xfs_mount_t
op_star
id|mp
suffix:semicolon
multiline_comment|/* file system mount point */
id|xfs_buf_t
op_star
id|rbp
suffix:semicolon
multiline_comment|/* right buffer pointer */
id|xfs_bmbt_block_t
op_star
id|right
suffix:semicolon
multiline_comment|/* right btree block */
id|xfs_bmbt_key_t
op_star
id|rkp
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* right btree key */
id|xfs_bmbt_ptr_t
op_star
id|rpp
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* right address pointer */
id|xfs_bmbt_rec_t
op_star
id|rrp
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* right record pointer */
r_int
id|rrecs
suffix:semicolon
multiline_comment|/* right record count */
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ENTRY
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_ARGI
c_func
(paren
id|cur
comma
id|level
)paren
suffix:semicolon
r_if
c_cond
(paren
id|level
op_eq
id|cur-&gt;bc_nlevels
op_minus
l_int|1
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|rbp
op_assign
id|cur-&gt;bc_bufs
(braket
id|level
)braket
suffix:semicolon
id|right
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
id|rbp
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|right
comma
id|level
comma
id|rbp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|INT_GET
c_func
(paren
id|right-&gt;bb_leftsib
comma
id|ARCH_CONVERT
)paren
op_eq
id|NULLDFSBNO
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cur-&gt;bc_ptrs
(braket
id|level
)braket
op_le
l_int|1
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|mp
op_assign
id|cur-&gt;bc_mp
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_read_bufl
c_func
(paren
id|mp
comma
id|cur-&gt;bc_tp
comma
id|INT_GET
c_func
(paren
id|right-&gt;bb_leftsib
comma
id|ARCH_CONVERT
)paren
comma
l_int|0
comma
op_amp
id|lbp
comma
id|XFS_BMAP_BTREE_REF
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|left
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
id|lbp
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|left
comma
id|level
comma
id|lbp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|INT_GET
c_func
(paren
id|left-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_eq
id|XFS_BMAP_BLOCK_IMAXRECS
c_func
(paren
id|level
comma
id|cur
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|lrecs
op_assign
id|INT_GET
c_func
(paren
id|left-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|level
OG
l_int|0
)paren
(brace
id|lkp
op_assign
id|XFS_BMAP_KEY_IADDR
c_func
(paren
id|left
comma
id|lrecs
comma
id|cur
)paren
suffix:semicolon
id|rkp
op_assign
id|XFS_BMAP_KEY_IADDR
c_func
(paren
id|right
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
op_star
id|lkp
op_assign
op_star
id|rkp
suffix:semicolon
id|xfs_bmbt_log_keys
c_func
(paren
id|cur
comma
id|lbp
comma
id|lrecs
comma
id|lrecs
)paren
suffix:semicolon
id|lpp
op_assign
id|XFS_BMAP_PTR_IADDR
c_func
(paren
id|left
comma
id|lrecs
comma
id|cur
)paren
suffix:semicolon
id|rpp
op_assign
id|XFS_BMAP_PTR_IADDR
c_func
(paren
id|right
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lptr
c_func
(paren
id|cur
comma
id|INT_GET
c_func
(paren
op_star
id|rpp
comma
id|ARCH_CONVERT
)paren
comma
id|level
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#endif
op_star
id|lpp
op_assign
op_star
id|rpp
suffix:semicolon
multiline_comment|/* INT_: direct copy */
id|xfs_bmbt_log_ptrs
c_func
(paren
id|cur
comma
id|lbp
comma
id|lrecs
comma
id|lrecs
)paren
suffix:semicolon
)brace
r_else
(brace
id|lrp
op_assign
id|XFS_BMAP_REC_IADDR
c_func
(paren
id|left
comma
id|lrecs
comma
id|cur
)paren
suffix:semicolon
id|rrp
op_assign
id|XFS_BMAP_REC_IADDR
c_func
(paren
id|right
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
op_star
id|lrp
op_assign
op_star
id|rrp
suffix:semicolon
id|xfs_bmbt_log_recs
c_func
(paren
id|cur
comma
id|lbp
comma
id|lrecs
comma
id|lrecs
)paren
suffix:semicolon
)brace
id|INT_SET
c_func
(paren
id|left-&gt;bb_numrecs
comma
id|ARCH_CONVERT
comma
id|lrecs
)paren
suffix:semicolon
id|xfs_bmbt_log_block
c_func
(paren
id|cur
comma
id|lbp
comma
id|XFS_BB_NUMRECS
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|level
OG
l_int|0
)paren
id|xfs_btree_check_key
c_func
(paren
id|XFS_BTNUM_BMAP
comma
id|lkp
op_minus
l_int|1
comma
id|lkp
)paren
suffix:semicolon
r_else
id|xfs_btree_check_rec
c_func
(paren
id|XFS_BTNUM_BMAP
comma
id|lrp
op_minus
l_int|1
comma
id|lrp
)paren
suffix:semicolon
macro_line|#endif
id|rrecs
op_assign
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_minus
l_int|1
suffix:semicolon
id|INT_SET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
comma
id|rrecs
)paren
suffix:semicolon
id|xfs_bmbt_log_block
c_func
(paren
id|cur
comma
id|rbp
comma
id|XFS_BB_NUMRECS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|level
OG
l_int|0
)paren
(brace
macro_line|#ifdef DEBUG
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|rrecs
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lptr
c_func
(paren
id|cur
comma
id|INT_GET
c_func
(paren
id|rpp
(braket
id|i
op_plus
l_int|1
)braket
comma
id|ARCH_CONVERT
)paren
comma
id|level
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
)brace
macro_line|#endif
id|memmove
c_func
(paren
id|rkp
comma
id|rkp
op_plus
l_int|1
comma
id|rrecs
op_star
r_sizeof
(paren
op_star
id|rkp
)paren
)paren
suffix:semicolon
id|memmove
c_func
(paren
id|rpp
comma
id|rpp
op_plus
l_int|1
comma
id|rrecs
op_star
r_sizeof
(paren
op_star
id|rpp
)paren
)paren
suffix:semicolon
id|xfs_bmbt_log_keys
c_func
(paren
id|cur
comma
id|rbp
comma
l_int|1
comma
id|rrecs
)paren
suffix:semicolon
id|xfs_bmbt_log_ptrs
c_func
(paren
id|cur
comma
id|rbp
comma
l_int|1
comma
id|rrecs
)paren
suffix:semicolon
)brace
r_else
(brace
id|memmove
c_func
(paren
id|rrp
comma
id|rrp
op_plus
l_int|1
comma
id|rrecs
op_star
r_sizeof
(paren
op_star
id|rrp
)paren
)paren
suffix:semicolon
id|xfs_bmbt_log_recs
c_func
(paren
id|cur
comma
id|rbp
comma
l_int|1
comma
id|rrecs
)paren
suffix:semicolon
id|INT_SET
c_func
(paren
id|key.br_startoff
comma
id|ARCH_CONVERT
comma
id|xfs_bmbt_disk_get_startoff
c_func
(paren
id|rrp
)paren
)paren
suffix:semicolon
id|rkp
op_assign
op_amp
id|key
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_bmbt_updkey
c_func
(paren
id|cur
comma
id|rkp
comma
id|level
op_plus
l_int|1
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|cur-&gt;bc_ptrs
(braket
id|level
)braket
op_decrement
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Move 1 record right from cur/level if possible.&n; * Update cur to reflect the new path.&n; */
id|STATIC
r_int
multiline_comment|/* error */
DECL|function|xfs_bmbt_rshift
id|xfs_bmbt_rshift
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
r_int
id|level
comma
r_int
op_star
id|stat
)paren
multiline_comment|/* success/failure */
(brace
r_int
id|error
suffix:semicolon
multiline_comment|/* error return value */
macro_line|#ifdef XFS_BMBT_TRACE
r_static
r_char
id|fname
(braket
)braket
op_assign
l_string|&quot;xfs_bmbt_rshift&quot;
suffix:semicolon
macro_line|#endif
r_int
id|i
suffix:semicolon
multiline_comment|/* loop counter */
id|xfs_bmbt_key_t
id|key
suffix:semicolon
multiline_comment|/* bmap btree key */
id|xfs_buf_t
op_star
id|lbp
suffix:semicolon
multiline_comment|/* left buffer pointer */
id|xfs_bmbt_block_t
op_star
id|left
suffix:semicolon
multiline_comment|/* left btree block */
id|xfs_bmbt_key_t
op_star
id|lkp
suffix:semicolon
multiline_comment|/* left btree key */
id|xfs_bmbt_ptr_t
op_star
id|lpp
suffix:semicolon
multiline_comment|/* left address pointer */
id|xfs_bmbt_rec_t
op_star
id|lrp
suffix:semicolon
multiline_comment|/* left record pointer */
id|xfs_mount_t
op_star
id|mp
suffix:semicolon
multiline_comment|/* file system mount point */
id|xfs_buf_t
op_star
id|rbp
suffix:semicolon
multiline_comment|/* right buffer pointer */
id|xfs_bmbt_block_t
op_star
id|right
suffix:semicolon
multiline_comment|/* right btree block */
id|xfs_bmbt_key_t
op_star
id|rkp
suffix:semicolon
multiline_comment|/* right btree key */
id|xfs_bmbt_ptr_t
op_star
id|rpp
suffix:semicolon
multiline_comment|/* right address pointer */
id|xfs_bmbt_rec_t
op_star
id|rrp
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* right record pointer */
r_struct
id|xfs_btree_cur
op_star
id|tcur
suffix:semicolon
multiline_comment|/* temporary btree cursor */
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ENTRY
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_ARGI
c_func
(paren
id|cur
comma
id|level
)paren
suffix:semicolon
r_if
c_cond
(paren
id|level
op_eq
id|cur-&gt;bc_nlevels
op_minus
l_int|1
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|lbp
op_assign
id|cur-&gt;bc_bufs
(braket
id|level
)braket
suffix:semicolon
id|left
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
id|lbp
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|left
comma
id|level
comma
id|lbp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|INT_GET
c_func
(paren
id|left-&gt;bb_rightsib
comma
id|ARCH_CONVERT
)paren
op_eq
id|NULLDFSBNO
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cur-&gt;bc_ptrs
(braket
id|level
)braket
op_ge
id|INT_GET
c_func
(paren
id|left-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|mp
op_assign
id|cur-&gt;bc_mp
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_read_bufl
c_func
(paren
id|mp
comma
id|cur-&gt;bc_tp
comma
id|INT_GET
c_func
(paren
id|left-&gt;bb_rightsib
comma
id|ARCH_CONVERT
)paren
comma
l_int|0
comma
op_amp
id|rbp
comma
id|XFS_BMAP_BTREE_REF
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|right
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
id|rbp
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|right
comma
id|level
comma
id|rbp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_eq
id|XFS_BMAP_BLOCK_IMAXRECS
c_func
(paren
id|level
comma
id|cur
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|level
OG
l_int|0
)paren
(brace
id|lkp
op_assign
id|XFS_BMAP_KEY_IADDR
c_func
(paren
id|left
comma
id|INT_GET
c_func
(paren
id|left-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
comma
id|cur
)paren
suffix:semicolon
id|lpp
op_assign
id|XFS_BMAP_PTR_IADDR
c_func
(paren
id|left
comma
id|INT_GET
c_func
(paren
id|left-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
comma
id|cur
)paren
suffix:semicolon
id|rkp
op_assign
id|XFS_BMAP_KEY_IADDR
c_func
(paren
id|right
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|rpp
op_assign
id|XFS_BMAP_PTR_IADDR
c_func
(paren
id|right
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_for
c_loop
(paren
id|i
op_assign
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lptr
c_func
(paren
id|cur
comma
id|INT_GET
c_func
(paren
id|rpp
(braket
id|i
)braket
comma
id|ARCH_CONVERT
)paren
comma
id|level
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
)brace
macro_line|#endif
id|memmove
c_func
(paren
id|rkp
op_plus
l_int|1
comma
id|rkp
comma
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_star
r_sizeof
(paren
op_star
id|rkp
)paren
)paren
suffix:semicolon
id|memmove
c_func
(paren
id|rpp
op_plus
l_int|1
comma
id|rpp
comma
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_star
r_sizeof
(paren
op_star
id|rpp
)paren
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lptr
c_func
(paren
id|cur
comma
id|INT_GET
c_func
(paren
op_star
id|lpp
comma
id|ARCH_CONVERT
)paren
comma
id|level
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#endif
op_star
id|rkp
op_assign
op_star
id|lkp
suffix:semicolon
op_star
id|rpp
op_assign
op_star
id|lpp
suffix:semicolon
multiline_comment|/* INT_: direct copy */
id|xfs_bmbt_log_keys
c_func
(paren
id|cur
comma
id|rbp
comma
l_int|1
comma
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_plus
l_int|1
)paren
suffix:semicolon
id|xfs_bmbt_log_ptrs
c_func
(paren
id|cur
comma
id|rbp
comma
l_int|1
comma
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|lrp
op_assign
id|XFS_BMAP_REC_IADDR
c_func
(paren
id|left
comma
id|INT_GET
c_func
(paren
id|left-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
comma
id|cur
)paren
suffix:semicolon
id|rrp
op_assign
id|XFS_BMAP_REC_IADDR
c_func
(paren
id|right
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|memmove
c_func
(paren
id|rrp
op_plus
l_int|1
comma
id|rrp
comma
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_star
r_sizeof
(paren
op_star
id|rrp
)paren
)paren
suffix:semicolon
op_star
id|rrp
op_assign
op_star
id|lrp
suffix:semicolon
id|xfs_bmbt_log_recs
c_func
(paren
id|cur
comma
id|rbp
comma
l_int|1
comma
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_plus
l_int|1
)paren
suffix:semicolon
id|INT_SET
c_func
(paren
id|key.br_startoff
comma
id|ARCH_CONVERT
comma
id|xfs_bmbt_disk_get_startoff
c_func
(paren
id|rrp
)paren
)paren
suffix:semicolon
id|rkp
op_assign
op_amp
id|key
suffix:semicolon
)brace
id|INT_MOD
c_func
(paren
id|left-&gt;bb_numrecs
comma
id|ARCH_CONVERT
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|xfs_bmbt_log_block
c_func
(paren
id|cur
comma
id|lbp
comma
id|XFS_BB_NUMRECS
)paren
suffix:semicolon
id|INT_MOD
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
comma
op_plus
l_int|1
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|level
OG
l_int|0
)paren
id|xfs_btree_check_key
c_func
(paren
id|XFS_BTNUM_BMAP
comma
id|rkp
comma
id|rkp
op_plus
l_int|1
)paren
suffix:semicolon
r_else
id|xfs_btree_check_rec
c_func
(paren
id|XFS_BTNUM_BMAP
comma
id|rrp
comma
id|rrp
op_plus
l_int|1
)paren
suffix:semicolon
macro_line|#endif
id|xfs_bmbt_log_block
c_func
(paren
id|cur
comma
id|rbp
comma
id|XFS_BB_NUMRECS
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_dup_cursor
c_func
(paren
id|cur
comma
op_amp
id|tcur
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|i
op_assign
id|xfs_btree_lastrec
c_func
(paren
id|tcur
comma
id|level
)paren
suffix:semicolon
id|XFS_WANT_CORRUPTED_GOTO
c_func
(paren
id|i
op_eq
l_int|1
comma
id|error0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_bmbt_increment
c_func
(paren
id|tcur
comma
id|level
comma
op_amp
id|i
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|tcur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error1
suffix:semicolon
)brace
id|XFS_WANT_CORRUPTED_GOTO
c_func
(paren
id|i
op_eq
l_int|1
comma
id|error0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_bmbt_updkey
c_func
(paren
id|tcur
comma
id|rkp
comma
id|level
op_plus
l_int|1
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|tcur
comma
id|ERROR
)paren
suffix:semicolon
r_goto
id|error1
suffix:semicolon
)brace
id|xfs_btree_del_cursor
c_func
(paren
id|tcur
comma
id|XFS_BTREE_NOERROR
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|error0
suffix:colon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
id|error1
suffix:colon
id|xfs_btree_del_cursor
c_func
(paren
id|tcur
comma
id|XFS_BTREE_ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/*&n; * Determine the extent state.&n; */
multiline_comment|/* ARGSUSED */
id|STATIC
id|xfs_exntst_t
DECL|function|xfs_extent_state
id|xfs_extent_state
c_func
(paren
id|xfs_filblks_t
id|blks
comma
r_int
id|extent_flag
)paren
(brace
r_if
c_cond
(paren
id|extent_flag
)paren
(brace
id|ASSERT
c_func
(paren
id|blks
op_ne
l_int|0
)paren
suffix:semicolon
multiline_comment|/* saved for DMIG */
r_return
id|XFS_EXT_UNWRITTEN
suffix:semicolon
)brace
r_return
id|XFS_EXT_NORM
suffix:semicolon
)brace
multiline_comment|/*&n; * Split cur/level block in half.&n; * Return new block number and its first record (to be inserted into parent).&n; */
id|STATIC
r_int
multiline_comment|/* error */
DECL|function|xfs_bmbt_split
id|xfs_bmbt_split
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
r_int
id|level
comma
id|xfs_fsblock_t
op_star
id|bnop
comma
id|xfs_bmbt_key_t
op_star
id|keyp
comma
id|xfs_btree_cur_t
op_star
op_star
id|curp
comma
r_int
op_star
id|stat
)paren
multiline_comment|/* success/failure */
(brace
id|xfs_alloc_arg_t
id|args
suffix:semicolon
multiline_comment|/* block allocation args */
r_int
id|error
suffix:semicolon
multiline_comment|/* error return value */
macro_line|#ifdef XFS_BMBT_TRACE
r_static
r_char
id|fname
(braket
)braket
op_assign
l_string|&quot;xfs_bmbt_split&quot;
suffix:semicolon
macro_line|#endif
r_int
id|i
suffix:semicolon
multiline_comment|/* loop counter */
id|xfs_fsblock_t
id|lbno
suffix:semicolon
multiline_comment|/* left sibling block number */
id|xfs_buf_t
op_star
id|lbp
suffix:semicolon
multiline_comment|/* left buffer pointer */
id|xfs_bmbt_block_t
op_star
id|left
suffix:semicolon
multiline_comment|/* left btree block */
id|xfs_bmbt_key_t
op_star
id|lkp
suffix:semicolon
multiline_comment|/* left btree key */
id|xfs_bmbt_ptr_t
op_star
id|lpp
suffix:semicolon
multiline_comment|/* left address pointer */
id|xfs_bmbt_rec_t
op_star
id|lrp
suffix:semicolon
multiline_comment|/* left record pointer */
id|xfs_buf_t
op_star
id|rbp
suffix:semicolon
multiline_comment|/* right buffer pointer */
id|xfs_bmbt_block_t
op_star
id|right
suffix:semicolon
multiline_comment|/* right btree block */
id|xfs_bmbt_key_t
op_star
id|rkp
suffix:semicolon
multiline_comment|/* right btree key */
id|xfs_bmbt_ptr_t
op_star
id|rpp
suffix:semicolon
multiline_comment|/* right address pointer */
id|xfs_bmbt_block_t
op_star
id|rrblock
suffix:semicolon
multiline_comment|/* right-right btree block */
id|xfs_buf_t
op_star
id|rrbp
suffix:semicolon
multiline_comment|/* right-right buffer pointer */
id|xfs_bmbt_rec_t
op_star
id|rrp
suffix:semicolon
multiline_comment|/* right record pointer */
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ENTRY
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_ARGIFK
c_func
(paren
id|cur
comma
id|level
comma
op_star
id|bnop
comma
id|keyp
)paren
suffix:semicolon
id|args.tp
op_assign
id|cur-&gt;bc_tp
suffix:semicolon
id|args.mp
op_assign
id|cur-&gt;bc_mp
suffix:semicolon
id|lbp
op_assign
id|cur-&gt;bc_bufs
(braket
id|level
)braket
suffix:semicolon
id|lbno
op_assign
id|XFS_DADDR_TO_FSB
c_func
(paren
id|args.mp
comma
id|XFS_BUF_ADDR
c_func
(paren
id|lbp
)paren
)paren
suffix:semicolon
id|left
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
id|lbp
)paren
suffix:semicolon
id|args.fsbno
op_assign
id|cur-&gt;bc_private.b.firstblock
suffix:semicolon
r_if
c_cond
(paren
id|args.fsbno
op_eq
id|NULLFSBLOCK
)paren
(brace
id|args.fsbno
op_assign
id|lbno
suffix:semicolon
id|args.type
op_assign
id|XFS_ALLOCTYPE_START_BNO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cur-&gt;bc_private.b.flist-&gt;xbf_low
)paren
id|args.type
op_assign
id|XFS_ALLOCTYPE_FIRST_AG
suffix:semicolon
r_else
id|args.type
op_assign
id|XFS_ALLOCTYPE_NEAR_BNO
suffix:semicolon
id|args.mod
op_assign
id|args.minleft
op_assign
id|args.alignment
op_assign
id|args.total
op_assign
id|args.isfl
op_assign
id|args.userdata
op_assign
id|args.minalignslop
op_assign
l_int|0
suffix:semicolon
id|args.minlen
op_assign
id|args.maxlen
op_assign
id|args.prod
op_assign
l_int|1
suffix:semicolon
id|args.wasdel
op_assign
id|cur-&gt;bc_private.b.flags
op_amp
id|XFS_BTCUR_BPRV_WASDEL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|args.wasdel
op_logical_and
id|xfs_trans_get_block_res
c_func
(paren
id|args.tp
)paren
op_eq
l_int|0
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|XFS_ERROR
c_func
(paren
id|ENOSPC
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_alloc_vextent
c_func
(paren
op_amp
id|args
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|args.fsbno
op_eq
id|NULLFSBLOCK
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ASSERT
c_func
(paren
id|args.len
op_eq
l_int|1
)paren
suffix:semicolon
id|cur-&gt;bc_private.b.firstblock
op_assign
id|args.fsbno
suffix:semicolon
id|cur-&gt;bc_private.b.allocated
op_increment
suffix:semicolon
id|cur-&gt;bc_private.b.ip-&gt;i_d.di_nblocks
op_increment
suffix:semicolon
id|xfs_trans_log_inode
c_func
(paren
id|args.tp
comma
id|cur-&gt;bc_private.b.ip
comma
id|XFS_ILOG_CORE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|XFS_IS_QUOTA_ON
c_func
(paren
id|args.mp
)paren
op_logical_and
id|cur-&gt;bc_private.b.ip-&gt;i_ino
op_ne
id|args.mp-&gt;m_sb.sb_uquotino
op_logical_and
id|cur-&gt;bc_private.b.ip-&gt;i_ino
op_ne
id|args.mp-&gt;m_sb.sb_gquotino
)paren
id|xfs_trans_mod_dquot_byino
c_func
(paren
id|args.tp
comma
id|cur-&gt;bc_private.b.ip
comma
id|XFS_TRANS_DQ_BCOUNT
comma
l_int|1L
)paren
suffix:semicolon
id|rbp
op_assign
id|xfs_btree_get_bufl
c_func
(paren
id|args.mp
comma
id|args.tp
comma
id|args.fsbno
comma
l_int|0
)paren
suffix:semicolon
id|right
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
id|rbp
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|left
comma
id|level
comma
id|rbp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#endif
id|INT_SET
c_func
(paren
id|right-&gt;bb_magic
comma
id|ARCH_CONVERT
comma
id|XFS_BMAP_MAGIC
)paren
suffix:semicolon
id|right-&gt;bb_level
op_assign
id|left-&gt;bb_level
suffix:semicolon
multiline_comment|/* INT_: direct copy */
id|INT_SET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
comma
(paren
id|__uint16_t
)paren
(paren
id|INT_GET
c_func
(paren
id|left-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_div
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|INT_GET
c_func
(paren
id|left-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_amp
l_int|1
)paren
op_logical_and
id|cur-&gt;bc_ptrs
(braket
id|level
)braket
op_le
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_plus
l_int|1
)paren
id|INT_MOD
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
comma
op_plus
l_int|1
)paren
suffix:semicolon
id|i
op_assign
id|INT_GET
c_func
(paren
id|left-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_minus
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|level
OG
l_int|0
)paren
(brace
id|lkp
op_assign
id|XFS_BMAP_KEY_IADDR
c_func
(paren
id|left
comma
id|i
comma
id|cur
)paren
suffix:semicolon
id|lpp
op_assign
id|XFS_BMAP_PTR_IADDR
c_func
(paren
id|left
comma
id|i
comma
id|cur
)paren
suffix:semicolon
id|rkp
op_assign
id|XFS_BMAP_KEY_IADDR
c_func
(paren
id|right
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|rpp
op_assign
id|XFS_BMAP_PTR_IADDR
c_func
(paren
id|right
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lptr
c_func
(paren
id|cur
comma
id|INT_GET
c_func
(paren
id|lpp
(braket
id|i
)braket
comma
id|ARCH_CONVERT
)paren
comma
id|level
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
)brace
macro_line|#endif
id|memcpy
c_func
(paren
id|rkp
comma
id|lkp
comma
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_star
r_sizeof
(paren
op_star
id|rkp
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|rpp
comma
id|lpp
comma
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_star
r_sizeof
(paren
op_star
id|rpp
)paren
)paren
suffix:semicolon
id|xfs_bmbt_log_keys
c_func
(paren
id|cur
comma
id|rbp
comma
l_int|1
comma
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
)paren
suffix:semicolon
id|xfs_bmbt_log_ptrs
c_func
(paren
id|cur
comma
id|rbp
comma
l_int|1
comma
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
)paren
suffix:semicolon
id|keyp-&gt;br_startoff
op_assign
id|INT_GET
c_func
(paren
id|rkp-&gt;br_startoff
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
)brace
r_else
(brace
id|lrp
op_assign
id|XFS_BMAP_REC_IADDR
c_func
(paren
id|left
comma
id|i
comma
id|cur
)paren
suffix:semicolon
id|rrp
op_assign
id|XFS_BMAP_REC_IADDR
c_func
(paren
id|right
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|rrp
comma
id|lrp
comma
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_star
r_sizeof
(paren
op_star
id|rrp
)paren
)paren
suffix:semicolon
id|xfs_bmbt_log_recs
c_func
(paren
id|cur
comma
id|rbp
comma
l_int|1
comma
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
)paren
suffix:semicolon
id|keyp-&gt;br_startoff
op_assign
id|xfs_bmbt_disk_get_startoff
c_func
(paren
id|rrp
)paren
suffix:semicolon
)brace
id|INT_MOD
c_func
(paren
id|left-&gt;bb_numrecs
comma
id|ARCH_CONVERT
comma
op_minus
(paren
id|INT_GET
c_func
(paren
id|right-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
)paren
)paren
suffix:semicolon
id|right-&gt;bb_rightsib
op_assign
id|left-&gt;bb_rightsib
suffix:semicolon
multiline_comment|/* INT_: direct copy */
id|INT_SET
c_func
(paren
id|left-&gt;bb_rightsib
comma
id|ARCH_CONVERT
comma
id|args.fsbno
)paren
suffix:semicolon
id|INT_SET
c_func
(paren
id|right-&gt;bb_leftsib
comma
id|ARCH_CONVERT
comma
id|lbno
)paren
suffix:semicolon
id|xfs_bmbt_log_block
c_func
(paren
id|cur
comma
id|rbp
comma
id|XFS_BB_ALL_BITS
)paren
suffix:semicolon
id|xfs_bmbt_log_block
c_func
(paren
id|cur
comma
id|lbp
comma
id|XFS_BB_NUMRECS
op_or
id|XFS_BB_RIGHTSIB
)paren
suffix:semicolon
r_if
c_cond
(paren
id|INT_GET
c_func
(paren
id|right-&gt;bb_rightsib
comma
id|ARCH_CONVERT
)paren
op_ne
id|NULLDFSBNO
)paren
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_read_bufl
c_func
(paren
id|args.mp
comma
id|args.tp
comma
id|INT_GET
c_func
(paren
id|right-&gt;bb_rightsib
comma
id|ARCH_CONVERT
)paren
comma
l_int|0
comma
op_amp
id|rrbp
comma
id|XFS_BMAP_BTREE_REF
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|rrblock
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
id|rrbp
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|rrblock
comma
id|level
comma
id|rrbp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|INT_SET
c_func
(paren
id|rrblock-&gt;bb_leftsib
comma
id|ARCH_CONVERT
comma
id|args.fsbno
)paren
suffix:semicolon
id|xfs_bmbt_log_block
c_func
(paren
id|cur
comma
id|rrbp
comma
id|XFS_BB_LEFTSIB
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cur-&gt;bc_ptrs
(braket
id|level
)braket
OG
id|INT_GET
c_func
(paren
id|left-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_plus
l_int|1
)paren
(brace
id|xfs_btree_setbuf
c_func
(paren
id|cur
comma
id|level
comma
id|rbp
)paren
suffix:semicolon
id|cur-&gt;bc_ptrs
(braket
id|level
)braket
op_sub_assign
id|INT_GET
c_func
(paren
id|left-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|level
op_plus
l_int|1
OL
id|cur-&gt;bc_nlevels
)paren
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_dup_cursor
c_func
(paren
id|cur
comma
id|curp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
(paren
op_star
id|curp
)paren
op_member_access_from_pointer
id|bc_ptrs
(braket
id|level
op_plus
l_int|1
)braket
op_increment
suffix:semicolon
)brace
op_star
id|bnop
op_assign
id|args.fsbno
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Update keys for the record.&n; */
id|STATIC
r_int
DECL|function|xfs_bmbt_updkey
id|xfs_bmbt_updkey
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
id|xfs_bmbt_key_t
op_star
id|keyp
comma
multiline_comment|/* on-disk format */
r_int
id|level
)paren
(brace
id|xfs_bmbt_block_t
op_star
id|block
suffix:semicolon
id|xfs_buf_t
op_star
id|bp
suffix:semicolon
macro_line|#ifdef DEBUG
r_int
id|error
suffix:semicolon
macro_line|#endif
macro_line|#ifdef XFS_BMBT_TRACE
r_static
r_char
id|fname
(braket
)braket
op_assign
l_string|&quot;xfs_bmbt_updkey&quot;
suffix:semicolon
macro_line|#endif
id|xfs_bmbt_key_t
op_star
id|kp
suffix:semicolon
r_int
id|ptr
suffix:semicolon
id|ASSERT
c_func
(paren
id|level
op_ge
l_int|1
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ENTRY
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_ARGIK
c_func
(paren
id|cur
comma
id|level
comma
id|keyp
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ptr
op_assign
l_int|1
suffix:semicolon
id|ptr
op_eq
l_int|1
op_logical_and
id|level
OL
id|cur-&gt;bc_nlevels
suffix:semicolon
id|level
op_increment
)paren
(brace
id|block
op_assign
id|xfs_bmbt_get_block
c_func
(paren
id|cur
comma
id|level
comma
op_amp
id|bp
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|block
comma
id|level
comma
id|bp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#endif
id|ptr
op_assign
id|cur-&gt;bc_ptrs
(braket
id|level
)braket
suffix:semicolon
id|kp
op_assign
id|XFS_BMAP_KEY_IADDR
c_func
(paren
id|block
comma
id|ptr
comma
id|cur
)paren
suffix:semicolon
op_star
id|kp
op_assign
op_star
id|keyp
suffix:semicolon
id|xfs_bmbt_log_keys
c_func
(paren
id|cur
comma
id|bp
comma
id|ptr
comma
id|ptr
)paren
suffix:semicolon
)brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Convert on-disk form of btree root to in-memory form.&n; */
r_void
DECL|function|xfs_bmdr_to_bmbt
id|xfs_bmdr_to_bmbt
c_func
(paren
id|xfs_bmdr_block_t
op_star
id|dblock
comma
r_int
id|dblocklen
comma
id|xfs_bmbt_block_t
op_star
id|rblock
comma
r_int
id|rblocklen
)paren
(brace
r_int
id|dmxr
suffix:semicolon
id|xfs_bmbt_key_t
op_star
id|fkp
suffix:semicolon
id|xfs_bmbt_ptr_t
op_star
id|fpp
suffix:semicolon
id|xfs_bmbt_key_t
op_star
id|tkp
suffix:semicolon
id|xfs_bmbt_ptr_t
op_star
id|tpp
suffix:semicolon
id|INT_SET
c_func
(paren
id|rblock-&gt;bb_magic
comma
id|ARCH_CONVERT
comma
id|XFS_BMAP_MAGIC
)paren
suffix:semicolon
id|rblock-&gt;bb_level
op_assign
id|dblock-&gt;bb_level
suffix:semicolon
multiline_comment|/* both in on-disk format */
id|ASSERT
c_func
(paren
id|INT_GET
c_func
(paren
id|rblock-&gt;bb_level
comma
id|ARCH_CONVERT
)paren
OG
l_int|0
)paren
suffix:semicolon
id|rblock-&gt;bb_numrecs
op_assign
id|dblock-&gt;bb_numrecs
suffix:semicolon
multiline_comment|/* both in on-disk format */
id|INT_SET
c_func
(paren
id|rblock-&gt;bb_leftsib
comma
id|ARCH_CONVERT
comma
id|NULLDFSBNO
)paren
suffix:semicolon
id|INT_SET
c_func
(paren
id|rblock-&gt;bb_rightsib
comma
id|ARCH_CONVERT
comma
id|NULLDFSBNO
)paren
suffix:semicolon
id|dmxr
op_assign
(paren
r_int
)paren
id|XFS_BTREE_BLOCK_MAXRECS
c_func
(paren
id|dblocklen
comma
id|xfs_bmdr
comma
l_int|0
)paren
suffix:semicolon
id|fkp
op_assign
id|XFS_BTREE_KEY_ADDR
c_func
(paren
id|dblocklen
comma
id|xfs_bmdr
comma
id|dblock
comma
l_int|1
comma
id|dmxr
)paren
suffix:semicolon
id|tkp
op_assign
id|XFS_BMAP_BROOT_KEY_ADDR
c_func
(paren
id|rblock
comma
l_int|1
comma
id|rblocklen
)paren
suffix:semicolon
id|fpp
op_assign
id|XFS_BTREE_PTR_ADDR
c_func
(paren
id|dblocklen
comma
id|xfs_bmdr
comma
id|dblock
comma
l_int|1
comma
id|dmxr
)paren
suffix:semicolon
id|tpp
op_assign
id|XFS_BMAP_BROOT_PTR_ADDR
c_func
(paren
id|rblock
comma
l_int|1
comma
id|rblocklen
)paren
suffix:semicolon
id|dmxr
op_assign
id|INT_GET
c_func
(paren
id|dblock-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|tkp
comma
id|fkp
comma
r_sizeof
(paren
op_star
id|fkp
)paren
op_star
id|dmxr
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|tpp
comma
id|fpp
comma
r_sizeof
(paren
op_star
id|fpp
)paren
op_star
id|dmxr
)paren
suffix:semicolon
multiline_comment|/* INT_: direct copy */
)brace
multiline_comment|/*&n; * Decrement cursor by one record at the level.&n; * For nonzero levels the leaf-ward information is untouched.&n; */
r_int
multiline_comment|/* error */
DECL|function|xfs_bmbt_decrement
id|xfs_bmbt_decrement
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
r_int
id|level
comma
r_int
op_star
id|stat
)paren
multiline_comment|/* success/failure */
(brace
id|xfs_bmbt_block_t
op_star
id|block
suffix:semicolon
id|xfs_buf_t
op_star
id|bp
suffix:semicolon
r_int
id|error
suffix:semicolon
multiline_comment|/* error return value */
macro_line|#ifdef XFS_BMBT_TRACE
r_static
r_char
id|fname
(braket
)braket
op_assign
l_string|&quot;xfs_bmbt_decrement&quot;
suffix:semicolon
macro_line|#endif
id|xfs_fsblock_t
id|fsbno
suffix:semicolon
r_int
id|lev
suffix:semicolon
id|xfs_mount_t
op_star
id|mp
suffix:semicolon
id|xfs_trans_t
op_star
id|tp
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ENTRY
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_ARGI
c_func
(paren
id|cur
comma
id|level
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|level
OL
id|cur-&gt;bc_nlevels
)paren
suffix:semicolon
r_if
c_cond
(paren
id|level
OL
id|cur-&gt;bc_nlevels
op_minus
l_int|1
)paren
id|xfs_btree_readahead
c_func
(paren
id|cur
comma
id|level
comma
id|XFS_BTCUR_LEFTRA
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|cur-&gt;bc_ptrs
(braket
id|level
)braket
OG
l_int|0
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|block
op_assign
id|xfs_bmbt_get_block
c_func
(paren
id|cur
comma
id|level
comma
op_amp
id|bp
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|block
comma
id|level
comma
id|bp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|INT_GET
c_func
(paren
id|block-&gt;bb_leftsib
comma
id|ARCH_CONVERT
)paren
op_eq
id|NULLDFSBNO
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|lev
op_assign
id|level
op_plus
l_int|1
suffix:semicolon
id|lev
OL
id|cur-&gt;bc_nlevels
suffix:semicolon
id|lev
op_increment
)paren
(brace
r_if
c_cond
(paren
op_decrement
id|cur-&gt;bc_ptrs
(braket
id|lev
)braket
OG
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|lev
OL
id|cur-&gt;bc_nlevels
op_minus
l_int|1
)paren
id|xfs_btree_readahead
c_func
(paren
id|cur
comma
id|lev
comma
id|XFS_BTCUR_LEFTRA
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lev
op_eq
id|cur-&gt;bc_nlevels
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|tp
op_assign
id|cur-&gt;bc_tp
suffix:semicolon
id|mp
op_assign
id|cur-&gt;bc_mp
suffix:semicolon
r_for
c_loop
(paren
id|block
op_assign
id|xfs_bmbt_get_block
c_func
(paren
id|cur
comma
id|lev
comma
op_amp
id|bp
)paren
suffix:semicolon
id|lev
OG
id|level
suffix:semicolon
)paren
(brace
id|fsbno
op_assign
id|INT_GET
c_func
(paren
op_star
id|XFS_BMAP_PTR_IADDR
c_func
(paren
id|block
comma
id|cur-&gt;bc_ptrs
(braket
id|lev
)braket
comma
id|cur
)paren
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_read_bufl
c_func
(paren
id|mp
comma
id|tp
comma
id|fsbno
comma
l_int|0
comma
op_amp
id|bp
comma
id|XFS_BMAP_BTREE_REF
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|lev
op_decrement
suffix:semicolon
id|xfs_btree_setbuf
c_func
(paren
id|cur
comma
id|lev
comma
id|bp
)paren
suffix:semicolon
id|block
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
id|bp
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|block
comma
id|lev
comma
id|bp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|cur-&gt;bc_ptrs
(braket
id|lev
)braket
op_assign
id|INT_GET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
)brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Delete the record pointed to by cur.&n; */
r_int
multiline_comment|/* error */
DECL|function|xfs_bmbt_delete
id|xfs_bmbt_delete
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
r_int
id|async
comma
multiline_comment|/* deletion can be async */
r_int
op_star
id|stat
)paren
multiline_comment|/* success/failure */
(brace
r_int
id|error
suffix:semicolon
multiline_comment|/* error return value */
macro_line|#ifdef XFS_BMBT_TRACE
r_static
r_char
id|fname
(braket
)braket
op_assign
l_string|&quot;xfs_bmbt_delete&quot;
suffix:semicolon
macro_line|#endif
r_int
id|i
suffix:semicolon
r_int
id|level
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ENTRY
)paren
suffix:semicolon
r_for
c_loop
(paren
id|level
op_assign
l_int|0
comma
id|i
op_assign
l_int|2
suffix:semicolon
id|i
op_eq
l_int|2
suffix:semicolon
id|level
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_bmbt_delrec
c_func
(paren
id|cur
comma
id|level
comma
id|async
comma
op_amp
id|i
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
(brace
r_for
c_loop
(paren
id|level
op_assign
l_int|1
suffix:semicolon
id|level
OL
id|cur-&gt;bc_nlevels
suffix:semicolon
id|level
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cur-&gt;bc_ptrs
(braket
id|level
)braket
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_bmbt_decrement
c_func
(paren
id|cur
comma
id|level
comma
op_amp
id|i
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
)brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
id|i
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Convert a compressed bmap extent record to an uncompressed form.&n; * This code must be in sync with the routines xfs_bmbt_get_startoff,&n; * xfs_bmbt_get_startblock, xfs_bmbt_get_blockcount and xfs_bmbt_get_state.&n; */
id|STATIC
id|__inline__
r_void
DECL|function|__xfs_bmbt_get_all
id|__xfs_bmbt_get_all
c_func
(paren
id|__uint64_t
id|l0
comma
id|__uint64_t
id|l1
comma
id|xfs_bmbt_irec_t
op_star
id|s
)paren
(brace
r_int
id|ext_flag
suffix:semicolon
id|xfs_exntst_t
id|st
suffix:semicolon
id|ext_flag
op_assign
(paren
r_int
)paren
(paren
id|l0
op_rshift
(paren
l_int|64
op_minus
id|BMBT_EXNTFLAG_BITLEN
)paren
)paren
suffix:semicolon
id|s-&gt;br_startoff
op_assign
(paren
(paren
id|xfs_fileoff_t
)paren
id|l0
op_amp
id|XFS_MASK64LO
c_func
(paren
l_int|64
op_minus
id|BMBT_EXNTFLAG_BITLEN
)paren
)paren
op_rshift
l_int|9
suffix:semicolon
macro_line|#if XFS_BIG_FILESYSTEMS
id|s-&gt;br_startblock
op_assign
(paren
(paren
(paren
id|xfs_fsblock_t
)paren
id|l0
op_amp
id|XFS_MASK64LO
c_func
(paren
l_int|9
)paren
)paren
op_lshift
l_int|43
)paren
op_or
(paren
(paren
(paren
id|xfs_fsblock_t
)paren
id|l1
)paren
op_rshift
l_int|21
)paren
suffix:semicolon
macro_line|#else
macro_line|#ifdef DEBUG
(brace
id|xfs_dfsbno_t
id|b
suffix:semicolon
id|b
op_assign
(paren
(paren
(paren
id|xfs_dfsbno_t
)paren
id|l0
op_amp
id|XFS_MASK64LO
c_func
(paren
l_int|9
)paren
)paren
op_lshift
l_int|43
)paren
op_or
(paren
(paren
(paren
id|xfs_dfsbno_t
)paren
id|l1
)paren
op_rshift
l_int|21
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
(paren
id|b
op_rshift
l_int|32
)paren
op_eq
l_int|0
op_logical_or
id|ISNULLDSTARTBLOCK
c_func
(paren
id|b
)paren
)paren
suffix:semicolon
id|s-&gt;br_startblock
op_assign
(paren
id|xfs_fsblock_t
)paren
id|b
suffix:semicolon
)brace
macro_line|#else&t;/* !DEBUG */
id|s-&gt;br_startblock
op_assign
(paren
id|xfs_fsblock_t
)paren
(paren
(paren
(paren
id|xfs_dfsbno_t
)paren
id|l1
)paren
op_rshift
l_int|21
)paren
suffix:semicolon
macro_line|#endif&t;/* DEBUG */
macro_line|#endif&t;/* XFS_BIG_FILESYSTEMS */
id|s-&gt;br_blockcount
op_assign
(paren
id|xfs_filblks_t
)paren
(paren
id|l1
op_amp
id|XFS_MASK64LO
c_func
(paren
l_int|21
)paren
)paren
suffix:semicolon
multiline_comment|/* This is xfs_extent_state() in-line */
r_if
c_cond
(paren
id|ext_flag
)paren
(brace
id|ASSERT
c_func
(paren
id|s-&gt;br_blockcount
op_ne
l_int|0
)paren
suffix:semicolon
multiline_comment|/* saved for DMIG */
id|st
op_assign
id|XFS_EXT_UNWRITTEN
suffix:semicolon
)brace
r_else
id|st
op_assign
id|XFS_EXT_NORM
suffix:semicolon
id|s-&gt;br_state
op_assign
id|st
suffix:semicolon
)brace
r_void
DECL|function|xfs_bmbt_get_all
id|xfs_bmbt_get_all
c_func
(paren
id|xfs_bmbt_rec_t
op_star
id|r
comma
id|xfs_bmbt_irec_t
op_star
id|s
)paren
(brace
id|__xfs_bmbt_get_all
c_func
(paren
id|r-&gt;l0
comma
id|r-&gt;l1
comma
id|s
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Get the block pointer for the given level of the cursor.&n; * Fill in the buffer pointer, if applicable.&n; */
id|xfs_bmbt_block_t
op_star
DECL|function|xfs_bmbt_get_block
id|xfs_bmbt_get_block
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
r_int
id|level
comma
id|xfs_buf_t
op_star
op_star
id|bpp
)paren
(brace
id|xfs_ifork_t
op_star
id|ifp
suffix:semicolon
id|xfs_bmbt_block_t
op_star
id|rval
suffix:semicolon
r_if
c_cond
(paren
id|level
OL
id|cur-&gt;bc_nlevels
op_minus
l_int|1
)paren
(brace
op_star
id|bpp
op_assign
id|cur-&gt;bc_bufs
(braket
id|level
)braket
suffix:semicolon
id|rval
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
op_star
id|bpp
)paren
suffix:semicolon
)brace
r_else
(brace
op_star
id|bpp
op_assign
l_int|0
suffix:semicolon
id|ifp
op_assign
id|XFS_IFORK_PTR
c_func
(paren
id|cur-&gt;bc_private.b.ip
comma
id|cur-&gt;bc_private.b.whichfork
)paren
suffix:semicolon
id|rval
op_assign
id|ifp-&gt;if_broot
suffix:semicolon
)brace
r_return
id|rval
suffix:semicolon
)brace
multiline_comment|/*&n; * Extract the blockcount field from an in memory bmap extent record.&n; */
id|xfs_filblks_t
DECL|function|xfs_bmbt_get_blockcount
id|xfs_bmbt_get_blockcount
c_func
(paren
id|xfs_bmbt_rec_t
op_star
id|r
)paren
(brace
r_return
(paren
id|xfs_filblks_t
)paren
(paren
id|r-&gt;l1
op_amp
id|XFS_MASK64LO
c_func
(paren
l_int|21
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Extract the startblock field from an in memory bmap extent record.&n; */
id|xfs_fsblock_t
DECL|function|xfs_bmbt_get_startblock
id|xfs_bmbt_get_startblock
c_func
(paren
id|xfs_bmbt_rec_t
op_star
id|r
)paren
(brace
macro_line|#if XFS_BIG_FILESYSTEMS
r_return
(paren
(paren
(paren
id|xfs_fsblock_t
)paren
id|r-&gt;l0
op_amp
id|XFS_MASK64LO
c_func
(paren
l_int|9
)paren
)paren
op_lshift
l_int|43
)paren
op_or
(paren
(paren
(paren
id|xfs_fsblock_t
)paren
id|r-&gt;l1
)paren
op_rshift
l_int|21
)paren
suffix:semicolon
macro_line|#else
macro_line|#ifdef DEBUG
id|xfs_dfsbno_t
id|b
suffix:semicolon
id|b
op_assign
(paren
(paren
(paren
id|xfs_dfsbno_t
)paren
id|r-&gt;l0
op_amp
id|XFS_MASK64LO
c_func
(paren
l_int|9
)paren
)paren
op_lshift
l_int|43
)paren
op_or
(paren
(paren
(paren
id|xfs_dfsbno_t
)paren
id|r-&gt;l1
)paren
op_rshift
l_int|21
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
(paren
id|b
op_rshift
l_int|32
)paren
op_eq
l_int|0
op_logical_or
id|ISNULLDSTARTBLOCK
c_func
(paren
id|b
)paren
)paren
suffix:semicolon
r_return
(paren
id|xfs_fsblock_t
)paren
id|b
suffix:semicolon
macro_line|#else&t;/* !DEBUG */
r_return
(paren
id|xfs_fsblock_t
)paren
(paren
(paren
(paren
id|xfs_dfsbno_t
)paren
id|r-&gt;l1
)paren
op_rshift
l_int|21
)paren
suffix:semicolon
macro_line|#endif&t;/* DEBUG */
macro_line|#endif&t;/* XFS_BIG_FILESYSTEMS */
)brace
multiline_comment|/*&n; * Extract the startoff field from an in memory bmap extent record.&n; */
id|xfs_fileoff_t
DECL|function|xfs_bmbt_get_startoff
id|xfs_bmbt_get_startoff
c_func
(paren
id|xfs_bmbt_rec_t
op_star
id|r
)paren
(brace
r_return
(paren
(paren
id|xfs_fileoff_t
)paren
id|r-&gt;l0
op_amp
id|XFS_MASK64LO
c_func
(paren
l_int|64
op_minus
id|BMBT_EXNTFLAG_BITLEN
)paren
)paren
op_rshift
l_int|9
suffix:semicolon
)brace
id|xfs_exntst_t
DECL|function|xfs_bmbt_get_state
id|xfs_bmbt_get_state
c_func
(paren
id|xfs_bmbt_rec_t
op_star
id|r
)paren
(brace
r_int
id|ext_flag
suffix:semicolon
id|ext_flag
op_assign
(paren
r_int
)paren
(paren
(paren
id|r-&gt;l0
)paren
op_rshift
(paren
l_int|64
op_minus
id|BMBT_EXNTFLAG_BITLEN
)paren
)paren
suffix:semicolon
r_return
id|xfs_extent_state
c_func
(paren
id|xfs_bmbt_get_blockcount
c_func
(paren
id|r
)paren
comma
id|ext_flag
)paren
suffix:semicolon
)brace
macro_line|#if ARCH_CONVERT != ARCH_NOCONVERT
multiline_comment|/* Endian flipping versions of the bmbt extraction functions */
r_void
DECL|function|xfs_bmbt_disk_get_all
id|xfs_bmbt_disk_get_all
c_func
(paren
id|xfs_bmbt_rec_t
op_star
id|r
comma
id|xfs_bmbt_irec_t
op_star
id|s
)paren
(brace
id|__uint64_t
id|l0
comma
id|l1
suffix:semicolon
id|l0
op_assign
id|INT_GET
c_func
(paren
id|r-&gt;l0
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
id|l1
op_assign
id|INT_GET
c_func
(paren
id|r-&gt;l1
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
id|__xfs_bmbt_get_all
c_func
(paren
id|l0
comma
id|l1
comma
id|s
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Extract the blockcount field from an on disk bmap extent record.&n; */
id|xfs_filblks_t
DECL|function|xfs_bmbt_disk_get_blockcount
id|xfs_bmbt_disk_get_blockcount
c_func
(paren
id|xfs_bmbt_rec_t
op_star
id|r
)paren
(brace
r_return
(paren
id|xfs_filblks_t
)paren
(paren
id|INT_GET
c_func
(paren
id|r-&gt;l1
comma
id|ARCH_CONVERT
)paren
op_amp
id|XFS_MASK64LO
c_func
(paren
l_int|21
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Extract the startblock field from an on disk bmap extent record.&n; */
id|xfs_fsblock_t
DECL|function|xfs_bmbt_disk_get_startblock
id|xfs_bmbt_disk_get_startblock
c_func
(paren
id|xfs_bmbt_rec_t
op_star
id|r
)paren
(brace
macro_line|#if XFS_BIG_FILESYSTEMS
r_return
(paren
(paren
(paren
id|xfs_fsblock_t
)paren
id|INT_GET
c_func
(paren
id|r-&gt;l0
comma
id|ARCH_CONVERT
)paren
op_amp
id|XFS_MASK64LO
c_func
(paren
l_int|9
)paren
)paren
op_lshift
l_int|43
)paren
op_or
(paren
(paren
(paren
id|xfs_fsblock_t
)paren
id|INT_GET
c_func
(paren
id|r-&gt;l1
comma
id|ARCH_CONVERT
)paren
)paren
op_rshift
l_int|21
)paren
suffix:semicolon
macro_line|#else
macro_line|#ifdef DEBUG
id|xfs_dfsbno_t
id|b
suffix:semicolon
id|b
op_assign
(paren
(paren
(paren
id|xfs_dfsbno_t
)paren
id|INT_GET
c_func
(paren
id|r-&gt;l0
comma
id|ARCH_CONVERT
)paren
op_amp
id|XFS_MASK64LO
c_func
(paren
l_int|9
)paren
)paren
op_lshift
l_int|43
)paren
op_or
(paren
(paren
(paren
id|xfs_dfsbno_t
)paren
id|INT_GET
c_func
(paren
id|r-&gt;l1
comma
id|ARCH_CONVERT
)paren
)paren
op_rshift
l_int|21
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
(paren
id|b
op_rshift
l_int|32
)paren
op_eq
l_int|0
op_logical_or
id|ISNULLDSTARTBLOCK
c_func
(paren
id|b
)paren
)paren
suffix:semicolon
r_return
(paren
id|xfs_fsblock_t
)paren
id|b
suffix:semicolon
macro_line|#else&t;/* !DEBUG */
r_return
(paren
id|xfs_fsblock_t
)paren
(paren
(paren
(paren
id|xfs_dfsbno_t
)paren
id|INT_GET
c_func
(paren
id|r-&gt;l1
comma
id|ARCH_CONVERT
)paren
)paren
op_rshift
l_int|21
)paren
suffix:semicolon
macro_line|#endif&t;/* DEBUG */
macro_line|#endif&t;/* XFS_BIG_FILESYSTEMS */
)brace
multiline_comment|/*&n; * Extract the startoff field from a disk format bmap extent record.&n; */
id|xfs_fileoff_t
DECL|function|xfs_bmbt_disk_get_startoff
id|xfs_bmbt_disk_get_startoff
c_func
(paren
id|xfs_bmbt_rec_t
op_star
id|r
)paren
(brace
r_return
(paren
(paren
id|xfs_fileoff_t
)paren
id|INT_GET
c_func
(paren
id|r-&gt;l0
comma
id|ARCH_CONVERT
)paren
op_amp
id|XFS_MASK64LO
c_func
(paren
l_int|64
op_minus
id|BMBT_EXNTFLAG_BITLEN
)paren
)paren
op_rshift
l_int|9
suffix:semicolon
)brace
id|xfs_exntst_t
DECL|function|xfs_bmbt_disk_get_state
id|xfs_bmbt_disk_get_state
c_func
(paren
id|xfs_bmbt_rec_t
op_star
id|r
)paren
(brace
r_int
id|ext_flag
suffix:semicolon
id|ext_flag
op_assign
(paren
r_int
)paren
(paren
(paren
id|INT_GET
c_func
(paren
id|r-&gt;l0
comma
id|ARCH_CONVERT
)paren
)paren
op_rshift
(paren
l_int|64
op_minus
id|BMBT_EXNTFLAG_BITLEN
)paren
)paren
suffix:semicolon
r_return
id|xfs_extent_state
c_func
(paren
id|xfs_bmbt_disk_get_blockcount
c_func
(paren
id|r
)paren
comma
id|ext_flag
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * Increment cursor by one record at the level.&n; * For nonzero levels the leaf-ward information is untouched.&n; */
r_int
multiline_comment|/* error */
DECL|function|xfs_bmbt_increment
id|xfs_bmbt_increment
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
r_int
id|level
comma
r_int
op_star
id|stat
)paren
multiline_comment|/* success/failure */
(brace
id|xfs_bmbt_block_t
op_star
id|block
suffix:semicolon
id|xfs_buf_t
op_star
id|bp
suffix:semicolon
r_int
id|error
suffix:semicolon
multiline_comment|/* error return value */
macro_line|#ifdef XFS_BMBT_TRACE
r_static
r_char
id|fname
(braket
)braket
op_assign
l_string|&quot;xfs_bmbt_increment&quot;
suffix:semicolon
macro_line|#endif
id|xfs_fsblock_t
id|fsbno
suffix:semicolon
r_int
id|lev
suffix:semicolon
id|xfs_mount_t
op_star
id|mp
suffix:semicolon
id|xfs_trans_t
op_star
id|tp
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ENTRY
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_ARGI
c_func
(paren
id|cur
comma
id|level
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|level
OL
id|cur-&gt;bc_nlevels
)paren
suffix:semicolon
r_if
c_cond
(paren
id|level
OL
id|cur-&gt;bc_nlevels
op_minus
l_int|1
)paren
id|xfs_btree_readahead
c_func
(paren
id|cur
comma
id|level
comma
id|XFS_BTCUR_RIGHTRA
)paren
suffix:semicolon
id|block
op_assign
id|xfs_bmbt_get_block
c_func
(paren
id|cur
comma
id|level
comma
op_amp
id|bp
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|block
comma
id|level
comma
id|bp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
op_increment
id|cur-&gt;bc_ptrs
(braket
id|level
)braket
op_le
id|INT_GET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|INT_GET
c_func
(paren
id|block-&gt;bb_rightsib
comma
id|ARCH_CONVERT
)paren
op_eq
id|NULLDFSBNO
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|lev
op_assign
id|level
op_plus
l_int|1
suffix:semicolon
id|lev
OL
id|cur-&gt;bc_nlevels
suffix:semicolon
id|lev
op_increment
)paren
(brace
id|block
op_assign
id|xfs_bmbt_get_block
c_func
(paren
id|cur
comma
id|lev
comma
op_amp
id|bp
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|block
comma
id|lev
comma
id|bp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
op_increment
id|cur-&gt;bc_ptrs
(braket
id|lev
)braket
op_le
id|INT_GET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|lev
OL
id|cur-&gt;bc_nlevels
op_minus
l_int|1
)paren
id|xfs_btree_readahead
c_func
(paren
id|cur
comma
id|lev
comma
id|XFS_BTCUR_RIGHTRA
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lev
op_eq
id|cur-&gt;bc_nlevels
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|tp
op_assign
id|cur-&gt;bc_tp
suffix:semicolon
id|mp
op_assign
id|cur-&gt;bc_mp
suffix:semicolon
r_for
c_loop
(paren
id|block
op_assign
id|xfs_bmbt_get_block
c_func
(paren
id|cur
comma
id|lev
comma
op_amp
id|bp
)paren
suffix:semicolon
id|lev
OG
id|level
suffix:semicolon
)paren
(brace
id|fsbno
op_assign
id|INT_GET
c_func
(paren
op_star
id|XFS_BMAP_PTR_IADDR
c_func
(paren
id|block
comma
id|cur-&gt;bc_ptrs
(braket
id|lev
)braket
comma
id|cur
)paren
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_read_bufl
c_func
(paren
id|mp
comma
id|tp
comma
id|fsbno
comma
l_int|0
comma
op_amp
id|bp
comma
id|XFS_BMAP_BTREE_REF
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|lev
op_decrement
suffix:semicolon
id|xfs_btree_setbuf
c_func
(paren
id|cur
comma
id|lev
comma
id|bp
)paren
suffix:semicolon
id|block
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
id|bp
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|block
comma
id|lev
comma
id|bp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|cur-&gt;bc_ptrs
(braket
id|lev
)braket
op_assign
l_int|1
suffix:semicolon
)brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Insert the current record at the point referenced by cur.&n; */
r_int
multiline_comment|/* error */
DECL|function|xfs_bmbt_insert
id|xfs_bmbt_insert
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
r_int
op_star
id|stat
)paren
multiline_comment|/* success/failure */
(brace
r_int
id|error
suffix:semicolon
multiline_comment|/* error return value */
macro_line|#ifdef XFS_BMBT_TRACE
r_static
r_char
id|fname
(braket
)braket
op_assign
l_string|&quot;xfs_bmbt_insert&quot;
suffix:semicolon
macro_line|#endif
r_int
id|i
suffix:semicolon
r_int
id|level
suffix:semicolon
id|xfs_fsblock_t
id|nbno
suffix:semicolon
id|xfs_btree_cur_t
op_star
id|ncur
suffix:semicolon
id|xfs_bmbt_rec_t
id|nrec
suffix:semicolon
id|xfs_btree_cur_t
op_star
id|pcur
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ENTRY
)paren
suffix:semicolon
id|level
op_assign
l_int|0
suffix:semicolon
id|nbno
op_assign
id|NULLFSBLOCK
suffix:semicolon
id|xfs_bmbt_disk_set_all
c_func
(paren
op_amp
id|nrec
comma
op_amp
id|cur-&gt;bc_rec.b
)paren
suffix:semicolon
id|ncur
op_assign
(paren
id|xfs_btree_cur_t
op_star
)paren
l_int|0
suffix:semicolon
id|pcur
op_assign
id|cur
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_bmbt_insrec
c_func
(paren
id|pcur
comma
id|level
op_increment
comma
op_amp
id|nbno
comma
op_amp
id|nrec
comma
op_amp
id|ncur
comma
op_amp
id|i
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|pcur
op_ne
id|cur
)paren
id|xfs_btree_del_cursor
c_func
(paren
id|pcur
comma
id|XFS_BTREE_ERROR
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|XFS_WANT_CORRUPTED_GOTO
c_func
(paren
id|i
op_eq
l_int|1
comma
id|error0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcur
op_ne
id|cur
op_logical_and
(paren
id|ncur
op_logical_or
id|nbno
op_eq
id|NULLFSBLOCK
)paren
)paren
(brace
id|cur-&gt;bc_nlevels
op_assign
id|pcur-&gt;bc_nlevels
suffix:semicolon
id|cur-&gt;bc_private.b.allocated
op_add_assign
id|pcur-&gt;bc_private.b.allocated
suffix:semicolon
id|pcur-&gt;bc_private.b.allocated
op_assign
l_int|0
suffix:semicolon
id|ASSERT
c_func
(paren
(paren
id|cur-&gt;bc_private.b.firstblock
op_ne
id|NULLFSBLOCK
)paren
op_logical_or
(paren
id|cur-&gt;bc_private.b.ip-&gt;i_d.di_flags
op_amp
id|XFS_DIFLAG_REALTIME
)paren
)paren
suffix:semicolon
id|cur-&gt;bc_private.b.firstblock
op_assign
id|pcur-&gt;bc_private.b.firstblock
suffix:semicolon
id|ASSERT
c_func
(paren
id|cur-&gt;bc_private.b.flist
op_eq
id|pcur-&gt;bc_private.b.flist
)paren
suffix:semicolon
id|xfs_btree_del_cursor
c_func
(paren
id|pcur
comma
id|XFS_BTREE_NOERROR
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ncur
)paren
(brace
id|pcur
op_assign
id|ncur
suffix:semicolon
id|ncur
op_assign
(paren
id|xfs_btree_cur_t
op_star
)paren
l_int|0
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|nbno
op_ne
id|NULLFSBLOCK
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
id|i
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|error0
suffix:colon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/*&n; * Log fields from the btree block header.&n; */
r_void
DECL|function|xfs_bmbt_log_block
id|xfs_bmbt_log_block
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
id|xfs_buf_t
op_star
id|bp
comma
r_int
id|fields
)paren
(brace
r_int
id|first
suffix:semicolon
macro_line|#ifdef XFS_BMBT_TRACE
r_static
r_char
id|fname
(braket
)braket
op_assign
l_string|&quot;xfs_bmbt_log_block&quot;
suffix:semicolon
macro_line|#endif
r_int
id|last
suffix:semicolon
id|xfs_trans_t
op_star
id|tp
suffix:semicolon
r_static
r_const
r_int
id|offsets
(braket
)braket
op_assign
(brace
m_offsetof
(paren
id|xfs_bmbt_block_t
comma
id|bb_magic
)paren
comma
m_offsetof
(paren
id|xfs_bmbt_block_t
comma
id|bb_level
)paren
comma
m_offsetof
(paren
id|xfs_bmbt_block_t
comma
id|bb_numrecs
)paren
comma
m_offsetof
(paren
id|xfs_bmbt_block_t
comma
id|bb_leftsib
)paren
comma
m_offsetof
(paren
id|xfs_bmbt_block_t
comma
id|bb_rightsib
)paren
comma
r_sizeof
(paren
id|xfs_bmbt_block_t
)paren
)brace
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ENTRY
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_ARGBI
c_func
(paren
id|cur
comma
id|bp
comma
id|fields
)paren
suffix:semicolon
id|tp
op_assign
id|cur-&gt;bc_tp
suffix:semicolon
r_if
c_cond
(paren
id|bp
)paren
(brace
id|xfs_btree_offsets
c_func
(paren
id|fields
comma
id|offsets
comma
id|XFS_BB_NUM_BITS
comma
op_amp
id|first
comma
op_amp
id|last
)paren
suffix:semicolon
id|xfs_trans_log_buf
c_func
(paren
id|tp
comma
id|bp
comma
id|first
comma
id|last
)paren
suffix:semicolon
)brace
r_else
id|xfs_trans_log_inode
c_func
(paren
id|tp
comma
id|cur-&gt;bc_private.b.ip
comma
id|XFS_ILOG_FBROOT
c_func
(paren
id|cur-&gt;bc_private.b.whichfork
)paren
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Log record values from the btree block.&n; */
r_void
DECL|function|xfs_bmbt_log_recs
id|xfs_bmbt_log_recs
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
id|xfs_buf_t
op_star
id|bp
comma
r_int
id|rfirst
comma
r_int
id|rlast
)paren
(brace
id|xfs_bmbt_block_t
op_star
id|block
suffix:semicolon
r_int
id|first
suffix:semicolon
macro_line|#ifdef XFS_BMBT_TRACE
r_static
r_char
id|fname
(braket
)braket
op_assign
l_string|&quot;xfs_bmbt_log_recs&quot;
suffix:semicolon
macro_line|#endif
r_int
id|last
suffix:semicolon
id|xfs_bmbt_rec_t
op_star
id|rp
suffix:semicolon
id|xfs_trans_t
op_star
id|tp
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ENTRY
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_ARGBII
c_func
(paren
id|cur
comma
id|bp
comma
id|rfirst
comma
id|rlast
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|bp
)paren
suffix:semicolon
id|tp
op_assign
id|cur-&gt;bc_tp
suffix:semicolon
id|block
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
id|bp
)paren
suffix:semicolon
id|rp
op_assign
id|XFS_BMAP_REC_DADDR
c_func
(paren
id|block
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|first
op_assign
(paren
r_int
)paren
(paren
(paren
id|xfs_caddr_t
)paren
op_amp
id|rp
(braket
id|rfirst
op_minus
l_int|1
)braket
op_minus
(paren
id|xfs_caddr_t
)paren
id|block
)paren
suffix:semicolon
id|last
op_assign
(paren
r_int
)paren
(paren
(paren
(paren
id|xfs_caddr_t
)paren
op_amp
id|rp
(braket
id|rlast
)braket
op_minus
l_int|1
)paren
op_minus
(paren
id|xfs_caddr_t
)paren
id|block
)paren
suffix:semicolon
id|xfs_trans_log_buf
c_func
(paren
id|tp
comma
id|bp
comma
id|first
comma
id|last
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
)brace
r_int
multiline_comment|/* error */
DECL|function|xfs_bmbt_lookup_eq
id|xfs_bmbt_lookup_eq
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
id|xfs_fileoff_t
id|off
comma
id|xfs_fsblock_t
id|bno
comma
id|xfs_filblks_t
id|len
comma
r_int
op_star
id|stat
)paren
multiline_comment|/* success/failure */
(brace
id|cur-&gt;bc_rec.b.br_startoff
op_assign
id|off
suffix:semicolon
id|cur-&gt;bc_rec.b.br_startblock
op_assign
id|bno
suffix:semicolon
id|cur-&gt;bc_rec.b.br_blockcount
op_assign
id|len
suffix:semicolon
r_return
id|xfs_bmbt_lookup
c_func
(paren
id|cur
comma
id|XFS_LOOKUP_EQ
comma
id|stat
)paren
suffix:semicolon
)brace
r_int
multiline_comment|/* error */
DECL|function|xfs_bmbt_lookup_ge
id|xfs_bmbt_lookup_ge
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
id|xfs_fileoff_t
id|off
comma
id|xfs_fsblock_t
id|bno
comma
id|xfs_filblks_t
id|len
comma
r_int
op_star
id|stat
)paren
multiline_comment|/* success/failure */
(brace
id|cur-&gt;bc_rec.b.br_startoff
op_assign
id|off
suffix:semicolon
id|cur-&gt;bc_rec.b.br_startblock
op_assign
id|bno
suffix:semicolon
id|cur-&gt;bc_rec.b.br_blockcount
op_assign
id|len
suffix:semicolon
r_return
id|xfs_bmbt_lookup
c_func
(paren
id|cur
comma
id|XFS_LOOKUP_GE
comma
id|stat
)paren
suffix:semicolon
)brace
r_int
multiline_comment|/* error */
DECL|function|xfs_bmbt_lookup_le
id|xfs_bmbt_lookup_le
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
id|xfs_fileoff_t
id|off
comma
id|xfs_fsblock_t
id|bno
comma
id|xfs_filblks_t
id|len
comma
r_int
op_star
id|stat
)paren
multiline_comment|/* success/failure */
(brace
id|cur-&gt;bc_rec.b.br_startoff
op_assign
id|off
suffix:semicolon
id|cur-&gt;bc_rec.b.br_startblock
op_assign
id|bno
suffix:semicolon
id|cur-&gt;bc_rec.b.br_blockcount
op_assign
id|len
suffix:semicolon
r_return
id|xfs_bmbt_lookup
c_func
(paren
id|cur
comma
id|XFS_LOOKUP_LE
comma
id|stat
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Give the bmap btree a new root block.  Copy the old broot contents&n; * down into a real block and make the broot point to it.&n; */
r_int
multiline_comment|/* error */
DECL|function|xfs_bmbt_newroot
id|xfs_bmbt_newroot
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
multiline_comment|/* btree cursor */
r_int
op_star
id|logflags
comma
multiline_comment|/* logging flags for inode */
r_int
op_star
id|stat
)paren
multiline_comment|/* return status - 0 fail */
(brace
id|xfs_alloc_arg_t
id|args
suffix:semicolon
multiline_comment|/* allocation arguments */
id|xfs_bmbt_block_t
op_star
id|block
suffix:semicolon
multiline_comment|/* bmap btree block */
id|xfs_buf_t
op_star
id|bp
suffix:semicolon
multiline_comment|/* buffer for block */
id|xfs_bmbt_block_t
op_star
id|cblock
suffix:semicolon
multiline_comment|/* child btree block */
id|xfs_bmbt_key_t
op_star
id|ckp
suffix:semicolon
multiline_comment|/* child key pointer */
id|xfs_bmbt_ptr_t
op_star
id|cpp
suffix:semicolon
multiline_comment|/* child ptr pointer */
r_int
id|error
suffix:semicolon
multiline_comment|/* error return code */
macro_line|#ifdef XFS_BMBT_TRACE
r_static
r_char
id|fname
(braket
)braket
op_assign
l_string|&quot;xfs_bmbt_newroot&quot;
suffix:semicolon
macro_line|#endif
macro_line|#ifdef DEBUG
r_int
id|i
suffix:semicolon
multiline_comment|/* loop counter */
macro_line|#endif
id|xfs_bmbt_key_t
op_star
id|kp
suffix:semicolon
multiline_comment|/* pointer to bmap btree key */
r_int
id|level
suffix:semicolon
multiline_comment|/* btree level */
id|xfs_bmbt_ptr_t
op_star
id|pp
suffix:semicolon
multiline_comment|/* pointer to bmap block addr */
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ENTRY
)paren
suffix:semicolon
id|level
op_assign
id|cur-&gt;bc_nlevels
op_minus
l_int|1
suffix:semicolon
id|block
op_assign
id|xfs_bmbt_get_block
c_func
(paren
id|cur
comma
id|level
comma
op_amp
id|bp
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Copy the root into a real block.&n;&t; */
id|args.mp
op_assign
id|cur-&gt;bc_mp
suffix:semicolon
id|pp
op_assign
id|XFS_BMAP_PTR_IADDR
c_func
(paren
id|block
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|args.tp
op_assign
id|cur-&gt;bc_tp
suffix:semicolon
id|args.fsbno
op_assign
id|cur-&gt;bc_private.b.firstblock
suffix:semicolon
id|args.mod
op_assign
id|args.minleft
op_assign
id|args.alignment
op_assign
id|args.total
op_assign
id|args.isfl
op_assign
id|args.userdata
op_assign
id|args.minalignslop
op_assign
l_int|0
suffix:semicolon
id|args.minlen
op_assign
id|args.maxlen
op_assign
id|args.prod
op_assign
l_int|1
suffix:semicolon
id|args.wasdel
op_assign
id|cur-&gt;bc_private.b.flags
op_amp
id|XFS_BTCUR_BPRV_WASDEL
suffix:semicolon
r_if
c_cond
(paren
id|args.fsbno
op_eq
id|NULLFSBLOCK
)paren
(brace
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lptr
c_func
(paren
id|cur
comma
id|INT_GET
c_func
(paren
op_star
id|pp
comma
id|ARCH_CONVERT
)paren
comma
id|level
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#endif
id|args.fsbno
op_assign
id|INT_GET
c_func
(paren
op_star
id|pp
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
id|args.type
op_assign
id|XFS_ALLOCTYPE_START_BNO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|args.wasdel
)paren
id|args.type
op_assign
id|XFS_ALLOCTYPE_FIRST_AG
suffix:semicolon
r_else
id|args.type
op_assign
id|XFS_ALLOCTYPE_NEAR_BNO
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_alloc_vextent
c_func
(paren
op_amp
id|args
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|args.fsbno
op_eq
id|NULLFSBLOCK
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ASSERT
c_func
(paren
id|args.len
op_eq
l_int|1
)paren
suffix:semicolon
id|cur-&gt;bc_private.b.firstblock
op_assign
id|args.fsbno
suffix:semicolon
id|cur-&gt;bc_private.b.allocated
op_increment
suffix:semicolon
id|cur-&gt;bc_private.b.ip-&gt;i_d.di_nblocks
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|XFS_IS_QUOTA_ON
c_func
(paren
id|args.mp
)paren
op_logical_and
id|cur-&gt;bc_private.b.ip-&gt;i_ino
op_ne
id|args.mp-&gt;m_sb.sb_uquotino
op_logical_and
id|cur-&gt;bc_private.b.ip-&gt;i_ino
op_ne
id|args.mp-&gt;m_sb.sb_gquotino
)paren
id|xfs_trans_mod_dquot_byino
c_func
(paren
id|args.tp
comma
id|cur-&gt;bc_private.b.ip
comma
id|XFS_TRANS_DQ_BCOUNT
comma
l_int|1L
)paren
suffix:semicolon
id|bp
op_assign
id|xfs_btree_get_bufl
c_func
(paren
id|args.mp
comma
id|cur-&gt;bc_tp
comma
id|args.fsbno
comma
l_int|0
)paren
suffix:semicolon
id|cblock
op_assign
id|XFS_BUF_TO_BMBT_BLOCK
c_func
(paren
id|bp
)paren
suffix:semicolon
op_star
id|cblock
op_assign
op_star
id|block
suffix:semicolon
id|INT_MOD
c_func
(paren
id|block-&gt;bb_level
comma
id|ARCH_CONVERT
comma
op_plus
l_int|1
)paren
suffix:semicolon
id|INT_SET
c_func
(paren
id|block-&gt;bb_numrecs
comma
id|ARCH_CONVERT
comma
l_int|1
)paren
suffix:semicolon
id|cur-&gt;bc_nlevels
op_increment
suffix:semicolon
id|cur-&gt;bc_ptrs
(braket
id|level
op_plus
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
id|kp
op_assign
id|XFS_BMAP_KEY_IADDR
c_func
(paren
id|block
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|ckp
op_assign
id|XFS_BMAP_KEY_IADDR
c_func
(paren
id|cblock
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|ckp
comma
id|kp
comma
id|INT_GET
c_func
(paren
id|cblock-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_star
r_sizeof
(paren
op_star
id|kp
)paren
)paren
suffix:semicolon
id|cpp
op_assign
id|XFS_BMAP_PTR_IADDR
c_func
(paren
id|cblock
comma
l_int|1
comma
id|cur
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|INT_GET
c_func
(paren
id|cblock-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lptr
c_func
(paren
id|cur
comma
id|INT_GET
c_func
(paren
id|pp
(braket
id|i
)braket
comma
id|ARCH_CONVERT
)paren
comma
id|level
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
)brace
macro_line|#endif
id|memcpy
c_func
(paren
id|cpp
comma
id|pp
comma
id|INT_GET
c_func
(paren
id|cblock-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
op_star
r_sizeof
(paren
op_star
id|pp
)paren
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lptr
c_func
(paren
id|cur
comma
(paren
id|xfs_bmbt_ptr_t
)paren
id|args.fsbno
comma
id|level
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#endif
id|INT_SET
c_func
(paren
op_star
id|pp
comma
id|ARCH_CONVERT
comma
id|args.fsbno
)paren
suffix:semicolon
id|xfs_iroot_realloc
c_func
(paren
id|cur-&gt;bc_private.b.ip
comma
l_int|1
op_minus
id|INT_GET
c_func
(paren
id|cblock-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
comma
id|cur-&gt;bc_private.b.whichfork
)paren
suffix:semicolon
id|xfs_btree_setbuf
c_func
(paren
id|cur
comma
id|level
comma
id|bp
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Do all this logging at the end so that&n;&t; * the root is at the right level.&n;&t; */
id|xfs_bmbt_log_block
c_func
(paren
id|cur
comma
id|bp
comma
id|XFS_BB_ALL_BITS
)paren
suffix:semicolon
id|xfs_bmbt_log_keys
c_func
(paren
id|cur
comma
id|bp
comma
l_int|1
comma
id|INT_GET
c_func
(paren
id|cblock-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
)paren
suffix:semicolon
id|xfs_bmbt_log_ptrs
c_func
(paren
id|cur
comma
id|bp
comma
l_int|1
comma
id|INT_GET
c_func
(paren
id|cblock-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
op_star
id|logflags
op_or_assign
id|XFS_ILOG_CORE
op_or
id|XFS_ILOG_FBROOT
c_func
(paren
id|cur-&gt;bc_private.b.whichfork
)paren
suffix:semicolon
op_star
id|stat
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Set all the fields in a bmap extent record from the uncompressed form.&n; */
r_void
DECL|function|xfs_bmbt_set_all
id|xfs_bmbt_set_all
c_func
(paren
id|xfs_bmbt_rec_t
op_star
id|r
comma
id|xfs_bmbt_irec_t
op_star
id|s
)paren
(brace
r_int
id|extent_flag
suffix:semicolon
id|ASSERT
c_func
(paren
(paren
id|s-&gt;br_state
op_eq
id|XFS_EXT_NORM
)paren
op_logical_or
(paren
id|s-&gt;br_state
op_eq
id|XFS_EXT_UNWRITTEN
)paren
)paren
suffix:semicolon
id|extent_flag
op_assign
(paren
id|s-&gt;br_state
op_eq
id|XFS_EXT_NORM
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|ASSERT
c_func
(paren
(paren
id|s-&gt;br_startoff
op_amp
id|XFS_MASK64HI
c_func
(paren
l_int|9
)paren
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
(paren
id|s-&gt;br_blockcount
op_amp
id|XFS_MASK64HI
c_func
(paren
l_int|43
)paren
)paren
op_eq
l_int|0
)paren
suffix:semicolon
macro_line|#if XFS_BIG_FILESYSTEMS
id|ASSERT
c_func
(paren
(paren
id|s-&gt;br_startblock
op_amp
id|XFS_MASK64HI
c_func
(paren
l_int|12
)paren
)paren
op_eq
l_int|0
)paren
suffix:semicolon
macro_line|#endif&t;/* XFS_BIG_FILESYSTEMS */
macro_line|#if XFS_BIG_FILESYSTEMS
id|r-&gt;l0
op_assign
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|extent_flag
op_lshift
l_int|63
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|s-&gt;br_startoff
op_lshift
l_int|9
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|s-&gt;br_startblock
op_rshift
l_int|43
)paren
suffix:semicolon
id|r-&gt;l1
op_assign
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|s-&gt;br_startblock
op_lshift
l_int|21
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|s-&gt;br_blockcount
op_amp
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|21
)paren
)paren
suffix:semicolon
macro_line|#else&t;/* !XFS_BIG_FILESYSTEMS */
r_if
c_cond
(paren
id|ISNULLSTARTBLOCK
c_func
(paren
id|s-&gt;br_startblock
)paren
)paren
(brace
id|r-&gt;l0
op_assign
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|extent_flag
op_lshift
l_int|63
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|s-&gt;br_startoff
op_lshift
l_int|9
)paren
op_or
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|9
)paren
suffix:semicolon
id|r-&gt;l1
op_assign
id|XFS_MASK64HI
c_func
(paren
l_int|11
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|s-&gt;br_startblock
op_lshift
l_int|21
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|s-&gt;br_blockcount
op_amp
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|21
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|r-&gt;l0
op_assign
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|extent_flag
op_lshift
l_int|63
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|s-&gt;br_startoff
op_lshift
l_int|9
)paren
suffix:semicolon
id|r-&gt;l1
op_assign
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|s-&gt;br_startblock
op_lshift
l_int|21
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|s-&gt;br_blockcount
op_amp
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|21
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif&t;/* XFS_BIG_FILESYSTEMS */
)brace
multiline_comment|/*&n; * Set all the fields in a bmap extent record from the arguments.&n; */
r_void
DECL|function|xfs_bmbt_set_allf
id|xfs_bmbt_set_allf
c_func
(paren
id|xfs_bmbt_rec_t
op_star
id|r
comma
id|xfs_fileoff_t
id|o
comma
id|xfs_fsblock_t
id|b
comma
id|xfs_filblks_t
id|c
comma
id|xfs_exntst_t
id|v
)paren
(brace
r_int
id|extent_flag
suffix:semicolon
id|ASSERT
c_func
(paren
(paren
id|v
op_eq
id|XFS_EXT_NORM
)paren
op_logical_or
(paren
id|v
op_eq
id|XFS_EXT_UNWRITTEN
)paren
)paren
suffix:semicolon
id|extent_flag
op_assign
(paren
id|v
op_eq
id|XFS_EXT_NORM
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|ASSERT
c_func
(paren
(paren
id|o
op_amp
id|XFS_MASK64HI
c_func
(paren
l_int|64
op_minus
id|BMBT_STARTOFF_BITLEN
)paren
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
(paren
id|c
op_amp
id|XFS_MASK64HI
c_func
(paren
l_int|64
op_minus
id|BMBT_BLOCKCOUNT_BITLEN
)paren
)paren
op_eq
l_int|0
)paren
suffix:semicolon
macro_line|#if XFS_BIG_FILESYSTEMS
id|ASSERT
c_func
(paren
(paren
id|b
op_amp
id|XFS_MASK64HI
c_func
(paren
l_int|64
op_minus
id|BMBT_STARTBLOCK_BITLEN
)paren
)paren
op_eq
l_int|0
)paren
suffix:semicolon
macro_line|#endif&t;/* XFS_BIG_FILESYSTEMS */
macro_line|#if XFS_BIG_FILESYSTEMS
id|r-&gt;l0
op_assign
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|extent_flag
op_lshift
l_int|63
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|o
op_lshift
l_int|9
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|b
op_rshift
l_int|43
)paren
suffix:semicolon
id|r-&gt;l1
op_assign
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|b
op_lshift
l_int|21
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|c
op_amp
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|21
)paren
)paren
suffix:semicolon
macro_line|#else&t;/* !XFS_BIG_FILESYSTEMS */
r_if
c_cond
(paren
id|ISNULLSTARTBLOCK
c_func
(paren
id|b
)paren
)paren
(brace
id|r-&gt;l0
op_assign
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|extent_flag
op_lshift
l_int|63
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|o
op_lshift
l_int|9
)paren
op_or
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|9
)paren
suffix:semicolon
id|r-&gt;l1
op_assign
id|XFS_MASK64HI
c_func
(paren
l_int|11
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|b
op_lshift
l_int|21
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|c
op_amp
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|21
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|r-&gt;l0
op_assign
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|extent_flag
op_lshift
l_int|63
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|o
op_lshift
l_int|9
)paren
suffix:semicolon
id|r-&gt;l1
op_assign
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|b
op_lshift
l_int|21
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|c
op_amp
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|21
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif&t;/* XFS_BIG_FILESYSTEMS */
)brace
macro_line|#if ARCH_CONVERT != ARCH_NOCONVERT
multiline_comment|/*&n; * Set all the fields in a bmap extent record from the uncompressed form.&n; */
r_void
DECL|function|xfs_bmbt_disk_set_all
id|xfs_bmbt_disk_set_all
c_func
(paren
id|xfs_bmbt_rec_t
op_star
id|r
comma
id|xfs_bmbt_irec_t
op_star
id|s
)paren
(brace
r_int
id|extent_flag
suffix:semicolon
id|ASSERT
c_func
(paren
(paren
id|s-&gt;br_state
op_eq
id|XFS_EXT_NORM
)paren
op_logical_or
(paren
id|s-&gt;br_state
op_eq
id|XFS_EXT_UNWRITTEN
)paren
)paren
suffix:semicolon
id|extent_flag
op_assign
(paren
id|s-&gt;br_state
op_eq
id|XFS_EXT_NORM
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|ASSERT
c_func
(paren
(paren
id|s-&gt;br_startoff
op_amp
id|XFS_MASK64HI
c_func
(paren
l_int|9
)paren
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
(paren
id|s-&gt;br_blockcount
op_amp
id|XFS_MASK64HI
c_func
(paren
l_int|43
)paren
)paren
op_eq
l_int|0
)paren
suffix:semicolon
macro_line|#if XFS_BIG_FILESYSTEMS
id|ASSERT
c_func
(paren
(paren
id|s-&gt;br_startblock
op_amp
id|XFS_MASK64HI
c_func
(paren
l_int|12
)paren
)paren
op_eq
l_int|0
)paren
suffix:semicolon
macro_line|#endif&t;/* XFS_BIG_FILESYSTEMS */
macro_line|#if XFS_BIG_FILESYSTEMS
id|INT_SET
c_func
(paren
id|r-&gt;l0
comma
id|ARCH_CONVERT
comma
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|extent_flag
op_lshift
l_int|63
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|s-&gt;br_startoff
op_lshift
l_int|9
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|s-&gt;br_startblock
op_rshift
l_int|43
)paren
)paren
suffix:semicolon
id|INT_SET
c_func
(paren
id|r-&gt;l1
comma
id|ARCH_CONVERT
comma
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|s-&gt;br_startblock
op_lshift
l_int|21
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|s-&gt;br_blockcount
op_amp
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|21
)paren
)paren
)paren
suffix:semicolon
macro_line|#else&t;/* !XFS_BIG_FILESYSTEMS */
r_if
c_cond
(paren
id|ISNULLSTARTBLOCK
c_func
(paren
id|s-&gt;br_startblock
)paren
)paren
(brace
id|INT_SET
c_func
(paren
id|r-&gt;l0
comma
id|ARCH_CONVERT
comma
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|extent_flag
op_lshift
l_int|63
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|s-&gt;br_startoff
op_lshift
l_int|9
)paren
op_or
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|9
)paren
)paren
suffix:semicolon
id|INT_SET
c_func
(paren
id|r-&gt;l1
comma
id|ARCH_CONVERT
comma
id|XFS_MASK64HI
c_func
(paren
l_int|11
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|s-&gt;br_startblock
op_lshift
l_int|21
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|s-&gt;br_blockcount
op_amp
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|21
)paren
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|INT_SET
c_func
(paren
id|r-&gt;l0
comma
id|ARCH_CONVERT
comma
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|extent_flag
op_lshift
l_int|63
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|s-&gt;br_startoff
op_lshift
l_int|9
)paren
)paren
suffix:semicolon
id|INT_SET
c_func
(paren
id|r-&gt;l1
comma
id|ARCH_CONVERT
comma
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|s-&gt;br_startblock
op_lshift
l_int|21
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|s-&gt;br_blockcount
op_amp
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|21
)paren
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif&t;/* XFS_BIG_FILESYSTEMS */
)brace
multiline_comment|/*&n; * Set all the fields in a disk format bmap extent record from the arguments.&n; */
r_void
DECL|function|xfs_bmbt_disk_set_allf
id|xfs_bmbt_disk_set_allf
c_func
(paren
id|xfs_bmbt_rec_t
op_star
id|r
comma
id|xfs_fileoff_t
id|o
comma
id|xfs_fsblock_t
id|b
comma
id|xfs_filblks_t
id|c
comma
id|xfs_exntst_t
id|v
)paren
(brace
r_int
id|extent_flag
suffix:semicolon
id|ASSERT
c_func
(paren
(paren
id|v
op_eq
id|XFS_EXT_NORM
)paren
op_logical_or
(paren
id|v
op_eq
id|XFS_EXT_UNWRITTEN
)paren
)paren
suffix:semicolon
id|extent_flag
op_assign
(paren
id|v
op_eq
id|XFS_EXT_NORM
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|ASSERT
c_func
(paren
(paren
id|o
op_amp
id|XFS_MASK64HI
c_func
(paren
l_int|64
op_minus
id|BMBT_STARTOFF_BITLEN
)paren
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
(paren
id|c
op_amp
id|XFS_MASK64HI
c_func
(paren
l_int|64
op_minus
id|BMBT_BLOCKCOUNT_BITLEN
)paren
)paren
op_eq
l_int|0
)paren
suffix:semicolon
macro_line|#if XFS_BIG_FILESYSTEMS
id|ASSERT
c_func
(paren
(paren
id|b
op_amp
id|XFS_MASK64HI
c_func
(paren
l_int|64
op_minus
id|BMBT_STARTBLOCK_BITLEN
)paren
)paren
op_eq
l_int|0
)paren
suffix:semicolon
macro_line|#endif&t;/* XFS_BIG_FILESYSTEMS */
macro_line|#if XFS_BIG_FILESYSTEMS
id|INT_SET
c_func
(paren
id|r-&gt;l0
comma
id|ARCH_CONVERT
comma
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|extent_flag
op_lshift
l_int|63
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|o
op_lshift
l_int|9
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|b
op_rshift
l_int|43
)paren
)paren
suffix:semicolon
id|INT_SET
c_func
(paren
id|r-&gt;l1
comma
id|ARCH_CONVERT
comma
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|b
op_lshift
l_int|21
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|c
op_amp
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|21
)paren
)paren
)paren
suffix:semicolon
macro_line|#else&t;/* !XFS_BIG_FILESYSTEMS */
r_if
c_cond
(paren
id|ISNULLSTARTBLOCK
c_func
(paren
id|b
)paren
)paren
(brace
id|INT_SET
c_func
(paren
id|r-&gt;l0
comma
id|ARCH_CONVERT
comma
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|extent_flag
op_lshift
l_int|63
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|o
op_lshift
l_int|9
)paren
op_or
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|9
)paren
)paren
suffix:semicolon
id|INT_SET
c_func
(paren
id|r-&gt;l1
comma
id|ARCH_CONVERT
comma
id|XFS_MASK64HI
c_func
(paren
l_int|11
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|b
op_lshift
l_int|21
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|c
op_amp
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|21
)paren
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|INT_SET
c_func
(paren
id|r-&gt;l0
comma
id|ARCH_CONVERT
comma
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|extent_flag
op_lshift
l_int|63
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|o
op_lshift
l_int|9
)paren
)paren
suffix:semicolon
id|INT_SET
c_func
(paren
id|r-&gt;l1
comma
id|ARCH_CONVERT
comma
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|b
op_lshift
l_int|21
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|c
op_amp
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|21
)paren
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif&t;/* XFS_BIG_FILESYSTEMS */
)brace
macro_line|#endif
multiline_comment|/*&n; * Set the blockcount field in a bmap extent record.&n; */
r_void
DECL|function|xfs_bmbt_set_blockcount
id|xfs_bmbt_set_blockcount
c_func
(paren
id|xfs_bmbt_rec_t
op_star
id|r
comma
id|xfs_filblks_t
id|v
)paren
(brace
id|ASSERT
c_func
(paren
(paren
id|v
op_amp
id|XFS_MASK64HI
c_func
(paren
l_int|43
)paren
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|r-&gt;l1
op_assign
(paren
id|r-&gt;l1
op_amp
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64HI
c_func
(paren
l_int|43
)paren
)paren
op_or
(paren
id|xfs_bmbt_rec_base_t
)paren
(paren
id|v
op_amp
id|XFS_MASK64LO
c_func
(paren
l_int|21
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Set the startblock field in a bmap extent record.&n; */
r_void
DECL|function|xfs_bmbt_set_startblock
id|xfs_bmbt_set_startblock
c_func
(paren
id|xfs_bmbt_rec_t
op_star
id|r
comma
id|xfs_fsblock_t
id|v
)paren
(brace
macro_line|#if XFS_BIG_FILESYSTEMS
id|ASSERT
c_func
(paren
(paren
id|v
op_amp
id|XFS_MASK64HI
c_func
(paren
l_int|12
)paren
)paren
op_eq
l_int|0
)paren
suffix:semicolon
macro_line|#endif&t;/* XFS_BIG_FILESYSTEMS */
macro_line|#if XFS_BIG_FILESYSTEMS
id|r-&gt;l0
op_assign
(paren
id|r-&gt;l0
op_amp
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64HI
c_func
(paren
l_int|55
)paren
)paren
op_or
(paren
id|xfs_bmbt_rec_base_t
)paren
(paren
id|v
op_rshift
l_int|43
)paren
suffix:semicolon
id|r-&gt;l1
op_assign
(paren
id|r-&gt;l1
op_amp
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|21
)paren
)paren
op_or
(paren
id|xfs_bmbt_rec_base_t
)paren
(paren
id|v
op_lshift
l_int|21
)paren
suffix:semicolon
macro_line|#else&t;/* !XFS_BIG_FILESYSTEMS */
r_if
c_cond
(paren
id|ISNULLSTARTBLOCK
c_func
(paren
id|v
)paren
)paren
(brace
id|r-&gt;l0
op_or_assign
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|9
)paren
suffix:semicolon
id|r-&gt;l1
op_assign
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64HI
c_func
(paren
l_int|11
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|v
op_lshift
l_int|21
)paren
op_or
(paren
id|r-&gt;l1
op_amp
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|21
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|r-&gt;l0
op_and_assign
op_complement
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|9
)paren
suffix:semicolon
id|r-&gt;l1
op_assign
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|v
op_lshift
l_int|21
)paren
op_or
(paren
id|r-&gt;l1
op_amp
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|21
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif&t;/* XFS_BIG_FILESYSTEMS */
)brace
multiline_comment|/*&n; * Set the startoff field in a bmap extent record.&n; */
r_void
DECL|function|xfs_bmbt_set_startoff
id|xfs_bmbt_set_startoff
c_func
(paren
id|xfs_bmbt_rec_t
op_star
id|r
comma
id|xfs_fileoff_t
id|v
)paren
(brace
id|ASSERT
c_func
(paren
(paren
id|v
op_amp
id|XFS_MASK64HI
c_func
(paren
l_int|9
)paren
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|r-&gt;l0
op_assign
(paren
id|r-&gt;l0
op_amp
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64HI
c_func
(paren
l_int|1
)paren
)paren
op_or
(paren
(paren
id|xfs_bmbt_rec_base_t
)paren
id|v
op_lshift
l_int|9
)paren
op_or
(paren
id|r-&gt;l0
op_amp
(paren
id|xfs_bmbt_rec_base_t
)paren
id|XFS_MASK64LO
c_func
(paren
l_int|9
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Set the extent state field in a bmap extent record.&n; */
r_void
DECL|function|xfs_bmbt_set_state
id|xfs_bmbt_set_state
c_func
(paren
id|xfs_bmbt_rec_t
op_star
id|r
comma
id|xfs_exntst_t
id|v
)paren
(brace
id|ASSERT
c_func
(paren
id|v
op_eq
id|XFS_EXT_NORM
op_logical_or
id|v
op_eq
id|XFS_EXT_UNWRITTEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|v
op_eq
id|XFS_EXT_NORM
)paren
id|r-&gt;l0
op_and_assign
id|XFS_MASK64LO
c_func
(paren
l_int|64
op_minus
id|BMBT_EXNTFLAG_BITLEN
)paren
suffix:semicolon
r_else
id|r-&gt;l0
op_or_assign
id|XFS_MASK64HI
c_func
(paren
id|BMBT_EXNTFLAG_BITLEN
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Convert in-memory form of btree root to on-disk form.&n; */
r_void
DECL|function|xfs_bmbt_to_bmdr
id|xfs_bmbt_to_bmdr
c_func
(paren
id|xfs_bmbt_block_t
op_star
id|rblock
comma
r_int
id|rblocklen
comma
id|xfs_bmdr_block_t
op_star
id|dblock
comma
r_int
id|dblocklen
)paren
(brace
r_int
id|dmxr
suffix:semicolon
id|xfs_bmbt_key_t
op_star
id|fkp
suffix:semicolon
id|xfs_bmbt_ptr_t
op_star
id|fpp
suffix:semicolon
id|xfs_bmbt_key_t
op_star
id|tkp
suffix:semicolon
id|xfs_bmbt_ptr_t
op_star
id|tpp
suffix:semicolon
id|ASSERT
c_func
(paren
id|INT_GET
c_func
(paren
id|rblock-&gt;bb_magic
comma
id|ARCH_CONVERT
)paren
op_eq
id|XFS_BMAP_MAGIC
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|INT_GET
c_func
(paren
id|rblock-&gt;bb_leftsib
comma
id|ARCH_CONVERT
)paren
op_eq
id|NULLDFSBNO
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|INT_GET
c_func
(paren
id|rblock-&gt;bb_rightsib
comma
id|ARCH_CONVERT
)paren
op_eq
id|NULLDFSBNO
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|INT_GET
c_func
(paren
id|rblock-&gt;bb_level
comma
id|ARCH_CONVERT
)paren
OG
l_int|0
)paren
suffix:semicolon
id|dblock-&gt;bb_level
op_assign
id|rblock-&gt;bb_level
suffix:semicolon
multiline_comment|/* both in on-disk format */
id|dblock-&gt;bb_numrecs
op_assign
id|rblock-&gt;bb_numrecs
suffix:semicolon
multiline_comment|/* both in on-disk format */
id|dmxr
op_assign
(paren
r_int
)paren
id|XFS_BTREE_BLOCK_MAXRECS
c_func
(paren
id|dblocklen
comma
id|xfs_bmdr
comma
l_int|0
)paren
suffix:semicolon
id|fkp
op_assign
id|XFS_BMAP_BROOT_KEY_ADDR
c_func
(paren
id|rblock
comma
l_int|1
comma
id|rblocklen
)paren
suffix:semicolon
id|tkp
op_assign
id|XFS_BTREE_KEY_ADDR
c_func
(paren
id|dblocklen
comma
id|xfs_bmdr
comma
id|dblock
comma
l_int|1
comma
id|dmxr
)paren
suffix:semicolon
id|fpp
op_assign
id|XFS_BMAP_BROOT_PTR_ADDR
c_func
(paren
id|rblock
comma
l_int|1
comma
id|rblocklen
)paren
suffix:semicolon
id|tpp
op_assign
id|XFS_BTREE_PTR_ADDR
c_func
(paren
id|dblocklen
comma
id|xfs_bmdr
comma
id|dblock
comma
l_int|1
comma
id|dmxr
)paren
suffix:semicolon
id|dmxr
op_assign
id|INT_GET
c_func
(paren
id|dblock-&gt;bb_numrecs
comma
id|ARCH_CONVERT
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|tkp
comma
id|fkp
comma
r_sizeof
(paren
op_star
id|fkp
)paren
op_star
id|dmxr
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|tpp
comma
id|fpp
comma
r_sizeof
(paren
op_star
id|fpp
)paren
op_star
id|dmxr
)paren
suffix:semicolon
multiline_comment|/* INT_: direct copy */
)brace
multiline_comment|/*&n; * Update the record to the passed values.&n; */
r_int
DECL|function|xfs_bmbt_update
id|xfs_bmbt_update
c_func
(paren
id|xfs_btree_cur_t
op_star
id|cur
comma
id|xfs_fileoff_t
id|off
comma
id|xfs_fsblock_t
id|bno
comma
id|xfs_filblks_t
id|len
comma
id|xfs_exntst_t
id|state
)paren
(brace
id|xfs_bmbt_block_t
op_star
id|block
suffix:semicolon
id|xfs_buf_t
op_star
id|bp
suffix:semicolon
r_int
id|error
suffix:semicolon
macro_line|#ifdef XFS_BMBT_TRACE
r_static
r_char
id|fname
(braket
)braket
op_assign
l_string|&quot;xfs_bmbt_update&quot;
suffix:semicolon
macro_line|#endif
id|xfs_bmbt_key_t
id|key
suffix:semicolon
r_int
id|ptr
suffix:semicolon
id|xfs_bmbt_rec_t
op_star
id|rp
suffix:semicolon
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ENTRY
)paren
suffix:semicolon
id|XFS_BMBT_TRACE_ARGFFFI
c_func
(paren
id|cur
comma
(paren
id|xfs_dfiloff_t
)paren
id|off
comma
(paren
id|xfs_dfsbno_t
)paren
id|bno
comma
(paren
id|xfs_dfilblks_t
)paren
id|len
comma
(paren
r_int
)paren
id|state
)paren
suffix:semicolon
id|block
op_assign
id|xfs_bmbt_get_block
c_func
(paren
id|cur
comma
l_int|0
comma
op_amp
id|bp
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_btree_check_lblock
c_func
(paren
id|cur
comma
id|block
comma
l_int|0
comma
id|bp
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#endif
id|ptr
op_assign
id|cur-&gt;bc_ptrs
(braket
l_int|0
)braket
suffix:semicolon
id|rp
op_assign
id|XFS_BMAP_REC_IADDR
c_func
(paren
id|block
comma
id|ptr
comma
id|cur
)paren
suffix:semicolon
id|xfs_bmbt_disk_set_allf
c_func
(paren
id|rp
comma
id|off
comma
id|bno
comma
id|len
comma
id|state
)paren
suffix:semicolon
id|xfs_bmbt_log_recs
c_func
(paren
id|cur
comma
id|bp
comma
id|ptr
comma
id|ptr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr
OG
l_int|1
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|INT_SET
c_func
(paren
id|key.br_startoff
comma
id|ARCH_CONVERT
comma
id|off
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|error
op_assign
id|xfs_bmbt_updkey
c_func
(paren
id|cur
comma
op_amp
id|key
comma
l_int|1
)paren
)paren
)paren
(brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|ERROR
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|XFS_BMBT_TRACE_CURSOR
c_func
(paren
id|cur
comma
id|EXIT
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Check an extent list, which has just been read, for&n; * any bit in the extent flag field. ASSERT on debug&n; * kernels, as this condition should not occur.&n; * Return an error condition (1) if any flags found,&n; * otherwise return 0.&n; */
r_int
DECL|function|xfs_check_nostate_extents
id|xfs_check_nostate_extents
c_func
(paren
id|xfs_bmbt_rec_t
op_star
id|ep
comma
id|xfs_extnum_t
id|num
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
id|num
OG
l_int|0
suffix:semicolon
id|num
op_decrement
comma
id|ep
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|ep-&gt;l0
op_rshift
(paren
l_int|64
op_minus
id|BMBT_EXNTFLAG_BITLEN
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|ASSERT
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
eof
