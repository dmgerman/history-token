multiline_comment|/*&n; * Copyright (c) 2000-2001 Silicon Graphics, Inc.  All Rights Reserved.&n; *&n; * This program is free software; you can redistribute it and/or modify it&n; * under the terms of version 2 of the GNU General Public License as&n; * published by the Free Software Foundation.&n; *&n; * This program is distributed in the hope that it would be useful, but&n; * WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&n; *&n; * Further, this software is distributed without any warranty that it is&n; * free of the rightful claim of any third person regarding infringement&n; * or the like.  Any license provided herein, whether implied or&n; * otherwise, applies only to this software file.  Patent licenses, if&n; * any, provided herein do not apply to combinations of this program with&n; * other software, or any other product whatsoever.&n; *&n; * You should have received a copy of the GNU General Public License along&n; * with this program; if not, write the Free Software Foundation, Inc., 59&n; * Temple Place - Suite 330, Boston MA 02111-1307, USA.&n; *&n; * Contact information: Silicon Graphics, Inc., 1600 Amphitheatre Pkwy,&n; * Mountain View, CA  94043, or:&n; *&n; * http://www.sgi.com&n; *&n; * For further information regarding this notice, see:&n; *&n; * http://oss.sgi.com/projects/GenInfo/SGIGPLNoticeExplan/&n; */
macro_line|#include &quot;xfs.h&quot;
macro_line|#include &quot;xfs_macros.h&quot;
macro_line|#include &quot;xfs_types.h&quot;
macro_line|#include &quot;xfs_inum.h&quot;
macro_line|#include &quot;xfs_log.h&quot;
macro_line|#include &quot;xfs_sb.h&quot;
macro_line|#include &quot;xfs_trans.h&quot;
macro_line|#include &quot;xfs_dir.h&quot;
macro_line|#include &quot;xfs_dir2.h&quot;
macro_line|#include &quot;xfs_dmapi.h&quot;
macro_line|#include &quot;xfs_mount.h&quot;
macro_line|#include &quot;xfs_bmap_btree.h&quot;
macro_line|#include &quot;xfs_attr_sf.h&quot;
macro_line|#include &quot;xfs_dir_sf.h&quot;
macro_line|#include &quot;xfs_dir2_sf.h&quot;
macro_line|#include &quot;xfs_dinode.h&quot;
macro_line|#include &quot;xfs_inode.h&quot;
macro_line|#include &quot;xfs_utils.h&quot;
macro_line|#include &quot;xfs_error.h&quot;
macro_line|#ifdef DEBUG
DECL|variable|xfs_etrap
r_int
id|xfs_etrap
(braket
id|XFS_ERROR_NTRAP
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
r_int
DECL|function|xfs_error_trap
id|xfs_error_trap
c_func
(paren
r_int
id|e
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|e
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|XFS_ERROR_NTRAP
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|xfs_etrap
(braket
id|i
)braket
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|e
op_ne
id|xfs_etrap
(braket
id|i
)braket
)paren
r_continue
suffix:semicolon
id|cmn_err
c_func
(paren
id|CE_NOTE
comma
l_string|&quot;xfs_error_trap: error %d&quot;
comma
id|e
)paren
suffix:semicolon
id|debug_stop_all_cpus
c_func
(paren
(paren
r_void
op_star
)paren
op_minus
l_int|1LL
)paren
suffix:semicolon
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|e
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if (defined(DEBUG) || defined(INDUCE_IO_ERROR))
DECL|variable|xfs_etest
r_int
id|xfs_etest
(braket
id|XFS_NUM_INJECT_ERROR
)braket
suffix:semicolon
DECL|variable|xfs_etest_fsid
r_int64
id|xfs_etest_fsid
(braket
id|XFS_NUM_INJECT_ERROR
)braket
suffix:semicolon
DECL|variable|xfs_etest_fsname
r_char
op_star
id|xfs_etest_fsname
(braket
id|XFS_NUM_INJECT_ERROR
)braket
suffix:semicolon
r_void
DECL|function|xfs_error_test_init
id|xfs_error_test_init
c_func
(paren
r_void
)paren
(brace
id|memset
c_func
(paren
id|xfs_etest
comma
l_int|0
comma
r_sizeof
(paren
id|xfs_etest
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|xfs_etest_fsid
comma
l_int|0
comma
r_sizeof
(paren
id|xfs_etest_fsid
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|xfs_etest_fsname
comma
l_int|0
comma
r_sizeof
(paren
id|xfs_etest_fsname
)paren
)paren
suffix:semicolon
)brace
r_int
DECL|function|xfs_error_test
id|xfs_error_test
c_func
(paren
r_int
id|error_tag
comma
r_int
op_star
id|fsidp
comma
r_char
op_star
id|expression
comma
r_int
id|line
comma
r_char
op_star
id|file
comma
r_int
r_int
id|randfactor
)paren
(brace
r_int
id|i
suffix:semicolon
r_int64
id|fsid
suffix:semicolon
r_if
c_cond
(paren
id|random
c_func
(paren
)paren
op_mod
id|randfactor
)paren
r_return
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|fsid
comma
id|fsidp
comma
r_sizeof
(paren
id|fsid_t
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|XFS_NUM_INJECT_ERROR
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|xfs_etest
(braket
id|i
)braket
op_eq
id|error_tag
op_logical_and
id|xfs_etest_fsid
(braket
id|i
)braket
op_eq
id|fsid
)paren
(brace
id|cmn_err
c_func
(paren
id|CE_WARN
comma
l_string|&quot;Injecting error (%s) at file %s, line %d, on filesystem &bslash;&quot;%s&bslash;&quot;&quot;
comma
id|expression
comma
id|file
comma
id|line
comma
id|xfs_etest_fsname
(braket
id|i
)braket
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|xfs_errortag_add
id|xfs_errortag_add
c_func
(paren
r_int
id|error_tag
comma
id|xfs_mount_t
op_star
id|mp
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|len
suffix:semicolon
r_int64
id|fsid
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|fsid
comma
id|mp-&gt;m_fixedfsid
comma
r_sizeof
(paren
id|fsid_t
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|XFS_NUM_INJECT_ERROR
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|xfs_etest_fsid
(braket
id|i
)braket
op_eq
id|fsid
op_logical_and
id|xfs_etest
(braket
id|i
)braket
op_eq
id|error_tag
)paren
(brace
id|cmn_err
c_func
(paren
id|CE_WARN
comma
l_string|&quot;XFS error tag #%d on&quot;
comma
id|error_tag
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|XFS_NUM_INJECT_ERROR
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|xfs_etest
(braket
id|i
)braket
op_eq
l_int|0
)paren
(brace
id|cmn_err
c_func
(paren
id|CE_WARN
comma
l_string|&quot;Turned on XFS error tag #%d&quot;
comma
id|error_tag
)paren
suffix:semicolon
id|xfs_etest
(braket
id|i
)braket
op_assign
id|error_tag
suffix:semicolon
id|xfs_etest_fsid
(braket
id|i
)braket
op_assign
id|fsid
suffix:semicolon
id|len
op_assign
id|strlen
c_func
(paren
id|mp-&gt;m_fsname
)paren
suffix:semicolon
id|xfs_etest_fsname
(braket
id|i
)braket
op_assign
id|kmem_alloc
c_func
(paren
id|len
op_plus
l_int|1
comma
id|KM_SLEEP
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|xfs_etest_fsname
(braket
id|i
)braket
comma
id|mp-&gt;m_fsname
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|cmn_err
c_func
(paren
id|CE_WARN
comma
l_string|&quot;error tag overflow, too many turned on&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_int
DECL|function|xfs_errortag_clear
id|xfs_errortag_clear
c_func
(paren
r_int
id|error_tag
comma
id|xfs_mount_t
op_star
id|mp
)paren
(brace
r_int
id|i
suffix:semicolon
r_int64
id|fsid
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|fsid
comma
id|mp-&gt;m_fixedfsid
comma
r_sizeof
(paren
id|fsid_t
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|XFS_NUM_INJECT_ERROR
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|xfs_etest_fsid
(braket
id|i
)braket
op_eq
id|fsid
op_logical_and
id|xfs_etest
(braket
id|i
)braket
op_eq
id|error_tag
)paren
(brace
id|xfs_etest
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|xfs_etest_fsid
(braket
id|i
)braket
op_assign
l_int|0LL
suffix:semicolon
id|kmem_free
c_func
(paren
id|xfs_etest_fsname
(braket
id|i
)braket
comma
id|strlen
c_func
(paren
id|xfs_etest_fsname
(braket
id|i
)braket
)paren
op_plus
l_int|1
)paren
suffix:semicolon
id|xfs_etest_fsname
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|cmn_err
c_func
(paren
id|CE_WARN
comma
l_string|&quot;Cleared XFS error tag #%d&quot;
comma
id|error_tag
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|cmn_err
c_func
(paren
id|CE_WARN
comma
l_string|&quot;XFS error tag %d not on&quot;
comma
id|error_tag
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_int
DECL|function|xfs_errortag_clearall_umount
id|xfs_errortag_clearall_umount
c_func
(paren
r_int64
id|fsid
comma
r_char
op_star
id|fsname
comma
r_int
id|loud
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|cleared
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|XFS_NUM_INJECT_ERROR
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|fsid
op_eq
l_int|0LL
op_logical_or
id|xfs_etest_fsid
(braket
id|i
)braket
op_eq
id|fsid
)paren
op_logical_and
id|xfs_etest
(braket
id|i
)braket
op_ne
l_int|0
)paren
(brace
id|cleared
op_assign
l_int|1
suffix:semicolon
id|cmn_err
c_func
(paren
id|CE_WARN
comma
l_string|&quot;Clearing XFS error tag #%d&quot;
comma
id|xfs_etest
(braket
id|i
)braket
)paren
suffix:semicolon
id|xfs_etest
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|xfs_etest_fsid
(braket
id|i
)braket
op_assign
l_int|0LL
suffix:semicolon
id|kmem_free
c_func
(paren
id|xfs_etest_fsname
(braket
id|i
)braket
comma
id|strlen
c_func
(paren
id|xfs_etest_fsname
(braket
id|i
)braket
)paren
op_plus
l_int|1
)paren
suffix:semicolon
id|xfs_etest_fsname
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|loud
op_logical_or
id|cleared
)paren
id|cmn_err
c_func
(paren
id|CE_WARN
comma
l_string|&quot;Cleared all XFS error tags for filesystem &bslash;&quot;%s&bslash;&quot;&quot;
comma
id|fsname
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|xfs_errortag_clearall
id|xfs_errortag_clearall
c_func
(paren
id|xfs_mount_t
op_star
id|mp
)paren
(brace
r_int64
id|fsid
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|fsid
comma
id|mp-&gt;m_fixedfsid
comma
r_sizeof
(paren
id|fsid_t
)paren
)paren
suffix:semicolon
r_return
id|xfs_errortag_clearall_umount
c_func
(paren
id|fsid
comma
id|mp-&gt;m_fsname
comma
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#endif /* DEBUG || INDUCE_IO_ERROR */
r_static
r_void
DECL|function|xfs_fs_vcmn_err
id|xfs_fs_vcmn_err
c_func
(paren
r_int
id|level
comma
id|xfs_mount_t
op_star
id|mp
comma
r_char
op_star
id|fmt
comma
id|va_list
id|ap
)paren
(brace
r_char
op_star
id|newfmt
suffix:semicolon
r_int
id|len
op_assign
l_int|16
op_plus
id|mp-&gt;m_fsname_len
op_plus
id|strlen
c_func
(paren
id|fmt
)paren
suffix:semicolon
id|newfmt
op_assign
id|kmem_alloc
c_func
(paren
id|len
comma
id|KM_SLEEP
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|newfmt
comma
l_string|&quot;Filesystem &bslash;&quot;%s&bslash;&quot;: %s&quot;
comma
id|mp-&gt;m_fsname
comma
id|fmt
)paren
suffix:semicolon
id|icmn_err
c_func
(paren
id|level
comma
id|newfmt
comma
id|ap
)paren
suffix:semicolon
id|kmem_free
c_func
(paren
id|newfmt
comma
id|len
)paren
suffix:semicolon
)brace
r_void
DECL|function|xfs_fs_cmn_err
id|xfs_fs_cmn_err
c_func
(paren
r_int
id|level
comma
id|xfs_mount_t
op_star
id|mp
comma
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|ap
suffix:semicolon
id|va_start
c_func
(paren
id|ap
comma
id|fmt
)paren
suffix:semicolon
id|xfs_fs_vcmn_err
c_func
(paren
id|level
comma
id|mp
comma
id|fmt
comma
id|ap
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|ap
)paren
suffix:semicolon
)brace
r_void
DECL|function|xfs_cmn_err
id|xfs_cmn_err
c_func
(paren
r_int
id|panic_tag
comma
r_int
id|level
comma
id|xfs_mount_t
op_star
id|mp
comma
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|ap
suffix:semicolon
macro_line|#ifdef DEBUG
id|xfs_panic_mask
op_or_assign
id|XFS_PTAG_SHUTDOWN_CORRUPT
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|xfs_panic_mask
op_logical_and
(paren
id|xfs_panic_mask
op_amp
id|panic_tag
)paren
op_logical_and
(paren
id|level
op_amp
id|CE_ALERT
)paren
)paren
(brace
id|level
op_and_assign
op_complement
id|CE_ALERT
suffix:semicolon
id|level
op_or_assign
id|CE_PANIC
suffix:semicolon
id|cmn_err
c_func
(paren
id|CE_ALERT
comma
l_string|&quot;XFS: Transforming an alert into a BUG.&quot;
)paren
suffix:semicolon
)brace
id|va_start
c_func
(paren
id|ap
comma
id|fmt
)paren
suffix:semicolon
id|xfs_fs_vcmn_err
c_func
(paren
id|level
comma
id|mp
comma
id|fmt
comma
id|ap
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|ap
)paren
suffix:semicolon
)brace
r_void
DECL|function|xfs_error_report
id|xfs_error_report
c_func
(paren
r_char
op_star
id|tag
comma
r_int
id|level
comma
id|xfs_mount_t
op_star
id|mp
comma
r_char
op_star
id|fname
comma
r_int
id|linenum
comma
id|inst_t
op_star
id|ra
)paren
(brace
r_if
c_cond
(paren
id|level
op_le
id|xfs_error_level
)paren
(brace
r_if
c_cond
(paren
id|mp
op_ne
l_int|NULL
)paren
(brace
id|xfs_cmn_err
c_func
(paren
id|XFS_PTAG_ERROR_REPORT
comma
id|CE_ALERT
comma
id|mp
comma
l_string|&quot;XFS internal error %s at line %d of file %s.  Caller 0x%p&bslash;n&quot;
comma
id|tag
comma
id|linenum
comma
id|fname
comma
id|ra
)paren
suffix:semicolon
)brace
r_else
(brace
id|cmn_err
c_func
(paren
id|CE_ALERT
comma
l_string|&quot;XFS internal error %s at line %d of file %s.  Caller 0x%p&bslash;n&quot;
comma
id|tag
comma
id|linenum
comma
id|fname
comma
id|ra
)paren
suffix:semicolon
)brace
id|xfs_stack_trace
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|xfs_hex_dump
id|xfs_hex_dump
c_func
(paren
r_void
op_star
id|p
comma
r_int
id|length
)paren
(brace
id|__uint8_t
op_star
id|uip
op_assign
(paren
id|__uint8_t
op_star
)paren
id|p
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
id|sbuf
(braket
l_int|128
)braket
comma
op_star
id|s
suffix:semicolon
id|s
op_assign
id|sbuf
suffix:semicolon
op_star
id|s
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|length
suffix:semicolon
id|i
op_increment
comma
id|uip
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|i
op_mod
l_int|16
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_star
id|s
op_ne
l_char|&squot;&bslash;0&squot;
)paren
id|cmn_err
c_func
(paren
id|CE_ALERT
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|sbuf
)paren
suffix:semicolon
id|s
op_assign
id|sbuf
suffix:semicolon
id|sprintf
c_func
(paren
id|s
comma
l_string|&quot;0x%x: &quot;
comma
id|i
)paren
suffix:semicolon
r_while
c_loop
(paren
op_star
id|s
op_ne
l_char|&squot;&bslash;0&squot;
)paren
(brace
id|s
op_increment
suffix:semicolon
)brace
)brace
id|sprintf
c_func
(paren
id|s
comma
l_string|&quot;%02x &quot;
comma
op_star
id|uip
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * the kernel sprintf is a void; user sprintf returns&n;&t;&t; * the sprintf&squot;ed string&squot;s length.  Find the new end-&n;&t;&t; * of-string&n;&t;&t; */
r_while
c_loop
(paren
op_star
id|s
op_ne
l_char|&squot;&bslash;0&squot;
)paren
(brace
id|s
op_increment
suffix:semicolon
)brace
)brace
id|cmn_err
c_func
(paren
id|CE_ALERT
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|sbuf
)paren
suffix:semicolon
)brace
r_void
DECL|function|xfs_corruption_error
id|xfs_corruption_error
c_func
(paren
r_char
op_star
id|tag
comma
r_int
id|level
comma
id|xfs_mount_t
op_star
id|mp
comma
r_void
op_star
id|p
comma
r_char
op_star
id|fname
comma
r_int
id|linenum
comma
id|inst_t
op_star
id|ra
)paren
(brace
r_if
c_cond
(paren
id|level
op_le
id|xfs_error_level
)paren
id|xfs_hex_dump
c_func
(paren
id|p
comma
l_int|16
)paren
suffix:semicolon
id|xfs_error_report
c_func
(paren
id|tag
comma
id|level
comma
id|mp
comma
id|fname
comma
id|linenum
comma
id|ra
)paren
suffix:semicolon
)brace
eof
