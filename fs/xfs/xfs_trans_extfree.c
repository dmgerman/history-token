multiline_comment|/*&n; * Copyright (c) 2000 Silicon Graphics, Inc.  All Rights Reserved.&n; *&n; * This program is free software; you can redistribute it and/or modify it&n; * under the terms of version 2 of the GNU General Public License as&n; * published by the Free Software Foundation.&n; *&n; * This program is distributed in the hope that it would be useful, but&n; * WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&n; *&n; * Further, this software is distributed without any warranty that it is&n; * free of the rightful claim of any third person regarding infringement&n; * or the like.  Any license provided herein, whether implied or&n; * otherwise, applies only to this software file.  Patent licenses, if&n; * any, provided herein do not apply to combinations of this program with&n; * other software, or any other product whatsoever.&n; *&n; * You should have received a copy of the GNU General Public License along&n; * with this program; if not, write the Free Software Foundation, Inc., 59&n; * Temple Place - Suite 330, Boston MA 02111-1307, USA.&n; *&n; * Contact information: Silicon Graphics, Inc., 1600 Amphitheatre Pkwy,&n; * Mountain View, CA  94043, or:&n; *&n; * http://www.sgi.com&n; *&n; * For further information regarding this notice, see:&n; *&n; * http://oss.sgi.com/projects/GenInfo/SGIGPLNoticeExplan/&n; */
macro_line|#include &lt;xfs.h&gt;
multiline_comment|/*&n; * This routine is called to allocate an &quot;extent free intention&quot;&n; * log item that will hold nextents worth of extents.  The&n; * caller must use all nextents extents, because we are not&n; * flexible about this at all.&n; */
id|xfs_efi_log_item_t
op_star
DECL|function|xfs_trans_get_efi
id|xfs_trans_get_efi
c_func
(paren
id|xfs_trans_t
op_star
id|tp
comma
id|uint
id|nextents
)paren
(brace
id|xfs_efi_log_item_t
op_star
id|efip
suffix:semicolon
id|ASSERT
c_func
(paren
id|tp
op_ne
l_int|NULL
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|nextents
OG
l_int|0
)paren
suffix:semicolon
id|efip
op_assign
id|xfs_efi_init
c_func
(paren
id|tp-&gt;t_mountp
comma
id|nextents
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|efip
op_ne
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Get a log_item_desc to point at the new item.&n;&t; */
(paren
r_void
)paren
id|xfs_trans_add_item
c_func
(paren
id|tp
comma
(paren
id|xfs_log_item_t
op_star
)paren
id|efip
)paren
suffix:semicolon
r_return
(paren
id|efip
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * This routine is called to indicate that the described&n; * extent is to be logged as needing to be freed.  It should&n; * be called once for each extent to be freed.&n; */
r_void
DECL|function|xfs_trans_log_efi_extent
id|xfs_trans_log_efi_extent
c_func
(paren
id|xfs_trans_t
op_star
id|tp
comma
id|xfs_efi_log_item_t
op_star
id|efip
comma
id|xfs_fsblock_t
id|start_block
comma
id|xfs_extlen_t
id|ext_len
)paren
(brace
id|xfs_log_item_desc_t
op_star
id|lidp
suffix:semicolon
id|uint
id|next_extent
suffix:semicolon
id|xfs_extent_t
op_star
id|extp
suffix:semicolon
id|lidp
op_assign
id|xfs_trans_find_item
c_func
(paren
id|tp
comma
(paren
id|xfs_log_item_t
op_star
)paren
id|efip
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|lidp
op_ne
l_int|NULL
)paren
suffix:semicolon
id|tp-&gt;t_flags
op_or_assign
id|XFS_TRANS_DIRTY
suffix:semicolon
id|lidp-&gt;lid_flags
op_or_assign
id|XFS_LID_DIRTY
suffix:semicolon
id|next_extent
op_assign
id|efip-&gt;efi_next_extent
suffix:semicolon
id|ASSERT
c_func
(paren
id|next_extent
OL
id|efip-&gt;efi_format.efi_nextents
)paren
suffix:semicolon
id|extp
op_assign
op_amp
(paren
id|efip-&gt;efi_format.efi_extents
(braket
id|next_extent
)braket
)paren
suffix:semicolon
id|extp-&gt;ext_start
op_assign
id|start_block
suffix:semicolon
id|extp-&gt;ext_len
op_assign
id|ext_len
suffix:semicolon
id|efip-&gt;efi_next_extent
op_increment
suffix:semicolon
)brace
multiline_comment|/*&n; * This routine is called to allocate an &quot;extent free done&quot;&n; * log item that will hold nextents worth of extents.  The&n; * caller must use all nextents extents, because we are not&n; * flexible about this at all.&n; */
id|xfs_efd_log_item_t
op_star
DECL|function|xfs_trans_get_efd
id|xfs_trans_get_efd
c_func
(paren
id|xfs_trans_t
op_star
id|tp
comma
id|xfs_efi_log_item_t
op_star
id|efip
comma
id|uint
id|nextents
)paren
(brace
id|xfs_efd_log_item_t
op_star
id|efdp
suffix:semicolon
id|ASSERT
c_func
(paren
id|tp
op_ne
l_int|NULL
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|nextents
OG
l_int|0
)paren
suffix:semicolon
id|efdp
op_assign
id|xfs_efd_init
c_func
(paren
id|tp-&gt;t_mountp
comma
id|efip
comma
id|nextents
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|efdp
op_ne
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Get a log_item_desc to point at the new item.&n;&t; */
(paren
r_void
)paren
id|xfs_trans_add_item
c_func
(paren
id|tp
comma
(paren
id|xfs_log_item_t
op_star
)paren
id|efdp
)paren
suffix:semicolon
r_return
(paren
id|efdp
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * This routine is called to indicate that the described&n; * extent is to be logged as having been freed.  It should&n; * be called once for each extent freed.&n; */
r_void
DECL|function|xfs_trans_log_efd_extent
id|xfs_trans_log_efd_extent
c_func
(paren
id|xfs_trans_t
op_star
id|tp
comma
id|xfs_efd_log_item_t
op_star
id|efdp
comma
id|xfs_fsblock_t
id|start_block
comma
id|xfs_extlen_t
id|ext_len
)paren
(brace
id|xfs_log_item_desc_t
op_star
id|lidp
suffix:semicolon
id|uint
id|next_extent
suffix:semicolon
id|xfs_extent_t
op_star
id|extp
suffix:semicolon
id|lidp
op_assign
id|xfs_trans_find_item
c_func
(paren
id|tp
comma
(paren
id|xfs_log_item_t
op_star
)paren
id|efdp
)paren
suffix:semicolon
id|ASSERT
c_func
(paren
id|lidp
op_ne
l_int|NULL
)paren
suffix:semicolon
id|tp-&gt;t_flags
op_or_assign
id|XFS_TRANS_DIRTY
suffix:semicolon
id|lidp-&gt;lid_flags
op_or_assign
id|XFS_LID_DIRTY
suffix:semicolon
id|next_extent
op_assign
id|efdp-&gt;efd_next_extent
suffix:semicolon
id|ASSERT
c_func
(paren
id|next_extent
OL
id|efdp-&gt;efd_format.efd_nextents
)paren
suffix:semicolon
id|extp
op_assign
op_amp
(paren
id|efdp-&gt;efd_format.efd_extents
(braket
id|next_extent
)braket
)paren
suffix:semicolon
id|extp-&gt;ext_start
op_assign
id|start_block
suffix:semicolon
id|extp-&gt;ext_len
op_assign
id|ext_len
suffix:semicolon
id|efdp-&gt;efd_next_extent
op_increment
suffix:semicolon
)brace
eof
