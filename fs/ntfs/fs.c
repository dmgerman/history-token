multiline_comment|/*&n; * fs.c - NTFS driver for Linux 2.4.x&n; *&n; * Legato Systems, Inc. (http://www.legato.com) have sponsored Anton&n; * Altaparmakov to develop NTFS on Linux since June 2001.&n; *&n; * Copyright (C) 1995-1997, 1999 Martin von L&#xfffd;wis&n; * Copyright (C) 1996 Richard Russon&n; * Copyright (C) 1996-1997 R&#xfffd;gis Duchesne&n; * Copyright (C) 2000-2001, Anton Altaparmakov (AIA)&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &quot;ntfstypes.h&quot;
macro_line|#include &quot;struct.h&quot;
macro_line|#include &quot;util.h&quot;
macro_line|#include &quot;inode.h&quot;
macro_line|#include &quot;super.h&quot;
macro_line|#include &quot;dir.h&quot;
macro_line|#include &quot;support.h&quot;
macro_line|#include &quot;macros.h&quot;
macro_line|#include &quot;sysctl.h&quot;
macro_line|#include &quot;attr.h&quot;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/locks.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/blkdev.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;linux/nls.h&gt;
macro_line|#include &lt;linux/ntfs_fs.h&gt;
multiline_comment|/* Forward declarations. */
DECL|variable|ntfs_dir_inode_operations
r_static
r_struct
id|inode_operations
id|ntfs_dir_inode_operations
suffix:semicolon
DECL|variable|ntfs_dir_operations
r_static
r_struct
id|file_operations
id|ntfs_dir_operations
suffix:semicolon
DECL|macro|ITEM_SIZE
mdefine_line|#define ITEM_SIZE 2040
multiline_comment|/* Io functions to user space. */
DECL|function|ntfs_putuser
r_static
r_void
id|ntfs_putuser
c_func
(paren
id|ntfs_io
op_star
id|dest
comma
r_void
op_star
id|src
comma
id|ntfs_size_t
id|len
)paren
(brace
id|copy_to_user
c_func
(paren
id|dest-&gt;param
comma
id|src
comma
id|len
)paren
suffix:semicolon
id|dest-&gt;param
op_add_assign
id|len
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_NTFS_RW
DECL|struct|ntfs_getuser_update_vm_s
r_struct
id|ntfs_getuser_update_vm_s
(brace
DECL|member|user
r_const
r_char
op_star
id|user
suffix:semicolon
DECL|member|ino
r_struct
id|inode
op_star
id|ino
suffix:semicolon
DECL|member|off
id|loff_t
id|off
suffix:semicolon
)brace
suffix:semicolon
DECL|function|ntfs_getuser_update_vm
r_static
r_void
id|ntfs_getuser_update_vm
c_func
(paren
r_void
op_star
id|dest
comma
id|ntfs_io
op_star
id|src
comma
id|ntfs_size_t
id|len
)paren
(brace
r_struct
id|ntfs_getuser_update_vm_s
op_star
id|p
op_assign
id|src-&gt;param
suffix:semicolon
id|copy_from_user
c_func
(paren
id|dest
comma
id|p-&gt;user
comma
id|len
)paren
suffix:semicolon
id|p-&gt;user
op_add_assign
id|len
suffix:semicolon
id|p-&gt;off
op_add_assign
id|len
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* loff_t is 64 bit signed, so is cool. */
DECL|function|ntfs_read
r_static
id|ssize_t
id|ntfs_read
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|off
)paren
(brace
r_int
id|error
suffix:semicolon
id|ntfs_io
id|io
suffix:semicolon
id|ntfs_attribute
op_star
id|attr
suffix:semicolon
id|ntfs_inode
op_star
id|ino
op_assign
id|NTFS_LINO2NINO
c_func
(paren
id|filp-&gt;f_dentry-&gt;d_inode
)paren
suffix:semicolon
multiline_comment|/* Inode is not properly initialized. */
r_if
c_cond
(paren
op_logical_neg
id|ino
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_read %x, %Lx, %x -&gt;&quot;
comma
(paren
r_int
)paren
id|ino-&gt;i_number
comma
(paren
r_int
r_int
r_int
)paren
op_star
id|off
comma
(paren
r_int
)paren
id|count
)paren
suffix:semicolon
id|attr
op_assign
id|ntfs_find_attr
c_func
(paren
id|ino
comma
id|ino-&gt;vol-&gt;at_data
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* Inode has no unnamed data attribute. */
r_if
c_cond
(paren
op_logical_neg
id|attr
)paren
(brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_read: $DATA not found!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|attr-&gt;flags
op_amp
id|ATTR_IS_ENCRYPTED
)paren
r_return
op_minus
id|EACCES
suffix:semicolon
multiline_comment|/* Read the data. */
id|io.fn_put
op_assign
id|ntfs_putuser
suffix:semicolon
id|io.fn_get
op_assign
l_int|0
suffix:semicolon
id|io.param
op_assign
id|buf
suffix:semicolon
id|io.size
op_assign
id|count
suffix:semicolon
id|error
op_assign
id|ntfs_read_attr
c_func
(paren
id|ino
comma
id|ino-&gt;vol-&gt;at_data
comma
l_int|NULL
comma
op_star
id|off
comma
op_amp
id|io
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_logical_and
op_logical_neg
id|io.size
)paren
(brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_read: read_attr failed with &quot;
l_string|&quot;error %i, io size %u.&bslash;n&quot;
comma
id|error
comma
id|io.size
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
op_star
id|off
op_add_assign
id|io.size
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_read: finished. read %u bytes.&bslash;n&quot;
comma
id|io.size
)paren
suffix:semicolon
r_return
id|io.size
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_NTFS_RW
DECL|function|ntfs_write
r_static
id|ssize_t
id|ntfs_write
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_int
id|err
suffix:semicolon
r_struct
id|inode
op_star
id|vfs_ino
op_assign
id|filp-&gt;f_dentry-&gt;d_inode
suffix:semicolon
id|ntfs_inode
op_star
id|ntfs_ino
op_assign
id|NTFS_LINO2NINO
c_func
(paren
id|vfs_ino
)paren
suffix:semicolon
id|ntfs_attribute
op_star
id|data
suffix:semicolon
id|ntfs_io
id|io
suffix:semicolon
r_struct
id|ntfs_getuser_update_vm_s
id|param
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ntfs_ino
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_LINUX
comma
id|__FUNCTION__
l_string|&quot;(): Entering for inode 0x%lx, &quot;
l_string|&quot;*pos 0x%Lx, count 0x%x.&bslash;n&quot;
comma
id|ntfs_ino-&gt;i_number
comma
op_star
id|pos
comma
id|count
)paren
suffix:semicolon
multiline_comment|/* Allows to lock fs ro at any time. */
r_if
c_cond
(paren
id|vfs_ino-&gt;i_sb-&gt;s_flags
op_amp
id|MS_RDONLY
)paren
r_return
op_minus
id|EROFS
suffix:semicolon
id|data
op_assign
id|ntfs_find_attr
c_func
(paren
id|ntfs_ino
comma
id|ntfs_ino-&gt;vol-&gt;at_data
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Evaluating O_APPEND is the file system&squot;s job... */
r_if
c_cond
(paren
id|filp-&gt;f_flags
op_amp
id|O_APPEND
)paren
op_star
id|pos
op_assign
id|vfs_ino-&gt;i_size
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data-&gt;resident
op_logical_and
op_star
id|pos
op_plus
id|count
OG
id|data-&gt;allocated
)paren
(brace
id|err
op_assign
id|ntfs_extend_attr
c_func
(paren
id|ntfs_ino
comma
id|data
comma
op_star
id|pos
op_plus
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
id|param.user
op_assign
id|buf
suffix:semicolon
id|param.ino
op_assign
id|vfs_ino
suffix:semicolon
id|param.off
op_assign
op_star
id|pos
suffix:semicolon
id|io.fn_put
op_assign
l_int|0
suffix:semicolon
id|io.fn_get
op_assign
id|ntfs_getuser_update_vm
suffix:semicolon
id|io.param
op_assign
op_amp
id|param
suffix:semicolon
id|io.size
op_assign
id|count
suffix:semicolon
id|io.do_read
op_assign
l_int|0
suffix:semicolon
id|err
op_assign
id|ntfs_readwrite_attr
c_func
(paren
id|ntfs_ino
comma
id|data
comma
op_star
id|pos
comma
op_amp
id|io
)paren
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_LINUX
comma
id|__FUNCTION__
l_string|&quot;(): Returning %i&bslash;n&quot;
comma
op_minus
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
op_star
id|pos
op_add_assign
id|io.size
suffix:semicolon
r_if
c_cond
(paren
op_star
id|pos
OG
id|vfs_ino-&gt;i_size
)paren
id|vfs_ino-&gt;i_size
op_assign
op_star
id|pos
suffix:semicolon
id|mark_inode_dirty
c_func
(paren
id|vfs_ino
)paren
suffix:semicolon
r_return
id|io.size
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
macro_line|#endif
DECL|struct|ntfs_filldir
r_struct
id|ntfs_filldir
(brace
DECL|member|dir
r_struct
id|inode
op_star
id|dir
suffix:semicolon
DECL|member|filldir
id|filldir_t
id|filldir
suffix:semicolon
DECL|member|type
r_int
r_int
id|type
suffix:semicolon
DECL|member|ph
DECL|member|pl
id|u32
id|ph
comma
id|pl
suffix:semicolon
DECL|member|dirent
r_void
op_star
id|dirent
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|namelen
r_int
id|namelen
suffix:semicolon
DECL|member|ret_code
r_int
id|ret_code
suffix:semicolon
)brace
suffix:semicolon
DECL|function|ntfs_printcb
r_static
r_int
id|ntfs_printcb
c_func
(paren
id|ntfs_u8
op_star
id|entry
comma
r_void
op_star
id|param
)paren
(brace
r_int
r_int
id|inum
op_assign
id|NTFS_GETU64
c_func
(paren
id|entry
)paren
op_amp
l_int|0xffffffffffff
suffix:semicolon
r_struct
id|ntfs_filldir
op_star
id|nf
op_assign
id|param
suffix:semicolon
id|u32
id|flags
op_assign
id|NTFS_GETU32
c_func
(paren
id|entry
op_plus
l_int|0x48
)paren
suffix:semicolon
r_char
id|show_sys_files
op_assign
l_int|0
suffix:semicolon
id|u8
id|name_len
op_assign
id|NTFS_GETU8
c_func
(paren
id|entry
op_plus
l_int|0x50
)paren
suffix:semicolon
id|u8
id|name_type
op_assign
id|NTFS_GETU8
c_func
(paren
id|entry
op_plus
l_int|0x51
)paren
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|file_type
suffix:semicolon
r_switch
c_cond
(paren
id|nf-&gt;type
)paren
(brace
r_case
id|ngt_dos
suffix:colon
multiline_comment|/* Don&squot;t display long names. */
r_if
c_cond
(paren
op_logical_neg
(paren
id|name_type
op_amp
l_int|2
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ngt_nt
suffix:colon
multiline_comment|/* Don&squot;t display short-only names. */
r_if
c_cond
(paren
(paren
id|name_type
op_amp
l_int|3
)paren
op_eq
l_int|2
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ngt_posix
suffix:colon
r_break
suffix:semicolon
r_case
id|ngt_full
suffix:colon
id|show_sys_files
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
id|err
op_assign
id|ntfs_encodeuni
c_func
(paren
id|NTFS_INO2VOL
c_func
(paren
id|nf-&gt;dir
)paren
comma
(paren
id|ntfs_u16
op_star
)paren
(paren
id|entry
op_plus
l_int|0x52
)paren
comma
id|name_len
comma
op_amp
id|nf-&gt;name
comma
op_amp
id|nf-&gt;namelen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
id|__FUNCTION__
l_string|&quot;(): Skipping &quot;
l_string|&quot;unrepresentable file.&bslash;n&quot;
)paren
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_goto
id|err_ret
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|show_sys_files
op_logical_and
id|inum
OL
l_int|0x10UL
)paren
(brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
id|__FUNCTION__
l_string|&quot;(): Skipping system &quot;
l_string|&quot;file (%s).&bslash;n&quot;
comma
id|nf-&gt;name
)paren
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_goto
id|err_ret
suffix:semicolon
)brace
multiline_comment|/* Do not return &quot;.&quot;, as this is faked. */
r_if
c_cond
(paren
id|nf-&gt;namelen
op_eq
l_int|1
op_logical_and
id|nf-&gt;name
(braket
l_int|0
)braket
op_eq
l_char|&squot;.&squot;
)paren
(brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
id|__FUNCTION__
l_string|&quot;(): Skipping &bslash;&quot;.&bslash;&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_goto
id|err_ret
suffix:semicolon
)brace
id|nf-&gt;name
(braket
id|nf-&gt;namelen
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
l_int|0x10000000
)paren
multiline_comment|/* FILE_ATTR_DUP_FILE_NAME_INDEX_PRESENT */
id|file_type
op_assign
id|DT_DIR
suffix:semicolon
r_else
id|file_type
op_assign
id|DT_REG
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
id|__FUNCTION__
l_string|&quot;(): Calling filldir for %s with &quot;
l_string|&quot;len %i, f_pos 0x%Lx, inode %lu, %s.&bslash;n&quot;
comma
id|nf-&gt;name
comma
id|nf-&gt;namelen
comma
(paren
id|loff_t
)paren
(paren
id|nf-&gt;ph
op_lshift
l_int|16
)paren
op_or
id|nf-&gt;pl
comma
id|inum
comma
id|file_type
op_eq
id|DT_DIR
ques
c_cond
l_string|&quot;DT_DIR&quot;
suffix:colon
l_string|&quot;DT_REG&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Userspace side of filldir expects an off_t rather than an loff_t.&n;&t; * And it also doesn&squot;t like the most significant bit being set as it&n;&t; * then considers the value to be negative. Thus this implementation&n;&t; * limits the number of index records to 32766, which should be plenty.&n;&t; */
id|err
op_assign
id|nf
op_member_access_from_pointer
id|filldir
c_func
(paren
id|nf-&gt;dirent
comma
id|nf-&gt;name
comma
id|nf-&gt;namelen
comma
(paren
id|loff_t
)paren
(paren
id|nf-&gt;ph
op_lshift
l_int|16
)paren
op_or
id|nf-&gt;pl
comma
id|inum
comma
id|file_type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|nf-&gt;ret_code
op_assign
id|err
suffix:semicolon
id|err_ret
suffix:colon
id|nf-&gt;namelen
op_assign
l_int|0
suffix:semicolon
id|ntfs_free
c_func
(paren
id|nf-&gt;name
)paren
suffix:semicolon
id|nf-&gt;name
op_assign
l_int|NULL
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; * readdir returns &squot;.&squot;, then &squot;..&squot;, then the directory entries in sequence.&n; * As the root directory contains an entry for itself, &squot;.&squot; is not emulated for&n; * the root directory.&n; */
DECL|function|ntfs_readdir
r_static
r_int
id|ntfs_readdir
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
r_void
op_star
id|dirent
comma
id|filldir_t
id|filldir
)paren
(brace
r_struct
id|inode
op_star
id|dir
op_assign
id|filp-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_int
id|err
suffix:semicolon
r_struct
id|ntfs_filldir
id|cb
suffix:semicolon
id|cb.ret_code
op_assign
l_int|0
suffix:semicolon
id|cb.pl
op_assign
id|filp-&gt;f_pos
op_amp
l_int|0xffff
suffix:semicolon
id|cb.ph
op_assign
(paren
id|filp-&gt;f_pos
op_rshift
l_int|16
)paren
op_amp
l_int|0x7fff
suffix:semicolon
id|filp-&gt;f_pos
op_assign
(paren
id|loff_t
)paren
(paren
id|cb.ph
op_lshift
l_int|16
)paren
op_or
id|cb.pl
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
id|__FUNCTION__
l_string|&quot;(): Entering for inode %lu, &quot;
l_string|&quot;f_pos 0x%Lx, i_mode 0x%x, i_count %lu.&bslash;n&quot;
comma
id|dir-&gt;i_ino
comma
id|filp-&gt;f_pos
comma
(paren
r_int
r_int
)paren
id|dir-&gt;i_mode
comma
id|atomic_read
c_func
(paren
op_amp
id|dir-&gt;i_count
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cb.ph
)paren
(brace
multiline_comment|/* Start of directory. Emulate &quot;.&quot; and &quot;..&quot;. */
r_if
c_cond
(paren
op_logical_neg
id|cb.pl
)paren
(brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
id|__FUNCTION__
l_string|&quot;(): Calling &quot;
l_string|&quot;filldir for . with len 1, f_pos 0x%Lx, &quot;
l_string|&quot;inode %lu, DT_DIR.&bslash;n&quot;
comma
id|filp-&gt;f_pos
comma
id|dir-&gt;i_ino
)paren
suffix:semicolon
id|cb.ret_code
op_assign
id|filldir
c_func
(paren
id|dirent
comma
l_string|&quot;.&quot;
comma
l_int|1
comma
id|filp-&gt;f_pos
comma
id|dir-&gt;i_ino
comma
id|DT_DIR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cb.ret_code
)paren
r_goto
id|done
suffix:semicolon
id|cb.pl
op_increment
suffix:semicolon
id|filp-&gt;f_pos
op_assign
(paren
id|loff_t
)paren
(paren
id|cb.ph
op_lshift
l_int|16
)paren
op_or
id|cb.pl
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cb.pl
op_eq
(paren
id|u32
)paren
l_int|1
)paren
(brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
id|__FUNCTION__
l_string|&quot;(): Calling &quot;
l_string|&quot;filldir for .. with len 2, f_pos 0x%Lx, &quot;
l_string|&quot;inode %lu, DT_DIR.&bslash;n&quot;
comma
id|filp-&gt;f_pos
comma
id|filp-&gt;f_dentry-&gt;d_parent-&gt;d_inode-&gt;i_ino
)paren
suffix:semicolon
id|cb.ret_code
op_assign
id|filldir
c_func
(paren
id|dirent
comma
l_string|&quot;..&quot;
comma
l_int|2
comma
id|filp-&gt;f_pos
comma
id|filp-&gt;f_dentry-&gt;d_parent-&gt;d_inode-&gt;i_ino
comma
id|DT_DIR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cb.ret_code
)paren
r_goto
id|done
suffix:semicolon
id|cb.pl
op_increment
suffix:semicolon
id|filp-&gt;f_pos
op_assign
(paren
id|loff_t
)paren
(paren
id|cb.ph
op_lshift
l_int|16
)paren
op_or
id|cb.pl
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|cb.ph
op_ge
l_int|0x7fff
)paren
multiline_comment|/* End of directory. */
r_goto
id|done
suffix:semicolon
id|cb.dir
op_assign
id|dir
suffix:semicolon
id|cb.filldir
op_assign
id|filldir
suffix:semicolon
id|cb.dirent
op_assign
id|dirent
suffix:semicolon
id|cb.type
op_assign
id|NTFS_INO2VOL
c_func
(paren
id|dir
)paren
op_member_access_from_pointer
id|ngt
suffix:semicolon
r_do
(brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
id|__FUNCTION__
l_string|&quot;(): Looking for next &quot;
l_string|&quot;file using ntfs_getdir_unsorted(), f_pos &quot;
l_string|&quot;0x%Lx.&bslash;n&quot;
comma
(paren
id|loff_t
)paren
(paren
id|cb.ph
op_lshift
l_int|16
)paren
op_or
id|cb.pl
)paren
suffix:semicolon
id|err
op_assign
id|ntfs_getdir_unsorted
c_func
(paren
id|NTFS_LINO2NINO
c_func
(paren
id|dir
)paren
comma
op_amp
id|cb.ph
comma
op_amp
id|cb.pl
comma
id|ntfs_printcb
comma
op_amp
id|cb
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
id|err
op_logical_and
op_logical_neg
id|cb.ret_code
op_logical_and
id|cb.ph
OL
l_int|0x7fff
)paren
suffix:semicolon
id|filp-&gt;f_pos
op_assign
(paren
id|loff_t
)paren
(paren
id|cb.ph
op_lshift
l_int|16
)paren
op_or
id|cb.pl
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
id|__FUNCTION__
l_string|&quot;(): After ntfs_getdir_unsorted()&quot;
l_string|&quot; calls, f_pos 0x%Lx.&bslash;n&quot;
comma
id|filp-&gt;f_pos
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|cb.ph
op_ne
l_int|0x7fff
op_logical_or
id|cb.pl
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|done
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|cb.ret_code
)paren
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
id|__FUNCTION__
l_string|&quot;(): EOD, f_pos &quot;
l_string|&quot;0x%Lx, returning 0.&bslash;n&quot;
comma
id|filp-&gt;f_pos
)paren
suffix:semicolon
r_else
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
id|__FUNCTION__
l_string|&quot;(): filldir &quot;
l_string|&quot;returned %i, returning 0, f_pos &quot;
l_string|&quot;0x%Lx.&bslash;n&quot;
comma
id|cb.ret_code
comma
id|filp-&gt;f_pos
)paren
suffix:semicolon
macro_line|#else
id|done
suffix:colon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
id|__FUNCTION__
l_string|&quot;(): Returning %i, f_pos 0x%Lx.&bslash;n&quot;
comma
id|err
comma
id|filp-&gt;f_pos
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* Copied from vfat driver. */
DECL|function|simple_getbool
r_static
r_int
id|simple_getbool
c_func
(paren
r_char
op_star
id|s
comma
r_int
op_star
id|setval
)paren
(brace
r_if
c_cond
(paren
id|s
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|s
comma
l_string|&quot;1&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|s
comma
l_string|&quot;yes&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|s
comma
l_string|&quot;true&quot;
)paren
)paren
op_star
id|setval
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|s
comma
l_string|&quot;0&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|s
comma
l_string|&quot;no&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|s
comma
l_string|&quot;false&quot;
)paren
)paren
op_star
id|setval
op_assign
l_int|0
suffix:semicolon
r_else
r_return
l_int|0
suffix:semicolon
)brace
r_else
op_star
id|setval
op_assign
l_int|1
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * This needs to be outside parse_options() otherwise a remount will reset&n; * these unintentionally.&n; */
DECL|function|init_ntfs_super_block
r_static
r_void
id|init_ntfs_super_block
c_func
(paren
id|ntfs_volume
op_star
id|vol
)paren
(brace
id|vol-&gt;uid
op_assign
id|vol-&gt;gid
op_assign
l_int|0
suffix:semicolon
id|vol-&gt;umask
op_assign
l_int|0077
suffix:semicolon
id|vol-&gt;ngt
op_assign
id|ngt_nt
suffix:semicolon
id|vol-&gt;nls_map
op_assign
(paren
r_void
op_star
)paren
op_minus
l_int|1
suffix:semicolon
id|vol-&gt;mft_zone_multiplier
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Parse the (re)mount options. */
DECL|function|parse_options
r_static
r_int
id|parse_options
c_func
(paren
id|ntfs_volume
op_star
id|vol
comma
r_char
op_star
id|opt
)paren
(brace
r_char
op_star
id|value
suffix:semicolon
multiline_comment|/* Defaults if not specified and !remount. */
id|ntfs_uid_t
id|uid
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* 0, root user only */
id|ntfs_gid_t
id|gid
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* 0, root user only */
r_int
id|umask
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* 0077, owner access only */
r_int
r_int
id|ngt
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* ngt_nt */
r_void
op_star
id|nls_map
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Try to load the default NLS. */
r_int
id|use_utf8
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* If no NLS specified and loading the default&n;&t;&t;&t;&t;   NLS failed use utf8. */
r_int
id|mft_zone_mul
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* 1 */
r_if
c_cond
(paren
op_logical_neg
id|opt
)paren
r_goto
id|done
suffix:semicolon
r_for
c_loop
(paren
id|opt
op_assign
id|strtok
c_func
(paren
id|opt
comma
l_string|&quot;,&quot;
)paren
suffix:semicolon
id|opt
suffix:semicolon
id|opt
op_assign
id|strtok
c_func
(paren
l_int|NULL
comma
l_string|&quot;,&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|value
op_assign
id|strchr
c_func
(paren
id|opt
comma
l_char|&squot;=&squot;
)paren
)paren
op_ne
l_int|NULL
)paren
op_star
id|value
op_increment
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;uid&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
op_star
id|value
)paren
r_goto
id|needs_arg
suffix:semicolon
id|uid
op_assign
id|simple_strtoul
c_func
(paren
id|value
comma
op_amp
id|value
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|value
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;NTFS: uid invalid argument&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;gid&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
op_star
id|value
)paren
r_goto
id|needs_arg
suffix:semicolon
id|gid
op_assign
id|simple_strtoul
c_func
(paren
id|value
comma
op_amp
id|value
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|value
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;NTFS: gid invalid argument&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;umask&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
op_star
id|value
)paren
r_goto
id|needs_arg
suffix:semicolon
id|umask
op_assign
id|simple_strtoul
c_func
(paren
id|value
comma
op_amp
id|value
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|value
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;NTFS: umask invalid &quot;
l_string|&quot;argument&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;mft_zone_multiplier&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_int
r_int
id|ul
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
op_star
id|value
)paren
r_goto
id|needs_arg
suffix:semicolon
id|ul
op_assign
id|simple_strtoul
c_func
(paren
id|value
comma
op_amp
id|value
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|value
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;NTFS: mft_zone_multiplier &quot;
l_string|&quot;invalid argument&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ul
op_ge
l_int|1
op_logical_and
id|ul
op_le
l_int|4
)paren
id|mft_zone_mul
op_assign
id|ul
suffix:semicolon
r_else
(brace
id|mft_zone_mul
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;NTFS: mft_zone_multiplier &quot;
l_string|&quot;out of range. Setting to 1.&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;posix&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
op_star
id|value
)paren
r_goto
id|needs_arg
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|simple_getbool
c_func
(paren
id|value
comma
op_amp
id|val
)paren
)paren
r_goto
id|needs_bool
suffix:semicolon
id|ngt
op_assign
id|val
ques
c_cond
id|ngt_posix
suffix:colon
id|ngt_nt
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;show_sys_files&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_int
id|val
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
op_star
id|value
)paren
id|val
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|simple_getbool
c_func
(paren
id|value
comma
op_amp
id|val
)paren
)paren
r_goto
id|needs_bool
suffix:semicolon
id|ngt
op_assign
id|val
ques
c_cond
id|ngt_full
suffix:colon
id|ngt_nt
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;iocharset&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
op_star
id|value
)paren
r_goto
id|needs_arg
suffix:semicolon
id|nls_map
op_assign
id|load_nls
c_func
(paren
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nls_map
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;NTFS: charset not found&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|opt
comma
l_string|&quot;utf8&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_int
id|val
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|value
op_logical_or
op_logical_neg
op_star
id|value
)paren
id|val
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|simple_getbool
c_func
(paren
id|value
comma
op_amp
id|val
)paren
)paren
r_goto
id|needs_bool
suffix:semicolon
id|use_utf8
op_assign
id|val
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;NTFS: unkown option &squot;%s&squot;&bslash;n&quot;
comma
id|opt
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|done
suffix:colon
r_if
c_cond
(paren
id|use_utf8
op_eq
op_minus
l_int|1
)paren
(brace
multiline_comment|/* utf8 was not specified at all. */
r_if
c_cond
(paren
op_logical_neg
id|nls_map
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * No NLS was specified. If first mount, load the&n;&t;&t;&t; * default NLS, otherwise don&squot;t change the NLS setting.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|vol-&gt;nls_map
op_eq
(paren
r_void
op_star
)paren
op_minus
l_int|1
)paren
id|vol-&gt;nls_map
op_assign
id|load_nls_default
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* If an NLS was already loaded, unload it first. */
r_if
c_cond
(paren
id|vol-&gt;nls_map
op_logical_and
id|vol-&gt;nls_map
op_ne
(paren
r_void
op_star
)paren
op_minus
l_int|1
)paren
id|unload_nls
c_func
(paren
id|vol-&gt;nls_map
)paren
suffix:semicolon
multiline_comment|/* Use the specified NLS. */
id|vol-&gt;nls_map
op_assign
id|nls_map
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* utf8 was specified. */
r_if
c_cond
(paren
id|use_utf8
op_logical_and
id|nls_map
)paren
(brace
id|unload_nls
c_func
(paren
id|nls_map
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;NTFS: utf8 cannot be combined with &quot;
l_string|&quot;iocharset.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* If an NLS was already loaded, unload it first. */
r_if
c_cond
(paren
id|vol-&gt;nls_map
op_logical_and
id|vol-&gt;nls_map
op_ne
(paren
r_void
op_star
)paren
op_minus
l_int|1
)paren
id|unload_nls
c_func
(paren
id|vol-&gt;nls_map
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|use_utf8
)paren
(brace
multiline_comment|/* utf8 was specified as false. */
r_if
c_cond
(paren
op_logical_neg
id|nls_map
)paren
multiline_comment|/* No NLS was specified, load the default. */
id|vol-&gt;nls_map
op_assign
id|load_nls_default
c_func
(paren
)paren
suffix:semicolon
r_else
multiline_comment|/* Use the specified NLS. */
id|vol-&gt;nls_map
op_assign
id|nls_map
suffix:semicolon
)brace
r_else
multiline_comment|/* utf8 was specified as true. */
id|vol-&gt;nls_map
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|uid
op_ne
op_minus
l_int|1
)paren
id|vol-&gt;uid
op_assign
id|uid
suffix:semicolon
r_if
c_cond
(paren
id|gid
op_ne
op_minus
l_int|1
)paren
id|vol-&gt;gid
op_assign
id|gid
suffix:semicolon
r_if
c_cond
(paren
id|umask
op_ne
op_minus
l_int|1
)paren
id|vol-&gt;umask
op_assign
(paren
id|ntmode_t
)paren
id|umask
suffix:semicolon
r_if
c_cond
(paren
id|ngt
op_ne
op_minus
l_int|1
)paren
id|vol-&gt;ngt
op_assign
id|ngt
suffix:semicolon
r_if
c_cond
(paren
id|mft_zone_mul
op_ne
op_minus
l_int|1
)paren
(brace
multiline_comment|/* mft_zone_multiplier was specified. */
r_if
c_cond
(paren
id|vol-&gt;mft_zone_multiplier
op_ne
op_minus
l_int|1
)paren
(brace
multiline_comment|/* This is a remount, ignore a change and warn user. */
r_if
c_cond
(paren
id|vol-&gt;mft_zone_multiplier
op_ne
id|mft_zone_mul
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;NTFS: Ignoring changes in &quot;
l_string|&quot;mft_zone_multiplier on &quot;
l_string|&quot;remount. If you want to &quot;
l_string|&quot;change this you need to &quot;
l_string|&quot;umount and mount again.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
multiline_comment|/* Use the specified multiplier. */
id|vol-&gt;mft_zone_multiplier
op_assign
id|mft_zone_mul
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vol-&gt;mft_zone_multiplier
op_eq
op_minus
l_int|1
)paren
multiline_comment|/* No multiplier specified and first mount, so set default. */
id|vol-&gt;mft_zone_multiplier
op_assign
l_int|1
suffix:semicolon
r_return
l_int|1
suffix:semicolon
id|needs_arg
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;NTFS: %s needs an argument&quot;
comma
id|opt
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|needs_bool
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;NTFS: %s needs boolean argument&quot;
comma
id|opt
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ntfs_lookup
r_static
r_struct
id|dentry
op_star
id|ntfs_lookup
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|d
)paren
(brace
r_struct
id|inode
op_star
id|res
op_assign
l_int|0
suffix:semicolon
r_char
op_star
id|item
op_assign
l_int|0
suffix:semicolon
id|ntfs_iterate_s
id|walk
suffix:semicolon
r_int
id|err
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_NAME1
comma
id|__FUNCTION__
l_string|&quot;(): Looking up %s in directory &quot;
l_string|&quot;ino 0x%x.&bslash;n&quot;
comma
id|d-&gt;d_name.name
comma
(paren
r_int
)paren
id|dir-&gt;i_ino
)paren
suffix:semicolon
id|walk.name
op_assign
l_int|NULL
suffix:semicolon
id|walk.namelen
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Convert to wide string. */
id|err
op_assign
id|ntfs_decodeuni
c_func
(paren
id|NTFS_INO2VOL
c_func
(paren
id|dir
)paren
comma
(paren
r_char
op_star
)paren
id|d-&gt;d_name.name
comma
id|d-&gt;d_name.len
comma
op_amp
id|walk.name
comma
op_amp
id|walk.namelen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|err_ret
suffix:semicolon
id|item
op_assign
id|ntfs_malloc
c_func
(paren
id|ITEM_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|item
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_ret
suffix:semicolon
)brace
multiline_comment|/* ntfs_getdir will place the directory entry into item, and the first&n;&t; * long long is the MFT record number. */
id|walk.type
op_assign
id|BY_NAME
suffix:semicolon
id|walk.dir
op_assign
id|NTFS_LINO2NINO
c_func
(paren
id|dir
)paren
suffix:semicolon
id|walk.result
op_assign
id|item
suffix:semicolon
r_if
c_cond
(paren
id|ntfs_getdir_byname
c_func
(paren
op_amp
id|walk
)paren
)paren
id|res
op_assign
id|iget
c_func
(paren
id|dir-&gt;i_sb
comma
id|NTFS_GETU32
c_func
(paren
id|item
)paren
)paren
suffix:semicolon
id|d_add
c_func
(paren
id|d
comma
id|res
)paren
suffix:semicolon
id|ntfs_free
c_func
(paren
id|item
)paren
suffix:semicolon
id|ntfs_free
c_func
(paren
id|walk.name
)paren
suffix:semicolon
multiline_comment|/* Always return success, the dcache will handle negative entries. */
r_return
l_int|NULL
suffix:semicolon
id|err_ret
suffix:colon
id|ntfs_free
c_func
(paren
id|walk.name
)paren
suffix:semicolon
r_return
id|ERR_PTR
c_func
(paren
id|err
)paren
suffix:semicolon
)brace
DECL|variable|ntfs_file_operations
r_static
r_struct
id|file_operations
id|ntfs_file_operations
op_assign
(brace
id|llseek
suffix:colon
id|generic_file_llseek
comma
id|read
suffix:colon
id|ntfs_read
comma
macro_line|#ifdef CONFIG_NTFS_RW
id|write
suffix:colon
id|ntfs_write
comma
macro_line|#endif
id|open
suffix:colon
id|generic_file_open
comma
)brace
suffix:semicolon
DECL|variable|ntfs_inode_operations
r_static
r_struct
id|inode_operations
id|ntfs_inode_operations
suffix:semicolon
macro_line|#ifdef CONFIG_NTFS_RW
DECL|function|ntfs_create
r_static
r_int
id|ntfs_create
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|d
comma
r_int
id|mode
)paren
(brace
r_struct
id|inode
op_star
id|r
op_assign
l_int|0
suffix:semicolon
id|ntfs_inode
op_star
id|ino
op_assign
l_int|0
suffix:semicolon
id|ntfs_volume
op_star
id|vol
suffix:semicolon
r_int
id|error
op_assign
l_int|0
suffix:semicolon
id|ntfs_attribute
op_star
id|si
suffix:semicolon
id|r
op_assign
id|new_inode
c_func
(paren
id|dir-&gt;i_sb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|r
)paren
(brace
id|error
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_create %s&bslash;n&quot;
comma
id|d-&gt;d_name.name
)paren
suffix:semicolon
id|vol
op_assign
id|NTFS_INO2VOL
c_func
(paren
id|dir
)paren
suffix:semicolon
id|ino
op_assign
id|NTFS_LINO2NINO
c_func
(paren
id|r
)paren
suffix:semicolon
id|error
op_assign
id|ntfs_alloc_file
c_func
(paren
id|NTFS_LINO2NINO
c_func
(paren
id|dir
)paren
comma
id|ino
comma
(paren
r_char
op_star
)paren
id|d-&gt;d_name.name
comma
id|d-&gt;d_name.len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
id|ntfs_error
c_func
(paren
l_string|&quot;ntfs_alloc_file FAILED: error = %i&quot;
comma
id|error
)paren
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
multiline_comment|/* Not doing this one was causing a huge amount of corruption! Now the&n;&t; * bugger bytes the dust! (-8 (AIA) */
id|r-&gt;i_ino
op_assign
id|ino-&gt;i_number
suffix:semicolon
id|error
op_assign
id|ntfs_update_inode
c_func
(paren
id|ino
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|fail
suffix:semicolon
id|error
op_assign
id|ntfs_update_inode
c_func
(paren
id|NTFS_LINO2NINO
c_func
(paren
id|dir
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|fail
suffix:semicolon
id|r-&gt;i_uid
op_assign
id|vol-&gt;uid
suffix:semicolon
id|r-&gt;i_gid
op_assign
id|vol-&gt;gid
suffix:semicolon
multiline_comment|/* FIXME: dirty? dev? */
multiline_comment|/* Get the file modification times from the standard information. */
id|si
op_assign
id|ntfs_find_attr
c_func
(paren
id|ino
comma
id|vol-&gt;at_standard_information
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|si
)paren
(brace
r_char
op_star
id|attr
op_assign
id|si-&gt;d.data
suffix:semicolon
id|r-&gt;i_atime
op_assign
id|ntfs_ntutc2unixutc
c_func
(paren
id|NTFS_GETU64
c_func
(paren
id|attr
op_plus
l_int|0x18
)paren
)paren
suffix:semicolon
id|r-&gt;i_ctime
op_assign
id|ntfs_ntutc2unixutc
c_func
(paren
id|NTFS_GETU64
c_func
(paren
id|attr
)paren
)paren
suffix:semicolon
id|r-&gt;i_mtime
op_assign
id|ntfs_ntutc2unixutc
c_func
(paren
id|NTFS_GETU64
c_func
(paren
id|attr
op_plus
l_int|8
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* It&squot;s not a directory */
id|r-&gt;i_op
op_assign
op_amp
id|ntfs_inode_operations
suffix:semicolon
id|r-&gt;i_fop
op_assign
op_amp
id|ntfs_file_operations
suffix:semicolon
id|r-&gt;i_mode
op_assign
id|S_IFREG
op_or
id|S_IRUGO
suffix:semicolon
macro_line|#ifdef CONFIG_NTFS_RW
id|r-&gt;i_mode
op_or_assign
id|S_IWUGO
suffix:semicolon
macro_line|#endif
id|r-&gt;i_mode
op_and_assign
op_complement
id|vol-&gt;umask
suffix:semicolon
id|insert_inode_hash
c_func
(paren
id|r
)paren
suffix:semicolon
id|d_instantiate
c_func
(paren
id|d
comma
id|r
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|fail
suffix:colon
r_if
c_cond
(paren
id|r
)paren
id|iput
c_func
(paren
id|r
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|_linux_ntfs_mkdir
r_static
r_int
id|_linux_ntfs_mkdir
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|d
comma
r_int
id|mode
)paren
(brace
r_int
id|error
suffix:semicolon
r_struct
id|inode
op_star
id|r
op_assign
l_int|0
suffix:semicolon
id|ntfs_volume
op_star
id|vol
suffix:semicolon
id|ntfs_inode
op_star
id|ino
suffix:semicolon
id|ntfs_attribute
op_star
id|si
suffix:semicolon
id|ntfs_debug
(paren
id|DEBUG_DIR1
comma
l_string|&quot;mkdir %s in %x&bslash;n&quot;
comma
id|d-&gt;d_name.name
comma
id|dir-&gt;i_ino
)paren
suffix:semicolon
id|error
op_assign
op_minus
id|ENAMETOOLONG
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;d_name.len
OG
multiline_comment|/* FIXME: */
l_int|255
)paren
r_goto
id|out
suffix:semicolon
id|error
op_assign
op_minus
id|EIO
suffix:semicolon
id|r
op_assign
id|new_inode
c_func
(paren
id|dir-&gt;i_sb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|r
)paren
r_goto
id|out
suffix:semicolon
id|vol
op_assign
id|NTFS_INO2VOL
c_func
(paren
id|dir
)paren
suffix:semicolon
id|ino
op_assign
id|NTFS_LINO2NINO
c_func
(paren
id|r
)paren
suffix:semicolon
id|error
op_assign
id|ntfs_mkdir
c_func
(paren
id|NTFS_LINO2NINO
c_func
(paren
id|dir
)paren
comma
id|d-&gt;d_name.name
comma
id|d-&gt;d_name.len
comma
id|ino
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Not doing this one was causing a huge amount of corruption! Now the&n;&t; * bugger bytes the dust! (-8 (AIA) */
id|r-&gt;i_ino
op_assign
id|ino-&gt;i_number
suffix:semicolon
id|r-&gt;i_uid
op_assign
id|vol-&gt;uid
suffix:semicolon
id|r-&gt;i_gid
op_assign
id|vol-&gt;gid
suffix:semicolon
id|si
op_assign
id|ntfs_find_attr
c_func
(paren
id|ino
comma
id|vol-&gt;at_standard_information
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|si
)paren
(brace
r_char
op_star
id|attr
op_assign
id|si-&gt;d.data
suffix:semicolon
id|r-&gt;i_atime
op_assign
id|ntfs_ntutc2unixutc
c_func
(paren
id|NTFS_GETU64
c_func
(paren
id|attr
op_plus
l_int|0x18
)paren
)paren
suffix:semicolon
id|r-&gt;i_ctime
op_assign
id|ntfs_ntutc2unixutc
c_func
(paren
id|NTFS_GETU64
c_func
(paren
id|attr
)paren
)paren
suffix:semicolon
id|r-&gt;i_mtime
op_assign
id|ntfs_ntutc2unixutc
c_func
(paren
id|NTFS_GETU64
c_func
(paren
id|attr
op_plus
l_int|8
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* It&squot;s a directory. */
id|r-&gt;i_op
op_assign
op_amp
id|ntfs_dir_inode_operations
suffix:semicolon
id|r-&gt;i_fop
op_assign
op_amp
id|ntfs_dir_operations
suffix:semicolon
id|r-&gt;i_mode
op_assign
id|S_IFDIR
op_or
id|S_IRUGO
op_or
id|S_IXUGO
suffix:semicolon
macro_line|#ifdef CONFIG_NTFS_RW
id|r-&gt;i_mode
op_or_assign
id|S_IWUGO
suffix:semicolon
macro_line|#endif
id|r-&gt;i_mode
op_and_assign
op_complement
id|vol-&gt;umask
suffix:semicolon
id|insert_inode_hash
c_func
(paren
id|r
)paren
suffix:semicolon
id|d_instantiate
c_func
(paren
id|d
comma
id|r
)paren
suffix:semicolon
id|error
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|ntfs_debug
(paren
id|DEBUG_DIR1
comma
l_string|&quot;mkdir returns %d&bslash;n&quot;
comma
id|error
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#endif
DECL|variable|ntfs_dir_operations
r_static
r_struct
id|file_operations
id|ntfs_dir_operations
op_assign
(brace
id|read
suffix:colon
id|generic_read_dir
comma
id|readdir
suffix:colon
id|ntfs_readdir
comma
)brace
suffix:semicolon
DECL|variable|ntfs_dir_inode_operations
r_static
r_struct
id|inode_operations
id|ntfs_dir_inode_operations
op_assign
(brace
id|lookup
suffix:colon
id|ntfs_lookup
comma
macro_line|#ifdef CONFIG_NTFS_RW
id|create
suffix:colon
id|ntfs_create
comma
id|mkdir
suffix:colon
id|_linux_ntfs_mkdir
comma
macro_line|#endif
)brace
suffix:semicolon
multiline_comment|/* ntfs_read_inode() is called by the Virtual File System (the kernel layer &n; * that deals with filesystems) when iget is called requesting an inode not&n; * already present in the inode table. Typically filesystems have separate&n; * inode_operations for directories, files and symlinks. */
DECL|function|ntfs_read_inode
r_static
r_void
id|ntfs_read_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
id|ntfs_volume
op_star
id|vol
suffix:semicolon
id|ntfs_inode
op_star
id|ino
suffix:semicolon
id|ntfs_attribute
op_star
id|data
suffix:semicolon
id|ntfs_attribute
op_star
id|si
suffix:semicolon
id|vol
op_assign
id|NTFS_INO2VOL
c_func
(paren
id|inode
)paren
suffix:semicolon
id|inode-&gt;i_mode
op_assign
l_int|0
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_read_inode 0x%lx&bslash;n&quot;
comma
id|inode-&gt;i_ino
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|inode-&gt;i_ino
)paren
(brace
multiline_comment|/* Those are loaded special files. */
r_case
id|FILE_Mft
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|vol-&gt;mft_ino
op_logical_or
(paren
(paren
id|vol-&gt;ino_flags
op_amp
l_int|1
)paren
op_eq
l_int|0
)paren
)paren
r_goto
id|sys_file_error
suffix:semicolon
id|ntfs_memcpy
c_func
(paren
op_amp
id|inode-&gt;u.ntfs_i
comma
id|vol-&gt;mft_ino
comma
r_sizeof
(paren
id|ntfs_inode
)paren
)paren
suffix:semicolon
id|ino
op_assign
id|vol-&gt;mft_ino
suffix:semicolon
id|vol-&gt;mft_ino
op_assign
op_amp
id|inode-&gt;u.ntfs_i
suffix:semicolon
id|vol-&gt;ino_flags
op_and_assign
op_complement
l_int|1
suffix:semicolon
id|ntfs_free
c_func
(paren
id|ino
)paren
suffix:semicolon
id|ino
op_assign
id|vol-&gt;mft_ino
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;Opening $MFT!&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FILE_MftMirr
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|vol-&gt;mftmirr
op_logical_or
(paren
(paren
id|vol-&gt;ino_flags
op_amp
l_int|2
)paren
op_eq
l_int|0
)paren
)paren
r_goto
id|sys_file_error
suffix:semicolon
id|ntfs_memcpy
c_func
(paren
op_amp
id|inode-&gt;u.ntfs_i
comma
id|vol-&gt;mftmirr
comma
r_sizeof
(paren
id|ntfs_inode
)paren
)paren
suffix:semicolon
id|ino
op_assign
id|vol-&gt;mftmirr
suffix:semicolon
id|vol-&gt;mftmirr
op_assign
op_amp
id|inode-&gt;u.ntfs_i
suffix:semicolon
id|vol-&gt;ino_flags
op_and_assign
op_complement
l_int|2
suffix:semicolon
id|ntfs_free
c_func
(paren
id|ino
)paren
suffix:semicolon
id|ino
op_assign
id|vol-&gt;mftmirr
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;Opening $MFTMirr!&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FILE_BitMap
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|vol-&gt;bitmap
op_logical_or
(paren
(paren
id|vol-&gt;ino_flags
op_amp
l_int|4
)paren
op_eq
l_int|0
)paren
)paren
r_goto
id|sys_file_error
suffix:semicolon
id|ntfs_memcpy
c_func
(paren
op_amp
id|inode-&gt;u.ntfs_i
comma
id|vol-&gt;bitmap
comma
r_sizeof
(paren
id|ntfs_inode
)paren
)paren
suffix:semicolon
id|ino
op_assign
id|vol-&gt;bitmap
suffix:semicolon
id|vol-&gt;bitmap
op_assign
op_amp
id|inode-&gt;u.ntfs_i
suffix:semicolon
id|vol-&gt;ino_flags
op_and_assign
op_complement
l_int|4
suffix:semicolon
id|ntfs_free
c_func
(paren
id|ino
)paren
suffix:semicolon
id|ino
op_assign
id|vol-&gt;bitmap
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;Opening $Bitmap!&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FILE_LogFile
dot
dot
dot
id|FILE_AttrDef
suffix:colon
multiline_comment|/* No need to log root directory accesses. */
r_case
id|FILE_Boot
dot
dot
dot
id|FILE_UpCase
suffix:colon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;Opening system file %i!&bslash;n&quot;
comma
id|inode-&gt;i_ino
)paren
suffix:semicolon
r_default
suffix:colon
id|ino
op_assign
op_amp
id|inode-&gt;u.ntfs_i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ino
op_logical_or
id|ntfs_init_inode
c_func
(paren
id|ino
comma
id|NTFS_INO2VOL
c_func
(paren
id|inode
)paren
comma
id|inode-&gt;i_ino
)paren
)paren
(brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;NTFS: Error loading inode &quot;
l_string|&quot;0x%x&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|inode-&gt;i_ino
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
multiline_comment|/* Set uid/gid from mount options */
id|inode-&gt;i_uid
op_assign
id|vol-&gt;uid
suffix:semicolon
id|inode-&gt;i_gid
op_assign
id|vol-&gt;gid
suffix:semicolon
id|inode-&gt;i_nlink
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Use the size of the data attribute as file size */
id|data
op_assign
id|ntfs_find_attr
c_func
(paren
id|ino
comma
id|vol-&gt;at_data
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data
)paren
id|inode-&gt;i_size
op_assign
l_int|0
suffix:semicolon
r_else
id|inode-&gt;i_size
op_assign
id|data-&gt;size
suffix:semicolon
multiline_comment|/* Get the file modification times from the standard information. */
id|si
op_assign
id|ntfs_find_attr
c_func
(paren
id|ino
comma
id|vol-&gt;at_standard_information
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|si
)paren
(brace
r_char
op_star
id|attr
op_assign
id|si-&gt;d.data
suffix:semicolon
id|inode-&gt;i_atime
op_assign
id|ntfs_ntutc2unixutc
c_func
(paren
id|NTFS_GETU64
c_func
(paren
id|attr
op_plus
l_int|0x18
)paren
)paren
suffix:semicolon
id|inode-&gt;i_ctime
op_assign
id|ntfs_ntutc2unixutc
c_func
(paren
id|NTFS_GETU64
c_func
(paren
id|attr
)paren
)paren
suffix:semicolon
id|inode-&gt;i_mtime
op_assign
id|ntfs_ntutc2unixutc
c_func
(paren
id|NTFS_GETU64
c_func
(paren
id|attr
op_plus
l_int|8
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* If it has an index root, it&squot;s a directory. */
r_if
c_cond
(paren
id|ntfs_find_attr
c_func
(paren
id|ino
comma
id|vol-&gt;at_index_root
comma
l_string|&quot;$I30&quot;
)paren
)paren
(brace
id|ntfs_attribute
op_star
id|at
suffix:semicolon
id|at
op_assign
id|ntfs_find_attr
c_func
(paren
id|ino
comma
id|vol-&gt;at_index_allocation
comma
l_string|&quot;$I30&quot;
)paren
suffix:semicolon
id|inode-&gt;i_size
op_assign
id|at
ques
c_cond
id|at-&gt;size
suffix:colon
l_int|0
suffix:semicolon
id|inode-&gt;i_op
op_assign
op_amp
id|ntfs_dir_inode_operations
suffix:semicolon
id|inode-&gt;i_fop
op_assign
op_amp
id|ntfs_dir_operations
suffix:semicolon
id|inode-&gt;i_mode
op_assign
id|S_IFDIR
op_or
id|S_IRUGO
op_or
id|S_IXUGO
suffix:semicolon
)brace
r_else
(brace
id|inode-&gt;i_op
op_assign
op_amp
id|ntfs_inode_operations
suffix:semicolon
id|inode-&gt;i_fop
op_assign
op_amp
id|ntfs_file_operations
suffix:semicolon
id|inode-&gt;i_mode
op_assign
id|S_IFREG
op_or
id|S_IRUGO
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_NTFS_RW
r_if
c_cond
(paren
op_logical_neg
id|data
op_logical_or
op_logical_neg
(paren
id|data-&gt;flags
op_amp
(paren
id|ATTR_IS_COMPRESSED
op_or
id|ATTR_IS_ENCRYPTED
)paren
)paren
)paren
id|inode-&gt;i_mode
op_or_assign
id|S_IWUGO
suffix:semicolon
macro_line|#endif
id|inode-&gt;i_mode
op_and_assign
op_complement
id|vol-&gt;umask
suffix:semicolon
r_return
suffix:semicolon
id|sys_file_error
suffix:colon
id|ntfs_error
c_func
(paren
l_string|&quot;Critical error. Tried to call ntfs_read_inode() before we &quot;
l_string|&quot;have completed read_super() or VFS error.&bslash;n&quot;
)paren
suffix:semicolon
singleline_comment|// FIXME: Should we panic() at this stage?
)brace
macro_line|#ifdef CONFIG_NTFS_RW
DECL|function|ntfs_write_inode
r_static
r_void
id|ntfs_write_inode
c_func
(paren
r_struct
id|inode
op_star
id|ino
comma
r_int
id|unused
)paren
(brace
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_LINUX
comma
l_string|&quot;ntfs_write_inode 0x%x&bslash;n&quot;
comma
id|ino-&gt;i_ino
)paren
suffix:semicolon
id|ntfs_update_inode
c_func
(paren
id|NTFS_LINO2NINO
c_func
(paren
id|ino
)paren
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|_ntfs_clear_inode
r_static
r_void
id|_ntfs_clear_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
id|ntfs_inode
op_star
id|ino
suffix:semicolon
id|ntfs_volume
op_star
id|vol
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;_ntfs_clear_inode 0x%x&bslash;n&quot;
comma
id|inode-&gt;i_ino
)paren
suffix:semicolon
id|vol
op_assign
id|NTFS_INO2VOL
c_func
(paren
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vol
)paren
id|ntfs_error
c_func
(paren
l_string|&quot;_ntfs_clear_inode: vol = NTFS_INO2VOL(inode) is &quot;
l_string|&quot;NULL.&bslash;n&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|inode-&gt;i_ino
)paren
(brace
r_case
id|FILE_Mft
suffix:colon
r_if
c_cond
(paren
id|vol-&gt;mft_ino
op_logical_and
(paren
(paren
id|vol-&gt;ino_flags
op_amp
l_int|1
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|ino
op_assign
(paren
id|ntfs_inode
op_star
)paren
id|ntfs_malloc
c_func
(paren
r_sizeof
(paren
id|ntfs_inode
)paren
)paren
suffix:semicolon
id|ntfs_memcpy
c_func
(paren
id|ino
comma
op_amp
id|inode-&gt;u.ntfs_i
comma
r_sizeof
(paren
id|ntfs_inode
)paren
)paren
suffix:semicolon
id|vol-&gt;mft_ino
op_assign
id|ino
suffix:semicolon
id|vol-&gt;ino_flags
op_or_assign
l_int|1
suffix:semicolon
r_goto
id|unl_out
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|FILE_MftMirr
suffix:colon
r_if
c_cond
(paren
id|vol-&gt;mftmirr
op_logical_and
(paren
(paren
id|vol-&gt;ino_flags
op_amp
l_int|2
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|ino
op_assign
(paren
id|ntfs_inode
op_star
)paren
id|ntfs_malloc
c_func
(paren
r_sizeof
(paren
id|ntfs_inode
)paren
)paren
suffix:semicolon
id|ntfs_memcpy
c_func
(paren
id|ino
comma
op_amp
id|inode-&gt;u.ntfs_i
comma
r_sizeof
(paren
id|ntfs_inode
)paren
)paren
suffix:semicolon
id|vol-&gt;mftmirr
op_assign
id|ino
suffix:semicolon
id|vol-&gt;ino_flags
op_or_assign
l_int|2
suffix:semicolon
r_goto
id|unl_out
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|FILE_BitMap
suffix:colon
r_if
c_cond
(paren
id|vol-&gt;bitmap
op_logical_and
(paren
(paren
id|vol-&gt;ino_flags
op_amp
l_int|4
)paren
op_eq
l_int|0
)paren
)paren
(brace
id|ino
op_assign
(paren
id|ntfs_inode
op_star
)paren
id|ntfs_malloc
c_func
(paren
r_sizeof
(paren
id|ntfs_inode
)paren
)paren
suffix:semicolon
id|ntfs_memcpy
c_func
(paren
id|ino
comma
op_amp
id|inode-&gt;u.ntfs_i
comma
r_sizeof
(paren
id|ntfs_inode
)paren
)paren
suffix:semicolon
id|vol-&gt;bitmap
op_assign
id|ino
suffix:semicolon
id|vol-&gt;ino_flags
op_or_assign
l_int|4
suffix:semicolon
r_goto
id|unl_out
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
multiline_comment|/* Nothing. Just clear the inode and exit. */
)brace
id|ntfs_clear_inode
c_func
(paren
op_amp
id|inode-&gt;u.ntfs_i
)paren
suffix:semicolon
id|unl_out
suffix:colon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Called when umounting a filesystem by do_umount() in fs/super.c. */
DECL|function|ntfs_put_super
r_static
r_void
id|ntfs_put_super
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
id|ntfs_volume
op_star
id|vol
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_put_super&bslash;n&quot;
)paren
suffix:semicolon
id|vol
op_assign
id|NTFS_SB2VOL
c_func
(paren
id|sb
)paren
suffix:semicolon
id|ntfs_release_volume
c_func
(paren
id|vol
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vol-&gt;nls_map
)paren
id|unload_nls
c_func
(paren
id|vol-&gt;nls_map
)paren
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_put_super: done&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* Called by the kernel when asking for stats. */
DECL|function|ntfs_statfs
r_static
r_int
id|ntfs_statfs
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|statfs
op_star
id|sf
)paren
(brace
r_struct
id|inode
op_star
id|mft
suffix:semicolon
id|ntfs_volume
op_star
id|vol
suffix:semicolon
id|__s64
id|size
suffix:semicolon
r_int
id|error
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_statfs&bslash;n&quot;
)paren
suffix:semicolon
id|vol
op_assign
id|NTFS_SB2VOL
c_func
(paren
id|sb
)paren
suffix:semicolon
id|sf-&gt;f_type
op_assign
id|NTFS_SUPER_MAGIC
suffix:semicolon
id|sf-&gt;f_bsize
op_assign
id|vol-&gt;cluster_size
suffix:semicolon
id|error
op_assign
id|ntfs_get_volumesize
c_func
(paren
id|NTFS_SB2VOL
c_func
(paren
id|sb
)paren
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
id|sf-&gt;f_blocks
op_assign
id|size
suffix:semicolon
multiline_comment|/* Volumesize is in clusters. */
id|size
op_assign
(paren
id|__s64
)paren
id|ntfs_get_free_cluster_count
c_func
(paren
id|vol-&gt;bitmap
)paren
suffix:semicolon
multiline_comment|/* Just say zero if the call failed. */
r_if
c_cond
(paren
id|size
OL
l_int|0LL
)paren
id|size
op_assign
l_int|0
suffix:semicolon
id|sf-&gt;f_bfree
op_assign
id|sf-&gt;f_bavail
op_assign
id|size
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_statfs: calling mft = iget(sb, &quot;
l_string|&quot;FILE_Mft)&bslash;n&quot;
)paren
suffix:semicolon
id|mft
op_assign
id|iget
c_func
(paren
id|sb
comma
id|FILE_Mft
)paren
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_statfs: iget(sb, FILE_Mft) returned &quot;
l_string|&quot;0x%x&bslash;n&quot;
comma
id|mft
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mft
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|sf-&gt;f_files
op_assign
id|mft-&gt;i_size
op_rshift
id|vol-&gt;mft_record_size_bits
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_statfs: calling iput(mft)&bslash;n&quot;
)paren
suffix:semicolon
id|iput
c_func
(paren
id|mft
)paren
suffix:semicolon
multiline_comment|/* Should be read from volume. */
id|sf-&gt;f_namelen
op_assign
l_int|255
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Called when remounting a filesystem by do_remount_sb() in fs/super.c. */
DECL|function|ntfs_remount_fs
r_static
r_int
id|ntfs_remount_fs
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_int
op_star
id|flags
comma
r_char
op_star
id|options
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|parse_options
c_func
(paren
id|NTFS_SB2VOL
c_func
(paren
id|sb
)paren
comma
id|options
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Define the super block operation that are implemented */
DECL|variable|ntfs_super_operations
r_static
r_struct
id|super_operations
id|ntfs_super_operations
op_assign
(brace
id|read_inode
suffix:colon
id|ntfs_read_inode
comma
macro_line|#ifdef CONFIG_NTFS_RW
id|write_inode
suffix:colon
id|ntfs_write_inode
comma
macro_line|#endif
id|put_super
suffix:colon
id|ntfs_put_super
comma
id|statfs
suffix:colon
id|ntfs_statfs
comma
id|remount_fs
suffix:colon
id|ntfs_remount_fs
comma
id|clear_inode
suffix:colon
id|_ntfs_clear_inode
comma
)brace
suffix:semicolon
multiline_comment|/**&n; * is_boot_sector_ntfs - check an NTFS boot sector for validity&n; * @b:&t;&t;buffer containing bootsector to check&n; * &n; * Check whether @b contains a valid NTFS boot sector.&n; * Return 1 if @b is a valid NTFS bootsector or 0 if not.&n; */
DECL|function|is_boot_sector_ntfs
r_static
r_int
id|is_boot_sector_ntfs
c_func
(paren
id|ntfs_u8
op_star
id|b
)paren
(brace
id|ntfs_u32
id|i
suffix:semicolon
multiline_comment|/* FIXME: We don&squot;t use checksumming yet as NT4(SP6a) doesn&squot;t either...&n;&t; * But we might as well have the code ready to do it. (AIA) */
macro_line|#if 0
multiline_comment|/* Calculate the checksum. */
r_if
c_cond
(paren
id|b
OL
id|b
op_plus
l_int|0x50
)paren
(brace
id|ntfs_u32
op_star
id|u
suffix:semicolon
id|ntfs_u32
op_star
id|bi
op_assign
(paren
id|ntfs_u32
op_star
)paren
(paren
id|b
op_plus
l_int|0x50
)paren
suffix:semicolon
r_for
c_loop
(paren
id|u
op_assign
id|bi
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|u
OL
id|bi
suffix:semicolon
op_increment
id|u
)paren
id|i
op_add_assign
id|NTFS_GETU32
c_func
(paren
op_star
id|u
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Check magic is &quot;NTFS    &quot; */
r_if
c_cond
(paren
id|b
(braket
l_int|3
)braket
op_ne
l_int|0x4e
)paren
r_goto
id|not_ntfs
suffix:semicolon
r_if
c_cond
(paren
id|b
(braket
l_int|4
)braket
op_ne
l_int|0x54
)paren
r_goto
id|not_ntfs
suffix:semicolon
r_if
c_cond
(paren
id|b
(braket
l_int|5
)braket
op_ne
l_int|0x46
)paren
r_goto
id|not_ntfs
suffix:semicolon
r_if
c_cond
(paren
id|b
(braket
l_int|6
)braket
op_ne
l_int|0x53
)paren
r_goto
id|not_ntfs
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|7
suffix:semicolon
id|i
OL
l_int|0xb
suffix:semicolon
op_increment
id|i
)paren
r_if
c_cond
(paren
id|b
(braket
id|i
)braket
op_ne
l_int|0x20
)paren
r_goto
id|not_ntfs
suffix:semicolon
multiline_comment|/* Check bytes per sector value is between 512 and 4096. */
r_if
c_cond
(paren
id|b
(braket
l_int|0xb
)braket
op_ne
l_int|0
)paren
r_goto
id|not_ntfs
suffix:semicolon
r_if
c_cond
(paren
id|b
(braket
l_int|0xc
)braket
OG
l_int|0x10
)paren
r_goto
id|not_ntfs
suffix:semicolon
multiline_comment|/* Check sectors per cluster value is valid. */
r_switch
c_cond
(paren
id|b
(braket
l_int|0xd
)braket
)paren
(brace
r_case
l_int|1
suffix:colon
r_case
l_int|2
suffix:colon
r_case
l_int|4
suffix:colon
r_case
l_int|8
suffix:colon
r_case
l_int|16
suffix:colon
r_case
l_int|32
suffix:colon
r_case
l_int|64
suffix:colon
r_case
l_int|128
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|not_ntfs
suffix:semicolon
)brace
multiline_comment|/* Check reserved sectors value and four other fields are zero. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0xe
suffix:semicolon
id|i
OL
l_int|0x15
suffix:semicolon
op_increment
id|i
)paren
r_if
c_cond
(paren
id|b
(braket
id|i
)braket
op_ne
l_int|0
)paren
r_goto
id|not_ntfs
suffix:semicolon
r_if
c_cond
(paren
id|b
(braket
l_int|0x16
)braket
op_ne
l_int|0
)paren
r_goto
id|not_ntfs
suffix:semicolon
r_if
c_cond
(paren
id|b
(braket
l_int|0x17
)braket
op_ne
l_int|0
)paren
r_goto
id|not_ntfs
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0x20
suffix:semicolon
id|i
OL
l_int|0x24
suffix:semicolon
op_increment
id|i
)paren
r_if
c_cond
(paren
id|b
(braket
id|i
)braket
op_ne
l_int|0
)paren
r_goto
id|not_ntfs
suffix:semicolon
multiline_comment|/* Check clusters per file record segment value is valid. */
r_if
c_cond
(paren
id|b
(braket
l_int|0x40
)braket
template_param
l_int|0xf7
)paren
(brace
r_switch
c_cond
(paren
id|b
(braket
l_int|0x40
)braket
)paren
(brace
r_case
l_int|1
suffix:colon
r_case
l_int|2
suffix:colon
r_case
l_int|4
suffix:colon
r_case
l_int|8
suffix:colon
r_case
l_int|16
suffix:colon
r_case
l_int|32
suffix:colon
r_case
l_int|64
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|not_ntfs
suffix:semicolon
)brace
)brace
multiline_comment|/* Check clusters per index block value is valid. */
r_if
c_cond
(paren
id|b
(braket
l_int|0x44
)braket
template_param
l_int|0xf7
)paren
(brace
r_switch
c_cond
(paren
id|b
(braket
l_int|0x44
)braket
)paren
(brace
r_case
l_int|1
suffix:colon
r_case
l_int|2
suffix:colon
r_case
l_int|4
suffix:colon
r_case
l_int|8
suffix:colon
r_case
l_int|16
suffix:colon
r_case
l_int|32
suffix:colon
r_case
l_int|64
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_goto
id|not_ntfs
suffix:semicolon
)brace
)brace
r_return
l_int|1
suffix:semicolon
id|not_ntfs
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Called to mount a filesystem by read_super() in fs/super.c.&n; * Return a super block, the main structure of a filesystem.&n; *&n; * NOTE : Don&squot;t store a pointer to an option, as the page containing the&n; * options is freed after ntfs_read_super() returns.&n; *&n; * NOTE : A context switch can happen in kernel code only if the code blocks&n; * (= calls schedule() in kernel/sched.c). */
DECL|function|ntfs_read_super
r_struct
id|super_block
op_star
id|ntfs_read_super
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_void
op_star
id|options
comma
r_int
id|silent
)paren
(brace
id|ntfs_volume
op_star
id|vol
suffix:semicolon
r_struct
id|buffer_head
op_star
id|bh
suffix:semicolon
r_int
id|i
comma
id|to_read
comma
id|blocksize
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;ntfs_read_super&bslash;n&quot;
)paren
suffix:semicolon
id|vol
op_assign
id|NTFS_SB2VOL
c_func
(paren
id|sb
)paren
suffix:semicolon
id|init_ntfs_super_block
c_func
(paren
id|vol
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|parse_options
c_func
(paren
id|vol
comma
(paren
r_char
op_star
)paren
id|options
)paren
)paren
r_goto
id|ntfs_read_super_vol
suffix:semicolon
id|blocksize
op_assign
id|get_hardsect_size
c_func
(paren
id|sb-&gt;s_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|blocksize
OL
l_int|512
)paren
id|blocksize
op_assign
l_int|512
suffix:semicolon
r_if
c_cond
(paren
id|set_blocksize
c_func
(paren
id|sb-&gt;s_dev
comma
id|blocksize
)paren
OL
l_int|0
)paren
(brace
id|ntfs_error
c_func
(paren
l_string|&quot;Unable to set blocksize %d.&bslash;n&quot;
comma
id|blocksize
)paren
suffix:semicolon
r_goto
id|ntfs_read_super_vol
suffix:semicolon
)brace
multiline_comment|/* Read the super block (boot block). */
r_if
c_cond
(paren
op_logical_neg
(paren
id|bh
op_assign
id|bread
c_func
(paren
id|sb-&gt;s_dev
comma
l_int|0
comma
id|blocksize
)paren
)paren
)paren
(brace
id|ntfs_error
c_func
(paren
l_string|&quot;Reading super block failed&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|ntfs_read_super_unl
suffix:semicolon
)brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;Done reading boot block&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Check for valid &squot;NTFS&squot; boot sector. */
r_if
c_cond
(paren
op_logical_neg
id|is_boot_sector_ntfs
c_func
(paren
id|bh-&gt;b_data
)paren
)paren
(brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;Not a NTFS volume&bslash;n&quot;
)paren
suffix:semicolon
id|bforget
c_func
(paren
id|bh
)paren
suffix:semicolon
r_goto
id|ntfs_read_super_unl
suffix:semicolon
)brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;Going to init volume&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ntfs_init_volume
c_func
(paren
id|vol
comma
id|bh-&gt;b_data
)paren
OL
l_int|0
)paren
(brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;Init volume failed.&bslash;n&quot;
)paren
suffix:semicolon
id|bforget
c_func
(paren
id|bh
)paren
suffix:semicolon
r_goto
id|ntfs_read_super_unl
suffix:semicolon
)brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;$Mft at cluster 0x%lx&bslash;n&quot;
comma
id|vol-&gt;mft_lcn
)paren
suffix:semicolon
id|brelse
c_func
(paren
id|bh
)paren
suffix:semicolon
id|NTFS_SB
c_func
(paren
id|vol
)paren
op_assign
id|sb
suffix:semicolon
r_if
c_cond
(paren
id|vol-&gt;cluster_size
OG
id|PAGE_SIZE
)paren
(brace
id|ntfs_error
c_func
(paren
l_string|&quot;Partition cluster size is not supported yet (it &quot;
l_string|&quot;is &gt; max kernel blocksize).&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|ntfs_read_super_unl
suffix:semicolon
)brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;Done to init volume&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Inform the kernel that a device block is a NTFS cluster. */
id|sb-&gt;s_blocksize
op_assign
id|vol-&gt;cluster_size
suffix:semicolon
id|sb-&gt;s_blocksize_bits
op_assign
id|vol-&gt;cluster_size_bits
suffix:semicolon
r_if
c_cond
(paren
id|blocksize
op_ne
id|vol-&gt;cluster_size
op_logical_and
id|set_blocksize
c_func
(paren
id|sb-&gt;s_dev
comma
id|sb-&gt;s_blocksize
)paren
OL
l_int|0
)paren
(brace
id|ntfs_error
c_func
(paren
l_string|&quot;Cluster size too small for device.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|ntfs_read_super_unl
suffix:semicolon
)brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;set_blocksize&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Allocate an MFT record (MFT record can be smaller than a cluster). */
id|i
op_assign
id|vol-&gt;cluster_size
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|vol-&gt;mft_record_size
)paren
id|i
op_assign
id|vol-&gt;mft_record_size
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|vol-&gt;mft
op_assign
id|ntfs_malloc
c_func
(paren
id|i
)paren
)paren
)paren
r_goto
id|ntfs_read_super_unl
suffix:semicolon
multiline_comment|/* Read at least the MFT record for $Mft. */
id|to_read
op_assign
id|vol-&gt;mft_clusters_per_record
suffix:semicolon
r_if
c_cond
(paren
id|to_read
OL
l_int|1
)paren
id|to_read
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|to_read
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bh
op_assign
id|bread
c_func
(paren
id|sb-&gt;s_dev
comma
id|vol-&gt;mft_lcn
op_plus
id|i
comma
id|vol-&gt;cluster_size
)paren
)paren
)paren
(brace
id|ntfs_error
c_func
(paren
l_string|&quot;Could not read $Mft record 0&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|ntfs_read_super_mft
suffix:semicolon
)brace
id|ntfs_memcpy
c_func
(paren
id|vol-&gt;mft
op_plus
(paren
(paren
id|__s64
)paren
id|i
op_lshift
id|vol-&gt;cluster_size_bits
)paren
comma
id|bh-&gt;b_data
comma
id|vol-&gt;cluster_size
)paren
suffix:semicolon
id|brelse
c_func
(paren
id|bh
)paren
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;Read cluster 0x%x&bslash;n&quot;
comma
id|vol-&gt;mft_lcn
op_plus
id|i
)paren
suffix:semicolon
)brace
multiline_comment|/* Check and fixup this MFT record */
r_if
c_cond
(paren
op_logical_neg
id|ntfs_check_mft_record
c_func
(paren
id|vol
comma
id|vol-&gt;mft
)paren
)paren
(brace
id|ntfs_error
c_func
(paren
l_string|&quot;Invalid $Mft record 0&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|ntfs_read_super_mft
suffix:semicolon
)brace
multiline_comment|/* Inform the kernel about which super operations are available. */
id|sb-&gt;s_op
op_assign
op_amp
id|ntfs_super_operations
suffix:semicolon
id|sb-&gt;s_magic
op_assign
id|NTFS_SUPER_MAGIC
suffix:semicolon
id|sb-&gt;s_maxbytes
op_assign
op_complement
l_int|0ULL
op_rshift
l_int|1
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;Reading special files&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ntfs_load_special_files
c_func
(paren
id|vol
)paren
)paren
(brace
id|ntfs_error
c_func
(paren
l_string|&quot;Error loading special files&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|ntfs_read_super_mft
suffix:semicolon
)brace
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;Getting RootDir&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Get the root directory. */
r_if
c_cond
(paren
op_logical_neg
(paren
id|sb-&gt;s_root
op_assign
id|d_alloc_root
c_func
(paren
id|iget
c_func
(paren
id|sb
comma
id|FILE_root
)paren
)paren
)paren
)paren
(brace
id|ntfs_error
c_func
(paren
l_string|&quot;Could not get root dir inode&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|ntfs_read_super_mft
suffix:semicolon
)brace
id|ntfs_read_super_ret
suffix:colon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;read_super: done&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|sb
suffix:semicolon
id|ntfs_read_super_mft
suffix:colon
id|ntfs_free
c_func
(paren
id|vol-&gt;mft
)paren
suffix:semicolon
id|ntfs_read_super_unl
suffix:colon
id|ntfs_read_super_vol
suffix:colon
id|sb
op_assign
l_int|NULL
suffix:semicolon
r_goto
id|ntfs_read_super_ret
suffix:semicolon
)brace
multiline_comment|/* Define the filesystem */
r_static
id|DECLARE_FSTYPE_DEV
c_func
(paren
id|ntfs_fs_type
comma
l_string|&quot;ntfs&quot;
comma
id|ntfs_read_super
)paren
suffix:semicolon
DECL|function|init_ntfs_fs
r_static
r_int
id|__init
id|init_ntfs_fs
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Comment this if you trust klogd. There are reasons not to trust it */
macro_line|#if defined(DEBUG) &amp;&amp; !defined(MODULE)
id|console_verbose
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;NTFS driver v&quot;
id|NTFS_VERSION
l_string|&quot; [Flags: R/&quot;
macro_line|#ifdef CONFIG_NTFS_RW
l_string|&quot;W&quot;
macro_line|#else
l_string|&quot;O&quot;
macro_line|#endif
macro_line|#ifdef DEBUG
l_string|&quot; DEBUG&quot;
macro_line|#endif
macro_line|#ifdef MODULE
l_string|&quot; MODULE&quot;
macro_line|#endif
l_string|&quot;]&bslash;n&quot;
)paren
suffix:semicolon
id|SYSCTL
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;registering %s&bslash;n&quot;
comma
id|ntfs_fs_type.name
)paren
suffix:semicolon
multiline_comment|/* Add this filesystem to the kernel table of filesystems. */
r_return
id|register_filesystem
c_func
(paren
op_amp
id|ntfs_fs_type
)paren
suffix:semicolon
)brace
DECL|function|exit_ntfs_fs
r_static
r_void
id|__exit
id|exit_ntfs_fs
c_func
(paren
r_void
)paren
(brace
id|SYSCTL
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|ntfs_debug
c_func
(paren
id|DEBUG_OTHER
comma
l_string|&quot;unregistering %s&bslash;n&quot;
comma
id|ntfs_fs_type.name
)paren
suffix:semicolon
id|unregister_filesystem
c_func
(paren
op_amp
id|ntfs_fs_type
)paren
suffix:semicolon
)brace
id|EXPORT_NO_SYMBOLS
suffix:semicolon
multiline_comment|/*&n; * Not strictly true. The driver was written originally by Martin von L&#xfffd;wis.&n; * I am just maintaining and rewriting it.&n; */
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Anton Altaparmakov &lt;aia21@cus.cam.ac.uk&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Linux NTFS driver&quot;
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
id|MODULE_PARM
c_func
(paren
id|ntdebug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|ntdebug
comma
l_string|&quot;Debug level&quot;
)paren
suffix:semicolon
macro_line|#endif
id|module_init
c_func
(paren
id|init_ntfs_fs
)paren
id|module_exit
c_func
(paren
id|exit_ntfs_fs
)paren
eof
