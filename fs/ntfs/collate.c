multiline_comment|/*&n; * collate.c - NTFS kernel collation handling.  Part of the Linux-NTFS project.&n; *&n; * Copyright (c) 2004 Anton Altaparmakov&n; *&n; * This program/include file is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License as published&n; * by the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * This program/include file is distributed in the hope that it will be&n; * useful, but WITHOUT ANY WARRANTY; without even the implied warranty&n; * of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program (in the main directory of the Linux-NTFS&n; * distribution in the file COPYING); if not, write to the Free Software&n; * Foundation,Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; */
macro_line|#include &quot;ntfs.h&quot;
macro_line|#include &quot;collate.h&quot;
DECL|function|ntfs_collate_binary
r_static
r_int
id|ntfs_collate_binary
c_func
(paren
id|ntfs_volume
op_star
id|vol
comma
r_const
r_void
op_star
id|data1
comma
r_const
r_int
id|data1_len
comma
r_const
r_void
op_star
id|data2
comma
r_const
r_int
id|data2_len
)paren
(brace
r_int
id|rc
suffix:semicolon
id|ntfs_debug
c_func
(paren
l_string|&quot;Entering.&quot;
)paren
suffix:semicolon
id|rc
op_assign
id|memcmp
c_func
(paren
id|data1
comma
id|data2
comma
id|min
c_func
(paren
id|data1_len
comma
id|data2_len
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
op_logical_and
(paren
id|data1_len
op_ne
id|data2_len
)paren
)paren
(brace
r_if
c_cond
(paren
id|data1_len
OL
id|data2_len
)paren
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
r_else
id|rc
op_assign
l_int|1
suffix:semicolon
)brace
id|ntfs_debug
c_func
(paren
l_string|&quot;Done, returning %i&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|ntfs_collate_ntofs_ulong
r_static
r_int
id|ntfs_collate_ntofs_ulong
c_func
(paren
id|ntfs_volume
op_star
id|vol
comma
r_const
r_void
op_star
id|data1
comma
r_const
r_int
id|data1_len
comma
r_const
r_void
op_star
id|data2
comma
r_const
r_int
id|data2_len
)paren
(brace
r_int
id|rc
suffix:semicolon
id|u32
id|d1
comma
id|d2
suffix:semicolon
id|ntfs_debug
c_func
(paren
l_string|&quot;Entering.&quot;
)paren
suffix:semicolon
singleline_comment|// FIXME:  We don&squot;t really want to bug here.
id|BUG_ON
c_func
(paren
id|data1_len
op_ne
id|data2_len
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|data1_len
op_ne
l_int|4
)paren
suffix:semicolon
id|d1
op_assign
id|le32_to_cpup
c_func
(paren
id|data1
)paren
suffix:semicolon
id|d2
op_assign
id|le32_to_cpup
c_func
(paren
id|data2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d1
OL
id|d2
)paren
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|d1
op_eq
id|d2
)paren
id|rc
op_assign
l_int|0
suffix:semicolon
r_else
id|rc
op_assign
l_int|1
suffix:semicolon
)brace
id|ntfs_debug
c_func
(paren
l_string|&quot;Done, returning %i&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|typedef|ntfs_collate_func_t
r_typedef
r_int
(paren
op_star
id|ntfs_collate_func_t
)paren
(paren
id|ntfs_volume
op_star
comma
r_const
r_void
op_star
comma
r_const
r_int
comma
r_const
r_void
op_star
comma
r_const
r_int
)paren
suffix:semicolon
DECL|variable|ntfs_do_collate0x0
r_static
id|ntfs_collate_func_t
id|ntfs_do_collate0x0
(braket
l_int|3
)braket
op_assign
(brace
id|ntfs_collate_binary
comma
l_int|NULL
multiline_comment|/*ntfs_collate_file_name*/
comma
l_int|NULL
multiline_comment|/*ntfs_collate_unicode_string*/
comma
)brace
suffix:semicolon
DECL|variable|ntfs_do_collate0x1
r_static
id|ntfs_collate_func_t
id|ntfs_do_collate0x1
(braket
l_int|4
)braket
op_assign
(brace
id|ntfs_collate_ntofs_ulong
comma
l_int|NULL
multiline_comment|/*ntfs_collate_ntofs_sid*/
comma
l_int|NULL
multiline_comment|/*ntfs_collate_ntofs_security_hash*/
comma
l_int|NULL
multiline_comment|/*ntfs_collate_ntofs_ulongs*/
comma
)brace
suffix:semicolon
multiline_comment|/**&n; * ntfs_collate - collate two data items using a specified collation rule&n; * @vol:&t;ntfs volume to which the data items belong&n; * @cr:&t;&t;collation rule to use when comparing the items&n; * @data1:&t;first data item to collate&n; * @data1_len:&t;length in bytes of @data1&n; * @data2:&t;second data item to collate&n; * @data2_len:&t;length in bytes of @data2&n; *&n; * Collate the two data items @data1 and @data2 using the collation rule @cr&n; * and return -1, 0, ir 1 if @data1 is found, respectively, to collate before,&n; * to match, or to collate after @data2.&n; *&n; * For speed we use the collation rule @cr as an index into two tables of&n; * function pointers to call the appropriate collation function.&n; */
DECL|function|ntfs_collate
r_int
id|ntfs_collate
c_func
(paren
id|ntfs_volume
op_star
id|vol
comma
id|COLLATION_RULE
id|cr
comma
r_const
r_void
op_star
id|data1
comma
r_const
r_int
id|data1_len
comma
r_const
r_void
op_star
id|data2
comma
r_const
r_int
id|data2_len
)paren
(brace
r_int
id|i
suffix:semicolon
id|ntfs_debug
c_func
(paren
l_string|&quot;Entering.&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * FIXME:  At the moment we only support COLLATION_BINARY and&n;&t; * COLLATION_NTOFS_ULONG, so we BUG() for everything else for now.&n;&t; */
id|BUG_ON
c_func
(paren
id|cr
op_ne
id|COLLATION_BINARY
op_logical_and
id|cr
op_ne
id|COLLATION_NTOFS_ULONG
)paren
suffix:semicolon
id|i
op_assign
id|le32_to_cpu
c_func
(paren
id|cr
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|i
OL
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_le
l_int|0x02
)paren
r_return
id|ntfs_do_collate0x0
(braket
id|i
)braket
(paren
id|vol
comma
id|data1
comma
id|data1_len
comma
id|data2
comma
id|data2_len
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|i
OL
l_int|0x10
)paren
suffix:semicolon
id|i
op_sub_assign
l_int|0x10
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|i
op_le
l_int|3
)paren
)paren
r_return
id|ntfs_do_collate0x1
(braket
id|i
)braket
(paren
id|vol
comma
id|data1
comma
id|data1_len
comma
id|data2
comma
id|data2_len
)paren
suffix:semicolon
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
