multiline_comment|/*&n; * linux/fs/nfs/callback_xdr.c&n; *&n; * Copyright (C) 2004 Trond Myklebust&n; *&n; * NFSv4 callback encode/decode procedures&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sunrpc/svc.h&gt;
macro_line|#include &lt;linux/nfs4.h&gt;
macro_line|#include &lt;linux/nfs_fs.h&gt;
macro_line|#include &quot;callback.h&quot;
DECL|macro|CB_OP_TAGLEN_MAXSZ
mdefine_line|#define CB_OP_TAGLEN_MAXSZ&t;(512)
DECL|macro|CB_OP_HDR_RES_MAXSZ
mdefine_line|#define CB_OP_HDR_RES_MAXSZ&t;(2 + CB_OP_TAGLEN_MAXSZ)
DECL|macro|CB_OP_GETATTR_BITMAP_MAXSZ
mdefine_line|#define CB_OP_GETATTR_BITMAP_MAXSZ&t;(4)
DECL|macro|CB_OP_GETATTR_RES_MAXSZ
mdefine_line|#define CB_OP_GETATTR_RES_MAXSZ&t;(CB_OP_HDR_RES_MAXSZ + &bslash;&n;&t;&t;&t;&t;CB_OP_GETATTR_BITMAP_MAXSZ + &bslash;&n;&t;&t;&t;&t;2 + 2 + 3 + 3)
DECL|macro|CB_OP_RECALL_RES_MAXSZ
mdefine_line|#define CB_OP_RECALL_RES_MAXSZ&t;(CB_OP_HDR_RES_MAXSZ)
DECL|macro|NFSDBG_FACILITY
mdefine_line|#define NFSDBG_FACILITY NFSDBG_CALLBACK
DECL|typedef|callback_process_op_t
r_typedef
r_int
(paren
op_star
id|callback_process_op_t
)paren
(paren
r_void
op_star
comma
r_void
op_star
)paren
suffix:semicolon
DECL|typedef|callback_decode_arg_t
r_typedef
r_int
(paren
op_star
id|callback_decode_arg_t
)paren
(paren
r_struct
id|svc_rqst
op_star
comma
r_struct
id|xdr_stream
op_star
comma
r_void
op_star
)paren
suffix:semicolon
DECL|typedef|callback_encode_res_t
r_typedef
r_int
(paren
op_star
id|callback_encode_res_t
)paren
(paren
r_struct
id|svc_rqst
op_star
comma
r_struct
id|xdr_stream
op_star
comma
r_void
op_star
)paren
suffix:semicolon
DECL|struct|callback_op
r_struct
id|callback_op
(brace
DECL|member|process_op
id|callback_process_op_t
id|process_op
suffix:semicolon
DECL|member|decode_args
id|callback_decode_arg_t
id|decode_args
suffix:semicolon
DECL|member|encode_res
id|callback_encode_res_t
id|encode_res
suffix:semicolon
DECL|member|res_maxsize
r_int
id|res_maxsize
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|callback_ops
r_static
r_struct
id|callback_op
id|callback_ops
(braket
)braket
suffix:semicolon
DECL|function|nfs4_callback_null
r_static
r_int
id|nfs4_callback_null
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
r_void
op_star
id|argp
comma
r_void
op_star
id|resp
)paren
(brace
r_return
id|htonl
c_func
(paren
id|NFS4_OK
)paren
suffix:semicolon
)brace
DECL|function|nfs4_decode_void
r_static
r_int
id|nfs4_decode_void
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
r_uint32
op_star
id|p
comma
r_void
op_star
id|dummy
)paren
(brace
r_return
id|xdr_argsize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
DECL|function|nfs4_encode_void
r_static
r_int
id|nfs4_encode_void
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
r_uint32
op_star
id|p
comma
r_void
op_star
id|dummy
)paren
(brace
r_return
id|xdr_ressize_check
c_func
(paren
id|rqstp
comma
id|p
)paren
suffix:semicolon
)brace
DECL|function|read_buf
r_static
r_uint32
op_star
id|read_buf
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_int
id|nbytes
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|p
op_assign
id|xdr_inline_decode
c_func
(paren
id|xdr
comma
id|nbytes
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|p
op_eq
l_int|NULL
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;NFSv4 callback reply buffer overflowed!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
DECL|function|decode_string
r_static
r_int
id|decode_string
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_int
r_int
op_star
id|len
comma
r_const
r_char
op_star
op_star
id|str
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|p
op_assign
id|read_buf
c_func
(paren
id|xdr
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|p
op_eq
l_int|NULL
)paren
)paren
r_return
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
op_star
id|len
op_assign
id|ntohl
c_func
(paren
op_star
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|len
op_ne
l_int|0
)paren
(brace
id|p
op_assign
id|read_buf
c_func
(paren
id|xdr
comma
op_star
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|p
op_eq
l_int|NULL
)paren
)paren
r_return
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
op_star
id|str
op_assign
(paren
r_const
r_char
op_star
)paren
id|p
suffix:semicolon
)brace
r_else
op_star
id|str
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|decode_fh
r_static
r_int
id|decode_fh
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs_fh
op_star
id|fh
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|p
op_assign
id|read_buf
c_func
(paren
id|xdr
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|p
op_eq
l_int|NULL
)paren
)paren
r_return
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
id|fh-&gt;size
op_assign
id|ntohl
c_func
(paren
op_star
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fh-&gt;size
OG
id|NFS4_FHSIZE
)paren
r_return
id|htonl
c_func
(paren
id|NFS4ERR_BADHANDLE
)paren
suffix:semicolon
id|p
op_assign
id|read_buf
c_func
(paren
id|xdr
comma
id|fh-&gt;size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|p
op_eq
l_int|NULL
)paren
)paren
r_return
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|fh-&gt;data
(braket
l_int|0
)braket
comma
id|p
comma
id|fh-&gt;size
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|fh-&gt;data
(braket
id|fh-&gt;size
)braket
comma
l_int|0
comma
r_sizeof
(paren
id|fh-&gt;data
)paren
op_minus
id|fh-&gt;size
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|decode_bitmap
r_static
r_int
id|decode_bitmap
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_uint32
op_star
id|bitmap
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
r_int
r_int
id|attrlen
suffix:semicolon
id|p
op_assign
id|read_buf
c_func
(paren
id|xdr
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|p
op_eq
l_int|NULL
)paren
)paren
r_return
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
id|attrlen
op_assign
id|ntohl
c_func
(paren
op_star
id|p
)paren
suffix:semicolon
id|p
op_assign
id|read_buf
c_func
(paren
id|xdr
comma
id|attrlen
op_lshift
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|p
op_eq
l_int|NULL
)paren
)paren
r_return
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|attrlen
OG
l_int|0
)paren
)paren
id|bitmap
(braket
l_int|0
)braket
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|attrlen
OG
l_int|1
)paren
id|bitmap
(braket
l_int|1
)braket
op_assign
id|ntohl
c_func
(paren
op_star
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|decode_stateid
r_static
r_int
id|decode_stateid
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
id|nfs4_stateid
op_star
id|stateid
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|p
op_assign
id|read_buf
c_func
(paren
id|xdr
comma
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|p
op_eq
l_int|NULL
)paren
)paren
r_return
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|stateid-&gt;data
comma
id|p
comma
l_int|16
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|decode_compound_hdr_arg
r_static
r_int
id|decode_compound_hdr_arg
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|cb_compound_hdr_arg
op_star
id|hdr
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
r_int
r_int
id|minor_version
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|decode_string
c_func
(paren
id|xdr
comma
op_amp
id|hdr-&gt;taglen
comma
op_amp
id|hdr-&gt;tag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|status
op_ne
l_int|0
)paren
)paren
r_return
id|status
suffix:semicolon
multiline_comment|/* We do not like overly long tags! */
r_if
c_cond
(paren
id|hdr-&gt;taglen
OG
id|CB_OP_TAGLEN_MAXSZ
op_minus
l_int|12
op_logical_or
id|hdr-&gt;taglen
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;NFSv4 CALLBACK %s: client sent tag of length %u&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|hdr-&gt;taglen
)paren
suffix:semicolon
r_return
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
)brace
id|p
op_assign
id|read_buf
c_func
(paren
id|xdr
comma
l_int|12
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|p
op_eq
l_int|NULL
)paren
)paren
r_return
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
id|minor_version
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
multiline_comment|/* Check minor version is zero. */
r_if
c_cond
(paren
id|minor_version
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s: NFSv4 server callback with illegal minor version %u!&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|minor_version
)paren
suffix:semicolon
r_return
id|htonl
c_func
(paren
id|NFS4ERR_MINOR_VERS_MISMATCH
)paren
suffix:semicolon
)brace
id|hdr-&gt;callback_ident
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|hdr-&gt;nops
op_assign
id|ntohl
c_func
(paren
op_star
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|decode_op_hdr
r_static
r_int
id|decode_op_hdr
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_int
r_int
op_star
id|op
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|p
op_assign
id|read_buf
c_func
(paren
id|xdr
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|p
op_eq
l_int|NULL
)paren
)paren
r_return
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
op_star
id|op
op_assign
id|ntohl
c_func
(paren
op_star
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|decode_getattr_args
r_static
r_int
id|decode_getattr_args
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|cb_getattrargs
op_star
id|args
)paren
(brace
r_int
id|status
suffix:semicolon
id|status
op_assign
id|decode_fh
c_func
(paren
id|xdr
comma
op_amp
id|args-&gt;fh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|status
op_ne
l_int|0
)paren
)paren
r_goto
id|out
suffix:semicolon
id|args-&gt;addr
op_assign
op_amp
id|rqstp-&gt;rq_addr
suffix:semicolon
id|status
op_assign
id|decode_bitmap
c_func
(paren
id|xdr
comma
id|args-&gt;bitmap
)paren
suffix:semicolon
id|out
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot;%s: exit with status = %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|status
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
DECL|function|decode_recall_args
r_static
r_int
id|decode_recall_args
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|cb_recallargs
op_star
id|args
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
r_int
id|status
suffix:semicolon
id|args-&gt;addr
op_assign
op_amp
id|rqstp-&gt;rq_addr
suffix:semicolon
id|status
op_assign
id|decode_stateid
c_func
(paren
id|xdr
comma
op_amp
id|args-&gt;stateid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|status
op_ne
l_int|0
)paren
)paren
r_goto
id|out
suffix:semicolon
id|p
op_assign
id|read_buf
c_func
(paren
id|xdr
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|p
op_eq
l_int|NULL
)paren
)paren
(brace
id|status
op_assign
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|args-&gt;truncate
op_assign
id|ntohl
c_func
(paren
op_star
id|p
)paren
suffix:semicolon
id|status
op_assign
id|decode_fh
c_func
(paren
id|xdr
comma
op_amp
id|args-&gt;fh
)paren
suffix:semicolon
id|out
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot;%s: exit with status = %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|status
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|encode_string
r_static
r_int
id|encode_string
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_int
r_int
id|len
comma
r_const
r_char
op_star
id|str
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|p
op_assign
id|xdr_reserve_space
c_func
(paren
id|xdr
comma
l_int|4
op_plus
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|p
op_eq
l_int|NULL
)paren
)paren
r_return
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
id|xdr_encode_opaque
c_func
(paren
id|p
comma
id|str
comma
id|len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|CB_SUPPORTED_ATTR0
mdefine_line|#define CB_SUPPORTED_ATTR0 (FATTR4_WORD0_CHANGE|FATTR4_WORD0_SIZE)
DECL|macro|CB_SUPPORTED_ATTR1
mdefine_line|#define CB_SUPPORTED_ATTR1 (FATTR4_WORD1_TIME_METADATA|FATTR4_WORD1_TIME_MODIFY)
DECL|function|encode_attr_bitmap
r_static
r_int
id|encode_attr_bitmap
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_const
r_uint32
op_star
id|bitmap
comma
r_uint32
op_star
op_star
id|savep
)paren
(brace
r_uint32
id|bm
(braket
l_int|2
)braket
suffix:semicolon
r_uint32
op_star
id|p
suffix:semicolon
id|bm
(braket
l_int|0
)braket
op_assign
id|htonl
c_func
(paren
id|bitmap
(braket
l_int|0
)braket
op_amp
id|CB_SUPPORTED_ATTR0
)paren
suffix:semicolon
id|bm
(braket
l_int|1
)braket
op_assign
id|htonl
c_func
(paren
id|bitmap
(braket
l_int|1
)braket
op_amp
id|CB_SUPPORTED_ATTR1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bm
(braket
l_int|1
)braket
op_ne
l_int|0
)paren
(brace
id|p
op_assign
id|xdr_reserve_space
c_func
(paren
id|xdr
comma
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|p
op_eq
l_int|NULL
)paren
)paren
r_return
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
l_int|2
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|bm
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|bm
(braket
l_int|1
)braket
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bm
(braket
l_int|0
)braket
op_ne
l_int|0
)paren
(brace
id|p
op_assign
id|xdr_reserve_space
c_func
(paren
id|xdr
comma
l_int|12
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|p
op_eq
l_int|NULL
)paren
)paren
r_return
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
l_int|1
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|bm
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
(brace
id|p
op_assign
id|xdr_reserve_space
c_func
(paren
id|xdr
comma
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|p
op_eq
l_int|NULL
)paren
)paren
r_return
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
op_star
id|savep
op_assign
id|p
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|encode_attr_change
r_static
r_int
id|encode_attr_change
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_const
r_uint32
op_star
id|bitmap
comma
r_uint64
id|change
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|bitmap
(braket
l_int|0
)braket
op_amp
id|FATTR4_WORD0_CHANGE
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|p
op_assign
id|xdr_reserve_space
c_func
(paren
id|xdr
comma
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|p
op_eq
l_int|0
)paren
)paren
r_return
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|change
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|encode_attr_size
r_static
r_int
id|encode_attr_size
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_const
r_uint32
op_star
id|bitmap
comma
r_uint64
id|size
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|bitmap
(braket
l_int|0
)braket
op_amp
id|FATTR4_WORD0_SIZE
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|p
op_assign
id|xdr_reserve_space
c_func
(paren
id|xdr
comma
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|p
op_eq
l_int|0
)paren
)paren
r_return
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|size
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|encode_attr_time
r_static
r_int
id|encode_attr_time
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_const
r_struct
id|timespec
op_star
id|time
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|p
op_assign
id|xdr_reserve_space
c_func
(paren
id|xdr
comma
l_int|12
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|p
op_eq
l_int|0
)paren
)paren
r_return
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|time-&gt;tv_sec
)paren
suffix:semicolon
op_star
id|p
op_assign
id|htonl
c_func
(paren
id|time-&gt;tv_nsec
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|encode_attr_ctime
r_static
r_int
id|encode_attr_ctime
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_const
r_uint32
op_star
id|bitmap
comma
r_const
r_struct
id|timespec
op_star
id|time
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bitmap
(braket
l_int|1
)braket
op_amp
id|FATTR4_WORD1_TIME_METADATA
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|encode_attr_time
c_func
(paren
id|xdr
comma
id|time
)paren
suffix:semicolon
)brace
DECL|function|encode_attr_mtime
r_static
r_int
id|encode_attr_mtime
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_const
r_uint32
op_star
id|bitmap
comma
r_const
r_struct
id|timespec
op_star
id|time
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bitmap
(braket
l_int|1
)braket
op_amp
id|FATTR4_WORD1_TIME_MODIFY
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|encode_attr_time
c_func
(paren
id|xdr
comma
id|time
)paren
suffix:semicolon
)brace
DECL|function|encode_compound_hdr_res
r_static
r_int
id|encode_compound_hdr_res
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|cb_compound_hdr_res
op_star
id|hdr
)paren
(brace
r_int
id|status
suffix:semicolon
id|hdr-&gt;status
op_assign
id|xdr_reserve_space
c_func
(paren
id|xdr
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|hdr-&gt;status
op_eq
l_int|NULL
)paren
)paren
r_return
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
id|status
op_assign
id|encode_string
c_func
(paren
id|xdr
comma
id|hdr-&gt;taglen
comma
id|hdr-&gt;tag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|status
op_ne
l_int|0
)paren
)paren
r_return
id|status
suffix:semicolon
id|hdr-&gt;nops
op_assign
id|xdr_reserve_space
c_func
(paren
id|xdr
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|hdr-&gt;nops
op_eq
l_int|NULL
)paren
)paren
r_return
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|encode_op_hdr
r_static
r_int
id|encode_op_hdr
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_uint32
id|op
comma
r_uint32
id|res
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|p
op_assign
id|xdr_reserve_space
c_func
(paren
id|xdr
comma
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|p
op_eq
l_int|NULL
)paren
)paren
r_return
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|op
)paren
suffix:semicolon
op_star
id|p
op_assign
id|res
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|encode_getattr_res
r_static
r_int
id|encode_getattr_res
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_const
r_struct
id|cb_getattrres
op_star
id|res
)paren
(brace
r_uint32
op_star
id|savep
suffix:semicolon
r_int
id|status
op_assign
id|res-&gt;status
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|status
op_ne
l_int|0
)paren
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|encode_attr_bitmap
c_func
(paren
id|xdr
comma
id|res-&gt;bitmap
comma
op_amp
id|savep
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|status
op_ne
l_int|0
)paren
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|encode_attr_change
c_func
(paren
id|xdr
comma
id|res-&gt;bitmap
comma
id|res-&gt;change_attr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|status
op_ne
l_int|0
)paren
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|encode_attr_size
c_func
(paren
id|xdr
comma
id|res-&gt;bitmap
comma
id|res-&gt;size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|status
op_ne
l_int|0
)paren
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|encode_attr_ctime
c_func
(paren
id|xdr
comma
id|res-&gt;bitmap
comma
op_amp
id|res-&gt;ctime
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|status
op_ne
l_int|0
)paren
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|encode_attr_mtime
c_func
(paren
id|xdr
comma
id|res-&gt;bitmap
comma
op_amp
id|res-&gt;mtime
)paren
suffix:semicolon
op_star
id|savep
op_assign
id|htonl
c_func
(paren
(paren
r_int
r_int
)paren
(paren
(paren
r_char
op_star
)paren
id|xdr-&gt;p
op_minus
(paren
r_char
op_star
)paren
(paren
id|savep
op_plus
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|out
suffix:colon
id|dprintk
c_func
(paren
l_string|&quot;%s: exit with status = %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|status
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
DECL|function|process_op
r_static
r_int
id|process_op
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
r_struct
id|xdr_stream
op_star
id|xdr_in
comma
r_void
op_star
id|argp
comma
r_struct
id|xdr_stream
op_star
id|xdr_out
comma
r_void
op_star
id|resp
)paren
(brace
r_struct
id|callback_op
op_star
id|op
suffix:semicolon
r_int
r_int
id|op_nr
suffix:semicolon
r_int
r_int
id|status
op_assign
l_int|0
suffix:semicolon
r_int
id|maxlen
suffix:semicolon
r_int
id|res
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: start&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|status
op_assign
id|decode_op_hdr
c_func
(paren
id|xdr_in
comma
op_amp
id|op_nr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|status
op_ne
l_int|0
)paren
)paren
(brace
id|op_nr
op_assign
id|OP_CB_ILLEGAL
suffix:semicolon
id|op
op_assign
op_amp
id|callback_ops
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|op_nr
op_ne
id|OP_CB_GETATTR
op_logical_and
id|op_nr
op_ne
id|OP_CB_RECALL
)paren
)paren
(brace
id|op_nr
op_assign
id|OP_CB_ILLEGAL
suffix:semicolon
id|op
op_assign
op_amp
id|callback_ops
(braket
l_int|0
)braket
suffix:semicolon
id|status
op_assign
id|htonl
c_func
(paren
id|NFS4ERR_OP_ILLEGAL
)paren
suffix:semicolon
)brace
r_else
id|op
op_assign
op_amp
id|callback_ops
(braket
id|op_nr
)braket
suffix:semicolon
id|maxlen
op_assign
id|xdr_out-&gt;end
op_minus
id|xdr_out-&gt;p
suffix:semicolon
r_if
c_cond
(paren
id|maxlen
OG
l_int|0
op_logical_and
id|maxlen
OL
id|PAGE_SIZE
)paren
(brace
r_if
c_cond
(paren
id|likely
c_func
(paren
id|status
op_eq
l_int|0
op_logical_and
id|op-&gt;decode_args
op_ne
l_int|NULL
)paren
)paren
id|status
op_assign
id|op
op_member_access_from_pointer
id|decode_args
c_func
(paren
id|rqstp
comma
id|xdr_in
comma
id|argp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|status
op_eq
l_int|0
op_logical_and
id|op-&gt;process_op
op_ne
l_int|NULL
)paren
)paren
id|status
op_assign
id|op
op_member_access_from_pointer
id|process_op
c_func
(paren
id|argp
comma
id|resp
)paren
suffix:semicolon
)brace
r_else
id|status
op_assign
id|htonl
c_func
(paren
id|NFS4ERR_RESOURCE
)paren
suffix:semicolon
id|res
op_assign
id|encode_op_hdr
c_func
(paren
id|xdr_out
comma
id|op_nr
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
l_int|0
)paren
id|status
op_assign
id|res
suffix:semicolon
r_if
c_cond
(paren
id|op-&gt;encode_res
op_ne
l_int|NULL
op_logical_and
id|status
op_eq
l_int|0
)paren
id|status
op_assign
id|op
op_member_access_from_pointer
id|encode_res
c_func
(paren
id|rqstp
comma
id|xdr_out
comma
id|resp
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: done, status = %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|status
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode, process and encode a COMPOUND&n; */
DECL|function|nfs4_callback_compound
r_static
r_int
id|nfs4_callback_compound
c_func
(paren
r_struct
id|svc_rqst
op_star
id|rqstp
comma
r_void
op_star
id|argp
comma
r_void
op_star
id|resp
)paren
(brace
r_struct
id|cb_compound_hdr_arg
id|hdr_arg
suffix:semicolon
r_struct
id|cb_compound_hdr_res
id|hdr_res
suffix:semicolon
r_struct
id|xdr_stream
id|xdr_in
comma
id|xdr_out
suffix:semicolon
r_uint32
op_star
id|p
suffix:semicolon
r_int
r_int
id|status
suffix:semicolon
r_int
r_int
id|nops
op_assign
l_int|1
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: start&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|xdr_init_decode
c_func
(paren
op_amp
id|xdr_in
comma
op_amp
id|rqstp-&gt;rq_arg
comma
id|rqstp-&gt;rq_arg.head
(braket
l_int|0
)braket
dot
id|iov_base
)paren
suffix:semicolon
id|p
op_assign
(paren
r_uint32
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|rqstp-&gt;rq_res.head
(braket
l_int|0
)braket
dot
id|iov_base
op_plus
id|rqstp-&gt;rq_res.head
(braket
l_int|0
)braket
dot
id|iov_len
)paren
suffix:semicolon
id|rqstp-&gt;rq_res.head
(braket
l_int|0
)braket
dot
id|iov_len
op_assign
id|PAGE_SIZE
suffix:semicolon
id|xdr_init_encode
c_func
(paren
op_amp
id|xdr_out
comma
op_amp
id|rqstp-&gt;rq_res
comma
id|p
)paren
suffix:semicolon
id|decode_compound_hdr_arg
c_func
(paren
op_amp
id|xdr_in
comma
op_amp
id|hdr_arg
)paren
suffix:semicolon
id|hdr_res.taglen
op_assign
id|hdr_arg.taglen
suffix:semicolon
id|hdr_res.tag
op_assign
id|hdr_arg.tag
suffix:semicolon
id|encode_compound_hdr_res
c_func
(paren
op_amp
id|xdr_out
comma
op_amp
id|hdr_res
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|status
op_assign
id|process_op
c_func
(paren
id|rqstp
comma
op_amp
id|xdr_in
comma
id|argp
comma
op_amp
id|xdr_out
comma
id|resp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|nops
op_eq
id|hdr_arg.nops
)paren
r_break
suffix:semicolon
id|nops
op_increment
suffix:semicolon
)brace
op_star
id|hdr_res.status
op_assign
id|status
suffix:semicolon
op_star
id|hdr_res.nops
op_assign
id|htonl
c_func
(paren
id|nops
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;%s: done, status = %u&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|status
)paren
suffix:semicolon
r_return
id|rpc_success
suffix:semicolon
)brace
multiline_comment|/*&n; * Define NFS4 callback COMPOUND ops.&n; */
DECL|variable|callback_ops
r_static
r_struct
id|callback_op
id|callback_ops
(braket
)braket
op_assign
(brace
(braket
l_int|0
)braket
op_assign
(brace
dot
id|res_maxsize
op_assign
id|CB_OP_HDR_RES_MAXSZ
comma
)brace
comma
(braket
id|OP_CB_GETATTR
)braket
op_assign
(brace
dot
id|process_op
op_assign
(paren
id|callback_process_op_t
)paren
id|nfs4_callback_getattr
comma
dot
id|decode_args
op_assign
(paren
id|callback_decode_arg_t
)paren
id|decode_getattr_args
comma
dot
id|encode_res
op_assign
(paren
id|callback_encode_res_t
)paren
id|encode_getattr_res
comma
dot
id|res_maxsize
op_assign
id|CB_OP_GETATTR_RES_MAXSZ
comma
)brace
comma
(braket
id|OP_CB_RECALL
)braket
op_assign
(brace
dot
id|process_op
op_assign
(paren
id|callback_process_op_t
)paren
id|nfs4_callback_recall
comma
dot
id|decode_args
op_assign
(paren
id|callback_decode_arg_t
)paren
id|decode_recall_args
comma
dot
id|res_maxsize
op_assign
id|CB_OP_RECALL_RES_MAXSZ
comma
)brace
)brace
suffix:semicolon
multiline_comment|/*&n; * Define NFS4 callback procedures&n; */
DECL|variable|nfs4_callback_procedures1
r_static
r_struct
id|svc_procedure
id|nfs4_callback_procedures1
(braket
)braket
op_assign
(brace
(braket
id|CB_NULL
)braket
op_assign
(brace
dot
id|pc_func
op_assign
id|nfs4_callback_null
comma
dot
id|pc_decode
op_assign
(paren
id|kxdrproc_t
)paren
id|nfs4_decode_void
comma
dot
id|pc_encode
op_assign
(paren
id|kxdrproc_t
)paren
id|nfs4_encode_void
comma
dot
id|pc_xdrressize
op_assign
l_int|1
comma
)brace
comma
(braket
id|CB_COMPOUND
)braket
op_assign
(brace
dot
id|pc_func
op_assign
id|nfs4_callback_compound
comma
dot
id|pc_encode
op_assign
(paren
id|kxdrproc_t
)paren
id|nfs4_encode_void
comma
dot
id|pc_argsize
op_assign
l_int|256
comma
dot
id|pc_ressize
op_assign
l_int|256
comma
dot
id|pc_xdrressize
op_assign
id|NFS4_CALLBACK_BUFSIZE
comma
)brace
)brace
suffix:semicolon
DECL|variable|nfs4_callback_version1
r_struct
id|svc_version
id|nfs4_callback_version1
op_assign
(brace
dot
id|vs_vers
op_assign
l_int|1
comma
dot
id|vs_nproc
op_assign
id|ARRAY_SIZE
c_func
(paren
id|nfs4_callback_procedures1
)paren
comma
dot
id|vs_proc
op_assign
id|nfs4_callback_procedures1
comma
dot
id|vs_xdrsize
op_assign
id|NFS4_CALLBACK_XDRSIZE
comma
dot
id|vs_dispatch
op_assign
l_int|NULL
comma
)brace
suffix:semicolon
eof
