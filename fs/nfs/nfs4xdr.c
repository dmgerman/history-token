multiline_comment|/*&n; *  fs/nfs/nfs4xdr.c&n; *&n; *  Client-side XDR for NFSv4.&n; *&n; *  Copyright (c) 2002 The Regents of the University of Michigan.&n; *  All rights reserved.&n; *&n; *  Kendrick Smith &lt;kmsmith@umich.edu&gt;&n; *  Andy Adamson   &lt;andros@umich.edu&gt;&n; * &n; *  Redistribution and use in source and binary forms, with or without&n; *  modification, are permitted provided that the following conditions&n; *  are met:&n; *&n; *  1. Redistributions of source code must retain the above copyright&n; *     notice, this list of conditions and the following disclaimer.&n; *  2. Redistributions in binary form must reproduce the above copyright&n; *     notice, this list of conditions and the following disclaimer in the&n; *     documentation and/or other materials provided with the distribution.&n; *  3. Neither the name of the University nor the names of its&n; *     contributors may be used to endorse or promote products derived&n; *     from this software without specific prior written permission.&n; *&n; *  THIS SOFTWARE IS PROVIDED ``AS IS&squot;&squot; AND ANY EXPRESS OR IMPLIED&n; *  WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF&n; *  MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE&n; *  DISCLAIMED. IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE&n; *  FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR&n; *  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF&n; *  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR&n; *  BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF&n; *  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING&n; *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS&n; *  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.&n; */
macro_line|#include &lt;linux/param.h&gt;
macro_line|#include &lt;linux/time.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/utsname.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/in.h&gt;
macro_line|#include &lt;linux/pagemap.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/kdev_t.h&gt;
macro_line|#include &lt;linux/sunrpc/clnt.h&gt;
macro_line|#include &lt;linux/nfs.h&gt;
macro_line|#include &lt;linux/nfs4.h&gt;
macro_line|#include &lt;linux/nfs_fs.h&gt;
macro_line|#include &lt;linux/nfs_idmap.h&gt;
DECL|macro|NFSDBG_FACILITY
mdefine_line|#define NFSDBG_FACILITY&t;&t;NFSDBG_XDR
multiline_comment|/* Mapping from NFS error code to &quot;errno&quot; error code. */
DECL|macro|errno_NFSERR_IO
mdefine_line|#define errno_NFSERR_IO&t;&t;EIO
r_extern
r_int
id|nfs_stat_to_errno
c_func
(paren
r_int
)paren
suffix:semicolon
multiline_comment|/* NFSv4 COMPOUND tags are only wanted for debugging purposes */
macro_line|#ifdef DEBUG
DECL|macro|NFS4_MAXTAGLEN
mdefine_line|#define NFS4_MAXTAGLEN&t;&t;20
macro_line|#else
DECL|macro|NFS4_MAXTAGLEN
mdefine_line|#define NFS4_MAXTAGLEN&t;&t;0
macro_line|#endif
DECL|macro|compound_encode_hdr_maxsz
mdefine_line|#define compound_encode_hdr_maxsz&t;3 + (NFS4_MAXTAGLEN &gt;&gt; 2)
DECL|macro|compound_decode_hdr_maxsz
mdefine_line|#define compound_decode_hdr_maxsz&t;2 + (NFS4_MAXTAGLEN &gt;&gt; 2)
DECL|macro|op_encode_hdr_maxsz
mdefine_line|#define op_encode_hdr_maxsz&t;1
DECL|macro|op_decode_hdr_maxsz
mdefine_line|#define op_decode_hdr_maxsz&t;2
DECL|macro|encode_putfh_maxsz
mdefine_line|#define encode_putfh_maxsz&t;op_encode_hdr_maxsz + 1 + &bslash;&n;&t;&t;&t;&t;(NFS4_FHSIZE &gt;&gt; 2)
DECL|macro|decode_putfh_maxsz
mdefine_line|#define decode_putfh_maxsz&t;op_decode_hdr_maxsz
DECL|macro|encode_getfh_maxsz
mdefine_line|#define encode_getfh_maxsz      op_encode_hdr_maxsz
DECL|macro|decode_getfh_maxsz
mdefine_line|#define decode_getfh_maxsz      op_decode_hdr_maxsz + 1 + &bslash;&n;                                (NFS4_FHSIZE &gt;&gt; 2)
DECL|macro|encode_getattr_maxsz
mdefine_line|#define encode_getattr_maxsz    op_encode_hdr_maxsz + 3
DECL|macro|nfs4_fattr_bitmap_maxsz
mdefine_line|#define nfs4_fattr_bitmap_maxsz 26 + 2 * ((NFS4_MAXNAMLEN +1) &gt;&gt; 2)
DECL|macro|decode_getattr_maxsz
mdefine_line|#define decode_getattr_maxsz    op_decode_hdr_maxsz + 3 + &bslash;&n;                                nfs4_fattr_bitmap_maxsz
DECL|macro|encode_savefh_maxsz
mdefine_line|#define encode_savefh_maxsz     op_encode_hdr_maxsz
DECL|macro|decode_savefh_maxsz
mdefine_line|#define decode_savefh_maxsz     op_decode_hdr_maxsz
DECL|macro|encode_restorefh_maxsz
mdefine_line|#define encode_restorefh_maxsz  op_encode_hdr_maxsz
DECL|macro|decode_restorefh_maxsz
mdefine_line|#define decode_restorefh_maxsz  op_decode_hdr_maxsz
DECL|macro|encode_read_getattr_maxsz
mdefine_line|#define encode_read_getattr_maxsz&t;op_encode_hdr_maxsz + 2
DECL|macro|decode_read_getattr_maxsz
mdefine_line|#define decode_read_getattr_maxsz&t;op_decode_hdr_maxsz + 8
DECL|macro|encode_pre_write_getattr_maxsz
mdefine_line|#define encode_pre_write_getattr_maxsz&t;op_encode_hdr_maxsz + 2
DECL|macro|decode_pre_write_getattr_maxsz
mdefine_line|#define decode_pre_write_getattr_maxsz&t;op_decode_hdr_maxsz + 5
DECL|macro|encode_post_write_getattr_maxsz
mdefine_line|#define encode_post_write_getattr_maxsz&t;op_encode_hdr_maxsz + 2
DECL|macro|decode_post_write_getattr_maxsz
mdefine_line|#define decode_post_write_getattr_maxsz&t;op_decode_hdr_maxsz + 13
DECL|macro|NFS4_enc_compound_sz
mdefine_line|#define NFS4_enc_compound_sz&t;1024  /* XXX: large enough? */
DECL|macro|NFS4_dec_compound_sz
mdefine_line|#define NFS4_dec_compound_sz&t;1024  /* XXX: large enough? */
DECL|macro|NFS4_enc_read_sz
mdefine_line|#define NFS4_enc_read_sz&t;compound_encode_hdr_maxsz + &bslash;&n;&t;&t;&t;&t;encode_putfh_maxsz + &bslash;&n;&t;&t;&t;&t;encode_read_getattr_maxsz + &bslash;&n;&t;&t;&t;&t;op_encode_hdr_maxsz + 7
DECL|macro|NFS4_dec_read_sz
mdefine_line|#define NFS4_dec_read_sz&t;compound_decode_hdr_maxsz + &bslash;&n;&t;&t;&t;&t;decode_putfh_maxsz + &bslash;&n;&t;&t;&t;&t;decode_read_getattr_maxsz + &bslash;&n;&t;&t;&t;&t;op_decode_hdr_maxsz + 2
DECL|macro|NFS4_enc_write_sz
mdefine_line|#define NFS4_enc_write_sz&t;compound_encode_hdr_maxsz + &bslash;&n;&t;&t;&t;&t;encode_putfh_maxsz + &bslash;&n;&t;&t;&t;&t;encode_pre_write_getattr_maxsz + &bslash;&n;&t;&t;&t;&t;op_encode_hdr_maxsz + 8 + &bslash;&n;&t;&t;&t;&t;encode_post_write_getattr_maxsz
DECL|macro|NFS4_dec_write_sz
mdefine_line|#define NFS4_dec_write_sz&t;compound_decode_hdr_maxsz + &bslash;&n;&t;&t;&t;&t;decode_putfh_maxsz + &bslash;&n;&t;&t;&t;&t;decode_pre_write_getattr_maxsz + &bslash;&n;&t;&t;&t;&t;op_decode_hdr_maxsz + 4 + &bslash;&n;&t;&t;&t;&t;decode_post_write_getattr_maxsz
DECL|macro|NFS4_enc_commit_sz
mdefine_line|#define NFS4_enc_commit_sz&t;compound_encode_hdr_maxsz + &bslash;&n;&t;&t;&t;&t;encode_putfh_maxsz + &bslash;&n;&t;&t;&t;&t;encode_pre_write_getattr_maxsz + &bslash;&n;&t;&t;&t;&t;op_encode_hdr_maxsz + 3 + &bslash;&n;&t;&t;&t;&t;encode_post_write_getattr_maxsz
DECL|macro|NFS4_dec_commit_sz
mdefine_line|#define NFS4_dec_commit_sz&t;compound_decode_hdr_maxsz + &bslash;&n;&t;&t;&t;&t;decode_putfh_maxsz + &bslash;&n;&t;&t;&t;&t;decode_pre_write_getattr_maxsz + &bslash;&n;&t;&t;&t;&t;op_decode_hdr_maxsz + 2 + &bslash;&n;&t;&t;&t;&t;decode_post_write_getattr_maxsz
DECL|macro|NFS4_enc_open_sz
mdefine_line|#define NFS4_enc_open_sz        compound_encode_hdr_maxsz + &bslash;&n;                                encode_putfh_maxsz + &bslash;&n;                                encode_savefh_maxsz + &bslash;&n;                                op_encode_hdr_maxsz + &bslash;&n;                                13 + 3 + 2 + 64 + &bslash;&n;                                encode_getattr_maxsz + &bslash;&n;                                encode_getfh_maxsz + &bslash;&n;                                encode_restorefh_maxsz + &bslash;&n;                                encode_getattr_maxsz
DECL|macro|NFS4_dec_open_sz
mdefine_line|#define NFS4_dec_open_sz        compound_decode_hdr_maxsz + &bslash;&n;                                decode_putfh_maxsz + &bslash;&n;                                decode_savefh_maxsz + &bslash;&n;                                op_decode_hdr_maxsz + 4 + 5 + 2 + 3 + &bslash;&n;                                decode_getattr_maxsz + &bslash;&n;                                decode_getfh_maxsz + &bslash;&n;                                decode_restorefh_maxsz + &bslash;&n;                                decode_getattr_maxsz
DECL|macro|NFS4_enc_open_confirm_sz
mdefine_line|#define NFS4_enc_open_confirm_sz      &bslash;&n;                                compound_encode_hdr_maxsz + &bslash;&n;                                encode_putfh_maxsz + &bslash;&n;                                op_encode_hdr_maxsz + 5
DECL|macro|NFS4_dec_open_confirm_sz
mdefine_line|#define NFS4_dec_open_confirm_sz        compound_decode_hdr_maxsz + &bslash;&n;                                        decode_putfh_maxsz + &bslash;&n;                                        op_decode_hdr_maxsz + 4
DECL|macro|NFS4_enc_close_sz
mdefine_line|#define NFS4_enc_close_sz       compound_encode_hdr_maxsz + &bslash;&n;                                encode_putfh_maxsz + &bslash;&n;                                op_encode_hdr_maxsz + 5
DECL|macro|NFS4_dec_close_sz
mdefine_line|#define NFS4_dec_close_sz       compound_decode_hdr_maxsz + &bslash;&n;                                decode_putfh_maxsz + &bslash;&n;                                op_decode_hdr_maxsz + 4
DECL|macro|NFS4_enc_setattr_sz
mdefine_line|#define NFS4_enc_setattr_sz     compound_encode_hdr_maxsz + &bslash;&n;                                encode_putfh_maxsz + &bslash;&n;                                op_encode_hdr_maxsz + 4 + &bslash;&n;                                nfs4_fattr_bitmap_maxsz + &bslash;&n;                                encode_getattr_maxsz
DECL|macro|NFS4_dec_setattr_sz
mdefine_line|#define NFS4_dec_setattr_sz     compound_decode_hdr_maxsz + &bslash;&n;                                decode_putfh_maxsz + &bslash;&n;                                op_decode_hdr_maxsz + 3
r_static
r_struct
(brace
DECL|member|mode
r_int
r_int
id|mode
suffix:semicolon
DECL|member|nfs2type
r_int
r_int
id|nfs2type
suffix:semicolon
DECL|variable|nfs_type2fmt
)brace
id|nfs_type2fmt
(braket
)braket
op_assign
(brace
(brace
l_int|0
comma
id|NFNON
)brace
comma
(brace
id|S_IFREG
comma
id|NFREG
)brace
comma
(brace
id|S_IFDIR
comma
id|NFDIR
)brace
comma
(brace
id|S_IFBLK
comma
id|NFBLK
)brace
comma
(brace
id|S_IFCHR
comma
id|NFCHR
)brace
comma
(brace
id|S_IFLNK
comma
id|NFLNK
)brace
comma
(brace
id|S_IFSOCK
comma
id|NFSOCK
)brace
comma
(brace
id|S_IFIFO
comma
id|NFFIFO
)brace
comma
(brace
l_int|0
comma
id|NFNON
)brace
comma
(brace
l_int|0
comma
id|NFNON
)brace
comma
)brace
suffix:semicolon
DECL|struct|compound_hdr
r_struct
id|compound_hdr
(brace
DECL|member|status
r_int32
id|status
suffix:semicolon
DECL|member|nops
r_uint32
id|nops
suffix:semicolon
DECL|member|taglen
r_uint32
id|taglen
suffix:semicolon
DECL|member|tag
r_char
op_star
id|tag
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n; * START OF &quot;GENERIC&quot; ENCODE ROUTINES.&n; *   These may look a little ugly since they are imported from a &quot;generic&quot;&n; * set of XDR encode/decode routines which are intended to be shared by&n; * all of our NFSv4 implementations (OpenBSD, MacOS X...).&n; *&n; * If the pain of reading these is too great, it should be a straightforward&n; * task to translate them into Linux-specific versions which are more&n; * consistent with the style used in NFSv2/v3...&n; */
DECL|macro|WRITE32
mdefine_line|#define WRITE32(n)               *p++ = htonl(n)
DECL|macro|WRITE64
mdefine_line|#define WRITE64(n)               do {&t;&t;&t;&t;&bslash;&n;&t;*p++ = htonl((uint32_t)((n) &gt;&gt; 32));&t;&t;&t;&t;&bslash;&n;&t;*p++ = htonl((uint32_t)(n));&t;&t;&t;&t;&t;&bslash;&n;} while (0)
DECL|macro|WRITEMEM
mdefine_line|#define WRITEMEM(ptr,nbytes)     do {&t;&t;&t;&t;&bslash;&n;&t;p = xdr_writemem(p, ptr, nbytes);&t;&t;&t;&bslash;&n;} while (0)
DECL|macro|RESERVE_SPACE
mdefine_line|#define RESERVE_SPACE(nbytes)&t;do {&t;&t;&t;&t;&bslash;&n;&t;p = xdr_reserve_space(xdr, nbytes);&t;&t;&t;&bslash;&n;&t;if (!p) printk(&quot;RESERVE_SPACE(%d) failed in function %s&bslash;n&quot;, nbytes, __FUNCTION__); &bslash;&n;&t;BUG_ON(!p);&t;&t;&t;&t;&t;&t;&bslash;&n;} while (0)
r_static
r_inline
DECL|function|xdr_writemem
r_uint32
op_star
id|xdr_writemem
c_func
(paren
r_uint32
op_star
id|p
comma
r_const
r_void
op_star
id|ptr
comma
r_int
id|nbytes
)paren
(brace
r_int
id|tmp
op_assign
id|XDR_QUADLEN
c_func
(paren
id|nbytes
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tmp
)paren
r_return
id|p
suffix:semicolon
id|p
(braket
id|tmp
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|p
comma
id|ptr
comma
id|nbytes
)paren
suffix:semicolon
r_return
id|p
op_plus
id|tmp
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_compound_hdr
id|encode_compound_hdr
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|compound_hdr
op_star
id|hdr
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;encode_compound: tag=%.*s&bslash;n&quot;
comma
(paren
r_int
)paren
id|hdr-&gt;taglen
comma
id|hdr-&gt;tag
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|hdr-&gt;taglen
OG
id|NFS4_MAXTAGLEN
)paren
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|12
op_plus
id|XDR_QUADLEN
c_func
(paren
id|hdr-&gt;taglen
)paren
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|hdr-&gt;taglen
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|hdr-&gt;tag
comma
id|hdr-&gt;taglen
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|NFS4_MINOR_VERSION
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|hdr-&gt;nops
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_attrs
id|encode_attrs
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|iattr
op_star
id|iap
comma
r_struct
id|nfs_server
op_star
id|server
)paren
(brace
r_char
id|owner_name
(braket
l_int|256
)braket
suffix:semicolon
r_char
id|owner_group
(braket
l_int|256
)braket
suffix:semicolon
r_int
id|owner_namelen
op_assign
l_int|0
suffix:semicolon
r_int
id|owner_grouplen
op_assign
l_int|0
suffix:semicolon
r_uint32
op_star
id|p
suffix:semicolon
r_uint32
op_star
id|q
suffix:semicolon
r_int
id|len
suffix:semicolon
r_uint32
id|bmval0
op_assign
l_int|0
suffix:semicolon
r_uint32
id|bmval1
op_assign
l_int|0
suffix:semicolon
r_int
id|status
suffix:semicolon
multiline_comment|/*&n;&t; * We reserve enough space to write the entire attribute buffer at once.&n;&t; * In the worst-case, this would be&n;&t; *   12(bitmap) + 4(attrlen) + 8(size) + 4(mode) + 4(atime) + 4(mtime)&n;&t; *          = 36 bytes, plus any contribution from variable-length fields&n;&t; *            such as owner/group/acl&squot;s.&n;&t; */
id|len
op_assign
l_int|16
suffix:semicolon
multiline_comment|/* Sigh */
r_if
c_cond
(paren
id|iap-&gt;ia_valid
op_amp
id|ATTR_SIZE
)paren
id|len
op_add_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|iap-&gt;ia_valid
op_amp
id|ATTR_MODE
)paren
id|len
op_add_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|iap-&gt;ia_valid
op_amp
id|ATTR_UID
)paren
(brace
id|status
op_assign
id|nfs_idmap_name
c_func
(paren
id|server
comma
id|IDMAP_TYPE_USER
comma
id|iap-&gt;ia_uid
comma
id|owner_name
comma
op_amp
id|owner_namelen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;nfs: couldn&squot;t resolve uid %d to string&bslash;n&quot;
comma
id|iap-&gt;ia_uid
)paren
suffix:semicolon
multiline_comment|/* XXX */
id|strcpy
c_func
(paren
id|owner_name
comma
l_string|&quot;nobody&quot;
)paren
suffix:semicolon
id|owner_namelen
op_assign
r_sizeof
(paren
l_string|&quot;nobody&quot;
)paren
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* goto out; */
)brace
id|len
op_add_assign
l_int|4
op_plus
(paren
id|XDR_QUADLEN
c_func
(paren
id|owner_namelen
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|iap-&gt;ia_valid
op_amp
id|ATTR_GID
)paren
(brace
id|status
op_assign
id|nfs_idmap_name
c_func
(paren
id|server
comma
id|IDMAP_TYPE_GROUP
comma
id|iap-&gt;ia_gid
comma
id|owner_group
comma
op_amp
id|owner_grouplen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;nfs4: couldn&squot;t resolve gid %d to string&bslash;n&quot;
comma
id|iap-&gt;ia_gid
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|owner_group
comma
l_string|&quot;nobody&quot;
)paren
suffix:semicolon
id|owner_grouplen
op_assign
r_sizeof
(paren
l_string|&quot;nobody&quot;
)paren
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* goto out; */
)brace
id|len
op_add_assign
l_int|4
op_plus
(paren
id|XDR_QUADLEN
c_func
(paren
id|owner_grouplen
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|iap-&gt;ia_valid
op_amp
id|ATTR_ATIME_SET
)paren
id|len
op_add_assign
l_int|16
suffix:semicolon
r_else
r_if
c_cond
(paren
id|iap-&gt;ia_valid
op_amp
id|ATTR_ATIME
)paren
id|len
op_add_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|iap-&gt;ia_valid
op_amp
id|ATTR_MTIME_SET
)paren
id|len
op_add_assign
l_int|16
suffix:semicolon
r_else
r_if
c_cond
(paren
id|iap-&gt;ia_valid
op_amp
id|ATTR_MTIME
)paren
id|len
op_add_assign
l_int|4
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
id|len
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * We write the bitmap length now, but leave the bitmap and the attribute&n;&t; * buffer length to be backfilled at the end of this routine.&n;&t; */
id|WRITE32
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|q
op_assign
id|p
suffix:semicolon
id|p
op_add_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|iap-&gt;ia_valid
op_amp
id|ATTR_SIZE
)paren
(brace
id|bmval0
op_or_assign
id|FATTR4_WORD0_SIZE
suffix:semicolon
id|WRITE64
c_func
(paren
id|iap-&gt;ia_size
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|iap-&gt;ia_valid
op_amp
id|ATTR_MODE
)paren
(brace
id|bmval1
op_or_assign
id|FATTR4_WORD1_MODE
suffix:semicolon
id|WRITE32
c_func
(paren
id|iap-&gt;ia_mode
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|iap-&gt;ia_valid
op_amp
id|ATTR_UID
)paren
(brace
id|bmval1
op_or_assign
id|FATTR4_WORD1_OWNER
suffix:semicolon
id|WRITE32
c_func
(paren
id|owner_namelen
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|owner_name
comma
id|owner_namelen
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|iap-&gt;ia_valid
op_amp
id|ATTR_GID
)paren
(brace
id|bmval1
op_or_assign
id|FATTR4_WORD1_OWNER_GROUP
suffix:semicolon
id|WRITE32
c_func
(paren
id|owner_grouplen
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|owner_group
comma
id|owner_grouplen
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|iap-&gt;ia_valid
op_amp
id|ATTR_ATIME_SET
)paren
(brace
id|bmval1
op_or_assign
id|FATTR4_WORD1_TIME_ACCESS_SET
suffix:semicolon
id|WRITE32
c_func
(paren
id|NFS4_SET_TO_CLIENT_TIME
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|iap-&gt;ia_mtime.tv_sec
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|iap-&gt;ia_mtime.tv_nsec
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|iap-&gt;ia_valid
op_amp
id|ATTR_ATIME
)paren
(brace
id|bmval1
op_or_assign
id|FATTR4_WORD1_TIME_ACCESS_SET
suffix:semicolon
id|WRITE32
c_func
(paren
id|NFS4_SET_TO_SERVER_TIME
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|iap-&gt;ia_valid
op_amp
id|ATTR_MTIME_SET
)paren
(brace
id|bmval1
op_or_assign
id|FATTR4_WORD1_TIME_MODIFY_SET
suffix:semicolon
id|WRITE32
c_func
(paren
id|NFS4_SET_TO_CLIENT_TIME
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|iap-&gt;ia_mtime.tv_sec
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|iap-&gt;ia_mtime.tv_nsec
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|iap-&gt;ia_valid
op_amp
id|ATTR_MTIME
)paren
(brace
id|bmval1
op_or_assign
id|FATTR4_WORD1_TIME_MODIFY_SET
suffix:semicolon
id|WRITE32
c_func
(paren
id|NFS4_SET_TO_SERVER_TIME
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Now we backfill the bitmap and the attribute buffer length.&n;&t; */
r_if
c_cond
(paren
id|len
op_ne
(paren
(paren
r_char
op_star
)paren
id|p
op_minus
(paren
r_char
op_star
)paren
id|q
)paren
op_plus
l_int|4
)paren
(brace
id|printk
(paren
l_string|&quot;encode_attr: Attr length calculation error! %u != %Zu&bslash;n&quot;
comma
id|len
comma
(paren
(paren
r_char
op_star
)paren
id|p
op_minus
(paren
r_char
op_star
)paren
id|q
)paren
op_plus
l_int|4
)paren
suffix:semicolon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
id|len
op_assign
(paren
r_char
op_star
)paren
id|p
op_minus
(paren
r_char
op_star
)paren
id|q
op_minus
l_int|12
suffix:semicolon
op_star
id|q
op_increment
op_assign
id|htonl
c_func
(paren
id|bmval0
)paren
suffix:semicolon
op_star
id|q
op_increment
op_assign
id|htonl
c_func
(paren
id|bmval1
)paren
suffix:semicolon
op_star
id|q
op_increment
op_assign
id|htonl
c_func
(paren
id|len
)paren
suffix:semicolon
id|status
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* out: */
r_return
id|status
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_access
id|encode_access
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_access
op_star
id|access
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_ACCESS
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|access-&gt;ac_req_access
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_close
id|encode_close
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs_closeargs
op_star
id|arg
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|8
op_plus
r_sizeof
(paren
id|arg-&gt;stateid.data
)paren
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_CLOSE
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|arg-&gt;seqid
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|arg-&gt;stateid.data
comma
r_sizeof
(paren
id|arg-&gt;stateid.data
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_commit
id|encode_commit
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs_writeargs
op_star
id|args
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|16
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_COMMIT
)paren
suffix:semicolon
id|WRITE64
c_func
(paren
id|args-&gt;offset
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|args-&gt;count
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_create
id|encode_create
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_create
op_star
id|create
comma
r_struct
id|nfs_server
op_star
id|server
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_CREATE
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|create-&gt;cr_ftype
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|create-&gt;cr_ftype
)paren
(brace
r_case
id|NF4LNK
suffix:colon
id|RESERVE_SPACE
c_func
(paren
l_int|4
op_plus
id|create-&gt;cr_textlen
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|create-&gt;cr_textlen
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|create-&gt;cr_text
comma
id|create-&gt;cr_textlen
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NF4BLK
suffix:colon
r_case
id|NF4CHR
suffix:colon
id|RESERVE_SPACE
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|create-&gt;cr_specdata1
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|create-&gt;cr_specdata2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|RESERVE_SPACE
c_func
(paren
l_int|4
op_plus
id|create-&gt;cr_namelen
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|create-&gt;cr_namelen
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|create-&gt;cr_name
comma
id|create-&gt;cr_namelen
)paren
suffix:semicolon
r_return
id|encode_attrs
c_func
(paren
id|xdr
comma
id|create-&gt;cr_attrs
comma
id|server
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_getattr_one
id|encode_getattr_one
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_uint32
id|bitmap
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|12
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_GETATTR
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|bitmap
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_getattr_two
id|encode_getattr_two
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_uint32
id|bm0
comma
r_uint32
id|bm1
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|16
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_GETATTR
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|bm0
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|bm1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|encode_getattr
id|encode_getattr
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_getattr
op_star
id|getattr
)paren
(brace
r_return
id|encode_getattr_two
c_func
(paren
id|xdr
comma
id|getattr-&gt;gt_bmval
(braket
l_int|0
)braket
comma
id|getattr-&gt;gt_bmval
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Request the change attribute in order to check attribute+cache consistency&n; */
r_static
r_inline
r_int
DECL|function|encode_read_getattr
id|encode_read_getattr
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
)paren
(brace
r_return
id|encode_getattr_two
c_func
(paren
id|xdr
comma
id|FATTR4_WORD0_CHANGE
comma
id|FATTR4_WORD1_TIME_ACCESS
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Request the change attribute prior to doing a write operation&n; */
r_static
r_inline
r_int
DECL|function|encode_pre_write_getattr
id|encode_pre_write_getattr
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
)paren
(brace
multiline_comment|/* Request the change attribute */
r_return
id|encode_getattr_one
c_func
(paren
id|xdr
comma
id|FATTR4_WORD0_CHANGE
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Request the change attribute, size, and [cm]time after a write operation&n; */
r_static
r_inline
r_int
DECL|function|encode_post_write_getattr
id|encode_post_write_getattr
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
)paren
(brace
r_return
id|encode_getattr_two
c_func
(paren
id|xdr
comma
id|FATTR4_WORD0_CHANGE
op_or
id|FATTR4_WORD0_SIZE
comma
id|FATTR4_WORD1_SPACE_USED
op_or
id|FATTR4_WORD1_TIME_METADATA
op_or
id|FATTR4_WORD1_TIME_MODIFY
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_getfh
id|encode_getfh
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_GETFH
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_link
id|encode_link
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_link
op_star
id|link
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|8
op_plus
id|link-&gt;ln_namelen
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_LINK
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|link-&gt;ln_namelen
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|link-&gt;ln_name
comma
id|link-&gt;ln_namelen
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_lookup
id|encode_lookup
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_lookup
op_star
id|lookup
)paren
(brace
r_int
id|len
op_assign
id|lookup-&gt;lo_name-&gt;len
suffix:semicolon
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|8
op_plus
id|len
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_LOOKUP
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|len
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|lookup-&gt;lo_name-&gt;name
comma
id|len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_open
id|encode_open
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs_openargs
op_star
id|arg
)paren
(brace
r_int
id|status
suffix:semicolon
r_uint32
op_star
id|p
suffix:semicolon
multiline_comment|/*&n; * opcode 4, seqid 4, share_access 4, share_deny 4, clientid 8, ownerlen 4,&n; * owner 4, opentype 4 = 36&n; */
id|RESERVE_SPACE
c_func
(paren
l_int|36
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_OPEN
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|arg-&gt;seqid
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|arg-&gt;share_access
)paren
(brace
r_case
id|FMODE_READ
suffix:colon
id|WRITE32
c_func
(paren
id|NFS4_SHARE_ACCESS_READ
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FMODE_WRITE
suffix:colon
id|WRITE32
c_func
(paren
id|NFS4_SHARE_ACCESS_WRITE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FMODE_READ
op_or
id|FMODE_WRITE
suffix:colon
id|WRITE32
c_func
(paren
id|NFS4_SHARE_ACCESS_BOTH
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* for linux, share_deny = 0 always */
id|WRITE64
c_func
(paren
id|arg-&gt;clientid
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|arg-&gt;id
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|arg-&gt;opentype
)paren
suffix:semicolon
r_if
c_cond
(paren
id|arg-&gt;opentype
op_eq
id|NFS4_OPEN_CREATE
)paren
(brace
r_if
c_cond
(paren
id|arg-&gt;createmode
op_eq
id|NFS4_CREATE_EXCLUSIVE
)paren
(brace
id|RESERVE_SPACE
c_func
(paren
l_int|12
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|arg-&gt;createmode
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|arg-&gt;u.verifier.data
comma
r_sizeof
(paren
id|arg-&gt;u.verifier.data
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|arg-&gt;u.attrs
)paren
(brace
id|RESERVE_SPACE
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|arg-&gt;createmode
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|encode_attrs
c_func
(paren
id|xdr
comma
id|arg-&gt;u.attrs
comma
id|arg-&gt;server
)paren
)paren
)paren
r_return
id|status
suffix:semicolon
)brace
r_else
(brace
id|RESERVE_SPACE
c_func
(paren
l_int|12
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|arg-&gt;createmode
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
)brace
id|RESERVE_SPACE
c_func
(paren
l_int|8
op_plus
id|arg-&gt;name-&gt;len
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|NFS4_OPEN_CLAIM_NULL
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|arg-&gt;name-&gt;len
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|arg-&gt;name-&gt;name
comma
id|arg-&gt;name-&gt;len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_open_confirm
id|encode_open_confirm
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs_open_confirmargs
op_star
id|arg
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|8
op_plus
r_sizeof
(paren
id|arg-&gt;stateid.data
)paren
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_OPEN_CONFIRM
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|arg-&gt;stateid.data
comma
r_sizeof
(paren
id|arg-&gt;stateid.data
)paren
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|arg-&gt;seqid
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_putfh
id|encode_putfh
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs_fh
op_star
id|fh
)paren
(brace
r_int
id|len
op_assign
id|fh-&gt;size
suffix:semicolon
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|8
op_plus
id|len
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_PUTFH
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|len
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|fh-&gt;data
comma
id|len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_putrootfh
id|encode_putrootfh
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_PUTROOTFH
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_read
id|encode_read
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs_readargs
op_star
id|args
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|32
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_READ
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|args-&gt;stateid.data
comma
r_sizeof
(paren
id|args-&gt;stateid.data
)paren
)paren
suffix:semicolon
id|WRITE64
c_func
(paren
id|args-&gt;offset
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|args-&gt;count
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_readdir
id|encode_readdir
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_readdir
op_star
id|readdir
comma
r_struct
id|rpc_rqst
op_star
id|req
)paren
(brace
r_struct
id|rpc_auth
op_star
id|auth
op_assign
id|req-&gt;rq_task-&gt;tk_auth
suffix:semicolon
r_int
id|replen
suffix:semicolon
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|32
op_plus
r_sizeof
(paren
id|nfs4_verifier
)paren
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_READDIR
)paren
suffix:semicolon
id|WRITE64
c_func
(paren
id|readdir-&gt;rd_cookie
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|readdir-&gt;rd_req_verifier.data
comma
r_sizeof
(paren
id|readdir-&gt;rd_req_verifier.data
)paren
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|readdir-&gt;rd_count
op_rshift
l_int|5
)paren
suffix:semicolon
multiline_comment|/* meaningless &quot;dircount&quot; field */
id|WRITE32
c_func
(paren
id|readdir-&gt;rd_count
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|readdir-&gt;rd_bmval
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|readdir-&gt;rd_bmval
(braket
l_int|1
)braket
)paren
suffix:semicolon
multiline_comment|/* set up reply iovec&n;&t; *    toplevel_status + taglen + rescount + OP_PUTFH + status&n;&t; *      + OP_READDIR + status + verifer(2)  = 9&n;&t; */
id|replen
op_assign
(paren
id|RPC_REPHDRSIZE
op_plus
id|auth-&gt;au_rslack
op_plus
l_int|9
)paren
op_lshift
l_int|2
suffix:semicolon
id|xdr_inline_pages
c_func
(paren
op_amp
id|req-&gt;rq_rcv_buf
comma
id|replen
comma
id|readdir-&gt;rd_pages
comma
id|readdir-&gt;rd_pgbase
comma
id|readdir-&gt;rd_count
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_readlink
id|encode_readlink
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_readlink
op_star
id|readlink
comma
r_struct
id|rpc_rqst
op_star
id|req
)paren
(brace
r_struct
id|rpc_auth
op_star
id|auth
op_assign
id|req-&gt;rq_task-&gt;tk_auth
suffix:semicolon
r_int
id|replen
suffix:semicolon
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_READLINK
)paren
suffix:semicolon
multiline_comment|/* set up reply iovec&n;&t; *    toplevel_status + taglen + rescount + OP_PUTFH + status&n;&t; *      + OP_READLINK + status  = 7&n;&t; */
id|replen
op_assign
(paren
id|RPC_REPHDRSIZE
op_plus
id|auth-&gt;au_rslack
op_plus
l_int|7
)paren
op_lshift
l_int|2
suffix:semicolon
id|xdr_inline_pages
c_func
(paren
op_amp
id|req-&gt;rq_rcv_buf
comma
id|replen
comma
id|readlink-&gt;rl_pages
comma
l_int|0
comma
id|readlink-&gt;rl_count
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_remove
id|encode_remove
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_remove
op_star
id|remove
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|8
op_plus
id|remove-&gt;rm_namelen
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_REMOVE
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|remove-&gt;rm_namelen
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|remove-&gt;rm_name
comma
id|remove-&gt;rm_namelen
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_rename
id|encode_rename
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_rename
op_star
id|rename
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|8
op_plus
id|rename-&gt;rn_oldnamelen
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_RENAME
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|rename-&gt;rn_oldnamelen
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|rename-&gt;rn_oldname
comma
id|rename-&gt;rn_oldnamelen
)paren
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|4
op_plus
id|rename-&gt;rn_newnamelen
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|rename-&gt;rn_newnamelen
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|rename-&gt;rn_newname
comma
id|rename-&gt;rn_newnamelen
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_renew
id|encode_renew
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_client
op_star
id|client_stateid
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|12
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_RENEW
)paren
suffix:semicolon
id|WRITE64
c_func
(paren
id|client_stateid-&gt;cl_clientid
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_restorefh
id|encode_restorefh
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_RESTOREFH
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_savefh
id|encode_savefh
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_SAVEFH
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_setattr
id|encode_setattr
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs_setattrargs
op_star
id|arg
comma
r_struct
id|nfs_server
op_star
id|server
)paren
(brace
r_int
id|status
suffix:semicolon
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|4
op_plus
r_sizeof
(paren
id|arg-&gt;stateid.data
)paren
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_SETATTR
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|arg-&gt;stateid.data
comma
r_sizeof
(paren
id|arg-&gt;stateid.data
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|encode_attrs
c_func
(paren
id|xdr
comma
id|arg-&gt;iap
comma
id|server
)paren
)paren
)paren
r_return
id|status
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_setclientid
id|encode_setclientid
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_setclientid
op_star
id|setclientid
)paren
(brace
r_uint32
id|total_len
suffix:semicolon
r_uint32
id|len1
comma
id|len2
comma
id|len3
suffix:semicolon
r_uint32
op_star
id|p
suffix:semicolon
id|len1
op_assign
id|strlen
c_func
(paren
id|setclientid-&gt;sc_name
)paren
suffix:semicolon
id|len2
op_assign
id|strlen
c_func
(paren
id|setclientid-&gt;sc_netid
)paren
suffix:semicolon
id|len3
op_assign
id|strlen
c_func
(paren
id|setclientid-&gt;sc_uaddr
)paren
suffix:semicolon
id|total_len
op_assign
id|XDR_QUADLEN
c_func
(paren
id|len1
)paren
op_plus
id|XDR_QUADLEN
c_func
(paren
id|len2
)paren
op_plus
id|XDR_QUADLEN
c_func
(paren
id|len3
)paren
suffix:semicolon
id|total_len
op_assign
(paren
id|total_len
op_lshift
l_int|2
)paren
op_plus
l_int|24
op_plus
r_sizeof
(paren
id|setclientid-&gt;sc_verifier.data
)paren
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
id|total_len
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_SETCLIENTID
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|setclientid-&gt;sc_verifier.data
comma
r_sizeof
(paren
id|setclientid-&gt;sc_verifier.data
)paren
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|len1
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|setclientid-&gt;sc_name
comma
id|len1
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|setclientid-&gt;sc_prog
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|len2
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|setclientid-&gt;sc_netid
comma
id|len2
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|len3
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|setclientid-&gt;sc_uaddr
comma
id|len3
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|setclientid-&gt;sc_cb_ident
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_setclientid_confirm
id|encode_setclientid_confirm
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_client
op_star
id|client_state
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|12
op_plus
r_sizeof
(paren
id|client_state-&gt;cl_confirm.data
)paren
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_SETCLIENTID_CONFIRM
)paren
suffix:semicolon
id|WRITE64
c_func
(paren
id|client_state-&gt;cl_clientid
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|client_state-&gt;cl_confirm.data
comma
r_sizeof
(paren
id|client_state-&gt;cl_confirm.data
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|encode_write
id|encode_write
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs_writeargs
op_star
id|args
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|RESERVE_SPACE
c_func
(paren
l_int|36
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|OP_WRITE
)paren
suffix:semicolon
id|WRITEMEM
c_func
(paren
id|args-&gt;stateid.data
comma
r_sizeof
(paren
id|args-&gt;stateid.data
)paren
)paren
suffix:semicolon
id|WRITE64
c_func
(paren
id|args-&gt;offset
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|args-&gt;stable
)paren
suffix:semicolon
id|WRITE32
c_func
(paren
id|args-&gt;count
)paren
suffix:semicolon
id|xdr_write_pages
c_func
(paren
id|xdr
comma
id|args-&gt;pages
comma
id|args-&gt;pgbase
comma
id|args-&gt;count
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* FIXME: this sucks */
r_static
r_int
DECL|function|encode_compound
id|encode_compound
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|rpc_rqst
op_star
id|req
)paren
(brace
r_struct
id|compound_hdr
id|hdr
op_assign
(brace
dot
id|taglen
op_assign
id|cp-&gt;taglen
comma
dot
id|tag
op_assign
id|cp-&gt;tag
comma
dot
id|nops
op_assign
id|cp-&gt;req_nops
comma
)brace
suffix:semicolon
r_int
id|i
comma
id|status
op_assign
l_int|0
suffix:semicolon
id|encode_compound_hdr
c_func
(paren
id|xdr
comma
op_amp
id|hdr
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cp-&gt;req_nops
suffix:semicolon
id|i
op_increment
)paren
(brace
r_switch
c_cond
(paren
id|cp-&gt;ops
(braket
id|i
)braket
dot
id|opnum
)paren
(brace
r_case
id|OP_ACCESS
suffix:colon
id|status
op_assign
id|encode_access
c_func
(paren
id|xdr
comma
op_amp
id|cp-&gt;ops
(braket
id|i
)braket
dot
id|u.access
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_CREATE
suffix:colon
id|status
op_assign
id|encode_create
c_func
(paren
id|xdr
comma
op_amp
id|cp-&gt;ops
(braket
id|i
)braket
dot
id|u.create
comma
id|cp-&gt;server
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_GETATTR
suffix:colon
id|status
op_assign
id|encode_getattr
c_func
(paren
id|xdr
comma
op_amp
id|cp-&gt;ops
(braket
id|i
)braket
dot
id|u.getattr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_GETFH
suffix:colon
id|status
op_assign
id|encode_getfh
c_func
(paren
id|xdr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_LINK
suffix:colon
id|status
op_assign
id|encode_link
c_func
(paren
id|xdr
comma
op_amp
id|cp-&gt;ops
(braket
id|i
)braket
dot
id|u.link
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_LOOKUP
suffix:colon
id|status
op_assign
id|encode_lookup
c_func
(paren
id|xdr
comma
op_amp
id|cp-&gt;ops
(braket
id|i
)braket
dot
id|u.lookup
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_PUTFH
suffix:colon
id|status
op_assign
id|encode_putfh
c_func
(paren
id|xdr
comma
id|cp-&gt;ops
(braket
id|i
)braket
dot
id|u.putfh.pf_fhandle
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_PUTROOTFH
suffix:colon
id|status
op_assign
id|encode_putrootfh
c_func
(paren
id|xdr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_READDIR
suffix:colon
id|status
op_assign
id|encode_readdir
c_func
(paren
id|xdr
comma
op_amp
id|cp-&gt;ops
(braket
id|i
)braket
dot
id|u.readdir
comma
id|req
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_READLINK
suffix:colon
id|status
op_assign
id|encode_readlink
c_func
(paren
id|xdr
comma
op_amp
id|cp-&gt;ops
(braket
id|i
)braket
dot
id|u.readlink
comma
id|req
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_REMOVE
suffix:colon
id|status
op_assign
id|encode_remove
c_func
(paren
id|xdr
comma
op_amp
id|cp-&gt;ops
(braket
id|i
)braket
dot
id|u.remove
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_RENAME
suffix:colon
id|status
op_assign
id|encode_rename
c_func
(paren
id|xdr
comma
op_amp
id|cp-&gt;ops
(braket
id|i
)braket
dot
id|u.rename
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_RENEW
suffix:colon
id|status
op_assign
id|encode_renew
c_func
(paren
id|xdr
comma
id|cp-&gt;ops
(braket
id|i
)braket
dot
id|u.renew
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_RESTOREFH
suffix:colon
id|status
op_assign
id|encode_restorefh
c_func
(paren
id|xdr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_SAVEFH
suffix:colon
id|status
op_assign
id|encode_savefh
c_func
(paren
id|xdr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_SETCLIENTID
suffix:colon
id|status
op_assign
id|encode_setclientid
c_func
(paren
id|xdr
comma
op_amp
id|cp-&gt;ops
(braket
id|i
)braket
dot
id|u.setclientid
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_SETCLIENTID_CONFIRM
suffix:colon
id|status
op_assign
id|encode_setclientid_confirm
c_func
(paren
id|xdr
comma
id|cp-&gt;ops
(braket
id|i
)braket
dot
id|u.setclientid_confirm
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
)paren
r_return
id|status
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * END OF &quot;GENERIC&quot; ENCODE ROUTINES.&n; */
multiline_comment|/*&n; * Encode COMPOUND argument&n; */
r_static
r_int
DECL|function|nfs4_xdr_enc_compound
id|nfs4_xdr_enc_compound
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
r_uint32
op_star
id|p
comma
r_struct
id|nfs4_compound
op_star
id|cp
)paren
(brace
r_struct
id|xdr_stream
id|xdr
suffix:semicolon
r_int
id|status
suffix:semicolon
id|xdr_init_encode
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|req-&gt;rq_snd_buf
comma
id|p
)paren
suffix:semicolon
id|status
op_assign
id|encode_compound
c_func
(paren
op_amp
id|xdr
comma
id|cp
comma
id|req
)paren
suffix:semicolon
id|cp-&gt;timestamp
op_assign
id|jiffies
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode a CLOSE request&n; */
r_static
r_int
DECL|function|nfs4_xdr_enc_close
id|nfs4_xdr_enc_close
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
r_uint32
op_star
id|p
comma
r_struct
id|nfs_closeargs
op_star
id|args
)paren
(brace
r_struct
id|xdr_stream
id|xdr
suffix:semicolon
r_struct
id|compound_hdr
id|hdr
op_assign
(brace
dot
id|nops
op_assign
l_int|2
comma
)brace
suffix:semicolon
r_int
id|status
suffix:semicolon
id|xdr_init_encode
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|req-&gt;rq_snd_buf
comma
id|p
)paren
suffix:semicolon
id|encode_compound_hdr
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|hdr
)paren
suffix:semicolon
id|status
op_assign
id|encode_putfh
c_func
(paren
op_amp
id|xdr
comma
id|args-&gt;fh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|status
op_assign
id|encode_close
c_func
(paren
op_amp
id|xdr
comma
id|args
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode an OPEN request&n; */
r_static
r_int
DECL|function|nfs4_xdr_enc_open
id|nfs4_xdr_enc_open
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
r_uint32
op_star
id|p
comma
r_struct
id|nfs_openargs
op_star
id|args
)paren
(brace
r_struct
id|xdr_stream
id|xdr
suffix:semicolon
r_struct
id|compound_hdr
id|hdr
op_assign
(brace
dot
id|nops
op_assign
l_int|7
comma
)brace
suffix:semicolon
r_int
id|status
suffix:semicolon
id|xdr_init_encode
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|req-&gt;rq_snd_buf
comma
id|p
)paren
suffix:semicolon
id|encode_compound_hdr
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|hdr
)paren
suffix:semicolon
id|status
op_assign
id|encode_putfh
c_func
(paren
op_amp
id|xdr
comma
id|args-&gt;fh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|encode_savefh
c_func
(paren
op_amp
id|xdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|encode_open
c_func
(paren
op_amp
id|xdr
comma
id|args
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|encode_getattr
c_func
(paren
op_amp
id|xdr
comma
id|args-&gt;f_getattr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|encode_getfh
c_func
(paren
op_amp
id|xdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|encode_restorefh
c_func
(paren
op_amp
id|xdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|encode_getattr
c_func
(paren
op_amp
id|xdr
comma
id|args-&gt;d_getattr
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode an OPEN_CONFIRM request&n; */
r_static
r_int
DECL|function|nfs4_xdr_enc_open_confirm
id|nfs4_xdr_enc_open_confirm
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
r_uint32
op_star
id|p
comma
r_struct
id|nfs_open_confirmargs
op_star
id|args
)paren
(brace
r_struct
id|xdr_stream
id|xdr
suffix:semicolon
r_struct
id|compound_hdr
id|hdr
op_assign
(brace
dot
id|nops
op_assign
l_int|2
comma
)brace
suffix:semicolon
r_int
id|status
suffix:semicolon
id|xdr_init_encode
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|req-&gt;rq_snd_buf
comma
id|p
)paren
suffix:semicolon
id|encode_compound_hdr
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|hdr
)paren
suffix:semicolon
id|status
op_assign
id|encode_putfh
c_func
(paren
op_amp
id|xdr
comma
id|args-&gt;fh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|status
op_assign
id|encode_open_confirm
c_func
(paren
op_amp
id|xdr
comma
id|args
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode a READ request&n; */
r_static
r_int
DECL|function|nfs4_xdr_enc_read
id|nfs4_xdr_enc_read
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
r_uint32
op_star
id|p
comma
r_struct
id|nfs_readargs
op_star
id|args
)paren
(brace
r_struct
id|rpc_auth
op_star
id|auth
op_assign
id|req-&gt;rq_task-&gt;tk_auth
suffix:semicolon
r_struct
id|xdr_stream
id|xdr
suffix:semicolon
r_struct
id|compound_hdr
id|hdr
op_assign
(brace
dot
id|nops
op_assign
l_int|3
comma
)brace
suffix:semicolon
r_int
id|replen
comma
id|status
suffix:semicolon
id|xdr_init_encode
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|req-&gt;rq_snd_buf
comma
id|p
)paren
suffix:semicolon
id|encode_compound_hdr
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|hdr
)paren
suffix:semicolon
id|status
op_assign
id|encode_putfh
c_func
(paren
op_amp
id|xdr
comma
id|args-&gt;fh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|encode_read
c_func
(paren
op_amp
id|xdr
comma
id|args
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|encode_read_getattr
c_func
(paren
op_amp
id|xdr
)paren
suffix:semicolon
multiline_comment|/* set up reply iovec&n;&t; *    toplevel status + taglen=0 + rescount + OP_PUTFH + status&n;&t; *       + OP_READ + status + eof + datalen = 9&n;&t; */
id|replen
op_assign
(paren
id|RPC_REPHDRSIZE
op_plus
id|auth-&gt;au_rslack
op_plus
id|NFS4_dec_read_sz
op_minus
id|decode_read_getattr_maxsz
)paren
op_lshift
l_int|2
suffix:semicolon
id|xdr_inline_pages
c_func
(paren
op_amp
id|req-&gt;rq_rcv_buf
comma
id|replen
comma
id|args-&gt;pages
comma
id|args-&gt;pgbase
comma
id|args-&gt;count
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode an SETATTR request&n; */
r_static
r_int
DECL|function|nfs4_xdr_enc_setattr
id|nfs4_xdr_enc_setattr
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
r_uint32
op_star
id|p
comma
r_struct
id|nfs_setattrargs
op_star
id|args
)paren
(brace
r_struct
id|xdr_stream
id|xdr
suffix:semicolon
r_struct
id|compound_hdr
id|hdr
op_assign
(brace
dot
id|nops
op_assign
l_int|3
comma
)brace
suffix:semicolon
r_int
id|status
suffix:semicolon
id|xdr_init_encode
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|req-&gt;rq_snd_buf
comma
id|p
)paren
suffix:semicolon
id|encode_compound_hdr
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|hdr
)paren
suffix:semicolon
id|status
op_assign
id|encode_putfh
c_func
(paren
op_amp
id|xdr
comma
id|args-&gt;fh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|status
op_assign
id|encode_setattr
c_func
(paren
op_amp
id|xdr
comma
id|args
comma
id|args-&gt;server
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|status
op_assign
id|encode_getattr
c_func
(paren
op_amp
id|xdr
comma
id|args-&gt;attr
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Encode a WRITE request&n; */
r_static
r_int
DECL|function|nfs4_xdr_enc_write
id|nfs4_xdr_enc_write
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
r_uint32
op_star
id|p
comma
r_struct
id|nfs_writeargs
op_star
id|args
)paren
(brace
r_struct
id|xdr_stream
id|xdr
suffix:semicolon
r_struct
id|compound_hdr
id|hdr
op_assign
(brace
dot
id|nops
op_assign
l_int|4
comma
)brace
suffix:semicolon
r_int
id|status
suffix:semicolon
id|xdr_init_encode
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|req-&gt;rq_snd_buf
comma
id|p
)paren
suffix:semicolon
id|encode_compound_hdr
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|hdr
)paren
suffix:semicolon
id|status
op_assign
id|encode_putfh
c_func
(paren
op_amp
id|xdr
comma
id|args-&gt;fh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|encode_pre_write_getattr
c_func
(paren
op_amp
id|xdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|encode_write
c_func
(paren
op_amp
id|xdr
comma
id|args
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|encode_post_write_getattr
c_func
(paren
op_amp
id|xdr
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; *  a COMMIT request&n; */
r_static
r_int
DECL|function|nfs4_xdr_enc_commit
id|nfs4_xdr_enc_commit
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|req
comma
r_uint32
op_star
id|p
comma
r_struct
id|nfs_writeargs
op_star
id|args
)paren
(brace
r_struct
id|xdr_stream
id|xdr
suffix:semicolon
r_struct
id|compound_hdr
id|hdr
op_assign
(brace
dot
id|nops
op_assign
l_int|4
comma
)brace
suffix:semicolon
r_int
id|status
suffix:semicolon
id|xdr_init_encode
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|req-&gt;rq_snd_buf
comma
id|p
)paren
suffix:semicolon
id|encode_compound_hdr
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|hdr
)paren
suffix:semicolon
id|status
op_assign
id|encode_putfh
c_func
(paren
op_amp
id|xdr
comma
id|args-&gt;fh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|encode_pre_write_getattr
c_func
(paren
op_amp
id|xdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|encode_commit
c_func
(paren
op_amp
id|xdr
comma
id|args
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|encode_post_write_getattr
c_func
(paren
op_amp
id|xdr
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * START OF &quot;GENERIC&quot; DECODE ROUTINES.&n; *   These may look a little ugly since they are imported from a &quot;generic&quot;&n; * set of XDR encode/decode routines which are intended to be shared by&n; * all of our NFSv4 implementations (OpenBSD, MacOS X...).&n; *&n; * If the pain of reading these is too great, it should be a straightforward&n; * task to translate them into Linux-specific versions which are more&n; * consistent with the style used in NFSv2/v3...&n; */
DECL|macro|DECODE_TAIL
mdefine_line|#define DECODE_TAIL&t;&t;&t;&t;&bslash;&n;&t;status = 0;&t;&t;&t;&t;&bslash;&n;out:&t;&t;&t;&t;&t;&t;&bslash;&n;&t;return status;&t;&t;&t;&t;&bslash;&n;xdr_error:&t;&t;&t;&t;&t;&bslash;&n;&t;printk(KERN_NOTICE &quot;xdr error! (%s:%d)&bslash;n&quot;, __FILE__, __LINE__); &bslash;&n;&t;status = -EIO;&t;&t;&t;&t;&bslash;&n;&t;goto out
DECL|macro|READ32
mdefine_line|#define READ32(x)         (x) = ntohl(*p++)
DECL|macro|READ64
mdefine_line|#define READ64(x)         do {&t;&t;&t;&bslash;&n;&t;(x) = (u64)ntohl(*p++) &lt;&lt; 32;&t;&t;&bslash;&n;&t;(x) |= ntohl(*p++);&t;&t;&t;&bslash;&n;} while (0)
DECL|macro|READTIME
mdefine_line|#define READTIME(x)       do {&t;&t;&t;&bslash;&n;&t;p++;&t;&t;&t;&t;&t;&bslash;&n;&t;(x.tv_sec) = ntohl(*p++);&t;&t;&bslash;&n;&t;(x.tv_nsec) = ntohl(*p++);&t;&t;&bslash;&n;} while (0)
DECL|macro|COPYMEM
mdefine_line|#define COPYMEM(x,nbytes) do {&t;&t;&t;&bslash;&n;&t;memcpy((x), p, nbytes);&t;&t;&t;&bslash;&n;&t;p += XDR_QUADLEN(nbytes);&t;&t;&bslash;&n;} while (0)
DECL|macro|READ_BUF
mdefine_line|#define READ_BUF(nbytes)  do { &bslash;&n;&t;p = xdr_inline_decode(xdr, nbytes); &bslash;&n;&t;if (!p) { &bslash;&n;&t;&t;printk(KERN_WARNING &quot;%s: reply buffer overflowed in line %d.&quot;, &bslash;&n;&t;&t;&t;       &t;__FUNCTION__, __LINE__); &bslash;&n;&t;&t;return -EIO; &bslash;&n;&t;} &bslash;&n;} while (0)
r_static
r_int
DECL|function|decode_compound_hdr
id|decode_compound_hdr
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|compound_hdr
op_star
id|hdr
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|hdr-&gt;status
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|hdr-&gt;taglen
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|hdr-&gt;taglen
op_plus
l_int|4
)paren
suffix:semicolon
id|hdr-&gt;tag
op_assign
(paren
r_char
op_star
)paren
id|p
suffix:semicolon
id|p
op_add_assign
id|XDR_QUADLEN
c_func
(paren
id|hdr-&gt;taglen
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|hdr-&gt;nops
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_op_hdr
id|decode_op_hdr
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_enum
id|nfs_opnum4
id|expected
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
r_uint32
id|opnum
suffix:semicolon
r_int32
id|nfserr
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|opnum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opnum
op_ne
id|expected
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;nfs4_decode_op_hdr: Server returned operation&quot;
l_string|&quot; %d but we issued a request for %d&bslash;n&quot;
comma
id|opnum
comma
id|expected
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|READ32
c_func
(paren
id|nfserr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nfserr
op_ne
id|NFS_OK
)paren
r_return
op_minus
id|nfs_stat_to_errno
c_func
(paren
id|nfserr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_change_info
id|decode_change_info
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_change_info
op_star
id|cinfo
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|cinfo-&gt;atomic
)paren
suffix:semicolon
id|READ64
c_func
(paren
id|cinfo-&gt;before
)paren
suffix:semicolon
id|READ64
c_func
(paren
id|cinfo-&gt;after
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_access
id|decode_access
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_access
op_star
id|access
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
r_uint32
id|supp
comma
id|acc
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_ACCESS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
id|status
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|supp
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|acc
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|supp
op_amp
op_complement
id|access-&gt;ac_req_access
)paren
op_logical_or
(paren
id|acc
op_amp
op_complement
id|supp
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;NFS: server returned bad bits in access call!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
op_star
id|access-&gt;ac_resp_supported
op_assign
id|supp
suffix:semicolon
op_star
id|access-&gt;ac_resp_access
op_assign
id|acc
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_close
id|decode_close
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs_closeres
op_star
id|res
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_CLOSE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
id|status
suffix:semicolon
id|READ_BUF
c_func
(paren
r_sizeof
(paren
id|res-&gt;stateid.data
)paren
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
id|res-&gt;stateid.data
comma
r_sizeof
(paren
id|res-&gt;stateid.data
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_commit
id|decode_commit
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs_writeres
op_star
id|res
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_COMMIT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
id|status
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
id|res-&gt;verf-&gt;verifier
comma
l_int|8
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_create
id|decode_create
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_create
op_star
id|create
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
r_uint32
id|bmlen
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_CREATE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
id|status
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|decode_change_info
c_func
(paren
id|xdr
comma
id|create-&gt;cr_cinfo
)paren
)paren
)paren
r_return
id|status
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|bmlen
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|bmlen
op_lshift
l_int|2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_extern
r_uint32
id|nfs4_fattr_bitmap
(braket
l_int|2
)braket
suffix:semicolon
r_extern
r_uint32
id|nfs4_fsinfo_bitmap
(braket
l_int|2
)braket
suffix:semicolon
r_extern
r_uint32
id|nfs4_fsstat_bitmap
(braket
l_int|2
)braket
suffix:semicolon
r_extern
r_uint32
id|nfs4_pathconf_bitmap
(braket
l_int|2
)braket
suffix:semicolon
r_static
r_int
DECL|function|decode_getattr
id|decode_getattr
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_getattr
op_star
id|getattr
comma
r_struct
id|nfs_server
op_star
id|server
)paren
(brace
r_struct
id|nfs_fattr
op_star
id|nfp
op_assign
id|getattr-&gt;gt_attrs
suffix:semicolon
r_struct
id|nfs_fsstat
op_star
id|fsstat
op_assign
id|getattr-&gt;gt_fsstat
suffix:semicolon
r_struct
id|nfs_fsinfo
op_star
id|fsinfo
op_assign
id|getattr-&gt;gt_fsinfo
suffix:semicolon
r_struct
id|nfs_pathconf
op_star
id|pathconf
op_assign
id|getattr-&gt;gt_pathconf
suffix:semicolon
r_uint32
id|attrlen
comma
id|dummy32
comma
id|bmlen
comma
id|bmval0
op_assign
l_int|0
comma
id|bmval1
op_assign
l_int|0
comma
id|len
op_assign
l_int|0
suffix:semicolon
r_uint32
op_star
id|p
suffix:semicolon
r_int
r_int
id|type
suffix:semicolon
r_int
id|fmode
op_assign
l_int|0
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_GETATTR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
id|status
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|bmlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmlen
OG
l_int|2
)paren
r_goto
id|xdr_error
suffix:semicolon
id|READ_BUF
c_func
(paren
(paren
id|bmlen
op_lshift
l_int|2
)paren
op_plus
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmlen
OG
l_int|0
)paren
id|READ32
c_func
(paren
id|bmval0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmlen
OG
l_int|1
)paren
id|READ32
c_func
(paren
id|bmval1
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|attrlen
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bmval0
op_amp
op_complement
id|getattr-&gt;gt_bmval
(braket
l_int|0
)braket
)paren
op_logical_or
(paren
id|bmval1
op_amp
op_complement
id|getattr-&gt;gt_bmval
(braket
l_int|1
)braket
)paren
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: server returned bad attributes!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|xdr_error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nfp
)paren
(brace
id|nfp-&gt;bitmap
(braket
l_int|0
)braket
op_assign
id|bmval0
suffix:semicolon
id|nfp-&gt;bitmap
(braket
l_int|1
)braket
op_assign
id|bmval1
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * In case the server doesn&squot;t return some attributes,&n;&t; * we initialize them here to some nominal values..&n;&t; */
r_if
c_cond
(paren
id|nfp
)paren
(brace
id|nfp-&gt;valid
op_assign
id|NFS_ATTR_FATTR
op_or
id|NFS_ATTR_FATTR_V3
op_or
id|NFS_ATTR_FATTR_V4
suffix:semicolon
id|nfp-&gt;nlink
op_assign
l_int|1
suffix:semicolon
id|nfp-&gt;timestamp
op_assign
id|jiffies
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fsinfo
)paren
(brace
id|fsinfo-&gt;rtmult
op_assign
id|fsinfo-&gt;wtmult
op_assign
l_int|512
suffix:semicolon
multiline_comment|/* ??? */
id|fsinfo-&gt;lease_time
op_assign
l_int|60
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_TYPE
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|len
op_add_assign
l_int|4
suffix:semicolon
id|READ32
c_func
(paren
id|type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|type
template_param
id|NF4NAMEDATTR
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: bad type %d&bslash;n&quot;
comma
id|type
)paren
suffix:semicolon
r_goto
id|xdr_error
suffix:semicolon
)brace
id|nfp-&gt;type
op_assign
id|nfs_type2fmt
(braket
id|type
)braket
dot
id|nfs2type
suffix:semicolon
id|fmode
op_assign
id|nfs_type2fmt
(braket
id|type
)braket
dot
id|mode
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: type=%d&bslash;n&quot;
comma
(paren
r_uint32
)paren
id|nfp-&gt;type
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_CHANGE
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|len
op_add_assign
l_int|8
suffix:semicolon
id|READ64
c_func
(paren
id|nfp-&gt;change_attr
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: changeid=%Ld&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|nfp-&gt;change_attr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_SIZE
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|len
op_add_assign
l_int|8
suffix:semicolon
id|READ64
c_func
(paren
id|nfp-&gt;size
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: size=%Ld&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|nfp-&gt;size
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_FSID
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|16
)paren
suffix:semicolon
id|len
op_add_assign
l_int|16
suffix:semicolon
id|READ64
c_func
(paren
id|nfp-&gt;fsid_u.nfs4.major
)paren
suffix:semicolon
id|READ64
c_func
(paren
id|nfp-&gt;fsid_u.nfs4.minor
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: fsid=0x%Lx/0x%Lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|nfp-&gt;fsid_u.nfs4.major
comma
(paren
r_int
r_int
)paren
id|nfp-&gt;fsid_u.nfs4.minor
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_LEASE_TIME
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|len
op_add_assign
l_int|4
suffix:semicolon
id|READ32
c_func
(paren
id|fsinfo-&gt;lease_time
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: lease_time=%d&bslash;n&quot;
comma
id|fsinfo-&gt;lease_time
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_FILEID
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|len
op_add_assign
l_int|8
suffix:semicolon
id|READ64
c_func
(paren
id|nfp-&gt;fileid
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: fileid=%Ld&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|nfp-&gt;fileid
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_FILES_AVAIL
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|len
op_add_assign
l_int|8
suffix:semicolon
id|READ64
c_func
(paren
id|fsstat-&gt;afiles
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: files_avail=0x%Lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|fsstat-&gt;afiles
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_FILES_FREE
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|len
op_add_assign
l_int|8
suffix:semicolon
id|READ64
c_func
(paren
id|fsstat-&gt;ffiles
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: files_free=0x%Lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|fsstat-&gt;ffiles
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_FILES_TOTAL
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|len
op_add_assign
l_int|8
suffix:semicolon
id|READ64
c_func
(paren
id|fsstat-&gt;tfiles
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: files_tot=0x%Lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|fsstat-&gt;tfiles
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_MAXFILESIZE
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|len
op_add_assign
l_int|8
suffix:semicolon
id|READ64
c_func
(paren
id|fsinfo-&gt;maxfilesize
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: maxfilesize=0x%Lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|fsinfo-&gt;maxfilesize
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_MAXLINK
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|len
op_add_assign
l_int|4
suffix:semicolon
id|READ32
c_func
(paren
id|pathconf-&gt;max_link
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: maxlink=%d&bslash;n&quot;
comma
id|pathconf-&gt;max_link
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_MAXNAME
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|len
op_add_assign
l_int|4
suffix:semicolon
id|READ32
c_func
(paren
id|pathconf-&gt;max_namelen
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: maxname=%d&bslash;n&quot;
comma
id|pathconf-&gt;max_namelen
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_MAXREAD
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|len
op_add_assign
l_int|8
suffix:semicolon
id|READ64
c_func
(paren
id|fsinfo-&gt;rtmax
)paren
suffix:semicolon
id|fsinfo-&gt;rtpref
op_assign
id|fsinfo-&gt;dtpref
op_assign
id|fsinfo-&gt;rtmax
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: maxread=%d&bslash;n&quot;
comma
id|fsinfo-&gt;rtmax
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval0
op_amp
id|FATTR4_WORD0_MAXWRITE
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|len
op_add_assign
l_int|8
suffix:semicolon
id|READ64
c_func
(paren
id|fsinfo-&gt;wtmax
)paren
suffix:semicolon
id|fsinfo-&gt;wtpref
op_assign
id|fsinfo-&gt;wtmax
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: maxwrite=%d&bslash;n&quot;
comma
id|fsinfo-&gt;wtmax
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_MODE
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|len
op_add_assign
l_int|4
suffix:semicolon
id|READ32
c_func
(paren
id|dummy32
)paren
suffix:semicolon
id|nfp-&gt;mode
op_assign
(paren
id|dummy32
op_amp
op_complement
id|S_IFMT
)paren
op_or
id|fmode
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: mode=0%o&bslash;n&quot;
comma
id|nfp-&gt;mode
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_NUMLINKS
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|len
op_add_assign
l_int|4
suffix:semicolon
id|READ32
c_func
(paren
id|nfp-&gt;nlink
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: nlinks=0%o&bslash;n&quot;
comma
id|nfp-&gt;nlink
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_OWNER
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|len
op_add_assign
l_int|4
suffix:semicolon
id|READ32
c_func
(paren
id|dummy32
)paren
suffix:semicolon
multiline_comment|/* name length */
r_if
c_cond
(paren
id|dummy32
OG
id|XDR_MAX_NETOBJ
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: name too long!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|xdr_error
suffix:semicolon
)brace
id|READ_BUF
c_func
(paren
id|dummy32
)paren
suffix:semicolon
id|len
op_add_assign
(paren
id|XDR_QUADLEN
c_func
(paren
id|dummy32
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|nfs_idmap_id
c_func
(paren
id|server
comma
id|IDMAP_TYPE_USER
comma
(paren
r_char
op_star
)paren
id|p
comma
id|len
comma
op_amp
id|nfp-&gt;uid
)paren
)paren
op_eq
op_minus
l_int|1
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: gss_get_num failed!&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* goto out; */
id|nfp-&gt;uid
op_assign
op_minus
l_int|2
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: uid=%d&bslash;n&quot;
comma
(paren
r_int
)paren
id|nfp-&gt;uid
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_OWNER_GROUP
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|len
op_add_assign
l_int|4
suffix:semicolon
id|READ32
c_func
(paren
id|dummy32
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dummy32
OG
id|XDR_MAX_NETOBJ
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: name too long!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|xdr_error
suffix:semicolon
)brace
id|READ_BUF
c_func
(paren
id|dummy32
)paren
suffix:semicolon
id|len
op_add_assign
(paren
id|XDR_QUADLEN
c_func
(paren
id|dummy32
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|nfs_idmap_id
c_func
(paren
id|server
comma
id|IDMAP_TYPE_GROUP
comma
(paren
r_char
op_star
)paren
id|p
comma
id|len
comma
op_amp
id|nfp-&gt;gid
)paren
)paren
op_eq
op_minus
l_int|1
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: gss_get_num failed!&bslash;n&quot;
)paren
suffix:semicolon
id|nfp-&gt;gid
op_assign
op_minus
l_int|2
suffix:semicolon
multiline_comment|/* goto out; */
)brace
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: gid=%d&bslash;n&quot;
comma
(paren
r_int
)paren
id|nfp-&gt;gid
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_RAWDEV
)paren
(brace
r_uint32
id|major
comma
id|minor
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|len
op_add_assign
l_int|8
suffix:semicolon
id|READ32
c_func
(paren
id|major
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|minor
)paren
suffix:semicolon
id|nfp-&gt;rdev
op_assign
id|MKDEV
c_func
(paren
id|major
comma
id|minor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|MAJOR
c_func
(paren
id|nfp-&gt;rdev
)paren
op_ne
id|major
op_logical_or
id|MINOR
c_func
(paren
id|nfp-&gt;rdev
)paren
op_ne
id|minor
)paren
id|nfp-&gt;rdev
op_assign
l_int|0
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: rdev=%u:%u&bslash;n&quot;
comma
id|major
comma
id|minor
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_SPACE_AVAIL
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|len
op_add_assign
l_int|8
suffix:semicolon
id|READ64
c_func
(paren
id|fsstat-&gt;abytes
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: savail=0x%Lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|fsstat-&gt;abytes
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_SPACE_FREE
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|len
op_add_assign
l_int|8
suffix:semicolon
id|READ64
c_func
(paren
id|fsstat-&gt;fbytes
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: sfree=0x%Lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|fsstat-&gt;fbytes
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_SPACE_TOTAL
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|len
op_add_assign
l_int|8
suffix:semicolon
id|READ64
c_func
(paren
id|fsstat-&gt;tbytes
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: stotal=0x%Lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|fsstat-&gt;tbytes
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_SPACE_USED
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|len
op_add_assign
l_int|8
suffix:semicolon
id|READ64
c_func
(paren
id|nfp-&gt;du.nfs3.used
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: sused=0x%Lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|nfp-&gt;du.nfs3.used
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_TIME_ACCESS
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|12
)paren
suffix:semicolon
id|len
op_add_assign
l_int|12
suffix:semicolon
id|READTIME
c_func
(paren
id|nfp-&gt;atime
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: atime=%ld&bslash;n&quot;
comma
(paren
r_int
)paren
id|nfp-&gt;atime.tv_sec
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_TIME_METADATA
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|12
)paren
suffix:semicolon
id|len
op_add_assign
l_int|12
suffix:semicolon
id|READTIME
c_func
(paren
id|nfp-&gt;ctime
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: ctime=%ld&bslash;n&quot;
comma
(paren
r_int
)paren
id|nfp-&gt;ctime.tv_sec
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_TIME_MODIFY
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|12
)paren
suffix:semicolon
id|len
op_add_assign
l_int|12
suffix:semicolon
id|READTIME
c_func
(paren
id|nfp-&gt;mtime
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;read_attrs: mtime=%ld&bslash;n&quot;
comma
(paren
r_int
)paren
id|nfp-&gt;mtime.tv_sec
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
op_ne
id|attrlen
)paren
r_goto
id|xdr_error
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_change_attr
id|decode_change_attr
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_uint64
op_star
id|change_attr
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
r_uint32
id|attrlen
comma
id|bmlen
comma
id|bmval
op_assign
l_int|0
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_GETATTR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
id|status
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|bmlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmlen
OL
l_int|1
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|READ_BUF
c_func
(paren
id|bmlen
op_lshift
l_int|2
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|bmval
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmval
op_ne
id|FATTR4_WORD0_CHANGE
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;decode_change_attr: server returned bad attribute bitmap 0x%x&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|bmval
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|attrlen
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|attrlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|attrlen
OL
l_int|8
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;decode_change_attr: server returned bad attribute length %u&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|attrlen
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|READ64
c_func
(paren
op_star
id|change_attr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_read_getattr
id|decode_read_getattr
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
r_uint32
id|attrlen
comma
id|bmlen
comma
id|bmval0
op_assign
l_int|0
comma
id|bmval1
op_assign
l_int|0
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_GETATTR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
id|status
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|bmlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmlen
OL
l_int|1
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|READ_BUF
c_func
(paren
id|bmlen
op_lshift
l_int|2
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|bmval0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmval0
op_ne
id|FATTR4_WORD0_CHANGE
)paren
r_goto
id|out_bad_bitmap
suffix:semicolon
r_if
c_cond
(paren
id|bmlen
OG
l_int|1
)paren
(brace
id|READ32
c_func
(paren
id|bmval1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmval1
op_amp
op_complement
(paren
id|FATTR4_WORD1_TIME_ACCESS
)paren
)paren
r_goto
id|out_bad_bitmap
suffix:semicolon
)brace
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|attrlen
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|attrlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|attrlen
OL
l_int|16
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;decode_post_write_getattr: server returned bad attribute length %u&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|attrlen
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|READ64
c_func
(paren
id|fattr-&gt;change_attr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_TIME_ACCESS
)paren
id|READTIME
c_func
(paren
id|fattr-&gt;atime
)paren
suffix:semicolon
id|fattr-&gt;bitmap
(braket
l_int|0
)braket
op_assign
id|bmval0
suffix:semicolon
id|fattr-&gt;bitmap
(braket
l_int|1
)braket
op_assign
id|bmval1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_bad_bitmap
suffix:colon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;decode_read_getattr: server returned bad attribute bitmap 0x%x/0x%x&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|bmval0
comma
(paren
r_int
r_int
)paren
id|bmval1
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_pre_write_getattr
id|decode_pre_write_getattr
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
r_return
id|decode_change_attr
c_func
(paren
id|xdr
comma
op_amp
id|fattr-&gt;pre_change_attr
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_post_write_getattr
id|decode_post_write_getattr
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
r_uint32
id|attrlen
comma
id|bmlen
comma
id|bmval0
op_assign
l_int|0
comma
id|bmval1
op_assign
l_int|0
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_GETATTR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
id|status
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|bmlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmlen
OL
l_int|1
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|READ_BUF
c_func
(paren
id|bmlen
op_lshift
l_int|2
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|bmval0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmval0
op_ne
(paren
id|FATTR4_WORD0_CHANGE
op_or
id|FATTR4_WORD0_SIZE
)paren
)paren
r_goto
id|out_bad_bitmap
suffix:semicolon
r_if
c_cond
(paren
id|bmlen
OG
l_int|1
)paren
(brace
id|READ32
c_func
(paren
id|bmval1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmval1
op_amp
op_complement
(paren
id|FATTR4_WORD1_SPACE_USED
op_or
id|FATTR4_WORD1_TIME_METADATA
op_or
id|FATTR4_WORD1_TIME_MODIFY
)paren
)paren
r_goto
id|out_bad_bitmap
suffix:semicolon
)brace
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|attrlen
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|attrlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|attrlen
OL
l_int|16
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;decode_post_write_getattr: server returned bad attribute length %u&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|attrlen
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|READ64
c_func
(paren
id|fattr-&gt;change_attr
)paren
suffix:semicolon
id|READ64
c_func
(paren
id|fattr-&gt;size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_SPACE_USED
)paren
id|READ64
c_func
(paren
id|fattr-&gt;du.nfs3.used
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_TIME_METADATA
)paren
id|READTIME
c_func
(paren
id|fattr-&gt;ctime
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmval1
op_amp
id|FATTR4_WORD1_TIME_MODIFY
)paren
id|READTIME
c_func
(paren
id|fattr-&gt;mtime
)paren
suffix:semicolon
id|fattr-&gt;bitmap
(braket
l_int|0
)braket
op_assign
id|bmval0
suffix:semicolon
id|fattr-&gt;bitmap
(braket
l_int|1
)braket
op_assign
id|bmval1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_bad_bitmap
suffix:colon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;decode_post_write_getattr: server returned bad attribute bitmap 0x%x/0x%x&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|bmval0
comma
(paren
r_int
r_int
)paren
id|bmval1
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_getfh
id|decode_getfh
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_getfh
op_star
id|getfh
)paren
(brace
r_struct
id|nfs_fh
op_star
id|fh
op_assign
id|getfh-&gt;gf_fhandle
suffix:semicolon
r_uint32
op_star
id|p
suffix:semicolon
r_uint32
id|len
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_GETFH
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
id|status
suffix:semicolon
multiline_comment|/* Zero handle first to allow comparisons */
id|memset
c_func
(paren
id|fh
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|fh
)paren
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|NFS_MAXFHSIZE
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|fh-&gt;size
op_assign
id|len
suffix:semicolon
id|READ_BUF
c_func
(paren
id|len
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
id|fh-&gt;data
comma
id|len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_link
id|decode_link
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_link
op_star
id|link
)paren
(brace
r_int
id|status
suffix:semicolon
id|status
op_assign
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_LINK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
id|status
suffix:semicolon
r_return
id|decode_change_info
c_func
(paren
id|xdr
comma
id|link-&gt;ln_cinfo
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_lookup
id|decode_lookup
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
)paren
(brace
r_return
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_LOOKUP
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_open
id|decode_open
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs_openres
op_star
id|res
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
r_uint32
id|bmlen
comma
id|delegation_type
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_OPEN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
id|status
suffix:semicolon
id|READ_BUF
c_func
(paren
r_sizeof
(paren
id|res-&gt;stateid.data
)paren
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
id|res-&gt;stateid.data
comma
r_sizeof
(paren
id|res-&gt;stateid.data
)paren
)paren
suffix:semicolon
id|decode_change_info
c_func
(paren
id|xdr
comma
id|res-&gt;cinfo
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|res-&gt;rflags
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|bmlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bmlen
OG
l_int|10
)paren
r_goto
id|xdr_error
suffix:semicolon
id|READ_BUF
c_func
(paren
(paren
id|bmlen
op_lshift
l_int|2
)paren
op_plus
l_int|4
)paren
suffix:semicolon
id|p
op_add_assign
id|bmlen
suffix:semicolon
id|READ32
c_func
(paren
id|delegation_type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|delegation_type
op_ne
id|NFS4_OPEN_DELEGATE_NONE
)paren
r_goto
id|xdr_error
suffix:semicolon
id|DECODE_TAIL
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_open_confirm
id|decode_open_confirm
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs_open_confirmres
op_star
id|res
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
id|res-&gt;status
op_assign
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_OPEN_CONFIRM
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res-&gt;status
)paren
r_return
id|res-&gt;status
suffix:semicolon
id|READ_BUF
c_func
(paren
r_sizeof
(paren
id|res-&gt;stateid.data
)paren
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
id|res-&gt;stateid.data
comma
r_sizeof
(paren
id|res-&gt;stateid.data
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_putfh
id|decode_putfh
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
)paren
(brace
r_return
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_PUTFH
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_putrootfh
id|decode_putrootfh
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
)paren
(brace
r_return
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_PUTROOTFH
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_read
id|decode_read
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|rpc_rqst
op_star
id|req
comma
r_struct
id|nfs_readres
op_star
id|res
)paren
(brace
r_struct
id|iovec
op_star
id|iov
op_assign
id|req-&gt;rq_rvec
suffix:semicolon
r_uint32
op_star
id|p
suffix:semicolon
r_uint32
id|count
comma
id|eof
comma
id|recvd
comma
id|hdrlen
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_READ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
id|status
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|eof
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|count
)paren
suffix:semicolon
id|hdrlen
op_assign
(paren
id|u8
op_star
)paren
id|p
op_minus
(paren
id|u8
op_star
)paren
id|iov-&gt;iov_base
suffix:semicolon
id|recvd
op_assign
id|req-&gt;rq_received
op_minus
id|hdrlen
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
id|recvd
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;NFS: server cheating in read reply: &quot;
l_string|&quot;count %u &gt; recvd %u&bslash;n&quot;
comma
id|count
comma
id|recvd
)paren
suffix:semicolon
id|count
op_assign
id|recvd
suffix:semicolon
id|eof
op_assign
l_int|0
suffix:semicolon
)brace
id|xdr_read_pages
c_func
(paren
id|xdr
comma
id|count
)paren
suffix:semicolon
id|res-&gt;eof
op_assign
id|eof
suffix:semicolon
id|res-&gt;count
op_assign
id|count
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_readdir
id|decode_readdir
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|rpc_rqst
op_star
id|req
comma
r_struct
id|nfs4_readdir
op_star
id|readdir
)paren
(brace
r_struct
id|xdr_buf
op_star
id|rcvbuf
op_assign
op_amp
id|req-&gt;rq_rcv_buf
suffix:semicolon
r_struct
id|page
op_star
id|page
op_assign
op_star
id|rcvbuf-&gt;pages
suffix:semicolon
r_struct
id|iovec
op_star
id|iov
op_assign
id|rcvbuf-&gt;head
suffix:semicolon
r_int
r_int
id|nr
comma
id|pglen
op_assign
id|rcvbuf-&gt;page_len
suffix:semicolon
r_uint32
op_star
id|end
comma
op_star
id|entry
comma
op_star
id|p
comma
op_star
id|kaddr
suffix:semicolon
r_uint32
id|len
comma
id|attrlen
comma
id|word
suffix:semicolon
r_int
id|i
comma
id|hdrlen
comma
id|recvd
comma
id|status
suffix:semicolon
id|status
op_assign
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_READDIR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
id|status
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
id|readdir-&gt;rd_resp_verifier.data
comma
l_int|8
)paren
suffix:semicolon
id|hdrlen
op_assign
(paren
r_char
op_star
)paren
id|p
op_minus
(paren
r_char
op_star
)paren
id|iov-&gt;iov_base
suffix:semicolon
id|recvd
op_assign
id|req-&gt;rq_received
op_minus
id|hdrlen
suffix:semicolon
r_if
c_cond
(paren
id|pglen
OG
id|recvd
)paren
id|pglen
op_assign
id|recvd
suffix:semicolon
id|xdr_read_pages
c_func
(paren
id|xdr
comma
id|pglen
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|pglen
op_plus
id|readdir-&gt;rd_pgbase
OG
id|PAGE_CACHE_SIZE
)paren
suffix:semicolon
id|kaddr
op_assign
id|p
op_assign
(paren
r_uint32
op_star
)paren
id|kmap_atomic
c_func
(paren
id|page
comma
id|KM_USER0
)paren
suffix:semicolon
id|end
op_assign
(paren
r_uint32
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|p
op_plus
id|pglen
op_plus
id|readdir-&gt;rd_pgbase
)paren
suffix:semicolon
id|entry
op_assign
id|p
suffix:semicolon
r_for
c_loop
(paren
id|nr
op_assign
l_int|0
suffix:semicolon
op_star
id|p
op_increment
suffix:semicolon
id|nr
op_increment
)paren
(brace
r_if
c_cond
(paren
id|p
op_plus
l_int|3
OG
id|end
)paren
r_goto
id|short_pkt
suffix:semicolon
id|p
op_add_assign
l_int|2
suffix:semicolon
multiline_comment|/* cookie */
id|len
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
multiline_comment|/* filename length */
r_if
c_cond
(paren
id|len
OG
id|NFS4_MAXNAMLEN
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;NFS: giant filename in readdir (len 0x%x)&bslash;n&quot;
comma
id|len
)paren
suffix:semicolon
r_goto
id|err_unmap
suffix:semicolon
)brace
id|p
op_add_assign
id|XDR_QUADLEN
c_func
(paren
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
op_plus
l_int|1
OG
id|end
)paren
r_goto
id|short_pkt
suffix:semicolon
id|len
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
multiline_comment|/* bitmap length */
r_if
c_cond
(paren
id|len
OG
l_int|10
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;NFS: giant bitmap in readdir (len 0x%x)&bslash;n&quot;
comma
id|len
)paren
suffix:semicolon
r_goto
id|err_unmap
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p
op_plus
id|len
op_plus
l_int|1
OG
id|end
)paren
r_goto
id|short_pkt
suffix:semicolon
id|attrlen
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|word
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|word
)paren
r_continue
suffix:semicolon
r_else
r_if
c_cond
(paren
id|i
op_eq
l_int|0
op_logical_and
id|word
op_eq
id|FATTR4_WORD0_FILEID
)paren
(brace
id|attrlen
op_assign
l_int|8
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;NFS: unexpected bitmap word in readdir (0x%x)&bslash;n&quot;
comma
id|word
)paren
suffix:semicolon
r_goto
id|err_unmap
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
op_ne
id|attrlen
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;NFS: unexpected attrlen in readdir&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|err_unmap
suffix:semicolon
)brace
id|p
op_add_assign
id|XDR_QUADLEN
c_func
(paren
id|attrlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
op_plus
l_int|1
OG
id|end
)paren
r_goto
id|short_pkt
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|nr
op_logical_and
(paren
id|entry
(braket
l_int|0
)braket
op_ne
l_int|0
op_logical_or
id|entry
(braket
l_int|1
)braket
op_eq
l_int|0
)paren
)paren
r_goto
id|short_pkt
suffix:semicolon
id|out
suffix:colon
id|kunmap_atomic
c_func
(paren
id|kaddr
comma
id|KM_USER0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|short_pkt
suffix:colon
id|entry
(braket
l_int|0
)braket
op_assign
id|entry
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* truncate listing ? */
r_if
c_cond
(paren
op_logical_neg
id|nr
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;NFS: readdir reply truncated!&bslash;n&quot;
)paren
suffix:semicolon
id|entry
(braket
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
)brace
r_goto
id|out
suffix:semicolon
id|err_unmap
suffix:colon
id|kunmap_atomic
c_func
(paren
id|kaddr
comma
id|KM_USER0
)paren
suffix:semicolon
r_return
op_minus
id|errno_NFSERR_IO
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_readlink
id|decode_readlink
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|rpc_rqst
op_star
id|req
comma
r_struct
id|nfs4_readlink
op_star
id|readlink
)paren
(brace
r_struct
id|xdr_buf
op_star
id|rcvbuf
op_assign
op_amp
id|req-&gt;rq_rcv_buf
suffix:semicolon
r_struct
id|iovec
op_star
id|iov
op_assign
id|rcvbuf-&gt;head
suffix:semicolon
r_uint32
op_star
id|strlen
suffix:semicolon
r_int
r_int
id|hdrlen
comma
id|len
suffix:semicolon
r_char
op_star
id|string
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_READLINK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
id|status
suffix:semicolon
id|hdrlen
op_assign
(paren
r_char
op_star
)paren
id|xdr-&gt;p
op_minus
(paren
r_char
op_star
)paren
id|iov-&gt;iov_base
suffix:semicolon
r_if
c_cond
(paren
id|iov-&gt;iov_len
OG
id|hdrlen
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;NFS: READLINK header is short. iovec will be shifted.&bslash;n&quot;
)paren
suffix:semicolon
id|xdr_shift_buf
c_func
(paren
id|rcvbuf
comma
id|iov-&gt;iov_len
op_minus
id|hdrlen
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * The XDR encode routine has set things up so that&n;&t; * the link text will be copied directly into the&n;&t; * buffer.  We just have to do overflow-checking,&n;&t; * and and null-terminate the text (the VFS expects&n;&t; * null-termination).&n;&t; */
id|strlen
op_assign
(paren
r_uint32
op_star
)paren
id|kmap_atomic
c_func
(paren
id|rcvbuf-&gt;pages
(braket
l_int|0
)braket
comma
id|KM_USER0
)paren
suffix:semicolon
id|len
op_assign
id|ntohl
c_func
(paren
op_star
id|strlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|PAGE_CACHE_SIZE
op_minus
l_int|5
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;nfs: server returned giant symlink!&bslash;n&quot;
)paren
suffix:semicolon
id|kunmap_atomic
c_func
(paren
id|strlen
comma
id|KM_USER0
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
op_star
id|strlen
op_assign
id|len
suffix:semicolon
id|string
op_assign
(paren
r_char
op_star
)paren
(paren
id|strlen
op_plus
l_int|1
)paren
suffix:semicolon
id|string
(braket
id|len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|kunmap_atomic
c_func
(paren
id|strlen
comma
id|KM_USER0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_restorefh
id|decode_restorefh
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
)paren
(brace
r_return
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_RESTOREFH
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_remove
id|decode_remove
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_remove
op_star
id|remove
)paren
(brace
r_int
id|status
suffix:semicolon
id|status
op_assign
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_REMOVE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_change_info
c_func
(paren
id|xdr
comma
id|remove-&gt;rm_cinfo
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|status
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_rename
id|decode_rename
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_rename
op_star
id|rename
)paren
(brace
r_int
id|status
suffix:semicolon
id|status
op_assign
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_RENAME
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|decode_change_info
c_func
(paren
id|xdr
comma
id|rename-&gt;rn_src_cinfo
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|decode_change_info
c_func
(paren
id|xdr
comma
id|rename-&gt;rn_dst_cinfo
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
id|out
suffix:colon
r_return
id|status
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_renew
id|decode_renew
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
)paren
(brace
r_return
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_RENEW
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_savefh
id|decode_savefh
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
)paren
(brace
r_return
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_SAVEFH
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_setattr
id|decode_setattr
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs_setattrres
op_star
id|res
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
r_uint32
id|bmlen
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_SETATTR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
id|status
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|bmlen
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|bmlen
op_lshift
l_int|2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_setclientid
id|decode_setclientid
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_setclientid
op_star
id|setclientid
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
r_uint32
id|opnum
suffix:semicolon
r_int32
id|nfserr
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|opnum
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opnum
op_ne
id|OP_SETCLIENTID
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;nfs4_decode_setclientid: Server returned operation&quot;
l_string|&quot; %d&bslash;n&quot;
comma
id|opnum
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|READ32
c_func
(paren
id|nfserr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nfserr
op_eq
id|NFS_OK
)paren
(brace
id|READ_BUF
c_func
(paren
l_int|8
op_plus
r_sizeof
(paren
id|setclientid-&gt;sc_state-&gt;cl_confirm.data
)paren
)paren
suffix:semicolon
id|READ64
c_func
(paren
id|setclientid-&gt;sc_state-&gt;cl_clientid
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
id|setclientid-&gt;sc_state-&gt;cl_confirm.data
comma
r_sizeof
(paren
id|setclientid-&gt;sc_state-&gt;cl_confirm.data
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|nfserr
op_eq
id|NFSERR_CLID_INUSE
)paren
(brace
r_uint32
id|len
suffix:semicolon
multiline_comment|/* skip netid string */
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|len
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|len
)paren
suffix:semicolon
multiline_comment|/* skip uaddr string */
id|READ_BUF
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|len
)paren
suffix:semicolon
id|READ_BUF
c_func
(paren
id|len
)paren
suffix:semicolon
r_return
op_minus
id|EEXIST
suffix:semicolon
)brace
r_else
r_return
op_minus
id|nfs_stat_to_errno
c_func
(paren
id|nfserr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_setclientid_confirm
id|decode_setclientid_confirm
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
)paren
(brace
r_return
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_SETCLIENTID_CONFIRM
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|decode_write
id|decode_write
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs_writeres
op_star
id|res
)paren
(brace
r_uint32
op_star
id|p
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|decode_op_hdr
c_func
(paren
id|xdr
comma
id|OP_WRITE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
id|status
suffix:semicolon
id|READ_BUF
c_func
(paren
l_int|16
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|res-&gt;count
)paren
suffix:semicolon
id|READ32
c_func
(paren
id|res-&gt;verf-&gt;committed
)paren
suffix:semicolon
id|COPYMEM
c_func
(paren
id|res-&gt;verf-&gt;verifier
comma
l_int|8
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* FIXME: this sucks */
r_static
r_int
DECL|function|decode_compound
id|decode_compound
c_func
(paren
r_struct
id|xdr_stream
op_star
id|xdr
comma
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|rpc_rqst
op_star
id|req
)paren
(brace
r_struct
id|compound_hdr
id|hdr
suffix:semicolon
r_struct
id|nfs4_op
op_star
id|op
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|decode_compound_hdr
c_func
(paren
id|xdr
comma
op_amp
id|hdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|cp-&gt;toplevel_status
op_assign
id|hdr.status
suffix:semicolon
multiline_comment|/*&n;&t; * We need this if our zero-copy I/O is going to work.  Rumor has&n;&t; * it that the spec will soon mandate it...&n;&t; */
r_if
c_cond
(paren
id|hdr.taglen
op_ne
id|cp-&gt;taglen
)paren
id|dprintk
c_func
(paren
l_string|&quot;nfs4: non-conforming server returns tag length mismatch!&bslash;n&quot;
)paren
suffix:semicolon
id|cp-&gt;resp_nops
op_assign
id|hdr.nops
suffix:semicolon
r_if
c_cond
(paren
id|hdr.nops
OG
id|cp-&gt;req_nops
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;nfs4: resp_nops &gt; req_nops!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|xdr_error
suffix:semicolon
)brace
id|op
op_assign
op_amp
id|cp-&gt;ops
(braket
l_int|0
)braket
suffix:semicolon
r_for
c_loop
(paren
id|cp-&gt;nops
op_assign
l_int|0
suffix:semicolon
id|cp-&gt;nops
OL
id|cp-&gt;resp_nops
suffix:semicolon
id|cp-&gt;nops
op_increment
comma
id|op
op_increment
)paren
(brace
r_switch
c_cond
(paren
id|op-&gt;opnum
)paren
(brace
r_case
id|OP_ACCESS
suffix:colon
id|status
op_assign
id|decode_access
c_func
(paren
id|xdr
comma
op_amp
id|op-&gt;u.access
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_CREATE
suffix:colon
id|status
op_assign
id|decode_create
c_func
(paren
id|xdr
comma
op_amp
id|op-&gt;u.create
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_GETATTR
suffix:colon
id|status
op_assign
id|decode_getattr
c_func
(paren
id|xdr
comma
op_amp
id|op-&gt;u.getattr
comma
id|cp-&gt;server
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_GETFH
suffix:colon
id|status
op_assign
id|decode_getfh
c_func
(paren
id|xdr
comma
op_amp
id|op-&gt;u.getfh
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_LINK
suffix:colon
id|status
op_assign
id|decode_link
c_func
(paren
id|xdr
comma
op_amp
id|op-&gt;u.link
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_LOOKUP
suffix:colon
id|status
op_assign
id|decode_lookup
c_func
(paren
id|xdr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_PUTFH
suffix:colon
id|status
op_assign
id|decode_putfh
c_func
(paren
id|xdr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_PUTROOTFH
suffix:colon
id|status
op_assign
id|decode_putrootfh
c_func
(paren
id|xdr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_READDIR
suffix:colon
id|status
op_assign
id|decode_readdir
c_func
(paren
id|xdr
comma
id|req
comma
op_amp
id|op-&gt;u.readdir
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_READLINK
suffix:colon
id|status
op_assign
id|decode_readlink
c_func
(paren
id|xdr
comma
id|req
comma
op_amp
id|op-&gt;u.readlink
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_RESTOREFH
suffix:colon
id|status
op_assign
id|decode_restorefh
c_func
(paren
id|xdr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_REMOVE
suffix:colon
id|status
op_assign
id|decode_remove
c_func
(paren
id|xdr
comma
op_amp
id|op-&gt;u.remove
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_RENAME
suffix:colon
id|status
op_assign
id|decode_rename
c_func
(paren
id|xdr
comma
op_amp
id|op-&gt;u.rename
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_RENEW
suffix:colon
id|status
op_assign
id|decode_renew
c_func
(paren
id|xdr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_SAVEFH
suffix:colon
id|status
op_assign
id|decode_savefh
c_func
(paren
id|xdr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_SETCLIENTID
suffix:colon
id|status
op_assign
id|decode_setclientid
c_func
(paren
id|xdr
comma
op_amp
id|op-&gt;u.setclientid
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OP_SETCLIENTID_CONFIRM
suffix:colon
id|status
op_assign
id|decode_setclientid_confirm
c_func
(paren
id|xdr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
)paren
r_break
suffix:semicolon
)brace
id|DECODE_TAIL
suffix:semicolon
)brace
multiline_comment|/*&n; * END OF &quot;GENERIC&quot; DECODE ROUTINES.&n; */
multiline_comment|/*&n; * Decode COMPOUND response&n; */
r_static
r_int
DECL|function|nfs4_xdr_dec_compound
id|nfs4_xdr_dec_compound
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|rqstp
comma
r_uint32
op_star
id|p
comma
r_struct
id|nfs4_compound
op_star
id|cp
)paren
(brace
r_struct
id|xdr_stream
id|xdr
suffix:semicolon
r_int
id|status
suffix:semicolon
id|xdr_init_decode
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|rqstp-&gt;rq_rcv_buf
comma
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|decode_compound
c_func
(paren
op_amp
id|xdr
comma
id|cp
comma
id|rqstp
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cp-&gt;toplevel_status
)paren
id|status
op_assign
op_minus
id|nfs_stat_to_errno
c_func
(paren
id|cp-&gt;toplevel_status
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode CLOSE response&n; */
r_static
r_int
DECL|function|nfs4_xdr_dec_close
id|nfs4_xdr_dec_close
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|rqstp
comma
r_uint32
op_star
id|p
comma
r_struct
id|nfs_closeres
op_star
id|res
)paren
(brace
r_struct
id|xdr_stream
id|xdr
suffix:semicolon
r_struct
id|compound_hdr
id|hdr
suffix:semicolon
r_int
id|status
suffix:semicolon
id|xdr_init_decode
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|rqstp-&gt;rq_rcv_buf
comma
id|p
)paren
suffix:semicolon
id|status
op_assign
id|decode_compound_hdr
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|hdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_putfh
c_func
(paren
op_amp
id|xdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_close
c_func
(paren
op_amp
id|xdr
comma
id|res
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode OPEN response&n; */
r_static
r_int
DECL|function|nfs4_xdr_dec_open
id|nfs4_xdr_dec_open
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|rqstp
comma
r_uint32
op_star
id|p
comma
r_struct
id|nfs_openres
op_star
id|res
)paren
(brace
r_struct
id|xdr_stream
id|xdr
suffix:semicolon
r_struct
id|compound_hdr
id|hdr
suffix:semicolon
r_struct
id|nfs4_getfh
id|gfh
op_assign
(brace
dot
id|gf_fhandle
op_assign
op_amp
id|res-&gt;fh
comma
)brace
suffix:semicolon
r_int
id|status
suffix:semicolon
id|xdr_init_decode
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|rqstp-&gt;rq_rcv_buf
comma
id|p
)paren
suffix:semicolon
id|status
op_assign
id|decode_compound_hdr
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|hdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_putfh
c_func
(paren
op_amp
id|xdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_savefh
c_func
(paren
op_amp
id|xdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_open
c_func
(paren
op_amp
id|xdr
comma
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_getattr
c_func
(paren
op_amp
id|xdr
comma
id|res-&gt;f_getattr
comma
id|res-&gt;server
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_getfh
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|gfh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_restorefh
c_func
(paren
op_amp
id|xdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_getattr
c_func
(paren
op_amp
id|xdr
comma
id|res-&gt;d_getattr
comma
id|res-&gt;server
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|out
suffix:colon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode OPEN_CONFIRM response&n; */
r_static
r_int
DECL|function|nfs4_xdr_dec_open_confirm
id|nfs4_xdr_dec_open_confirm
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|rqstp
comma
r_uint32
op_star
id|p
comma
r_struct
id|nfs_open_confirmres
op_star
id|res
)paren
(brace
r_struct
id|xdr_stream
id|xdr
suffix:semicolon
r_struct
id|compound_hdr
id|hdr
suffix:semicolon
r_int
id|status
suffix:semicolon
id|xdr_init_decode
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|rqstp-&gt;rq_rcv_buf
comma
id|p
)paren
suffix:semicolon
id|status
op_assign
id|decode_compound_hdr
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|hdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_putfh
c_func
(paren
op_amp
id|xdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_open_confirm
c_func
(paren
op_amp
id|xdr
comma
id|res
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode SETATTR response&n; */
r_static
r_int
DECL|function|nfs4_xdr_dec_setattr
id|nfs4_xdr_dec_setattr
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|rqstp
comma
r_uint32
op_star
id|p
comma
r_struct
id|nfs_setattrres
op_star
id|res
)paren
(brace
r_struct
id|xdr_stream
id|xdr
suffix:semicolon
r_struct
id|compound_hdr
id|hdr
suffix:semicolon
r_int
id|status
suffix:semicolon
id|xdr_init_decode
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|rqstp-&gt;rq_rcv_buf
comma
id|p
)paren
suffix:semicolon
id|status
op_assign
id|decode_compound_hdr
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|hdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_putfh
c_func
(paren
op_amp
id|xdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_setattr
c_func
(paren
op_amp
id|xdr
comma
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_getattr
c_func
(paren
op_amp
id|xdr
comma
id|res-&gt;attr
comma
id|res-&gt;server
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode Read response&n; */
r_static
r_int
DECL|function|nfs4_xdr_dec_read
id|nfs4_xdr_dec_read
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|rqstp
comma
r_uint32
op_star
id|p
comma
r_struct
id|nfs_readres
op_star
id|res
)paren
(brace
r_struct
id|xdr_stream
id|xdr
suffix:semicolon
r_struct
id|compound_hdr
id|hdr
suffix:semicolon
r_int
id|status
suffix:semicolon
id|xdr_init_decode
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|rqstp-&gt;rq_rcv_buf
comma
id|p
)paren
suffix:semicolon
id|status
op_assign
id|decode_compound_hdr
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|hdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_putfh
c_func
(paren
op_amp
id|xdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_read
c_func
(paren
op_amp
id|xdr
comma
id|rqstp
comma
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_read_getattr
c_func
(paren
op_amp
id|xdr
comma
id|res-&gt;fattr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
id|status
op_assign
op_minus
id|nfs_stat_to_errno
c_func
(paren
id|hdr.status
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode WRITE response&n; */
r_static
r_int
DECL|function|nfs4_xdr_dec_write
id|nfs4_xdr_dec_write
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|rqstp
comma
r_uint32
op_star
id|p
comma
r_struct
id|nfs_writeres
op_star
id|res
)paren
(brace
r_struct
id|xdr_stream
id|xdr
suffix:semicolon
r_struct
id|compound_hdr
id|hdr
suffix:semicolon
r_int
id|status
suffix:semicolon
id|xdr_init_decode
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|rqstp-&gt;rq_rcv_buf
comma
id|p
)paren
suffix:semicolon
id|status
op_assign
id|decode_compound_hdr
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|hdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_putfh
c_func
(paren
op_amp
id|xdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_pre_write_getattr
c_func
(paren
op_amp
id|xdr
comma
id|res-&gt;fattr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_write
c_func
(paren
op_amp
id|xdr
comma
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_post_write_getattr
c_func
(paren
op_amp
id|xdr
comma
id|res-&gt;fattr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
id|status
op_assign
op_minus
id|nfs_stat_to_errno
c_func
(paren
id|hdr.status
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
id|status
op_assign
id|res-&gt;count
suffix:semicolon
id|out
suffix:colon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Decode COMMIT response&n; */
r_static
r_int
DECL|function|nfs4_xdr_dec_commit
id|nfs4_xdr_dec_commit
c_func
(paren
r_struct
id|rpc_rqst
op_star
id|rqstp
comma
r_uint32
op_star
id|p
comma
r_struct
id|nfs_writeres
op_star
id|res
)paren
(brace
r_struct
id|xdr_stream
id|xdr
suffix:semicolon
r_struct
id|compound_hdr
id|hdr
suffix:semicolon
r_int
id|status
suffix:semicolon
id|xdr_init_decode
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|rqstp-&gt;rq_rcv_buf
comma
id|p
)paren
suffix:semicolon
id|status
op_assign
id|decode_compound_hdr
c_func
(paren
op_amp
id|xdr
comma
op_amp
id|hdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_putfh
c_func
(paren
op_amp
id|xdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_pre_write_getattr
c_func
(paren
op_amp
id|xdr
comma
id|res-&gt;fattr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_commit
c_func
(paren
op_amp
id|xdr
comma
id|res
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out
suffix:semicolon
id|status
op_assign
id|decode_post_write_getattr
c_func
(paren
op_amp
id|xdr
comma
id|res-&gt;fattr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
id|status
op_assign
op_minus
id|nfs_stat_to_errno
c_func
(paren
id|hdr.status
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|status
suffix:semicolon
)brace
r_uint32
op_star
DECL|function|nfs4_decode_dirent
id|nfs4_decode_dirent
c_func
(paren
r_uint32
op_star
id|p
comma
r_struct
id|nfs_entry
op_star
id|entry
comma
r_int
id|plus
)paren
(brace
r_uint32
id|len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|p
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
op_star
id|p
)paren
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EAGAIN
)paren
suffix:semicolon
id|entry-&gt;eof
op_assign
l_int|1
suffix:semicolon
r_return
id|ERR_PTR
c_func
(paren
op_minus
id|EBADCOOKIE
)paren
suffix:semicolon
)brace
id|entry-&gt;prev_cookie
op_assign
id|entry-&gt;cookie
suffix:semicolon
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|entry-&gt;cookie
)paren
suffix:semicolon
id|entry-&gt;len
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
id|entry-&gt;name
op_assign
(paren
r_const
r_char
op_star
)paren
id|p
suffix:semicolon
id|p
op_add_assign
id|XDR_QUADLEN
c_func
(paren
id|entry-&gt;len
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * In case the server doesn&squot;t return an inode number,&n;&t; * we fake one here.  (We don&squot;t use inode number 0,&n;&t; * since glibc seems to choke on it...)&n;&t; */
id|entry-&gt;ino
op_assign
l_int|1
suffix:semicolon
id|len
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
multiline_comment|/* bitmap length */
id|p
op_add_assign
id|len
suffix:semicolon
id|len
op_assign
id|ntohl
c_func
(paren
op_star
id|p
op_increment
)paren
suffix:semicolon
multiline_comment|/* attribute buffer length */
r_if
c_cond
(paren
id|len
)paren
id|p
op_assign
id|xdr_decode_hyper
c_func
(paren
id|p
comma
op_amp
id|entry-&gt;ino
)paren
suffix:semicolon
id|entry-&gt;eof
op_assign
op_logical_neg
id|p
(braket
l_int|0
)braket
op_logical_and
id|p
(braket
l_int|1
)braket
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
macro_line|#ifndef MAX
DECL|macro|MAX
macro_line|# define MAX(a, b)&t;(((a) &gt; (b))? (a) : (b))
macro_line|#endif
DECL|macro|PROC
mdefine_line|#define PROC(proc, argtype, restype)&t;&t;&t;&t;&bslash;&n;[NFSPROC4_CLNT_##proc] = {&t;&t;&t;&t;&t;&bslash;&n;&t;.p_proc   = NFSPROC4_COMPOUND,&t;&t;&t;&t;&bslash;&n;&t;.p_encode = (kxdrproc_t) nfs4_xdr_##argtype,&t;&t;&bslash;&n;&t;.p_decode = (kxdrproc_t) nfs4_xdr_##restype,&t;&t;&bslash;&n;&t;.p_bufsiz = MAX(NFS4_##argtype##_sz,NFS4_##restype##_sz) &lt;&lt; 2,&t;&bslash;&n;    }
DECL|variable|nfs4_procedures
r_struct
id|rpc_procinfo
id|nfs4_procedures
(braket
)braket
op_assign
(brace
id|PROC
c_func
(paren
id|COMPOUND
comma
id|enc_compound
comma
id|dec_compound
)paren
comma
id|PROC
c_func
(paren
id|READ
comma
id|enc_read
comma
id|dec_read
)paren
comma
id|PROC
c_func
(paren
id|WRITE
comma
id|enc_write
comma
id|dec_write
)paren
comma
id|PROC
c_func
(paren
id|COMMIT
comma
id|enc_commit
comma
id|dec_commit
)paren
comma
id|PROC
c_func
(paren
id|OPEN
comma
id|enc_open
comma
id|dec_open
)paren
comma
id|PROC
c_func
(paren
id|OPEN_CONFIRM
comma
id|enc_open_confirm
comma
id|dec_open_confirm
)paren
comma
id|PROC
c_func
(paren
id|CLOSE
comma
id|enc_close
comma
id|dec_close
)paren
comma
id|PROC
c_func
(paren
id|SETATTR
comma
id|enc_setattr
comma
id|dec_setattr
)paren
comma
)brace
suffix:semicolon
DECL|variable|nfs_version4
r_struct
id|rpc_version
id|nfs_version4
op_assign
(brace
dot
id|number
op_assign
l_int|4
comma
dot
id|nrprocs
op_assign
r_sizeof
(paren
id|nfs4_procedures
)paren
op_div
r_sizeof
(paren
id|nfs4_procedures
(braket
l_int|0
)braket
)paren
comma
dot
id|procs
op_assign
id|nfs4_procedures
)brace
suffix:semicolon
multiline_comment|/*&n; * Local variables:&n; *  c-basic-offset: 8&n; * End:&n; */
eof
