multiline_comment|/*&n; *  fs/nfs/nfs4proc.c&n; *&n; *  Client-side procedure declarations for NFSv4.&n; *&n; *  Copyright (c) 2002 The Regents of the University of Michigan.&n; *  All rights reserved.&n; *&n; *  Kendrick Smith &lt;kmsmith@umich.edu&gt;&n; *  Andy Adamson   &lt;andros@umich.edu&gt;&n; *&n; *  Redistribution and use in source and binary forms, with or without&n; *  modification, are permitted provided that the following conditions&n; *  are met:&n; *&n; *  1. Redistributions of source code must retain the above copyright&n; *     notice, this list of conditions and the following disclaimer.&n; *  2. Redistributions in binary form must reproduce the above copyright&n; *     notice, this list of conditions and the following disclaimer in the&n; *     documentation and/or other materials provided with the distribution.&n; *  3. Neither the name of the University nor the names of its&n; *     contributors may be used to endorse or promote products derived&n; *     from this software without specific prior written permission.&n; *&n; *  THIS SOFTWARE IS PROVIDED ``AS IS&squot;&squot; AND ANY EXPRESS OR IMPLIED&n; *  WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF&n; *  MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE&n; *  DISCLAIMED. IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE&n; *  FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR&n; *  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF&n; *  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR&n; *  BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF&n; *  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING&n; *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS&n; *  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.&n; */
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/utsname.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/sunrpc/clnt.h&gt;
macro_line|#include &lt;linux/nfs.h&gt;
macro_line|#include &lt;linux/nfs4.h&gt;
macro_line|#include &lt;linux/nfs_fs.h&gt;
macro_line|#include &lt;linux/nfs_page.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
DECL|macro|NFSDBG_FACILITY
mdefine_line|#define NFSDBG_FACILITY&t;&t;NFSDBG_PROC
DECL|macro|GET_OP
mdefine_line|#define GET_OP(cp,name)&t;&t;&amp;cp-&gt;ops[cp-&gt;req_nops].u.name
DECL|macro|OPNUM
mdefine_line|#define OPNUM(cp)&t;&t;cp-&gt;ops[cp-&gt;req_nops].opnum
r_extern
id|u32
op_star
id|nfs4_decode_dirent
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|nfs_entry
op_star
id|entry
comma
r_int
id|plus
)paren
suffix:semicolon
r_extern
r_struct
id|rpc_procinfo
id|nfs4_procedures
(braket
)braket
suffix:semicolon
DECL|variable|zero_stateid
r_static
id|nfs4_stateid
id|zero_stateid
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|renew_lock
r_static
id|spinlock_t
id|renew_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
r_static
r_void
DECL|function|nfs4_setup_compound
id|nfs4_setup_compound
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|nfs4_op
op_star
id|ops
comma
r_struct
id|nfs_server
op_star
id|server
comma
r_char
op_star
id|tag
)paren
(brace
id|memset
c_func
(paren
id|cp
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|cp
)paren
)paren
suffix:semicolon
id|cp-&gt;ops
op_assign
id|ops
suffix:semicolon
id|cp-&gt;server
op_assign
id|server
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_access
id|nfs4_setup_access
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
id|u32
id|req_access
comma
id|u32
op_star
id|resp_supported
comma
id|u32
op_star
id|resp_access
)paren
(brace
r_struct
id|nfs4_access
op_star
id|access
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|access
)paren
suffix:semicolon
id|access-&gt;ac_req_access
op_assign
id|req_access
suffix:semicolon
id|access-&gt;ac_resp_supported
op_assign
id|resp_supported
suffix:semicolon
id|access-&gt;ac_resp_access
op_assign
id|resp_access
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_ACCESS
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_create_dir
id|nfs4_setup_create_dir
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|qstr
op_star
id|name
comma
r_struct
id|iattr
op_star
id|sattr
comma
r_struct
id|nfs4_change_info
op_star
id|info
)paren
(brace
r_struct
id|nfs4_create
op_star
id|create
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|create
)paren
suffix:semicolon
id|create-&gt;cr_ftype
op_assign
id|NF4DIR
suffix:semicolon
id|create-&gt;cr_namelen
op_assign
id|name-&gt;len
suffix:semicolon
id|create-&gt;cr_name
op_assign
id|name-&gt;name
suffix:semicolon
id|create-&gt;cr_attrs
op_assign
id|sattr
suffix:semicolon
id|create-&gt;cr_cinfo
op_assign
id|info
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_CREATE
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_create_symlink
id|nfs4_setup_create_symlink
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|qstr
op_star
id|name
comma
r_struct
id|qstr
op_star
id|linktext
comma
r_struct
id|iattr
op_star
id|sattr
comma
r_struct
id|nfs4_change_info
op_star
id|info
)paren
(brace
r_struct
id|nfs4_create
op_star
id|create
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|create
)paren
suffix:semicolon
id|create-&gt;cr_ftype
op_assign
id|NF4LNK
suffix:semicolon
id|create-&gt;cr_textlen
op_assign
id|linktext-&gt;len
suffix:semicolon
id|create-&gt;cr_text
op_assign
id|linktext-&gt;name
suffix:semicolon
id|create-&gt;cr_namelen
op_assign
id|name-&gt;len
suffix:semicolon
id|create-&gt;cr_name
op_assign
id|name-&gt;name
suffix:semicolon
id|create-&gt;cr_attrs
op_assign
id|sattr
suffix:semicolon
id|create-&gt;cr_cinfo
op_assign
id|info
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_CREATE
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_create_special
id|nfs4_setup_create_special
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|qstr
op_star
id|name
comma
id|dev_t
id|dev
comma
r_struct
id|iattr
op_star
id|sattr
comma
r_struct
id|nfs4_change_info
op_star
id|info
)paren
(brace
r_int
id|mode
op_assign
id|sattr-&gt;ia_mode
suffix:semicolon
r_struct
id|nfs4_create
op_star
id|create
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|create
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
op_logical_neg
(paren
id|sattr-&gt;ia_valid
op_amp
id|ATTR_MODE
)paren
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
op_logical_neg
id|S_ISFIFO
c_func
(paren
id|mode
)paren
op_logical_and
op_logical_neg
id|S_ISBLK
c_func
(paren
id|mode
)paren
op_logical_and
op_logical_neg
id|S_ISCHR
c_func
(paren
id|mode
)paren
op_logical_and
op_logical_neg
id|S_ISSOCK
c_func
(paren
id|mode
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|S_ISFIFO
c_func
(paren
id|mode
)paren
)paren
id|create-&gt;cr_ftype
op_assign
id|NF4FIFO
suffix:semicolon
r_else
r_if
c_cond
(paren
id|S_ISBLK
c_func
(paren
id|mode
)paren
)paren
(brace
id|create-&gt;cr_ftype
op_assign
id|NF4BLK
suffix:semicolon
id|create-&gt;cr_specdata1
op_assign
id|MAJOR
c_func
(paren
id|dev
)paren
suffix:semicolon
id|create-&gt;cr_specdata2
op_assign
id|MINOR
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|S_ISCHR
c_func
(paren
id|mode
)paren
)paren
(brace
id|create-&gt;cr_ftype
op_assign
id|NF4CHR
suffix:semicolon
id|create-&gt;cr_specdata1
op_assign
id|MAJOR
c_func
(paren
id|dev
)paren
suffix:semicolon
id|create-&gt;cr_specdata2
op_assign
id|MINOR
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
id|create-&gt;cr_ftype
op_assign
id|NF4SOCK
suffix:semicolon
id|create-&gt;cr_namelen
op_assign
id|name-&gt;len
suffix:semicolon
id|create-&gt;cr_name
op_assign
id|name-&gt;name
suffix:semicolon
id|create-&gt;cr_attrs
op_assign
id|sattr
suffix:semicolon
id|create-&gt;cr_cinfo
op_assign
id|info
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_CREATE
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
multiline_comment|/*&n; * This is our standard bitmap for GETATTR requests.&n; */
DECL|variable|nfs4_fattr_bitmap
id|u32
id|nfs4_fattr_bitmap
(braket
l_int|2
)braket
op_assign
(brace
id|FATTR4_WORD0_TYPE
op_or
id|FATTR4_WORD0_CHANGE
op_or
id|FATTR4_WORD0_SIZE
op_or
id|FATTR4_WORD0_FSID
op_or
id|FATTR4_WORD0_FILEID
comma
id|FATTR4_WORD1_MODE
op_or
id|FATTR4_WORD1_NUMLINKS
op_or
id|FATTR4_WORD1_OWNER
op_or
id|FATTR4_WORD1_OWNER_GROUP
op_or
id|FATTR4_WORD1_RAWDEV
op_or
id|FATTR4_WORD1_SPACE_USED
op_or
id|FATTR4_WORD1_TIME_ACCESS
op_or
id|FATTR4_WORD1_TIME_METADATA
op_or
id|FATTR4_WORD1_TIME_MODIFY
)brace
suffix:semicolon
DECL|variable|nfs4_statfs_bitmap
id|u32
id|nfs4_statfs_bitmap
(braket
l_int|2
)braket
op_assign
(brace
id|FATTR4_WORD0_FILES_AVAIL
op_or
id|FATTR4_WORD0_FILES_FREE
op_or
id|FATTR4_WORD0_FILES_TOTAL
comma
id|FATTR4_WORD1_SPACE_AVAIL
op_or
id|FATTR4_WORD1_SPACE_FREE
op_or
id|FATTR4_WORD1_SPACE_TOTAL
)brace
suffix:semicolon
DECL|variable|nfs4_fsinfo_bitmap
id|u32
id|nfs4_fsinfo_bitmap
(braket
l_int|2
)braket
op_assign
(brace
id|FATTR4_WORD0_MAXFILESIZE
op_or
id|FATTR4_WORD0_MAXREAD
op_or
id|FATTR4_WORD0_MAXWRITE
op_or
id|FATTR4_WORD0_LEASE_TIME
comma
l_int|0
)brace
suffix:semicolon
DECL|variable|nfs4_pathconf_bitmap
id|u32
id|nfs4_pathconf_bitmap
(braket
l_int|2
)braket
op_assign
(brace
id|FATTR4_WORD0_MAXLINK
op_or
id|FATTR4_WORD0_MAXNAME
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/* mount bitmap: fattr bitmap + lease time */
DECL|variable|nfs4_mount_bitmap
id|u32
id|nfs4_mount_bitmap
(braket
l_int|2
)braket
op_assign
(brace
id|FATTR4_WORD0_TYPE
op_or
id|FATTR4_WORD0_CHANGE
op_or
id|FATTR4_WORD0_SIZE
op_or
id|FATTR4_WORD0_FSID
op_or
id|FATTR4_WORD0_FILEID
op_or
id|FATTR4_WORD0_LEASE_TIME
comma
id|FATTR4_WORD1_MODE
op_or
id|FATTR4_WORD1_NUMLINKS
op_or
id|FATTR4_WORD1_OWNER
op_or
id|FATTR4_WORD1_OWNER_GROUP
op_or
id|FATTR4_WORD1_RAWDEV
op_or
id|FATTR4_WORD1_SPACE_USED
op_or
id|FATTR4_WORD1_TIME_ACCESS
op_or
id|FATTR4_WORD1_TIME_METADATA
op_or
id|FATTR4_WORD1_TIME_MODIFY
)brace
suffix:semicolon
r_static
r_inline
r_void
DECL|function|__nfs4_setup_getattr
id|__nfs4_setup_getattr
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
id|u32
op_star
id|bitmap
comma
r_struct
id|nfs_fattr
op_star
id|fattr
comma
r_struct
id|nfs_fsstat
op_star
id|fsstat
comma
r_struct
id|nfs_fsinfo
op_star
id|fsinfo
comma
r_struct
id|nfs_pathconf
op_star
id|pathconf
comma
id|u32
op_star
id|bmres
)paren
(brace
r_struct
id|nfs4_getattr
op_star
id|getattr
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|getattr
)paren
suffix:semicolon
id|getattr-&gt;gt_bmval
op_assign
id|bitmap
suffix:semicolon
id|getattr-&gt;gt_attrs
op_assign
id|fattr
suffix:semicolon
id|getattr-&gt;gt_fsstat
op_assign
id|fsstat
suffix:semicolon
id|getattr-&gt;gt_fsinfo
op_assign
id|fsinfo
suffix:semicolon
id|getattr-&gt;gt_pathconf
op_assign
id|pathconf
suffix:semicolon
id|getattr-&gt;gt_bmres
op_assign
id|bmres
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_GETATTR
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_getattr
id|nfs4_setup_getattr
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|nfs_fattr
op_star
id|fattr
comma
id|u32
op_star
id|bmres
)paren
(brace
id|__nfs4_setup_getattr
c_func
(paren
id|cp
comma
id|nfs4_fattr_bitmap
comma
id|fattr
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
id|bmres
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_getrootattr
id|nfs4_setup_getrootattr
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|nfs_fattr
op_star
id|fattr
comma
r_struct
id|nfs_fsinfo
op_star
id|fsinfo
comma
id|u32
op_star
id|bmres
)paren
(brace
id|__nfs4_setup_getattr
c_func
(paren
id|cp
comma
id|nfs4_mount_bitmap
comma
id|fattr
comma
l_int|NULL
comma
id|fsinfo
comma
l_int|NULL
comma
id|bmres
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_statfs
id|nfs4_setup_statfs
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|nfs_fsstat
op_star
id|fsstat
comma
id|u32
op_star
id|bmres
)paren
(brace
id|__nfs4_setup_getattr
c_func
(paren
id|cp
comma
id|nfs4_statfs_bitmap
comma
l_int|NULL
comma
id|fsstat
comma
l_int|NULL
comma
l_int|NULL
comma
id|bmres
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_fsinfo
id|nfs4_setup_fsinfo
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|nfs_fsinfo
op_star
id|fsinfo
comma
id|u32
op_star
id|bmres
)paren
(brace
id|__nfs4_setup_getattr
c_func
(paren
id|cp
comma
id|nfs4_fsinfo_bitmap
comma
l_int|NULL
comma
l_int|NULL
comma
id|fsinfo
comma
l_int|NULL
comma
id|bmres
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_pathconf
id|nfs4_setup_pathconf
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|nfs_pathconf
op_star
id|pathconf
comma
id|u32
op_star
id|bmres
)paren
(brace
id|__nfs4_setup_getattr
c_func
(paren
id|cp
comma
id|nfs4_pathconf_bitmap
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
id|pathconf
comma
id|bmres
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_getfh
id|nfs4_setup_getfh
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|nfs_fh
op_star
id|fhandle
)paren
(brace
r_struct
id|nfs4_getfh
op_star
id|getfh
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|getfh
)paren
suffix:semicolon
id|getfh-&gt;gf_fhandle
op_assign
id|fhandle
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_GETFH
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_link
id|nfs4_setup_link
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|qstr
op_star
id|name
comma
r_struct
id|nfs4_change_info
op_star
id|info
)paren
(brace
r_struct
id|nfs4_link
op_star
id|link
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|link
)paren
suffix:semicolon
id|link-&gt;ln_namelen
op_assign
id|name-&gt;len
suffix:semicolon
id|link-&gt;ln_name
op_assign
id|name-&gt;name
suffix:semicolon
id|link-&gt;ln_cinfo
op_assign
id|info
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_LINK
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_lookup
id|nfs4_setup_lookup
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|qstr
op_star
id|q
)paren
(brace
r_struct
id|nfs4_lookup
op_star
id|lookup
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|lookup
)paren
suffix:semicolon
id|lookup-&gt;lo_name
op_assign
id|q
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_LOOKUP
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_putfh
id|nfs4_setup_putfh
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|nfs_fh
op_star
id|fhandle
)paren
(brace
r_struct
id|nfs4_putfh
op_star
id|putfh
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|putfh
)paren
suffix:semicolon
id|putfh-&gt;pf_fhandle
op_assign
id|fhandle
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_PUTFH
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_putrootfh
id|nfs4_setup_putrootfh
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
)paren
(brace
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_PUTROOTFH
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_readdir
id|nfs4_setup_readdir
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
id|u64
id|cookie
comma
id|u32
op_star
id|verifier
comma
r_struct
id|page
op_star
op_star
id|pages
comma
r_int
r_int
id|bufsize
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
id|u32
op_star
id|start
comma
op_star
id|p
suffix:semicolon
r_struct
id|nfs4_readdir
op_star
id|readdir
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|readdir
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|bufsize
OL
l_int|80
)paren
suffix:semicolon
id|readdir-&gt;rd_cookie
op_assign
(paren
id|cookie
OG
l_int|2
)paren
ques
c_cond
id|cookie
suffix:colon
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|readdir-&gt;rd_req_verifier
comma
id|verifier
comma
r_sizeof
(paren
id|nfs4_verifier
)paren
)paren
suffix:semicolon
id|readdir-&gt;rd_count
op_assign
id|bufsize
suffix:semicolon
id|readdir-&gt;rd_bmval
(braket
l_int|0
)braket
op_assign
id|FATTR4_WORD0_FILEID
suffix:semicolon
id|readdir-&gt;rd_bmval
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|readdir-&gt;rd_pages
op_assign
id|pages
suffix:semicolon
id|readdir-&gt;rd_pgbase
op_assign
l_int|0
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_READDIR
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|cookie
op_ge
l_int|2
)paren
r_return
suffix:semicolon
multiline_comment|/*&n;&t; * NFSv4 servers do not return entries for &squot;.&squot; and &squot;..&squot;&n;&t; * Therefore, we fake these entries here.  We let &squot;.&squot;&n;&t; * have cookie 0 and &squot;..&squot; have cookie 1.  Note that&n;&t; * when talking to the server, we always send cookie 0&n;&t; * instead of 1 or 2.&n;&t; */
id|start
op_assign
id|p
op_assign
(paren
id|u32
op_star
)paren
id|kmap_atomic
c_func
(paren
op_star
id|pages
comma
id|KM_USER0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cookie
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* next */
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
multiline_comment|/* cookie, first word */
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* cookie, second word */
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* entry len */
id|memcpy
c_func
(paren
id|p
comma
l_string|&quot;.&bslash;0&bslash;0&bslash;0&quot;
comma
l_int|4
)paren
suffix:semicolon
multiline_comment|/* entry */
id|p
op_increment
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* bitmap length */
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|FATTR4_WORD0_FILEID
)paren
suffix:semicolon
multiline_comment|/* bitmap */
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
l_int|8
)paren
suffix:semicolon
multiline_comment|/* attribute buffer length */
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|NFS_FILEID
c_func
(paren
id|dentry-&gt;d_inode
)paren
)paren
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* next */
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
multiline_comment|/* cookie, first word */
op_star
id|p
op_increment
op_assign
id|xdr_two
suffix:semicolon
multiline_comment|/* cookie, second word */
op_star
id|p
op_increment
op_assign
id|xdr_two
suffix:semicolon
multiline_comment|/* entry len */
id|memcpy
c_func
(paren
id|p
comma
l_string|&quot;..&bslash;0&bslash;0&quot;
comma
l_int|4
)paren
suffix:semicolon
multiline_comment|/* entry */
id|p
op_increment
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* bitmap length */
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|FATTR4_WORD0_FILEID
)paren
suffix:semicolon
multiline_comment|/* bitmap */
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
l_int|8
)paren
suffix:semicolon
multiline_comment|/* attribute buffer length */
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|NFS_FILEID
c_func
(paren
id|dentry-&gt;d_parent-&gt;d_inode
)paren
)paren
suffix:semicolon
id|readdir-&gt;rd_pgbase
op_assign
(paren
r_char
op_star
)paren
id|p
op_minus
(paren
r_char
op_star
)paren
id|start
suffix:semicolon
id|readdir-&gt;rd_count
op_sub_assign
id|readdir-&gt;rd_pgbase
suffix:semicolon
id|kunmap_atomic
c_func
(paren
id|start
comma
id|KM_USER0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_readlink
id|nfs4_setup_readlink
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_int
id|count
comma
r_struct
id|page
op_star
op_star
id|pages
)paren
(brace
r_struct
id|nfs4_readlink
op_star
id|readlink
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|readlink
)paren
suffix:semicolon
id|readlink-&gt;rl_count
op_assign
id|count
suffix:semicolon
id|readlink-&gt;rl_pages
op_assign
id|pages
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_READLINK
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_remove
id|nfs4_setup_remove
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|qstr
op_star
id|name
comma
r_struct
id|nfs4_change_info
op_star
id|cinfo
)paren
(brace
r_struct
id|nfs4_remove
op_star
id|remove
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|remove
)paren
suffix:semicolon
id|remove-&gt;rm_namelen
op_assign
id|name-&gt;len
suffix:semicolon
id|remove-&gt;rm_name
op_assign
id|name-&gt;name
suffix:semicolon
id|remove-&gt;rm_cinfo
op_assign
id|cinfo
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_REMOVE
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_rename
id|nfs4_setup_rename
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|qstr
op_star
id|old
comma
r_struct
id|qstr
op_star
r_new
comma
r_struct
id|nfs4_change_info
op_star
id|old_cinfo
comma
r_struct
id|nfs4_change_info
op_star
id|new_cinfo
)paren
(brace
r_struct
id|nfs4_rename
op_star
id|rename
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|rename
)paren
suffix:semicolon
id|rename-&gt;rn_oldnamelen
op_assign
id|old-&gt;len
suffix:semicolon
id|rename-&gt;rn_oldname
op_assign
id|old-&gt;name
suffix:semicolon
id|rename-&gt;rn_newnamelen
op_assign
r_new
op_member_access_from_pointer
id|len
suffix:semicolon
id|rename-&gt;rn_newname
op_assign
r_new
op_member_access_from_pointer
id|name
suffix:semicolon
id|rename-&gt;rn_src_cinfo
op_assign
id|old_cinfo
suffix:semicolon
id|rename-&gt;rn_dst_cinfo
op_assign
id|new_cinfo
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_RENAME
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_renew
id|nfs4_setup_renew
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
)paren
(brace
r_struct
id|nfs4_client
op_star
op_star
id|client_state
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|renew
)paren
suffix:semicolon
op_star
id|client_state
op_assign
id|cp-&gt;server-&gt;nfs4_state
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_RENEW
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
id|cp-&gt;renew_index
op_assign
id|cp-&gt;req_nops
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_restorefh
id|nfs4_setup_restorefh
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
)paren
(brace
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_RESTOREFH
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_savefh
id|nfs4_setup_savefh
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
)paren
(brace
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_SAVEFH
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_setattr
id|nfs4_setup_setattr
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_char
op_star
id|stateid
comma
r_struct
id|iattr
op_star
id|iap
)paren
(brace
r_struct
id|nfs4_setattr
op_star
id|setattr
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|setattr
)paren
suffix:semicolon
id|setattr-&gt;st_stateid
op_assign
id|stateid
suffix:semicolon
id|setattr-&gt;st_iap
op_assign
id|iap
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_SETATTR
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_setclientid
id|nfs4_setup_setclientid
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
id|u32
id|program
comma
r_int
r_int
id|port
)paren
(brace
r_struct
id|nfs4_setclientid
op_star
id|setclientid
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|setclientid
)paren
suffix:semicolon
r_struct
id|nfs_server
op_star
id|server
op_assign
id|cp-&gt;server
suffix:semicolon
r_struct
id|timespec
id|tv
suffix:semicolon
id|u32
op_star
id|p
suffix:semicolon
id|tv
op_assign
id|CURRENT_TIME
suffix:semicolon
id|p
op_assign
(paren
id|u32
op_star
)paren
id|setclientid-&gt;sc_verifier
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|tv.tv_sec
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|tv.tv_nsec
suffix:semicolon
id|setclientid-&gt;sc_name
op_assign
id|server-&gt;ip_addr
suffix:semicolon
id|sprintf
c_func
(paren
id|setclientid-&gt;sc_netid
comma
l_string|&quot;udp&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|setclientid-&gt;sc_uaddr
comma
l_string|&quot;%s.%d.%d&quot;
comma
id|server-&gt;ip_addr
comma
id|port
op_rshift
l_int|8
comma
id|port
op_amp
l_int|255
)paren
suffix:semicolon
id|setclientid-&gt;sc_prog
op_assign
id|program
suffix:semicolon
id|setclientid-&gt;sc_cb_ident
op_assign
l_int|0
suffix:semicolon
id|setclientid-&gt;sc_state
op_assign
id|server-&gt;nfs4_state
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_SETCLIENTID
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_setclientid_confirm
id|nfs4_setup_setclientid_confirm
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
)paren
(brace
r_struct
id|nfs4_client
op_star
op_star
id|client_state
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|setclientid_confirm
)paren
suffix:semicolon
op_star
id|client_state
op_assign
id|cp-&gt;server-&gt;nfs4_state
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_SETCLIENTID_CONFIRM
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
id|cp-&gt;renew_index
op_assign
id|cp-&gt;req_nops
suffix:semicolon
)brace
r_static
r_void
DECL|function|renew_lease
id|renew_lease
c_func
(paren
r_struct
id|nfs_server
op_star
id|server
comma
r_int
r_int
id|timestamp
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|renew_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time_before
c_func
(paren
id|server-&gt;last_renewal
comma
id|timestamp
)paren
)paren
id|server-&gt;last_renewal
op_assign
id|timestamp
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|renew_lock
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|process_lease
id|process_lease
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
)paren
(brace
multiline_comment|/*&n;         * Generic lease processing: If this operation contains a&n;&t; * lease-renewing operation, and it succeeded, update the RENEW time&n;&t; * in the superblock.  Instead of the current time, we use the time&n;&t; * when the request was sent out.  (All we know is that the lease was&n;&t; * renewed sometime between then and now, and we have to assume the&n;&t; * worst case.)&n;&t; *&n;&t; * Notes:&n;&t; *   (1) renewd doesn&squot;t acquire the spinlock when messing with&n;&t; *     server-&gt;last_renewal; this is OK since rpciod always runs&n;&t; *     under the BKL.&n;&t; *   (2) cp-&gt;timestamp was set at the end of XDR encode.&n;         */
r_if
c_cond
(paren
op_logical_neg
id|cp-&gt;renew_index
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cp-&gt;toplevel_status
op_logical_or
id|cp-&gt;resp_nops
OG
id|cp-&gt;renew_index
)paren
id|renew_lease
c_func
(paren
id|cp-&gt;server
comma
id|cp-&gt;timestamp
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_call_compound
id|nfs4_call_compound
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|rpc_cred
op_star
id|cred
comma
r_int
id|flags
)paren
(brace
r_int
id|status
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_COMPOUND
)braket
comma
dot
id|rpc_argp
op_assign
id|cp
comma
dot
id|rpc_resp
op_assign
id|cp
comma
dot
id|rpc_cred
op_assign
id|cred
comma
)brace
suffix:semicolon
id|status
op_assign
id|rpc_call_sync
c_func
(paren
id|cp-&gt;server-&gt;client
comma
op_amp
id|msg
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
id|process_lease
c_func
(paren
id|cp
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|process_cinfo
id|process_cinfo
c_func
(paren
r_struct
id|nfs4_change_info
op_star
id|info
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
id|BUG_ON
c_func
(paren
(paren
id|fattr-&gt;valid
op_amp
id|NFS_ATTR_FATTR
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
(paren
id|fattr-&gt;valid
op_amp
id|NFS_ATTR_FATTR_V4
)paren
op_eq
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fattr-&gt;change_attr
op_eq
id|info-&gt;after
)paren
(brace
id|fattr-&gt;pre_change_attr
op_assign
id|info-&gt;before
suffix:semicolon
id|fattr-&gt;valid
op_or_assign
id|NFS_ATTR_PRE_CHANGE
suffix:semicolon
id|fattr-&gt;timestamp
op_assign
id|jiffies
suffix:semicolon
)brace
)brace
r_int
DECL|function|nfs4_do_open
id|nfs4_do_open
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|qstr
op_star
id|name
comma
r_int
id|flags
comma
r_struct
id|iattr
op_star
id|sattr
comma
r_struct
id|nfs_fattr
op_star
id|fattr
comma
r_struct
id|nfs_fh
op_star
id|fhandle
comma
r_struct
id|nfs4_shareowner
op_star
op_star
id|spp
)paren
(brace
r_struct
id|nfs4_shareowner
op_star
id|sp
suffix:semicolon
r_struct
id|nfs_server
op_star
id|server
op_assign
id|NFS_SERVER
c_func
(paren
id|dir
)paren
suffix:semicolon
r_struct
id|nfs4_change_info
id|d_cinfo
suffix:semicolon
r_int
id|status
suffix:semicolon
id|u32
id|f_bmres
(braket
l_int|2
)braket
suffix:semicolon
id|u32
id|d_bmres
(braket
l_int|2
)braket
suffix:semicolon
r_struct
id|nfs_fattr
id|d_attr
op_assign
(brace
dot
id|valid
l_int|0
comma
)brace
suffix:semicolon
r_struct
id|nfs_fattr
id|f_attr
op_assign
(brace
dot
id|valid
l_int|0
comma
)brace
suffix:semicolon
r_struct
id|nfs4_getattr
id|f_getattr
op_assign
(brace
dot
id|gt_bmval
op_assign
id|nfs4_fattr_bitmap
comma
dot
id|gt_attrs
op_assign
(paren
id|fattr
op_eq
l_int|NULL
ques
c_cond
op_amp
id|f_attr
suffix:colon
id|fattr
)paren
comma
dot
id|gt_bmres
op_assign
id|f_bmres
comma
)brace
suffix:semicolon
r_struct
id|nfs4_getattr
id|d_getattr
op_assign
(brace
dot
id|gt_bmval
op_assign
id|nfs4_fattr_bitmap
comma
dot
id|gt_attrs
op_assign
op_amp
id|d_attr
comma
dot
id|gt_bmres
op_assign
id|d_bmres
comma
)brace
suffix:semicolon
r_struct
id|nfs_openargs
id|o_arg
op_assign
(brace
dot
id|fh
op_assign
id|NFS_FH
c_func
(paren
id|dir
)paren
comma
dot
id|share_access
op_assign
id|flags
op_amp
id|O_ACCMODE
comma
dot
id|clientid
op_assign
id|NFS_SERVER
c_func
(paren
id|dir
)paren
op_member_access_from_pointer
id|nfs4_state-&gt;cl_clientid
comma
dot
id|opentype
op_assign
(paren
id|flags
op_amp
id|O_CREAT
)paren
ques
c_cond
id|NFS4_OPEN_CREATE
suffix:colon
id|NFS4_OPEN_NOCREATE
comma
dot
id|createmode
op_assign
(paren
id|flags
op_amp
id|O_EXCL
)paren
ques
c_cond
id|NFS4_CREATE_EXCLUSIVE
suffix:colon
id|NFS4_CREATE_UNCHECKED
comma
dot
id|name
op_assign
id|name
comma
dot
id|f_getattr
op_assign
op_amp
id|f_getattr
comma
dot
id|d_getattr
op_assign
op_amp
id|d_getattr
comma
)brace
suffix:semicolon
r_struct
id|nfs_openres
id|o_res
op_assign
(brace
dot
id|cinfo
op_assign
op_amp
id|d_cinfo
comma
dot
id|f_getattr
op_assign
op_amp
id|f_getattr
comma
dot
id|d_getattr
op_assign
op_amp
id|d_getattr
comma
)brace
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_OPEN
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|o_arg
comma
dot
id|rpc_resp
op_assign
op_amp
id|o_res
comma
)brace
suffix:semicolon
id|status
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sp
op_assign
id|nfs4_get_shareowner
c_func
(paren
id|dir
)paren
)paren
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;nfs4_do_open: nfs4_get_shareowner failed!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|o_arg.createmode
op_amp
id|NFS4_CREATE_EXCLUSIVE
)paren
(brace
id|u32
op_star
id|p
op_assign
(paren
id|u32
op_star
)paren
id|o_arg.u.verifier
suffix:semicolon
id|p
(braket
l_int|0
)braket
op_assign
id|jiffies
suffix:semicolon
id|p
(braket
l_int|1
)braket
op_assign
id|current-&gt;pid
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|o_arg.createmode
op_eq
id|NFS4_CREATE_UNCHECKED
)paren
(brace
id|o_arg.u.attrs
op_assign
id|sattr
suffix:semicolon
)brace
multiline_comment|/* Serialization for the sequence id */
id|down
c_func
(paren
op_amp
id|sp-&gt;so_sema
)paren
suffix:semicolon
id|o_arg.seqid
op_assign
id|sp-&gt;so_seqid
suffix:semicolon
id|o_arg.id
op_assign
id|sp-&gt;so_id
suffix:semicolon
id|status
op_assign
id|rpc_call_sync
c_func
(paren
id|server-&gt;client
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
r_goto
id|out_up
suffix:semicolon
)brace
id|nfs4_increment_seqid
c_func
(paren
id|status
comma
id|sp
)paren
suffix:semicolon
id|process_cinfo
c_func
(paren
op_amp
id|d_cinfo
comma
op_amp
id|d_attr
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|dir
comma
op_amp
id|d_attr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fhandle
)paren
(brace
id|memset
c_func
(paren
id|fhandle
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|fhandle
)paren
)paren
suffix:semicolon
id|fhandle-&gt;size
op_assign
(paren
id|o_res.fh.size
OL
id|NFS_MAXFHSIZE
ques
c_cond
id|o_res.fh.size
suffix:colon
id|NFS_MAXFHSIZE
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|fhandle-&gt;data
comma
id|o_res.fh.data
comma
id|fhandle-&gt;size
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|o_res.rflags
op_amp
id|NFS4_OPEN_RESULT_CONFIRM
)paren
(brace
r_struct
id|nfs_open_confirmargs
id|oc_arg
op_assign
(brace
dot
id|fh
op_assign
op_amp
id|o_res.fh
comma
dot
id|seqid
op_assign
id|sp-&gt;so_seqid
comma
)brace
suffix:semicolon
r_struct
id|nfs_open_confirmres
id|oc_res
op_assign
(brace
dot
id|status
op_assign
l_int|0
comma
)brace
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_OPEN_CONFIRM
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|oc_arg
comma
dot
id|rpc_resp
op_assign
op_amp
id|oc_res
comma
)brace
suffix:semicolon
id|memcpy
c_func
(paren
id|oc_arg.stateid
comma
id|o_res.stateid
comma
r_sizeof
(paren
id|nfs4_stateid
)paren
)paren
suffix:semicolon
id|status
op_assign
id|rpc_call_sync
c_func
(paren
id|server-&gt;client
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out_up
suffix:semicolon
id|nfs4_increment_seqid
c_func
(paren
id|status
comma
id|sp
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|sp-&gt;so_stateid
comma
id|oc_res.stateid
comma
r_sizeof
(paren
id|nfs4_stateid
)paren
)paren
suffix:semicolon
)brace
r_else
id|memcpy
c_func
(paren
id|sp-&gt;so_stateid
comma
id|o_res.stateid
comma
r_sizeof
(paren
id|nfs4_stateid
)paren
)paren
suffix:semicolon
id|sp-&gt;so_flags
op_assign
id|flags
op_amp
id|O_ACCMODE
suffix:semicolon
id|out_up
suffix:colon
id|up
c_func
(paren
op_amp
id|sp-&gt;so_sema
)paren
suffix:semicolon
id|out
suffix:colon
op_star
id|spp
op_assign
id|sp
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
r_static
r_int
DECL|function|do_setattr
id|do_setattr
c_func
(paren
r_struct
id|nfs_server
op_star
id|server
comma
r_struct
id|nfs_fattr
op_star
id|fattr
comma
r_struct
id|nfs_fh
op_star
id|fhandle
comma
r_struct
id|iattr
op_star
id|sattr
comma
r_char
op_star
id|stateid
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|3
)braket
suffix:semicolon
id|u32
id|bmres
(braket
l_int|2
)braket
suffix:semicolon
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|server
comma
l_string|&quot;setattr&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|fhandle
)paren
suffix:semicolon
id|nfs4_setup_setattr
c_func
(paren
op_amp
id|compound
comma
id|stateid
comma
id|sattr
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
id|fattr
comma
id|bmres
)paren
suffix:semicolon
r_return
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* &n; * It is possible for data to be read/written from a mem-mapped file &n; * after the sys_close call (which hits the vfs layer as a flush).&n; * This means that we can&squot;t safely call nfsv4 close on a file until &n; * the inode is cleared. This in turn means that we are not good&n; * NFSv4 citizens - we do not indicate to the server to update the file&squot;s &n; * share state even when we are done with one of the three share &n; * stateid&squot;s in the inode.&n; */
r_int
DECL|function|nfs4_do_close
id|nfs4_do_close
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|nfs4_shareowner
op_star
id|sp
)paren
(brace
r_int
id|status
op_assign
l_int|0
suffix:semicolon
r_struct
id|nfs_closeargs
id|arg
op_assign
(brace
dot
id|fh
op_assign
id|NFS_FH
c_func
(paren
id|inode
)paren
comma
)brace
suffix:semicolon
r_struct
id|nfs_closeres
id|res
op_assign
(brace
dot
id|status
op_assign
l_int|0
comma
)brace
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_CLOSE
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|arg
comma
dot
id|rpc_resp
op_assign
op_amp
id|res
comma
)brace
suffix:semicolon
id|memcpy
c_func
(paren
id|arg.stateid
comma
id|sp-&gt;so_stateid
comma
r_sizeof
(paren
id|nfs4_stateid
)paren
)paren
suffix:semicolon
multiline_comment|/* Serialization for the sequence id */
id|down
c_func
(paren
op_amp
id|sp-&gt;so_sema
)paren
suffix:semicolon
id|arg.seqid
op_assign
id|sp-&gt;so_seqid
comma
id|status
op_assign
id|rpc_call_sync
c_func
(paren
id|NFS_SERVER
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|client
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* hmm. we are done with the inode, and in the process of freeing&n;&t; * the shareowner. we keep this around to process errors&n;&t; */
id|nfs4_increment_seqid
c_func
(paren
id|status
comma
id|sp
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|sp-&gt;so_sema
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_get_root
id|nfs4_proc_get_root
c_func
(paren
r_struct
id|nfs_server
op_star
id|server
comma
r_struct
id|nfs_fh
op_star
id|fhandle
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|4
)braket
suffix:semicolon
r_struct
id|nfs_fsinfo
id|fsinfo
suffix:semicolon
id|u32
id|bmres
(braket
l_int|2
)braket
suffix:semicolon
r_int
r_char
op_star
id|p
suffix:semicolon
r_struct
id|qstr
id|q
suffix:semicolon
r_int
id|status
suffix:semicolon
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|server-&gt;nfs4_state
op_assign
id|nfs4_get_client
c_func
(paren
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/* &n;&t; * SETCLIENTID.&n;&t; * Until delegations are imported, we don&squot;t bother setting the program&n;&t; * number and port to anything meaningful.&n;&t; */
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|server
comma
l_string|&quot;setclientid&quot;
)paren
suffix:semicolon
id|nfs4_setup_setclientid
c_func
(paren
op_amp
id|compound
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/*&n;&t; * SETCLIENTID_CONFIRM, plus root filehandle.&n;&t; * We also get the lease time here.&n;&t; */
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|server
comma
l_string|&quot;setclientid_confirm&quot;
)paren
suffix:semicolon
id|nfs4_setup_setclientid_confirm
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_putrootfh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_getrootattr
c_func
(paren
op_amp
id|compound
comma
id|fattr
comma
op_amp
id|fsinfo
comma
id|bmres
)paren
suffix:semicolon
id|nfs4_setup_getfh
c_func
(paren
op_amp
id|compound
comma
id|fhandle
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/*&n;&t; * Now that we have instantiated the clientid and determined&n;&t; * the lease time, we can initialize the renew daemon for this&n;&t; * server.&n;&t; */
id|server-&gt;lease_time
op_assign
id|fsinfo.lease_time
op_star
id|HZ
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|nfs4_init_renewd
c_func
(paren
id|server
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/*&n;&t; * Now we do a separate LOOKUP for each component of the mount path.&n;&t; * The LOOKUPs are done separately so that we can conveniently&n;&t; * catch an ERR_WRONGSEC if it occurs along the way...&n;&t; */
id|p
op_assign
id|server-&gt;mnt_path
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_while
c_loop
(paren
op_star
id|p
op_eq
l_char|&squot;/&squot;
)paren
id|p
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|p
)paren
r_break
suffix:semicolon
id|q.name
op_assign
id|p
suffix:semicolon
r_while
c_loop
(paren
op_star
id|p
op_logical_and
(paren
op_star
id|p
op_ne
l_char|&squot;/&squot;
)paren
)paren
id|p
op_increment
suffix:semicolon
id|q.len
op_assign
id|p
op_minus
id|q.name
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|server
comma
l_string|&quot;mount&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|fhandle
)paren
suffix:semicolon
id|nfs4_setup_lookup
c_func
(paren
op_amp
id|compound
comma
op_amp
id|q
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
id|fattr
comma
id|bmres
)paren
suffix:semicolon
id|nfs4_setup_getfh
c_func
(paren
op_amp
id|compound
comma
id|fhandle
)paren
suffix:semicolon
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
op_minus
id|ENOENT
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;NFS: mount path %s does not exist!&bslash;n&quot;
comma
id|server-&gt;mnt_path
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;NFS: suggestion: try mounting &squot;/&squot; instead.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|status
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_getattr
id|nfs4_proc_getattr
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|2
)braket
suffix:semicolon
id|u32
id|bmres
(braket
l_int|2
)braket
suffix:semicolon
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|inode
)paren
comma
l_string|&quot;getattr&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
id|fattr
comma
id|bmres
)paren
suffix:semicolon
r_return
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* &n; * The file is not closed if it is opened due to the a request to change&n; * the size of the file. The open call will not be needed once the&n; * VFS layer lookup-intents are implemented.&n; * Close is called when the inode is destroyed.&n; */
r_static
r_int
DECL|function|nfs4_proc_setattr
id|nfs4_proc_setattr
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_struct
id|nfs_fattr
op_star
id|fattr
comma
r_struct
id|iattr
op_star
id|sattr
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|dentry-&gt;d_inode
suffix:semicolon
r_int
id|size_change
op_assign
id|sattr-&gt;ia_valid
op_amp
id|ATTR_SIZE
suffix:semicolon
r_struct
id|nfs_fh
id|throwaway_fh
suffix:semicolon
r_struct
id|nfs4_shareowner
op_star
id|sp
op_assign
l_int|NULL
suffix:semicolon
r_int
id|status
comma
id|fake
op_assign
l_int|1
suffix:semicolon
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|size_change
)paren
(brace
id|status
op_assign
id|nfs4_do_open
c_func
(paren
id|dentry-&gt;d_parent-&gt;d_inode
comma
op_amp
id|dentry-&gt;d_name
comma
id|O_WRONLY
comma
l_int|NULL
comma
id|fattr
comma
op_amp
id|throwaway_fh
comma
op_amp
id|sp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
id|status
suffix:semicolon
id|fake
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Because OPEN is always done by name in nfsv4, it is&n;&t;&t; * possible that we opened a different file by the same&n;&t;&t; * name.  We can recognize this race condition, but we&n;&t;&t; * can&squot;t do anything about it besides returning an error.&n;&t;&t; *&n;&t;&t; * XXX: Should we compare filehandles too, as in&n;&t;&t; * nfs_find_actor()?&n;&t;&t; */
r_if
c_cond
(paren
id|fattr-&gt;fileid
op_ne
id|NFS_FILEID
c_func
(paren
id|inode
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;nfs: raced in setattr, returning -EIO&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
)brace
id|status
op_assign
id|do_setattr
c_func
(paren
id|NFS_SERVER
c_func
(paren
id|inode
)paren
comma
id|fattr
comma
id|NFS_FH
c_func
(paren
id|inode
)paren
comma
id|sattr
comma
id|fake
op_eq
l_int|1
ques
c_cond
id|zero_stateid
suffix:colon
id|sp-&gt;so_stateid
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_lookup
id|nfs4_proc_lookup
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|qstr
op_star
id|name
comma
r_struct
id|nfs_fh
op_star
id|fhandle
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|5
)braket
suffix:semicolon
r_struct
id|nfs_fattr
id|dir_attr
suffix:semicolon
id|u32
id|dir_bmres
(braket
l_int|2
)braket
suffix:semicolon
id|u32
id|bmres
(braket
l_int|2
)braket
suffix:semicolon
r_int
id|status
suffix:semicolon
id|dir_attr.valid
op_assign
l_int|0
suffix:semicolon
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;NFS call  lookup %s&bslash;n&quot;
comma
id|name-&gt;name
)paren
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|dir
)paren
comma
l_string|&quot;lookup&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|dir
)paren
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
op_amp
id|dir_attr
comma
id|dir_bmres
)paren
suffix:semicolon
id|nfs4_setup_lookup
c_func
(paren
op_amp
id|compound
comma
id|name
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
id|fattr
comma
id|bmres
)paren
suffix:semicolon
id|nfs4_setup_getfh
c_func
(paren
op_amp
id|compound
comma
id|fhandle
)paren
suffix:semicolon
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;NFS reply lookup: %d&bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ge
l_int|0
)paren
id|status
op_assign
id|nfs_refresh_inode
c_func
(paren
id|dir
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_access
id|nfs4_proc_access
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|rpc_cred
op_star
id|cred
comma
r_int
id|mode
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|3
)braket
suffix:semicolon
r_struct
id|nfs_fattr
id|fattr
suffix:semicolon
id|u32
id|bmres
(braket
l_int|2
)braket
suffix:semicolon
id|u32
id|req_access
op_assign
l_int|0
comma
id|resp_supported
comma
id|resp_access
suffix:semicolon
r_int
id|status
suffix:semicolon
id|fattr.valid
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Determine which access bits we want to ask for...&n;&t; */
r_if
c_cond
(paren
id|mode
op_amp
id|MAY_READ
)paren
id|req_access
op_or_assign
id|NFS4_ACCESS_READ
suffix:semicolon
r_if
c_cond
(paren
id|S_ISDIR
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
(brace
r_if
c_cond
(paren
id|mode
op_amp
id|MAY_WRITE
)paren
id|req_access
op_or_assign
id|NFS4_ACCESS_MODIFY
op_or
id|NFS4_ACCESS_EXTEND
op_or
id|NFS4_ACCESS_DELETE
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_amp
id|MAY_EXEC
)paren
id|req_access
op_or_assign
id|NFS4_ACCESS_LOOKUP
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|mode
op_amp
id|MAY_WRITE
)paren
id|req_access
op_or_assign
id|NFS4_ACCESS_MODIFY
op_or
id|NFS4_ACCESS_EXTEND
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_amp
id|MAY_EXEC
)paren
id|req_access
op_or_assign
id|NFS4_ACCESS_EXECUTE
suffix:semicolon
)brace
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|inode
)paren
comma
l_string|&quot;access&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
op_amp
id|fattr
comma
id|bmres
)paren
suffix:semicolon
id|nfs4_setup_access
c_func
(paren
op_amp
id|compound
comma
id|req_access
comma
op_amp
id|resp_supported
comma
op_amp
id|resp_access
)paren
suffix:semicolon
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
id|cred
comma
l_int|0
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|inode
comma
op_amp
id|fattr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
r_if
c_cond
(paren
id|req_access
op_ne
id|resp_supported
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;NFS: server didn&squot;t support all access bits!&bslash;n&quot;
)paren
suffix:semicolon
id|status
op_assign
op_minus
id|ENOTSUPP
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|req_access
op_ne
id|resp_access
)paren
id|status
op_assign
op_minus
id|EACCES
suffix:semicolon
)brace
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * TODO: For the time being, we don&squot;t try to get any attributes&n; * along with any of the zero-copy operations READ, READDIR,&n; * READLINK, WRITE.&n; *&n; * In the case of the first three, we want to put the GETATTR&n; * after the read-type operation -- this is because it is hard&n; * to predict the length of a GETATTR response in v4, and thus&n; * align the READ data correctly.  This means that the GETATTR&n; * may end up partially falling into the page cache, and we should&n; * shift it into the &squot;tail&squot; of the xdr_buf before processing.&n; * To do this efficiently, we need to know the total length&n; * of data received, which doesn&squot;t seem to be available outside&n; * of the RPC layer.&n; *&n; * In the case of WRITE, we also want to put the GETATTR after&n; * the operation -- in this case because we want to make sure&n; * we get the post-operation mtime and size.  This means that&n; * we can&squot;t use xdr_encode_pages() as written: we need a variant&n; * of it which would leave room in the &squot;tail&squot; iovec.&n; *&n; * Both of these changes to the XDR layer would in fact be quite&n; * minor, but I decided to leave them for a subsequent patch.&n; */
r_static
r_int
DECL|function|nfs4_proc_readlink
id|nfs4_proc_readlink
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|page
op_star
id|page
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|2
)braket
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|inode
)paren
comma
l_string|&quot;readlink&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|nfs4_setup_readlink
c_func
(paren
op_amp
id|compound
comma
id|PAGE_CACHE_SIZE
comma
op_amp
id|page
)paren
suffix:semicolon
r_return
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_read
id|nfs4_proc_read
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|rpc_cred
op_star
id|cred
comma
r_struct
id|nfs_fattr
op_star
id|fattr
comma
r_int
id|flags
comma
r_int
r_int
id|base
comma
r_int
r_int
id|count
comma
r_struct
id|page
op_star
id|page
comma
r_int
op_star
id|eofp
)paren
(brace
r_struct
id|nfs_server
op_star
id|server
op_assign
id|NFS_SERVER
c_func
(paren
id|inode
)paren
suffix:semicolon
r_uint64
id|offset
op_assign
id|page_offset
c_func
(paren
id|page
)paren
op_plus
id|base
suffix:semicolon
r_struct
id|nfs_readargs
id|arg
op_assign
(brace
dot
id|fh
op_assign
id|NFS_FH
c_func
(paren
id|inode
)paren
comma
dot
id|offset
op_assign
id|offset
comma
dot
id|count
op_assign
id|count
comma
dot
id|pgbase
op_assign
id|base
comma
dot
id|pages
op_assign
op_amp
id|page
comma
)brace
suffix:semicolon
r_struct
id|nfs_readres
id|res
op_assign
(brace
dot
id|fattr
op_assign
id|fattr
comma
dot
id|count
op_assign
id|count
comma
)brace
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_READ
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|arg
comma
dot
id|rpc_resp
op_assign
op_amp
id|res
comma
dot
id|rpc_cred
op_assign
id|cred
comma
)brace
suffix:semicolon
r_int
r_int
id|timestamp
op_assign
id|jiffies
suffix:semicolon
r_int
id|status
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;NFS call  read %d @ %Ld&bslash;n&quot;
comma
id|count
comma
(paren
r_int
r_int
)paren
id|offset
)paren
suffix:semicolon
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|status
op_assign
id|rpc_call_sync
c_func
(paren
id|server-&gt;client
comma
op_amp
id|msg
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
id|renew_lease
c_func
(paren
id|server
comma
id|timestamp
)paren
suffix:semicolon
multiline_comment|/* Check cache consistency */
r_if
c_cond
(paren
id|fattr-&gt;change_attr
op_ne
id|NFS_CHANGE_ATTR
c_func
(paren
id|inode
)paren
)paren
id|nfs_zap_caches
c_func
(paren
id|inode
)paren
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_string|&quot;NFS reply read: %d&bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
op_star
id|eofp
op_assign
id|res.eof
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_write
id|nfs4_proc_write
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|rpc_cred
op_star
id|cred
comma
r_struct
id|nfs_fattr
op_star
id|fattr
comma
r_int
id|flags
comma
r_int
r_int
id|base
comma
r_int
r_int
id|count
comma
r_struct
id|page
op_star
id|page
comma
r_struct
id|nfs_writeverf
op_star
id|verf
)paren
(brace
r_struct
id|nfs_server
op_star
id|server
op_assign
id|NFS_SERVER
c_func
(paren
id|inode
)paren
suffix:semicolon
r_uint64
id|offset
op_assign
id|page_offset
c_func
(paren
id|page
)paren
op_plus
id|base
suffix:semicolon
r_struct
id|nfs_writeargs
id|arg
op_assign
(brace
dot
id|fh
op_assign
id|NFS_FH
c_func
(paren
id|inode
)paren
comma
dot
id|offset
op_assign
id|offset
comma
dot
id|count
op_assign
id|count
comma
dot
id|stable
op_assign
(paren
id|flags
op_amp
id|NFS_RW_SYNC
)paren
ques
c_cond
id|NFS_FILE_SYNC
suffix:colon
id|NFS_UNSTABLE
comma
dot
id|pgbase
op_assign
id|base
comma
dot
id|pages
op_assign
op_amp
id|page
comma
)brace
suffix:semicolon
r_struct
id|nfs_writeres
id|res
op_assign
(brace
dot
id|fattr
op_assign
id|fattr
comma
dot
id|count
op_assign
id|count
comma
dot
id|verf
op_assign
id|verf
comma
)brace
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_WRITE
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|arg
comma
dot
id|rpc_resp
op_assign
op_amp
id|res
comma
dot
id|rpc_cred
op_assign
id|cred
comma
)brace
suffix:semicolon
r_int
id|rpcflags
op_assign
(paren
id|flags
op_amp
id|NFS_RW_SWAP
)paren
ques
c_cond
id|NFS_RPC_SWAPFLAGS
suffix:colon
l_int|0
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;NFS call  write %d @ %Ld&bslash;n&quot;
comma
id|count
comma
(paren
r_int
r_int
)paren
id|offset
)paren
suffix:semicolon
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
r_return
id|rpc_call_sync
c_func
(paren
id|server-&gt;client
comma
op_amp
id|msg
comma
id|rpcflags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Got race?&n; * We will need to arrange for the VFS layer to provide an atomic open.&n; * Until then, this create/open method is prone to inefficiency and race&n; * conditions due to the lookup, create, and open VFS calls from sys_open()&n; * placed on the wire.&n; *&n; * Given the above sorry state of affairs, I&squot;m simply sending an OPEN.&n; * The file will be opened again in the subsequent VFS open call&n; * (nfs4_proc_file_open).&n; *&n; * The open for read will just hang around to be used by any process that&n; * opens the file O_RDONLY. This will all be resolved with the VFS changes.&n; */
r_static
r_int
DECL|function|nfs4_proc_create
id|nfs4_proc_create
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|qstr
op_star
id|name
comma
r_struct
id|iattr
op_star
id|sattr
comma
r_int
id|flags
comma
r_struct
id|nfs_fh
op_star
id|fhandle
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
r_int
id|oflags
suffix:semicolon
r_struct
id|nfs4_shareowner
op_star
id|sp
op_assign
l_int|NULL
suffix:semicolon
r_int
id|status
suffix:semicolon
id|oflags
op_assign
id|O_RDONLY
op_or
id|O_CREAT
op_or
(paren
id|flags
op_amp
id|O_EXCL
)paren
suffix:semicolon
id|status
op_assign
id|nfs4_do_open
c_func
(paren
id|dir
comma
id|name
comma
id|oflags
comma
id|sattr
comma
id|fattr
comma
id|fhandle
comma
op_amp
id|sp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
r_if
c_cond
(paren
id|flags
op_amp
id|O_EXCL
)paren
(brace
id|status
op_assign
id|do_setattr
c_func
(paren
id|NFS_SERVER
c_func
(paren
id|dir
)paren
comma
id|fattr
comma
id|fhandle
comma
id|sattr
comma
id|sp-&gt;so_stateid
)paren
suffix:semicolon
multiline_comment|/* XXX should i bother closing the file? */
)brace
)brace
r_return
id|status
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_remove
id|nfs4_proc_remove
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|qstr
op_star
id|name
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|3
)braket
suffix:semicolon
r_struct
id|nfs4_change_info
id|dir_cinfo
suffix:semicolon
r_struct
id|nfs_fattr
id|dir_attr
suffix:semicolon
id|u32
id|dir_bmres
(braket
l_int|2
)braket
suffix:semicolon
r_int
id|status
suffix:semicolon
id|dir_attr.valid
op_assign
l_int|0
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|dir
)paren
comma
l_string|&quot;remove&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|dir
)paren
)paren
suffix:semicolon
id|nfs4_setup_remove
c_func
(paren
op_amp
id|compound
comma
id|name
comma
op_amp
id|dir_cinfo
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
op_amp
id|dir_attr
comma
id|dir_bmres
)paren
suffix:semicolon
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
id|process_cinfo
c_func
(paren
op_amp
id|dir_cinfo
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|dir
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
)brace
r_return
id|status
suffix:semicolon
)brace
DECL|struct|unlink_desc
r_struct
id|unlink_desc
(brace
DECL|member|compound
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
DECL|member|ops
r_struct
id|nfs4_op
id|ops
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|cinfo
r_struct
id|nfs4_change_info
id|cinfo
suffix:semicolon
DECL|member|attrs
r_struct
id|nfs_fattr
id|attrs
suffix:semicolon
)brace
suffix:semicolon
r_static
r_int
DECL|function|nfs4_proc_unlink_setup
id|nfs4_proc_unlink_setup
c_func
(paren
r_struct
id|rpc_message
op_star
id|msg
comma
r_struct
id|dentry
op_star
id|dir
comma
r_struct
id|qstr
op_star
id|name
)paren
(brace
r_struct
id|unlink_desc
op_star
id|up
suffix:semicolon
r_struct
id|nfs4_compound
op_star
id|cp
suffix:semicolon
id|u32
id|bmres
(braket
l_int|2
)braket
suffix:semicolon
id|up
op_assign
(paren
r_struct
id|unlink_desc
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|up
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|up
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|cp
op_assign
op_amp
id|up-&gt;compound
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
id|cp
comma
id|up-&gt;ops
comma
id|NFS_SERVER
c_func
(paren
id|dir-&gt;d_inode
)paren
comma
l_string|&quot;unlink_setup&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
id|cp
comma
id|NFS_FH
c_func
(paren
id|dir-&gt;d_inode
)paren
)paren
suffix:semicolon
id|nfs4_setup_remove
c_func
(paren
id|cp
comma
id|name
comma
op_amp
id|up-&gt;cinfo
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
id|cp
comma
op_amp
id|up-&gt;attrs
comma
id|bmres
)paren
suffix:semicolon
id|msg-&gt;rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_COMPOUND
)braket
suffix:semicolon
id|msg-&gt;rpc_argp
op_assign
id|cp
suffix:semicolon
id|msg-&gt;rpc_resp
op_assign
id|cp
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_unlink_done
id|nfs4_proc_unlink_done
c_func
(paren
r_struct
id|dentry
op_star
id|dir
comma
r_struct
id|rpc_task
op_star
id|task
)paren
(brace
r_struct
id|rpc_message
op_star
id|msg
op_assign
op_amp
id|task-&gt;tk_msg
suffix:semicolon
r_struct
id|unlink_desc
op_star
id|up
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;rpc_argp
)paren
(brace
id|up
op_assign
(paren
r_struct
id|unlink_desc
op_star
)paren
id|msg-&gt;rpc_argp
suffix:semicolon
id|process_lease
c_func
(paren
op_amp
id|up-&gt;compound
)paren
suffix:semicolon
id|process_cinfo
c_func
(paren
op_amp
id|up-&gt;cinfo
comma
op_amp
id|up-&gt;attrs
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|dir-&gt;d_inode
comma
op_amp
id|up-&gt;attrs
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|up
)paren
suffix:semicolon
id|msg-&gt;rpc_argp
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_rename
id|nfs4_proc_rename
c_func
(paren
r_struct
id|inode
op_star
id|old_dir
comma
r_struct
id|qstr
op_star
id|old_name
comma
r_struct
id|inode
op_star
id|new_dir
comma
r_struct
id|qstr
op_star
id|new_name
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|7
)braket
suffix:semicolon
r_struct
id|nfs4_change_info
id|old_cinfo
comma
id|new_cinfo
suffix:semicolon
r_struct
id|nfs_fattr
id|old_dir_attr
comma
id|new_dir_attr
suffix:semicolon
id|u32
id|old_dir_bmres
(braket
l_int|2
)braket
comma
id|new_dir_bmres
(braket
l_int|2
)braket
suffix:semicolon
r_int
id|status
suffix:semicolon
id|old_dir_attr.valid
op_assign
l_int|0
suffix:semicolon
id|new_dir_attr.valid
op_assign
l_int|0
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|old_dir
)paren
comma
l_string|&quot;rename&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|old_dir
)paren
)paren
suffix:semicolon
id|nfs4_setup_savefh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|new_dir
)paren
)paren
suffix:semicolon
id|nfs4_setup_rename
c_func
(paren
op_amp
id|compound
comma
id|old_name
comma
id|new_name
comma
op_amp
id|old_cinfo
comma
op_amp
id|new_cinfo
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
op_amp
id|new_dir_attr
comma
id|new_dir_bmres
)paren
suffix:semicolon
id|nfs4_setup_restorefh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
op_amp
id|old_dir_attr
comma
id|old_dir_bmres
)paren
suffix:semicolon
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
id|process_cinfo
c_func
(paren
op_amp
id|old_cinfo
comma
op_amp
id|old_dir_attr
)paren
suffix:semicolon
id|process_cinfo
c_func
(paren
op_amp
id|new_cinfo
comma
op_amp
id|new_dir_attr
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|old_dir
comma
op_amp
id|old_dir_attr
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|new_dir
comma
op_amp
id|new_dir_attr
)paren
suffix:semicolon
)brace
r_return
id|status
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_link
id|nfs4_proc_link
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|qstr
op_star
id|name
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|7
)braket
suffix:semicolon
r_struct
id|nfs4_change_info
id|dir_cinfo
suffix:semicolon
r_struct
id|nfs_fattr
id|dir_attr
comma
id|fattr
suffix:semicolon
id|u32
id|dir_bmres
(braket
l_int|2
)braket
comma
id|bmres
(braket
l_int|2
)braket
suffix:semicolon
r_int
id|status
suffix:semicolon
id|dir_attr.valid
op_assign
l_int|0
suffix:semicolon
id|fattr.valid
op_assign
l_int|0
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|inode
)paren
comma
l_string|&quot;link&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|nfs4_setup_savefh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|dir
)paren
)paren
suffix:semicolon
id|nfs4_setup_link
c_func
(paren
op_amp
id|compound
comma
id|name
comma
op_amp
id|dir_cinfo
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
op_amp
id|dir_attr
comma
id|dir_bmres
)paren
suffix:semicolon
id|nfs4_setup_restorefh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
op_amp
id|fattr
comma
id|bmres
)paren
suffix:semicolon
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
id|process_cinfo
c_func
(paren
op_amp
id|dir_cinfo
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|dir
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|inode
comma
op_amp
id|fattr
)paren
suffix:semicolon
)brace
r_return
id|status
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_symlink
id|nfs4_proc_symlink
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|qstr
op_star
id|name
comma
r_struct
id|qstr
op_star
id|path
comma
r_struct
id|iattr
op_star
id|sattr
comma
r_struct
id|nfs_fh
op_star
id|fhandle
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|7
)braket
suffix:semicolon
r_struct
id|nfs_fattr
id|dir_attr
suffix:semicolon
id|u32
id|dir_bmres
(braket
l_int|2
)braket
comma
id|bmres
(braket
l_int|2
)braket
suffix:semicolon
r_struct
id|nfs4_change_info
id|dir_cinfo
suffix:semicolon
r_int
id|status
suffix:semicolon
id|dir_attr.valid
op_assign
l_int|0
suffix:semicolon
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|dir
)paren
comma
l_string|&quot;symlink&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|dir
)paren
)paren
suffix:semicolon
id|nfs4_setup_savefh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_create_symlink
c_func
(paren
op_amp
id|compound
comma
id|name
comma
id|path
comma
id|sattr
comma
op_amp
id|dir_cinfo
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
id|fattr
comma
id|bmres
)paren
suffix:semicolon
id|nfs4_setup_getfh
c_func
(paren
op_amp
id|compound
comma
id|fhandle
)paren
suffix:semicolon
id|nfs4_setup_restorefh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
op_amp
id|dir_attr
comma
id|dir_bmres
)paren
suffix:semicolon
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
id|process_cinfo
c_func
(paren
op_amp
id|dir_cinfo
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|dir
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
)brace
r_return
id|status
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_mkdir
id|nfs4_proc_mkdir
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|qstr
op_star
id|name
comma
r_struct
id|iattr
op_star
id|sattr
comma
r_struct
id|nfs_fh
op_star
id|fhandle
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|7
)braket
suffix:semicolon
r_struct
id|nfs_fattr
id|dir_attr
suffix:semicolon
id|u32
id|dir_bmres
(braket
l_int|2
)braket
comma
id|bmres
(braket
l_int|2
)braket
suffix:semicolon
r_struct
id|nfs4_change_info
id|dir_cinfo
suffix:semicolon
r_int
id|status
suffix:semicolon
id|dir_attr.valid
op_assign
l_int|0
suffix:semicolon
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|dir
)paren
comma
l_string|&quot;mkdir&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|dir
)paren
)paren
suffix:semicolon
id|nfs4_setup_savefh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_create_dir
c_func
(paren
op_amp
id|compound
comma
id|name
comma
id|sattr
comma
op_amp
id|dir_cinfo
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
id|fattr
comma
id|bmres
)paren
suffix:semicolon
id|nfs4_setup_getfh
c_func
(paren
op_amp
id|compound
comma
id|fhandle
)paren
suffix:semicolon
id|nfs4_setup_restorefh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
op_amp
id|dir_attr
comma
id|dir_bmres
)paren
suffix:semicolon
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
id|process_cinfo
c_func
(paren
op_amp
id|dir_cinfo
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|dir
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
)brace
r_return
id|status
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_readdir
id|nfs4_proc_readdir
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_struct
id|rpc_cred
op_star
id|cred
comma
id|u64
id|cookie
comma
r_struct
id|page
op_star
id|page
comma
r_int
r_int
id|count
comma
r_int
id|plus
)paren
(brace
r_struct
id|inode
op_star
id|dir
op_assign
id|dentry-&gt;d_inode
suffix:semicolon
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|2
)braket
suffix:semicolon
r_int
id|status
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|dir
)paren
comma
l_string|&quot;readdir&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|dir
)paren
)paren
suffix:semicolon
id|nfs4_setup_readdir
c_func
(paren
op_amp
id|compound
comma
id|cookie
comma
id|NFS_COOKIEVERF
c_func
(paren
id|dir
)paren
comma
op_amp
id|page
comma
id|count
comma
id|dentry
)paren
suffix:semicolon
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
id|cred
comma
l_int|0
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_mknod
id|nfs4_proc_mknod
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|qstr
op_star
id|name
comma
r_struct
id|iattr
op_star
id|sattr
comma
id|dev_t
id|rdev
comma
r_struct
id|nfs_fh
op_star
id|fh
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|7
)braket
suffix:semicolon
r_struct
id|nfs_fattr
id|dir_attr
suffix:semicolon
id|u32
id|dir_bmres
(braket
l_int|2
)braket
comma
id|bmres
(braket
l_int|2
)braket
suffix:semicolon
r_struct
id|nfs4_change_info
id|dir_cinfo
suffix:semicolon
r_int
id|status
suffix:semicolon
id|dir_attr.valid
op_assign
l_int|0
suffix:semicolon
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|dir
)paren
comma
l_string|&quot;mknod&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|dir
)paren
)paren
suffix:semicolon
id|nfs4_setup_savefh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_create_special
c_func
(paren
op_amp
id|compound
comma
id|name
comma
id|rdev
comma
id|sattr
comma
op_amp
id|dir_cinfo
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
id|fattr
comma
id|bmres
)paren
suffix:semicolon
id|nfs4_setup_getfh
c_func
(paren
op_amp
id|compound
comma
id|fh
)paren
suffix:semicolon
id|nfs4_setup_restorefh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
op_amp
id|dir_attr
comma
id|dir_bmres
)paren
suffix:semicolon
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
id|process_cinfo
c_func
(paren
op_amp
id|dir_cinfo
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|dir
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
)brace
r_return
id|status
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_statfs
id|nfs4_proc_statfs
c_func
(paren
r_struct
id|nfs_server
op_star
id|server
comma
r_struct
id|nfs_fh
op_star
id|fhandle
comma
r_struct
id|nfs_fsstat
op_star
id|fsstat
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|2
)braket
suffix:semicolon
id|u32
id|bmres
(braket
l_int|2
)braket
suffix:semicolon
id|memset
c_func
(paren
id|fsstat
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|fsstat
)paren
)paren
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|server
comma
l_string|&quot;statfs&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|fhandle
)paren
suffix:semicolon
id|nfs4_setup_statfs
c_func
(paren
op_amp
id|compound
comma
id|fsstat
comma
id|bmres
)paren
suffix:semicolon
r_return
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_fsinfo
id|nfs4_proc_fsinfo
c_func
(paren
r_struct
id|nfs_server
op_star
id|server
comma
r_struct
id|nfs_fh
op_star
id|fhandle
comma
r_struct
id|nfs_fsinfo
op_star
id|fsinfo
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|2
)braket
suffix:semicolon
id|u32
id|bmres
(braket
l_int|2
)braket
suffix:semicolon
id|memset
c_func
(paren
id|fsinfo
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|fsinfo
)paren
)paren
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|server
comma
l_string|&quot;statfs&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|fhandle
)paren
suffix:semicolon
id|nfs4_setup_fsinfo
c_func
(paren
op_amp
id|compound
comma
id|fsinfo
comma
id|bmres
)paren
suffix:semicolon
r_return
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_pathconf
id|nfs4_proc_pathconf
c_func
(paren
r_struct
id|nfs_server
op_star
id|server
comma
r_struct
id|nfs_fh
op_star
id|fhandle
comma
r_struct
id|nfs_pathconf
op_star
id|pathconf
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|2
)braket
suffix:semicolon
id|u32
id|bmres
(braket
l_int|2
)braket
suffix:semicolon
id|memset
c_func
(paren
id|pathconf
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|pathconf
)paren
)paren
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|server
comma
l_string|&quot;statfs&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|fhandle
)paren
suffix:semicolon
id|nfs4_setup_pathconf
c_func
(paren
op_amp
id|compound
comma
id|pathconf
comma
id|bmres
)paren
suffix:semicolon
r_return
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_read_done
id|nfs4_read_done
c_func
(paren
r_struct
id|rpc_task
op_star
id|task
)paren
(brace
r_struct
id|nfs_read_data
op_star
id|data
op_assign
(paren
r_struct
id|nfs_read_data
op_star
)paren
id|task-&gt;tk_calldata
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|data-&gt;inode
suffix:semicolon
r_struct
id|nfs_fattr
op_star
id|fattr
op_assign
id|data-&gt;res.fattr
suffix:semicolon
r_if
c_cond
(paren
id|task-&gt;tk_status
OG
l_int|0
)paren
id|renew_lease
c_func
(paren
id|NFS_SERVER
c_func
(paren
id|inode
)paren
comma
id|data-&gt;timestamp
)paren
suffix:semicolon
multiline_comment|/* Check cache consistency */
r_if
c_cond
(paren
id|fattr-&gt;change_attr
op_ne
id|NFS_CHANGE_ATTR
c_func
(paren
id|inode
)paren
)paren
id|nfs_zap_caches
c_func
(paren
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fattr-&gt;bitmap
(braket
l_int|1
)braket
op_amp
id|FATTR4_WORD1_TIME_ACCESS
)paren
id|inode-&gt;i_atime
op_assign
id|fattr-&gt;atime
suffix:semicolon
multiline_comment|/* Call back common NFS readpage processing */
id|nfs_readpage_result
c_func
(paren
id|task
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_proc_read_setup
id|nfs4_proc_read_setup
c_func
(paren
r_struct
id|nfs_read_data
op_star
id|data
comma
r_int
r_int
id|count
)paren
(brace
r_struct
id|rpc_task
op_star
id|task
op_assign
op_amp
id|data-&gt;task
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_READ
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|data-&gt;args
comma
dot
id|rpc_resp
op_assign
op_amp
id|data-&gt;res
comma
dot
id|rpc_cred
op_assign
id|data-&gt;cred
comma
)brace
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|data-&gt;inode
suffix:semicolon
r_struct
id|nfs_page
op_star
id|req
op_assign
id|nfs_list_entry
c_func
(paren
id|data-&gt;pages.next
)paren
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|data-&gt;args.fh
op_assign
id|NFS_FH
c_func
(paren
id|inode
)paren
suffix:semicolon
id|data-&gt;args.offset
op_assign
id|req_offset
c_func
(paren
id|req
)paren
suffix:semicolon
id|data-&gt;args.pgbase
op_assign
id|req-&gt;wb_pgbase
suffix:semicolon
id|data-&gt;args.pages
op_assign
id|data-&gt;pagevec
suffix:semicolon
id|data-&gt;args.count
op_assign
id|count
suffix:semicolon
id|data-&gt;res.fattr
op_assign
op_amp
id|data-&gt;fattr
suffix:semicolon
id|data-&gt;res.count
op_assign
id|count
suffix:semicolon
id|data-&gt;res.eof
op_assign
l_int|0
suffix:semicolon
id|data-&gt;timestamp
op_assign
id|jiffies
suffix:semicolon
multiline_comment|/* N.B. Do we need to test? Never called for swapfile inode */
id|flags
op_assign
id|RPC_TASK_ASYNC
op_or
(paren
id|IS_SWAPFILE
c_func
(paren
id|inode
)paren
ques
c_cond
id|NFS_RPC_SWAPFLAGS
suffix:colon
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Finalize the task. */
id|rpc_init_task
c_func
(paren
id|task
comma
id|NFS_CLIENT
c_func
(paren
id|inode
)paren
comma
id|nfs4_read_done
comma
id|flags
)paren
suffix:semicolon
id|task-&gt;tk_calldata
op_assign
id|data
suffix:semicolon
multiline_comment|/* Release requests */
id|task-&gt;tk_release
op_assign
id|nfs_readdata_release
suffix:semicolon
id|rpc_call_setup
c_func
(paren
id|task
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_write_refresh_inode
id|nfs4_write_refresh_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
multiline_comment|/* Check cache consistency */
r_if
c_cond
(paren
id|fattr-&gt;pre_change_attr
op_ne
id|NFS_CHANGE_ATTR
c_func
(paren
id|inode
)paren
)paren
id|nfs_zap_caches
c_func
(paren
id|inode
)paren
suffix:semicolon
id|NFS_CHANGE_ATTR
c_func
(paren
id|inode
)paren
op_assign
id|fattr-&gt;change_attr
suffix:semicolon
r_if
c_cond
(paren
id|fattr-&gt;bitmap
(braket
l_int|1
)braket
op_amp
id|FATTR4_WORD1_SPACE_USED
)paren
id|inode-&gt;i_blocks
op_assign
(paren
id|fattr-&gt;du.nfs3.used
op_plus
l_int|511
)paren
op_rshift
l_int|9
suffix:semicolon
r_if
c_cond
(paren
id|fattr-&gt;bitmap
(braket
l_int|1
)braket
op_amp
id|FATTR4_WORD1_TIME_METADATA
)paren
id|inode-&gt;i_ctime
op_assign
id|fattr-&gt;ctime
suffix:semicolon
r_if
c_cond
(paren
id|fattr-&gt;bitmap
(braket
l_int|1
)braket
op_amp
id|FATTR4_WORD1_TIME_MODIFY
)paren
id|inode-&gt;i_mtime
op_assign
id|fattr-&gt;mtime
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_write_done
id|nfs4_write_done
c_func
(paren
r_struct
id|rpc_task
op_star
id|task
)paren
(brace
r_struct
id|nfs_write_data
op_star
id|data
op_assign
(paren
r_struct
id|nfs_write_data
op_star
)paren
id|task-&gt;tk_calldata
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|data-&gt;inode
suffix:semicolon
r_if
c_cond
(paren
id|task-&gt;tk_status
op_ge
l_int|0
)paren
id|renew_lease
c_func
(paren
id|NFS_SERVER
c_func
(paren
id|inode
)paren
comma
id|data-&gt;timestamp
)paren
suffix:semicolon
id|nfs4_write_refresh_inode
c_func
(paren
id|inode
comma
id|data-&gt;res.fattr
)paren
suffix:semicolon
multiline_comment|/* Call back common NFS writeback processing */
id|nfs_writeback_done
c_func
(paren
id|task
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_proc_write_setup
id|nfs4_proc_write_setup
c_func
(paren
r_struct
id|nfs_write_data
op_star
id|data
comma
r_int
r_int
id|count
comma
r_int
id|how
)paren
(brace
r_struct
id|rpc_task
op_star
id|task
op_assign
op_amp
id|data-&gt;task
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_WRITE
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|data-&gt;args
comma
dot
id|rpc_resp
op_assign
op_amp
id|data-&gt;res
comma
dot
id|rpc_cred
op_assign
id|data-&gt;cred
comma
)brace
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|data-&gt;inode
suffix:semicolon
r_struct
id|nfs_page
op_star
id|req
op_assign
id|nfs_list_entry
c_func
(paren
id|data-&gt;pages.next
)paren
suffix:semicolon
r_int
id|stable
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|how
op_amp
id|FLUSH_STABLE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|NFS_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|ncommit
)paren
id|stable
op_assign
id|NFS_FILE_SYNC
suffix:semicolon
r_else
id|stable
op_assign
id|NFS_DATA_SYNC
suffix:semicolon
)brace
r_else
id|stable
op_assign
id|NFS_UNSTABLE
suffix:semicolon
id|data-&gt;args.fh
op_assign
id|NFS_FH
c_func
(paren
id|inode
)paren
suffix:semicolon
id|data-&gt;args.offset
op_assign
id|req_offset
c_func
(paren
id|req
)paren
suffix:semicolon
id|data-&gt;args.pgbase
op_assign
id|req-&gt;wb_pgbase
suffix:semicolon
id|data-&gt;args.count
op_assign
id|count
suffix:semicolon
id|data-&gt;args.stable
op_assign
id|stable
suffix:semicolon
id|data-&gt;args.pages
op_assign
id|data-&gt;pagevec
suffix:semicolon
id|data-&gt;res.fattr
op_assign
op_amp
id|data-&gt;fattr
suffix:semicolon
id|data-&gt;res.count
op_assign
id|count
suffix:semicolon
id|data-&gt;res.verf
op_assign
op_amp
id|data-&gt;verf
suffix:semicolon
id|data-&gt;timestamp
op_assign
id|jiffies
suffix:semicolon
multiline_comment|/* Set the initial flags for the task.  */
id|flags
op_assign
(paren
id|how
op_amp
id|FLUSH_SYNC
)paren
ques
c_cond
l_int|0
suffix:colon
id|RPC_TASK_ASYNC
suffix:semicolon
multiline_comment|/* Finalize the task. */
id|rpc_init_task
c_func
(paren
id|task
comma
id|NFS_CLIENT
c_func
(paren
id|inode
)paren
comma
id|nfs4_write_done
comma
id|flags
)paren
suffix:semicolon
id|task-&gt;tk_calldata
op_assign
id|data
suffix:semicolon
multiline_comment|/* Release requests */
id|task-&gt;tk_release
op_assign
id|nfs_writedata_release
suffix:semicolon
id|rpc_call_setup
c_func
(paren
id|task
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_commit_done
id|nfs4_commit_done
c_func
(paren
r_struct
id|rpc_task
op_star
id|task
)paren
(brace
r_struct
id|nfs_write_data
op_star
id|data
op_assign
(paren
r_struct
id|nfs_write_data
op_star
)paren
id|task-&gt;tk_calldata
suffix:semicolon
id|nfs4_write_refresh_inode
c_func
(paren
id|data-&gt;inode
comma
id|data-&gt;res.fattr
)paren
suffix:semicolon
multiline_comment|/* Call back common NFS writeback processing */
id|nfs_commit_done
c_func
(paren
id|task
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_proc_commit_setup
id|nfs4_proc_commit_setup
c_func
(paren
r_struct
id|nfs_write_data
op_star
id|data
comma
id|u64
id|start
comma
id|u32
id|len
comma
r_int
id|how
)paren
(brace
r_struct
id|rpc_task
op_star
id|task
op_assign
op_amp
id|data-&gt;task
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_COMMIT
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|data-&gt;args
comma
dot
id|rpc_resp
op_assign
op_amp
id|data-&gt;res
comma
dot
id|rpc_cred
op_assign
id|data-&gt;cred
comma
)brace
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|data-&gt;inode
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|data-&gt;args.fh
op_assign
id|NFS_FH
c_func
(paren
id|data-&gt;inode
)paren
suffix:semicolon
id|data-&gt;args.offset
op_assign
id|start
suffix:semicolon
id|data-&gt;args.count
op_assign
id|len
suffix:semicolon
id|data-&gt;res.count
op_assign
id|len
suffix:semicolon
id|data-&gt;res.fattr
op_assign
op_amp
id|data-&gt;fattr
suffix:semicolon
id|data-&gt;res.verf
op_assign
op_amp
id|data-&gt;verf
suffix:semicolon
multiline_comment|/* Set the initial flags for the task.  */
id|flags
op_assign
(paren
id|how
op_amp
id|FLUSH_SYNC
)paren
ques
c_cond
l_int|0
suffix:colon
id|RPC_TASK_ASYNC
suffix:semicolon
multiline_comment|/* Finalize the task. */
id|rpc_init_task
c_func
(paren
id|task
comma
id|NFS_CLIENT
c_func
(paren
id|inode
)paren
comma
id|nfs4_commit_done
comma
id|flags
)paren
suffix:semicolon
id|task-&gt;tk_calldata
op_assign
id|data
suffix:semicolon
multiline_comment|/* Release requests */
id|task-&gt;tk_release
op_assign
id|nfs_commit_release
suffix:semicolon
id|rpc_call_setup
c_func
(paren
id|task
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * nfs4_proc_renew(): This is not one of the nfs_rpc_ops; it is a special&n; * standalone procedure for queueing an asynchronous RENEW.&n; */
DECL|struct|renew_desc
r_struct
id|renew_desc
(brace
DECL|member|task
r_struct
id|rpc_task
id|task
suffix:semicolon
DECL|member|compound
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
DECL|member|ops
r_struct
id|nfs4_op
id|ops
(braket
l_int|1
)braket
suffix:semicolon
)brace
suffix:semicolon
r_static
r_void
DECL|function|renew_done
id|renew_done
c_func
(paren
r_struct
id|rpc_task
op_star
id|task
)paren
(brace
r_struct
id|nfs4_compound
op_star
id|cp
op_assign
(paren
r_struct
id|nfs4_compound
op_star
)paren
id|task-&gt;tk_msg.rpc_argp
suffix:semicolon
id|process_lease
c_func
(paren
id|cp
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|renew_release
id|renew_release
c_func
(paren
r_struct
id|rpc_task
op_star
id|task
)paren
(brace
id|kfree
c_func
(paren
id|task-&gt;tk_calldata
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs4_proc_renew
id|nfs4_proc_renew
c_func
(paren
r_struct
id|nfs_server
op_star
id|server
)paren
(brace
r_struct
id|renew_desc
op_star
id|rp
suffix:semicolon
r_struct
id|rpc_task
op_star
id|task
suffix:semicolon
r_struct
id|nfs4_compound
op_star
id|cp
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_COMPOUND
)braket
comma
)brace
suffix:semicolon
id|rp
op_assign
(paren
r_struct
id|renew_desc
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|rp
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|cp
op_assign
op_amp
id|rp-&gt;compound
suffix:semicolon
id|task
op_assign
op_amp
id|rp-&gt;task
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
id|cp
comma
id|rp-&gt;ops
comma
id|server
comma
l_string|&quot;renew&quot;
)paren
suffix:semicolon
id|nfs4_setup_renew
c_func
(paren
id|cp
)paren
suffix:semicolon
id|msg.rpc_argp
op_assign
id|cp
suffix:semicolon
id|msg.rpc_resp
op_assign
id|cp
suffix:semicolon
id|rpc_init_task
c_func
(paren
id|task
comma
id|server-&gt;client
comma
id|renew_done
comma
id|RPC_TASK_ASYNC
)paren
suffix:semicolon
id|rpc_call_setup
c_func
(paren
id|task
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
id|task-&gt;tk_calldata
op_assign
id|rp
suffix:semicolon
id|task-&gt;tk_release
op_assign
id|renew_release
suffix:semicolon
r_return
id|rpc_execute
c_func
(paren
id|task
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * We will need to arrange for the VFS layer to provide an atomic open.&n; * Until then, this open method is prone to inefficiency and race conditions&n; * due to the lookup, potential create, and open VFS calls from sys_open()&n; * placed on the wire.&n; */
r_int
DECL|function|nfs4_proc_file_open
id|nfs4_proc_file_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_struct
id|dentry
op_star
id|dentry
op_assign
id|filp-&gt;f_dentry
suffix:semicolon
r_struct
id|inode
op_star
id|dir
op_assign
id|dentry-&gt;d_parent-&gt;d_inode
suffix:semicolon
r_int
id|flags
comma
id|status
op_assign
l_int|0
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;nfs4_proc_file_open: starting on (%.*s/%.*s)&bslash;n&quot;
comma
(paren
r_int
)paren
id|dentry-&gt;d_parent-&gt;d_name.len
comma
id|dentry-&gt;d_parent-&gt;d_name.name
comma
(paren
r_int
)paren
id|dentry-&gt;d_name.len
comma
id|dentry-&gt;d_name.name
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* isn&squot;t this done in open_namei? */
r_if
c_cond
(paren
op_logical_neg
id|S_ISREG
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
(brace
id|status
op_assign
op_minus
id|EISDIR
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|flags
op_assign
id|filp-&gt;f_flags
op_amp
id|O_ACCMODE
suffix:semicolon
multiline_comment|/*&n;* Got race??&n;* We have already opened the file &quot;O_EXCL&quot; in nfs4_proc_create!!&n;* This ugliness will go away with lookup-intent...&n;*/
r_while
c_loop
(paren
op_logical_neg
id|nfs4_get_inode_share
c_func
(paren
id|inode
comma
id|flags
)paren
)paren
(brace
r_struct
id|nfs4_shareowner
op_star
id|sp
op_assign
l_int|NULL
suffix:semicolon
id|status
op_assign
id|nfs4_do_open
c_func
(paren
id|dir
comma
op_amp
id|dentry-&gt;d_name
comma
id|flags
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
op_amp
id|sp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
id|nfs4_put_shareowner
c_func
(paren
id|inode
comma
id|sp
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nfs4_set_inode_share
c_func
(paren
id|inode
comma
id|sp
comma
id|flags
)paren
)paren
id|nfs4_put_shareowner
c_func
(paren
id|inode
comma
id|sp
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
DECL|variable|nfs_v4_clientops
r_struct
id|nfs_rpc_ops
id|nfs_v4_clientops
op_assign
(brace
dot
id|version
op_assign
l_int|4
comma
multiline_comment|/* protocol version */
dot
id|getroot
op_assign
id|nfs4_proc_get_root
comma
dot
id|getattr
op_assign
id|nfs4_proc_getattr
comma
dot
id|setattr
op_assign
id|nfs4_proc_setattr
comma
dot
id|lookup
op_assign
id|nfs4_proc_lookup
comma
dot
id|access
op_assign
id|nfs4_proc_access
comma
dot
id|readlink
op_assign
id|nfs4_proc_readlink
comma
dot
id|read
op_assign
id|nfs4_proc_read
comma
dot
id|write
op_assign
id|nfs4_proc_write
comma
dot
id|commit
op_assign
l_int|NULL
comma
dot
id|create
op_assign
id|nfs4_proc_create
comma
dot
id|remove
op_assign
id|nfs4_proc_remove
comma
dot
id|unlink_setup
op_assign
id|nfs4_proc_unlink_setup
comma
dot
id|unlink_done
op_assign
id|nfs4_proc_unlink_done
comma
dot
id|rename
op_assign
id|nfs4_proc_rename
comma
dot
id|link
op_assign
id|nfs4_proc_link
comma
dot
id|symlink
op_assign
id|nfs4_proc_symlink
comma
dot
id|mkdir
op_assign
id|nfs4_proc_mkdir
comma
dot
id|rmdir
op_assign
id|nfs4_proc_remove
comma
dot
id|readdir
op_assign
id|nfs4_proc_readdir
comma
dot
id|mknod
op_assign
id|nfs4_proc_mknod
comma
dot
id|statfs
op_assign
id|nfs4_proc_statfs
comma
dot
id|fsinfo
op_assign
id|nfs4_proc_fsinfo
comma
dot
id|pathconf
op_assign
id|nfs4_proc_pathconf
comma
dot
id|decode_dirent
op_assign
id|nfs4_decode_dirent
comma
dot
id|read_setup
op_assign
id|nfs4_proc_read_setup
comma
dot
id|write_setup
op_assign
id|nfs4_proc_write_setup
comma
dot
id|commit_setup
op_assign
id|nfs4_proc_commit_setup
comma
dot
id|file_open
op_assign
id|nfs4_proc_file_open
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Local variables:&n; *  c-basic-offset: 8&n; * End:&n; */
eof
