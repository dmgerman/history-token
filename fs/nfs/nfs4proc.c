multiline_comment|/*&n; *  fs/nfs/nfs4proc.c&n; *&n; *  Client-side procedure declarations for NFSv4.&n; *&n; *  Copyright (c) 2002 The Regents of the University of Michigan.&n; *  All rights reserved.&n; *&n; *  Kendrick Smith &lt;kmsmith@umich.edu&gt;&n; *  Andy Adamson   &lt;andros@umich.edu&gt;&n; *&n; *  Redistribution and use in source and binary forms, with or without&n; *  modification, are permitted provided that the following conditions&n; *  are met:&n; *&n; *  1. Redistributions of source code must retain the above copyright&n; *     notice, this list of conditions and the following disclaimer.&n; *  2. Redistributions in binary form must reproduce the above copyright&n; *     notice, this list of conditions and the following disclaimer in the&n; *     documentation and/or other materials provided with the distribution.&n; *  3. Neither the name of the University nor the names of its&n; *     contributors may be used to endorse or promote products derived&n; *     from this software without specific prior written permission.&n; *&n; *  THIS SOFTWARE IS PROVIDED ``AS IS&squot;&squot; AND ANY EXPRESS OR IMPLIED&n; *  WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF&n; *  MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE&n; *  DISCLAIMED. IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE&n; *  FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR&n; *  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF&n; *  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR&n; *  BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF&n; *  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING&n; *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS&n; *  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.&n; */
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/utsname.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/sunrpc/clnt.h&gt;
macro_line|#include &lt;linux/nfs.h&gt;
macro_line|#include &lt;linux/nfs4.h&gt;
macro_line|#include &lt;linux/nfs_fs.h&gt;
macro_line|#include &lt;linux/nfs_page.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/namei.h&gt;
DECL|macro|NFSDBG_FACILITY
mdefine_line|#define NFSDBG_FACILITY&t;&t;NFSDBG_PROC
DECL|macro|NFS4_POLL_RETRY_TIME
mdefine_line|#define NFS4_POLL_RETRY_TIME&t;(15*HZ)
DECL|macro|GET_OP
mdefine_line|#define GET_OP(cp,name)&t;&t;&amp;cp-&gt;ops[cp-&gt;req_nops].u.name
DECL|macro|OPNUM
mdefine_line|#define OPNUM(cp)&t;&t;cp-&gt;ops[cp-&gt;req_nops].opnum
r_static
r_int
id|nfs4_proc_fsinfo
c_func
(paren
r_struct
id|nfs_server
op_star
comma
r_struct
id|nfs_fh
op_star
comma
r_struct
id|nfs_fsinfo
op_star
)paren
suffix:semicolon
r_static
r_int
id|nfs4_async_handle_error
c_func
(paren
r_struct
id|rpc_task
op_star
comma
r_struct
id|nfs_server
op_star
)paren
suffix:semicolon
r_extern
id|u32
op_star
id|nfs4_decode_dirent
c_func
(paren
id|u32
op_star
id|p
comma
r_struct
id|nfs_entry
op_star
id|entry
comma
r_int
id|plus
)paren
suffix:semicolon
r_extern
r_struct
id|rpc_procinfo
id|nfs4_procedures
(braket
)braket
suffix:semicolon
r_extern
id|nfs4_stateid
id|zero_stateid
suffix:semicolon
multiline_comment|/* Prevent leaks of NFSv4 errors into userland */
DECL|function|nfs4_map_errors
r_static
r_inline
r_int
id|nfs4_map_errors
c_func
(paren
r_int
id|err
)paren
(brace
r_if
c_cond
(paren
id|err
OL
op_minus
l_int|1000
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;%s could not handle NFSv4 error %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
op_minus
id|err
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_compound
id|nfs4_setup_compound
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|nfs4_op
op_star
id|ops
comma
r_struct
id|nfs_server
op_star
id|server
comma
r_char
op_star
id|tag
)paren
(brace
id|memset
c_func
(paren
id|cp
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|cp
)paren
)paren
suffix:semicolon
id|cp-&gt;ops
op_assign
id|ops
suffix:semicolon
id|cp-&gt;server
op_assign
id|server
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_access
id|nfs4_setup_access
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
id|u32
id|req_access
comma
id|u32
op_star
id|resp_supported
comma
id|u32
op_star
id|resp_access
)paren
(brace
r_struct
id|nfs4_access
op_star
id|access
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|access
)paren
suffix:semicolon
id|access-&gt;ac_req_access
op_assign
id|req_access
suffix:semicolon
id|access-&gt;ac_resp_supported
op_assign
id|resp_supported
suffix:semicolon
id|access-&gt;ac_resp_access
op_assign
id|resp_access
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_ACCESS
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_create_dir
id|nfs4_setup_create_dir
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|qstr
op_star
id|name
comma
r_struct
id|iattr
op_star
id|sattr
comma
r_struct
id|nfs4_change_info
op_star
id|info
)paren
(brace
r_struct
id|nfs4_create
op_star
id|create
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|create
)paren
suffix:semicolon
id|create-&gt;cr_ftype
op_assign
id|NF4DIR
suffix:semicolon
id|create-&gt;cr_namelen
op_assign
id|name-&gt;len
suffix:semicolon
id|create-&gt;cr_name
op_assign
id|name-&gt;name
suffix:semicolon
id|create-&gt;cr_attrs
op_assign
id|sattr
suffix:semicolon
id|create-&gt;cr_cinfo
op_assign
id|info
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_CREATE
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_create_symlink
id|nfs4_setup_create_symlink
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|qstr
op_star
id|name
comma
r_struct
id|qstr
op_star
id|linktext
comma
r_struct
id|iattr
op_star
id|sattr
comma
r_struct
id|nfs4_change_info
op_star
id|info
)paren
(brace
r_struct
id|nfs4_create
op_star
id|create
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|create
)paren
suffix:semicolon
id|create-&gt;cr_ftype
op_assign
id|NF4LNK
suffix:semicolon
id|create-&gt;cr_textlen
op_assign
id|linktext-&gt;len
suffix:semicolon
id|create-&gt;cr_text
op_assign
id|linktext-&gt;name
suffix:semicolon
id|create-&gt;cr_namelen
op_assign
id|name-&gt;len
suffix:semicolon
id|create-&gt;cr_name
op_assign
id|name-&gt;name
suffix:semicolon
id|create-&gt;cr_attrs
op_assign
id|sattr
suffix:semicolon
id|create-&gt;cr_cinfo
op_assign
id|info
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_CREATE
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_create_special
id|nfs4_setup_create_special
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|qstr
op_star
id|name
comma
id|dev_t
id|dev
comma
r_struct
id|iattr
op_star
id|sattr
comma
r_struct
id|nfs4_change_info
op_star
id|info
)paren
(brace
r_int
id|mode
op_assign
id|sattr-&gt;ia_mode
suffix:semicolon
r_struct
id|nfs4_create
op_star
id|create
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|create
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
op_logical_neg
(paren
id|sattr-&gt;ia_valid
op_amp
id|ATTR_MODE
)paren
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
op_logical_neg
id|S_ISFIFO
c_func
(paren
id|mode
)paren
op_logical_and
op_logical_neg
id|S_ISBLK
c_func
(paren
id|mode
)paren
op_logical_and
op_logical_neg
id|S_ISCHR
c_func
(paren
id|mode
)paren
op_logical_and
op_logical_neg
id|S_ISSOCK
c_func
(paren
id|mode
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|S_ISFIFO
c_func
(paren
id|mode
)paren
)paren
id|create-&gt;cr_ftype
op_assign
id|NF4FIFO
suffix:semicolon
r_else
r_if
c_cond
(paren
id|S_ISBLK
c_func
(paren
id|mode
)paren
)paren
(brace
id|create-&gt;cr_ftype
op_assign
id|NF4BLK
suffix:semicolon
id|create-&gt;cr_specdata1
op_assign
id|MAJOR
c_func
(paren
id|dev
)paren
suffix:semicolon
id|create-&gt;cr_specdata2
op_assign
id|MINOR
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|S_ISCHR
c_func
(paren
id|mode
)paren
)paren
(brace
id|create-&gt;cr_ftype
op_assign
id|NF4CHR
suffix:semicolon
id|create-&gt;cr_specdata1
op_assign
id|MAJOR
c_func
(paren
id|dev
)paren
suffix:semicolon
id|create-&gt;cr_specdata2
op_assign
id|MINOR
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
id|create-&gt;cr_ftype
op_assign
id|NF4SOCK
suffix:semicolon
id|create-&gt;cr_namelen
op_assign
id|name-&gt;len
suffix:semicolon
id|create-&gt;cr_name
op_assign
id|name-&gt;name
suffix:semicolon
id|create-&gt;cr_attrs
op_assign
id|sattr
suffix:semicolon
id|create-&gt;cr_cinfo
op_assign
id|info
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_CREATE
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
multiline_comment|/*&n; * This is our standard bitmap for GETATTR requests.&n; */
DECL|variable|nfs4_fattr_bitmap
id|u32
id|nfs4_fattr_bitmap
(braket
l_int|2
)braket
op_assign
(brace
id|FATTR4_WORD0_TYPE
op_or
id|FATTR4_WORD0_CHANGE
op_or
id|FATTR4_WORD0_SIZE
op_or
id|FATTR4_WORD0_FSID
op_or
id|FATTR4_WORD0_FILEID
comma
id|FATTR4_WORD1_MODE
op_or
id|FATTR4_WORD1_NUMLINKS
op_or
id|FATTR4_WORD1_OWNER
op_or
id|FATTR4_WORD1_OWNER_GROUP
op_or
id|FATTR4_WORD1_RAWDEV
op_or
id|FATTR4_WORD1_SPACE_USED
op_or
id|FATTR4_WORD1_TIME_ACCESS
op_or
id|FATTR4_WORD1_TIME_METADATA
op_or
id|FATTR4_WORD1_TIME_MODIFY
)brace
suffix:semicolon
DECL|variable|nfs4_statfs_bitmap
id|u32
id|nfs4_statfs_bitmap
(braket
l_int|2
)braket
op_assign
(brace
id|FATTR4_WORD0_FILES_AVAIL
op_or
id|FATTR4_WORD0_FILES_FREE
op_or
id|FATTR4_WORD0_FILES_TOTAL
comma
id|FATTR4_WORD1_SPACE_AVAIL
op_or
id|FATTR4_WORD1_SPACE_FREE
op_or
id|FATTR4_WORD1_SPACE_TOTAL
)brace
suffix:semicolon
DECL|variable|nfs4_pathconf_bitmap
id|u32
id|nfs4_pathconf_bitmap
(braket
l_int|2
)braket
op_assign
(brace
id|FATTR4_WORD0_MAXLINK
op_or
id|FATTR4_WORD0_MAXNAME
comma
l_int|0
)brace
suffix:semicolon
r_static
r_inline
r_void
DECL|function|__nfs4_setup_getattr
id|__nfs4_setup_getattr
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
id|u32
op_star
id|bitmap
comma
r_struct
id|nfs_fattr
op_star
id|fattr
comma
r_struct
id|nfs_fsstat
op_star
id|fsstat
comma
r_struct
id|nfs_pathconf
op_star
id|pathconf
)paren
(brace
r_struct
id|nfs4_getattr
op_star
id|getattr
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|getattr
)paren
suffix:semicolon
id|getattr-&gt;gt_bmval
op_assign
id|bitmap
suffix:semicolon
id|getattr-&gt;gt_attrs
op_assign
id|fattr
suffix:semicolon
id|getattr-&gt;gt_fsstat
op_assign
id|fsstat
suffix:semicolon
id|getattr-&gt;gt_pathconf
op_assign
id|pathconf
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_GETATTR
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_getattr
id|nfs4_setup_getattr
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
id|__nfs4_setup_getattr
c_func
(paren
id|cp
comma
id|nfs4_fattr_bitmap
comma
id|fattr
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_statfs
id|nfs4_setup_statfs
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|nfs_fsstat
op_star
id|fsstat
)paren
(brace
id|__nfs4_setup_getattr
c_func
(paren
id|cp
comma
id|nfs4_statfs_bitmap
comma
l_int|NULL
comma
id|fsstat
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_pathconf
id|nfs4_setup_pathconf
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|nfs_pathconf
op_star
id|pathconf
)paren
(brace
id|__nfs4_setup_getattr
c_func
(paren
id|cp
comma
id|nfs4_pathconf_bitmap
comma
l_int|NULL
comma
l_int|NULL
comma
id|pathconf
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_getfh
id|nfs4_setup_getfh
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|nfs_fh
op_star
id|fhandle
)paren
(brace
r_struct
id|nfs4_getfh
op_star
id|getfh
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|getfh
)paren
suffix:semicolon
id|getfh-&gt;gf_fhandle
op_assign
id|fhandle
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_GETFH
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_link
id|nfs4_setup_link
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|qstr
op_star
id|name
comma
r_struct
id|nfs4_change_info
op_star
id|info
)paren
(brace
r_struct
id|nfs4_link
op_star
id|link
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|link
)paren
suffix:semicolon
id|link-&gt;ln_namelen
op_assign
id|name-&gt;len
suffix:semicolon
id|link-&gt;ln_name
op_assign
id|name-&gt;name
suffix:semicolon
id|link-&gt;ln_cinfo
op_assign
id|info
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_LINK
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_lookup
id|nfs4_setup_lookup
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|qstr
op_star
id|q
)paren
(brace
r_struct
id|nfs4_lookup
op_star
id|lookup
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|lookup
)paren
suffix:semicolon
id|lookup-&gt;lo_name
op_assign
id|q
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_LOOKUP
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_putfh
id|nfs4_setup_putfh
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|nfs_fh
op_star
id|fhandle
)paren
(brace
r_struct
id|nfs4_putfh
op_star
id|putfh
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|putfh
)paren
suffix:semicolon
id|putfh-&gt;pf_fhandle
op_assign
id|fhandle
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_PUTFH
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_putrootfh
id|nfs4_setup_putrootfh
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
)paren
(brace
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_PUTROOTFH
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_readdir
id|nfs4_setup_readdir
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
id|u64
id|cookie
comma
id|u32
op_star
id|verifier
comma
r_struct
id|page
op_star
op_star
id|pages
comma
r_int
r_int
id|bufsize
comma
r_struct
id|dentry
op_star
id|dentry
)paren
(brace
id|u32
op_star
id|start
comma
op_star
id|p
suffix:semicolon
r_struct
id|nfs4_readdir
op_star
id|readdir
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|readdir
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|bufsize
OL
l_int|80
)paren
suffix:semicolon
id|readdir-&gt;rd_cookie
op_assign
(paren
id|cookie
OG
l_int|2
)paren
ques
c_cond
id|cookie
suffix:colon
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|readdir-&gt;rd_req_verifier
comma
id|verifier
comma
r_sizeof
(paren
id|readdir-&gt;rd_req_verifier
)paren
)paren
suffix:semicolon
id|readdir-&gt;rd_count
op_assign
id|bufsize
suffix:semicolon
id|readdir-&gt;rd_bmval
(braket
l_int|0
)braket
op_assign
id|FATTR4_WORD0_FILEID
suffix:semicolon
id|readdir-&gt;rd_bmval
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|readdir-&gt;rd_pages
op_assign
id|pages
suffix:semicolon
id|readdir-&gt;rd_pgbase
op_assign
l_int|0
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_READDIR
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|cookie
op_ge
l_int|2
)paren
r_return
suffix:semicolon
multiline_comment|/*&n;&t; * NFSv4 servers do not return entries for &squot;.&squot; and &squot;..&squot;&n;&t; * Therefore, we fake these entries here.  We let &squot;.&squot;&n;&t; * have cookie 0 and &squot;..&squot; have cookie 1.  Note that&n;&t; * when talking to the server, we always send cookie 0&n;&t; * instead of 1 or 2.&n;&t; */
id|start
op_assign
id|p
op_assign
(paren
id|u32
op_star
)paren
id|kmap_atomic
c_func
(paren
op_star
id|pages
comma
id|KM_USER0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cookie
op_eq
l_int|0
)paren
(brace
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* next */
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
multiline_comment|/* cookie, first word */
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* cookie, second word */
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* entry len */
id|memcpy
c_func
(paren
id|p
comma
l_string|&quot;.&bslash;0&bslash;0&bslash;0&quot;
comma
l_int|4
)paren
suffix:semicolon
multiline_comment|/* entry */
id|p
op_increment
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* bitmap length */
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|FATTR4_WORD0_FILEID
)paren
suffix:semicolon
multiline_comment|/* bitmap */
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
l_int|8
)paren
suffix:semicolon
multiline_comment|/* attribute buffer length */
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|NFS_FILEID
c_func
(paren
id|dentry-&gt;d_inode
)paren
)paren
suffix:semicolon
)brace
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* next */
op_star
id|p
op_increment
op_assign
id|xdr_zero
suffix:semicolon
multiline_comment|/* cookie, first word */
op_star
id|p
op_increment
op_assign
id|xdr_two
suffix:semicolon
multiline_comment|/* cookie, second word */
op_star
id|p
op_increment
op_assign
id|xdr_two
suffix:semicolon
multiline_comment|/* entry len */
id|memcpy
c_func
(paren
id|p
comma
l_string|&quot;..&bslash;0&bslash;0&quot;
comma
l_int|4
)paren
suffix:semicolon
multiline_comment|/* entry */
id|p
op_increment
suffix:semicolon
op_star
id|p
op_increment
op_assign
id|xdr_one
suffix:semicolon
multiline_comment|/* bitmap length */
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
id|FATTR4_WORD0_FILEID
)paren
suffix:semicolon
multiline_comment|/* bitmap */
op_star
id|p
op_increment
op_assign
id|htonl
c_func
(paren
l_int|8
)paren
suffix:semicolon
multiline_comment|/* attribute buffer length */
id|p
op_assign
id|xdr_encode_hyper
c_func
(paren
id|p
comma
id|NFS_FILEID
c_func
(paren
id|dentry-&gt;d_parent-&gt;d_inode
)paren
)paren
suffix:semicolon
id|readdir-&gt;rd_pgbase
op_assign
(paren
r_char
op_star
)paren
id|p
op_minus
(paren
r_char
op_star
)paren
id|start
suffix:semicolon
id|readdir-&gt;rd_count
op_sub_assign
id|readdir-&gt;rd_pgbase
suffix:semicolon
id|kunmap_atomic
c_func
(paren
id|start
comma
id|KM_USER0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_readlink
id|nfs4_setup_readlink
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_int
id|count
comma
r_struct
id|page
op_star
op_star
id|pages
)paren
(brace
r_struct
id|nfs4_readlink
op_star
id|readlink
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|readlink
)paren
suffix:semicolon
id|readlink-&gt;rl_count
op_assign
id|count
suffix:semicolon
id|readlink-&gt;rl_pages
op_assign
id|pages
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_READLINK
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_remove
id|nfs4_setup_remove
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|qstr
op_star
id|name
comma
r_struct
id|nfs4_change_info
op_star
id|cinfo
)paren
(brace
r_struct
id|nfs4_remove
op_star
id|remove
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|remove
)paren
suffix:semicolon
id|remove-&gt;rm_namelen
op_assign
id|name-&gt;len
suffix:semicolon
id|remove-&gt;rm_name
op_assign
id|name-&gt;name
suffix:semicolon
id|remove-&gt;rm_cinfo
op_assign
id|cinfo
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_REMOVE
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_rename
id|nfs4_setup_rename
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|qstr
op_star
id|old
comma
r_struct
id|qstr
op_star
r_new
comma
r_struct
id|nfs4_change_info
op_star
id|old_cinfo
comma
r_struct
id|nfs4_change_info
op_star
id|new_cinfo
)paren
(brace
r_struct
id|nfs4_rename
op_star
id|rename
op_assign
id|GET_OP
c_func
(paren
id|cp
comma
id|rename
)paren
suffix:semicolon
id|rename-&gt;rn_oldnamelen
op_assign
id|old-&gt;len
suffix:semicolon
id|rename-&gt;rn_oldname
op_assign
id|old-&gt;name
suffix:semicolon
id|rename-&gt;rn_newnamelen
op_assign
r_new
op_member_access_from_pointer
id|len
suffix:semicolon
id|rename-&gt;rn_newname
op_assign
r_new
op_member_access_from_pointer
id|name
suffix:semicolon
id|rename-&gt;rn_src_cinfo
op_assign
id|old_cinfo
suffix:semicolon
id|rename-&gt;rn_dst_cinfo
op_assign
id|new_cinfo
suffix:semicolon
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_RENAME
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_restorefh
id|nfs4_setup_restorefh
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
)paren
(brace
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_RESTOREFH
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_setup_savefh
id|nfs4_setup_savefh
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
)paren
(brace
id|OPNUM
c_func
(paren
id|cp
)paren
op_assign
id|OP_SAVEFH
suffix:semicolon
id|cp-&gt;req_nops
op_increment
suffix:semicolon
)brace
r_static
r_void
DECL|function|renew_lease
id|renew_lease
c_func
(paren
r_struct
id|nfs_server
op_star
id|server
comma
r_int
r_int
id|timestamp
)paren
(brace
r_struct
id|nfs4_client
op_star
id|clp
op_assign
id|server-&gt;nfs4_state
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|clp-&gt;cl_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time_before
c_func
(paren
id|clp-&gt;cl_last_renewal
comma
id|timestamp
)paren
)paren
id|clp-&gt;cl_last_renewal
op_assign
id|timestamp
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|clp-&gt;cl_lock
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|process_lease
id|process_lease
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
)paren
(brace
multiline_comment|/*&n;         * Generic lease processing: If this operation contains a&n;&t; * lease-renewing operation, and it succeeded, update the RENEW time&n;&t; * in the superblock.  Instead of the current time, we use the time&n;&t; * when the request was sent out.  (All we know is that the lease was&n;&t; * renewed sometime between then and now, and we have to assume the&n;&t; * worst case.)&n;&t; *&n;&t; * Notes:&n;&t; *   (1) renewd doesn&squot;t acquire the spinlock when messing with&n;&t; *     server-&gt;last_renewal; this is OK since rpciod always runs&n;&t; *     under the BKL.&n;&t; *   (2) cp-&gt;timestamp was set at the end of XDR encode.&n;         */
r_if
c_cond
(paren
op_logical_neg
id|cp-&gt;renew_index
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cp-&gt;toplevel_status
op_logical_or
id|cp-&gt;resp_nops
OG
id|cp-&gt;renew_index
)paren
id|renew_lease
c_func
(paren
id|cp-&gt;server
comma
id|cp-&gt;timestamp
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_call_compound
id|nfs4_call_compound
c_func
(paren
r_struct
id|nfs4_compound
op_star
id|cp
comma
r_struct
id|rpc_cred
op_star
id|cred
comma
r_int
id|flags
)paren
(brace
r_int
id|status
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_COMPOUND
)braket
comma
dot
id|rpc_argp
op_assign
id|cp
comma
dot
id|rpc_resp
op_assign
id|cp
comma
dot
id|rpc_cred
op_assign
id|cred
comma
)brace
suffix:semicolon
id|status
op_assign
id|rpc_call_sync
c_func
(paren
id|cp-&gt;server-&gt;client
comma
op_amp
id|msg
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
id|process_lease
c_func
(paren
id|cp
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|process_cinfo
id|process_cinfo
c_func
(paren
r_struct
id|nfs4_change_info
op_star
id|info
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
id|BUG_ON
c_func
(paren
(paren
id|fattr-&gt;valid
op_amp
id|NFS_ATTR_FATTR
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
(paren
id|fattr-&gt;valid
op_amp
id|NFS_ATTR_FATTR_V4
)paren
op_eq
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fattr-&gt;change_attr
op_eq
id|info-&gt;after
)paren
(brace
id|fattr-&gt;pre_change_attr
op_assign
id|info-&gt;before
suffix:semicolon
id|fattr-&gt;valid
op_or_assign
id|NFS_ATTR_PRE_CHANGE
suffix:semicolon
id|fattr-&gt;timestamp
op_assign
id|jiffies
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * OPEN_RECLAIM:&n; * &t;reclaim state on the server after a reboot.&n; * &t;Assumes caller is holding the sp-&gt;so_sem&n; */
r_int
DECL|function|nfs4_open_reclaim
id|nfs4_open_reclaim
c_func
(paren
r_struct
id|nfs4_state_owner
op_star
id|sp
comma
r_struct
id|nfs4_state
op_star
id|state
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|state-&gt;inode
suffix:semicolon
r_struct
id|nfs_server
op_star
id|server
op_assign
id|NFS_SERVER
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|nfs_fattr
id|fattr
op_assign
(brace
dot
id|valid
op_assign
l_int|0
comma
)brace
suffix:semicolon
r_struct
id|nfs4_change_info
id|d_cinfo
suffix:semicolon
r_struct
id|nfs4_getattr
id|f_getattr
op_assign
(brace
dot
id|gt_bmval
op_assign
id|nfs4_fattr_bitmap
comma
dot
id|gt_attrs
op_assign
op_amp
id|fattr
comma
)brace
suffix:semicolon
r_struct
id|nfs_open_reclaimargs
id|o_arg
op_assign
(brace
dot
id|fh
op_assign
id|NFS_FH
c_func
(paren
id|inode
)paren
comma
dot
id|seqid
op_assign
id|sp-&gt;so_seqid
comma
dot
id|id
op_assign
id|sp-&gt;so_id
comma
dot
id|share_access
op_assign
id|state-&gt;state
comma
dot
id|clientid
op_assign
id|server-&gt;nfs4_state-&gt;cl_clientid
comma
dot
id|claim
op_assign
id|NFS4_OPEN_CLAIM_PREVIOUS
comma
dot
id|f_getattr
op_assign
op_amp
id|f_getattr
comma
)brace
suffix:semicolon
r_struct
id|nfs_openres
id|o_res
op_assign
(brace
dot
id|cinfo
op_assign
op_amp
id|d_cinfo
comma
dot
id|f_getattr
op_assign
op_amp
id|f_getattr
comma
dot
id|server
op_assign
id|server
comma
multiline_comment|/* Grrr */
)brace
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_OPEN_RECLAIM
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|o_arg
comma
dot
id|rpc_resp
op_assign
op_amp
id|o_res
comma
dot
id|rpc_cred
op_assign
id|sp-&gt;so_cred
comma
)brace
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|rpc_call_sync
c_func
(paren
id|server-&gt;client
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
id|nfs4_increment_seqid
c_func
(paren
id|status
comma
id|sp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
l_int|0
)paren
id|memcpy
c_func
(paren
op_amp
id|state-&gt;stateid
comma
op_amp
id|o_res.stateid
comma
r_sizeof
(paren
id|state-&gt;stateid
)paren
)paren
suffix:semicolon
multiline_comment|/* Update the inode attributes */
id|nfs_refresh_inode
c_func
(paren
id|inode
comma
op_amp
id|fattr
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * Returns an nfs4_state + an referenced inode&n; */
r_struct
id|nfs4_state
op_star
DECL|function|nfs4_do_open
id|nfs4_do_open
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|qstr
op_star
id|name
comma
r_int
id|flags
comma
r_struct
id|iattr
op_star
id|sattr
comma
r_struct
id|rpc_cred
op_star
id|cred
)paren
(brace
r_struct
id|nfs4_state_owner
op_star
id|sp
suffix:semicolon
r_struct
id|nfs4_state
op_star
id|state
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|nfs_server
op_star
id|server
op_assign
id|NFS_SERVER
c_func
(paren
id|dir
)paren
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|nfs4_change_info
id|d_cinfo
suffix:semicolon
r_int
id|status
suffix:semicolon
r_struct
id|nfs_fattr
id|d_attr
op_assign
(brace
dot
id|valid
op_assign
l_int|0
comma
)brace
suffix:semicolon
r_struct
id|nfs_fattr
id|f_attr
op_assign
(brace
dot
id|valid
op_assign
l_int|0
comma
)brace
suffix:semicolon
r_struct
id|nfs4_getattr
id|f_getattr
op_assign
(brace
dot
id|gt_bmval
op_assign
id|nfs4_fattr_bitmap
comma
dot
id|gt_attrs
op_assign
op_amp
id|f_attr
comma
)brace
suffix:semicolon
r_struct
id|nfs4_getattr
id|d_getattr
op_assign
(brace
dot
id|gt_bmval
op_assign
id|nfs4_fattr_bitmap
comma
dot
id|gt_attrs
op_assign
op_amp
id|d_attr
comma
)brace
suffix:semicolon
r_struct
id|nfs_openargs
id|o_arg
op_assign
(brace
dot
id|fh
op_assign
id|NFS_FH
c_func
(paren
id|dir
)paren
comma
dot
id|share_access
op_assign
id|flags
op_amp
(paren
id|FMODE_READ
op_or
id|FMODE_WRITE
)paren
comma
dot
id|opentype
op_assign
(paren
id|flags
op_amp
id|O_CREAT
)paren
ques
c_cond
id|NFS4_OPEN_CREATE
suffix:colon
id|NFS4_OPEN_NOCREATE
comma
dot
id|createmode
op_assign
(paren
id|flags
op_amp
id|O_EXCL
)paren
ques
c_cond
id|NFS4_CREATE_EXCLUSIVE
suffix:colon
id|NFS4_CREATE_UNCHECKED
comma
dot
id|name
op_assign
id|name
comma
dot
id|f_getattr
op_assign
op_amp
id|f_getattr
comma
dot
id|d_getattr
op_assign
op_amp
id|d_getattr
comma
dot
id|server
op_assign
id|server
comma
)brace
suffix:semicolon
r_struct
id|nfs_openres
id|o_res
op_assign
(brace
dot
id|cinfo
op_assign
op_amp
id|d_cinfo
comma
dot
id|f_getattr
op_assign
op_amp
id|f_getattr
comma
dot
id|d_getattr
op_assign
op_amp
id|d_getattr
comma
dot
id|server
op_assign
id|server
comma
)brace
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_OPEN
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|o_arg
comma
dot
id|rpc_resp
op_assign
op_amp
id|o_res
comma
dot
id|rpc_cred
op_assign
id|cred
comma
)brace
suffix:semicolon
id|retry
suffix:colon
id|status
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sp
op_assign
id|nfs4_get_state_owner
c_func
(paren
id|NFS_SERVER
c_func
(paren
id|dir
)paren
comma
id|cred
)paren
)paren
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;nfs4_do_open: nfs4_get_state_owner failed!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|o_arg.createmode
op_amp
id|NFS4_CREATE_EXCLUSIVE
)paren
(brace
id|u32
op_star
id|p
op_assign
(paren
id|u32
op_star
)paren
id|o_arg.u.verifier.data
suffix:semicolon
id|p
(braket
l_int|0
)braket
op_assign
id|jiffies
suffix:semicolon
id|p
(braket
l_int|1
)braket
op_assign
id|current-&gt;pid
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|o_arg.createmode
op_eq
id|NFS4_CREATE_UNCHECKED
)paren
(brace
id|o_arg.u.attrs
op_assign
id|sattr
suffix:semicolon
)brace
multiline_comment|/* Serialization for the sequence id */
id|down
c_func
(paren
op_amp
id|sp-&gt;so_sema
)paren
suffix:semicolon
id|o_arg.seqid
op_assign
id|sp-&gt;so_seqid
suffix:semicolon
id|o_arg.id
op_assign
id|sp-&gt;so_id
suffix:semicolon
id|o_arg.clientid
op_assign
id|NFS_SERVER
c_func
(paren
id|dir
)paren
op_member_access_from_pointer
id|nfs4_state-&gt;cl_clientid
comma
id|status
op_assign
id|rpc_call_sync
c_func
(paren
id|server-&gt;client
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
id|nfs4_increment_seqid
c_func
(paren
id|status
comma
id|sp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out_up
suffix:semicolon
id|process_cinfo
c_func
(paren
op_amp
id|d_cinfo
comma
op_amp
id|d_attr
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|dir
comma
op_amp
id|d_attr
)paren
suffix:semicolon
id|status
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|inode
op_assign
id|nfs_fhget
c_func
(paren
id|dir-&gt;i_sb
comma
op_amp
id|o_res.fh
comma
op_amp
id|f_attr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
r_goto
id|out_up
suffix:semicolon
id|state
op_assign
id|nfs4_get_open_state
c_func
(paren
id|inode
comma
id|sp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|state
)paren
r_goto
id|out_up
suffix:semicolon
r_if
c_cond
(paren
id|o_res.rflags
op_amp
id|NFS4_OPEN_RESULT_CONFIRM
)paren
(brace
r_struct
id|nfs_open_confirmargs
id|oc_arg
op_assign
(brace
dot
id|fh
op_assign
op_amp
id|o_res.fh
comma
dot
id|seqid
op_assign
id|sp-&gt;so_seqid
comma
)brace
suffix:semicolon
r_struct
id|nfs_open_confirmres
id|oc_res
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_OPEN_CONFIRM
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|oc_arg
comma
dot
id|rpc_resp
op_assign
op_amp
id|oc_res
comma
dot
id|rpc_cred
op_assign
id|cred
comma
)brace
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|oc_arg.stateid
comma
op_amp
id|o_res.stateid
comma
r_sizeof
(paren
id|oc_arg.stateid
)paren
)paren
suffix:semicolon
id|status
op_assign
id|rpc_call_sync
c_func
(paren
id|server-&gt;client
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
id|nfs4_increment_seqid
c_func
(paren
id|status
comma
id|sp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_goto
id|out_up
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|state-&gt;stateid
comma
op_amp
id|oc_res.stateid
comma
r_sizeof
(paren
id|state-&gt;stateid
)paren
)paren
suffix:semicolon
)brace
r_else
id|memcpy
c_func
(paren
op_amp
id|state-&gt;stateid
comma
op_amp
id|o_res.stateid
comma
r_sizeof
(paren
id|state-&gt;stateid
)paren
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|inode-&gt;i_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|FMODE_READ
)paren
id|state-&gt;nreaders
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|FMODE_WRITE
)paren
id|state-&gt;nwriters
op_increment
suffix:semicolon
id|state-&gt;state
op_or_assign
id|flags
op_amp
(paren
id|FMODE_READ
op_or
id|FMODE_WRITE
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|inode-&gt;i_lock
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|sp-&gt;so_sema
)paren
suffix:semicolon
id|nfs4_put_state_owner
c_func
(paren
id|sp
)paren
suffix:semicolon
r_return
id|state
suffix:semicolon
id|out_up
suffix:colon
id|up
c_func
(paren
op_amp
id|sp-&gt;so_sema
)paren
suffix:semicolon
id|nfs4_put_state_owner
c_func
(paren
id|sp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state
)paren
(brace
id|nfs4_put_open_state
c_func
(paren
id|state
)paren
suffix:semicolon
id|state
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|inode
)paren
(brace
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
id|inode
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* NOTE: BAD_SEQID means the server and client disagree about the&n;&t; * book-keeping w.r.t. state-changing operations&n;&t; * (OPEN/CLOSE/LOCK/LOCKU...)&n;&t; * It is actually a sign of a bug on the client or on the server.&n;&t; *&n;&t; * If we receive a BAD_SEQID error in the particular case of&n;&t; * doing an OPEN, we assume that nfs4_increment_seqid() will&n;&t; * have unhashed the old state_owner for us, and that we can&n;&t; * therefore safely retry using a new one. We should still warn&n;&t; * the user though...&n;&t; */
r_if
c_cond
(paren
id|status
op_eq
op_minus
id|NFS4ERR_BAD_SEQID
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;NFS: v4 server returned a bad sequence-id error!&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|retry
suffix:semicolon
)brace
id|status
op_assign
id|nfs4_handle_error
c_func
(paren
id|server
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
r_goto
id|retry
suffix:semicolon
id|BUG_ON
c_func
(paren
id|status
template_param
l_int|0
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|ERR_PTR
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs4_do_setattr
id|nfs4_do_setattr
c_func
(paren
r_struct
id|nfs_server
op_star
id|server
comma
r_struct
id|nfs_fattr
op_star
id|fattr
comma
r_struct
id|nfs_fh
op_star
id|fhandle
comma
r_struct
id|iattr
op_star
id|sattr
comma
r_struct
id|nfs4_state
op_star
id|state
)paren
(brace
r_struct
id|nfs4_getattr
id|getattr
op_assign
(brace
dot
id|gt_bmval
op_assign
id|nfs4_fattr_bitmap
comma
dot
id|gt_attrs
op_assign
id|fattr
comma
)brace
suffix:semicolon
r_struct
id|nfs_setattrargs
id|arg
op_assign
(brace
dot
id|fh
op_assign
id|fhandle
comma
dot
id|iap
op_assign
id|sattr
comma
dot
id|attr
op_assign
op_amp
id|getattr
comma
dot
id|server
op_assign
id|server
comma
)brace
suffix:semicolon
r_struct
id|nfs_setattrres
id|res
op_assign
(brace
dot
id|attr
op_assign
op_amp
id|getattr
comma
dot
id|server
op_assign
id|server
comma
)brace
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_SETATTR
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|arg
comma
dot
id|rpc_resp
op_assign
op_amp
id|res
comma
)brace
suffix:semicolon
r_int
id|status
suffix:semicolon
id|retry
suffix:colon
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sattr-&gt;ia_valid
op_amp
id|ATTR_SIZE
)paren
id|nfs4_copy_stateid
c_func
(paren
op_amp
id|arg.stateid
comma
id|state
comma
l_int|0
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
op_amp
id|arg.stateid
comma
op_amp
id|zero_stateid
comma
r_sizeof
(paren
id|arg.stateid
)paren
)paren
suffix:semicolon
id|status
op_assign
id|rpc_call_sync
c_func
(paren
id|server-&gt;client
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
id|status
op_assign
id|nfs4_handle_error
c_func
(paren
id|server
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
r_goto
id|retry
suffix:semicolon
)brace
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/* &n; * It is possible for data to be read/written from a mem-mapped file &n; * after the sys_close call (which hits the vfs layer as a flush).&n; * This means that we can&squot;t safely call nfsv4 close on a file until &n; * the inode is cleared. This in turn means that we are not good&n; * NFSv4 citizens - we do not indicate to the server to update the file&squot;s &n; * share state even when we are done with one of the three share &n; * stateid&squot;s in the inode.&n; *&n; * NOTE: Caller must be holding the sp-&gt;so_owner semaphore!&n; */
r_int
DECL|function|nfs4_do_close
id|nfs4_do_close
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|nfs4_state
op_star
id|state
)paren
(brace
r_struct
id|nfs4_state_owner
op_star
id|sp
op_assign
id|state-&gt;owner
suffix:semicolon
r_int
id|status
op_assign
l_int|0
suffix:semicolon
r_struct
id|nfs_closeargs
id|arg
op_assign
(brace
dot
id|fh
op_assign
id|NFS_FH
c_func
(paren
id|inode
)paren
comma
)brace
suffix:semicolon
r_struct
id|nfs_closeres
id|res
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_CLOSE
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|arg
comma
dot
id|rpc_resp
op_assign
op_amp
id|res
comma
)brace
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|arg.stateid
comma
op_amp
id|state-&gt;stateid
comma
r_sizeof
(paren
id|arg.stateid
)paren
)paren
suffix:semicolon
multiline_comment|/* Serialization for the sequence id */
id|arg.seqid
op_assign
id|sp-&gt;so_seqid
comma
id|status
op_assign
id|rpc_call_sync
c_func
(paren
id|NFS_SERVER
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|client
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* hmm. we are done with the inode, and in the process of freeing&n;&t; * the state_owner. we keep this around to process errors&n;&t; */
id|nfs4_increment_seqid
c_func
(paren
id|status
comma
id|sp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
id|memcpy
c_func
(paren
op_amp
id|state-&gt;stateid
comma
op_amp
id|res.stateid
comma
r_sizeof
(paren
id|state-&gt;stateid
)paren
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
r_int
DECL|function|nfs4_do_downgrade
id|nfs4_do_downgrade
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|nfs4_state
op_star
id|state
comma
id|mode_t
id|mode
)paren
(brace
r_struct
id|nfs4_state_owner
op_star
id|sp
op_assign
id|state-&gt;owner
suffix:semicolon
r_int
id|status
op_assign
l_int|0
suffix:semicolon
r_struct
id|nfs_closeargs
id|arg
op_assign
(brace
dot
id|fh
op_assign
id|NFS_FH
c_func
(paren
id|inode
)paren
comma
dot
id|seqid
op_assign
id|sp-&gt;so_seqid
comma
dot
id|share_access
op_assign
id|mode
comma
)brace
suffix:semicolon
r_struct
id|nfs_closeres
id|res
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_OPEN_DOWNGRADE
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|arg
comma
dot
id|rpc_resp
op_assign
op_amp
id|res
comma
)brace
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|arg.stateid
comma
op_amp
id|state-&gt;stateid
comma
r_sizeof
(paren
id|arg.stateid
)paren
)paren
suffix:semicolon
id|status
op_assign
id|rpc_call_sync
c_func
(paren
id|NFS_SERVER
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|client
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
id|nfs4_increment_seqid
c_func
(paren
id|status
comma
id|sp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
id|memcpy
c_func
(paren
op_amp
id|state-&gt;stateid
comma
op_amp
id|res.stateid
comma
r_sizeof
(paren
id|state-&gt;stateid
)paren
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
r_struct
id|inode
op_star
DECL|function|nfs4_atomic_open
id|nfs4_atomic_open
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
comma
r_struct
id|nameidata
op_star
id|nd
)paren
(brace
r_struct
id|iattr
id|attr
suffix:semicolon
r_struct
id|rpc_cred
op_star
id|cred
suffix:semicolon
r_struct
id|nfs4_state
op_star
id|state
suffix:semicolon
r_if
c_cond
(paren
id|nd-&gt;flags
op_amp
id|LOOKUP_CREATE
)paren
(brace
id|attr.ia_mode
op_assign
id|nd-&gt;intent.open.create_mode
suffix:semicolon
id|attr.ia_valid
op_assign
id|ATTR_MODE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_POSIXACL
c_func
(paren
id|dir
)paren
)paren
id|attr.ia_mode
op_and_assign
op_complement
id|current-&gt;fs-&gt;umask
suffix:semicolon
)brace
r_else
(brace
id|attr.ia_valid
op_assign
l_int|0
suffix:semicolon
id|BUG_ON
c_func
(paren
id|nd-&gt;intent.open.flags
op_amp
id|O_CREAT
)paren
suffix:semicolon
)brace
id|cred
op_assign
id|rpcauth_lookupcred
c_func
(paren
id|NFS_SERVER
c_func
(paren
id|dir
)paren
op_member_access_from_pointer
id|client-&gt;cl_auth
comma
l_int|0
)paren
suffix:semicolon
id|state
op_assign
id|nfs4_do_open
c_func
(paren
id|dir
comma
op_amp
id|dentry-&gt;d_name
comma
id|nd-&gt;intent.open.flags
comma
op_amp
id|attr
comma
id|cred
)paren
suffix:semicolon
id|put_rpccred
c_func
(paren
id|cred
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|state
)paren
)paren
r_return
(paren
r_struct
id|inode
op_star
)paren
id|state
suffix:semicolon
r_return
id|state-&gt;inode
suffix:semicolon
)brace
r_int
DECL|function|nfs4_open_revalidate
id|nfs4_open_revalidate
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|dentry
op_star
id|dentry
comma
r_int
id|openflags
)paren
(brace
r_struct
id|rpc_cred
op_star
id|cred
suffix:semicolon
r_struct
id|nfs4_state
op_star
id|state
suffix:semicolon
r_struct
id|inode
op_star
id|inode
suffix:semicolon
id|cred
op_assign
id|rpcauth_lookupcred
c_func
(paren
id|NFS_SERVER
c_func
(paren
id|dir
)paren
op_member_access_from_pointer
id|client-&gt;cl_auth
comma
l_int|0
)paren
suffix:semicolon
id|state
op_assign
id|nfs4_do_open
c_func
(paren
id|dir
comma
op_amp
id|dentry-&gt;d_name
comma
id|openflags
comma
l_int|NULL
comma
id|cred
)paren
suffix:semicolon
id|put_rpccred
c_func
(paren
id|cred
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state
op_eq
id|ERR_PTR
c_func
(paren
op_minus
id|ENOENT
)paren
op_logical_and
id|dentry-&gt;d_inode
op_eq
l_int|0
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|state
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|inode
op_assign
id|state-&gt;inode
suffix:semicolon
r_if
c_cond
(paren
id|inode
op_eq
id|dentry-&gt;d_inode
)paren
(brace
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|d_drop
c_func
(paren
id|dentry
)paren
suffix:semicolon
id|nfs4_close_state
c_func
(paren
id|state
comma
id|openflags
)paren
suffix:semicolon
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_get_root
id|nfs4_proc_get_root
c_func
(paren
r_struct
id|nfs_server
op_star
id|server
comma
r_struct
id|nfs_fh
op_star
id|fhandle
comma
r_struct
id|nfs_fsinfo
op_star
id|info
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|4
)braket
suffix:semicolon
r_struct
id|nfs_fattr
op_star
id|fattr
op_assign
id|info-&gt;fattr
suffix:semicolon
r_int
r_char
op_star
id|p
suffix:semicolon
r_struct
id|qstr
id|q
suffix:semicolon
r_int
id|status
suffix:semicolon
multiline_comment|/*&n;&t; * Now we do a separate LOOKUP for each component of the mount path.&n;&t; * The LOOKUPs are done separately so that we can conveniently&n;&t; * catch an ERR_WRONGSEC if it occurs along the way...&n;&t; */
id|p
op_assign
id|server-&gt;mnt_path
suffix:semicolon
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|server
comma
l_string|&quot;getrootfh&quot;
)paren
suffix:semicolon
id|nfs4_setup_putrootfh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
id|fattr
)paren
suffix:semicolon
id|nfs4_setup_getfh
c_func
(paren
op_amp
id|compound
comma
id|fhandle
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_while
c_loop
(paren
op_star
id|p
op_eq
l_char|&squot;/&squot;
)paren
id|p
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|p
)paren
r_break
suffix:semicolon
id|q.name
op_assign
id|p
suffix:semicolon
r_while
c_loop
(paren
op_star
id|p
op_logical_and
(paren
op_star
id|p
op_ne
l_char|&squot;/&squot;
)paren
)paren
id|p
op_increment
suffix:semicolon
id|q.len
op_assign
id|p
op_minus
id|q.name
suffix:semicolon
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|server
comma
l_string|&quot;mount&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|fhandle
)paren
suffix:semicolon
id|nfs4_setup_lookup
c_func
(paren
op_amp
id|compound
comma
op_amp
id|q
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
id|fattr
)paren
suffix:semicolon
id|nfs4_setup_getfh
c_func
(paren
op_amp
id|compound
comma
id|fhandle
)paren
suffix:semicolon
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
op_minus
id|ENOENT
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;NFS: mount path %s does not exist!&bslash;n&quot;
comma
id|server-&gt;mnt_path
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;NFS: suggestion: try mounting &squot;/&squot; instead.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
id|out
suffix:colon
r_if
c_cond
(paren
id|status
)paren
r_return
id|nfs4_map_errors
c_func
(paren
id|status
)paren
suffix:semicolon
r_return
id|nfs4_proc_fsinfo
c_func
(paren
id|server
comma
id|fhandle
comma
id|info
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_getattr
id|nfs4_proc_getattr
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|2
)braket
suffix:semicolon
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|inode
)paren
comma
l_string|&quot;getattr&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
id|fattr
)paren
suffix:semicolon
r_return
id|nfs4_map_errors
c_func
(paren
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* &n; * The file is not closed if it is opened due to the a request to change&n; * the size of the file. The open call will not be needed once the&n; * VFS layer lookup-intents are implemented.&n; *&n; * Close is called when the inode is destroyed.&n; * If we haven&squot;t opened the file for O_WRONLY, we&n; * need to in the size_change case to obtain a stateid.&n; *&n; * Got race?&n; * Because OPEN is always done by name in nfsv4, it is&n; * possible that we opened a different file by the same&n; * name.  We can recognize this race condition, but we&n; * can&squot;t do anything about it besides returning an error.&n; *&n; * This will be fixed with VFS changes (lookup-intent).&n; */
r_static
r_int
DECL|function|nfs4_proc_setattr
id|nfs4_proc_setattr
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_struct
id|nfs_fattr
op_star
id|fattr
comma
r_struct
id|iattr
op_star
id|sattr
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|dentry-&gt;d_inode
suffix:semicolon
r_int
id|size_change
op_assign
id|sattr-&gt;ia_valid
op_amp
id|ATTR_SIZE
suffix:semicolon
r_struct
id|nfs4_state
op_star
id|state
op_assign
l_int|NULL
suffix:semicolon
r_int
id|need_iput
op_assign
l_int|0
suffix:semicolon
r_int
id|status
suffix:semicolon
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|size_change
)paren
(brace
r_struct
id|rpc_cred
op_star
id|cred
op_assign
id|rpcauth_lookupcred
c_func
(paren
id|NFS_SERVER
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|client-&gt;cl_auth
comma
l_int|0
)paren
suffix:semicolon
id|state
op_assign
id|nfs4_find_state
c_func
(paren
id|inode
comma
id|cred
comma
id|FMODE_WRITE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|state
)paren
(brace
id|state
op_assign
id|nfs4_do_open
c_func
(paren
id|dentry-&gt;d_parent-&gt;d_inode
comma
op_amp
id|dentry-&gt;d_name
comma
id|FMODE_WRITE
comma
l_int|NULL
comma
id|cred
)paren
suffix:semicolon
id|need_iput
op_assign
l_int|1
suffix:semicolon
)brace
id|put_rpccred
c_func
(paren
id|cred
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IS_ERR
c_func
(paren
id|state
)paren
)paren
r_return
id|PTR_ERR
c_func
(paren
id|state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;inode
op_ne
id|inode
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;nfs: raced in setattr (%p != %p), returning -EIO&bslash;n&quot;
comma
id|inode
comma
id|state-&gt;inode
)paren
suffix:semicolon
id|status
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|status
op_assign
id|nfs4_do_setattr
c_func
(paren
id|NFS_SERVER
c_func
(paren
id|inode
)paren
comma
id|fattr
comma
id|NFS_FH
c_func
(paren
id|inode
)paren
comma
id|sattr
comma
id|state
)paren
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
id|state
)paren
(brace
id|inode
op_assign
id|state-&gt;inode
suffix:semicolon
id|nfs4_close_state
c_func
(paren
id|state
comma
id|FMODE_WRITE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|need_iput
)paren
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
)brace
r_return
id|status
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_lookup
id|nfs4_proc_lookup
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|qstr
op_star
id|name
comma
r_struct
id|nfs_fh
op_star
id|fhandle
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|5
)braket
suffix:semicolon
r_struct
id|nfs_fattr
id|dir_attr
suffix:semicolon
r_int
id|status
suffix:semicolon
id|dir_attr.valid
op_assign
l_int|0
suffix:semicolon
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;NFS call  lookup %s&bslash;n&quot;
comma
id|name-&gt;name
)paren
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|dir
)paren
comma
l_string|&quot;lookup&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|dir
)paren
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
id|nfs4_setup_lookup
c_func
(paren
op_amp
id|compound
comma
id|name
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
id|fattr
)paren
suffix:semicolon
id|nfs4_setup_getfh
c_func
(paren
op_amp
id|compound
comma
id|fhandle
)paren
suffix:semicolon
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;NFS reply lookup: %d&bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ge
l_int|0
)paren
id|status
op_assign
id|nfs_refresh_inode
c_func
(paren
id|dir
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
r_return
id|nfs4_map_errors
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_access
id|nfs4_proc_access
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|rpc_cred
op_star
id|cred
comma
r_int
id|mode
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|3
)braket
suffix:semicolon
r_struct
id|nfs_fattr
id|fattr
suffix:semicolon
id|u32
id|req_access
op_assign
l_int|0
comma
id|resp_supported
comma
id|resp_access
suffix:semicolon
r_int
id|status
suffix:semicolon
id|fattr.valid
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Determine which access bits we want to ask for...&n;&t; */
r_if
c_cond
(paren
id|mode
op_amp
id|MAY_READ
)paren
id|req_access
op_or_assign
id|NFS4_ACCESS_READ
suffix:semicolon
r_if
c_cond
(paren
id|S_ISDIR
c_func
(paren
id|inode-&gt;i_mode
)paren
)paren
(brace
r_if
c_cond
(paren
id|mode
op_amp
id|MAY_WRITE
)paren
id|req_access
op_or_assign
id|NFS4_ACCESS_MODIFY
op_or
id|NFS4_ACCESS_EXTEND
op_or
id|NFS4_ACCESS_DELETE
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_amp
id|MAY_EXEC
)paren
id|req_access
op_or_assign
id|NFS4_ACCESS_LOOKUP
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|mode
op_amp
id|MAY_WRITE
)paren
id|req_access
op_or_assign
id|NFS4_ACCESS_MODIFY
op_or
id|NFS4_ACCESS_EXTEND
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_amp
id|MAY_EXEC
)paren
id|req_access
op_or_assign
id|NFS4_ACCESS_EXECUTE
suffix:semicolon
)brace
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|inode
)paren
comma
l_string|&quot;access&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
op_amp
id|fattr
)paren
suffix:semicolon
id|nfs4_setup_access
c_func
(paren
op_amp
id|compound
comma
id|req_access
comma
op_amp
id|resp_supported
comma
op_amp
id|resp_access
)paren
suffix:semicolon
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
id|cred
comma
l_int|0
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|inode
comma
op_amp
id|fattr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
r_if
c_cond
(paren
id|req_access
op_ne
id|resp_supported
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;NFS: server didn&squot;t support all access bits!&bslash;n&quot;
)paren
suffix:semicolon
id|status
op_assign
op_minus
id|ENOTSUPP
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|req_access
op_ne
id|resp_access
)paren
id|status
op_assign
op_minus
id|EACCES
suffix:semicolon
)brace
r_return
id|nfs4_map_errors
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * TODO: For the time being, we don&squot;t try to get any attributes&n; * along with any of the zero-copy operations READ, READDIR,&n; * READLINK, WRITE.&n; *&n; * In the case of the first three, we want to put the GETATTR&n; * after the read-type operation -- this is because it is hard&n; * to predict the length of a GETATTR response in v4, and thus&n; * align the READ data correctly.  This means that the GETATTR&n; * may end up partially falling into the page cache, and we should&n; * shift it into the &squot;tail&squot; of the xdr_buf before processing.&n; * To do this efficiently, we need to know the total length&n; * of data received, which doesn&squot;t seem to be available outside&n; * of the RPC layer.&n; *&n; * In the case of WRITE, we also want to put the GETATTR after&n; * the operation -- in this case because we want to make sure&n; * we get the post-operation mtime and size.  This means that&n; * we can&squot;t use xdr_encode_pages() as written: we need a variant&n; * of it which would leave room in the &squot;tail&squot; iovec.&n; *&n; * Both of these changes to the XDR layer would in fact be quite&n; * minor, but I decided to leave them for a subsequent patch.&n; */
r_static
r_int
DECL|function|nfs4_proc_readlink
id|nfs4_proc_readlink
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|page
op_star
id|page
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|2
)braket
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|inode
)paren
comma
l_string|&quot;readlink&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|nfs4_setup_readlink
c_func
(paren
op_amp
id|compound
comma
id|PAGE_CACHE_SIZE
comma
op_amp
id|page
)paren
suffix:semicolon
r_return
id|nfs4_map_errors
c_func
(paren
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_read
id|nfs4_proc_read
c_func
(paren
r_struct
id|nfs_read_data
op_star
id|rdata
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_int
id|flags
op_assign
id|rdata-&gt;flags
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|rdata-&gt;inode
suffix:semicolon
r_struct
id|nfs_fattr
op_star
id|fattr
op_assign
id|rdata-&gt;res.fattr
suffix:semicolon
r_struct
id|nfs_server
op_star
id|server
op_assign
id|NFS_SERVER
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_READ
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|rdata-&gt;args
comma
dot
id|rpc_resp
op_assign
op_amp
id|rdata-&gt;res
comma
)brace
suffix:semicolon
r_int
r_int
id|timestamp
op_assign
id|jiffies
suffix:semicolon
r_int
id|status
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;NFS call  read %d @ %Ld&bslash;n&quot;
comma
id|rdata-&gt;args.count
comma
(paren
r_int
r_int
)paren
id|rdata-&gt;args.offset
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Try first to use O_RDONLY, then O_RDWR stateid.&n;&t; */
r_if
c_cond
(paren
id|filp
)paren
(brace
r_struct
id|nfs4_state
op_star
id|state
suffix:semicolon
id|state
op_assign
(paren
r_struct
id|nfs4_state
op_star
)paren
id|filp-&gt;private_data
suffix:semicolon
id|rdata-&gt;args.state
op_assign
id|state
suffix:semicolon
id|msg.rpc_cred
op_assign
id|state-&gt;owner-&gt;so_cred
suffix:semicolon
)brace
r_else
(brace
id|rdata-&gt;args.state
op_assign
l_int|NULL
suffix:semicolon
id|msg.rpc_cred
op_assign
id|NFS_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|mm_cred
suffix:semicolon
)brace
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|status
op_assign
id|rpc_call_sync
c_func
(paren
id|server-&gt;client
comma
op_amp
id|msg
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
id|renew_lease
c_func
(paren
id|server
comma
id|timestamp
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;NFS reply read: %d&bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
r_return
id|nfs4_map_errors
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_write
id|nfs4_proc_write
c_func
(paren
r_struct
id|nfs_write_data
op_star
id|wdata
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_int
id|rpcflags
op_assign
id|wdata-&gt;flags
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|wdata-&gt;inode
suffix:semicolon
r_struct
id|nfs_fattr
op_star
id|fattr
op_assign
id|wdata-&gt;res.fattr
suffix:semicolon
r_struct
id|nfs_server
op_star
id|server
op_assign
id|NFS_SERVER
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_WRITE
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|wdata-&gt;args
comma
dot
id|rpc_resp
op_assign
op_amp
id|wdata-&gt;res
comma
)brace
suffix:semicolon
r_int
id|status
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;NFS call  write %d @ %Ld&bslash;n&quot;
comma
id|wdata-&gt;args.count
comma
(paren
r_int
r_int
)paren
id|wdata-&gt;args.offset
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Try first to use O_WRONLY, then O_RDWR stateid.&n;&t; */
r_if
c_cond
(paren
id|filp
)paren
(brace
r_struct
id|nfs4_state
op_star
id|state
suffix:semicolon
id|state
op_assign
(paren
r_struct
id|nfs4_state
op_star
)paren
id|filp-&gt;private_data
suffix:semicolon
id|nfs4_copy_stateid
c_func
(paren
op_amp
id|wdata-&gt;args.stateid
comma
id|state
comma
id|wdata-&gt;lockowner
)paren
suffix:semicolon
id|msg.rpc_cred
op_assign
id|state-&gt;owner-&gt;so_cred
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
op_amp
id|wdata-&gt;args.stateid
comma
op_amp
id|zero_stateid
comma
r_sizeof
(paren
id|wdata-&gt;args.stateid
)paren
)paren
suffix:semicolon
id|msg.rpc_cred
op_assign
id|NFS_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|mm_cred
suffix:semicolon
)brace
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|status
op_assign
id|rpc_call_sync
c_func
(paren
id|server-&gt;client
comma
op_amp
id|msg
comma
id|rpcflags
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;NFS reply write: %d&bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
r_return
id|nfs4_map_errors
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_commit
id|nfs4_proc_commit
c_func
(paren
r_struct
id|nfs_write_data
op_star
id|cdata
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|cdata-&gt;inode
suffix:semicolon
r_struct
id|nfs_fattr
op_star
id|fattr
op_assign
id|cdata-&gt;res.fattr
suffix:semicolon
r_struct
id|nfs_server
op_star
id|server
op_assign
id|NFS_SERVER
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_COMMIT
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|cdata-&gt;args
comma
dot
id|rpc_resp
op_assign
op_amp
id|cdata-&gt;res
comma
)brace
suffix:semicolon
r_int
id|status
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;NFS call  commit %d @ %Ld&bslash;n&quot;
comma
id|cdata-&gt;args.count
comma
(paren
r_int
r_int
)paren
id|cdata-&gt;args.offset
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Try first to use O_WRONLY, then O_RDWR stateid.&n;&t; */
r_if
c_cond
(paren
id|filp
)paren
(brace
r_struct
id|nfs4_state
op_star
id|state
suffix:semicolon
id|state
op_assign
(paren
r_struct
id|nfs4_state
op_star
)paren
id|filp-&gt;private_data
suffix:semicolon
id|nfs4_copy_stateid
c_func
(paren
op_amp
id|cdata-&gt;args.stateid
comma
id|state
comma
id|cdata-&gt;lockowner
)paren
suffix:semicolon
id|msg.rpc_cred
op_assign
id|state-&gt;owner-&gt;so_cred
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
op_amp
id|cdata-&gt;args.stateid
comma
op_amp
id|zero_stateid
comma
r_sizeof
(paren
id|cdata-&gt;args.stateid
)paren
)paren
suffix:semicolon
id|msg.rpc_cred
op_assign
id|NFS_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|mm_cred
suffix:semicolon
)brace
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|status
op_assign
id|rpc_call_sync
c_func
(paren
id|server-&gt;client
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;NFS reply commit: %d&bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
r_return
id|nfs4_map_errors
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Got race?&n; * We will need to arrange for the VFS layer to provide an atomic open.&n; * Until then, this create/open method is prone to inefficiency and race&n; * conditions due to the lookup, create, and open VFS calls from sys_open()&n; * placed on the wire.&n; *&n; * Given the above sorry state of affairs, I&squot;m simply sending an OPEN.&n; * The file will be opened again in the subsequent VFS open call&n; * (nfs4_proc_file_open).&n; *&n; * The open for read will just hang around to be used by any process that&n; * opens the file O_RDONLY. This will all be resolved with the VFS changes.&n; */
r_static
r_struct
id|inode
op_star
DECL|function|nfs4_proc_create
id|nfs4_proc_create
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|qstr
op_star
id|name
comma
r_struct
id|iattr
op_star
id|sattr
comma
r_int
id|flags
)paren
(brace
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_struct
id|nfs4_state
op_star
id|state
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|rpc_cred
op_star
id|cred
suffix:semicolon
id|cred
op_assign
id|rpcauth_lookupcred
c_func
(paren
id|NFS_SERVER
c_func
(paren
id|dir
)paren
op_member_access_from_pointer
id|client-&gt;cl_auth
comma
l_int|0
)paren
suffix:semicolon
id|state
op_assign
id|nfs4_do_open
c_func
(paren
id|dir
comma
id|name
comma
id|flags
comma
id|sattr
comma
id|cred
)paren
suffix:semicolon
id|put_rpccred
c_func
(paren
id|cred
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|IS_ERR
c_func
(paren
id|state
)paren
)paren
(brace
id|inode
op_assign
id|state-&gt;inode
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|O_EXCL
)paren
(brace
r_struct
id|nfs_fattr
id|fattr
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|nfs4_do_setattr
c_func
(paren
id|NFS_SERVER
c_func
(paren
id|dir
)paren
comma
op_amp
id|fattr
comma
id|NFS_FH
c_func
(paren
id|inode
)paren
comma
id|sattr
comma
id|state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
l_int|0
)paren
(brace
id|nfs4_close_state
c_func
(paren
id|state
comma
id|flags
)paren
suffix:semicolon
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
id|inode
op_assign
id|ERR_PTR
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
id|inode
op_assign
(paren
r_struct
id|inode
op_star
)paren
id|state
suffix:semicolon
r_return
id|inode
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_remove
id|nfs4_proc_remove
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|qstr
op_star
id|name
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|3
)braket
suffix:semicolon
r_struct
id|nfs4_change_info
id|dir_cinfo
suffix:semicolon
r_struct
id|nfs_fattr
id|dir_attr
suffix:semicolon
r_int
id|status
suffix:semicolon
id|dir_attr.valid
op_assign
l_int|0
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|dir
)paren
comma
l_string|&quot;remove&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|dir
)paren
)paren
suffix:semicolon
id|nfs4_setup_remove
c_func
(paren
op_amp
id|compound
comma
id|name
comma
op_amp
id|dir_cinfo
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
id|process_cinfo
c_func
(paren
op_amp
id|dir_cinfo
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|dir
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
)brace
r_return
id|nfs4_map_errors
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
DECL|struct|unlink_desc
r_struct
id|unlink_desc
(brace
DECL|member|compound
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
DECL|member|ops
r_struct
id|nfs4_op
id|ops
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|cinfo
r_struct
id|nfs4_change_info
id|cinfo
suffix:semicolon
DECL|member|attrs
r_struct
id|nfs_fattr
id|attrs
suffix:semicolon
)brace
suffix:semicolon
r_static
r_int
DECL|function|nfs4_proc_unlink_setup
id|nfs4_proc_unlink_setup
c_func
(paren
r_struct
id|rpc_message
op_star
id|msg
comma
r_struct
id|dentry
op_star
id|dir
comma
r_struct
id|qstr
op_star
id|name
)paren
(brace
r_struct
id|unlink_desc
op_star
id|up
suffix:semicolon
r_struct
id|nfs4_compound
op_star
id|cp
suffix:semicolon
id|up
op_assign
(paren
r_struct
id|unlink_desc
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|up
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|up
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|cp
op_assign
op_amp
id|up-&gt;compound
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
id|cp
comma
id|up-&gt;ops
comma
id|NFS_SERVER
c_func
(paren
id|dir-&gt;d_inode
)paren
comma
l_string|&quot;unlink_setup&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
id|cp
comma
id|NFS_FH
c_func
(paren
id|dir-&gt;d_inode
)paren
)paren
suffix:semicolon
id|nfs4_setup_remove
c_func
(paren
id|cp
comma
id|name
comma
op_amp
id|up-&gt;cinfo
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
id|cp
comma
op_amp
id|up-&gt;attrs
)paren
suffix:semicolon
id|msg-&gt;rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_COMPOUND
)braket
suffix:semicolon
id|msg-&gt;rpc_argp
op_assign
id|cp
suffix:semicolon
id|msg-&gt;rpc_resp
op_assign
id|cp
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_unlink_done
id|nfs4_proc_unlink_done
c_func
(paren
r_struct
id|dentry
op_star
id|dir
comma
r_struct
id|rpc_task
op_star
id|task
)paren
(brace
r_struct
id|rpc_message
op_star
id|msg
op_assign
op_amp
id|task-&gt;tk_msg
suffix:semicolon
r_struct
id|unlink_desc
op_star
id|up
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;rpc_argp
)paren
(brace
id|up
op_assign
(paren
r_struct
id|unlink_desc
op_star
)paren
id|msg-&gt;rpc_argp
suffix:semicolon
id|process_lease
c_func
(paren
op_amp
id|up-&gt;compound
)paren
suffix:semicolon
id|process_cinfo
c_func
(paren
op_amp
id|up-&gt;cinfo
comma
op_amp
id|up-&gt;attrs
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|dir-&gt;d_inode
comma
op_amp
id|up-&gt;attrs
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|up
)paren
suffix:semicolon
id|msg-&gt;rpc_argp
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_rename
id|nfs4_proc_rename
c_func
(paren
r_struct
id|inode
op_star
id|old_dir
comma
r_struct
id|qstr
op_star
id|old_name
comma
r_struct
id|inode
op_star
id|new_dir
comma
r_struct
id|qstr
op_star
id|new_name
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|7
)braket
suffix:semicolon
r_struct
id|nfs4_change_info
id|old_cinfo
comma
id|new_cinfo
suffix:semicolon
r_struct
id|nfs_fattr
id|old_dir_attr
comma
id|new_dir_attr
suffix:semicolon
r_int
id|status
suffix:semicolon
id|old_dir_attr.valid
op_assign
l_int|0
suffix:semicolon
id|new_dir_attr.valid
op_assign
l_int|0
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|old_dir
)paren
comma
l_string|&quot;rename&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|old_dir
)paren
)paren
suffix:semicolon
id|nfs4_setup_savefh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|new_dir
)paren
)paren
suffix:semicolon
id|nfs4_setup_rename
c_func
(paren
op_amp
id|compound
comma
id|old_name
comma
id|new_name
comma
op_amp
id|old_cinfo
comma
op_amp
id|new_cinfo
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
op_amp
id|new_dir_attr
)paren
suffix:semicolon
id|nfs4_setup_restorefh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
op_amp
id|old_dir_attr
)paren
suffix:semicolon
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
id|process_cinfo
c_func
(paren
op_amp
id|old_cinfo
comma
op_amp
id|old_dir_attr
)paren
suffix:semicolon
id|process_cinfo
c_func
(paren
op_amp
id|new_cinfo
comma
op_amp
id|new_dir_attr
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|old_dir
comma
op_amp
id|old_dir_attr
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|new_dir
comma
op_amp
id|new_dir_attr
)paren
suffix:semicolon
)brace
r_return
id|nfs4_map_errors
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_link
id|nfs4_proc_link
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|qstr
op_star
id|name
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|7
)braket
suffix:semicolon
r_struct
id|nfs4_change_info
id|dir_cinfo
suffix:semicolon
r_struct
id|nfs_fattr
id|dir_attr
comma
id|fattr
suffix:semicolon
r_int
id|status
suffix:semicolon
id|dir_attr.valid
op_assign
l_int|0
suffix:semicolon
id|fattr.valid
op_assign
l_int|0
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|inode
)paren
comma
l_string|&quot;link&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
id|nfs4_setup_savefh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|dir
)paren
)paren
suffix:semicolon
id|nfs4_setup_link
c_func
(paren
op_amp
id|compound
comma
id|name
comma
op_amp
id|dir_cinfo
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
id|nfs4_setup_restorefh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
op_amp
id|fattr
)paren
suffix:semicolon
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
id|process_cinfo
c_func
(paren
op_amp
id|dir_cinfo
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|dir
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|inode
comma
op_amp
id|fattr
)paren
suffix:semicolon
)brace
r_return
id|nfs4_map_errors
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_symlink
id|nfs4_proc_symlink
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|qstr
op_star
id|name
comma
r_struct
id|qstr
op_star
id|path
comma
r_struct
id|iattr
op_star
id|sattr
comma
r_struct
id|nfs_fh
op_star
id|fhandle
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|7
)braket
suffix:semicolon
r_struct
id|nfs_fattr
id|dir_attr
suffix:semicolon
r_struct
id|nfs4_change_info
id|dir_cinfo
suffix:semicolon
r_int
id|status
suffix:semicolon
id|dir_attr.valid
op_assign
l_int|0
suffix:semicolon
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|dir
)paren
comma
l_string|&quot;symlink&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|dir
)paren
)paren
suffix:semicolon
id|nfs4_setup_savefh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_create_symlink
c_func
(paren
op_amp
id|compound
comma
id|name
comma
id|path
comma
id|sattr
comma
op_amp
id|dir_cinfo
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
id|fattr
)paren
suffix:semicolon
id|nfs4_setup_getfh
c_func
(paren
op_amp
id|compound
comma
id|fhandle
)paren
suffix:semicolon
id|nfs4_setup_restorefh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
id|process_cinfo
c_func
(paren
op_amp
id|dir_cinfo
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|dir
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
)brace
r_return
id|nfs4_map_errors
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_mkdir
id|nfs4_proc_mkdir
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|qstr
op_star
id|name
comma
r_struct
id|iattr
op_star
id|sattr
comma
r_struct
id|nfs_fh
op_star
id|fhandle
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|7
)braket
suffix:semicolon
r_struct
id|nfs_fattr
id|dir_attr
suffix:semicolon
r_struct
id|nfs4_change_info
id|dir_cinfo
suffix:semicolon
r_int
id|status
suffix:semicolon
id|dir_attr.valid
op_assign
l_int|0
suffix:semicolon
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|dir
)paren
comma
l_string|&quot;mkdir&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|dir
)paren
)paren
suffix:semicolon
id|nfs4_setup_savefh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_create_dir
c_func
(paren
op_amp
id|compound
comma
id|name
comma
id|sattr
comma
op_amp
id|dir_cinfo
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
id|fattr
)paren
suffix:semicolon
id|nfs4_setup_getfh
c_func
(paren
op_amp
id|compound
comma
id|fhandle
)paren
suffix:semicolon
id|nfs4_setup_restorefh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
id|process_cinfo
c_func
(paren
op_amp
id|dir_cinfo
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|dir
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
)brace
r_return
id|nfs4_map_errors
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_readdir
id|nfs4_proc_readdir
c_func
(paren
r_struct
id|dentry
op_star
id|dentry
comma
r_struct
id|rpc_cred
op_star
id|cred
comma
id|u64
id|cookie
comma
r_struct
id|page
op_star
id|page
comma
r_int
r_int
id|count
comma
r_int
id|plus
)paren
(brace
r_struct
id|inode
op_star
id|dir
op_assign
id|dentry-&gt;d_inode
suffix:semicolon
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|2
)braket
suffix:semicolon
r_int
id|status
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|dir
)paren
comma
l_string|&quot;readdir&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|dir
)paren
)paren
suffix:semicolon
id|nfs4_setup_readdir
c_func
(paren
op_amp
id|compound
comma
id|cookie
comma
id|NFS_COOKIEVERF
c_func
(paren
id|dir
)paren
comma
op_amp
id|page
comma
id|count
comma
id|dentry
)paren
suffix:semicolon
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
id|cred
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
l_int|0
)paren
id|memcpy
c_func
(paren
id|NFS_COOKIEVERF
c_func
(paren
id|dir
)paren
comma
id|ops
(braket
l_int|1
)braket
dot
id|u.readdir.rd_resp_verifier.data
comma
id|NFS4_VERIFIER_SIZE
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|nfs4_map_errors
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_mknod
id|nfs4_proc_mknod
c_func
(paren
r_struct
id|inode
op_star
id|dir
comma
r_struct
id|qstr
op_star
id|name
comma
r_struct
id|iattr
op_star
id|sattr
comma
id|dev_t
id|rdev
comma
r_struct
id|nfs_fh
op_star
id|fh
comma
r_struct
id|nfs_fattr
op_star
id|fattr
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|7
)braket
suffix:semicolon
r_struct
id|nfs_fattr
id|dir_attr
suffix:semicolon
r_struct
id|nfs4_change_info
id|dir_cinfo
suffix:semicolon
r_int
id|status
suffix:semicolon
id|dir_attr.valid
op_assign
l_int|0
suffix:semicolon
id|fattr-&gt;valid
op_assign
l_int|0
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|NFS_SERVER
c_func
(paren
id|dir
)paren
comma
l_string|&quot;mknod&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|NFS_FH
c_func
(paren
id|dir
)paren
)paren
suffix:semicolon
id|nfs4_setup_savefh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_create_special
c_func
(paren
op_amp
id|compound
comma
id|name
comma
id|rdev
comma
id|sattr
comma
op_amp
id|dir_cinfo
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
id|fattr
)paren
suffix:semicolon
id|nfs4_setup_getfh
c_func
(paren
op_amp
id|compound
comma
id|fh
)paren
suffix:semicolon
id|nfs4_setup_restorefh
c_func
(paren
op_amp
id|compound
)paren
suffix:semicolon
id|nfs4_setup_getattr
c_func
(paren
op_amp
id|compound
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
id|status
op_assign
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
id|process_cinfo
c_func
(paren
op_amp
id|dir_cinfo
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
id|nfs_refresh_inode
c_func
(paren
id|dir
comma
op_amp
id|dir_attr
)paren
suffix:semicolon
)brace
r_return
id|nfs4_map_errors
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_statfs
id|nfs4_proc_statfs
c_func
(paren
r_struct
id|nfs_server
op_star
id|server
comma
r_struct
id|nfs_fh
op_star
id|fhandle
comma
r_struct
id|nfs_fsstat
op_star
id|fsstat
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|2
)braket
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|server
comma
l_string|&quot;statfs&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|fhandle
)paren
suffix:semicolon
id|nfs4_setup_statfs
c_func
(paren
op_amp
id|compound
comma
id|fsstat
)paren
suffix:semicolon
r_return
id|nfs4_map_errors
c_func
(paren
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_fsinfo
id|nfs4_proc_fsinfo
c_func
(paren
r_struct
id|nfs_server
op_star
id|server
comma
r_struct
id|nfs_fh
op_star
id|fhandle
comma
r_struct
id|nfs_fsinfo
op_star
id|fsinfo
)paren
(brace
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_FSINFO
)braket
comma
dot
id|rpc_argp
op_assign
id|fhandle
comma
dot
id|rpc_resp
op_assign
id|fsinfo
comma
)brace
suffix:semicolon
r_return
id|nfs4_map_errors
c_func
(paren
id|rpc_call_sync
c_func
(paren
id|server-&gt;client
comma
op_amp
id|msg
comma
l_int|0
)paren
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_pathconf
id|nfs4_proc_pathconf
c_func
(paren
r_struct
id|nfs_server
op_star
id|server
comma
r_struct
id|nfs_fh
op_star
id|fhandle
comma
r_struct
id|nfs_pathconf
op_star
id|pathconf
)paren
(brace
r_struct
id|nfs4_compound
id|compound
suffix:semicolon
r_struct
id|nfs4_op
id|ops
(braket
l_int|2
)braket
suffix:semicolon
id|nfs4_setup_compound
c_func
(paren
op_amp
id|compound
comma
id|ops
comma
id|server
comma
l_string|&quot;statfs&quot;
)paren
suffix:semicolon
id|nfs4_setup_putfh
c_func
(paren
op_amp
id|compound
comma
id|fhandle
)paren
suffix:semicolon
id|nfs4_setup_pathconf
c_func
(paren
op_amp
id|compound
comma
id|pathconf
)paren
suffix:semicolon
r_return
id|nfs4_map_errors
c_func
(paren
id|nfs4_call_compound
c_func
(paren
op_amp
id|compound
comma
l_int|NULL
comma
l_int|0
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_read_done
id|nfs4_read_done
c_func
(paren
r_struct
id|rpc_task
op_star
id|task
)paren
(brace
r_struct
id|nfs_read_data
op_star
id|data
op_assign
(paren
r_struct
id|nfs_read_data
op_star
)paren
id|task-&gt;tk_calldata
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|data-&gt;inode
suffix:semicolon
r_if
c_cond
(paren
id|nfs4_async_handle_error
c_func
(paren
id|task
comma
id|NFS_SERVER
c_func
(paren
id|inode
)paren
)paren
op_eq
op_minus
id|EAGAIN
)paren
(brace
id|rpc_restart_call
c_func
(paren
id|task
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|task-&gt;tk_status
OG
l_int|0
)paren
id|renew_lease
c_func
(paren
id|NFS_SERVER
c_func
(paren
id|inode
)paren
comma
id|data-&gt;timestamp
)paren
suffix:semicolon
multiline_comment|/* Call back common NFS readpage processing */
id|nfs_readpage_result
c_func
(paren
id|task
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_proc_read_setup
id|nfs4_proc_read_setup
c_func
(paren
r_struct
id|nfs_read_data
op_star
id|data
)paren
(brace
r_struct
id|rpc_task
op_star
id|task
op_assign
op_amp
id|data-&gt;task
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_READ
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|data-&gt;args
comma
dot
id|rpc_resp
op_assign
op_amp
id|data-&gt;res
comma
dot
id|rpc_cred
op_assign
id|data-&gt;cred
comma
)brace
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|data-&gt;inode
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|data-&gt;timestamp
op_assign
id|jiffies
suffix:semicolon
multiline_comment|/* N.B. Do we need to test? Never called for swapfile inode */
id|flags
op_assign
id|RPC_TASK_ASYNC
op_or
(paren
id|IS_SWAPFILE
c_func
(paren
id|inode
)paren
ques
c_cond
id|NFS_RPC_SWAPFLAGS
suffix:colon
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Finalize the task. */
id|rpc_init_task
c_func
(paren
id|task
comma
id|NFS_CLIENT
c_func
(paren
id|inode
)paren
comma
id|nfs4_read_done
comma
id|flags
)paren
suffix:semicolon
id|rpc_call_setup
c_func
(paren
id|task
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_restart_write
id|nfs4_restart_write
c_func
(paren
r_struct
id|rpc_task
op_star
id|task
)paren
(brace
r_struct
id|nfs_write_data
op_star
id|data
op_assign
(paren
r_struct
id|nfs_write_data
op_star
)paren
id|task-&gt;tk_calldata
suffix:semicolon
r_struct
id|nfs_page
op_star
id|req
suffix:semicolon
id|rpc_restart_call
c_func
(paren
id|task
)paren
suffix:semicolon
id|req
op_assign
id|nfs_list_entry
c_func
(paren
id|data-&gt;pages.next
)paren
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;wb_state
)paren
id|nfs4_copy_stateid
c_func
(paren
op_amp
id|data-&gt;args.stateid
comma
id|req-&gt;wb_state
comma
id|req-&gt;wb_lockowner
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
op_amp
id|data-&gt;args.stateid
comma
op_amp
id|zero_stateid
comma
r_sizeof
(paren
id|data-&gt;args.stateid
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_write_done
id|nfs4_write_done
c_func
(paren
r_struct
id|rpc_task
op_star
id|task
)paren
(brace
r_struct
id|nfs_write_data
op_star
id|data
op_assign
(paren
r_struct
id|nfs_write_data
op_star
)paren
id|task-&gt;tk_calldata
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|data-&gt;inode
suffix:semicolon
r_if
c_cond
(paren
id|nfs4_async_handle_error
c_func
(paren
id|task
comma
id|NFS_SERVER
c_func
(paren
id|inode
)paren
)paren
op_eq
op_minus
id|EAGAIN
)paren
(brace
id|task-&gt;tk_action
op_assign
id|nfs4_restart_write
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|task-&gt;tk_status
op_ge
l_int|0
)paren
id|renew_lease
c_func
(paren
id|NFS_SERVER
c_func
(paren
id|inode
)paren
comma
id|data-&gt;timestamp
)paren
suffix:semicolon
multiline_comment|/* Call back common NFS writeback processing */
id|nfs_writeback_done
c_func
(paren
id|task
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_proc_write_setup
id|nfs4_proc_write_setup
c_func
(paren
r_struct
id|nfs_write_data
op_star
id|data
comma
r_int
r_int
id|count
comma
r_int
id|how
)paren
(brace
r_struct
id|rpc_task
op_star
id|task
op_assign
op_amp
id|data-&gt;task
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_WRITE
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|data-&gt;args
comma
dot
id|rpc_resp
op_assign
op_amp
id|data-&gt;res
comma
dot
id|rpc_cred
op_assign
id|data-&gt;cred
comma
)brace
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|data-&gt;inode
suffix:semicolon
r_struct
id|nfs_page
op_star
id|req
op_assign
id|nfs_list_entry
c_func
(paren
id|data-&gt;pages.next
)paren
suffix:semicolon
r_int
id|stable
suffix:semicolon
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|how
op_amp
id|FLUSH_STABLE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|NFS_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|ncommit
)paren
id|stable
op_assign
id|NFS_FILE_SYNC
suffix:semicolon
r_else
id|stable
op_assign
id|NFS_DATA_SYNC
suffix:semicolon
)brace
r_else
id|stable
op_assign
id|NFS_UNSTABLE
suffix:semicolon
id|data-&gt;args.fh
op_assign
id|NFS_FH
c_func
(paren
id|inode
)paren
suffix:semicolon
id|data-&gt;args.offset
op_assign
id|req_offset
c_func
(paren
id|req
)paren
suffix:semicolon
id|data-&gt;args.pgbase
op_assign
id|req-&gt;wb_pgbase
suffix:semicolon
id|data-&gt;args.count
op_assign
id|count
suffix:semicolon
id|data-&gt;args.stable
op_assign
id|stable
suffix:semicolon
id|data-&gt;args.pages
op_assign
id|data-&gt;pagevec
suffix:semicolon
id|data-&gt;res.fattr
op_assign
op_amp
id|data-&gt;fattr
suffix:semicolon
id|data-&gt;res.count
op_assign
id|count
suffix:semicolon
id|data-&gt;res.verf
op_assign
op_amp
id|data-&gt;verf
suffix:semicolon
id|data-&gt;timestamp
op_assign
id|jiffies
suffix:semicolon
id|data-&gt;lockowner
op_assign
id|req-&gt;wb_lockowner
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;wb_state
)paren
id|nfs4_copy_stateid
c_func
(paren
op_amp
id|data-&gt;args.stateid
comma
id|req-&gt;wb_state
comma
id|req-&gt;wb_lockowner
)paren
suffix:semicolon
r_else
id|memcpy
c_func
(paren
op_amp
id|data-&gt;args.stateid
comma
op_amp
id|zero_stateid
comma
r_sizeof
(paren
id|data-&gt;args.stateid
)paren
)paren
suffix:semicolon
multiline_comment|/* Set the initial flags for the task.  */
id|flags
op_assign
(paren
id|how
op_amp
id|FLUSH_SYNC
)paren
ques
c_cond
l_int|0
suffix:colon
id|RPC_TASK_ASYNC
suffix:semicolon
multiline_comment|/* Finalize the task. */
id|rpc_init_task
c_func
(paren
id|task
comma
id|NFS_CLIENT
c_func
(paren
id|inode
)paren
comma
id|nfs4_write_done
comma
id|flags
)paren
suffix:semicolon
id|task-&gt;tk_calldata
op_assign
id|data
suffix:semicolon
multiline_comment|/* Release requests */
id|task-&gt;tk_release
op_assign
id|nfs_writedata_release
suffix:semicolon
id|rpc_call_setup
c_func
(paren
id|task
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_commit_done
id|nfs4_commit_done
c_func
(paren
r_struct
id|rpc_task
op_star
id|task
)paren
(brace
r_struct
id|nfs_write_data
op_star
id|data
op_assign
(paren
r_struct
id|nfs_write_data
op_star
)paren
id|task-&gt;tk_calldata
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|data-&gt;inode
suffix:semicolon
r_if
c_cond
(paren
id|nfs4_async_handle_error
c_func
(paren
id|task
comma
id|NFS_SERVER
c_func
(paren
id|inode
)paren
)paren
op_eq
op_minus
id|EAGAIN
)paren
(brace
id|task-&gt;tk_action
op_assign
id|nfs4_restart_write
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Call back common NFS writeback processing */
id|nfs_commit_done
c_func
(paren
id|task
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_proc_commit_setup
id|nfs4_proc_commit_setup
c_func
(paren
r_struct
id|nfs_write_data
op_star
id|data
comma
id|u64
id|start
comma
id|u32
id|len
comma
r_int
id|how
)paren
(brace
r_struct
id|rpc_task
op_star
id|task
op_assign
op_amp
id|data-&gt;task
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_COMMIT
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|data-&gt;args
comma
dot
id|rpc_resp
op_assign
op_amp
id|data-&gt;res
comma
dot
id|rpc_cred
op_assign
id|data-&gt;cred
comma
)brace
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|data-&gt;inode
suffix:semicolon
r_int
id|flags
suffix:semicolon
id|data-&gt;args.fh
op_assign
id|NFS_FH
c_func
(paren
id|data-&gt;inode
)paren
suffix:semicolon
id|data-&gt;args.offset
op_assign
id|start
suffix:semicolon
id|data-&gt;args.count
op_assign
id|len
suffix:semicolon
id|data-&gt;res.count
op_assign
id|len
suffix:semicolon
id|data-&gt;res.fattr
op_assign
op_amp
id|data-&gt;fattr
suffix:semicolon
id|data-&gt;res.verf
op_assign
op_amp
id|data-&gt;verf
suffix:semicolon
multiline_comment|/* Set the initial flags for the task.  */
id|flags
op_assign
(paren
id|how
op_amp
id|FLUSH_SYNC
)paren
ques
c_cond
l_int|0
suffix:colon
id|RPC_TASK_ASYNC
suffix:semicolon
multiline_comment|/* Finalize the task. */
id|rpc_init_task
c_func
(paren
id|task
comma
id|NFS_CLIENT
c_func
(paren
id|inode
)paren
comma
id|nfs4_commit_done
comma
id|flags
)paren
suffix:semicolon
id|task-&gt;tk_calldata
op_assign
id|data
suffix:semicolon
multiline_comment|/* Release requests */
id|task-&gt;tk_release
op_assign
id|nfs_commit_release
suffix:semicolon
id|rpc_call_setup
c_func
(paren
id|task
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * nfs4_proc_async_renew(): This is not one of the nfs_rpc_ops; it is a special&n; * standalone procedure for queueing an asynchronous RENEW.&n; */
r_static
r_void
DECL|function|renew_done
id|renew_done
c_func
(paren
r_struct
id|rpc_task
op_star
id|task
)paren
(brace
r_struct
id|nfs4_client
op_star
id|clp
op_assign
(paren
r_struct
id|nfs4_client
op_star
)paren
id|task-&gt;tk_msg.rpc_argp
suffix:semicolon
r_int
r_int
id|timestamp
op_assign
(paren
r_int
r_int
)paren
id|task-&gt;tk_calldata
suffix:semicolon
r_if
c_cond
(paren
id|task-&gt;tk_status
OL
l_int|0
)paren
(brace
r_switch
c_cond
(paren
id|task-&gt;tk_status
)paren
(brace
r_case
op_minus
id|NFS4ERR_STALE_CLIENTID
suffix:colon
id|nfs4_schedule_state_recovery
c_func
(paren
id|clp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|spin_lock
c_func
(paren
op_amp
id|clp-&gt;cl_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time_before
c_func
(paren
id|clp-&gt;cl_last_renewal
comma
id|timestamp
)paren
)paren
id|clp-&gt;cl_last_renewal
op_assign
id|timestamp
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|clp-&gt;cl_lock
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs4_proc_async_renew
id|nfs4_proc_async_renew
c_func
(paren
r_struct
id|nfs4_client
op_star
id|clp
)paren
(brace
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_RENEW
)braket
comma
dot
id|rpc_argp
op_assign
id|clp
comma
dot
id|rpc_cred
op_assign
id|clp-&gt;cl_cred
comma
)brace
suffix:semicolon
r_return
id|rpc_call_async
c_func
(paren
id|clp-&gt;cl_rpcclient
comma
op_amp
id|msg
comma
id|RPC_TASK_SOFT
comma
id|renew_done
comma
(paren
r_void
op_star
)paren
id|jiffies
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs4_proc_renew
id|nfs4_proc_renew
c_func
(paren
r_struct
id|nfs4_client
op_star
id|clp
)paren
(brace
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_RENEW
)braket
comma
dot
id|rpc_argp
op_assign
id|clp
comma
dot
id|rpc_cred
op_assign
id|clp-&gt;cl_cred
comma
)brace
suffix:semicolon
r_int
r_int
id|now
op_assign
id|jiffies
suffix:semicolon
r_int
id|status
suffix:semicolon
id|status
op_assign
id|rpc_call_sync
c_func
(paren
id|clp-&gt;cl_rpcclient
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|clp-&gt;cl_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|time_before
c_func
(paren
id|clp-&gt;cl_last_renewal
comma
id|now
)paren
)paren
id|clp-&gt;cl_last_renewal
op_assign
id|now
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|clp-&gt;cl_lock
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * We will need to arrange for the VFS layer to provide an atomic open.&n; * Until then, this open method is prone to inefficiency and race conditions&n; * due to the lookup, potential create, and open VFS calls from sys_open()&n; * placed on the wire.&n; */
r_static
r_int
DECL|function|nfs4_proc_file_open
id|nfs4_proc_file_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_struct
id|dentry
op_star
id|dentry
op_assign
id|filp-&gt;f_dentry
suffix:semicolon
r_struct
id|nfs4_state
op_star
id|state
suffix:semicolon
r_struct
id|rpc_cred
op_star
id|cred
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;nfs4_proc_file_open: starting on (%.*s/%.*s)&bslash;n&quot;
comma
(paren
r_int
)paren
id|dentry-&gt;d_parent-&gt;d_name.len
comma
id|dentry-&gt;d_parent-&gt;d_name.name
comma
(paren
r_int
)paren
id|dentry-&gt;d_name.len
comma
id|dentry-&gt;d_name.name
)paren
suffix:semicolon
multiline_comment|/* Find our open stateid */
id|cred
op_assign
id|rpcauth_lookupcred
c_func
(paren
id|NFS_SERVER
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|client-&gt;cl_auth
comma
l_int|0
)paren
suffix:semicolon
id|state
op_assign
id|nfs4_find_state
c_func
(paren
id|inode
comma
id|cred
comma
id|filp-&gt;f_mode
)paren
suffix:semicolon
id|put_rpccred
c_func
(paren
id|cred
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;NFS: v4 raced in function %s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
multiline_comment|/* ERACE actually */
)brace
id|nfs4_close_state
c_func
(paren
id|state
comma
id|filp-&gt;f_mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|filp-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|nfs_set_mmcred
c_func
(paren
id|inode
comma
id|state-&gt;owner-&gt;so_cred
)paren
suffix:semicolon
id|nfs_begin_data_update
c_func
(paren
id|inode
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
)brace
id|filp-&gt;private_data
op_assign
id|state
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Release our state&n; */
r_static
r_int
DECL|function|nfs4_proc_file_release
id|nfs4_proc_file_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_struct
id|nfs4_state
op_star
id|state
op_assign
(paren
r_struct
id|nfs4_state
op_star
)paren
id|filp-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
id|state
)paren
id|nfs4_close_state
c_func
(paren
id|state
comma
id|filp-&gt;f_mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|filp-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|nfs_end_data_update
c_func
(paren
id|inode
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Set up the nfspage struct with the right state info and credentials&n; */
r_static
r_void
DECL|function|nfs4_request_init
id|nfs4_request_init
c_func
(paren
r_struct
id|nfs_page
op_star
id|req
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_struct
id|nfs4_state
op_star
id|state
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|filp
)paren
(brace
id|req-&gt;wb_cred
op_assign
id|get_rpccred
c_func
(paren
id|NFS_I
c_func
(paren
id|req-&gt;wb_inode
)paren
op_member_access_from_pointer
id|mm_cred
)paren
suffix:semicolon
id|req-&gt;wb_state
op_assign
l_int|NULL
suffix:semicolon
r_return
suffix:semicolon
)brace
id|state
op_assign
(paren
r_struct
id|nfs4_state
op_star
)paren
id|filp-&gt;private_data
suffix:semicolon
id|req-&gt;wb_state
op_assign
id|state
suffix:semicolon
id|req-&gt;wb_cred
op_assign
id|get_rpccred
c_func
(paren
id|state-&gt;owner-&gt;so_cred
)paren
suffix:semicolon
id|req-&gt;wb_lockowner
op_assign
id|current-&gt;files
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_async_handle_error
id|nfs4_async_handle_error
c_func
(paren
r_struct
id|rpc_task
op_star
id|task
comma
r_struct
id|nfs_server
op_star
id|server
)paren
(brace
r_struct
id|nfs4_client
op_star
id|clp
op_assign
id|server-&gt;nfs4_state
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|clp
op_logical_or
id|task-&gt;tk_status
op_ge
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|task-&gt;tk_status
)paren
(brace
r_case
op_minus
id|NFS4ERR_STALE_CLIENTID
suffix:colon
r_case
op_minus
id|NFS4ERR_STALE_STATEID
suffix:colon
r_case
op_minus
id|NFS4ERR_EXPIRED
suffix:colon
id|rpc_sleep_on
c_func
(paren
op_amp
id|clp-&gt;cl_rpcwaitq
comma
id|task
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|nfs4_schedule_state_recovery
c_func
(paren
id|clp
)paren
suffix:semicolon
id|task-&gt;tk_status
op_assign
l_int|0
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_case
op_minus
id|NFS4ERR_GRACE
suffix:colon
r_case
op_minus
id|NFS4ERR_DELAY
suffix:colon
id|rpc_delay
c_func
(paren
id|task
comma
id|NFS4_POLL_RETRY_TIME
)paren
suffix:semicolon
id|task-&gt;tk_status
op_assign
l_int|0
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
r_case
op_minus
id|NFS4ERR_OLD_STATEID
suffix:colon
id|task-&gt;tk_status
op_assign
l_int|0
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|task-&gt;tk_status
op_assign
id|nfs4_map_errors
c_func
(paren
id|task-&gt;tk_status
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|nfs4_wait_clnt_recover
id|nfs4_wait_clnt_recover
c_func
(paren
r_struct
id|rpc_clnt
op_star
id|clnt
comma
r_struct
id|nfs4_client
op_star
id|clp
)paren
(brace
id|DEFINE_WAIT
c_func
(paren
id|wait
)paren
suffix:semicolon
id|sigset_t
id|oldset
suffix:semicolon
r_int
id|interruptible
comma
id|res
suffix:semicolon
id|might_sleep
c_func
(paren
)paren
suffix:semicolon
id|rpc_clnt_sigmask
c_func
(paren
id|clnt
comma
op_amp
id|oldset
)paren
suffix:semicolon
id|interruptible
op_assign
id|TASK_UNINTERRUPTIBLE
suffix:semicolon
r_if
c_cond
(paren
id|clnt-&gt;cl_intr
)paren
id|interruptible
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
r_do
(brace
id|res
op_assign
l_int|0
suffix:semicolon
id|prepare_to_wait
c_func
(paren
op_amp
id|clp-&gt;cl_waitq
comma
op_amp
id|wait
comma
id|interruptible
)paren
suffix:semicolon
id|nfs4_schedule_state_recovery
c_func
(paren
id|clp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|NFS4CLNT_OK
comma
op_amp
id|clp-&gt;cl_state
)paren
op_logical_and
op_logical_neg
id|test_bit
c_func
(paren
id|NFS4CLNT_SETUP_STATE
comma
op_amp
id|clp-&gt;cl_state
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|clnt-&gt;cl_intr
op_logical_and
id|signalled
c_func
(paren
)paren
)paren
(brace
id|res
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
id|schedule
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|NFS4CLNT_OK
comma
op_amp
id|clp-&gt;cl_state
)paren
)paren
(brace
suffix:semicolon
)brace
id|finish_wait
c_func
(paren
op_amp
id|clp-&gt;cl_waitq
comma
op_amp
id|wait
)paren
suffix:semicolon
id|rpc_clnt_sigunmask
c_func
(paren
id|clnt
comma
op_amp
id|oldset
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_delay
id|nfs4_delay
c_func
(paren
r_struct
id|rpc_clnt
op_star
id|clnt
)paren
(brace
id|sigset_t
id|oldset
suffix:semicolon
r_int
id|res
op_assign
l_int|0
suffix:semicolon
id|might_sleep
c_func
(paren
)paren
suffix:semicolon
id|rpc_clnt_sigmask
c_func
(paren
id|clnt
comma
op_amp
id|oldset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|clnt-&gt;cl_intr
)paren
(brace
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|NFS4_POLL_RETRY_TIME
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signalled
c_func
(paren
)paren
)paren
id|res
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
)brace
r_else
(brace
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|NFS4_POLL_RETRY_TIME
)paren
suffix:semicolon
)brace
id|rpc_clnt_sigunmask
c_func
(paren
id|clnt
comma
op_amp
id|oldset
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
multiline_comment|/* This is the error handling routine for processes that are allowed&n; * to sleep.&n; */
r_int
DECL|function|nfs4_handle_error
id|nfs4_handle_error
c_func
(paren
r_struct
id|nfs_server
op_star
id|server
comma
r_int
id|errorcode
)paren
(brace
r_struct
id|nfs4_client
op_star
id|clp
op_assign
id|server-&gt;nfs4_state
suffix:semicolon
r_int
id|ret
op_assign
id|errorcode
suffix:semicolon
r_switch
c_cond
(paren
id|errorcode
)paren
(brace
r_case
op_minus
id|NFS4ERR_STALE_CLIENTID
suffix:colon
r_case
op_minus
id|NFS4ERR_STALE_STATEID
suffix:colon
r_case
op_minus
id|NFS4ERR_EXPIRED
suffix:colon
id|ret
op_assign
id|nfs4_wait_clnt_recover
c_func
(paren
id|server-&gt;client
comma
id|clp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
op_minus
id|NFS4ERR_GRACE
suffix:colon
r_case
op_minus
id|NFS4ERR_DELAY
suffix:colon
id|ret
op_assign
id|nfs4_delay
c_func
(paren
id|server-&gt;client
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
op_minus
id|NFS4ERR_OLD_STATEID
suffix:colon
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* We failed to handle the error */
r_return
id|nfs4_map_errors
c_func
(paren
id|ret
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_request_compatible
id|nfs4_request_compatible
c_func
(paren
r_struct
id|nfs_page
op_star
id|req
comma
r_struct
id|file
op_star
id|filp
comma
r_struct
id|page
op_star
id|page
)paren
(brace
r_struct
id|nfs4_state
op_star
id|state
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|rpc_cred
op_star
id|cred
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;wb_file
op_ne
id|filp
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;wb_page
op_ne
id|page
)paren
r_return
l_int|0
suffix:semicolon
id|state
op_assign
(paren
r_struct
id|nfs4_state
op_star
)paren
id|filp-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;wb_state
op_ne
id|state
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;wb_lockowner
op_ne
id|current-&gt;files
)paren
r_return
l_int|0
suffix:semicolon
id|cred
op_assign
id|state-&gt;owner-&gt;so_cred
suffix:semicolon
r_if
c_cond
(paren
id|req-&gt;wb_cred
op_ne
id|cred
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_int
DECL|function|nfs4_proc_setclientid
id|nfs4_proc_setclientid
c_func
(paren
r_struct
id|nfs4_client
op_star
id|clp
comma
id|u32
id|program
comma
r_int
r_int
id|port
)paren
(brace
id|u32
op_star
id|p
suffix:semicolon
r_struct
id|nfs4_setclientid
id|setclientid
suffix:semicolon
r_struct
id|timespec
id|tv
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_SETCLIENTID
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|setclientid
comma
dot
id|rpc_resp
op_assign
id|clp
comma
dot
id|rpc_cred
op_assign
id|clp-&gt;cl_cred
comma
)brace
suffix:semicolon
id|tv
op_assign
id|CURRENT_TIME
suffix:semicolon
id|p
op_assign
(paren
id|u32
op_star
)paren
id|setclientid.sc_verifier.data
suffix:semicolon
op_star
id|p
op_increment
op_assign
(paren
id|u32
)paren
id|tv.tv_sec
suffix:semicolon
op_star
id|p
op_assign
(paren
id|u32
)paren
id|tv.tv_nsec
suffix:semicolon
id|setclientid.sc_name
op_assign
id|clp-&gt;cl_ipaddr
suffix:semicolon
id|sprintf
c_func
(paren
id|setclientid.sc_netid
comma
l_string|&quot;tcp&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|setclientid.sc_uaddr
comma
l_string|&quot;%s.%d.%d&quot;
comma
id|clp-&gt;cl_ipaddr
comma
id|port
op_rshift
l_int|8
comma
id|port
op_amp
l_int|255
)paren
suffix:semicolon
id|setclientid.sc_prog
op_assign
id|htonl
c_func
(paren
id|program
)paren
suffix:semicolon
id|setclientid.sc_cb_ident
op_assign
l_int|0
suffix:semicolon
r_return
id|rpc_call_sync
c_func
(paren
id|clp-&gt;cl_rpcclient
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs4_proc_setclientid_confirm
id|nfs4_proc_setclientid_confirm
c_func
(paren
r_struct
id|nfs4_client
op_star
id|clp
)paren
(brace
r_struct
id|nfs_fsinfo
id|fsinfo
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_SETCLIENTID_CONFIRM
)braket
comma
dot
id|rpc_argp
op_assign
id|clp
comma
dot
id|rpc_resp
op_assign
op_amp
id|fsinfo
comma
dot
id|rpc_cred
op_assign
id|clp-&gt;cl_cred
comma
)brace
suffix:semicolon
r_int
r_int
id|now
suffix:semicolon
r_int
id|status
suffix:semicolon
id|now
op_assign
id|jiffies
suffix:semicolon
id|status
op_assign
id|rpc_call_sync
c_func
(paren
id|clp-&gt;cl_rpcclient
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
l_int|0
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|clp-&gt;cl_lock
)paren
suffix:semicolon
id|clp-&gt;cl_lease_time
op_assign
id|fsinfo.lease_time
op_star
id|HZ
suffix:semicolon
id|clp-&gt;cl_last_renewal
op_assign
id|now
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|clp-&gt;cl_lock
)paren
suffix:semicolon
)brace
r_return
id|status
suffix:semicolon
)brace
DECL|macro|NFS4_LOCK_MINTIMEOUT
mdefine_line|#define NFS4_LOCK_MINTIMEOUT (1 * HZ)
DECL|macro|NFS4_LOCK_MAXTIMEOUT
mdefine_line|#define NFS4_LOCK_MAXTIMEOUT (30 * HZ)
multiline_comment|/* &n; * sleep, with exponential backoff, and retry the LOCK operation. &n; */
r_static
r_int
r_int
DECL|function|nfs4_set_lock_task_retry
id|nfs4_set_lock_task_retry
c_func
(paren
r_int
r_int
id|timeout
)paren
(brace
id|current-&gt;state
op_assign
id|TASK_INTERRUPTIBLE
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|timeout
)paren
suffix:semicolon
id|timeout
op_lshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|timeout
OG
id|NFS4_LOCK_MAXTIMEOUT
)paren
r_return
id|NFS4_LOCK_MAXTIMEOUT
suffix:semicolon
r_return
id|timeout
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|nfs4_lck_type
id|nfs4_lck_type
c_func
(paren
r_int
id|cmd
comma
r_struct
id|file_lock
op_star
id|request
)paren
(brace
multiline_comment|/* set lock type */
r_switch
c_cond
(paren
id|request-&gt;fl_type
)paren
(brace
r_case
id|F_RDLCK
suffix:colon
r_return
id|IS_SETLKW
c_func
(paren
id|cmd
)paren
ques
c_cond
id|NFS4_READW_LT
suffix:colon
id|NFS4_READ_LT
suffix:semicolon
r_case
id|F_WRLCK
suffix:colon
r_return
id|IS_SETLKW
c_func
(paren
id|cmd
)paren
ques
c_cond
id|NFS4_WRITEW_LT
suffix:colon
id|NFS4_WRITE_LT
suffix:semicolon
r_case
id|F_UNLCK
suffix:colon
r_return
id|NFS4_WRITE_LT
suffix:semicolon
)brace
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_inline
r_uint64
DECL|function|nfs4_lck_length
id|nfs4_lck_length
c_func
(paren
r_struct
id|file_lock
op_star
id|request
)paren
(brace
r_if
c_cond
(paren
id|request-&gt;fl_end
op_eq
id|OFFSET_MAX
)paren
r_return
op_complement
(paren
r_uint64
)paren
l_int|0
suffix:semicolon
r_return
id|request-&gt;fl_end
op_minus
id|request-&gt;fl_start
op_plus
l_int|1
suffix:semicolon
)brace
r_int
DECL|function|nfs4_proc_getlk
id|nfs4_proc_getlk
c_func
(paren
r_struct
id|nfs4_state
op_star
id|state
comma
r_int
id|cmd
comma
r_struct
id|file_lock
op_star
id|request
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|state-&gt;inode
suffix:semicolon
r_struct
id|nfs_server
op_star
id|server
op_assign
id|NFS_SERVER
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|nfs4_client
op_star
id|clp
op_assign
id|server-&gt;nfs4_state
suffix:semicolon
r_struct
id|nfs_lockargs
id|arg
op_assign
(brace
dot
id|fh
op_assign
id|NFS_FH
c_func
(paren
id|inode
)paren
comma
dot
id|type
op_assign
id|nfs4_lck_type
c_func
(paren
id|cmd
comma
id|request
)paren
comma
dot
id|offset
op_assign
id|request-&gt;fl_start
comma
dot
id|length
op_assign
id|nfs4_lck_length
c_func
(paren
id|request
)paren
comma
)brace
suffix:semicolon
r_struct
id|nfs_lockres
id|res
op_assign
(brace
dot
id|server
op_assign
id|server
comma
)brace
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_LOCKT
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|arg
comma
dot
id|rpc_resp
op_assign
op_amp
id|res
comma
dot
id|rpc_cred
op_assign
id|state-&gt;owner-&gt;so_cred
comma
)brace
suffix:semicolon
r_struct
id|nfs_lowner
id|nlo
suffix:semicolon
r_struct
id|nfs4_lock_state
op_star
id|lsp
suffix:semicolon
r_int
id|status
suffix:semicolon
id|nlo.clientid
op_assign
id|clp-&gt;cl_clientid
suffix:semicolon
id|down
c_func
(paren
op_amp
id|state-&gt;lock_sema
)paren
suffix:semicolon
id|lsp
op_assign
id|nfs4_find_lock_state
c_func
(paren
id|state
comma
id|request-&gt;fl_owner
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lsp
)paren
id|nlo.id
op_assign
id|lsp-&gt;ls_id
suffix:semicolon
r_else
(brace
id|spin_lock
c_func
(paren
op_amp
id|clp-&gt;cl_lock
)paren
suffix:semicolon
id|nlo.id
op_assign
id|nfs4_alloc_lockowner_id
c_func
(paren
id|clp
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|clp-&gt;cl_lock
)paren
suffix:semicolon
)brace
id|arg.u.lockt
op_assign
op_amp
id|nlo
suffix:semicolon
id|status
op_assign
id|rpc_call_sync
c_func
(paren
id|server-&gt;client
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
(brace
id|request-&gt;fl_type
op_assign
id|F_UNLCK
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|status
op_eq
op_minus
id|NFS4ERR_DENIED
)paren
(brace
r_int64
id|len
comma
id|start
comma
id|end
suffix:semicolon
id|start
op_assign
id|res.u.denied.offset
suffix:semicolon
id|len
op_assign
id|res.u.denied.length
suffix:semicolon
id|end
op_assign
id|start
op_plus
id|len
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|end
OL
l_int|0
op_logical_or
id|len
op_eq
l_int|0
)paren
id|request-&gt;fl_end
op_assign
id|OFFSET_MAX
suffix:semicolon
r_else
id|request-&gt;fl_end
op_assign
(paren
id|loff_t
)paren
id|end
suffix:semicolon
id|request-&gt;fl_start
op_assign
(paren
id|loff_t
)paren
id|start
suffix:semicolon
id|request-&gt;fl_type
op_assign
id|F_WRLCK
suffix:semicolon
r_if
c_cond
(paren
id|res.u.denied.type
op_amp
l_int|1
)paren
id|request-&gt;fl_type
op_assign
id|F_RDLCK
suffix:semicolon
id|request-&gt;fl_pid
op_assign
l_int|0
suffix:semicolon
id|status
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lsp
)paren
id|nfs4_put_lock_state
c_func
(paren
id|lsp
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|state-&gt;lock_sema
)paren
suffix:semicolon
r_return
id|nfs4_map_errors
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
r_int
DECL|function|nfs4_proc_unlck
id|nfs4_proc_unlck
c_func
(paren
r_struct
id|nfs4_state
op_star
id|state
comma
r_int
id|cmd
comma
r_struct
id|file_lock
op_star
id|request
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|state-&gt;inode
suffix:semicolon
r_struct
id|nfs_server
op_star
id|server
op_assign
id|NFS_SERVER
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|nfs_lockargs
id|arg
op_assign
(brace
dot
id|fh
op_assign
id|NFS_FH
c_func
(paren
id|inode
)paren
comma
dot
id|type
op_assign
id|nfs4_lck_type
c_func
(paren
id|cmd
comma
id|request
)paren
comma
dot
id|offset
op_assign
id|request-&gt;fl_start
comma
dot
id|length
op_assign
id|nfs4_lck_length
c_func
(paren
id|request
)paren
comma
)brace
suffix:semicolon
r_struct
id|nfs_lockres
id|res
op_assign
(brace
dot
id|server
op_assign
id|server
comma
)brace
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_LOCKU
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|arg
comma
dot
id|rpc_resp
op_assign
op_amp
id|res
comma
dot
id|rpc_cred
op_assign
id|state-&gt;owner-&gt;so_cred
comma
)brace
suffix:semicolon
r_struct
id|nfs4_lock_state
op_star
id|lsp
suffix:semicolon
r_struct
id|nfs_locku_opargs
id|luargs
suffix:semicolon
r_int
id|status
op_assign
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|state-&gt;lock_sema
)paren
suffix:semicolon
id|lsp
op_assign
id|nfs4_find_lock_state
c_func
(paren
id|state
comma
id|request-&gt;fl_owner
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lsp
)paren
r_goto
id|out
suffix:semicolon
id|luargs.seqid
op_assign
id|lsp-&gt;ls_seqid
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|luargs.stateid
comma
op_amp
id|lsp-&gt;ls_stateid
comma
r_sizeof
(paren
id|luargs.stateid
)paren
)paren
suffix:semicolon
id|arg.u.locku
op_assign
op_amp
id|luargs
suffix:semicolon
id|status
op_assign
id|rpc_call_sync
c_func
(paren
id|server-&gt;client
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
id|nfs4_increment_lock_seqid
c_func
(paren
id|status
comma
id|lsp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
l_int|0
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|lsp-&gt;ls_stateid
comma
op_amp
id|res.u.stateid
comma
r_sizeof
(paren
id|lsp-&gt;ls_stateid
)paren
)paren
suffix:semicolon
id|nfs4_notify_unlck
c_func
(paren
id|inode
comma
id|request
comma
id|lsp
)paren
suffix:semicolon
)brace
id|nfs4_put_lock_state
c_func
(paren
id|lsp
)paren
suffix:semicolon
id|out
suffix:colon
id|up
c_func
(paren
op_amp
id|state-&gt;lock_sema
)paren
suffix:semicolon
r_return
id|nfs4_map_errors
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_setlk
id|nfs4_proc_setlk
c_func
(paren
r_struct
id|nfs4_state
op_star
id|state
comma
r_int
id|cmd
comma
r_struct
id|file_lock
op_star
id|request
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|state-&gt;inode
suffix:semicolon
r_struct
id|nfs_server
op_star
id|server
op_assign
id|NFS_SERVER
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|nfs4_lock_state
op_star
id|lsp
suffix:semicolon
r_struct
id|nfs_lockargs
id|arg
op_assign
(brace
dot
id|fh
op_assign
id|NFS_FH
c_func
(paren
id|inode
)paren
comma
dot
id|type
op_assign
id|nfs4_lck_type
c_func
(paren
id|cmd
comma
id|request
)paren
comma
dot
id|offset
op_assign
id|request-&gt;fl_start
comma
dot
id|length
op_assign
id|nfs4_lck_length
c_func
(paren
id|request
)paren
comma
)brace
suffix:semicolon
r_struct
id|nfs_lockres
id|res
op_assign
(brace
dot
id|server
op_assign
id|server
comma
)brace
suffix:semicolon
r_struct
id|rpc_message
id|msg
op_assign
(brace
dot
id|rpc_proc
op_assign
op_amp
id|nfs4_procedures
(braket
id|NFSPROC4_CLNT_LOCK
)braket
comma
dot
id|rpc_argp
op_assign
op_amp
id|arg
comma
dot
id|rpc_resp
op_assign
op_amp
id|res
comma
dot
id|rpc_cred
op_assign
id|state-&gt;owner-&gt;so_cred
comma
)brace
suffix:semicolon
r_struct
id|nfs_lock_opargs
id|largs
op_assign
(brace
dot
id|new_lock_owner
op_assign
l_int|0
comma
)brace
suffix:semicolon
r_int
id|status
suffix:semicolon
id|down
c_func
(paren
op_amp
id|state-&gt;lock_sema
)paren
suffix:semicolon
id|lsp
op_assign
id|nfs4_find_lock_state
c_func
(paren
id|state
comma
id|request-&gt;fl_owner
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lsp
op_eq
l_int|NULL
)paren
(brace
r_struct
id|nfs4_state_owner
op_star
id|owner
op_assign
id|state-&gt;owner
suffix:semicolon
r_struct
id|nfs_open_to_lock
id|otl
op_assign
(brace
dot
id|lock_owner
op_assign
(brace
dot
id|clientid
op_assign
id|server-&gt;nfs4_state-&gt;cl_clientid
comma
)brace
comma
)brace
suffix:semicolon
id|status
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|lsp
op_assign
id|nfs4_alloc_lock_state
c_func
(paren
id|state
comma
id|request-&gt;fl_owner
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lsp
)paren
r_goto
id|out
suffix:semicolon
id|otl.lock_seqid
op_assign
id|lsp-&gt;ls_seqid
suffix:semicolon
id|otl.lock_owner.id
op_assign
id|lsp-&gt;ls_id
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|otl.open_stateid
comma
op_amp
id|state-&gt;stateid
comma
r_sizeof
(paren
id|otl.open_stateid
)paren
)paren
suffix:semicolon
id|largs.u.open_lock
op_assign
op_amp
id|otl
suffix:semicolon
id|largs.new_lock_owner
op_assign
l_int|1
suffix:semicolon
id|arg.u.lock
op_assign
op_amp
id|largs
suffix:semicolon
id|down
c_func
(paren
op_amp
id|owner-&gt;so_sema
)paren
suffix:semicolon
id|otl.open_seqid
op_assign
id|owner-&gt;so_seqid
suffix:semicolon
id|status
op_assign
id|rpc_call_sync
c_func
(paren
id|server-&gt;client
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* increment open_owner seqid on success, and &n;&t;&t;* seqid mutating errors */
id|nfs4_increment_seqid
c_func
(paren
id|status
comma
id|owner
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|owner-&gt;so_sema
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|nfs_exist_lock
id|el
op_assign
(brace
dot
id|seqid
op_assign
id|lsp-&gt;ls_seqid
comma
)brace
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|el.stateid
comma
op_amp
id|lsp-&gt;ls_stateid
comma
r_sizeof
(paren
id|el.stateid
)paren
)paren
suffix:semicolon
id|largs.u.exist_lock
op_assign
op_amp
id|el
suffix:semicolon
id|largs.new_lock_owner
op_assign
l_int|0
suffix:semicolon
id|arg.u.lock
op_assign
op_amp
id|largs
suffix:semicolon
id|status
op_assign
id|rpc_call_sync
c_func
(paren
id|server-&gt;client
comma
op_amp
id|msg
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* increment seqid on success, and * seqid mutating errors*/
id|nfs4_increment_lock_seqid
c_func
(paren
id|status
comma
id|lsp
)paren
suffix:semicolon
multiline_comment|/* save the returned stateid. */
r_if
c_cond
(paren
id|status
op_eq
l_int|0
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|lsp-&gt;ls_stateid
comma
op_amp
id|res.u.stateid
comma
r_sizeof
(paren
id|nfs4_stateid
)paren
)paren
suffix:semicolon
id|nfs4_notify_setlk
c_func
(paren
id|inode
comma
id|request
comma
id|lsp
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|status
op_eq
op_minus
id|NFS4ERR_DENIED
)paren
id|status
op_assign
op_minus
id|EAGAIN
suffix:semicolon
id|nfs4_put_lock_state
c_func
(paren
id|lsp
)paren
suffix:semicolon
id|out
suffix:colon
id|up
c_func
(paren
op_amp
id|state-&gt;lock_sema
)paren
suffix:semicolon
r_return
id|nfs4_map_errors
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|nfs4_proc_lock
id|nfs4_proc_lock
c_func
(paren
r_struct
id|file
op_star
id|filp
comma
r_int
id|cmd
comma
r_struct
id|file_lock
op_star
id|request
)paren
(brace
r_struct
id|nfs4_state
op_star
id|state
suffix:semicolon
r_int
r_int
id|timeout
op_assign
id|NFS4_LOCK_MINTIMEOUT
suffix:semicolon
r_int
id|status
suffix:semicolon
multiline_comment|/* verify open state */
id|state
op_assign
(paren
r_struct
id|nfs4_state
op_star
)paren
id|filp-&gt;private_data
suffix:semicolon
id|BUG_ON
c_func
(paren
op_logical_neg
id|state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request-&gt;fl_start
OL
l_int|0
op_logical_or
id|request-&gt;fl_end
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|IS_GETLK
c_func
(paren
id|cmd
)paren
)paren
r_return
id|nfs4_proc_getlk
c_func
(paren
id|state
comma
id|F_GETLK
comma
id|request
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|IS_SETLK
c_func
(paren
id|cmd
)paren
op_logical_or
id|IS_SETLKW
c_func
(paren
id|cmd
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|request-&gt;fl_type
op_eq
id|F_UNLCK
)paren
r_return
id|nfs4_proc_unlck
c_func
(paren
id|state
comma
id|cmd
comma
id|request
)paren
suffix:semicolon
r_do
(brace
id|status
op_assign
id|nfs4_proc_setlk
c_func
(paren
id|state
comma
id|cmd
comma
id|request
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_ne
op_minus
id|EAGAIN
)paren
op_logical_or
id|IS_SETLK
c_func
(paren
id|cmd
)paren
)paren
r_break
suffix:semicolon
id|timeout
op_assign
id|nfs4_set_lock_task_retry
c_func
(paren
id|timeout
)paren
suffix:semicolon
id|status
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|signalled
c_func
(paren
)paren
)paren
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
id|status
OL
l_int|0
)paren
(brace
suffix:semicolon
)brace
r_return
id|status
suffix:semicolon
)brace
DECL|variable|nfs_v4_clientops
r_struct
id|nfs_rpc_ops
id|nfs_v4_clientops
op_assign
(brace
dot
id|version
op_assign
l_int|4
comma
multiline_comment|/* protocol version */
dot
id|dentry_ops
op_assign
op_amp
id|nfs4_dentry_operations
comma
dot
id|dir_inode_ops
op_assign
op_amp
id|nfs4_dir_inode_operations
comma
dot
id|getroot
op_assign
id|nfs4_proc_get_root
comma
dot
id|getattr
op_assign
id|nfs4_proc_getattr
comma
dot
id|setattr
op_assign
id|nfs4_proc_setattr
comma
dot
id|lookup
op_assign
id|nfs4_proc_lookup
comma
dot
id|access
op_assign
id|nfs4_proc_access
comma
dot
id|readlink
op_assign
id|nfs4_proc_readlink
comma
dot
id|read
op_assign
id|nfs4_proc_read
comma
dot
id|write
op_assign
id|nfs4_proc_write
comma
dot
id|commit
op_assign
id|nfs4_proc_commit
comma
dot
id|create
op_assign
id|nfs4_proc_create
comma
dot
id|remove
op_assign
id|nfs4_proc_remove
comma
dot
id|unlink_setup
op_assign
id|nfs4_proc_unlink_setup
comma
dot
id|unlink_done
op_assign
id|nfs4_proc_unlink_done
comma
dot
id|rename
op_assign
id|nfs4_proc_rename
comma
dot
id|link
op_assign
id|nfs4_proc_link
comma
dot
id|symlink
op_assign
id|nfs4_proc_symlink
comma
dot
id|mkdir
op_assign
id|nfs4_proc_mkdir
comma
dot
id|rmdir
op_assign
id|nfs4_proc_remove
comma
dot
id|readdir
op_assign
id|nfs4_proc_readdir
comma
dot
id|mknod
op_assign
id|nfs4_proc_mknod
comma
dot
id|statfs
op_assign
id|nfs4_proc_statfs
comma
dot
id|fsinfo
op_assign
id|nfs4_proc_fsinfo
comma
dot
id|pathconf
op_assign
id|nfs4_proc_pathconf
comma
dot
id|decode_dirent
op_assign
id|nfs4_decode_dirent
comma
dot
id|read_setup
op_assign
id|nfs4_proc_read_setup
comma
dot
id|write_setup
op_assign
id|nfs4_proc_write_setup
comma
dot
id|commit_setup
op_assign
id|nfs4_proc_commit_setup
comma
dot
id|file_open
op_assign
id|nfs4_proc_file_open
comma
dot
id|file_release
op_assign
id|nfs4_proc_file_release
comma
dot
id|request_init
op_assign
id|nfs4_request_init
comma
dot
id|request_compatible
op_assign
id|nfs4_request_compatible
comma
dot
id|lock
op_assign
id|nfs4_proc_lock
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Local variables:&n; *  c-basic-offset: 8&n; * End:&n; */
eof
