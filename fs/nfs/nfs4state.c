multiline_comment|/*&n; *  fs/nfs/nfs4state.c&n; *&n; *  Client-side XDR for NFSv4.&n; *&n; *  Copyright (c) 2002 The Regents of the University of Michigan.&n; *  All rights reserved.&n; *&n; *  Kendrick Smith &lt;kmsmith@umich.edu&gt;&n; *&n; *  Redistribution and use in source and binary forms, with or without&n; *  modification, are permitted provided that the following conditions&n; *  are met:&n; *&n; *  1. Redistributions of source code must retain the above copyright&n; *     notice, this list of conditions and the following disclaimer.&n; *  2. Redistributions in binary form must reproduce the above copyright&n; *     notice, this list of conditions and the following disclaimer in the&n; *     documentation and/or other materials provided with the distribution.&n; *  3. Neither the name of the University nor the names of its&n; *     contributors may be used to endorse or promote products derived&n; *     from this software without specific prior written permission.&n; *&n; *  THIS SOFTWARE IS PROVIDED ``AS IS&squot;&squot; AND ANY EXPRESS OR IMPLIED&n; *  WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF&n; *  MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE&n; *  DISCLAIMED. IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE&n; *  FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR&n; *  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF&n; *  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR&n; *  BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF&n; *  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING&n; *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS&n; *  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.&n; *&n; * Implementation of the NFSv4 state model.  For the time being,&n; * this is minimal, but will be made much more complex in a&n; * subsequent patch.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/nfs_fs.h&gt;
DECL|macro|OPENOWNER_POOL_SIZE
mdefine_line|#define OPENOWNER_POOL_SIZE&t;8
DECL|variable|state_spinlock
r_static
id|spinlock_t
id|state_spinlock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|zero_stateid
id|nfs4_stateid
id|zero_stateid
suffix:semicolon
macro_line|#if 0
id|nfs4_stateid
id|one_stateid
op_assign
(brace
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
comma
l_int|0xff
)brace
suffix:semicolon
macro_line|#endif
r_static
id|LIST_HEAD
c_func
(paren
id|nfs4_clientid_list
)paren
suffix:semicolon
multiline_comment|/*&n; * nfs4_get_client(): returns an empty client structure&n; * nfs4_put_client(): drops reference to client structure&n; *&n; * Since these are allocated/deallocated very rarely, we don&squot;t&n; * bother putting them in a slab cache...&n; */
r_static
r_struct
id|nfs4_client
op_star
DECL|function|nfs4_alloc_client
id|nfs4_alloc_client
c_func
(paren
r_struct
id|in_addr
op_star
id|addr
)paren
(brace
r_struct
id|nfs4_client
op_star
id|clp
suffix:semicolon
r_if
c_cond
(paren
(paren
id|clp
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|clp
)paren
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|memset
c_func
(paren
id|clp
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|clp
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|clp-&gt;cl_addr
comma
id|addr
comma
r_sizeof
(paren
id|clp-&gt;cl_addr
)paren
)paren
suffix:semicolon
id|init_rwsem
c_func
(paren
op_amp
id|clp-&gt;cl_sem
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|clp-&gt;cl_state_owners
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|clp-&gt;cl_unused
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|clp-&gt;cl_lock
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|clp-&gt;cl_count
comma
l_int|1
)paren
suffix:semicolon
id|clp-&gt;cl_state
op_assign
id|NFS4CLNT_NEW
suffix:semicolon
)brace
r_return
id|clp
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_free_client
id|nfs4_free_client
c_func
(paren
r_struct
id|nfs4_client
op_star
id|clp
)paren
(brace
r_struct
id|nfs4_state_owner
op_star
id|sp
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|clp-&gt;cl_unused
)paren
)paren
(brace
id|sp
op_assign
id|list_entry
c_func
(paren
id|clp-&gt;cl_unused.next
comma
r_struct
id|nfs4_state_owner
comma
id|so_list
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|sp-&gt;so_list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sp
)paren
suffix:semicolon
)brace
id|BUG_ON
c_func
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|clp-&gt;cl_state_owners
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|clp-&gt;cl_cred
)paren
id|put_rpccred
c_func
(paren
id|clp-&gt;cl_cred
)paren
suffix:semicolon
r_if
c_cond
(paren
id|clp-&gt;cl_rpcclient
)paren
id|rpc_shutdown_client
c_func
(paren
id|clp-&gt;cl_rpcclient
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|clp
)paren
suffix:semicolon
)brace
r_struct
id|nfs4_client
op_star
DECL|function|nfs4_get_client
id|nfs4_get_client
c_func
(paren
r_struct
id|in_addr
op_star
id|addr
)paren
(brace
r_struct
id|nfs4_client
op_star
r_new
comma
op_star
id|clp
op_assign
l_int|NULL
suffix:semicolon
r_new
op_assign
id|nfs4_alloc_client
c_func
(paren
id|addr
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|state_spinlock
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|clp
comma
op_amp
id|nfs4_clientid_list
comma
id|cl_servers
)paren
(brace
r_if
c_cond
(paren
id|memcmp
c_func
(paren
op_amp
id|clp-&gt;cl_addr
comma
id|addr
comma
r_sizeof
(paren
id|clp-&gt;cl_addr
)paren
)paren
op_eq
l_int|0
)paren
r_goto
id|found
suffix:semicolon
)brace
r_if
c_cond
(paren
r_new
)paren
id|list_add
c_func
(paren
op_amp
r_new
op_member_access_from_pointer
id|cl_servers
comma
op_amp
id|nfs4_clientid_list
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|state_spinlock
)paren
suffix:semicolon
r_return
r_new
suffix:semicolon
id|found
suffix:colon
id|atomic_inc
c_func
(paren
op_amp
id|clp-&gt;cl_count
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|state_spinlock
)paren
suffix:semicolon
r_if
c_cond
(paren
r_new
)paren
id|nfs4_free_client
c_func
(paren
r_new
)paren
suffix:semicolon
r_return
id|clp
suffix:semicolon
)brace
r_void
DECL|function|nfs4_put_client
id|nfs4_put_client
c_func
(paren
r_struct
id|nfs4_client
op_star
id|clp
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|atomic_dec_and_lock
c_func
(paren
op_amp
id|clp-&gt;cl_count
comma
op_amp
id|state_spinlock
)paren
)paren
r_return
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|clp-&gt;cl_servers
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|state_spinlock
)paren
suffix:semicolon
id|nfs4_free_client
c_func
(paren
id|clp
)paren
suffix:semicolon
)brace
r_static
r_inline
id|u32
DECL|function|nfs4_alloc_lockowner_id
id|nfs4_alloc_lockowner_id
c_func
(paren
r_struct
id|nfs4_client
op_star
id|clp
)paren
(brace
r_return
id|clp-&gt;cl_lockowner_id
op_increment
suffix:semicolon
)brace
r_static
r_struct
id|nfs4_state_owner
op_star
DECL|function|nfs4_client_grab_unused
id|nfs4_client_grab_unused
c_func
(paren
r_struct
id|nfs4_client
op_star
id|clp
comma
r_struct
id|rpc_cred
op_star
id|cred
)paren
(brace
r_struct
id|nfs4_state_owner
op_star
id|sp
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|clp-&gt;cl_unused
)paren
)paren
(brace
id|sp
op_assign
id|list_entry
c_func
(paren
id|clp-&gt;cl_unused.next
comma
r_struct
id|nfs4_state_owner
comma
id|so_list
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|sp-&gt;so_count
)paren
suffix:semicolon
id|sp-&gt;so_cred
op_assign
id|cred
suffix:semicolon
id|list_move
c_func
(paren
op_amp
id|sp-&gt;so_list
comma
op_amp
id|clp-&gt;cl_state_owners
)paren
suffix:semicolon
id|clp-&gt;cl_nunused
op_decrement
suffix:semicolon
)brace
r_return
id|sp
suffix:semicolon
)brace
multiline_comment|/*&n; * nfs4_alloc_state_owner(): this is called on the OPEN or CREATE path to&n; * create a new state_owner.&n; *&n; */
r_static
r_struct
id|nfs4_state_owner
op_star
DECL|function|nfs4_alloc_state_owner
id|nfs4_alloc_state_owner
c_func
(paren
r_void
)paren
(brace
r_struct
id|nfs4_state_owner
op_star
id|sp
suffix:semicolon
id|sp
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|sp
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sp
)paren
r_return
l_int|NULL
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|sp-&gt;so_sema
)paren
suffix:semicolon
id|sp-&gt;so_seqid
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* arbitrary */
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|sp-&gt;so_states
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|sp-&gt;so_count
comma
l_int|1
)paren
suffix:semicolon
r_return
id|sp
suffix:semicolon
)brace
r_struct
id|nfs4_state_owner
op_star
DECL|function|nfs4_get_state_owner
id|nfs4_get_state_owner
c_func
(paren
r_struct
id|nfs_server
op_star
id|server
comma
r_struct
id|rpc_cred
op_star
id|cred
)paren
(brace
r_struct
id|nfs4_client
op_star
id|clp
op_assign
id|server-&gt;nfs4_state
suffix:semicolon
r_struct
id|nfs4_state_owner
op_star
id|sp
comma
op_star
r_new
suffix:semicolon
id|get_rpccred
c_func
(paren
id|cred
)paren
suffix:semicolon
r_new
op_assign
id|nfs4_alloc_state_owner
c_func
(paren
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|clp-&gt;cl_lock
)paren
suffix:semicolon
id|sp
op_assign
id|nfs4_client_grab_unused
c_func
(paren
id|clp
comma
id|cred
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp
op_eq
l_int|NULL
op_logical_and
r_new
op_ne
l_int|NULL
)paren
(brace
id|list_add
c_func
(paren
op_amp
r_new
op_member_access_from_pointer
id|so_list
comma
op_amp
id|clp-&gt;cl_state_owners
)paren
suffix:semicolon
r_new
op_member_access_from_pointer
id|so_client
op_assign
id|clp
suffix:semicolon
r_new
op_member_access_from_pointer
id|so_id
op_assign
id|nfs4_alloc_lockowner_id
c_func
(paren
id|clp
)paren
suffix:semicolon
r_new
op_member_access_from_pointer
id|so_cred
op_assign
id|cred
suffix:semicolon
id|sp
op_assign
r_new
suffix:semicolon
r_new
op_assign
l_int|NULL
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|clp-&gt;cl_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
r_new
)paren
id|kfree
c_func
(paren
r_new
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sp
)paren
id|put_rpccred
c_func
(paren
id|cred
)paren
suffix:semicolon
r_return
id|sp
suffix:semicolon
)brace
r_void
DECL|function|nfs4_put_state_owner
id|nfs4_put_state_owner
c_func
(paren
r_struct
id|nfs4_state_owner
op_star
id|sp
)paren
(brace
r_struct
id|nfs4_client
op_star
id|clp
op_assign
id|sp-&gt;so_client
suffix:semicolon
r_struct
id|rpc_cred
op_star
id|cred
op_assign
id|sp-&gt;so_cred
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|atomic_dec_and_lock
c_func
(paren
op_amp
id|sp-&gt;so_count
comma
op_amp
id|clp-&gt;cl_lock
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|clp-&gt;cl_nunused
op_ge
id|OPENOWNER_POOL_SIZE
)paren
r_goto
id|out_free
suffix:semicolon
id|list_move
c_func
(paren
op_amp
id|sp-&gt;so_list
comma
op_amp
id|clp-&gt;cl_unused
)paren
suffix:semicolon
id|clp-&gt;cl_nunused
op_increment
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|clp-&gt;cl_lock
)paren
suffix:semicolon
id|put_rpccred
c_func
(paren
id|cred
)paren
suffix:semicolon
id|cred
op_assign
l_int|NULL
suffix:semicolon
r_return
suffix:semicolon
id|out_free
suffix:colon
id|list_del
c_func
(paren
op_amp
id|sp-&gt;so_list
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|clp-&gt;cl_lock
)paren
suffix:semicolon
id|put_rpccred
c_func
(paren
id|cred
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sp
)paren
suffix:semicolon
)brace
r_static
r_struct
id|nfs4_state
op_star
DECL|function|nfs4_alloc_open_state
id|nfs4_alloc_open_state
c_func
(paren
r_void
)paren
(brace
r_struct
id|nfs4_state
op_star
id|state
suffix:semicolon
id|state
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|state
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|state
)paren
r_return
l_int|NULL
suffix:semicolon
id|state-&gt;pid
op_assign
id|current-&gt;pid
suffix:semicolon
id|state-&gt;state
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|state-&gt;stateid.data
comma
l_int|0
comma
r_sizeof
(paren
id|state-&gt;stateid.data
)paren
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|state-&gt;count
comma
l_int|1
)paren
suffix:semicolon
r_return
id|state
suffix:semicolon
)brace
r_static
r_struct
id|nfs4_state
op_star
DECL|function|__nfs4_find_state_bypid
id|__nfs4_find_state_bypid
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
id|pid_t
id|pid
)paren
(brace
r_struct
id|nfs_inode
op_star
id|nfsi
op_assign
id|NFS_I
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|nfs4_state
op_star
id|state
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|state
comma
op_amp
id|nfsi-&gt;open_states
comma
id|inode_states
)paren
(brace
r_if
c_cond
(paren
id|state-&gt;pid
op_eq
id|pid
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|state-&gt;count
)paren
suffix:semicolon
r_return
id|state
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
r_static
r_struct
id|nfs4_state
op_star
DECL|function|__nfs4_find_state_byowner
id|__nfs4_find_state_byowner
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|nfs4_state_owner
op_star
id|owner
)paren
(brace
r_struct
id|nfs_inode
op_star
id|nfsi
op_assign
id|NFS_I
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|nfs4_state
op_star
id|state
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|state
comma
op_amp
id|nfsi-&gt;open_states
comma
id|inode_states
)paren
(brace
r_if
c_cond
(paren
id|state-&gt;owner
op_eq
id|owner
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|state-&gt;count
)paren
suffix:semicolon
r_return
id|state
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
r_struct
id|nfs4_state
op_star
DECL|function|nfs4_find_state_bypid
id|nfs4_find_state_bypid
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
id|pid_t
id|pid
)paren
(brace
r_struct
id|nfs_inode
op_star
id|nfsi
op_assign
id|NFS_I
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|nfs4_state
op_star
id|state
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|inode-&gt;i_lock
)paren
suffix:semicolon
id|state
op_assign
id|__nfs4_find_state_bypid
c_func
(paren
id|inode
comma
id|pid
)paren
suffix:semicolon
multiline_comment|/* Add the state to the tail of the inode&squot;s list */
r_if
c_cond
(paren
id|state
)paren
id|list_move_tail
c_func
(paren
op_amp
id|state-&gt;inode_states
comma
op_amp
id|nfsi-&gt;open_states
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|inode-&gt;i_lock
)paren
suffix:semicolon
r_return
id|state
suffix:semicolon
)brace
r_static
r_void
DECL|function|nfs4_free_open_state
id|nfs4_free_open_state
c_func
(paren
r_struct
id|nfs4_state
op_star
id|state
)paren
(brace
id|kfree
c_func
(paren
id|state
)paren
suffix:semicolon
)brace
r_struct
id|nfs4_state
op_star
DECL|function|nfs4_get_open_state
id|nfs4_get_open_state
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|nfs4_state_owner
op_star
id|owner
)paren
(brace
r_struct
id|nfs4_state
op_star
id|state
comma
op_star
r_new
suffix:semicolon
r_struct
id|nfs_inode
op_star
id|nfsi
op_assign
id|NFS_I
c_func
(paren
id|inode
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|inode-&gt;i_lock
)paren
suffix:semicolon
id|state
op_assign
id|__nfs4_find_state_byowner
c_func
(paren
id|inode
comma
id|owner
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|inode-&gt;i_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state
)paren
r_goto
id|out
suffix:semicolon
r_new
op_assign
id|nfs4_alloc_open_state
c_func
(paren
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|inode-&gt;i_lock
)paren
suffix:semicolon
id|state
op_assign
id|__nfs4_find_state_byowner
c_func
(paren
id|inode
comma
id|owner
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state
op_eq
l_int|NULL
op_logical_and
r_new
op_ne
l_int|NULL
)paren
(brace
id|state
op_assign
r_new
suffix:semicolon
multiline_comment|/* Caller *must* be holding owner-&gt;so_sem */
id|list_add
c_func
(paren
op_amp
id|state-&gt;open_states
comma
op_amp
id|owner-&gt;so_states
)paren
suffix:semicolon
id|state-&gt;owner
op_assign
id|owner
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|owner-&gt;so_count
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|state-&gt;inode_states
comma
op_amp
id|nfsi-&gt;open_states
)paren
suffix:semicolon
id|state-&gt;inode
op_assign
id|inode
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|inode-&gt;i_count
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|inode-&gt;i_lock
)paren
suffix:semicolon
)brace
r_else
(brace
id|spin_unlock
c_func
(paren
op_amp
id|inode-&gt;i_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
r_new
)paren
id|nfs4_free_open_state
c_func
(paren
r_new
)paren
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|state
suffix:semicolon
)brace
r_void
DECL|function|nfs4_put_open_state
id|nfs4_put_open_state
c_func
(paren
r_struct
id|nfs4_state
op_star
id|state
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|state-&gt;inode
suffix:semicolon
r_struct
id|nfs4_state_owner
op_star
id|owner
op_assign
id|state-&gt;owner
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|atomic_dec_and_lock
c_func
(paren
op_amp
id|state-&gt;count
comma
op_amp
id|inode-&gt;i_lock
)paren
)paren
r_return
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|state-&gt;inode_states
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|inode-&gt;i_lock
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|owner-&gt;so_sema
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|state-&gt;open_states
)paren
suffix:semicolon
r_if
c_cond
(paren
id|state-&gt;state
op_ne
l_int|0
)paren
id|nfs4_do_close
c_func
(paren
id|inode
comma
id|state
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|owner-&gt;so_sema
)paren
suffix:semicolon
id|iput
c_func
(paren
id|inode
)paren
suffix:semicolon
id|nfs4_free_open_state
c_func
(paren
id|state
)paren
suffix:semicolon
id|nfs4_put_state_owner
c_func
(paren
id|owner
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;* Called with sp-&gt;so_sema held.&n;*&n;* Increment the seqid if the OPEN/OPEN_DOWNGRADE/CLOSE succeeded, or&n;* failed with a seqid incrementing error -&n;* see comments nfs_fs.h:seqid_mutating_error()&n;*/
r_void
DECL|function|nfs4_increment_seqid
id|nfs4_increment_seqid
c_func
(paren
id|u32
id|status
comma
r_struct
id|nfs4_state_owner
op_star
id|sp
)paren
(brace
r_if
c_cond
(paren
id|status
op_eq
id|NFS_OK
op_logical_or
id|seqid_mutating_err
c_func
(paren
id|status
)paren
)paren
id|sp-&gt;so_seqid
op_increment
suffix:semicolon
)brace
multiline_comment|/*&n; * Local variables:&n; *  c-basic-offset: 8&n; * End:&n; */
eof
