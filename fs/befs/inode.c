multiline_comment|/*&n; * inode.c&n; * &n; * Copyright (C) 2001 Will Dyson &lt;will_dyson@pobox.com&gt;&n; */
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &quot;befs.h&quot;
macro_line|#include &quot;inode.h&quot;
macro_line|#include &quot;endian.h&quot;
multiline_comment|/*&n;&t;Validates the correctness of the befs inode&n;&t;Returns BEFS_OK if the inode should be used, otherwise&n;&t;returns BEFS_BAD_INODE&n;*/
r_int
DECL|function|befs_check_inode
id|befs_check_inode
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
id|befs_inode
op_star
id|raw_inode
comma
id|befs_blocknr_t
id|inode
)paren
(brace
id|u32
id|magic1
op_assign
id|fs32_to_cpu
c_func
(paren
id|sb
comma
id|raw_inode-&gt;magic1
)paren
suffix:semicolon
id|befs_inode_addr
id|ino_num
op_assign
id|fsrun_to_cpu
c_func
(paren
id|sb
comma
id|raw_inode-&gt;inode_num
)paren
suffix:semicolon
id|u32
id|flags
op_assign
id|fs32_to_cpu
c_func
(paren
id|sb
comma
id|raw_inode-&gt;flags
)paren
suffix:semicolon
multiline_comment|/* check magic header. */
r_if
c_cond
(paren
id|magic1
op_ne
id|BEFS_INODE_MAGIC1
)paren
(brace
id|befs_error
c_func
(paren
id|sb
comma
l_string|&quot;Inode has a bad magic header - inode = %lu&quot;
comma
id|inode
)paren
suffix:semicolon
r_return
id|BEFS_BAD_INODE
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Sanity check2: inodes store their own block address. Check it.&n;&t; */
r_if
c_cond
(paren
id|inode
op_ne
id|iaddr2blockno
c_func
(paren
id|sb
comma
op_amp
id|ino_num
)paren
)paren
(brace
id|befs_error
c_func
(paren
id|sb
comma
l_string|&quot;inode blocknr field disagrees with vfs &quot;
l_string|&quot;VFS: %lu, Inode %lu&quot;
comma
id|inode
comma
id|iaddr2blockno
c_func
(paren
id|sb
comma
op_amp
id|ino_num
)paren
)paren
suffix:semicolon
r_return
id|BEFS_BAD_INODE
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * check flag&n;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
id|BEFS_INODE_IN_USE
)paren
)paren
(brace
id|befs_error
c_func
(paren
id|sb
comma
l_string|&quot;inode is not used - inode = %lu&quot;
comma
id|inode
)paren
suffix:semicolon
r_return
id|BEFS_BAD_INODE
suffix:semicolon
)brace
r_return
id|BEFS_OK
suffix:semicolon
)brace
eof
