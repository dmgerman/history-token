multiline_comment|/* -*- mode: c; c-basic-offset: 8; indent-tabs-mode: nil; -*-&n; * vim:expandtab:shiftwidth=8:tabstop=8:&n; *&n; *  Copyright (C) 1999 Peter J. Braam &lt;braam@clusterfs.com&gt;&n; *&n; *   This file is part of InterMezzo, http://www.inter-mezzo.org.&n; *&n; *   InterMezzo is free software; you can redistribute it and/or&n; *   modify it under the terms of version 2 of the GNU General Public&n; *   License as published by the Free Software Foundation.&n; *&n; *   InterMezzo is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with InterMezzo; if not, write to the Free Software&n; *   Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; *  Sysctrl entries for Intermezzo!&n; */
macro_line|#include &lt;linux/config.h&gt; /* for CONFIG_PROC_FS */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/sysctl.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/utsname.h&gt;
macro_line|#include &lt;linux/blk.h&gt;
macro_line|#include &quot;intermezzo_fs.h&quot;
macro_line|#include &quot;intermezzo_psdev.h&quot;
multiline_comment|/* /proc entries */
macro_line|#ifdef CONFIG_PROC_FS
DECL|variable|proc_fs_intermezzo
r_struct
id|proc_dir_entry
op_star
id|proc_fs_intermezzo
suffix:semicolon
DECL|function|intermezzo_mount_get_info
r_int
id|intermezzo_mount_get_info
c_func
(paren
r_char
op_star
id|buffer
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|length
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* this works as long as we are below 1024 characters! */
op_star
id|start
op_assign
id|buffer
op_plus
id|offset
suffix:semicolon
id|len
op_sub_assign
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* SYSCTL below */
DECL|variable|intermezzo_table_header
r_static
r_struct
id|ctl_table_header
op_star
id|intermezzo_table_header
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* 0x100 to avoid any chance of collisions at any point in the tree with&n; * non-directories&n; */
DECL|macro|PSDEV_INTERMEZZO
mdefine_line|#define PSDEV_INTERMEZZO  (0x100)
DECL|macro|PSDEV_DEBUG
mdefine_line|#define PSDEV_DEBUG&t;   1      /* control debugging */
DECL|macro|PSDEV_TRACE
mdefine_line|#define PSDEV_TRACE&t;   2      /* control enter/leave pattern */
DECL|macro|PSDEV_TIMEOUT
mdefine_line|#define PSDEV_TIMEOUT      3      /* timeout on upcalls to become intrble */
DECL|macro|PSDEV_HARD
mdefine_line|#define PSDEV_HARD         4      /* mount type &quot;hard&quot; or &quot;soft&quot; */
DECL|macro|PSDEV_NO_FILTER
mdefine_line|#define PSDEV_NO_FILTER    5      /* controls presto_chk */
DECL|macro|PSDEV_NO_JOURNAL
mdefine_line|#define PSDEV_NO_JOURNAL   6      /* controls presto_chk */
DECL|macro|PSDEV_NO_UPCALL
mdefine_line|#define PSDEV_NO_UPCALL    7      /* controls lento_upcall */
DECL|macro|PSDEV_ERRORVAL
mdefine_line|#define PSDEV_ERRORVAL     8      /* controls presto_debug_fail_blkdev */
DECL|macro|PSDEV_EXCL_GID
mdefine_line|#define PSDEV_EXCL_GID     9      /* which GID is ignored by presto */
DECL|macro|PSDEV_BYTES_TO_CLOSE
mdefine_line|#define PSDEV_BYTES_TO_CLOSE 11   /* bytes to write before close */
multiline_comment|/* These are global presto control options */
DECL|macro|PRESTO_PRIMARY_CTLCNT
mdefine_line|#define PRESTO_PRIMARY_CTLCNT 2
DECL|variable|presto_table
r_static
r_struct
id|ctl_table
id|presto_table
(braket
id|PRESTO_PRIMARY_CTLCNT
op_plus
id|MAX_CHANNEL
op_plus
l_int|1
)braket
op_assign
(brace
(brace
id|PSDEV_DEBUG
comma
l_string|&quot;debug&quot;
comma
op_amp
id|presto_debug
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|PSDEV_TRACE
comma
l_string|&quot;trace&quot;
comma
op_amp
id|presto_print_entry
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Intalling the sysctl entries: strategy&n; * - have templates for each /proc/sys/intermezzo/ entry&n; *   such an entry exists for each /dev/presto&n; *    (proto_channel_entry)&n; * - have a template for the contents of such directories&n; *    (proto_psdev_table)&n; * - have the master table (presto_table)&n; *&n; * When installing, malloc, memcpy and fix up the pointers to point to&n; * the appropriate constants in izo_channels[your_minor]&n; */
DECL|variable|proto_psdev_table
r_static
id|ctl_table
id|proto_psdev_table
(braket
)braket
op_assign
(brace
(brace
id|PSDEV_HARD
comma
l_string|&quot;hard&quot;
comma
l_int|0
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|PSDEV_NO_FILTER
comma
l_string|&quot;no_filter&quot;
comma
l_int|0
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|PSDEV_NO_JOURNAL
comma
l_string|&quot;no_journal&quot;
comma
l_int|NULL
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|PSDEV_NO_UPCALL
comma
l_string|&quot;no_upcall&quot;
comma
l_int|NULL
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
(brace
id|PSDEV_TIMEOUT
comma
l_string|&quot;timeout&quot;
comma
l_int|NULL
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
macro_line|#ifdef PRESTO_DEBUG
(brace
id|PSDEV_ERRORVAL
comma
l_string|&quot;errorval&quot;
comma
l_int|NULL
comma
r_sizeof
(paren
r_int
)paren
comma
l_int|0644
comma
l_int|NULL
comma
op_amp
id|proc_dointvec
)brace
comma
macro_line|#endif
(brace
l_int|0
)brace
)brace
suffix:semicolon
DECL|variable|proto_channel_entry
r_static
id|ctl_table
id|proto_channel_entry
op_assign
(brace
id|PSDEV_INTERMEZZO
comma
l_int|0
comma
l_int|NULL
comma
l_int|0
comma
l_int|0555
comma
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|intermezzo_table
r_static
id|ctl_table
id|intermezzo_table
(braket
l_int|2
)braket
op_assign
(brace
(brace
id|PSDEV_INTERMEZZO
comma
l_string|&quot;intermezzo&quot;
comma
l_int|NULL
comma
l_int|0
comma
l_int|0555
comma
id|presto_table
)brace
comma
(brace
l_int|0
)brace
)brace
suffix:semicolon
multiline_comment|/* support for external setting and getting of opts. */
multiline_comment|/* particularly via ioctl. The Right way to do this is via sysctl,&n; * but that will have to wait until intermezzo gets its own nice set of&n; * sysctl IDs&n; */
multiline_comment|/* we made these separate as setting may in future be more restricted&n; * than getting&n; */
macro_line|#ifdef RON_MINNICH
DECL|function|dosetopt
r_int
id|dosetopt
c_func
(paren
r_int
id|minor
comma
r_struct
id|psdev_opt
op_star
id|opt
)paren
(brace
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
r_int
id|newval
op_assign
id|opt-&gt;optval
suffix:semicolon
id|ENTRY
suffix:semicolon
r_switch
c_cond
(paren
id|opt-&gt;optname
)paren
(brace
r_case
id|PSDEV_TIMEOUT
suffix:colon
id|izo_channels
(braket
id|minor
)braket
dot
id|uc_timeout
op_assign
id|newval
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSDEV_HARD
suffix:colon
id|izo_channels
(braket
id|minor
)braket
dot
id|uc_hard
op_assign
id|newval
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSDEV_NO_FILTER
suffix:colon
id|izo_channels
(braket
id|minor
)braket
dot
id|uc_no_filter
op_assign
id|newval
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSDEV_NO_JOURNAL
suffix:colon
id|izo_channels
(braket
id|minor
)braket
dot
id|uc_no_journal
op_assign
id|newval
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSDEV_NO_UPCALL
suffix:colon
id|izo_channels
(braket
id|minor
)braket
dot
id|uc_no_upcall
op_assign
id|newval
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef PRESTO_DEBUG
r_case
id|PSDEV_ERRORVAL
suffix:colon
(brace
multiline_comment|/* If we have a positive arg, set a breakpoint for that&n;&t;&t; * value.  If we have a negative arg, make that device&n;&t;&t; * read-only.  FIXME  It would be much better to only&n;&t;&t; * allow setting the underlying device read-only for the&n;&t;&t; * current presto cache.&n;&t;&t; */
r_int
id|errorval
op_assign
id|izo_channels
(braket
id|minor
)braket
dot
id|uc_errorval
suffix:semicolon
r_if
c_cond
(paren
id|errorval
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|newval
op_eq
l_int|0
)paren
id|set_device_ro
c_func
(paren
op_minus
id|errorval
comma
l_int|0
)paren
suffix:semicolon
r_else
id|CERROR
c_func
(paren
l_string|&quot;device %s already read only&bslash;n&quot;
comma
id|kdevname
c_func
(paren
op_minus
id|errorval
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|newval
OL
l_int|0
)paren
id|set_device_ro
c_func
(paren
op_minus
id|newval
comma
l_int|1
)paren
suffix:semicolon
id|izo_channels
(braket
id|minor
)braket
dot
id|uc_errorval
op_assign
id|newval
suffix:semicolon
id|CDEBUG
c_func
(paren
id|D_PSDEV
comma
l_string|&quot;setting errorval to %d&bslash;n&quot;
comma
id|newval
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
macro_line|#endif
r_case
id|PSDEV_TRACE
suffix:colon
r_case
id|PSDEV_DEBUG
suffix:colon
r_case
id|PSDEV_BYTES_TO_CLOSE
suffix:colon
r_default
suffix:colon
id|CDEBUG
c_func
(paren
id|D_PSDEV
comma
l_string|&quot;ioctl: dosetopt: minor %d, bad optname 0x%x, &bslash;n&quot;
comma
id|minor
comma
id|opt-&gt;optname
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|EXIT
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|dogetopt
r_int
id|dogetopt
c_func
(paren
r_int
id|minor
comma
r_struct
id|psdev_opt
op_star
id|opt
)paren
(brace
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|ENTRY
suffix:semicolon
r_switch
c_cond
(paren
id|opt-&gt;optname
)paren
(brace
r_case
id|PSDEV_TIMEOUT
suffix:colon
id|opt-&gt;optval
op_assign
id|izo_channels
(braket
id|minor
)braket
dot
id|uc_timeout
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSDEV_HARD
suffix:colon
id|opt-&gt;optval
op_assign
id|izo_channels
(braket
id|minor
)braket
dot
id|uc_hard
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSDEV_NO_FILTER
suffix:colon
id|opt-&gt;optval
op_assign
id|izo_channels
(braket
id|minor
)braket
dot
id|uc_no_filter
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSDEV_NO_JOURNAL
suffix:colon
id|opt-&gt;optval
op_assign
id|izo_channels
(braket
id|minor
)braket
dot
id|uc_no_journal
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSDEV_NO_UPCALL
suffix:colon
id|opt-&gt;optval
op_assign
id|izo_channels
(braket
id|minor
)braket
dot
id|uc_no_upcall
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef PSDEV_DEBUG
r_case
id|PSDEV_ERRORVAL
suffix:colon
(brace
r_int
id|errorval
op_assign
id|izo_channels
(braket
id|minor
)braket
dot
id|uc_errorval
suffix:semicolon
r_if
c_cond
(paren
id|errorval
OL
l_int|0
op_logical_and
id|is_read_only
c_func
(paren
op_minus
id|errorval
)paren
)paren
id|CERROR
c_func
(paren
l_string|&quot;device %s has been set read-only&bslash;n&quot;
comma
id|kdevname
c_func
(paren
op_minus
id|errorval
)paren
)paren
suffix:semicolon
id|opt-&gt;optval
op_assign
id|izo_channels
(braket
id|minor
)braket
dot
id|uc_errorval
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#endif
r_case
id|PSDEV_TRACE
suffix:colon
r_case
id|PSDEV_DEBUG
suffix:colon
r_case
id|PSDEV_BYTES_TO_CLOSE
suffix:colon
r_default
suffix:colon
id|CDEBUG
c_func
(paren
id|D_PSDEV
comma
l_string|&quot;ioctl: dogetopt: minor %d, bad optval 0x%x, &bslash;n&quot;
comma
id|minor
comma
id|opt-&gt;optname
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|EXIT
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* allocate the tables for the presto devices. We need&n; * sizeof(proto_channel_table)/sizeof(proto_channel_table[0])&n; * entries for each dev&n; */
DECL|function|init_intermezzo_sysctl
r_int
multiline_comment|/* __init */
id|init_intermezzo_sysctl
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|total_dev
op_assign
id|MAX_CHANNEL
suffix:semicolon
r_int
id|entries_per_dev
op_assign
r_sizeof
(paren
id|proto_psdev_table
)paren
op_div
r_sizeof
(paren
id|proto_psdev_table
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_int
id|total_entries
op_assign
id|entries_per_dev
op_star
id|total_dev
suffix:semicolon
id|ctl_table
op_star
id|dev_ctl_table
suffix:semicolon
id|PRESTO_ALLOC
c_func
(paren
id|dev_ctl_table
comma
r_sizeof
(paren
id|ctl_table
)paren
op_star
id|total_entries
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev_ctl_table
)paren
(brace
id|CERROR
c_func
(paren
l_string|&quot;WARNING: presto couldn&squot;t allocate dev_ctl_table&bslash;n&quot;
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* now fill in the entries ... we put the individual presto&lt;x&gt;&n;&t; * entries at the end of the table, and the per-presto stuff&n;&t; * starting at the front.  We assume that the compiler makes&n;&t; * this code more efficient, but really, who cares ... it&n;&t; * happens once per reboot.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|total_dev
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* entry for this /proc/sys/intermezzo/intermezzo&quot;i&quot; */
id|ctl_table
op_star
id|psdev
op_assign
op_amp
id|presto_table
(braket
id|i
op_plus
id|PRESTO_PRIMARY_CTLCNT
)braket
suffix:semicolon
multiline_comment|/* entries for the individual &quot;files&quot; in this &quot;directory&quot; */
id|ctl_table
op_star
id|psdev_entries
op_assign
op_amp
id|dev_ctl_table
(braket
id|i
op_star
id|entries_per_dev
)braket
suffix:semicolon
multiline_comment|/* init the psdev and psdev_entries with the prototypes */
op_star
id|psdev
op_assign
id|proto_channel_entry
suffix:semicolon
id|memcpy
c_func
(paren
id|psdev_entries
comma
id|proto_psdev_table
comma
r_sizeof
(paren
id|proto_psdev_table
)paren
)paren
suffix:semicolon
multiline_comment|/* now specialize them ... */
multiline_comment|/* the psdev has to point to psdev_entries, and fix the number */
id|psdev-&gt;ctl_name
op_assign
id|psdev-&gt;ctl_name
op_plus
id|i
op_plus
l_int|1
suffix:semicolon
multiline_comment|/* sorry */
id|PRESTO_ALLOC
c_func
(paren
(paren
r_void
op_star
)paren
id|psdev-&gt;procname
comma
id|PROCNAME_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|psdev-&gt;procname
)paren
(brace
id|PRESTO_FREE
c_func
(paren
id|dev_ctl_table
comma
r_sizeof
(paren
id|ctl_table
)paren
op_star
id|total_entries
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|sprintf
c_func
(paren
(paren
r_char
op_star
)paren
id|psdev-&gt;procname
comma
l_string|&quot;intermezzo%d&quot;
comma
id|i
)paren
suffix:semicolon
multiline_comment|/* hook presto into */
id|psdev-&gt;child
op_assign
id|psdev_entries
suffix:semicolon
multiline_comment|/* now for each psdev entry ... */
id|psdev_entries
(braket
l_int|0
)braket
dot
id|data
op_assign
op_amp
(paren
id|izo_channels
(braket
id|i
)braket
dot
id|uc_hard
)paren
suffix:semicolon
id|psdev_entries
(braket
l_int|1
)braket
dot
id|data
op_assign
op_amp
(paren
id|izo_channels
(braket
id|i
)braket
dot
id|uc_no_filter
)paren
suffix:semicolon
id|psdev_entries
(braket
l_int|2
)braket
dot
id|data
op_assign
op_amp
(paren
id|izo_channels
(braket
id|i
)braket
dot
id|uc_no_journal
)paren
suffix:semicolon
id|psdev_entries
(braket
l_int|3
)braket
dot
id|data
op_assign
op_amp
(paren
id|izo_channels
(braket
id|i
)braket
dot
id|uc_no_upcall
)paren
suffix:semicolon
id|psdev_entries
(braket
l_int|4
)braket
dot
id|data
op_assign
op_amp
(paren
id|izo_channels
(braket
id|i
)braket
dot
id|uc_timeout
)paren
suffix:semicolon
macro_line|#ifdef PRESTO_DEBUG
id|psdev_entries
(braket
l_int|5
)braket
dot
id|data
op_assign
op_amp
(paren
id|izo_channels
(braket
id|i
)braket
dot
id|uc_errorval
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#ifdef CONFIG_SYSCTL
r_if
c_cond
(paren
op_logical_neg
id|intermezzo_table_header
)paren
id|intermezzo_table_header
op_assign
id|register_sysctl_table
c_func
(paren
id|intermezzo_table
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PROC_FS
id|proc_fs_intermezzo
op_assign
id|proc_mkdir
c_func
(paren
l_string|&quot;intermezzo&quot;
comma
id|proc_root_fs
)paren
suffix:semicolon
id|proc_fs_intermezzo-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
id|create_proc_info_entry
c_func
(paren
l_string|&quot;mounts&quot;
comma
l_int|0
comma
id|proc_fs_intermezzo
comma
id|intermezzo_mount_get_info
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cleanup_intermezzo_sysctl
r_void
id|cleanup_intermezzo_sysctl
c_func
(paren
r_void
)paren
(brace
r_int
id|total_dev
op_assign
id|MAX_CHANNEL
suffix:semicolon
r_int
id|entries_per_dev
op_assign
r_sizeof
(paren
id|proto_psdev_table
)paren
op_div
r_sizeof
(paren
id|proto_psdev_table
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_int
id|total_entries
op_assign
id|entries_per_dev
op_star
id|total_dev
suffix:semicolon
r_int
id|i
suffix:semicolon
macro_line|#ifdef CONFIG_SYSCTL
r_if
c_cond
(paren
id|intermezzo_table_header
)paren
id|unregister_sysctl_table
c_func
(paren
id|intermezzo_table_header
)paren
suffix:semicolon
id|intermezzo_table_header
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|total_dev
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* entry for this /proc/sys/intermezzo/intermezzo&quot;i&quot; */
id|ctl_table
op_star
id|psdev
op_assign
op_amp
id|presto_table
(braket
id|i
op_plus
id|PRESTO_PRIMARY_CTLCNT
)braket
suffix:semicolon
id|PRESTO_FREE
c_func
(paren
id|psdev-&gt;procname
comma
id|PROCNAME_SIZE
)paren
suffix:semicolon
)brace
multiline_comment|/* presto_table[PRESTO_PRIMARY_CTLCNT].child points to the&n;&t; * dev_ctl_table previously allocated in init_intermezzo_psdev()&n;&t; */
id|PRESTO_FREE
c_func
(paren
id|presto_table
(braket
id|PRESTO_PRIMARY_CTLCNT
)braket
dot
id|child
comma
r_sizeof
(paren
id|ctl_table
)paren
op_star
id|total_entries
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PROC_FS
id|remove_proc_entry
c_func
(paren
l_string|&quot;mounts&quot;
comma
id|proc_fs_intermezzo
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;intermezzo&quot;
comma
id|proc_root_fs
)paren
suffix:semicolon
macro_line|#endif
)brace
eof
