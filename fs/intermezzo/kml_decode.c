multiline_comment|/*&n; * KML Decoding&n; *&n; * Copryright (C) 1996 Arthur Ma &lt;arthur.ma@mountainviewdata.com&gt; &n; *&n; * Copyright (C) 2001 Mountainview Data, Inc.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &quot;intermezzo_fs.h&quot;
macro_line|#include &quot;intermezzo_kml.h&quot;
r_static
r_int
id|size_round
(paren
r_int
id|val
)paren
suffix:semicolon
r_static
r_int
id|unpack_create
(paren
r_struct
id|kml_create
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
suffix:semicolon
r_static
r_int
id|unpack_open
(paren
r_struct
id|kml_open
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
suffix:semicolon
r_static
r_int
id|unpack_symlink
(paren
r_struct
id|kml_symlink
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
suffix:semicolon
r_static
r_int
id|unpack_mknod
(paren
r_struct
id|kml_mknod
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
suffix:semicolon
r_static
r_int
id|unpack_link
(paren
r_struct
id|kml_link
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
suffix:semicolon
r_static
r_int
id|unpack_rename
(paren
r_struct
id|kml_rename
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
suffix:semicolon
r_static
r_int
id|unpack_unlink
(paren
r_struct
id|kml_unlink
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
suffix:semicolon
r_static
r_int
id|unpack_rmdir
(paren
r_struct
id|kml_rmdir
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
suffix:semicolon
r_static
r_int
id|unpack_setattr
(paren
r_struct
id|kml_setattr
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
suffix:semicolon
r_static
r_int
id|unpack_close
(paren
r_struct
id|kml_close
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
suffix:semicolon
r_static
r_int
id|unpack_mkdir
(paren
r_struct
id|kml_mkdir
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
suffix:semicolon
macro_line|#if 0
r_static
r_int
id|unpack_endmark
(paren
r_struct
id|kml_endmark
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
suffix:semicolon
r_static
r_void
id|print_kml_endmark
(paren
r_struct
id|kml_endmark
op_star
id|rec
)paren
suffix:semicolon
macro_line|#endif
r_static
r_int
id|kml_unpack
(paren
r_char
op_star
id|kml_buf
comma
r_int
id|rec_size
comma
r_int
id|kml_offset
comma
r_struct
id|kml_rec
op_star
op_star
id|newrec
)paren
suffix:semicolon
r_static
r_char
op_star
id|kml_version
(paren
r_struct
id|presto_version
op_star
id|ver
)paren
suffix:semicolon
r_static
r_void
id|print_kml_prefix
(paren
r_struct
id|big_journal_prefix
op_star
id|head
)paren
suffix:semicolon
r_static
r_void
id|print_kml_create
(paren
r_struct
id|kml_create
op_star
id|rec
)paren
suffix:semicolon
r_static
r_void
id|print_kml_mkdir
(paren
r_struct
id|kml_mkdir
op_star
id|rec
)paren
suffix:semicolon
r_static
r_void
id|print_kml_unlink
(paren
r_struct
id|kml_unlink
op_star
id|rec
)paren
suffix:semicolon
r_static
r_void
id|print_kml_rmdir
(paren
r_struct
id|kml_rmdir
op_star
id|rec
)paren
suffix:semicolon
r_static
r_void
id|print_kml_close
(paren
r_struct
id|kml_close
op_star
id|rec
)paren
suffix:semicolon
r_static
r_void
id|print_kml_symlink
(paren
r_struct
id|kml_symlink
op_star
id|rec
)paren
suffix:semicolon
r_static
r_void
id|print_kml_rename
(paren
r_struct
id|kml_rename
op_star
id|rec
)paren
suffix:semicolon
r_static
r_void
id|print_kml_setattr
(paren
r_struct
id|kml_setattr
op_star
id|rec
)paren
suffix:semicolon
r_static
r_void
id|print_kml_link
(paren
r_struct
id|kml_link
op_star
id|rec
)paren
suffix:semicolon
r_static
r_void
id|print_kml_mknod
(paren
r_struct
id|kml_mknod
op_star
id|rec
)paren
suffix:semicolon
r_static
r_void
id|print_kml_open
(paren
r_struct
id|kml_open
op_star
id|rec
)paren
suffix:semicolon
r_static
r_void
id|print_kml_suffix
(paren
r_struct
id|journal_suffix
op_star
id|tail
)paren
suffix:semicolon
r_static
r_char
op_star
id|readrec
(paren
r_char
op_star
id|recbuf
comma
r_int
id|reclen
comma
r_int
id|pos
comma
r_int
op_star
id|size
)paren
suffix:semicolon
DECL|macro|KML_PREFIX_WORDS
mdefine_line|#define  KML_PREFIX_WORDS           8
DECL|function|kml_unpack
r_static
r_int
id|kml_unpack
(paren
r_char
op_star
id|kml_buf
comma
r_int
id|rec_size
comma
r_int
id|kml_offset
comma
r_struct
id|kml_rec
op_star
op_star
id|newrec
)paren
(brace
r_struct
id|kml_rec
op_star
id|rec
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_int
id|pos
comma
id|rec_offs
suffix:semicolon
r_int
id|error
suffix:semicolon
id|ENTRY
suffix:semicolon
r_if
c_cond
(paren
id|rec_size
OL
r_sizeof
(paren
r_struct
id|journal_prefix
)paren
op_plus
r_sizeof
(paren
r_struct
id|journal_suffix
)paren
)paren
r_return
op_minus
id|EBADF
suffix:semicolon
id|PRESTO_ALLOC
c_func
(paren
id|rec
comma
r_struct
id|kml_rec
op_star
comma
r_sizeof
(paren
r_struct
id|kml_rec
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rec
op_eq
l_int|NULL
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|rec-&gt;rec_kml_offset
op_assign
id|kml_offset
suffix:semicolon
id|rec-&gt;rec_size
op_assign
id|rec_size
suffix:semicolon
id|p
op_assign
id|kml_buf
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;rec_head
comma
id|p
comma
id|KML_PREFIX_WORDS
op_star
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;rec_head.groups
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
op_star
id|rec-&gt;rec_head.ngroups
)paren
suffix:semicolon
id|pos
op_assign
r_sizeof
(paren
r_struct
id|journal_prefix
)paren
op_plus
r_sizeof
(paren
r_int
)paren
op_star
id|rec-&gt;rec_head.ngroups
suffix:semicolon
r_switch
c_cond
(paren
id|rec-&gt;rec_head.opcode
)paren
(brace
r_case
id|KML_CREATE
suffix:colon
id|error
op_assign
id|unpack_create
(paren
op_amp
id|rec-&gt;rec_kml.create
comma
id|kml_buf
comma
id|pos
comma
op_amp
id|rec_offs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_MKDIR
suffix:colon
id|error
op_assign
id|unpack_mkdir
(paren
op_amp
id|rec-&gt;rec_kml.mkdir
comma
id|kml_buf
comma
id|pos
comma
op_amp
id|rec_offs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_UNLINK
suffix:colon
id|error
op_assign
id|unpack_unlink
(paren
op_amp
id|rec-&gt;rec_kml.unlink
comma
id|kml_buf
comma
id|pos
comma
op_amp
id|rec_offs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_RMDIR
suffix:colon
id|error
op_assign
id|unpack_rmdir
(paren
op_amp
id|rec-&gt;rec_kml.rmdir
comma
id|kml_buf
comma
id|pos
comma
op_amp
id|rec_offs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_CLOSE
suffix:colon
id|error
op_assign
id|unpack_close
(paren
op_amp
id|rec-&gt;rec_kml.close
comma
id|kml_buf
comma
id|pos
comma
op_amp
id|rec_offs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_SYMLINK
suffix:colon
id|error
op_assign
id|unpack_symlink
(paren
op_amp
id|rec-&gt;rec_kml.symlink
comma
id|kml_buf
comma
id|pos
comma
op_amp
id|rec_offs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_RENAME
suffix:colon
id|error
op_assign
id|unpack_rename
(paren
op_amp
id|rec-&gt;rec_kml.rename
comma
id|kml_buf
comma
id|pos
comma
op_amp
id|rec_offs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_SETATTR
suffix:colon
id|error
op_assign
id|unpack_setattr
(paren
op_amp
id|rec-&gt;rec_kml.setattr
comma
id|kml_buf
comma
id|pos
comma
op_amp
id|rec_offs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_LINK
suffix:colon
id|error
op_assign
id|unpack_link
(paren
op_amp
id|rec-&gt;rec_kml.link
comma
id|kml_buf
comma
id|pos
comma
op_amp
id|rec_offs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_OPEN
suffix:colon
id|error
op_assign
id|unpack_open
(paren
op_amp
id|rec-&gt;rec_kml.open
comma
id|kml_buf
comma
id|pos
comma
op_amp
id|rec_offs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_MKNOD
suffix:colon
id|error
op_assign
id|unpack_mknod
(paren
op_amp
id|rec-&gt;rec_kml.mknod
comma
id|kml_buf
comma
id|pos
comma
op_amp
id|rec_offs
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if 0
r_case
id|KML_ENDMARK
suffix:colon
id|error
op_assign
id|unpack_endmark
(paren
op_amp
id|rec-&gt;rec_kml.endmark
comma
id|kml_buf
comma
id|pos
comma
op_amp
id|rec_offs
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;wrong opcode::%u&bslash;n&quot;
comma
id|rec-&gt;rec_head.opcode
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|error
)paren
(brace
id|PRESTO_FREE
(paren
id|rec
comma
r_sizeof
(paren
r_struct
id|kml_rec
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|p
op_assign
id|kml_buf
op_plus
id|rec_offs
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;rec_tail
comma
id|p
comma
r_sizeof
(paren
r_struct
id|journal_suffix
)paren
)paren
suffix:semicolon
id|memset
(paren
op_amp
id|rec-&gt;kml_optimize
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|kml_optimize
)paren
)paren
suffix:semicolon
op_star
id|newrec
op_assign
id|rec
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|size_round
r_static
r_int
id|size_round
(paren
r_int
id|val
)paren
(brace
r_return
(paren
id|val
op_plus
l_int|3
)paren
op_amp
(paren
op_complement
l_int|0x3
)paren
suffix:semicolon
)brace
DECL|function|unpack_create
r_static
r_int
id|unpack_create
(paren
r_struct
id|kml_create
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
(brace
r_char
op_star
id|p
comma
op_star
id|q
suffix:semicolon
r_int
id|unpack_size
op_assign
l_int|88
suffix:semicolon
r_int
id|pathlen
suffix:semicolon
id|ENTRY
suffix:semicolon
id|p
op_assign
id|buf
op_plus
id|pos
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;old_parentv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;new_parentv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;new_objectv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;mode
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;uid
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;gid
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|pathlen
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|PRESTO_ALLOC
c_func
(paren
id|q
comma
r_char
op_star
comma
id|pathlen
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
op_eq
l_int|NULL
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memcpy
(paren
id|q
comma
id|p
comma
id|pathlen
)paren
suffix:semicolon
id|q
(braket
id|pathlen
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|rec-&gt;path
op_assign
id|q
suffix:semicolon
op_star
id|rec_offs
op_assign
id|pos
op_plus
id|unpack_size
op_plus
id|size_round
c_func
(paren
id|pathlen
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|unpack_open
r_static
r_int
id|unpack_open
(paren
r_struct
id|kml_open
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
(brace
op_star
id|rec_offs
op_assign
id|pos
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|unpack_symlink
r_static
r_int
id|unpack_symlink
(paren
r_struct
id|kml_symlink
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
(brace
r_char
op_star
id|p
comma
op_star
id|q
suffix:semicolon
r_int
id|unpack_size
op_assign
l_int|88
suffix:semicolon
r_int
id|pathlen
comma
id|targetlen
suffix:semicolon
id|ENTRY
suffix:semicolon
id|p
op_assign
id|buf
op_plus
id|pos
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;old_parentv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;new_parentv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;new_objectv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;uid
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;gid
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|pathlen
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|targetlen
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|PRESTO_ALLOC
c_func
(paren
id|q
comma
r_char
op_star
comma
id|pathlen
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
op_eq
l_int|NULL
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memcpy
(paren
id|q
comma
id|p
comma
id|pathlen
)paren
suffix:semicolon
id|q
(braket
id|pathlen
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|rec-&gt;sourcepath
op_assign
id|q
suffix:semicolon
id|PRESTO_ALLOC
c_func
(paren
id|q
comma
r_char
op_star
comma
id|targetlen
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
op_eq
l_int|NULL
)paren
(brace
id|PRESTO_FREE
(paren
id|rec-&gt;sourcepath
comma
id|pathlen
op_plus
l_int|1
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memcpy
(paren
id|q
comma
id|p
comma
id|targetlen
)paren
suffix:semicolon
id|q
(braket
id|targetlen
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|rec-&gt;targetpath
op_assign
id|q
suffix:semicolon
op_star
id|rec_offs
op_assign
id|pos
op_plus
id|unpack_size
op_plus
id|size_round
c_func
(paren
id|pathlen
)paren
op_plus
id|size_round
c_func
(paren
id|targetlen
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|unpack_mknod
r_static
r_int
id|unpack_mknod
(paren
r_struct
id|kml_mknod
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
(brace
r_char
op_star
id|p
comma
op_star
id|q
suffix:semicolon
r_int
id|unpack_size
op_assign
l_int|96
suffix:semicolon
r_int
id|pathlen
suffix:semicolon
id|ENTRY
suffix:semicolon
id|p
op_assign
id|buf
op_plus
id|pos
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;old_parentv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;new_parentv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;new_objectv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;mode
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;uid
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;gid
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;major
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;minor
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|pathlen
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|PRESTO_ALLOC
c_func
(paren
id|q
comma
r_char
op_star
comma
id|pathlen
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
op_eq
l_int|NULL
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memcpy
(paren
id|q
comma
id|p
comma
id|pathlen
)paren
suffix:semicolon
id|q
(braket
id|pathlen
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|rec-&gt;path
op_assign
id|q
suffix:semicolon
op_star
id|rec_offs
op_assign
id|pos
op_plus
id|unpack_size
op_plus
id|size_round
c_func
(paren
id|pathlen
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|unpack_link
r_static
r_int
id|unpack_link
(paren
r_struct
id|kml_link
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
(brace
r_char
op_star
id|p
comma
op_star
id|q
suffix:semicolon
r_int
id|unpack_size
op_assign
l_int|80
suffix:semicolon
r_int
id|pathlen
comma
id|targetlen
suffix:semicolon
id|ENTRY
suffix:semicolon
id|p
op_assign
id|buf
op_plus
id|pos
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;old_parentv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;new_parentv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;new_objectv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|pathlen
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|targetlen
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|PRESTO_ALLOC
c_func
(paren
id|q
comma
r_char
op_star
comma
id|pathlen
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
op_eq
l_int|NULL
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memcpy
(paren
id|q
comma
id|p
comma
id|pathlen
)paren
suffix:semicolon
id|q
(braket
id|pathlen
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|rec-&gt;sourcepath
op_assign
id|q
suffix:semicolon
id|p
op_add_assign
id|size_round
(paren
id|pathlen
)paren
suffix:semicolon
id|PRESTO_ALLOC
c_func
(paren
id|q
comma
r_char
op_star
comma
id|targetlen
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
op_eq
l_int|NULL
)paren
(brace
id|PRESTO_FREE
(paren
id|rec-&gt;sourcepath
comma
id|pathlen
op_plus
l_int|1
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memcpy
(paren
id|q
comma
id|p
comma
id|targetlen
)paren
suffix:semicolon
id|q
(braket
id|targetlen
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|rec-&gt;targetpath
op_assign
id|q
suffix:semicolon
op_star
id|rec_offs
op_assign
id|pos
op_plus
id|unpack_size
op_plus
id|size_round
c_func
(paren
id|pathlen
)paren
op_plus
id|size_round
c_func
(paren
id|targetlen
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|unpack_rename
r_static
r_int
id|unpack_rename
(paren
r_struct
id|kml_rename
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
(brace
r_char
op_star
id|p
comma
op_star
id|q
suffix:semicolon
r_int
id|unpack_size
op_assign
l_int|104
suffix:semicolon
r_int
id|pathlen
comma
id|targetlen
suffix:semicolon
id|ENTRY
suffix:semicolon
id|p
op_assign
id|buf
op_plus
id|pos
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;old_objectv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;new_objectv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;new_tgtv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;old_tgtv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|pathlen
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|targetlen
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|PRESTO_ALLOC
c_func
(paren
id|q
comma
r_char
op_star
comma
id|pathlen
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
op_eq
l_int|NULL
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memcpy
(paren
id|q
comma
id|p
comma
id|pathlen
)paren
suffix:semicolon
id|q
(braket
id|pathlen
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|rec-&gt;sourcepath
op_assign
id|q
suffix:semicolon
id|p
op_add_assign
id|size_round
(paren
id|pathlen
)paren
suffix:semicolon
id|PRESTO_ALLOC
c_func
(paren
id|q
comma
r_char
op_star
comma
id|targetlen
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
op_eq
l_int|NULL
)paren
(brace
id|PRESTO_FREE
(paren
id|rec-&gt;sourcepath
comma
id|pathlen
op_plus
l_int|1
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memcpy
(paren
id|q
comma
id|p
comma
id|targetlen
)paren
suffix:semicolon
id|q
(braket
id|targetlen
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|rec-&gt;targetpath
op_assign
id|q
suffix:semicolon
op_star
id|rec_offs
op_assign
id|pos
op_plus
id|unpack_size
op_plus
id|size_round
c_func
(paren
id|pathlen
)paren
op_plus
id|size_round
c_func
(paren
id|targetlen
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|unpack_unlink
r_static
r_int
id|unpack_unlink
(paren
r_struct
id|kml_unlink
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
(brace
r_char
op_star
id|p
comma
op_star
id|q
suffix:semicolon
r_int
id|unpack_size
op_assign
l_int|80
suffix:semicolon
r_int
id|pathlen
comma
id|targetlen
suffix:semicolon
id|ENTRY
suffix:semicolon
id|p
op_assign
id|buf
op_plus
id|pos
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;old_parentv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;new_parentv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;old_tgtv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|pathlen
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|targetlen
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|PRESTO_ALLOC
c_func
(paren
id|q
comma
r_char
op_star
comma
id|pathlen
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
op_eq
l_int|NULL
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memcpy
(paren
id|q
comma
id|p
comma
id|pathlen
)paren
suffix:semicolon
id|q
(braket
id|pathlen
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|rec-&gt;path
op_assign
id|q
suffix:semicolon
id|p
op_add_assign
id|size_round
(paren
id|pathlen
)paren
suffix:semicolon
id|PRESTO_ALLOC
c_func
(paren
id|q
comma
r_char
op_star
comma
id|targetlen
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
op_eq
l_int|NULL
)paren
(brace
id|PRESTO_FREE
(paren
id|rec-&gt;path
comma
id|pathlen
op_plus
l_int|1
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memcpy
(paren
id|q
comma
id|p
comma
id|targetlen
)paren
suffix:semicolon
id|q
(braket
id|targetlen
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|rec-&gt;name
op_assign
id|q
suffix:semicolon
multiline_comment|/* fix the presto_journal_unlink problem */
op_star
id|rec_offs
op_assign
id|pos
op_plus
id|unpack_size
op_plus
id|size_round
c_func
(paren
id|pathlen
)paren
op_plus
id|size_round
c_func
(paren
id|targetlen
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|unpack_rmdir
r_static
r_int
id|unpack_rmdir
(paren
r_struct
id|kml_rmdir
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
(brace
r_char
op_star
id|p
comma
op_star
id|q
suffix:semicolon
r_int
id|unpack_size
op_assign
l_int|80
suffix:semicolon
r_int
id|pathlen
comma
id|targetlen
suffix:semicolon
id|ENTRY
suffix:semicolon
id|p
op_assign
id|buf
op_plus
id|pos
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;old_parentv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;new_parentv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;old_tgtv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|pathlen
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|targetlen
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|PRESTO_ALLOC
c_func
(paren
id|q
comma
r_char
op_star
comma
id|pathlen
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
op_eq
l_int|NULL
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memcpy
(paren
id|q
comma
id|p
comma
id|pathlen
)paren
suffix:semicolon
id|q
(braket
id|pathlen
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|rec-&gt;path
op_assign
id|q
suffix:semicolon
id|p
op_add_assign
id|size_round
(paren
id|pathlen
)paren
suffix:semicolon
id|PRESTO_ALLOC
c_func
(paren
id|q
comma
r_char
op_star
comma
id|targetlen
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
op_eq
l_int|NULL
)paren
(brace
id|PRESTO_FREE
(paren
id|rec-&gt;path
comma
id|pathlen
op_plus
l_int|1
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memcpy
(paren
id|q
comma
id|p
comma
id|targetlen
)paren
suffix:semicolon
id|q
(braket
id|targetlen
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|rec-&gt;name
op_assign
id|q
suffix:semicolon
op_star
id|rec_offs
op_assign
id|pos
op_plus
id|unpack_size
op_plus
id|size_round
c_func
(paren
id|pathlen
)paren
op_plus
id|size_round
c_func
(paren
id|targetlen
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|unpack_setattr
r_static
r_int
id|unpack_setattr
(paren
r_struct
id|kml_setattr
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
(brace
r_char
op_star
id|p
comma
op_star
id|q
suffix:semicolon
r_int
id|unpack_size
op_assign
l_int|72
suffix:semicolon
r_struct
id|kml_attr
(brace
id|__u64
id|size
comma
id|mtime
comma
id|ctime
suffix:semicolon
)brace
id|objattr
suffix:semicolon
r_int
id|valid
comma
id|mode
comma
id|uid
comma
id|gid
comma
id|flags
suffix:semicolon
r_int
id|pathlen
suffix:semicolon
id|ENTRY
suffix:semicolon
id|p
op_assign
id|buf
op_plus
id|pos
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;old_objectv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|valid
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|mode
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|uid
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|gid
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|objattr
comma
id|p
comma
r_sizeof
(paren
r_struct
id|kml_attr
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|flags
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|pathlen
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|rec-&gt;iattr.ia_valid
op_assign
id|valid
suffix:semicolon
id|rec-&gt;iattr.ia_mode
op_assign
id|mode
suffix:semicolon
id|rec-&gt;iattr.ia_uid
op_assign
id|uid
suffix:semicolon
id|rec-&gt;iattr.ia_gid
op_assign
id|gid
suffix:semicolon
id|rec-&gt;iattr.ia_size
op_assign
id|objattr.size
suffix:semicolon
id|rec-&gt;iattr.ia_mtime
op_assign
id|objattr.mtime
suffix:semicolon
id|rec-&gt;iattr.ia_ctime
op_assign
id|objattr.ctime
suffix:semicolon
id|rec-&gt;iattr.ia_atime
op_assign
l_int|0
suffix:semicolon
id|rec-&gt;iattr.ia_attr_flags
op_assign
id|flags
suffix:semicolon
id|PRESTO_ALLOC
c_func
(paren
id|q
comma
r_char
op_star
comma
id|pathlen
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
op_eq
l_int|NULL
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memcpy
(paren
id|q
comma
id|p
comma
id|pathlen
)paren
suffix:semicolon
id|q
(braket
id|pathlen
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|rec-&gt;path
op_assign
id|q
suffix:semicolon
id|p
op_add_assign
id|pathlen
suffix:semicolon
op_star
id|rec_offs
op_assign
id|pos
op_plus
id|unpack_size
op_plus
id|size_round
c_func
(paren
id|pathlen
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|unpack_close
r_static
r_int
id|unpack_close
(paren
r_struct
id|kml_close
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
(brace
r_char
op_star
id|p
comma
op_star
id|q
suffix:semicolon
r_int
id|unpack_size
op_assign
l_int|52
suffix:semicolon
r_int
id|pathlen
suffix:semicolon
id|ENTRY
suffix:semicolon
id|p
op_assign
id|buf
op_plus
id|pos
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;open_mode
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;open_uid
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;open_gid
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;new_objectv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;ino
comma
id|p
comma
r_sizeof
(paren
id|__u64
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;generation
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|pathlen
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|PRESTO_ALLOC
c_func
(paren
id|q
comma
r_char
op_star
comma
id|pathlen
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
op_eq
l_int|NULL
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memcpy
(paren
id|q
comma
id|p
comma
id|pathlen
)paren
suffix:semicolon
id|q
(braket
id|pathlen
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|rec-&gt;path
op_assign
id|q
suffix:semicolon
id|p
op_add_assign
id|pathlen
suffix:semicolon
op_star
id|rec_offs
op_assign
id|pos
op_plus
id|unpack_size
op_plus
id|size_round
c_func
(paren
id|pathlen
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|unpack_mkdir
r_static
r_int
id|unpack_mkdir
(paren
r_struct
id|kml_mkdir
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
(brace
r_char
op_star
id|p
comma
op_star
id|q
suffix:semicolon
r_int
id|unpack_size
op_assign
l_int|88
suffix:semicolon
r_int
id|pathlen
suffix:semicolon
id|ENTRY
suffix:semicolon
id|p
op_assign
id|buf
op_plus
id|pos
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;old_parentv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;new_parentv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;new_objectv
comma
id|p
comma
r_sizeof
(paren
r_struct
id|presto_version
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;mode
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;uid
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;gid
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|pathlen
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|PRESTO_ALLOC
c_func
(paren
id|q
comma
r_char
op_star
comma
id|pathlen
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q
op_eq
l_int|NULL
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memcpy
(paren
id|q
comma
id|p
comma
id|pathlen
)paren
suffix:semicolon
id|q
(braket
id|pathlen
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|rec-&gt;path
op_assign
id|q
suffix:semicolon
id|p
op_add_assign
id|pathlen
suffix:semicolon
op_star
id|rec_offs
op_assign
id|pos
op_plus
id|unpack_size
op_plus
id|size_round
c_func
(paren
id|pathlen
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_int
id|unpack_endmark
(paren
r_struct
id|kml_endmark
op_star
id|rec
comma
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
op_star
id|rec_offs
)paren
(brace
r_char
op_star
id|p
suffix:semicolon
id|p
op_assign
id|buf
op_plus
id|pos
suffix:semicolon
id|p
op_assign
id|dlogit
(paren
op_amp
id|rec-&gt;total
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|PRESTO_ALLOC
(paren
id|rec-&gt;kop
comma
r_struct
id|kml_kop_node
op_star
comma
r_sizeof
(paren
r_struct
id|kml_kop_node
)paren
op_star
id|rec-&gt;total
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rec-&gt;kop
op_eq
l_int|NULL
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|p
op_assign
id|dlogit
(paren
id|rec-&gt;kop
comma
id|p
comma
r_sizeof
(paren
r_struct
id|kml_kop_node
)paren
op_star
id|rec-&gt;total
)paren
suffix:semicolon
op_star
id|rec_offs
op_assign
id|pos
op_plus
r_sizeof
(paren
r_int
)paren
op_plus
r_sizeof
(paren
r_struct
id|kml_kop_node
)paren
op_star
id|rec-&gt;total
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|function|kml_version
r_static
r_char
op_star
id|kml_version
(paren
r_struct
id|presto_version
op_star
id|ver
)paren
(brace
r_static
r_char
id|buf
(braket
l_int|256
)braket
suffix:semicolon
id|sprintf
(paren
id|buf
comma
l_string|&quot;mt::%lld, ct::%lld, size::%lld&quot;
comma
id|ver-&gt;pv_mtime
comma
id|ver-&gt;pv_ctime
comma
id|ver-&gt;pv_size
)paren
suffix:semicolon
r_return
id|buf
suffix:semicolon
)brace
DECL|function|print_kml_prefix
r_static
r_void
id|print_kml_prefix
(paren
r_struct
id|big_journal_prefix
op_star
id|head
)paren
(brace
r_int
id|i
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot; === KML PREFIX&bslash;n&quot;
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     len        = %u&bslash;n&quot;
comma
id|head-&gt;len
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     version    = %u&bslash;n&quot;
comma
id|head-&gt;version
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     pid        = %u&bslash;n&quot;
comma
id|head-&gt;pid
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     uid        = %u&bslash;n&quot;
comma
id|head-&gt;uid
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     fsuid      = %u&bslash;n&quot;
comma
id|head-&gt;fsuid
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     fsgid      = %u&bslash;n&quot;
comma
id|head-&gt;fsgid
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     opcode     = %u&bslash;n&quot;
comma
id|head-&gt;opcode
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     ngroup     = %u&quot;
comma
id|head-&gt;ngroups
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|head-&gt;ngroups
suffix:semicolon
id|i
op_increment
)paren
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;%u  &quot;
comma
id|head-&gt;groups
(braket
id|i
)braket
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|print_kml_create
r_static
r_void
id|print_kml_create
(paren
r_struct
id|kml_create
op_star
id|rec
)paren
(brace
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot; === CREATE&bslash;n&quot;
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     path::%s&bslash;n&quot;
comma
id|rec-&gt;path
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     new_objv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;new_objectv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     old_parv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;old_parentv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     new_parv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;new_parentv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     mode::%o&bslash;n&quot;
comma
id|rec-&gt;mode
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     uid::%d&bslash;n&quot;
comma
id|rec-&gt;uid
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     gid::%d&bslash;n&quot;
comma
id|rec-&gt;gid
)paren
suffix:semicolon
)brace
DECL|function|print_kml_mkdir
r_static
r_void
id|print_kml_mkdir
(paren
r_struct
id|kml_mkdir
op_star
id|rec
)paren
(brace
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot; === MKDIR&bslash;n&quot;
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     path::%s&bslash;n&quot;
comma
id|rec-&gt;path
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     new_objv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;new_objectv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     old_parv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;old_parentv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     new_parv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;new_parentv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     mode::%o&bslash;n&quot;
comma
id|rec-&gt;mode
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     uid::%d&bslash;n&quot;
comma
id|rec-&gt;uid
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     gid::%d&bslash;n&quot;
comma
id|rec-&gt;gid
)paren
suffix:semicolon
)brace
DECL|function|print_kml_unlink
r_static
r_void
id|print_kml_unlink
(paren
r_struct
id|kml_unlink
op_star
id|rec
)paren
(brace
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot; === UNLINK&bslash;n&quot;
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     path::%s/%s&bslash;n&quot;
comma
id|rec-&gt;path
comma
id|rec-&gt;name
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     old_tgtv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;old_tgtv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     old_parv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;old_parentv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     new_parv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;new_parentv
)paren
)paren
suffix:semicolon
)brace
DECL|function|print_kml_rmdir
r_static
r_void
id|print_kml_rmdir
(paren
r_struct
id|kml_rmdir
op_star
id|rec
)paren
(brace
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot; === RMDIR&bslash;n&quot;
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     path::%s/%s&bslash;n&quot;
comma
id|rec-&gt;path
comma
id|rec-&gt;name
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     old_tgtv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;old_tgtv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     old_parv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;old_parentv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     new_parv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;new_parentv
)paren
)paren
suffix:semicolon
)brace
DECL|function|print_kml_close
r_static
r_void
id|print_kml_close
(paren
r_struct
id|kml_close
op_star
id|rec
)paren
(brace
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot; === CLOSE&bslash;n&quot;
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     mode::%o&bslash;n&quot;
comma
id|rec-&gt;open_mode
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     uid::%d&bslash;n&quot;
comma
id|rec-&gt;open_uid
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     gid::%d&bslash;n&quot;
comma
id|rec-&gt;open_gid
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     path::%s&bslash;n&quot;
comma
id|rec-&gt;path
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     new_objv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;new_objectv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     ino::%lld&bslash;n&quot;
comma
id|rec-&gt;ino
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     gen::%u&bslash;n&quot;
comma
id|rec-&gt;generation
)paren
suffix:semicolon
)brace
DECL|function|print_kml_symlink
r_static
r_void
id|print_kml_symlink
(paren
r_struct
id|kml_symlink
op_star
id|rec
)paren
(brace
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot; === SYMLINK&bslash;n&quot;
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     s-path::%s&bslash;n&quot;
comma
id|rec-&gt;sourcepath
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     t-path::%s&bslash;n&quot;
comma
id|rec-&gt;targetpath
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     old_parv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;old_parentv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     new_parv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;new_parentv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     new_objv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;new_objectv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     uid::%d&bslash;n&quot;
comma
id|rec-&gt;uid
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     gid::%d&bslash;n&quot;
comma
id|rec-&gt;gid
)paren
suffix:semicolon
)brace
DECL|function|print_kml_rename
r_static
r_void
id|print_kml_rename
(paren
r_struct
id|kml_rename
op_star
id|rec
)paren
(brace
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot; === RENAME&bslash;n&quot;
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     s-path::%s&bslash;n&quot;
comma
id|rec-&gt;sourcepath
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     t-path::%s&bslash;n&quot;
comma
id|rec-&gt;targetpath
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     old_tgtv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;old_tgtv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     new_tgtv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;new_tgtv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     new_objv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;new_objectv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     old_objv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;old_objectv
)paren
)paren
suffix:semicolon
)brace
DECL|function|print_kml_setattr
r_static
r_void
id|print_kml_setattr
(paren
r_struct
id|kml_setattr
op_star
id|rec
)paren
(brace
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot; === SETATTR&bslash;n&quot;
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     path::%s&bslash;n&quot;
comma
id|rec-&gt;path
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     old_objv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;old_objectv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     valid::0x%x&bslash;n&quot;
comma
id|rec-&gt;iattr.ia_valid
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     mode::%o&bslash;n&quot;
comma
id|rec-&gt;iattr.ia_mode
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     uid::%d&bslash;n&quot;
comma
id|rec-&gt;iattr.ia_uid
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     gid::%d&bslash;n&quot;
comma
id|rec-&gt;iattr.ia_gid
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     size::%u&bslash;n&quot;
comma
(paren
id|u32
)paren
id|rec-&gt;iattr.ia_size
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     mtime::%u&bslash;n&quot;
comma
(paren
id|u32
)paren
id|rec-&gt;iattr.ia_mtime
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     ctime::%u&bslash;n&quot;
comma
(paren
id|u32
)paren
id|rec-&gt;iattr.ia_ctime
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     flags::%u&bslash;n&quot;
comma
(paren
id|u32
)paren
id|rec-&gt;iattr.ia_attr_flags
)paren
suffix:semicolon
)brace
DECL|function|print_kml_link
r_static
r_void
id|print_kml_link
(paren
r_struct
id|kml_link
op_star
id|rec
)paren
(brace
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot; === LINK&bslash;n&quot;
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     path::%s ==&gt; %s&bslash;n&quot;
comma
id|rec-&gt;sourcepath
comma
id|rec-&gt;targetpath
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     old_parv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;old_parentv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     new_obj::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;new_objectv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     new_parv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;new_parentv
)paren
)paren
suffix:semicolon
)brace
DECL|function|print_kml_mknod
r_static
r_void
id|print_kml_mknod
(paren
r_struct
id|kml_mknod
op_star
id|rec
)paren
(brace
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot; === MKNOD&bslash;n&quot;
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     path::%s&bslash;n&quot;
comma
id|rec-&gt;path
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     new_obj::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;new_objectv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     old_parv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;old_parentv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     new_parv::%s&bslash;n&quot;
comma
id|kml_version
(paren
op_amp
id|rec-&gt;new_parentv
)paren
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     mode::%o&bslash;n&quot;
comma
id|rec-&gt;mode
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     uid::%d&bslash;n&quot;
comma
id|rec-&gt;uid
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     gid::%d&bslash;n&quot;
comma
id|rec-&gt;gid
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     major::%d&bslash;n&quot;
comma
id|rec-&gt;major
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     minor::%d&bslash;n&quot;
comma
id|rec-&gt;minor
)paren
suffix:semicolon
)brace
DECL|function|print_kml_open
r_static
r_void
id|print_kml_open
(paren
r_struct
id|kml_open
op_star
id|rec
)paren
(brace
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot; === OPEN&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_void
id|print_kml_endmark
(paren
r_struct
id|kml_endmark
op_star
id|rec
)paren
(brace
r_int
id|i
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot; === ENDMARK&bslash;n&quot;
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     total::%u&bslash;n&quot;
comma
id|rec-&gt;total
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|rec-&gt;total
suffix:semicolon
id|i
op_increment
)paren
(brace
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;         recno=%ld::flag=%ld,op=%ld, i_ino=%ld, &bslash;&n;                        i_nlink=%ld&bslash;n&quot;
comma
(paren
r_int
)paren
id|rec-&gt;kop
(braket
id|i
)braket
dot
id|kml_recno
comma
(paren
r_int
)paren
id|rec-&gt;kop
(braket
id|i
)braket
dot
id|kml_flag
comma
(paren
r_int
)paren
id|rec-&gt;kop
(braket
id|i
)braket
dot
id|kml_op
comma
(paren
r_int
)paren
id|rec-&gt;kop
(braket
id|i
)braket
dot
id|i_ino
comma
(paren
r_int
)paren
id|rec-&gt;kop
(braket
id|i
)braket
dot
id|i_nlink
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
DECL|function|print_kml_optimize
r_static
r_void
id|print_kml_optimize
(paren
r_struct
id|kml_optimize
op_star
id|rec
)paren
(brace
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot; === OPTIMIZE&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rec-&gt;kml_flag
op_eq
id|KML_REC_DELETE
)paren
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     kml_flag::deleted&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     kml_flag::exist&bslash;n&quot;
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     kml_op::%u&bslash;n&quot;
comma
id|rec-&gt;kml_op
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     i_nlink::%d&bslash;n&quot;
comma
id|rec-&gt;i_nlink
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     i_ino::%u&bslash;n&quot;
comma
id|rec-&gt;i_ino
)paren
suffix:semicolon
)brace
DECL|function|print_kml_suffix
r_static
r_void
id|print_kml_suffix
(paren
r_struct
id|journal_suffix
op_star
id|tail
)paren
(brace
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot; === KML SUFFIX&bslash;n&quot;
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     prevrec::%ld&bslash;n&quot;
comma
id|tail-&gt;prevrec
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     recno::%ld&bslash;n&quot;
comma
(paren
r_int
)paren
id|tail-&gt;recno
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     time::%d&bslash;n&quot;
comma
id|tail-&gt;time
)paren
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;     len::%d&bslash;n&quot;
comma
id|tail-&gt;len
)paren
suffix:semicolon
)brace
DECL|function|kml_printrec
r_void
id|kml_printrec
(paren
r_struct
id|kml_rec
op_star
id|rec
comma
r_int
id|kml_printop
)paren
(brace
r_if
c_cond
(paren
id|kml_printop
op_amp
id|PRINT_KML_PREFIX
)paren
id|print_kml_prefix
(paren
op_amp
id|rec-&gt;rec_head
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kml_printop
op_amp
id|PRINT_KML_REC
)paren
(brace
r_switch
c_cond
(paren
id|rec-&gt;rec_head.opcode
)paren
(brace
r_case
id|KML_CREATE
suffix:colon
id|print_kml_create
(paren
op_amp
id|rec-&gt;rec_kml.create
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_MKDIR
suffix:colon
id|print_kml_mkdir
(paren
op_amp
id|rec-&gt;rec_kml.mkdir
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_UNLINK
suffix:colon
id|print_kml_unlink
(paren
op_amp
id|rec-&gt;rec_kml.unlink
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_RMDIR
suffix:colon
id|print_kml_rmdir
(paren
op_amp
id|rec-&gt;rec_kml.rmdir
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_CLOSE
suffix:colon
id|print_kml_close
(paren
op_amp
id|rec-&gt;rec_kml.close
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_SYMLINK
suffix:colon
id|print_kml_symlink
(paren
op_amp
id|rec-&gt;rec_kml.symlink
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_RENAME
suffix:colon
id|print_kml_rename
(paren
op_amp
id|rec-&gt;rec_kml.rename
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_SETATTR
suffix:colon
id|print_kml_setattr
(paren
op_amp
id|rec-&gt;rec_kml.setattr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_LINK
suffix:colon
id|print_kml_link
(paren
op_amp
id|rec-&gt;rec_kml.link
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_OPEN
suffix:colon
id|print_kml_open
(paren
op_amp
id|rec-&gt;rec_kml.open
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_MKNOD
suffix:colon
id|print_kml_mknod
(paren
op_amp
id|rec-&gt;rec_kml.mknod
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if 0
r_case
id|KML_ENDMARK
suffix:colon
id|print_kml_endmark
(paren
op_amp
id|rec-&gt;rec_kml.endmark
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_default
suffix:colon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot; === BAD RECORD, opcode=%u&bslash;n&quot;
comma
id|rec-&gt;rec_head.opcode
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|kml_printop
op_amp
id|PRINT_KML_SUFFIX
)paren
id|print_kml_suffix
(paren
op_amp
id|rec-&gt;rec_tail
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kml_printop
op_amp
id|PRINT_KML_OPTIMIZE
)paren
id|print_kml_optimize
(paren
op_amp
id|rec-&gt;kml_optimize
)paren
suffix:semicolon
)brace
DECL|function|kml_freerec
r_void
id|kml_freerec
(paren
r_struct
id|kml_rec
op_star
id|rec
)paren
(brace
r_char
op_star
id|sourcepath
op_assign
l_int|NULL
comma
op_star
id|targetpath
op_assign
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|rec-&gt;rec_head.opcode
)paren
(brace
r_case
id|KML_CREATE
suffix:colon
id|sourcepath
op_assign
id|rec-&gt;rec_kml.create.path
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_MKDIR
suffix:colon
id|sourcepath
op_assign
id|rec-&gt;rec_kml.create.path
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_UNLINK
suffix:colon
id|sourcepath
op_assign
id|rec-&gt;rec_kml.unlink.path
suffix:semicolon
id|targetpath
op_assign
id|rec-&gt;rec_kml.unlink.name
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_RMDIR
suffix:colon
id|sourcepath
op_assign
id|rec-&gt;rec_kml.rmdir.path
suffix:semicolon
id|targetpath
op_assign
id|rec-&gt;rec_kml.rmdir.name
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_CLOSE
suffix:colon
id|sourcepath
op_assign
id|rec-&gt;rec_kml.close.path
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_SYMLINK
suffix:colon
id|sourcepath
op_assign
id|rec-&gt;rec_kml.symlink.sourcepath
suffix:semicolon
id|targetpath
op_assign
id|rec-&gt;rec_kml.symlink.targetpath
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_RENAME
suffix:colon
id|sourcepath
op_assign
id|rec-&gt;rec_kml.rename.sourcepath
suffix:semicolon
id|targetpath
op_assign
id|rec-&gt;rec_kml.rename.targetpath
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_SETATTR
suffix:colon
id|sourcepath
op_assign
id|rec-&gt;rec_kml.setattr.path
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_LINK
suffix:colon
id|sourcepath
op_assign
id|rec-&gt;rec_kml.link.sourcepath
suffix:semicolon
id|targetpath
op_assign
id|rec-&gt;rec_kml.link.targetpath
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_OPEN
suffix:colon
r_break
suffix:semicolon
r_case
id|KML_MKNOD
suffix:colon
id|sourcepath
op_assign
id|rec-&gt;rec_kml.mknod.path
suffix:semicolon
r_break
suffix:semicolon
macro_line|#if 0
r_case
id|KML_ENDMARK
suffix:colon
id|PRESTO_FREE
(paren
id|rec-&gt;rec_kml.endmark.kop
comma
r_sizeof
(paren
r_int
)paren
op_plus
r_sizeof
(paren
r_struct
id|kml_kop_node
)paren
op_star
id|rec-&gt;rec_kml.endmark.total
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sourcepath
op_ne
l_int|NULL
)paren
id|PRESTO_FREE
(paren
id|sourcepath
comma
id|strlen
(paren
id|sourcepath
)paren
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|targetpath
op_ne
l_int|NULL
)paren
id|PRESTO_FREE
(paren
id|targetpath
comma
id|strlen
(paren
id|targetpath
)paren
op_plus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|readrec
r_char
op_star
id|readrec
(paren
r_char
op_star
id|recbuf
comma
r_int
id|reclen
comma
r_int
id|pos
comma
r_int
op_star
id|size
)paren
(brace
r_char
op_star
id|p
op_assign
id|recbuf
op_plus
id|pos
suffix:semicolon
op_star
id|size
op_assign
op_star
(paren
(paren
r_int
op_star
)paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|size
OG
(paren
id|reclen
op_minus
id|pos
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
DECL|function|kml_decoderec
r_int
id|kml_decoderec
(paren
r_char
op_star
id|buf
comma
r_int
id|pos
comma
r_int
id|buflen
comma
r_int
op_star
id|size
comma
r_struct
id|kml_rec
op_star
op_star
id|newrec
)paren
(brace
r_char
op_star
id|tmp
suffix:semicolon
r_int
id|error
suffix:semicolon
id|tmp
op_assign
id|readrec
(paren
id|buf
comma
id|buflen
comma
id|pos
comma
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EBADF
suffix:semicolon
id|error
op_assign
id|kml_unpack
(paren
id|tmp
comma
op_star
id|size
comma
id|pos
comma
id|newrec
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_void
id|fill_kmlrec_optimize
(paren
r_struct
id|list_head
op_star
id|head
comma
r_struct
id|kml_rec
op_star
id|optrec
)paren
(brace
r_struct
id|kml_rec
op_star
id|kmlrec
suffix:semicolon
r_struct
id|list_head
op_star
id|tmp
suffix:semicolon
r_struct
id|kml_endmark
op_star
id|km
suffix:semicolon
r_struct
id|kml_optimize
op_star
id|ko
suffix:semicolon
r_int
id|n
suffix:semicolon
r_if
c_cond
(paren
id|optrec-&gt;rec_kml.endmark.total
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|n
op_assign
id|optrec-&gt;rec_kml.endmark.total
op_minus
l_int|1
suffix:semicolon
id|tmp
op_assign
id|head-&gt;prev
suffix:semicolon
id|km
op_assign
op_amp
id|optrec-&gt;rec_kml.endmark
suffix:semicolon
r_while
c_loop
(paren
id|n
op_ge
l_int|0
op_logical_and
id|tmp
op_ne
id|head
)paren
(brace
id|kmlrec
op_assign
id|list_entry
c_func
(paren
id|tmp
comma
r_struct
id|kml_rec
comma
id|kml_optimize.kml_chains
)paren
suffix:semicolon
id|tmp
op_assign
id|tmp-&gt;prev
suffix:semicolon
r_if
c_cond
(paren
id|kmlrec-&gt;rec_tail.recno
op_eq
id|km-&gt;kop
(braket
id|n
)braket
dot
id|kml_recno
)paren
(brace
id|ko
op_assign
op_amp
id|kmlrec-&gt;kml_optimize
suffix:semicolon
id|ko-&gt;kml_flag
op_assign
id|km-&gt;kop
(braket
id|n
)braket
dot
id|kml_flag
suffix:semicolon
id|ko-&gt;kml_op
op_assign
id|km-&gt;kop
(braket
id|n
)braket
dot
id|kml_op
suffix:semicolon
id|ko-&gt;i_nlink
op_assign
id|km-&gt;kop
(braket
id|n
)braket
dot
id|i_nlink
suffix:semicolon
id|ko-&gt;i_ino
op_assign
id|km-&gt;kop
(braket
id|n
)braket
dot
id|i_ino
suffix:semicolon
id|n
op_decrement
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|n
op_ne
op_minus
l_int|1
)paren
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;Yeah!!!, KML optimize error, recno=%d, n=%d&bslash;n&quot;
comma
id|optrec-&gt;rec_tail.recno
comma
id|n
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|decode_kmlrec
r_int
id|decode_kmlrec
(paren
r_struct
id|list_head
op_star
id|head
comma
r_char
op_star
id|kml_buf
comma
r_int
id|buflen
)paren
(brace
r_struct
id|kml_rec
op_star
id|rec
suffix:semicolon
r_int
id|pos
op_assign
l_int|0
comma
id|size
suffix:semicolon
r_int
id|err
suffix:semicolon
r_while
c_loop
(paren
id|pos
OL
id|buflen
)paren
(brace
id|err
op_assign
id|kml_decoderec
(paren
id|kml_buf
comma
id|pos
comma
id|buflen
comma
op_amp
id|size
comma
op_amp
id|rec
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
l_int|0
)paren
r_break
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|rec-&gt;rec_head.opcode
op_eq
id|KML_ENDMARK
)paren
(brace
id|fill_kmlrec_optimize
(paren
id|head
comma
id|rec
)paren
suffix:semicolon
id|mark_rec_deleted
(paren
id|rec
)paren
suffix:semicolon
)brace
macro_line|#endif
id|list_add_tail
(paren
op_amp
id|rec-&gt;kml_optimize.kml_chains
comma
id|head
)paren
suffix:semicolon
id|pos
op_add_assign
id|size
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|delete_kmlrec
r_int
id|delete_kmlrec
(paren
r_struct
id|list_head
op_star
id|head
)paren
(brace
r_struct
id|kml_rec
op_star
id|rec
suffix:semicolon
r_struct
id|list_head
op_star
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
id|head
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|tmp
op_assign
id|head-&gt;next
suffix:semicolon
r_while
c_loop
(paren
id|tmp
op_ne
id|head
)paren
(brace
id|rec
op_assign
id|list_entry
c_func
(paren
id|tmp
comma
r_struct
id|kml_rec
comma
id|kml_optimize.kml_chains
)paren
suffix:semicolon
id|tmp
op_assign
id|tmp-&gt;next
suffix:semicolon
id|kml_freerec
(paren
id|rec
)paren
suffix:semicolon
)brace
id|INIT_LIST_HEAD
c_func
(paren
id|head
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|print_allkmlrec
r_int
id|print_allkmlrec
(paren
r_struct
id|list_head
op_star
id|head
comma
r_int
id|printop
)paren
(brace
r_struct
id|kml_rec
op_star
id|rec
suffix:semicolon
r_struct
id|list_head
op_star
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
id|head
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|tmp
op_assign
id|head-&gt;next
suffix:semicolon
r_while
c_loop
(paren
id|tmp
op_ne
id|head
)paren
(brace
id|rec
op_assign
id|list_entry
c_func
(paren
id|tmp
comma
r_struct
id|kml_rec
comma
id|kml_optimize.kml_chains
)paren
suffix:semicolon
id|tmp
op_assign
id|tmp-&gt;next
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|printop
op_amp
id|PRINT_KML_EXIST
)paren
(brace
r_if
c_cond
(paren
id|is_deleted_node
(paren
id|rec
)paren
)paren
r_continue
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|printop
op_amp
id|PRINT_KML_DELETE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|is_deleted_node
(paren
id|rec
)paren
)paren
r_continue
suffix:semicolon
)brace
macro_line|#endif
id|kml_printrec
(paren
id|rec
comma
id|printop
)paren
suffix:semicolon
)brace
id|INIT_LIST_HEAD
c_func
(paren
id|head
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
