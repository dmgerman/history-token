multiline_comment|/* -*- mode: c; c-basic-offset: 8; indent-tabs-mode: nil; -*-&n; * vim:expandtab:shiftwidth=8:tabstop=8:&n; *&n; * Copyright (C) 2001, 2002 Cluster File Systems, Inc. &lt;braam@clusterfs.com&gt;&n; * Copyright (C) 2001 Tacit Networks, Inc. &lt;phil@off.net&gt;&n; *&n; *   This file is part of InterMezzo, http://www.inter-mezzo.org.&n; *&n; *   InterMezzo is free software; you can redistribute it and/or&n; *   modify it under the terms of version 2 of the GNU General Public&n; *   License as published by the Free Software Foundation.&n; *&n; *   InterMezzo is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with InterMezzo; if not, write to the Free Software&n; *   Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; * Mostly platform independent upcall operations to a cache manager:&n; *  -- upcalls&n; *  -- upcall routines&n; *&n; */
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;asm/signal.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;asm/segment.h&gt;
macro_line|#include &lt;linux/intermezzo_lib.h&gt;
macro_line|#include &lt;linux/intermezzo_fs.h&gt;
macro_line|#include &lt;linux/intermezzo_psdev.h&gt;
macro_line|#include &lt;linux/intermezzo_idl.h&gt;
multiline_comment|/*&n;  At present:&n;  -- Asynchronous calls:&n;   - kml:            give a &quot;more&quot; kml indication to userland&n;   - kml_truncate:   initiate KML truncation&n;   - release_permit: kernel is done with permit&n;  -- Synchronous&n;   - open:           fetch file&n;   - permit:         get a permit&n;&n;  Errors returned by user level code are positive&n;&n; */
DECL|function|upc_pack
r_static
r_struct
id|izo_upcall_hdr
op_star
id|upc_pack
c_func
(paren
id|__u32
id|opcode
comma
r_int
id|pathlen
comma
r_char
op_star
id|path
comma
r_char
op_star
id|fsetname
comma
r_int
id|reclen
comma
r_char
op_star
id|rec
comma
r_int
op_star
id|size
)paren
(brace
r_struct
id|izo_upcall_hdr
op_star
id|hdr
suffix:semicolon
r_char
op_star
id|ptr
suffix:semicolon
id|ENTRY
suffix:semicolon
op_star
id|size
op_assign
r_sizeof
(paren
r_struct
id|izo_upcall_hdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fsetname
)paren
(brace
op_star
id|size
op_add_assign
id|round_strlen
c_func
(paren
id|fsetname
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|path
)paren
(brace
op_star
id|size
op_add_assign
id|round_strlen
c_func
(paren
id|path
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rec
)paren
(brace
op_star
id|size
op_add_assign
id|size_round
c_func
(paren
id|reclen
)paren
suffix:semicolon
)brace
id|PRESTO_ALLOC
c_func
(paren
id|hdr
comma
op_star
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hdr
)paren
(brace
id|CERROR
c_func
(paren
l_string|&quot;intermezzo upcall: out of memory (opc %d)&bslash;n&quot;
comma
id|opcode
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|hdr
comma
l_int|0
comma
op_star
id|size
)paren
suffix:semicolon
id|ptr
op_assign
(paren
r_char
op_star
)paren
id|hdr
op_plus
r_sizeof
(paren
op_star
id|hdr
)paren
suffix:semicolon
multiline_comment|/* XXX do we need fsuid ? */
id|hdr-&gt;u_len
op_assign
op_star
id|size
suffix:semicolon
id|hdr-&gt;u_version
op_assign
id|IZO_UPC_VERSION
suffix:semicolon
id|hdr-&gt;u_opc
op_assign
id|opcode
suffix:semicolon
id|hdr-&gt;u_pid
op_assign
id|current-&gt;pid
suffix:semicolon
id|hdr-&gt;u_uid
op_assign
id|current-&gt;fsuid
suffix:semicolon
r_if
c_cond
(paren
id|path
)paren
(brace
multiline_comment|/*XXX Robert: please review what len to pass in for &n;                  NUL terminated strings */
id|hdr-&gt;u_pathlen
op_assign
id|strlen
c_func
(paren
id|path
)paren
suffix:semicolon
id|LOGL0
c_func
(paren
id|path
comma
id|hdr-&gt;u_pathlen
comma
id|ptr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fsetname
)paren
(brace
id|hdr-&gt;u_fsetlen
op_assign
id|strlen
c_func
(paren
id|fsetname
)paren
suffix:semicolon
id|LOGL0
c_func
(paren
id|fsetname
comma
id|strlen
c_func
(paren
id|fsetname
)paren
comma
id|ptr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rec
)paren
(brace
id|hdr-&gt;u_reclen
op_assign
id|reclen
suffix:semicolon
id|LOGL
c_func
(paren
id|rec
comma
id|reclen
comma
id|ptr
)paren
suffix:semicolon
)brace
id|EXIT
suffix:semicolon
r_return
id|hdr
suffix:semicolon
)brace
multiline_comment|/* the upcalls */
DECL|function|izo_upc_kml
r_int
id|izo_upc_kml
c_func
(paren
r_int
id|minor
comma
id|__u64
id|offset
comma
id|__u32
id|first_recno
comma
id|__u64
id|length
comma
id|__u32
id|last_recno
comma
r_char
op_star
id|fsetname
)paren
(brace
r_int
id|size
suffix:semicolon
r_int
id|error
suffix:semicolon
r_struct
id|izo_upcall_hdr
op_star
id|hdr
suffix:semicolon
id|ENTRY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|presto_lento_up
c_func
(paren
id|minor
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|hdr
op_assign
id|upc_pack
c_func
(paren
id|IZO_UPC_KML
comma
l_int|0
comma
l_int|NULL
comma
id|fsetname
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hdr
op_logical_or
id|IS_ERR
c_func
(paren
id|hdr
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|PTR_ERR
c_func
(paren
id|hdr
)paren
suffix:semicolon
)brace
id|hdr-&gt;u_offset
op_assign
id|offset
suffix:semicolon
id|hdr-&gt;u_first_recno
op_assign
id|first_recno
suffix:semicolon
id|hdr-&gt;u_length
op_assign
id|length
suffix:semicolon
id|hdr-&gt;u_last_recno
op_assign
id|last_recno
suffix:semicolon
id|CDEBUG
c_func
(paren
id|D_UPCALL
comma
l_string|&quot;KML: fileset %s, offset %Lu, length %Lu, &quot;
l_string|&quot;first %u, last %d; minor %d&bslash;n&quot;
comma
id|fsetname
comma
id|hdr-&gt;u_offset
comma
id|hdr-&gt;u_length
comma
id|hdr-&gt;u_first_recno
comma
id|hdr-&gt;u_last_recno
comma
id|minor
)paren
suffix:semicolon
id|error
op_assign
id|izo_upc_upcall
c_func
(paren
id|minor
comma
op_amp
id|size
comma
id|hdr
comma
id|ASYNCHRONOUS
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
DECL|function|izo_upc_kml_truncate
r_int
id|izo_upc_kml_truncate
c_func
(paren
r_int
id|minor
comma
id|__u64
id|length
comma
id|__u32
id|last_recno
comma
r_char
op_star
id|fsetname
)paren
(brace
r_int
id|size
suffix:semicolon
r_int
id|error
suffix:semicolon
r_struct
id|izo_upcall_hdr
op_star
id|hdr
suffix:semicolon
id|ENTRY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|presto_lento_up
c_func
(paren
id|minor
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|hdr
op_assign
id|upc_pack
c_func
(paren
id|IZO_UPC_KML_TRUNC
comma
l_int|0
comma
l_int|NULL
comma
id|fsetname
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hdr
op_logical_or
id|IS_ERR
c_func
(paren
id|hdr
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|PTR_ERR
c_func
(paren
id|hdr
)paren
suffix:semicolon
)brace
id|hdr-&gt;u_length
op_assign
id|length
suffix:semicolon
id|hdr-&gt;u_last_recno
op_assign
id|last_recno
suffix:semicolon
id|CDEBUG
c_func
(paren
id|D_UPCALL
comma
l_string|&quot;KML TRUNCATE: fileset %s, length %Lu, &quot;
l_string|&quot;last recno %d, minor %d&bslash;n&quot;
comma
id|fsetname
comma
id|hdr-&gt;u_length
comma
id|hdr-&gt;u_last_recno
comma
id|minor
)paren
suffix:semicolon
id|error
op_assign
id|izo_upc_upcall
c_func
(paren
id|minor
comma
op_amp
id|size
comma
id|hdr
comma
id|ASYNCHRONOUS
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|izo_upc_open
r_int
id|izo_upc_open
c_func
(paren
r_int
id|minor
comma
id|__u32
id|pathlen
comma
r_char
op_star
id|path
comma
r_char
op_star
id|fsetname
comma
r_struct
id|lento_vfs_context
op_star
id|info
)paren
(brace
r_int
id|size
suffix:semicolon
r_int
id|error
suffix:semicolon
r_struct
id|izo_upcall_hdr
op_star
id|hdr
suffix:semicolon
id|ENTRY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|presto_lento_up
c_func
(paren
id|minor
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|hdr
op_assign
id|upc_pack
c_func
(paren
id|IZO_UPC_OPEN
comma
id|pathlen
comma
id|path
comma
id|fsetname
comma
r_sizeof
(paren
op_star
id|info
)paren
comma
(paren
r_char
op_star
)paren
id|info
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hdr
op_logical_or
id|IS_ERR
c_func
(paren
id|hdr
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|PTR_ERR
c_func
(paren
id|hdr
)paren
suffix:semicolon
)brace
id|CDEBUG
c_func
(paren
id|D_UPCALL
comma
l_string|&quot;path %s&bslash;n&quot;
comma
id|path
)paren
suffix:semicolon
id|error
op_assign
id|izo_upc_upcall
c_func
(paren
id|minor
comma
op_amp
id|size
comma
id|hdr
comma
id|SYNCHRONOUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
id|CERROR
c_func
(paren
l_string|&quot;InterMezzo: %s: error %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|error
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
DECL|function|izo_upc_get_fileid
r_int
id|izo_upc_get_fileid
c_func
(paren
r_int
id|minor
comma
id|__u32
id|reclen
comma
r_char
op_star
id|rec
comma
id|__u32
id|pathlen
comma
r_char
op_star
id|path
comma
r_char
op_star
id|fsetname
)paren
(brace
r_int
id|size
suffix:semicolon
r_int
id|error
suffix:semicolon
r_struct
id|izo_upcall_hdr
op_star
id|hdr
suffix:semicolon
id|ENTRY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|presto_lento_up
c_func
(paren
id|minor
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|hdr
op_assign
id|upc_pack
c_func
(paren
id|IZO_UPC_GET_FILEID
comma
id|pathlen
comma
id|path
comma
id|fsetname
comma
id|reclen
comma
id|rec
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hdr
op_logical_or
id|IS_ERR
c_func
(paren
id|hdr
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|PTR_ERR
c_func
(paren
id|hdr
)paren
suffix:semicolon
)brace
id|CDEBUG
c_func
(paren
id|D_UPCALL
comma
l_string|&quot;path %s&bslash;n&quot;
comma
id|path
)paren
suffix:semicolon
id|error
op_assign
id|izo_upc_upcall
c_func
(paren
id|minor
comma
op_amp
id|size
comma
id|hdr
comma
id|SYNCHRONOUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
id|CERROR
c_func
(paren
l_string|&quot;InterMezzo: %s: error %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|error
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
DECL|function|izo_upc_backfetch
r_int
id|izo_upc_backfetch
c_func
(paren
r_int
id|minor
comma
r_char
op_star
id|path
comma
r_char
op_star
id|fsetname
comma
r_struct
id|lento_vfs_context
op_star
id|info
)paren
(brace
r_int
id|size
suffix:semicolon
r_int
id|error
suffix:semicolon
r_struct
id|izo_upcall_hdr
op_star
id|hdr
suffix:semicolon
id|ENTRY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|presto_lento_up
c_func
(paren
id|minor
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|hdr
op_assign
id|upc_pack
c_func
(paren
id|IZO_UPC_BACKFETCH
comma
id|strlen
c_func
(paren
id|path
)paren
comma
id|path
comma
id|fsetname
comma
r_sizeof
(paren
op_star
id|info
)paren
comma
(paren
r_char
op_star
)paren
id|info
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hdr
op_logical_or
id|IS_ERR
c_func
(paren
id|hdr
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|PTR_ERR
c_func
(paren
id|hdr
)paren
suffix:semicolon
)brace
multiline_comment|/* This is currently synchronous, kml_reint_record blocks */
id|error
op_assign
id|izo_upc_upcall
c_func
(paren
id|minor
comma
op_amp
id|size
comma
id|hdr
comma
id|SYNCHRONOUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
id|CERROR
c_func
(paren
l_string|&quot;InterMezzo: %s: error %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|error
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
DECL|function|izo_upc_permit
r_int
id|izo_upc_permit
c_func
(paren
r_int
id|minor
comma
r_struct
id|dentry
op_star
id|dentry
comma
id|__u32
id|pathlen
comma
r_char
op_star
id|path
comma
r_char
op_star
id|fsetname
)paren
(brace
r_int
id|size
suffix:semicolon
r_int
id|error
suffix:semicolon
r_struct
id|izo_upcall_hdr
op_star
id|hdr
suffix:semicolon
id|ENTRY
suffix:semicolon
id|hdr
op_assign
id|upc_pack
c_func
(paren
id|IZO_UPC_PERMIT
comma
id|pathlen
comma
id|path
comma
id|fsetname
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hdr
op_logical_or
id|IS_ERR
c_func
(paren
id|hdr
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|PTR_ERR
c_func
(paren
id|hdr
)paren
suffix:semicolon
)brace
id|CDEBUG
c_func
(paren
id|D_UPCALL
comma
l_string|&quot;Permit minor %d path %s&bslash;n&quot;
comma
id|minor
comma
id|path
)paren
suffix:semicolon
id|error
op_assign
id|izo_upc_upcall
c_func
(paren
id|minor
comma
op_amp
id|size
comma
id|hdr
comma
id|SYNCHRONOUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_eq
op_minus
id|EROFS
)paren
(brace
r_int
id|err
suffix:semicolon
id|CERROR
c_func
(paren
l_string|&quot;InterMezzo: ERROR - requested permit for read-only &quot;
l_string|&quot;fileset.&bslash;n   Setting &bslash;&quot;%s&bslash;&quot; read-only!&bslash;n&quot;
comma
id|path
)paren
suffix:semicolon
id|err
op_assign
id|izo_mark_cache
c_func
(paren
id|dentry
comma
l_int|0xFFFFFFFF
comma
id|CACHE_CLIENT_RO
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
id|CERROR
c_func
(paren
l_string|&quot;InterMezzo ERROR: mark_cache %d&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|error
)paren
(brace
id|CERROR
c_func
(paren
l_string|&quot;InterMezzo: %s: error %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|error
)paren
suffix:semicolon
)brace
id|EXIT
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/* This is a ping-pong upcall handled on the server when a client (uuid)&n; * requests the permit for itself. */
DECL|function|izo_upc_revoke_permit
r_int
id|izo_upc_revoke_permit
c_func
(paren
r_int
id|minor
comma
r_char
op_star
id|fsetname
comma
id|__u8
id|uuid
(braket
l_int|16
)braket
)paren
(brace
r_int
id|size
suffix:semicolon
r_int
id|error
suffix:semicolon
r_struct
id|izo_upcall_hdr
op_star
id|hdr
suffix:semicolon
id|ENTRY
suffix:semicolon
id|hdr
op_assign
id|upc_pack
c_func
(paren
id|IZO_UPC_REVOKE_PERMIT
comma
l_int|0
comma
l_int|NULL
comma
id|fsetname
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hdr
op_logical_or
id|IS_ERR
c_func
(paren
id|hdr
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|PTR_ERR
c_func
(paren
id|hdr
)paren
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|hdr-&gt;u_uuid
comma
id|uuid
comma
r_sizeof
(paren
id|hdr-&gt;u_uuid
)paren
)paren
suffix:semicolon
id|error
op_assign
id|izo_upc_upcall
c_func
(paren
id|minor
comma
op_amp
id|size
comma
id|hdr
comma
id|SYNCHRONOUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
id|CERROR
c_func
(paren
l_string|&quot;InterMezzo: %s: error %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|error
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
DECL|function|izo_upc_go_fetch_kml
r_int
id|izo_upc_go_fetch_kml
c_func
(paren
r_int
id|minor
comma
r_char
op_star
id|fsetname
comma
id|__u8
id|uuid
(braket
l_int|16
)braket
comma
id|__u64
id|kmlsize
)paren
(brace
r_int
id|size
suffix:semicolon
r_int
id|error
suffix:semicolon
r_struct
id|izo_upcall_hdr
op_star
id|hdr
suffix:semicolon
id|ENTRY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|presto_lento_up
c_func
(paren
id|minor
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|hdr
op_assign
id|upc_pack
c_func
(paren
id|IZO_UPC_GO_FETCH_KML
comma
l_int|0
comma
l_int|NULL
comma
id|fsetname
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hdr
op_logical_or
id|IS_ERR
c_func
(paren
id|hdr
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|PTR_ERR
c_func
(paren
id|hdr
)paren
suffix:semicolon
)brace
id|hdr-&gt;u_offset
op_assign
id|kmlsize
suffix:semicolon
id|memcpy
c_func
(paren
id|hdr-&gt;u_uuid
comma
id|uuid
comma
r_sizeof
(paren
id|hdr-&gt;u_uuid
)paren
)paren
suffix:semicolon
id|error
op_assign
id|izo_upc_upcall
c_func
(paren
id|minor
comma
op_amp
id|size
comma
id|hdr
comma
id|ASYNCHRONOUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
id|CERROR
c_func
(paren
l_string|&quot;%s: error %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|error
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
DECL|function|izo_upc_connect
r_int
id|izo_upc_connect
c_func
(paren
r_int
id|minor
comma
id|__u64
id|ip_address
comma
id|__u64
id|port
comma
id|__u8
id|uuid
(braket
l_int|16
)braket
comma
r_int
id|client_flag
)paren
(brace
r_int
id|size
suffix:semicolon
r_int
id|error
suffix:semicolon
r_struct
id|izo_upcall_hdr
op_star
id|hdr
suffix:semicolon
id|ENTRY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|presto_lento_up
c_func
(paren
id|minor
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|hdr
op_assign
id|upc_pack
c_func
(paren
id|IZO_UPC_CONNECT
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hdr
op_logical_or
id|IS_ERR
c_func
(paren
id|hdr
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|PTR_ERR
c_func
(paren
id|hdr
)paren
suffix:semicolon
)brace
id|hdr-&gt;u_offset
op_assign
id|ip_address
suffix:semicolon
id|hdr-&gt;u_length
op_assign
id|port
suffix:semicolon
id|memcpy
c_func
(paren
id|hdr-&gt;u_uuid
comma
id|uuid
comma
r_sizeof
(paren
id|hdr-&gt;u_uuid
)paren
)paren
suffix:semicolon
id|hdr-&gt;u_first_recno
op_assign
id|client_flag
suffix:semicolon
id|error
op_assign
id|izo_upc_upcall
c_func
(paren
id|minor
comma
op_amp
id|size
comma
id|hdr
comma
id|SYNCHRONOUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
id|CERROR
c_func
(paren
l_string|&quot;%s: error %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|error
)paren
suffix:semicolon
)brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
DECL|function|izo_upc_set_kmlsize
r_int
id|izo_upc_set_kmlsize
c_func
(paren
r_int
id|minor
comma
r_char
op_star
id|fsetname
comma
id|__u8
id|uuid
(braket
l_int|16
)braket
comma
id|__u64
id|kmlsize
)paren
(brace
r_int
id|size
suffix:semicolon
r_int
id|error
suffix:semicolon
r_struct
id|izo_upcall_hdr
op_star
id|hdr
suffix:semicolon
id|ENTRY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|presto_lento_up
c_func
(paren
id|minor
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|hdr
op_assign
id|upc_pack
c_func
(paren
id|IZO_UPC_SET_KMLSIZE
comma
l_int|0
comma
l_int|NULL
comma
id|fsetname
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hdr
op_logical_or
id|IS_ERR
c_func
(paren
id|hdr
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|PTR_ERR
c_func
(paren
id|hdr
)paren
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|hdr-&gt;u_uuid
comma
id|uuid
comma
r_sizeof
(paren
id|hdr-&gt;u_uuid
)paren
)paren
suffix:semicolon
id|hdr-&gt;u_length
op_assign
id|kmlsize
suffix:semicolon
id|error
op_assign
id|izo_upc_upcall
c_func
(paren
id|minor
comma
op_amp
id|size
comma
id|hdr
comma
id|SYNCHRONOUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
id|CERROR
c_func
(paren
l_string|&quot;%s: error %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|error
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
DECL|function|izo_upc_repstatus
r_int
id|izo_upc_repstatus
c_func
(paren
r_int
id|minor
comma
r_char
op_star
id|fsetname
comma
r_struct
id|izo_rcvd_rec
op_star
id|lr_server
)paren
(brace
r_int
id|size
suffix:semicolon
r_int
id|error
suffix:semicolon
r_struct
id|izo_upcall_hdr
op_star
id|hdr
suffix:semicolon
id|ENTRY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|presto_lento_up
c_func
(paren
id|minor
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|hdr
op_assign
id|upc_pack
c_func
(paren
id|IZO_UPC_REPSTATUS
comma
l_int|0
comma
l_int|NULL
comma
id|fsetname
comma
r_sizeof
(paren
op_star
id|lr_server
)paren
comma
(paren
r_char
op_star
)paren
id|lr_server
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hdr
op_logical_or
id|IS_ERR
c_func
(paren
id|hdr
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|PTR_ERR
c_func
(paren
id|hdr
)paren
suffix:semicolon
)brace
id|error
op_assign
id|izo_upc_upcall
c_func
(paren
id|minor
comma
op_amp
id|size
comma
id|hdr
comma
id|SYNCHRONOUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
id|CERROR
c_func
(paren
l_string|&quot;%s: error %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|error
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
macro_line|#if 0
r_int
id|izo_upc_client_make_branch
c_func
(paren
r_int
id|minor
comma
r_char
op_star
id|fsetname
comma
r_char
op_star
id|tagname
comma
r_char
op_star
id|branchname
)paren
(brace
r_int
id|size
comma
id|error
suffix:semicolon
r_struct
id|izo_upcall_hdr
op_star
id|hdr
suffix:semicolon
r_int
id|pathlen
suffix:semicolon
r_char
op_star
id|path
suffix:semicolon
id|ENTRY
suffix:semicolon
id|hdr
op_assign
id|upc_pack
c_func
(paren
id|IZO_UPC_CLIENT_MAKE_BRANCH
comma
id|strlen
c_func
(paren
id|tagname
)paren
comma
id|tagname
comma
id|fsetname
comma
id|strlen
c_func
(paren
id|branchname
)paren
op_plus
l_int|1
comma
id|branchname
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hdr
op_logical_or
id|IS_ERR
c_func
(paren
id|hdr
)paren
)paren
(brace
id|error
op_assign
op_minus
id|PTR_ERR
c_func
(paren
id|hdr
)paren
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
id|error
op_assign
id|izo_upc_upcall
c_func
(paren
id|minor
comma
op_amp
id|size
comma
id|hdr
comma
id|SYNCHRONOUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
id|CERROR
c_func
(paren
l_string|&quot;InterMezzo: error %d&bslash;n&quot;
comma
id|error
)paren
suffix:semicolon
id|error
suffix:colon
id|PRESTO_FREE
c_func
(paren
id|path
comma
id|pathlen
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#endif
DECL|function|izo_upc_server_make_branch
r_int
id|izo_upc_server_make_branch
c_func
(paren
r_int
id|minor
comma
r_char
op_star
id|fsetname
)paren
(brace
r_int
id|size
comma
id|error
suffix:semicolon
r_struct
id|izo_upcall_hdr
op_star
id|hdr
suffix:semicolon
id|ENTRY
suffix:semicolon
id|hdr
op_assign
id|upc_pack
c_func
(paren
id|IZO_UPC_SERVER_MAKE_BRANCH
comma
l_int|0
comma
l_int|NULL
comma
id|fsetname
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hdr
op_logical_or
id|IS_ERR
c_func
(paren
id|hdr
)paren
)paren
(brace
id|error
op_assign
op_minus
id|PTR_ERR
c_func
(paren
id|hdr
)paren
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
id|error
op_assign
id|izo_upc_upcall
c_func
(paren
id|minor
comma
op_amp
id|size
comma
id|hdr
comma
id|SYNCHRONOUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
id|CERROR
c_func
(paren
l_string|&quot;InterMezzo: error %d&bslash;n&quot;
comma
id|error
)paren
suffix:semicolon
id|error
suffix:colon
id|EXIT
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
DECL|function|izo_upc_branch_undo
r_int
id|izo_upc_branch_undo
c_func
(paren
r_int
id|minor
comma
r_char
op_star
id|fsetname
comma
r_char
op_star
id|branchname
)paren
(brace
r_int
id|size
suffix:semicolon
r_int
id|error
suffix:semicolon
r_struct
id|izo_upcall_hdr
op_star
id|hdr
suffix:semicolon
id|ENTRY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|presto_lento_up
c_func
(paren
id|minor
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|hdr
op_assign
id|upc_pack
c_func
(paren
id|IZO_UPC_BRANCH_UNDO
comma
id|strlen
c_func
(paren
id|branchname
)paren
comma
id|branchname
comma
id|fsetname
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hdr
op_logical_or
id|IS_ERR
c_func
(paren
id|hdr
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|PTR_ERR
c_func
(paren
id|hdr
)paren
suffix:semicolon
)brace
id|error
op_assign
id|izo_upc_upcall
c_func
(paren
id|minor
comma
op_amp
id|size
comma
id|hdr
comma
id|SYNCHRONOUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
id|CERROR
c_func
(paren
l_string|&quot;InterMezzo: %s: error %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|error
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
DECL|function|izo_upc_branch_redo
r_int
id|izo_upc_branch_redo
c_func
(paren
r_int
id|minor
comma
r_char
op_star
id|fsetname
comma
r_char
op_star
id|branchname
)paren
(brace
r_int
id|size
suffix:semicolon
r_int
id|error
suffix:semicolon
r_struct
id|izo_upcall_hdr
op_star
id|hdr
suffix:semicolon
id|ENTRY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|presto_lento_up
c_func
(paren
id|minor
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|hdr
op_assign
id|upc_pack
c_func
(paren
id|IZO_UPC_BRANCH_REDO
comma
id|strlen
c_func
(paren
id|branchname
)paren
op_plus
l_int|1
comma
id|branchname
comma
id|fsetname
comma
l_int|0
comma
l_int|NULL
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hdr
op_logical_or
id|IS_ERR
c_func
(paren
id|hdr
)paren
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|PTR_ERR
c_func
(paren
id|hdr
)paren
suffix:semicolon
)brace
id|error
op_assign
id|izo_upc_upcall
c_func
(paren
id|minor
comma
op_amp
id|size
comma
id|hdr
comma
id|SYNCHRONOUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
id|CERROR
c_func
(paren
l_string|&quot;InterMezzo: %s: error %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|error
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
op_minus
id|error
suffix:semicolon
)brace
eof
