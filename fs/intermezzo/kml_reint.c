multiline_comment|/*&n; * KML REINT&n; *&n; * Copryright (C) 1996 Arthur Ma &lt;arthur.ma@mountainviewdata.com&gt;&n; *&n; * Copyright (C) 2000 Mountainview Data, Inc.&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/mmu_context.h&gt;
macro_line|#include &lt;linux/intermezzo_fs.h&gt;
macro_line|#include &lt;linux/intermezzo_kml.h&gt;
macro_line|#include &lt;linux/intermezzo_psdev.h&gt;
macro_line|#include &lt;linux/intermezzo_upcall.h&gt;
r_static
r_void
id|kmlreint_pre_secure
(paren
r_struct
id|kml_rec
op_star
id|rec
)paren
suffix:semicolon
r_static
r_void
id|kmlreint_post_secure
(paren
r_struct
id|kml_rec
op_star
id|rec
)paren
suffix:semicolon
DECL|function|kmlreint_pre_secure
r_static
r_void
id|kmlreint_pre_secure
(paren
r_struct
id|kml_rec
op_star
id|rec
)paren
(brace
r_if
c_cond
(paren
id|current-&gt;fsuid
op_ne
id|current-&gt;uid
)paren
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;reint_kmlreint_pre_secure: cannot setfsuid&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;fsgid
op_ne
id|current-&gt;gid
)paren
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;reint_kmlreint_pre_secure: cannot setfsgid&bslash;n&quot;
)paren
suffix:semicolon
id|current-&gt;fsuid
op_assign
id|rec-&gt;rec_head.uid
suffix:semicolon
id|current-&gt;fsgid
op_assign
id|rec-&gt;rec_head.fsgid
suffix:semicolon
)brace
DECL|function|kmlreint_post_secure
r_static
r_void
id|kmlreint_post_secure
(paren
r_struct
id|kml_rec
op_star
id|rec
)paren
(brace
id|current-&gt;fsuid
op_assign
id|current-&gt;uid
suffix:semicolon
id|current-&gt;fsgid
op_assign
id|current-&gt;gid
suffix:semicolon
multiline_comment|/* current-&gt;egid = current-&gt;gid; */
multiline_comment|/* ????????????? */
)brace
DECL|function|reint_create
r_static
r_int
id|reint_create
(paren
r_int
id|slot_offset
comma
r_struct
id|kml_rec
op_star
id|rec
)paren
(brace
r_struct
id|lento_vfs_context
id|info
suffix:semicolon
r_struct
id|kml_create
op_star
id|create
op_assign
op_amp
id|rec-&gt;rec_kml.create
suffix:semicolon
id|mm_segment_t
id|old_fs
suffix:semicolon
r_int
id|error
suffix:semicolon
id|ENTRY
suffix:semicolon
id|kmlreint_pre_secure
(paren
id|rec
)paren
suffix:semicolon
id|info.slot_offset
op_assign
id|slot_offset
suffix:semicolon
id|info.recno
op_assign
id|rec-&gt;rec_tail.recno
suffix:semicolon
id|info.kml_offset
op_assign
id|rec-&gt;rec_kml_offset
suffix:semicolon
id|info.flags
op_assign
l_int|0
suffix:semicolon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;=====REINT_CREATE::%s&bslash;n&quot;
comma
id|create-&gt;path
)paren
suffix:semicolon
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
(paren
id|get_ds
c_func
(paren
)paren
)paren
suffix:semicolon
id|error
op_assign
id|lento_create
c_func
(paren
id|create-&gt;path
comma
id|create-&gt;mode
comma
op_amp
id|info
)paren
suffix:semicolon
id|set_fs
(paren
id|old_fs
)paren
suffix:semicolon
id|kmlreint_post_secure
(paren
id|rec
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|reint_open
r_static
r_int
id|reint_open
(paren
r_int
id|slot_offset
comma
r_struct
id|kml_rec
op_star
id|rec
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|reint_mkdir
r_static
r_int
id|reint_mkdir
(paren
r_int
id|slot_offset
comma
r_struct
id|kml_rec
op_star
id|rec
)paren
(brace
r_struct
id|lento_vfs_context
id|info
suffix:semicolon
r_struct
id|kml_mkdir
op_star
id|mkdir
op_assign
op_amp
id|rec-&gt;rec_kml.mkdir
suffix:semicolon
id|mm_segment_t
id|old_fs
suffix:semicolon
r_int
id|error
suffix:semicolon
id|ENTRY
suffix:semicolon
id|kmlreint_pre_secure
(paren
id|rec
)paren
suffix:semicolon
id|info.slot_offset
op_assign
id|slot_offset
suffix:semicolon
id|info.recno
op_assign
id|rec-&gt;rec_tail.recno
suffix:semicolon
id|info.kml_offset
op_assign
id|rec-&gt;rec_kml_offset
suffix:semicolon
id|info.flags
op_assign
l_int|0
suffix:semicolon
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
(paren
id|get_ds
c_func
(paren
)paren
)paren
suffix:semicolon
id|error
op_assign
id|lento_mkdir
(paren
id|mkdir-&gt;path
comma
id|mkdir-&gt;mode
comma
op_amp
id|info
)paren
suffix:semicolon
id|set_fs
(paren
id|old_fs
)paren
suffix:semicolon
id|kmlreint_post_secure
(paren
id|rec
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|reint_rmdir
r_static
r_int
id|reint_rmdir
(paren
r_int
id|slot_offset
comma
r_struct
id|kml_rec
op_star
id|rec
)paren
(brace
r_struct
id|kml_rmdir
op_star
id|rmdir
op_assign
op_amp
id|rec-&gt;rec_kml.rmdir
suffix:semicolon
r_struct
id|lento_vfs_context
id|info
suffix:semicolon
id|mm_segment_t
id|old_fs
suffix:semicolon
r_char
op_star
id|name
suffix:semicolon
r_int
id|error
suffix:semicolon
id|ENTRY
suffix:semicolon
id|kmlreint_pre_secure
(paren
id|rec
)paren
suffix:semicolon
id|name
op_assign
id|bdup_printf
(paren
l_string|&quot;%s/%s&quot;
comma
id|rmdir-&gt;path
comma
id|rmdir-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|name
op_eq
l_int|NULL
)paren
(brace
id|kmlreint_post_secure
(paren
id|rec
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|info.slot_offset
op_assign
id|slot_offset
suffix:semicolon
id|info.recno
op_assign
id|rec-&gt;rec_tail.recno
suffix:semicolon
id|info.kml_offset
op_assign
id|rec-&gt;rec_kml_offset
suffix:semicolon
id|info.flags
op_assign
l_int|0
suffix:semicolon
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
(paren
id|get_ds
c_func
(paren
)paren
)paren
suffix:semicolon
id|error
op_assign
id|lento_rmdir
(paren
id|name
comma
op_amp
id|info
)paren
suffix:semicolon
id|set_fs
(paren
id|old_fs
)paren
suffix:semicolon
id|PRESTO_FREE
(paren
id|name
comma
id|strlen
(paren
id|name
)paren
op_plus
l_int|1
)paren
suffix:semicolon
id|kmlreint_post_secure
(paren
id|rec
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|reint_link
r_static
r_int
id|reint_link
(paren
r_int
id|slot_offset
comma
r_struct
id|kml_rec
op_star
id|rec
)paren
(brace
r_struct
id|kml_link
op_star
id|link
op_assign
op_amp
id|rec-&gt;rec_kml.link
suffix:semicolon
r_struct
id|lento_vfs_context
id|info
suffix:semicolon
id|mm_segment_t
id|old_fs
suffix:semicolon
r_int
id|error
suffix:semicolon
id|ENTRY
suffix:semicolon
id|kmlreint_pre_secure
(paren
id|rec
)paren
suffix:semicolon
id|info.slot_offset
op_assign
id|slot_offset
suffix:semicolon
id|info.recno
op_assign
id|rec-&gt;rec_tail.recno
suffix:semicolon
id|info.kml_offset
op_assign
id|rec-&gt;rec_kml_offset
suffix:semicolon
id|info.flags
op_assign
l_int|0
suffix:semicolon
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
(paren
id|get_ds
c_func
(paren
)paren
)paren
suffix:semicolon
id|error
op_assign
id|lento_link
(paren
id|link-&gt;sourcepath
comma
id|link-&gt;targetpath
comma
op_amp
id|info
)paren
suffix:semicolon
id|set_fs
(paren
id|old_fs
)paren
suffix:semicolon
id|kmlreint_post_secure
(paren
id|rec
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|reint_unlink
r_static
r_int
id|reint_unlink
(paren
r_int
id|slot_offset
comma
r_struct
id|kml_rec
op_star
id|rec
)paren
(brace
r_struct
id|kml_unlink
op_star
id|unlink
op_assign
op_amp
id|rec-&gt;rec_kml.unlink
suffix:semicolon
r_struct
id|lento_vfs_context
id|info
suffix:semicolon
id|mm_segment_t
id|old_fs
suffix:semicolon
r_int
id|error
suffix:semicolon
r_char
op_star
id|name
suffix:semicolon
id|ENTRY
suffix:semicolon
id|kmlreint_pre_secure
(paren
id|rec
)paren
suffix:semicolon
id|name
op_assign
id|bdup_printf
(paren
l_string|&quot;%s/%s&quot;
comma
id|unlink-&gt;path
comma
id|unlink-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|name
op_eq
l_int|NULL
)paren
(brace
id|kmlreint_post_secure
(paren
id|rec
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|info.slot_offset
op_assign
id|slot_offset
suffix:semicolon
id|info.recno
op_assign
id|rec-&gt;rec_tail.recno
suffix:semicolon
id|info.kml_offset
op_assign
id|rec-&gt;rec_kml_offset
suffix:semicolon
id|info.flags
op_assign
l_int|0
suffix:semicolon
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
(paren
id|get_ds
c_func
(paren
)paren
)paren
suffix:semicolon
id|error
op_assign
id|lento_unlink
(paren
id|name
comma
op_amp
id|info
)paren
suffix:semicolon
id|set_fs
(paren
id|old_fs
)paren
suffix:semicolon
id|PRESTO_FREE
(paren
id|name
comma
id|strlen
(paren
id|name
)paren
)paren
suffix:semicolon
id|kmlreint_post_secure
(paren
id|rec
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|reint_symlink
r_static
r_int
id|reint_symlink
(paren
r_int
id|slot_offset
comma
r_struct
id|kml_rec
op_star
id|rec
)paren
(brace
r_struct
id|kml_symlink
op_star
id|symlink
op_assign
op_amp
id|rec-&gt;rec_kml.symlink
suffix:semicolon
r_struct
id|lento_vfs_context
id|info
suffix:semicolon
id|mm_segment_t
id|old_fs
suffix:semicolon
r_int
id|error
suffix:semicolon
id|ENTRY
suffix:semicolon
id|kmlreint_pre_secure
(paren
id|rec
)paren
suffix:semicolon
id|info.slot_offset
op_assign
id|slot_offset
suffix:semicolon
id|info.recno
op_assign
id|rec-&gt;rec_tail.recno
suffix:semicolon
id|info.kml_offset
op_assign
id|rec-&gt;rec_kml_offset
suffix:semicolon
id|info.flags
op_assign
l_int|0
suffix:semicolon
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
(paren
id|get_ds
c_func
(paren
)paren
)paren
suffix:semicolon
id|error
op_assign
id|lento_symlink
(paren
id|symlink-&gt;targetpath
comma
id|symlink-&gt;sourcepath
comma
op_amp
id|info
)paren
suffix:semicolon
id|set_fs
(paren
id|old_fs
)paren
suffix:semicolon
id|kmlreint_post_secure
(paren
id|rec
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|reint_rename
r_static
r_int
id|reint_rename
(paren
r_int
id|slot_offset
comma
r_struct
id|kml_rec
op_star
id|rec
)paren
(brace
r_struct
id|kml_rename
op_star
id|rename
op_assign
op_amp
id|rec-&gt;rec_kml.rename
suffix:semicolon
r_struct
id|lento_vfs_context
id|info
suffix:semicolon
id|mm_segment_t
id|old_fs
suffix:semicolon
r_int
id|error
suffix:semicolon
id|ENTRY
suffix:semicolon
id|kmlreint_pre_secure
(paren
id|rec
)paren
suffix:semicolon
id|info.slot_offset
op_assign
id|slot_offset
suffix:semicolon
id|info.recno
op_assign
id|rec-&gt;rec_tail.recno
suffix:semicolon
id|info.kml_offset
op_assign
id|rec-&gt;rec_kml_offset
suffix:semicolon
id|info.flags
op_assign
l_int|0
suffix:semicolon
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
(paren
id|get_ds
c_func
(paren
)paren
)paren
suffix:semicolon
id|error
op_assign
id|lento_rename
(paren
id|rename-&gt;sourcepath
comma
id|rename-&gt;targetpath
comma
op_amp
id|info
)paren
suffix:semicolon
id|set_fs
(paren
id|old_fs
)paren
suffix:semicolon
id|kmlreint_post_secure
(paren
id|rec
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|reint_setattr
r_static
r_int
id|reint_setattr
(paren
r_int
id|slot_offset
comma
r_struct
id|kml_rec
op_star
id|rec
)paren
(brace
r_struct
id|kml_setattr
op_star
id|setattr
op_assign
op_amp
id|rec-&gt;rec_kml.setattr
suffix:semicolon
r_struct
id|lento_vfs_context
id|info
suffix:semicolon
id|mm_segment_t
id|old_fs
suffix:semicolon
r_int
id|error
suffix:semicolon
id|ENTRY
suffix:semicolon
id|kmlreint_pre_secure
(paren
id|rec
)paren
suffix:semicolon
id|info.slot_offset
op_assign
id|slot_offset
suffix:semicolon
id|info.recno
op_assign
id|rec-&gt;rec_tail.recno
suffix:semicolon
id|info.kml_offset
op_assign
id|rec-&gt;rec_kml_offset
suffix:semicolon
id|info.flags
op_assign
id|setattr-&gt;iattr.ia_attr_flags
suffix:semicolon
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
(paren
id|get_ds
c_func
(paren
)paren
)paren
suffix:semicolon
id|error
op_assign
id|lento_setattr
(paren
id|setattr-&gt;path
comma
op_amp
id|setattr-&gt;iattr
comma
op_amp
id|info
)paren
suffix:semicolon
id|set_fs
(paren
id|old_fs
)paren
suffix:semicolon
id|kmlreint_post_secure
(paren
id|rec
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|reint_mknod
r_static
r_int
id|reint_mknod
(paren
r_int
id|slot_offset
comma
r_struct
id|kml_rec
op_star
id|rec
)paren
(brace
r_struct
id|kml_mknod
op_star
id|mknod
op_assign
op_amp
id|rec-&gt;rec_kml.mknod
suffix:semicolon
r_struct
id|lento_vfs_context
id|info
suffix:semicolon
id|mm_segment_t
id|old_fs
suffix:semicolon
r_int
id|error
suffix:semicolon
id|ENTRY
suffix:semicolon
id|kmlreint_pre_secure
(paren
id|rec
)paren
suffix:semicolon
id|info.slot_offset
op_assign
id|slot_offset
suffix:semicolon
id|info.recno
op_assign
id|rec-&gt;rec_tail.recno
suffix:semicolon
id|info.kml_offset
op_assign
id|rec-&gt;rec_kml_offset
suffix:semicolon
id|info.flags
op_assign
l_int|0
suffix:semicolon
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
(paren
id|get_ds
c_func
(paren
)paren
)paren
suffix:semicolon
id|error
op_assign
id|lento_mknod
(paren
id|mknod-&gt;path
comma
id|mknod-&gt;mode
comma
id|MKDEV
c_func
(paren
id|mknod-&gt;major
comma
id|mknod-&gt;minor
)paren
comma
op_amp
id|info
)paren
suffix:semicolon
id|set_fs
(paren
id|old_fs
)paren
suffix:semicolon
id|kmlreint_post_secure
(paren
id|rec
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|kml_reint
r_int
id|kml_reint
(paren
r_char
op_star
id|mtpt
comma
r_int
id|slot_offset
comma
r_struct
id|kml_rec
op_star
id|rec
)paren
(brace
r_int
id|error
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|rec-&gt;rec_head.opcode
)paren
(brace
r_case
id|KML_CREATE
suffix:colon
id|error
op_assign
id|reint_create
(paren
id|slot_offset
comma
id|rec
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_OPEN
suffix:colon
id|error
op_assign
id|reint_open
(paren
id|slot_offset
comma
id|rec
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_CLOSE
suffix:colon
multiline_comment|/* error = reint_close (slot_offset, rec);&n;                           force the system to return to lento */
id|error
op_assign
id|KML_CLOSE_BACKFETCH
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_MKDIR
suffix:colon
id|error
op_assign
id|reint_mkdir
(paren
id|slot_offset
comma
id|rec
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_RMDIR
suffix:colon
id|error
op_assign
id|reint_rmdir
(paren
id|slot_offset
comma
id|rec
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_UNLINK
suffix:colon
id|error
op_assign
id|reint_unlink
(paren
id|slot_offset
comma
id|rec
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_LINK
suffix:colon
id|error
op_assign
id|reint_link
(paren
id|slot_offset
comma
id|rec
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_SYMLINK
suffix:colon
id|error
op_assign
id|reint_symlink
(paren
id|slot_offset
comma
id|rec
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_RENAME
suffix:colon
id|error
op_assign
id|reint_rename
(paren
id|slot_offset
comma
id|rec
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_SETATTR
suffix:colon
id|error
op_assign
id|reint_setattr
(paren
id|slot_offset
comma
id|rec
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KML_MKNOD
suffix:colon
id|error
op_assign
id|reint_mknod
(paren
id|slot_offset
comma
id|rec
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;wrong opcode::%d&bslash;n&quot;
comma
id|rec-&gt;rec_head.opcode
)paren
suffix:semicolon
r_return
op_minus
id|EBADF
suffix:semicolon
)brace
r_if
c_cond
(paren
id|error
op_ne
l_int|0
op_logical_and
id|error
op_ne
id|KML_CLOSE_BACKFETCH
)paren
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;KML_ERROR::error = %d&bslash;n&quot;
comma
id|error
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/* return the old mtpt */
multiline_comment|/*&n;struct fs_struct {&n;        atomic_t count;&n;        int umask;&n;        struct dentry * root, * pwd;&n;};&n;*/
DECL|function|do_set_fs_root
r_static
r_int
id|do_set_fs_root
(paren
r_struct
id|dentry
op_star
id|newroot
comma
r_struct
id|dentry
op_star
op_star
id|old_root
)paren
(brace
r_struct
id|dentry
op_star
id|de
op_assign
id|current-&gt;fs-&gt;root
suffix:semicolon
id|current-&gt;fs-&gt;root
op_assign
id|newroot
suffix:semicolon
r_if
c_cond
(paren
id|old_root
op_ne
(paren
r_struct
id|dentry
op_star
op_star
)paren
l_int|NULL
)paren
op_star
id|old_root
op_assign
id|de
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|set_system_mtpt
r_static
r_int
id|set_system_mtpt
(paren
r_char
op_star
id|mtpt
comma
r_struct
id|dentry
op_star
op_star
id|old_root
)paren
(brace
r_struct
id|nameidata
id|nd
suffix:semicolon
r_struct
id|dentry
op_star
id|dentry
suffix:semicolon
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
id|path_init
c_func
(paren
id|pathname
comma
id|LOOKUP_PARENT
comma
op_amp
id|nd
)paren
)paren
id|error
op_assign
id|path_walk
c_func
(paren
id|mtpt
comma
op_amp
id|nd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
id|CDEBUG
(paren
id|D_KML
comma
l_string|&quot;Yean!!!!::Can&squot;t find mtpt::%s&bslash;n&quot;
comma
id|mtpt
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|dentry
op_assign
id|nd.dentry
suffix:semicolon
id|error
op_assign
id|do_set_fs_root
(paren
id|dentry
comma
id|old_root
)paren
suffix:semicolon
id|path_release
(paren
op_amp
id|nd
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
DECL|function|kml_reintbuf
r_int
id|kml_reintbuf
(paren
r_struct
id|kml_fsdata
op_star
id|kml_fsdata
comma
r_char
op_star
id|mtpt
comma
r_struct
id|kml_rec
op_star
op_star
id|close_rec
)paren
(brace
r_struct
id|kml_rec
op_star
id|rec
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|list_head
op_star
id|head
comma
op_star
id|tmp
suffix:semicolon
r_struct
id|dentry
op_star
id|old_root
suffix:semicolon
r_int
id|error
op_assign
l_int|0
suffix:semicolon
id|head
op_assign
op_amp
id|kml_fsdata-&gt;kml_reint_cache
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
id|head
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|kml_fsdata-&gt;kml_reint_current
op_eq
l_int|NULL
op_logical_or
id|kml_fsdata-&gt;kml_reint_current
op_eq
id|head-&gt;next
)paren
r_return
l_int|0
suffix:semicolon
id|error
op_assign
id|set_system_mtpt
(paren
id|mtpt
comma
op_amp
id|old_root
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|error
suffix:semicolon
id|tmp
op_assign
id|head-&gt;next
suffix:semicolon
r_while
c_loop
(paren
id|error
op_eq
l_int|0
op_logical_and
id|tmp
op_ne
id|head
)paren
(brace
id|rec
op_assign
id|list_entry
c_func
(paren
id|tmp
comma
r_struct
id|kml_rec
comma
id|kml_optimize.kml_chains
)paren
suffix:semicolon
id|error
op_assign
id|kml_reint
(paren
id|mtpt
comma
id|rec-&gt;rec_kml_offset
comma
id|rec
)paren
suffix:semicolon
id|tmp
op_assign
id|tmp-&gt;next
suffix:semicolon
)brace
id|do_set_fs_root
(paren
id|old_root
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
op_eq
id|KML_CLOSE_BACKFETCH
)paren
op_star
id|close_rec
op_assign
id|rec
suffix:semicolon
id|kml_fsdata-&gt;kml_reint_current
op_assign
id|tmp
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
eof
