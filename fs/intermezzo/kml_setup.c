macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/intermezzo_fs.h&gt;
macro_line|#include &lt;linux/intermezzo_upcall.h&gt;
macro_line|#include &lt;linux/intermezzo_psdev.h&gt;
macro_line|#include &lt;linux/intermezzo_kml.h&gt;
DECL|function|kml_init
r_int
id|kml_init
(paren
r_struct
id|presto_file_set
op_star
id|fset
)paren
(brace
r_struct
id|kml_fsdata
op_star
id|data
suffix:semicolon
id|ENTRY
suffix:semicolon
id|PRESTO_ALLOC
(paren
id|data
comma
r_struct
id|kml_fsdata
op_star
comma
r_sizeof
(paren
r_struct
id|kml_fsdata
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_eq
l_int|NULL
)paren
(brace
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|INIT_LIST_HEAD
(paren
op_amp
id|data-&gt;kml_reint_cache
)paren
suffix:semicolon
id|INIT_LIST_HEAD
(paren
op_amp
id|data-&gt;kml_kop_cache
)paren
suffix:semicolon
id|PRESTO_ALLOC
(paren
id|data-&gt;kml_buf
comma
r_char
op_star
comma
id|KML_REINT_MAXBUF
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data-&gt;kml_buf
op_eq
l_int|NULL
)paren
(brace
id|PRESTO_FREE
(paren
id|data
comma
r_sizeof
(paren
r_struct
id|kml_fsdata
)paren
)paren
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|data-&gt;kml_maxsize
op_assign
id|KML_REINT_MAXBUF
suffix:semicolon
id|data-&gt;kml_len
op_assign
l_int|0
suffix:semicolon
id|data-&gt;kml_reintpos
op_assign
l_int|0
suffix:semicolon
id|data-&gt;kml_count
op_assign
l_int|0
suffix:semicolon
id|fset-&gt;fset_kmldata
op_assign
id|data
suffix:semicolon
id|EXIT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|kml_cleanup
r_int
id|kml_cleanup
(paren
r_struct
id|presto_file_set
op_star
id|fset
)paren
(brace
r_struct
id|kml_fsdata
op_star
id|data
op_assign
id|fset-&gt;fset_kmldata
suffix:semicolon
r_if
c_cond
(paren
id|data
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|fset-&gt;fset_kmldata
op_assign
l_int|NULL
suffix:semicolon
macro_line|#if 0
id|kml_sop_cleanup
(paren
op_amp
id|data-&gt;kml_reint_cache
)paren
suffix:semicolon
id|kml_kop_cleanup
(paren
op_amp
id|data-&gt;kml_kop_cache
)paren
suffix:semicolon
macro_line|#endif
id|PRESTO_FREE
(paren
id|data-&gt;kml_buf
comma
id|KML_REINT_MAXBUF
)paren
suffix:semicolon
id|PRESTO_FREE
(paren
id|data
comma
r_sizeof
(paren
r_struct
id|kml_fsdata
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
