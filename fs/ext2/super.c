multiline_comment|/*&n; *  linux/fs/ext2/super.c&n; *&n; * Copyright (C) 1992, 1993, 1994, 1995&n; * Remy Card (card@masi.ibp.fr)&n; * Laboratoire MASI - Institut Blaise Pascal&n; * Universite Pierre et Marie Curie (Paris VI)&n; *&n; *  from&n; *&n; *  linux/fs/minix/inode.c&n; *&n; *  Copyright (C) 1991, 1992  Linus Torvalds&n; *&n; *  Big-endian to little-endian byte-swapping/bitmaps by&n; *        David S. Miller (davem@caip.rutgers.edu), 1995&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/blkdev.h&gt;
macro_line|#include &lt;linux/parser.h&gt;
macro_line|#include &lt;linux/random.h&gt;
macro_line|#include &lt;linux/buffer_head.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/vfs.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &quot;ext2.h&quot;
macro_line|#include &quot;xattr.h&quot;
macro_line|#include &quot;acl.h&quot;
r_static
r_void
id|ext2_sync_super
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|ext2_super_block
op_star
id|es
)paren
suffix:semicolon
r_static
r_int
id|ext2_remount
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_int
op_star
id|flags
comma
r_char
op_star
id|data
)paren
suffix:semicolon
r_static
r_int
id|ext2_statfs
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|kstatfs
op_star
id|buf
)paren
suffix:semicolon
DECL|function|ext2_error
r_void
id|ext2_error
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_const
r_char
op_star
id|function
comma
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
r_struct
id|ext2_sb_info
op_star
id|sbi
op_assign
id|EXT2_SB
c_func
(paren
id|sb
)paren
suffix:semicolon
r_struct
id|ext2_super_block
op_star
id|es
op_assign
id|sbi-&gt;s_es
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sb-&gt;s_flags
op_amp
id|MS_RDONLY
)paren
)paren
(brace
id|sbi-&gt;s_mount_state
op_or_assign
id|EXT2_ERROR_FS
suffix:semicolon
id|es-&gt;s_state
op_assign
id|cpu_to_le16
c_func
(paren
id|le16_to_cpu
c_func
(paren
id|es-&gt;s_state
)paren
op_or
id|EXT2_ERROR_FS
)paren
suffix:semicolon
id|ext2_sync_super
c_func
(paren
id|sb
comma
id|es
)paren
suffix:semicolon
)brace
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;EXT2-fs error (device %s): %s: &quot;
comma
id|sb-&gt;s_id
comma
id|function
)paren
suffix:semicolon
id|vprintk
c_func
(paren
id|fmt
comma
id|args
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_opt
c_func
(paren
id|sb
comma
id|ERRORS_PANIC
)paren
)paren
id|panic
c_func
(paren
l_string|&quot;EXT2-fs panic from previous error&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_opt
c_func
(paren
id|sb
comma
id|ERRORS_RO
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Remounting filesystem read-only&bslash;n&quot;
)paren
suffix:semicolon
id|sb-&gt;s_flags
op_or_assign
id|MS_RDONLY
suffix:semicolon
)brace
)brace
DECL|function|ext2_warning
r_void
id|ext2_warning
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_const
r_char
op_star
id|function
comma
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;EXT2-fs warning (device %s): %s: &quot;
comma
id|sb-&gt;s_id
comma
id|function
)paren
suffix:semicolon
id|vprintk
c_func
(paren
id|fmt
comma
id|args
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
)brace
DECL|function|ext2_update_dynamic_rev
r_void
id|ext2_update_dynamic_rev
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_struct
id|ext2_super_block
op_star
id|es
op_assign
id|EXT2_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_es
suffix:semicolon
r_if
c_cond
(paren
id|le32_to_cpu
c_func
(paren
id|es-&gt;s_rev_level
)paren
OG
id|EXT2_GOOD_OLD_REV
)paren
r_return
suffix:semicolon
id|ext2_warning
c_func
(paren
id|sb
comma
id|__FUNCTION__
comma
l_string|&quot;updating to rev %d because of new feature flag, &quot;
l_string|&quot;running e2fsck is recommended&quot;
comma
id|EXT2_DYNAMIC_REV
)paren
suffix:semicolon
id|es-&gt;s_first_ino
op_assign
id|cpu_to_le32
c_func
(paren
id|EXT2_GOOD_OLD_FIRST_INO
)paren
suffix:semicolon
id|es-&gt;s_inode_size
op_assign
id|cpu_to_le16
c_func
(paren
id|EXT2_GOOD_OLD_INODE_SIZE
)paren
suffix:semicolon
id|es-&gt;s_rev_level
op_assign
id|cpu_to_le32
c_func
(paren
id|EXT2_DYNAMIC_REV
)paren
suffix:semicolon
multiline_comment|/* leave es-&gt;s_feature_*compat flags alone */
multiline_comment|/* es-&gt;s_uuid will be set by e2fsck if empty */
multiline_comment|/*&n;&t; * The rest of the superblock fields should be zero, and if not it&n;&t; * means they are likely already in use, so leave them alone.  We&n;&t; * can leave it up to e2fsck to clean up any inconsistencies there.&n;&t; */
)brace
DECL|function|ext2_put_super
r_static
r_void
id|ext2_put_super
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_int
id|db_count
suffix:semicolon
r_int
id|i
suffix:semicolon
r_struct
id|ext2_sb_info
op_star
id|sbi
op_assign
id|EXT2_SB
c_func
(paren
id|sb
)paren
suffix:semicolon
id|ext2_xattr_put_super
c_func
(paren
id|sb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sb-&gt;s_flags
op_amp
id|MS_RDONLY
)paren
)paren
(brace
r_struct
id|ext2_super_block
op_star
id|es
op_assign
id|sbi-&gt;s_es
suffix:semicolon
id|es-&gt;s_state
op_assign
id|cpu_to_le16
c_func
(paren
id|sbi-&gt;s_mount_state
)paren
suffix:semicolon
id|ext2_sync_super
c_func
(paren
id|sb
comma
id|es
)paren
suffix:semicolon
)brace
id|db_count
op_assign
id|sbi-&gt;s_gdb_count
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|db_count
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|sbi-&gt;s_group_desc
(braket
id|i
)braket
)paren
id|brelse
(paren
id|sbi-&gt;s_group_desc
(braket
id|i
)braket
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sbi-&gt;s_group_desc
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sbi-&gt;s_debts
)paren
suffix:semicolon
id|percpu_counter_destroy
c_func
(paren
op_amp
id|sbi-&gt;s_freeblocks_counter
)paren
suffix:semicolon
id|percpu_counter_destroy
c_func
(paren
op_amp
id|sbi-&gt;s_freeinodes_counter
)paren
suffix:semicolon
id|percpu_counter_destroy
c_func
(paren
op_amp
id|sbi-&gt;s_dirs_counter
)paren
suffix:semicolon
id|brelse
(paren
id|sbi-&gt;s_sbh
)paren
suffix:semicolon
id|sb-&gt;s_fs_info
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|sbi
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|variable|ext2_inode_cachep
r_static
id|kmem_cache_t
op_star
id|ext2_inode_cachep
suffix:semicolon
DECL|function|ext2_alloc_inode
r_static
r_struct
id|inode
op_star
id|ext2_alloc_inode
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_struct
id|ext2_inode_info
op_star
id|ei
suffix:semicolon
id|ei
op_assign
(paren
r_struct
id|ext2_inode_info
op_star
)paren
id|kmem_cache_alloc
c_func
(paren
id|ext2_inode_cachep
comma
id|SLAB_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ei
)paren
r_return
l_int|NULL
suffix:semicolon
macro_line|#ifdef CONFIG_EXT2_FS_POSIX_ACL
id|ei-&gt;i_acl
op_assign
id|EXT2_ACL_NOT_CACHED
suffix:semicolon
id|ei-&gt;i_default_acl
op_assign
id|EXT2_ACL_NOT_CACHED
suffix:semicolon
macro_line|#endif
id|ei-&gt;vfs_inode.i_version
op_assign
l_int|1
suffix:semicolon
r_return
op_amp
id|ei-&gt;vfs_inode
suffix:semicolon
)brace
DECL|function|ext2_destroy_inode
r_static
r_void
id|ext2_destroy_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
id|kmem_cache_free
c_func
(paren
id|ext2_inode_cachep
comma
id|EXT2_I
c_func
(paren
id|inode
)paren
)paren
suffix:semicolon
)brace
DECL|function|init_once
r_static
r_void
id|init_once
c_func
(paren
r_void
op_star
id|foo
comma
id|kmem_cache_t
op_star
id|cachep
comma
r_int
r_int
id|flags
)paren
(brace
r_struct
id|ext2_inode_info
op_star
id|ei
op_assign
(paren
r_struct
id|ext2_inode_info
op_star
)paren
id|foo
suffix:semicolon
r_if
c_cond
(paren
(paren
id|flags
op_amp
(paren
id|SLAB_CTOR_VERIFY
op_or
id|SLAB_CTOR_CONSTRUCTOR
)paren
)paren
op_eq
id|SLAB_CTOR_CONSTRUCTOR
)paren
(brace
id|rwlock_init
c_func
(paren
op_amp
id|ei-&gt;i_meta_lock
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_EXT2_FS_XATTR
id|init_rwsem
c_func
(paren
op_amp
id|ei-&gt;xattr_sem
)paren
suffix:semicolon
macro_line|#endif
id|inode_init_once
c_func
(paren
op_amp
id|ei-&gt;vfs_inode
)paren
suffix:semicolon
)brace
)brace
DECL|function|init_inodecache
r_static
r_int
id|init_inodecache
c_func
(paren
r_void
)paren
(brace
id|ext2_inode_cachep
op_assign
id|kmem_cache_create
c_func
(paren
l_string|&quot;ext2_inode_cache&quot;
comma
r_sizeof
(paren
r_struct
id|ext2_inode_info
)paren
comma
l_int|0
comma
id|SLAB_RECLAIM_ACCOUNT
comma
id|init_once
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ext2_inode_cachep
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|destroy_inodecache
r_static
r_void
id|destroy_inodecache
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|kmem_cache_destroy
c_func
(paren
id|ext2_inode_cachep
)paren
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ext2_inode_cache: not all structures were freed&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|ext2_clear_inode
r_static
r_void
id|ext2_clear_inode
c_func
(paren
r_struct
id|inode
op_star
id|inode
)paren
(brace
macro_line|#ifdef CONFIG_EXT2_FS_POSIX_ACL
r_struct
id|ext2_inode_info
op_star
id|ei
op_assign
id|EXT2_I
c_func
(paren
id|inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ei-&gt;i_acl
op_logical_and
id|ei-&gt;i_acl
op_ne
id|EXT2_ACL_NOT_CACHED
)paren
(brace
id|posix_acl_release
c_func
(paren
id|ei-&gt;i_acl
)paren
suffix:semicolon
id|ei-&gt;i_acl
op_assign
id|EXT2_ACL_NOT_CACHED
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ei-&gt;i_default_acl
op_logical_and
id|ei-&gt;i_default_acl
op_ne
id|EXT2_ACL_NOT_CACHED
)paren
(brace
id|posix_acl_release
c_func
(paren
id|ei-&gt;i_default_acl
)paren
suffix:semicolon
id|ei-&gt;i_default_acl
op_assign
id|EXT2_ACL_NOT_CACHED
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|is_bad_inode
c_func
(paren
id|inode
)paren
)paren
id|ext2_discard_prealloc
c_func
(paren
id|inode
)paren
suffix:semicolon
)brace
DECL|variable|ext2_sops
r_static
r_struct
id|super_operations
id|ext2_sops
op_assign
(brace
dot
id|alloc_inode
op_assign
id|ext2_alloc_inode
comma
dot
id|destroy_inode
op_assign
id|ext2_destroy_inode
comma
dot
id|read_inode
op_assign
id|ext2_read_inode
comma
dot
id|write_inode
op_assign
id|ext2_write_inode
comma
dot
id|delete_inode
op_assign
id|ext2_delete_inode
comma
dot
id|put_super
op_assign
id|ext2_put_super
comma
dot
id|write_super
op_assign
id|ext2_write_super
comma
dot
id|statfs
op_assign
id|ext2_statfs
comma
dot
id|remount_fs
op_assign
id|ext2_remount
comma
dot
id|clear_inode
op_assign
id|ext2_clear_inode
comma
)brace
suffix:semicolon
multiline_comment|/* Yes, most of these are left as NULL!!&n; * A NULL value implies the default, which works with ext2-like file&n; * systems, but can be improved upon.&n; * Currently only get_parent is required.&n; */
r_struct
id|dentry
op_star
id|ext2_get_parent
c_func
(paren
r_struct
id|dentry
op_star
id|child
)paren
suffix:semicolon
DECL|variable|ext2_export_ops
r_static
r_struct
id|export_operations
id|ext2_export_ops
op_assign
(brace
dot
id|get_parent
op_assign
id|ext2_get_parent
comma
)brace
suffix:semicolon
DECL|function|get_sb_block
r_static
r_int
r_int
id|get_sb_block
c_func
(paren
r_void
op_star
op_star
id|data
)paren
(brace
r_int
r_int
id|sb_block
suffix:semicolon
r_char
op_star
id|options
op_assign
(paren
r_char
op_star
)paren
op_star
id|data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
op_logical_or
id|strncmp
c_func
(paren
id|options
comma
l_string|&quot;sb=&quot;
comma
l_int|3
)paren
op_ne
l_int|0
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/* Default location */
id|options
op_add_assign
l_int|3
suffix:semicolon
id|sb_block
op_assign
id|simple_strtoul
c_func
(paren
id|options
comma
op_amp
id|options
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|options
op_logical_and
op_star
id|options
op_ne
l_char|&squot;,&squot;
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;EXT2-fs: Invalid sb specification: %s&bslash;n&quot;
comma
(paren
r_char
op_star
)paren
op_star
id|data
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|options
op_eq
l_char|&squot;,&squot;
)paren
id|options
op_increment
suffix:semicolon
op_star
id|data
op_assign
(paren
r_void
op_star
)paren
id|options
suffix:semicolon
r_return
id|sb_block
suffix:semicolon
)brace
r_enum
(brace
DECL|enumerator|Opt_bsd_df
DECL|enumerator|Opt_minix_df
DECL|enumerator|Opt_grpid
DECL|enumerator|Opt_nogrpid
id|Opt_bsd_df
comma
id|Opt_minix_df
comma
id|Opt_grpid
comma
id|Opt_nogrpid
comma
DECL|enumerator|Opt_resgid
DECL|enumerator|Opt_resuid
DECL|enumerator|Opt_sb
DECL|enumerator|Opt_err_cont
DECL|enumerator|Opt_err_panic
DECL|enumerator|Opt_err_ro
id|Opt_resgid
comma
id|Opt_resuid
comma
id|Opt_sb
comma
id|Opt_err_cont
comma
id|Opt_err_panic
comma
id|Opt_err_ro
comma
DECL|enumerator|Opt_nouid32
DECL|enumerator|Opt_check
DECL|enumerator|Opt_nocheck
DECL|enumerator|Opt_debug
DECL|enumerator|Opt_oldalloc
DECL|enumerator|Opt_orlov
DECL|enumerator|Opt_nobh
id|Opt_nouid32
comma
id|Opt_check
comma
id|Opt_nocheck
comma
id|Opt_debug
comma
id|Opt_oldalloc
comma
id|Opt_orlov
comma
id|Opt_nobh
comma
DECL|enumerator|Opt_user_xattr
DECL|enumerator|Opt_nouser_xattr
DECL|enumerator|Opt_acl
DECL|enumerator|Opt_noacl
id|Opt_user_xattr
comma
id|Opt_nouser_xattr
comma
id|Opt_acl
comma
id|Opt_noacl
comma
DECL|enumerator|Opt_ignore
DECL|enumerator|Opt_err
id|Opt_ignore
comma
id|Opt_err
comma
)brace
suffix:semicolon
DECL|variable|tokens
r_static
id|match_table_t
id|tokens
op_assign
(brace
(brace
id|Opt_bsd_df
comma
l_string|&quot;bsddf&quot;
)brace
comma
(brace
id|Opt_minix_df
comma
l_string|&quot;minixdf&quot;
)brace
comma
(brace
id|Opt_grpid
comma
l_string|&quot;grpid&quot;
)brace
comma
(brace
id|Opt_grpid
comma
l_string|&quot;bsdgroups&quot;
)brace
comma
(brace
id|Opt_nogrpid
comma
l_string|&quot;nogrpid&quot;
)brace
comma
(brace
id|Opt_nogrpid
comma
l_string|&quot;sysvgroups&quot;
)brace
comma
(brace
id|Opt_resgid
comma
l_string|&quot;resgid=%u&quot;
)brace
comma
(brace
id|Opt_resuid
comma
l_string|&quot;resuid=%u&quot;
)brace
comma
(brace
id|Opt_sb
comma
l_string|&quot;sb=%u&quot;
)brace
comma
(brace
id|Opt_err_cont
comma
l_string|&quot;errors=continue&quot;
)brace
comma
(brace
id|Opt_err_panic
comma
l_string|&quot;errors=panic&quot;
)brace
comma
(brace
id|Opt_err_ro
comma
l_string|&quot;errors=remount-ro&quot;
)brace
comma
(brace
id|Opt_nouid32
comma
l_string|&quot;nouid32&quot;
)brace
comma
(brace
id|Opt_nocheck
comma
l_string|&quot;check=none&quot;
)brace
comma
(brace
id|Opt_nocheck
comma
l_string|&quot;nocheck&quot;
)brace
comma
(brace
id|Opt_check
comma
l_string|&quot;check&quot;
)brace
comma
(brace
id|Opt_debug
comma
l_string|&quot;debug&quot;
)brace
comma
(brace
id|Opt_oldalloc
comma
l_string|&quot;oldalloc&quot;
)brace
comma
(brace
id|Opt_orlov
comma
l_string|&quot;orlov&quot;
)brace
comma
(brace
id|Opt_nobh
comma
l_string|&quot;nobh&quot;
)brace
comma
(brace
id|Opt_user_xattr
comma
l_string|&quot;user_xattr&quot;
)brace
comma
(brace
id|Opt_nouser_xattr
comma
l_string|&quot;nouser_xattr&quot;
)brace
comma
(brace
id|Opt_acl
comma
l_string|&quot;acl&quot;
)brace
comma
(brace
id|Opt_noacl
comma
l_string|&quot;noacl&quot;
)brace
comma
(brace
id|Opt_ignore
comma
l_string|&quot;grpquota&quot;
)brace
comma
(brace
id|Opt_ignore
comma
l_string|&quot;noquota&quot;
)brace
comma
(brace
id|Opt_ignore
comma
l_string|&quot;quota&quot;
)brace
comma
(brace
id|Opt_ignore
comma
l_string|&quot;usrquota&quot;
)brace
comma
(brace
id|Opt_err
comma
l_int|NULL
)brace
)brace
suffix:semicolon
DECL|function|parse_options
r_static
r_int
id|parse_options
(paren
r_char
op_star
id|options
comma
r_struct
id|ext2_sb_info
op_star
id|sbi
)paren
(brace
r_char
op_star
id|p
suffix:semicolon
id|substring_t
id|args
(braket
id|MAX_OPT_ARGS
)braket
suffix:semicolon
r_int
r_int
id|kind
op_assign
id|EXT2_MOUNT_ERRORS_CONT
suffix:semicolon
r_int
id|option
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|options
)paren
r_return
l_int|1
suffix:semicolon
r_while
c_loop
(paren
(paren
id|p
op_assign
id|strsep
(paren
op_amp
id|options
comma
l_string|&quot;,&quot;
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_int
id|token
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|p
)paren
r_continue
suffix:semicolon
id|token
op_assign
id|match_token
c_func
(paren
id|p
comma
id|tokens
comma
id|args
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|token
)paren
(brace
r_case
id|Opt_bsd_df
suffix:colon
id|clear_opt
(paren
id|sbi-&gt;s_mount_opt
comma
id|MINIX_DF
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|Opt_minix_df
suffix:colon
id|set_opt
(paren
id|sbi-&gt;s_mount_opt
comma
id|MINIX_DF
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|Opt_grpid
suffix:colon
id|set_opt
(paren
id|sbi-&gt;s_mount_opt
comma
id|GRPID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|Opt_nogrpid
suffix:colon
id|clear_opt
(paren
id|sbi-&gt;s_mount_opt
comma
id|GRPID
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|Opt_resuid
suffix:colon
r_if
c_cond
(paren
id|match_int
c_func
(paren
op_amp
id|args
(braket
l_int|0
)braket
comma
op_amp
id|option
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|sbi-&gt;s_resuid
op_assign
id|option
suffix:semicolon
r_break
suffix:semicolon
r_case
id|Opt_resgid
suffix:colon
r_if
c_cond
(paren
id|match_int
c_func
(paren
op_amp
id|args
(braket
l_int|0
)braket
comma
op_amp
id|option
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|sbi-&gt;s_resgid
op_assign
id|option
suffix:semicolon
r_break
suffix:semicolon
r_case
id|Opt_sb
suffix:colon
multiline_comment|/* handled by get_sb_block() instead of here */
multiline_comment|/* *sb_block = match_int(&amp;args[0]); */
r_break
suffix:semicolon
r_case
id|Opt_err_panic
suffix:colon
id|kind
op_assign
id|EXT2_MOUNT_ERRORS_PANIC
suffix:semicolon
r_break
suffix:semicolon
r_case
id|Opt_err_ro
suffix:colon
id|kind
op_assign
id|EXT2_MOUNT_ERRORS_RO
suffix:semicolon
r_break
suffix:semicolon
r_case
id|Opt_err_cont
suffix:colon
id|kind
op_assign
id|EXT2_MOUNT_ERRORS_CONT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|Opt_nouid32
suffix:colon
id|set_opt
(paren
id|sbi-&gt;s_mount_opt
comma
id|NO_UID32
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|Opt_check
suffix:colon
macro_line|#ifdef CONFIG_EXT2_CHECK
id|set_opt
(paren
id|sbi-&gt;s_mount_opt
comma
id|CHECK
)paren
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
l_string|&quot;EXT2 Check option not supported&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|Opt_nocheck
suffix:colon
id|clear_opt
(paren
id|sbi-&gt;s_mount_opt
comma
id|CHECK
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|Opt_debug
suffix:colon
id|set_opt
(paren
id|sbi-&gt;s_mount_opt
comma
id|DEBUG
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|Opt_oldalloc
suffix:colon
id|set_opt
(paren
id|sbi-&gt;s_mount_opt
comma
id|OLDALLOC
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|Opt_orlov
suffix:colon
id|clear_opt
(paren
id|sbi-&gt;s_mount_opt
comma
id|OLDALLOC
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|Opt_nobh
suffix:colon
id|set_opt
(paren
id|sbi-&gt;s_mount_opt
comma
id|NOBH
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_EXT2_FS_XATTR
r_case
id|Opt_user_xattr
suffix:colon
id|set_opt
(paren
id|sbi-&gt;s_mount_opt
comma
id|XATTR_USER
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|Opt_nouser_xattr
suffix:colon
id|clear_opt
(paren
id|sbi-&gt;s_mount_opt
comma
id|XATTR_USER
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#else
r_case
id|Opt_user_xattr
suffix:colon
r_case
id|Opt_nouser_xattr
suffix:colon
id|printk
c_func
(paren
l_string|&quot;EXT2 (no)user_xattr options not supported&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_EXT2_FS_POSIX_ACL
r_case
id|Opt_acl
suffix:colon
id|set_opt
c_func
(paren
id|sbi-&gt;s_mount_opt
comma
id|POSIX_ACL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|Opt_noacl
suffix:colon
id|clear_opt
c_func
(paren
id|sbi-&gt;s_mount_opt
comma
id|POSIX_ACL
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#else
r_case
id|Opt_acl
suffix:colon
r_case
id|Opt_noacl
suffix:colon
id|printk
c_func
(paren
l_string|&quot;EXT2 (no)acl options not supported&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_case
id|Opt_ignore
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|sbi-&gt;s_mount_opt
op_or_assign
id|kind
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|ext2_setup_super
r_static
r_int
id|ext2_setup_super
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|ext2_super_block
op_star
id|es
comma
r_int
id|read_only
)paren
(brace
r_int
id|res
op_assign
l_int|0
suffix:semicolon
r_struct
id|ext2_sb_info
op_star
id|sbi
op_assign
id|EXT2_SB
c_func
(paren
id|sb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|le32_to_cpu
c_func
(paren
id|es-&gt;s_rev_level
)paren
OG
id|EXT2_MAX_SUPP_REV
)paren
(brace
id|printk
(paren
l_string|&quot;EXT2-fs warning: revision level too high, &quot;
l_string|&quot;forcing read-only mode&bslash;n&quot;
)paren
suffix:semicolon
id|res
op_assign
id|MS_RDONLY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|read_only
)paren
r_return
id|res
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sbi-&gt;s_mount_state
op_amp
id|EXT2_VALID_FS
)paren
)paren
id|printk
(paren
l_string|&quot;EXT2-fs warning: mounting unchecked fs, &quot;
l_string|&quot;running e2fsck is recommended&bslash;n&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|sbi-&gt;s_mount_state
op_amp
id|EXT2_ERROR_FS
)paren
)paren
id|printk
(paren
l_string|&quot;EXT2-fs warning: mounting fs with errors, &quot;
l_string|&quot;running e2fsck is recommended&bslash;n&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|__s16
)paren
id|le16_to_cpu
c_func
(paren
id|es-&gt;s_max_mnt_count
)paren
op_ge
l_int|0
op_logical_and
id|le16_to_cpu
c_func
(paren
id|es-&gt;s_mnt_count
)paren
op_ge
(paren
r_int
r_int
)paren
(paren
id|__s16
)paren
id|le16_to_cpu
c_func
(paren
id|es-&gt;s_max_mnt_count
)paren
)paren
id|printk
(paren
l_string|&quot;EXT2-fs warning: maximal mount count reached, &quot;
l_string|&quot;running e2fsck is recommended&bslash;n&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|le32_to_cpu
c_func
(paren
id|es-&gt;s_checkinterval
)paren
op_logical_and
(paren
id|le32_to_cpu
c_func
(paren
id|es-&gt;s_lastcheck
)paren
op_plus
id|le32_to_cpu
c_func
(paren
id|es-&gt;s_checkinterval
)paren
op_le
id|get_seconds
c_func
(paren
)paren
)paren
)paren
id|printk
(paren
l_string|&quot;EXT2-fs warning: checktime reached, &quot;
l_string|&quot;running e2fsck is recommended&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|le16_to_cpu
c_func
(paren
id|es-&gt;s_max_mnt_count
)paren
)paren
id|es-&gt;s_max_mnt_count
op_assign
id|cpu_to_le16
c_func
(paren
id|EXT2_DFL_MAX_MNT_COUNT
)paren
suffix:semicolon
id|es-&gt;s_mnt_count
op_assign
id|cpu_to_le16
c_func
(paren
id|le16_to_cpu
c_func
(paren
id|es-&gt;s_mnt_count
)paren
op_plus
l_int|1
)paren
suffix:semicolon
id|ext2_write_super
c_func
(paren
id|sb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_opt
(paren
id|sb
comma
id|DEBUG
)paren
)paren
id|printk
(paren
l_string|&quot;[EXT II FS %s, %s, bs=%lu, fs=%lu, gc=%lu, &quot;
l_string|&quot;bpg=%lu, ipg=%lu, mo=%04lx]&bslash;n&quot;
comma
id|EXT2FS_VERSION
comma
id|EXT2FS_DATE
comma
id|sb-&gt;s_blocksize
comma
id|sbi-&gt;s_frag_size
comma
id|sbi-&gt;s_groups_count
comma
id|EXT2_BLOCKS_PER_GROUP
c_func
(paren
id|sb
)paren
comma
id|EXT2_INODES_PER_GROUP
c_func
(paren
id|sb
)paren
comma
id|sbi-&gt;s_mount_opt
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_EXT2_CHECK
r_if
c_cond
(paren
id|test_opt
(paren
id|sb
comma
id|CHECK
)paren
)paren
(brace
id|ext2_check_blocks_bitmap
(paren
id|sb
)paren
suffix:semicolon
id|ext2_check_inodes_bitmap
(paren
id|sb
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
id|res
suffix:semicolon
)brace
DECL|function|ext2_check_descriptors
r_static
r_int
id|ext2_check_descriptors
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|desc_block
op_assign
l_int|0
suffix:semicolon
r_struct
id|ext2_sb_info
op_star
id|sbi
op_assign
id|EXT2_SB
c_func
(paren
id|sb
)paren
suffix:semicolon
r_int
r_int
id|block
op_assign
id|le32_to_cpu
c_func
(paren
id|sbi-&gt;s_es-&gt;s_first_data_block
)paren
suffix:semicolon
r_struct
id|ext2_group_desc
op_star
id|gdp
op_assign
l_int|NULL
suffix:semicolon
id|ext2_debug
(paren
l_string|&quot;Checking group descriptors&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sbi-&gt;s_groups_count
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|i
op_mod
id|EXT2_DESC_PER_BLOCK
c_func
(paren
id|sb
)paren
)paren
op_eq
l_int|0
)paren
id|gdp
op_assign
(paren
r_struct
id|ext2_group_desc
op_star
)paren
id|sbi-&gt;s_group_desc
(braket
id|desc_block
op_increment
)braket
op_member_access_from_pointer
id|b_data
suffix:semicolon
r_if
c_cond
(paren
id|le32_to_cpu
c_func
(paren
id|gdp-&gt;bg_block_bitmap
)paren
OL
id|block
op_logical_or
id|le32_to_cpu
c_func
(paren
id|gdp-&gt;bg_block_bitmap
)paren
op_ge
id|block
op_plus
id|EXT2_BLOCKS_PER_GROUP
c_func
(paren
id|sb
)paren
)paren
(brace
id|ext2_error
(paren
id|sb
comma
l_string|&quot;ext2_check_descriptors&quot;
comma
l_string|&quot;Block bitmap for group %d&quot;
l_string|&quot; not in group (block %lu)!&quot;
comma
id|i
comma
(paren
r_int
r_int
)paren
id|le32_to_cpu
c_func
(paren
id|gdp-&gt;bg_block_bitmap
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|le32_to_cpu
c_func
(paren
id|gdp-&gt;bg_inode_bitmap
)paren
OL
id|block
op_logical_or
id|le32_to_cpu
c_func
(paren
id|gdp-&gt;bg_inode_bitmap
)paren
op_ge
id|block
op_plus
id|EXT2_BLOCKS_PER_GROUP
c_func
(paren
id|sb
)paren
)paren
(brace
id|ext2_error
(paren
id|sb
comma
l_string|&quot;ext2_check_descriptors&quot;
comma
l_string|&quot;Inode bitmap for group %d&quot;
l_string|&quot; not in group (block %lu)!&quot;
comma
id|i
comma
(paren
r_int
r_int
)paren
id|le32_to_cpu
c_func
(paren
id|gdp-&gt;bg_inode_bitmap
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|le32_to_cpu
c_func
(paren
id|gdp-&gt;bg_inode_table
)paren
OL
id|block
op_logical_or
id|le32_to_cpu
c_func
(paren
id|gdp-&gt;bg_inode_table
)paren
op_plus
id|sbi-&gt;s_itb_per_group
op_ge
id|block
op_plus
id|EXT2_BLOCKS_PER_GROUP
c_func
(paren
id|sb
)paren
)paren
(brace
id|ext2_error
(paren
id|sb
comma
l_string|&quot;ext2_check_descriptors&quot;
comma
l_string|&quot;Inode table for group %d&quot;
l_string|&quot; not in group (block %lu)!&quot;
comma
id|i
comma
(paren
r_int
r_int
)paren
id|le32_to_cpu
c_func
(paren
id|gdp-&gt;bg_inode_table
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|block
op_add_assign
id|EXT2_BLOCKS_PER_GROUP
c_func
(paren
id|sb
)paren
suffix:semicolon
id|gdp
op_increment
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|macro|log2
mdefine_line|#define log2(n) ffz(~(n))
multiline_comment|/*&n; * Maximal file size.  There is a direct, and {,double-,triple-}indirect&n; * block limit, and also a limit of (2^32 - 1) 512-byte sectors in i_blocks.&n; * We need to be 1 filesystem block less than the 2^32 sector limit.&n; */
DECL|function|ext2_max_size
r_static
id|loff_t
id|ext2_max_size
c_func
(paren
r_int
id|bits
)paren
(brace
id|loff_t
id|res
op_assign
id|EXT2_NDIR_BLOCKS
suffix:semicolon
id|res
op_add_assign
l_int|1LL
op_lshift
(paren
id|bits
op_minus
l_int|2
)paren
suffix:semicolon
id|res
op_add_assign
l_int|1LL
op_lshift
(paren
l_int|2
op_star
(paren
id|bits
op_minus
l_int|2
)paren
)paren
suffix:semicolon
id|res
op_add_assign
l_int|1LL
op_lshift
(paren
l_int|3
op_star
(paren
id|bits
op_minus
l_int|2
)paren
)paren
suffix:semicolon
id|res
op_lshift_assign
id|bits
suffix:semicolon
r_if
c_cond
(paren
id|res
OG
(paren
l_int|512LL
op_lshift
l_int|32
)paren
op_minus
(paren
l_int|1
op_lshift
id|bits
)paren
)paren
id|res
op_assign
(paren
l_int|512LL
op_lshift
l_int|32
)paren
op_minus
(paren
l_int|1
op_lshift
id|bits
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|descriptor_loc
r_static
r_int
r_int
id|descriptor_loc
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_int
r_int
id|logic_sb_block
comma
r_int
id|nr
)paren
(brace
r_struct
id|ext2_sb_info
op_star
id|sbi
op_assign
id|EXT2_SB
c_func
(paren
id|sb
)paren
suffix:semicolon
r_int
r_int
id|bg
comma
id|first_data_block
comma
id|first_meta_bg
suffix:semicolon
r_int
id|has_super
op_assign
l_int|0
suffix:semicolon
id|first_data_block
op_assign
id|le32_to_cpu
c_func
(paren
id|sbi-&gt;s_es-&gt;s_first_data_block
)paren
suffix:semicolon
id|first_meta_bg
op_assign
id|le32_to_cpu
c_func
(paren
id|sbi-&gt;s_es-&gt;s_first_meta_bg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|EXT2_HAS_INCOMPAT_FEATURE
c_func
(paren
id|sb
comma
id|EXT2_FEATURE_INCOMPAT_META_BG
)paren
op_logical_or
id|nr
OL
id|first_meta_bg
)paren
r_return
(paren
id|logic_sb_block
op_plus
id|nr
op_plus
l_int|1
)paren
suffix:semicolon
id|bg
op_assign
id|sbi-&gt;s_desc_per_block
op_star
id|nr
suffix:semicolon
r_if
c_cond
(paren
id|ext2_bg_has_super
c_func
(paren
id|sb
comma
id|bg
)paren
)paren
id|has_super
op_assign
l_int|1
suffix:semicolon
r_return
(paren
id|first_data_block
op_plus
id|has_super
op_plus
(paren
id|bg
op_star
id|sbi-&gt;s_blocks_per_group
)paren
)paren
suffix:semicolon
)brace
DECL|function|ext2_fill_super
r_static
r_int
id|ext2_fill_super
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_void
op_star
id|data
comma
r_int
id|silent
)paren
(brace
r_struct
id|buffer_head
op_star
id|bh
suffix:semicolon
r_struct
id|ext2_sb_info
op_star
id|sbi
suffix:semicolon
r_struct
id|ext2_super_block
op_star
id|es
suffix:semicolon
r_struct
id|inode
op_star
id|root
suffix:semicolon
r_int
r_int
id|block
suffix:semicolon
r_int
r_int
id|sb_block
op_assign
id|get_sb_block
c_func
(paren
op_amp
id|data
)paren
suffix:semicolon
r_int
r_int
id|logic_sb_block
suffix:semicolon
r_int
r_int
id|offset
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|def_mount_opts
suffix:semicolon
r_int
id|blocksize
op_assign
id|BLOCK_SIZE
suffix:semicolon
r_int
id|db_count
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|__le32
id|features
suffix:semicolon
id|sbi
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|sbi
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sbi
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|sb-&gt;s_fs_info
op_assign
id|sbi
suffix:semicolon
id|memset
c_func
(paren
id|sbi
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|sbi
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * See what the current blocksize for the device is, and&n;&t; * use that as the blocksize.  Otherwise (or if the blocksize&n;&t; * is smaller than the default) use the default.&n;&t; * This is important for devices that have a hardware&n;&t; * sectorsize that is larger than the default.&n;&t; */
id|blocksize
op_assign
id|sb_min_blocksize
c_func
(paren
id|sb
comma
id|BLOCK_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|blocksize
)paren
(brace
id|printk
(paren
l_string|&quot;EXT2-fs: unable to set blocksize&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|failed_sbi
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * If the superblock doesn&squot;t start on a hardware sector boundary,&n;&t; * calculate the offset.  &n;&t; */
r_if
c_cond
(paren
id|blocksize
op_ne
id|BLOCK_SIZE
)paren
(brace
id|logic_sb_block
op_assign
(paren
id|sb_block
op_star
id|BLOCK_SIZE
)paren
op_div
id|blocksize
suffix:semicolon
id|offset
op_assign
(paren
id|sb_block
op_star
id|BLOCK_SIZE
)paren
op_mod
id|blocksize
suffix:semicolon
)brace
r_else
(brace
id|logic_sb_block
op_assign
id|sb_block
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|bh
op_assign
id|sb_bread
c_func
(paren
id|sb
comma
id|logic_sb_block
)paren
)paren
)paren
(brace
id|printk
(paren
l_string|&quot;EXT2-fs: unable to read superblock&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|failed_sbi
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Note: s_es must be initialized as soon as possible because&n;&t; *       some ext2 macro-instructions depend on its value&n;&t; */
id|es
op_assign
(paren
r_struct
id|ext2_super_block
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|bh-&gt;b_data
)paren
op_plus
id|offset
)paren
suffix:semicolon
id|sbi-&gt;s_es
op_assign
id|es
suffix:semicolon
id|sb-&gt;s_magic
op_assign
id|le16_to_cpu
c_func
(paren
id|es-&gt;s_magic
)paren
suffix:semicolon
id|sb-&gt;s_flags
op_or_assign
id|MS_ONE_SECOND
suffix:semicolon
r_if
c_cond
(paren
id|sb-&gt;s_magic
op_ne
id|EXT2_SUPER_MAGIC
)paren
r_goto
id|cantfind_ext2
suffix:semicolon
multiline_comment|/* Set defaults before we parse the mount options */
id|def_mount_opts
op_assign
id|le32_to_cpu
c_func
(paren
id|es-&gt;s_default_mount_opts
)paren
suffix:semicolon
r_if
c_cond
(paren
id|def_mount_opts
op_amp
id|EXT2_DEFM_DEBUG
)paren
id|set_opt
c_func
(paren
id|sbi-&gt;s_mount_opt
comma
id|DEBUG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|def_mount_opts
op_amp
id|EXT2_DEFM_BSDGROUPS
)paren
id|set_opt
c_func
(paren
id|sbi-&gt;s_mount_opt
comma
id|GRPID
)paren
suffix:semicolon
r_if
c_cond
(paren
id|def_mount_opts
op_amp
id|EXT2_DEFM_UID16
)paren
id|set_opt
c_func
(paren
id|sbi-&gt;s_mount_opt
comma
id|NO_UID32
)paren
suffix:semicolon
r_if
c_cond
(paren
id|def_mount_opts
op_amp
id|EXT2_DEFM_XATTR_USER
)paren
id|set_opt
c_func
(paren
id|sbi-&gt;s_mount_opt
comma
id|XATTR_USER
)paren
suffix:semicolon
r_if
c_cond
(paren
id|def_mount_opts
op_amp
id|EXT2_DEFM_ACL
)paren
id|set_opt
c_func
(paren
id|sbi-&gt;s_mount_opt
comma
id|POSIX_ACL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|le16_to_cpu
c_func
(paren
id|sbi-&gt;s_es-&gt;s_errors
)paren
op_eq
id|EXT2_ERRORS_PANIC
)paren
id|set_opt
c_func
(paren
id|sbi-&gt;s_mount_opt
comma
id|ERRORS_PANIC
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|le16_to_cpu
c_func
(paren
id|sbi-&gt;s_es-&gt;s_errors
)paren
op_eq
id|EXT2_ERRORS_RO
)paren
id|set_opt
c_func
(paren
id|sbi-&gt;s_mount_opt
comma
id|ERRORS_RO
)paren
suffix:semicolon
id|sbi-&gt;s_resuid
op_assign
id|le16_to_cpu
c_func
(paren
id|es-&gt;s_def_resuid
)paren
suffix:semicolon
id|sbi-&gt;s_resgid
op_assign
id|le16_to_cpu
c_func
(paren
id|es-&gt;s_def_resgid
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|parse_options
(paren
(paren
r_char
op_star
)paren
id|data
comma
id|sbi
)paren
)paren
r_goto
id|failed_mount
suffix:semicolon
id|sb-&gt;s_flags
op_assign
(paren
id|sb-&gt;s_flags
op_amp
op_complement
id|MS_POSIXACL
)paren
op_or
(paren
(paren
id|EXT2_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_mount_opt
op_amp
id|EXT2_MOUNT_POSIX_ACL
)paren
ques
c_cond
id|MS_POSIXACL
suffix:colon
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|le32_to_cpu
c_func
(paren
id|es-&gt;s_rev_level
)paren
op_eq
id|EXT2_GOOD_OLD_REV
op_logical_and
(paren
id|EXT2_HAS_COMPAT_FEATURE
c_func
(paren
id|sb
comma
op_complement
l_int|0U
)paren
op_logical_or
id|EXT2_HAS_RO_COMPAT_FEATURE
c_func
(paren
id|sb
comma
op_complement
l_int|0U
)paren
op_logical_or
id|EXT2_HAS_INCOMPAT_FEATURE
c_func
(paren
id|sb
comma
op_complement
l_int|0U
)paren
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;EXT2-fs warning: feature flags set on rev 0 fs, &quot;
l_string|&quot;running e2fsck is recommended&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Check feature flags regardless of the revision level, since we&n;&t; * previously didn&squot;t change the revision level when setting the flags,&n;&t; * so there is a chance incompat flags are set on a rev 0 filesystem.&n;&t; */
id|features
op_assign
id|EXT2_HAS_INCOMPAT_FEATURE
c_func
(paren
id|sb
comma
op_complement
id|EXT2_FEATURE_INCOMPAT_SUPP
)paren
suffix:semicolon
r_if
c_cond
(paren
id|features
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;EXT2-fs: %s: couldn&squot;t mount because of &quot;
l_string|&quot;unsupported optional features (%x).&bslash;n&quot;
comma
id|sb-&gt;s_id
comma
id|le32_to_cpu
c_func
(paren
id|features
)paren
)paren
suffix:semicolon
r_goto
id|failed_mount
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|sb-&gt;s_flags
op_amp
id|MS_RDONLY
)paren
op_logical_and
(paren
id|features
op_assign
id|EXT2_HAS_RO_COMPAT_FEATURE
c_func
(paren
id|sb
comma
op_complement
id|EXT2_FEATURE_RO_COMPAT_SUPP
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;EXT2-fs: %s: couldn&squot;t mount RDWR because of &quot;
l_string|&quot;unsupported optional features (%x).&bslash;n&quot;
comma
id|sb-&gt;s_id
comma
id|le32_to_cpu
c_func
(paren
id|features
)paren
)paren
suffix:semicolon
r_goto
id|failed_mount
suffix:semicolon
)brace
id|blocksize
op_assign
id|BLOCK_SIZE
op_lshift
id|le32_to_cpu
c_func
(paren
id|sbi-&gt;s_es-&gt;s_log_block_size
)paren
suffix:semicolon
multiline_comment|/* If the blocksize doesn&squot;t match, re-read the thing.. */
r_if
c_cond
(paren
id|sb-&gt;s_blocksize
op_ne
id|blocksize
)paren
(brace
id|brelse
c_func
(paren
id|bh
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sb_set_blocksize
c_func
(paren
id|sb
comma
id|blocksize
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;EXT2-fs: blocksize too small for device.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|failed_sbi
suffix:semicolon
)brace
id|logic_sb_block
op_assign
(paren
id|sb_block
op_star
id|BLOCK_SIZE
)paren
op_div
id|blocksize
suffix:semicolon
id|offset
op_assign
(paren
id|sb_block
op_star
id|BLOCK_SIZE
)paren
op_mod
id|blocksize
suffix:semicolon
id|bh
op_assign
id|sb_bread
c_func
(paren
id|sb
comma
id|logic_sb_block
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bh
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;EXT2-fs: Couldn&squot;t read superblock on &quot;
l_string|&quot;2nd try.&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|failed_sbi
suffix:semicolon
)brace
id|es
op_assign
(paren
r_struct
id|ext2_super_block
op_star
)paren
(paren
(paren
(paren
r_char
op_star
)paren
id|bh-&gt;b_data
)paren
op_plus
id|offset
)paren
suffix:semicolon
id|sbi-&gt;s_es
op_assign
id|es
suffix:semicolon
r_if
c_cond
(paren
id|es-&gt;s_magic
op_ne
id|cpu_to_le16
c_func
(paren
id|EXT2_SUPER_MAGIC
)paren
)paren
(brace
id|printk
(paren
l_string|&quot;EXT2-fs: Magic mismatch, very weird !&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|failed_mount
suffix:semicolon
)brace
)brace
id|sb-&gt;s_maxbytes
op_assign
id|ext2_max_size
c_func
(paren
id|sb-&gt;s_blocksize_bits
)paren
suffix:semicolon
r_if
c_cond
(paren
id|le32_to_cpu
c_func
(paren
id|es-&gt;s_rev_level
)paren
op_eq
id|EXT2_GOOD_OLD_REV
)paren
(brace
id|sbi-&gt;s_inode_size
op_assign
id|EXT2_GOOD_OLD_INODE_SIZE
suffix:semicolon
id|sbi-&gt;s_first_ino
op_assign
id|EXT2_GOOD_OLD_FIRST_INO
suffix:semicolon
)brace
r_else
(brace
id|sbi-&gt;s_inode_size
op_assign
id|le16_to_cpu
c_func
(paren
id|es-&gt;s_inode_size
)paren
suffix:semicolon
id|sbi-&gt;s_first_ino
op_assign
id|le32_to_cpu
c_func
(paren
id|es-&gt;s_first_ino
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sbi-&gt;s_inode_size
OL
id|EXT2_GOOD_OLD_INODE_SIZE
)paren
op_logical_or
(paren
id|sbi-&gt;s_inode_size
op_amp
(paren
id|sbi-&gt;s_inode_size
op_minus
l_int|1
)paren
)paren
op_logical_or
(paren
id|sbi-&gt;s_inode_size
OG
id|blocksize
)paren
)paren
(brace
id|printk
(paren
l_string|&quot;EXT2-fs: unsupported inode size: %d&bslash;n&quot;
comma
id|sbi-&gt;s_inode_size
)paren
suffix:semicolon
r_goto
id|failed_mount
suffix:semicolon
)brace
)brace
id|sbi-&gt;s_frag_size
op_assign
id|EXT2_MIN_FRAG_SIZE
op_lshift
id|le32_to_cpu
c_func
(paren
id|es-&gt;s_log_frag_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sbi-&gt;s_frag_size
op_eq
l_int|0
)paren
r_goto
id|cantfind_ext2
suffix:semicolon
id|sbi-&gt;s_frags_per_block
op_assign
id|sb-&gt;s_blocksize
op_div
id|sbi-&gt;s_frag_size
suffix:semicolon
id|sbi-&gt;s_blocks_per_group
op_assign
id|le32_to_cpu
c_func
(paren
id|es-&gt;s_blocks_per_group
)paren
suffix:semicolon
id|sbi-&gt;s_frags_per_group
op_assign
id|le32_to_cpu
c_func
(paren
id|es-&gt;s_frags_per_group
)paren
suffix:semicolon
id|sbi-&gt;s_inodes_per_group
op_assign
id|le32_to_cpu
c_func
(paren
id|es-&gt;s_inodes_per_group
)paren
suffix:semicolon
r_if
c_cond
(paren
id|EXT2_INODE_SIZE
c_func
(paren
id|sb
)paren
op_eq
l_int|0
)paren
r_goto
id|cantfind_ext2
suffix:semicolon
id|sbi-&gt;s_inodes_per_block
op_assign
id|sb-&gt;s_blocksize
op_div
id|EXT2_INODE_SIZE
c_func
(paren
id|sb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sbi-&gt;s_inodes_per_block
op_eq
l_int|0
)paren
r_goto
id|cantfind_ext2
suffix:semicolon
id|sbi-&gt;s_itb_per_group
op_assign
id|sbi-&gt;s_inodes_per_group
op_div
id|sbi-&gt;s_inodes_per_block
suffix:semicolon
id|sbi-&gt;s_desc_per_block
op_assign
id|sb-&gt;s_blocksize
op_div
r_sizeof
(paren
r_struct
id|ext2_group_desc
)paren
suffix:semicolon
id|sbi-&gt;s_sbh
op_assign
id|bh
suffix:semicolon
id|sbi-&gt;s_mount_state
op_assign
id|le16_to_cpu
c_func
(paren
id|es-&gt;s_state
)paren
suffix:semicolon
id|sbi-&gt;s_addr_per_block_bits
op_assign
id|log2
(paren
id|EXT2_ADDR_PER_BLOCK
c_func
(paren
id|sb
)paren
)paren
suffix:semicolon
id|sbi-&gt;s_desc_per_block_bits
op_assign
id|log2
(paren
id|EXT2_DESC_PER_BLOCK
c_func
(paren
id|sb
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb-&gt;s_magic
op_ne
id|EXT2_SUPER_MAGIC
)paren
r_goto
id|cantfind_ext2
suffix:semicolon
r_if
c_cond
(paren
id|sb-&gt;s_blocksize
op_ne
id|bh-&gt;b_size
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|silent
)paren
id|printk
(paren
l_string|&quot;VFS: Unsupported blocksize on dev &quot;
l_string|&quot;%s.&bslash;n&quot;
comma
id|sb-&gt;s_id
)paren
suffix:semicolon
r_goto
id|failed_mount
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sb-&gt;s_blocksize
op_ne
id|sbi-&gt;s_frag_size
)paren
(brace
id|printk
(paren
l_string|&quot;EXT2-fs: fragsize %lu != blocksize %lu (not supported yet)&bslash;n&quot;
comma
id|sbi-&gt;s_frag_size
comma
id|sb-&gt;s_blocksize
)paren
suffix:semicolon
r_goto
id|failed_mount
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sbi-&gt;s_blocks_per_group
OG
id|sb-&gt;s_blocksize
op_star
l_int|8
)paren
(brace
id|printk
(paren
l_string|&quot;EXT2-fs: #blocks per group too big: %lu&bslash;n&quot;
comma
id|sbi-&gt;s_blocks_per_group
)paren
suffix:semicolon
r_goto
id|failed_mount
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sbi-&gt;s_frags_per_group
OG
id|sb-&gt;s_blocksize
op_star
l_int|8
)paren
(brace
id|printk
(paren
l_string|&quot;EXT2-fs: #fragments per group too big: %lu&bslash;n&quot;
comma
id|sbi-&gt;s_frags_per_group
)paren
suffix:semicolon
r_goto
id|failed_mount
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sbi-&gt;s_inodes_per_group
OG
id|sb-&gt;s_blocksize
op_star
l_int|8
)paren
(brace
id|printk
(paren
l_string|&quot;EXT2-fs: #inodes per group too big: %lu&bslash;n&quot;
comma
id|sbi-&gt;s_inodes_per_group
)paren
suffix:semicolon
r_goto
id|failed_mount
suffix:semicolon
)brace
r_if
c_cond
(paren
id|EXT2_BLOCKS_PER_GROUP
c_func
(paren
id|sb
)paren
op_eq
l_int|0
)paren
r_goto
id|cantfind_ext2
suffix:semicolon
id|sbi-&gt;s_groups_count
op_assign
(paren
id|le32_to_cpu
c_func
(paren
id|es-&gt;s_blocks_count
)paren
op_minus
id|le32_to_cpu
c_func
(paren
id|es-&gt;s_first_data_block
)paren
op_plus
id|EXT2_BLOCKS_PER_GROUP
c_func
(paren
id|sb
)paren
op_minus
l_int|1
)paren
op_div
id|EXT2_BLOCKS_PER_GROUP
c_func
(paren
id|sb
)paren
suffix:semicolon
id|db_count
op_assign
(paren
id|sbi-&gt;s_groups_count
op_plus
id|EXT2_DESC_PER_BLOCK
c_func
(paren
id|sb
)paren
op_minus
l_int|1
)paren
op_div
id|EXT2_DESC_PER_BLOCK
c_func
(paren
id|sb
)paren
suffix:semicolon
id|sbi-&gt;s_group_desc
op_assign
id|kmalloc
(paren
id|db_count
op_star
r_sizeof
(paren
r_struct
id|buffer_head
op_star
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sbi-&gt;s_group_desc
op_eq
l_int|NULL
)paren
(brace
id|printk
(paren
l_string|&quot;EXT2-fs: not enough memory&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|failed_mount
suffix:semicolon
)brace
id|percpu_counter_init
c_func
(paren
op_amp
id|sbi-&gt;s_freeblocks_counter
)paren
suffix:semicolon
id|percpu_counter_init
c_func
(paren
op_amp
id|sbi-&gt;s_freeinodes_counter
)paren
suffix:semicolon
id|percpu_counter_init
c_func
(paren
op_amp
id|sbi-&gt;s_dirs_counter
)paren
suffix:semicolon
id|bgl_lock_init
c_func
(paren
op_amp
id|sbi-&gt;s_blockgroup_lock
)paren
suffix:semicolon
id|sbi-&gt;s_debts
op_assign
id|kmalloc
c_func
(paren
id|sbi-&gt;s_groups_count
op_star
r_sizeof
(paren
op_star
id|sbi-&gt;s_debts
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sbi-&gt;s_debts
)paren
(brace
id|printk
(paren
l_string|&quot;EXT2-fs: not enough memory&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|failed_mount_group_desc
suffix:semicolon
)brace
id|memset
c_func
(paren
id|sbi-&gt;s_debts
comma
l_int|0
comma
id|sbi-&gt;s_groups_count
op_star
r_sizeof
(paren
op_star
id|sbi-&gt;s_debts
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|db_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|block
op_assign
id|descriptor_loc
c_func
(paren
id|sb
comma
id|logic_sb_block
comma
id|i
)paren
suffix:semicolon
id|sbi-&gt;s_group_desc
(braket
id|i
)braket
op_assign
id|sb_bread
c_func
(paren
id|sb
comma
id|block
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sbi-&gt;s_group_desc
(braket
id|i
)braket
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|i
suffix:semicolon
id|j
op_increment
)paren
id|brelse
(paren
id|sbi-&gt;s_group_desc
(braket
id|j
)braket
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;EXT2-fs: unable to read group descriptors&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|failed_mount_group_desc
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|ext2_check_descriptors
(paren
id|sb
)paren
)paren
(brace
id|printk
(paren
l_string|&quot;EXT2-fs: group descriptors corrupted!&bslash;n&quot;
)paren
suffix:semicolon
id|db_count
op_assign
id|i
suffix:semicolon
r_goto
id|failed_mount2
suffix:semicolon
)brace
id|sbi-&gt;s_gdb_count
op_assign
id|db_count
suffix:semicolon
id|get_random_bytes
c_func
(paren
op_amp
id|sbi-&gt;s_next_generation
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|sbi-&gt;s_next_gen_lock
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * set up enough so that it can read an inode&n;&t; */
id|sb-&gt;s_op
op_assign
op_amp
id|ext2_sops
suffix:semicolon
id|sb-&gt;s_export_op
op_assign
op_amp
id|ext2_export_ops
suffix:semicolon
id|sb-&gt;s_xattr
op_assign
id|ext2_xattr_handlers
suffix:semicolon
id|root
op_assign
id|iget
c_func
(paren
id|sb
comma
id|EXT2_ROOT_INO
)paren
suffix:semicolon
id|sb-&gt;s_root
op_assign
id|d_alloc_root
c_func
(paren
id|root
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sb-&gt;s_root
)paren
(brace
id|iput
c_func
(paren
id|root
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;EXT2-fs: get root inode failed&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|failed_mount2
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|S_ISDIR
c_func
(paren
id|root-&gt;i_mode
)paren
op_logical_or
op_logical_neg
id|root-&gt;i_blocks
op_logical_or
op_logical_neg
id|root-&gt;i_size
)paren
(brace
id|dput
c_func
(paren
id|sb-&gt;s_root
)paren
suffix:semicolon
id|sb-&gt;s_root
op_assign
l_int|NULL
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;EXT2-fs: corrupt root inode, run e2fsck&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|failed_mount2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|EXT2_HAS_COMPAT_FEATURE
c_func
(paren
id|sb
comma
id|EXT3_FEATURE_COMPAT_HAS_JOURNAL
)paren
)paren
id|ext2_warning
c_func
(paren
id|sb
comma
id|__FUNCTION__
comma
l_string|&quot;mounting ext3 filesystem as ext2&bslash;n&quot;
)paren
suffix:semicolon
id|ext2_setup_super
(paren
id|sb
comma
id|es
comma
id|sb-&gt;s_flags
op_amp
id|MS_RDONLY
)paren
suffix:semicolon
id|percpu_counter_mod
c_func
(paren
op_amp
id|sbi-&gt;s_freeblocks_counter
comma
id|ext2_count_free_blocks
c_func
(paren
id|sb
)paren
)paren
suffix:semicolon
id|percpu_counter_mod
c_func
(paren
op_amp
id|sbi-&gt;s_freeinodes_counter
comma
id|ext2_count_free_inodes
c_func
(paren
id|sb
)paren
)paren
suffix:semicolon
id|percpu_counter_mod
c_func
(paren
op_amp
id|sbi-&gt;s_dirs_counter
comma
id|ext2_count_dirs
c_func
(paren
id|sb
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|cantfind_ext2
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|silent
)paren
id|printk
c_func
(paren
l_string|&quot;VFS: Can&squot;t find an ext2 filesystem on dev %s.&bslash;n&quot;
comma
id|sb-&gt;s_id
)paren
suffix:semicolon
r_goto
id|failed_mount
suffix:semicolon
id|failed_mount2
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|db_count
suffix:semicolon
id|i
op_increment
)paren
id|brelse
c_func
(paren
id|sbi-&gt;s_group_desc
(braket
id|i
)braket
)paren
suffix:semicolon
id|failed_mount_group_desc
suffix:colon
id|kfree
c_func
(paren
id|sbi-&gt;s_group_desc
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|sbi-&gt;s_debts
)paren
suffix:semicolon
id|failed_mount
suffix:colon
id|brelse
c_func
(paren
id|bh
)paren
suffix:semicolon
id|failed_sbi
suffix:colon
id|sb-&gt;s_fs_info
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|sbi
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|ext2_commit_super
r_static
r_void
id|ext2_commit_super
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|ext2_super_block
op_star
id|es
)paren
(brace
id|es-&gt;s_wtime
op_assign
id|cpu_to_le32
c_func
(paren
id|get_seconds
c_func
(paren
)paren
)paren
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
id|EXT2_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_sbh
)paren
suffix:semicolon
id|sb-&gt;s_dirt
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|ext2_sync_super
r_static
r_void
id|ext2_sync_super
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|ext2_super_block
op_star
id|es
)paren
(brace
id|es-&gt;s_free_blocks_count
op_assign
id|cpu_to_le32
c_func
(paren
id|ext2_count_free_blocks
c_func
(paren
id|sb
)paren
)paren
suffix:semicolon
id|es-&gt;s_free_inodes_count
op_assign
id|cpu_to_le32
c_func
(paren
id|ext2_count_free_inodes
c_func
(paren
id|sb
)paren
)paren
suffix:semicolon
id|es-&gt;s_wtime
op_assign
id|cpu_to_le32
c_func
(paren
id|get_seconds
c_func
(paren
)paren
)paren
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
id|EXT2_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_sbh
)paren
suffix:semicolon
id|sync_dirty_buffer
c_func
(paren
id|EXT2_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_sbh
)paren
suffix:semicolon
id|sb-&gt;s_dirt
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * In the second extended file system, it is not necessary to&n; * write the super block since we use a mapping of the&n; * disk super block in a buffer.&n; *&n; * However, this function is still used to set the fs valid&n; * flags to 0.  We need to set this flag to 0 since the fs&n; * may have been checked while mounted and e2fsck may have&n; * set s_state to EXT2_VALID_FS after some corrections.&n; */
DECL|function|ext2_write_super
r_void
id|ext2_write_super
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_struct
id|ext2_super_block
op_star
id|es
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sb-&gt;s_flags
op_amp
id|MS_RDONLY
)paren
)paren
(brace
id|es
op_assign
id|EXT2_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|s_es
suffix:semicolon
r_if
c_cond
(paren
id|le16_to_cpu
c_func
(paren
id|es-&gt;s_state
)paren
op_amp
id|EXT2_VALID_FS
)paren
(brace
id|ext2_debug
(paren
l_string|&quot;setting valid to 0&bslash;n&quot;
)paren
suffix:semicolon
id|es-&gt;s_state
op_assign
id|cpu_to_le16
c_func
(paren
id|le16_to_cpu
c_func
(paren
id|es-&gt;s_state
)paren
op_amp
op_complement
id|EXT2_VALID_FS
)paren
suffix:semicolon
id|es-&gt;s_free_blocks_count
op_assign
id|cpu_to_le32
c_func
(paren
id|ext2_count_free_blocks
c_func
(paren
id|sb
)paren
)paren
suffix:semicolon
id|es-&gt;s_free_inodes_count
op_assign
id|cpu_to_le32
c_func
(paren
id|ext2_count_free_inodes
c_func
(paren
id|sb
)paren
)paren
suffix:semicolon
id|es-&gt;s_mtime
op_assign
id|cpu_to_le32
c_func
(paren
id|get_seconds
c_func
(paren
)paren
)paren
suffix:semicolon
id|ext2_sync_super
c_func
(paren
id|sb
comma
id|es
)paren
suffix:semicolon
)brace
r_else
id|ext2_commit_super
(paren
id|sb
comma
id|es
)paren
suffix:semicolon
)brace
id|sb-&gt;s_dirt
op_assign
l_int|0
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|ext2_remount
r_static
r_int
id|ext2_remount
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_int
op_star
id|flags
comma
r_char
op_star
id|data
)paren
(brace
r_struct
id|ext2_sb_info
op_star
id|sbi
op_assign
id|EXT2_SB
c_func
(paren
id|sb
)paren
suffix:semicolon
r_struct
id|ext2_super_block
op_star
id|es
suffix:semicolon
multiline_comment|/*&n;&t; * Allow the &quot;check&quot; option to be passed as a remount option.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|parse_options
(paren
id|data
comma
id|sbi
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|sb-&gt;s_flags
op_assign
(paren
id|sb-&gt;s_flags
op_amp
op_complement
id|MS_POSIXACL
)paren
op_or
(paren
(paren
id|sbi-&gt;s_mount_opt
op_amp
id|EXT2_MOUNT_POSIX_ACL
)paren
ques
c_cond
id|MS_POSIXACL
suffix:colon
l_int|0
)paren
suffix:semicolon
id|es
op_assign
id|sbi-&gt;s_es
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|flags
op_amp
id|MS_RDONLY
)paren
op_eq
(paren
id|sb-&gt;s_flags
op_amp
id|MS_RDONLY
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_star
id|flags
op_amp
id|MS_RDONLY
)paren
(brace
r_if
c_cond
(paren
id|le16_to_cpu
c_func
(paren
id|es-&gt;s_state
)paren
op_amp
id|EXT2_VALID_FS
op_logical_or
op_logical_neg
(paren
id|sbi-&gt;s_mount_state
op_amp
id|EXT2_VALID_FS
)paren
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t;&t; * OK, we are remounting a valid rw partition rdonly, so set&n;&t;&t; * the rdonly flag and then mark the partition as valid again.&n;&t;&t; */
id|es-&gt;s_state
op_assign
id|cpu_to_le16
c_func
(paren
id|sbi-&gt;s_mount_state
)paren
suffix:semicolon
id|es-&gt;s_mtime
op_assign
id|cpu_to_le32
c_func
(paren
id|get_seconds
c_func
(paren
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|__le32
id|ret
op_assign
id|EXT2_HAS_RO_COMPAT_FEATURE
c_func
(paren
id|sb
comma
op_complement
id|EXT2_FEATURE_RO_COMPAT_SUPP
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;EXT2-fs: %s: couldn&squot;t remount RDWR because of &quot;
l_string|&quot;unsupported optional features (%x).&bslash;n&quot;
comma
id|sb-&gt;s_id
comma
id|le32_to_cpu
c_func
(paren
id|ret
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EROFS
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Mounting a RDONLY partition read-write, so reread and&n;&t;&t; * store the current valid flag.  (It may have been changed&n;&t;&t; * by e2fsck since we originally mounted the partition.)&n;&t;&t; */
id|sbi-&gt;s_mount_state
op_assign
id|le16_to_cpu
c_func
(paren
id|es-&gt;s_state
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ext2_setup_super
(paren
id|sb
comma
id|es
comma
l_int|0
)paren
)paren
id|sb-&gt;s_flags
op_and_assign
op_complement
id|MS_RDONLY
suffix:semicolon
)brace
id|ext2_sync_super
c_func
(paren
id|sb
comma
id|es
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ext2_statfs
r_static
r_int
id|ext2_statfs
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|kstatfs
op_star
id|buf
)paren
(brace
r_struct
id|ext2_sb_info
op_star
id|sbi
op_assign
id|EXT2_SB
c_func
(paren
id|sb
)paren
suffix:semicolon
r_int
r_int
id|overhead
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|test_opt
(paren
id|sb
comma
id|MINIX_DF
)paren
)paren
id|overhead
op_assign
l_int|0
suffix:semicolon
r_else
(brace
multiline_comment|/*&n;&t;&t; * Compute the overhead (FS structures)&n;&t;&t; */
multiline_comment|/*&n;&t;&t; * All of the blocks before first_data_block are&n;&t;&t; * overhead&n;&t;&t; */
id|overhead
op_assign
id|le32_to_cpu
c_func
(paren
id|sbi-&gt;s_es-&gt;s_first_data_block
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Add the overhead attributed to the superblock and&n;&t;&t; * block group descriptors.  If the sparse superblocks&n;&t;&t; * feature is turned on, then not all groups have this.&n;&t;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sbi-&gt;s_groups_count
suffix:semicolon
id|i
op_increment
)paren
id|overhead
op_add_assign
id|ext2_bg_has_super
c_func
(paren
id|sb
comma
id|i
)paren
op_plus
id|ext2_bg_num_gdb
c_func
(paren
id|sb
comma
id|i
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Every block group has an inode bitmap, a block&n;&t;&t; * bitmap, and an inode table.&n;&t;&t; */
id|overhead
op_add_assign
(paren
id|sbi-&gt;s_groups_count
op_star
(paren
l_int|2
op_plus
id|sbi-&gt;s_itb_per_group
)paren
)paren
suffix:semicolon
)brace
id|buf-&gt;f_type
op_assign
id|EXT2_SUPER_MAGIC
suffix:semicolon
id|buf-&gt;f_bsize
op_assign
id|sb-&gt;s_blocksize
suffix:semicolon
id|buf-&gt;f_blocks
op_assign
id|le32_to_cpu
c_func
(paren
id|sbi-&gt;s_es-&gt;s_blocks_count
)paren
op_minus
id|overhead
suffix:semicolon
id|buf-&gt;f_bfree
op_assign
id|ext2_count_free_blocks
c_func
(paren
id|sb
)paren
suffix:semicolon
id|buf-&gt;f_bavail
op_assign
id|buf-&gt;f_bfree
op_minus
id|le32_to_cpu
c_func
(paren
id|sbi-&gt;s_es-&gt;s_r_blocks_count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;f_bfree
OL
id|le32_to_cpu
c_func
(paren
id|sbi-&gt;s_es-&gt;s_r_blocks_count
)paren
)paren
id|buf-&gt;f_bavail
op_assign
l_int|0
suffix:semicolon
id|buf-&gt;f_files
op_assign
id|le32_to_cpu
c_func
(paren
id|sbi-&gt;s_es-&gt;s_inodes_count
)paren
suffix:semicolon
id|buf-&gt;f_ffree
op_assign
id|ext2_count_free_inodes
(paren
id|sb
)paren
suffix:semicolon
id|buf-&gt;f_namelen
op_assign
id|EXT2_NAME_LEN
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ext2_get_sb
r_static
r_struct
id|super_block
op_star
id|ext2_get_sb
c_func
(paren
r_struct
id|file_system_type
op_star
id|fs_type
comma
r_int
id|flags
comma
r_const
r_char
op_star
id|dev_name
comma
r_void
op_star
id|data
)paren
(brace
r_return
id|get_sb_bdev
c_func
(paren
id|fs_type
comma
id|flags
comma
id|dev_name
comma
id|data
comma
id|ext2_fill_super
)paren
suffix:semicolon
)brace
DECL|variable|ext2_fs_type
r_static
r_struct
id|file_system_type
id|ext2_fs_type
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;ext2&quot;
comma
dot
id|get_sb
op_assign
id|ext2_get_sb
comma
dot
id|kill_sb
op_assign
id|kill_block_super
comma
dot
id|fs_flags
op_assign
id|FS_REQUIRES_DEV
comma
)brace
suffix:semicolon
DECL|function|init_ext2_fs
r_static
r_int
id|__init
id|init_ext2_fs
c_func
(paren
r_void
)paren
(brace
r_int
id|err
op_assign
id|init_ext2_xattr
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|err
op_assign
id|init_inodecache
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out1
suffix:semicolon
id|err
op_assign
id|register_filesystem
c_func
(paren
op_amp
id|ext2_fs_type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out
suffix:colon
id|destroy_inodecache
c_func
(paren
)paren
suffix:semicolon
id|out1
suffix:colon
id|exit_ext2_xattr
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|exit_ext2_fs
r_static
r_void
id|__exit
id|exit_ext2_fs
c_func
(paren
r_void
)paren
(brace
id|unregister_filesystem
c_func
(paren
op_amp
id|ext2_fs_type
)paren
suffix:semicolon
id|destroy_inodecache
c_func
(paren
)paren
suffix:semicolon
id|exit_ext2_xattr
c_func
(paren
)paren
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|init_ext2_fs
)paren
id|module_exit
c_func
(paren
id|exit_ext2_fs
)paren
eof
