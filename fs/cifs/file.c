multiline_comment|/*&n; *   fs/cifs/file.c&n; *&n; *   vfs operations that deal with files&n; * &n; *   Copyright (c) International Business Machines  Corp., 2002&n; *   Author(s): Steve French (sfrench@us.ibm.com)&n; *&n; *   This library is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU Lesser General Public License as published&n; *   by the Free Software Foundation; either version 2.1 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This library is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See&n; *   the GNU Lesser General Public License for more details.&n; *&n; *   You should have received a copy of the GNU Lesser General Public License&n; *   along with this library; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA&n; */
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/stat.h&gt;
macro_line|#include &lt;linux/fcntl.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/pagemap.h&gt;
macro_line|#include &lt;linux/pagevec.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;asm/div64.h&gt;
macro_line|#include &quot;cifsfs.h&quot;
macro_line|#include &quot;cifspdu.h&quot;
macro_line|#include &quot;cifsglob.h&quot;
macro_line|#include &quot;cifsproto.h&quot;
macro_line|#include &quot;cifs_unicode.h&quot;
macro_line|#include &quot;cifs_debug.h&quot;
macro_line|#include &quot;cifs_fs_sb.h&quot;
r_int
DECL|function|cifs_open
id|cifs_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|rc
op_assign
op_minus
id|EACCES
suffix:semicolon
r_int
id|xid
comma
id|oplock
suffix:semicolon
r_struct
id|cifs_sb_info
op_star
id|cifs_sb
suffix:semicolon
r_struct
id|cifsTconInfo
op_star
id|pTcon
suffix:semicolon
r_struct
id|cifsFileInfo
op_star
id|pCifsFile
suffix:semicolon
r_struct
id|cifsInodeInfo
op_star
id|pCifsInode
suffix:semicolon
r_char
op_star
id|full_path
op_assign
l_int|NULL
suffix:semicolon
r_int
id|desiredAccess
op_assign
l_int|0x20197
suffix:semicolon
r_int
id|disposition
op_assign
id|FILE_OPEN
suffix:semicolon
id|__u16
id|netfid
suffix:semicolon
id|xid
op_assign
id|GetXid
c_func
(paren
)paren
suffix:semicolon
id|cifs_sb
op_assign
id|CIFS_SB
c_func
(paren
id|inode-&gt;i_sb
)paren
suffix:semicolon
id|pTcon
op_assign
id|cifs_sb-&gt;tcon
suffix:semicolon
id|full_path
op_assign
id|build_path_from_dentry
c_func
(paren
id|file-&gt;f_dentry
)paren
suffix:semicolon
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot; inode = 0x%p file flags are %x for %s&quot;
comma
id|inode
comma
id|file-&gt;f_flags
comma
id|full_path
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_ACCMODE
)paren
op_eq
id|O_RDONLY
)paren
id|desiredAccess
op_assign
id|GENERIC_READ
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_ACCMODE
)paren
op_eq
id|O_WRONLY
)paren
id|desiredAccess
op_assign
id|GENERIC_WRITE
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_ACCMODE
)paren
op_eq
id|O_RDWR
)paren
id|desiredAccess
op_assign
id|GENERIC_ALL
suffix:semicolon
multiline_comment|/* BB check other flags carefully to find equivalent NTCreateX flags */
multiline_comment|/*&n;#define O_CREAT&t;&t;   0100&t;&n;#define O_EXCL&t;&t;   0200&t;&n;#define O_NOCTTY&t;   0400&t;&n;#define O_TRUNC&t;&t;  01000&t;&n;#define O_APPEND&t;  02000&n;#define O_NONBLOCK&t;  04000&n;#define O_NDELAY&t;O_NONBLOCK&n;#define O_SYNC&t;&t; 010000&n;#define FASYNC&t;&t; 020000&t;&n;#define O_DIRECT&t; 040000&t;&n;#define O_LARGEFILE&t;0100000&n;#define O_DIRECTORY&t;0200000&t;&n;#define O_NOFOLLOW&t;0400000&n;#define O_ATOMICLOOKUP&t;01000000 */
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_CREAT
)paren
id|disposition
op_assign
id|FILE_OVERWRITE
suffix:semicolon
multiline_comment|/* BB first check if file has batch oplock (or oplock ?) */
multiline_comment|/* BB finish adding in oplock support BB */
r_if
c_cond
(paren
id|oplockEnabled
)paren
id|oplock
op_assign
id|REQ_OPLOCK
suffix:semicolon
r_else
id|oplock
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/* BB pass O_SYNC flag through on file attributes .. BB */
id|rc
op_assign
id|CIFSSMBOpen
c_func
(paren
id|xid
comma
id|pTcon
comma
id|full_path
comma
id|disposition
comma
id|desiredAccess
comma
id|CREATE_NOT_DIR
comma
op_amp
id|netfid
comma
op_amp
id|oplock
comma
id|cifs_sb-&gt;local_nls
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;cifs_open returned 0x%x &quot;
comma
id|rc
)paren
)paren
suffix:semicolon
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;oplock: %d &quot;
comma
id|oplock
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|file-&gt;private_data
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|cifsFileInfo
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;private_data
)paren
(brace
id|memset
c_func
(paren
id|file-&gt;private_data
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|cifsFileInfo
)paren
)paren
suffix:semicolon
id|pCifsFile
op_assign
(paren
r_struct
id|cifsFileInfo
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|pCifsFile-&gt;netfid
op_assign
id|netfid
suffix:semicolon
id|pCifsFile-&gt;pid
op_assign
id|current-&gt;pid
suffix:semicolon
id|pCifsFile-&gt;pfile
op_assign
id|file
suffix:semicolon
multiline_comment|/* needed for writepage */
id|write_lock
c_func
(paren
op_amp
id|file-&gt;f_owner.lock
)paren
suffix:semicolon
id|write_lock
c_func
(paren
op_amp
id|GlobalSMBSeslock
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|pCifsFile-&gt;tlist
comma
op_amp
id|pTcon-&gt;openFileList
)paren
suffix:semicolon
id|pCifsInode
op_assign
id|CIFS_I
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pCifsInode-&gt;openFileList.next
)paren
(brace
id|list_add
c_func
(paren
op_amp
id|pCifsFile-&gt;flist
comma
op_amp
id|pCifsInode-&gt;openFileList
)paren
suffix:semicolon
)brace
id|write_unlock
c_func
(paren
op_amp
id|GlobalSMBSeslock
)paren
suffix:semicolon
id|write_unlock
c_func
(paren
op_amp
id|file-&gt;f_owner.lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_CREAT
)paren
(brace
multiline_comment|/* time to set mode which we can not set earlier due&n;&t;&t;&t;&t; to problems creating new read-only files */
r_if
c_cond
(paren
id|cifs_sb-&gt;tcon-&gt;ses-&gt;capabilities
op_amp
id|CAP_UNIX
)paren
id|CIFSSMBUnixSetPerms
c_func
(paren
id|xid
comma
id|pTcon
comma
id|full_path
comma
id|inode-&gt;i_mode
comma
(paren
id|__u64
)paren
op_minus
l_int|1
comma
(paren
id|__u64
)paren
op_minus
l_int|1
comma
l_int|0
multiline_comment|/* dev */
comma
id|cifs_sb-&gt;local_nls
)paren
suffix:semicolon
r_else
(brace
multiline_comment|/* BB implement via Windows security descriptors */
multiline_comment|/* eg CIFSSMBWinSetPerms(xid,pTcon,full_path,mode,-1,-1,local_nls);*/
multiline_comment|/* in the meantime could set r/o dos attribute when perms are eg:&n;&t;&t;&t;&t;&t;mode &amp; 0222 == 0 */
)brace
)brace
)brace
)brace
r_if
c_cond
(paren
id|full_path
)paren
id|kfree
c_func
(paren
id|full_path
)paren
suffix:semicolon
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* Try to reaquire byte range locks that were released when session */
multiline_comment|/* to server was lost */
DECL|function|relock_files
r_int
id|relock_files
c_func
(paren
r_struct
id|cifsFileInfo
op_star
id|cifsFile
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* list all locks open on this file */
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* Try to reopen files that were closed when session to server was lost */
DECL|function|reopen_files
r_int
id|reopen_files
c_func
(paren
r_struct
id|cifsTconInfo
op_star
id|pTcon
comma
r_struct
id|nls_table
op_star
id|nlsinfo
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_struct
id|cifsFileInfo
op_star
id|open_file
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|file
op_star
id|file
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|list_head
op_star
id|tmp
suffix:semicolon
r_struct
id|list_head
op_star
id|tmp1
suffix:semicolon
multiline_comment|/* list all files open on tree connection */
id|read_lock
c_func
(paren
op_amp
id|GlobalSMBSeslock
)paren
suffix:semicolon
id|list_for_each_safe
c_func
(paren
id|tmp
comma
id|tmp1
comma
op_amp
id|pTcon-&gt;openFileList
)paren
(brace
id|open_file
op_assign
id|list_entry
c_func
(paren
id|tmp
comma
r_struct
id|cifsFileInfo
comma
id|flist
)paren
suffix:semicolon
r_if
c_cond
(paren
id|open_file
)paren
(brace
r_if
c_cond
(paren
id|open_file-&gt;search_resume_name
)paren
(brace
id|kfree
c_func
(paren
id|open_file-&gt;search_resume_name
)paren
suffix:semicolon
)brace
id|file
op_assign
id|open_file-&gt;pfile
suffix:semicolon
id|kfree
c_func
(paren
id|open_file
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file
)paren
(brace
id|file-&gt;private_data
op_assign
l_int|NULL
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|GlobalSMBSeslock
)paren
suffix:semicolon
id|rc
op_assign
id|cifs_open
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode
comma
id|file
)paren
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|GlobalSMBSeslock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;reconnecting file %s failed with %d&quot;
comma
id|file-&gt;f_dentry-&gt;d_name.name
comma
id|rc
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;reconnection of %s succeeded&quot;
comma
id|file-&gt;f_dentry-&gt;d_name.name
)paren
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|GlobalSMBSeslock
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_int
DECL|function|cifs_close
id|cifs_close
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_int
id|xid
suffix:semicolon
r_struct
id|cifs_sb_info
op_star
id|cifs_sb
suffix:semicolon
r_struct
id|cifsTconInfo
op_star
id|pTcon
suffix:semicolon
r_struct
id|cifsFileInfo
op_star
id|pSMBFile
op_assign
(paren
r_struct
id|cifsFileInfo
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|xid
op_assign
id|GetXid
c_func
(paren
)paren
suffix:semicolon
id|cifs_sb
op_assign
id|CIFS_SB
c_func
(paren
id|inode-&gt;i_sb
)paren
suffix:semicolon
id|pTcon
op_assign
id|cifs_sb-&gt;tcon
suffix:semicolon
r_if
c_cond
(paren
id|pSMBFile
)paren
(brace
id|write_lock
c_func
(paren
op_amp
id|file-&gt;f_owner.lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pSMBFile-&gt;flist.next
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|pSMBFile-&gt;flist
)paren
suffix:semicolon
)brace
id|list_del
c_func
(paren
op_amp
id|pSMBFile-&gt;tlist
)paren
suffix:semicolon
id|write_unlock
c_func
(paren
op_amp
id|file-&gt;f_owner.lock
)paren
suffix:semicolon
id|rc
op_assign
id|CIFSSMBClose
c_func
(paren
id|xid
comma
id|pTcon
comma
id|pSMBFile-&gt;netfid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pSMBFile-&gt;search_resume_name
)paren
(brace
id|kfree
c_func
(paren
id|pSMBFile-&gt;search_resume_name
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|file-&gt;private_data
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
id|rc
op_assign
op_minus
id|EBADF
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_eq
l_int|0
)paren
op_logical_and
id|CIFS_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|write_behind_rc
)paren
(brace
id|rc
op_assign
id|CIFS_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|write_behind_rc
suffix:semicolon
)brace
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_int
DECL|function|cifs_closedir
id|cifs_closedir
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_int
id|xid
suffix:semicolon
r_struct
id|cifsFileInfo
op_star
id|pSMBFileStruct
op_assign
(paren
r_struct
id|cifsFileInfo
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Closedir inode = 0x%p with &quot;
comma
id|inode
)paren
)paren
suffix:semicolon
id|xid
op_assign
id|GetXid
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pSMBFileStruct
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Freeing private data in close dir&quot;
)paren
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|file-&gt;private_data
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
l_int|NULL
suffix:semicolon
)brace
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_int
DECL|function|cifs_lock
id|cifs_lock
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_int
id|cmd
comma
r_struct
id|file_lock
op_star
id|pfLock
)paren
(brace
r_int
id|rc
comma
id|xid
suffix:semicolon
id|__u32
id|lockType
op_assign
id|LOCKING_ANDX_LARGE_FILES
suffix:semicolon
id|__u32
id|numLock
op_assign
l_int|0
suffix:semicolon
id|__u32
id|numUnlock
op_assign
l_int|0
suffix:semicolon
id|__u64
id|length
suffix:semicolon
r_struct
id|cifs_sb_info
op_star
id|cifs_sb
suffix:semicolon
r_struct
id|cifsTconInfo
op_star
id|pTcon
suffix:semicolon
id|length
op_assign
l_int|1
op_plus
id|pfLock-&gt;fl_end
op_minus
id|pfLock-&gt;fl_start
suffix:semicolon
id|rc
op_assign
op_minus
id|EACCES
suffix:semicolon
id|xid
op_assign
id|GetXid
c_func
(paren
)paren
suffix:semicolon
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Lock parm: 0x%x flockflags: 0x%x flocktype: 0x%x start: %lld end: %lld&quot;
comma
id|cmd
comma
id|pfLock-&gt;fl_flags
comma
id|pfLock-&gt;fl_type
comma
id|pfLock-&gt;fl_start
comma
id|pfLock-&gt;fl_end
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pfLock-&gt;fl_flags
op_amp
id|FL_POSIX
)paren
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Posix &quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pfLock-&gt;fl_flags
op_amp
id|FL_FLOCK
)paren
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Flock &quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pfLock-&gt;fl_flags
op_amp
id|FL_SLEEP
)paren
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Blocking lock &quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pfLock-&gt;fl_flags
op_amp
id|FL_ACCESS
)paren
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Process suspended by mandatory locking &quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pfLock-&gt;fl_flags
op_amp
id|FL_LEASE
)paren
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Lease on file &quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pfLock-&gt;fl_flags
op_amp
l_int|0xFFD0
)paren
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Unknown lock flags &quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pfLock-&gt;fl_type
op_eq
id|F_WRLCK
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;F_WRLCK &quot;
)paren
)paren
suffix:semicolon
id|numLock
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pfLock-&gt;fl_type
op_eq
id|F_UNLCK
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;F_UNLCK &quot;
)paren
)paren
suffix:semicolon
id|numUnlock
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pfLock-&gt;fl_type
op_eq
id|F_RDLCK
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;F_RDLCK &quot;
)paren
)paren
suffix:semicolon
id|lockType
op_or_assign
id|LOCKING_ANDX_SHARED_LOCK
suffix:semicolon
id|numLock
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pfLock-&gt;fl_type
op_eq
id|F_EXLCK
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;F_EXLCK &quot;
)paren
)paren
suffix:semicolon
id|numLock
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pfLock-&gt;fl_type
op_eq
id|F_SHLCK
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;F_SHLCK &quot;
)paren
)paren
suffix:semicolon
id|lockType
op_or_assign
id|LOCKING_ANDX_SHARED_LOCK
suffix:semicolon
id|numLock
op_assign
l_int|1
suffix:semicolon
)brace
r_else
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Unknown type of lock &quot;
)paren
)paren
suffix:semicolon
id|cifs_sb
op_assign
id|CIFS_SB
c_func
(paren
id|file-&gt;f_dentry-&gt;d_sb
)paren
suffix:semicolon
id|pTcon
op_assign
id|cifs_sb-&gt;tcon
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;private_data
op_eq
l_int|NULL
)paren
(brace
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
op_minus
id|EBADF
suffix:semicolon
)brace
r_if
c_cond
(paren
id|IS_GETLK
c_func
(paren
id|cmd
)paren
)paren
(brace
id|rc
op_assign
id|CIFSSMBLock
c_func
(paren
id|xid
comma
id|pTcon
comma
(paren
(paren
r_struct
id|cifsFileInfo
op_star
)paren
id|file
op_member_access_from_pointer
id|private_data
)paren
op_member_access_from_pointer
id|netfid
comma
id|length
comma
id|pfLock-&gt;fl_start
comma
l_int|0
comma
l_int|1
comma
id|lockType
comma
l_int|0
multiline_comment|/* wait flag */
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
l_int|0
)paren
(brace
id|rc
op_assign
id|CIFSSMBLock
c_func
(paren
id|xid
comma
id|pTcon
comma
(paren
(paren
r_struct
id|cifsFileInfo
op_star
)paren
id|file
op_member_access_from_pointer
id|private_data
)paren
op_member_access_from_pointer
id|netfid
comma
id|length
comma
id|pfLock-&gt;fl_start
comma
l_int|1
multiline_comment|/* numUnlock */
comma
l_int|0
multiline_comment|/* numLock */
comma
id|lockType
comma
l_int|0
multiline_comment|/* wait flag */
)paren
suffix:semicolon
id|pfLock-&gt;fl_type
op_assign
id|F_UNLCK
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
)paren
id|cERROR
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Error unlocking previously locked range %d during test of lock &quot;
comma
id|rc
)paren
)paren
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* if rc == ERR_SHARING_VIOLATION ? */
id|rc
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* do not change lock type to unlock since range in use */
)brace
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|rc
op_assign
id|CIFSSMBLock
c_func
(paren
id|xid
comma
id|pTcon
comma
(paren
(paren
r_struct
id|cifsFileInfo
op_star
)paren
id|file-&gt;private_data
)paren
op_member_access_from_pointer
id|netfid
comma
id|length
comma
id|pfLock-&gt;fl_start
comma
id|numUnlock
comma
id|numLock
comma
id|lockType
comma
l_int|0
multiline_comment|/* wait flag */
)paren
suffix:semicolon
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|ssize_t
DECL|function|cifs_write
id|cifs_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|write_data
comma
r_int
id|write_size
comma
id|loff_t
op_star
id|poffset
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|bytes_written
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|total_written
suffix:semicolon
r_struct
id|cifs_sb_info
op_star
id|cifs_sb
suffix:semicolon
r_struct
id|cifsTconInfo
op_star
id|pTcon
suffix:semicolon
r_int
id|xid
comma
id|long_op
suffix:semicolon
id|xid
op_assign
id|GetXid
c_func
(paren
)paren
suffix:semicolon
id|cifs_sb
op_assign
id|CIFS_SB
c_func
(paren
id|file-&gt;f_dentry-&gt;d_sb
)paren
suffix:semicolon
id|pTcon
op_assign
id|cifs_sb-&gt;tcon
suffix:semicolon
multiline_comment|/*cFYI(1,&n;&t;   (&quot; write %d bytes to offset %lld of %s&quot;, write_size,&n;&t;   *poffset, file-&gt;f_dentry-&gt;d_name.name)); */
r_if
c_cond
(paren
id|file-&gt;private_data
op_eq
l_int|NULL
)paren
(brace
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
op_minus
id|EBADF
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|poffset
OG
id|file-&gt;f_dentry-&gt;d_inode-&gt;i_size
)paren
id|long_op
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* writes past end of file can take a long time */
r_else
id|long_op
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|total_written
op_assign
l_int|0
suffix:semicolon
id|write_size
OG
id|total_written
suffix:semicolon
id|total_written
op_add_assign
id|bytes_written
)paren
(brace
id|rc
op_assign
id|CIFSSMBWrite
c_func
(paren
id|xid
comma
id|pTcon
comma
(paren
(paren
r_struct
id|cifsFileInfo
op_star
)paren
id|file
op_member_access_from_pointer
id|private_data
)paren
op_member_access_from_pointer
id|netfid
comma
id|write_size
op_minus
id|total_written
comma
op_star
id|poffset
comma
op_amp
id|bytes_written
comma
id|write_data
op_plus
id|total_written
comma
id|long_op
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_logical_or
(paren
id|bytes_written
op_eq
l_int|0
)paren
)paren
(brace
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|total_written
)paren
r_break
suffix:semicolon
r_else
(brace
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
)brace
r_else
op_star
id|poffset
op_add_assign
id|bytes_written
suffix:semicolon
id|long_op
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/* subsequent writes fast - 15 seconds is plenty */
)brace
id|file-&gt;f_dentry-&gt;d_inode-&gt;i_ctime
op_assign
id|file-&gt;f_dentry-&gt;d_inode-&gt;i_mtime
op_assign
id|CURRENT_TIME
suffix:semicolon
r_if
c_cond
(paren
id|bytes_written
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_star
id|poffset
OG
id|file-&gt;f_dentry-&gt;d_inode-&gt;i_size
)paren
id|file-&gt;f_dentry-&gt;d_inode-&gt;i_size
op_assign
op_star
id|poffset
suffix:semicolon
)brace
id|mark_inode_dirty_sync
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode
)paren
suffix:semicolon
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
id|total_written
suffix:semicolon
)brace
r_static
r_int
DECL|function|cifs_partialpagewrite
id|cifs_partialpagewrite
c_func
(paren
r_struct
id|page
op_star
id|page
comma
r_int
id|from
comma
r_int
id|to
)paren
(brace
r_struct
id|address_space
op_star
id|mapping
op_assign
id|page-&gt;mapping
suffix:semicolon
id|loff_t
id|offset
op_assign
(paren
id|loff_t
)paren
id|page-&gt;index
op_lshift
id|PAGE_CACHE_SHIFT
suffix:semicolon
r_char
op_star
id|write_data
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_int
id|bytes_written
op_assign
l_int|0
suffix:semicolon
r_struct
id|cifs_sb_info
op_star
id|cifs_sb
suffix:semicolon
r_struct
id|cifsTconInfo
op_star
id|pTcon
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|page-&gt;mapping-&gt;host
suffix:semicolon
r_struct
id|cifsInodeInfo
op_star
id|cifsInode
suffix:semicolon
r_struct
id|cifsFileInfo
op_star
id|open_file
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|list_head
op_star
id|tmp
suffix:semicolon
r_struct
id|list_head
op_star
id|tmp1
suffix:semicolon
r_int
id|xid
suffix:semicolon
id|xid
op_assign
id|GetXid
c_func
(paren
)paren
suffix:semicolon
id|cifs_sb
op_assign
id|CIFS_SB
c_func
(paren
id|inode-&gt;i_sb
)paren
suffix:semicolon
id|pTcon
op_assign
id|cifs_sb-&gt;tcon
suffix:semicolon
multiline_comment|/* figure out which file struct to use &n;&t;if (file-&gt;private_data == NULL) {&n;&t;&t;kunmap(page);&n;&t;&t;FreeXid(xid);&n;&t;&t;return -EBADF;&n;&t;}     &n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|mapping
)paren
(brace
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|mapping-&gt;host
)paren
(brace
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|offset
op_add_assign
(paren
id|loff_t
)paren
id|from
suffix:semicolon
id|write_data
op_assign
id|kmap
c_func
(paren
id|page
)paren
suffix:semicolon
id|write_data
op_add_assign
id|from
suffix:semicolon
r_if
c_cond
(paren
(paren
id|to
OG
id|PAGE_CACHE_SIZE
)paren
op_logical_or
(paren
id|from
OG
id|to
)paren
op_logical_or
(paren
id|offset
OG
id|mapping-&gt;host-&gt;i_size
)paren
)paren
(brace
id|kunmap
c_func
(paren
id|page
)paren
suffix:semicolon
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/* check to make sure that we are not extending the file */
r_if
c_cond
(paren
id|mapping-&gt;host-&gt;i_size
op_minus
id|offset
OL
(paren
id|loff_t
)paren
id|to
)paren
(brace
id|to
op_assign
(paren
r_int
)paren
(paren
id|mapping-&gt;host-&gt;i_size
op_minus
id|offset
)paren
suffix:semicolon
)brace
id|cifsInode
op_assign
id|CIFS_I
c_func
(paren
id|mapping-&gt;host
)paren
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|GlobalSMBSeslock
)paren
suffix:semicolon
id|list_for_each_safe
c_func
(paren
id|tmp
comma
id|tmp1
comma
op_amp
id|cifsInode-&gt;openFileList
)paren
(brace
id|open_file
op_assign
id|list_entry
c_func
(paren
id|tmp
comma
r_struct
id|cifsFileInfo
comma
id|flist
)paren
suffix:semicolon
multiline_comment|/* We could check if file is open for writing first */
r_if
c_cond
(paren
(paren
id|open_file-&gt;pfile
)paren
op_logical_and
(paren
(paren
id|open_file-&gt;pfile-&gt;f_flags
op_amp
id|O_RDWR
)paren
op_logical_or
(paren
id|open_file-&gt;pfile-&gt;f_flags
op_amp
id|O_WRONLY
)paren
)paren
)paren
(brace
id|read_unlock
c_func
(paren
op_amp
id|GlobalSMBSeslock
)paren
suffix:semicolon
id|bytes_written
op_assign
id|cifs_write
c_func
(paren
id|open_file-&gt;pfile
comma
id|write_data
comma
id|to
op_minus
id|from
comma
op_amp
id|offset
)paren
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|GlobalSMBSeslock
)paren
suffix:semicolon
multiline_comment|/* Does mm or vfs already set times? */
id|inode-&gt;i_atime
op_assign
id|inode-&gt;i_mtime
op_assign
id|CURRENT_TIME
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bytes_written
OG
l_int|0
)paren
op_logical_and
(paren
id|offset
)paren
)paren
(brace
id|rc
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bytes_written
OL
l_int|0
)paren
(brace
id|rc
op_assign
id|bytes_written
suffix:semicolon
)brace
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|GlobalSMBSeslock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|open_file
op_eq
l_int|NULL
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;No writeable filehandles for inode&quot;
)paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
)brace
id|kunmap
c_func
(paren
id|page
)paren
suffix:semicolon
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_int
id|cifs_writepages
c_func
(paren
r_struct
id|address_space
op_star
id|mapping
comma
r_struct
id|writeback_control
op_star
id|wbc
)paren
(brace
r_int
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_int
id|xid
suffix:semicolon
id|xid
op_assign
id|GetXid
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* call 16K write then Setpageuptodate */
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
macro_line|#endif
r_static
r_int
DECL|function|cifs_writepage
id|cifs_writepage
c_func
(paren
r_struct
id|page
op_star
id|page
comma
r_struct
id|writeback_control
op_star
id|wbc
)paren
(brace
r_int
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_int
id|xid
suffix:semicolon
id|xid
op_assign
id|GetXid
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* BB add check for wbc flags */
id|page_cache_get
c_func
(paren
id|page
)paren
suffix:semicolon
id|rc
op_assign
id|cifs_partialpagewrite
c_func
(paren
id|page
comma
l_int|0
comma
id|PAGE_CACHE_SIZE
)paren
suffix:semicolon
id|SetPageUptodate
c_func
(paren
id|page
)paren
suffix:semicolon
multiline_comment|/* BB add check for error and Clearuptodate? */
id|unlock_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|page_cache_release
c_func
(paren
id|page
)paren
suffix:semicolon
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|cifs_commit_write
id|cifs_commit_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|page
op_star
id|page
comma
r_int
id|offset
comma
r_int
id|to
)paren
(brace
r_int
id|xid
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|page-&gt;mapping-&gt;host
suffix:semicolon
id|loff_t
id|position
op_assign
(paren
(paren
id|loff_t
)paren
id|page-&gt;index
op_lshift
id|PAGE_CACHE_SHIFT
)paren
op_plus
id|to
suffix:semicolon
r_struct
id|cifsFileInfo
op_star
id|open_file
suffix:semicolon
r_struct
id|cifs_sb_info
op_star
id|cifs_sb
suffix:semicolon
id|xid
op_assign
id|GetXid
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|position
OG
id|inode-&gt;i_size
)paren
(brace
id|inode-&gt;i_size
op_assign
id|position
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;private_data
op_eq
l_int|NULL
)paren
(brace
id|rc
op_assign
op_minus
id|EBADF
suffix:semicolon
)brace
r_else
(brace
id|cifs_sb
op_assign
id|CIFS_SB
c_func
(paren
id|inode-&gt;i_sb
)paren
suffix:semicolon
id|open_file
op_assign
(paren
r_struct
id|cifsFileInfo
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|rc
op_assign
id|CIFSSMBSetFileSize
c_func
(paren
id|xid
comma
id|cifs_sb-&gt;tcon
comma
id|position
comma
id|open_file-&gt;netfid
comma
id|open_file-&gt;pid
comma
id|FALSE
)paren
suffix:semicolon
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot; SetEOF (commit write) rc = %d&quot;
comma
id|rc
)paren
)paren
suffix:semicolon
)brace
)brace
id|set_page_dirty
c_func
(paren
id|page
)paren
suffix:semicolon
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_int
DECL|function|cifs_fsync
id|cifs_fsync
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|dentry
op_star
id|dentry
comma
r_int
id|datasync
)paren
(brace
r_int
id|xid
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_struct
id|inode
op_star
id|inode
op_assign
id|file-&gt;f_dentry-&gt;d_inode
suffix:semicolon
id|xid
op_assign
id|GetXid
c_func
(paren
)paren
suffix:semicolon
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Sync file - name: %s datasync: 0x%x &quot;
comma
id|dentry-&gt;d_name.name
comma
id|datasync
)paren
)paren
suffix:semicolon
id|rc
op_assign
id|filemap_fdatawrite
c_func
(paren
id|inode-&gt;i_mapping
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
l_int|0
)paren
(brace
id|CIFS_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|write_behind_rc
op_assign
l_int|0
suffix:semicolon
)brace
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|cifs_sync_page
id|cifs_sync_page
c_func
(paren
r_struct
id|page
op_star
id|page
)paren
(brace
r_struct
id|address_space
op_star
id|mapping
suffix:semicolon
r_struct
id|inode
op_star
id|inode
suffix:semicolon
r_int
r_int
id|index
op_assign
id|page-&gt;index
suffix:semicolon
r_int
r_int
id|rpages
op_assign
l_int|0
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;sync page %p&quot;
comma
id|page
)paren
)paren
suffix:semicolon
id|mapping
op_assign
id|page-&gt;mapping
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mapping
)paren
r_return
l_int|0
suffix:semicolon
id|inode
op_assign
id|mapping-&gt;host
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|inode
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/*&t;fill in rpages then &n;    result = cifs_pagein_inode(inode, index, rpages); */
multiline_comment|/* BB finish */
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;rpages is %d for sync page of Index %ld &quot;
comma
id|rpages
comma
id|index
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_return
id|rc
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * As file closes, flush all cached write data for this inode checking&n; * for write behind errors.&n; *&n; */
DECL|function|cifs_flush
r_int
id|cifs_flush
c_func
(paren
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|inode
op_star
id|inode
op_assign
id|file-&gt;f_dentry-&gt;d_inode
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Rather than do the steps manually: */
multiline_comment|/* lock the inode for writing */
multiline_comment|/* loop through pages looking for write behind data (dirty pages) */
multiline_comment|/* coalesce into contiguous 16K (or smaller) chunks to write to server */
multiline_comment|/* send to server (prefer in parallel) */
multiline_comment|/* deal with writebehind errors */
multiline_comment|/* unlock inode for writing */
multiline_comment|/* filemapfdatawrite appears easier for the time being */
id|rc
op_assign
id|filemap_fdatawrite
c_func
(paren
id|inode-&gt;i_mapping
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
l_int|0
)paren
(brace
multiline_comment|/* reset wb rc if we were able to write out dirty pages */
id|CIFS_I
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|write_behind_rc
op_assign
l_int|0
suffix:semicolon
)brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Flush inode %p file %p rc %d&quot;
comma
id|inode
comma
id|file
comma
id|rc
)paren
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|ssize_t
DECL|function|cifs_read
id|cifs_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|read_data
comma
r_int
id|read_size
comma
id|loff_t
op_star
id|poffset
)paren
(brace
r_int
id|rc
op_assign
op_minus
id|EACCES
suffix:semicolon
r_int
r_int
id|bytes_read
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|total_read
suffix:semicolon
r_int
r_int
id|current_read_size
suffix:semicolon
r_struct
id|cifs_sb_info
op_star
id|cifs_sb
suffix:semicolon
r_struct
id|cifsTconInfo
op_star
id|pTcon
suffix:semicolon
r_int
id|xid
suffix:semicolon
r_char
op_star
id|current_offset
suffix:semicolon
id|xid
op_assign
id|GetXid
c_func
(paren
)paren
suffix:semicolon
id|cifs_sb
op_assign
id|CIFS_SB
c_func
(paren
id|file-&gt;f_dentry-&gt;d_sb
)paren
suffix:semicolon
id|pTcon
op_assign
id|cifs_sb-&gt;tcon
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;private_data
op_eq
l_int|NULL
)paren
(brace
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
op_minus
id|EBADF
suffix:semicolon
)brace
r_for
c_loop
(paren
id|total_read
op_assign
l_int|0
comma
id|current_offset
op_assign
id|read_data
suffix:semicolon
id|read_size
OG
id|total_read
suffix:semicolon
id|total_read
op_add_assign
id|bytes_read
comma
id|current_offset
op_add_assign
id|bytes_read
)paren
(brace
id|current_read_size
op_assign
id|min_t
c_func
(paren
r_const
r_int
comma
id|read_size
op_minus
id|total_read
comma
id|cifs_sb-&gt;rsize
)paren
suffix:semicolon
id|rc
op_assign
id|CIFSSMBRead
c_func
(paren
id|xid
comma
id|pTcon
comma
(paren
(paren
r_struct
id|cifsFileInfo
op_star
)paren
id|file
op_member_access_from_pointer
id|private_data
)paren
op_member_access_from_pointer
id|netfid
comma
id|current_read_size
comma
op_star
id|poffset
comma
op_amp
id|bytes_read
comma
op_amp
id|current_offset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_logical_or
(paren
id|bytes_read
op_eq
l_int|0
)paren
)paren
(brace
r_if
c_cond
(paren
id|total_read
)paren
(brace
r_break
suffix:semicolon
)brace
r_else
(brace
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
)brace
r_else
op_star
id|poffset
op_add_assign
id|bytes_read
suffix:semicolon
)brace
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
id|total_read
suffix:semicolon
)brace
DECL|function|cifs_file_mmap
r_int
id|cifs_file_mmap
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|dentry
op_star
id|dentry
op_assign
id|file-&gt;f_dentry
suffix:semicolon
r_int
id|rc
comma
id|xid
suffix:semicolon
id|xid
op_assign
id|GetXid
c_func
(paren
)paren
suffix:semicolon
id|rc
op_assign
id|cifs_revalidate
c_func
(paren
id|dentry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Validation prior to mmap failed, error=%d&quot;
comma
id|rc
)paren
)paren
suffix:semicolon
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
id|rc
op_assign
id|generic_file_mmap
c_func
(paren
id|file
comma
id|vma
)paren
suffix:semicolon
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|cifs_copy_cache_pages
r_static
r_void
id|cifs_copy_cache_pages
c_func
(paren
r_struct
id|address_space
op_star
id|mapping
comma
r_struct
id|list_head
op_star
id|pages
comma
r_int
id|bytes_read
comma
r_char
op_star
id|data
comma
r_struct
id|pagevec
op_star
id|plru_pvec
)paren
(brace
r_struct
id|page
op_star
id|page
suffix:semicolon
r_char
op_star
id|target
suffix:semicolon
r_while
c_loop
(paren
id|bytes_read
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|list_empty
c_func
(paren
id|pages
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
id|spin_lock
c_func
(paren
op_amp
id|mapping-&gt;page_lock
)paren
suffix:semicolon
id|page
op_assign
id|list_entry
c_func
(paren
id|pages-&gt;prev
comma
r_struct
id|page
comma
id|list
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|page-&gt;list
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|mapping-&gt;page_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|add_to_page_cache
c_func
(paren
id|page
comma
id|mapping
comma
id|page-&gt;index
comma
id|GFP_KERNEL
)paren
)paren
(brace
id|page_cache_release
c_func
(paren
id|page
)paren
suffix:semicolon
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Add page cache failed&quot;
)paren
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|page_cache_get
c_func
(paren
id|page
)paren
suffix:semicolon
id|target
op_assign
id|kmap_atomic
c_func
(paren
id|page
comma
id|KM_USER0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PAGE_CACHE_SIZE
OG
id|bytes_read
)paren
(brace
id|memcpy
c_func
(paren
id|target
comma
id|data
comma
id|bytes_read
)paren
suffix:semicolon
id|bytes_read
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|target
comma
id|data
comma
id|PAGE_CACHE_SIZE
)paren
suffix:semicolon
id|bytes_read
op_sub_assign
id|PAGE_CACHE_SIZE
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|pagevec_add
c_func
(paren
id|plru_pvec
comma
id|page
)paren
)paren
id|__pagevec_lru_add
c_func
(paren
id|plru_pvec
)paren
suffix:semicolon
id|flush_dcache_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|SetPageUptodate
c_func
(paren
id|page
)paren
suffix:semicolon
id|kunmap_atomic
c_func
(paren
id|page
comma
id|KM_USER0
)paren
suffix:semicolon
id|unlock_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|page_cache_release
c_func
(paren
id|page
)paren
suffix:semicolon
id|data
op_add_assign
id|PAGE_CACHE_SIZE
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_static
r_int
DECL|function|cifs_readpages
id|cifs_readpages
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|address_space
op_star
id|mapping
comma
r_struct
id|list_head
op_star
id|page_list
comma
r_int
id|num_pages
)paren
(brace
r_int
id|rc
op_assign
op_minus
id|EACCES
suffix:semicolon
r_int
id|xid
suffix:semicolon
id|loff_t
id|offset
suffix:semicolon
r_struct
id|page
op_star
id|page
suffix:semicolon
r_struct
id|cifs_sb_info
op_star
id|cifs_sb
suffix:semicolon
r_struct
id|cifsTconInfo
op_star
id|pTcon
suffix:semicolon
r_int
id|bytes_read
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|read_size
comma
id|i
suffix:semicolon
r_char
op_star
id|smb_read_data
op_assign
l_int|0
suffix:semicolon
r_struct
id|smb_com_read_rsp
op_star
id|pSMBr
suffix:semicolon
r_struct
id|pagevec
id|lru_pvec
suffix:semicolon
id|xid
op_assign
id|GetXid
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;private_data
op_eq
l_int|NULL
)paren
(brace
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
op_minus
id|EBADF
suffix:semicolon
)brace
id|cifs_sb
op_assign
id|CIFS_SB
c_func
(paren
id|file-&gt;f_dentry-&gt;d_sb
)paren
suffix:semicolon
id|pTcon
op_assign
id|cifs_sb-&gt;tcon
suffix:semicolon
id|pagevec_init
c_func
(paren
op_amp
id|lru_pvec
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_pages
suffix:semicolon
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|mapping-&gt;page_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|list_empty
c_func
(paren
id|page_list
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
id|page
op_assign
id|list_entry
c_func
(paren
id|page_list-&gt;prev
comma
r_struct
id|page
comma
id|list
)paren
suffix:semicolon
id|offset
op_assign
(paren
id|loff_t
)paren
id|page-&gt;index
op_lshift
id|PAGE_CACHE_SHIFT
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|mapping-&gt;page_lock
)paren
suffix:semicolon
multiline_comment|/* for reads over a certain size could initiate async read ahead */
id|cFYI
c_func
(paren
l_int|0
comma
(paren
l_string|&quot;Read %d pages into cache at offset %ld &quot;
comma
id|num_pages
op_minus
id|i
comma
(paren
r_int
r_int
)paren
id|offset
)paren
)paren
suffix:semicolon
id|read_size
op_assign
(paren
id|num_pages
op_minus
id|i
)paren
op_star
id|PAGE_CACHE_SIZE
suffix:semicolon
multiline_comment|/* Read size needs to be in multiples of one page */
id|read_size
op_assign
id|min_t
c_func
(paren
r_const
r_int
r_int
comma
id|read_size
comma
id|cifs_sb-&gt;rsize
op_amp
id|PAGE_CACHE_MASK
)paren
suffix:semicolon
id|rc
op_assign
id|CIFSSMBRead
c_func
(paren
id|xid
comma
id|pTcon
comma
(paren
(paren
r_struct
id|cifsFileInfo
op_star
)paren
id|file
op_member_access_from_pointer
id|private_data
)paren
op_member_access_from_pointer
id|netfid
comma
id|read_size
comma
id|offset
comma
op_amp
id|bytes_read
comma
op_amp
id|smb_read_data
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
OL
l_int|0
)paren
op_logical_or
(paren
id|smb_read_data
op_eq
l_int|NULL
)paren
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Read error in readpages: %d&quot;
comma
id|rc
)paren
)paren
suffix:semicolon
multiline_comment|/* clean up remaing pages off list */
id|spin_lock
c_func
(paren
op_amp
id|mapping-&gt;page_lock
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|list_empty
c_func
(paren
id|page_list
)paren
op_logical_and
(paren
id|i
OL
id|num_pages
)paren
)paren
(brace
id|page
op_assign
id|list_entry
c_func
(paren
id|page_list-&gt;prev
comma
r_struct
id|page
comma
id|list
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|page-&gt;list
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|mapping-&gt;page_lock
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bytes_read
OG
l_int|0
)paren
(brace
id|pSMBr
op_assign
(paren
r_struct
id|smb_com_read_rsp
op_star
)paren
id|smb_read_data
suffix:semicolon
id|cifs_copy_cache_pages
c_func
(paren
id|mapping
comma
id|page_list
comma
id|bytes_read
comma
id|smb_read_data
op_plus
l_int|4
multiline_comment|/* RFC1000 hdr */
op_plus
id|le16_to_cpu
c_func
(paren
id|pSMBr-&gt;DataOffset
)paren
comma
op_amp
id|lru_pvec
)paren
suffix:semicolon
id|i
op_add_assign
id|bytes_read
op_rshift
id|PAGE_CACHE_SHIFT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bytes_read
op_amp
id|PAGE_CACHE_MASK
)paren
op_ne
id|bytes_read
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Partial page %d of %d read to cache&quot;
comma
id|i
op_increment
comma
id|num_pages
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;No bytes read&quot;
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|smb_read_data
)paren
(brace
id|buf_release
c_func
(paren
id|smb_read_data
)paren
suffix:semicolon
id|smb_read_data
op_assign
l_int|0
suffix:semicolon
)brace
id|bytes_read
op_assign
l_int|0
suffix:semicolon
)brace
id|pagevec_lru_add
c_func
(paren
op_amp
id|lru_pvec
)paren
suffix:semicolon
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|cifs_readpage
id|cifs_readpage
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|page
op_star
id|page
)paren
(brace
id|loff_t
id|offset
op_assign
(paren
id|loff_t
)paren
id|page-&gt;index
op_lshift
id|PAGE_CACHE_SHIFT
suffix:semicolon
r_char
op_star
id|read_data
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|EACCES
suffix:semicolon
r_int
id|xid
suffix:semicolon
id|xid
op_assign
id|GetXid
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;private_data
op_eq
l_int|NULL
)paren
(brace
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
op_minus
id|EBADF
suffix:semicolon
)brace
id|cFYI
c_func
(paren
l_int|0
comma
(paren
l_string|&quot;readpage %p at offset %d 0x%x&bslash;n&quot;
comma
id|page
comma
(paren
r_int
)paren
id|offset
comma
(paren
r_int
)paren
id|offset
)paren
)paren
suffix:semicolon
id|page_cache_get
c_func
(paren
id|page
)paren
suffix:semicolon
id|read_data
op_assign
id|kmap
c_func
(paren
id|page
)paren
suffix:semicolon
multiline_comment|/* for reads over a certain size could initiate async read ahead */
id|rc
op_assign
id|cifs_read
c_func
(paren
id|file
comma
id|read_data
comma
id|PAGE_CACHE_SIZE
comma
op_amp
id|offset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
OL
l_int|0
)paren
r_goto
id|io_error
suffix:semicolon
r_else
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Bytes read %d &quot;
comma
id|rc
)paren
)paren
suffix:semicolon
)brace
id|file-&gt;f_dentry-&gt;d_inode-&gt;i_atime
op_assign
id|CURRENT_TIME
suffix:semicolon
r_if
c_cond
(paren
id|PAGE_CACHE_SIZE
OG
id|rc
)paren
(brace
id|memset
c_func
(paren
id|read_data
op_plus
id|rc
comma
l_int|0
comma
id|PAGE_CACHE_SIZE
op_minus
id|rc
)paren
suffix:semicolon
)brace
id|flush_dcache_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|SetPageUptodate
c_func
(paren
id|page
)paren
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
id|io_error
suffix:colon
id|kunmap
c_func
(paren
id|page
)paren
suffix:semicolon
id|unlock_page
c_func
(paren
id|page
)paren
suffix:semicolon
id|page_cache_release
c_func
(paren
id|page
)paren
suffix:semicolon
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_void
DECL|function|fill_in_inode
id|fill_in_inode
c_func
(paren
r_struct
id|inode
op_star
id|tmp_inode
comma
id|FILE_DIRECTORY_INFO
op_star
id|pfindData
comma
r_int
op_star
id|pobject_type
)paren
(brace
r_struct
id|cifsInodeInfo
op_star
id|cifsInfo
op_assign
id|CIFS_I
c_func
(paren
id|tmp_inode
)paren
suffix:semicolon
r_struct
id|cifs_sb_info
op_star
id|cifs_sb
op_assign
id|CIFS_SB
c_func
(paren
id|tmp_inode-&gt;i_sb
)paren
suffix:semicolon
id|pfindData-&gt;ExtFileAttributes
op_assign
id|le32_to_cpu
c_func
(paren
id|pfindData-&gt;ExtFileAttributes
)paren
suffix:semicolon
id|pfindData-&gt;AllocationSize
op_assign
id|le64_to_cpu
c_func
(paren
id|pfindData-&gt;AllocationSize
)paren
suffix:semicolon
id|pfindData-&gt;EndOfFile
op_assign
id|le64_to_cpu
c_func
(paren
id|pfindData-&gt;EndOfFile
)paren
suffix:semicolon
id|cifsInfo-&gt;cifsAttrs
op_assign
id|pfindData-&gt;ExtFileAttributes
suffix:semicolon
id|cifsInfo-&gt;time
op_assign
id|jiffies
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|cifsInfo-&gt;inUse
)paren
suffix:semicolon
multiline_comment|/* inc on every refresh of inode info */
multiline_comment|/* Linux can not store file creation time unfortunately so ignore it */
id|tmp_inode-&gt;i_atime
op_assign
id|cifs_NTtimeToUnix
c_func
(paren
id|le64_to_cpu
c_func
(paren
id|pfindData-&gt;LastAccessTime
)paren
)paren
suffix:semicolon
id|tmp_inode-&gt;i_mtime
op_assign
id|cifs_NTtimeToUnix
c_func
(paren
id|le64_to_cpu
c_func
(paren
id|pfindData-&gt;LastWriteTime
)paren
)paren
suffix:semicolon
id|tmp_inode-&gt;i_ctime
op_assign
id|cifs_NTtimeToUnix
c_func
(paren
id|le64_to_cpu
c_func
(paren
id|pfindData-&gt;ChangeTime
)paren
)paren
suffix:semicolon
multiline_comment|/* treat dos attribute of read-only as read-only mode bit e.g. 555? */
multiline_comment|/* 2767 perms - indicate mandatory locking */
multiline_comment|/* BB fill in uid and gid here? with help from winbind? &n;&t;&t;&t;or retrieve from NTFS stream extended attribute */
id|tmp_inode-&gt;i_uid
op_assign
id|cifs_sb-&gt;mnt_uid
suffix:semicolon
id|tmp_inode-&gt;i_gid
op_assign
id|cifs_sb-&gt;mnt_gid
suffix:semicolon
multiline_comment|/* set default mode. will override for dirs below */
id|tmp_inode-&gt;i_mode
op_assign
id|cifs_sb-&gt;mnt_file_mode
suffix:semicolon
id|cFYI
c_func
(paren
l_int|0
comma
(paren
l_string|&quot;CIFS FFIRST: Attributes came in as 0x%x&quot;
comma
id|pfindData-&gt;ExtFileAttributes
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pfindData-&gt;ExtFileAttributes
op_amp
id|ATTR_REPARSE
)paren
(brace
op_star
id|pobject_type
op_assign
id|DT_LNK
suffix:semicolon
multiline_comment|/* BB can this and S_IFREG or S_IFDIR be set as in Windows? */
id|tmp_inode-&gt;i_mode
op_or_assign
id|S_IFLNK
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pfindData-&gt;ExtFileAttributes
op_amp
id|ATTR_DIRECTORY
)paren
(brace
op_star
id|pobject_type
op_assign
id|DT_DIR
suffix:semicolon
multiline_comment|/* override default perms since we do not lock dirs */
id|tmp_inode-&gt;i_mode
op_assign
id|cifs_sb-&gt;mnt_dir_mode
suffix:semicolon
id|tmp_inode-&gt;i_mode
op_or_assign
id|S_IFDIR
suffix:semicolon
)brace
r_else
(brace
op_star
id|pobject_type
op_assign
id|DT_REG
suffix:semicolon
id|tmp_inode-&gt;i_mode
op_or_assign
id|S_IFREG
suffix:semicolon
r_if
c_cond
(paren
id|pfindData-&gt;ExtFileAttributes
op_amp
id|ATTR_READONLY
)paren
(brace
id|tmp_inode-&gt;i_mode
op_and_assign
op_complement
(paren
id|S_IWUGO
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* could add code here - to validate if device or weird share type? */
multiline_comment|/* can not fill in nlink here as in qpathinfo version and Unx search */
id|tmp_inode-&gt;i_size
op_assign
id|pfindData-&gt;EndOfFile
suffix:semicolon
id|tmp_inode-&gt;i_blocks
op_assign
id|do_div
c_func
(paren
id|pfindData-&gt;AllocationSize
comma
id|tmp_inode-&gt;i_blksize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pfindData-&gt;AllocationSize
OL
id|pfindData-&gt;EndOfFile
)paren
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Possible sparse file: allocation size less than end of file &quot;
)paren
)paren
suffix:semicolon
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;File Size %ld and blocks %ld and blocksize %ld&quot;
comma
(paren
r_int
r_int
)paren
id|tmp_inode-&gt;i_size
comma
id|tmp_inode-&gt;i_blocks
comma
id|tmp_inode-&gt;i_blksize
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|S_ISREG
c_func
(paren
id|tmp_inode-&gt;i_mode
)paren
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot; File inode &quot;
)paren
)paren
suffix:semicolon
id|tmp_inode-&gt;i_op
op_assign
op_amp
id|cifs_file_inode_ops
suffix:semicolon
id|tmp_inode-&gt;i_fop
op_assign
op_amp
id|cifs_file_ops
suffix:semicolon
id|tmp_inode-&gt;i_data.a_ops
op_assign
op_amp
id|cifs_addr_ops
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|S_ISDIR
c_func
(paren
id|tmp_inode-&gt;i_mode
)paren
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot; Directory inode&quot;
)paren
)paren
suffix:semicolon
id|tmp_inode-&gt;i_op
op_assign
op_amp
id|cifs_dir_inode_ops
suffix:semicolon
id|tmp_inode-&gt;i_fop
op_assign
op_amp
id|cifs_dir_ops
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|S_ISLNK
c_func
(paren
id|tmp_inode-&gt;i_mode
)paren
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot; Symbolic Link inode &quot;
)paren
)paren
suffix:semicolon
id|tmp_inode-&gt;i_op
op_assign
op_amp
id|cifs_symlink_inode_ops
suffix:semicolon
)brace
r_else
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot; Init special inode &quot;
)paren
)paren
suffix:semicolon
id|init_special_inode
c_func
(paren
id|tmp_inode
comma
id|tmp_inode-&gt;i_mode
comma
id|kdev_t_to_nr
c_func
(paren
id|tmp_inode-&gt;i_rdev
)paren
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|unix_fill_in_inode
id|unix_fill_in_inode
c_func
(paren
r_struct
id|inode
op_star
id|tmp_inode
comma
id|FILE_UNIX_INFO
op_star
id|pfindData
comma
r_int
op_star
id|pobject_type
)paren
(brace
r_struct
id|cifsInodeInfo
op_star
id|cifsInfo
op_assign
id|CIFS_I
c_func
(paren
id|tmp_inode
)paren
suffix:semicolon
id|cifsInfo-&gt;time
op_assign
id|jiffies
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|cifsInfo-&gt;inUse
)paren
suffix:semicolon
id|tmp_inode-&gt;i_atime
op_assign
id|cifs_NTtimeToUnix
c_func
(paren
id|le64_to_cpu
c_func
(paren
id|pfindData-&gt;LastAccessTime
)paren
)paren
suffix:semicolon
id|tmp_inode-&gt;i_mtime
op_assign
id|cifs_NTtimeToUnix
c_func
(paren
id|le64_to_cpu
c_func
(paren
id|pfindData-&gt;LastModificationTime
)paren
)paren
suffix:semicolon
id|tmp_inode-&gt;i_ctime
op_assign
id|cifs_NTtimeToUnix
c_func
(paren
id|le64_to_cpu
c_func
(paren
id|pfindData-&gt;LastStatusChange
)paren
)paren
suffix:semicolon
id|tmp_inode-&gt;i_mode
op_assign
id|le64_to_cpu
c_func
(paren
id|pfindData-&gt;Permissions
)paren
suffix:semicolon
id|pfindData-&gt;Type
op_assign
id|le32_to_cpu
c_func
(paren
id|pfindData-&gt;Type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pfindData-&gt;Type
op_eq
id|UNIX_FILE
)paren
(brace
op_star
id|pobject_type
op_assign
id|DT_REG
suffix:semicolon
id|tmp_inode-&gt;i_mode
op_or_assign
id|S_IFREG
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pfindData-&gt;Type
op_eq
id|UNIX_SYMLINK
)paren
(brace
op_star
id|pobject_type
op_assign
id|DT_LNK
suffix:semicolon
id|tmp_inode-&gt;i_mode
op_or_assign
id|S_IFLNK
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pfindData-&gt;Type
op_eq
id|UNIX_DIR
)paren
(brace
op_star
id|pobject_type
op_assign
id|DT_DIR
suffix:semicolon
id|tmp_inode-&gt;i_mode
op_or_assign
id|S_IFDIR
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pfindData-&gt;Type
op_eq
id|UNIX_CHARDEV
)paren
(brace
op_star
id|pobject_type
op_assign
id|DT_CHR
suffix:semicolon
id|tmp_inode-&gt;i_mode
op_or_assign
id|S_IFCHR
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pfindData-&gt;Type
op_eq
id|UNIX_BLOCKDEV
)paren
(brace
op_star
id|pobject_type
op_assign
id|DT_BLK
suffix:semicolon
id|tmp_inode-&gt;i_mode
op_or_assign
id|S_IFBLK
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pfindData-&gt;Type
op_eq
id|UNIX_FIFO
)paren
(brace
op_star
id|pobject_type
op_assign
id|DT_FIFO
suffix:semicolon
id|tmp_inode-&gt;i_mode
op_or_assign
id|S_IFIFO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pfindData-&gt;Type
op_eq
id|UNIX_SOCKET
)paren
(brace
op_star
id|pobject_type
op_assign
id|DT_SOCK
suffix:semicolon
id|tmp_inode-&gt;i_mode
op_or_assign
id|S_IFSOCK
suffix:semicolon
)brace
id|tmp_inode-&gt;i_uid
op_assign
id|le64_to_cpu
c_func
(paren
id|pfindData-&gt;Uid
)paren
suffix:semicolon
id|tmp_inode-&gt;i_gid
op_assign
id|le64_to_cpu
c_func
(paren
id|pfindData-&gt;Gid
)paren
suffix:semicolon
id|tmp_inode-&gt;i_nlink
op_assign
id|le64_to_cpu
c_func
(paren
id|pfindData-&gt;Nlinks
)paren
suffix:semicolon
id|pfindData-&gt;NumOfBytes
op_assign
id|le64_to_cpu
c_func
(paren
id|pfindData-&gt;NumOfBytes
)paren
suffix:semicolon
id|pfindData-&gt;EndOfFile
op_assign
id|le64_to_cpu
c_func
(paren
id|pfindData-&gt;EndOfFile
)paren
suffix:semicolon
id|tmp_inode-&gt;i_size
op_assign
id|pfindData-&gt;EndOfFile
suffix:semicolon
id|tmp_inode-&gt;i_blocks
op_assign
id|do_div
c_func
(paren
id|pfindData-&gt;NumOfBytes
comma
id|tmp_inode-&gt;i_blksize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|S_ISREG
c_func
(paren
id|tmp_inode-&gt;i_mode
)paren
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot; File inode &quot;
)paren
)paren
suffix:semicolon
id|tmp_inode-&gt;i_op
op_assign
op_amp
id|cifs_file_inode_ops
suffix:semicolon
id|tmp_inode-&gt;i_fop
op_assign
op_amp
id|cifs_file_ops
suffix:semicolon
id|tmp_inode-&gt;i_data.a_ops
op_assign
op_amp
id|cifs_addr_ops
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|S_ISDIR
c_func
(paren
id|tmp_inode-&gt;i_mode
)paren
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot; Directory inode&quot;
)paren
)paren
suffix:semicolon
id|tmp_inode-&gt;i_op
op_assign
op_amp
id|cifs_dir_inode_ops
suffix:semicolon
id|tmp_inode-&gt;i_fop
op_assign
op_amp
id|cifs_dir_ops
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|S_ISLNK
c_func
(paren
id|tmp_inode-&gt;i_mode
)paren
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot; Symbolic Link inode &quot;
)paren
)paren
suffix:semicolon
id|tmp_inode-&gt;i_op
op_assign
op_amp
id|cifs_symlink_inode_ops
suffix:semicolon
multiline_comment|/* tmp_inode-&gt;i_fop = */
multiline_comment|/* do not need to set to anything */
)brace
r_else
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot; Init special inode &quot;
)paren
)paren
suffix:semicolon
id|init_special_inode
c_func
(paren
id|tmp_inode
comma
id|tmp_inode-&gt;i_mode
comma
id|kdev_t_to_nr
c_func
(paren
id|tmp_inode-&gt;i_rdev
)paren
)paren
suffix:semicolon
)brace
)brace
r_void
DECL|function|construct_dentry
id|construct_dentry
c_func
(paren
r_struct
id|qstr
op_star
id|qstring
comma
r_struct
id|file
op_star
id|file
comma
r_struct
id|inode
op_star
op_star
id|ptmp_inode
comma
r_struct
id|dentry
op_star
op_star
id|pnew_dentry
)paren
(brace
r_struct
id|dentry
op_star
id|tmp_dentry
suffix:semicolon
r_struct
id|cifs_sb_info
op_star
id|cifs_sb
suffix:semicolon
r_struct
id|cifsTconInfo
op_star
id|pTcon
suffix:semicolon
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;For %s &quot;
comma
id|qstring-&gt;name
)paren
)paren
suffix:semicolon
id|cifs_sb
op_assign
id|CIFS_SB
c_func
(paren
id|file-&gt;f_dentry-&gt;d_sb
)paren
suffix:semicolon
id|pTcon
op_assign
id|cifs_sb-&gt;tcon
suffix:semicolon
id|qstring-&gt;hash
op_assign
id|full_name_hash
c_func
(paren
id|qstring-&gt;name
comma
id|qstring-&gt;len
)paren
suffix:semicolon
id|tmp_dentry
op_assign
id|d_lookup
c_func
(paren
id|file-&gt;f_dentry
comma
id|qstring
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp_dentry
)paren
(brace
id|cFYI
c_func
(paren
l_int|0
comma
(paren
l_string|&quot; existing dentry with inode 0x%p&quot;
comma
id|tmp_dentry-&gt;d_inode
)paren
)paren
suffix:semicolon
op_star
id|ptmp_inode
op_assign
id|tmp_dentry-&gt;d_inode
suffix:semicolon
multiline_comment|/* BB overwrite the old name? i.e. tmp_dentry-&gt;d_name and tmp_dentry-&gt;d_name.len ?? */
)brace
r_else
(brace
id|tmp_dentry
op_assign
id|d_alloc
c_func
(paren
id|file-&gt;f_dentry
comma
id|qstring
)paren
suffix:semicolon
op_star
id|ptmp_inode
op_assign
id|new_inode
c_func
(paren
id|file-&gt;f_dentry-&gt;d_sb
)paren
suffix:semicolon
id|tmp_dentry-&gt;d_op
op_assign
op_amp
id|cifs_dentry_ops
suffix:semicolon
id|cFYI
c_func
(paren
l_int|0
comma
(paren
l_string|&quot; instantiate dentry 0x%p with inode 0x%p &quot;
comma
id|tmp_dentry
comma
op_star
id|ptmp_inode
)paren
)paren
suffix:semicolon
id|d_instantiate
c_func
(paren
id|tmp_dentry
comma
op_star
id|ptmp_inode
)paren
suffix:semicolon
id|d_rehash
c_func
(paren
id|tmp_dentry
)paren
suffix:semicolon
)brace
id|tmp_dentry-&gt;d_time
op_assign
id|jiffies
suffix:semicolon
(paren
op_star
id|ptmp_inode
)paren
op_member_access_from_pointer
id|i_blksize
op_assign
(paren
id|pTcon-&gt;ses-&gt;server-&gt;maxBuf
op_minus
id|MAX_CIFS_HDR_SIZE
)paren
op_amp
l_int|0xFFFFFE00
suffix:semicolon
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;i_blksize = %ld&quot;
comma
(paren
op_star
id|ptmp_inode
)paren
op_member_access_from_pointer
id|i_blksize
)paren
)paren
suffix:semicolon
op_star
id|pnew_dentry
op_assign
id|tmp_dentry
suffix:semicolon
)brace
r_void
DECL|function|cifs_filldir
id|cifs_filldir
c_func
(paren
r_struct
id|qstr
op_star
id|pqstring
comma
id|FILE_DIRECTORY_INFO
op_star
id|pfindData
comma
r_struct
id|file
op_star
id|file
comma
id|filldir_t
id|filldir
comma
r_void
op_star
id|direntry
)paren
(brace
r_struct
id|inode
op_star
id|tmp_inode
suffix:semicolon
r_struct
id|dentry
op_star
id|tmp_dentry
suffix:semicolon
r_int
id|object_type
suffix:semicolon
id|pqstring-&gt;name
op_assign
id|pfindData-&gt;FileName
suffix:semicolon
id|pqstring-&gt;len
op_assign
id|pfindData-&gt;FileNameLength
suffix:semicolon
id|construct_dentry
c_func
(paren
id|pqstring
comma
id|file
comma
op_amp
id|tmp_inode
comma
op_amp
id|tmp_dentry
)paren
suffix:semicolon
id|fill_in_inode
c_func
(paren
id|tmp_inode
comma
id|pfindData
comma
op_amp
id|object_type
)paren
suffix:semicolon
id|filldir
c_func
(paren
id|direntry
comma
id|pfindData-&gt;FileName
comma
id|pqstring-&gt;len
comma
id|file-&gt;f_pos
comma
id|tmp_inode-&gt;i_ino
comma
id|object_type
)paren
suffix:semicolon
id|dput
c_func
(paren
id|tmp_dentry
)paren
suffix:semicolon
)brace
r_void
DECL|function|cifs_filldir_unix
id|cifs_filldir_unix
c_func
(paren
r_struct
id|qstr
op_star
id|pqstring
comma
id|FILE_UNIX_INFO
op_star
id|pUnixFindData
comma
r_struct
id|file
op_star
id|file
comma
id|filldir_t
id|filldir
comma
r_void
op_star
id|direntry
)paren
(brace
r_struct
id|inode
op_star
id|tmp_inode
suffix:semicolon
r_struct
id|dentry
op_star
id|tmp_dentry
suffix:semicolon
r_int
id|object_type
suffix:semicolon
id|pqstring-&gt;name
op_assign
id|pUnixFindData-&gt;FileName
suffix:semicolon
id|pqstring-&gt;len
op_assign
id|strnlen
c_func
(paren
id|pUnixFindData-&gt;FileName
comma
id|MAX_PATHCONF
)paren
suffix:semicolon
id|construct_dentry
c_func
(paren
id|pqstring
comma
id|file
comma
op_amp
id|tmp_inode
comma
op_amp
id|tmp_dentry
)paren
suffix:semicolon
id|unix_fill_in_inode
c_func
(paren
id|tmp_inode
comma
id|pUnixFindData
comma
op_amp
id|object_type
)paren
suffix:semicolon
id|filldir
c_func
(paren
id|direntry
comma
id|pUnixFindData-&gt;FileName
comma
id|pqstring-&gt;len
comma
id|file-&gt;f_pos
comma
id|tmp_inode-&gt;i_ino
comma
id|object_type
)paren
suffix:semicolon
id|dput
c_func
(paren
id|tmp_dentry
)paren
suffix:semicolon
)brace
r_int
DECL|function|cifs_readdir
id|cifs_readdir
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_void
op_star
id|direntry
comma
id|filldir_t
id|filldir
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_int
id|xid
suffix:semicolon
r_int
id|Unicode
op_assign
id|FALSE
suffix:semicolon
r_int
id|UnixSearch
op_assign
id|FALSE
suffix:semicolon
r_int
r_int
id|bufsize
comma
id|i
suffix:semicolon
id|__u16
id|searchHandle
suffix:semicolon
r_struct
id|cifs_sb_info
op_star
id|cifs_sb
suffix:semicolon
r_struct
id|cifsTconInfo
op_star
id|pTcon
suffix:semicolon
r_struct
id|cifsFileInfo
op_star
id|cifsFile
op_assign
l_int|NULL
suffix:semicolon
r_char
op_star
id|full_path
op_assign
l_int|NULL
suffix:semicolon
r_char
op_star
id|data
suffix:semicolon
r_struct
id|qstr
id|qstring
suffix:semicolon
id|T2_FFIRST_RSP_PARMS
id|findParms
suffix:semicolon
id|T2_FNEXT_RSP_PARMS
id|findNextParms
suffix:semicolon
id|FILE_DIRECTORY_INFO
op_star
id|pfindData
suffix:semicolon
id|FILE_DIRECTORY_INFO
op_star
id|lastFindData
suffix:semicolon
id|FILE_UNIX_INFO
op_star
id|pfindDataUnix
suffix:semicolon
id|xid
op_assign
id|GetXid
c_func
(paren
)paren
suffix:semicolon
id|cifs_sb
op_assign
id|CIFS_SB
c_func
(paren
id|file-&gt;f_dentry-&gt;d_sb
)paren
suffix:semicolon
id|pTcon
op_assign
id|cifs_sb-&gt;tcon
suffix:semicolon
id|bufsize
op_assign
id|pTcon-&gt;ses-&gt;server-&gt;maxBuf
op_minus
id|MAX_CIFS_HDR_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|bufsize
OG
id|CIFS_MAX_MSGSIZE
)paren
(brace
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|data
op_assign
id|kmalloc
c_func
(paren
id|bufsize
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|pfindData
op_assign
(paren
id|FILE_DIRECTORY_INFO
op_star
)paren
id|data
suffix:semicolon
id|full_path
op_assign
id|build_wildcard_path_from_dentry
c_func
(paren
id|file-&gt;f_dentry
)paren
suffix:semicolon
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Full path: %s start at: %lld &quot;
comma
id|full_path
comma
id|file-&gt;f_pos
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
r_int
)paren
id|file-&gt;f_pos
)paren
(brace
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
id|filldir
c_func
(paren
id|direntry
comma
l_string|&quot;.&quot;
comma
l_int|1
comma
id|file-&gt;f_pos
comma
id|file-&gt;f_dentry-&gt;d_inode-&gt;i_ino
comma
id|DT_DIR
)paren
OL
l_int|0
)paren
(brace
id|cERROR
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Filldir for current dir failed &quot;
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|file-&gt;f_pos
op_increment
suffix:semicolon
multiline_comment|/* fallthrough */
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
id|filldir
c_func
(paren
id|direntry
comma
l_string|&quot;..&quot;
comma
l_int|2
comma
id|file-&gt;f_pos
comma
id|file-&gt;f_dentry-&gt;d_parent-&gt;d_inode-&gt;i_ino
comma
id|DT_DIR
)paren
OL
l_int|0
)paren
(brace
id|cERROR
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Filldir for parent dir failed &quot;
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|file-&gt;f_pos
op_increment
suffix:semicolon
multiline_comment|/* fallthrough */
r_case
l_int|2
suffix:colon
r_if
c_cond
(paren
id|file-&gt;private_data
op_ne
l_int|NULL
)paren
(brace
id|cifsFile
op_assign
(paren
r_struct
id|cifsFileInfo
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
id|cifsFile-&gt;endOfSearch
)paren
(brace
r_if
c_cond
(paren
id|cifsFile-&gt;emptyDir
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;End of search, empty dir&quot;
)paren
)paren
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
id|CIFSFindClose
c_func
(paren
id|xid
comma
id|pTcon
comma
id|cifsFile-&gt;netfid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cifsFile-&gt;search_resume_name
)paren
(brace
id|kfree
c_func
(paren
id|cifsFile-&gt;search_resume_name
)paren
suffix:semicolon
id|cifsFile-&gt;search_resume_name
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|rc
op_assign
id|CIFSFindFirst
c_func
(paren
id|xid
comma
id|pTcon
comma
id|full_path
comma
id|pfindData
comma
op_amp
id|findParms
comma
id|cifs_sb-&gt;local_nls
comma
op_amp
id|Unicode
comma
op_amp
id|UnixSearch
)paren
suffix:semicolon
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Count: %d  End: %d &quot;
comma
id|findParms.SearchCount
comma
id|findParms.EndofSearch
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
l_int|0
)paren
(brace
id|searchHandle
op_assign
id|findParms.SearchHandle
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;private_data
op_eq
l_int|NULL
)paren
(brace
id|file-&gt;private_data
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|cifsFileInfo
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;private_data
)paren
(brace
id|memset
c_func
(paren
id|file-&gt;private_data
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|cifsFileInfo
)paren
)paren
suffix:semicolon
id|cifsFile
op_assign
(paren
r_struct
id|cifsFileInfo
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|cifsFile-&gt;netfid
op_assign
id|searchHandle
suffix:semicolon
)brace
r_else
(brace
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|renew_parental_timestamps
c_func
(paren
id|file-&gt;f_dentry
)paren
suffix:semicolon
id|lastFindData
op_assign
(paren
id|FILE_DIRECTORY_INFO
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|pfindData
op_plus
id|le32_to_cpu
c_func
(paren
id|findParms.LastNameOffset
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
r_char
op_star
)paren
id|lastFindData
OG
(paren
r_char
op_star
)paren
id|pfindData
op_plus
id|bufsize
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;last search entry past end of packet&quot;
)paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Offset of resume key same for levels 257 and 514 */
id|cifsFile-&gt;resume_key
op_assign
id|lastFindData-&gt;FileIndex
suffix:semicolon
r_if
c_cond
(paren
id|UnixSearch
op_eq
id|FALSE
)paren
(brace
id|cifsFile-&gt;resume_name_length
op_assign
id|le32_to_cpu
c_func
(paren
id|lastFindData-&gt;FileNameLength
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cifsFile-&gt;resume_name_length
OG
id|bufsize
op_minus
l_int|64
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Illegal resume file name length %d&quot;
comma
id|cifsFile-&gt;resume_name_length
)paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|cifsFile-&gt;search_resume_name
op_assign
id|kmalloc
c_func
(paren
id|cifsFile-&gt;resume_name_length
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Last file: %s with name %d bytes long&quot;
comma
id|lastFindData-&gt;FileName
comma
id|cifsFile-&gt;resume_name_length
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|cifsFile-&gt;search_resume_name
comma
id|lastFindData-&gt;FileName
comma
id|cifsFile-&gt;resume_name_length
)paren
suffix:semicolon
)brace
r_else
(brace
id|pfindDataUnix
op_assign
(paren
id|FILE_UNIX_INFO
op_star
)paren
id|lastFindData
suffix:semicolon
r_if
c_cond
(paren
id|Unicode
op_eq
id|TRUE
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|pfindDataUnix-&gt;FileName
(braket
id|i
)braket
op_or
id|pfindDataUnix-&gt;FileName
(braket
id|i
op_plus
l_int|1
)braket
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|i
OG
id|bufsize
op_minus
l_int|64
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
id|cifsFile-&gt;resume_name_length
op_assign
id|i
op_plus
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|cifsFile-&gt;resume_name_length
op_assign
id|strnlen
c_func
(paren
id|pfindDataUnix-&gt;FileName
comma
id|bufsize
op_minus
l_int|63
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cifsFile-&gt;resume_name_length
OG
id|bufsize
op_minus
l_int|64
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Illegal resume file name length %d&quot;
comma
id|cifsFile-&gt;resume_name_length
)paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|cifsFile-&gt;search_resume_name
op_assign
id|kmalloc
c_func
(paren
id|cifsFile-&gt;resume_name_length
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Last file: %s with name %d bytes long&quot;
comma
id|pfindDataUnix-&gt;FileName
comma
id|cifsFile-&gt;resume_name_length
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|cifsFile-&gt;search_resume_name
comma
id|pfindDataUnix-&gt;FileName
comma
id|cifsFile-&gt;resume_name_length
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|2
suffix:semicolon
id|i
OL
id|findParms.SearchCount
op_plus
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|UnixSearch
op_eq
id|FALSE
)paren
(brace
id|pfindData-&gt;FileNameLength
op_assign
id|le32_to_cpu
c_func
(paren
id|pfindData-&gt;FileNameLength
)paren
suffix:semicolon
r_if
c_cond
(paren
id|Unicode
op_eq
id|TRUE
)paren
id|pfindData-&gt;FileNameLength
op_assign
id|cifs_strfromUCS_le
(paren
id|pfindData-&gt;FileName
comma
(paren
m_wchar_t
op_star
)paren
id|pfindData-&gt;FileName
comma
(paren
id|pfindData
op_member_access_from_pointer
id|FileNameLength
)paren
op_div
l_int|2
comma
id|cifs_sb-&gt;local_nls
)paren
suffix:semicolon
id|qstring.len
op_assign
id|pfindData-&gt;FileNameLength
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|qstring.len
op_ne
l_int|1
)paren
op_logical_or
(paren
id|pfindData-&gt;FileName
(braket
l_int|0
)braket
op_ne
l_char|&squot;.&squot;
)paren
)paren
op_logical_and
(paren
(paren
id|qstring.len
op_ne
l_int|2
)paren
op_logical_or
(paren
id|pfindData
op_member_access_from_pointer
id|FileName
(braket
l_int|0
)braket
op_ne
l_char|&squot;.&squot;
)paren
op_logical_or
(paren
id|pfindData
op_member_access_from_pointer
id|FileName
(braket
l_int|1
)braket
op_ne
l_char|&squot;.&squot;
)paren
)paren
)paren
(brace
id|cifs_filldir
c_func
(paren
op_amp
id|qstring
comma
id|pfindData
comma
id|file
comma
id|filldir
comma
id|direntry
)paren
suffix:semicolon
id|file-&gt;f_pos
op_increment
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* UnixSearch */
id|pfindDataUnix
op_assign
(paren
id|FILE_UNIX_INFO
op_star
)paren
id|pfindData
suffix:semicolon
r_if
c_cond
(paren
id|Unicode
op_eq
id|TRUE
)paren
id|qstring.len
op_assign
id|cifs_strfromUCS_le
(paren
id|pfindDataUnix-&gt;FileName
comma
(paren
m_wchar_t
op_star
)paren
id|pfindDataUnix-&gt;FileName
comma
id|MAX_PATHCONF
comma
id|cifs_sb-&gt;local_nls
)paren
suffix:semicolon
r_else
id|qstring.len
op_assign
id|strnlen
c_func
(paren
id|pfindDataUnix
op_member_access_from_pointer
id|FileName
comma
id|MAX_PATHCONF
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|qstring.len
op_ne
l_int|1
)paren
op_logical_or
(paren
id|pfindDataUnix
op_member_access_from_pointer
id|FileName
(braket
l_int|0
)braket
op_ne
l_char|&squot;.&squot;
)paren
)paren
op_logical_and
(paren
(paren
id|qstring.len
op_ne
l_int|2
)paren
op_logical_or
(paren
id|pfindDataUnix
op_member_access_from_pointer
id|FileName
(braket
l_int|0
)braket
op_ne
l_char|&squot;.&squot;
)paren
op_logical_or
(paren
id|pfindDataUnix
op_member_access_from_pointer
id|FileName
(braket
l_int|1
)braket
op_ne
l_char|&squot;.&squot;
)paren
)paren
)paren
(brace
id|cifs_filldir_unix
c_func
(paren
op_amp
id|qstring
comma
id|pfindDataUnix
comma
id|file
comma
id|filldir
comma
id|direntry
)paren
suffix:semicolon
id|file-&gt;f_pos
op_increment
suffix:semicolon
)brace
)brace
multiline_comment|/* works also for Unix ff struct since first field of both */
id|pfindData
op_assign
(paren
id|FILE_DIRECTORY_INFO
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|pfindData
op_plus
id|le32_to_cpu
c_func
(paren
id|pfindData-&gt;NextEntryOffset
)paren
)paren
suffix:semicolon
multiline_comment|/* BB also should check to make sure that pointer is not beyond the end of the SMB */
multiline_comment|/* if(pfindData &gt; lastFindData) rc = -EIO; break; */
)brace
multiline_comment|/* end for loop */
r_if
c_cond
(paren
(paren
id|findParms.EndofSearch
op_ne
l_int|0
)paren
op_logical_and
id|cifsFile
)paren
(brace
id|cifsFile-&gt;endOfSearch
op_assign
id|TRUE
suffix:semicolon
r_if
c_cond
(paren
id|findParms.SearchCount
op_eq
l_int|2
)paren
(brace
id|cifsFile-&gt;emptyDir
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|cifsFile
)paren
id|cifsFile-&gt;endOfSearch
op_assign
id|TRUE
suffix:semicolon
multiline_comment|/* unless parent directory gone do not return error */
id|rc
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|file-&gt;private_data
op_eq
l_int|NULL
)paren
(brace
id|rc
op_assign
op_minus
id|EBADF
suffix:semicolon
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Readdir on closed srch, pos = %lld&quot;
comma
id|file-&gt;f_pos
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|cifsFile
op_assign
(paren
r_struct
id|cifsFileInfo
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
id|cifsFile-&gt;endOfSearch
)paren
(brace
id|rc
op_assign
l_int|0
suffix:semicolon
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;End of search &quot;
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|searchHandle
op_assign
id|cifsFile-&gt;netfid
suffix:semicolon
id|rc
op_assign
id|CIFSFindNext
c_func
(paren
id|xid
comma
id|pTcon
comma
id|pfindData
comma
op_amp
id|findNextParms
comma
id|searchHandle
comma
id|cifsFile-&gt;search_resume_name
comma
id|cifsFile-&gt;resume_name_length
comma
id|cifsFile-&gt;resume_key
comma
op_amp
id|Unicode
comma
op_amp
id|UnixSearch
)paren
suffix:semicolon
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Count: %d  End: %d &quot;
comma
id|findNextParms.SearchCount
comma
id|findNextParms.EndofSearch
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_eq
l_int|0
)paren
op_logical_and
(paren
id|findNextParms.SearchCount
op_ne
l_int|0
)paren
)paren
(brace
multiline_comment|/* BB save off resume key, key name and name length  */
id|lastFindData
op_assign
(paren
id|FILE_DIRECTORY_INFO
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|pfindData
op_plus
id|le32_to_cpu
c_func
(paren
id|findNextParms.LastNameOffset
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
r_char
op_star
)paren
id|lastFindData
OG
(paren
r_char
op_star
)paren
id|pfindData
op_plus
id|bufsize
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;last search entry past end of packet&quot;
)paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|EIO
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Offset of resume key same for levels 257 and 514 */
id|cifsFile-&gt;resume_key
op_assign
id|lastFindData-&gt;FileIndex
suffix:semicolon
r_if
c_cond
(paren
id|UnixSearch
op_eq
id|FALSE
)paren
(brace
id|cifsFile-&gt;resume_name_length
op_assign
id|le32_to_cpu
c_func
(paren
id|lastFindData-&gt;FileNameLength
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cifsFile-&gt;resume_name_length
OG
id|bufsize
op_minus
l_int|64
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Illegal resume file name length %d&quot;
comma
id|cifsFile-&gt;resume_name_length
)paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|cifsFile-&gt;search_resume_name
op_assign
id|kmalloc
c_func
(paren
id|cifsFile-&gt;resume_name_length
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Last file: %s with name %d bytes long&quot;
comma
id|lastFindData-&gt;FileName
comma
id|cifsFile-&gt;resume_name_length
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|cifsFile-&gt;search_resume_name
comma
id|lastFindData-&gt;FileName
comma
id|cifsFile-&gt;resume_name_length
)paren
suffix:semicolon
)brace
r_else
(brace
id|pfindDataUnix
op_assign
(paren
id|FILE_UNIX_INFO
op_star
)paren
id|lastFindData
suffix:semicolon
r_if
c_cond
(paren
id|Unicode
op_eq
id|TRUE
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|pfindDataUnix-&gt;FileName
(braket
id|i
)braket
op_or
id|pfindDataUnix-&gt;FileName
(braket
id|i
op_plus
l_int|1
)braket
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|i
OG
id|bufsize
op_minus
l_int|64
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
id|cifsFile-&gt;resume_name_length
op_assign
id|i
op_plus
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|cifsFile-&gt;resume_name_length
op_assign
id|strnlen
c_func
(paren
id|pfindDataUnix
op_member_access_from_pointer
id|FileName
comma
id|MAX_PATHCONF
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cifsFile-&gt;resume_name_length
OG
id|bufsize
op_minus
l_int|64
)paren
(brace
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;Illegal resume file name length %d&quot;
comma
id|cifsFile-&gt;resume_name_length
)paren
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|cifsFile-&gt;search_resume_name
op_assign
id|kmalloc
c_func
(paren
id|cifsFile-&gt;resume_name_length
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|cFYI
c_func
(paren
l_int|1
comma
(paren
l_string|&quot;fnext last file: %s with name %d bytes long&quot;
comma
id|lastFindData-&gt;FileName
comma
id|cifsFile-&gt;resume_name_length
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|cifsFile-&gt;search_resume_name
comma
id|lastFindData-&gt;FileName
comma
id|cifsFile-&gt;resume_name_length
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|findNextParms.SearchCount
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pfindData-&gt;FileNameLength
op_assign
id|le32_to_cpu
c_func
(paren
id|pfindData
op_member_access_from_pointer
id|FileNameLength
)paren
suffix:semicolon
r_if
c_cond
(paren
id|UnixSearch
op_eq
id|FALSE
)paren
(brace
r_if
c_cond
(paren
id|Unicode
op_eq
id|TRUE
)paren
id|pfindData-&gt;FileNameLength
op_assign
id|cifs_strfromUCS_le
(paren
id|pfindData-&gt;FileName
comma
(paren
m_wchar_t
op_star
)paren
id|pfindData-&gt;FileName
comma
(paren
id|pfindData-&gt;FileNameLength
)paren
op_div
l_int|2
comma
id|cifs_sb-&gt;local_nls
)paren
suffix:semicolon
id|qstring.len
op_assign
id|pfindData-&gt;FileNameLength
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|qstring.len
op_ne
l_int|1
)paren
op_logical_or
(paren
id|pfindData-&gt;FileName
(braket
l_int|0
)braket
op_ne
l_char|&squot;.&squot;
)paren
)paren
op_logical_and
(paren
(paren
id|qstring.len
op_ne
l_int|2
)paren
op_logical_or
(paren
id|pfindData-&gt;FileName
(braket
l_int|0
)braket
op_ne
l_char|&squot;.&squot;
)paren
op_logical_or
(paren
id|pfindData-&gt;FileName
(braket
l_int|1
)braket
op_ne
l_char|&squot;.&squot;
)paren
)paren
)paren
(brace
id|cifs_filldir
(paren
op_amp
id|qstring
comma
id|pfindData
comma
id|file
comma
id|filldir
comma
id|direntry
)paren
suffix:semicolon
id|file-&gt;f_pos
op_increment
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* UnixSearch */
id|pfindDataUnix
op_assign
(paren
id|FILE_UNIX_INFO
op_star
)paren
id|pfindData
suffix:semicolon
r_if
c_cond
(paren
id|Unicode
op_eq
id|TRUE
)paren
id|qstring.len
op_assign
id|cifs_strfromUCS_le
(paren
id|pfindDataUnix-&gt;FileName
comma
(paren
m_wchar_t
op_star
)paren
id|pfindDataUnix-&gt;FileName
comma
id|MAX_PATHCONF
comma
id|cifs_sb-&gt;local_nls
)paren
suffix:semicolon
r_else
id|qstring.len
op_assign
id|strnlen
(paren
id|pfindDataUnix
op_member_access_from_pointer
id|FileName
comma
id|MAX_PATHCONF
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|qstring.len
op_ne
l_int|1
)paren
op_logical_or
(paren
id|pfindDataUnix
op_member_access_from_pointer
id|FileName
(braket
l_int|0
)braket
op_ne
l_char|&squot;.&squot;
)paren
)paren
op_logical_and
(paren
(paren
id|qstring.len
op_ne
l_int|2
)paren
op_logical_or
(paren
id|pfindDataUnix
op_member_access_from_pointer
id|FileName
(braket
l_int|0
)braket
op_ne
l_char|&squot;.&squot;
)paren
op_logical_or
(paren
id|pfindDataUnix
op_member_access_from_pointer
id|FileName
(braket
l_int|1
)braket
op_ne
l_char|&squot;.&squot;
)paren
)paren
)paren
(brace
id|cifs_filldir_unix
(paren
op_amp
id|qstring
comma
id|pfindDataUnix
comma
id|file
comma
id|filldir
comma
id|direntry
)paren
suffix:semicolon
id|file-&gt;f_pos
op_increment
suffix:semicolon
)brace
)brace
id|pfindData
op_assign
(paren
id|FILE_DIRECTORY_INFO
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|pfindData
op_plus
id|le32_to_cpu
c_func
(paren
id|pfindData-&gt;NextEntryOffset
)paren
)paren
suffix:semicolon
multiline_comment|/* works also for Unix find struct since this is the first field of both */
multiline_comment|/* BB also should check to make sure that pointer is not beyond the end of the SMB */
)brace
multiline_comment|/* end for loop */
r_if
c_cond
(paren
id|findNextParms.EndofSearch
op_ne
l_int|0
)paren
(brace
id|cifsFile-&gt;endOfSearch
op_assign
id|TRUE
suffix:semicolon
)brace
)brace
r_else
(brace
id|cifsFile-&gt;endOfSearch
op_assign
id|TRUE
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* unless parent directory disappeared - do not return error here (eg Access Denied or no more files) */
)brace
)brace
)brace
multiline_comment|/* end switch */
r_if
c_cond
(paren
id|data
)paren
id|kfree
c_func
(paren
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|full_path
)paren
id|kfree
c_func
(paren
id|full_path
)paren
suffix:semicolon
id|FreeXid
c_func
(paren
id|xid
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|variable|cifs_addr_ops
r_struct
id|address_space_operations
id|cifs_addr_ops
op_assign
(brace
dot
id|readpage
op_assign
id|cifs_readpage
comma
dot
id|readpages
op_assign
id|cifs_readpages
comma
dot
id|writepage
op_assign
id|cifs_writepage
comma
dot
id|prepare_write
op_assign
id|simple_prepare_write
comma
dot
id|commit_write
op_assign
id|cifs_commit_write
comma
dot
id|sync_page
op_assign
id|cifs_sync_page
comma
multiline_comment|/*.direct_IO = */
)brace
suffix:semicolon
DECL|variable|cifs_addr_ops_writethrough
r_struct
id|address_space_operations
id|cifs_addr_ops_writethrough
op_assign
(brace
dot
id|readpage
op_assign
id|cifs_readpage
comma
dot
id|readpages
op_assign
id|cifs_readpages
comma
dot
id|writepage
op_assign
id|cifs_writepage
comma
dot
id|prepare_write
op_assign
id|simple_prepare_write
comma
dot
id|commit_write
op_assign
id|cifs_commit_write
comma
dot
id|sync_page
op_assign
id|cifs_sync_page
comma
multiline_comment|/*.direct_IO = &t; */
)brace
suffix:semicolon
DECL|variable|cifs_addr_ops_nocache
r_struct
id|address_space_operations
id|cifs_addr_ops_nocache
op_assign
(brace
dot
id|readpage
op_assign
id|cifs_readpage
comma
dot
id|readpages
op_assign
id|cifs_readpages
comma
dot
id|writepage
op_assign
id|cifs_writepage
comma
dot
id|prepare_write
op_assign
id|simple_prepare_write
comma
dot
id|commit_write
op_assign
id|cifs_commit_write
comma
dot
id|sync_page
op_assign
id|cifs_sync_page
comma
multiline_comment|/*.direct_IO = */
)brace
suffix:semicolon
eof
