multiline_comment|/*&n; *  fs/partitions/sgi.c&n; *&n; *  Code extracted from drivers/block/genhd.c&n; */
macro_line|#include &quot;check.h&quot;
macro_line|#include &quot;sgi.h&quot;
DECL|struct|sgi_disklabel
r_struct
id|sgi_disklabel
(brace
DECL|member|magic_mushroom
id|__be32
id|magic_mushroom
suffix:semicolon
multiline_comment|/* Big fat spliff... */
DECL|member|root_part_num
id|__be16
id|root_part_num
suffix:semicolon
multiline_comment|/* Root partition number */
DECL|member|swap_part_num
id|__be16
id|swap_part_num
suffix:semicolon
multiline_comment|/* Swap partition number */
DECL|member|boot_file
id|s8
id|boot_file
(braket
l_int|16
)braket
suffix:semicolon
multiline_comment|/* Name of boot file for ARCS */
DECL|member|_unused0
id|u8
id|_unused0
(braket
l_int|48
)braket
suffix:semicolon
multiline_comment|/* Device parameter useless crapola.. */
DECL|struct|sgi_volume
r_struct
id|sgi_volume
(brace
DECL|member|name
id|s8
id|name
(braket
l_int|8
)braket
suffix:semicolon
multiline_comment|/* Name of volume */
DECL|member|block_num
id|__be32
id|block_num
suffix:semicolon
multiline_comment|/* Logical block number */
DECL|member|num_bytes
id|__be32
id|num_bytes
suffix:semicolon
multiline_comment|/* How big, in bytes */
DECL|member|volume
)brace
id|volume
(braket
l_int|15
)braket
suffix:semicolon
DECL|struct|sgi_partition
r_struct
id|sgi_partition
(brace
DECL|member|num_blocks
id|__be32
id|num_blocks
suffix:semicolon
multiline_comment|/* Size in logical blocks */
DECL|member|first_block
id|__be32
id|first_block
suffix:semicolon
multiline_comment|/* First logical block */
DECL|member|type
id|__be32
id|type
suffix:semicolon
multiline_comment|/* Type of this partition */
DECL|member|partitions
)brace
id|partitions
(braket
l_int|16
)braket
suffix:semicolon
DECL|member|csum
id|__be32
id|csum
suffix:semicolon
multiline_comment|/* Disk label checksum */
DECL|member|_unused1
id|__be32
id|_unused1
suffix:semicolon
multiline_comment|/* Padding */
)brace
suffix:semicolon
DECL|function|sgi_partition
r_int
id|sgi_partition
c_func
(paren
r_struct
id|parsed_partitions
op_star
id|state
comma
r_struct
id|block_device
op_star
id|bdev
)paren
(brace
r_int
id|i
comma
id|csum
suffix:semicolon
id|__be32
id|magic
suffix:semicolon
r_int
id|slot
op_assign
l_int|1
suffix:semicolon
r_int
r_int
id|start
comma
id|blocks
suffix:semicolon
id|__be32
op_star
id|ui
comma
id|cs
suffix:semicolon
id|Sector
id|sect
suffix:semicolon
r_struct
id|sgi_disklabel
op_star
id|label
suffix:semicolon
r_struct
id|sgi_partition
op_star
id|p
suffix:semicolon
r_char
id|b
(braket
id|BDEVNAME_SIZE
)braket
suffix:semicolon
id|label
op_assign
(paren
r_struct
id|sgi_disklabel
op_star
)paren
id|read_dev_sector
c_func
(paren
id|bdev
comma
l_int|0
comma
op_amp
id|sect
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|label
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|p
op_assign
op_amp
id|label-&gt;partitions
(braket
l_int|0
)braket
suffix:semicolon
id|magic
op_assign
id|label-&gt;magic_mushroom
suffix:semicolon
r_if
c_cond
(paren
id|be32_to_cpu
c_func
(paren
id|magic
)paren
op_ne
id|SGI_LABEL_MAGIC
)paren
(brace
multiline_comment|/*printk(&quot;Dev %s SGI disklabel: bad magic %08x&bslash;n&quot;,&n;&t;&t;       bdevname(bdev, b), be32_to_cpu(magic));*/
id|put_dev_sector
c_func
(paren
id|sect
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ui
op_assign
(paren
(paren
id|__be32
op_star
)paren
(paren
id|label
op_plus
l_int|1
)paren
)paren
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|csum
op_assign
l_int|0
suffix:semicolon
id|ui
op_ge
(paren
(paren
id|__be32
op_star
)paren
id|label
)paren
suffix:semicolon
)paren
(brace
id|cs
op_assign
op_star
id|ui
op_decrement
suffix:semicolon
id|csum
op_add_assign
id|be32_to_cpu
c_func
(paren
id|cs
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|csum
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Dev %s SGI disklabel: csum bad, label corrupted&bslash;n&quot;
comma
id|bdevname
c_func
(paren
id|bdev
comma
id|b
)paren
)paren
suffix:semicolon
id|put_dev_sector
c_func
(paren
id|sect
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* All SGI disk labels have 16 partitions, disks under Linux only&n;&t; * have 15 minor&squot;s.  Luckily there are always a few zero length&n;&t; * partitions which we don&squot;t care about so we never overflow the&n;&t; * current_minor.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
comma
id|p
op_increment
)paren
(brace
id|blocks
op_assign
id|be32_to_cpu
c_func
(paren
id|p-&gt;num_blocks
)paren
suffix:semicolon
id|start
op_assign
id|be32_to_cpu
c_func
(paren
id|p-&gt;first_block
)paren
suffix:semicolon
r_if
c_cond
(paren
id|blocks
)paren
(brace
id|put_partition
c_func
(paren
id|state
comma
id|slot
comma
id|start
comma
id|blocks
)paren
suffix:semicolon
r_if
c_cond
(paren
id|be32_to_cpu
c_func
(paren
id|p-&gt;type
)paren
op_eq
id|LINUX_RAID_PARTITION
)paren
id|state-&gt;parts
(braket
id|slot
)braket
dot
id|flags
op_assign
l_int|1
suffix:semicolon
)brace
id|slot
op_increment
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|put_dev_sector
c_func
(paren
id|sect
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
eof
