multiline_comment|/*&n; * Copyright (C) 2004, OGAWA Hirofumi&n; * Released under GPL v2.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/msdos_fs.h&gt;
DECL|struct|fatent_operations
r_struct
id|fatent_operations
(brace
DECL|member|ent_blocknr
r_void
(paren
op_star
id|ent_blocknr
)paren
(paren
r_struct
id|super_block
op_star
comma
r_int
comma
r_int
op_star
comma
id|sector_t
op_star
)paren
suffix:semicolon
DECL|member|ent_set_ptr
r_void
(paren
op_star
id|ent_set_ptr
)paren
(paren
r_struct
id|fat_entry
op_star
comma
r_int
)paren
suffix:semicolon
DECL|member|ent_bread
r_int
(paren
op_star
id|ent_bread
)paren
(paren
r_struct
id|super_block
op_star
comma
r_struct
id|fat_entry
op_star
comma
r_int
comma
id|sector_t
)paren
suffix:semicolon
DECL|member|ent_get
r_int
(paren
op_star
id|ent_get
)paren
(paren
r_struct
id|fat_entry
op_star
)paren
suffix:semicolon
DECL|member|ent_put
r_void
(paren
op_star
id|ent_put
)paren
(paren
r_struct
id|fat_entry
op_star
comma
r_int
)paren
suffix:semicolon
DECL|member|ent_next
r_int
(paren
op_star
id|ent_next
)paren
(paren
r_struct
id|fat_entry
op_star
)paren
suffix:semicolon
)brace
suffix:semicolon
DECL|function|fat12_ent_blocknr
r_static
r_void
id|fat12_ent_blocknr
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_int
id|entry
comma
r_int
op_star
id|offset
comma
id|sector_t
op_star
id|blocknr
)paren
(brace
r_struct
id|msdos_sb_info
op_star
id|sbi
op_assign
id|MSDOS_SB
c_func
(paren
id|sb
)paren
suffix:semicolon
r_int
id|bytes
op_assign
id|entry
op_plus
(paren
id|entry
op_rshift
l_int|1
)paren
suffix:semicolon
id|WARN_ON
c_func
(paren
id|entry
OL
id|FAT_START_ENT
op_logical_or
id|sbi-&gt;max_cluster
op_le
id|entry
)paren
suffix:semicolon
op_star
id|offset
op_assign
id|bytes
op_amp
(paren
id|sb-&gt;s_blocksize
op_minus
l_int|1
)paren
suffix:semicolon
op_star
id|blocknr
op_assign
id|sbi-&gt;fat_start
op_plus
(paren
id|bytes
op_rshift
id|sb-&gt;s_blocksize_bits
)paren
suffix:semicolon
)brace
DECL|function|fat_ent_blocknr
r_static
r_void
id|fat_ent_blocknr
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_int
id|entry
comma
r_int
op_star
id|offset
comma
id|sector_t
op_star
id|blocknr
)paren
(brace
r_struct
id|msdos_sb_info
op_star
id|sbi
op_assign
id|MSDOS_SB
c_func
(paren
id|sb
)paren
suffix:semicolon
r_int
id|bytes
op_assign
(paren
id|entry
op_lshift
id|sbi-&gt;fatent_shift
)paren
suffix:semicolon
id|WARN_ON
c_func
(paren
id|entry
OL
id|FAT_START_ENT
op_logical_or
id|sbi-&gt;max_cluster
op_le
id|entry
)paren
suffix:semicolon
op_star
id|offset
op_assign
id|bytes
op_amp
(paren
id|sb-&gt;s_blocksize
op_minus
l_int|1
)paren
suffix:semicolon
op_star
id|blocknr
op_assign
id|sbi-&gt;fat_start
op_plus
(paren
id|bytes
op_rshift
id|sb-&gt;s_blocksize_bits
)paren
suffix:semicolon
)brace
DECL|function|fat12_ent_set_ptr
r_static
r_void
id|fat12_ent_set_ptr
c_func
(paren
r_struct
id|fat_entry
op_star
id|fatent
comma
r_int
id|offset
)paren
(brace
r_struct
id|buffer_head
op_star
op_star
id|bhs
op_assign
id|fatent-&gt;bhs
suffix:semicolon
r_if
c_cond
(paren
id|fatent-&gt;nr_bhs
op_eq
l_int|1
)paren
(brace
id|WARN_ON
c_func
(paren
id|offset
op_ge
(paren
id|bhs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|b_size
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|fatent-&gt;u.ent12_p
(braket
l_int|0
)braket
op_assign
id|bhs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|b_data
op_plus
id|offset
suffix:semicolon
id|fatent-&gt;u.ent12_p
(braket
l_int|1
)braket
op_assign
id|bhs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|b_data
op_plus
(paren
id|offset
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|WARN_ON
c_func
(paren
id|offset
op_ne
(paren
id|bhs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|b_size
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|fatent-&gt;u.ent12_p
(braket
l_int|0
)braket
op_assign
id|bhs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|b_data
op_plus
id|offset
suffix:semicolon
id|fatent-&gt;u.ent12_p
(braket
l_int|1
)braket
op_assign
id|bhs
(braket
l_int|1
)braket
op_member_access_from_pointer
id|b_data
suffix:semicolon
)brace
)brace
DECL|function|fat16_ent_set_ptr
r_static
r_void
id|fat16_ent_set_ptr
c_func
(paren
r_struct
id|fat_entry
op_star
id|fatent
comma
r_int
id|offset
)paren
(brace
id|WARN_ON
c_func
(paren
id|offset
op_amp
(paren
l_int|2
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|fatent-&gt;u.ent16_p
op_assign
(paren
id|__le16
op_star
)paren
(paren
id|fatent-&gt;bhs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|b_data
op_plus
id|offset
)paren
suffix:semicolon
)brace
DECL|function|fat32_ent_set_ptr
r_static
r_void
id|fat32_ent_set_ptr
c_func
(paren
r_struct
id|fat_entry
op_star
id|fatent
comma
r_int
id|offset
)paren
(brace
id|WARN_ON
c_func
(paren
id|offset
op_amp
(paren
l_int|4
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|fatent-&gt;u.ent32_p
op_assign
(paren
id|__le32
op_star
)paren
(paren
id|fatent-&gt;bhs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|b_data
op_plus
id|offset
)paren
suffix:semicolon
)brace
DECL|function|fat12_ent_bread
r_static
r_int
id|fat12_ent_bread
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|fat_entry
op_star
id|fatent
comma
r_int
id|offset
comma
id|sector_t
id|blocknr
)paren
(brace
r_struct
id|buffer_head
op_star
op_star
id|bhs
op_assign
id|fatent-&gt;bhs
suffix:semicolon
id|WARN_ON
c_func
(paren
id|blocknr
OL
id|MSDOS_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|fat_start
)paren
suffix:semicolon
id|bhs
(braket
l_int|0
)braket
op_assign
id|sb_bread
c_func
(paren
id|sb
comma
id|blocknr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bhs
(braket
l_int|0
)braket
)paren
r_goto
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|offset
op_plus
l_int|1
)paren
OL
id|sb-&gt;s_blocksize
)paren
id|fatent-&gt;nr_bhs
op_assign
l_int|1
suffix:semicolon
r_else
(brace
multiline_comment|/* This entry is block boundary, it needs the next block */
id|blocknr
op_increment
suffix:semicolon
id|bhs
(braket
l_int|1
)braket
op_assign
id|sb_bread
c_func
(paren
id|sb
comma
id|blocknr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bhs
(braket
l_int|1
)braket
)paren
r_goto
id|err_brelse
suffix:semicolon
id|fatent-&gt;nr_bhs
op_assign
l_int|2
suffix:semicolon
)brace
id|fat12_ent_set_ptr
c_func
(paren
id|fatent
comma
id|offset
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_brelse
suffix:colon
id|brelse
c_func
(paren
id|bhs
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|err
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;FAT: FAT read failed (blocknr %llu)&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|blocknr
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|fat_ent_bread
r_static
r_int
id|fat_ent_bread
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|fat_entry
op_star
id|fatent
comma
r_int
id|offset
comma
id|sector_t
id|blocknr
)paren
(brace
r_struct
id|fatent_operations
op_star
id|ops
op_assign
id|MSDOS_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|fatent_ops
suffix:semicolon
id|WARN_ON
c_func
(paren
id|blocknr
OL
id|MSDOS_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|fat_start
)paren
suffix:semicolon
id|fatent-&gt;bhs
(braket
l_int|0
)braket
op_assign
id|sb_bread
c_func
(paren
id|sb
comma
id|blocknr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fatent-&gt;bhs
(braket
l_int|0
)braket
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;FAT: FAT read failed (blocknr %llu)&bslash;n&quot;
comma
(paren
r_int
r_int
r_int
)paren
id|blocknr
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|fatent-&gt;nr_bhs
op_assign
l_int|1
suffix:semicolon
id|ops
op_member_access_from_pointer
id|ent_set_ptr
c_func
(paren
id|fatent
comma
id|offset
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fat12_ent_get
r_static
r_int
id|fat12_ent_get
c_func
(paren
r_struct
id|fat_entry
op_star
id|fatent
)paren
(brace
id|u8
op_star
op_star
id|ent12_p
op_assign
id|fatent-&gt;u.ent12_p
suffix:semicolon
r_int
id|next
suffix:semicolon
r_if
c_cond
(paren
id|fatent-&gt;entry
op_amp
l_int|1
)paren
id|next
op_assign
(paren
op_star
id|ent12_p
(braket
l_int|0
)braket
op_rshift
l_int|4
)paren
op_or
(paren
op_star
id|ent12_p
(braket
l_int|1
)braket
op_lshift
l_int|4
)paren
suffix:semicolon
r_else
id|next
op_assign
(paren
op_star
id|ent12_p
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
op_star
id|ent12_p
(braket
l_int|0
)braket
suffix:semicolon
id|next
op_and_assign
l_int|0x0fff
suffix:semicolon
r_if
c_cond
(paren
id|next
op_ge
id|BAD_FAT12
)paren
id|next
op_assign
id|FAT_ENT_EOF
suffix:semicolon
r_return
id|next
suffix:semicolon
)brace
DECL|function|fat16_ent_get
r_static
r_int
id|fat16_ent_get
c_func
(paren
r_struct
id|fat_entry
op_star
id|fatent
)paren
(brace
r_int
id|next
op_assign
id|le16_to_cpu
c_func
(paren
op_star
id|fatent-&gt;u.ent16_p
)paren
suffix:semicolon
id|WARN_ON
c_func
(paren
(paren
r_int
r_int
)paren
id|fatent-&gt;u.ent16_p
op_amp
(paren
l_int|2
op_minus
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|next
op_ge
id|BAD_FAT16
)paren
id|next
op_assign
id|FAT_ENT_EOF
suffix:semicolon
r_return
id|next
suffix:semicolon
)brace
DECL|function|fat32_ent_get
r_static
r_int
id|fat32_ent_get
c_func
(paren
r_struct
id|fat_entry
op_star
id|fatent
)paren
(brace
r_int
id|next
op_assign
id|le32_to_cpu
c_func
(paren
op_star
id|fatent-&gt;u.ent32_p
)paren
op_amp
l_int|0x0fffffff
suffix:semicolon
id|WARN_ON
c_func
(paren
(paren
r_int
r_int
)paren
id|fatent-&gt;u.ent32_p
op_amp
(paren
l_int|4
op_minus
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|next
op_ge
id|BAD_FAT32
)paren
id|next
op_assign
id|FAT_ENT_EOF
suffix:semicolon
r_return
id|next
suffix:semicolon
)brace
DECL|function|fat12_ent_put
r_static
r_void
id|fat12_ent_put
c_func
(paren
r_struct
id|fat_entry
op_star
id|fatent
comma
r_int
r_new
)paren
(brace
id|u8
op_star
op_star
id|ent12_p
op_assign
id|fatent-&gt;u.ent12_p
suffix:semicolon
r_if
c_cond
(paren
r_new
op_eq
id|FAT_ENT_EOF
)paren
r_new
op_assign
id|EOF_FAT12
suffix:semicolon
r_if
c_cond
(paren
id|fatent-&gt;entry
op_amp
l_int|1
)paren
(brace
op_star
id|ent12_p
(braket
l_int|0
)braket
op_assign
(paren
r_new
op_lshift
l_int|4
)paren
op_or
(paren
op_star
id|ent12_p
(braket
l_int|0
)braket
op_amp
l_int|0x0f
)paren
suffix:semicolon
op_star
id|ent12_p
(braket
l_int|1
)braket
op_assign
r_new
op_rshift
l_int|4
suffix:semicolon
)brace
r_else
(brace
op_star
id|ent12_p
(braket
l_int|0
)braket
op_assign
r_new
op_amp
l_int|0xff
suffix:semicolon
op_star
id|ent12_p
(braket
l_int|1
)braket
op_assign
(paren
op_star
id|ent12_p
(braket
l_int|1
)braket
op_amp
l_int|0xf0
)paren
op_or
(paren
r_new
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
id|mark_buffer_dirty
c_func
(paren
id|fatent-&gt;bhs
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fatent-&gt;nr_bhs
op_eq
l_int|2
)paren
id|mark_buffer_dirty
c_func
(paren
id|fatent-&gt;bhs
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
DECL|function|fat16_ent_put
r_static
r_void
id|fat16_ent_put
c_func
(paren
r_struct
id|fat_entry
op_star
id|fatent
comma
r_int
r_new
)paren
(brace
r_if
c_cond
(paren
r_new
op_eq
id|FAT_ENT_EOF
)paren
r_new
op_assign
id|EOF_FAT16
suffix:semicolon
op_star
id|fatent-&gt;u.ent16_p
op_assign
id|cpu_to_le16
c_func
(paren
r_new
)paren
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
id|fatent-&gt;bhs
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
DECL|function|fat32_ent_put
r_static
r_void
id|fat32_ent_put
c_func
(paren
r_struct
id|fat_entry
op_star
id|fatent
comma
r_int
r_new
)paren
(brace
r_if
c_cond
(paren
r_new
op_eq
id|FAT_ENT_EOF
)paren
r_new
op_assign
id|EOF_FAT32
suffix:semicolon
id|WARN_ON
c_func
(paren
r_new
op_amp
l_int|0xf0000000
)paren
suffix:semicolon
r_new
op_or_assign
id|le32_to_cpu
c_func
(paren
op_star
id|fatent-&gt;u.ent32_p
)paren
op_amp
op_complement
l_int|0x0fffffff
suffix:semicolon
op_star
id|fatent-&gt;u.ent32_p
op_assign
id|cpu_to_le32
c_func
(paren
r_new
)paren
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
id|fatent-&gt;bhs
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
DECL|function|fat12_ent_next
r_static
r_int
id|fat12_ent_next
c_func
(paren
r_struct
id|fat_entry
op_star
id|fatent
)paren
(brace
id|u8
op_star
op_star
id|ent12_p
op_assign
id|fatent-&gt;u.ent12_p
suffix:semicolon
r_struct
id|buffer_head
op_star
op_star
id|bhs
op_assign
id|fatent-&gt;bhs
suffix:semicolon
id|u8
op_star
id|nextp
op_assign
id|ent12_p
(braket
l_int|1
)braket
op_plus
l_int|1
op_plus
(paren
id|fatent-&gt;entry
op_amp
l_int|1
)paren
suffix:semicolon
id|fatent-&gt;entry
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fatent-&gt;nr_bhs
op_eq
l_int|1
)paren
(brace
id|WARN_ON
c_func
(paren
id|ent12_p
(braket
l_int|0
)braket
OG
(paren
id|u8
op_star
)paren
(paren
id|bhs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|b_data
op_plus
(paren
id|bhs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|b_size
op_minus
l_int|2
)paren
)paren
)paren
suffix:semicolon
id|WARN_ON
c_func
(paren
id|ent12_p
(braket
l_int|1
)braket
OG
(paren
id|u8
op_star
)paren
(paren
id|bhs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|b_data
op_plus
(paren
id|bhs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|b_size
op_minus
l_int|1
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nextp
OL
(paren
id|u8
op_star
)paren
(paren
id|bhs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|b_data
op_plus
(paren
id|bhs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|b_size
op_minus
l_int|1
)paren
)paren
)paren
(brace
id|ent12_p
(braket
l_int|0
)braket
op_assign
id|nextp
op_minus
l_int|1
suffix:semicolon
id|ent12_p
(braket
l_int|1
)braket
op_assign
id|nextp
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
id|WARN_ON
c_func
(paren
id|ent12_p
(braket
l_int|0
)braket
op_ne
(paren
id|u8
op_star
)paren
(paren
id|bhs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|b_data
op_plus
(paren
id|bhs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|b_size
op_minus
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|WARN_ON
c_func
(paren
id|ent12_p
(braket
l_int|1
)braket
op_ne
(paren
id|u8
op_star
)paren
id|bhs
(braket
l_int|1
)braket
op_member_access_from_pointer
id|b_data
)paren
suffix:semicolon
id|ent12_p
(braket
l_int|0
)braket
op_assign
id|nextp
op_minus
l_int|1
suffix:semicolon
id|ent12_p
(braket
l_int|1
)braket
op_assign
id|nextp
suffix:semicolon
id|brelse
c_func
(paren
id|bhs
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|bhs
(braket
l_int|0
)braket
op_assign
id|bhs
(braket
l_int|1
)braket
suffix:semicolon
id|fatent-&gt;nr_bhs
op_assign
l_int|1
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|ent12_p
(braket
l_int|0
)braket
op_assign
l_int|NULL
suffix:semicolon
id|ent12_p
(braket
l_int|1
)braket
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fat16_ent_next
r_static
r_int
id|fat16_ent_next
c_func
(paren
r_struct
id|fat_entry
op_star
id|fatent
)paren
(brace
r_const
r_struct
id|buffer_head
op_star
id|bh
op_assign
id|fatent-&gt;bhs
(braket
l_int|0
)braket
suffix:semicolon
id|fatent-&gt;entry
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fatent-&gt;u.ent16_p
OL
(paren
id|__le16
op_star
)paren
(paren
id|bh-&gt;b_data
op_plus
(paren
id|bh-&gt;b_size
op_minus
l_int|2
)paren
)paren
)paren
(brace
id|fatent-&gt;u.ent16_p
op_increment
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|fatent-&gt;u.ent16_p
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fat32_ent_next
r_static
r_int
id|fat32_ent_next
c_func
(paren
r_struct
id|fat_entry
op_star
id|fatent
)paren
(brace
r_const
r_struct
id|buffer_head
op_star
id|bh
op_assign
id|fatent-&gt;bhs
(braket
l_int|0
)braket
suffix:semicolon
id|fatent-&gt;entry
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|fatent-&gt;u.ent32_p
OL
(paren
id|__le32
op_star
)paren
(paren
id|bh-&gt;b_data
op_plus
(paren
id|bh-&gt;b_size
op_minus
l_int|4
)paren
)paren
)paren
(brace
id|fatent-&gt;u.ent32_p
op_increment
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|fatent-&gt;u.ent32_p
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|fat12_ops
r_static
r_struct
id|fatent_operations
id|fat12_ops
op_assign
(brace
dot
id|ent_blocknr
op_assign
id|fat12_ent_blocknr
comma
dot
id|ent_set_ptr
op_assign
id|fat12_ent_set_ptr
comma
dot
id|ent_bread
op_assign
id|fat12_ent_bread
comma
dot
id|ent_get
op_assign
id|fat12_ent_get
comma
dot
id|ent_put
op_assign
id|fat12_ent_put
comma
dot
id|ent_next
op_assign
id|fat12_ent_next
comma
)brace
suffix:semicolon
DECL|variable|fat16_ops
r_static
r_struct
id|fatent_operations
id|fat16_ops
op_assign
(brace
dot
id|ent_blocknr
op_assign
id|fat_ent_blocknr
comma
dot
id|ent_set_ptr
op_assign
id|fat16_ent_set_ptr
comma
dot
id|ent_bread
op_assign
id|fat_ent_bread
comma
dot
id|ent_get
op_assign
id|fat16_ent_get
comma
dot
id|ent_put
op_assign
id|fat16_ent_put
comma
dot
id|ent_next
op_assign
id|fat16_ent_next
comma
)brace
suffix:semicolon
DECL|variable|fat32_ops
r_static
r_struct
id|fatent_operations
id|fat32_ops
op_assign
(brace
dot
id|ent_blocknr
op_assign
id|fat_ent_blocknr
comma
dot
id|ent_set_ptr
op_assign
id|fat32_ent_set_ptr
comma
dot
id|ent_bread
op_assign
id|fat_ent_bread
comma
dot
id|ent_get
op_assign
id|fat32_ent_get
comma
dot
id|ent_put
op_assign
id|fat32_ent_put
comma
dot
id|ent_next
op_assign
id|fat32_ent_next
comma
)brace
suffix:semicolon
DECL|function|lock_fat
r_static
r_inline
r_void
id|lock_fat
c_func
(paren
r_struct
id|msdos_sb_info
op_star
id|sbi
)paren
(brace
id|down
c_func
(paren
op_amp
id|sbi-&gt;fat_lock
)paren
suffix:semicolon
)brace
DECL|function|unlock_fat
r_static
r_inline
r_void
id|unlock_fat
c_func
(paren
r_struct
id|msdos_sb_info
op_star
id|sbi
)paren
(brace
id|up
c_func
(paren
op_amp
id|sbi-&gt;fat_lock
)paren
suffix:semicolon
)brace
DECL|function|fat_ent_access_init
r_void
id|fat_ent_access_init
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_struct
id|msdos_sb_info
op_star
id|sbi
op_assign
id|MSDOS_SB
c_func
(paren
id|sb
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|sbi-&gt;fat_lock
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|sbi-&gt;fat_bits
)paren
(brace
r_case
l_int|32
suffix:colon
id|sbi-&gt;fatent_shift
op_assign
l_int|2
suffix:semicolon
id|sbi-&gt;fatent_ops
op_assign
op_amp
id|fat32_ops
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|sbi-&gt;fatent_shift
op_assign
l_int|1
suffix:semicolon
id|sbi-&gt;fatent_ops
op_assign
op_amp
id|fat16_ops
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|12
suffix:colon
id|sbi-&gt;fatent_shift
op_assign
op_minus
l_int|1
suffix:semicolon
id|sbi-&gt;fatent_ops
op_assign
op_amp
id|fat12_ops
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|fat_ent_update_ptr
r_static
r_inline
r_int
id|fat_ent_update_ptr
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|fat_entry
op_star
id|fatent
comma
r_int
id|offset
comma
id|sector_t
id|blocknr
)paren
(brace
r_struct
id|msdos_sb_info
op_star
id|sbi
op_assign
id|MSDOS_SB
c_func
(paren
id|sb
)paren
suffix:semicolon
r_struct
id|fatent_operations
op_star
id|ops
op_assign
id|sbi-&gt;fatent_ops
suffix:semicolon
r_struct
id|buffer_head
op_star
op_star
id|bhs
op_assign
id|fatent-&gt;bhs
suffix:semicolon
multiline_comment|/* Is this fatent&squot;s blocks including this entry? */
r_if
c_cond
(paren
op_logical_neg
id|fatent-&gt;nr_bhs
op_logical_or
id|bhs
(braket
l_int|0
)braket
op_member_access_from_pointer
id|b_blocknr
op_ne
id|blocknr
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Does this entry need the next block? */
r_if
c_cond
(paren
id|sbi-&gt;fat_bits
op_eq
l_int|12
op_logical_and
(paren
id|offset
op_plus
l_int|1
)paren
op_ge
id|sb-&gt;s_blocksize
)paren
(brace
r_if
c_cond
(paren
id|fatent-&gt;nr_bhs
op_ne
l_int|2
op_logical_or
id|bhs
(braket
l_int|1
)braket
op_member_access_from_pointer
id|b_blocknr
op_ne
(paren
id|blocknr
op_plus
l_int|1
)paren
)paren
r_return
l_int|0
suffix:semicolon
)brace
id|ops
op_member_access_from_pointer
id|ent_set_ptr
c_func
(paren
id|fatent
comma
id|offset
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|fat_ent_read
r_int
id|fat_ent_read
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|fat_entry
op_star
id|fatent
comma
r_int
id|entry
)paren
(brace
r_struct
id|super_block
op_star
id|sb
op_assign
id|inode-&gt;i_sb
suffix:semicolon
r_struct
id|msdos_sb_info
op_star
id|sbi
op_assign
id|MSDOS_SB
c_func
(paren
id|inode-&gt;i_sb
)paren
suffix:semicolon
r_struct
id|fatent_operations
op_star
id|ops
op_assign
id|sbi-&gt;fatent_ops
suffix:semicolon
r_int
id|err
comma
id|offset
suffix:semicolon
id|sector_t
id|blocknr
suffix:semicolon
r_if
c_cond
(paren
id|entry
OL
id|FAT_START_ENT
op_logical_or
id|sbi-&gt;max_cluster
op_le
id|entry
)paren
(brace
id|fatent_brelse
c_func
(paren
id|fatent
)paren
suffix:semicolon
id|fat_fs_panic
c_func
(paren
id|sb
comma
l_string|&quot;invalid access to FAT (entry 0x%08x)&quot;
comma
id|entry
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|fatent_set_entry
c_func
(paren
id|fatent
comma
id|entry
)paren
suffix:semicolon
id|ops
op_member_access_from_pointer
id|ent_blocknr
c_func
(paren
id|sb
comma
id|entry
comma
op_amp
id|offset
comma
op_amp
id|blocknr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fat_ent_update_ptr
c_func
(paren
id|sb
comma
id|fatent
comma
id|offset
comma
id|blocknr
)paren
)paren
(brace
id|fatent_brelse
c_func
(paren
id|fatent
)paren
suffix:semicolon
id|err
op_assign
id|ops
op_member_access_from_pointer
id|ent_bread
c_func
(paren
id|sb
comma
id|fatent
comma
id|offset
comma
id|blocknr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
id|ops
op_member_access_from_pointer
id|ent_get
c_func
(paren
id|fatent
)paren
suffix:semicolon
)brace
multiline_comment|/* FIXME: We can write the blocks as more big chunk. */
DECL|function|fat_mirror_bhs
r_static
r_int
id|fat_mirror_bhs
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|buffer_head
op_star
op_star
id|bhs
comma
r_int
id|nr_bhs
)paren
(brace
r_struct
id|msdos_sb_info
op_star
id|sbi
op_assign
id|MSDOS_SB
c_func
(paren
id|sb
)paren
suffix:semicolon
r_struct
id|buffer_head
op_star
id|c_bh
suffix:semicolon
r_int
id|err
comma
id|n
comma
id|copy
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|copy
op_assign
l_int|1
suffix:semicolon
id|copy
OL
id|sbi-&gt;fats
suffix:semicolon
id|copy
op_increment
)paren
(brace
id|sector_t
id|backup_fat
op_assign
id|sbi-&gt;fat_length
op_star
id|copy
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|nr_bhs
suffix:semicolon
id|n
op_increment
)paren
(brace
id|c_bh
op_assign
id|sb_getblk
c_func
(paren
id|sb
comma
id|backup_fat
op_plus
id|bhs
(braket
id|n
)braket
op_member_access_from_pointer
id|b_blocknr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c_bh
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|c_bh-&gt;b_data
comma
id|bhs
(braket
id|n
)braket
op_member_access_from_pointer
id|b_data
comma
id|sb-&gt;s_blocksize
)paren
suffix:semicolon
id|set_buffer_uptodate
c_func
(paren
id|c_bh
)paren
suffix:semicolon
id|mark_buffer_dirty
c_func
(paren
id|c_bh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb-&gt;s_flags
op_amp
id|MS_SYNCHRONOUS
)paren
id|err
op_assign
id|sync_dirty_buffer
c_func
(paren
id|c_bh
)paren
suffix:semicolon
id|brelse
c_func
(paren
id|c_bh
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|error
suffix:semicolon
)brace
)brace
id|error
suffix:colon
r_return
id|err
suffix:semicolon
)brace
DECL|function|fat_ent_write
r_int
id|fat_ent_write
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|fat_entry
op_star
id|fatent
comma
r_int
r_new
comma
r_int
id|wait
)paren
(brace
r_struct
id|super_block
op_star
id|sb
op_assign
id|inode-&gt;i_sb
suffix:semicolon
r_struct
id|fatent_operations
op_star
id|ops
op_assign
id|MSDOS_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|fatent_ops
suffix:semicolon
r_int
id|err
suffix:semicolon
id|ops
op_member_access_from_pointer
id|ent_put
c_func
(paren
id|fatent
comma
r_new
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wait
)paren
(brace
id|err
op_assign
id|fat_sync_bhs
c_func
(paren
id|fatent-&gt;bhs
comma
id|fatent-&gt;nr_bhs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
id|fat_mirror_bhs
c_func
(paren
id|sb
comma
id|fatent-&gt;bhs
comma
id|fatent-&gt;nr_bhs
)paren
suffix:semicolon
)brace
DECL|function|fat_ent_next
r_static
r_inline
r_int
id|fat_ent_next
c_func
(paren
r_struct
id|msdos_sb_info
op_star
id|sbi
comma
r_struct
id|fat_entry
op_star
id|fatent
)paren
(brace
r_if
c_cond
(paren
id|sbi-&gt;fatent_ops
op_member_access_from_pointer
id|ent_next
c_func
(paren
id|fatent
)paren
)paren
(brace
r_if
c_cond
(paren
id|fatent-&gt;entry
OL
id|sbi-&gt;max_cluster
)paren
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|fat_ent_read_block
r_static
r_inline
r_int
id|fat_ent_read_block
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|fat_entry
op_star
id|fatent
)paren
(brace
r_struct
id|fatent_operations
op_star
id|ops
op_assign
id|MSDOS_SB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|fatent_ops
suffix:semicolon
id|sector_t
id|blocknr
suffix:semicolon
r_int
id|offset
suffix:semicolon
id|fatent_brelse
c_func
(paren
id|fatent
)paren
suffix:semicolon
id|ops
op_member_access_from_pointer
id|ent_blocknr
c_func
(paren
id|sb
comma
id|fatent-&gt;entry
comma
op_amp
id|offset
comma
op_amp
id|blocknr
)paren
suffix:semicolon
r_return
id|ops
op_member_access_from_pointer
id|ent_bread
c_func
(paren
id|sb
comma
id|fatent
comma
id|offset
comma
id|blocknr
)paren
suffix:semicolon
)brace
DECL|function|fat_collect_bhs
r_static
r_void
id|fat_collect_bhs
c_func
(paren
r_struct
id|buffer_head
op_star
op_star
id|bhs
comma
r_int
op_star
id|nr_bhs
comma
r_struct
id|fat_entry
op_star
id|fatent
)paren
(brace
r_int
id|n
comma
id|i
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|fatent-&gt;nr_bhs
suffix:semicolon
id|n
op_increment
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
op_star
id|nr_bhs
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|fatent-&gt;bhs
(braket
id|n
)braket
op_eq
id|bhs
(braket
id|i
)braket
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
op_star
id|nr_bhs
)paren
(brace
id|get_bh
c_func
(paren
id|fatent-&gt;bhs
(braket
id|n
)braket
)paren
suffix:semicolon
id|bhs
(braket
id|i
)braket
op_assign
id|fatent-&gt;bhs
(braket
id|n
)braket
suffix:semicolon
(paren
op_star
id|nr_bhs
)paren
op_increment
suffix:semicolon
)brace
)brace
)brace
DECL|function|fat_alloc_clusters
r_int
id|fat_alloc_clusters
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
op_star
id|cluster
comma
r_int
id|nr_cluster
)paren
(brace
r_struct
id|super_block
op_star
id|sb
op_assign
id|inode-&gt;i_sb
suffix:semicolon
r_struct
id|msdos_sb_info
op_star
id|sbi
op_assign
id|MSDOS_SB
c_func
(paren
id|sb
)paren
suffix:semicolon
r_struct
id|fatent_operations
op_star
id|ops
op_assign
id|sbi-&gt;fatent_ops
suffix:semicolon
r_struct
id|fat_entry
id|fatent
comma
id|prev_ent
suffix:semicolon
r_struct
id|buffer_head
op_star
id|bhs
(braket
id|MAX_BUF_PER_PAGE
)braket
suffix:semicolon
r_int
id|i
comma
id|count
comma
id|err
comma
id|nr_bhs
comma
id|idx_clus
suffix:semicolon
id|BUG_ON
c_func
(paren
id|nr_cluster
OG
(paren
id|MAX_BUF_PER_PAGE
op_div
l_int|2
)paren
)paren
suffix:semicolon
multiline_comment|/* fixed limit */
id|lock_fat
c_func
(paren
id|sbi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sbi-&gt;free_clusters
op_ne
op_minus
l_int|1
op_logical_and
id|sbi-&gt;free_clusters
OL
id|nr_cluster
)paren
(brace
id|unlock_fat
c_func
(paren
id|sbi
)paren
suffix:semicolon
r_return
op_minus
id|ENOSPC
suffix:semicolon
)brace
id|err
op_assign
id|nr_bhs
op_assign
id|idx_clus
op_assign
l_int|0
suffix:semicolon
id|count
op_assign
id|FAT_START_ENT
suffix:semicolon
id|fatent_init
c_func
(paren
op_amp
id|prev_ent
)paren
suffix:semicolon
id|fatent_init
c_func
(paren
op_amp
id|fatent
)paren
suffix:semicolon
id|fatent_set_entry
c_func
(paren
op_amp
id|fatent
comma
id|sbi-&gt;prev_free
op_plus
l_int|1
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OL
id|sbi-&gt;max_cluster
)paren
(brace
r_if
c_cond
(paren
id|fatent.entry
op_ge
id|sbi-&gt;max_cluster
)paren
id|fatent.entry
op_assign
id|FAT_START_ENT
suffix:semicolon
id|fatent_set_entry
c_func
(paren
op_amp
id|fatent
comma
id|fatent.entry
)paren
suffix:semicolon
id|err
op_assign
id|fat_ent_read_block
c_func
(paren
id|sb
comma
op_amp
id|fatent
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* Find the free entries in a block */
r_do
(brace
r_if
c_cond
(paren
id|ops
op_member_access_from_pointer
id|ent_get
c_func
(paren
op_amp
id|fatent
)paren
op_eq
id|FAT_ENT_FREE
)paren
(brace
r_int
id|entry
op_assign
id|fatent.entry
suffix:semicolon
multiline_comment|/* make the cluster chain */
id|ops
op_member_access_from_pointer
id|ent_put
c_func
(paren
op_amp
id|fatent
comma
id|FAT_ENT_EOF
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prev_ent.nr_bhs
)paren
id|ops
op_member_access_from_pointer
id|ent_put
c_func
(paren
op_amp
id|prev_ent
comma
id|entry
)paren
suffix:semicolon
id|fat_collect_bhs
c_func
(paren
id|bhs
comma
op_amp
id|nr_bhs
comma
op_amp
id|fatent
)paren
suffix:semicolon
id|sbi-&gt;prev_free
op_assign
id|entry
suffix:semicolon
r_if
c_cond
(paren
id|sbi-&gt;free_clusters
op_ne
op_minus
l_int|1
)paren
id|sbi-&gt;free_clusters
op_decrement
suffix:semicolon
id|cluster
(braket
id|idx_clus
)braket
op_assign
id|entry
suffix:semicolon
id|idx_clus
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|idx_clus
op_eq
id|nr_cluster
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t; * fat_collect_bhs() gets ref-count of bhs,&n;&t;&t;&t;&t; * so we can still use the prev_ent.&n;&t;&t;&t;&t; */
id|prev_ent
op_assign
id|fatent
suffix:semicolon
)brace
id|count
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
id|sbi-&gt;max_cluster
)paren
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
id|fat_ent_next
c_func
(paren
id|sbi
comma
op_amp
id|fatent
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Couldn&squot;t allocate the free entries */
id|sbi-&gt;free_clusters
op_assign
l_int|0
suffix:semicolon
id|err
op_assign
op_minus
id|ENOSPC
suffix:semicolon
id|out
suffix:colon
id|unlock_fat
c_func
(paren
id|sbi
)paren
suffix:semicolon
id|fatent_brelse
c_func
(paren
op_amp
id|fatent
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
r_if
c_cond
(paren
id|inode_needs_sync
c_func
(paren
id|inode
)paren
)paren
id|err
op_assign
id|fat_sync_bhs
c_func
(paren
id|bhs
comma
id|nr_bhs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|err
op_assign
id|fat_mirror_bhs
c_func
(paren
id|sb
comma
id|bhs
comma
id|nr_bhs
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nr_bhs
suffix:semicolon
id|i
op_increment
)paren
id|brelse
c_func
(paren
id|bhs
(braket
id|i
)braket
)paren
suffix:semicolon
id|fat_clusters_flush
c_func
(paren
id|sb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_logical_and
id|idx_clus
)paren
id|fat_free_clusters
c_func
(paren
id|inode
comma
id|cluster
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|fat_free_clusters
r_int
id|fat_free_clusters
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_int
id|cluster
)paren
(brace
r_struct
id|super_block
op_star
id|sb
op_assign
id|inode-&gt;i_sb
suffix:semicolon
r_struct
id|msdos_sb_info
op_star
id|sbi
op_assign
id|MSDOS_SB
c_func
(paren
id|sb
)paren
suffix:semicolon
r_struct
id|fatent_operations
op_star
id|ops
op_assign
id|sbi-&gt;fatent_ops
suffix:semicolon
r_struct
id|fat_entry
id|fatent
suffix:semicolon
r_struct
id|buffer_head
op_star
id|bhs
(braket
id|MAX_BUF_PER_PAGE
)braket
suffix:semicolon
r_int
id|i
comma
id|err
comma
id|nr_bhs
suffix:semicolon
id|nr_bhs
op_assign
l_int|0
suffix:semicolon
id|fatent_init
c_func
(paren
op_amp
id|fatent
)paren
suffix:semicolon
id|lock_fat
c_func
(paren
id|sbi
)paren
suffix:semicolon
r_do
(brace
id|cluster
op_assign
id|fat_ent_read
c_func
(paren
id|inode
comma
op_amp
id|fatent
comma
id|cluster
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cluster
OL
l_int|0
)paren
(brace
id|err
op_assign
id|cluster
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cluster
op_eq
id|FAT_ENT_FREE
)paren
(brace
id|fat_fs_panic
c_func
(paren
id|sb
comma
l_string|&quot;%s: deleting FAT entry beyond EOF&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
id|ops
op_member_access_from_pointer
id|ent_put
c_func
(paren
op_amp
id|fatent
comma
id|FAT_ENT_FREE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sbi-&gt;free_clusters
op_ne
op_minus
l_int|1
)paren
id|sbi-&gt;free_clusters
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|nr_bhs
op_plus
id|fatent.nr_bhs
OG
id|MAX_BUF_PER_PAGE
)paren
(brace
r_if
c_cond
(paren
id|sb-&gt;s_flags
op_amp
id|MS_SYNCHRONOUS
)paren
(brace
id|err
op_assign
id|fat_sync_bhs
c_func
(paren
id|bhs
comma
id|nr_bhs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|error
suffix:semicolon
)brace
id|err
op_assign
id|fat_mirror_bhs
c_func
(paren
id|sb
comma
id|bhs
comma
id|nr_bhs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|error
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nr_bhs
suffix:semicolon
id|i
op_increment
)paren
id|brelse
c_func
(paren
id|bhs
(braket
id|i
)braket
)paren
suffix:semicolon
id|nr_bhs
op_assign
l_int|0
suffix:semicolon
)brace
id|fat_collect_bhs
c_func
(paren
id|bhs
comma
op_amp
id|nr_bhs
comma
op_amp
id|fatent
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|cluster
op_ne
id|FAT_ENT_EOF
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb-&gt;s_flags
op_amp
id|MS_SYNCHRONOUS
)paren
(brace
id|err
op_assign
id|fat_sync_bhs
c_func
(paren
id|bhs
comma
id|nr_bhs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|error
suffix:semicolon
)brace
id|err
op_assign
id|fat_mirror_bhs
c_func
(paren
id|sb
comma
id|bhs
comma
id|nr_bhs
)paren
suffix:semicolon
id|error
suffix:colon
id|fatent_brelse
c_func
(paren
op_amp
id|fatent
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nr_bhs
suffix:semicolon
id|i
op_increment
)paren
id|brelse
c_func
(paren
id|bhs
(braket
id|i
)braket
)paren
suffix:semicolon
id|unlock_fat
c_func
(paren
id|sbi
)paren
suffix:semicolon
id|fat_clusters_flush
c_func
(paren
id|sb
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|variable|fat_free_clusters
id|EXPORT_SYMBOL
c_func
(paren
id|fat_free_clusters
)paren
suffix:semicolon
DECL|function|fat_count_free_clusters
r_int
id|fat_count_free_clusters
c_func
(paren
r_struct
id|super_block
op_star
id|sb
)paren
(brace
r_struct
id|msdos_sb_info
op_star
id|sbi
op_assign
id|MSDOS_SB
c_func
(paren
id|sb
)paren
suffix:semicolon
r_struct
id|fatent_operations
op_star
id|ops
op_assign
id|sbi-&gt;fatent_ops
suffix:semicolon
r_struct
id|fat_entry
id|fatent
suffix:semicolon
r_int
id|err
op_assign
l_int|0
comma
id|free
suffix:semicolon
id|lock_fat
c_func
(paren
id|sbi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sbi-&gt;free_clusters
op_ne
op_minus
l_int|1
)paren
r_goto
id|out
suffix:semicolon
id|free
op_assign
l_int|0
suffix:semicolon
id|fatent_init
c_func
(paren
op_amp
id|fatent
)paren
suffix:semicolon
id|fatent_set_entry
c_func
(paren
op_amp
id|fatent
comma
id|FAT_START_ENT
)paren
suffix:semicolon
r_while
c_loop
(paren
id|fatent.entry
OL
id|sbi-&gt;max_cluster
)paren
(brace
id|err
op_assign
id|fat_ent_read_block
c_func
(paren
id|sb
comma
op_amp
id|fatent
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|ops
op_member_access_from_pointer
id|ent_get
c_func
(paren
op_amp
id|fatent
)paren
op_eq
id|FAT_ENT_FREE
)paren
id|free
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|fat_ent_next
c_func
(paren
id|sbi
comma
op_amp
id|fatent
)paren
)paren
suffix:semicolon
)brace
id|sbi-&gt;free_clusters
op_assign
id|free
suffix:semicolon
id|fatent_brelse
c_func
(paren
op_amp
id|fatent
)paren
suffix:semicolon
id|out
suffix:colon
id|unlock_fat
c_func
(paren
id|sbi
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
eof
