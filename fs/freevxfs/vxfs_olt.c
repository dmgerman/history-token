multiline_comment|/*&n; * Copyright (c) 2000-2001 Christoph Hellwig.&n; * All rights reserved.&n; *&n; * Redistribution and use in source and binary forms, with or without&n; * modification, are permitted provided that the following conditions&n; * are met:&n; * 1. Redistributions of source code must retain the above copyright&n; *    notice, this list of conditions, and the following disclaimer,&n; *    without modification.&n; * 2. The name of the author may not be used to endorse or promote products&n; *    derived from this software without specific prior written permission.&n; *&n; * Alternatively, this software may be distributed under the terms of the&n; * GNU General Public License (&quot;GPL&quot;).&n; *&n; * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS&squot;&squot; AND&n; * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE&n; * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE&n; * ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE FOR&n; * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL&n; * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS&n; * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)&n; * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT&n; * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY&n; * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF&n; * SUCH DAMAGE.&n; */
macro_line|#ident &quot;$Id: vxfs_olt.c,v 1.10 2002/01/02 23:03:58 hch Exp hch $&quot;
multiline_comment|/* &n; * Veritas filesystem driver - object location table support.&n; */
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/buffer_head.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &quot;vxfs.h&quot;
macro_line|#include &quot;vxfs_olt.h&quot;
r_static
id|__inline__
r_void
DECL|function|vxfs_get_fshead
id|vxfs_get_fshead
c_func
(paren
r_struct
id|vxfs_oltfshead
op_star
id|fshp
comma
r_struct
id|vxfs_sb_info
op_star
id|infp
)paren
(brace
r_if
c_cond
(paren
id|infp-&gt;vsi_fshino
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|infp-&gt;vsi_fshino
op_assign
id|fshp-&gt;olt_fsino
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_static
id|__inline__
r_void
DECL|function|vxfs_get_ilist
id|vxfs_get_ilist
c_func
(paren
r_struct
id|vxfs_oltilist
op_star
id|ilistp
comma
r_struct
id|vxfs_sb_info
op_star
id|infp
)paren
(brace
r_if
c_cond
(paren
id|infp-&gt;vsi_iext
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|infp-&gt;vsi_iext
op_assign
id|ilistp-&gt;olt_iext
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_static
id|__inline__
id|u_long
DECL|function|vxfs_oblock
id|vxfs_oblock
c_func
(paren
r_struct
id|super_block
op_star
id|sbp
comma
id|daddr_t
id|block
comma
id|u_long
id|bsize
)paren
(brace
r_if
c_cond
(paren
id|sbp-&gt;s_blocksize
op_mod
id|bsize
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_return
(paren
id|block
op_star
(paren
id|sbp-&gt;s_blocksize
op_div
id|bsize
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * vxfs_read_olt - read olt&n; * @sbp:&t;superblock of the filesystem&n; * @bsize:&t;blocksize of the filesystem&n; *&n; * Description:&n; *   vxfs_read_olt reads the olt of the filesystem described by @sbp&n; *   into main memory and does some basic setup.&n; *&n; * Returns:&n; *   Zero on success, else a negative error code.&n; */
r_int
DECL|function|vxfs_read_olt
id|vxfs_read_olt
c_func
(paren
r_struct
id|super_block
op_star
id|sbp
comma
id|u_long
id|bsize
)paren
(brace
r_struct
id|vxfs_sb_info
op_star
id|infp
op_assign
id|VXFS_SBI
c_func
(paren
id|sbp
)paren
suffix:semicolon
r_struct
id|buffer_head
op_star
id|bp
suffix:semicolon
r_struct
id|vxfs_olt
op_star
id|op
suffix:semicolon
r_char
op_star
id|oaddr
comma
op_star
id|eaddr
suffix:semicolon
id|bp
op_assign
id|sb_bread
c_func
(paren
id|sbp
comma
id|vxfs_oblock
c_func
(paren
id|sbp
comma
id|infp-&gt;vsi_oltext
comma
id|bsize
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bp
op_logical_or
op_logical_neg
id|bp-&gt;b_data
)paren
r_goto
id|fail
suffix:semicolon
id|op
op_assign
(paren
r_struct
id|vxfs_olt
op_star
)paren
id|bp-&gt;b_data
suffix:semicolon
r_if
c_cond
(paren
id|op-&gt;olt_magic
op_ne
id|VXFS_OLT_MAGIC
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;vxfs: ivalid olt magic number&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * It is in theory possible that vsi_oltsize is &gt; 1.&n;&t; * I&squot;ve not seen any such filesystem yet and I&squot;m lazy..  --hch&n;&t; */
r_if
c_cond
(paren
id|infp-&gt;vsi_oltsize
OG
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;vxfs: oltsize &gt; 1 detected.&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;vxfs: please notify hch@caldera.de&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
id|oaddr
op_assign
(paren
r_char
op_star
)paren
id|bp-&gt;b_data
op_plus
id|op-&gt;olt_size
suffix:semicolon
id|eaddr
op_assign
(paren
r_char
op_star
)paren
id|bp-&gt;b_data
op_plus
(paren
id|infp-&gt;vsi_oltsize
op_star
id|sbp-&gt;s_blocksize
)paren
suffix:semicolon
r_while
c_loop
(paren
id|oaddr
OL
id|eaddr
)paren
(brace
r_struct
id|vxfs_oltcommon
op_star
id|ocp
op_assign
(paren
r_struct
id|vxfs_oltcommon
op_star
)paren
id|oaddr
suffix:semicolon
r_switch
c_cond
(paren
id|ocp-&gt;olt_type
)paren
(brace
r_case
id|VXFS_OLT_FSHEAD
suffix:colon
id|vxfs_get_fshead
c_func
(paren
(paren
r_struct
id|vxfs_oltfshead
op_star
)paren
id|oaddr
comma
id|infp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VXFS_OLT_ILIST
suffix:colon
id|vxfs_get_ilist
c_func
(paren
(paren
r_struct
id|vxfs_oltilist
op_star
)paren
id|oaddr
comma
id|infp
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|oaddr
op_add_assign
id|ocp-&gt;olt_size
suffix:semicolon
)brace
id|brelse
c_func
(paren
id|bp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|fail
suffix:colon
id|brelse
c_func
(paren
id|bp
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
eof
