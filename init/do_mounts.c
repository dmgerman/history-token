DECL|macro|__KERNEL_SYSCALLS__
mdefine_line|#define __KERNEL_SYSCALLS__
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/devfs_fs_kernel.h&gt;
macro_line|#include &lt;linux/unistd.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/blk.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/nfs_fs.h&gt;
macro_line|#include &lt;linux/nfs_fs_sb.h&gt;
macro_line|#include &lt;linux/nfs_mount.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
multiline_comment|/* syscalls missing from unistd.h */
r_static
r_inline
id|_syscall2
c_func
(paren
r_int
comma
id|mkdir
comma
r_char
op_star
comma
id|name
comma
r_int
comma
id|mode
)paren
suffix:semicolon
r_static
r_inline
id|_syscall1
c_func
(paren
r_int
comma
id|chdir
comma
r_char
op_star
comma
id|name
)paren
suffix:semicolon
r_static
r_inline
id|_syscall1
c_func
(paren
r_int
comma
id|chroot
comma
r_char
op_star
comma
id|name
)paren
suffix:semicolon
r_static
r_inline
id|_syscall1
c_func
(paren
r_int
comma
id|unlink
comma
r_char
op_star
comma
id|name
)paren
suffix:semicolon
r_static
r_inline
id|_syscall3
c_func
(paren
r_int
comma
id|mknod
comma
r_char
op_star
comma
id|name
comma
r_int
comma
id|mode
comma
id|dev_t
comma
id|dev
)paren
suffix:semicolon
r_static
r_inline
id|_syscall5
c_func
(paren
r_int
comma
id|mount
comma
r_char
op_star
comma
id|dev
comma
r_char
op_star
comma
id|dir
comma
r_char
op_star
comma
id|type
comma
r_int
r_int
comma
id|flags
comma
r_void
op_star
comma
id|data
)paren
suffix:semicolon
r_static
r_inline
id|_syscall2
c_func
(paren
r_int
comma
id|umount
comma
r_char
op_star
comma
id|name
comma
r_int
comma
id|flags
)paren
suffix:semicolon
r_extern
r_void
id|rd_load
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|initrd_load
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_INITRD
DECL|variable|real_root_dev
r_int
r_int
id|real_root_dev
suffix:semicolon
multiline_comment|/* do_proc_dointvec cannot handle kdev_t */
macro_line|#endif
DECL|variable|root_mountflags
r_int
id|root_mountflags
op_assign
id|MS_RDONLY
suffix:semicolon
DECL|variable|root_device_name
r_char
id|root_device_name
(braket
l_int|64
)braket
suffix:semicolon
multiline_comment|/* this is initialized in init/main.c */
DECL|variable|ROOT_DEV
id|kdev_t
id|ROOT_DEV
suffix:semicolon
DECL|function|readonly
r_static
r_int
id|__init
id|readonly
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_if
c_cond
(paren
op_star
id|str
)paren
r_return
l_int|0
suffix:semicolon
id|root_mountflags
op_or_assign
id|MS_RDONLY
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|readwrite
r_static
r_int
id|__init
id|readwrite
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_if
c_cond
(paren
op_star
id|str
)paren
r_return
l_int|0
suffix:semicolon
id|root_mountflags
op_and_assign
op_complement
id|MS_RDONLY
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;ro&quot;
comma
id|readonly
)paren
suffix:semicolon
id|__setup
c_func
(paren
l_string|&quot;rw&quot;
comma
id|readwrite
)paren
suffix:semicolon
DECL|struct|dev_name_struct
r_static
r_struct
id|dev_name_struct
(brace
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|num
r_const
r_int
id|num
suffix:semicolon
DECL|variable|__initdata
)brace
id|root_dev_names
(braket
)braket
id|__initdata
op_assign
(brace
(brace
l_string|&quot;nfs&quot;
comma
l_int|0x00ff
)brace
comma
(brace
l_string|&quot;hda&quot;
comma
l_int|0x0300
)brace
comma
(brace
l_string|&quot;hdb&quot;
comma
l_int|0x0340
)brace
comma
(brace
l_string|&quot;loop&quot;
comma
l_int|0x0700
)brace
comma
(brace
l_string|&quot;hdc&quot;
comma
l_int|0x1600
)brace
comma
(brace
l_string|&quot;hdd&quot;
comma
l_int|0x1640
)brace
comma
(brace
l_string|&quot;hde&quot;
comma
l_int|0x2100
)brace
comma
(brace
l_string|&quot;hdf&quot;
comma
l_int|0x2140
)brace
comma
(brace
l_string|&quot;hdg&quot;
comma
l_int|0x2200
)brace
comma
(brace
l_string|&quot;hdh&quot;
comma
l_int|0x2240
)brace
comma
(brace
l_string|&quot;hdi&quot;
comma
l_int|0x3800
)brace
comma
(brace
l_string|&quot;hdj&quot;
comma
l_int|0x3840
)brace
comma
(brace
l_string|&quot;hdk&quot;
comma
l_int|0x3900
)brace
comma
(brace
l_string|&quot;hdl&quot;
comma
l_int|0x3940
)brace
comma
(brace
l_string|&quot;hdm&quot;
comma
l_int|0x5800
)brace
comma
(brace
l_string|&quot;hdn&quot;
comma
l_int|0x5840
)brace
comma
(brace
l_string|&quot;hdo&quot;
comma
l_int|0x5900
)brace
comma
(brace
l_string|&quot;hdp&quot;
comma
l_int|0x5940
)brace
comma
(brace
l_string|&quot;hdq&quot;
comma
l_int|0x5A00
)brace
comma
(brace
l_string|&quot;hdr&quot;
comma
l_int|0x5A40
)brace
comma
(brace
l_string|&quot;hds&quot;
comma
l_int|0x5B00
)brace
comma
(brace
l_string|&quot;hdt&quot;
comma
l_int|0x5B40
)brace
comma
(brace
l_string|&quot;sda&quot;
comma
l_int|0x0800
)brace
comma
(brace
l_string|&quot;sdb&quot;
comma
l_int|0x0810
)brace
comma
(brace
l_string|&quot;sdc&quot;
comma
l_int|0x0820
)brace
comma
(brace
l_string|&quot;sdd&quot;
comma
l_int|0x0830
)brace
comma
(brace
l_string|&quot;sde&quot;
comma
l_int|0x0840
)brace
comma
(brace
l_string|&quot;sdf&quot;
comma
l_int|0x0850
)brace
comma
(brace
l_string|&quot;sdg&quot;
comma
l_int|0x0860
)brace
comma
(brace
l_string|&quot;sdh&quot;
comma
l_int|0x0870
)brace
comma
(brace
l_string|&quot;sdi&quot;
comma
l_int|0x0880
)brace
comma
(brace
l_string|&quot;sdj&quot;
comma
l_int|0x0890
)brace
comma
(brace
l_string|&quot;sdk&quot;
comma
l_int|0x08a0
)brace
comma
(brace
l_string|&quot;sdl&quot;
comma
l_int|0x08b0
)brace
comma
(brace
l_string|&quot;sdm&quot;
comma
l_int|0x08c0
)brace
comma
(brace
l_string|&quot;sdn&quot;
comma
l_int|0x08d0
)brace
comma
(brace
l_string|&quot;sdo&quot;
comma
l_int|0x08e0
)brace
comma
(brace
l_string|&quot;sdp&quot;
comma
l_int|0x08f0
)brace
comma
(brace
l_string|&quot;ada&quot;
comma
l_int|0x1c00
)brace
comma
(brace
l_string|&quot;adb&quot;
comma
l_int|0x1c10
)brace
comma
(brace
l_string|&quot;adc&quot;
comma
l_int|0x1c20
)brace
comma
(brace
l_string|&quot;add&quot;
comma
l_int|0x1c30
)brace
comma
(brace
l_string|&quot;ade&quot;
comma
l_int|0x1c40
)brace
comma
(brace
l_string|&quot;fd&quot;
comma
l_int|0x0200
)brace
comma
(brace
l_string|&quot;md&quot;
comma
l_int|0x0900
)brace
comma
(brace
l_string|&quot;xda&quot;
comma
l_int|0x0d00
)brace
comma
(brace
l_string|&quot;xdb&quot;
comma
l_int|0x0d40
)brace
comma
(brace
l_string|&quot;ram&quot;
comma
l_int|0x0100
)brace
comma
(brace
l_string|&quot;scd&quot;
comma
l_int|0x0b00
)brace
comma
(brace
l_string|&quot;mcd&quot;
comma
l_int|0x1700
)brace
comma
(brace
l_string|&quot;cdu535&quot;
comma
l_int|0x1800
)brace
comma
(brace
l_string|&quot;sonycd&quot;
comma
l_int|0x1800
)brace
comma
(brace
l_string|&quot;aztcd&quot;
comma
l_int|0x1d00
)brace
comma
(brace
l_string|&quot;cm206cd&quot;
comma
l_int|0x2000
)brace
comma
(brace
l_string|&quot;gscd&quot;
comma
l_int|0x1000
)brace
comma
(brace
l_string|&quot;sbpcd&quot;
comma
l_int|0x1900
)brace
comma
(brace
l_string|&quot;eda&quot;
comma
l_int|0x2400
)brace
comma
(brace
l_string|&quot;edb&quot;
comma
l_int|0x2440
)brace
comma
(brace
l_string|&quot;pda&quot;
comma
l_int|0x2d00
)brace
comma
(brace
l_string|&quot;pdb&quot;
comma
l_int|0x2d10
)brace
comma
(brace
l_string|&quot;pdc&quot;
comma
l_int|0x2d20
)brace
comma
(brace
l_string|&quot;pdd&quot;
comma
l_int|0x2d30
)brace
comma
(brace
l_string|&quot;pcd&quot;
comma
l_int|0x2e00
)brace
comma
(brace
l_string|&quot;pf&quot;
comma
l_int|0x2f00
)brace
comma
(brace
l_string|&quot;apblock&quot;
comma
id|APBLOCK_MAJOR
op_lshift
l_int|8
)brace
comma
(brace
l_string|&quot;ddv&quot;
comma
id|DDV_MAJOR
op_lshift
l_int|8
)brace
comma
(brace
l_string|&quot;jsfd&quot;
comma
id|JSFD_MAJOR
op_lshift
l_int|8
)brace
comma
macro_line|#if defined(CONFIG_ARCH_S390)
(brace
l_string|&quot;dasda&quot;
comma
(paren
id|DASD_MAJOR
op_lshift
id|MINORBITS
)paren
)brace
comma
(brace
l_string|&quot;dasdb&quot;
comma
(paren
id|DASD_MAJOR
op_lshift
id|MINORBITS
)paren
op_plus
(paren
l_int|1
op_lshift
l_int|2
)paren
)brace
comma
(brace
l_string|&quot;dasdc&quot;
comma
(paren
id|DASD_MAJOR
op_lshift
id|MINORBITS
)paren
op_plus
(paren
l_int|2
op_lshift
l_int|2
)paren
)brace
comma
(brace
l_string|&quot;dasdd&quot;
comma
(paren
id|DASD_MAJOR
op_lshift
id|MINORBITS
)paren
op_plus
(paren
l_int|3
op_lshift
l_int|2
)paren
)brace
comma
(brace
l_string|&quot;dasde&quot;
comma
(paren
id|DASD_MAJOR
op_lshift
id|MINORBITS
)paren
op_plus
(paren
l_int|4
op_lshift
l_int|2
)paren
)brace
comma
(brace
l_string|&quot;dasdf&quot;
comma
(paren
id|DASD_MAJOR
op_lshift
id|MINORBITS
)paren
op_plus
(paren
l_int|5
op_lshift
l_int|2
)paren
)brace
comma
(brace
l_string|&quot;dasdg&quot;
comma
(paren
id|DASD_MAJOR
op_lshift
id|MINORBITS
)paren
op_plus
(paren
l_int|6
op_lshift
l_int|2
)paren
)brace
comma
(brace
l_string|&quot;dasdh&quot;
comma
(paren
id|DASD_MAJOR
op_lshift
id|MINORBITS
)paren
op_plus
(paren
l_int|7
op_lshift
l_int|2
)paren
)brace
comma
macro_line|#endif
macro_line|#if defined(CONFIG_BLK_CPQ_DA) || defined(CONFIG_BLK_CPQ_DA_MODULE)
(brace
l_string|&quot;ida/c0d0p&quot;
comma
l_int|0x4800
)brace
comma
(brace
l_string|&quot;ida/c0d1p&quot;
comma
l_int|0x4810
)brace
comma
(brace
l_string|&quot;ida/c0d2p&quot;
comma
l_int|0x4820
)brace
comma
(brace
l_string|&quot;ida/c0d3p&quot;
comma
l_int|0x4830
)brace
comma
(brace
l_string|&quot;ida/c0d4p&quot;
comma
l_int|0x4840
)brace
comma
(brace
l_string|&quot;ida/c0d5p&quot;
comma
l_int|0x4850
)brace
comma
(brace
l_string|&quot;ida/c0d6p&quot;
comma
l_int|0x4860
)brace
comma
(brace
l_string|&quot;ida/c0d7p&quot;
comma
l_int|0x4870
)brace
comma
(brace
l_string|&quot;ida/c0d8p&quot;
comma
l_int|0x4880
)brace
comma
(brace
l_string|&quot;ida/c0d9p&quot;
comma
l_int|0x4890
)brace
comma
(brace
l_string|&quot;ida/c0d10p&quot;
comma
l_int|0x48A0
)brace
comma
(brace
l_string|&quot;ida/c0d11p&quot;
comma
l_int|0x48B0
)brace
comma
(brace
l_string|&quot;ida/c0d12p&quot;
comma
l_int|0x48C0
)brace
comma
(brace
l_string|&quot;ida/c0d13p&quot;
comma
l_int|0x48D0
)brace
comma
(brace
l_string|&quot;ida/c0d14p&quot;
comma
l_int|0x48E0
)brace
comma
(brace
l_string|&quot;ida/c0d15p&quot;
comma
l_int|0x48F0
)brace
comma
macro_line|#endif
macro_line|#if defined(CONFIG_BLK_CPQ_CISS_DA) || defined(CONFIG_BLK_CPQ_CISS_DA_MODULE)
(brace
l_string|&quot;cciss/c0d0p&quot;
comma
l_int|0x6800
)brace
comma
(brace
l_string|&quot;cciss/c0d1p&quot;
comma
l_int|0x6810
)brace
comma
(brace
l_string|&quot;cciss/c0d2p&quot;
comma
l_int|0x6820
)brace
comma
(brace
l_string|&quot;cciss/c0d3p&quot;
comma
l_int|0x6830
)brace
comma
(brace
l_string|&quot;cciss/c0d4p&quot;
comma
l_int|0x6840
)brace
comma
(brace
l_string|&quot;cciss/c0d5p&quot;
comma
l_int|0x6850
)brace
comma
(brace
l_string|&quot;cciss/c0d6p&quot;
comma
l_int|0x6860
)brace
comma
(brace
l_string|&quot;cciss/c0d7p&quot;
comma
l_int|0x6870
)brace
comma
(brace
l_string|&quot;cciss/c0d8p&quot;
comma
l_int|0x6880
)brace
comma
(brace
l_string|&quot;cciss/c0d9p&quot;
comma
l_int|0x6890
)brace
comma
(brace
l_string|&quot;cciss/c0d10p&quot;
comma
l_int|0x68A0
)brace
comma
(brace
l_string|&quot;cciss/c0d11p&quot;
comma
l_int|0x68B0
)brace
comma
(brace
l_string|&quot;cciss/c0d12p&quot;
comma
l_int|0x68C0
)brace
comma
(brace
l_string|&quot;cciss/c0d13p&quot;
comma
l_int|0x68D0
)brace
comma
(brace
l_string|&quot;cciss/c0d14p&quot;
comma
l_int|0x68E0
)brace
comma
(brace
l_string|&quot;cciss/c0d15p&quot;
comma
l_int|0x68F0
)brace
comma
macro_line|#endif
(brace
l_string|&quot;nftla&quot;
comma
l_int|0x5d00
)brace
comma
(brace
l_string|&quot;nftlb&quot;
comma
l_int|0x5d10
)brace
comma
(brace
l_string|&quot;nftlc&quot;
comma
l_int|0x5d20
)brace
comma
(brace
l_string|&quot;nftld&quot;
comma
l_int|0x5d30
)brace
comma
(brace
l_string|&quot;ftla&quot;
comma
l_int|0x2c00
)brace
comma
(brace
l_string|&quot;ftlb&quot;
comma
l_int|0x2c08
)brace
comma
(brace
l_string|&quot;ftlc&quot;
comma
l_int|0x2c10
)brace
comma
(brace
l_string|&quot;ftld&quot;
comma
l_int|0x2c18
)brace
comma
(brace
l_string|&quot;mtdblock&quot;
comma
l_int|0x1f00
)brace
comma
(brace
l_int|NULL
comma
l_int|0
)brace
)brace
suffix:semicolon
DECL|function|name_to_kdev_t
id|kdev_t
id|__init
id|name_to_kdev_t
c_func
(paren
r_char
op_star
id|line
)paren
(brace
r_int
id|base
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;/dev/&quot;
comma
l_int|5
)paren
op_eq
l_int|0
)paren
(brace
r_struct
id|dev_name_struct
op_star
id|dev
op_assign
id|root_dev_names
suffix:semicolon
id|line
op_add_assign
l_int|5
suffix:semicolon
r_do
(brace
r_int
id|len
op_assign
id|strlen
c_func
(paren
id|dev-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|line
comma
id|dev-&gt;name
comma
id|len
)paren
op_eq
l_int|0
)paren
(brace
id|line
op_add_assign
id|len
suffix:semicolon
id|base
op_assign
id|dev-&gt;num
suffix:semicolon
r_break
suffix:semicolon
)brace
id|dev
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|dev-&gt;name
)paren
suffix:semicolon
)brace
r_return
id|to_kdev_t
c_func
(paren
id|base
op_plus
id|simple_strtoul
c_func
(paren
id|line
comma
l_int|NULL
comma
id|base
ques
c_cond
l_int|10
suffix:colon
l_int|16
)paren
)paren
suffix:semicolon
)brace
DECL|function|root_dev_setup
r_static
r_int
id|__init
id|root_dev_setup
c_func
(paren
r_char
op_star
id|line
)paren
(brace
r_int
id|i
suffix:semicolon
r_char
id|ch
suffix:semicolon
id|ROOT_DEV
op_assign
id|name_to_kdev_t
c_func
(paren
id|line
)paren
suffix:semicolon
id|memset
(paren
id|root_device_name
comma
l_int|0
comma
r_sizeof
id|root_device_name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
(paren
id|line
comma
l_string|&quot;/dev/&quot;
comma
l_int|5
)paren
op_eq
l_int|0
)paren
id|line
op_add_assign
l_int|5
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
id|root_device_name
op_minus
l_int|1
suffix:semicolon
op_increment
id|i
)paren
(brace
id|ch
op_assign
id|line
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|isspace
(paren
id|ch
)paren
op_logical_or
(paren
id|ch
op_eq
l_char|&squot;,&squot;
)paren
op_logical_or
(paren
id|ch
op_eq
l_char|&squot;&bslash;0&squot;
)paren
)paren
r_break
suffix:semicolon
id|root_device_name
(braket
id|i
)braket
op_assign
id|ch
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;root=&quot;
comma
id|root_dev_setup
)paren
suffix:semicolon
DECL|variable|root_mount_data
r_static
r_char
op_star
id|__initdata
id|root_mount_data
suffix:semicolon
DECL|function|root_data_setup
r_static
r_int
id|__init
id|root_data_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
id|root_mount_data
op_assign
id|str
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|variable|root_fs_names
r_static
r_char
op_star
id|__initdata
id|root_fs_names
suffix:semicolon
DECL|function|fs_names_setup
r_static
r_int
id|__init
id|fs_names_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
id|root_fs_names
op_assign
id|str
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;rootflags=&quot;
comma
id|root_data_setup
)paren
suffix:semicolon
id|__setup
c_func
(paren
l_string|&quot;rootfstype=&quot;
comma
id|fs_names_setup
)paren
suffix:semicolon
DECL|function|get_fs_names
r_static
r_void
id|__init
id|get_fs_names
c_func
(paren
r_char
op_star
id|page
)paren
(brace
r_char
op_star
id|s
op_assign
id|page
suffix:semicolon
r_if
c_cond
(paren
id|root_fs_names
)paren
(brace
id|strcpy
c_func
(paren
id|page
comma
id|root_fs_names
)paren
suffix:semicolon
r_while
c_loop
(paren
op_star
id|s
op_increment
)paren
(brace
r_if
c_cond
(paren
id|s
(braket
op_minus
l_int|1
)braket
op_eq
l_char|&squot;,&squot;
)paren
id|s
(braket
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
)brace
r_else
(brace
r_int
id|len
op_assign
id|get_filesystem_list
c_func
(paren
id|page
)paren
suffix:semicolon
r_char
op_star
id|p
comma
op_star
id|next
suffix:semicolon
id|page
(braket
id|len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|page
op_minus
l_int|1
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
id|next
)paren
(brace
id|next
op_assign
id|strchr
c_func
(paren
op_increment
id|p
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|p
op_increment
op_ne
l_char|&squot;&bslash;t&squot;
)paren
r_continue
suffix:semicolon
r_while
c_loop
(paren
(paren
op_star
id|s
op_increment
op_assign
op_star
id|p
op_increment
)paren
op_ne
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
id|s
(braket
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
)brace
op_star
id|s
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
DECL|function|mount_root
r_static
r_void
id|__init
id|mount_root
c_func
(paren
r_void
)paren
(brace
r_void
op_star
id|handle
suffix:semicolon
r_char
id|path
(braket
l_int|64
)braket
suffix:semicolon
r_char
op_star
id|name
op_assign
l_string|&quot;/dev/root&quot;
suffix:semicolon
r_char
op_star
id|fs_names
comma
op_star
id|p
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|do_devfs
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_ROOT_NFS
r_void
op_star
id|data
suffix:semicolon
macro_line|#endif
id|root_mountflags
op_or_assign
id|MS_VERBOSE
suffix:semicolon
id|fs_names
op_assign
id|__getname
c_func
(paren
)paren
suffix:semicolon
id|get_fs_names
c_func
(paren
id|fs_names
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ROOT_NFS
r_if
c_cond
(paren
id|MAJOR
c_func
(paren
id|ROOT_DEV
)paren
op_ne
id|UNNAMED_MAJOR
)paren
r_goto
id|skip_nfs
suffix:semicolon
id|data
op_assign
id|nfs_root_data
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data
)paren
r_goto
id|no_nfs
suffix:semicolon
id|err
op_assign
id|mount
c_func
(paren
l_string|&quot;/dev/root&quot;
comma
l_string|&quot;/root&quot;
comma
l_string|&quot;nfs&quot;
comma
id|root_mountflags
comma
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
r_goto
id|done
suffix:semicolon
id|no_nfs
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;VFS: Unable to mount root fs via NFS, trying floppy.&bslash;n&quot;
)paren
suffix:semicolon
id|ROOT_DEV
op_assign
id|MKDEV
c_func
(paren
id|FLOPPY_MAJOR
comma
l_int|0
)paren
suffix:semicolon
id|skip_nfs
suffix:colon
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_FD
r_if
c_cond
(paren
id|MAJOR
c_func
(paren
id|ROOT_DEV
)paren
op_eq
id|FLOPPY_MAJOR
)paren
(brace
macro_line|#ifdef CONFIG_BLK_DEV_RAM
r_extern
r_int
id|rd_doload
suffix:semicolon
r_extern
r_void
id|rd_load_secondary
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
id|floppy_eject
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifndef CONFIG_BLK_DEV_RAM
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;(Warning, this kernel has no ramdisk support)&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#else
multiline_comment|/* rd_doload is 2 for a dual initrd/ramload setup */
r_if
c_cond
(paren
id|rd_doload
op_eq
l_int|2
)paren
(brace
id|rd_load_secondary
c_func
(paren
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;VFS: Insert root floppy and press ENTER&bslash;n&quot;
)paren
suffix:semicolon
id|wait_for_keypress
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
id|devfs_make_root
(paren
id|root_device_name
)paren
suffix:semicolon
id|handle
op_assign
id|devfs_find_handle
(paren
l_int|NULL
comma
id|ROOT_DEVICE_NAME
comma
id|MAJOR
(paren
id|ROOT_DEV
)paren
comma
id|MINOR
(paren
id|ROOT_DEV
)paren
comma
id|DEVFS_SPECIAL_BLK
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|handle
)paren
(brace
r_int
id|n
suffix:semicolon
r_int
id|major
comma
id|minor
suffix:semicolon
id|devfs_get_maj_min
(paren
id|handle
comma
op_amp
id|major
comma
op_amp
id|minor
)paren
suffix:semicolon
id|ROOT_DEV
op_assign
id|MKDEV
(paren
id|major
comma
id|minor
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ROOT_DEV
)paren
id|panic
c_func
(paren
l_string|&quot;I have no root and I want to scream&quot;
)paren
suffix:semicolon
id|n
op_assign
id|devfs_generate_path
(paren
id|handle
comma
id|path
op_plus
l_int|5
comma
r_sizeof
(paren
id|path
)paren
op_minus
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|n
op_ge
l_int|0
)paren
(brace
id|name
op_assign
id|path
op_plus
id|n
suffix:semicolon
id|devfs_mk_symlink
(paren
l_int|NULL
comma
l_string|&quot;root&quot;
comma
id|DEVFS_FL_DEFAULT
comma
id|name
op_plus
l_int|5
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|memcpy
(paren
id|name
comma
l_string|&quot;/dev/&quot;
comma
l_int|5
)paren
suffix:semicolon
id|do_devfs
op_assign
l_int|1
suffix:semicolon
)brace
)brace
id|chdir
c_func
(paren
l_string|&quot;/dev&quot;
)paren
suffix:semicolon
id|unlink
c_func
(paren
l_string|&quot;root&quot;
)paren
suffix:semicolon
id|mknod
c_func
(paren
l_string|&quot;root&quot;
comma
id|S_IFBLK
op_or
l_int|0600
comma
id|kdev_t_to_nr
c_func
(paren
id|ROOT_DEV
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|do_devfs
)paren
id|mount
c_func
(paren
l_string|&quot;devfs&quot;
comma
l_string|&quot;.&quot;
comma
l_string|&quot;devfs&quot;
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
id|retry
suffix:colon
r_for
c_loop
(paren
id|p
op_assign
id|fs_names
suffix:semicolon
op_star
id|p
suffix:semicolon
id|p
op_add_assign
id|strlen
c_func
(paren
id|p
)paren
op_plus
l_int|1
)paren
(brace
r_int
id|err
suffix:semicolon
id|err
op_assign
id|sys_mount
c_func
(paren
id|name
comma
l_string|&quot;/root&quot;
comma
id|p
comma
id|root_mountflags
comma
id|root_mount_data
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|err
)paren
(brace
r_case
l_int|0
suffix:colon
r_goto
id|done
suffix:semicolon
r_case
op_minus
id|EACCES
suffix:colon
id|root_mountflags
op_or_assign
id|MS_RDONLY
suffix:semicolon
r_goto
id|retry
suffix:semicolon
r_case
op_minus
id|EINVAL
suffix:colon
r_continue
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Allow the user to distinguish between failed open&n;&t;&t; * and bad superblock on root device.&n;&t;&t; */
id|printk
(paren
l_string|&quot;VFS: Cannot open root device &bslash;&quot;%s&bslash;&quot; or %s&bslash;n&quot;
comma
id|root_device_name
comma
id|kdevname
(paren
id|ROOT_DEV
)paren
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;Please append a correct &bslash;&quot;root=&bslash;&quot; boot option&bslash;n&quot;
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;VFS: Unable to mount root fs on %s&quot;
comma
id|kdevname
c_func
(paren
id|ROOT_DEV
)paren
)paren
suffix:semicolon
)brace
id|panic
c_func
(paren
l_string|&quot;VFS: Unable to mount root fs on %s&quot;
comma
id|kdevname
c_func
(paren
id|ROOT_DEV
)paren
)paren
suffix:semicolon
id|done
suffix:colon
id|putname
c_func
(paren
id|fs_names
)paren
suffix:semicolon
r_if
c_cond
(paren
id|do_devfs
)paren
id|umount
c_func
(paren
l_string|&quot;.&quot;
comma
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_BLK_DEV_INITRD
DECL|function|change_root
r_static
r_int
id|__init
id|change_root
c_func
(paren
id|kdev_t
id|new_root_dev
comma
r_const
r_char
op_star
id|put_old
)paren
(brace
r_struct
id|vfsmount
op_star
id|old_rootmnt
suffix:semicolon
r_struct
id|nameidata
id|devfs_nd
suffix:semicolon
r_char
op_star
id|new_devname
op_assign
id|kmalloc
c_func
(paren
id|strlen
c_func
(paren
l_string|&quot;/dev/root.old&quot;
)paren
op_plus
l_int|1
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_int
id|error
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|new_devname
)paren
id|strcpy
c_func
(paren
id|new_devname
comma
l_string|&quot;/dev/root.old&quot;
)paren
suffix:semicolon
multiline_comment|/* .. here is directory mounted over root */
id|mount
c_func
(paren
l_string|&quot;..&quot;
comma
l_string|&quot;.&quot;
comma
l_int|NULL
comma
id|MS_MOVE
comma
l_int|NULL
)paren
suffix:semicolon
id|chdir
c_func
(paren
l_string|&quot;/old&quot;
)paren
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|current-&gt;fs-&gt;lock
)paren
suffix:semicolon
id|old_rootmnt
op_assign
id|mntget
c_func
(paren
id|current-&gt;fs-&gt;pwdmnt
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|current-&gt;fs-&gt;lock
)paren
suffix:semicolon
multiline_comment|/*  First unmount devfs if mounted  */
r_if
c_cond
(paren
id|path_init
c_func
(paren
l_string|&quot;/old/dev&quot;
comma
id|LOOKUP_FOLLOW
op_or
id|LOOKUP_POSITIVE
comma
op_amp
id|devfs_nd
)paren
)paren
id|error
op_assign
id|path_walk
c_func
(paren
l_string|&quot;/old/dev&quot;
comma
op_amp
id|devfs_nd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error
)paren
(brace
r_if
c_cond
(paren
id|devfs_nd.mnt-&gt;mnt_sb-&gt;s_magic
op_eq
id|DEVFS_SUPER_MAGIC
op_logical_and
id|devfs_nd.dentry
op_eq
id|devfs_nd.mnt-&gt;mnt_root
)paren
id|umount
c_func
(paren
l_string|&quot;/old/dev&quot;
comma
l_int|0
)paren
suffix:semicolon
id|path_release
c_func
(paren
op_amp
id|devfs_nd
)paren
suffix:semicolon
)brace
id|ROOT_DEV
op_assign
id|new_root_dev
suffix:semicolon
id|mount_root
c_func
(paren
)paren
suffix:semicolon
id|chdir
c_func
(paren
l_string|&quot;/root&quot;
)paren
suffix:semicolon
id|ROOT_DEV
op_assign
id|current-&gt;fs-&gt;pwdmnt-&gt;mnt_sb-&gt;s_dev
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;VFS: Mounted root (%s filesystem)%s.&bslash;n&quot;
comma
id|current-&gt;fs-&gt;pwdmnt-&gt;mnt_sb-&gt;s_type-&gt;name
comma
(paren
id|current-&gt;fs-&gt;pwdmnt-&gt;mnt_sb-&gt;s_flags
op_amp
id|MS_RDONLY
)paren
ques
c_cond
l_string|&quot; readonly&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
macro_line|#if 1
id|shrink_dcache
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;change_root: old root has d_count=%d&bslash;n&quot;
comma
id|atomic_read
c_func
(paren
op_amp
id|old_rootmnt-&gt;mnt_root-&gt;d_count
)paren
)paren
suffix:semicolon
macro_line|#endif
id|error
op_assign
id|mount
c_func
(paren
l_string|&quot;/old&quot;
comma
l_string|&quot;/root/initrd&quot;
comma
l_int|NULL
comma
id|MS_MOVE
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
r_int
id|blivet
suffix:semicolon
r_struct
id|block_device
op_star
id|ramdisk
op_assign
id|old_rootmnt-&gt;mnt_sb-&gt;s_bdev
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|ramdisk-&gt;bd_count
)paren
suffix:semicolon
id|blivet
op_assign
id|blkdev_get
c_func
(paren
id|ramdisk
comma
id|FMODE_READ
comma
l_int|0
comma
id|BDEV_FS
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;Trying to unmount old root ... &quot;
)paren
suffix:semicolon
id|umount
c_func
(paren
l_string|&quot;/old&quot;
comma
id|MNT_DETACH
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|blivet
)paren
(brace
id|blivet
op_assign
id|ioctl_by_bdev
c_func
(paren
id|ramdisk
comma
id|BLKFLSBUF
comma
l_int|0
)paren
suffix:semicolon
id|blkdev_put
c_func
(paren
id|ramdisk
comma
id|BDEV_FS
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|blivet
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;error %d&bslash;n&quot;
comma
id|blivet
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;okay&bslash;n&quot;
)paren
suffix:semicolon
id|error
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
(brace
id|spin_lock
c_func
(paren
op_amp
id|dcache_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_devname
)paren
(brace
r_void
op_star
id|p
op_assign
id|old_rootmnt-&gt;mnt_devname
suffix:semicolon
id|old_rootmnt-&gt;mnt_devname
op_assign
id|new_devname
suffix:semicolon
id|new_devname
op_assign
id|p
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|dcache_lock
)paren
suffix:semicolon
)brace
multiline_comment|/* put the old stuff */
id|mntput
c_func
(paren
id|old_rootmnt
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|new_devname
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_INITRD
DECL|function|do_linuxrc
r_static
r_int
id|do_linuxrc
c_func
(paren
r_void
op_star
id|shell
)paren
(brace
r_static
r_char
op_star
id|argv
(braket
)braket
op_assign
(brace
l_string|&quot;linuxrc&quot;
comma
l_int|NULL
comma
)brace
suffix:semicolon
r_extern
r_char
op_star
id|envp_init
(braket
)braket
suffix:semicolon
id|chdir
c_func
(paren
l_string|&quot;/root&quot;
)paren
suffix:semicolon
id|mount
c_func
(paren
l_string|&quot;.&quot;
comma
l_string|&quot;/&quot;
comma
l_int|NULL
comma
id|MS_MOVE
comma
l_int|NULL
)paren
suffix:semicolon
id|chroot
c_func
(paren
l_string|&quot;.&quot;
)paren
suffix:semicolon
id|mount_devfs_fs
(paren
)paren
suffix:semicolon
id|close
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|close
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|close
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|setsid
c_func
(paren
)paren
suffix:semicolon
(paren
r_void
)paren
id|open
c_func
(paren
l_string|&quot;/dev/console&quot;
comma
id|O_RDWR
comma
l_int|0
)paren
suffix:semicolon
(paren
r_void
)paren
id|dup
c_func
(paren
l_int|0
)paren
suffix:semicolon
(paren
r_void
)paren
id|dup
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_return
id|execve
c_func
(paren
id|shell
comma
id|argv
comma
id|envp_init
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * Prepare the namespace - decide what/where to mount, load ramdisks, etc.&n; */
DECL|function|prepare_namespace
r_void
id|prepare_namespace
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_BLK_DEV_INITRD
r_int
id|real_root_mountflags
op_assign
id|root_mountflags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|initrd_start
)paren
id|mount_initrd
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mount_initrd
)paren
id|root_mountflags
op_and_assign
op_complement
id|MS_RDONLY
suffix:semicolon
id|real_root_dev
op_assign
id|ROOT_DEV
suffix:semicolon
macro_line|#endif
id|mkdir
c_func
(paren
l_string|&quot;/dev&quot;
comma
l_int|0700
)paren
suffix:semicolon
id|mkdir
c_func
(paren
l_string|&quot;/root&quot;
comma
l_int|0700
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_RAM
macro_line|#ifdef CONFIG_BLK_DEV_INITRD
r_if
c_cond
(paren
id|mount_initrd
)paren
id|initrd_load
c_func
(paren
)paren
suffix:semicolon
r_else
macro_line|#endif
id|rd_load
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Mount the root filesystem.. */
id|mount_root
c_func
(paren
)paren
suffix:semicolon
id|chdir
c_func
(paren
l_string|&quot;/root&quot;
)paren
suffix:semicolon
id|ROOT_DEV
op_assign
id|current-&gt;fs-&gt;pwdmnt-&gt;mnt_sb-&gt;s_dev
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;VFS: Mounted root (%s filesystem)%s.&bslash;n&quot;
comma
id|current-&gt;fs-&gt;pwdmnt-&gt;mnt_sb-&gt;s_type-&gt;name
comma
(paren
id|current-&gt;fs-&gt;pwdmnt-&gt;mnt_sb-&gt;s_flags
op_amp
id|MS_RDONLY
)paren
ques
c_cond
l_string|&quot; readonly&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_INITRD
id|root_mountflags
op_assign
id|real_root_mountflags
suffix:semicolon
r_if
c_cond
(paren
id|mount_initrd
op_logical_and
id|ROOT_DEV
op_ne
id|real_root_dev
op_logical_and
id|MAJOR
c_func
(paren
id|ROOT_DEV
)paren
op_eq
id|RAMDISK_MAJOR
op_logical_and
id|MINOR
c_func
(paren
id|ROOT_DEV
)paren
op_eq
l_int|0
)paren
(brace
r_int
id|error
suffix:semicolon
r_int
id|i
comma
id|pid
suffix:semicolon
id|mkdir
c_func
(paren
l_string|&quot;/old&quot;
comma
l_int|0700
)paren
suffix:semicolon
id|chdir
c_func
(paren
l_string|&quot;/old&quot;
)paren
suffix:semicolon
id|pid
op_assign
id|kernel_thread
c_func
(paren
id|do_linuxrc
comma
l_string|&quot;/linuxrc&quot;
comma
id|SIGCHLD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pid
OG
l_int|0
)paren
(brace
r_while
c_loop
(paren
id|pid
op_ne
id|wait
c_func
(paren
op_amp
id|i
)paren
)paren
(brace
id|current-&gt;policy
op_or_assign
id|SCHED_YIELD
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|MAJOR
c_func
(paren
id|real_root_dev
)paren
op_ne
id|RAMDISK_MAJOR
op_logical_or
id|MINOR
c_func
(paren
id|real_root_dev
)paren
op_ne
l_int|0
)paren
(brace
id|error
op_assign
id|change_root
c_func
(paren
id|real_root_dev
comma
l_string|&quot;/initrd&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Change root to /initrd: &quot;
l_string|&quot;error %d&bslash;n&quot;
comma
id|error
)paren
suffix:semicolon
id|chdir
c_func
(paren
l_string|&quot;/root&quot;
)paren
suffix:semicolon
id|mount
c_func
(paren
l_string|&quot;.&quot;
comma
l_string|&quot;/&quot;
comma
l_int|NULL
comma
id|MS_MOVE
comma
l_int|NULL
)paren
suffix:semicolon
id|chroot
c_func
(paren
l_string|&quot;.&quot;
)paren
suffix:semicolon
id|mount_devfs_fs
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|chroot
c_func
(paren
l_string|&quot;..&quot;
)paren
suffix:semicolon
id|chdir
c_func
(paren
l_string|&quot;/&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
id|mount
c_func
(paren
l_string|&quot;.&quot;
comma
l_string|&quot;/&quot;
comma
l_int|NULL
comma
id|MS_MOVE
comma
l_int|NULL
)paren
suffix:semicolon
id|chroot
c_func
(paren
l_string|&quot;.&quot;
)paren
suffix:semicolon
id|mount_devfs_fs
(paren
)paren
suffix:semicolon
)brace
eof
