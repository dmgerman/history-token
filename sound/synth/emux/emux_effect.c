multiline_comment|/*&n; *  Midi synth routines for the Emu8k/Emu10k1&n; *&n; *  Copyright (C) 1999 Steve Ratcliffe&n; *  Copyright (c) 1999-2000 Takashi Iwai &lt;tiwai@suse.de&gt;&n; *&n; *  Contains code based on awe_wave.c by Takashi Iwai&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#include &quot;emux_voice.h&quot;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#ifdef SNDRV_EMUX_USE_RAW_EFFECT
multiline_comment|/*&n; * effects table&n; */
DECL|macro|xoffsetof
mdefine_line|#define xoffsetof(type,tag)&t;((long)(&amp;((type)NULL)-&gt;tag) - (long)(NULL))
DECL|macro|parm_offset
mdefine_line|#define parm_offset(tag)&t;xoffsetof(soundfont_voice_parm_t*, tag)
DECL|macro|PARM_IS_BYTE
mdefine_line|#define PARM_IS_BYTE&t;&t;(1 &lt;&lt; 0)
DECL|macro|PARM_IS_WORD
mdefine_line|#define PARM_IS_WORD&t;&t;(1 &lt;&lt; 1)
DECL|macro|PARM_IS_ALIGNED
mdefine_line|#define PARM_IS_ALIGNED&t;&t;(3 &lt;&lt; 2)
DECL|macro|PARM_IS_ALIGN_HI
mdefine_line|#define PARM_IS_ALIGN_HI&t;(1 &lt;&lt; 2)
DECL|macro|PARM_IS_ALIGN_LO
mdefine_line|#define PARM_IS_ALIGN_LO&t;(2 &lt;&lt; 2)
DECL|macro|PARM_IS_SIGNED
mdefine_line|#define PARM_IS_SIGNED&t;&t;(1 &lt;&lt; 4)
DECL|macro|PARM_WORD
mdefine_line|#define PARM_WORD&t;(PARM_IS_WORD)
DECL|macro|PARM_BYTE_LO
mdefine_line|#define PARM_BYTE_LO&t;(PARM_IS_BYTE|PARM_IS_ALIGN_LO)
DECL|macro|PARM_BYTE_HI
mdefine_line|#define PARM_BYTE_HI&t;(PARM_IS_BYTE|PARM_IS_ALIGN_HI)
DECL|macro|PARM_BYTE
mdefine_line|#define PARM_BYTE&t;(PARM_IS_BYTE)
DECL|macro|PARM_SIGN_LO
mdefine_line|#define PARM_SIGN_LO&t;(PARM_IS_BYTE|PARM_IS_ALIGN_LO|PARM_IS_SIGNED)
DECL|macro|PARM_SIGN_HI
mdefine_line|#define PARM_SIGN_HI&t;(PARM_IS_BYTE|PARM_IS_ALIGN_HI|PARM_IS_SIGNED)
DECL|struct|emux_parm_defs
r_static
r_struct
id|emux_parm_defs
(brace
DECL|member|type
r_int
id|type
suffix:semicolon
multiline_comment|/* byte or word */
DECL|member|low
DECL|member|high
r_int
id|low
comma
id|high
suffix:semicolon
multiline_comment|/* value range */
DECL|member|offset
r_int
id|offset
suffix:semicolon
multiline_comment|/* offset in parameter record (-1 = not written) */
DECL|member|update
r_int
id|update
suffix:semicolon
multiline_comment|/* flgas for real-time update */
DECL|variable|parm_defs
)brace
id|parm_defs
(braket
id|EMUX_NUM_EFFECTS
)braket
op_assign
(brace
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0x8000
comma
id|parm_offset
c_func
(paren
id|moddelay
)paren
comma
l_int|0
)brace
comma
multiline_comment|/* env1 delay */
(brace
id|PARM_BYTE_LO
comma
l_int|1
comma
l_int|0x80
comma
id|parm_offset
c_func
(paren
id|modatkhld
)paren
comma
l_int|0
)brace
comma
multiline_comment|/* env1 attack */
(brace
id|PARM_BYTE_HI
comma
l_int|0
comma
l_int|0x7e
comma
id|parm_offset
c_func
(paren
id|modatkhld
)paren
comma
l_int|0
)brace
comma
multiline_comment|/* env1 hold */
(brace
id|PARM_BYTE_LO
comma
l_int|1
comma
l_int|0x7f
comma
id|parm_offset
c_func
(paren
id|moddcysus
)paren
comma
l_int|0
)brace
comma
multiline_comment|/* env1 decay */
(brace
id|PARM_BYTE_LO
comma
l_int|1
comma
l_int|0x7f
comma
id|parm_offset
c_func
(paren
id|modrelease
)paren
comma
l_int|0
)brace
comma
multiline_comment|/* env1 release */
(brace
id|PARM_BYTE_HI
comma
l_int|0
comma
l_int|0x7f
comma
id|parm_offset
c_func
(paren
id|moddcysus
)paren
comma
l_int|0
)brace
comma
multiline_comment|/* env1 sustain */
(brace
id|PARM_BYTE_HI
comma
l_int|0
comma
l_int|0xff
comma
id|parm_offset
c_func
(paren
id|pefe
)paren
comma
l_int|0
)brace
comma
multiline_comment|/* env1 pitch */
(brace
id|PARM_BYTE_LO
comma
l_int|0
comma
l_int|0xff
comma
id|parm_offset
c_func
(paren
id|pefe
)paren
comma
l_int|0
)brace
comma
multiline_comment|/* env1 fc */
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0x8000
comma
id|parm_offset
c_func
(paren
id|voldelay
)paren
comma
l_int|0
)brace
comma
multiline_comment|/* env2 delay */
(brace
id|PARM_BYTE_LO
comma
l_int|1
comma
l_int|0x80
comma
id|parm_offset
c_func
(paren
id|volatkhld
)paren
comma
l_int|0
)brace
comma
multiline_comment|/* env2 attack */
(brace
id|PARM_BYTE_HI
comma
l_int|0
comma
l_int|0x7e
comma
id|parm_offset
c_func
(paren
id|volatkhld
)paren
comma
l_int|0
)brace
comma
multiline_comment|/* env2 hold */
(brace
id|PARM_BYTE_LO
comma
l_int|1
comma
l_int|0x7f
comma
id|parm_offset
c_func
(paren
id|voldcysus
)paren
comma
l_int|0
)brace
comma
multiline_comment|/* env2 decay */
(brace
id|PARM_BYTE_LO
comma
l_int|1
comma
l_int|0x7f
comma
id|parm_offset
c_func
(paren
id|volrelease
)paren
comma
l_int|0
)brace
comma
multiline_comment|/* env2 release */
(brace
id|PARM_BYTE_HI
comma
l_int|0
comma
l_int|0x7f
comma
id|parm_offset
c_func
(paren
id|voldcysus
)paren
comma
l_int|0
)brace
comma
multiline_comment|/* env2 sustain */
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0x8000
comma
id|parm_offset
c_func
(paren
id|lfo1delay
)paren
comma
l_int|0
)brace
comma
multiline_comment|/* lfo1 delay */
(brace
id|PARM_BYTE_LO
comma
l_int|0
comma
l_int|0xff
comma
id|parm_offset
c_func
(paren
id|tremfrq
)paren
comma
id|SNDRV_EMUX_UPDATE_TREMFREQ
)brace
comma
multiline_comment|/* lfo1 freq */
(brace
id|PARM_SIGN_HI
comma
op_minus
l_int|128
comma
l_int|127
comma
id|parm_offset
c_func
(paren
id|tremfrq
)paren
comma
id|SNDRV_EMUX_UPDATE_TREMFREQ
)brace
comma
multiline_comment|/* lfo1 vol */
(brace
id|PARM_SIGN_HI
comma
op_minus
l_int|128
comma
l_int|127
comma
id|parm_offset
c_func
(paren
id|fmmod
)paren
comma
id|SNDRV_EMUX_UPDATE_FMMOD
)brace
comma
multiline_comment|/* lfo1 pitch */
(brace
id|PARM_BYTE_LO
comma
l_int|0
comma
l_int|0xff
comma
id|parm_offset
c_func
(paren
id|fmmod
)paren
comma
id|SNDRV_EMUX_UPDATE_FMMOD
)brace
comma
multiline_comment|/* lfo1 cutoff */
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0x8000
comma
id|parm_offset
c_func
(paren
id|lfo2delay
)paren
comma
l_int|0
)brace
comma
multiline_comment|/* lfo2 delay */
(brace
id|PARM_BYTE_LO
comma
l_int|0
comma
l_int|0xff
comma
id|parm_offset
c_func
(paren
id|fm2frq2
)paren
comma
id|SNDRV_EMUX_UPDATE_FM2FRQ2
)brace
comma
multiline_comment|/* lfo2 freq */
(brace
id|PARM_SIGN_HI
comma
op_minus
l_int|128
comma
l_int|127
comma
id|parm_offset
c_func
(paren
id|fm2frq2
)paren
comma
id|SNDRV_EMUX_UPDATE_FM2FRQ2
)brace
comma
multiline_comment|/* lfo2 pitch */
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0xffff
comma
op_minus
l_int|1
comma
id|SNDRV_EMUX_UPDATE_PITCH
)brace
comma
multiline_comment|/* initial pitch */
(brace
id|PARM_BYTE
comma
l_int|0
comma
l_int|0xff
comma
id|parm_offset
c_func
(paren
id|chorus
)paren
comma
l_int|0
)brace
comma
multiline_comment|/* chorus */
(brace
id|PARM_BYTE
comma
l_int|0
comma
l_int|0xff
comma
id|parm_offset
c_func
(paren
id|reverb
)paren
comma
l_int|0
)brace
comma
multiline_comment|/* reverb */
(brace
id|PARM_BYTE
comma
l_int|0
comma
l_int|0xff
comma
id|parm_offset
c_func
(paren
id|cutoff
)paren
comma
id|SNDRV_EMUX_UPDATE_VOLUME
)brace
comma
multiline_comment|/* cutoff */
(brace
id|PARM_BYTE
comma
l_int|0
comma
l_int|15
comma
id|parm_offset
c_func
(paren
id|filterQ
)paren
comma
id|SNDRV_EMUX_UPDATE_Q
)brace
comma
multiline_comment|/* resonance */
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0xffff
comma
op_minus
l_int|1
comma
l_int|0
)brace
comma
multiline_comment|/* sample start */
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0xffff
comma
op_minus
l_int|1
comma
l_int|0
)brace
comma
multiline_comment|/* loop start */
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0xffff
comma
op_minus
l_int|1
comma
l_int|0
)brace
comma
multiline_comment|/* loop end */
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0xffff
comma
op_minus
l_int|1
comma
l_int|0
)brace
comma
multiline_comment|/* coarse sample start */
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0xffff
comma
op_minus
l_int|1
comma
l_int|0
)brace
comma
multiline_comment|/* coarse loop start */
(brace
id|PARM_WORD
comma
l_int|0
comma
l_int|0xffff
comma
op_minus
l_int|1
comma
l_int|0
)brace
comma
multiline_comment|/* coarse loop end */
(brace
id|PARM_BYTE
comma
l_int|0
comma
l_int|0xff
comma
op_minus
l_int|1
comma
id|SNDRV_EMUX_UPDATE_VOLUME
)brace
comma
multiline_comment|/* initial attenuation */
)brace
suffix:semicolon
multiline_comment|/* set byte effect value */
r_static
r_void
DECL|function|effect_set_byte
id|effect_set_byte
c_func
(paren
r_int
r_char
op_star
id|valp
comma
id|snd_midi_channel_t
op_star
id|chan
comma
r_int
id|type
)paren
(brace
r_int
id|effect
suffix:semicolon
id|snd_emux_effect_table_t
op_star
id|fx
op_assign
id|chan
op_member_access_from_pointer
r_private
suffix:semicolon
id|effect
op_assign
id|fx-&gt;val
(braket
id|type
)braket
suffix:semicolon
r_if
c_cond
(paren
id|fx-&gt;flag
(braket
id|type
)braket
op_eq
id|EMUX_FX_FLAG_ADD
)paren
(brace
r_if
c_cond
(paren
id|parm_defs
(braket
id|type
)braket
dot
id|type
op_amp
id|PARM_IS_SIGNED
)paren
id|effect
op_add_assign
op_star
(paren
r_char
op_star
)paren
id|valp
suffix:semicolon
r_else
id|effect
op_add_assign
op_star
id|valp
suffix:semicolon
)brace
r_if
c_cond
(paren
id|effect
OL
id|parm_defs
(braket
id|type
)braket
dot
id|low
)paren
id|effect
op_assign
id|parm_defs
(braket
id|type
)braket
dot
id|low
suffix:semicolon
r_else
r_if
c_cond
(paren
id|effect
OG
id|parm_defs
(braket
id|type
)braket
dot
id|high
)paren
id|effect
op_assign
id|parm_defs
(braket
id|type
)braket
dot
id|high
suffix:semicolon
op_star
id|valp
op_assign
(paren
r_int
r_char
)paren
id|effect
suffix:semicolon
)brace
multiline_comment|/* set word effect value */
r_static
r_void
DECL|function|effect_set_word
id|effect_set_word
c_func
(paren
r_int
r_int
op_star
id|valp
comma
id|snd_midi_channel_t
op_star
id|chan
comma
r_int
id|type
)paren
(brace
r_int
id|effect
suffix:semicolon
id|snd_emux_effect_table_t
op_star
id|fx
op_assign
id|chan
op_member_access_from_pointer
r_private
suffix:semicolon
id|effect
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
op_amp
id|fx-&gt;val
(braket
id|type
)braket
suffix:semicolon
r_if
c_cond
(paren
id|fx-&gt;flag
(braket
id|type
)braket
op_eq
id|EMUX_FX_FLAG_ADD
)paren
id|effect
op_add_assign
op_star
id|valp
suffix:semicolon
r_if
c_cond
(paren
id|effect
OL
id|parm_defs
(braket
id|type
)braket
dot
id|low
)paren
id|effect
op_assign
id|parm_defs
(braket
id|type
)braket
dot
id|low
suffix:semicolon
r_else
r_if
c_cond
(paren
id|effect
OG
id|parm_defs
(braket
id|type
)braket
dot
id|high
)paren
id|effect
op_assign
id|parm_defs
(braket
id|type
)braket
dot
id|high
suffix:semicolon
op_star
id|valp
op_assign
(paren
r_int
r_int
)paren
id|effect
suffix:semicolon
)brace
multiline_comment|/* address offset */
r_static
r_int
DECL|function|effect_get_offset
id|effect_get_offset
c_func
(paren
id|snd_midi_channel_t
op_star
id|chan
comma
r_int
id|lo
comma
r_int
id|hi
comma
r_int
id|mode
)paren
(brace
r_int
id|addr
op_assign
l_int|0
suffix:semicolon
id|snd_emux_effect_table_t
op_star
id|fx
op_assign
id|chan
op_member_access_from_pointer
r_private
suffix:semicolon
r_if
c_cond
(paren
id|fx-&gt;flag
(braket
id|hi
)braket
)paren
id|addr
op_assign
(paren
r_int
)paren
id|fx-&gt;val
(braket
id|hi
)braket
suffix:semicolon
id|addr
op_assign
id|addr
op_lshift
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|fx-&gt;flag
(braket
id|lo
)braket
)paren
id|addr
op_add_assign
(paren
r_int
)paren
id|fx-&gt;val
(braket
id|lo
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mode
op_amp
id|SNDRV_SFNT_SAMPLE_8BITS
)paren
)paren
id|addr
op_div_assign
l_int|2
suffix:semicolon
r_return
id|addr
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SND_SEQUENCER_OSS
multiline_comment|/* change effects - for OSS sequencer compatibility */
r_void
DECL|function|snd_emux_send_effect_oss
id|snd_emux_send_effect_oss
c_func
(paren
id|snd_emux_port_t
op_star
id|port
comma
id|snd_midi_channel_t
op_star
id|chan
comma
r_int
id|type
comma
r_int
id|val
)paren
(brace
r_int
id|mode
suffix:semicolon
r_if
c_cond
(paren
id|type
op_amp
l_int|0x40
)paren
id|mode
op_assign
id|EMUX_FX_FLAG_OFF
suffix:semicolon
r_else
r_if
c_cond
(paren
id|type
op_amp
l_int|0x80
)paren
id|mode
op_assign
id|EMUX_FX_FLAG_ADD
suffix:semicolon
r_else
id|mode
op_assign
id|EMUX_FX_FLAG_SET
suffix:semicolon
id|type
op_and_assign
l_int|0x3f
suffix:semicolon
id|snd_emux_send_effect
c_func
(paren
id|port
comma
id|chan
comma
id|type
comma
id|val
comma
id|mode
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Modify the effect value.&n; * if update is necessary, call emu8000_control&n; */
r_void
DECL|function|snd_emux_send_effect
id|snd_emux_send_effect
c_func
(paren
id|snd_emux_port_t
op_star
id|port
comma
id|snd_midi_channel_t
op_star
id|chan
comma
r_int
id|type
comma
r_int
id|val
comma
r_int
id|mode
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|offset
suffix:semicolon
r_int
r_char
op_star
id|srcp
comma
op_star
id|origp
suffix:semicolon
id|snd_emux_t
op_star
id|emu
suffix:semicolon
id|snd_emux_effect_table_t
op_star
id|fx
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|emu
op_assign
id|port-&gt;emu
suffix:semicolon
id|fx
op_assign
id|chan
op_member_access_from_pointer
r_private
suffix:semicolon
r_if
c_cond
(paren
id|emu
op_eq
l_int|NULL
op_logical_or
id|fx
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|type
OL
l_int|0
op_logical_or
id|type
op_ge
id|EMUX_NUM_EFFECTS
)paren
r_return
suffix:semicolon
id|fx-&gt;val
(braket
id|type
)braket
op_assign
id|val
suffix:semicolon
id|fx-&gt;flag
(braket
id|type
)braket
op_assign
id|mode
suffix:semicolon
multiline_comment|/* do we need to modify the register in realtime ? */
r_if
c_cond
(paren
op_logical_neg
id|parm_defs
(braket
id|type
)braket
dot
id|update
op_logical_or
(paren
id|offset
op_assign
id|parm_defs
(braket
id|type
)braket
dot
id|offset
)paren
OL
l_int|0
)paren
r_return
suffix:semicolon
macro_line|#ifdef SNDRV_LITTLE_ENDIAN
r_if
c_cond
(paren
id|parm_defs
(braket
id|type
)braket
dot
id|type
op_amp
id|PARM_IS_ALIGN_HI
)paren
id|offset
op_increment
suffix:semicolon
macro_line|#else
r_if
c_cond
(paren
id|parm_defs
(braket
id|type
)braket
dot
id|type
op_amp
id|PARM_IS_ALIGN_LO
)paren
id|offset
op_increment
suffix:semicolon
macro_line|#endif
multiline_comment|/* modify the register values */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;voice_lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|emu-&gt;max_voices
suffix:semicolon
id|i
op_increment
)paren
(brace
id|snd_emux_voice_t
op_star
id|vp
op_assign
op_amp
id|emu-&gt;voices
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|STATE_IS_PLAYING
c_func
(paren
id|vp-&gt;state
)paren
op_logical_or
id|vp-&gt;chan
op_ne
id|chan
)paren
r_continue
suffix:semicolon
id|srcp
op_assign
(paren
r_int
r_char
op_star
)paren
op_amp
id|vp-&gt;reg.parm
op_plus
id|offset
suffix:semicolon
id|origp
op_assign
(paren
r_int
r_char
op_star
)paren
op_amp
id|vp-&gt;zone-&gt;v.parm
op_plus
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|parm_defs
(braket
id|i
)braket
dot
id|type
op_amp
id|PARM_IS_BYTE
)paren
(brace
op_star
id|srcp
op_assign
op_star
id|origp
suffix:semicolon
id|effect_set_byte
c_func
(paren
id|srcp
comma
id|chan
comma
id|type
)paren
suffix:semicolon
)brace
r_else
(brace
op_star
(paren
r_int
r_int
op_star
)paren
id|srcp
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|origp
suffix:semicolon
id|effect_set_word
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|srcp
comma
id|chan
comma
id|type
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;voice_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* activate them */
id|snd_emux_update_channel
c_func
(paren
id|port
comma
id|chan
comma
id|parm_defs
(braket
id|type
)braket
dot
id|update
)paren
suffix:semicolon
)brace
multiline_comment|/* copy wavetable registers to voice table */
r_void
DECL|function|snd_emux_setup_effect
id|snd_emux_setup_effect
c_func
(paren
id|snd_emux_voice_t
op_star
id|vp
)paren
(brace
id|snd_midi_channel_t
op_star
id|chan
op_assign
id|vp-&gt;chan
suffix:semicolon
id|snd_emux_effect_table_t
op_star
id|fx
suffix:semicolon
r_int
r_char
op_star
id|srcp
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fx
op_assign
id|chan
op_member_access_from_pointer
r_private
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* modify the register values via effect table */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|EMUX_FX_END
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|offset
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fx-&gt;flag
(braket
id|i
)braket
op_logical_or
(paren
id|offset
op_assign
id|parm_defs
(braket
id|i
)braket
dot
id|offset
)paren
OL
l_int|0
)paren
r_continue
suffix:semicolon
macro_line|#ifdef SNDRV_LITTLE_ENDIAN
r_if
c_cond
(paren
id|parm_defs
(braket
id|i
)braket
dot
id|type
op_amp
id|PARM_IS_ALIGN_HI
)paren
id|offset
op_increment
suffix:semicolon
macro_line|#else
r_if
c_cond
(paren
id|parm_defs
(braket
id|i
)braket
dot
id|type
op_amp
id|PARM_IS_ALIGN_LO
)paren
id|offset
op_increment
suffix:semicolon
macro_line|#endif
id|srcp
op_assign
(paren
r_int
r_char
op_star
)paren
op_amp
id|vp-&gt;reg.parm
op_plus
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|parm_defs
(braket
id|i
)braket
dot
id|type
op_amp
id|PARM_IS_BYTE
)paren
id|effect_set_byte
c_func
(paren
id|srcp
comma
id|chan
comma
id|i
)paren
suffix:semicolon
r_else
id|effect_set_word
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|srcp
comma
id|chan
comma
id|i
)paren
suffix:semicolon
)brace
multiline_comment|/* correct sample and loop points */
id|vp-&gt;reg.start
op_add_assign
id|effect_get_offset
c_func
(paren
id|chan
comma
id|EMUX_FX_SAMPLE_START
comma
id|EMUX_FX_COARSE_SAMPLE_START
comma
id|vp-&gt;reg.sample_mode
)paren
suffix:semicolon
id|vp-&gt;reg.loopstart
op_add_assign
id|effect_get_offset
c_func
(paren
id|chan
comma
id|EMUX_FX_LOOP_START
comma
id|EMUX_FX_COARSE_LOOP_START
comma
id|vp-&gt;reg.sample_mode
)paren
suffix:semicolon
id|vp-&gt;reg.loopend
op_add_assign
id|effect_get_offset
c_func
(paren
id|chan
comma
id|EMUX_FX_LOOP_END
comma
id|EMUX_FX_COARSE_LOOP_END
comma
id|vp-&gt;reg.sample_mode
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * effect table&n; */
r_void
DECL|function|snd_emux_create_effect
id|snd_emux_create_effect
c_func
(paren
id|snd_emux_port_t
op_star
id|p
)paren
(brace
r_int
id|i
suffix:semicolon
id|p-&gt;effect
op_assign
id|snd_kcalloc
c_func
(paren
r_sizeof
(paren
id|snd_emux_effect_table_t
)paren
op_star
id|p-&gt;chset.max_channels
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;effect
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|p-&gt;chset.max_channels
suffix:semicolon
id|i
op_increment
)paren
id|p-&gt;chset.channels
(braket
id|i
)braket
dot
r_private
op_assign
id|p-&gt;effect
op_plus
id|i
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|p-&gt;chset.max_channels
suffix:semicolon
id|i
op_increment
)paren
id|p-&gt;chset.channels
(braket
id|i
)braket
dot
r_private
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_void
DECL|function|snd_emux_delete_effect
id|snd_emux_delete_effect
c_func
(paren
id|snd_emux_port_t
op_star
id|p
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;effect
)paren
(brace
id|kfree
c_func
(paren
id|p-&gt;effect
)paren
suffix:semicolon
id|p-&gt;effect
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_void
DECL|function|snd_emux_clear_effect
id|snd_emux_clear_effect
c_func
(paren
id|snd_emux_port_t
op_star
id|p
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;effect
)paren
(brace
id|memset
c_func
(paren
id|p-&gt;effect
comma
l_int|0
comma
r_sizeof
(paren
id|snd_emux_effect_table_t
)paren
op_star
id|p-&gt;chset.max_channels
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif /* SNDRV_EMUX_USE_RAW_EFFECT */
eof
