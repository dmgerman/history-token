multiline_comment|/*&n; * Driver for Digigram VX soundcards&n; *&n; * hwdep device manager&n; *&n; * Copyright (c) 2002 by Takashi Iwai &lt;tiwai@suse.de&gt;&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/hwdep.h&gt;
macro_line|#include &lt;sound/vx_core.h&gt;
DECL|function|vx_hwdep_open
r_static
r_int
id|vx_hwdep_open
c_func
(paren
id|snd_hwdep_t
op_star
id|hw
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|vx_hwdep_release
r_static
r_int
id|vx_hwdep_release
c_func
(paren
id|snd_hwdep_t
op_star
id|hw
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|vx_hwdep_dsp_status
r_static
r_int
id|vx_hwdep_dsp_status
c_func
(paren
id|snd_hwdep_t
op_star
id|hw
comma
id|snd_hwdep_dsp_status_t
op_star
id|info
)paren
(brace
r_static
r_char
op_star
id|type_ids
(braket
id|VX_TYPE_NUMS
)braket
op_assign
(brace
(braket
id|VX_TYPE_BOARD
)braket
op_assign
l_string|&quot;vxboard&quot;
comma
(braket
id|VX_TYPE_V2
)braket
op_assign
l_string|&quot;vx222&quot;
comma
(braket
id|VX_TYPE_MIC
)braket
op_assign
l_string|&quot;vx222&quot;
comma
(braket
id|VX_TYPE_VXPOCKET
)braket
op_assign
l_string|&quot;vxpocket&quot;
comma
(braket
id|VX_TYPE_VXP440
)braket
op_assign
l_string|&quot;vxp440&quot;
comma
)brace
suffix:semicolon
id|vx_core_t
op_star
id|vx
op_assign
id|snd_magic_cast
c_func
(paren
id|vx_core_t
comma
id|hw-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|type_ids
(braket
id|vx-&gt;type
)braket
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|info-&gt;id
comma
id|type_ids
(braket
id|vx-&gt;type
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vx_is_pcmcia
c_func
(paren
id|vx
)paren
)paren
id|info-&gt;num_dsps
op_assign
l_int|4
suffix:semicolon
r_else
id|info-&gt;num_dsps
op_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|vx-&gt;chip_status
op_amp
id|VX_STAT_CHIP_INIT
)paren
id|info-&gt;chip_ready
op_assign
l_int|1
suffix:semicolon
id|info-&gt;version
op_assign
id|VX_DRIVER_VERSION
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|vx_hwdep_dsp_load
r_static
r_int
id|vx_hwdep_dsp_load
c_func
(paren
id|snd_hwdep_t
op_star
id|hw
comma
id|snd_hwdep_dsp_image_t
op_star
id|dsp
)paren
(brace
id|vx_core_t
op_star
id|vx
op_assign
id|snd_magic_cast
c_func
(paren
id|vx_core_t
comma
id|hw-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_int
id|index
comma
id|err
suffix:semicolon
id|snd_assert
c_func
(paren
id|vx-&gt;ops-&gt;load_dsp
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|err
op_assign
id|vx-&gt;ops
op_member_access_from_pointer
id|load_dsp
c_func
(paren
id|vx
comma
id|dsp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|index
op_assign
id|dsp-&gt;index
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vx_is_pcmcia
c_func
(paren
id|vx
)paren
)paren
id|index
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|index
op_eq
l_int|1
)paren
id|vx-&gt;chip_status
op_or_assign
id|VX_STAT_XILINX_LOADED
suffix:semicolon
r_if
c_cond
(paren
id|index
OL
l_int|3
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* ok, we reached to the last one */
multiline_comment|/* create the devices if not built yet */
r_if
c_cond
(paren
op_logical_neg
(paren
id|vx-&gt;chip_status
op_amp
id|VX_STAT_DEVICE_INIT
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_vx_pcm_new
c_func
(paren
id|vx
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_vx_mixer_new
c_func
(paren
id|vx
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|vx-&gt;ops-&gt;add_controls
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|vx-&gt;ops
op_member_access_from_pointer
id|add_controls
c_func
(paren
id|vx
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_card_register
c_func
(paren
id|vx-&gt;card
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|vx-&gt;chip_status
op_or_assign
id|VX_STAT_DEVICE_INIT
suffix:semicolon
)brace
id|vx-&gt;chip_status
op_or_assign
id|VX_STAT_CHIP_INIT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* exported */
DECL|function|snd_vx_hwdep_new
r_int
id|snd_vx_hwdep_new
c_func
(paren
id|vx_core_t
op_star
id|chip
)paren
(brace
r_int
id|err
suffix:semicolon
id|snd_hwdep_t
op_star
id|hw
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_hwdep_new
c_func
(paren
id|chip-&gt;card
comma
id|SND_VX_HWDEP_ID
comma
l_int|0
comma
op_amp
id|hw
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|hw-&gt;iface
op_assign
id|SNDRV_HWDEP_IFACE_VX
suffix:semicolon
id|hw-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|hw-&gt;ops.open
op_assign
id|vx_hwdep_open
suffix:semicolon
id|hw-&gt;ops.release
op_assign
id|vx_hwdep_release
suffix:semicolon
id|hw-&gt;ops.dsp_status
op_assign
id|vx_hwdep_dsp_status
suffix:semicolon
id|hw-&gt;ops.dsp_load
op_assign
id|vx_hwdep_dsp_load
suffix:semicolon
id|hw-&gt;exclusive
op_assign
l_int|1
suffix:semicolon
id|sprintf
c_func
(paren
id|hw-&gt;name
comma
l_string|&quot;VX Loader (%s)&quot;
comma
id|chip-&gt;card-&gt;driver
)paren
suffix:semicolon
id|chip-&gt;hwdep
op_assign
id|hw
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
