multiline_comment|/*&n; *  Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *  GUS&squot;s memory allocation routines / bottom layer&n; *&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/gus.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#ifdef CONFIG_SND_DEBUG
r_static
r_void
id|snd_gf1_mem_info_read
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
suffix:semicolon
macro_line|#endif
DECL|function|snd_gf1_mem_lock
r_void
id|snd_gf1_mem_lock
c_func
(paren
id|snd_gf1_mem_t
op_star
id|alloc
comma
r_int
id|xup
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|xup
)paren
(brace
id|down
c_func
(paren
op_amp
id|alloc-&gt;memory_mutex
)paren
suffix:semicolon
)brace
r_else
(brace
id|up
c_func
(paren
op_amp
id|alloc-&gt;memory_mutex
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_gf1_mem_xalloc
id|snd_gf1_mem_block_t
op_star
id|snd_gf1_mem_xalloc
c_func
(paren
id|snd_gf1_mem_t
op_star
id|alloc
comma
id|snd_gf1_mem_block_t
op_star
id|block
)paren
(brace
id|snd_gf1_mem_block_t
op_star
id|pblock
comma
op_star
id|nblock
suffix:semicolon
id|nblock
op_assign
(paren
id|snd_gf1_mem_block_t
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|snd_gf1_mem_block_t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nblock
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
op_star
id|nblock
op_assign
op_star
id|block
suffix:semicolon
id|pblock
op_assign
id|alloc-&gt;first
suffix:semicolon
r_while
c_loop
(paren
id|pblock
)paren
(brace
r_if
c_cond
(paren
id|pblock-&gt;ptr
OG
id|nblock-&gt;ptr
)paren
(brace
id|nblock-&gt;prev
op_assign
id|pblock-&gt;prev
suffix:semicolon
id|nblock-&gt;next
op_assign
id|pblock
suffix:semicolon
id|pblock-&gt;prev
op_assign
id|nblock
suffix:semicolon
r_if
c_cond
(paren
id|pblock
op_eq
id|alloc-&gt;first
)paren
id|alloc-&gt;first
op_assign
id|nblock
suffix:semicolon
r_else
id|nblock-&gt;prev-&gt;next
op_assign
id|nblock
suffix:semicolon
id|up
c_func
(paren
op_amp
id|alloc-&gt;memory_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|pblock
op_assign
id|pblock-&gt;next
suffix:semicolon
)brace
id|nblock-&gt;next
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|alloc-&gt;last
op_eq
l_int|NULL
)paren
(brace
id|nblock-&gt;prev
op_assign
l_int|NULL
suffix:semicolon
id|alloc-&gt;first
op_assign
id|alloc-&gt;last
op_assign
id|nblock
suffix:semicolon
)brace
r_else
(brace
id|nblock-&gt;prev
op_assign
id|alloc-&gt;last
suffix:semicolon
id|alloc-&gt;last-&gt;next
op_assign
id|nblock
suffix:semicolon
id|alloc-&gt;last
op_assign
id|nblock
suffix:semicolon
)brace
r_return
id|nblock
suffix:semicolon
)brace
DECL|function|snd_gf1_mem_xfree
r_int
id|snd_gf1_mem_xfree
c_func
(paren
id|snd_gf1_mem_t
op_star
id|alloc
comma
id|snd_gf1_mem_block_t
op_star
id|block
)paren
(brace
r_if
c_cond
(paren
id|block-&gt;share
)paren
(brace
multiline_comment|/* ok.. shared block */
id|block-&gt;share
op_decrement
suffix:semicolon
id|up
c_func
(paren
op_amp
id|alloc-&gt;memory_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|alloc-&gt;first
op_eq
id|block
)paren
(brace
id|alloc-&gt;first
op_assign
id|block-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|block-&gt;next
)paren
id|block-&gt;next-&gt;prev
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|block-&gt;prev-&gt;next
op_assign
id|block-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|block-&gt;next
)paren
id|block-&gt;next-&gt;prev
op_assign
id|block-&gt;prev
suffix:semicolon
)brace
r_if
c_cond
(paren
id|alloc-&gt;last
op_eq
id|block
)paren
(brace
id|alloc-&gt;last
op_assign
id|block-&gt;prev
suffix:semicolon
r_if
c_cond
(paren
id|block-&gt;prev
)paren
id|block-&gt;prev-&gt;next
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|block-&gt;next-&gt;prev
op_assign
id|block-&gt;prev
suffix:semicolon
r_if
c_cond
(paren
id|block-&gt;prev
)paren
id|block-&gt;prev-&gt;next
op_assign
id|block-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|block-&gt;name
)paren
id|kfree
c_func
(paren
id|block-&gt;name
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|block
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gf1_mem_look
id|snd_gf1_mem_block_t
op_star
id|snd_gf1_mem_look
c_func
(paren
id|snd_gf1_mem_t
op_star
id|alloc
comma
r_int
r_int
id|address
)paren
(brace
id|snd_gf1_mem_block_t
op_star
id|block
suffix:semicolon
r_for
c_loop
(paren
id|block
op_assign
id|alloc-&gt;first
suffix:semicolon
id|block
suffix:semicolon
id|block
op_assign
id|block-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|block-&gt;ptr
op_eq
id|address
)paren
(brace
r_return
id|block
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|snd_gf1_mem_share
id|snd_gf1_mem_block_t
op_star
id|snd_gf1_mem_share
c_func
(paren
id|snd_gf1_mem_t
op_star
id|alloc
comma
r_int
r_int
op_star
id|share_id
)paren
(brace
id|snd_gf1_mem_block_t
op_star
id|block
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|share_id
(braket
l_int|0
)braket
op_logical_and
op_logical_neg
id|share_id
(braket
l_int|1
)braket
op_logical_and
op_logical_neg
id|share_id
(braket
l_int|2
)braket
op_logical_and
op_logical_neg
id|share_id
(braket
l_int|3
)braket
)paren
r_return
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|block
op_assign
id|alloc-&gt;first
suffix:semicolon
id|block
suffix:semicolon
id|block
op_assign
id|block-&gt;next
)paren
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|share_id
comma
id|block-&gt;share_id
comma
r_sizeof
(paren
id|share_id
)paren
)paren
)paren
r_return
id|block
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|snd_gf1_mem_find
r_static
r_int
id|snd_gf1_mem_find
c_func
(paren
id|snd_gf1_mem_t
op_star
id|alloc
comma
id|snd_gf1_mem_block_t
op_star
id|block
comma
r_int
r_int
id|size
comma
r_int
id|w_16
comma
r_int
id|align
)paren
(brace
id|snd_gf1_bank_info_t
op_star
id|info
op_assign
id|w_16
ques
c_cond
id|alloc-&gt;banks_16
suffix:colon
id|alloc-&gt;banks_8
suffix:semicolon
r_int
r_int
id|idx
comma
id|boundary
suffix:semicolon
r_int
id|size1
suffix:semicolon
id|snd_gf1_mem_block_t
op_star
id|pblock
suffix:semicolon
r_int
r_int
id|ptr1
comma
id|ptr2
suffix:semicolon
id|align
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|w_16
op_logical_and
id|align
OL
l_int|1
)paren
id|align
op_assign
l_int|1
suffix:semicolon
id|block-&gt;flags
op_assign
id|w_16
ques
c_cond
id|SNDRV_GF1_MEM_BLOCK_16BIT
suffix:colon
l_int|0
suffix:semicolon
id|block-&gt;owner
op_assign
id|SNDRV_GF1_MEM_OWNER_DRIVER
suffix:semicolon
id|block-&gt;share
op_assign
l_int|0
suffix:semicolon
id|block-&gt;share_id
(braket
l_int|0
)braket
op_assign
id|block-&gt;share_id
(braket
l_int|1
)braket
op_assign
id|block-&gt;share_id
(braket
l_int|2
)braket
op_assign
id|block-&gt;share_id
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
id|block-&gt;name
op_assign
l_int|NULL
suffix:semicolon
id|block-&gt;prev
op_assign
id|block-&gt;next
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|pblock
op_assign
id|alloc-&gt;first
comma
id|idx
op_assign
l_int|0
suffix:semicolon
id|pblock
suffix:semicolon
id|pblock
op_assign
id|pblock-&gt;next
)paren
(brace
r_while
c_loop
(paren
id|pblock-&gt;ptr
op_ge
(paren
id|boundary
op_assign
id|info
(braket
id|idx
)braket
dot
id|address
op_plus
id|info
(braket
id|idx
)braket
dot
id|size
)paren
)paren
id|idx
op_increment
suffix:semicolon
r_while
c_loop
(paren
id|pblock-&gt;ptr
op_plus
id|pblock-&gt;size
op_ge
(paren
id|boundary
op_assign
id|info
(braket
id|idx
)braket
dot
id|address
op_plus
id|info
(braket
id|idx
)braket
dot
id|size
)paren
)paren
id|idx
op_increment
suffix:semicolon
id|ptr2
op_assign
id|boundary
suffix:semicolon
r_if
c_cond
(paren
id|pblock-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|pblock-&gt;ptr
op_plus
id|pblock-&gt;size
op_eq
id|pblock-&gt;next-&gt;ptr
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|pblock-&gt;next-&gt;ptr
OL
id|boundary
)paren
id|ptr2
op_assign
id|pblock-&gt;next-&gt;ptr
suffix:semicolon
)brace
id|ptr1
op_assign
(paren
id|pblock-&gt;ptr
op_plus
id|pblock-&gt;size
op_plus
id|align
)paren
op_amp
op_complement
id|align
suffix:semicolon
r_if
c_cond
(paren
id|ptr1
op_ge
id|ptr2
)paren
r_continue
suffix:semicolon
id|size1
op_assign
id|ptr2
op_minus
id|ptr1
suffix:semicolon
r_if
c_cond
(paren
id|size
op_le
id|size1
)paren
(brace
id|block-&gt;ptr
op_assign
id|ptr1
suffix:semicolon
id|block-&gt;size
op_assign
id|size
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
op_increment
id|idx
OL
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|size
op_le
id|info
(braket
id|idx
)braket
dot
id|size
)paren
(brace
multiline_comment|/* I assume that bank address is already aligned.. */
id|block-&gt;ptr
op_assign
id|info
(braket
id|idx
)braket
dot
id|address
suffix:semicolon
id|block-&gt;size
op_assign
id|size
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
DECL|function|snd_gf1_mem_alloc
id|snd_gf1_mem_block_t
op_star
id|snd_gf1_mem_alloc
c_func
(paren
id|snd_gf1_mem_t
op_star
id|alloc
comma
r_int
id|owner
comma
r_char
op_star
id|name
comma
r_int
id|size
comma
r_int
id|w_16
comma
r_int
id|align
comma
r_int
r_int
op_star
id|share_id
)paren
(brace
id|snd_gf1_mem_block_t
id|block
comma
op_star
id|nblock
suffix:semicolon
id|snd_gf1_mem_lock
c_func
(paren
id|alloc
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|share_id
op_ne
l_int|NULL
)paren
(brace
id|nblock
op_assign
id|snd_gf1_mem_share
c_func
(paren
id|alloc
comma
id|share_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nblock
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|size
op_ne
id|nblock-&gt;size
)paren
(brace
multiline_comment|/* TODO: remove in the future */
id|snd_printk
c_func
(paren
l_string|&quot;snd_gf1_mem_alloc - share: sizes differ&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|__std
suffix:semicolon
)brace
id|nblock-&gt;share
op_increment
suffix:semicolon
id|snd_gf1_mem_lock
c_func
(paren
id|alloc
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
id|__std
suffix:colon
r_if
c_cond
(paren
id|snd_gf1_mem_find
c_func
(paren
id|alloc
comma
op_amp
id|block
comma
id|size
comma
id|w_16
comma
id|align
)paren
OL
l_int|0
)paren
(brace
id|snd_gf1_mem_lock
c_func
(paren
id|alloc
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|share_id
op_ne
l_int|NULL
)paren
id|memcpy
c_func
(paren
op_amp
id|block.share_id
comma
id|share_id
comma
r_sizeof
(paren
id|block.share_id
)paren
)paren
suffix:semicolon
id|block.owner
op_assign
id|owner
suffix:semicolon
id|block.name
op_assign
id|snd_kmalloc_strdup
c_func
(paren
id|name
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|nblock
op_assign
id|snd_gf1_mem_xalloc
c_func
(paren
id|alloc
comma
op_amp
id|block
)paren
suffix:semicolon
id|snd_gf1_mem_lock
c_func
(paren
id|alloc
comma
l_int|1
)paren
suffix:semicolon
r_return
id|nblock
suffix:semicolon
)brace
DECL|function|snd_gf1_mem_free
r_int
id|snd_gf1_mem_free
c_func
(paren
id|snd_gf1_mem_t
op_star
id|alloc
comma
r_int
r_int
id|address
)paren
(brace
r_int
id|result
suffix:semicolon
id|snd_gf1_mem_block_t
op_star
id|block
suffix:semicolon
id|snd_gf1_mem_lock
c_func
(paren
id|alloc
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|block
op_assign
id|snd_gf1_mem_look
c_func
(paren
id|alloc
comma
id|address
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|result
op_assign
id|snd_gf1_mem_xfree
c_func
(paren
id|alloc
comma
id|block
)paren
suffix:semicolon
id|snd_gf1_mem_lock
c_func
(paren
id|alloc
comma
l_int|1
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
id|snd_gf1_mem_lock
c_func
(paren
id|alloc
comma
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|snd_gf1_mem_init
r_int
id|snd_gf1_mem_init
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
)paren
(brace
id|snd_gf1_mem_t
op_star
id|alloc
suffix:semicolon
id|snd_gf1_mem_block_t
id|block
suffix:semicolon
macro_line|#ifdef CONFIG_SND_DEBUG
id|snd_info_entry_t
op_star
id|entry
suffix:semicolon
macro_line|#endif
id|alloc
op_assign
op_amp
id|gus-&gt;gf1.mem_alloc
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|alloc-&gt;memory_mutex
)paren
suffix:semicolon
id|alloc-&gt;first
op_assign
id|alloc-&gt;last
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gus-&gt;gf1.memory
)paren
r_return
l_int|0
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|block
comma
l_int|0
comma
r_sizeof
(paren
id|block
)paren
)paren
suffix:semicolon
id|block.owner
op_assign
id|SNDRV_GF1_MEM_OWNER_DRIVER
suffix:semicolon
r_if
c_cond
(paren
id|gus-&gt;gf1.enh_mode
)paren
(brace
id|block.ptr
op_assign
l_int|0
suffix:semicolon
id|block.size
op_assign
l_int|1024
suffix:semicolon
id|block.name
op_assign
id|snd_kmalloc_strdup
c_func
(paren
l_string|&quot;InterWave LFOs&quot;
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_gf1_mem_xalloc
c_func
(paren
id|alloc
comma
op_amp
id|block
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|block.ptr
op_assign
id|gus-&gt;gf1.default_voice_address
suffix:semicolon
id|block.size
op_assign
l_int|4
suffix:semicolon
id|block.name
op_assign
id|snd_kmalloc_strdup
c_func
(paren
l_string|&quot;Voice default (NULL&squot;s)&quot;
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_gf1_mem_xalloc
c_func
(paren
id|alloc
comma
op_amp
id|block
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
macro_line|#ifdef CONFIG_SND_DEBUG
id|alloc-&gt;info_entry
op_assign
l_int|NULL
suffix:semicolon
id|entry
op_assign
id|snd_info_create_card_entry
c_func
(paren
id|gus-&gt;card
comma
l_string|&quot;gusmem&quot;
comma
id|gus-&gt;card-&gt;proc_root
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
)paren
(brace
id|entry-&gt;content
op_assign
id|SNDRV_INFO_CONTENT_TEXT
suffix:semicolon
id|entry-&gt;c.text.read_size
op_assign
l_int|256
op_star
l_int|1024
suffix:semicolon
id|entry-&gt;c.text.read
op_assign
id|snd_gf1_mem_info_read
suffix:semicolon
id|entry-&gt;private_data
op_assign
id|gus
suffix:semicolon
r_if
c_cond
(paren
id|snd_info_register
c_func
(paren
id|entry
)paren
OL
l_int|0
)paren
(brace
id|snd_info_free_entry
c_func
(paren
id|entry
)paren
suffix:semicolon
id|entry
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|alloc-&gt;info_entry
op_assign
id|entry
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gf1_mem_done
r_int
id|snd_gf1_mem_done
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
)paren
(brace
id|snd_gf1_mem_t
op_star
id|alloc
suffix:semicolon
id|snd_gf1_mem_block_t
op_star
id|block
comma
op_star
id|nblock
suffix:semicolon
id|alloc
op_assign
op_amp
id|gus-&gt;gf1.mem_alloc
suffix:semicolon
id|block
op_assign
id|alloc-&gt;first
suffix:semicolon
r_while
c_loop
(paren
id|block
)paren
(brace
id|nblock
op_assign
id|block-&gt;next
suffix:semicolon
id|snd_gf1_mem_xfree
c_func
(paren
id|alloc
comma
id|block
)paren
suffix:semicolon
id|block
op_assign
id|nblock
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SND_DEBUG
r_if
c_cond
(paren
id|alloc-&gt;info_entry
)paren
id|snd_info_unregister
c_func
(paren
id|alloc-&gt;info_entry
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SND_DEBUG
DECL|function|snd_gf1_mem_info_read
r_static
r_void
id|snd_gf1_mem_info_read
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|snd_gus_card_t
op_star
id|gus
suffix:semicolon
id|snd_gf1_mem_t
op_star
id|alloc
suffix:semicolon
id|snd_gf1_mem_block_t
op_star
id|block
suffix:semicolon
r_int
r_int
id|total
comma
id|used
suffix:semicolon
r_int
id|i
suffix:semicolon
id|gus
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_gus_card_t
comma
id|entry-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|alloc
op_assign
op_amp
id|gus-&gt;gf1.mem_alloc
suffix:semicolon
id|down
c_func
(paren
op_amp
id|alloc-&gt;memory_mutex
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;8-bit banks       : &bslash;n    &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;0x%06x (%04ik)%s&quot;
comma
id|alloc-&gt;banks_8
(braket
id|i
)braket
dot
id|address
comma
id|alloc-&gt;banks_8
(braket
id|i
)braket
dot
id|size
op_rshift
l_int|10
comma
id|i
op_plus
l_int|1
OL
l_int|4
ques
c_cond
l_string|&quot;,&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n&quot;
l_string|&quot;16-bit banks      : &bslash;n    &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|total
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;0x%06x (%04ik)%s&quot;
comma
id|alloc-&gt;banks_16
(braket
id|i
)braket
dot
id|address
comma
id|alloc-&gt;banks_16
(braket
id|i
)braket
dot
id|size
op_rshift
l_int|10
comma
id|i
op_plus
l_int|1
OL
l_int|4
ques
c_cond
l_string|&quot;,&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|total
op_add_assign
id|alloc-&gt;banks_16
(braket
id|i
)braket
dot
id|size
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|used
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|block
op_assign
id|alloc-&gt;first
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|block
suffix:semicolon
id|block
op_assign
id|block-&gt;next
comma
id|i
op_increment
)paren
(brace
id|used
op_add_assign
id|block-&gt;size
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Block %i at 0x%lx onboard 0x%x size %i (0x%x):&bslash;n&quot;
comma
id|i
comma
(paren
r_int
)paren
id|block
comma
id|block-&gt;ptr
comma
id|block-&gt;size
comma
id|block-&gt;size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|block-&gt;share
op_logical_or
id|block-&gt;share_id
(braket
l_int|0
)braket
op_logical_or
id|block-&gt;share_id
(braket
l_int|1
)braket
op_logical_or
id|block-&gt;share_id
(braket
l_int|2
)braket
op_logical_or
id|block-&gt;share_id
(braket
l_int|3
)braket
)paren
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;  Share           : %i [id0 0x%x] [id1 0x%x] [id2 0x%x] [id3 0x%x]&bslash;n&quot;
comma
id|block-&gt;share
comma
id|block-&gt;share_id
(braket
l_int|0
)braket
comma
id|block-&gt;share_id
(braket
l_int|1
)braket
comma
id|block-&gt;share_id
(braket
l_int|2
)braket
comma
id|block-&gt;share_id
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;  Flags           :%s&bslash;n&quot;
comma
id|block-&gt;flags
op_amp
id|SNDRV_GF1_MEM_BLOCK_16BIT
ques
c_cond
l_string|&quot; 16-bit&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;  Owner           : &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|block-&gt;owner
)paren
(brace
r_case
id|SNDRV_GF1_MEM_OWNER_DRIVER
suffix:colon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;driver - %s&bslash;n&quot;
comma
id|block-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_GF1_MEM_OWNER_WAVE_SIMPLE
suffix:colon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;SIMPLE wave&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_GF1_MEM_OWNER_WAVE_GF1
suffix:colon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;GF1 wave&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_GF1_MEM_OWNER_WAVE_IWFFFF
suffix:colon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;IWFFFF wave&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;unknown&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;  Total: memory = %i, used = %i, free = %i&bslash;n&quot;
comma
id|total
comma
id|used
comma
id|total
op_minus
id|used
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|alloc-&gt;memory_mutex
)paren
suffix:semicolon
macro_line|#if 0
id|ultra_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;  Verify: free = %i, max 8-bit block = %i, max 16-bit block = %i&bslash;n&quot;
comma
id|ultra_memory_free_size
c_func
(paren
id|card
comma
op_amp
id|card-&gt;gf1.mem_alloc
)paren
comma
id|ultra_memory_free_block
c_func
(paren
id|card
comma
op_amp
id|card-&gt;gf1.mem_alloc
comma
l_int|0
)paren
comma
id|ultra_memory_free_block
c_func
(paren
id|card
comma
op_amp
id|card-&gt;gf1.mem_alloc
comma
l_int|1
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif
eof
