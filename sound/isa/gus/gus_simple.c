multiline_comment|/*&n; *  Routines for Gravis UltraSound soundcards - Simple instrument handlers&n; *  Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/gus.h&gt;
macro_line|#include &quot;gus_tables.h&quot;
multiline_comment|/*&n; *&n; */
r_static
r_void
id|interrupt_wave
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|voice
)paren
suffix:semicolon
r_static
r_void
id|interrupt_volume
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|voice
)paren
suffix:semicolon
r_static
r_void
id|interrupt_effect
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|voice
)paren
suffix:semicolon
r_static
r_void
id|sample_start
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|voice
comma
id|snd_seq_position_t
id|position
)paren
suffix:semicolon
r_static
r_void
id|sample_stop
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|voice
comma
id|snd_seq_stop_mode_t
id|mode
)paren
suffix:semicolon
r_static
r_void
id|sample_freq
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|voice
comma
id|snd_seq_frequency_t
id|freq
)paren
suffix:semicolon
r_static
r_void
id|sample_volume
c_func
(paren
id|snd_gus_card_t
op_star
id|card
comma
id|snd_gus_voice_t
op_star
id|voice
comma
id|snd_seq_ev_volume_t
op_star
id|volume
)paren
suffix:semicolon
r_static
r_void
id|sample_loop
c_func
(paren
id|snd_gus_card_t
op_star
id|card
comma
id|snd_gus_voice_t
op_star
id|voice
comma
id|snd_seq_ev_loop_t
op_star
id|loop
)paren
suffix:semicolon
r_static
r_void
id|sample_pos
c_func
(paren
id|snd_gus_card_t
op_star
id|card
comma
id|snd_gus_voice_t
op_star
id|voice
comma
id|snd_seq_position_t
id|position
)paren
suffix:semicolon
r_static
r_void
id|sample_private1
c_func
(paren
id|snd_gus_card_t
op_star
id|card
comma
id|snd_gus_voice_t
op_star
id|voice
comma
r_int
r_char
op_star
id|data
)paren
suffix:semicolon
DECL|variable|sample_ops
r_static
id|snd_gus_sample_ops_t
id|sample_ops
op_assign
(brace
id|sample_start
comma
id|sample_stop
comma
id|sample_freq
comma
id|sample_volume
comma
id|sample_loop
comma
id|sample_pos
comma
id|sample_private1
)brace
suffix:semicolon
macro_line|#if 0
r_static
r_void
id|note_stop
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|voice
comma
r_int
id|wait
)paren
suffix:semicolon
r_static
r_void
id|note_wait
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|voice
)paren
suffix:semicolon
r_static
r_void
id|note_off
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|voice
)paren
suffix:semicolon
r_static
r_void
id|note_volume
c_func
(paren
id|snd_gus_card_t
op_star
id|card
comma
id|snd_gus_voice_t
op_star
id|voice
)paren
suffix:semicolon
r_static
r_void
id|note_pitchbend
c_func
(paren
id|snd_gus_card_t
op_star
id|card
comma
id|snd_gus_voice_t
op_star
id|voice
)paren
suffix:semicolon
r_static
r_void
id|note_vibrato
c_func
(paren
id|snd_gus_card_t
op_star
id|card
comma
id|snd_gus_voice_t
op_star
id|voice
)paren
suffix:semicolon
r_static
r_void
id|note_tremolo
c_func
(paren
id|snd_gus_card_t
op_star
id|card
comma
id|snd_gus_voice_t
op_star
id|voice
)paren
suffix:semicolon
r_static
r_struct
id|snd_gus_note_handlers
id|note_commands
op_assign
(brace
id|note_stop
comma
id|note_wait
comma
id|note_off
comma
id|note_volume
comma
id|note_pitchbend
comma
id|note_vibrato
comma
id|note_tremolo
)brace
suffix:semicolon
r_static
r_void
id|chn_trigger_down
c_func
(paren
id|snd_gus_card_t
op_star
id|card
comma
id|ultra_channel_t
op_star
id|channel
comma
id|ultra_instrument_t
op_star
id|instrument
comma
r_int
r_char
id|note
comma
r_int
r_char
id|velocity
comma
r_int
r_char
id|priority
)paren
suffix:semicolon
r_static
r_void
id|chn_trigger_up
c_func
(paren
id|ultra_card_t
op_star
id|card
comma
id|ultra_note_t
op_star
id|note
)paren
suffix:semicolon
r_static
r_void
id|chn_control
c_func
(paren
id|ultra_card_t
op_star
id|card
comma
id|ultra_channel_t
op_star
id|channel
comma
r_int
r_int
id|p1
comma
r_int
r_int
id|p2
)paren
suffix:semicolon
r_static
r_struct
id|ULTRA_STRU_INSTRUMENT_CHANNEL_COMMANDS
id|channel_commands
op_assign
(brace
id|chn_trigger_down
comma
id|chn_trigger_up
comma
id|chn_control
)brace
suffix:semicolon
macro_line|#endif
r_static
r_void
id|do_volume_envelope
c_func
(paren
id|snd_gus_card_t
op_star
id|card
comma
id|snd_gus_voice_t
op_star
id|voice
)paren
suffix:semicolon
r_static
r_void
id|do_pan_envelope
c_func
(paren
id|snd_gus_card_t
op_star
id|card
comma
id|snd_gus_voice_t
op_star
id|voice
)paren
suffix:semicolon
multiline_comment|/*&n; *&n; */
DECL|function|interrupt_wave
r_static
r_void
id|interrupt_wave
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|voice
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|gus-&gt;event_lock
)paren
suffix:semicolon
id|snd_gf1_stop_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|gus-&gt;reg_lock
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|snd_gf1_write16
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VW_VOLUME
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|gus-&gt;reg_lock
)paren
suffix:semicolon
id|voice-&gt;flags
op_and_assign
op_complement
id|SNDRV_GF1_VFLG_RUNNING
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|gus-&gt;event_lock
)paren
suffix:semicolon
)brace
DECL|function|interrupt_volume
r_static
r_void
id|interrupt_volume
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|voice
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|gus-&gt;event_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;flags
op_amp
id|SNDRV_GF1_VFLG_RUNNING
)paren
id|do_volume_envelope
c_func
(paren
id|gus
comma
id|voice
)paren
suffix:semicolon
r_else
id|snd_gf1_stop_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|gus-&gt;event_lock
)paren
suffix:semicolon
)brace
DECL|function|interrupt_effect
r_static
r_void
id|interrupt_effect
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|voice
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|gus-&gt;event_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|voice-&gt;flags
op_amp
(paren
id|SNDRV_GF1_VFLG_RUNNING
op_or
id|SNDRV_GF1_VFLG_EFFECT_TIMER1
)paren
)paren
op_eq
(paren
id|SNDRV_GF1_VFLG_RUNNING
op_or
id|SNDRV_GF1_VFLG_EFFECT_TIMER1
)paren
)paren
id|do_pan_envelope
c_func
(paren
id|gus
comma
id|voice
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|gus-&gt;event_lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&n; */
DECL|function|do_volume_envelope
r_static
r_void
id|do_volume_envelope
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|voice
)paren
(brace
r_int
r_int
id|next
comma
id|rate
comma
id|old_volume
suffix:semicolon
r_int
id|program_next_ramp
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gus-&gt;gf1.volume_ramp
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|snd_gf1_ctrl_stop
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_CONTROL
)paren
suffix:semicolon
id|snd_gf1_write16
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VW_VOLUME
comma
id|voice-&gt;gf1_volume
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;gf1_volume = 0x%x&bslash;n&quot;
comma
id|voice-&gt;gf1_volume
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|program_next_ramp
op_assign
l_int|0
suffix:semicolon
id|rate
op_assign
id|next
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|program_next_ramp
op_assign
l_int|0
suffix:semicolon
id|rate
op_assign
id|next
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|voice-&gt;venv_state
)paren
(brace
r_case
id|VENV_BEFORE
suffix:colon
id|voice-&gt;venv_state
op_assign
id|VENV_ATTACK
suffix:semicolon
id|voice-&gt;venv_value_next
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|snd_gf1_ctrl_stop
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_CONTROL
)paren
suffix:semicolon
id|snd_gf1_write16
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VW_VOLUME
comma
id|SNDRV_GF1_MIN_VOLUME
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VENV_ATTACK
suffix:colon
id|voice-&gt;venv_state
op_assign
id|VENV_SUSTAIN
suffix:semicolon
id|program_next_ramp
op_increment
suffix:semicolon
id|next
op_assign
l_int|255
suffix:semicolon
id|rate
op_assign
id|gus-&gt;gf1.volume_ramp
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VENV_SUSTAIN
suffix:colon
id|voice-&gt;venv_state
op_assign
id|VENV_RELEASE
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|snd_gf1_ctrl_stop
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_CONTROL
)paren
suffix:semicolon
id|snd_gf1_write16
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VW_VOLUME
comma
(paren
(paren
r_int
)paren
id|voice-&gt;gf1_volume
op_star
(paren
r_int
)paren
id|voice-&gt;venv_value_next
)paren
op_div
l_int|255
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|VENV_RELEASE
suffix:colon
id|voice-&gt;venv_state
op_assign
id|VENV_DONE
suffix:semicolon
id|program_next_ramp
op_increment
suffix:semicolon
id|next
op_assign
l_int|0
suffix:semicolon
id|rate
op_assign
id|gus-&gt;gf1.volume_ramp
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VENV_DONE
suffix:colon
id|snd_gf1_stop_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|voice-&gt;flags
op_and_assign
op_complement
id|SNDRV_GF1_VFLG_RUNNING
suffix:semicolon
r_return
suffix:semicolon
r_case
id|VENV_VOLUME
suffix:colon
id|program_next_ramp
op_increment
suffix:semicolon
id|next
op_assign
id|voice-&gt;venv_value_next
suffix:semicolon
id|rate
op_assign
id|gus-&gt;gf1.volume_ramp
suffix:semicolon
id|voice-&gt;venv_state
op_assign
id|voice-&gt;venv_state_prev
suffix:semicolon
r_break
suffix:semicolon
)brace
id|voice-&gt;venv_value_next
op_assign
id|next
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|program_next_ramp
)paren
r_continue
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|snd_gf1_ctrl_stop
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_CONTROL
)paren
suffix:semicolon
id|old_volume
op_assign
id|snd_gf1_read16
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VW_VOLUME
)paren
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rate
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|next
op_assign
(paren
(paren
(paren
r_int
)paren
id|voice-&gt;gf1_volume
op_star
(paren
r_int
)paren
id|next
)paren
op_div
l_int|255
)paren
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|old_volume
OL
id|SNDRV_GF1_MIN_OFFSET
)paren
id|old_volume
op_assign
id|SNDRV_GF1_MIN_OFFSET
suffix:semicolon
r_if
c_cond
(paren
id|next
OL
id|SNDRV_GF1_MIN_OFFSET
)paren
id|next
op_assign
id|SNDRV_GF1_MIN_OFFSET
suffix:semicolon
r_if
c_cond
(paren
id|next
OG
id|SNDRV_GF1_MAX_OFFSET
)paren
id|next
op_assign
id|SNDRV_GF1_MAX_OFFSET
suffix:semicolon
r_if
c_cond
(paren
id|old_volume
op_eq
id|next
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|voice-&gt;volume_control
op_and_assign
op_complement
l_int|0xc3
suffix:semicolon
id|voice-&gt;volume_control
op_or_assign
l_int|0x20
suffix:semicolon
r_if
c_cond
(paren
id|old_volume
OG
id|next
)paren
(brace
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_START
comma
id|next
)paren
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_END
comma
id|old_volume
)paren
suffix:semicolon
id|voice-&gt;volume_control
op_or_assign
l_int|0x40
suffix:semicolon
)brace
r_else
(brace
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_START
comma
id|old_volume
)paren
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_END
comma
id|next
)paren
suffix:semicolon
)brace
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_RATE
comma
id|rate
)paren
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_CONTROL
comma
id|voice-&gt;volume_control
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gus-&gt;gf1.enh_mode
)paren
(brace
id|snd_gf1_delay
c_func
(paren
id|gus
)paren
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_CONTROL
comma
id|voice-&gt;volume_control
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
DECL|function|do_pan_envelope
r_static
r_void
id|do_pan_envelope
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|voice
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|old_pan
suffix:semicolon
macro_line|#if 0
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; -%i- do_pan_envelope - flags = 0x%x (0x%x -&gt; 0x%x)&bslash;n&quot;
comma
id|voice-&gt;number
comma
id|voice-&gt;flags
comma
id|voice-&gt;gf1_pan
comma
id|snd_gf1_i_read8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_PAN
)paren
op_amp
l_int|0x0f
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|gus-&gt;gf1.enh_mode
)paren
(brace
id|voice-&gt;flags
op_and_assign
op_complement
(paren
id|SNDRV_GF1_VFLG_EFFECT_TIMER1
op_or
id|SNDRV_GF1_VFLG_PAN
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|gus-&gt;gf1.smooth_pan
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_PAN
comma
id|voice-&gt;gf1_pan
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|voice-&gt;flags
op_amp
id|SNDRV_GF1_VFLG_PAN
)paren
)paren
multiline_comment|/* before */
id|voice-&gt;flags
op_or_assign
id|SNDRV_GF1_VFLG_EFFECT_TIMER1
op_or
id|SNDRV_GF1_VFLG_PAN
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|old_pan
op_assign
id|snd_gf1_read8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_PAN
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|old_pan
OG
id|voice-&gt;gf1_pan
)paren
id|old_pan
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|old_pan
OL
id|voice-&gt;gf1_pan
)paren
id|old_pan
op_increment
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_PAN
comma
id|old_pan
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|old_pan
op_eq
id|voice-&gt;gf1_pan
)paren
multiline_comment|/* the goal was reached */
id|voice-&gt;flags
op_and_assign
op_complement
(paren
id|SNDRV_GF1_VFLG_EFFECT_TIMER1
op_or
id|SNDRV_GF1_VFLG_PAN
)paren
suffix:semicolon
macro_line|#if 0
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; -%i- (1) do_pan_envelope - flags = 0x%x (0x%x -&gt; 0x%x)&bslash;n&quot;
comma
id|voice-&gt;number
comma
id|voice-&gt;flags
comma
id|voice-&gt;gf1_pan
comma
id|snd_gf1_i_read8
c_func
(paren
id|gus
comma
id|GF1_VB_PAN
)paren
op_amp
l_int|0x0f
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|set_enhanced_pan
r_static
r_void
id|set_enhanced_pan
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|voice
comma
r_int
r_int
id|pan
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|vlo
comma
id|vro
suffix:semicolon
id|vlo
op_assign
id|SNDRV_GF1_ATTEN
c_func
(paren
(paren
id|SNDRV_GF1_ATTEN_TABLE_SIZE
op_minus
l_int|1
)paren
op_minus
id|pan
)paren
suffix:semicolon
id|vro
op_assign
id|SNDRV_GF1_ATTEN
c_func
(paren
id|pan
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pan
op_ne
id|SNDRV_GF1_ATTEN_TABLE_SIZE
op_minus
l_int|1
op_logical_and
id|pan
op_ne
l_int|0
)paren
(brace
id|vlo
op_rshift_assign
l_int|1
suffix:semicolon
id|vro
op_rshift_assign
l_int|1
suffix:semicolon
)brace
id|vlo
op_lshift_assign
l_int|4
suffix:semicolon
id|vro
op_lshift_assign
l_int|4
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;vlo = 0x%x (0x%x), vro = 0x%x (0x%x)&bslash;n&quot;
comma
id|vlo
comma
id|snd_gf1_i_read16
c_func
(paren
id|gus
comma
id|GF1_VW_OFFSET_LEFT
)paren
comma
id|vro
comma
id|snd_gf1_i_read16
c_func
(paren
id|gus
comma
id|GF1_VW_OFFSET_RIGHT
)paren
)paren
suffix:semicolon
macro_line|#endif
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|snd_gf1_write16
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VW_OFFSET_LEFT_FINAL
comma
id|vlo
)paren
suffix:semicolon
id|snd_gf1_write16
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VW_OFFSET_RIGHT_FINAL
comma
id|vro
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|voice-&gt;vlo
op_assign
id|vlo
suffix:semicolon
id|voice-&gt;vro
op_assign
id|vro
suffix:semicolon
)brace
multiline_comment|/*&n; *&n; */
DECL|function|sample_start
r_static
r_void
id|sample_start
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|voice
comma
id|snd_seq_position_t
id|position
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|begin
comma
id|addr
comma
id|addr_end
comma
id|addr_start
suffix:semicolon
r_int
id|w_16
suffix:semicolon
id|simple_instrument_t
op_star
id|simple
suffix:semicolon
id|snd_seq_kinstr_t
op_star
id|instr
suffix:semicolon
id|instr
op_assign
id|snd_seq_instr_find
c_func
(paren
id|gus-&gt;gf1.ilist
comma
op_amp
id|voice-&gt;instr
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|instr
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|voice-&gt;instr
op_assign
id|instr-&gt;instr
suffix:semicolon
multiline_comment|/* copy ID to speedup aliases */
id|simple
op_assign
id|KINSTR_DATA
c_func
(paren
id|instr
)paren
suffix:semicolon
id|begin
op_assign
id|simple-&gt;address.memory
op_lshift
l_int|4
suffix:semicolon
id|w_16
op_assign
id|simple-&gt;format
op_amp
id|SIMPLE_WAVE_16BIT
ques
c_cond
l_int|0x04
suffix:colon
l_int|0
suffix:semicolon
id|addr_start
op_assign
id|simple-&gt;loop_start
suffix:semicolon
r_if
c_cond
(paren
id|simple-&gt;format
op_amp
id|SIMPLE_WAVE_LOOP
)paren
(brace
id|addr_end
op_assign
id|simple-&gt;loop_end
suffix:semicolon
)brace
r_else
(brace
id|addr_end
op_assign
(paren
id|simple-&gt;size
op_lshift
l_int|4
)paren
op_minus
(paren
id|w_16
ques
c_cond
l_int|40
suffix:colon
l_int|24
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|simple-&gt;format
op_amp
id|SIMPLE_WAVE_BACKWARD
)paren
(brace
id|addr
op_assign
id|simple-&gt;loop_end
suffix:semicolon
r_if
c_cond
(paren
id|position
OL
id|simple-&gt;loop_end
)paren
id|addr
op_sub_assign
id|position
suffix:semicolon
)brace
r_else
(brace
id|addr
op_assign
id|position
suffix:semicolon
)brace
id|voice-&gt;control
op_assign
l_int|0x00
suffix:semicolon
id|voice-&gt;mode
op_assign
l_int|0x20
suffix:semicolon
multiline_comment|/* enable offset registers */
r_if
c_cond
(paren
id|simple-&gt;format
op_amp
id|SIMPLE_WAVE_16BIT
)paren
id|voice-&gt;control
op_or_assign
l_int|0x04
suffix:semicolon
r_if
c_cond
(paren
id|simple-&gt;format
op_amp
id|SIMPLE_WAVE_BACKWARD
)paren
id|voice-&gt;control
op_or_assign
l_int|0x40
suffix:semicolon
r_if
c_cond
(paren
id|simple-&gt;format
op_amp
id|SIMPLE_WAVE_LOOP
)paren
(brace
id|voice-&gt;control
op_or_assign
l_int|0x08
suffix:semicolon
)brace
r_else
(brace
id|voice-&gt;control
op_or_assign
l_int|0x20
suffix:semicolon
)brace
r_if
c_cond
(paren
id|simple-&gt;format
op_amp
id|SIMPLE_WAVE_BIDIR
)paren
id|voice-&gt;control
op_or_assign
l_int|0x10
suffix:semicolon
r_if
c_cond
(paren
id|simple-&gt;format
op_amp
id|SIMPLE_WAVE_ULAW
)paren
id|voice-&gt;mode
op_or_assign
l_int|0x40
suffix:semicolon
r_if
c_cond
(paren
id|w_16
)paren
(brace
id|addr
op_assign
(paren
(paren
id|addr
op_lshift
l_int|1
)paren
op_amp
op_complement
l_int|0x1f
)paren
op_or
(paren
id|addr
op_amp
l_int|0x0f
)paren
suffix:semicolon
id|addr_start
op_assign
(paren
(paren
id|addr_start
op_lshift
l_int|1
)paren
op_amp
op_complement
l_int|0x1f
)paren
op_or
(paren
id|addr_start
op_amp
l_int|0x0f
)paren
suffix:semicolon
id|addr_end
op_assign
(paren
(paren
id|addr_end
op_lshift
l_int|1
)paren
op_amp
op_complement
l_int|0x1f
)paren
op_or
(paren
id|addr_end
op_amp
l_int|0x0f
)paren
suffix:semicolon
)brace
id|addr
op_add_assign
id|begin
suffix:semicolon
id|addr_start
op_add_assign
id|begin
suffix:semicolon
id|addr_end
op_add_assign
id|begin
suffix:semicolon
id|snd_gf1_stop_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|snd_gf1_write16
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VW_FREQUENCY
comma
id|voice-&gt;fc_register
op_plus
id|voice-&gt;fc_lfo
)paren
suffix:semicolon
id|voice-&gt;venv_state
op_assign
id|VENV_BEFORE
suffix:semicolon
id|voice-&gt;volume_control
op_assign
l_int|0x03
suffix:semicolon
id|snd_gf1_write_addr
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VA_START
comma
id|addr_start
comma
id|w_16
)paren
suffix:semicolon
id|snd_gf1_write_addr
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VA_END
comma
id|addr_end
comma
id|w_16
)paren
suffix:semicolon
id|snd_gf1_write_addr
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VA_CURRENT
comma
id|addr
comma
id|w_16
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gus-&gt;gf1.enh_mode
)paren
(brace
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_PAN
comma
id|voice-&gt;gf1_pan
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_gf1_write16
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VW_OFFSET_LEFT
comma
id|voice-&gt;vlo
)paren
suffix:semicolon
id|snd_gf1_write16
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VW_OFFSET_LEFT_FINAL
comma
id|voice-&gt;vlo
)paren
suffix:semicolon
id|snd_gf1_write16
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VW_OFFSET_RIGHT
comma
id|voice-&gt;vro
)paren
suffix:semicolon
id|snd_gf1_write16
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VW_OFFSET_RIGHT_FINAL
comma
id|voice-&gt;vro
)paren
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_ACCUMULATOR
comma
id|voice-&gt;effect_accumulator
)paren
suffix:semicolon
id|snd_gf1_write16
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VW_EFFECT_VOLUME
comma
id|voice-&gt;gf1_effect_volume
)paren
suffix:semicolon
id|snd_gf1_write16
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VW_EFFECT_VOLUME_FINAL
comma
id|voice-&gt;gf1_effect_volume
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|do_volume_envelope
c_func
(paren
id|gus
comma
id|voice
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gus-&gt;gf1.enh_mode
)paren
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_MODE
comma
id|voice-&gt;mode
)paren
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_ADDRESS_CONTROL
comma
id|voice-&gt;control
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gus-&gt;gf1.enh_mode
)paren
(brace
id|snd_gf1_delay
c_func
(paren
id|gus
)paren
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_ADDRESS_CONTROL
comma
id|voice-&gt;control
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
macro_line|#if 0
id|snd_gf1_print_voice_registers
c_func
(paren
id|gus
)paren
suffix:semicolon
macro_line|#endif
id|voice-&gt;flags
op_or_assign
id|SNDRV_GF1_VFLG_RUNNING
suffix:semicolon
id|snd_seq_instr_free_use
c_func
(paren
id|gus-&gt;gf1.ilist
comma
id|instr
)paren
suffix:semicolon
)brace
DECL|function|sample_stop
r_static
r_void
id|sample_stop
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|voice
comma
id|snd_seq_stop_mode_t
id|mode
)paren
(brace
r_int
r_char
id|control
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|voice-&gt;flags
op_amp
id|SNDRV_GF1_VFLG_RUNNING
)paren
)paren
r_return
suffix:semicolon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|gus-&gt;gf1.volume_ramp
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|voice-&gt;venv_state
OL
id|VENV_RELEASE
)paren
(brace
id|voice-&gt;venv_state
op_assign
id|VENV_RELEASE
suffix:semicolon
id|do_volume_envelope
c_func
(paren
id|gus
comma
id|voice
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|mode
op_ne
id|SAMPLE_STOP_VENVELOPE
)paren
(brace
id|snd_gf1_stop_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|snd_gf1_write16
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VW_VOLUME
comma
id|SNDRV_GF1_MIN_VOLUME
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|voice-&gt;flags
op_and_assign
op_complement
id|SNDRV_GF1_VFLG_RUNNING
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SAMPLE_STOP_LOOP
suffix:colon
multiline_comment|/* disable loop only */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|control
op_assign
id|snd_gf1_read8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_ADDRESS_CONTROL
)paren
suffix:semicolon
id|control
op_and_assign
op_complement
(paren
l_int|0x83
op_or
l_int|0x04
)paren
suffix:semicolon
id|control
op_or_assign
l_int|0x20
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_ADDRESS_CONTROL
comma
id|control
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|sample_freq
r_static
r_void
id|sample_freq
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|voice
comma
id|snd_seq_frequency_t
id|freq
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|voice-&gt;fc_register
op_assign
id|snd_gf1_translate_freq
c_func
(paren
id|gus
comma
id|freq
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|snd_gf1_write16
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VW_FREQUENCY
comma
id|voice-&gt;fc_register
op_plus
id|voice-&gt;fc_lfo
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|sample_volume
r_static
r_void
id|sample_volume
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|voice
comma
id|snd_seq_ev_volume_t
op_star
id|volume
)paren
(brace
r_if
c_cond
(paren
id|volume-&gt;volume
op_ge
l_int|0
)paren
(brace
id|volume-&gt;volume
op_and_assign
l_int|0x3fff
suffix:semicolon
id|voice-&gt;gf1_volume
op_assign
id|snd_gf1_lvol_to_gvol_raw
c_func
(paren
id|volume-&gt;volume
op_lshift
l_int|2
)paren
op_lshift
l_int|4
suffix:semicolon
id|voice-&gt;venv_state_prev
op_assign
id|VENV_SUSTAIN
suffix:semicolon
id|voice-&gt;venv_state
op_assign
id|VENV_VOLUME
suffix:semicolon
id|do_volume_envelope
c_func
(paren
id|gus
comma
id|voice
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|volume-&gt;lr
op_ge
l_int|0
)paren
(brace
id|volume-&gt;lr
op_and_assign
l_int|0x3fff
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gus-&gt;gf1.enh_mode
)paren
(brace
id|voice-&gt;gf1_pan
op_assign
(paren
id|volume-&gt;lr
op_rshift
l_int|10
)paren
op_amp
l_int|15
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gus-&gt;gf1.full_range_pan
)paren
(brace
r_if
c_cond
(paren
id|voice-&gt;gf1_pan
op_eq
l_int|0
)paren
id|voice-&gt;gf1_pan
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;gf1_pan
op_eq
l_int|15
)paren
id|voice-&gt;gf1_pan
op_decrement
suffix:semicolon
)brace
id|voice-&gt;flags
op_and_assign
op_complement
id|SNDRV_GF1_VFLG_PAN
suffix:semicolon
multiline_comment|/* before */
id|do_pan_envelope
c_func
(paren
id|gus
comma
id|voice
)paren
suffix:semicolon
)brace
r_else
(brace
id|set_enhanced_pan
c_func
(paren
id|gus
comma
id|voice
comma
id|volume-&gt;lr
op_rshift
l_int|7
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|sample_loop
r_static
r_void
id|sample_loop
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|voice
comma
id|snd_seq_ev_loop_t
op_star
id|loop
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|w_16
op_assign
id|voice-&gt;control
op_amp
l_int|0x04
suffix:semicolon
r_int
r_int
id|begin
comma
id|addr_start
comma
id|addr_end
suffix:semicolon
id|simple_instrument_t
op_star
id|simple
suffix:semicolon
id|snd_seq_kinstr_t
op_star
id|instr
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;voice_loop: start = 0x%x, end = 0x%x&bslash;n&quot;
comma
id|loop-&gt;start
comma
id|loop-&gt;end
)paren
suffix:semicolon
macro_line|#endif
id|instr
op_assign
id|snd_seq_instr_find
c_func
(paren
id|gus-&gt;gf1.ilist
comma
op_amp
id|voice-&gt;instr
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|instr
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|voice-&gt;instr
op_assign
id|instr-&gt;instr
suffix:semicolon
multiline_comment|/* copy ID to speedup aliases */
id|simple
op_assign
id|KINSTR_DATA
c_func
(paren
id|instr
)paren
suffix:semicolon
id|begin
op_assign
id|simple-&gt;address.memory
suffix:semicolon
id|addr_start
op_assign
id|loop-&gt;start
suffix:semicolon
id|addr_end
op_assign
id|loop-&gt;end
suffix:semicolon
id|addr_start
op_assign
(paren
(paren
(paren
id|addr_start
op_lshift
l_int|1
)paren
op_amp
op_complement
l_int|0x1f
)paren
op_or
(paren
id|addr_start
op_amp
l_int|0x0f
)paren
)paren
op_plus
id|begin
suffix:semicolon
id|addr_end
op_assign
(paren
(paren
(paren
id|addr_end
op_lshift
l_int|1
)paren
op_amp
op_complement
l_int|0x1f
)paren
op_or
(paren
id|addr_end
op_amp
l_int|0x0f
)paren
)paren
op_plus
id|begin
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|snd_gf1_write_addr
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VA_START
comma
id|addr_start
comma
id|w_16
)paren
suffix:semicolon
id|snd_gf1_write_addr
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VA_END
comma
id|addr_end
comma
id|w_16
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_seq_instr_free_use
c_func
(paren
id|gus-&gt;gf1.ilist
comma
id|instr
)paren
suffix:semicolon
)brace
DECL|function|sample_pos
r_static
r_void
id|sample_pos
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|voice
comma
id|snd_seq_position_t
id|position
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|w_16
op_assign
id|voice-&gt;control
op_amp
l_int|0x04
suffix:semicolon
r_int
r_int
id|begin
comma
id|addr
suffix:semicolon
id|simple_instrument_t
op_star
id|simple
suffix:semicolon
id|snd_seq_kinstr_t
op_star
id|instr
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;voice_loop: start = 0x%x, end = 0x%x&bslash;n&quot;
comma
id|loop-&gt;start
comma
id|loop-&gt;end
)paren
suffix:semicolon
macro_line|#endif
id|instr
op_assign
id|snd_seq_instr_find
c_func
(paren
id|gus-&gt;gf1.ilist
comma
op_amp
id|voice-&gt;instr
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|instr
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|voice-&gt;instr
op_assign
id|instr-&gt;instr
suffix:semicolon
multiline_comment|/* copy ID to speedup aliases */
id|simple
op_assign
id|KINSTR_DATA
c_func
(paren
id|instr
)paren
suffix:semicolon
id|begin
op_assign
id|simple-&gt;address.memory
suffix:semicolon
id|addr
op_assign
(paren
(paren
(paren
id|position
op_lshift
l_int|1
)paren
op_amp
op_complement
l_int|0x1f
)paren
op_or
(paren
id|position
op_amp
l_int|0x0f
)paren
)paren
op_plus
id|begin
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|snd_gf1_write_addr
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VA_CURRENT
comma
id|addr
comma
id|w_16
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_seq_instr_free_use
c_func
(paren
id|gus-&gt;gf1.ilist
comma
id|instr
)paren
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_int
r_char
id|get_effects_mask
c_func
(paren
id|ultra_card_t
op_star
id|card
comma
r_int
id|value
)paren
(brace
r_if
c_cond
(paren
id|value
OG
l_int|7
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|card
op_member_access_from_pointer
id|gf1.effects
op_logical_and
id|card
op_member_access_from_pointer
id|gf1.effects
op_member_access_from_pointer
id|chip_type
op_eq
id|ULTRA_EFFECT_CHIP_INTERWAVE
)paren
r_return
id|card
op_member_access_from_pointer
id|gf1.effects
op_member_access_from_pointer
id|chip.interwave.voice_output
(braket
id|value
)braket
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|function|sample_private1
r_static
r_void
id|sample_private1
c_func
(paren
id|snd_gus_card_t
op_star
id|card
comma
id|snd_gus_voice_t
op_star
id|voice
comma
r_int
r_char
op_star
id|data
)paren
(brace
macro_line|#if 0
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|uc
suffix:semicolon
r_switch
c_cond
(paren
op_star
id|data
)paren
(brace
r_case
id|ULTRA_PRIV1_IW_EFFECT
suffix:colon
id|uc
op_assign
id|get_effects_mask
c_func
(paren
id|card
comma
id|ultra_get_byte
c_func
(paren
id|data
comma
l_int|4
)paren
)paren
suffix:semicolon
id|uc
op_or_assign
id|get_effects_mask
c_func
(paren
id|card
comma
id|ultra_get_byte
c_func
(paren
id|data
comma
l_int|4
)paren
op_rshift
l_int|4
)paren
suffix:semicolon
id|uc
op_or_assign
id|get_effects_mask
c_func
(paren
id|card
comma
id|ultra_get_byte
c_func
(paren
id|data
comma
l_int|5
)paren
)paren
suffix:semicolon
id|uc
op_or_assign
id|get_effects_mask
c_func
(paren
id|card
comma
id|ultra_get_byte
c_func
(paren
id|data
comma
l_int|5
)paren
op_rshift
l_int|4
)paren
suffix:semicolon
id|voice
op_member_access_from_pointer
id|data.simple.effect_accumulator
op_assign
id|uc
suffix:semicolon
id|voice
op_member_access_from_pointer
id|data.simple.effect_volume
op_assign
id|ultra_translate_voice_volume
c_func
(paren
id|card
comma
id|ultra_get_word
c_func
(paren
id|data
comma
l_int|2
)paren
)paren
op_lshift
l_int|4
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
op_member_access_from_pointer
id|gf1.enh_mode
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|voice
op_member_access_from_pointer
id|flags
op_amp
id|VFLG_WAIT_FOR_START
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|voice
op_member_access_from_pointer
id|flags
op_amp
id|VFLG_RUNNING
)paren
(brace
id|CLI
c_func
(paren
op_amp
id|flags
)paren
suffix:semicolon
id|gf1_select_voice
c_func
(paren
id|card
comma
id|voice
op_member_access_from_pointer
id|number
)paren
suffix:semicolon
id|ultra_write8
c_func
(paren
id|card
comma
id|GF1_VB_ACCUMULATOR
comma
id|voice
op_member_access_from_pointer
id|data.simple.effect_accumulator
)paren
suffix:semicolon
id|ultra_write16
c_func
(paren
id|card
comma
id|GF1_VW_EFFECT_VOLUME_FINAL
comma
id|voice
op_member_access_from_pointer
id|data.simple.effect_volume
)paren
suffix:semicolon
id|STI
c_func
(paren
op_amp
id|flags
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ULTRA_PRIV1_IW_LFO
suffix:colon
id|ultra_lfo_command
c_func
(paren
id|card
comma
id|voice
op_member_access_from_pointer
id|number
comma
id|data
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
macro_line|#if 0
multiline_comment|/*&n; *&n; */
r_static
r_void
id|note_stop
c_func
(paren
id|ultra_card_t
op_star
id|card
comma
id|ultra_voice_t
op_star
id|voice
comma
r_int
id|wait
)paren
(brace
)brace
r_static
r_void
id|note_wait
c_func
(paren
id|ultra_card_t
op_star
id|card
comma
id|ultra_voice_t
op_star
id|voice
)paren
(brace
)brace
r_static
r_void
id|note_off
c_func
(paren
id|ultra_card_t
op_star
id|card
comma
id|ultra_voice_t
op_star
id|voice
)paren
(brace
)brace
r_static
r_void
id|note_volume
c_func
(paren
id|ultra_card_t
op_star
id|card
comma
id|ultra_voice_t
op_star
id|voice
)paren
(brace
)brace
r_static
r_void
id|note_pitchbend
c_func
(paren
id|ultra_card_t
op_star
id|card
comma
id|ultra_voice_t
op_star
id|voice
)paren
(brace
)brace
r_static
r_void
id|note_vibrato
c_func
(paren
id|ultra_card_t
op_star
id|card
comma
id|ultra_voice_t
op_star
id|voice
)paren
(brace
)brace
r_static
r_void
id|note_tremolo
c_func
(paren
id|ultra_card_t
op_star
id|card
comma
id|ultra_voice_t
op_star
id|voice
)paren
(brace
)brace
multiline_comment|/*&n; *&n; */
r_static
r_void
id|chn_trigger_down
c_func
(paren
id|ultra_card_t
op_star
id|card
comma
id|ultra_channel_t
op_star
id|channel
comma
id|ultra_instrument_t
op_star
id|instrument
comma
r_int
r_char
id|note
comma
r_int
r_char
id|velocity
comma
r_int
r_char
id|priority
)paren
(brace
)brace
r_static
r_void
id|chn_trigger_up
c_func
(paren
id|ultra_card_t
op_star
id|card
comma
id|ultra_note_t
op_star
id|note
)paren
(brace
)brace
r_static
r_void
id|chn_control
c_func
(paren
id|ultra_card_t
op_star
id|card
comma
id|ultra_channel_t
op_star
id|channel
comma
r_int
r_int
id|p1
comma
r_int
r_int
id|p2
)paren
(brace
)brace
multiline_comment|/*&n; *&n; */
macro_line|#endif
DECL|function|snd_gf1_simple_init
r_void
id|snd_gf1_simple_init
c_func
(paren
id|snd_gus_voice_t
op_star
id|voice
)paren
(brace
id|voice-&gt;handler_wave
op_assign
id|interrupt_wave
suffix:semicolon
id|voice-&gt;handler_volume
op_assign
id|interrupt_volume
suffix:semicolon
id|voice-&gt;handler_effect
op_assign
id|interrupt_effect
suffix:semicolon
id|voice-&gt;volume_change
op_assign
l_int|NULL
suffix:semicolon
id|voice-&gt;sample_ops
op_assign
op_amp
id|sample_ops
suffix:semicolon
)brace
eof
