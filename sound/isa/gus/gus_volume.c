multiline_comment|/*&n; *  Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;linux/time.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/gus.h&gt;
DECL|macro|__GUS_TABLES_ALLOC__
mdefine_line|#define __GUS_TABLES_ALLOC__
macro_line|#include &quot;gus_tables.h&quot;
DECL|variable|snd_gf1_atten_table
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_atten_table
)paren
suffix:semicolon
multiline_comment|/* for snd-gus-synth module */
DECL|function|snd_gf1_lvol_to_gvol_raw
r_int
r_int
id|snd_gf1_lvol_to_gvol_raw
c_func
(paren
r_int
r_int
id|vol
)paren
(brace
r_int
r_int
id|e
comma
id|m
comma
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|vol
OG
l_int|65535
)paren
id|vol
op_assign
l_int|65535
suffix:semicolon
id|tmp
op_assign
id|vol
suffix:semicolon
id|e
op_assign
l_int|7
suffix:semicolon
r_if
c_cond
(paren
id|tmp
OL
l_int|128
)paren
(brace
r_while
c_loop
(paren
id|e
OG
l_int|0
op_logical_and
id|tmp
OL
(paren
l_int|1
op_lshift
id|e
)paren
)paren
id|e
op_decrement
suffix:semicolon
)brace
r_else
(brace
r_while
c_loop
(paren
id|tmp
OG
l_int|255
)paren
(brace
id|tmp
op_rshift_assign
l_int|1
suffix:semicolon
id|e
op_increment
suffix:semicolon
)brace
)brace
id|m
op_assign
id|vol
op_minus
(paren
l_int|1
op_lshift
id|e
)paren
suffix:semicolon
r_if
c_cond
(paren
id|m
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|e
OG
l_int|8
)paren
id|m
op_rshift_assign
id|e
op_minus
l_int|8
suffix:semicolon
r_else
r_if
c_cond
(paren
id|e
OL
l_int|8
)paren
id|m
op_lshift_assign
l_int|8
op_minus
id|e
suffix:semicolon
id|m
op_and_assign
l_int|255
suffix:semicolon
)brace
r_return
(paren
id|e
op_lshift
l_int|8
)paren
op_or
id|m
suffix:semicolon
)brace
DECL|function|snd_gf1_gvol_to_lvol_raw
r_int
r_int
id|snd_gf1_gvol_to_lvol_raw
c_func
(paren
r_int
r_int
id|gf1_vol
)paren
(brace
r_int
r_int
id|rvol
suffix:semicolon
r_int
r_int
id|e
comma
id|m
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gf1_vol
)paren
r_return
l_int|0
suffix:semicolon
id|e
op_assign
id|gf1_vol
op_rshift
l_int|8
suffix:semicolon
id|m
op_assign
(paren
r_int
r_char
)paren
id|gf1_vol
suffix:semicolon
id|rvol
op_assign
l_int|1
op_lshift
id|e
suffix:semicolon
r_if
c_cond
(paren
id|e
OG
l_int|8
)paren
r_return
id|rvol
op_or
(paren
id|m
op_lshift
(paren
id|e
op_minus
l_int|8
)paren
)paren
suffix:semicolon
r_return
id|rvol
op_or
(paren
id|m
op_rshift
(paren
l_int|8
op_minus
id|e
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_gf1_calc_ramp_rate
r_int
r_int
id|snd_gf1_calc_ramp_rate
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
r_int
r_int
id|start
comma
r_int
r_int
id|end
comma
r_int
r_int
id|us
)paren
(brace
r_static
r_int
r_char
id|vol_rates
(braket
l_int|19
)braket
op_assign
(brace
l_int|23
comma
l_int|24
comma
l_int|26
comma
l_int|28
comma
l_int|29
comma
l_int|31
comma
l_int|32
comma
l_int|34
comma
l_int|36
comma
l_int|37
comma
l_int|39
comma
l_int|40
comma
l_int|42
comma
l_int|44
comma
l_int|45
comma
l_int|47
comma
l_int|49
comma
l_int|50
comma
l_int|52
)brace
suffix:semicolon
r_int
r_int
id|range
comma
id|increment
comma
id|value
comma
id|i
suffix:semicolon
id|start
op_rshift_assign
l_int|4
suffix:semicolon
id|end
op_rshift_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|start
OL
id|end
)paren
id|us
op_div_assign
id|end
op_minus
id|start
suffix:semicolon
r_else
id|us
op_div_assign
id|start
op_minus
id|end
suffix:semicolon
id|range
op_assign
l_int|4
suffix:semicolon
id|value
op_assign
id|gus-&gt;gf1.enh_mode
ques
c_cond
id|vol_rates
(braket
l_int|0
)braket
suffix:colon
id|vol_rates
(braket
id|gus-&gt;gf1.active_voices
op_minus
l_int|14
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|us
OL
id|value
)paren
(brace
id|range
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
id|value
op_lshift_assign
l_int|3
suffix:semicolon
)brace
r_if
c_cond
(paren
id|range
op_eq
l_int|4
)paren
(brace
id|range
op_assign
l_int|3
suffix:semicolon
id|increment
op_assign
l_int|1
suffix:semicolon
)brace
r_else
id|increment
op_assign
(paren
id|value
op_plus
(paren
id|value
op_rshift
l_int|1
)paren
)paren
op_div
id|us
suffix:semicolon
r_return
(paren
id|range
op_lshift
l_int|6
)paren
op_or
(paren
id|increment
op_amp
l_int|0x3f
)paren
suffix:semicolon
)brace
DECL|function|snd_gf1_translate_freq
r_int
r_int
id|snd_gf1_translate_freq
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
r_int
r_int
id|freq16
)paren
(brace
id|freq16
op_rshift_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|freq16
OL
l_int|50
)paren
id|freq16
op_assign
l_int|50
suffix:semicolon
r_if
c_cond
(paren
id|freq16
op_amp
l_int|0xf8000000
)paren
(brace
id|freq16
op_assign
op_complement
l_int|0xf8000000
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;snd_gf1_translate_freq: overflow - freq = 0x%x&bslash;n&quot;
comma
id|freq16
)paren
suffix:semicolon
)brace
r_return
(paren
(paren
id|freq16
op_lshift
l_int|9
)paren
op_plus
(paren
id|gus-&gt;gf1.playback_freq
op_rshift
l_int|1
)paren
)paren
op_div
id|gus-&gt;gf1.playback_freq
suffix:semicolon
)brace
DECL|function|snd_gf1_compute_vibrato
r_int
id|snd_gf1_compute_vibrato
c_func
(paren
r_int
id|cents
comma
r_int
r_int
id|fc_register
)paren
(brace
r_static
r_int
id|vibrato_table
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|32
comma
l_int|592
comma
l_int|61
comma
l_int|1175
comma
l_int|93
comma
l_int|1808
comma
l_int|124
comma
l_int|2433
comma
l_int|152
comma
l_int|3007
comma
l_int|182
comma
l_int|3632
comma
l_int|213
comma
l_int|4290
comma
l_int|241
comma
l_int|4834
comma
l_int|255
comma
l_int|5200
)brace
suffix:semicolon
r_int
id|depth
suffix:semicolon
r_int
op_star
id|vi1
comma
op_star
id|vi2
comma
id|pcents
comma
id|v1
suffix:semicolon
id|pcents
op_assign
id|cents
OL
l_int|0
ques
c_cond
op_minus
id|cents
suffix:colon
id|cents
suffix:semicolon
r_for
c_loop
(paren
id|vi1
op_assign
id|vibrato_table
comma
id|vi2
op_assign
id|vi1
op_plus
l_int|2
suffix:semicolon
id|pcents
OG
op_star
id|vi2
suffix:semicolon
id|vi1
op_assign
id|vi2
comma
id|vi2
op_add_assign
l_int|2
)paren
suffix:semicolon
id|v1
op_assign
op_star
(paren
id|vi1
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* The FC table above is a list of pairs. The first number in the pair     */
multiline_comment|/* is the cents index from 0-255 cents, and the second number in the       */
multiline_comment|/* pair is the FC adjustment needed to change the pitch by the indexed     */
multiline_comment|/* number of cents. The table was created for an FC of 32768.              */
multiline_comment|/* The following expression does a linear interpolation against the        */
multiline_comment|/* approximated log curve in the table above, and then scales the number   */
multiline_comment|/* by the FC before the LFO. This calculation also adjusts the output      */
multiline_comment|/* value to produce the appropriate depth for the hardware. The depth      */
multiline_comment|/* is 2 * desired FC + 1.                                                  */
id|depth
op_assign
(paren
(paren
(paren
r_int
)paren
(paren
op_star
(paren
id|vi2
op_plus
l_int|1
)paren
op_minus
op_star
id|vi1
)paren
op_star
(paren
id|pcents
op_minus
op_star
id|vi1
)paren
op_div
(paren
op_star
id|vi2
op_minus
op_star
id|vi1
)paren
)paren
op_plus
id|v1
)paren
op_star
id|fc_register
op_rshift
l_int|14
suffix:semicolon
r_if
c_cond
(paren
id|depth
)paren
id|depth
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|depth
OG
l_int|255
)paren
id|depth
op_assign
l_int|255
suffix:semicolon
r_return
id|cents
OL
l_int|0
ques
c_cond
op_minus
(paren
r_int
)paren
id|depth
suffix:colon
(paren
r_int
)paren
id|depth
suffix:semicolon
)brace
DECL|function|snd_gf1_compute_pitchbend
r_int
r_int
id|snd_gf1_compute_pitchbend
c_func
(paren
r_int
r_int
id|pitchbend
comma
r_int
r_int
id|sens
)paren
(brace
r_static
r_int
id|log_table
(braket
)braket
op_assign
(brace
l_int|1024
comma
l_int|1085
comma
l_int|1149
comma
l_int|1218
comma
l_int|1290
comma
l_int|1367
comma
l_int|1448
comma
l_int|1534
comma
l_int|1625
comma
l_int|1722
comma
l_int|1825
comma
l_int|1933
)brace
suffix:semicolon
r_int
id|wheel
comma
id|sensitivity
suffix:semicolon
r_int
r_int
id|mantissa
comma
id|f1
comma
id|f2
suffix:semicolon
r_int
r_int
id|semitones
comma
id|f1_index
comma
id|f2_index
comma
id|f1_power
comma
id|f2_power
suffix:semicolon
r_char
id|bend_down
op_assign
l_int|0
suffix:semicolon
r_int
id|bend
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sens
)paren
r_return
l_int|1024
suffix:semicolon
id|wheel
op_assign
(paren
r_int
)paren
id|pitchbend
op_minus
l_int|8192
suffix:semicolon
id|sensitivity
op_assign
(paren
(paren
r_int
)paren
id|sens
op_star
id|wheel
)paren
op_div
l_int|128
suffix:semicolon
r_if
c_cond
(paren
id|sensitivity
OL
l_int|0
)paren
(brace
id|bend_down
op_assign
l_int|1
suffix:semicolon
id|sensitivity
op_assign
op_minus
id|sensitivity
suffix:semicolon
)brace
id|semitones
op_assign
(paren
r_int
r_int
)paren
(paren
id|sensitivity
op_rshift
l_int|13
)paren
suffix:semicolon
id|mantissa
op_assign
id|sensitivity
op_mod
l_int|8192
suffix:semicolon
id|f1_index
op_assign
id|semitones
op_mod
l_int|12
suffix:semicolon
id|f2_index
op_assign
(paren
id|semitones
op_plus
l_int|1
)paren
op_mod
l_int|12
suffix:semicolon
id|f1_power
op_assign
id|semitones
op_div
l_int|12
suffix:semicolon
id|f2_power
op_assign
(paren
id|semitones
op_plus
l_int|1
)paren
op_div
l_int|12
suffix:semicolon
id|f1
op_assign
id|log_table
(braket
id|f1_index
)braket
op_lshift
id|f1_power
suffix:semicolon
id|f2
op_assign
id|log_table
(braket
id|f2_index
)braket
op_lshift
id|f2_power
suffix:semicolon
id|bend
op_assign
(paren
r_int
)paren
(paren
(paren
(paren
(paren
id|f2
op_minus
id|f1
)paren
op_star
id|mantissa
)paren
op_rshift
l_int|13
)paren
op_plus
id|f1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bend_down
)paren
id|bend
op_assign
l_int|1048576L
op_div
id|bend
suffix:semicolon
r_return
id|bend
suffix:semicolon
)brace
DECL|function|snd_gf1_compute_freq
r_int
r_int
id|snd_gf1_compute_freq
c_func
(paren
r_int
r_int
id|freq
comma
r_int
r_int
id|rate
comma
r_int
r_int
id|mix_rate
)paren
(brace
r_int
r_int
id|fc
suffix:semicolon
r_int
id|scale
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|freq
op_ge
l_int|4194304L
)paren
(brace
id|scale
op_increment
suffix:semicolon
id|freq
op_rshift_assign
l_int|1
suffix:semicolon
)brace
id|fc
op_assign
(paren
id|freq
op_lshift
l_int|10
)paren
op_div
id|rate
suffix:semicolon
r_if
c_cond
(paren
id|fc
OG
l_int|97391L
)paren
(brace
id|fc
op_assign
l_int|97391
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;patch: (1) fc frequency overflow - %u&bslash;n&quot;
comma
id|fc
)paren
suffix:semicolon
)brace
id|fc
op_assign
(paren
id|fc
op_star
l_int|44100UL
)paren
op_div
id|mix_rate
suffix:semicolon
r_while
c_loop
(paren
id|scale
op_decrement
)paren
id|fc
op_lshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|fc
OG
l_int|65535L
)paren
(brace
id|fc
op_assign
l_int|65535
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;patch: (2) fc frequency overflow - %u&bslash;n&quot;
comma
id|fc
)paren
suffix:semicolon
)brace
r_return
(paren
r_int
r_int
)paren
id|fc
suffix:semicolon
)brace
eof
