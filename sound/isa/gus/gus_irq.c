multiline_comment|/*&n; *  Routine for IRQ handling from GF1/InterWave chip&n; *  Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#include &lt;sound/gus.h&gt;
macro_line|#ifdef CONFIG_SND_DEBUG
DECL|macro|STAT_ADD
mdefine_line|#define STAT_ADD(x)&t;((x)++)
macro_line|#else
DECL|macro|STAT_ADD
mdefine_line|#define STAT_ADD(x)&t;while (0) { ; }
macro_line|#endif
DECL|function|snd_gus_interrupt
r_void
id|snd_gus_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|snd_gus_card_t
op_star
id|gus
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_gus_card_t
comma
id|dev_id
comma
r_return
)paren
suffix:semicolon
r_int
r_char
id|status
suffix:semicolon
r_int
id|loop
op_assign
l_int|100
suffix:semicolon
id|__again
suffix:colon
id|status
op_assign
id|inb
c_func
(paren
id|gus-&gt;gf1.reg_irqstat
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
l_int|0
)paren
r_return
suffix:semicolon
singleline_comment|// snd_printk(&quot;IRQ: status = 0x%x&bslash;n&quot;, status);
r_if
c_cond
(paren
id|status
op_amp
l_int|0x02
)paren
(brace
id|STAT_ADD
c_func
(paren
id|gus-&gt;gf1.interrupt_stat_midi_in
)paren
suffix:semicolon
id|gus-&gt;gf1
dot
id|interrupt_handler_midi_in
c_func
(paren
id|gus
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
l_int|0x01
)paren
(brace
id|STAT_ADD
c_func
(paren
id|gus-&gt;gf1.interrupt_stat_midi_out
)paren
suffix:semicolon
id|gus-&gt;gf1
dot
id|interrupt_handler_midi_out
c_func
(paren
id|gus
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
(paren
l_int|0x20
op_or
l_int|0x40
)paren
)paren
(brace
r_int
r_int
id|already
comma
id|_current_
suffix:semicolon
r_int
r_char
id|voice_status
comma
id|voice
suffix:semicolon
id|snd_gus_voice_t
op_star
id|pvoice
suffix:semicolon
id|already
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
(paren
id|voice_status
op_assign
id|snd_gf1_i_read8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_GB_VOICES_IRQ
)paren
)paren
op_amp
l_int|0xc0
)paren
op_ne
l_int|0xc0
)paren
(brace
id|voice
op_assign
id|voice_status
op_amp
l_int|0x1f
suffix:semicolon
id|_current_
op_assign
l_int|1
op_lshift
id|voice
suffix:semicolon
r_if
c_cond
(paren
id|already
op_amp
id|_current_
)paren
r_continue
suffix:semicolon
multiline_comment|/* multi request */
id|already
op_or_assign
id|_current_
suffix:semicolon
multiline_comment|/* mark request */
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;voice = %i, voice_status = 0x%x, voice_verify = %i&bslash;n&quot;
comma
id|voice
comma
id|voice_status
comma
id|inb
c_func
(paren
id|GUSP
c_func
(paren
id|gus
comma
id|GF1PAGE
)paren
)paren
)paren
suffix:semicolon
macro_line|#endif
id|pvoice
op_assign
op_amp
id|gus-&gt;gf1.voices
(braket
id|voice
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pvoice-&gt;use
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|voice_status
op_amp
l_int|0x80
)paren
)paren
(brace
multiline_comment|/* voice position IRQ */
id|STAT_ADD
c_func
(paren
id|pvoice-&gt;interrupt_stat_wave
)paren
suffix:semicolon
id|pvoice
op_member_access_from_pointer
id|handler_wave
c_func
(paren
id|gus
comma
id|pvoice
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|voice_status
op_amp
l_int|0x40
)paren
)paren
(brace
multiline_comment|/* volume ramp IRQ */
id|STAT_ADD
c_func
(paren
id|pvoice-&gt;interrupt_stat_volume
)paren
suffix:semicolon
id|pvoice
op_member_access_from_pointer
id|handler_volume
c_func
(paren
id|gus
comma
id|pvoice
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|STAT_ADD
c_func
(paren
id|gus-&gt;gf1.interrupt_stat_voice_lost
)paren
suffix:semicolon
id|snd_gf1_i_ctrl_stop
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_ADDRESS_CONTROL
)paren
suffix:semicolon
id|snd_gf1_i_ctrl_stop
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_CONTROL
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|status
op_amp
l_int|0x04
)paren
(brace
id|STAT_ADD
c_func
(paren
id|gus-&gt;gf1.interrupt_stat_timer1
)paren
suffix:semicolon
id|gus-&gt;gf1
dot
id|interrupt_handler_timer1
c_func
(paren
id|gus
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
l_int|0x08
)paren
(brace
id|STAT_ADD
c_func
(paren
id|gus-&gt;gf1.interrupt_stat_timer2
)paren
suffix:semicolon
id|gus-&gt;gf1
dot
id|interrupt_handler_timer2
c_func
(paren
id|gus
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
l_int|0x80
)paren
(brace
r_if
c_cond
(paren
id|snd_gf1_i_look8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_GB_DRAM_DMA_CONTROL
)paren
op_amp
l_int|0x40
)paren
(brace
id|STAT_ADD
c_func
(paren
id|gus-&gt;gf1.interrupt_stat_dma_write
)paren
suffix:semicolon
id|gus-&gt;gf1
dot
id|interrupt_handler_dma_write
c_func
(paren
id|gus
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|snd_gf1_i_look8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_GB_REC_DMA_CONTROL
)paren
op_amp
l_int|0x40
)paren
(brace
id|STAT_ADD
c_func
(paren
id|gus-&gt;gf1.interrupt_stat_dma_read
)paren
suffix:semicolon
id|gus-&gt;gf1
dot
id|interrupt_handler_dma_read
c_func
(paren
id|gus
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_decrement
id|loop
OG
l_int|0
)paren
r_goto
id|__again
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SND_DEBUG
DECL|function|snd_gus_irq_info_read
r_static
r_void
id|snd_gus_irq_info_read
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|snd_gus_card_t
op_star
id|gus
suffix:semicolon
id|snd_gus_voice_t
op_star
id|pvoice
suffix:semicolon
r_int
id|idx
suffix:semicolon
id|gus
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_gus_card_t
comma
id|entry-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;midi out = %u&bslash;n&quot;
comma
id|gus-&gt;gf1.interrupt_stat_midi_out
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;midi in = %u&bslash;n&quot;
comma
id|gus-&gt;gf1.interrupt_stat_midi_in
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;timer1 = %u&bslash;n&quot;
comma
id|gus-&gt;gf1.interrupt_stat_timer1
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;timer2 = %u&bslash;n&quot;
comma
id|gus-&gt;gf1.interrupt_stat_timer2
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;dma write = %u&bslash;n&quot;
comma
id|gus-&gt;gf1.interrupt_stat_dma_write
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;dma read = %u&bslash;n&quot;
comma
id|gus-&gt;gf1.interrupt_stat_dma_read
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;voice lost = %u&bslash;n&quot;
comma
id|gus-&gt;gf1.interrupt_stat_voice_lost
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|32
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|pvoice
op_assign
op_amp
id|gus-&gt;gf1.voices
(braket
id|idx
)braket
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;voice %i: wave = %u, volume = %u&bslash;n&quot;
comma
id|idx
comma
id|pvoice-&gt;interrupt_stat_wave
comma
id|pvoice-&gt;interrupt_stat_volume
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_gus_irq_profile_init
r_void
id|snd_gus_irq_profile_init
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
)paren
(brace
id|snd_info_entry_t
op_star
id|entry
suffix:semicolon
id|gus-&gt;irq_entry
op_assign
l_int|NULL
suffix:semicolon
id|entry
op_assign
id|snd_info_create_card_entry
c_func
(paren
id|gus-&gt;card
comma
l_string|&quot;gusirq&quot;
comma
id|gus-&gt;card-&gt;proc_root
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
)paren
(brace
id|entry-&gt;content
op_assign
id|SNDRV_INFO_CONTENT_TEXT
suffix:semicolon
id|entry-&gt;c.text.read_size
op_assign
l_int|512
suffix:semicolon
id|entry-&gt;c.text.read
op_assign
id|snd_gus_irq_info_read
suffix:semicolon
id|entry-&gt;private_data
op_assign
id|gus
suffix:semicolon
r_if
c_cond
(paren
id|snd_info_register
c_func
(paren
id|entry
)paren
OL
l_int|0
)paren
(brace
id|snd_info_free_entry
c_func
(paren
id|entry
)paren
suffix:semicolon
id|entry
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|gus-&gt;irq_entry
op_assign
id|entry
suffix:semicolon
)brace
DECL|function|snd_gus_irq_profile_done
r_void
id|snd_gus_irq_profile_done
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
)paren
(brace
r_if
c_cond
(paren
id|gus-&gt;irq_entry
)paren
(brace
id|snd_info_unregister
c_func
(paren
id|gus-&gt;irq_entry
)paren
suffix:semicolon
id|gus-&gt;irq_entry
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
macro_line|#endif
eof
