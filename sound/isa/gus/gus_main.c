multiline_comment|/*&n; *  Routines for Gravis UltraSound soundcards&n; *  Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/gus.h&gt;
macro_line|#include &lt;sound/control.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jaroslav Kysela &lt;perex@suse.cz&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Routines for Gravis UltraSound soundcards&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|macro|chip_t
mdefine_line|#define chip_t snd_gus_card_t
r_static
r_int
id|snd_gus_init_dma_irq
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
r_int
id|latches
)paren
suffix:semicolon
DECL|function|snd_gus_use_inc
r_int
id|snd_gus_use_inc
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
)paren
(brace
id|MOD_INC_USE_COUNT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|try_module_get
c_func
(paren
id|gus-&gt;card-&gt;module
)paren
)paren
(brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|snd_gus_use_dec
r_void
id|snd_gus_use_dec
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
)paren
(brace
id|module_put
c_func
(paren
id|gus-&gt;card-&gt;module
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
DECL|function|snd_gus_joystick_info
r_static
r_int
id|snd_gus_joystick_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|31
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gus_joystick_get
r_static
r_int
id|snd_gus_joystick_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|snd_gus_card_t
op_star
id|gus
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|gus-&gt;joystick_dac
op_amp
l_int|31
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gus_joystick_put
r_static
r_int
id|snd_gus_joystick_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|snd_gus_card_t
op_star
id|gus
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|change
suffix:semicolon
r_int
r_char
id|nval
suffix:semicolon
id|nval
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|31
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|change
op_assign
id|gus-&gt;joystick_dac
op_ne
id|nval
suffix:semicolon
id|gus-&gt;joystick_dac
op_assign
id|nval
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_GB_JOYSTICK_DAC_LEVEL
comma
id|gus-&gt;joystick_dac
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|snd_gus_joystick_control
r_static
id|snd_kcontrol_new_t
id|snd_gus_joystick_control
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_CARD
comma
dot
id|name
op_assign
l_string|&quot;Joystick Speed&quot;
comma
dot
id|info
op_assign
id|snd_gus_joystick_info
comma
dot
id|get
op_assign
id|snd_gus_joystick_get
comma
dot
id|put
op_assign
id|snd_gus_joystick_put
)brace
suffix:semicolon
DECL|function|snd_gus_init_control
r_static
r_void
id|snd_gus_init_control
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|gus-&gt;ace_flag
)paren
id|snd_ctl_add
c_func
(paren
id|gus-&gt;card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_gus_joystick_control
comma
id|gus
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&n; */
DECL|function|snd_gus_free
r_static
r_int
id|snd_gus_free
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
)paren
(brace
r_if
c_cond
(paren
id|gus-&gt;gf1.res_port2
op_eq
l_int|NULL
)paren
r_goto
id|__hw_end
suffix:semicolon
macro_line|#if defined(CONFIG_SND_SEQUENCER) || defined(CONFIG_SND_SEQUENCER_MODULE)
r_if
c_cond
(paren
id|gus-&gt;seq_dev
)paren
(brace
id|snd_device_free
c_func
(paren
id|gus-&gt;card
comma
id|gus-&gt;seq_dev
)paren
suffix:semicolon
id|gus-&gt;seq_dev
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif
id|snd_gf1_stop
c_func
(paren
id|gus
)paren
suffix:semicolon
id|snd_gus_init_dma_irq
c_func
(paren
id|gus
comma
l_int|0
)paren
suffix:semicolon
id|__hw_end
suffix:colon
r_if
c_cond
(paren
id|gus-&gt;gf1.res_port1
)paren
(brace
id|release_resource
c_func
(paren
id|gus-&gt;gf1.res_port1
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|gus-&gt;gf1.res_port1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|gus-&gt;gf1.res_port2
)paren
(brace
id|release_resource
c_func
(paren
id|gus-&gt;gf1.res_port2
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|gus-&gt;gf1.res_port2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|gus-&gt;gf1.irq
op_ge
l_int|0
)paren
id|free_irq
c_func
(paren
id|gus-&gt;gf1.irq
comma
(paren
r_void
op_star
)paren
id|gus
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gus-&gt;gf1.dma1
op_ge
l_int|0
)paren
(brace
id|disable_dma
c_func
(paren
id|gus-&gt;gf1.dma1
)paren
suffix:semicolon
id|free_dma
c_func
(paren
id|gus-&gt;gf1.dma1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|gus-&gt;equal_dma
op_logical_and
id|gus-&gt;gf1.dma2
op_ge
l_int|0
)paren
(brace
id|disable_dma
c_func
(paren
id|gus-&gt;gf1.dma2
)paren
suffix:semicolon
id|free_dma
c_func
(paren
id|gus-&gt;gf1.dma2
)paren
suffix:semicolon
)brace
id|snd_magic_kfree
c_func
(paren
id|gus
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gus_dev_free
r_static
r_int
id|snd_gus_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|snd_gus_card_t
op_star
id|gus
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_gus_card_t
comma
id|device-&gt;device_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_return
id|snd_gus_free
c_func
(paren
id|gus
)paren
suffix:semicolon
)brace
DECL|function|snd_gus_create
r_int
id|snd_gus_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_int
r_int
id|port
comma
r_int
id|irq
comma
r_int
id|dma1
comma
r_int
id|dma2
comma
r_int
id|timer_dev
comma
r_int
id|voices
comma
r_int
id|pcm_channels
comma
r_int
id|effect
comma
id|snd_gus_card_t
op_star
op_star
id|rgus
)paren
(brace
id|snd_gus_card_t
op_star
id|gus
suffix:semicolon
r_int
id|err
suffix:semicolon
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
dot
id|dev_free
op_assign
id|snd_gus_dev_free
comma
)brace
suffix:semicolon
op_star
id|rgus
op_assign
l_int|NULL
suffix:semicolon
id|gus
op_assign
id|snd_magic_kcalloc
c_func
(paren
id|snd_gus_card_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gus
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|gus-&gt;gf1.irq
op_assign
op_minus
l_int|1
suffix:semicolon
id|gus-&gt;gf1.dma1
op_assign
op_minus
l_int|1
suffix:semicolon
id|gus-&gt;gf1.dma2
op_assign
op_minus
l_int|1
suffix:semicolon
id|gus-&gt;card
op_assign
id|card
suffix:semicolon
id|gus-&gt;gf1.port
op_assign
id|port
suffix:semicolon
multiline_comment|/* fill register variables for speedup */
id|gus-&gt;gf1.reg_page
op_assign
id|GUSP
c_func
(paren
id|gus
comma
id|GF1PAGE
)paren
suffix:semicolon
id|gus-&gt;gf1.reg_regsel
op_assign
id|GUSP
c_func
(paren
id|gus
comma
id|GF1REGSEL
)paren
suffix:semicolon
id|gus-&gt;gf1.reg_data8
op_assign
id|GUSP
c_func
(paren
id|gus
comma
id|GF1DATAHIGH
)paren
suffix:semicolon
id|gus-&gt;gf1.reg_data16
op_assign
id|GUSP
c_func
(paren
id|gus
comma
id|GF1DATALOW
)paren
suffix:semicolon
id|gus-&gt;gf1.reg_irqstat
op_assign
id|GUSP
c_func
(paren
id|gus
comma
id|IRQSTAT
)paren
suffix:semicolon
id|gus-&gt;gf1.reg_dram
op_assign
id|GUSP
c_func
(paren
id|gus
comma
id|DRAM
)paren
suffix:semicolon
id|gus-&gt;gf1.reg_timerctrl
op_assign
id|GUSP
c_func
(paren
id|gus
comma
id|TIMERCNTRL
)paren
suffix:semicolon
id|gus-&gt;gf1.reg_timerdata
op_assign
id|GUSP
c_func
(paren
id|gus
comma
id|TIMERDATA
)paren
suffix:semicolon
multiline_comment|/* allocate resources */
r_if
c_cond
(paren
(paren
id|gus-&gt;gf1.res_port1
op_assign
id|request_region
c_func
(paren
id|port
comma
l_int|16
comma
l_string|&quot;GUS GF1 (Adlib/SB)&quot;
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_gus_free
c_func
(paren
id|gus
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|gus-&gt;gf1.res_port2
op_assign
id|request_region
c_func
(paren
id|port
op_plus
l_int|0x100
comma
l_int|12
comma
l_string|&quot;GUS GF1 (Synth)&quot;
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_gus_free
c_func
(paren
id|gus
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irq
op_ge
l_int|0
op_logical_and
id|request_irq
c_func
(paren
id|irq
comma
id|snd_gus_interrupt
comma
id|SA_INTERRUPT
comma
l_string|&quot;GUS GF1&quot;
comma
(paren
r_void
op_star
)paren
id|gus
)paren
)paren
(brace
id|snd_gus_free
c_func
(paren
id|gus
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|gus-&gt;gf1.irq
op_assign
id|irq
suffix:semicolon
r_if
c_cond
(paren
id|request_dma
c_func
(paren
id|dma1
comma
l_string|&quot;GUS - 1&quot;
)paren
)paren
(brace
id|snd_gus_free
c_func
(paren
id|gus
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|gus-&gt;gf1.dma1
op_assign
id|dma1
suffix:semicolon
r_if
c_cond
(paren
id|dma2
op_ge
l_int|0
op_logical_and
id|dma1
op_ne
id|dma2
)paren
(brace
r_if
c_cond
(paren
id|request_dma
c_func
(paren
id|dma2
comma
l_string|&quot;GUS - 2&quot;
)paren
)paren
(brace
id|snd_gus_free
c_func
(paren
id|gus
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|gus-&gt;gf1.dma2
op_assign
id|dma2
suffix:semicolon
)brace
r_else
(brace
id|gus-&gt;gf1.dma2
op_assign
id|gus-&gt;gf1.dma1
suffix:semicolon
id|gus-&gt;equal_dma
op_assign
l_int|1
suffix:semicolon
)brace
id|gus-&gt;timer_dev
op_assign
id|timer_dev
suffix:semicolon
r_if
c_cond
(paren
id|voices
OL
l_int|14
)paren
id|voices
op_assign
l_int|14
suffix:semicolon
r_if
c_cond
(paren
id|voices
OG
l_int|32
)paren
id|voices
op_assign
l_int|32
suffix:semicolon
r_if
c_cond
(paren
id|pcm_channels
OL
l_int|0
)paren
id|pcm_channels
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|pcm_channels
OG
l_int|8
)paren
id|pcm_channels
op_assign
l_int|8
suffix:semicolon
id|pcm_channels
op_increment
suffix:semicolon
id|pcm_channels
op_and_assign
op_complement
l_int|1
suffix:semicolon
id|gus-&gt;gf1.effect
op_assign
id|effect
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|gus-&gt;gf1.active_voices
op_assign
id|voices
suffix:semicolon
id|gus-&gt;gf1.pcm_channels
op_assign
id|pcm_channels
suffix:semicolon
id|gus-&gt;gf1.volume_ramp
op_assign
l_int|25
suffix:semicolon
id|gus-&gt;gf1.smooth_pan
op_assign
l_int|1
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|gus-&gt;reg_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|gus-&gt;voice_alloc
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|gus-&gt;active_voice_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|gus-&gt;event_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|gus-&gt;dma_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|gus-&gt;pcm_volume_level_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|gus-&gt;uart_cmd_lock
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|gus-&gt;dma_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|gus
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_gus_free
c_func
(paren
id|gus
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
op_star
id|rgus
op_assign
id|gus
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Memory detection routine for plain GF1 soundcards&n; */
DECL|function|snd_gus_detect_memory
r_static
r_int
id|snd_gus_detect_memory
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
)paren
(brace
r_int
id|l
comma
id|idx
comma
id|local
suffix:semicolon
r_int
r_char
id|d
suffix:semicolon
id|snd_gf1_poke
c_func
(paren
id|gus
comma
l_int|0L
comma
l_int|0xaa
)paren
suffix:semicolon
id|snd_gf1_poke
c_func
(paren
id|gus
comma
l_int|1L
comma
l_int|0x55
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_gf1_peek
c_func
(paren
id|gus
comma
l_int|0L
)paren
op_ne
l_int|0xaa
op_logical_or
id|snd_gf1_peek
c_func
(paren
id|gus
comma
l_int|1L
)paren
op_ne
l_int|0x55
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;plain GF1 card at 0x%lx without onboard DRAM?&bslash;n&quot;
comma
id|gus-&gt;gf1.port
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|1
comma
id|d
op_assign
l_int|0xab
suffix:semicolon
id|idx
OL
l_int|4
suffix:semicolon
id|idx
op_increment
comma
id|d
op_increment
)paren
(brace
id|local
op_assign
id|idx
op_lshift
l_int|18
suffix:semicolon
id|snd_gf1_poke
c_func
(paren
id|gus
comma
id|local
comma
id|d
)paren
suffix:semicolon
id|snd_gf1_poke
c_func
(paren
id|gus
comma
id|local
op_plus
l_int|1
comma
id|d
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_gf1_peek
c_func
(paren
id|gus
comma
id|local
)paren
op_ne
id|d
op_logical_or
id|snd_gf1_peek
c_func
(paren
id|gus
comma
id|local
op_plus
l_int|1
)paren
op_ne
id|d
op_plus
l_int|1
op_logical_or
id|snd_gf1_peek
c_func
(paren
id|gus
comma
l_int|0L
)paren
op_ne
l_int|0xaa
)paren
r_break
suffix:semicolon
)brace
macro_line|#if 1
id|gus-&gt;gf1.memory
op_assign
id|idx
op_lshift
l_int|18
suffix:semicolon
macro_line|#else
id|gus-&gt;gf1.memory
op_assign
l_int|256
op_star
l_int|1024
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|l
op_assign
l_int|0
comma
id|local
op_assign
id|gus-&gt;gf1.memory
suffix:semicolon
id|l
OL
l_int|4
suffix:semicolon
id|l
op_increment
comma
id|local
op_sub_assign
l_int|256
op_star
l_int|1024
)paren
(brace
id|gus-&gt;gf1.mem_alloc.banks_8
(braket
id|l
)braket
dot
id|address
op_assign
id|gus-&gt;gf1.mem_alloc.banks_8
(braket
id|l
)braket
dot
id|size
op_assign
l_int|0
suffix:semicolon
id|gus-&gt;gf1.mem_alloc.banks_16
(braket
id|l
)braket
dot
id|address
op_assign
id|l
op_lshift
l_int|18
suffix:semicolon
id|gus-&gt;gf1.mem_alloc.banks_16
(braket
id|l
)braket
dot
id|size
op_assign
id|local
OG
l_int|0
ques
c_cond
l_int|256
op_star
l_int|1024
suffix:colon
l_int|0
suffix:semicolon
)brace
id|gus-&gt;gf1.mem_alloc.banks_8
(braket
l_int|0
)braket
dot
id|size
op_assign
id|gus-&gt;gf1.memory
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* some memory were detected */
)brace
DECL|function|snd_gus_init_dma_irq
r_static
r_int
id|snd_gus_init_dma_irq
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
r_int
id|latches
)paren
(brace
id|snd_card_t
op_star
id|card
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|irq
comma
id|dma1
comma
id|dma2
suffix:semicolon
r_static
r_int
r_char
id|irqs
(braket
l_int|16
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|3
comma
l_int|0
comma
l_int|2
comma
l_int|0
comma
l_int|4
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|5
comma
l_int|6
comma
l_int|0
comma
l_int|0
comma
l_int|7
)brace
suffix:semicolon
r_static
r_int
r_char
id|dmas
(braket
l_int|8
)braket
op_assign
(brace
l_int|6
comma
l_int|1
comma
l_int|0
comma
l_int|2
comma
l_int|0
comma
l_int|3
comma
l_int|4
comma
l_int|5
)brace
suffix:semicolon
id|snd_assert
c_func
(paren
id|gus
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|card
op_assign
id|gus-&gt;card
suffix:semicolon
id|snd_assert
c_func
(paren
id|card
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|gus-&gt;mix_cntrl_reg
op_and_assign
l_int|0xf8
suffix:semicolon
id|gus-&gt;mix_cntrl_reg
op_or_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* disable MIC, LINE IN, enable LINE OUT */
r_if
c_cond
(paren
id|gus-&gt;codec_flag
op_logical_or
id|gus-&gt;ess_flag
)paren
(brace
id|gus-&gt;mix_cntrl_reg
op_and_assign
op_complement
l_int|1
suffix:semicolon
multiline_comment|/* enable LINE IN */
id|gus-&gt;mix_cntrl_reg
op_or_assign
l_int|4
suffix:semicolon
multiline_comment|/* enable MIC */
)brace
id|dma1
op_assign
id|gus-&gt;gf1.dma1
suffix:semicolon
id|dma1
op_assign
id|dma1
OL
l_int|0
ques
c_cond
op_minus
id|dma1
suffix:colon
id|dma1
suffix:semicolon
id|dma1
op_assign
id|dmas
(braket
id|dma1
op_amp
l_int|7
)braket
suffix:semicolon
id|dma2
op_assign
id|gus-&gt;gf1.dma2
suffix:semicolon
id|dma2
op_assign
id|dma2
OL
l_int|0
ques
c_cond
op_minus
id|dma2
suffix:colon
id|dma2
suffix:semicolon
id|dma2
op_assign
id|dmas
(braket
id|dma2
op_amp
l_int|7
)braket
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;dma1 = %i, dma2 = %i&bslash;n&quot;
comma
id|gus-&gt;gf1.dma1
comma
id|gus-&gt;gf1.dma2
)paren
suffix:semicolon
macro_line|#endif
id|dma1
op_or_assign
id|gus-&gt;equal_dma
ques
c_cond
l_int|0x40
suffix:colon
(paren
id|dma2
op_lshift
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dma1
op_amp
l_int|7
)paren
op_eq
l_int|0
op_logical_or
(paren
id|dma2
op_amp
l_int|7
)paren
op_eq
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;Error! DMA isn&squot;t defined.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|irq
op_assign
id|gus-&gt;gf1.irq
suffix:semicolon
id|irq
op_assign
id|irq
OL
l_int|0
ques
c_cond
op_minus
id|irq
suffix:colon
id|irq
suffix:semicolon
id|irq
op_assign
id|irqs
(braket
id|irq
op_amp
l_int|0x0f
)braket
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_eq
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;Error! IRQ isn&squot;t defined.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|irq
op_or_assign
l_int|0x40
suffix:semicolon
macro_line|#if 0
id|card-&gt;mixer.mix_ctrl_reg
op_or_assign
l_int|0x10
suffix:semicolon
macro_line|#endif
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|5
comma
id|GUSP
c_func
(paren
id|gus
comma
id|REGCNTRLS
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|gus-&gt;mix_cntrl_reg
comma
id|GUSP
c_func
(paren
id|gus
comma
id|MIXCNTRLREG
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|GUSP
c_func
(paren
id|gus
comma
id|IRQDMACNTRLREG
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|GUSP
c_func
(paren
id|gus
comma
id|REGCNTRLS
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
op_or
id|gus-&gt;mix_cntrl_reg
comma
id|GUSP
c_func
(paren
id|gus
comma
id|MIXCNTRLREG
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|dma1
comma
id|GUSP
c_func
(paren
id|gus
comma
id|IRQDMACNTRLREG
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|latches
)paren
(brace
id|outb
c_func
(paren
l_int|0x40
op_or
id|gus-&gt;mix_cntrl_reg
comma
id|GUSP
c_func
(paren
id|gus
comma
id|MIXCNTRLREG
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|irq
comma
id|GUSP
c_func
(paren
id|gus
comma
id|IRQDMACNTRLREG
)paren
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
op_or
id|gus-&gt;mix_cntrl_reg
comma
id|GUSP
c_func
(paren
id|gus
comma
id|MIXCNTRLREG
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|dma1
comma
id|GUSP
c_func
(paren
id|gus
comma
id|IRQDMACNTRLREG
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|latches
)paren
(brace
id|outb
c_func
(paren
l_int|0x40
op_or
id|gus-&gt;mix_cntrl_reg
comma
id|GUSP
c_func
(paren
id|gus
comma
id|MIXCNTRLREG
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|irq
comma
id|GUSP
c_func
(paren
id|gus
comma
id|IRQDMACNTRLREG
)paren
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_gf1_delay
c_func
(paren
id|gus
)paren
suffix:semicolon
r_if
c_cond
(paren
id|latches
)paren
id|gus-&gt;mix_cntrl_reg
op_or_assign
l_int|0x08
suffix:semicolon
multiline_comment|/* enable latches */
r_else
id|gus-&gt;mix_cntrl_reg
op_and_assign
op_complement
l_int|0x08
suffix:semicolon
multiline_comment|/* disable latches */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
id|gus-&gt;mix_cntrl_reg
comma
id|GUSP
c_func
(paren
id|gus
comma
id|MIXCNTRLREG
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|GUSP
c_func
(paren
id|gus
comma
id|GF1PAGE
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gus_check_version
r_static
r_int
id|snd_gus_check_version
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|val
comma
id|rev
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
id|card
op_assign
id|gus-&gt;card
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x20
comma
id|GUSP
c_func
(paren
id|gus
comma
id|REGCNTRLS
)paren
)paren
suffix:semicolon
id|val
op_assign
id|inb
c_func
(paren
id|GUSP
c_func
(paren
id|gus
comma
id|REGCNTRLS
)paren
)paren
suffix:semicolon
id|rev
op_assign
id|inb
c_func
(paren
id|GUSP
c_func
(paren
id|gus
comma
id|BOARDVERSION
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_printdd
c_func
(paren
l_string|&quot;GF1 [0x%lx] init - val = 0x%x, rev = 0x%x&bslash;n&quot;
comma
id|gus-&gt;gf1.port
comma
id|val
comma
id|rev
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;GUS&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;Gravis UltraSound Classic (2.4)&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_ne
l_int|255
op_logical_and
(paren
id|val
op_amp
l_int|0x06
)paren
)paren
op_logical_or
(paren
id|rev
op_ge
l_int|5
op_logical_and
id|rev
op_ne
l_int|255
)paren
)paren
(brace
r_if
c_cond
(paren
id|rev
op_ge
l_int|5
op_logical_and
id|rev
op_le
l_int|9
)paren
(brace
id|gus-&gt;ics_flag
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|rev
op_eq
l_int|5
)paren
id|gus-&gt;ics_flipped
op_assign
l_int|1
suffix:semicolon
id|card-&gt;longname
(braket
l_int|27
)braket
op_assign
l_char|&squot;3&squot;
suffix:semicolon
id|card-&gt;longname
(braket
l_int|29
)braket
op_assign
id|rev
op_eq
l_int|5
ques
c_cond
l_char|&squot;5&squot;
suffix:colon
l_char|&squot;7&squot;
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rev
op_ge
l_int|10
op_logical_and
id|rev
op_ne
l_int|255
)paren
(brace
r_if
c_cond
(paren
id|rev
op_ge
l_int|10
op_logical_and
id|rev
op_le
l_int|11
)paren
(brace
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;GUS MAX&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;Gravis UltraSound MAX&quot;
)paren
suffix:semicolon
id|gus-&gt;max_flag
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rev
op_eq
l_int|0x30
)paren
(brace
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;GUS ACE&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;Gravis UltraSound Ace&quot;
)paren
suffix:semicolon
id|gus-&gt;ace_flag
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|rev
op_eq
l_int|0x50
)paren
(brace
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;GUS Extreme&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;Gravis UltraSound Extreme&quot;
)paren
suffix:semicolon
id|gus-&gt;ess_flag
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unknown GF1 revision number at 0x%lx - 0x%x (0x%x)&bslash;n&quot;
comma
id|gus-&gt;gf1.port
comma
id|rev
comma
id|val
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;  please - report to &lt;perex@suse.cz&gt;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
id|strcpy
c_func
(paren
id|card-&gt;shortname
comma
id|card-&gt;longname
)paren
suffix:semicolon
id|gus-&gt;uart_enable
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* standard GUSes doesn&squot;t have midi uart trouble */
id|snd_gus_init_control
c_func
(paren
id|gus
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gus_seq_dev_free
r_static
r_void
id|snd_gus_seq_dev_free
c_func
(paren
id|snd_seq_device_t
op_star
id|seq_dev
)paren
(brace
id|snd_gus_card_t
op_star
id|gus
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_gus_card_t
comma
id|seq_dev-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|gus-&gt;seq_dev
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|snd_gus_initialize
r_int
id|snd_gus_initialize
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gus-&gt;interwave
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_gus_check_version
c_func
(paren
id|gus
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;version check failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_gus_detect_memory
c_func
(paren
id|gus
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_gus_init_dma_irq
c_func
(paren
id|gus
comma
l_int|1
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
macro_line|#if defined(CONFIG_SND_SEQUENCER) || defined(CONFIG_SND_SEQUENCER_MODULE)
r_if
c_cond
(paren
id|snd_seq_device_new
c_func
(paren
id|gus-&gt;card
comma
l_int|1
comma
id|SNDRV_SEQ_DEV_ID_GUS
comma
r_sizeof
(paren
id|snd_gus_card_t
op_star
)paren
comma
op_amp
id|gus-&gt;seq_dev
)paren
op_ge
l_int|0
)paren
(brace
id|strcpy
c_func
(paren
id|gus-&gt;seq_dev-&gt;name
comma
l_string|&quot;GUS&quot;
)paren
suffix:semicolon
op_star
(paren
id|snd_gus_card_t
op_star
op_star
)paren
id|SNDRV_SEQ_DEVICE_ARGPTR
c_func
(paren
id|gus-&gt;seq_dev
)paren
op_assign
id|gus
suffix:semicolon
id|gus-&gt;seq_dev-&gt;private_data
op_assign
id|gus
suffix:semicolon
id|gus-&gt;seq_dev-&gt;private_free
op_assign
id|snd_gus_seq_dev_free
suffix:semicolon
)brace
macro_line|#endif
id|snd_gf1_start
c_func
(paren
id|gus
)paren
suffix:semicolon
id|gus-&gt;initialized
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* gus_io.c */
DECL|variable|snd_gf1_delay
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_delay
)paren
suffix:semicolon
DECL|variable|snd_gf1_write8
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_write8
)paren
suffix:semicolon
DECL|variable|snd_gf1_look8
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_look8
)paren
suffix:semicolon
DECL|variable|snd_gf1_write16
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_write16
)paren
suffix:semicolon
DECL|variable|snd_gf1_look16
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_look16
)paren
suffix:semicolon
DECL|variable|snd_gf1_i_write8
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_i_write8
)paren
suffix:semicolon
DECL|variable|snd_gf1_i_look8
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_i_look8
)paren
suffix:semicolon
DECL|variable|snd_gf1_i_write16
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_i_write16
)paren
suffix:semicolon
DECL|variable|snd_gf1_i_look16
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_i_look16
)paren
suffix:semicolon
DECL|variable|snd_gf1_dram_addr
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_dram_addr
)paren
suffix:semicolon
DECL|variable|snd_gf1_write_addr
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_write_addr
)paren
suffix:semicolon
DECL|variable|snd_gf1_poke
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_poke
)paren
suffix:semicolon
DECL|variable|snd_gf1_peek
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_peek
)paren
suffix:semicolon
multiline_comment|/* gus_reset.c */
DECL|variable|snd_gf1_alloc_voice
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_alloc_voice
)paren
suffix:semicolon
DECL|variable|snd_gf1_free_voice
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_free_voice
)paren
suffix:semicolon
DECL|variable|snd_gf1_ctrl_stop
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_ctrl_stop
)paren
suffix:semicolon
DECL|variable|snd_gf1_stop_voice
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_stop_voice
)paren
suffix:semicolon
DECL|variable|snd_gf1_start
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_start
)paren
suffix:semicolon
DECL|variable|snd_gf1_stop
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_stop
)paren
suffix:semicolon
multiline_comment|/* gus_mixer.c */
DECL|variable|snd_gf1_new_mixer
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_new_mixer
)paren
suffix:semicolon
multiline_comment|/* gus_pcm.c */
DECL|variable|snd_gf1_pcm_new
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_pcm_new
)paren
suffix:semicolon
multiline_comment|/* gus.c */
DECL|variable|snd_gus_use_inc
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gus_use_inc
)paren
suffix:semicolon
DECL|variable|snd_gus_use_dec
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gus_use_dec
)paren
suffix:semicolon
DECL|variable|snd_gus_create
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gus_create
)paren
suffix:semicolon
DECL|variable|snd_gus_initialize
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gus_initialize
)paren
suffix:semicolon
multiline_comment|/* gus_irq.c */
DECL|variable|snd_gus_interrupt
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gus_interrupt
)paren
suffix:semicolon
multiline_comment|/* gus_uart.c */
DECL|variable|snd_gf1_rawmidi_new
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_rawmidi_new
)paren
suffix:semicolon
multiline_comment|/* gus_dram.c */
DECL|variable|snd_gus_dram_write
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gus_dram_write
)paren
suffix:semicolon
DECL|variable|snd_gus_dram_read
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gus_dram_read
)paren
suffix:semicolon
multiline_comment|/* gus_volume.c */
DECL|variable|snd_gf1_lvol_to_gvol_raw
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_lvol_to_gvol_raw
)paren
suffix:semicolon
DECL|variable|snd_gf1_translate_freq
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_translate_freq
)paren
suffix:semicolon
multiline_comment|/* gus_mem.c */
DECL|variable|snd_gf1_mem_alloc
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_mem_alloc
)paren
suffix:semicolon
DECL|variable|snd_gf1_mem_xfree
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_mem_xfree
)paren
suffix:semicolon
DECL|variable|snd_gf1_mem_free
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_mem_free
)paren
suffix:semicolon
DECL|variable|snd_gf1_mem_lock
id|EXPORT_SYMBOL
c_func
(paren
id|snd_gf1_mem_lock
)paren
suffix:semicolon
multiline_comment|/*&n; *  INIT part&n; */
DECL|function|alsa_gus_init
r_static
r_int
id|__init
id|alsa_gus_init
c_func
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|alsa_gus_exit
r_static
r_void
id|__exit
id|alsa_gus_exit
c_func
(paren
r_void
)paren
(brace
)brace
id|module_init
c_func
(paren
id|alsa_gus_init
)paren
id|module_exit
c_func
(paren
id|alsa_gus_exit
)paren
eof
