multiline_comment|/*&n; *  Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *  GUS&squot;s memory access via proc filesystem&n; *&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/gus.h&gt;
macro_line|#include &lt;sound/info.h&gt;
DECL|struct|gus_proc_private
r_typedef
r_struct
id|gus_proc_private
(brace
DECL|member|rom
r_int
id|rom
suffix:semicolon
multiline_comment|/* data are in ROM */
DECL|member|address
r_int
r_int
id|address
suffix:semicolon
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
DECL|member|gus
id|snd_gus_card_t
op_star
id|gus
suffix:semicolon
DECL|typedef|gus_proc_private_t
)brace
id|gus_proc_private_t
suffix:semicolon
DECL|function|snd_gf1_mem_proc_dump
r_static
r_int
id|snd_gf1_mem_proc_dump
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
r_void
op_star
id|file_private_data
comma
r_struct
id|file
op_star
id|file
comma
r_char
id|__user
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|size
suffix:semicolon
id|gus_proc_private_t
op_star
id|priv
op_assign
id|snd_magic_cast
c_func
(paren
id|gus_proc_private_t
comma
id|entry-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|snd_gus_card_t
op_star
id|gus
op_assign
id|priv-&gt;gus
suffix:semicolon
r_int
id|err
suffix:semicolon
id|size
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_pos
op_plus
id|size
OG
id|priv-&gt;size
)paren
id|size
op_assign
(paren
r_int
)paren
id|priv-&gt;size
op_minus
id|file-&gt;f_pos
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_gus_dram_read
c_func
(paren
id|gus
comma
id|buf
comma
id|file-&gt;f_pos
comma
id|size
comma
id|priv-&gt;rom
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|file-&gt;f_pos
op_add_assign
id|size
suffix:semicolon
r_return
id|size
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gf1_mem_proc_llseek
r_static
r_int
r_int
id|snd_gf1_mem_proc_llseek
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
r_void
op_star
id|private_file_data
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|offset
comma
r_int
id|orig
)paren
(brace
id|gus_proc_private_t
op_star
id|priv
op_assign
id|snd_magic_cast
c_func
(paren
id|gus_proc_private_t
comma
id|entry-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|orig
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* SEEK_SET */
id|file-&gt;f_pos
op_assign
id|offset
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* SEEK_CUR */
id|file-&gt;f_pos
op_add_assign
id|offset
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* SEEK_END, offset is negative */
id|file-&gt;f_pos
op_assign
id|priv-&gt;size
op_plus
id|offset
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_pos
OG
id|priv-&gt;size
)paren
id|file-&gt;f_pos
op_assign
id|priv-&gt;size
suffix:semicolon
r_return
id|file-&gt;f_pos
suffix:semicolon
)brace
DECL|function|snd_gf1_mem_proc_free
r_static
r_void
id|snd_gf1_mem_proc_free
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
)paren
(brace
id|gus_proc_private_t
op_star
id|priv
op_assign
id|snd_magic_cast
c_func
(paren
id|gus_proc_private_t
comma
id|entry-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|snd_magic_kfree
c_func
(paren
id|priv
)paren
suffix:semicolon
)brace
DECL|variable|snd_gf1_mem_proc_ops
r_static
r_struct
id|snd_info_entry_ops
id|snd_gf1_mem_proc_ops
op_assign
(brace
dot
id|read
op_assign
id|snd_gf1_mem_proc_dump
comma
dot
id|llseek
op_assign
id|snd_gf1_mem_proc_llseek
comma
)brace
suffix:semicolon
DECL|function|snd_gf1_mem_proc_init
r_int
id|snd_gf1_mem_proc_init
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
)paren
(brace
r_int
id|idx
suffix:semicolon
r_char
id|name
(braket
l_int|16
)braket
suffix:semicolon
id|gus_proc_private_t
op_star
id|priv
suffix:semicolon
id|snd_info_entry_t
op_star
id|entry
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|4
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
id|gus-&gt;gf1.mem_alloc.banks_8
(braket
id|idx
)braket
dot
id|size
OG
l_int|0
)paren
(brace
id|priv
op_assign
id|snd_magic_kcalloc
c_func
(paren
id|gus_proc_private_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|priv-&gt;gus
op_assign
id|gus
suffix:semicolon
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;gus-ram-%i&quot;
comma
id|idx
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_card_proc_new
c_func
(paren
id|gus-&gt;card
comma
id|name
comma
op_amp
id|entry
)paren
)paren
(brace
id|entry-&gt;content
op_assign
id|SNDRV_INFO_CONTENT_DATA
suffix:semicolon
id|entry-&gt;private_data
op_assign
id|priv
suffix:semicolon
id|entry-&gt;private_free
op_assign
id|snd_gf1_mem_proc_free
suffix:semicolon
id|entry-&gt;c.ops
op_assign
op_amp
id|snd_gf1_mem_proc_ops
suffix:semicolon
id|priv-&gt;address
op_assign
id|gus-&gt;gf1.mem_alloc.banks_8
(braket
id|idx
)braket
dot
id|address
suffix:semicolon
id|priv-&gt;size
op_assign
id|entry-&gt;size
op_assign
id|gus-&gt;gf1.mem_alloc.banks_8
(braket
id|idx
)braket
dot
id|size
suffix:semicolon
)brace
)brace
)brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|4
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
id|gus-&gt;gf1.rom_present
op_amp
(paren
l_int|1
op_lshift
id|idx
)paren
)paren
(brace
id|priv
op_assign
id|snd_magic_kcalloc
c_func
(paren
id|gus_proc_private_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|priv
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|priv-&gt;rom
op_assign
l_int|1
suffix:semicolon
id|priv-&gt;gus
op_assign
id|gus
suffix:semicolon
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;gus-rom-%i&quot;
comma
id|idx
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_card_proc_new
c_func
(paren
id|gus-&gt;card
comma
id|name
comma
op_amp
id|entry
)paren
)paren
(brace
id|entry-&gt;content
op_assign
id|SNDRV_INFO_CONTENT_DATA
suffix:semicolon
id|entry-&gt;private_data
op_assign
id|priv
suffix:semicolon
id|entry-&gt;private_free
op_assign
id|snd_gf1_mem_proc_free
suffix:semicolon
id|entry-&gt;c.ops
op_assign
op_amp
id|snd_gf1_mem_proc_ops
suffix:semicolon
id|priv-&gt;address
op_assign
id|idx
op_star
l_int|4096
op_star
l_int|1024
suffix:semicolon
id|priv-&gt;size
op_assign
id|entry-&gt;size
op_assign
id|gus-&gt;gf1.rom_memory
suffix:semicolon
)brace
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
eof
