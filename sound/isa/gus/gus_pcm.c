multiline_comment|/*&n; *  Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *  Routines for control of GF1 chip (PCM things)&n; *&n; *  InterWave chips supports interleaved DMA, but this feature isn&squot;t used in&n; *  this code.&n; *  &n; *  This code emulates autoinit DMA transfer for playback, recording by GF1&n; *  chip doesn&squot;t support autoinit DMA.&n; *&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/control.h&gt;
macro_line|#include &lt;sound/gus.h&gt;
macro_line|#include &quot;gus_tables.h&quot;
DECL|macro|chip_t
mdefine_line|#define chip_t snd_gus_card_t
multiline_comment|/* maximum rate */
DECL|macro|SNDRV_GF1_PCM_RATE
mdefine_line|#define SNDRV_GF1_PCM_RATE&t;&t;48000
DECL|macro|SNDRV_GF1_PCM_PFLG_NONE
mdefine_line|#define SNDRV_GF1_PCM_PFLG_NONE&t;&t;0
DECL|macro|SNDRV_GF1_PCM_PFLG_ACTIVE
mdefine_line|#define SNDRV_GF1_PCM_PFLG_ACTIVE&t;(1&lt;&lt;0)
DECL|macro|SNDRV_GF1_PCM_PFLG_NEUTRAL
mdefine_line|#define SNDRV_GF1_PCM_PFLG_NEUTRAL&t;(2&lt;&lt;0)
r_typedef
r_struct
(brace
DECL|member|gus
id|snd_gus_card_t
op_star
id|gus
suffix:semicolon
DECL|member|substream
id|snd_pcm_substream_t
op_star
id|substream
suffix:semicolon
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|voices
r_int
id|voices
suffix:semicolon
DECL|member|pvoices
id|snd_gus_voice_t
op_star
id|pvoices
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|memory
r_int
r_int
id|memory
suffix:semicolon
DECL|member|flags
r_int
r_int
id|flags
suffix:semicolon
DECL|member|voice_ctrl
DECL|member|ramp_ctrl
r_int
r_char
id|voice_ctrl
comma
id|ramp_ctrl
suffix:semicolon
DECL|member|bpos
r_int
r_int
id|bpos
suffix:semicolon
DECL|member|blocks
r_int
r_int
id|blocks
suffix:semicolon
DECL|member|block_size
r_int
r_int
id|block_size
suffix:semicolon
DECL|member|dma_size
r_int
r_int
id|dma_size
suffix:semicolon
DECL|member|sleep
id|wait_queue_head_t
id|sleep
suffix:semicolon
DECL|member|dma_count
id|atomic_t
id|dma_count
suffix:semicolon
DECL|member|final_volume
r_int
id|final_volume
suffix:semicolon
DECL|typedef|gus_pcm_private_t
)brace
id|gus_pcm_private_t
suffix:semicolon
DECL|variable|snd_gf1_pcm_use_dma
r_static
r_int
id|snd_gf1_pcm_use_dma
op_assign
l_int|1
suffix:semicolon
DECL|function|snd_gf1_pcm_block_change_ack
r_static
r_void
id|snd_gf1_pcm_block_change_ack
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
r_void
op_star
id|private_data
)paren
(brace
id|gus_pcm_private_t
op_star
id|pcmp
op_assign
id|snd_magic_cast
c_func
(paren
id|gus_pcm_private_t
comma
id|private_data
comma
r_return
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcmp
)paren
(brace
id|atomic_dec
c_func
(paren
op_amp
id|pcmp-&gt;dma_count
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|pcmp-&gt;sleep
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_gf1_pcm_block_change
r_static
r_int
id|snd_gf1_pcm_block_change
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
r_int
id|offset
comma
r_int
r_int
id|addr
comma
r_int
r_int
id|count
)paren
(brace
id|snd_gf1_dma_block_t
id|block
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|gus_pcm_private_t
op_star
id|pcmp
op_assign
id|snd_magic_cast
c_func
(paren
id|gus_pcm_private_t
comma
id|runtime-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|count
op_add_assign
id|offset
op_amp
l_int|31
suffix:semicolon
id|offset
op_and_assign
op_complement
l_int|31
suffix:semicolon
singleline_comment|// snd_printk(&quot;block change - offset = 0x%x, count = 0x%x&bslash;n&quot;, offset, count);
id|memset
c_func
(paren
op_amp
id|block
comma
l_int|0
comma
r_sizeof
(paren
id|block
)paren
)paren
suffix:semicolon
id|block.cmd
op_assign
id|SNDRV_GF1_DMA_IRQ
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_unsigned
c_func
(paren
id|runtime-&gt;format
)paren
)paren
id|block.cmd
op_or_assign
id|SNDRV_GF1_DMA_UNSIGNED
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|16
)paren
id|block.cmd
op_or_assign
id|SNDRV_GF1_DMA_16BIT
suffix:semicolon
id|block.addr
op_assign
id|addr
op_amp
op_complement
l_int|31
suffix:semicolon
id|block.buffer
op_assign
id|runtime-&gt;dma_area
op_plus
id|offset
suffix:semicolon
id|block.count
op_assign
id|count
suffix:semicolon
id|block.private_data
op_assign
id|pcmp
suffix:semicolon
id|block.ack
op_assign
id|snd_gf1_pcm_block_change_ack
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_gf1_dma_transfer_block
c_func
(paren
id|pcmp-&gt;gus
comma
op_amp
id|block
comma
l_int|0
comma
l_int|0
)paren
)paren
id|atomic_inc
c_func
(paren
op_amp
id|pcmp-&gt;dma_count
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_trigger_up
r_static
r_void
id|snd_gf1_pcm_trigger_up
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|gus_pcm_private_t
op_star
id|pcmp
op_assign
id|snd_magic_cast
c_func
(paren
id|gus_pcm_private_t
comma
id|runtime-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|snd_gus_card_t
op_star
id|gus
op_assign
id|pcmp-&gt;gus
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|voice_ctrl
comma
id|ramp_ctrl
suffix:semicolon
r_int
r_int
id|rate
suffix:semicolon
r_int
r_int
id|curr
comma
id|begin
comma
id|end
suffix:semicolon
r_int
r_int
id|vol
suffix:semicolon
r_int
r_char
id|pan
suffix:semicolon
r_int
r_int
id|voice
suffix:semicolon
r_if
c_cond
(paren
id|substream
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|pcmp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcmp-&gt;flags
op_amp
id|SNDRV_GF1_PCM_PFLG_ACTIVE
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pcmp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|pcmp-&gt;flags
op_or_assign
id|SNDRV_GF1_PCM_PFLG_ACTIVE
suffix:semicolon
id|pcmp-&gt;final_volume
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|pcmp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|rate
op_assign
id|snd_gf1_translate_freq
c_func
(paren
id|gus
comma
id|runtime-&gt;rate
op_lshift
l_int|4
)paren
suffix:semicolon
multiline_comment|/* enable WAVE IRQ */
id|voice_ctrl
op_assign
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|16
ques
c_cond
l_int|0x24
suffix:colon
l_int|0x20
suffix:semicolon
multiline_comment|/* enable RAMP IRQ + rollover */
id|ramp_ctrl
op_assign
l_int|0x24
suffix:semicolon
r_if
c_cond
(paren
id|pcmp-&gt;blocks
op_eq
l_int|1
)paren
(brace
id|voice_ctrl
op_or_assign
l_int|0x08
suffix:semicolon
multiline_comment|/* loop enable */
id|ramp_ctrl
op_and_assign
op_complement
l_int|0x04
suffix:semicolon
multiline_comment|/* disable rollover */
)brace
r_for
c_loop
(paren
id|voice
op_assign
l_int|0
suffix:semicolon
id|voice
OL
id|pcmp-&gt;voices
suffix:semicolon
id|voice
op_increment
)paren
(brace
id|begin
op_assign
id|pcmp-&gt;memory
op_plus
id|voice
op_star
(paren
id|pcmp-&gt;dma_size
op_div
id|runtime-&gt;channels
)paren
suffix:semicolon
id|curr
op_assign
id|begin
op_plus
(paren
id|pcmp-&gt;bpos
op_star
id|pcmp-&gt;block_size
)paren
op_div
id|runtime-&gt;channels
suffix:semicolon
id|end
op_assign
id|curr
op_plus
(paren
id|pcmp-&gt;block_size
op_div
id|runtime-&gt;channels
)paren
suffix:semicolon
id|end
op_sub_assign
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|16
ques
c_cond
l_int|2
suffix:colon
l_int|1
suffix:semicolon
singleline_comment|// snd_printk(&quot;init: curr=0x%x, begin=0x%x, end=0x%x, ctrl=0x%x, ramp=0x%x, rate=0x%x&bslash;n&quot;, curr, begin, end, voice_ctrl, ramp_ctrl, rate);
id|pan
op_assign
id|runtime-&gt;channels
op_eq
l_int|2
ques
c_cond
(paren
op_logical_neg
id|voice
ques
c_cond
l_int|1
suffix:colon
l_int|14
)paren
suffix:colon
l_int|8
suffix:semicolon
id|vol
op_assign
op_logical_neg
id|voice
ques
c_cond
id|gus-&gt;gf1.pcm_volume_level_left
suffix:colon
id|gus-&gt;gf1.pcm_volume_level_right
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|pcmp-&gt;pvoices
(braket
id|voice
)braket
op_member_access_from_pointer
id|number
)paren
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_PAN
comma
id|pan
)paren
suffix:semicolon
id|snd_gf1_write16
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VW_FREQUENCY
comma
id|rate
)paren
suffix:semicolon
id|snd_gf1_write_addr
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VA_START
comma
id|begin
op_lshift
l_int|4
comma
id|voice_ctrl
op_amp
l_int|4
)paren
suffix:semicolon
id|snd_gf1_write_addr
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VA_END
comma
id|end
op_lshift
l_int|4
comma
id|voice_ctrl
op_amp
l_int|4
)paren
suffix:semicolon
id|snd_gf1_write_addr
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VA_CURRENT
comma
id|curr
op_lshift
l_int|4
comma
id|voice_ctrl
op_amp
l_int|4
)paren
suffix:semicolon
id|snd_gf1_write16
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VW_VOLUME
comma
id|SNDRV_GF1_MIN_VOLUME
op_lshift
l_int|4
)paren
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_RATE
comma
l_int|0x2f
)paren
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_START
comma
id|SNDRV_GF1_MIN_OFFSET
)paren
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_END
comma
id|vol
op_rshift
l_int|8
)paren
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_CONTROL
comma
id|ramp_ctrl
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gus-&gt;gf1.enh_mode
)paren
(brace
id|snd_gf1_delay
c_func
(paren
id|gus
)paren
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_CONTROL
comma
id|ramp_ctrl
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|voice
op_assign
l_int|0
suffix:semicolon
id|voice
OL
id|pcmp-&gt;voices
suffix:semicolon
id|voice
op_increment
)paren
(brace
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|pcmp-&gt;pvoices
(braket
id|voice
)braket
op_member_access_from_pointer
id|number
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gus-&gt;gf1.enh_mode
)paren
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_MODE
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* deactivate voice */
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_ADDRESS_CONTROL
comma
id|voice_ctrl
)paren
suffix:semicolon
id|voice_ctrl
op_and_assign
op_complement
l_int|0x20
suffix:semicolon
)brace
id|voice_ctrl
op_or_assign
l_int|0x20
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gus-&gt;gf1.enh_mode
)paren
(brace
id|snd_gf1_delay
c_func
(paren
id|gus
)paren
suffix:semicolon
r_for
c_loop
(paren
id|voice
op_assign
l_int|0
suffix:semicolon
id|voice
OL
id|pcmp-&gt;voices
suffix:semicolon
id|voice
op_increment
)paren
(brace
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|pcmp-&gt;pvoices
(braket
id|voice
)braket
op_member_access_from_pointer
id|number
)paren
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_ADDRESS_CONTROL
comma
id|voice_ctrl
)paren
suffix:semicolon
id|voice_ctrl
op_and_assign
op_complement
l_int|0x20
suffix:semicolon
multiline_comment|/* disable IRQ for next voice */
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_interrupt_wave
r_static
r_void
id|snd_gf1_pcm_interrupt_wave
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|pvoice
)paren
(brace
id|gus_pcm_private_t
op_star
id|pcmp
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
suffix:semicolon
r_int
r_char
id|voice_ctrl
comma
id|ramp_ctrl
suffix:semicolon
r_int
id|idx
suffix:semicolon
r_int
r_int
id|end
comma
id|step
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pvoice-&gt;private_data
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;snd_gf1_pcm: unknown wave irq?&bslash;n&quot;
)paren
suffix:semicolon
id|snd_gf1_smart_stop_voice
c_func
(paren
id|gus
comma
id|pvoice-&gt;number
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|pcmp
op_assign
id|snd_magic_cast
c_func
(paren
id|gus_pcm_private_t
comma
id|pvoice-&gt;private_data
comma
r_return
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcmp
op_eq
l_int|NULL
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;snd_gf1_pcm: unknown wave irq?&bslash;n&quot;
)paren
suffix:semicolon
id|snd_gf1_smart_stop_voice
c_func
(paren
id|gus
comma
id|pvoice-&gt;number
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|gus
op_assign
id|pcmp-&gt;gus
suffix:semicolon
id|runtime
op_assign
id|pcmp-&gt;substream-&gt;runtime
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|gus-&gt;reg_lock
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|pvoice-&gt;number
)paren
suffix:semicolon
id|voice_ctrl
op_assign
id|snd_gf1_read8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_ADDRESS_CONTROL
)paren
op_amp
op_complement
l_int|0x8b
suffix:semicolon
id|ramp_ctrl
op_assign
(paren
id|snd_gf1_read8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_CONTROL
)paren
op_amp
op_complement
l_int|0xa4
)paren
op_or
l_int|0x03
suffix:semicolon
macro_line|#if 0
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|pvoice-&gt;number
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;position = 0x%x&bslash;n&quot;
comma
(paren
id|snd_gf1_read_addr
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VA_CURRENT
comma
id|voice_ctrl
op_amp
l_int|4
)paren
op_rshift
l_int|4
)paren
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|pcmp-&gt;pvoices
(braket
l_int|1
)braket
op_member_access_from_pointer
id|number
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;position = 0x%x&bslash;n&quot;
comma
(paren
id|snd_gf1_read_addr
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VA_CURRENT
comma
id|voice_ctrl
op_amp
l_int|4
)paren
op_rshift
l_int|4
)paren
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|pvoice-&gt;number
)paren
suffix:semicolon
macro_line|#endif
id|pcmp-&gt;bpos
op_increment
suffix:semicolon
id|pcmp-&gt;bpos
op_mod_assign
id|pcmp-&gt;blocks
suffix:semicolon
r_if
c_cond
(paren
id|pcmp-&gt;bpos
op_plus
l_int|1
op_ge
id|pcmp-&gt;blocks
)paren
(brace
multiline_comment|/* last block? */
id|voice_ctrl
op_or_assign
l_int|0x08
suffix:semicolon
multiline_comment|/* enable loop */
)brace
r_else
(brace
id|ramp_ctrl
op_or_assign
l_int|0x04
suffix:semicolon
multiline_comment|/* enable rollover */
)brace
id|end
op_assign
id|pcmp-&gt;memory
op_plus
(paren
(paren
(paren
id|pcmp-&gt;bpos
op_plus
l_int|1
)paren
op_star
id|pcmp-&gt;block_size
)paren
op_div
id|runtime-&gt;channels
)paren
suffix:semicolon
id|end
op_sub_assign
id|voice_ctrl
op_amp
l_int|4
ques
c_cond
l_int|2
suffix:colon
l_int|1
suffix:semicolon
id|step
op_assign
id|pcmp-&gt;dma_size
op_div
id|runtime-&gt;channels
suffix:semicolon
id|voice_ctrl
op_or_assign
l_int|0x20
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pcmp-&gt;final_volume
)paren
(brace
id|ramp_ctrl
op_or_assign
l_int|0x20
suffix:semicolon
id|ramp_ctrl
op_and_assign
op_complement
l_int|0x03
suffix:semicolon
)brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|pcmp-&gt;voices
suffix:semicolon
id|idx
op_increment
comma
id|end
op_add_assign
id|step
)paren
(brace
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|pcmp-&gt;pvoices
(braket
id|idx
)braket
op_member_access_from_pointer
id|number
)paren
suffix:semicolon
id|snd_gf1_write_addr
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VA_END
comma
id|end
op_lshift
l_int|4
comma
id|voice_ctrl
op_amp
l_int|4
)paren
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_ADDRESS_CONTROL
comma
id|voice_ctrl
)paren
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_CONTROL
comma
id|ramp_ctrl
)paren
suffix:semicolon
id|voice_ctrl
op_and_assign
op_complement
l_int|0x20
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|gus-&gt;gf1.enh_mode
)paren
(brace
id|snd_gf1_delay
c_func
(paren
id|gus
)paren
suffix:semicolon
id|voice_ctrl
op_or_assign
l_int|0x20
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|pcmp-&gt;voices
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|pcmp-&gt;pvoices
(braket
id|idx
)braket
op_member_access_from_pointer
id|number
)paren
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_ADDRESS_CONTROL
comma
id|voice_ctrl
)paren
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_CONTROL
comma
id|ramp_ctrl
)paren
suffix:semicolon
id|voice_ctrl
op_and_assign
op_complement
l_int|0x20
suffix:semicolon
)brace
)brace
id|spin_unlock
c_func
(paren
op_amp
id|gus-&gt;reg_lock
)paren
suffix:semicolon
id|snd_pcm_period_elapsed
c_func
(paren
id|pcmp-&gt;substream
)paren
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
(paren
id|runtime-&gt;flags
op_amp
id|SNDRV_PCM_FLG_MMAP
)paren
op_logical_and
op_star
id|runtime-&gt;state
op_eq
id|SNDRV_PCM_STATE_RUNNING
)paren
(brace
id|end
op_assign
id|pcmp-&gt;bpos
op_star
id|pcmp-&gt;block_size
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;channels
OG
l_int|1
)paren
(brace
id|snd_gf1_pcm_block_change
c_func
(paren
id|pcmp-&gt;substream
comma
id|end
comma
id|pcmp-&gt;memory
op_plus
(paren
id|end
op_div
l_int|2
)paren
comma
id|pcmp-&gt;block_size
op_div
l_int|2
)paren
suffix:semicolon
id|snd_gf1_pcm_block_change
c_func
(paren
id|pcmp-&gt;substream
comma
id|end
op_plus
(paren
id|pcmp-&gt;block_size
op_div
l_int|2
)paren
comma
id|pcmp-&gt;memory
op_plus
(paren
id|pcmp-&gt;dma_size
op_div
l_int|2
)paren
op_plus
(paren
id|end
op_div
l_int|2
)paren
comma
id|pcmp-&gt;block_size
op_div
l_int|2
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_gf1_pcm_block_change
c_func
(paren
id|pcmp-&gt;substream
comma
id|end
comma
id|pcmp-&gt;memory
op_plus
id|end
comma
id|pcmp-&gt;block_size
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
)brace
DECL|function|snd_gf1_pcm_interrupt_volume
r_static
r_void
id|snd_gf1_pcm_interrupt_volume
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
id|snd_gus_voice_t
op_star
id|pvoice
)paren
(brace
r_int
r_int
id|vol
suffix:semicolon
r_int
id|cvoice
suffix:semicolon
id|gus_pcm_private_t
op_star
id|pcmp
op_assign
id|snd_magic_cast
c_func
(paren
id|gus_pcm_private_t
comma
id|pvoice-&gt;private_data
comma
r_return
)paren
suffix:semicolon
multiline_comment|/* stop ramp, but leave rollover bit untouched */
id|spin_lock
c_func
(paren
op_amp
id|gus-&gt;reg_lock
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|pvoice-&gt;number
)paren
suffix:semicolon
id|snd_gf1_ctrl_stop
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_CONTROL
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|gus-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcmp
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
multiline_comment|/* are we active? */
r_if
c_cond
(paren
op_logical_neg
(paren
id|pcmp-&gt;flags
op_amp
id|SNDRV_GF1_PCM_PFLG_ACTIVE
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* load real volume - better precision */
id|cvoice
op_assign
id|pcmp-&gt;pvoices
(braket
l_int|0
)braket
op_eq
id|pvoice
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|pcmp-&gt;substream
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|vol
op_assign
op_logical_neg
id|cvoice
ques
c_cond
id|gus-&gt;gf1.pcm_volume_level_left
suffix:colon
id|gus-&gt;gf1.pcm_volume_level_right
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|gus-&gt;reg_lock
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|pvoice-&gt;number
)paren
suffix:semicolon
id|snd_gf1_write16
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VW_VOLUME
comma
id|vol
)paren
suffix:semicolon
id|pcmp-&gt;final_volume
op_assign
l_int|1
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|gus-&gt;reg_lock
)paren
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_volume_change
r_static
r_void
id|snd_gf1_pcm_volume_change
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
)paren
(brace
)brace
DECL|function|snd_gf1_pcm_poke_block
r_static
r_int
id|snd_gf1_pcm_poke_block
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
r_int
r_char
op_star
id|buf
comma
r_int
r_int
id|pos
comma
r_int
r_int
id|count
comma
r_int
id|w16
comma
r_int
id|invert
)paren
(brace
r_int
r_int
id|len
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
singleline_comment|// printk(&quot;poke block; buf = 0x%x, pos = %i, count = %i, port = 0x%x&bslash;n&quot;, (int)buf, pos, count, gus-&gt;gf1.port);
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|len
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|512
)paren
multiline_comment|/* limit, to allow IRQ */
id|len
op_assign
l_int|512
suffix:semicolon
id|count
op_sub_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
id|gus-&gt;interwave
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_GB_MEMORY_CONTROL
comma
l_int|0x01
op_or
(paren
id|invert
ques
c_cond
l_int|0x08
suffix:colon
l_int|0x00
)paren
)paren
suffix:semicolon
id|snd_gf1_dram_addr
c_func
(paren
id|gus
comma
id|pos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|w16
)paren
(brace
id|outb
c_func
(paren
id|SNDRV_GF1_GW_DRAM_IO16
comma
id|GUSP
c_func
(paren
id|gus
comma
id|GF1REGSEL
)paren
)paren
suffix:semicolon
id|outsw
c_func
(paren
id|GUSP
c_func
(paren
id|gus
comma
id|GF1DATALOW
)paren
comma
id|buf
comma
id|len
op_rshift
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|outsb
c_func
(paren
id|GUSP
c_func
(paren
id|gus
comma
id|DRAM
)paren
comma
id|buf
comma
id|len
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|buf
op_add_assign
l_int|512
suffix:semicolon
id|pos
op_add_assign
l_int|512
suffix:semicolon
)brace
r_else
(brace
id|invert
op_assign
id|invert
ques
c_cond
l_int|0x80
suffix:colon
l_int|0x00
suffix:semicolon
r_if
c_cond
(paren
id|w16
)paren
(brace
id|len
op_rshift_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|len
op_decrement
)paren
(brace
id|snd_gf1_poke
c_func
(paren
id|gus
comma
id|pos
op_increment
comma
op_star
id|buf
op_increment
)paren
suffix:semicolon
id|snd_gf1_poke
c_func
(paren
id|gus
comma
id|pos
op_increment
comma
op_star
id|buf
op_increment
op_xor
id|invert
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_while
c_loop
(paren
id|len
op_decrement
)paren
id|snd_gf1_poke
c_func
(paren
id|gus
comma
id|pos
op_increment
comma
op_star
id|buf
op_increment
op_xor
id|invert
)paren
suffix:semicolon
)brace
)brace
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_playback_copy
r_static
r_int
id|snd_gf1_pcm_playback_copy
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|voice
comma
id|snd_pcm_uframes_t
id|pos
comma
r_void
op_star
id|src
comma
id|snd_pcm_uframes_t
id|count
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|gus_pcm_private_t
op_star
id|pcmp
op_assign
id|snd_magic_cast
c_func
(paren
id|gus_pcm_private_t
comma
id|runtime-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_int
r_int
id|bpos
comma
id|len
suffix:semicolon
id|bpos
op_assign
id|samples_to_bytes
c_func
(paren
id|runtime
comma
id|pos
)paren
op_plus
(paren
id|voice
op_star
(paren
id|pcmp-&gt;dma_size
op_div
l_int|2
)paren
)paren
suffix:semicolon
id|len
op_assign
id|samples_to_bytes
c_func
(paren
id|runtime
comma
id|count
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|bpos
op_le
id|pcmp-&gt;dma_size
comma
r_return
op_minus
id|EIO
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|bpos
op_plus
id|len
op_le
id|pcmp-&gt;dma_size
comma
r_return
op_minus
id|EIO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|runtime-&gt;dma_area
op_plus
id|bpos
comma
id|src
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|snd_gf1_pcm_use_dma
op_logical_and
id|len
OG
l_int|32
)paren
(brace
r_return
id|snd_gf1_pcm_block_change
c_func
(paren
id|substream
comma
id|bpos
comma
id|pcmp-&gt;memory
op_plus
id|bpos
comma
id|len
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_gus_card_t
op_star
id|gus
op_assign
id|pcmp-&gt;gus
suffix:semicolon
r_int
id|err
comma
id|w16
comma
id|invert
suffix:semicolon
id|w16
op_assign
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|16
)paren
suffix:semicolon
id|invert
op_assign
id|snd_pcm_format_unsigned
c_func
(paren
id|runtime-&gt;format
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_gf1_pcm_poke_block
c_func
(paren
id|gus
comma
id|runtime-&gt;dma_area
op_plus
id|bpos
comma
id|pcmp-&gt;memory
op_plus
id|bpos
comma
id|len
comma
id|w16
comma
id|invert
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_playback_silence
r_static
r_int
id|snd_gf1_pcm_playback_silence
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|voice
comma
id|snd_pcm_uframes_t
id|pos
comma
id|snd_pcm_uframes_t
id|count
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|gus_pcm_private_t
op_star
id|pcmp
op_assign
id|snd_magic_cast
c_func
(paren
id|gus_pcm_private_t
comma
id|runtime-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_int
r_int
id|bpos
comma
id|len
suffix:semicolon
id|bpos
op_assign
id|samples_to_bytes
c_func
(paren
id|runtime
comma
id|pos
)paren
op_plus
(paren
id|voice
op_star
(paren
id|pcmp-&gt;dma_size
op_div
l_int|2
)paren
)paren
suffix:semicolon
id|len
op_assign
id|samples_to_bytes
c_func
(paren
id|runtime
comma
id|count
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|bpos
op_le
id|pcmp-&gt;dma_size
comma
r_return
op_minus
id|EIO
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|bpos
op_plus
id|len
op_le
id|pcmp-&gt;dma_size
comma
r_return
op_minus
id|EIO
)paren
suffix:semicolon
id|snd_pcm_format_set_silence
c_func
(paren
id|runtime-&gt;format
comma
id|runtime-&gt;dma_area
op_plus
id|bpos
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_gf1_pcm_use_dma
op_logical_and
id|len
OG
l_int|32
)paren
(brace
r_return
id|snd_gf1_pcm_block_change
c_func
(paren
id|substream
comma
id|bpos
comma
id|pcmp-&gt;memory
op_plus
id|bpos
comma
id|len
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_gus_card_t
op_star
id|gus
op_assign
id|pcmp-&gt;gus
suffix:semicolon
r_int
id|err
comma
id|w16
comma
id|invert
suffix:semicolon
id|w16
op_assign
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|16
)paren
suffix:semicolon
id|invert
op_assign
id|snd_pcm_format_unsigned
c_func
(paren
id|runtime-&gt;format
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_gf1_pcm_poke_block
c_func
(paren
id|gus
comma
id|runtime-&gt;dma_area
op_plus
id|bpos
comma
id|pcmp-&gt;memory
op_plus
id|bpos
comma
id|len
comma
id|w16
comma
id|invert
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_playback_hw_params
r_static
r_int
id|snd_gf1_pcm_playback_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
id|snd_gus_card_t
op_star
id|gus
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|gus_pcm_private_t
op_star
id|pcmp
op_assign
id|snd_magic_cast
c_func
(paren
id|gus_pcm_private_t
comma
id|runtime-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|err
OG
l_int|0
)paren
(brace
multiline_comment|/* change */
id|snd_gf1_mem_block_t
op_star
id|block
suffix:semicolon
r_if
c_cond
(paren
id|pcmp-&gt;memory
OG
l_int|0
)paren
(brace
id|snd_gf1_mem_free
c_func
(paren
op_amp
id|gus-&gt;gf1.mem_alloc
comma
id|pcmp-&gt;memory
)paren
suffix:semicolon
id|pcmp-&gt;memory
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|block
op_assign
id|snd_gf1_mem_alloc
c_func
(paren
op_amp
id|gus-&gt;gf1.mem_alloc
comma
id|SNDRV_GF1_MEM_OWNER_DRIVER
comma
l_string|&quot;GF1 PCM&quot;
comma
id|runtime-&gt;dma_bytes
comma
l_int|1
comma
l_int|32
comma
l_int|NULL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|pcmp-&gt;memory
op_assign
id|block-&gt;ptr
suffix:semicolon
)brace
id|pcmp-&gt;voices
op_assign
id|params_channels
c_func
(paren
id|hw_params
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcmp-&gt;pvoices
(braket
l_int|0
)braket
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
(paren
id|pcmp-&gt;pvoices
(braket
l_int|0
)braket
op_assign
id|snd_gf1_alloc_voice
c_func
(paren
id|pcmp-&gt;gus
comma
id|SNDRV_GF1_VOICE_TYPE_PCM
comma
l_int|0
comma
l_int|0
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|pcmp-&gt;pvoices
(braket
l_int|0
)braket
op_member_access_from_pointer
id|handler_wave
op_assign
id|snd_gf1_pcm_interrupt_wave
suffix:semicolon
id|pcmp-&gt;pvoices
(braket
l_int|0
)braket
op_member_access_from_pointer
id|handler_volume
op_assign
id|snd_gf1_pcm_interrupt_volume
suffix:semicolon
id|pcmp-&gt;pvoices
(braket
l_int|0
)braket
op_member_access_from_pointer
id|volume_change
op_assign
id|snd_gf1_pcm_volume_change
suffix:semicolon
id|pcmp-&gt;pvoices
(braket
l_int|0
)braket
op_member_access_from_pointer
id|private_data
op_assign
id|pcmp
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pcmp-&gt;voices
OG
l_int|1
op_logical_and
id|pcmp-&gt;pvoices
(braket
l_int|1
)braket
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
(paren
id|pcmp-&gt;pvoices
(braket
l_int|1
)braket
op_assign
id|snd_gf1_alloc_voice
c_func
(paren
id|pcmp-&gt;gus
comma
id|SNDRV_GF1_VOICE_TYPE_PCM
comma
l_int|0
comma
l_int|0
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|pcmp-&gt;pvoices
(braket
l_int|1
)braket
op_member_access_from_pointer
id|handler_wave
op_assign
id|snd_gf1_pcm_interrupt_wave
suffix:semicolon
id|pcmp-&gt;pvoices
(braket
l_int|1
)braket
op_member_access_from_pointer
id|handler_volume
op_assign
id|snd_gf1_pcm_interrupt_volume
suffix:semicolon
id|pcmp-&gt;pvoices
(braket
l_int|1
)braket
op_member_access_from_pointer
id|volume_change
op_assign
id|snd_gf1_pcm_volume_change
suffix:semicolon
id|pcmp-&gt;pvoices
(braket
l_int|1
)braket
op_member_access_from_pointer
id|private_data
op_assign
id|pcmp
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|pcmp-&gt;voices
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|pcmp-&gt;pvoices
(braket
l_int|1
)braket
)paren
(brace
id|snd_gf1_free_voice
c_func
(paren
id|pcmp-&gt;gus
comma
id|pcmp-&gt;pvoices
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|pcmp-&gt;pvoices
(braket
l_int|1
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_playback_hw_free
r_static
r_int
id|snd_gf1_pcm_playback_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|gus_pcm_private_t
op_star
id|pcmp
op_assign
id|snd_magic_cast
c_func
(paren
id|gus_pcm_private_t
comma
id|runtime-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcmp-&gt;pvoices
(braket
l_int|0
)braket
)paren
(brace
id|snd_gf1_free_voice
c_func
(paren
id|pcmp-&gt;gus
comma
id|pcmp-&gt;pvoices
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|pcmp-&gt;pvoices
(braket
l_int|0
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pcmp-&gt;pvoices
(braket
l_int|1
)braket
)paren
(brace
id|snd_gf1_free_voice
c_func
(paren
id|pcmp-&gt;gus
comma
id|pcmp-&gt;pvoices
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|pcmp-&gt;pvoices
(braket
l_int|1
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pcmp-&gt;memory
OG
l_int|0
)paren
(brace
id|snd_gf1_mem_free
c_func
(paren
op_amp
id|pcmp-&gt;gus-&gt;gf1.mem_alloc
comma
id|pcmp-&gt;memory
)paren
suffix:semicolon
id|pcmp-&gt;memory
op_assign
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_playback_prepare
r_static
r_int
id|snd_gf1_pcm_playback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|gus_pcm_private_t
op_star
id|pcmp
op_assign
id|snd_magic_cast
c_func
(paren
id|gus_pcm_private_t
comma
id|runtime-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|pcmp-&gt;bpos
op_assign
l_int|0
suffix:semicolon
id|pcmp-&gt;dma_size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|pcmp-&gt;block_size
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|pcmp-&gt;blocks
op_assign
id|pcmp-&gt;dma_size
op_div
id|pcmp-&gt;block_size
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_playback_trigger
r_static
r_int
id|snd_gf1_pcm_playback_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|snd_gus_card_t
op_star
id|gus
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|gus_pcm_private_t
op_star
id|pcmp
op_assign
id|snd_magic_cast
c_func
(paren
id|gus_pcm_private_t
comma
id|runtime-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_int
id|voice
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_START
)paren
(brace
id|snd_gf1_pcm_trigger_up
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_STOP
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|pcmp-&gt;lock
)paren
suffix:semicolon
id|pcmp-&gt;flags
op_and_assign
op_complement
id|SNDRV_GF1_PCM_PFLG_ACTIVE
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|pcmp-&gt;lock
)paren
suffix:semicolon
id|voice
op_assign
id|pcmp-&gt;pvoices
(braket
l_int|0
)braket
op_member_access_from_pointer
id|number
suffix:semicolon
id|snd_gf1_stop_voices
c_func
(paren
id|gus
comma
id|voice
comma
id|voice
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcmp-&gt;pvoices
(braket
l_int|1
)braket
)paren
(brace
id|voice
op_assign
id|pcmp-&gt;pvoices
(braket
l_int|1
)braket
op_member_access_from_pointer
id|number
suffix:semicolon
id|snd_gf1_stop_voices
c_func
(paren
id|gus
comma
id|voice
comma
id|voice
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_playback_pointer
r_static
id|snd_pcm_uframes_t
id|snd_gf1_pcm_playback_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_gus_card_t
op_star
id|gus
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|gus_pcm_private_t
op_star
id|pcmp
op_assign
id|snd_magic_cast
c_func
(paren
id|gus_pcm_private_t
comma
id|runtime-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_int
r_int
id|pos
suffix:semicolon
r_int
r_char
id|voice_ctrl
suffix:semicolon
id|pos
op_assign
l_int|0
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|gus-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcmp-&gt;flags
op_amp
id|SNDRV_GF1_PCM_PFLG_ACTIVE
)paren
(brace
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|pcmp-&gt;pvoices
(braket
l_int|0
)braket
op_member_access_from_pointer
id|number
)paren
suffix:semicolon
id|voice_ctrl
op_assign
id|snd_gf1_read8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_ADDRESS_CONTROL
)paren
suffix:semicolon
id|pos
op_assign
(paren
id|snd_gf1_read_addr
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VA_CURRENT
comma
id|voice_ctrl
op_amp
l_int|4
)paren
op_rshift
l_int|4
)paren
op_minus
id|pcmp-&gt;memory
suffix:semicolon
r_if
c_cond
(paren
id|substream-&gt;runtime-&gt;channels
OG
l_int|1
)paren
id|pos
op_lshift_assign
l_int|1
suffix:semicolon
id|pos
op_assign
id|bytes_to_frames
c_func
(paren
id|runtime
comma
id|pos
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|gus-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|pos
suffix:semicolon
)brace
DECL|variable|clock
r_static
id|ratnum_t
id|clock
op_assign
(brace
id|num
suffix:colon
l_int|9878400
op_div
l_int|16
comma
id|den_min
suffix:colon
l_int|2
comma
id|den_max
suffix:colon
l_int|257
comma
id|den_step
suffix:colon
l_int|1
comma
)brace
suffix:semicolon
DECL|variable|hw_constraints_clocks
r_static
id|snd_pcm_hw_constraint_ratnums_t
id|hw_constraints_clocks
op_assign
(brace
id|nrats
suffix:colon
l_int|1
comma
id|rats
suffix:colon
op_amp
id|clock
comma
)brace
suffix:semicolon
DECL|function|snd_gf1_pcm_capture_hw_params
r_static
r_int
id|snd_gf1_pcm_capture_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
id|snd_gus_card_t
op_star
id|gus
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|gus-&gt;c_dma_size
op_assign
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
suffix:semicolon
id|gus-&gt;c_period_size
op_assign
id|params_period_bytes
c_func
(paren
id|hw_params
)paren
suffix:semicolon
id|gus-&gt;c_pos
op_assign
l_int|0
suffix:semicolon
id|gus-&gt;gf1.pcm_rcntrl_reg
op_assign
l_int|0x21
suffix:semicolon
multiline_comment|/* IRQ at end, enable &amp; start */
r_if
c_cond
(paren
id|params_channels
c_func
(paren
id|hw_params
)paren
OG
l_int|1
)paren
id|gus-&gt;gf1.pcm_rcntrl_reg
op_or_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|gus-&gt;gf1.dma2
OG
l_int|3
)paren
id|gus-&gt;gf1.pcm_rcntrl_reg
op_or_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_unsigned
c_func
(paren
id|params_format
c_func
(paren
id|hw_params
)paren
)paren
)paren
id|gus-&gt;gf1.pcm_rcntrl_reg
op_or_assign
l_int|0x80
suffix:semicolon
r_return
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_capture_hw_free
r_static
r_int
id|snd_gf1_pcm_capture_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_capture_prepare
r_static
r_int
id|snd_gf1_pcm_capture_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_gus_card_t
op_star
id|gus
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_gf1_i_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_GB_RECORD_RATE
comma
id|runtime-&gt;rate_den
op_minus
l_int|2
)paren
suffix:semicolon
id|snd_gf1_i_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_GB_REC_DMA_CONTROL
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* disable sampling */
id|snd_gf1_i_look8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_GB_REC_DMA_CONTROL
)paren
suffix:semicolon
multiline_comment|/* Sampling Control Register */
id|snd_dma_program
c_func
(paren
id|gus-&gt;gf1.dma2
comma
op_amp
id|runtime-&gt;dma_area
comma
id|gus-&gt;c_period_size
comma
id|DMA_MODE_READ
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_capture_trigger
r_static
r_int
id|snd_gf1_pcm_capture_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|snd_gus_card_t
op_star
id|gus
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_START
)paren
(brace
id|val
op_assign
id|gus-&gt;gf1.pcm_rcntrl_reg
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_STOP
)paren
(brace
id|val
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_lock
c_func
(paren
op_amp
id|gus-&gt;reg_lock
)paren
suffix:semicolon
id|snd_gf1_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_GB_REC_DMA_CONTROL
comma
id|val
)paren
suffix:semicolon
id|snd_gf1_look8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_GB_REC_DMA_CONTROL
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|gus-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_capture_pointer
r_static
id|snd_pcm_uframes_t
id|snd_gf1_pcm_capture_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_gus_card_t
op_star
id|gus
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|pos
op_assign
id|gus-&gt;c_period_size
op_minus
id|snd_dma_residue
c_func
(paren
id|gus-&gt;gf1.dma2
)paren
suffix:semicolon
id|pos
op_assign
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
(paren
id|gus-&gt;c_pos
op_plus
id|pos
)paren
op_mod
id|gus-&gt;c_dma_size
)paren
suffix:semicolon
r_return
id|pos
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_interrupt_dma_read
r_static
r_void
id|snd_gf1_pcm_interrupt_dma_read
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
)paren
(brace
id|snd_gf1_i_write8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_GB_REC_DMA_CONTROL
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* disable sampling */
id|snd_gf1_i_look8
c_func
(paren
id|gus
comma
id|SNDRV_GF1_GB_REC_DMA_CONTROL
)paren
suffix:semicolon
multiline_comment|/* Sampling Control Register */
r_if
c_cond
(paren
id|gus-&gt;pcm_cap_substream
op_ne
l_int|NULL
)paren
(brace
id|snd_gf1_pcm_capture_prepare
c_func
(paren
id|gus-&gt;pcm_cap_substream
)paren
suffix:semicolon
id|snd_gf1_pcm_capture_trigger
c_func
(paren
id|gus-&gt;pcm_cap_substream
comma
id|SNDRV_PCM_TRIGGER_START
)paren
suffix:semicolon
id|gus-&gt;c_pos
op_add_assign
id|gus-&gt;c_period_size
suffix:semicolon
id|snd_pcm_period_elapsed
c_func
(paren
id|gus-&gt;pcm_cap_substream
)paren
suffix:semicolon
)brace
)brace
DECL|variable|snd_gf1_pcm_playback
r_static
id|snd_pcm_hardware_t
id|snd_gf1_pcm_playback
op_assign
(brace
id|info
suffix:colon
id|SNDRV_PCM_INFO_NONINTERLEAVED
comma
id|formats
suffix:colon
(paren
id|SNDRV_PCM_FMTBIT_S8
op_or
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
op_or
id|SNDRV_PCM_FMTBIT_U16_LE
)paren
comma
id|rates
suffix:colon
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_44100
comma
id|rate_min
suffix:colon
l_int|5510
comma
id|rate_max
suffix:colon
l_int|48000
comma
id|channels_min
suffix:colon
l_int|1
comma
id|channels_max
suffix:colon
l_int|2
comma
id|buffer_bytes_max
suffix:colon
(paren
l_int|128
op_star
l_int|1024
)paren
comma
id|period_bytes_min
suffix:colon
l_int|64
comma
id|period_bytes_max
suffix:colon
(paren
l_int|128
op_star
l_int|1024
)paren
comma
id|periods_min
suffix:colon
l_int|1
comma
id|periods_max
suffix:colon
l_int|1024
comma
id|fifo_size
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|snd_gf1_pcm_capture
r_static
id|snd_pcm_hardware_t
id|snd_gf1_pcm_capture
op_assign
(brace
id|info
suffix:colon
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
id|formats
suffix:colon
id|SNDRV_PCM_FMTBIT_S8
op_or
id|SNDRV_PCM_FMTBIT_U8
comma
id|rates
suffix:colon
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_44100
comma
id|rate_min
suffix:colon
l_int|5510
comma
id|rate_max
suffix:colon
l_int|44100
comma
id|channels_min
suffix:colon
l_int|1
comma
id|channels_max
suffix:colon
l_int|2
comma
id|buffer_bytes_max
suffix:colon
(paren
l_int|128
op_star
l_int|1024
)paren
comma
id|period_bytes_min
suffix:colon
l_int|64
comma
id|period_bytes_max
suffix:colon
(paren
l_int|128
op_star
l_int|1024
)paren
comma
id|periods_min
suffix:colon
l_int|1
comma
id|periods_max
suffix:colon
l_int|1024
comma
id|fifo_size
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
DECL|function|snd_gf1_pcm_playback_free
r_static
r_void
id|snd_gf1_pcm_playback_free
c_func
(paren
id|snd_pcm_runtime_t
op_star
id|runtime
)paren
(brace
id|gus_pcm_private_t
op_star
id|pcmp
op_assign
id|snd_magic_cast
c_func
(paren
id|gus_pcm_private_t
comma
id|runtime-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|snd_magic_kfree
c_func
(paren
id|pcmp
)paren
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_playback_open
r_static
r_int
id|snd_gf1_pcm_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|gus_pcm_private_t
op_star
id|pcmp
suffix:semicolon
id|snd_gus_card_t
op_star
id|gus
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
id|pcmp
op_assign
id|snd_magic_kcalloc
c_func
(paren
id|gus_pcm_private_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcmp
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|pcmp-&gt;gus
op_assign
id|gus
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|pcmp-&gt;lock
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|pcmp-&gt;sleep
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|pcmp-&gt;dma_count
comma
l_int|0
)paren
suffix:semicolon
id|runtime-&gt;private_data
op_assign
id|pcmp
suffix:semicolon
id|runtime-&gt;private_free
op_assign
id|snd_gf1_pcm_playback_free
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;playback.buffer = 0x%lx, gf1.pcm_buffer = 0x%lx&bslash;n&quot;
comma
(paren
r_int
)paren
id|pcm-&gt;playback.buffer
comma
(paren
r_int
)paren
id|gus-&gt;gf1.pcm_buffer
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_gf1_dma_init
c_func
(paren
id|gus
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|pcmp-&gt;flags
op_assign
id|SNDRV_GF1_PCM_PFLG_NONE
suffix:semicolon
id|pcmp-&gt;substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_gf1_pcm_playback
suffix:semicolon
id|snd_pcm_limit_isa_dma_size
c_func
(paren
id|gus-&gt;gf1.dma1
comma
op_amp
id|runtime-&gt;hw.buffer_bytes_max
)paren
suffix:semicolon
id|snd_pcm_limit_isa_dma_size
c_func
(paren
id|gus-&gt;gf1.dma1
comma
op_amp
id|runtime-&gt;hw.period_bytes_max
)paren
suffix:semicolon
id|snd_pcm_hw_constraint_step
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_PERIOD_BYTES
comma
l_int|64
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_playback_close
r_static
r_int
id|snd_gf1_pcm_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_gus_card_t
op_star
id|gus
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|gus_pcm_private_t
op_star
id|pcmp
op_assign
id|snd_magic_cast
c_func
(paren
id|gus_pcm_private_t
comma
id|runtime-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_int
r_int
id|jiffies_old
suffix:semicolon
id|jiffies_old
op_assign
id|jiffies
suffix:semicolon
r_while
c_loop
(paren
id|atomic_read
c_func
(paren
op_amp
id|pcmp-&gt;dma_count
)paren
OG
l_int|0
)paren
(brace
id|interruptible_sleep_on_timeout
c_func
(paren
op_amp
id|pcmp-&gt;sleep
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
(paren
id|jiffies
op_minus
id|jiffies_old
)paren
OG
l_int|2
op_star
id|HZ
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;gf1 pcm - serious DMA problem&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|snd_gf1_dma_done
c_func
(paren
id|gus
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_capture_open
r_static
r_int
id|snd_gf1_pcm_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_gus_card_t
op_star
id|gus
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|gus-&gt;gf1.interrupt_handler_dma_read
op_assign
id|snd_gf1_pcm_interrupt_dma_read
suffix:semicolon
id|gus-&gt;pcm_cap_substream
op_assign
id|substream
suffix:semicolon
id|substream-&gt;runtime-&gt;hw
op_assign
id|snd_gf1_pcm_capture
suffix:semicolon
id|snd_pcm_limit_isa_dma_size
c_func
(paren
id|gus-&gt;gf1.dma2
comma
op_amp
id|runtime-&gt;hw.buffer_bytes_max
)paren
suffix:semicolon
id|snd_pcm_limit_isa_dma_size
c_func
(paren
id|gus-&gt;gf1.dma2
comma
op_amp
id|runtime-&gt;hw.period_bytes_max
)paren
suffix:semicolon
id|snd_pcm_hw_constraint_ratnums
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
op_amp
id|hw_constraints_clocks
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_capture_close
r_static
r_int
id|snd_gf1_pcm_capture_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_gus_card_t
op_star
id|gus
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|gus-&gt;pcm_cap_substream
op_assign
l_int|NULL
suffix:semicolon
id|snd_gf1_set_default_handlers
c_func
(paren
id|gus
comma
id|SNDRV_GF1_HANDLER_DMA_READ
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_free
r_static
r_void
id|snd_gf1_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|snd_gus_card_t
op_star
id|gus
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_gus_card_t
comma
id|pcm-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|gus-&gt;pcm
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_volume_info
r_static
r_int
id|snd_gf1_pcm_volume_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|127
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_volume_get
r_static
r_int
id|snd_gf1_pcm_volume_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|snd_gus_card_t
op_star
id|gus
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;pcm_volume_level_lock
comma
id|flags
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|gus-&gt;gf1.pcm_volume_level_left1
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
id|gus-&gt;gf1.pcm_volume_level_right1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;pcm_volume_level_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_gf1_pcm_volume_put
r_static
r_int
id|snd_gf1_pcm_volume_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|snd_gus_card_t
op_star
id|gus
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|change
comma
id|idx
suffix:semicolon
r_int
r_int
id|val1
comma
id|val2
comma
id|vol
suffix:semicolon
id|gus_pcm_private_t
op_star
id|pcmp
suffix:semicolon
id|snd_gus_voice_t
op_star
id|pvoice
suffix:semicolon
id|val1
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|127
suffix:semicolon
id|val2
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_amp
l_int|127
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;pcm_volume_level_lock
comma
id|flags
)paren
suffix:semicolon
id|change
op_assign
id|val1
op_ne
id|gus-&gt;gf1.pcm_volume_level_left1
op_logical_or
id|val2
op_ne
id|gus-&gt;gf1.pcm_volume_level_right1
suffix:semicolon
id|gus-&gt;gf1.pcm_volume_level_left1
op_assign
id|val1
suffix:semicolon
id|gus-&gt;gf1.pcm_volume_level_right1
op_assign
id|val2
suffix:semicolon
id|gus-&gt;gf1.pcm_volume_level_left
op_assign
id|snd_gf1_lvol_to_gvol_raw
c_func
(paren
id|val1
op_lshift
l_int|9
)paren
op_lshift
l_int|4
suffix:semicolon
id|gus-&gt;gf1.pcm_volume_level_right
op_assign
id|snd_gf1_lvol_to_gvol_raw
c_func
(paren
id|val2
op_lshift
l_int|9
)paren
op_lshift
l_int|4
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;pcm_volume_level_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* are we active? */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;voice_alloc
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|32
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|pvoice
op_assign
op_amp
id|gus-&gt;gf1.voices
(braket
id|idx
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pvoice-&gt;pcm
)paren
r_continue
suffix:semicolon
id|pcmp
op_assign
id|snd_magic_cast
c_func
(paren
id|gus_pcm_private_t
comma
id|pvoice-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pcmp-&gt;flags
op_amp
id|SNDRV_GF1_PCM_PFLG_ACTIVE
)paren
)paren
r_continue
suffix:semicolon
multiline_comment|/* load real volume - better precision */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_gf1_select_voice
c_func
(paren
id|gus
comma
id|pvoice-&gt;number
)paren
suffix:semicolon
id|snd_gf1_ctrl_stop
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VB_VOLUME_CONTROL
)paren
suffix:semicolon
id|vol
op_assign
id|pvoice
op_eq
id|pcmp-&gt;pvoices
(braket
l_int|0
)braket
ques
c_cond
id|gus-&gt;gf1.pcm_volume_level_left
suffix:colon
id|gus-&gt;gf1.pcm_volume_level_right
suffix:semicolon
id|snd_gf1_write16
c_func
(paren
id|gus
comma
id|SNDRV_GF1_VW_VOLUME
comma
id|vol
)paren
suffix:semicolon
id|pcmp-&gt;final_volume
op_assign
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|gus-&gt;voice_alloc
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|snd_gf1_pcm_volume_control
r_static
id|snd_kcontrol_new_t
id|snd_gf1_pcm_volume_control
op_assign
(brace
id|iface
suffix:colon
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
id|name
suffix:colon
l_string|&quot;PCM Playback Volume&quot;
comma
id|info
suffix:colon
id|snd_gf1_pcm_volume_info
comma
id|get
suffix:colon
id|snd_gf1_pcm_volume_get
comma
id|put
suffix:colon
id|snd_gf1_pcm_volume_put
)brace
suffix:semicolon
DECL|variable|snd_gf1_pcm_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_gf1_pcm_playback_ops
op_assign
(brace
id|open
suffix:colon
id|snd_gf1_pcm_playback_open
comma
id|close
suffix:colon
id|snd_gf1_pcm_playback_close
comma
id|ioctl
suffix:colon
id|snd_pcm_lib_ioctl
comma
id|hw_params
suffix:colon
id|snd_gf1_pcm_playback_hw_params
comma
id|hw_free
suffix:colon
id|snd_gf1_pcm_playback_hw_free
comma
id|prepare
suffix:colon
id|snd_gf1_pcm_playback_prepare
comma
id|trigger
suffix:colon
id|snd_gf1_pcm_playback_trigger
comma
id|pointer
suffix:colon
id|snd_gf1_pcm_playback_pointer
comma
id|copy
suffix:colon
id|snd_gf1_pcm_playback_copy
comma
id|silence
suffix:colon
id|snd_gf1_pcm_playback_silence
comma
)brace
suffix:semicolon
DECL|variable|snd_gf1_pcm_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_gf1_pcm_capture_ops
op_assign
(brace
id|open
suffix:colon
id|snd_gf1_pcm_capture_open
comma
id|close
suffix:colon
id|snd_gf1_pcm_capture_close
comma
id|ioctl
suffix:colon
id|snd_pcm_lib_ioctl
comma
id|hw_params
suffix:colon
id|snd_gf1_pcm_capture_hw_params
comma
id|hw_free
suffix:colon
id|snd_gf1_pcm_capture_hw_free
comma
id|prepare
suffix:colon
id|snd_gf1_pcm_capture_prepare
comma
id|trigger
suffix:colon
id|snd_gf1_pcm_capture_trigger
comma
id|pointer
suffix:colon
id|snd_gf1_pcm_capture_pointer
comma
)brace
suffix:semicolon
DECL|function|snd_gf1_pcm_new
r_int
id|snd_gf1_pcm_new
c_func
(paren
id|snd_gus_card_t
op_star
id|gus
comma
r_int
id|pcm_dev
comma
r_int
id|control_index
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_card_t
op_star
id|card
suffix:semicolon
id|snd_kcontrol_t
op_star
id|kctl
suffix:semicolon
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
id|snd_pcm_substream_t
op_star
id|substream
suffix:semicolon
r_int
id|capture
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
id|card
op_assign
id|gus-&gt;card
suffix:semicolon
id|capture
op_assign
op_logical_neg
id|gus-&gt;interwave
op_logical_and
op_logical_neg
id|gus-&gt;ess_flag
op_logical_and
op_logical_neg
id|gus-&gt;ace_flag
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|card
comma
id|gus-&gt;interwave
ques
c_cond
l_string|&quot;AMD InterWave&quot;
suffix:colon
l_string|&quot;GF1&quot;
comma
id|pcm_dev
comma
id|gus-&gt;gf1.pcm_channels
op_div
l_int|2
comma
id|capture
comma
op_amp
id|pcm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|gus
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_gf1_pcm_free
suffix:semicolon
multiline_comment|/* playback setup */
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_gf1_pcm_playback_ops
)paren
suffix:semicolon
r_for
c_loop
(paren
id|substream
op_assign
id|pcm-&gt;streams
(braket
id|SNDRV_PCM_STREAM_PLAYBACK
)braket
dot
id|substream
suffix:semicolon
id|substream
suffix:semicolon
id|substream
op_assign
id|substream-&gt;next
)paren
id|snd_pcm_lib_preallocate_isa_pages
c_func
(paren
id|substream
comma
l_int|64
op_star
l_int|1024
comma
id|gus-&gt;gf1.dma1
OG
l_int|3
ques
c_cond
l_int|128
op_star
l_int|1024
suffix:colon
l_int|64
op_star
l_int|1024
comma
id|GFP_KERNEL
op_or
id|GFP_DMA
)paren
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|pcm-&gt;dev_subclass
op_assign
id|SNDRV_PCM_SUBCLASS_GENERIC_MIX
suffix:semicolon
r_if
c_cond
(paren
id|capture
)paren
(brace
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_gf1_pcm_capture_ops
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gus-&gt;gf1.dma2
op_eq
id|gus-&gt;gf1.dma1
)paren
id|pcm-&gt;info_flags
op_or_assign
id|SNDRV_PCM_INFO_HALF_DUPLEX
suffix:semicolon
id|snd_pcm_lib_preallocate_isa_pages
c_func
(paren
id|pcm-&gt;streams
(braket
id|SNDRV_PCM_STREAM_CAPTURE
)braket
dot
id|substream
comma
l_int|64
op_star
l_int|1024
comma
id|gus-&gt;gf1.dma2
OG
l_int|3
ques
c_cond
l_int|128
op_star
l_int|1024
suffix:colon
l_int|64
op_star
l_int|1024
comma
id|GFP_KERNEL
op_or
id|GFP_DMA
)paren
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
id|pcm-&gt;id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|gus-&gt;interwave
)paren
(brace
id|sprintf
c_func
(paren
id|pcm-&gt;name
op_plus
id|strlen
c_func
(paren
id|pcm-&gt;name
)paren
comma
l_string|&quot; rev %c&quot;
comma
id|gus-&gt;revision
op_plus
l_char|&squot;A&squot;
)paren
suffix:semicolon
)brace
id|strcat
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot; (synth)&quot;
)paren
suffix:semicolon
id|gus-&gt;pcm
op_assign
id|pcm
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_gf1_pcm_volume_control
comma
id|gus
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|kctl-&gt;id.index
op_assign
id|control_index
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
