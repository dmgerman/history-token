multiline_comment|/*&n; *  Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *  Routines for control of ESS ES1688/688/488 chip&n; *&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/es1688.h&gt;
macro_line|#include &lt;sound/initval.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jaroslav Kysela &lt;perex@suse.cz&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;ESS ESx688 lowlevel module&quot;
)paren
suffix:semicolon
id|MODULE_CLASSES
c_func
(paren
l_string|&quot;{sound}&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|macro|chip_t
mdefine_line|#define chip_t es1688_t
DECL|function|snd_es1688_dsp_command
r_static
r_int
id|snd_es1688_dsp_command
c_func
(paren
id|es1688_t
op_star
id|chip
comma
r_int
r_char
id|val
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|10000
suffix:semicolon
id|i
suffix:semicolon
id|i
op_decrement
)paren
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|STATUS
)paren
)paren
op_amp
l_int|0x80
)paren
op_eq
l_int|0
)paren
(brace
id|outb
c_func
(paren
id|val
comma
id|ES1688P
c_func
(paren
id|chip
comma
id|COMMAND
)paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SND_DEBUG
id|printk
c_func
(paren
l_string|&quot;snd_es1688_dsp_command: timeout (0x%x)&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1688_dsp_get_byte
r_static
r_int
id|snd_es1688_dsp_get_byte
c_func
(paren
id|es1688_t
op_star
id|chip
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1000
suffix:semicolon
id|i
suffix:semicolon
id|i
op_decrement
)paren
r_if
c_cond
(paren
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|DATA_AVAIL
)paren
)paren
op_amp
l_int|0x80
)paren
r_return
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|READ
)paren
)paren
suffix:semicolon
id|snd_printd
c_func
(paren
l_string|&quot;es1688 get byte failed: 0x%lx = 0x%x!!!&bslash;n&quot;
comma
id|ES1688P
c_func
(paren
id|chip
comma
id|DATA_AVAIL
)paren
comma
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|DATA_AVAIL
)paren
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
DECL|function|snd_es1688_write
r_static
r_int
id|snd_es1688_write
c_func
(paren
id|es1688_t
op_star
id|chip
comma
r_int
r_char
id|reg
comma
r_int
r_char
id|data
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|snd_es1688_dsp_command
c_func
(paren
id|chip
comma
id|reg
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|snd_es1688_dsp_command
c_func
(paren
id|chip
comma
id|data
)paren
suffix:semicolon
)brace
DECL|function|snd_es1688_read
r_int
id|snd_es1688_read
c_func
(paren
id|es1688_t
op_star
id|chip
comma
r_int
r_char
id|reg
)paren
(brace
multiline_comment|/* Read a byte from an extended mode register of ES1688 */
r_if
c_cond
(paren
op_logical_neg
id|snd_es1688_dsp_command
c_func
(paren
id|chip
comma
l_int|0xc0
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_es1688_dsp_command
c_func
(paren
id|chip
comma
id|reg
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_return
id|snd_es1688_dsp_get_byte
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
DECL|function|snd_es1688_mixer_write
r_void
id|snd_es1688_mixer_write
c_func
(paren
id|es1688_t
op_star
id|chip
comma
r_int
r_char
id|reg
comma
r_int
r_char
id|data
)paren
(brace
id|outb
c_func
(paren
id|reg
comma
id|ES1688P
c_func
(paren
id|chip
comma
id|MIXER_ADDR
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|outb
c_func
(paren
id|data
comma
id|ES1688P
c_func
(paren
id|chip
comma
id|MIXER_DATA
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
DECL|function|snd_es1688_mixer_read
r_int
r_char
id|snd_es1688_mixer_read
c_func
(paren
id|es1688_t
op_star
id|chip
comma
r_int
r_char
id|reg
)paren
(brace
r_int
r_char
id|result
suffix:semicolon
id|outb
c_func
(paren
id|reg
comma
id|ES1688P
c_func
(paren
id|chip
comma
id|MIXER_ADDR
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|result
op_assign
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|MIXER_DATA
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_es1688_reset
r_static
r_int
id|snd_es1688_reset
c_func
(paren
id|es1688_t
op_star
id|chip
)paren
(brace
r_int
id|i
suffix:semicolon
id|outb
c_func
(paren
l_int|3
comma
id|ES1688P
c_func
(paren
id|chip
comma
id|RESET
)paren
)paren
suffix:semicolon
multiline_comment|/* valid only for ESS chips, SB -&gt; 1 */
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|ES1688P
c_func
(paren
id|chip
comma
id|RESET
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|30
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|1000
op_logical_and
op_logical_neg
(paren
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|DATA_AVAIL
)paren
)paren
op_amp
l_int|0x80
)paren
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|READ
)paren
)paren
op_ne
l_int|0xaa
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;ess_reset at 0x%lx: failed!!!&bslash;n&quot;
comma
id|chip-&gt;port
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|snd_es1688_dsp_command
c_func
(paren
id|chip
comma
l_int|0xc6
)paren
suffix:semicolon
multiline_comment|/* enable extended mode */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1688_probe
r_static
r_int
id|snd_es1688_probe
c_func
(paren
id|es1688_t
op_star
id|chip
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|major
comma
id|minor
comma
id|hw
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/*&n;&t; *  initialization sequence&n;&t; */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* Some ESS1688 cards need this */
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|ENABLE1
)paren
)paren
suffix:semicolon
multiline_comment|/* ENABLE1 */
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|ENABLE1
)paren
)paren
suffix:semicolon
multiline_comment|/* ENABLE1 */
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|ENABLE1
)paren
)paren
suffix:semicolon
multiline_comment|/* ENABLE1 */
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|ENABLE2
)paren
)paren
suffix:semicolon
multiline_comment|/* ENABLE2 */
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|ENABLE1
)paren
)paren
suffix:semicolon
multiline_comment|/* ENABLE1 */
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|ENABLE2
)paren
)paren
suffix:semicolon
multiline_comment|/* ENABLE2 */
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|ENABLE1
)paren
)paren
suffix:semicolon
multiline_comment|/* ENABLE1 */
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|ENABLE1
)paren
)paren
suffix:semicolon
multiline_comment|/* ENABLE1 */
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|ENABLE2
)paren
)paren
suffix:semicolon
multiline_comment|/* ENABLE2 */
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|ENABLE1
)paren
)paren
suffix:semicolon
multiline_comment|/* ENABLE1 */
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|ENABLE0
)paren
)paren
suffix:semicolon
multiline_comment|/* ENABLE0 */
r_if
c_cond
(paren
id|snd_es1688_reset
c_func
(paren
id|chip
)paren
OL
l_int|0
)paren
(brace
id|snd_printdd
c_func
(paren
l_string|&quot;ESS: [0x%lx] reset failed... 0x%x&bslash;n&quot;
comma
id|chip-&gt;port
comma
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|READ
)paren
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|snd_es1688_dsp_command
c_func
(paren
id|chip
comma
l_int|0xe7
)paren
suffix:semicolon
multiline_comment|/* return identification */
r_for
c_loop
(paren
id|i
op_assign
l_int|1000
comma
id|major
op_assign
id|minor
op_assign
l_int|0
suffix:semicolon
id|i
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|DATA_AVAIL
)paren
)paren
op_amp
l_int|0x80
)paren
(brace
r_if
c_cond
(paren
id|major
op_eq
l_int|0
)paren
(brace
id|major
op_assign
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|READ
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|minor
op_assign
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|READ
)paren
)paren
suffix:semicolon
)brace
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_printdd
c_func
(paren
l_string|&quot;ESS: [0x%lx] found.. major = 0x%x, minor = 0x%x&bslash;n&quot;
comma
id|chip-&gt;port
comma
id|major
comma
id|minor
)paren
suffix:semicolon
id|chip-&gt;version
op_assign
(paren
id|major
op_lshift
l_int|8
)paren
op_or
id|minor
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chip-&gt;version
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/* probably SB */
id|hw
op_assign
id|ES1688_HW_AUTO
suffix:semicolon
r_switch
c_cond
(paren
id|chip-&gt;version
op_amp
l_int|0xfff0
)paren
(brace
r_case
l_int|0x4880
suffix:colon
id|snd_printk
c_func
(paren
l_string|&quot;[0x%lx] ESS: AudioDrive ES488 detected, but driver is in another place&bslash;n&quot;
comma
id|chip-&gt;port
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
r_case
l_int|0x6880
suffix:colon
id|hw
op_assign
(paren
id|chip-&gt;version
op_amp
l_int|0x0f
)paren
op_ge
l_int|8
ques
c_cond
id|ES1688_HW_1688
suffix:colon
id|ES1688_HW_688
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|snd_printk
c_func
(paren
l_string|&quot;[0x%lx] ESS: unknown AudioDrive chip with version 0x%x (Jazz16 soundcard?)&bslash;n&quot;
comma
id|chip-&gt;port
comma
id|chip-&gt;version
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb1
comma
l_int|0x10
)paren
suffix:semicolon
multiline_comment|/* disable IRQ */
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb2
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* disable DMA */
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* enable joystick, but disable OPL3 */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_es1688_mixer_write
c_func
(paren
id|chip
comma
l_int|0x40
comma
l_int|0x01
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1688_init
r_static
r_int
id|snd_es1688_init
c_func
(paren
id|es1688_t
op_star
id|chip
comma
r_int
id|enable
)paren
(brace
r_static
r_int
id|irqs
(braket
l_int|16
)braket
op_assign
(brace
op_minus
l_int|1
comma
op_minus
l_int|1
comma
l_int|0
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
l_int|1
comma
op_minus
l_int|1
comma
l_int|2
comma
op_minus
l_int|1
comma
l_int|0
comma
l_int|3
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
op_minus
l_int|1
)brace
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|cfg
comma
id|irq_bits
comma
id|dma
comma
id|dma_bits
comma
id|tmp
comma
id|tmp1
suffix:semicolon
multiline_comment|/* ok.. setup MPU-401 port and joystick and OPL3 */
id|cfg
op_assign
l_int|0x01
suffix:semicolon
multiline_comment|/* enable joystick, but disable OPL3 */
r_if
c_cond
(paren
id|enable
op_logical_and
id|chip-&gt;mpu_port
op_ge
l_int|0x300
op_logical_and
id|chip-&gt;mpu_irq
OG
l_int|0
op_logical_and
id|chip-&gt;hardware
op_ne
id|ES1688_HW_688
)paren
(brace
id|tmp
op_assign
(paren
id|chip-&gt;mpu_port
op_amp
l_int|0x0f0
)paren
op_rshift
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_le
l_int|3
)paren
(brace
r_switch
c_cond
(paren
id|chip-&gt;mpu_irq
)paren
(brace
r_case
l_int|9
suffix:colon
id|tmp1
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|5
suffix:colon
id|tmp1
op_assign
l_int|5
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|7
suffix:colon
id|tmp1
op_assign
l_int|6
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|10
suffix:colon
id|tmp1
op_assign
l_int|7
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|tmp1
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tmp1
)paren
(brace
id|cfg
op_or_assign
(paren
id|tmp
op_lshift
l_int|3
)paren
op_or
(paren
id|tmp1
op_lshift
l_int|5
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#if 0
id|snd_printk
c_func
(paren
l_string|&quot;mpu cfg = 0x%x&bslash;n&quot;
comma
id|cfg
)paren
suffix:semicolon
macro_line|#endif
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_es1688_mixer_write
c_func
(paren
id|chip
comma
l_int|0x40
comma
id|cfg
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* --- */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_es1688_read
c_func
(paren
id|chip
comma
l_int|0xb1
)paren
suffix:semicolon
id|snd_es1688_read
c_func
(paren
id|chip
comma
l_int|0xb2
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enable
)paren
(brace
id|cfg
op_assign
l_int|0xf0
suffix:semicolon
multiline_comment|/* enable only DMA counter interrupt */
id|irq_bits
op_assign
id|irqs
(braket
id|chip-&gt;irq
op_amp
l_int|0x0f
)braket
suffix:semicolon
r_if
c_cond
(paren
id|irq_bits
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;[0x%lx] ESS: bad IRQ %d for ES1688 chip!!&bslash;n&quot;
comma
id|chip-&gt;port
comma
id|chip-&gt;irq
)paren
suffix:semicolon
macro_line|#if 0
id|irq_bits
op_assign
l_int|0
suffix:semicolon
id|cfg
op_assign
l_int|0x10
suffix:semicolon
macro_line|#endif
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb1
comma
id|cfg
op_or
(paren
id|irq_bits
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|cfg
op_assign
l_int|0xf0
suffix:semicolon
multiline_comment|/* extended mode DMA enable */
id|dma
op_assign
id|chip-&gt;dma8
suffix:semicolon
r_if
c_cond
(paren
id|dma
OG
l_int|3
op_logical_or
id|dma
op_eq
l_int|2
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;[0x%lx] ESS: bad DMA channel %d for ES1688 chip!!&bslash;n&quot;
comma
id|chip-&gt;port
comma
id|dma
)paren
suffix:semicolon
macro_line|#if 0
id|dma_bits
op_assign
l_int|0
suffix:semicolon
id|cfg
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* disable all DMA */
macro_line|#endif
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_else
(brace
id|dma_bits
op_assign
id|dma
suffix:semicolon
r_if
c_cond
(paren
id|dma
op_ne
l_int|3
)paren
id|dma_bits
op_increment
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb2
comma
id|cfg
op_or
(paren
id|dma_bits
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_else
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb1
comma
l_int|0x10
)paren
suffix:semicolon
multiline_comment|/* disable IRQ */
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb2
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* disable DMA */
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_es1688_read
c_func
(paren
id|chip
comma
l_int|0xb1
)paren
suffix:semicolon
id|snd_es1688_read
c_func
(paren
id|chip
comma
l_int|0xb2
)paren
suffix:semicolon
id|snd_es1688_reset
c_func
(paren
id|chip
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&n; */
DECL|variable|clocks
r_static
id|ratnum_t
id|clocks
(braket
l_int|2
)braket
op_assign
(brace
(brace
dot
id|num
op_assign
l_int|795444
comma
dot
id|den_min
op_assign
l_int|1
comma
dot
id|den_max
op_assign
l_int|128
comma
dot
id|den_step
op_assign
l_int|1
comma
)brace
comma
(brace
dot
id|num
op_assign
l_int|397722
comma
dot
id|den_min
op_assign
l_int|1
comma
dot
id|den_max
op_assign
l_int|128
comma
dot
id|den_step
op_assign
l_int|1
comma
)brace
)brace
suffix:semicolon
DECL|variable|hw_constraints_clocks
r_static
id|snd_pcm_hw_constraint_ratnums_t
id|hw_constraints_clocks
op_assign
(brace
dot
id|nrats
op_assign
l_int|2
comma
dot
id|rats
op_assign
id|clocks
comma
)brace
suffix:semicolon
DECL|function|snd_es1688_set_rate
r_static
r_void
id|snd_es1688_set_rate
c_func
(paren
id|es1688_t
op_star
id|chip
comma
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
r_int
id|bits
comma
id|divider
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;rate_num
op_eq
id|clocks
(braket
l_int|0
)braket
dot
id|num
)paren
id|bits
op_assign
l_int|256
op_minus
id|runtime-&gt;rate_den
suffix:semicolon
r_else
id|bits
op_assign
l_int|128
op_minus
id|runtime-&gt;rate_den
suffix:semicolon
multiline_comment|/* set filter register */
id|divider
op_assign
l_int|256
op_minus
l_int|7160000
op_star
l_int|20
op_div
(paren
l_int|8
op_star
l_int|82
op_star
id|runtime-&gt;rate
)paren
suffix:semicolon
multiline_comment|/* write result to hardware */
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xa1
comma
id|bits
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xa2
comma
id|divider
)paren
suffix:semicolon
)brace
DECL|function|snd_es1688_ioctl
r_static
r_int
id|snd_es1688_ioctl
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_return
id|snd_pcm_lib_ioctl
c_func
(paren
id|substream
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|function|snd_es1688_trigger
r_static
r_int
id|snd_es1688_trigger
c_func
(paren
id|es1688_t
op_star
id|chip
comma
r_int
id|cmd
comma
r_int
r_char
id|value
)paren
(brace
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_STOP
)paren
(brace
id|value
op_assign
l_int|0x00
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cmd
op_ne
id|SNDRV_PCM_TRIGGER_START
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|chip-&gt;trigger_value
op_assign
id|value
suffix:semicolon
id|val
op_assign
id|snd_es1688_read
c_func
(paren
id|chip
comma
l_int|0xb8
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
OL
l_int|0
)paren
op_logical_or
(paren
id|val
op_amp
l_int|0x0f
)paren
op_eq
id|value
)paren
(brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* something is wrong */
)brace
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;trigger: val = 0x%x, value = 0x%x&bslash;n&quot;
comma
id|val
comma
id|value
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;trigger: pointer = 0x%x&bslash;n&quot;
comma
id|snd_dma_pointer
c_func
(paren
id|chip-&gt;dma8
comma
id|chip-&gt;dma_size
)paren
)paren
suffix:semicolon
macro_line|#endif
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb8
comma
(paren
id|val
op_amp
l_int|0xf0
)paren
op_or
id|value
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1688_hw_params
r_static
r_int
id|snd_es1688_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
r_return
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_es1688_hw_free
r_static
r_int
id|snd_es1688_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
DECL|function|snd_es1688_playback_prepare
r_static
r_int
id|snd_es1688_playback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|es1688_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
r_int
id|size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|count
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;dma_size
op_assign
id|size
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_es1688_reset
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_es1688_set_rate
c_func
(paren
id|chip
comma
id|substream
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb8
comma
l_int|4
)paren
suffix:semicolon
multiline_comment|/* auto init DMA mode */
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xa8
comma
(paren
id|snd_es1688_read
c_func
(paren
id|chip
comma
l_int|0xa8
)paren
op_amp
op_complement
l_int|0x03
)paren
op_or
(paren
l_int|3
op_minus
id|runtime-&gt;channels
)paren
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb9
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* demand mode (4 bytes/request) */
r_if
c_cond
(paren
id|runtime-&gt;channels
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|8
)paren
(brace
multiline_comment|/* 8. bit mono */
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb6
comma
l_int|0x80
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb7
comma
l_int|0x51
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb7
comma
l_int|0xd0
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* 16. bit mono */
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb6
comma
l_int|0x00
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb7
comma
l_int|0x71
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb7
comma
l_int|0xf4
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|8
)paren
(brace
multiline_comment|/* 8. bit stereo */
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb6
comma
l_int|0x80
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb7
comma
l_int|0x51
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb7
comma
l_int|0x98
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* 16. bit stereo */
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb6
comma
l_int|0x00
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb7
comma
l_int|0x71
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb7
comma
l_int|0xbc
)paren
suffix:semicolon
)brace
)brace
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb1
comma
(paren
id|snd_es1688_read
c_func
(paren
id|chip
comma
l_int|0xb1
)paren
op_amp
l_int|0x0f
)paren
op_or
l_int|0x50
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb2
comma
(paren
id|snd_es1688_read
c_func
(paren
id|chip
comma
l_int|0xb2
)paren
op_amp
l_int|0x0f
)paren
op_or
l_int|0x50
)paren
suffix:semicolon
id|snd_es1688_dsp_command
c_func
(paren
id|chip
comma
id|ES1688_DSP_CMD_SPKON
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* --- */
id|count
op_assign
op_minus
id|count
suffix:semicolon
id|snd_dma_program
c_func
(paren
id|chip-&gt;dma8
comma
id|runtime-&gt;dma_addr
comma
id|size
comma
id|DMA_MODE_WRITE
op_or
id|DMA_AUTOINIT
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xa4
comma
(paren
r_int
r_char
)paren
id|count
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xa5
comma
(paren
r_int
r_char
)paren
(paren
id|count
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1688_playback_trigger
r_static
r_int
id|snd_es1688_playback_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|es1688_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|snd_es1688_trigger
c_func
(paren
id|chip
comma
id|cmd
comma
l_int|0x05
)paren
suffix:semicolon
)brace
DECL|function|snd_es1688_capture_prepare
r_static
r_int
id|snd_es1688_capture_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|es1688_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
r_int
id|size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|count
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;dma_size
op_assign
id|size
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_es1688_reset
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_es1688_set_rate
c_func
(paren
id|chip
comma
id|substream
)paren
suffix:semicolon
id|snd_es1688_dsp_command
c_func
(paren
id|chip
comma
id|ES1688_DSP_CMD_SPKOFF
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb8
comma
l_int|0x0e
)paren
suffix:semicolon
multiline_comment|/* auto init DMA mode */
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xa8
comma
(paren
id|snd_es1688_read
c_func
(paren
id|chip
comma
l_int|0xa8
)paren
op_amp
op_complement
l_int|0x03
)paren
op_or
(paren
l_int|3
op_minus
id|runtime-&gt;channels
)paren
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb9
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* demand mode (4 bytes/request) */
r_if
c_cond
(paren
id|runtime-&gt;channels
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|8
)paren
(brace
multiline_comment|/* 8. bit mono */
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb7
comma
l_int|0x51
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb7
comma
l_int|0xd0
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* 16. bit mono */
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb7
comma
l_int|0x71
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb7
comma
l_int|0xf4
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|8
)paren
(brace
multiline_comment|/* 8. bit stereo */
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb7
comma
l_int|0x51
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb7
comma
l_int|0x98
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* 16. bit stereo */
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb7
comma
l_int|0x71
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb7
comma
l_int|0xbc
)paren
suffix:semicolon
)brace
)brace
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb1
comma
(paren
id|snd_es1688_read
c_func
(paren
id|chip
comma
l_int|0xb1
)paren
op_amp
l_int|0x0f
)paren
op_or
l_int|0x50
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xb2
comma
(paren
id|snd_es1688_read
c_func
(paren
id|chip
comma
l_int|0xb2
)paren
op_amp
l_int|0x0f
)paren
op_or
l_int|0x50
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* --- */
id|count
op_assign
op_minus
id|count
suffix:semicolon
id|snd_dma_program
c_func
(paren
id|chip-&gt;dma8
comma
id|runtime-&gt;dma_addr
comma
id|size
comma
id|DMA_MODE_READ
op_or
id|DMA_AUTOINIT
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xa4
comma
(paren
r_int
r_char
)paren
id|count
)paren
suffix:semicolon
id|snd_es1688_write
c_func
(paren
id|chip
comma
l_int|0xa5
comma
(paren
r_int
r_char
)paren
(paren
id|count
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1688_capture_trigger
r_static
r_int
id|snd_es1688_capture_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|es1688_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|snd_es1688_trigger
c_func
(paren
id|chip
comma
id|cmd
comma
l_int|0x0f
)paren
suffix:semicolon
)brace
DECL|function|snd_es1688_interrupt
r_void
id|snd_es1688_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|es1688_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|es1688_t
comma
id|dev_id
comma
r_return
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;trigger_value
op_eq
l_int|0x05
)paren
multiline_comment|/* ok.. playback is active */
id|snd_pcm_period_elapsed
c_func
(paren
id|chip-&gt;playback_substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;trigger_value
op_eq
l_int|0x0f
)paren
multiline_comment|/* ok.. capture is active */
id|snd_pcm_period_elapsed
c_func
(paren
id|chip-&gt;capture_substream
)paren
suffix:semicolon
id|inb
c_func
(paren
id|ES1688P
c_func
(paren
id|chip
comma
id|DATA_AVAIL
)paren
)paren
suffix:semicolon
multiline_comment|/* ack interrupt */
)brace
DECL|function|snd_es1688_playback_pointer
r_static
id|snd_pcm_uframes_t
id|snd_es1688_playback_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|es1688_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;trigger_value
op_ne
l_int|0x05
)paren
r_return
l_int|0
suffix:semicolon
id|ptr
op_assign
id|snd_dma_pointer
c_func
(paren
id|chip-&gt;dma8
comma
id|chip-&gt;dma_size
)paren
suffix:semicolon
r_return
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|ptr
)paren
suffix:semicolon
)brace
DECL|function|snd_es1688_capture_pointer
r_static
id|snd_pcm_uframes_t
id|snd_es1688_capture_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|es1688_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;trigger_value
op_ne
l_int|0x0f
)paren
r_return
l_int|0
suffix:semicolon
id|ptr
op_assign
id|snd_dma_pointer
c_func
(paren
id|chip-&gt;dma8
comma
id|chip-&gt;dma_size
)paren
suffix:semicolon
r_return
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|ptr
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&n; */
DECL|variable|snd_es1688_playback
r_static
id|snd_pcm_hardware_t
id|snd_es1688_playback
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
dot
id|rate_min
op_assign
l_int|4000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
l_int|65536
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
l_int|65536
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|1024
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|snd_es1688_capture
r_static
id|snd_pcm_hardware_t
id|snd_es1688_capture
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
dot
id|rate_min
op_assign
l_int|4000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
l_int|65536
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
l_int|65536
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|1024
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/*&n;&n; */
DECL|function|snd_es1688_playback_open
r_static
r_int
id|snd_es1688_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|es1688_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;capture_substream
op_ne
l_int|NULL
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|chip-&gt;playback_substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_es1688_playback
suffix:semicolon
id|snd_pcm_hw_constraint_ratnums
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
op_amp
id|hw_constraints_clocks
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1688_capture_open
r_static
r_int
id|snd_es1688_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|es1688_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;playback_substream
op_ne
l_int|NULL
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|chip-&gt;capture_substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_es1688_capture
suffix:semicolon
id|snd_pcm_hw_constraint_ratnums
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
op_amp
id|hw_constraints_clocks
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1688_playback_close
r_static
r_int
id|snd_es1688_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|es1688_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;playback_substream
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1688_capture_close
r_static
r_int
id|snd_es1688_capture_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|es1688_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;capture_substream
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1688_free
r_static
r_int
id|snd_es1688_free
c_func
(paren
id|es1688_t
op_star
id|chip
)paren
(brace
r_if
c_cond
(paren
id|chip-&gt;res_port
)paren
(brace
id|snd_es1688_init
c_func
(paren
id|chip
comma
l_int|0
)paren
suffix:semicolon
id|release_resource
c_func
(paren
id|chip-&gt;res_port
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|chip-&gt;res_port
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chip-&gt;irq
op_ge
l_int|0
)paren
id|free_irq
c_func
(paren
id|chip-&gt;irq
comma
(paren
r_void
op_star
)paren
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;dma8
op_ge
l_int|0
)paren
(brace
id|disable_dma
c_func
(paren
id|chip-&gt;dma8
)paren
suffix:semicolon
id|free_dma
c_func
(paren
id|chip-&gt;dma8
)paren
suffix:semicolon
)brace
id|snd_magic_kfree
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1688_dev_free
r_static
r_int
id|snd_es1688_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|es1688_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|es1688_t
comma
id|device-&gt;device_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_return
id|snd_es1688_free
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
DECL|function|snd_es1688_chip_id
r_static
r_const
r_char
op_star
id|snd_es1688_chip_id
c_func
(paren
id|es1688_t
op_star
id|chip
)paren
(brace
r_static
r_char
id|tmp
(braket
l_int|16
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|tmp
comma
l_string|&quot;ES%s688 rev %i&quot;
comma
id|chip-&gt;hardware
op_eq
id|ES1688_HW_688
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;1&quot;
comma
id|chip-&gt;version
op_amp
l_int|0x0f
)paren
suffix:semicolon
r_return
id|tmp
suffix:semicolon
)brace
DECL|function|snd_es1688_create
r_int
id|snd_es1688_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_int
r_int
id|port
comma
r_int
r_int
id|mpu_port
comma
r_int
id|irq
comma
r_int
id|mpu_irq
comma
r_int
id|dma8
comma
r_int
r_int
id|hardware
comma
id|es1688_t
op_star
op_star
id|rchip
)paren
(brace
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
dot
id|dev_free
op_assign
id|snd_es1688_dev_free
comma
)brace
suffix:semicolon
id|es1688_t
op_star
id|chip
suffix:semicolon
r_int
id|err
suffix:semicolon
op_star
id|rchip
op_assign
l_int|NULL
suffix:semicolon
id|chip
op_assign
id|snd_magic_kcalloc
c_func
(paren
id|es1688_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|chip-&gt;irq
op_assign
op_minus
l_int|1
suffix:semicolon
id|chip-&gt;dma8
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chip-&gt;res_port
op_assign
id|request_region
c_func
(paren
id|port
op_plus
l_int|4
comma
l_int|12
comma
l_string|&quot;ES1688&quot;
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_es1688_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|irq
comma
id|snd_es1688_interrupt
comma
id|SA_INTERRUPT
comma
l_string|&quot;ES1688&quot;
comma
(paren
r_void
op_star
)paren
id|chip
)paren
)paren
(brace
id|snd_es1688_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|chip-&gt;irq
op_assign
id|irq
suffix:semicolon
r_if
c_cond
(paren
id|request_dma
c_func
(paren
id|dma8
comma
l_string|&quot;ES1688&quot;
)paren
)paren
(brace
id|snd_es1688_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|chip-&gt;dma8
op_assign
id|dma8
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|chip-&gt;mixer_lock
)paren
suffix:semicolon
id|chip-&gt;card
op_assign
id|card
suffix:semicolon
id|chip-&gt;port
op_assign
id|port
suffix:semicolon
id|mpu_port
op_and_assign
op_complement
l_int|0x000f
suffix:semicolon
r_if
c_cond
(paren
id|mpu_port
template_param
l_int|0x330
)paren
id|mpu_port
op_assign
l_int|0
suffix:semicolon
id|chip-&gt;mpu_port
op_assign
id|mpu_port
suffix:semicolon
id|chip-&gt;mpu_irq
op_assign
id|mpu_irq
suffix:semicolon
id|chip-&gt;hardware
op_assign
id|hardware
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_es1688_probe
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_es1688_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_es1688_init
c_func
(paren
id|chip
comma
l_int|1
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_es1688_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* Register device */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|chip
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_es1688_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
op_star
id|rchip
op_assign
id|chip
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_es1688_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_es1688_playback_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_es1688_playback_open
comma
dot
id|close
op_assign
id|snd_es1688_playback_close
comma
dot
id|ioctl
op_assign
id|snd_es1688_ioctl
comma
dot
id|hw_params
op_assign
id|snd_es1688_hw_params
comma
dot
id|hw_free
op_assign
id|snd_es1688_hw_free
comma
dot
id|prepare
op_assign
id|snd_es1688_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_es1688_playback_trigger
comma
dot
id|pointer
op_assign
id|snd_es1688_playback_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_es1688_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_es1688_capture_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_es1688_capture_open
comma
dot
id|close
op_assign
id|snd_es1688_capture_close
comma
dot
id|ioctl
op_assign
id|snd_es1688_ioctl
comma
dot
id|hw_params
op_assign
id|snd_es1688_hw_params
comma
dot
id|hw_free
op_assign
id|snd_es1688_hw_free
comma
dot
id|prepare
op_assign
id|snd_es1688_capture_prepare
comma
dot
id|trigger
op_assign
id|snd_es1688_capture_trigger
comma
dot
id|pointer
op_assign
id|snd_es1688_capture_pointer
comma
)brace
suffix:semicolon
DECL|function|snd_es1688_pcm_free
r_static
r_void
id|snd_es1688_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|es1688_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|es1688_t
comma
id|pcm-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|chip-&gt;pcm
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_es1688_pcm
r_int
id|snd_es1688_pcm
c_func
(paren
id|es1688_t
op_star
id|chip
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;ESx688&quot;
comma
id|device
comma
l_int|1
comma
l_int|1
comma
op_amp
id|pcm
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_es1688_playback_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_es1688_capture_ops
)paren
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_es1688_pcm_free
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
id|SNDRV_PCM_INFO_HALF_DUPLEX
suffix:semicolon
id|sprintf
c_func
(paren
id|pcm-&gt;name
comma
id|snd_es1688_chip_id
c_func
(paren
id|chip
)paren
)paren
suffix:semicolon
id|chip-&gt;pcm
op_assign
id|pcm
suffix:semicolon
id|snd_pcm_lib_preallocate_isa_pages_for_all
c_func
(paren
id|pcm
comma
l_int|64
op_star
l_int|1024
comma
l_int|64
op_star
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  MIXER part&n; */
DECL|function|snd_es1688_info_mux
r_static
r_int
id|snd_es1688_info_mux
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_static
r_char
op_star
id|texts
(braket
l_int|9
)braket
op_assign
(brace
l_string|&quot;Mic&quot;
comma
l_string|&quot;Mic Master&quot;
comma
l_string|&quot;CD&quot;
comma
l_string|&quot;AOUT&quot;
comma
l_string|&quot;Mic1&quot;
comma
l_string|&quot;Mix&quot;
comma
l_string|&quot;Line&quot;
comma
l_string|&quot;Master&quot;
)brace
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_ENUMERATED
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.enumerated.items
op_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|uinfo-&gt;value.enumerated.item
OG
l_int|7
)paren
id|uinfo-&gt;value.enumerated.item
op_assign
l_int|7
suffix:semicolon
id|strcpy
c_func
(paren
id|uinfo-&gt;value.enumerated.name
comma
id|texts
(braket
id|uinfo-&gt;value.enumerated.item
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1688_get_mux
r_static
r_int
id|snd_es1688_get_mux
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|es1688_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
op_assign
id|snd_es1688_mixer_read
c_func
(paren
id|chip
comma
id|ES1688_REC_DEV
)paren
op_amp
l_int|7
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1688_put_mux
r_static
r_int
id|snd_es1688_put_mux
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|es1688_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|oval
comma
id|nval
suffix:semicolon
r_int
id|change
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
OG
l_int|8
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|oval
op_assign
id|snd_es1688_mixer_read
c_func
(paren
id|chip
comma
id|ES1688_REC_DEV
)paren
suffix:semicolon
id|nval
op_assign
(paren
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
op_amp
l_int|7
)paren
op_or
(paren
id|oval
op_amp
op_complement
l_int|15
)paren
suffix:semicolon
id|change
op_assign
id|nval
op_ne
id|oval
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
id|snd_es1688_mixer_write
c_func
(paren
id|chip
comma
id|ES1688_REC_DEV
comma
id|nval
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|macro|ES1688_SINGLE
mdefine_line|#define ES1688_SINGLE(xname, xindex, reg, shift, mask, invert) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, .index = xindex, &bslash;&n;  .info = snd_es1688_info_single, &bslash;&n;  .get = snd_es1688_get_single, .put = snd_es1688_put_single, &bslash;&n;  .private_value = reg | (shift &lt;&lt; 8) | (mask &lt;&lt; 16) | (invert &lt;&lt; 24) }
DECL|function|snd_es1688_info_single
r_static
r_int
id|snd_es1688_info_single
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|mask
op_eq
l_int|1
ques
c_cond
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:colon
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
id|mask
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1688_get_single
r_static
r_int
id|snd_es1688_get_single
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|es1688_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|snd_es1688_mixer_read
c_func
(paren
id|chip
comma
id|reg
)paren
op_rshift
id|shift
)paren
op_amp
id|mask
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|mask
op_minus
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1688_put_single
r_static
r_int
id|snd_es1688_put_single
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|es1688_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|change
suffix:semicolon
r_int
r_char
id|oval
comma
id|nval
suffix:semicolon
id|nval
op_assign
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
id|mask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
id|nval
op_assign
id|mask
op_minus
id|nval
suffix:semicolon
id|nval
op_lshift_assign
id|shift
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|oval
op_assign
id|snd_es1688_mixer_read
c_func
(paren
id|chip
comma
id|reg
)paren
suffix:semicolon
id|nval
op_assign
(paren
id|oval
op_amp
op_complement
(paren
id|mask
op_lshift
id|shift
)paren
)paren
op_or
id|nval
suffix:semicolon
id|change
op_assign
id|nval
op_ne
id|oval
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
id|snd_es1688_mixer_write
c_func
(paren
id|chip
comma
id|reg
comma
id|nval
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|macro|ES1688_DOUBLE
mdefine_line|#define ES1688_DOUBLE(xname, xindex, left_reg, right_reg, shift_left, shift_right, mask, invert) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, .index = xindex, &bslash;&n;  .info = snd_es1688_info_double, &bslash;&n;  .get = snd_es1688_get_double, .put = snd_es1688_put_double, &bslash;&n;  .private_value = left_reg | (right_reg &lt;&lt; 8) | (shift_left &lt;&lt; 16) | (shift_right &lt;&lt; 19) | (mask &lt;&lt; 24) | (invert &lt;&lt; 22) }
DECL|function|snd_es1688_info_double
r_static
r_int
id|snd_es1688_info_double
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|mask
op_eq
l_int|1
ques
c_cond
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:colon
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
id|mask
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1688_get_double
r_static
r_int
id|snd_es1688_get_double
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|es1688_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|left_reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|right_reg
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift_left
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0x07
suffix:semicolon
r_int
id|shift_right
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|19
)paren
op_amp
l_int|0x07
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|22
)paren
op_amp
l_int|1
suffix:semicolon
r_int
r_char
id|left
comma
id|right
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|left_reg
OL
l_int|0xa0
)paren
id|left
op_assign
id|snd_es1688_mixer_read
c_func
(paren
id|chip
comma
id|left_reg
)paren
suffix:semicolon
r_else
id|left
op_assign
id|snd_es1688_read
c_func
(paren
id|chip
comma
id|left_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|left_reg
op_ne
id|right_reg
)paren
(brace
r_if
c_cond
(paren
id|right_reg
OL
l_int|0xa0
)paren
id|right
op_assign
id|snd_es1688_mixer_read
c_func
(paren
id|chip
comma
id|right_reg
)paren
suffix:semicolon
r_else
id|right
op_assign
id|snd_es1688_read
c_func
(paren
id|chip
comma
id|right_reg
)paren
suffix:semicolon
)brace
r_else
id|right
op_assign
id|left
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|left
op_rshift
id|shift_left
)paren
op_amp
id|mask
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
(paren
id|right
op_rshift
id|shift_right
)paren
op_amp
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
(brace
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|mask
op_minus
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
id|mask
op_minus
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1688_put_double
r_static
r_int
id|snd_es1688_put_double
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|es1688_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|left_reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|right_reg
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift_left
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0x07
suffix:semicolon
r_int
id|shift_right
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|19
)paren
op_amp
l_int|0x07
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|22
)paren
op_amp
l_int|1
suffix:semicolon
r_int
id|change
suffix:semicolon
r_int
r_char
id|val1
comma
id|val2
comma
id|oval1
comma
id|oval2
suffix:semicolon
id|val1
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
id|mask
suffix:semicolon
id|val2
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_amp
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
(brace
id|val1
op_assign
id|mask
op_minus
id|val1
suffix:semicolon
id|val2
op_assign
id|mask
op_minus
id|val2
suffix:semicolon
)brace
id|val1
op_lshift_assign
id|shift_left
suffix:semicolon
id|val2
op_lshift_assign
id|shift_right
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|left_reg
op_ne
id|right_reg
)paren
(brace
r_if
c_cond
(paren
id|left_reg
OL
l_int|0xa0
)paren
id|oval1
op_assign
id|snd_es1688_mixer_read
c_func
(paren
id|chip
comma
id|left_reg
)paren
suffix:semicolon
r_else
id|oval1
op_assign
id|snd_es1688_read
c_func
(paren
id|chip
comma
id|left_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|right_reg
OL
l_int|0xa0
)paren
id|oval2
op_assign
id|snd_es1688_mixer_read
c_func
(paren
id|chip
comma
id|right_reg
)paren
suffix:semicolon
r_else
id|oval2
op_assign
id|snd_es1688_read
c_func
(paren
id|chip
comma
id|right_reg
)paren
suffix:semicolon
id|val1
op_assign
(paren
id|oval1
op_amp
op_complement
(paren
id|mask
op_lshift
id|shift_left
)paren
)paren
op_or
id|val1
suffix:semicolon
id|val2
op_assign
(paren
id|oval2
op_amp
op_complement
(paren
id|mask
op_lshift
id|shift_right
)paren
)paren
op_or
id|val2
suffix:semicolon
id|change
op_assign
id|val1
op_ne
id|oval1
op_logical_or
id|val2
op_ne
id|oval2
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
(brace
r_if
c_cond
(paren
id|left_reg
OL
l_int|0xa0
)paren
id|snd_es1688_mixer_write
c_func
(paren
id|chip
comma
id|left_reg
comma
id|val1
)paren
suffix:semicolon
r_else
id|snd_es1688_write
c_func
(paren
id|chip
comma
id|left_reg
comma
id|val1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|right_reg
OL
l_int|0xa0
)paren
id|snd_es1688_mixer_write
c_func
(paren
id|chip
comma
id|right_reg
comma
id|val1
)paren
suffix:semicolon
r_else
id|snd_es1688_write
c_func
(paren
id|chip
comma
id|right_reg
comma
id|val1
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|left_reg
OL
l_int|0xa0
)paren
id|oval1
op_assign
id|snd_es1688_mixer_read
c_func
(paren
id|chip
comma
id|left_reg
)paren
suffix:semicolon
r_else
id|oval1
op_assign
id|snd_es1688_read
c_func
(paren
id|chip
comma
id|left_reg
)paren
suffix:semicolon
id|val1
op_assign
(paren
id|oval1
op_amp
op_complement
(paren
(paren
id|mask
op_lshift
id|shift_left
)paren
op_or
(paren
id|mask
op_lshift
id|shift_right
)paren
)paren
)paren
op_or
id|val1
op_or
id|val2
suffix:semicolon
id|change
op_assign
id|val1
op_ne
id|oval1
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
(brace
r_if
c_cond
(paren
id|left_reg
OL
l_int|0xa0
)paren
id|snd_es1688_mixer_write
c_func
(paren
id|chip
comma
id|left_reg
comma
id|val1
)paren
suffix:semicolon
r_else
id|snd_es1688_write
c_func
(paren
id|chip
comma
id|left_reg
comma
id|val1
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|macro|ES1688_CONTROLS
mdefine_line|#define ES1688_CONTROLS (sizeof(snd_es1688_controls)/sizeof(snd_kcontrol_new_t))
DECL|variable|snd_es1688_controls
r_static
id|snd_kcontrol_new_t
id|snd_es1688_controls
(braket
)braket
op_assign
(brace
id|ES1688_DOUBLE
c_func
(paren
l_string|&quot;Master Playback Volume&quot;
comma
l_int|0
comma
id|ES1688_MASTER_DEV
comma
id|ES1688_MASTER_DEV
comma
l_int|4
comma
l_int|0
comma
l_int|15
comma
l_int|0
)paren
comma
id|ES1688_DOUBLE
c_func
(paren
l_string|&quot;PCM Playback Volume&quot;
comma
l_int|0
comma
id|ES1688_PCM_DEV
comma
id|ES1688_PCM_DEV
comma
l_int|4
comma
l_int|0
comma
l_int|15
comma
l_int|0
)paren
comma
id|ES1688_DOUBLE
c_func
(paren
l_string|&quot;Line Playback Volume&quot;
comma
l_int|0
comma
id|ES1688_LINE_DEV
comma
id|ES1688_LINE_DEV
comma
l_int|4
comma
l_int|0
comma
l_int|15
comma
l_int|0
)paren
comma
id|ES1688_DOUBLE
c_func
(paren
l_string|&quot;CD Playback Volume&quot;
comma
l_int|0
comma
id|ES1688_CD_DEV
comma
id|ES1688_CD_DEV
comma
l_int|4
comma
l_int|0
comma
l_int|15
comma
l_int|0
)paren
comma
id|ES1688_DOUBLE
c_func
(paren
l_string|&quot;FM Playback Volume&quot;
comma
l_int|0
comma
id|ES1688_FM_DEV
comma
id|ES1688_FM_DEV
comma
l_int|4
comma
l_int|0
comma
l_int|15
comma
l_int|0
)paren
comma
id|ES1688_DOUBLE
c_func
(paren
l_string|&quot;Mic Playback Volume&quot;
comma
l_int|0
comma
id|ES1688_MIC_DEV
comma
id|ES1688_MIC_DEV
comma
l_int|4
comma
l_int|0
comma
l_int|15
comma
l_int|0
)paren
comma
id|ES1688_DOUBLE
c_func
(paren
l_string|&quot;Aux Playback Volume&quot;
comma
l_int|0
comma
id|ES1688_AUX_DEV
comma
id|ES1688_AUX_DEV
comma
l_int|4
comma
l_int|0
comma
l_int|15
comma
l_int|0
)paren
comma
id|ES1688_SINGLE
c_func
(paren
l_string|&quot;PC Speaker Playback Volume&quot;
comma
l_int|0
comma
id|ES1688_SPEAKER_DEV
comma
l_int|0
comma
l_int|7
comma
l_int|0
)paren
comma
id|ES1688_DOUBLE
c_func
(paren
l_string|&quot;Capture Volume&quot;
comma
l_int|0
comma
id|ES1688_RECLEV_DEV
comma
id|ES1688_RECLEV_DEV
comma
l_int|4
comma
l_int|0
comma
l_int|15
comma
l_int|0
)paren
comma
id|ES1688_SINGLE
c_func
(paren
l_string|&quot;Capture Switch&quot;
comma
l_int|0
comma
id|ES1688_REC_DEV
comma
l_int|4
comma
l_int|1
comma
l_int|1
)paren
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Capture Source&quot;
comma
dot
id|info
op_assign
id|snd_es1688_info_mux
comma
dot
id|get
op_assign
id|snd_es1688_get_mux
comma
dot
id|put
op_assign
id|snd_es1688_put_mux
comma
)brace
comma
)brace
suffix:semicolon
DECL|macro|ES1688_INIT_TABLE_SIZE
mdefine_line|#define ES1688_INIT_TABLE_SIZE (sizeof(snd_es1688_init_table)/2)
DECL|variable|snd_es1688_init_table
r_static
r_int
r_char
id|snd_es1688_init_table
(braket
)braket
(braket
l_int|2
)braket
op_assign
(brace
(brace
id|ES1688_MASTER_DEV
comma
l_int|0
)brace
comma
(brace
id|ES1688_PCM_DEV
comma
l_int|0
)brace
comma
(brace
id|ES1688_LINE_DEV
comma
l_int|0
)brace
comma
(brace
id|ES1688_CD_DEV
comma
l_int|0
)brace
comma
(brace
id|ES1688_FM_DEV
comma
l_int|0
)brace
comma
(brace
id|ES1688_MIC_DEV
comma
l_int|0
)brace
comma
(brace
id|ES1688_AUX_DEV
comma
l_int|0
)brace
comma
(brace
id|ES1688_SPEAKER_DEV
comma
l_int|0
)brace
comma
(brace
id|ES1688_RECLEV_DEV
comma
l_int|0
)brace
comma
(brace
id|ES1688_REC_DEV
comma
l_int|0x17
)brace
)brace
suffix:semicolon
DECL|function|snd_es1688_mixer
r_int
id|snd_es1688_mixer
c_func
(paren
id|es1688_t
op_star
id|chip
)paren
(brace
id|snd_card_t
op_star
id|card
suffix:semicolon
r_int
r_int
id|idx
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
r_char
id|reg
comma
id|val
suffix:semicolon
id|snd_assert
c_func
(paren
id|chip
op_ne
l_int|NULL
op_logical_and
id|chip-&gt;card
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|card
op_assign
id|chip-&gt;card
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;mixername
comma
id|snd_es1688_chip_id
c_func
(paren
id|chip
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|ES1688_CONTROLS
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_es1688_controls
(braket
id|idx
)braket
comma
id|chip
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|ES1688_INIT_TABLE_SIZE
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|reg
op_assign
id|snd_es1688_init_table
(braket
id|idx
)braket
(braket
l_int|0
)braket
suffix:semicolon
id|val
op_assign
id|snd_es1688_init_table
(braket
id|idx
)braket
(braket
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|reg
OL
l_int|0xa0
)paren
id|snd_es1688_mixer_write
c_func
(paren
id|chip
comma
id|reg
comma
id|val
)paren
suffix:semicolon
r_else
id|snd_es1688_write
c_func
(paren
id|chip
comma
id|reg
comma
id|val
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_es1688_mixer_write
id|EXPORT_SYMBOL
c_func
(paren
id|snd_es1688_mixer_write
)paren
suffix:semicolon
DECL|variable|snd_es1688_mixer_read
id|EXPORT_SYMBOL
c_func
(paren
id|snd_es1688_mixer_read
)paren
suffix:semicolon
DECL|variable|snd_es1688_interrupt
id|EXPORT_SYMBOL
c_func
(paren
id|snd_es1688_interrupt
)paren
suffix:semicolon
DECL|variable|snd_es1688_create
id|EXPORT_SYMBOL
c_func
(paren
id|snd_es1688_create
)paren
suffix:semicolon
DECL|variable|snd_es1688_pcm
id|EXPORT_SYMBOL
c_func
(paren
id|snd_es1688_pcm
)paren
suffix:semicolon
DECL|variable|snd_es1688_mixer
id|EXPORT_SYMBOL
c_func
(paren
id|snd_es1688_mixer
)paren
suffix:semicolon
multiline_comment|/*&n; *  INIT part&n; */
DECL|function|alsa_es1688_init
r_static
r_int
id|__init
id|alsa_es1688_init
c_func
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|alsa_es1688_exit
r_static
r_void
id|__exit
id|alsa_es1688_exit
c_func
(paren
r_void
)paren
(brace
)brace
id|module_init
c_func
(paren
id|alsa_es1688_init
)paren
id|module_exit
c_func
(paren
id|alsa_es1688_exit
)paren
eof
