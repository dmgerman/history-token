multiline_comment|/*&n; *  Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *     and (c) 1999 Steve Ratcliffe &lt;steve@parabola.demon.co.uk&gt;&n; *  Copyright (C) 1999-2000 Takashi Iwai &lt;tiwai@suse.de&gt;&n; *&n; *  Routines for control of EMU8000 chip&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;linux/wait.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/emu8000.h&gt;
macro_line|#include &lt;sound/emu8000_reg.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;sound/control.h&gt;
macro_line|#include &lt;sound/initval.h&gt;
multiline_comment|/*&n; * emu8000 register controls&n; */
multiline_comment|/*&n; * The following routines read and write registers on the emu8000.  They&n; * should always be called via the EMU8000*READ/WRITE macros and never&n; * directly.  The macros handle the port number and command word.&n; */
multiline_comment|/* Write a word */
DECL|function|snd_emu8000_poke
r_void
id|snd_emu8000_poke
c_func
(paren
id|emu8000_t
op_star
id|emu
comma
r_int
r_int
id|port
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_ne
id|emu-&gt;last_reg
)paren
(brace
id|outw
c_func
(paren
(paren
r_int
r_int
)paren
id|reg
comma
id|EMU8000_PTR
c_func
(paren
id|emu
)paren
)paren
suffix:semicolon
multiline_comment|/* Set register */
id|emu-&gt;last_reg
op_assign
id|reg
suffix:semicolon
)brace
id|outw
c_func
(paren
(paren
r_int
r_int
)paren
id|val
comma
id|port
)paren
suffix:semicolon
multiline_comment|/* Send data */
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* Read a word */
DECL|function|snd_emu8000_peek
r_int
r_int
id|snd_emu8000_peek
c_func
(paren
id|emu8000_t
op_star
id|emu
comma
r_int
r_int
id|port
comma
r_int
r_int
id|reg
)paren
(brace
r_int
r_int
id|res
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_ne
id|emu-&gt;last_reg
)paren
(brace
id|outw
c_func
(paren
(paren
r_int
r_int
)paren
id|reg
comma
id|EMU8000_PTR
c_func
(paren
id|emu
)paren
)paren
suffix:semicolon
multiline_comment|/* Set register */
id|emu-&gt;last_reg
op_assign
id|reg
suffix:semicolon
)brace
id|res
op_assign
id|inw
c_func
(paren
id|port
)paren
suffix:semicolon
multiline_comment|/* Read data */
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
multiline_comment|/* Write a double word */
DECL|function|snd_emu8000_poke_dw
r_void
id|snd_emu8000_poke_dw
c_func
(paren
id|emu8000_t
op_star
id|emu
comma
r_int
r_int
id|port
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_ne
id|emu-&gt;last_reg
)paren
(brace
id|outw
c_func
(paren
(paren
r_int
r_int
)paren
id|reg
comma
id|EMU8000_PTR
c_func
(paren
id|emu
)paren
)paren
suffix:semicolon
multiline_comment|/* Set register */
id|emu-&gt;last_reg
op_assign
id|reg
suffix:semicolon
)brace
id|outw
c_func
(paren
(paren
r_int
r_int
)paren
id|val
comma
id|port
)paren
suffix:semicolon
multiline_comment|/* Send low word of data */
id|outw
c_func
(paren
(paren
r_int
r_int
)paren
(paren
id|val
op_rshift
l_int|16
)paren
comma
id|port
op_plus
l_int|2
)paren
suffix:semicolon
multiline_comment|/* Send high word of data */
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* Read a double word */
DECL|function|snd_emu8000_peek_dw
r_int
r_int
id|snd_emu8000_peek_dw
c_func
(paren
id|emu8000_t
op_star
id|emu
comma
r_int
r_int
id|port
comma
r_int
r_int
id|reg
)paren
(brace
r_int
r_int
id|low
suffix:semicolon
r_int
r_int
id|res
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_ne
id|emu-&gt;last_reg
)paren
(brace
id|outw
c_func
(paren
(paren
r_int
r_int
)paren
id|reg
comma
id|EMU8000_PTR
c_func
(paren
id|emu
)paren
)paren
suffix:semicolon
multiline_comment|/* Set register */
id|emu-&gt;last_reg
op_assign
id|reg
suffix:semicolon
)brace
id|low
op_assign
id|inw
c_func
(paren
id|port
)paren
suffix:semicolon
multiline_comment|/* Read low word of data */
id|res
op_assign
id|low
op_plus
(paren
id|inw
c_func
(paren
id|port
op_plus
l_int|2
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
multiline_comment|/*&n; * Set up / close a channel to be used for DMA.&n; */
multiline_comment|/*exported*/
r_void
DECL|function|snd_emu8000_dma_chan
id|snd_emu8000_dma_chan
c_func
(paren
id|emu8000_t
op_star
id|emu
comma
r_int
id|ch
comma
r_int
id|mode
)paren
(brace
r_int
id|right_bit
op_assign
(paren
id|mode
op_amp
id|EMU8000_RAM_RIGHT
)paren
ques
c_cond
l_int|0x01000000
suffix:colon
l_int|0
suffix:semicolon
id|mode
op_and_assign
id|EMU8000_RAM_MODE_MASK
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_eq
id|EMU8000_RAM_CLOSE
)paren
(brace
id|EMU8000_CCCA_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_DCYSUSV_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0x807F
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|EMU8000_DCYSUSV_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0x80
)paren
suffix:semicolon
id|EMU8000_VTFT_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_CVCF_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_PTRX_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0x40000000
)paren
suffix:semicolon
id|EMU8000_CPF_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0x40000000
)paren
suffix:semicolon
id|EMU8000_PSST_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_CSL_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_eq
id|EMU8000_RAM_WRITE
)paren
multiline_comment|/* DMA write */
id|EMU8000_CCCA_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0x06000000
op_or
id|right_bit
)paren
suffix:semicolon
r_else
multiline_comment|/* DMA read */
id|EMU8000_CCCA_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0x04000000
op_or
id|right_bit
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; */
r_static
r_void
id|__init
DECL|function|snd_emu8000_read_wait
id|snd_emu8000_read_wait
c_func
(paren
id|emu8000_t
op_star
id|emu
)paren
(brace
r_while
c_loop
(paren
(paren
id|EMU8000_SMALR_READ
c_func
(paren
id|emu
)paren
op_amp
l_int|0x80000000
)paren
op_ne
l_int|0
)paren
(brace
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; */
r_static
r_void
id|__init
DECL|function|snd_emu8000_write_wait
id|snd_emu8000_write_wait
c_func
(paren
id|emu8000_t
op_star
id|emu
)paren
(brace
r_while
c_loop
(paren
(paren
id|EMU8000_SMALW_READ
c_func
(paren
id|emu
)paren
op_amp
l_int|0x80000000
)paren
op_ne
l_int|0
)paren
(brace
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * detect a card at the given port&n; */
r_static
r_int
id|__init
DECL|function|snd_emu8000_detect
id|snd_emu8000_detect
c_func
(paren
id|emu8000_t
op_star
id|emu
)paren
(brace
multiline_comment|/* Initialise */
id|EMU8000_HWCF1_WRITE
c_func
(paren
id|emu
comma
l_int|0x0059
)paren
suffix:semicolon
id|EMU8000_HWCF2_WRITE
c_func
(paren
id|emu
comma
l_int|0x0020
)paren
suffix:semicolon
id|EMU8000_HWCF3_WRITE
c_func
(paren
id|emu
comma
l_int|0x0000
)paren
suffix:semicolon
multiline_comment|/* Check for a recognisable emu8000 */
multiline_comment|/*&n;&t;if ((EMU8000_U1_READ(emu) &amp; 0x000f) != 0x000c)&n;&t;&t;return -ENODEV;&n;&t;&t;*/
r_if
c_cond
(paren
(paren
id|EMU8000_HWCF1_READ
c_func
(paren
id|emu
)paren
op_amp
l_int|0x007e
)paren
op_ne
l_int|0x0058
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
(paren
id|EMU8000_HWCF2_READ
c_func
(paren
id|emu
)paren
op_amp
l_int|0x0003
)paren
op_ne
l_int|0x0003
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|snd_printdd
c_func
(paren
l_string|&quot;EMU8000 [0x%lx]: Synth chip found&bslash;n&quot;
comma
id|emu-&gt;port1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * intiailize audio channels&n; */
r_static
r_void
id|__init
DECL|function|init_audio
id|init_audio
c_func
(paren
id|emu8000_t
op_star
id|emu
)paren
(brace
r_int
id|ch
suffix:semicolon
multiline_comment|/* turn off envelope engines */
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
id|EMU8000_CHANNELS
suffix:semicolon
id|ch
op_increment
)paren
id|EMU8000_DCYSUSV_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0x80
)paren
suffix:semicolon
multiline_comment|/* reset all other parameters to zero */
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
id|EMU8000_CHANNELS
suffix:semicolon
id|ch
op_increment
)paren
(brace
id|EMU8000_ENVVOL_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_ENVVAL_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_DCYSUS_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_ATKHLDV_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_LFO1VAL_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_ATKHLD_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_LFO2VAL_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_IP_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_IFATN_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_PEFE_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_FMMOD_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_TREMFRQ_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_FM2FRQ2_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_PTRX_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_VTFT_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_PSST_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_CSL_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_CCCA_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
id|EMU8000_CHANNELS
suffix:semicolon
id|ch
op_increment
)paren
(brace
id|EMU8000_CPF_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_CVCF_WRITE
c_func
(paren
id|emu
comma
id|ch
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * initialize DMA address&n; */
r_static
r_void
id|__init
DECL|function|init_dma
id|init_dma
c_func
(paren
id|emu8000_t
op_star
id|emu
)paren
(brace
id|EMU8000_SMALR_WRITE
c_func
(paren
id|emu
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_SMARR_WRITE
c_func
(paren
id|emu
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_SMALW_WRITE
c_func
(paren
id|emu
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_SMARW_WRITE
c_func
(paren
id|emu
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * initialization arrays; from ADIP&n; */
DECL|variable|init1
r_static
r_int
r_int
id|init1
(braket
l_int|128
)braket
multiline_comment|/*__devinitdata*/
op_assign
(brace
l_int|0x03ff
comma
l_int|0x0030
comma
l_int|0x07ff
comma
l_int|0x0130
comma
l_int|0x0bff
comma
l_int|0x0230
comma
l_int|0x0fff
comma
l_int|0x0330
comma
l_int|0x13ff
comma
l_int|0x0430
comma
l_int|0x17ff
comma
l_int|0x0530
comma
l_int|0x1bff
comma
l_int|0x0630
comma
l_int|0x1fff
comma
l_int|0x0730
comma
l_int|0x23ff
comma
l_int|0x0830
comma
l_int|0x27ff
comma
l_int|0x0930
comma
l_int|0x2bff
comma
l_int|0x0a30
comma
l_int|0x2fff
comma
l_int|0x0b30
comma
l_int|0x33ff
comma
l_int|0x0c30
comma
l_int|0x37ff
comma
l_int|0x0d30
comma
l_int|0x3bff
comma
l_int|0x0e30
comma
l_int|0x3fff
comma
l_int|0x0f30
comma
l_int|0x43ff
comma
l_int|0x0030
comma
l_int|0x47ff
comma
l_int|0x0130
comma
l_int|0x4bff
comma
l_int|0x0230
comma
l_int|0x4fff
comma
l_int|0x0330
comma
l_int|0x53ff
comma
l_int|0x0430
comma
l_int|0x57ff
comma
l_int|0x0530
comma
l_int|0x5bff
comma
l_int|0x0630
comma
l_int|0x5fff
comma
l_int|0x0730
comma
l_int|0x63ff
comma
l_int|0x0830
comma
l_int|0x67ff
comma
l_int|0x0930
comma
l_int|0x6bff
comma
l_int|0x0a30
comma
l_int|0x6fff
comma
l_int|0x0b30
comma
l_int|0x73ff
comma
l_int|0x0c30
comma
l_int|0x77ff
comma
l_int|0x0d30
comma
l_int|0x7bff
comma
l_int|0x0e30
comma
l_int|0x7fff
comma
l_int|0x0f30
comma
l_int|0x83ff
comma
l_int|0x0030
comma
l_int|0x87ff
comma
l_int|0x0130
comma
l_int|0x8bff
comma
l_int|0x0230
comma
l_int|0x8fff
comma
l_int|0x0330
comma
l_int|0x93ff
comma
l_int|0x0430
comma
l_int|0x97ff
comma
l_int|0x0530
comma
l_int|0x9bff
comma
l_int|0x0630
comma
l_int|0x9fff
comma
l_int|0x0730
comma
l_int|0xa3ff
comma
l_int|0x0830
comma
l_int|0xa7ff
comma
l_int|0x0930
comma
l_int|0xabff
comma
l_int|0x0a30
comma
l_int|0xafff
comma
l_int|0x0b30
comma
l_int|0xb3ff
comma
l_int|0x0c30
comma
l_int|0xb7ff
comma
l_int|0x0d30
comma
l_int|0xbbff
comma
l_int|0x0e30
comma
l_int|0xbfff
comma
l_int|0x0f30
comma
l_int|0xc3ff
comma
l_int|0x0030
comma
l_int|0xc7ff
comma
l_int|0x0130
comma
l_int|0xcbff
comma
l_int|0x0230
comma
l_int|0xcfff
comma
l_int|0x0330
comma
l_int|0xd3ff
comma
l_int|0x0430
comma
l_int|0xd7ff
comma
l_int|0x0530
comma
l_int|0xdbff
comma
l_int|0x0630
comma
l_int|0xdfff
comma
l_int|0x0730
comma
l_int|0xe3ff
comma
l_int|0x0830
comma
l_int|0xe7ff
comma
l_int|0x0930
comma
l_int|0xebff
comma
l_int|0x0a30
comma
l_int|0xefff
comma
l_int|0x0b30
comma
l_int|0xf3ff
comma
l_int|0x0c30
comma
l_int|0xf7ff
comma
l_int|0x0d30
comma
l_int|0xfbff
comma
l_int|0x0e30
comma
l_int|0xffff
comma
l_int|0x0f30
comma
)brace
suffix:semicolon
DECL|variable|init2
r_static
r_int
r_int
id|init2
(braket
l_int|128
)braket
multiline_comment|/*__devinitdata*/
op_assign
(brace
l_int|0x03ff
comma
l_int|0x8030
comma
l_int|0x07ff
comma
l_int|0x8130
comma
l_int|0x0bff
comma
l_int|0x8230
comma
l_int|0x0fff
comma
l_int|0x8330
comma
l_int|0x13ff
comma
l_int|0x8430
comma
l_int|0x17ff
comma
l_int|0x8530
comma
l_int|0x1bff
comma
l_int|0x8630
comma
l_int|0x1fff
comma
l_int|0x8730
comma
l_int|0x23ff
comma
l_int|0x8830
comma
l_int|0x27ff
comma
l_int|0x8930
comma
l_int|0x2bff
comma
l_int|0x8a30
comma
l_int|0x2fff
comma
l_int|0x8b30
comma
l_int|0x33ff
comma
l_int|0x8c30
comma
l_int|0x37ff
comma
l_int|0x8d30
comma
l_int|0x3bff
comma
l_int|0x8e30
comma
l_int|0x3fff
comma
l_int|0x8f30
comma
l_int|0x43ff
comma
l_int|0x8030
comma
l_int|0x47ff
comma
l_int|0x8130
comma
l_int|0x4bff
comma
l_int|0x8230
comma
l_int|0x4fff
comma
l_int|0x8330
comma
l_int|0x53ff
comma
l_int|0x8430
comma
l_int|0x57ff
comma
l_int|0x8530
comma
l_int|0x5bff
comma
l_int|0x8630
comma
l_int|0x5fff
comma
l_int|0x8730
comma
l_int|0x63ff
comma
l_int|0x8830
comma
l_int|0x67ff
comma
l_int|0x8930
comma
l_int|0x6bff
comma
l_int|0x8a30
comma
l_int|0x6fff
comma
l_int|0x8b30
comma
l_int|0x73ff
comma
l_int|0x8c30
comma
l_int|0x77ff
comma
l_int|0x8d30
comma
l_int|0x7bff
comma
l_int|0x8e30
comma
l_int|0x7fff
comma
l_int|0x8f30
comma
l_int|0x83ff
comma
l_int|0x8030
comma
l_int|0x87ff
comma
l_int|0x8130
comma
l_int|0x8bff
comma
l_int|0x8230
comma
l_int|0x8fff
comma
l_int|0x8330
comma
l_int|0x93ff
comma
l_int|0x8430
comma
l_int|0x97ff
comma
l_int|0x8530
comma
l_int|0x9bff
comma
l_int|0x8630
comma
l_int|0x9fff
comma
l_int|0x8730
comma
l_int|0xa3ff
comma
l_int|0x8830
comma
l_int|0xa7ff
comma
l_int|0x8930
comma
l_int|0xabff
comma
l_int|0x8a30
comma
l_int|0xafff
comma
l_int|0x8b30
comma
l_int|0xb3ff
comma
l_int|0x8c30
comma
l_int|0xb7ff
comma
l_int|0x8d30
comma
l_int|0xbbff
comma
l_int|0x8e30
comma
l_int|0xbfff
comma
l_int|0x8f30
comma
l_int|0xc3ff
comma
l_int|0x8030
comma
l_int|0xc7ff
comma
l_int|0x8130
comma
l_int|0xcbff
comma
l_int|0x8230
comma
l_int|0xcfff
comma
l_int|0x8330
comma
l_int|0xd3ff
comma
l_int|0x8430
comma
l_int|0xd7ff
comma
l_int|0x8530
comma
l_int|0xdbff
comma
l_int|0x8630
comma
l_int|0xdfff
comma
l_int|0x8730
comma
l_int|0xe3ff
comma
l_int|0x8830
comma
l_int|0xe7ff
comma
l_int|0x8930
comma
l_int|0xebff
comma
l_int|0x8a30
comma
l_int|0xefff
comma
l_int|0x8b30
comma
l_int|0xf3ff
comma
l_int|0x8c30
comma
l_int|0xf7ff
comma
l_int|0x8d30
comma
l_int|0xfbff
comma
l_int|0x8e30
comma
l_int|0xffff
comma
l_int|0x8f30
comma
)brace
suffix:semicolon
DECL|variable|init3
r_static
r_int
r_int
id|init3
(braket
l_int|128
)braket
multiline_comment|/*__devinitdata*/
op_assign
(brace
l_int|0x0C10
comma
l_int|0x8470
comma
l_int|0x14FE
comma
l_int|0xB488
comma
l_int|0x167F
comma
l_int|0xA470
comma
l_int|0x18E7
comma
l_int|0x84B5
comma
l_int|0x1B6E
comma
l_int|0x842A
comma
l_int|0x1F1D
comma
l_int|0x852A
comma
l_int|0x0DA3
comma
l_int|0x8F7C
comma
l_int|0x167E
comma
l_int|0xF254
comma
l_int|0x0000
comma
l_int|0x842A
comma
l_int|0x0001
comma
l_int|0x852A
comma
l_int|0x18E6
comma
l_int|0x8BAA
comma
l_int|0x1B6D
comma
l_int|0xF234
comma
l_int|0x229F
comma
l_int|0x8429
comma
l_int|0x2746
comma
l_int|0x8529
comma
l_int|0x1F1C
comma
l_int|0x86E7
comma
l_int|0x229E
comma
l_int|0xF224
comma
l_int|0x0DA4
comma
l_int|0x8429
comma
l_int|0x2C29
comma
l_int|0x8529
comma
l_int|0x2745
comma
l_int|0x87F6
comma
l_int|0x2C28
comma
l_int|0xF254
comma
l_int|0x383B
comma
l_int|0x8428
comma
l_int|0x320F
comma
l_int|0x8528
comma
l_int|0x320E
comma
l_int|0x8F02
comma
l_int|0x1341
comma
l_int|0xF264
comma
l_int|0x3EB6
comma
l_int|0x8428
comma
l_int|0x3EB9
comma
l_int|0x8528
comma
l_int|0x383A
comma
l_int|0x8FA9
comma
l_int|0x3EB5
comma
l_int|0xF294
comma
l_int|0x3EB7
comma
l_int|0x8474
comma
l_int|0x3EBA
comma
l_int|0x8575
comma
l_int|0x3EB8
comma
l_int|0xC4C3
comma
l_int|0x3EBB
comma
l_int|0xC5C3
comma
l_int|0x0000
comma
l_int|0xA404
comma
l_int|0x0001
comma
l_int|0xA504
comma
l_int|0x141F
comma
l_int|0x8671
comma
l_int|0x14FD
comma
l_int|0x8287
comma
l_int|0x3EBC
comma
l_int|0xE610
comma
l_int|0x3EC8
comma
l_int|0x8C7B
comma
l_int|0x031A
comma
l_int|0x87E6
comma
l_int|0x3EC8
comma
l_int|0x86F7
comma
l_int|0x3EC0
comma
l_int|0x821E
comma
l_int|0x3EBE
comma
l_int|0xD208
comma
l_int|0x3EBD
comma
l_int|0x821F
comma
l_int|0x3ECA
comma
l_int|0x8386
comma
l_int|0x3EC1
comma
l_int|0x8C03
comma
l_int|0x3EC9
comma
l_int|0x831E
comma
l_int|0x3ECA
comma
l_int|0x8C4C
comma
l_int|0x3EBF
comma
l_int|0x8C55
comma
l_int|0x3EC9
comma
l_int|0xC208
comma
l_int|0x3EC4
comma
l_int|0xBC84
comma
l_int|0x3EC8
comma
l_int|0x8EAD
comma
l_int|0x3EC8
comma
l_int|0xD308
comma
l_int|0x3EC2
comma
l_int|0x8F7E
comma
l_int|0x3ECB
comma
l_int|0x8219
comma
l_int|0x3ECB
comma
l_int|0xD26E
comma
l_int|0x3EC5
comma
l_int|0x831F
comma
l_int|0x3EC6
comma
l_int|0xC308
comma
l_int|0x3EC3
comma
l_int|0xB2FF
comma
l_int|0x3EC9
comma
l_int|0x8265
comma
l_int|0x3EC9
comma
l_int|0x8319
comma
l_int|0x1342
comma
l_int|0xD36E
comma
l_int|0x3EC7
comma
l_int|0xB3FF
comma
l_int|0x0000
comma
l_int|0x8365
comma
l_int|0x1420
comma
l_int|0x9570
comma
)brace
suffix:semicolon
DECL|variable|init4
r_static
r_int
r_int
id|init4
(braket
l_int|128
)braket
multiline_comment|/*__devinitdata*/
op_assign
(brace
l_int|0x0C10
comma
l_int|0x8470
comma
l_int|0x14FE
comma
l_int|0xB488
comma
l_int|0x167F
comma
l_int|0xA470
comma
l_int|0x18E7
comma
l_int|0x84B5
comma
l_int|0x1B6E
comma
l_int|0x842A
comma
l_int|0x1F1D
comma
l_int|0x852A
comma
l_int|0x0DA3
comma
l_int|0x0F7C
comma
l_int|0x167E
comma
l_int|0x7254
comma
l_int|0x0000
comma
l_int|0x842A
comma
l_int|0x0001
comma
l_int|0x852A
comma
l_int|0x18E6
comma
l_int|0x0BAA
comma
l_int|0x1B6D
comma
l_int|0x7234
comma
l_int|0x229F
comma
l_int|0x8429
comma
l_int|0x2746
comma
l_int|0x8529
comma
l_int|0x1F1C
comma
l_int|0x06E7
comma
l_int|0x229E
comma
l_int|0x7224
comma
l_int|0x0DA4
comma
l_int|0x8429
comma
l_int|0x2C29
comma
l_int|0x8529
comma
l_int|0x2745
comma
l_int|0x07F6
comma
l_int|0x2C28
comma
l_int|0x7254
comma
l_int|0x383B
comma
l_int|0x8428
comma
l_int|0x320F
comma
l_int|0x8528
comma
l_int|0x320E
comma
l_int|0x0F02
comma
l_int|0x1341
comma
l_int|0x7264
comma
l_int|0x3EB6
comma
l_int|0x8428
comma
l_int|0x3EB9
comma
l_int|0x8528
comma
l_int|0x383A
comma
l_int|0x0FA9
comma
l_int|0x3EB5
comma
l_int|0x7294
comma
l_int|0x3EB7
comma
l_int|0x8474
comma
l_int|0x3EBA
comma
l_int|0x8575
comma
l_int|0x3EB8
comma
l_int|0x44C3
comma
l_int|0x3EBB
comma
l_int|0x45C3
comma
l_int|0x0000
comma
l_int|0xA404
comma
l_int|0x0001
comma
l_int|0xA504
comma
l_int|0x141F
comma
l_int|0x0671
comma
l_int|0x14FD
comma
l_int|0x0287
comma
l_int|0x3EBC
comma
l_int|0xE610
comma
l_int|0x3EC8
comma
l_int|0x0C7B
comma
l_int|0x031A
comma
l_int|0x07E6
comma
l_int|0x3EC8
comma
l_int|0x86F7
comma
l_int|0x3EC0
comma
l_int|0x821E
comma
l_int|0x3EBE
comma
l_int|0xD208
comma
l_int|0x3EBD
comma
l_int|0x021F
comma
l_int|0x3ECA
comma
l_int|0x0386
comma
l_int|0x3EC1
comma
l_int|0x0C03
comma
l_int|0x3EC9
comma
l_int|0x031E
comma
l_int|0x3ECA
comma
l_int|0x8C4C
comma
l_int|0x3EBF
comma
l_int|0x0C55
comma
l_int|0x3EC9
comma
l_int|0xC208
comma
l_int|0x3EC4
comma
l_int|0xBC84
comma
l_int|0x3EC8
comma
l_int|0x0EAD
comma
l_int|0x3EC8
comma
l_int|0xD308
comma
l_int|0x3EC2
comma
l_int|0x8F7E
comma
l_int|0x3ECB
comma
l_int|0x0219
comma
l_int|0x3ECB
comma
l_int|0xD26E
comma
l_int|0x3EC5
comma
l_int|0x031F
comma
l_int|0x3EC6
comma
l_int|0xC308
comma
l_int|0x3EC3
comma
l_int|0x32FF
comma
l_int|0x3EC9
comma
l_int|0x0265
comma
l_int|0x3EC9
comma
l_int|0x8319
comma
l_int|0x1342
comma
l_int|0xD36E
comma
l_int|0x3EC7
comma
l_int|0x33FF
comma
l_int|0x0000
comma
l_int|0x8365
comma
l_int|0x1420
comma
l_int|0x9570
comma
)brace
suffix:semicolon
multiline_comment|/* send an initialization array&n; * Taken from the oss driver, not obvious from the doc how this&n; * is meant to work&n; */
r_static
r_void
id|__init
DECL|function|send_array
id|send_array
c_func
(paren
id|emu8000_t
op_star
id|emu
comma
r_int
r_int
op_star
id|data
comma
r_int
id|size
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
op_star
id|p
suffix:semicolon
id|p
op_assign
id|data
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
id|i
op_increment
comma
id|p
op_increment
)paren
id|EMU8000_INIT1_WRITE
c_func
(paren
id|emu
comma
id|i
comma
op_star
id|p
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
id|i
op_increment
comma
id|p
op_increment
)paren
id|EMU8000_INIT2_WRITE
c_func
(paren
id|emu
comma
id|i
comma
op_star
id|p
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
id|i
op_increment
comma
id|p
op_increment
)paren
id|EMU8000_INIT3_WRITE
c_func
(paren
id|emu
comma
id|i
comma
op_star
id|p
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
id|i
op_increment
comma
id|p
op_increment
)paren
id|EMU8000_INIT4_WRITE
c_func
(paren
id|emu
comma
id|i
comma
op_star
id|p
)paren
suffix:semicolon
)brace
DECL|macro|NELEM
mdefine_line|#define NELEM(arr) (sizeof(arr)/sizeof((arr)[0]))
multiline_comment|/*&n; * Send initialization arrays to start up, this just follows the&n; * initialisation sequence in the adip.&n; */
r_static
r_void
id|__init
DECL|function|init_arrays
id|init_arrays
c_func
(paren
id|emu8000_t
op_star
id|emu
)paren
(brace
id|send_array
c_func
(paren
id|emu
comma
id|init1
comma
id|NELEM
c_func
(paren
id|init1
)paren
op_div
l_int|4
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
(paren
id|HZ
op_star
(paren
l_int|44099
op_plus
l_int|1024
)paren
)paren
op_div
l_int|44100
)paren
suffix:semicolon
multiline_comment|/* wait for 1024 clocks */
id|send_array
c_func
(paren
id|emu
comma
id|init2
comma
id|NELEM
c_func
(paren
id|init2
)paren
op_div
l_int|4
)paren
suffix:semicolon
id|send_array
c_func
(paren
id|emu
comma
id|init3
comma
id|NELEM
c_func
(paren
id|init3
)paren
op_div
l_int|4
)paren
suffix:semicolon
id|EMU8000_HWCF4_WRITE
c_func
(paren
id|emu
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_HWCF5_WRITE
c_func
(paren
id|emu
comma
l_int|0x83
)paren
suffix:semicolon
id|EMU8000_HWCF6_WRITE
c_func
(paren
id|emu
comma
l_int|0x8000
)paren
suffix:semicolon
id|send_array
c_func
(paren
id|emu
comma
id|init4
comma
id|NELEM
c_func
(paren
id|init4
)paren
op_div
l_int|4
)paren
suffix:semicolon
)brace
DECL|macro|UNIQUE_ID1
mdefine_line|#define UNIQUE_ID1&t;0xa5b9
DECL|macro|UNIQUE_ID2
mdefine_line|#define UNIQUE_ID2&t;0x9d53
multiline_comment|/*&n; * Size the onboard memory.&n; * This is written so as not to need arbitary delays after the write. It&n; * seems that the only way to do this is to use the one channel and keep&n; * reallocating between read and write.&n; */
r_static
r_void
id|__init
DECL|function|size_dram
id|size_dram
c_func
(paren
id|emu8000_t
op_star
id|emu
)paren
(brace
r_int
id|i
comma
id|size
suffix:semicolon
r_if
c_cond
(paren
id|emu-&gt;dram_checked
)paren
r_return
suffix:semicolon
id|size
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* write out a magic number */
id|snd_emu8000_dma_chan
c_func
(paren
id|emu
comma
l_int|0
comma
id|EMU8000_RAM_WRITE
)paren
suffix:semicolon
id|snd_emu8000_dma_chan
c_func
(paren
id|emu
comma
l_int|1
comma
id|EMU8000_RAM_READ
)paren
suffix:semicolon
id|EMU8000_SMALW_WRITE
c_func
(paren
id|emu
comma
id|EMU8000_DRAM_OFFSET
)paren
suffix:semicolon
id|EMU8000_SMLD_WRITE
c_func
(paren
id|emu
comma
id|UNIQUE_ID1
)paren
suffix:semicolon
id|snd_emu8000_init_fm
c_func
(paren
id|emu
)paren
suffix:semicolon
multiline_comment|/* This must really be here and not 2 lines back even */
r_while
c_loop
(paren
id|size
OL
id|EMU8000_MAX_DRAM
)paren
(brace
id|size
op_add_assign
l_int|512
op_star
l_int|1024
suffix:semicolon
multiline_comment|/* increment 512kbytes */
multiline_comment|/* Write a unique data on the test address.&n;&t;&t; * if the address is out of range, the data is written on&n;&t;&t; * 0x200000(=EMU8000_DRAM_OFFSET).  Then the id word is&n;&t;&t; * changed by this data.&n;&t;&t; */
multiline_comment|/*snd_emu8000_dma_chan(emu, 0, EMU8000_RAM_WRITE);*/
id|EMU8000_SMALW_WRITE
c_func
(paren
id|emu
comma
id|EMU8000_DRAM_OFFSET
op_plus
(paren
id|size
op_rshift
l_int|1
)paren
)paren
suffix:semicolon
id|EMU8000_SMLD_WRITE
c_func
(paren
id|emu
comma
id|UNIQUE_ID2
)paren
suffix:semicolon
id|snd_emu8000_write_wait
c_func
(paren
id|emu
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * read the data on the just written DRAM address&n;&t;&t; * if not the same then we have reached the end of ram.&n;&t;&t; */
multiline_comment|/*snd_emu8000_dma_chan(emu, 0, EMU8000_RAM_READ);*/
id|EMU8000_SMALR_WRITE
c_func
(paren
id|emu
comma
id|EMU8000_DRAM_OFFSET
op_plus
(paren
id|size
op_rshift
l_int|1
)paren
)paren
suffix:semicolon
multiline_comment|/*snd_emu8000_read_wait(emu);*/
id|EMU8000_SMLD_READ
c_func
(paren
id|emu
)paren
suffix:semicolon
multiline_comment|/* discard stale data  */
r_if
c_cond
(paren
id|EMU8000_SMLD_READ
c_func
(paren
id|emu
)paren
op_ne
id|UNIQUE_ID2
)paren
r_break
suffix:semicolon
multiline_comment|/* we must have wrapped around */
id|snd_emu8000_read_wait
c_func
(paren
id|emu
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * If it is the same it could be that the address just&n;&t;&t; * wraps back to the beginning; so check to see if the&n;&t;&t; * initial value has been overwritten.&n;&t;&t; */
id|EMU8000_SMALR_WRITE
c_func
(paren
id|emu
comma
id|EMU8000_DRAM_OFFSET
)paren
suffix:semicolon
id|EMU8000_SMLD_READ
c_func
(paren
id|emu
)paren
suffix:semicolon
multiline_comment|/* discard stale data  */
r_if
c_cond
(paren
id|EMU8000_SMLD_READ
c_func
(paren
id|emu
)paren
op_ne
id|UNIQUE_ID1
)paren
r_break
suffix:semicolon
multiline_comment|/* we must have wrapped around */
id|snd_emu8000_read_wait
c_func
(paren
id|emu
)paren
suffix:semicolon
)brace
multiline_comment|/* wait until FULL bit in SMAxW register is false */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10000
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|EMU8000_SMALW_READ
c_func
(paren
id|emu
)paren
op_amp
l_int|0x80000000
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
)brace
id|snd_emu8000_dma_chan
c_func
(paren
id|emu
comma
l_int|0
comma
id|EMU8000_RAM_CLOSE
)paren
suffix:semicolon
id|snd_emu8000_dma_chan
c_func
(paren
id|emu
comma
l_int|1
comma
id|EMU8000_RAM_CLOSE
)paren
suffix:semicolon
id|snd_printdd
c_func
(paren
l_string|&quot;EMU8000 [0x%lx]: %d Kb on-board memory detected&bslash;n&quot;
comma
id|emu-&gt;port1
comma
id|size
op_div
l_int|1024
)paren
suffix:semicolon
id|emu-&gt;mem_size
op_assign
id|size
suffix:semicolon
id|emu-&gt;dram_checked
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * Initiailise the FM section.  You have to do this to use sample RAM&n; * and therefore lose 2 voices.&n; */
multiline_comment|/*exported*/
r_void
DECL|function|snd_emu8000_init_fm
id|snd_emu8000_init_fm
c_func
(paren
id|emu8000_t
op_star
id|emu
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* Initialize the last two channels for DRAM refresh and producing&n;&t;   the reverb and chorus effects for Yamaha OPL-3 synthesizer */
multiline_comment|/* 31: FM left channel, 0xffffe0-0xffffe8 */
id|EMU8000_DCYSUSV_WRITE
c_func
(paren
id|emu
comma
l_int|30
comma
l_int|0x80
)paren
suffix:semicolon
id|EMU8000_PSST_WRITE
c_func
(paren
id|emu
comma
l_int|30
comma
l_int|0xFFFFFFE0
)paren
suffix:semicolon
multiline_comment|/* full left */
id|EMU8000_CSL_WRITE
c_func
(paren
id|emu
comma
l_int|30
comma
l_int|0x00FFFFE8
op_or
(paren
id|emu-&gt;fm_chorus_depth
op_lshift
l_int|24
)paren
)paren
suffix:semicolon
id|EMU8000_PTRX_WRITE
c_func
(paren
id|emu
comma
l_int|30
comma
(paren
id|emu-&gt;fm_reverb_depth
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
id|EMU8000_CPF_WRITE
c_func
(paren
id|emu
comma
l_int|30
comma
l_int|0
)paren
suffix:semicolon
id|EMU8000_CCCA_WRITE
c_func
(paren
id|emu
comma
l_int|30
comma
l_int|0x00FFFFE3
)paren
suffix:semicolon
multiline_comment|/* 32: FM right channel, 0xfffff0-0xfffff8 */
id|EMU8000_DCYSUSV_WRITE
c_func
(paren
id|emu
comma
l_int|31
comma
l_int|0x80
)paren
suffix:semicolon
id|EMU8000_PSST_WRITE
c_func
(paren
id|emu
comma
l_int|31
comma
l_int|0x00FFFFF0
)paren
suffix:semicolon
multiline_comment|/* full right */
id|EMU8000_CSL_WRITE
c_func
(paren
id|emu
comma
l_int|31
comma
l_int|0x00FFFFF8
op_or
(paren
id|emu-&gt;fm_chorus_depth
op_lshift
l_int|24
)paren
)paren
suffix:semicolon
id|EMU8000_PTRX_WRITE
c_func
(paren
id|emu
comma
l_int|31
comma
(paren
id|emu-&gt;fm_reverb_depth
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
id|EMU8000_CPF_WRITE
c_func
(paren
id|emu
comma
l_int|31
comma
l_int|0x8000
)paren
suffix:semicolon
id|EMU8000_CCCA_WRITE
c_func
(paren
id|emu
comma
l_int|31
comma
l_int|0x00FFFFF3
)paren
suffix:semicolon
id|snd_emu8000_poke
c_func
(paren
(paren
id|emu
)paren
comma
id|EMU8000_DATA0
c_func
(paren
id|emu
)paren
comma
id|EMU8000_CMD
c_func
(paren
l_int|1
comma
(paren
l_int|30
)paren
)paren
comma
l_int|0
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|inw
c_func
(paren
id|EMU8000_PTR
c_func
(paren
id|emu
)paren
)paren
op_amp
l_int|0x1000
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|inw
c_func
(paren
id|EMU8000_PTR
c_func
(paren
id|emu
)paren
)paren
op_amp
l_int|0x1000
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_emu8000_poke
c_func
(paren
(paren
id|emu
)paren
comma
id|EMU8000_DATA0
c_func
(paren
id|emu
)paren
comma
id|EMU8000_CMD
c_func
(paren
l_int|1
comma
(paren
l_int|30
)paren
)paren
comma
l_int|0x4828
)paren
suffix:semicolon
multiline_comment|/* this is really odd part.. */
id|outb
c_func
(paren
l_int|0x3C
comma
id|EMU8000_PTR
c_func
(paren
id|emu
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|EMU8000_DATA1
c_func
(paren
id|emu
)paren
)paren
suffix:semicolon
multiline_comment|/* skew volume &amp; cutoff */
id|EMU8000_VTFT_WRITE
c_func
(paren
id|emu
comma
l_int|30
comma
l_int|0x8000FFFF
)paren
suffix:semicolon
id|EMU8000_VTFT_WRITE
c_func
(paren
id|emu
comma
l_int|31
comma
l_int|0x8000FFFF
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * The main initialization routine.&n; */
r_static
r_void
id|__init
DECL|function|snd_emu8000_init_hw
id|snd_emu8000_init_hw
c_func
(paren
id|emu8000_t
op_star
id|emu
)paren
(brace
r_int
id|i
suffix:semicolon
id|emu-&gt;last_reg
op_assign
l_int|0xffff
suffix:semicolon
multiline_comment|/* reset the last register index */
multiline_comment|/* initialize hardware configuration */
id|EMU8000_HWCF1_WRITE
c_func
(paren
id|emu
comma
l_int|0x0059
)paren
suffix:semicolon
id|EMU8000_HWCF2_WRITE
c_func
(paren
id|emu
comma
l_int|0x0020
)paren
suffix:semicolon
multiline_comment|/* disable audio; this seems to reduce a clicking noise a bit.. */
id|EMU8000_HWCF3_WRITE
c_func
(paren
id|emu
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* initialize audio channels */
id|init_audio
c_func
(paren
id|emu
)paren
suffix:semicolon
multiline_comment|/* initialize DMA */
id|init_dma
c_func
(paren
id|emu
)paren
suffix:semicolon
multiline_comment|/* initialize init arrays */
id|init_arrays
c_func
(paren
id|emu
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Initialize the FM section of the AWE32, this is needed&n;&t; * for DRAM refresh as well&n;&t; */
id|snd_emu8000_init_fm
c_func
(paren
id|emu
)paren
suffix:semicolon
multiline_comment|/* terminate all voices */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|EMU8000_DRAM_VOICES
suffix:semicolon
id|i
op_increment
)paren
id|EMU8000_DCYSUSV_WRITE
c_func
(paren
id|emu
comma
l_int|0
comma
l_int|0x807F
)paren
suffix:semicolon
multiline_comment|/* check DRAM memory size */
id|size_dram
c_func
(paren
id|emu
)paren
suffix:semicolon
multiline_comment|/* enable audio */
id|EMU8000_HWCF3_WRITE
c_func
(paren
id|emu
comma
l_int|0x4
)paren
suffix:semicolon
multiline_comment|/* set equzlier, chorus and reverb modes */
id|snd_emu8000_update_equalizer
c_func
(paren
id|emu
)paren
suffix:semicolon
id|snd_emu8000_update_chorus_mode
c_func
(paren
id|emu
)paren
suffix:semicolon
id|snd_emu8000_update_reverb_mode
c_func
(paren
id|emu
)paren
suffix:semicolon
)brace
multiline_comment|/*----------------------------------------------------------------&n; * Bass/Treble Equalizer&n; *----------------------------------------------------------------*/
DECL|variable|bass_parm
r_static
r_int
r_int
id|bass_parm
(braket
l_int|12
)braket
(braket
l_int|3
)braket
op_assign
(brace
(brace
l_int|0xD26A
comma
l_int|0xD36A
comma
l_int|0x0000
)brace
comma
multiline_comment|/* -12 dB */
(brace
l_int|0xD25B
comma
l_int|0xD35B
comma
l_int|0x0000
)brace
comma
multiline_comment|/*  -8 */
(brace
l_int|0xD24C
comma
l_int|0xD34C
comma
l_int|0x0000
)brace
comma
multiline_comment|/*  -6 */
(brace
l_int|0xD23D
comma
l_int|0xD33D
comma
l_int|0x0000
)brace
comma
multiline_comment|/*  -4 */
(brace
l_int|0xD21F
comma
l_int|0xD31F
comma
l_int|0x0000
)brace
comma
multiline_comment|/*  -2 */
(brace
l_int|0xC208
comma
l_int|0xC308
comma
l_int|0x0001
)brace
comma
multiline_comment|/*   0 (HW default) */
(brace
l_int|0xC219
comma
l_int|0xC319
comma
l_int|0x0001
)brace
comma
multiline_comment|/*  +2 */
(brace
l_int|0xC22A
comma
l_int|0xC32A
comma
l_int|0x0001
)brace
comma
multiline_comment|/*  +4 */
(brace
l_int|0xC24C
comma
l_int|0xC34C
comma
l_int|0x0001
)brace
comma
multiline_comment|/*  +6 */
(brace
l_int|0xC26E
comma
l_int|0xC36E
comma
l_int|0x0001
)brace
comma
multiline_comment|/*  +8 */
(brace
l_int|0xC248
comma
l_int|0xC384
comma
l_int|0x0002
)brace
comma
multiline_comment|/* +10 */
(brace
l_int|0xC26A
comma
l_int|0xC36A
comma
l_int|0x0002
)brace
comma
multiline_comment|/* +12 dB */
)brace
suffix:semicolon
DECL|variable|treble_parm
r_static
r_int
r_int
id|treble_parm
(braket
l_int|12
)braket
(braket
l_int|9
)braket
op_assign
(brace
(brace
l_int|0x821E
comma
l_int|0xC26A
comma
l_int|0x031E
comma
l_int|0xC36A
comma
l_int|0x021E
comma
l_int|0xD208
comma
l_int|0x831E
comma
l_int|0xD308
comma
l_int|0x0001
)brace
comma
multiline_comment|/* -12 dB */
(brace
l_int|0x821E
comma
l_int|0xC25B
comma
l_int|0x031E
comma
l_int|0xC35B
comma
l_int|0x021E
comma
l_int|0xD208
comma
l_int|0x831E
comma
l_int|0xD308
comma
l_int|0x0001
)brace
comma
(brace
l_int|0x821E
comma
l_int|0xC24C
comma
l_int|0x031E
comma
l_int|0xC34C
comma
l_int|0x021E
comma
l_int|0xD208
comma
l_int|0x831E
comma
l_int|0xD308
comma
l_int|0x0001
)brace
comma
(brace
l_int|0x821E
comma
l_int|0xC23D
comma
l_int|0x031E
comma
l_int|0xC33D
comma
l_int|0x021E
comma
l_int|0xD208
comma
l_int|0x831E
comma
l_int|0xD308
comma
l_int|0x0001
)brace
comma
(brace
l_int|0x821E
comma
l_int|0xC21F
comma
l_int|0x031E
comma
l_int|0xC31F
comma
l_int|0x021E
comma
l_int|0xD208
comma
l_int|0x831E
comma
l_int|0xD308
comma
l_int|0x0001
)brace
comma
(brace
l_int|0x821E
comma
l_int|0xD208
comma
l_int|0x031E
comma
l_int|0xD308
comma
l_int|0x021E
comma
l_int|0xD208
comma
l_int|0x831E
comma
l_int|0xD308
comma
l_int|0x0002
)brace
comma
(brace
l_int|0x821E
comma
l_int|0xD208
comma
l_int|0x031E
comma
l_int|0xD308
comma
l_int|0x021D
comma
l_int|0xD219
comma
l_int|0x831D
comma
l_int|0xD319
comma
l_int|0x0002
)brace
comma
(brace
l_int|0x821E
comma
l_int|0xD208
comma
l_int|0x031E
comma
l_int|0xD308
comma
l_int|0x021C
comma
l_int|0xD22A
comma
l_int|0x831C
comma
l_int|0xD32A
comma
l_int|0x0002
)brace
comma
(brace
l_int|0x821E
comma
l_int|0xD208
comma
l_int|0x031E
comma
l_int|0xD308
comma
l_int|0x021A
comma
l_int|0xD24C
comma
l_int|0x831A
comma
l_int|0xD34C
comma
l_int|0x0002
)brace
comma
(brace
l_int|0x821E
comma
l_int|0xD208
comma
l_int|0x031E
comma
l_int|0xD308
comma
l_int|0x0219
comma
l_int|0xD26E
comma
l_int|0x8319
comma
l_int|0xD36E
comma
l_int|0x0002
)brace
comma
multiline_comment|/* +8 (HW default) */
(brace
l_int|0x821D
comma
l_int|0xD219
comma
l_int|0x031D
comma
l_int|0xD319
comma
l_int|0x0219
comma
l_int|0xD26E
comma
l_int|0x8319
comma
l_int|0xD36E
comma
l_int|0x0002
)brace
comma
(brace
l_int|0x821C
comma
l_int|0xD22A
comma
l_int|0x031C
comma
l_int|0xD32A
comma
l_int|0x0219
comma
l_int|0xD26E
comma
l_int|0x8319
comma
l_int|0xD36E
comma
l_int|0x0002
)brace
multiline_comment|/* +12 dB */
)brace
suffix:semicolon
multiline_comment|/*&n; * set Emu8000 digital equalizer; from 0 to 11 [-12dB - 12dB]&n; */
multiline_comment|/*exported*/
r_void
DECL|function|snd_emu8000_update_equalizer
id|snd_emu8000_update_equalizer
c_func
(paren
id|emu8000_t
op_star
id|emu
)paren
(brace
r_int
r_int
id|w
suffix:semicolon
r_int
id|bass
op_assign
id|emu-&gt;bass_level
suffix:semicolon
r_int
id|treble
op_assign
id|emu-&gt;treble_level
suffix:semicolon
r_if
c_cond
(paren
id|bass
template_param
l_int|11
op_logical_or
id|treble
template_param
l_int|11
)paren
r_return
suffix:semicolon
id|EMU8000_INIT4_WRITE
c_func
(paren
id|emu
comma
l_int|0x01
comma
id|bass_parm
(braket
id|bass
)braket
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|EMU8000_INIT4_WRITE
c_func
(paren
id|emu
comma
l_int|0x11
comma
id|bass_parm
(braket
id|bass
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|EMU8000_INIT3_WRITE
c_func
(paren
id|emu
comma
l_int|0x11
comma
id|treble_parm
(braket
id|treble
)braket
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|EMU8000_INIT3_WRITE
c_func
(paren
id|emu
comma
l_int|0x13
comma
id|treble_parm
(braket
id|treble
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|EMU8000_INIT3_WRITE
c_func
(paren
id|emu
comma
l_int|0x1b
comma
id|treble_parm
(braket
id|treble
)braket
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|EMU8000_INIT4_WRITE
c_func
(paren
id|emu
comma
l_int|0x07
comma
id|treble_parm
(braket
id|treble
)braket
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|EMU8000_INIT4_WRITE
c_func
(paren
id|emu
comma
l_int|0x0b
comma
id|treble_parm
(braket
id|treble
)braket
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|EMU8000_INIT4_WRITE
c_func
(paren
id|emu
comma
l_int|0x0d
comma
id|treble_parm
(braket
id|treble
)braket
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|EMU8000_INIT4_WRITE
c_func
(paren
id|emu
comma
l_int|0x17
comma
id|treble_parm
(braket
id|treble
)braket
(braket
l_int|6
)braket
)paren
suffix:semicolon
id|EMU8000_INIT4_WRITE
c_func
(paren
id|emu
comma
l_int|0x19
comma
id|treble_parm
(braket
id|treble
)braket
(braket
l_int|7
)braket
)paren
suffix:semicolon
id|w
op_assign
id|bass_parm
(braket
id|bass
)braket
(braket
l_int|2
)braket
op_plus
id|treble_parm
(braket
id|treble
)braket
(braket
l_int|8
)braket
suffix:semicolon
id|EMU8000_INIT4_WRITE
c_func
(paren
id|emu
comma
l_int|0x15
comma
(paren
r_int
r_int
)paren
(paren
id|w
op_plus
l_int|0x0262
)paren
)paren
suffix:semicolon
id|EMU8000_INIT4_WRITE
c_func
(paren
id|emu
comma
l_int|0x1d
comma
(paren
r_int
r_int
)paren
(paren
id|w
op_plus
l_int|0x8362
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*----------------------------------------------------------------&n; * Chorus mode control&n; *----------------------------------------------------------------*/
multiline_comment|/*&n; * chorus mode parameters&n; */
DECL|macro|SNDRV_EMU8000_CHORUS_1
mdefine_line|#define SNDRV_EMU8000_CHORUS_1&t;&t;0
DECL|macro|SNDRV_EMU8000_CHORUS_2
mdefine_line|#define&t;SNDRV_EMU8000_CHORUS_2&t;&t;1
DECL|macro|SNDRV_EMU8000_CHORUS_3
mdefine_line|#define&t;SNDRV_EMU8000_CHORUS_3&t;&t;2
DECL|macro|SNDRV_EMU8000_CHORUS_4
mdefine_line|#define&t;SNDRV_EMU8000_CHORUS_4&t;&t;3
DECL|macro|SNDRV_EMU8000_CHORUS_FEEDBACK
mdefine_line|#define&t;SNDRV_EMU8000_CHORUS_FEEDBACK&t;4
DECL|macro|SNDRV_EMU8000_CHORUS_FLANGER
mdefine_line|#define&t;SNDRV_EMU8000_CHORUS_FLANGER&t;5
DECL|macro|SNDRV_EMU8000_CHORUS_SHORTDELAY
mdefine_line|#define&t;SNDRV_EMU8000_CHORUS_SHORTDELAY&t;6
DECL|macro|SNDRV_EMU8000_CHORUS_SHORTDELAY2
mdefine_line|#define&t;SNDRV_EMU8000_CHORUS_SHORTDELAY2&t;7
DECL|macro|SNDRV_EMU8000_CHORUS_PREDEFINED
mdefine_line|#define SNDRV_EMU8000_CHORUS_PREDEFINED&t;8
multiline_comment|/* user can define chorus modes up to 32 */
DECL|macro|SNDRV_EMU8000_CHORUS_NUMBERS
mdefine_line|#define SNDRV_EMU8000_CHORUS_NUMBERS&t;32
DECL|struct|soundfont_chorus_fx_t
r_typedef
r_struct
id|soundfont_chorus_fx_t
(brace
DECL|member|feedback
r_int
r_int
id|feedback
suffix:semicolon
multiline_comment|/* feedback level (0xE600-0xE6FF) */
DECL|member|delay_offset
r_int
r_int
id|delay_offset
suffix:semicolon
multiline_comment|/* delay (0-0x0DA3) [1/44100 sec] */
DECL|member|lfo_depth
r_int
r_int
id|lfo_depth
suffix:semicolon
multiline_comment|/* LFO depth (0xBC00-0xBCFF) */
DECL|member|delay
r_int
r_int
id|delay
suffix:semicolon
multiline_comment|/* right delay (0-0xFFFFFFFF) [1/256/44100 sec] */
DECL|member|lfo_freq
r_int
r_int
id|lfo_freq
suffix:semicolon
multiline_comment|/* LFO freq LFO freq (0-0xFFFFFFFF) */
DECL|typedef|soundfont_chorus_fx_t
)brace
id|soundfont_chorus_fx_t
suffix:semicolon
multiline_comment|/* 5 parameters for each chorus mode; 3 x 16bit, 2 x 32bit */
DECL|variable|chorus_defined
r_static
r_char
id|chorus_defined
(braket
id|SNDRV_EMU8000_CHORUS_NUMBERS
)braket
suffix:semicolon
DECL|variable|chorus_parm
r_static
id|soundfont_chorus_fx_t
id|chorus_parm
(braket
id|SNDRV_EMU8000_CHORUS_NUMBERS
)braket
op_assign
(brace
(brace
l_int|0xE600
comma
l_int|0x03F6
comma
l_int|0xBC2C
comma
l_int|0x00000000
comma
l_int|0x0000006D
)brace
comma
multiline_comment|/* chorus 1 */
(brace
l_int|0xE608
comma
l_int|0x031A
comma
l_int|0xBC6E
comma
l_int|0x00000000
comma
l_int|0x0000017C
)brace
comma
multiline_comment|/* chorus 2 */
(brace
l_int|0xE610
comma
l_int|0x031A
comma
l_int|0xBC84
comma
l_int|0x00000000
comma
l_int|0x00000083
)brace
comma
multiline_comment|/* chorus 3 */
(brace
l_int|0xE620
comma
l_int|0x0269
comma
l_int|0xBC6E
comma
l_int|0x00000000
comma
l_int|0x0000017C
)brace
comma
multiline_comment|/* chorus 4 */
(brace
l_int|0xE680
comma
l_int|0x04D3
comma
l_int|0xBCA6
comma
l_int|0x00000000
comma
l_int|0x0000005B
)brace
comma
multiline_comment|/* feedback */
(brace
l_int|0xE6E0
comma
l_int|0x044E
comma
l_int|0xBC37
comma
l_int|0x00000000
comma
l_int|0x00000026
)brace
comma
multiline_comment|/* flanger */
(brace
l_int|0xE600
comma
l_int|0x0B06
comma
l_int|0xBC00
comma
l_int|0x0006E000
comma
l_int|0x00000083
)brace
comma
multiline_comment|/* short delay */
(brace
l_int|0xE6C0
comma
l_int|0x0B06
comma
l_int|0xBC00
comma
l_int|0x0006E000
comma
l_int|0x00000083
)brace
comma
multiline_comment|/* short delay + feedback */
)brace
suffix:semicolon
multiline_comment|/*exported*/
r_int
DECL|function|snd_emu8000_load_chorus_fx
id|snd_emu8000_load_chorus_fx
c_func
(paren
id|emu8000_t
op_star
id|emu
comma
r_int
id|mode
comma
r_const
r_void
id|__user
op_star
id|buf
comma
r_int
id|len
)paren
(brace
id|soundfont_chorus_fx_t
id|rec
suffix:semicolon
r_if
c_cond
(paren
id|mode
OL
id|SNDRV_EMU8000_CHORUS_PREDEFINED
op_logical_or
id|mode
op_ge
id|SNDRV_EMU8000_CHORUS_NUMBERS
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;invalid chorus mode %d for uploading&bslash;n&quot;
comma
id|mode
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
OL
(paren
r_int
)paren
r_sizeof
(paren
id|rec
)paren
op_logical_or
id|copy_from_user
c_func
(paren
op_amp
id|rec
comma
id|buf
comma
r_sizeof
(paren
id|rec
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|chorus_parm
(braket
id|mode
)braket
op_assign
id|rec
suffix:semicolon
id|chorus_defined
(braket
id|mode
)braket
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*exported*/
r_void
DECL|function|snd_emu8000_update_chorus_mode
id|snd_emu8000_update_chorus_mode
c_func
(paren
id|emu8000_t
op_star
id|emu
)paren
(brace
r_int
id|effect
op_assign
id|emu-&gt;chorus_mode
suffix:semicolon
r_if
c_cond
(paren
id|effect
OL
l_int|0
op_logical_or
id|effect
op_ge
id|SNDRV_EMU8000_CHORUS_NUMBERS
op_logical_or
(paren
id|effect
op_ge
id|SNDRV_EMU8000_CHORUS_PREDEFINED
op_logical_and
op_logical_neg
id|chorus_defined
(braket
id|effect
)braket
)paren
)paren
r_return
suffix:semicolon
id|EMU8000_INIT3_WRITE
c_func
(paren
id|emu
comma
l_int|0x09
comma
id|chorus_parm
(braket
id|effect
)braket
dot
id|feedback
)paren
suffix:semicolon
id|EMU8000_INIT3_WRITE
c_func
(paren
id|emu
comma
l_int|0x0c
comma
id|chorus_parm
(braket
id|effect
)braket
dot
id|delay_offset
)paren
suffix:semicolon
id|EMU8000_INIT4_WRITE
c_func
(paren
id|emu
comma
l_int|0x03
comma
id|chorus_parm
(braket
id|effect
)braket
dot
id|lfo_depth
)paren
suffix:semicolon
id|EMU8000_HWCF4_WRITE
c_func
(paren
id|emu
comma
id|chorus_parm
(braket
id|effect
)braket
dot
id|delay
)paren
suffix:semicolon
id|EMU8000_HWCF5_WRITE
c_func
(paren
id|emu
comma
id|chorus_parm
(braket
id|effect
)braket
dot
id|lfo_freq
)paren
suffix:semicolon
id|EMU8000_HWCF6_WRITE
c_func
(paren
id|emu
comma
l_int|0x8000
)paren
suffix:semicolon
id|EMU8000_HWCF7_WRITE
c_func
(paren
id|emu
comma
l_int|0x0000
)paren
suffix:semicolon
)brace
multiline_comment|/*----------------------------------------------------------------&n; * Reverb mode control&n; *----------------------------------------------------------------*/
multiline_comment|/*&n; * reverb mode parameters&n; */
DECL|macro|SNDRV_EMU8000_REVERB_ROOM1
mdefine_line|#define&t;SNDRV_EMU8000_REVERB_ROOM1&t;0
DECL|macro|SNDRV_EMU8000_REVERB_ROOM2
mdefine_line|#define SNDRV_EMU8000_REVERB_ROOM2&t;1
DECL|macro|SNDRV_EMU8000_REVERB_ROOM3
mdefine_line|#define&t;SNDRV_EMU8000_REVERB_ROOM3&t;2
DECL|macro|SNDRV_EMU8000_REVERB_HALL1
mdefine_line|#define&t;SNDRV_EMU8000_REVERB_HALL1&t;3
DECL|macro|SNDRV_EMU8000_REVERB_HALL2
mdefine_line|#define&t;SNDRV_EMU8000_REVERB_HALL2&t;4
DECL|macro|SNDRV_EMU8000_REVERB_PLATE
mdefine_line|#define&t;SNDRV_EMU8000_REVERB_PLATE&t;5
DECL|macro|SNDRV_EMU8000_REVERB_DELAY
mdefine_line|#define&t;SNDRV_EMU8000_REVERB_DELAY&t;6
DECL|macro|SNDRV_EMU8000_REVERB_PANNINGDELAY
mdefine_line|#define&t;SNDRV_EMU8000_REVERB_PANNINGDELAY 7
DECL|macro|SNDRV_EMU8000_REVERB_PREDEFINED
mdefine_line|#define SNDRV_EMU8000_REVERB_PREDEFINED&t;8
multiline_comment|/* user can define reverb modes up to 32 */
DECL|macro|SNDRV_EMU8000_REVERB_NUMBERS
mdefine_line|#define SNDRV_EMU8000_REVERB_NUMBERS&t;32
DECL|struct|soundfont_reverb_fx_t
r_typedef
r_struct
id|soundfont_reverb_fx_t
(brace
DECL|member|parms
r_int
r_int
id|parms
(braket
l_int|28
)braket
suffix:semicolon
DECL|typedef|soundfont_reverb_fx_t
)brace
id|soundfont_reverb_fx_t
suffix:semicolon
multiline_comment|/* reverb mode settings; write the following 28 data of 16 bit length&n; *   on the corresponding ports in the reverb_cmds array&n; */
DECL|variable|reverb_defined
r_static
r_char
id|reverb_defined
(braket
id|SNDRV_EMU8000_CHORUS_NUMBERS
)braket
suffix:semicolon
DECL|variable|reverb_parm
r_static
id|soundfont_reverb_fx_t
id|reverb_parm
(braket
id|SNDRV_EMU8000_REVERB_NUMBERS
)braket
op_assign
(brace
(brace
(brace
multiline_comment|/* room 1 */
l_int|0xB488
comma
l_int|0xA450
comma
l_int|0x9550
comma
l_int|0x84B5
comma
l_int|0x383A
comma
l_int|0x3EB5
comma
l_int|0x72F4
comma
l_int|0x72A4
comma
l_int|0x7254
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x4416
comma
l_int|0x4516
comma
l_int|0xA490
comma
l_int|0xA590
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8428
comma
l_int|0x8528
comma
l_int|0x8428
comma
l_int|0x8528
comma
)brace
)brace
comma
(brace
(brace
multiline_comment|/* room 2 */
l_int|0xB488
comma
l_int|0xA458
comma
l_int|0x9558
comma
l_int|0x84B5
comma
l_int|0x383A
comma
l_int|0x3EB5
comma
l_int|0x7284
comma
l_int|0x7254
comma
l_int|0x7224
comma
l_int|0x7224
comma
l_int|0x7254
comma
l_int|0x7284
comma
l_int|0x4448
comma
l_int|0x4548
comma
l_int|0xA440
comma
l_int|0xA540
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8428
comma
l_int|0x8528
comma
l_int|0x8428
comma
l_int|0x8528
comma
)brace
)brace
comma
(brace
(brace
multiline_comment|/* room 3 */
l_int|0xB488
comma
l_int|0xA460
comma
l_int|0x9560
comma
l_int|0x84B5
comma
l_int|0x383A
comma
l_int|0x3EB5
comma
l_int|0x7284
comma
l_int|0x7254
comma
l_int|0x7224
comma
l_int|0x7224
comma
l_int|0x7254
comma
l_int|0x7284
comma
l_int|0x4416
comma
l_int|0x4516
comma
l_int|0xA490
comma
l_int|0xA590
comma
l_int|0x842C
comma
l_int|0x852C
comma
l_int|0x842C
comma
l_int|0x852C
comma
l_int|0x842B
comma
l_int|0x852B
comma
l_int|0x842B
comma
l_int|0x852B
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x842A
comma
l_int|0x852A
comma
)brace
)brace
comma
(brace
(brace
multiline_comment|/* hall 1 */
l_int|0xB488
comma
l_int|0xA470
comma
l_int|0x9570
comma
l_int|0x84B5
comma
l_int|0x383A
comma
l_int|0x3EB5
comma
l_int|0x7284
comma
l_int|0x7254
comma
l_int|0x7224
comma
l_int|0x7224
comma
l_int|0x7254
comma
l_int|0x7284
comma
l_int|0x4448
comma
l_int|0x4548
comma
l_int|0xA440
comma
l_int|0xA540
comma
l_int|0x842B
comma
l_int|0x852B
comma
l_int|0x842B
comma
l_int|0x852B
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8429
comma
l_int|0x8529
comma
)brace
)brace
comma
(brace
(brace
multiline_comment|/* hall 2 */
l_int|0xB488
comma
l_int|0xA470
comma
l_int|0x9570
comma
l_int|0x84B5
comma
l_int|0x383A
comma
l_int|0x3EB5
comma
l_int|0x7254
comma
l_int|0x7234
comma
l_int|0x7224
comma
l_int|0x7254
comma
l_int|0x7264
comma
l_int|0x7294
comma
l_int|0x44C3
comma
l_int|0x45C3
comma
l_int|0xA404
comma
l_int|0xA504
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8428
comma
l_int|0x8528
comma
l_int|0x8428
comma
l_int|0x8528
comma
)brace
)brace
comma
(brace
(brace
multiline_comment|/* plate */
l_int|0xB4FF
comma
l_int|0xA470
comma
l_int|0x9570
comma
l_int|0x84B5
comma
l_int|0x383A
comma
l_int|0x3EB5
comma
l_int|0x7234
comma
l_int|0x7234
comma
l_int|0x7234
comma
l_int|0x7234
comma
l_int|0x7234
comma
l_int|0x7234
comma
l_int|0x4448
comma
l_int|0x4548
comma
l_int|0xA440
comma
l_int|0xA540
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x842A
comma
l_int|0x852A
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8429
comma
l_int|0x8529
comma
l_int|0x8428
comma
l_int|0x8528
comma
l_int|0x8428
comma
l_int|0x8528
comma
)brace
)brace
comma
(brace
(brace
multiline_comment|/* delay */
l_int|0xB4FF
comma
l_int|0xA470
comma
l_int|0x9500
comma
l_int|0x84B5
comma
l_int|0x333A
comma
l_int|0x39B5
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x72F4
comma
l_int|0x4400
comma
l_int|0x4500
comma
l_int|0xA4FF
comma
l_int|0xA5FF
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
)brace
)brace
comma
(brace
(brace
multiline_comment|/* panning delay */
l_int|0xB4FF
comma
l_int|0xA490
comma
l_int|0x9590
comma
l_int|0x8474
comma
l_int|0x333A
comma
l_int|0x39B5
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x7204
comma
l_int|0x72F4
comma
l_int|0x4400
comma
l_int|0x4500
comma
l_int|0xA4FF
comma
l_int|0xA5FF
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
l_int|0x8420
comma
l_int|0x8520
comma
)brace
)brace
comma
)brace
suffix:semicolon
DECL|enumerator|DATA1
DECL|enumerator|DATA2
r_enum
(brace
id|DATA1
comma
id|DATA2
)brace
suffix:semicolon
DECL|macro|AWE_INIT1
mdefine_line|#define AWE_INIT1(c)&t;EMU8000_CMD(2,c), DATA1
DECL|macro|AWE_INIT2
mdefine_line|#define AWE_INIT2(c)&t;EMU8000_CMD(2,c), DATA2
DECL|macro|AWE_INIT3
mdefine_line|#define AWE_INIT3(c)&t;EMU8000_CMD(3,c), DATA1
DECL|macro|AWE_INIT4
mdefine_line|#define AWE_INIT4(c)&t;EMU8000_CMD(3,c), DATA2
DECL|struct|reverb_cmd_pair
r_static
r_struct
id|reverb_cmd_pair
(brace
DECL|member|cmd
DECL|member|port
r_int
r_int
id|cmd
comma
id|port
suffix:semicolon
DECL|variable|reverb_cmds
)brace
id|reverb_cmds
(braket
l_int|28
)braket
op_assign
(brace
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x03
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x05
)paren
)brace
comma
(brace
id|AWE_INIT4
c_func
(paren
l_int|0x1F
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x07
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x14
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x16
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x0F
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x17
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x1F
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x07
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x0F
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x17
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x1D
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x1F
)paren
)brace
comma
(brace
id|AWE_INIT3
c_func
(paren
l_int|0x01
)paren
)brace
comma
(brace
id|AWE_INIT3
c_func
(paren
l_int|0x03
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x09
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x0B
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x11
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x13
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x19
)paren
)brace
comma
(brace
id|AWE_INIT1
c_func
(paren
l_int|0x1B
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x01
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x03
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x09
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x0B
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x11
)paren
)brace
comma
(brace
id|AWE_INIT2
c_func
(paren
l_int|0x13
)paren
)brace
comma
)brace
suffix:semicolon
multiline_comment|/*exported*/
r_int
DECL|function|snd_emu8000_load_reverb_fx
id|snd_emu8000_load_reverb_fx
c_func
(paren
id|emu8000_t
op_star
id|emu
comma
r_int
id|mode
comma
r_const
r_void
id|__user
op_star
id|buf
comma
r_int
id|len
)paren
(brace
id|soundfont_reverb_fx_t
id|rec
suffix:semicolon
r_if
c_cond
(paren
id|mode
OL
id|SNDRV_EMU8000_REVERB_PREDEFINED
op_logical_or
id|mode
op_ge
id|SNDRV_EMU8000_REVERB_NUMBERS
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;invalid reverb mode %d for uploading&bslash;n&quot;
comma
id|mode
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
OL
(paren
r_int
)paren
r_sizeof
(paren
id|rec
)paren
op_logical_or
id|copy_from_user
c_func
(paren
op_amp
id|rec
comma
id|buf
comma
r_sizeof
(paren
id|rec
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|reverb_parm
(braket
id|mode
)braket
op_assign
id|rec
suffix:semicolon
id|reverb_defined
(braket
id|mode
)braket
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*exported*/
r_void
DECL|function|snd_emu8000_update_reverb_mode
id|snd_emu8000_update_reverb_mode
c_func
(paren
id|emu8000_t
op_star
id|emu
)paren
(brace
r_int
id|effect
op_assign
id|emu-&gt;reverb_mode
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|effect
OL
l_int|0
op_logical_or
id|effect
op_ge
id|SNDRV_EMU8000_REVERB_NUMBERS
op_logical_or
(paren
id|effect
op_ge
id|SNDRV_EMU8000_REVERB_PREDEFINED
op_logical_and
op_logical_neg
id|reverb_defined
(braket
id|effect
)braket
)paren
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|28
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|port
suffix:semicolon
r_if
c_cond
(paren
id|reverb_cmds
(braket
id|i
)braket
dot
id|port
op_eq
id|DATA1
)paren
id|port
op_assign
id|EMU8000_DATA1
c_func
(paren
id|emu
)paren
suffix:semicolon
r_else
id|port
op_assign
id|EMU8000_DATA2
c_func
(paren
id|emu
)paren
suffix:semicolon
id|snd_emu8000_poke
c_func
(paren
id|emu
comma
id|port
comma
id|reverb_cmds
(braket
id|i
)braket
dot
id|cmd
comma
id|reverb_parm
(braket
id|effect
)braket
dot
id|parms
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*----------------------------------------------------------------&n; * mixer interface&n; *----------------------------------------------------------------*/
multiline_comment|/*&n; * bass/treble&n; */
DECL|function|mixer_bass_treble_info
r_static
r_int
id|mixer_bass_treble_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|11
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mixer_bass_treble_get
r_static
r_int
id|mixer_bass_treble_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|emu8000_t
op_star
id|emu
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|kcontrol-&gt;private_value
ques
c_cond
id|emu-&gt;treble_level
suffix:colon
id|emu-&gt;bass_level
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mixer_bass_treble_put
r_static
r_int
id|mixer_bass_treble_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|emu8000_t
op_star
id|emu
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|change
suffix:semicolon
r_int
r_int
id|val1
suffix:semicolon
id|val1
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_mod
l_int|12
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;control_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kcontrol-&gt;private_value
)paren
(brace
id|change
op_assign
id|val1
op_ne
id|emu-&gt;treble_level
suffix:semicolon
id|emu-&gt;treble_level
op_assign
id|val1
suffix:semicolon
)brace
r_else
(brace
id|change
op_assign
id|val1
op_ne
id|emu-&gt;bass_level
suffix:semicolon
id|emu-&gt;bass_level
op_assign
id|val1
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;control_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_emu8000_update_equalizer
c_func
(paren
id|emu
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|mixer_bass_control
r_static
id|snd_kcontrol_new_t
id|mixer_bass_control
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Synth Tone Control - Bass&quot;
comma
dot
id|info
op_assign
id|mixer_bass_treble_info
comma
dot
id|get
op_assign
id|mixer_bass_treble_get
comma
dot
id|put
op_assign
id|mixer_bass_treble_put
comma
dot
id|private_value
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|mixer_treble_control
r_static
id|snd_kcontrol_new_t
id|mixer_treble_control
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Synth Tone Control - Treble&quot;
comma
dot
id|info
op_assign
id|mixer_bass_treble_info
comma
dot
id|get
op_assign
id|mixer_bass_treble_get
comma
dot
id|put
op_assign
id|mixer_bass_treble_put
comma
dot
id|private_value
op_assign
l_int|1
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * chorus/reverb mode&n; */
DECL|function|mixer_chorus_reverb_info
r_static
r_int
id|mixer_chorus_reverb_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
id|kcontrol-&gt;private_value
ques
c_cond
(paren
id|SNDRV_EMU8000_CHORUS_NUMBERS
op_minus
l_int|1
)paren
suffix:colon
(paren
id|SNDRV_EMU8000_REVERB_NUMBERS
op_minus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mixer_chorus_reverb_get
r_static
r_int
id|mixer_chorus_reverb_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|emu8000_t
op_star
id|emu
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|kcontrol-&gt;private_value
ques
c_cond
id|emu-&gt;chorus_mode
suffix:colon
id|emu-&gt;reverb_mode
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mixer_chorus_reverb_put
r_static
r_int
id|mixer_chorus_reverb_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|emu8000_t
op_star
id|emu
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|change
suffix:semicolon
r_int
r_int
id|val1
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;control_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kcontrol-&gt;private_value
)paren
(brace
id|val1
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_mod
id|SNDRV_EMU8000_CHORUS_NUMBERS
suffix:semicolon
id|change
op_assign
id|val1
op_ne
id|emu-&gt;chorus_mode
suffix:semicolon
id|emu-&gt;chorus_mode
op_assign
id|val1
suffix:semicolon
)brace
r_else
(brace
id|val1
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_mod
id|SNDRV_EMU8000_REVERB_NUMBERS
suffix:semicolon
id|change
op_assign
id|val1
op_ne
id|emu-&gt;reverb_mode
suffix:semicolon
id|emu-&gt;reverb_mode
op_assign
id|val1
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;control_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
(brace
r_if
c_cond
(paren
id|kcontrol-&gt;private_value
)paren
id|snd_emu8000_update_chorus_mode
c_func
(paren
id|emu
)paren
suffix:semicolon
r_else
id|snd_emu8000_update_reverb_mode
c_func
(paren
id|emu
)paren
suffix:semicolon
)brace
r_return
id|change
suffix:semicolon
)brace
DECL|variable|mixer_chorus_mode_control
r_static
id|snd_kcontrol_new_t
id|mixer_chorus_mode_control
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Chorus Mode&quot;
comma
dot
id|info
op_assign
id|mixer_chorus_reverb_info
comma
dot
id|get
op_assign
id|mixer_chorus_reverb_get
comma
dot
id|put
op_assign
id|mixer_chorus_reverb_put
comma
dot
id|private_value
op_assign
l_int|1
comma
)brace
suffix:semicolon
DECL|variable|mixer_reverb_mode_control
r_static
id|snd_kcontrol_new_t
id|mixer_reverb_mode_control
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Reverb Mode&quot;
comma
dot
id|info
op_assign
id|mixer_chorus_reverb_info
comma
dot
id|get
op_assign
id|mixer_chorus_reverb_get
comma
dot
id|put
op_assign
id|mixer_chorus_reverb_put
comma
dot
id|private_value
op_assign
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * FM OPL3 chorus/reverb depth&n; */
DECL|function|mixer_fm_depth_info
r_static
r_int
id|mixer_fm_depth_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|255
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mixer_fm_depth_get
r_static
r_int
id|mixer_fm_depth_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|emu8000_t
op_star
id|emu
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|kcontrol-&gt;private_value
ques
c_cond
id|emu-&gt;fm_chorus_depth
suffix:colon
id|emu-&gt;fm_reverb_depth
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|mixer_fm_depth_put
r_static
r_int
id|mixer_fm_depth_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|emu8000_t
op_star
id|emu
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|change
suffix:semicolon
r_int
r_int
id|val1
suffix:semicolon
id|val1
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_mod
l_int|256
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;control_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kcontrol-&gt;private_value
)paren
(brace
id|change
op_assign
id|val1
op_ne
id|emu-&gt;fm_chorus_depth
suffix:semicolon
id|emu-&gt;fm_chorus_depth
op_assign
id|val1
suffix:semicolon
)brace
r_else
(brace
id|change
op_assign
id|val1
op_ne
id|emu-&gt;fm_reverb_depth
suffix:semicolon
id|emu-&gt;fm_reverb_depth
op_assign
id|val1
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;control_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
id|snd_emu8000_init_fm
c_func
(paren
id|emu
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|mixer_fm_chorus_depth_control
r_static
id|snd_kcontrol_new_t
id|mixer_fm_chorus_depth_control
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;FM Chorus Depth&quot;
comma
dot
id|info
op_assign
id|mixer_fm_depth_info
comma
dot
id|get
op_assign
id|mixer_fm_depth_get
comma
dot
id|put
op_assign
id|mixer_fm_depth_put
comma
dot
id|private_value
op_assign
l_int|1
comma
)brace
suffix:semicolon
DECL|variable|mixer_fm_reverb_depth_control
r_static
id|snd_kcontrol_new_t
id|mixer_fm_reverb_depth_control
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;FM Reverb Depth&quot;
comma
dot
id|info
op_assign
id|mixer_fm_depth_info
comma
dot
id|get
op_assign
id|mixer_fm_depth_get
comma
dot
id|put
op_assign
id|mixer_fm_depth_put
comma
dot
id|private_value
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|mixer_defs
r_static
id|snd_kcontrol_new_t
op_star
id|mixer_defs
(braket
id|EMU8000_NUM_CONTROLS
)braket
op_assign
(brace
op_amp
id|mixer_bass_control
comma
op_amp
id|mixer_treble_control
comma
op_amp
id|mixer_chorus_mode_control
comma
op_amp
id|mixer_reverb_mode_control
comma
op_amp
id|mixer_fm_chorus_depth_control
comma
op_amp
id|mixer_fm_reverb_depth_control
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * create and attach mixer elements for WaveTable treble/bass controls&n; */
r_static
r_int
id|__init
DECL|function|snd_emu8000_create_mixer
id|snd_emu8000_create_mixer
c_func
(paren
id|snd_card_t
op_star
id|card
comma
id|emu8000_t
op_star
id|emu
)paren
(brace
r_int
id|i
comma
id|err
op_assign
l_int|0
suffix:semicolon
id|snd_assert
c_func
(paren
id|emu
op_ne
l_int|NULL
op_logical_and
id|card
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|emu-&gt;control_lock
)paren
suffix:semicolon
id|memset
c_func
(paren
id|emu-&gt;controls
comma
l_int|0
comma
r_sizeof
(paren
id|emu-&gt;controls
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|EMU8000_NUM_CONTROLS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|emu-&gt;controls
(braket
id|i
)braket
op_assign
id|snd_ctl_new1
c_func
(paren
id|mixer_defs
(braket
id|i
)braket
comma
id|emu
)paren
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__error
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|__error
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|EMU8000_NUM_CONTROLS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|down_write
c_func
(paren
op_amp
id|card-&gt;controls_rwsem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|emu-&gt;controls
(braket
id|i
)braket
)paren
id|snd_ctl_remove
c_func
(paren
id|card
comma
id|emu-&gt;controls
(braket
id|i
)braket
)paren
suffix:semicolon
id|up_write
c_func
(paren
op_amp
id|card-&gt;controls_rwsem
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; * free resources&n; */
DECL|function|snd_emu8000_free
r_static
r_int
id|snd_emu8000_free
c_func
(paren
id|emu8000_t
op_star
id|hw
)paren
(brace
r_if
c_cond
(paren
id|hw-&gt;res_port1
)paren
(brace
id|release_resource
c_func
(paren
id|hw-&gt;res_port1
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|hw-&gt;res_port1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hw-&gt;res_port2
)paren
(brace
id|release_resource
c_func
(paren
id|hw-&gt;res_port2
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|hw-&gt;res_port2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|hw-&gt;res_port3
)paren
(brace
id|release_resource
c_func
(paren
id|hw-&gt;res_port3
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|hw-&gt;res_port3
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|hw
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; */
DECL|function|snd_emu8000_dev_free
r_static
r_int
id|snd_emu8000_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|emu8000_t
op_star
id|hw
op_assign
id|device-&gt;device_data
suffix:semicolon
r_return
id|snd_emu8000_free
c_func
(paren
id|hw
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * initialize and register emu8000 synth device.&n; */
r_int
id|__init
DECL|function|snd_emu8000_new
id|snd_emu8000_new
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_int
id|index
comma
r_int
id|port
comma
r_int
id|seq_ports
comma
id|snd_seq_device_t
op_star
op_star
id|awe_ret
)paren
(brace
id|snd_seq_device_t
op_star
id|awe
suffix:semicolon
id|emu8000_t
op_star
id|hw
suffix:semicolon
r_int
id|err
suffix:semicolon
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
dot
id|dev_free
op_assign
id|snd_emu8000_dev_free
comma
)brace
suffix:semicolon
r_if
c_cond
(paren
id|awe_ret
)paren
op_star
id|awe_ret
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|seq_ports
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|hw
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|hw
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hw
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|hw-&gt;reg_lock
)paren
suffix:semicolon
id|hw-&gt;index
op_assign
id|index
suffix:semicolon
id|hw-&gt;port1
op_assign
id|port
suffix:semicolon
id|hw-&gt;port2
op_assign
id|port
op_plus
l_int|0x400
suffix:semicolon
id|hw-&gt;port3
op_assign
id|port
op_plus
l_int|0x800
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|hw-&gt;res_port1
op_assign
id|request_region
c_func
(paren
id|hw-&gt;port1
comma
l_int|4
comma
l_string|&quot;Emu8000-1&quot;
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|hw-&gt;res_port2
op_assign
id|request_region
c_func
(paren
id|hw-&gt;port2
comma
l_int|4
comma
l_string|&quot;Emu8000-2&quot;
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|hw-&gt;res_port3
op_assign
id|request_region
c_func
(paren
id|hw-&gt;port3
comma
l_int|4
comma
l_string|&quot;Emu8000-3&quot;
)paren
)paren
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;sbawe: can&squot;t grab ports 0x%lx, 0x%lx, 0x%lx&bslash;n&quot;
comma
id|hw-&gt;port1
comma
id|hw-&gt;port2
comma
id|hw-&gt;port3
)paren
suffix:semicolon
id|snd_emu8000_free
c_func
(paren
id|hw
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|hw-&gt;mem_size
op_assign
l_int|0
suffix:semicolon
id|hw-&gt;card
op_assign
id|card
suffix:semicolon
id|hw-&gt;seq_ports
op_assign
id|seq_ports
suffix:semicolon
id|hw-&gt;bass_level
op_assign
l_int|5
suffix:semicolon
id|hw-&gt;treble_level
op_assign
l_int|9
suffix:semicolon
id|hw-&gt;chorus_mode
op_assign
l_int|2
suffix:semicolon
id|hw-&gt;reverb_mode
op_assign
l_int|4
suffix:semicolon
id|hw-&gt;fm_chorus_depth
op_assign
l_int|0
suffix:semicolon
id|hw-&gt;fm_reverb_depth
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|snd_emu8000_detect
c_func
(paren
id|hw
)paren
OL
l_int|0
)paren
(brace
id|snd_emu8000_free
c_func
(paren
id|hw
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|snd_emu8000_init_hw
c_func
(paren
id|hw
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_emu8000_create_mixer
c_func
(paren
id|card
comma
id|hw
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_emu8000_free
c_func
(paren
id|hw
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|hw
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_emu8000_free
c_func
(paren
id|hw
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_SND_SEQUENCER) || (defined(MODULE) &amp;&amp; defined(CONFIG_SND_SEQUENCER_MODULE))
r_if
c_cond
(paren
id|snd_seq_device_new
c_func
(paren
id|card
comma
id|index
comma
id|SNDRV_SEQ_DEV_ID_EMU8000
comma
r_sizeof
(paren
id|emu8000_t
op_star
)paren
comma
op_amp
id|awe
)paren
op_ge
l_int|0
)paren
(brace
id|strcpy
c_func
(paren
id|awe-&gt;name
comma
l_string|&quot;EMU-8000&quot;
)paren
suffix:semicolon
op_star
(paren
id|emu8000_t
op_star
op_star
)paren
id|SNDRV_SEQ_DEVICE_ARGPTR
c_func
(paren
id|awe
)paren
op_assign
id|hw
suffix:semicolon
)brace
macro_line|#else
id|awe
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|awe_ret
)paren
op_star
id|awe_ret
op_assign
id|awe
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * exported stuff&n; */
DECL|variable|snd_emu8000_poke
id|EXPORT_SYMBOL
c_func
(paren
id|snd_emu8000_poke
)paren
suffix:semicolon
DECL|variable|snd_emu8000_peek
id|EXPORT_SYMBOL
c_func
(paren
id|snd_emu8000_peek
)paren
suffix:semicolon
DECL|variable|snd_emu8000_poke_dw
id|EXPORT_SYMBOL
c_func
(paren
id|snd_emu8000_poke_dw
)paren
suffix:semicolon
DECL|variable|snd_emu8000_peek_dw
id|EXPORT_SYMBOL
c_func
(paren
id|snd_emu8000_peek_dw
)paren
suffix:semicolon
DECL|variable|snd_emu8000_dma_chan
id|EXPORT_SYMBOL
c_func
(paren
id|snd_emu8000_dma_chan
)paren
suffix:semicolon
DECL|variable|snd_emu8000_init_fm
id|EXPORT_SYMBOL
c_func
(paren
id|snd_emu8000_init_fm
)paren
suffix:semicolon
DECL|variable|snd_emu8000_load_chorus_fx
id|EXPORT_SYMBOL
c_func
(paren
id|snd_emu8000_load_chorus_fx
)paren
suffix:semicolon
DECL|variable|snd_emu8000_load_reverb_fx
id|EXPORT_SYMBOL
c_func
(paren
id|snd_emu8000_load_reverb_fx
)paren
suffix:semicolon
DECL|variable|snd_emu8000_update_chorus_mode
id|EXPORT_SYMBOL
c_func
(paren
id|snd_emu8000_update_chorus_mode
)paren
suffix:semicolon
DECL|variable|snd_emu8000_update_reverb_mode
id|EXPORT_SYMBOL
c_func
(paren
id|snd_emu8000_update_reverb_mode
)paren
suffix:semicolon
DECL|variable|snd_emu8000_update_equalizer
id|EXPORT_SYMBOL
c_func
(paren
id|snd_emu8000_update_equalizer
)paren
suffix:semicolon
eof
