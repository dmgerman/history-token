multiline_comment|/*&n; *  Copyright (c) 1999 by Uros Bizjak &lt;uros@kss-loka.si&gt;&n; *                        Takashi Iwai &lt;tiwai@suse.de&gt;&n; *&n; *  SB16ASP/AWE32 CSP control&n; *&n; *  CSP microcode loader:&n; *   alsa-tools/sb16_csp/ &n; *&n; *   This program is free software; you can redistribute it and/or modify &n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/control.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#include &lt;sound/sb16_csp.h&gt;
macro_line|#include &lt;sound/initval.h&gt;
DECL|macro|chip_t
mdefine_line|#define chip_t snd_sb_csp_t
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Uros Bizjak &lt;uros@kss-loka.si&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;ALSA driver for SB16 Creative Signal Processor&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_CLASSES
c_func
(paren
l_string|&quot;{sound}&quot;
)paren
suffix:semicolon
macro_line|#ifdef SNDRV_LITTLE_ENDIAN
DECL|macro|CSP_HDR_VALUE
mdefine_line|#define CSP_HDR_VALUE(a,b,c,d)&t;((a) | ((b)&lt;&lt;8) | ((c)&lt;&lt;16) | ((d)&lt;&lt;24))
macro_line|#else
DECL|macro|CSP_HDR_VALUE
mdefine_line|#define CSP_HDR_VALUE(a,b,c,d)&t;((d) | ((c)&lt;&lt;8) | ((b)&lt;&lt;16) | ((a)&lt;&lt;24))
macro_line|#endif
DECL|macro|LE_SHORT
mdefine_line|#define LE_SHORT(v)&t;&t;le16_to_cpu(v)
DECL|macro|LE_INT
mdefine_line|#define LE_INT(v)&t;&t;le32_to_cpu(v)
DECL|macro|RIFF_HEADER
mdefine_line|#define RIFF_HEADER&t;CSP_HDR_VALUE(&squot;R&squot;, &squot;I&squot;, &squot;F&squot;, &squot;F&squot;)
DECL|macro|CSP__HEADER
mdefine_line|#define CSP__HEADER&t;CSP_HDR_VALUE(&squot;C&squot;, &squot;S&squot;, &squot;P&squot;, &squot; &squot;)
DECL|macro|LIST_HEADER
mdefine_line|#define LIST_HEADER&t;CSP_HDR_VALUE(&squot;L&squot;, &squot;I&squot;, &squot;S&squot;, &squot;T&squot;)
DECL|macro|FUNC_HEADER
mdefine_line|#define FUNC_HEADER&t;CSP_HDR_VALUE(&squot;f&squot;, &squot;u&squot;, &squot;n&squot;, &squot;c&squot;)
DECL|macro|CODE_HEADER
mdefine_line|#define CODE_HEADER&t;CSP_HDR_VALUE(&squot;c&squot;, &squot;o&squot;, &squot;d&squot;, &squot;e&squot;)
DECL|macro|INIT_HEADER
mdefine_line|#define INIT_HEADER&t;CSP_HDR_VALUE(&squot;i&squot;, &squot;n&squot;, &squot;i&squot;, &squot;t&squot;)
DECL|macro|MAIN_HEADER
mdefine_line|#define MAIN_HEADER&t;CSP_HDR_VALUE(&squot;m&squot;, &squot;a&squot;, &squot;i&squot;, &squot;n&squot;)
multiline_comment|/*&n; * RIFF data format&n; */
DECL|struct|riff_header
r_typedef
r_struct
id|riff_header
(brace
DECL|member|name
id|__u32
id|name
suffix:semicolon
DECL|member|len
id|__u32
id|len
suffix:semicolon
DECL|typedef|riff_header_t
)brace
id|riff_header_t
suffix:semicolon
DECL|struct|desc_header
r_typedef
r_struct
id|desc_header
(brace
DECL|member|info
id|riff_header_t
id|info
suffix:semicolon
DECL|member|func_nr
id|__u16
id|func_nr
suffix:semicolon
DECL|member|VOC_type
id|__u16
id|VOC_type
suffix:semicolon
DECL|member|flags_play_rec
id|__u16
id|flags_play_rec
suffix:semicolon
DECL|member|flags_16bit_8bit
id|__u16
id|flags_16bit_8bit
suffix:semicolon
DECL|member|flags_stereo_mono
id|__u16
id|flags_stereo_mono
suffix:semicolon
DECL|member|flags_rates
id|__u16
id|flags_rates
suffix:semicolon
DECL|typedef|desc_header_t
)brace
id|desc_header_t
suffix:semicolon
multiline_comment|/*&n; * prototypes&n; */
r_static
r_void
id|snd_sb_csp_free
c_func
(paren
id|snd_hwdep_t
op_star
id|hw
)paren
suffix:semicolon
r_static
r_int
id|snd_sb_csp_open
c_func
(paren
id|snd_hwdep_t
op_star
id|hw
comma
r_struct
id|file
op_star
id|file
)paren
suffix:semicolon
r_static
r_int
id|snd_sb_csp_ioctl
c_func
(paren
id|snd_hwdep_t
op_star
id|hw
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
suffix:semicolon
r_static
r_int
id|snd_sb_csp_release
c_func
(paren
id|snd_hwdep_t
op_star
id|hw
comma
r_struct
id|file
op_star
id|file
)paren
suffix:semicolon
r_static
r_int
id|csp_detect
c_func
(paren
id|sb_t
op_star
id|chip
comma
r_int
op_star
id|version
)paren
suffix:semicolon
r_static
r_int
id|set_codec_parameter
c_func
(paren
id|sb_t
op_star
id|chip
comma
r_int
r_char
id|par
comma
r_int
r_char
id|val
)paren
suffix:semicolon
r_static
r_int
id|set_register
c_func
(paren
id|sb_t
op_star
id|chip
comma
r_int
r_char
id|reg
comma
r_int
r_char
id|val
)paren
suffix:semicolon
r_static
r_int
id|read_register
c_func
(paren
id|sb_t
op_star
id|chip
comma
r_int
r_char
id|reg
)paren
suffix:semicolon
r_static
r_int
id|set_mode_register
c_func
(paren
id|sb_t
op_star
id|chip
comma
r_int
r_char
id|mode
)paren
suffix:semicolon
r_static
r_int
id|get_version
c_func
(paren
id|sb_t
op_star
id|chip
)paren
suffix:semicolon
r_static
r_int
id|snd_sb_csp_riff_load
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
comma
id|snd_sb_csp_microcode_t
op_star
id|code
)paren
suffix:semicolon
r_static
r_int
id|snd_sb_csp_unload
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
)paren
suffix:semicolon
r_static
r_int
id|snd_sb_csp_load_user
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
comma
r_const
r_int
r_char
op_star
id|buf
comma
r_int
id|size
comma
r_int
id|load_flags
)paren
suffix:semicolon
r_static
r_int
id|snd_sb_csp_autoload
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
comma
r_int
id|pcm_sfmt
comma
r_int
id|play_rec_mode
)paren
suffix:semicolon
r_static
r_int
id|snd_sb_csp_check_version
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
)paren
suffix:semicolon
r_static
r_int
id|snd_sb_csp_use
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
)paren
suffix:semicolon
r_static
r_int
id|snd_sb_csp_unuse
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
)paren
suffix:semicolon
r_static
r_int
id|snd_sb_csp_start
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
comma
r_int
id|sample_width
comma
r_int
id|channels
)paren
suffix:semicolon
r_static
r_int
id|snd_sb_csp_stop
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
)paren
suffix:semicolon
r_static
r_int
id|snd_sb_csp_pause
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
)paren
suffix:semicolon
r_static
r_int
id|snd_sb_csp_restart
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
)paren
suffix:semicolon
r_static
r_int
id|snd_sb_qsound_build
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
)paren
suffix:semicolon
r_static
r_void
id|snd_sb_qsound_destroy
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
)paren
suffix:semicolon
r_static
r_int
id|snd_sb_csp_qsound_transfer
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
)paren
suffix:semicolon
r_static
r_int
id|init_proc_entry
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
comma
r_int
id|device
)paren
suffix:semicolon
r_static
r_void
id|info_read
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
suffix:semicolon
multiline_comment|/*&n; * Detect CSP chip and create a new instance&n; */
DECL|function|snd_sb_csp_new
r_int
id|snd_sb_csp_new
c_func
(paren
id|sb_t
op_star
id|chip
comma
r_int
id|device
comma
id|snd_hwdep_t
op_star
op_star
id|rhwdep
)paren
(brace
id|snd_sb_csp_t
op_star
id|p
suffix:semicolon
r_int
id|version
comma
id|err
suffix:semicolon
id|snd_hwdep_t
op_star
id|hw
suffix:semicolon
r_if
c_cond
(paren
id|rhwdep
)paren
op_star
id|rhwdep
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|csp_detect
c_func
(paren
id|chip
comma
op_amp
id|version
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_hwdep_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;SB16-CSP&quot;
comma
id|device
comma
op_amp
id|hw
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|p
op_assign
id|snd_magic_kcalloc
c_func
(paren
id|snd_sb_csp_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_device_free
c_func
(paren
id|chip-&gt;card
comma
id|hw
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|p-&gt;chip
op_assign
id|chip
suffix:semicolon
id|p-&gt;version
op_assign
id|version
suffix:semicolon
multiline_comment|/* CSP operators */
id|p-&gt;ops.csp_use
op_assign
id|snd_sb_csp_use
suffix:semicolon
id|p-&gt;ops.csp_unuse
op_assign
id|snd_sb_csp_unuse
suffix:semicolon
id|p-&gt;ops.csp_autoload
op_assign
id|snd_sb_csp_autoload
suffix:semicolon
id|p-&gt;ops.csp_start
op_assign
id|snd_sb_csp_start
suffix:semicolon
id|p-&gt;ops.csp_stop
op_assign
id|snd_sb_csp_stop
suffix:semicolon
id|p-&gt;ops.csp_qsound_transfer
op_assign
id|snd_sb_csp_qsound_transfer
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|p-&gt;access_mutex
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|hw-&gt;name
comma
l_string|&quot;CSP v%d.%d&quot;
comma
(paren
id|version
op_rshift
l_int|4
)paren
comma
(paren
id|version
op_amp
l_int|0x0f
)paren
)paren
suffix:semicolon
id|hw-&gt;iface
op_assign
id|SNDRV_HWDEP_IFACE_SB16CSP
suffix:semicolon
id|hw-&gt;private_data
op_assign
id|p
suffix:semicolon
id|hw-&gt;private_free
op_assign
id|snd_sb_csp_free
suffix:semicolon
multiline_comment|/* operators - only write/ioctl */
id|hw-&gt;ops.open
op_assign
id|snd_sb_csp_open
suffix:semicolon
id|hw-&gt;ops.ioctl
op_assign
id|snd_sb_csp_ioctl
suffix:semicolon
id|hw-&gt;ops.release
op_assign
id|snd_sb_csp_release
suffix:semicolon
multiline_comment|/* create a proc entry */
id|init_proc_entry
c_func
(paren
id|p
comma
id|device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rhwdep
)paren
op_star
id|rhwdep
op_assign
id|hw
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * free_private for hwdep instance&n; */
DECL|function|snd_sb_csp_free
r_static
r_void
id|snd_sb_csp_free
c_func
(paren
id|snd_hwdep_t
op_star
id|hwdep
)paren
(brace
id|snd_sb_csp_t
op_star
id|p
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_sb_csp_t
comma
id|hwdep-&gt;private_data
comma
r_return
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;running
op_amp
id|SNDRV_SB_CSP_ST_RUNNING
)paren
id|snd_sb_csp_stop
c_func
(paren
id|p
)paren
suffix:semicolon
id|snd_magic_kfree
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* ------------------------------ */
multiline_comment|/*&n; * open the device exclusively&n; */
DECL|function|snd_sb_csp_open
r_static
r_int
id|snd_sb_csp_open
c_func
(paren
id|snd_hwdep_t
op_star
id|hw
comma
r_struct
id|file
op_star
id|file
)paren
(brace
id|snd_sb_csp_t
op_star
id|p
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_sb_csp_t
comma
id|hw-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_return
(paren
id|snd_sb_csp_use
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ioctl for hwdep device:&n; */
DECL|function|snd_sb_csp_ioctl
r_static
r_int
id|snd_sb_csp_ioctl
c_func
(paren
id|snd_hwdep_t
op_star
id|hw
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|snd_sb_csp_t
op_star
id|p
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_sb_csp_t
comma
id|hw-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|snd_sb_csp_info_t
id|info
suffix:semicolon
id|snd_sb_csp_start_t
id|start_info
suffix:semicolon
r_int
id|err
suffix:semicolon
id|snd_assert
c_func
(paren
id|p
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_sb_csp_check_version
c_func
(paren
id|p
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
multiline_comment|/* get information */
r_case
id|SNDRV_SB_CSP_IOCTL_INFO
suffix:colon
op_star
id|info.codec_name
op_assign
op_star
id|p-&gt;codec_name
suffix:semicolon
id|info.func_nr
op_assign
id|p-&gt;func_nr
suffix:semicolon
id|info.acc_format
op_assign
id|p-&gt;acc_format
suffix:semicolon
id|info.acc_channels
op_assign
id|p-&gt;acc_channels
suffix:semicolon
id|info.acc_width
op_assign
id|p-&gt;acc_width
suffix:semicolon
id|info.acc_rates
op_assign
id|p-&gt;acc_rates
suffix:semicolon
id|info.csp_mode
op_assign
id|p-&gt;mode
suffix:semicolon
id|info.run_channels
op_assign
id|p-&gt;run_channels
suffix:semicolon
id|info.run_width
op_assign
id|p-&gt;run_width
suffix:semicolon
id|info.version
op_assign
id|p-&gt;version
suffix:semicolon
id|info.state
op_assign
id|p-&gt;running
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|arg
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
id|err
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* load CSP microcode */
r_case
id|SNDRV_SB_CSP_IOCTL_LOAD_CODE
suffix:colon
id|err
op_assign
(paren
id|p-&gt;running
op_amp
id|SNDRV_SB_CSP_ST_RUNNING
ques
c_cond
op_minus
id|EBUSY
suffix:colon
id|snd_sb_csp_riff_load
c_func
(paren
id|p
comma
(paren
id|snd_sb_csp_microcode_t
op_star
)paren
id|arg
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SB_CSP_IOCTL_UNLOAD_CODE
suffix:colon
id|err
op_assign
(paren
id|p-&gt;running
op_amp
id|SNDRV_SB_CSP_ST_RUNNING
ques
c_cond
op_minus
id|EBUSY
suffix:colon
id|snd_sb_csp_unload
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* change CSP running state */
r_case
id|SNDRV_SB_CSP_IOCTL_START
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|start_info
comma
(paren
r_void
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|start_info
)paren
)paren
)paren
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
id|err
op_assign
id|snd_sb_csp_start
c_func
(paren
id|p
comma
id|start_info.sample_width
comma
id|start_info.channels
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SB_CSP_IOCTL_STOP
suffix:colon
id|err
op_assign
id|snd_sb_csp_stop
c_func
(paren
id|p
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SB_CSP_IOCTL_PAUSE
suffix:colon
id|err
op_assign
id|snd_sb_csp_pause
c_func
(paren
id|p
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SB_CSP_IOCTL_RESTART
suffix:colon
id|err
op_assign
id|snd_sb_csp_restart
c_func
(paren
id|p
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|ENOTTY
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; * close the device&n; */
DECL|function|snd_sb_csp_release
r_static
r_int
id|snd_sb_csp_release
c_func
(paren
id|snd_hwdep_t
op_star
id|hw
comma
r_struct
id|file
op_star
id|file
)paren
(brace
id|snd_sb_csp_t
op_star
id|p
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_sb_csp_t
comma
id|hw-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_return
(paren
id|snd_sb_csp_unuse
c_func
(paren
id|p
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* ------------------------------ */
multiline_comment|/*&n; * acquire device&n; */
DECL|function|snd_sb_csp_use
r_static
r_int
id|snd_sb_csp_use
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
)paren
(brace
id|down
c_func
(paren
op_amp
id|p-&gt;access_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;used
)paren
(brace
id|up
c_func
(paren
op_amp
id|p-&gt;access_mutex
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|p-&gt;used
op_increment
suffix:semicolon
id|up
c_func
(paren
op_amp
id|p-&gt;access_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * release device&n; */
DECL|function|snd_sb_csp_unuse
r_static
r_int
id|snd_sb_csp_unuse
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
)paren
(brace
id|down
c_func
(paren
op_amp
id|p-&gt;access_mutex
)paren
suffix:semicolon
id|p-&gt;used
op_decrement
suffix:semicolon
id|up
c_func
(paren
op_amp
id|p-&gt;access_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * load microcode via ioctl: &n; * code is user-space pointer&n; */
DECL|function|snd_sb_csp_riff_load
r_static
r_int
id|snd_sb_csp_riff_load
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
comma
id|snd_sb_csp_microcode_t
op_star
id|mcode
)paren
(brace
id|snd_sb_csp_mc_header_t
id|info
suffix:semicolon
r_int
r_char
op_star
id|data_ptr
comma
op_star
id|data_end
suffix:semicolon
r_int
r_int
id|func_nr
op_assign
l_int|0
suffix:semicolon
id|riff_header_t
id|file_h
comma
id|item_h
comma
id|code_h
suffix:semicolon
id|__u32
id|item_type
suffix:semicolon
id|desc_header_t
id|funcdesc_h
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|info
comma
id|mcode
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data_ptr
op_assign
id|mcode-&gt;data
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|file_h
comma
id|data_ptr
comma
r_sizeof
(paren
id|file_h
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|file_h.name
op_ne
id|RIFF_HEADER
)paren
op_logical_or
(paren
id|LE_INT
c_func
(paren
id|file_h.len
)paren
op_ge
id|SNDRV_SB_CSP_MAX_MICROCODE_FILE_SIZE
op_minus
r_sizeof
(paren
id|file_h
)paren
)paren
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;%s: Invalid RIFF header&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|data_ptr
op_add_assign
r_sizeof
(paren
id|file_h
)paren
suffix:semicolon
id|data_end
op_assign
id|data_ptr
op_plus
id|LE_INT
c_func
(paren
id|file_h.len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|item_type
comma
id|data_ptr
comma
r_sizeof
(paren
id|item_type
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|item_type
op_ne
id|CSP__HEADER
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;%s: Invalid RIFF file type&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|data_ptr
op_add_assign
r_sizeof
(paren
id|item_type
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|data_ptr
OL
id|data_end
suffix:semicolon
id|data_ptr
op_add_assign
id|LE_INT
c_func
(paren
id|item_h.len
)paren
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|item_h
comma
id|data_ptr
comma
r_sizeof
(paren
id|item_h
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|data_ptr
op_add_assign
r_sizeof
(paren
id|item_h
)paren
suffix:semicolon
r_if
c_cond
(paren
id|item_h.name
op_ne
id|LIST_HEADER
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|item_type
comma
id|data_ptr
comma
r_sizeof
(paren
id|item_type
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|item_type
)paren
(brace
r_case
id|FUNC_HEADER
suffix:colon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|funcdesc_h
comma
id|data_ptr
op_plus
r_sizeof
(paren
id|item_type
)paren
comma
r_sizeof
(paren
id|funcdesc_h
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|func_nr
op_assign
id|LE_SHORT
c_func
(paren
id|funcdesc_h.func_nr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CODE_HEADER
suffix:colon
r_if
c_cond
(paren
id|func_nr
op_ne
id|info.func_req
)paren
r_break
suffix:semicolon
multiline_comment|/* not required function, try next */
id|data_ptr
op_add_assign
r_sizeof
(paren
id|item_type
)paren
suffix:semicolon
multiline_comment|/* destroy QSound mixer element */
r_if
c_cond
(paren
id|p-&gt;mode
op_eq
id|SNDRV_SB_CSP_MODE_QSOUND
)paren
(brace
id|snd_sb_qsound_destroy
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* Clear all flags */
id|p-&gt;running
op_assign
l_int|0
suffix:semicolon
id|p-&gt;mode
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* load microcode blocks */
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_if
c_cond
(paren
id|data_ptr
op_ge
id|data_end
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|code_h
comma
id|data_ptr
comma
r_sizeof
(paren
id|code_h
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
multiline_comment|/* init microcode blocks */
r_if
c_cond
(paren
id|code_h.name
op_ne
id|INIT_HEADER
)paren
r_break
suffix:semicolon
id|data_ptr
op_add_assign
r_sizeof
(paren
id|code_h
)paren
suffix:semicolon
id|err
op_assign
id|snd_sb_csp_load_user
c_func
(paren
id|p
comma
id|data_ptr
comma
id|LE_INT
c_func
(paren
id|code_h.len
)paren
comma
id|SNDRV_SB_CSP_LOAD_INITBLOCK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|data_ptr
op_add_assign
id|LE_INT
c_func
(paren
id|code_h.len
)paren
suffix:semicolon
)brace
multiline_comment|/* main microcode block */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|code_h
comma
id|data_ptr
comma
r_sizeof
(paren
id|code_h
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|code_h.name
op_ne
id|MAIN_HEADER
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;%s: Missing &squot;main&squot; microcode&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|data_ptr
op_add_assign
r_sizeof
(paren
id|code_h
)paren
suffix:semicolon
id|err
op_assign
id|snd_sb_csp_load_user
c_func
(paren
id|p
comma
id|data_ptr
comma
id|LE_INT
c_func
(paren
id|code_h.len
)paren
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* fill in codec header */
id|strlcpy
c_func
(paren
id|p-&gt;codec_name
comma
id|info.codec_name
comma
r_sizeof
(paren
id|p-&gt;codec_name
)paren
)paren
suffix:semicolon
id|p-&gt;func_nr
op_assign
id|func_nr
suffix:semicolon
id|p-&gt;mode
op_assign
id|LE_SHORT
c_func
(paren
id|funcdesc_h.flags_play_rec
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|LE_SHORT
c_func
(paren
id|funcdesc_h.VOC_type
)paren
)paren
(brace
r_case
l_int|0x0001
suffix:colon
multiline_comment|/* QSound decoder */
r_if
c_cond
(paren
id|LE_SHORT
c_func
(paren
id|funcdesc_h.flags_play_rec
)paren
op_eq
id|SNDRV_SB_CSP_MODE_DSP_WRITE
)paren
(brace
r_if
c_cond
(paren
id|snd_sb_qsound_build
c_func
(paren
id|p
)paren
op_eq
l_int|0
)paren
multiline_comment|/* set QSound flag and clear all other mode flags */
id|p-&gt;mode
op_assign
id|SNDRV_SB_CSP_MODE_QSOUND
suffix:semicolon
)brace
id|p-&gt;acc_format
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0006
suffix:colon
multiline_comment|/* A Law codec */
id|p-&gt;acc_format
op_assign
id|SNDRV_PCM_FMTBIT_A_LAW
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0007
suffix:colon
multiline_comment|/* Mu Law codec */
id|p-&gt;acc_format
op_assign
id|SNDRV_PCM_FMTBIT_MU_LAW
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0011
suffix:colon
multiline_comment|/* what Creative thinks is IMA ADPCM codec */
r_case
l_int|0x0200
suffix:colon
multiline_comment|/* Creative ADPCM codec */
id|p-&gt;acc_format
op_assign
id|SNDRV_PCM_FMTBIT_IMA_ADPCM
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|201
suffix:colon
multiline_comment|/* Text 2 Speech decoder */
multiline_comment|/* TODO: Text2Speech handling routines */
id|p-&gt;acc_format
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0202
suffix:colon
multiline_comment|/* Fast Speech 8 codec */
r_case
l_int|0x0203
suffix:colon
multiline_comment|/* Fast Speech 10 codec */
id|p-&gt;acc_format
op_assign
id|SNDRV_PCM_FMTBIT_SPECIAL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* other codecs are unsupported */
id|p-&gt;acc_format
op_assign
id|p-&gt;acc_width
op_assign
id|p-&gt;acc_rates
op_assign
l_int|0
suffix:semicolon
id|p-&gt;mode
op_assign
l_int|0
suffix:semicolon
id|snd_printd
c_func
(paren
l_string|&quot;%s: Unsupported CSP codec type: 0x%04x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|LE_SHORT
c_func
(paren
id|funcdesc_h.VOC_type
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|p-&gt;acc_channels
op_assign
id|LE_SHORT
c_func
(paren
id|funcdesc_h.flags_stereo_mono
)paren
suffix:semicolon
id|p-&gt;acc_width
op_assign
id|LE_SHORT
c_func
(paren
id|funcdesc_h.flags_16bit_8bit
)paren
suffix:semicolon
id|p-&gt;acc_rates
op_assign
id|LE_SHORT
c_func
(paren
id|funcdesc_h.flags_rates
)paren
suffix:semicolon
multiline_comment|/* Decouple CSP from IRQ and DMAREQ lines */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|p-&gt;chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|set_mode_register
c_func
(paren
id|p-&gt;chip
comma
l_int|0xfc
)paren
suffix:semicolon
id|set_mode_register
c_func
(paren
id|p-&gt;chip
comma
l_int|0x00
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|p-&gt;chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* finished loading successfully */
id|p-&gt;running
op_assign
id|SNDRV_SB_CSP_ST_LOADED
suffix:semicolon
multiline_comment|/* set LOADED flag */
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|snd_printd
c_func
(paren
l_string|&quot;%s: Function #%d not found&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|info.func_req
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n; * unload CSP microcode&n; */
DECL|function|snd_sb_csp_unload
r_static
r_int
id|snd_sb_csp_unload
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;running
op_amp
id|SNDRV_SB_CSP_ST_RUNNING
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p-&gt;running
op_amp
id|SNDRV_SB_CSP_ST_LOADED
)paren
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
multiline_comment|/* clear supported formats */
id|p-&gt;acc_format
op_assign
l_int|0
suffix:semicolon
id|p-&gt;acc_channels
op_assign
id|p-&gt;acc_width
op_assign
id|p-&gt;acc_rates
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* destroy QSound mixer element */
r_if
c_cond
(paren
id|p-&gt;mode
op_eq
id|SNDRV_SB_CSP_MODE_QSOUND
)paren
(brace
id|snd_sb_qsound_destroy
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
multiline_comment|/* clear all flags */
id|p-&gt;running
op_assign
l_int|0
suffix:semicolon
id|p-&gt;mode
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * send command sequence to DSP&n; */
DECL|function|command_seq
r_static
r_inline
r_int
id|command_seq
c_func
(paren
id|sb_t
op_star
id|chip
comma
r_const
r_int
r_char
op_star
id|seq
comma
r_int
id|size
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|snd_sbdsp_command
c_func
(paren
id|chip
comma
id|seq
(braket
id|i
)braket
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * set CSP codec parameter&n; */
DECL|function|set_codec_parameter
r_static
r_int
id|set_codec_parameter
c_func
(paren
id|sb_t
op_star
id|chip
comma
r_int
r_char
id|par
comma
r_int
r_char
id|val
)paren
(brace
r_int
r_char
id|dsp_cmd
(braket
l_int|3
)braket
suffix:semicolon
id|dsp_cmd
(braket
l_int|0
)braket
op_assign
l_int|0x05
suffix:semicolon
multiline_comment|/* CSP set codec parameter */
id|dsp_cmd
(braket
l_int|1
)braket
op_assign
id|val
suffix:semicolon
multiline_comment|/* Parameter value */
id|dsp_cmd
(braket
l_int|2
)braket
op_assign
id|par
suffix:semicolon
multiline_comment|/* Parameter */
id|command_seq
c_func
(paren
id|chip
comma
id|dsp_cmd
comma
l_int|3
)paren
suffix:semicolon
id|snd_sbdsp_command
c_func
(paren
id|chip
comma
l_int|0x03
)paren
suffix:semicolon
multiline_comment|/* DSP read? */
r_if
c_cond
(paren
id|snd_sbdsp_get_byte
c_func
(paren
id|chip
)paren
op_ne
id|par
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * set CSP register&n; */
DECL|function|set_register
r_static
r_int
id|set_register
c_func
(paren
id|sb_t
op_star
id|chip
comma
r_int
r_char
id|reg
comma
r_int
r_char
id|val
)paren
(brace
r_int
r_char
id|dsp_cmd
(braket
l_int|3
)braket
suffix:semicolon
id|dsp_cmd
(braket
l_int|0
)braket
op_assign
l_int|0x0e
suffix:semicolon
multiline_comment|/* CSP set register */
id|dsp_cmd
(braket
l_int|1
)braket
op_assign
id|reg
suffix:semicolon
multiline_comment|/* CSP Register */
id|dsp_cmd
(braket
l_int|2
)braket
op_assign
id|val
suffix:semicolon
multiline_comment|/* value */
r_return
id|command_seq
c_func
(paren
id|chip
comma
id|dsp_cmd
comma
l_int|3
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * read CSP register&n; * return &lt; 0 -&gt; error&n; */
DECL|function|read_register
r_static
r_int
id|read_register
c_func
(paren
id|sb_t
op_star
id|chip
comma
r_int
r_char
id|reg
)paren
(brace
r_int
r_char
id|dsp_cmd
(braket
l_int|2
)braket
suffix:semicolon
id|dsp_cmd
(braket
l_int|0
)braket
op_assign
l_int|0x0f
suffix:semicolon
multiline_comment|/* CSP read register */
id|dsp_cmd
(braket
l_int|1
)braket
op_assign
id|reg
suffix:semicolon
multiline_comment|/* CSP Register */
id|command_seq
c_func
(paren
id|chip
comma
id|dsp_cmd
comma
l_int|2
)paren
suffix:semicolon
r_return
id|snd_sbdsp_get_byte
c_func
(paren
id|chip
)paren
suffix:semicolon
multiline_comment|/* Read DSP value */
)brace
multiline_comment|/*&n; * set CSP mode register&n; */
DECL|function|set_mode_register
r_static
r_int
id|set_mode_register
c_func
(paren
id|sb_t
op_star
id|chip
comma
r_int
r_char
id|mode
)paren
(brace
r_int
r_char
id|dsp_cmd
(braket
l_int|2
)braket
suffix:semicolon
id|dsp_cmd
(braket
l_int|0
)braket
op_assign
l_int|0x04
suffix:semicolon
multiline_comment|/* CSP set mode register */
id|dsp_cmd
(braket
l_int|1
)braket
op_assign
id|mode
suffix:semicolon
multiline_comment|/* mode */
r_return
id|command_seq
c_func
(paren
id|chip
comma
id|dsp_cmd
comma
l_int|2
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Detect CSP&n; * return 0 if CSP exists.&n; */
DECL|function|csp_detect
r_static
r_int
id|csp_detect
c_func
(paren
id|sb_t
op_star
id|chip
comma
r_int
op_star
id|version
)paren
(brace
r_int
r_char
id|csp_test1
comma
id|csp_test2
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|result
op_assign
op_minus
id|ENODEV
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|set_codec_parameter
c_func
(paren
id|chip
comma
l_int|0x00
comma
l_int|0x00
)paren
suffix:semicolon
id|set_mode_register
c_func
(paren
id|chip
comma
l_int|0xfc
)paren
suffix:semicolon
multiline_comment|/* 0xfc = ?? */
id|csp_test1
op_assign
id|read_register
c_func
(paren
id|chip
comma
l_int|0x83
)paren
suffix:semicolon
id|set_register
c_func
(paren
id|chip
comma
l_int|0x83
comma
op_complement
id|csp_test1
)paren
suffix:semicolon
id|csp_test2
op_assign
id|read_register
c_func
(paren
id|chip
comma
l_int|0x83
)paren
suffix:semicolon
r_if
c_cond
(paren
id|csp_test2
op_ne
(paren
id|csp_test1
op_xor
l_int|0xff
)paren
)paren
r_goto
id|__fail
suffix:semicolon
id|set_register
c_func
(paren
id|chip
comma
l_int|0x83
comma
id|csp_test1
)paren
suffix:semicolon
id|csp_test2
op_assign
id|read_register
c_func
(paren
id|chip
comma
l_int|0x83
)paren
suffix:semicolon
r_if
c_cond
(paren
id|csp_test2
op_ne
id|csp_test1
)paren
r_goto
id|__fail
suffix:semicolon
id|set_mode_register
c_func
(paren
id|chip
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* 0x00 = ? */
op_star
id|version
op_assign
id|get_version
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_sbdsp_reset
c_func
(paren
id|chip
)paren
suffix:semicolon
multiline_comment|/* reset DSP after getversion! */
r_if
c_cond
(paren
op_star
id|version
op_ge
l_int|0x10
op_logical_and
op_star
id|version
op_le
l_int|0x1f
)paren
id|result
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* valid version id */
id|__fail
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/*&n; * get CSP version number&n; */
DECL|function|get_version
r_static
r_int
id|get_version
c_func
(paren
id|sb_t
op_star
id|chip
)paren
(brace
r_int
r_char
id|dsp_cmd
(braket
l_int|2
)braket
suffix:semicolon
id|dsp_cmd
(braket
l_int|0
)braket
op_assign
l_int|0x08
suffix:semicolon
multiline_comment|/* SB_DSP_!something! */
id|dsp_cmd
(braket
l_int|1
)braket
op_assign
l_int|0x03
suffix:semicolon
multiline_comment|/* get chip version id? */
id|command_seq
c_func
(paren
id|chip
comma
id|dsp_cmd
comma
l_int|2
)paren
suffix:semicolon
r_return
(paren
id|snd_sbdsp_get_byte
c_func
(paren
id|chip
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * check if the CSP version is valid&n; */
DECL|function|snd_sb_csp_check_version
r_static
r_int
id|snd_sb_csp_check_version
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;version
template_param
l_int|0x1f
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;%s: Invalid CSP version: 0x%x&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|p-&gt;version
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * download microcode to CSP (microcode should have one &quot;main&quot; block).&n; */
DECL|function|snd_sb_csp_load
r_static
r_int
id|snd_sb_csp_load
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
comma
r_const
r_int
r_char
op_star
id|buf
comma
r_int
id|size
comma
r_int
id|load_flags
)paren
(brace
r_int
id|status
comma
id|i
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|result
op_assign
op_minus
id|EIO
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|p-&gt;chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_sbdsp_command
c_func
(paren
id|p-&gt;chip
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* CSP download command */
r_if
c_cond
(paren
id|snd_sbdsp_get_byte
c_func
(paren
id|p-&gt;chip
)paren
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;%s: Download command failed&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_goto
id|__fail
suffix:semicolon
)brace
multiline_comment|/* Send CSP low byte (size - 1) */
id|snd_sbdsp_command
c_func
(paren
id|p-&gt;chip
comma
(paren
r_int
r_char
)paren
(paren
id|size
op_minus
l_int|1
)paren
)paren
suffix:semicolon
multiline_comment|/* Send high byte */
id|snd_sbdsp_command
c_func
(paren
id|p-&gt;chip
comma
(paren
r_int
r_char
)paren
(paren
(paren
id|size
op_minus
l_int|1
)paren
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
multiline_comment|/* send microcode sequence */
r_if
c_cond
(paren
id|load_flags
op_amp
id|SNDRV_SB_CSP_LOAD_FROMUSER
)paren
multiline_comment|/* load from kernel space */
r_while
c_loop
(paren
id|size
op_decrement
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|snd_sbdsp_command
c_func
(paren
id|p-&gt;chip
comma
op_star
id|buf
op_increment
)paren
)paren
r_goto
id|__fail
suffix:semicolon
)brace
r_if
c_cond
(paren
id|snd_sbdsp_get_byte
c_func
(paren
id|p-&gt;chip
)paren
)paren
r_goto
id|__fail
suffix:semicolon
r_if
c_cond
(paren
id|load_flags
op_amp
id|SNDRV_SB_CSP_LOAD_INITBLOCK
)paren
(brace
id|i
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* some codecs (FastSpeech) take some time to initialize */
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|snd_sbdsp_command
c_func
(paren
id|p-&gt;chip
comma
l_int|0x03
)paren
suffix:semicolon
id|status
op_assign
id|snd_sbdsp_get_byte
c_func
(paren
id|p-&gt;chip
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
l_int|0x55
op_logical_or
op_increment
id|i
op_ge
l_int|10
)paren
r_break
suffix:semicolon
id|udelay
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_ne
l_int|0x55
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;%s: Microcode initialization failed&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_goto
id|__fail
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t; * Read mixer register SB_DSP4_DMASETUP after loading &squot;main&squot; code.&n;&t;&t; * Start CSP chip if no 16bit DMA channel is set - some kind&n;&t;&t; * of autorun or perhaps a bugfix?&n;&t;&t; */
id|spin_lock
c_func
(paren
op_amp
id|p-&gt;chip-&gt;mixer_lock
)paren
suffix:semicolon
id|status
op_assign
id|snd_sbmixer_read
c_func
(paren
id|p-&gt;chip
comma
id|SB_DSP4_DMASETUP
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|p-&gt;chip-&gt;mixer_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
(paren
id|SB_DMASETUP_DMA7
op_or
id|SB_DMASETUP_DMA6
op_or
id|SB_DMASETUP_DMA5
)paren
)paren
)paren
(brace
id|err
op_assign
(paren
id|set_codec_parameter
c_func
(paren
id|p-&gt;chip
comma
l_int|0xaa
comma
l_int|0x00
)paren
op_logical_or
id|set_codec_parameter
c_func
(paren
id|p-&gt;chip
comma
l_int|0xff
comma
l_int|0x00
)paren
)paren
suffix:semicolon
id|snd_sbdsp_reset
c_func
(paren
id|p-&gt;chip
)paren
suffix:semicolon
multiline_comment|/* really! */
r_if
c_cond
(paren
id|err
)paren
r_goto
id|__fail
suffix:semicolon
id|set_mode_register
c_func
(paren
id|p-&gt;chip
comma
l_int|0xc0
)paren
suffix:semicolon
multiline_comment|/* c0 = STOP */
id|set_mode_register
c_func
(paren
id|p-&gt;chip
comma
l_int|0x70
)paren
suffix:semicolon
multiline_comment|/* 70 = RUN */
)brace
)brace
id|result
op_assign
l_int|0
suffix:semicolon
id|__fail
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|p-&gt;chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_sb_csp_load_user
r_static
r_int
id|snd_sb_csp_load_user
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
comma
r_const
r_int
r_char
op_star
id|buf
comma
r_int
id|size
comma
r_int
id|load_flags
)paren
(brace
r_int
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_int
r_char
op_star
id|kbuf
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kbuf
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|kbuf
comma
id|buf
comma
id|size
)paren
)paren
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
id|err
op_assign
id|snd_sb_csp_load
c_func
(paren
id|p
comma
id|kbuf
comma
id|size
comma
id|load_flags
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|kbuf
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
macro_line|#include &quot;sb16_csp_codecs.h&quot;
multiline_comment|/*&n; * autoload hardware codec if necessary&n; * return 0 if CSP is loaded and ready to run (p-&gt;running != 0)&n; */
DECL|function|snd_sb_csp_autoload
r_static
r_int
id|snd_sb_csp_autoload
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
comma
r_int
id|pcm_sfmt
comma
r_int
id|play_rec_mode
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* if CSP is running or manually loaded then exit */
r_if
c_cond
(paren
id|p-&gt;running
op_amp
(paren
id|SNDRV_SB_CSP_ST_RUNNING
op_or
id|SNDRV_SB_CSP_ST_LOADED
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
multiline_comment|/* autoload microcode only if requested hardware codec is not already loaded */
r_if
c_cond
(paren
(paren
(paren
l_int|1
op_lshift
id|pcm_sfmt
)paren
op_amp
id|p-&gt;acc_format
)paren
op_logical_and
(paren
id|play_rec_mode
op_amp
id|p-&gt;mode
)paren
)paren
(brace
id|p-&gt;running
op_assign
id|SNDRV_SB_CSP_ST_AUTO
suffix:semicolon
)brace
r_else
(brace
r_switch
c_cond
(paren
id|pcm_sfmt
)paren
(brace
r_case
id|SNDRV_PCM_FORMAT_MU_LAW
suffix:colon
id|err
op_assign
id|snd_sb_csp_load
c_func
(paren
id|p
comma
op_amp
id|mulaw_main
(braket
l_int|0
)braket
comma
r_sizeof
(paren
id|mulaw_main
)paren
comma
l_int|0
)paren
suffix:semicolon
id|p-&gt;acc_format
op_assign
id|SNDRV_PCM_FMTBIT_MU_LAW
suffix:semicolon
id|p-&gt;mode
op_assign
id|SNDRV_SB_CSP_MODE_DSP_READ
op_or
id|SNDRV_SB_CSP_MODE_DSP_WRITE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_FORMAT_A_LAW
suffix:colon
id|err
op_assign
id|snd_sb_csp_load
c_func
(paren
id|p
comma
op_amp
id|alaw_main
(braket
l_int|0
)braket
comma
r_sizeof
(paren
id|alaw_main
)paren
comma
l_int|0
)paren
suffix:semicolon
id|p-&gt;acc_format
op_assign
id|SNDRV_PCM_FMTBIT_A_LAW
suffix:semicolon
id|p-&gt;mode
op_assign
id|SNDRV_SB_CSP_MODE_DSP_READ
op_or
id|SNDRV_SB_CSP_MODE_DSP_WRITE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_FORMAT_IMA_ADPCM
suffix:colon
id|err
op_assign
id|snd_sb_csp_load
c_func
(paren
id|p
comma
op_amp
id|ima_adpcm_init
(braket
l_int|0
)braket
comma
r_sizeof
(paren
id|ima_adpcm_init
)paren
comma
id|SNDRV_SB_CSP_LOAD_INITBLOCK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|play_rec_mode
op_eq
id|SNDRV_SB_CSP_MODE_DSP_WRITE
)paren
(brace
id|err
op_assign
id|snd_sb_csp_load
c_func
(paren
id|p
comma
op_amp
id|ima_adpcm_playback
(braket
l_int|0
)braket
comma
r_sizeof
(paren
id|ima_adpcm_playback
)paren
comma
l_int|0
)paren
suffix:semicolon
id|p-&gt;mode
op_assign
id|SNDRV_SB_CSP_MODE_DSP_WRITE
suffix:semicolon
)brace
r_else
(brace
id|err
op_assign
id|snd_sb_csp_load
c_func
(paren
id|p
comma
op_amp
id|ima_adpcm_capture
(braket
l_int|0
)braket
comma
r_sizeof
(paren
id|ima_adpcm_capture
)paren
comma
l_int|0
)paren
suffix:semicolon
id|p-&gt;mode
op_assign
id|SNDRV_SB_CSP_MODE_DSP_READ
suffix:semicolon
)brace
id|p-&gt;acc_format
op_assign
id|SNDRV_PCM_FMTBIT_IMA_ADPCM
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
multiline_comment|/* Decouple CSP from IRQ and DMAREQ lines */
r_if
c_cond
(paren
id|p-&gt;running
op_amp
id|SNDRV_SB_CSP_ST_AUTO
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|p-&gt;chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|set_mode_register
c_func
(paren
id|p-&gt;chip
comma
l_int|0xfc
)paren
suffix:semicolon
id|set_mode_register
c_func
(paren
id|p-&gt;chip
comma
l_int|0x00
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|p-&gt;chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|p-&gt;running
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* clear autoloaded flag */
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
)paren
(brace
id|p-&gt;acc_format
op_assign
l_int|0
suffix:semicolon
id|p-&gt;acc_channels
op_assign
id|p-&gt;acc_width
op_assign
id|p-&gt;acc_rates
op_assign
l_int|0
suffix:semicolon
id|p-&gt;running
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* clear autoloaded flag */
id|p-&gt;mode
op_assign
l_int|0
suffix:semicolon
r_return
(paren
id|err
)paren
suffix:semicolon
)brace
r_else
(brace
id|p-&gt;running
op_assign
id|SNDRV_SB_CSP_ST_AUTO
suffix:semicolon
multiline_comment|/* set autoloaded flag */
id|p-&gt;acc_width
op_assign
id|SNDRV_SB_CSP_SAMPLE_16BIT
suffix:semicolon
multiline_comment|/* only 16 bit data */
id|p-&gt;acc_channels
op_assign
id|SNDRV_SB_CSP_MONO
op_or
id|SNDRV_SB_CSP_STEREO
suffix:semicolon
id|p-&gt;acc_rates
op_assign
id|SNDRV_SB_CSP_RATE_ALL
suffix:semicolon
multiline_comment|/* HW codecs accept all rates */
)brace
)brace
r_return
(paren
id|p-&gt;running
op_amp
id|SNDRV_SB_CSP_ST_AUTO
)paren
ques
c_cond
l_int|0
suffix:colon
op_minus
id|ENXIO
suffix:semicolon
)brace
multiline_comment|/*&n; * start CSP&n; */
DECL|function|snd_sb_csp_start
r_static
r_int
id|snd_sb_csp_start
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
comma
r_int
id|sample_width
comma
r_int
id|channels
)paren
(brace
r_int
r_char
id|s_type
suffix:semicolon
multiline_comment|/* sample type */
r_int
r_char
id|mixL
comma
id|mixR
suffix:semicolon
r_int
id|result
op_assign
op_minus
id|EIO
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p-&gt;running
op_amp
(paren
id|SNDRV_SB_CSP_ST_LOADED
op_or
id|SNDRV_SB_CSP_ST_AUTO
)paren
)paren
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;%s: Microcode not loaded&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;running
op_amp
id|SNDRV_SB_CSP_ST_RUNNING
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;%s: CSP already running&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|sample_width
op_amp
id|p-&gt;acc_width
)paren
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;%s: Unsupported PCM sample width&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|channels
op_amp
id|p-&gt;acc_channels
)paren
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;%s: Invalid number of channels&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* Mute PCM volume */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|p-&gt;chip-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
id|mixL
op_assign
id|snd_sbmixer_read
c_func
(paren
id|p-&gt;chip
comma
id|SB_DSP4_PCM_DEV
)paren
suffix:semicolon
id|mixR
op_assign
id|snd_sbmixer_read
c_func
(paren
id|p-&gt;chip
comma
id|SB_DSP4_PCM_DEV
op_plus
l_int|1
)paren
suffix:semicolon
id|snd_sbmixer_write
c_func
(paren
id|p-&gt;chip
comma
id|SB_DSP4_PCM_DEV
comma
id|mixL
op_amp
l_int|0x7
)paren
suffix:semicolon
id|snd_sbmixer_write
c_func
(paren
id|p-&gt;chip
comma
id|SB_DSP4_PCM_DEV
op_plus
l_int|1
comma
id|mixR
op_amp
l_int|0x7
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|p-&gt;chip-&gt;reg_lock
)paren
suffix:semicolon
id|set_mode_register
c_func
(paren
id|p-&gt;chip
comma
l_int|0xc0
)paren
suffix:semicolon
multiline_comment|/* c0 = STOP */
id|set_mode_register
c_func
(paren
id|p-&gt;chip
comma
l_int|0x70
)paren
suffix:semicolon
multiline_comment|/* 70 = RUN */
id|s_type
op_assign
l_int|0x00
suffix:semicolon
r_if
c_cond
(paren
id|channels
op_eq
id|SNDRV_SB_CSP_MONO
)paren
id|s_type
op_assign
l_int|0x11
suffix:semicolon
multiline_comment|/* 000n 000n    (n = 1 if mono) */
r_if
c_cond
(paren
id|sample_width
op_eq
id|SNDRV_SB_CSP_SAMPLE_8BIT
)paren
id|s_type
op_or_assign
l_int|0x22
suffix:semicolon
multiline_comment|/* 00dX 00dX    (d = 1 if 8 bit samples) */
r_if
c_cond
(paren
id|set_codec_parameter
c_func
(paren
id|p-&gt;chip
comma
l_int|0x81
comma
id|s_type
)paren
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;%s: Set sample type command failed&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_goto
id|__fail
suffix:semicolon
)brace
r_if
c_cond
(paren
id|set_codec_parameter
c_func
(paren
id|p-&gt;chip
comma
l_int|0x80
comma
l_int|0x00
)paren
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;%s: Codec start command failed&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_goto
id|__fail
suffix:semicolon
)brace
id|p-&gt;run_width
op_assign
id|sample_width
suffix:semicolon
id|p-&gt;run_channels
op_assign
id|channels
suffix:semicolon
id|p-&gt;running
op_or_assign
id|SNDRV_SB_CSP_ST_RUNNING
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;mode
op_amp
id|SNDRV_SB_CSP_MODE_QSOUND
)paren
(brace
id|set_codec_parameter
c_func
(paren
id|p-&gt;chip
comma
l_int|0xe0
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* enable QSound decoder */
id|set_codec_parameter
c_func
(paren
id|p-&gt;chip
comma
l_int|0x00
comma
l_int|0xff
)paren
suffix:semicolon
id|set_codec_parameter
c_func
(paren
id|p-&gt;chip
comma
l_int|0x01
comma
l_int|0xff
)paren
suffix:semicolon
id|p-&gt;running
op_or_assign
id|SNDRV_SB_CSP_ST_QSOUND
suffix:semicolon
multiline_comment|/* set QSound startup value */
id|snd_sb_csp_qsound_transfer
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
id|result
op_assign
l_int|0
suffix:semicolon
id|__fail
suffix:colon
id|spin_unlock
c_func
(paren
op_amp
id|p-&gt;chip-&gt;reg_lock
)paren
suffix:semicolon
multiline_comment|/* restore PCM volume */
id|snd_sbmixer_write
c_func
(paren
id|p-&gt;chip
comma
id|SB_DSP4_PCM_DEV
comma
id|mixL
)paren
suffix:semicolon
id|snd_sbmixer_write
c_func
(paren
id|p-&gt;chip
comma
id|SB_DSP4_PCM_DEV
op_plus
l_int|1
comma
id|mixR
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|p-&gt;chip-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/*&n; * stop CSP&n; */
DECL|function|snd_sb_csp_stop
r_static
r_int
id|snd_sb_csp_stop
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
)paren
(brace
r_int
id|result
suffix:semicolon
r_int
r_char
id|mixL
comma
id|mixR
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p-&gt;running
op_amp
id|SNDRV_SB_CSP_ST_RUNNING
)paren
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Mute PCM volume */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|p-&gt;chip-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
id|mixL
op_assign
id|snd_sbmixer_read
c_func
(paren
id|p-&gt;chip
comma
id|SB_DSP4_PCM_DEV
)paren
suffix:semicolon
id|mixR
op_assign
id|snd_sbmixer_read
c_func
(paren
id|p-&gt;chip
comma
id|SB_DSP4_PCM_DEV
op_plus
l_int|1
)paren
suffix:semicolon
id|snd_sbmixer_write
c_func
(paren
id|p-&gt;chip
comma
id|SB_DSP4_PCM_DEV
comma
id|mixL
op_amp
l_int|0x7
)paren
suffix:semicolon
id|snd_sbmixer_write
c_func
(paren
id|p-&gt;chip
comma
id|SB_DSP4_PCM_DEV
op_plus
l_int|1
comma
id|mixR
op_amp
l_int|0x7
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|p-&gt;chip-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;running
op_amp
id|SNDRV_SB_CSP_ST_QSOUND
)paren
(brace
id|set_codec_parameter
c_func
(paren
id|p-&gt;chip
comma
l_int|0xe0
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* disable QSound decoder */
id|set_codec_parameter
c_func
(paren
id|p-&gt;chip
comma
l_int|0x00
comma
l_int|0x00
)paren
suffix:semicolon
id|set_codec_parameter
c_func
(paren
id|p-&gt;chip
comma
l_int|0x01
comma
l_int|0x00
)paren
suffix:semicolon
id|p-&gt;running
op_and_assign
op_complement
id|SNDRV_SB_CSP_ST_QSOUND
suffix:semicolon
)brace
id|result
op_assign
id|set_mode_register
c_func
(paren
id|p-&gt;chip
comma
l_int|0xc0
)paren
suffix:semicolon
multiline_comment|/* c0 = STOP */
id|spin_unlock
c_func
(paren
op_amp
id|p-&gt;chip-&gt;reg_lock
)paren
suffix:semicolon
multiline_comment|/* restore PCM volume */
id|snd_sbmixer_write
c_func
(paren
id|p-&gt;chip
comma
id|SB_DSP4_PCM_DEV
comma
id|mixL
)paren
suffix:semicolon
id|snd_sbmixer_write
c_func
(paren
id|p-&gt;chip
comma
id|SB_DSP4_PCM_DEV
op_plus
l_int|1
comma
id|mixR
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|p-&gt;chip-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|result
)paren
)paren
id|p-&gt;running
op_and_assign
op_complement
(paren
id|SNDRV_SB_CSP_ST_PAUSED
op_or
id|SNDRV_SB_CSP_ST_RUNNING
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/*&n; * pause CSP codec and hold DMA transfer&n; */
DECL|function|snd_sb_csp_pause
r_static
r_int
id|snd_sb_csp_pause
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
)paren
(brace
r_int
id|result
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p-&gt;running
op_amp
id|SNDRV_SB_CSP_ST_RUNNING
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|p-&gt;chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|result
op_assign
id|set_codec_parameter
c_func
(paren
id|p-&gt;chip
comma
l_int|0x80
comma
l_int|0xff
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|p-&gt;chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|result
)paren
)paren
id|p-&gt;running
op_or_assign
id|SNDRV_SB_CSP_ST_PAUSED
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/*&n; * restart CSP codec and resume DMA transfer&n; */
DECL|function|snd_sb_csp_restart
r_static
r_int
id|snd_sb_csp_restart
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
)paren
(brace
r_int
id|result
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|p-&gt;running
op_amp
id|SNDRV_SB_CSP_ST_PAUSED
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|p-&gt;chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|result
op_assign
id|set_codec_parameter
c_func
(paren
id|p-&gt;chip
comma
l_int|0x80
comma
l_int|0x00
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|p-&gt;chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|result
)paren
)paren
id|p-&gt;running
op_and_assign
op_complement
id|SNDRV_SB_CSP_ST_PAUSED
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/* ------------------------------ */
multiline_comment|/*&n; * QSound mixer control for PCM&n; */
DECL|function|snd_sb_qsound_switch_info
r_static
r_int
id|snd_sb_qsound_switch_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_sb_qsound_switch_get
r_static
r_int
id|snd_sb_qsound_switch_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|snd_sb_csp_t
op_star
id|p
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|p-&gt;q_enabled
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_sb_qsound_switch_put
r_static
r_int
id|snd_sb_qsound_switch_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|snd_sb_csp_t
op_star
id|p
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|change
suffix:semicolon
r_int
r_char
id|nval
suffix:semicolon
id|nval
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|0x01
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|p-&gt;q_lock
comma
id|flags
)paren
suffix:semicolon
id|change
op_assign
id|p-&gt;q_enabled
op_ne
id|nval
suffix:semicolon
id|p-&gt;q_enabled
op_assign
id|nval
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|p-&gt;q_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|function|snd_sb_qsound_space_info
r_static
r_int
id|snd_sb_qsound_space_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
id|SNDRV_SB_CSP_QSOUND_MAX_RIGHT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_sb_qsound_space_get
r_static
r_int
id|snd_sb_qsound_space_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|snd_sb_csp_t
op_star
id|p
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|p-&gt;q_lock
comma
id|flags
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|p-&gt;qpos_left
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
id|p-&gt;qpos_right
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|p-&gt;q_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_sb_qsound_space_put
r_static
r_int
id|snd_sb_qsound_space_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|snd_sb_csp_t
op_star
id|p
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|change
suffix:semicolon
r_int
r_char
id|nval1
comma
id|nval2
suffix:semicolon
id|nval1
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|nval1
OG
id|SNDRV_SB_CSP_QSOUND_MAX_RIGHT
)paren
id|nval1
op_assign
id|SNDRV_SB_CSP_QSOUND_MAX_RIGHT
suffix:semicolon
id|nval2
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|nval2
OG
id|SNDRV_SB_CSP_QSOUND_MAX_RIGHT
)paren
id|nval2
op_assign
id|SNDRV_SB_CSP_QSOUND_MAX_RIGHT
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|p-&gt;q_lock
comma
id|flags
)paren
suffix:semicolon
id|change
op_assign
id|p-&gt;qpos_left
op_ne
id|nval1
op_logical_or
id|p-&gt;qpos_right
op_ne
id|nval2
suffix:semicolon
id|p-&gt;qpos_left
op_assign
id|nval1
suffix:semicolon
id|p-&gt;qpos_right
op_assign
id|nval2
suffix:semicolon
id|p-&gt;qpos_changed
op_assign
id|change
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|p-&gt;q_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|snd_sb_qsound_switch
r_static
id|snd_kcontrol_new_t
id|snd_sb_qsound_switch
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;3D Control - Switch&quot;
comma
dot
id|info
op_assign
id|snd_sb_qsound_switch_info
comma
dot
id|get
op_assign
id|snd_sb_qsound_switch_get
comma
dot
id|put
op_assign
id|snd_sb_qsound_switch_put
)brace
suffix:semicolon
DECL|variable|snd_sb_qsound_space
r_static
id|snd_kcontrol_new_t
id|snd_sb_qsound_space
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;3D Control - Space&quot;
comma
dot
id|info
op_assign
id|snd_sb_qsound_space_info
comma
dot
id|get
op_assign
id|snd_sb_qsound_space_get
comma
dot
id|put
op_assign
id|snd_sb_qsound_space_put
)brace
suffix:semicolon
DECL|function|snd_sb_qsound_build
r_static
r_int
id|snd_sb_qsound_build
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
)paren
(brace
id|snd_card_t
op_star
id|card
suffix:semicolon
r_int
id|err
suffix:semicolon
id|snd_assert
c_func
(paren
id|p
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|card
op_assign
id|p-&gt;chip-&gt;card
suffix:semicolon
id|p-&gt;qpos_left
op_assign
id|p-&gt;qpos_right
op_assign
id|SNDRV_SB_CSP_QSOUND_MAX_RIGHT
op_div
l_int|2
suffix:semicolon
id|p-&gt;qpos_changed
op_assign
l_int|0
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|p-&gt;q_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|p-&gt;qsound_switch
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_sb_qsound_switch
comma
id|p
)paren
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|p-&gt;qsound_space
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_sb_qsound_space
comma
id|p
)paren
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__error
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|__error
suffix:colon
id|snd_sb_qsound_destroy
c_func
(paren
id|p
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|snd_sb_qsound_destroy
r_static
r_void
id|snd_sb_qsound_destroy
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
)paren
(brace
id|snd_card_t
op_star
id|card
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|snd_assert
c_func
(paren
id|p
op_ne
l_int|NULL
comma
r_return
)paren
suffix:semicolon
id|card
op_assign
id|p-&gt;chip-&gt;card
suffix:semicolon
id|down_write
c_func
(paren
op_amp
id|card-&gt;controls_rwsem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;qsound_switch
)paren
id|snd_ctl_remove
c_func
(paren
id|card
comma
id|p-&gt;qsound_switch
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;qsound_space
)paren
id|snd_ctl_remove
c_func
(paren
id|card
comma
id|p-&gt;qsound_space
)paren
suffix:semicolon
id|up_write
c_func
(paren
op_amp
id|card-&gt;controls_rwsem
)paren
suffix:semicolon
multiline_comment|/* cancel pending transfer of QSound parameters */
id|spin_lock_irqsave
(paren
op_amp
id|p-&gt;q_lock
comma
id|flags
)paren
suffix:semicolon
id|p-&gt;qpos_changed
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
(paren
op_amp
id|p-&gt;q_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Transfer qsound parameters to CSP,&n; * function should be called from interrupt routine&n; */
DECL|function|snd_sb_csp_qsound_transfer
r_static
r_int
id|snd_sb_csp_qsound_transfer
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
)paren
(brace
r_int
id|err
op_assign
op_minus
id|ENXIO
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|p-&gt;q_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;running
op_amp
id|SNDRV_SB_CSP_ST_QSOUND
)paren
(brace
id|set_codec_parameter
c_func
(paren
id|p-&gt;chip
comma
l_int|0xe0
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* left channel */
id|set_codec_parameter
c_func
(paren
id|p-&gt;chip
comma
l_int|0x00
comma
id|p-&gt;qpos_left
)paren
suffix:semicolon
id|set_codec_parameter
c_func
(paren
id|p-&gt;chip
comma
l_int|0x02
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* right channel */
id|set_codec_parameter
c_func
(paren
id|p-&gt;chip
comma
l_int|0x00
comma
id|p-&gt;qpos_right
)paren
suffix:semicolon
id|set_codec_parameter
c_func
(paren
id|p-&gt;chip
comma
l_int|0x03
comma
l_int|0x00
)paren
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
)brace
id|p-&gt;qpos_changed
op_assign
l_int|0
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|p-&gt;q_lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* ------------------------------ */
multiline_comment|/*&n; * proc interface&n; */
DECL|function|init_proc_entry
r_static
r_int
id|init_proc_entry
c_func
(paren
id|snd_sb_csp_t
op_star
id|p
comma
r_int
id|device
)paren
(brace
r_char
id|name
(braket
l_int|16
)braket
suffix:semicolon
id|snd_info_entry_t
op_star
id|entry
suffix:semicolon
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;cspD%d&quot;
comma
id|device
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_card_proc_new
c_func
(paren
id|p-&gt;chip-&gt;card
comma
id|name
comma
op_amp
id|entry
)paren
)paren
id|snd_info_set_text_ops
c_func
(paren
id|entry
comma
id|p
comma
l_int|1024
comma
id|info_read
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|info_read
r_static
r_void
id|info_read
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|snd_sb_csp_t
op_star
id|p
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_sb_csp_t
comma
id|entry-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Creative Signal Processor [v%d.%d]&bslash;n&quot;
comma
(paren
id|p-&gt;version
op_rshift
l_int|4
)paren
comma
(paren
id|p-&gt;version
op_amp
l_int|0x0f
)paren
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;State: %cx%c%c%c&bslash;n&quot;
comma
(paren
(paren
id|p-&gt;running
op_amp
id|SNDRV_SB_CSP_ST_QSOUND
)paren
ques
c_cond
l_char|&squot;Q&squot;
suffix:colon
l_char|&squot;-&squot;
)paren
comma
(paren
(paren
id|p-&gt;running
op_amp
id|SNDRV_SB_CSP_ST_PAUSED
)paren
ques
c_cond
l_char|&squot;P&squot;
suffix:colon
l_char|&squot;-&squot;
)paren
comma
(paren
(paren
id|p-&gt;running
op_amp
id|SNDRV_SB_CSP_ST_RUNNING
)paren
ques
c_cond
l_char|&squot;R&squot;
suffix:colon
l_char|&squot;-&squot;
)paren
comma
(paren
(paren
id|p-&gt;running
op_amp
id|SNDRV_SB_CSP_ST_LOADED
)paren
ques
c_cond
l_char|&squot;L&squot;
suffix:colon
l_char|&squot;-&squot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;running
op_amp
id|SNDRV_SB_CSP_ST_LOADED
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Codec: %s [func #%d]&bslash;n&quot;
comma
id|p-&gt;codec_name
comma
id|p-&gt;func_nr
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Sample rates: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;acc_rates
op_eq
id|SNDRV_SB_CSP_RATE_ALL
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;All&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%s%s%s%s&bslash;n&quot;
comma
(paren
(paren
id|p-&gt;acc_rates
op_amp
id|SNDRV_SB_CSP_RATE_8000
)paren
ques
c_cond
l_string|&quot;8000Hz &quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
(paren
(paren
id|p-&gt;acc_rates
op_amp
id|SNDRV_SB_CSP_RATE_11025
)paren
ques
c_cond
l_string|&quot;11025Hz &quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
(paren
(paren
id|p-&gt;acc_rates
op_amp
id|SNDRV_SB_CSP_RATE_22050
)paren
ques
c_cond
l_string|&quot;22050Hz &quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
(paren
(paren
id|p-&gt;acc_rates
op_amp
id|SNDRV_SB_CSP_RATE_44100
)paren
ques
c_cond
l_string|&quot;44100Hz&quot;
suffix:colon
l_string|&quot;&quot;
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;mode
op_eq
id|SNDRV_SB_CSP_MODE_QSOUND
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;QSound decoder %sabled&bslash;n&quot;
comma
id|p-&gt;q_enabled
ques
c_cond
l_string|&quot;en&quot;
suffix:colon
l_string|&quot;dis&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;PCM format ID: 0x%x (%s/%s) [%s/%s] [%s/%s]&bslash;n&quot;
comma
id|p-&gt;acc_format
comma
(paren
(paren
id|p-&gt;acc_width
op_amp
id|SNDRV_SB_CSP_SAMPLE_16BIT
)paren
ques
c_cond
l_string|&quot;16bit&quot;
suffix:colon
l_string|&quot;-&quot;
)paren
comma
(paren
(paren
id|p-&gt;acc_width
op_amp
id|SNDRV_SB_CSP_SAMPLE_8BIT
)paren
ques
c_cond
l_string|&quot;8bit&quot;
suffix:colon
l_string|&quot;-&quot;
)paren
comma
(paren
(paren
id|p-&gt;acc_channels
op_amp
id|SNDRV_SB_CSP_MONO
)paren
ques
c_cond
l_string|&quot;mono&quot;
suffix:colon
l_string|&quot;-&quot;
)paren
comma
(paren
(paren
id|p-&gt;acc_channels
op_amp
id|SNDRV_SB_CSP_STEREO
)paren
ques
c_cond
l_string|&quot;stereo&quot;
suffix:colon
l_string|&quot;-&quot;
)paren
comma
(paren
(paren
id|p-&gt;mode
op_amp
id|SNDRV_SB_CSP_MODE_DSP_WRITE
)paren
ques
c_cond
l_string|&quot;playback&quot;
suffix:colon
l_string|&quot;-&quot;
)paren
comma
(paren
(paren
id|p-&gt;mode
op_amp
id|SNDRV_SB_CSP_MODE_DSP_READ
)paren
ques
c_cond
l_string|&quot;capture&quot;
suffix:colon
l_string|&quot;-&quot;
)paren
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|p-&gt;running
op_amp
id|SNDRV_SB_CSP_ST_AUTO
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Autoloaded Mu-Law, A-Law or Ima-ADPCM hardware codec&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;running
op_amp
id|SNDRV_SB_CSP_ST_RUNNING
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Processing %dbit %s PCM samples&bslash;n&quot;
comma
(paren
(paren
id|p-&gt;run_width
op_amp
id|SNDRV_SB_CSP_SAMPLE_16BIT
)paren
ques
c_cond
l_int|16
suffix:colon
l_int|8
)paren
comma
(paren
(paren
id|p-&gt;run_channels
op_amp
id|SNDRV_SB_CSP_MONO
)paren
ques
c_cond
l_string|&quot;mono&quot;
suffix:colon
l_string|&quot;stereo&quot;
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p-&gt;running
op_amp
id|SNDRV_SB_CSP_ST_QSOUND
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Qsound position: left = 0x%x, right = 0x%x&bslash;n&quot;
comma
id|p-&gt;qpos_left
comma
id|p-&gt;qpos_right
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* */
DECL|variable|snd_sb_csp_new
id|EXPORT_SYMBOL
c_func
(paren
id|snd_sb_csp_new
)paren
suffix:semicolon
multiline_comment|/*&n; * INIT part&n; */
DECL|function|alsa_sb_csp_init
r_static
r_int
id|__init
id|alsa_sb_csp_init
c_func
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|alsa_sb_csp_exit
r_static
r_void
id|__exit
id|alsa_sb_csp_exit
c_func
(paren
r_void
)paren
(brace
)brace
id|module_init
c_func
(paren
id|alsa_sb_csp_init
)paren
id|module_exit
c_func
(paren
id|alsa_sb_csp_exit
)paren
eof
