multiline_comment|/*&n; *  Routines for control of the TEA6330T circuit via i2c bus&n; *  Sound fader control circuit for car radios by Philips Semiconductors&n; *  Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/tea6330t.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jaroslav Kysela &lt;perex@suse.cz&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Routines for control of the TEA6330T circuit via i2c bus&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|macro|TEA6330T_ADDR
mdefine_line|#define TEA6330T_ADDR&t;&t;&t;(0x80&gt;&gt;1) /* fixed address */
DECL|macro|TEA6330T_SADDR_VOLUME_LEFT
mdefine_line|#define TEA6330T_SADDR_VOLUME_LEFT&t;0x00&t;/* volume left */
DECL|macro|TEA6330T_SADDR_VOLUME_RIGHT
mdefine_line|#define TEA6330T_SADDR_VOLUME_RIGHT&t;0x01&t;/* volume right */
DECL|macro|TEA6330T_SADDR_BASS
mdefine_line|#define TEA6330T_SADDR_BASS&t;&t;0x02&t;/* bass control */
DECL|macro|TEA6330T_SADDR_TREBLE
mdefine_line|#define TEA6330T_SADDR_TREBLE&t;&t;0x03&t;/* treble control */
DECL|macro|TEA6330T_SADDR_FADER
mdefine_line|#define TEA6330T_SADDR_FADER&t;&t;0x04&t;/* fader control */
DECL|macro|TEA6330T_MFN
mdefine_line|#define   TEA6330T_MFN&t;&t;&t;0x20&t;/* mute control for selected channels */
DECL|macro|TEA6330T_FCH
mdefine_line|#define   TEA6330T_FCH&t;&t;&t;0x10&t;/* select fader channels - front or rear */
DECL|macro|TEA6330T_SADDR_AUDIO_SWITCH
mdefine_line|#define TEA6330T_SADDR_AUDIO_SWITCH&t;0x05&t;/* audio switch */
DECL|macro|TEA6330T_GMU
mdefine_line|#define   TEA6330T_GMU&t;&t;&t;0x80&t;/* mute control, general mute */
DECL|macro|TEA6330T_EQN
mdefine_line|#define   TEA6330T_EQN&t;&t;&t;0x40&t;/* equalizer switchover (0=equalizer-on) */
DECL|function|snd_tea6330t_detect
r_int
id|snd_tea6330t_detect
c_func
(paren
id|snd_i2c_bus_t
op_star
id|bus
comma
r_int
id|equalizer
)paren
(brace
r_int
id|res
suffix:semicolon
id|snd_i2c_lock
c_func
(paren
id|bus
)paren
suffix:semicolon
id|res
op_assign
id|snd_i2c_probeaddr
c_func
(paren
id|bus
comma
id|TEA6330T_ADDR
)paren
suffix:semicolon
id|snd_i2c_unlock
c_func
(paren
id|bus
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_void
id|snd_tea6330t_set
c_func
(paren
id|tea6330t_t
op_star
id|tea
comma
r_int
r_char
id|addr
comma
r_int
r_char
id|value
)paren
(brace
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;set - 0x%x/0x%x&bslash;n&quot;
comma
id|addr
comma
id|value
)paren
suffix:semicolon
macro_line|#endif
id|snd_i2c_write
c_func
(paren
id|tea-&gt;bus
comma
id|TEA6330T_ADDR
comma
id|addr
comma
id|value
comma
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|macro|TEA6330T_MASTER_VOLUME
mdefine_line|#define TEA6330T_MASTER_VOLUME(xname, xindex) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, .index = xindex, &bslash;&n;  .info = snd_tea6330t_info_master_volume, &bslash;&n;  .get = snd_tea6330t_get_master_volume, .put = snd_tea6330t_put_master_volume }
DECL|function|snd_tea6330t_info_master_volume
r_static
r_int
id|snd_tea6330t_info_master_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|43
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_tea6330t_get_master_volume
r_static
r_int
id|snd_tea6330t_get_master_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|tea6330t_t
op_star
id|tea
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|snd_i2c_lock
c_func
(paren
id|tea-&gt;bus
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|tea-&gt;mleft
op_minus
l_int|0x14
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
id|tea-&gt;mright
op_minus
l_int|0x14
suffix:semicolon
id|snd_i2c_unlock
c_func
(paren
id|tea-&gt;bus
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_tea6330t_put_master_volume
r_static
r_int
id|snd_tea6330t_put_master_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|tea6330t_t
op_star
id|tea
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|change
comma
id|count
comma
id|err
suffix:semicolon
r_int
r_char
id|bytes
(braket
l_int|3
)braket
suffix:semicolon
r_int
r_char
id|val1
comma
id|val2
suffix:semicolon
id|val1
op_assign
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_mod
l_int|44
)paren
op_plus
l_int|0x14
suffix:semicolon
id|val2
op_assign
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_mod
l_int|44
)paren
op_plus
l_int|0x14
suffix:semicolon
id|snd_i2c_lock
c_func
(paren
id|tea-&gt;bus
)paren
suffix:semicolon
id|change
op_assign
id|val1
op_ne
id|tea-&gt;mleft
op_logical_or
id|val2
op_ne
id|tea-&gt;mright
suffix:semicolon
id|tea-&gt;mleft
op_assign
id|val1
suffix:semicolon
id|tea-&gt;mright
op_assign
id|val2
suffix:semicolon
id|count
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tea-&gt;regs
(braket
id|TEA6330T_SADDR_VOLUME_LEFT
)braket
op_ne
l_int|0
)paren
(brace
id|bytes
(braket
id|count
op_increment
)braket
op_assign
id|TEA6330T_SADDR_VOLUME_LEFT
suffix:semicolon
id|bytes
(braket
id|count
op_increment
)braket
op_assign
id|tea-&gt;regs
(braket
id|TEA6330T_SADDR_VOLUME_LEFT
)braket
op_assign
id|tea-&gt;mleft
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tea-&gt;regs
(braket
id|TEA6330T_SADDR_VOLUME_RIGHT
)braket
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
id|bytes
(braket
id|count
op_increment
)braket
op_assign
id|TEA6330T_SADDR_VOLUME_RIGHT
suffix:semicolon
id|bytes
(braket
id|count
op_increment
)braket
op_assign
id|tea-&gt;regs
(braket
id|TEA6330T_SADDR_VOLUME_RIGHT
)braket
op_assign
id|tea-&gt;mright
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_i2c_sendbytes
c_func
(paren
id|tea-&gt;device
comma
id|bytes
comma
id|count
)paren
)paren
OL
l_int|0
)paren
id|change
op_assign
id|err
suffix:semicolon
)brace
id|snd_i2c_unlock
c_func
(paren
id|tea-&gt;bus
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|macro|TEA6330T_MASTER_SWITCH
mdefine_line|#define TEA6330T_MASTER_SWITCH(xname, xindex) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, .index = xindex, &bslash;&n;  .info = snd_tea6330t_info_master_switch, &bslash;&n;  .get = snd_tea6330t_get_master_switch, .put = snd_tea6330t_put_master_switch }
DECL|function|snd_tea6330t_info_master_switch
r_static
r_int
id|snd_tea6330t_info_master_switch
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_tea6330t_get_master_switch
r_static
r_int
id|snd_tea6330t_get_master_switch
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|tea6330t_t
op_star
id|tea
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|snd_i2c_lock
c_func
(paren
id|tea-&gt;bus
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|tea-&gt;regs
(braket
id|TEA6330T_SADDR_VOLUME_LEFT
)braket
op_eq
l_int|0
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
id|tea-&gt;regs
(braket
id|TEA6330T_SADDR_VOLUME_RIGHT
)braket
op_eq
l_int|0
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|snd_i2c_unlock
c_func
(paren
id|tea-&gt;bus
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_tea6330t_put_master_switch
r_static
r_int
id|snd_tea6330t_put_master_switch
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|tea6330t_t
op_star
id|tea
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|change
comma
id|err
suffix:semicolon
r_int
r_char
id|bytes
(braket
l_int|3
)braket
suffix:semicolon
r_int
r_char
id|oval1
comma
id|oval2
comma
id|val1
comma
id|val2
suffix:semicolon
id|val1
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|1
suffix:semicolon
id|val2
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_amp
l_int|1
suffix:semicolon
id|snd_i2c_lock
c_func
(paren
id|tea-&gt;bus
)paren
suffix:semicolon
id|oval1
op_assign
id|tea-&gt;regs
(braket
id|TEA6330T_SADDR_VOLUME_LEFT
)braket
op_eq
l_int|0
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|oval2
op_assign
id|tea-&gt;regs
(braket
id|TEA6330T_SADDR_VOLUME_RIGHT
)braket
op_eq
l_int|0
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|change
op_assign
id|val1
op_ne
id|oval1
op_logical_or
id|val2
op_ne
id|oval2
suffix:semicolon
id|tea-&gt;regs
(braket
id|TEA6330T_SADDR_VOLUME_LEFT
)braket
op_assign
id|val1
ques
c_cond
id|tea-&gt;mleft
suffix:colon
l_int|0
suffix:semicolon
id|tea-&gt;regs
(braket
id|TEA6330T_SADDR_VOLUME_RIGHT
)braket
op_assign
id|val2
ques
c_cond
id|tea-&gt;mright
suffix:colon
l_int|0
suffix:semicolon
id|bytes
(braket
l_int|0
)braket
op_assign
id|TEA6330T_SADDR_VOLUME_LEFT
suffix:semicolon
id|bytes
(braket
l_int|1
)braket
op_assign
id|tea-&gt;regs
(braket
id|TEA6330T_SADDR_VOLUME_LEFT
)braket
suffix:semicolon
id|bytes
(braket
l_int|2
)braket
op_assign
id|tea-&gt;regs
(braket
id|TEA6330T_SADDR_VOLUME_RIGHT
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_i2c_sendbytes
c_func
(paren
id|tea-&gt;device
comma
id|bytes
comma
l_int|3
)paren
)paren
OL
l_int|0
)paren
id|change
op_assign
id|err
suffix:semicolon
id|snd_i2c_unlock
c_func
(paren
id|tea-&gt;bus
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|macro|TEA6330T_BASS
mdefine_line|#define TEA6330T_BASS(xname, xindex) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, .index = xindex, &bslash;&n;  .info = snd_tea6330t_info_bass, &bslash;&n;  .get = snd_tea6330t_get_bass, .put = snd_tea6330t_put_bass }
DECL|function|snd_tea6330t_info_bass
r_static
r_int
id|snd_tea6330t_info_bass
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|tea6330t_t
op_star
id|tea
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
id|tea-&gt;max_bass
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_tea6330t_get_bass
r_static
r_int
id|snd_tea6330t_get_bass
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|tea6330t_t
op_star
id|tea
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|tea-&gt;bass
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_tea6330t_put_bass
r_static
r_int
id|snd_tea6330t_put_bass
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|tea6330t_t
op_star
id|tea
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|change
comma
id|err
suffix:semicolon
r_int
r_char
id|bytes
(braket
l_int|2
)braket
suffix:semicolon
r_int
r_char
id|val1
suffix:semicolon
id|val1
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_mod
(paren
id|tea-&gt;max_bass
op_plus
l_int|1
)paren
suffix:semicolon
id|snd_i2c_lock
c_func
(paren
id|tea-&gt;bus
)paren
suffix:semicolon
id|tea-&gt;bass
op_assign
id|val1
suffix:semicolon
id|val1
op_add_assign
id|tea-&gt;equalizer
ques
c_cond
l_int|7
suffix:colon
l_int|3
suffix:semicolon
id|change
op_assign
id|tea-&gt;regs
(braket
id|TEA6330T_SADDR_BASS
)braket
op_ne
id|val1
suffix:semicolon
id|bytes
(braket
l_int|0
)braket
op_assign
id|TEA6330T_SADDR_BASS
suffix:semicolon
id|bytes
(braket
l_int|1
)braket
op_assign
id|tea-&gt;regs
(braket
id|TEA6330T_SADDR_BASS
)braket
op_assign
id|val1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_i2c_sendbytes
c_func
(paren
id|tea-&gt;device
comma
id|bytes
comma
l_int|2
)paren
)paren
OL
l_int|0
)paren
id|change
op_assign
id|err
suffix:semicolon
id|snd_i2c_unlock
c_func
(paren
id|tea-&gt;bus
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|macro|TEA6330T_TREBLE
mdefine_line|#define TEA6330T_TREBLE(xname, xindex) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, .index = xindex, &bslash;&n;  .info = snd_tea6330t_info_treble, &bslash;&n;  .get = snd_tea6330t_get_treble, .put = snd_tea6330t_put_treble }
DECL|function|snd_tea6330t_info_treble
r_static
r_int
id|snd_tea6330t_info_treble
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|tea6330t_t
op_star
id|tea
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
id|tea-&gt;max_treble
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_tea6330t_get_treble
r_static
r_int
id|snd_tea6330t_get_treble
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|tea6330t_t
op_star
id|tea
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|tea-&gt;treble
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_tea6330t_put_treble
r_static
r_int
id|snd_tea6330t_put_treble
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|tea6330t_t
op_star
id|tea
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|change
comma
id|err
suffix:semicolon
r_int
r_char
id|bytes
(braket
l_int|2
)braket
suffix:semicolon
r_int
r_char
id|val1
suffix:semicolon
id|val1
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_mod
(paren
id|tea-&gt;max_treble
op_plus
l_int|1
)paren
suffix:semicolon
id|snd_i2c_lock
c_func
(paren
id|tea-&gt;bus
)paren
suffix:semicolon
id|tea-&gt;treble
op_assign
id|val1
suffix:semicolon
id|val1
op_add_assign
l_int|3
suffix:semicolon
id|change
op_assign
id|tea-&gt;regs
(braket
id|TEA6330T_SADDR_TREBLE
)braket
op_ne
id|val1
suffix:semicolon
id|bytes
(braket
l_int|0
)braket
op_assign
id|TEA6330T_SADDR_TREBLE
suffix:semicolon
id|bytes
(braket
l_int|1
)braket
op_assign
id|tea-&gt;regs
(braket
id|TEA6330T_SADDR_TREBLE
)braket
op_assign
id|val1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_i2c_sendbytes
c_func
(paren
id|tea-&gt;device
comma
id|bytes
comma
l_int|2
)paren
)paren
OL
l_int|0
)paren
id|change
op_assign
id|err
suffix:semicolon
id|snd_i2c_unlock
c_func
(paren
id|tea-&gt;bus
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|macro|TEA6330T_CONTROLS
mdefine_line|#define TEA6330T_CONTROLS (sizeof(snd_tea6330t_controls)/sizeof(snd_kcontrol_new_t))
DECL|variable|snd_tea6330t_controls
r_static
id|snd_kcontrol_new_t
id|snd_tea6330t_controls
(braket
)braket
op_assign
(brace
id|TEA6330T_MASTER_SWITCH
c_func
(paren
l_string|&quot;Master Playback Switch&quot;
comma
l_int|0
)paren
comma
id|TEA6330T_MASTER_VOLUME
c_func
(paren
l_string|&quot;Master Playback Volume&quot;
comma
l_int|0
)paren
comma
id|TEA6330T_BASS
c_func
(paren
l_string|&quot;Tone Control - Bass&quot;
comma
l_int|0
)paren
comma
id|TEA6330T_TREBLE
c_func
(paren
l_string|&quot;Tone Control - Treble&quot;
comma
l_int|0
)paren
)brace
suffix:semicolon
DECL|function|snd_tea6330_free
r_static
r_void
id|snd_tea6330_free
c_func
(paren
id|snd_i2c_device_t
op_star
id|device
)paren
(brace
id|tea6330t_t
op_star
id|tea
op_assign
id|device-&gt;private_data
suffix:semicolon
id|kfree
c_func
(paren
id|tea
)paren
suffix:semicolon
)brace
DECL|function|snd_tea6330t_update_mixer
r_int
id|snd_tea6330t_update_mixer
c_func
(paren
id|snd_card_t
op_star
id|card
comma
id|snd_i2c_bus_t
op_star
id|bus
comma
r_int
id|equalizer
comma
r_int
id|fader
)paren
(brace
id|snd_i2c_device_t
op_star
id|device
suffix:semicolon
id|tea6330t_t
op_star
id|tea
suffix:semicolon
id|snd_kcontrol_new_t
op_star
id|knew
suffix:semicolon
r_int
r_int
id|idx
suffix:semicolon
r_int
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|u8
id|default_treble
comma
id|default_bass
suffix:semicolon
r_int
r_char
id|bytes
(braket
l_int|7
)braket
suffix:semicolon
id|tea
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|tea
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tea
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_i2c_device_create
c_func
(paren
id|bus
comma
l_string|&quot;TEA6330T&quot;
comma
id|TEA6330T_ADDR
comma
op_amp
id|device
)paren
)paren
OL
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|tea
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|tea-&gt;device
op_assign
id|device
suffix:semicolon
id|tea-&gt;bus
op_assign
id|bus
suffix:semicolon
id|tea-&gt;equalizer
op_assign
id|equalizer
suffix:semicolon
id|tea-&gt;fader
op_assign
id|fader
suffix:semicolon
id|device-&gt;private_data
op_assign
id|tea
suffix:semicolon
id|device-&gt;private_free
op_assign
id|snd_tea6330_free
suffix:semicolon
id|snd_i2c_lock
c_func
(paren
id|bus
)paren
suffix:semicolon
multiline_comment|/* turn fader off and handle equalizer */
id|tea-&gt;regs
(braket
id|TEA6330T_SADDR_FADER
)braket
op_assign
l_int|0x3f
suffix:semicolon
id|tea-&gt;regs
(braket
id|TEA6330T_SADDR_AUDIO_SWITCH
)braket
op_assign
id|equalizer
ques
c_cond
l_int|0
suffix:colon
id|TEA6330T_EQN
suffix:semicolon
multiline_comment|/* initialize mixer */
r_if
c_cond
(paren
op_logical_neg
id|tea-&gt;equalizer
)paren
(brace
id|tea-&gt;max_bass
op_assign
l_int|9
suffix:semicolon
id|tea-&gt;max_treble
op_assign
l_int|8
suffix:semicolon
id|default_bass
op_assign
l_int|3
op_plus
l_int|4
suffix:semicolon
id|tea-&gt;bass
op_assign
l_int|4
suffix:semicolon
id|default_treble
op_assign
l_int|3
op_plus
l_int|4
suffix:semicolon
id|tea-&gt;treble
op_assign
l_int|4
suffix:semicolon
)brace
r_else
(brace
id|tea-&gt;max_bass
op_assign
l_int|5
suffix:semicolon
id|tea-&gt;max_treble
op_assign
l_int|0
suffix:semicolon
id|default_bass
op_assign
l_int|7
op_plus
l_int|4
suffix:semicolon
id|tea-&gt;bass
op_assign
l_int|4
suffix:semicolon
id|default_treble
op_assign
l_int|3
suffix:semicolon
id|tea-&gt;treble
op_assign
l_int|0
suffix:semicolon
)brace
id|tea-&gt;mleft
op_assign
id|tea-&gt;mright
op_assign
l_int|0x14
suffix:semicolon
id|tea-&gt;regs
(braket
id|TEA6330T_SADDR_BASS
)braket
op_assign
id|default_bass
suffix:semicolon
id|tea-&gt;regs
(braket
id|TEA6330T_SADDR_TREBLE
)braket
op_assign
id|default_treble
suffix:semicolon
multiline_comment|/* compose I2C message and put the hardware to initial state */
id|bytes
(braket
l_int|0
)braket
op_assign
id|TEA6330T_SADDR_VOLUME_LEFT
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|6
suffix:semicolon
id|idx
op_increment
)paren
id|bytes
(braket
id|idx
op_plus
l_int|1
)braket
op_assign
id|tea-&gt;regs
(braket
id|idx
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_i2c_sendbytes
c_func
(paren
id|device
comma
id|bytes
comma
l_int|7
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__error
suffix:semicolon
id|strcat
c_func
(paren
id|card-&gt;mixername
comma
l_string|&quot;,TEA6330T&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_component_add
c_func
(paren
id|card
comma
l_string|&quot;TEA6330T&quot;
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__error
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|TEA6330T_CONTROLS
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|knew
op_assign
op_amp
id|snd_tea6330t_controls
(braket
id|idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|tea-&gt;treble
op_eq
l_int|0
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|knew-&gt;name
comma
l_string|&quot;Tone Control - Treble&quot;
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ctl_new1
c_func
(paren
id|knew
comma
id|tea
)paren
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__error
suffix:semicolon
)brace
id|snd_i2c_unlock
c_func
(paren
id|bus
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|__error
suffix:colon
id|snd_i2c_unlock
c_func
(paren
id|bus
)paren
suffix:semicolon
id|snd_i2c_device_free
c_func
(paren
id|device
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|variable|snd_tea6330t_detect
id|EXPORT_SYMBOL
c_func
(paren
id|snd_tea6330t_detect
)paren
suffix:semicolon
DECL|variable|snd_tea6330t_update_mixer
id|EXPORT_SYMBOL
c_func
(paren
id|snd_tea6330t_update_mixer
)paren
suffix:semicolon
multiline_comment|/*&n; *  INIT part&n; */
DECL|function|alsa_tea6330t_init
r_static
r_int
id|__init
id|alsa_tea6330t_init
c_func
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|alsa_tea6330t_exit
r_static
r_void
id|__exit
id|alsa_tea6330t_exit
c_func
(paren
r_void
)paren
(brace
)brace
id|module_init
c_func
(paren
id|alsa_tea6330t_init
)paren
id|module_exit
c_func
(paren
id|alsa_tea6330t_exit
)paren
eof
