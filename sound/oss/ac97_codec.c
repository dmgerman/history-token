multiline_comment|/*&n; * ac97_codec.c: Generic AC97 mixer/modem module&n; *&n; * Derived from ac97 mixer in maestro and trident driver.&n; *&n; * Copyright 2000 Silicon Integrated System Corporation&n; *&n; *&t;This program is free software; you can redistribute it and/or modify&n; *&t;it under the terms of the GNU General Public License as published by&n; *&t;the Free Software Foundation; either version 2 of the License, or&n; *&t;(at your option) any later version.&n; *&n; *&t;This program is distributed in the hope that it will be useful,&n; *&t;but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *&t;MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *&t;GNU General Public License for more details.&n; *&n; *&t;You should have received a copy of the GNU General Public License&n; *&t;along with this program; if not, write to the Free Software&n; *&t;Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; **************************************************************************&n; *&n; * The Intel Audio Codec &squot;97 specification is available at the Intel&n; * audio homepage: http://developer.intel.com/ial/scalableplatforms/audio/&n; *&n; * The specification itself is currently available at:&n; * ftp://download.intel.com/ial/scalableplatforms/ac97r22.pdf&n; *&n; **************************************************************************&n; *&n; * History&n; * May 02, 2003 Liam Girdwood &lt;liam.girdwood@wolfsonmicro.com&gt;&n; *&t;Removed non existant WM9700&n; *&t;Added support for WM9705, WM9708, WM9709, WM9710, WM9711&n; *&t;WM9712 and WM9717&n; * Mar 28, 2002 Randolph Bentson &lt;bentson@holmsjoen.com&gt;&n; *&t;corrections to support WM9707 in ViewPad 1000&n; * v0.4 Mar 15 2000 Ollie Lho&n; *&t;dual codecs support verified with 4 channels output&n; * v0.3 Feb 22 2000 Ollie Lho&n; *&t;bug fix for record mask setting&n; * v0.2 Feb 10 2000 Ollie Lho&n; *&t;add ac97_read_proc for /proc/driver/{vendor}/ac97&n; * v0.1 Jan 14 2000 Ollie Lho &lt;ollie@sis.com.tw&gt; &n; *&t;Isolated from trident.c to support multiple ac97 codec&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/ac97_codec.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
DECL|macro|CODEC_ID_BUFSZ
mdefine_line|#define CODEC_ID_BUFSZ 14
r_static
r_int
id|ac97_read_mixer
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
comma
r_int
id|oss_channel
)paren
suffix:semicolon
r_static
r_void
id|ac97_write_mixer
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
comma
r_int
id|oss_channel
comma
r_int
r_int
id|left
comma
r_int
r_int
id|right
)paren
suffix:semicolon
r_static
r_void
id|ac97_set_mixer
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
comma
r_int
r_int
id|oss_mixer
comma
r_int
r_int
id|val
)paren
suffix:semicolon
r_static
r_int
id|ac97_recmask_io
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
comma
r_int
id|rw
comma
r_int
id|mask
)paren
suffix:semicolon
r_static
r_int
id|ac97_mixer_ioctl
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
suffix:semicolon
r_static
r_int
id|ac97_init_mixer
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
suffix:semicolon
r_static
r_int
id|wolfson_init03
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
suffix:semicolon
r_static
r_int
id|wolfson_init04
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
suffix:semicolon
r_static
r_int
id|wolfson_init05
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
suffix:semicolon
r_static
r_int
id|wolfson_init11
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
suffix:semicolon
r_static
r_int
id|tritech_init
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
suffix:semicolon
r_static
r_int
id|tritech_maestro_init
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
suffix:semicolon
r_static
r_int
id|sigmatel_9708_init
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
suffix:semicolon
r_static
r_int
id|sigmatel_9721_init
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
suffix:semicolon
r_static
r_int
id|sigmatel_9744_init
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
suffix:semicolon
r_static
r_int
id|ad1886_init
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
suffix:semicolon
r_static
r_int
id|eapd_control
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
comma
r_int
)paren
suffix:semicolon
r_static
r_int
id|crystal_digital_control
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
comma
r_int
id|slots
comma
r_int
id|rate
comma
r_int
id|mode
)paren
suffix:semicolon
r_static
r_int
id|cmedia_init
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
suffix:semicolon
r_static
r_int
id|cmedia_digital_control
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
comma
r_int
id|slots
comma
r_int
id|rate
comma
r_int
id|mode
)paren
suffix:semicolon
r_static
r_int
id|generic_digital_control
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
comma
r_int
id|slots
comma
r_int
id|rate
comma
r_int
id|mode
)paren
suffix:semicolon
multiline_comment|/*&n; *&t;AC97 operations.&n; *&n; *&t;If you are adding a codec then you should be able to use&n; *&t;&t;eapd_ops - any codec that supports EAPD amp control (most)&n; *&t;&t;null_ops - any ancient codec that supports nothing&n; *&n; *&t;The three functions are&n; *&t;&t;init - used for non AC97 standard initialisation&n; *&t;&t;amplifier - used to do amplifier control (1=on 0=off)&n; *&t;&t;digital - switch to digital modes (0 = analog)&n; *&n; *&t;Not all codecs support all features, not all drivers use all the&n; *&t;operations yet&n; */
DECL|variable|null_ops
r_static
r_struct
id|ac97_ops
id|null_ops
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|default_ops
r_static
r_struct
id|ac97_ops
id|default_ops
op_assign
(brace
l_int|NULL
comma
id|eapd_control
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|default_digital_ops
r_static
r_struct
id|ac97_ops
id|default_digital_ops
op_assign
(brace
l_int|NULL
comma
id|eapd_control
comma
id|generic_digital_control
)brace
suffix:semicolon
DECL|variable|wolfson_ops03
r_static
r_struct
id|ac97_ops
id|wolfson_ops03
op_assign
(brace
id|wolfson_init03
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|wolfson_ops04
r_static
r_struct
id|ac97_ops
id|wolfson_ops04
op_assign
(brace
id|wolfson_init04
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|wolfson_ops05
r_static
r_struct
id|ac97_ops
id|wolfson_ops05
op_assign
(brace
id|wolfson_init05
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|wolfson_ops11
r_static
r_struct
id|ac97_ops
id|wolfson_ops11
op_assign
(brace
id|wolfson_init11
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|tritech_ops
r_static
r_struct
id|ac97_ops
id|tritech_ops
op_assign
(brace
id|tritech_init
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|tritech_m_ops
r_static
r_struct
id|ac97_ops
id|tritech_m_ops
op_assign
(brace
id|tritech_maestro_init
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|sigmatel_9708_ops
r_static
r_struct
id|ac97_ops
id|sigmatel_9708_ops
op_assign
(brace
id|sigmatel_9708_init
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|sigmatel_9721_ops
r_static
r_struct
id|ac97_ops
id|sigmatel_9721_ops
op_assign
(brace
id|sigmatel_9721_init
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|sigmatel_9744_ops
r_static
r_struct
id|ac97_ops
id|sigmatel_9744_ops
op_assign
(brace
id|sigmatel_9744_init
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|crystal_digital_ops
r_static
r_struct
id|ac97_ops
id|crystal_digital_ops
op_assign
(brace
l_int|NULL
comma
id|eapd_control
comma
id|crystal_digital_control
)brace
suffix:semicolon
DECL|variable|ad1886_ops
r_static
r_struct
id|ac97_ops
id|ad1886_ops
op_assign
(brace
id|ad1886_init
comma
id|eapd_control
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|cmedia_ops
r_static
r_struct
id|ac97_ops
id|cmedia_ops
op_assign
(brace
l_int|NULL
comma
id|eapd_control
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|cmedia_digital_ops
r_static
r_struct
id|ac97_ops
id|cmedia_digital_ops
op_assign
(brace
id|cmedia_init
comma
id|eapd_control
comma
id|cmedia_digital_control
)brace
suffix:semicolon
multiline_comment|/* sorted by vendor/device id */
r_static
r_const
r_struct
(brace
DECL|member|id
id|u32
id|id
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|ops
r_struct
id|ac97_ops
op_star
id|ops
suffix:semicolon
DECL|member|flags
r_int
id|flags
suffix:semicolon
DECL|variable|ac97_codec_ids
)brace
id|ac97_codec_ids
(braket
)braket
op_assign
(brace
(brace
l_int|0x41445303
comma
l_string|&quot;Analog Devices AD1819&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x41445340
comma
l_string|&quot;Analog Devices AD1881&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x41445348
comma
l_string|&quot;Analog Devices AD1881A&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x41445360
comma
l_string|&quot;Analog Devices AD1885&quot;
comma
op_amp
id|default_ops
)brace
comma
(brace
l_int|0x41445361
comma
l_string|&quot;Analog Devices AD1886&quot;
comma
op_amp
id|ad1886_ops
)brace
comma
(brace
l_int|0x41445370
comma
l_string|&quot;Analog Devices AD1981&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x41445372
comma
l_string|&quot;Analog Devices AD1981A&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x41445374
comma
l_string|&quot;Analog Devices AD1981B&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x41445460
comma
l_string|&quot;Analog Devices AD1885&quot;
comma
op_amp
id|default_ops
)brace
comma
(brace
l_int|0x41445461
comma
l_string|&quot;Analog Devices AD1886&quot;
comma
op_amp
id|ad1886_ops
)brace
comma
(brace
l_int|0x414B4D00
comma
l_string|&quot;Asahi Kasei AK4540&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x414B4D01
comma
l_string|&quot;Asahi Kasei AK4542&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x414B4D02
comma
l_string|&quot;Asahi Kasei AK4543&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x414C4326
comma
l_string|&quot;ALC100P&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x414C4710
comma
l_string|&quot;ALC200/200P&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x414C4720
comma
l_string|&quot;ALC650&quot;
comma
op_amp
id|default_digital_ops
)brace
comma
(brace
l_int|0x434D4941
comma
l_string|&quot;CMedia&quot;
comma
op_amp
id|cmedia_ops
comma
id|AC97_NO_PCM_VOLUME
)brace
comma
(brace
l_int|0x434D4942
comma
l_string|&quot;CMedia&quot;
comma
op_amp
id|cmedia_ops
comma
id|AC97_NO_PCM_VOLUME
)brace
comma
(brace
l_int|0x434D4961
comma
l_string|&quot;CMedia&quot;
comma
op_amp
id|cmedia_digital_ops
comma
id|AC97_NO_PCM_VOLUME
)brace
comma
(brace
l_int|0x43525900
comma
l_string|&quot;Cirrus Logic CS4297&quot;
comma
op_amp
id|default_ops
)brace
comma
(brace
l_int|0x43525903
comma
l_string|&quot;Cirrus Logic CS4297&quot;
comma
op_amp
id|default_ops
)brace
comma
(brace
l_int|0x43525913
comma
l_string|&quot;Cirrus Logic CS4297A rev A&quot;
comma
op_amp
id|default_ops
)brace
comma
(brace
l_int|0x43525914
comma
l_string|&quot;Cirrus Logic CS4297A rev B&quot;
comma
op_amp
id|default_ops
)brace
comma
(brace
l_int|0x43525923
comma
l_string|&quot;Cirrus Logic CS4298&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x4352592B
comma
l_string|&quot;Cirrus Logic CS4294&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x4352592D
comma
l_string|&quot;Cirrus Logic CS4294&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x43525931
comma
l_string|&quot;Cirrus Logic CS4299 rev A&quot;
comma
op_amp
id|crystal_digital_ops
)brace
comma
(brace
l_int|0x43525933
comma
l_string|&quot;Cirrus Logic CS4299 rev C&quot;
comma
op_amp
id|crystal_digital_ops
)brace
comma
(brace
l_int|0x43525934
comma
l_string|&quot;Cirrus Logic CS4299 rev D&quot;
comma
op_amp
id|crystal_digital_ops
)brace
comma
(brace
l_int|0x43585442
comma
l_string|&quot;CXT66&quot;
comma
op_amp
id|default_ops
comma
id|AC97_DELUDED_MODEM
)brace
comma
(brace
l_int|0x44543031
comma
l_string|&quot;Diamond Technology DT0893&quot;
comma
op_amp
id|default_ops
)brace
comma
(brace
l_int|0x45838308
comma
l_string|&quot;ESS Allegro ES1988&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x49434511
comma
l_string|&quot;ICE1232&quot;
comma
op_amp
id|null_ops
)brace
comma
multiline_comment|/* I hope --jk */
(brace
l_int|0x4e534331
comma
l_string|&quot;National Semiconductor LM4549&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x53494c22
comma
l_string|&quot;Silicon Laboratory Si3036&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x53494c23
comma
l_string|&quot;Silicon Laboratory Si3038&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x545200FF
comma
l_string|&quot;TriTech TR?????&quot;
comma
op_amp
id|tritech_m_ops
)brace
comma
(brace
l_int|0x54524102
comma
l_string|&quot;TriTech TR28022&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x54524103
comma
l_string|&quot;TriTech TR28023&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x54524106
comma
l_string|&quot;TriTech TR28026&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x54524108
comma
l_string|&quot;TriTech TR28028&quot;
comma
op_amp
id|tritech_ops
)brace
comma
(brace
l_int|0x54524123
comma
l_string|&quot;TriTech TR A5&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x574D4C03
comma
l_string|&quot;Wolfson WM9703/07/08/17&quot;
comma
op_amp
id|wolfson_ops03
)brace
comma
(brace
l_int|0x574D4C04
comma
l_string|&quot;Wolfson WM9704M/WM9704Q&quot;
comma
op_amp
id|wolfson_ops04
)brace
comma
(brace
l_int|0x574D4C05
comma
l_string|&quot;Wolfson WM9705/WM9710&quot;
comma
op_amp
id|wolfson_ops05
)brace
comma
(brace
l_int|0x574D4C09
comma
l_string|&quot;Wolfson WM9709&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x574D4C12
comma
l_string|&quot;Wolfson WM9711/9712&quot;
comma
op_amp
id|wolfson_ops11
)brace
comma
(brace
l_int|0x83847600
comma
l_string|&quot;SigmaTel STAC????&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x83847604
comma
l_string|&quot;SigmaTel STAC9701/3/4/5&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x83847605
comma
l_string|&quot;SigmaTel STAC9704&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x83847608
comma
l_string|&quot;SigmaTel STAC9708&quot;
comma
op_amp
id|sigmatel_9708_ops
)brace
comma
(brace
l_int|0x83847609
comma
l_string|&quot;SigmaTel STAC9721/23&quot;
comma
op_amp
id|sigmatel_9721_ops
)brace
comma
(brace
l_int|0x83847644
comma
l_string|&quot;SigmaTel STAC9744/45&quot;
comma
op_amp
id|sigmatel_9744_ops
)brace
comma
(brace
l_int|0x83847652
comma
l_string|&quot;SigmaTel STAC9752/53&quot;
comma
op_amp
id|default_ops
)brace
comma
(brace
l_int|0x83847656
comma
l_string|&quot;SigmaTel STAC9756/57&quot;
comma
op_amp
id|sigmatel_9744_ops
)brace
comma
(brace
l_int|0x83847666
comma
l_string|&quot;SigmaTel STAC9750T&quot;
comma
op_amp
id|sigmatel_9744_ops
)brace
comma
(brace
l_int|0x83847684
comma
l_string|&quot;SigmaTel STAC9783/84?&quot;
comma
op_amp
id|null_ops
)brace
comma
(brace
l_int|0x57454301
comma
l_string|&quot;Winbond 83971D&quot;
comma
op_amp
id|null_ops
)brace
comma
)brace
suffix:semicolon
DECL|variable|ac97_stereo_enhancements
r_static
r_const
r_char
op_star
id|ac97_stereo_enhancements
(braket
)braket
op_assign
(brace
multiline_comment|/*   0 */
l_string|&quot;No 3D Stereo Enhancement&quot;
comma
multiline_comment|/*   1 */
l_string|&quot;Analog Devices Phat Stereo&quot;
comma
multiline_comment|/*   2 */
l_string|&quot;Creative Stereo Enhancement&quot;
comma
multiline_comment|/*   3 */
l_string|&quot;National Semi 3D Stereo Enhancement&quot;
comma
multiline_comment|/*   4 */
l_string|&quot;YAMAHA Ymersion&quot;
comma
multiline_comment|/*   5 */
l_string|&quot;BBE 3D Stereo Enhancement&quot;
comma
multiline_comment|/*   6 */
l_string|&quot;Crystal Semi 3D Stereo Enhancement&quot;
comma
multiline_comment|/*   7 */
l_string|&quot;Qsound QXpander&quot;
comma
multiline_comment|/*   8 */
l_string|&quot;Spatializer 3D Stereo Enhancement&quot;
comma
multiline_comment|/*   9 */
l_string|&quot;SRS 3D Stereo Enhancement&quot;
comma
multiline_comment|/*  10 */
l_string|&quot;Platform Tech 3D Stereo Enhancement&quot;
comma
multiline_comment|/*  11 */
l_string|&quot;AKM 3D Audio&quot;
comma
multiline_comment|/*  12 */
l_string|&quot;Aureal Stereo Enhancement&quot;
comma
multiline_comment|/*  13 */
l_string|&quot;Aztech 3D Enhancement&quot;
comma
multiline_comment|/*  14 */
l_string|&quot;Binaura 3D Audio Enhancement&quot;
comma
multiline_comment|/*  15 */
l_string|&quot;ESS Technology Stereo Enhancement&quot;
comma
multiline_comment|/*  16 */
l_string|&quot;Harman International VMAx&quot;
comma
multiline_comment|/*  17 */
l_string|&quot;Nvidea 3D Stereo Enhancement&quot;
comma
multiline_comment|/*  18 */
l_string|&quot;Philips Incredible Sound&quot;
comma
multiline_comment|/*  19 */
l_string|&quot;Texas Instruments 3D Stereo Enhancement&quot;
comma
multiline_comment|/*  20 */
l_string|&quot;VLSI Technology 3D Stereo Enhancement&quot;
comma
multiline_comment|/*  21 */
l_string|&quot;TriTech 3D Stereo Enhancement&quot;
comma
multiline_comment|/*  22 */
l_string|&quot;Realtek 3D Stereo Enhancement&quot;
comma
multiline_comment|/*  23 */
l_string|&quot;Samsung 3D Stereo Enhancement&quot;
comma
multiline_comment|/*  24 */
l_string|&quot;Wolfson Microelectronics 3D Enhancement&quot;
comma
multiline_comment|/*  25 */
l_string|&quot;Delta Integration 3D Enhancement&quot;
comma
multiline_comment|/*  26 */
l_string|&quot;SigmaTel 3D Enhancement&quot;
comma
multiline_comment|/*  27 */
l_string|&quot;Winbond 3D Stereo Enhancement&quot;
comma
multiline_comment|/*  28 */
l_string|&quot;Rockwell 3D Stereo Enhancement&quot;
comma
multiline_comment|/*  29 */
l_string|&quot;Reserved 29&quot;
comma
multiline_comment|/*  30 */
l_string|&quot;Reserved 30&quot;
comma
multiline_comment|/*  31 */
l_string|&quot;Reserved 31&quot;
)brace
suffix:semicolon
multiline_comment|/* this table has default mixer values for all OSS mixers. */
DECL|struct|mixer_defaults
r_static
r_struct
id|mixer_defaults
(brace
DECL|member|mixer
r_int
id|mixer
suffix:semicolon
DECL|member|value
r_int
r_int
id|value
suffix:semicolon
DECL|variable|mixer_defaults
)brace
id|mixer_defaults
(braket
id|SOUND_MIXER_NRDEVICES
)braket
op_assign
(brace
multiline_comment|/* all values 0 -&gt; 100 in bytes */
(brace
id|SOUND_MIXER_VOLUME
comma
l_int|0x4343
)brace
comma
(brace
id|SOUND_MIXER_BASS
comma
l_int|0x4343
)brace
comma
(brace
id|SOUND_MIXER_TREBLE
comma
l_int|0x4343
)brace
comma
(brace
id|SOUND_MIXER_PCM
comma
l_int|0x4343
)brace
comma
(brace
id|SOUND_MIXER_SPEAKER
comma
l_int|0x4343
)brace
comma
(brace
id|SOUND_MIXER_LINE
comma
l_int|0x4343
)brace
comma
(brace
id|SOUND_MIXER_MIC
comma
l_int|0x0000
)brace
comma
(brace
id|SOUND_MIXER_CD
comma
l_int|0x4343
)brace
comma
(brace
id|SOUND_MIXER_ALTPCM
comma
l_int|0x4343
)brace
comma
(brace
id|SOUND_MIXER_IGAIN
comma
l_int|0x4343
)brace
comma
(brace
id|SOUND_MIXER_LINE1
comma
l_int|0x4343
)brace
comma
(brace
id|SOUND_MIXER_PHONEIN
comma
l_int|0x4343
)brace
comma
(brace
id|SOUND_MIXER_PHONEOUT
comma
l_int|0x4343
)brace
comma
(brace
id|SOUND_MIXER_VIDEO
comma
l_int|0x4343
)brace
comma
(brace
op_minus
l_int|1
comma
l_int|0
)brace
)brace
suffix:semicolon
multiline_comment|/* table to scale scale from OSS mixer value to AC97 mixer register value */
DECL|struct|ac97_mixer_hw
r_static
r_struct
id|ac97_mixer_hw
(brace
DECL|member|offset
r_int
r_char
id|offset
suffix:semicolon
DECL|member|scale
r_int
id|scale
suffix:semicolon
DECL|variable|ac97_hw
)brace
id|ac97_hw
(braket
id|SOUND_MIXER_NRDEVICES
)braket
op_assign
(brace
(braket
id|SOUND_MIXER_VOLUME
)braket
op_assign
(brace
id|AC97_MASTER_VOL_STEREO
comma
l_int|64
)brace
comma
(braket
id|SOUND_MIXER_BASS
)braket
op_assign
(brace
id|AC97_MASTER_TONE
comma
l_int|16
)brace
comma
(braket
id|SOUND_MIXER_TREBLE
)braket
op_assign
(brace
id|AC97_MASTER_TONE
comma
l_int|16
)brace
comma
(braket
id|SOUND_MIXER_PCM
)braket
op_assign
(brace
id|AC97_PCMOUT_VOL
comma
l_int|32
)brace
comma
(braket
id|SOUND_MIXER_SPEAKER
)braket
op_assign
(brace
id|AC97_PCBEEP_VOL
comma
l_int|16
)brace
comma
(braket
id|SOUND_MIXER_LINE
)braket
op_assign
(brace
id|AC97_LINEIN_VOL
comma
l_int|32
)brace
comma
(braket
id|SOUND_MIXER_MIC
)braket
op_assign
(brace
id|AC97_MIC_VOL
comma
l_int|32
)brace
comma
(braket
id|SOUND_MIXER_CD
)braket
op_assign
(brace
id|AC97_CD_VOL
comma
l_int|32
)brace
comma
(braket
id|SOUND_MIXER_ALTPCM
)braket
op_assign
(brace
id|AC97_HEADPHONE_VOL
comma
l_int|64
)brace
comma
(braket
id|SOUND_MIXER_IGAIN
)braket
op_assign
(brace
id|AC97_RECORD_GAIN
comma
l_int|16
)brace
comma
(braket
id|SOUND_MIXER_LINE1
)braket
op_assign
(brace
id|AC97_AUX_VOL
comma
l_int|32
)brace
comma
(braket
id|SOUND_MIXER_PHONEIN
)braket
op_assign
(brace
id|AC97_PHONE_VOL
comma
l_int|32
)brace
comma
(braket
id|SOUND_MIXER_PHONEOUT
)braket
op_assign
(brace
id|AC97_MASTER_VOL_MONO
comma
l_int|64
)brace
comma
(braket
id|SOUND_MIXER_VIDEO
)braket
op_assign
(brace
id|AC97_VIDEO_VOL
comma
l_int|32
)brace
comma
)brace
suffix:semicolon
multiline_comment|/* the following tables allow us to go from OSS &lt;-&gt; ac97 quickly. */
DECL|enum|ac97_recsettings
r_enum
id|ac97_recsettings
(brace
DECL|enumerator|AC97_REC_MIC
id|AC97_REC_MIC
op_assign
l_int|0
comma
DECL|enumerator|AC97_REC_CD
id|AC97_REC_CD
comma
DECL|enumerator|AC97_REC_VIDEO
id|AC97_REC_VIDEO
comma
DECL|enumerator|AC97_REC_AUX
id|AC97_REC_AUX
comma
DECL|enumerator|AC97_REC_LINE
id|AC97_REC_LINE
comma
DECL|enumerator|AC97_REC_STEREO
id|AC97_REC_STEREO
comma
multiline_comment|/* combination of all enabled outputs..  */
DECL|enumerator|AC97_REC_MONO
id|AC97_REC_MONO
comma
multiline_comment|/*.. or the mono equivalent */
DECL|enumerator|AC97_REC_PHONE
id|AC97_REC_PHONE
)brace
suffix:semicolon
DECL|variable|ac97_rm2oss
r_static
r_const
r_int
r_int
id|ac97_rm2oss
(braket
)braket
op_assign
(brace
(braket
id|AC97_REC_MIC
)braket
op_assign
id|SOUND_MIXER_MIC
comma
(braket
id|AC97_REC_CD
)braket
op_assign
id|SOUND_MIXER_CD
comma
(braket
id|AC97_REC_VIDEO
)braket
op_assign
id|SOUND_MIXER_VIDEO
comma
(braket
id|AC97_REC_AUX
)braket
op_assign
id|SOUND_MIXER_LINE1
comma
(braket
id|AC97_REC_LINE
)braket
op_assign
id|SOUND_MIXER_LINE
comma
(braket
id|AC97_REC_STEREO
)braket
op_assign
id|SOUND_MIXER_IGAIN
comma
(braket
id|AC97_REC_PHONE
)braket
op_assign
id|SOUND_MIXER_PHONEIN
)brace
suffix:semicolon
multiline_comment|/* indexed by bit position */
DECL|variable|ac97_oss_rm
r_static
r_const
r_int
r_int
id|ac97_oss_rm
(braket
)braket
op_assign
(brace
(braket
id|SOUND_MIXER_MIC
)braket
op_assign
id|AC97_REC_MIC
comma
(braket
id|SOUND_MIXER_CD
)braket
op_assign
id|AC97_REC_CD
comma
(braket
id|SOUND_MIXER_VIDEO
)braket
op_assign
id|AC97_REC_VIDEO
comma
(braket
id|SOUND_MIXER_LINE1
)braket
op_assign
id|AC97_REC_AUX
comma
(braket
id|SOUND_MIXER_LINE
)braket
op_assign
id|AC97_REC_LINE
comma
(braket
id|SOUND_MIXER_IGAIN
)braket
op_assign
id|AC97_REC_STEREO
comma
(braket
id|SOUND_MIXER_PHONEIN
)braket
op_assign
id|AC97_REC_PHONE
)brace
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|codecs
)paren
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|codec_drivers
)paren
suffix:semicolon
r_static
id|DECLARE_MUTEX
c_func
(paren
id|codec_sem
)paren
suffix:semicolon
multiline_comment|/* reads the given OSS mixer from the ac97 the caller must have insured that the ac97 knows&n;   about that given mixer, and should be holding a spinlock for the card */
DECL|function|ac97_read_mixer
r_static
r_int
id|ac97_read_mixer
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
comma
r_int
id|oss_channel
)paren
(brace
id|u16
id|val
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_int
id|scale
suffix:semicolon
r_struct
id|ac97_mixer_hw
op_star
id|mh
op_assign
op_amp
id|ac97_hw
(braket
id|oss_channel
)braket
suffix:semicolon
id|val
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|mh-&gt;offset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
id|AC97_MUTE
)paren
(brace
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|AC97_STEREO_MASK
op_amp
(paren
l_int|1
op_lshift
id|oss_channel
)paren
)paren
(brace
multiline_comment|/* nice stereo mixers .. */
r_int
id|left
comma
id|right
suffix:semicolon
id|left
op_assign
(paren
id|val
op_rshift
l_int|8
)paren
op_amp
l_int|0x7f
suffix:semicolon
id|right
op_assign
id|val
op_amp
l_int|0x7f
suffix:semicolon
r_if
c_cond
(paren
id|oss_channel
op_eq
id|SOUND_MIXER_IGAIN
)paren
(brace
id|right
op_assign
(paren
id|right
op_star
l_int|100
)paren
op_div
id|mh-&gt;scale
suffix:semicolon
id|left
op_assign
(paren
id|left
op_star
l_int|100
)paren
op_div
id|mh-&gt;scale
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* these may have 5 or 6 bit resolution */
r_if
c_cond
(paren
id|oss_channel
op_eq
id|SOUND_MIXER_VOLUME
op_logical_or
id|oss_channel
op_eq
id|SOUND_MIXER_ALTPCM
)paren
(brace
id|scale
op_assign
(paren
l_int|1
op_lshift
id|codec-&gt;bit_resolution
)paren
suffix:semicolon
)brace
r_else
id|scale
op_assign
id|mh-&gt;scale
suffix:semicolon
id|right
op_assign
l_int|100
op_minus
(paren
(paren
id|right
op_star
l_int|100
)paren
op_div
id|scale
)paren
suffix:semicolon
id|left
op_assign
l_int|100
op_minus
(paren
(paren
id|left
op_star
l_int|100
)paren
op_div
id|scale
)paren
suffix:semicolon
)brace
id|ret
op_assign
id|left
op_or
(paren
id|right
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|oss_channel
op_eq
id|SOUND_MIXER_SPEAKER
)paren
(brace
id|ret
op_assign
l_int|100
op_minus
(paren
(paren
(paren
(paren
id|val
op_amp
l_int|0x1e
)paren
op_rshift
l_int|1
)paren
op_star
l_int|100
)paren
op_div
id|mh-&gt;scale
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|oss_channel
op_eq
id|SOUND_MIXER_PHONEIN
)paren
(brace
id|ret
op_assign
l_int|100
op_minus
(paren
(paren
(paren
id|val
op_amp
l_int|0x1f
)paren
op_star
l_int|100
)paren
op_div
id|mh-&gt;scale
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|oss_channel
op_eq
id|SOUND_MIXER_PHONEOUT
)paren
(brace
id|scale
op_assign
(paren
l_int|1
op_lshift
id|codec-&gt;bit_resolution
)paren
suffix:semicolon
id|ret
op_assign
l_int|100
op_minus
(paren
(paren
(paren
id|val
op_amp
l_int|0x1f
)paren
op_star
l_int|100
)paren
op_div
id|scale
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|oss_channel
op_eq
id|SOUND_MIXER_MIC
)paren
(brace
id|ret
op_assign
l_int|100
op_minus
(paren
(paren
(paren
id|val
op_amp
l_int|0x1f
)paren
op_star
l_int|100
)paren
op_div
id|mh-&gt;scale
)paren
suffix:semicolon
multiline_comment|/*  the low bit is optional in the tone sliders and masking&n;&t;&t;    it lets us avoid the 0xf &squot;bypass&squot;.. */
)brace
r_else
r_if
c_cond
(paren
id|oss_channel
op_eq
id|SOUND_MIXER_BASS
)paren
(brace
id|ret
op_assign
l_int|100
op_minus
(paren
(paren
(paren
(paren
id|val
op_rshift
l_int|8
)paren
op_amp
l_int|0xe
)paren
op_star
l_int|100
)paren
op_div
id|mh-&gt;scale
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|oss_channel
op_eq
id|SOUND_MIXER_TREBLE
)paren
(brace
id|ret
op_assign
l_int|100
op_minus
(paren
(paren
(paren
id|val
op_amp
l_int|0xe
)paren
op_star
l_int|100
)paren
op_div
id|mh-&gt;scale
)paren
suffix:semicolon
)brace
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
l_string|&quot;ac97_codec: read OSS mixer %2d (%s ac97 register 0x%02x), &quot;
l_string|&quot;0x%04x -&gt; 0x%04x&bslash;n&quot;
comma
id|oss_channel
comma
id|codec-&gt;id
ques
c_cond
l_string|&quot;Secondary&quot;
suffix:colon
l_string|&quot;Primary&quot;
comma
id|mh-&gt;offset
comma
id|val
comma
id|ret
)paren
suffix:semicolon
macro_line|#endif
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* write the OSS encoded volume to the given OSS encoded mixer, again caller&squot;s job to&n;   make sure all is well in arg land, call with spinlock held */
DECL|function|ac97_write_mixer
r_static
r_void
id|ac97_write_mixer
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
comma
r_int
id|oss_channel
comma
r_int
r_int
id|left
comma
r_int
r_int
id|right
)paren
(brace
id|u16
id|val
op_assign
l_int|0
suffix:semicolon
r_int
id|scale
suffix:semicolon
r_struct
id|ac97_mixer_hw
op_star
id|mh
op_assign
op_amp
id|ac97_hw
(braket
id|oss_channel
)braket
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
l_string|&quot;ac97_codec: wrote OSS mixer %2d (%s ac97 register 0x%02x), &quot;
l_string|&quot;left vol:%2d, right vol:%2d:&quot;
comma
id|oss_channel
comma
id|codec-&gt;id
ques
c_cond
l_string|&quot;Secondary&quot;
suffix:colon
l_string|&quot;Primary&quot;
comma
id|mh-&gt;offset
comma
id|left
comma
id|right
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|AC97_STEREO_MASK
op_amp
(paren
l_int|1
op_lshift
id|oss_channel
)paren
)paren
(brace
multiline_comment|/* stereo mixers */
r_if
c_cond
(paren
id|left
op_eq
l_int|0
op_logical_and
id|right
op_eq
l_int|0
)paren
(brace
id|val
op_assign
id|AC97_MUTE
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|oss_channel
op_eq
id|SOUND_MIXER_IGAIN
)paren
(brace
id|right
op_assign
(paren
id|right
op_star
id|mh-&gt;scale
)paren
op_div
l_int|100
suffix:semicolon
id|left
op_assign
(paren
id|left
op_star
id|mh-&gt;scale
)paren
op_div
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|right
op_ge
id|mh-&gt;scale
)paren
id|right
op_assign
id|mh-&gt;scale
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|left
op_ge
id|mh-&gt;scale
)paren
id|left
op_assign
id|mh-&gt;scale
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* these may have 5 or 6 bit resolution */
r_if
c_cond
(paren
id|oss_channel
op_eq
id|SOUND_MIXER_VOLUME
op_logical_or
id|oss_channel
op_eq
id|SOUND_MIXER_ALTPCM
)paren
id|scale
op_assign
(paren
l_int|1
op_lshift
id|codec-&gt;bit_resolution
)paren
suffix:semicolon
r_else
id|scale
op_assign
id|mh-&gt;scale
suffix:semicolon
id|right
op_assign
(paren
(paren
l_int|100
op_minus
id|right
)paren
op_star
id|scale
)paren
op_div
l_int|100
suffix:semicolon
id|left
op_assign
(paren
(paren
l_int|100
op_minus
id|left
)paren
op_star
id|scale
)paren
op_div
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|right
op_ge
id|scale
)paren
id|right
op_assign
id|scale
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|left
op_ge
id|scale
)paren
id|left
op_assign
id|scale
op_minus
l_int|1
suffix:semicolon
)brace
id|val
op_assign
(paren
id|left
op_lshift
l_int|8
)paren
op_or
id|right
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|oss_channel
op_eq
id|SOUND_MIXER_BASS
)paren
(brace
id|val
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|mh-&gt;offset
)paren
op_amp
op_complement
l_int|0x0f00
suffix:semicolon
id|left
op_assign
(paren
(paren
l_int|100
op_minus
id|left
)paren
op_star
id|mh-&gt;scale
)paren
op_div
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|left
op_ge
id|mh-&gt;scale
)paren
id|left
op_assign
id|mh-&gt;scale
op_minus
l_int|1
suffix:semicolon
id|val
op_or_assign
(paren
id|left
op_lshift
l_int|8
)paren
op_amp
l_int|0x0e00
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|oss_channel
op_eq
id|SOUND_MIXER_TREBLE
)paren
(brace
id|val
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|mh-&gt;offset
)paren
op_amp
op_complement
l_int|0x000f
suffix:semicolon
id|left
op_assign
(paren
(paren
l_int|100
op_minus
id|left
)paren
op_star
id|mh-&gt;scale
)paren
op_div
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|left
op_ge
id|mh-&gt;scale
)paren
id|left
op_assign
id|mh-&gt;scale
op_minus
l_int|1
suffix:semicolon
id|val
op_or_assign
id|left
op_amp
l_int|0x000e
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|left
op_eq
l_int|0
)paren
(brace
id|val
op_assign
id|AC97_MUTE
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|oss_channel
op_eq
id|SOUND_MIXER_SPEAKER
)paren
(brace
id|left
op_assign
(paren
(paren
l_int|100
op_minus
id|left
)paren
op_star
id|mh-&gt;scale
)paren
op_div
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|left
op_ge
id|mh-&gt;scale
)paren
id|left
op_assign
id|mh-&gt;scale
op_minus
l_int|1
suffix:semicolon
id|val
op_assign
id|left
op_lshift
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|oss_channel
op_eq
id|SOUND_MIXER_PHONEIN
)paren
(brace
id|left
op_assign
(paren
(paren
l_int|100
op_minus
id|left
)paren
op_star
id|mh-&gt;scale
)paren
op_div
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|left
op_ge
id|mh-&gt;scale
)paren
id|left
op_assign
id|mh-&gt;scale
op_minus
l_int|1
suffix:semicolon
id|val
op_assign
id|left
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|oss_channel
op_eq
id|SOUND_MIXER_PHONEOUT
)paren
(brace
id|scale
op_assign
(paren
l_int|1
op_lshift
id|codec-&gt;bit_resolution
)paren
suffix:semicolon
id|left
op_assign
(paren
(paren
l_int|100
op_minus
id|left
)paren
op_star
id|scale
)paren
op_div
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|left
op_ge
id|mh-&gt;scale
)paren
id|left
op_assign
id|mh-&gt;scale
op_minus
l_int|1
suffix:semicolon
id|val
op_assign
id|left
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|oss_channel
op_eq
id|SOUND_MIXER_MIC
)paren
(brace
id|val
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|mh-&gt;offset
)paren
op_amp
op_complement
l_int|0x801f
suffix:semicolon
id|left
op_assign
(paren
(paren
l_int|100
op_minus
id|left
)paren
op_star
id|mh-&gt;scale
)paren
op_div
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|left
op_ge
id|mh-&gt;scale
)paren
id|left
op_assign
id|mh-&gt;scale
op_minus
l_int|1
suffix:semicolon
id|val
op_or_assign
id|left
suffix:semicolon
multiline_comment|/*  the low bit is optional in the tone sliders and masking&n;&t;&t;    it lets us avoid the 0xf &squot;bypass&squot;.. */
)brace
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
l_string|&quot; 0x%04x&quot;
comma
id|val
)paren
suffix:semicolon
macro_line|#endif
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|mh-&gt;offset
comma
id|val
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
id|val
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|mh-&gt;offset
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; -&gt; 0x%04x&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* a thin wrapper for write_mixer */
DECL|function|ac97_set_mixer
r_static
r_void
id|ac97_set_mixer
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
comma
r_int
r_int
id|oss_mixer
comma
r_int
r_int
id|val
)paren
(brace
r_int
r_int
id|left
comma
id|right
suffix:semicolon
multiline_comment|/* cleanse input a little */
id|right
op_assign
(paren
(paren
id|val
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|left
op_assign
(paren
id|val
op_amp
l_int|0xff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|right
OG
l_int|100
)paren
id|right
op_assign
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|left
OG
l_int|100
)paren
id|left
op_assign
l_int|100
suffix:semicolon
id|codec-&gt;mixer_state
(braket
id|oss_mixer
)braket
op_assign
(paren
id|right
op_lshift
l_int|8
)paren
op_or
id|left
suffix:semicolon
id|codec
op_member_access_from_pointer
id|write_mixer
c_func
(paren
id|codec
comma
id|oss_mixer
comma
id|left
comma
id|right
)paren
suffix:semicolon
)brace
multiline_comment|/* read or write the recmask, the ac97 can really have left and right recording&n;   inputs independantly set, but OSS doesn&squot;t seem to want us to express that to&n;   the user. the caller guarantees that we have a supported bit set, and they&n;   must be holding the card&squot;s spinlock */
DECL|function|ac97_recmask_io
r_static
r_int
id|ac97_recmask_io
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
comma
r_int
id|rw
comma
r_int
id|mask
)paren
(brace
r_int
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
id|rw
)paren
(brace
multiline_comment|/* read it from the card */
id|val
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_RECORD_SELECT
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
l_string|&quot;ac97_codec: ac97 recmask to set to 0x%04x&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
macro_line|#endif
r_return
(paren
l_int|1
op_lshift
id|ac97_rm2oss
(braket
id|val
op_amp
l_int|0x07
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* else, write the first set in the mask as the&n;&t;   output */
multiline_comment|/* clear out current set value first (AC97 supports only 1 input!) */
id|val
op_assign
(paren
l_int|1
op_lshift
id|ac97_rm2oss
(braket
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_RECORD_SELECT
)paren
op_amp
l_int|0x07
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mask
op_ne
id|val
)paren
id|mask
op_and_assign
op_complement
id|val
suffix:semicolon
id|val
op_assign
id|ffs
c_func
(paren
id|mask
)paren
suffix:semicolon
id|val
op_assign
id|ac97_oss_rm
(braket
id|val
op_minus
l_int|1
)braket
suffix:semicolon
id|val
op_or_assign
id|val
op_lshift
l_int|8
suffix:semicolon
multiline_comment|/* set both channels */
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
l_string|&quot;ac97_codec: setting ac97 recmask to 0x%04x&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
macro_line|#endif
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_RECORD_SELECT
comma
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
suffix:semicolon
DECL|function|ac97_mixer_ioctl
r_static
r_int
id|ac97_mixer_ioctl
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
id|i
comma
id|val
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_MIXER_INFO
)paren
(brace
id|mixer_info
id|info
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|info
comma
l_int|0
comma
r_sizeof
(paren
id|info
)paren
)paren
suffix:semicolon
id|strlcpy
c_func
(paren
id|info.id
comma
id|codec-&gt;name
comma
r_sizeof
(paren
id|info.id
)paren
)paren
suffix:semicolon
id|strlcpy
c_func
(paren
id|info.name
comma
id|codec-&gt;name
comma
r_sizeof
(paren
id|info.name
)paren
)paren
suffix:semicolon
id|info.modify_counter
op_assign
id|codec-&gt;modcnt
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
id|__user
op_star
)paren
id|arg
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_OLD_MIXER_INFO
)paren
(brace
id|_old_mixer_info
id|info
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|info
comma
l_int|0
comma
r_sizeof
(paren
id|info
)paren
)paren
suffix:semicolon
id|strlcpy
c_func
(paren
id|info.id
comma
id|codec-&gt;name
comma
r_sizeof
(paren
id|info.id
)paren
)paren
suffix:semicolon
id|strlcpy
c_func
(paren
id|info.name
comma
id|codec-&gt;name
comma
r_sizeof
(paren
id|info.name
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
id|__user
op_star
)paren
id|arg
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|_IOC_TYPE
c_func
(paren
id|cmd
)paren
op_ne
l_char|&squot;M&squot;
op_logical_or
id|_SIOC_SIZE
c_func
(paren
id|cmd
)paren
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|OSS_GETVERSION
)paren
r_return
id|put_user
c_func
(paren
id|SOUND_VERSION
comma
(paren
r_int
id|__user
op_star
)paren
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|_SIOC_DIR
c_func
(paren
id|cmd
)paren
op_eq
id|_SIOC_READ
)paren
(brace
r_switch
c_cond
(paren
id|_IOC_NR
c_func
(paren
id|cmd
)paren
)paren
(brace
r_case
id|SOUND_MIXER_RECSRC
suffix:colon
multiline_comment|/* give them the current record source */
r_if
c_cond
(paren
op_logical_neg
id|codec-&gt;recmask_io
)paren
(brace
id|val
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|val
op_assign
id|codec
op_member_access_from_pointer
id|recmask_io
c_func
(paren
id|codec
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_DEVMASK
suffix:colon
multiline_comment|/* give them the supported mixers */
id|val
op_assign
id|codec-&gt;supported_mixers
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_RECMASK
suffix:colon
multiline_comment|/* Arg contains a bit for each supported recording source */
id|val
op_assign
id|codec-&gt;record_sources
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_STEREODEVS
suffix:colon
multiline_comment|/* Mixer channels supporting stereo */
id|val
op_assign
id|codec-&gt;stereo_mixers
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SOUND_MIXER_CAPS
suffix:colon
id|val
op_assign
id|SOUND_CAP_EXCL_INPUT
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* read a specific mixer */
id|i
op_assign
id|_IOC_NR
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|supported_mixer
c_func
(paren
id|codec
comma
id|i
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* do we ever want to touch the hardware? */
multiline_comment|/* val = codec-&gt;read_mixer(codec, i); */
id|val
op_assign
id|codec-&gt;mixer_state
(braket
id|i
)braket
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
id|val
comma
(paren
r_int
id|__user
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|_SIOC_DIR
c_func
(paren
id|cmd
)paren
op_eq
(paren
id|_SIOC_WRITE
op_or
id|_SIOC_READ
)paren
)paren
(brace
id|codec-&gt;modcnt
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
id|__user
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|_IOC_NR
c_func
(paren
id|cmd
)paren
)paren
(brace
r_case
id|SOUND_MIXER_RECSRC
suffix:colon
multiline_comment|/* Arg contains a bit for each recording source */
r_if
c_cond
(paren
op_logical_neg
id|codec-&gt;recmask_io
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|val
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|val
op_and_assign
id|codec-&gt;record_sources
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|codec
op_member_access_from_pointer
id|recmask_io
c_func
(paren
id|codec
comma
l_int|0
comma
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* write a specific mixer */
id|i
op_assign
id|_IOC_NR
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|supported_mixer
c_func
(paren
id|codec
comma
id|i
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|ac97_set_mixer
c_func
(paren
id|codec
comma
id|i
comma
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* entry point for /proc/driver/controller_vendor/ac97/%d */
DECL|function|ac97_read_proc
r_int
id|ac97_read_proc
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|len
op_assign
l_int|0
comma
id|cap
comma
id|extid
comma
id|val
comma
id|id1
comma
id|id2
suffix:semicolon
r_struct
id|ac97_codec
op_star
id|codec
suffix:semicolon
r_int
id|is_ac97_20
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|codec
op_assign
id|data
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|id1
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_VENDOR_ID1
)paren
suffix:semicolon
id|id2
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_VENDOR_ID2
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Vendor name      : %s&bslash;n&quot;
comma
id|codec-&gt;name
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Vendor id        : %04X %04X&bslash;n&quot;
comma
id|id1
comma
id|id2
)paren
suffix:semicolon
id|extid
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_EXTENDED_ID
)paren
suffix:semicolon
id|extid
op_and_assign
op_complement
(paren
(paren
l_int|1
op_lshift
l_int|2
)paren
op_or
(paren
l_int|1
op_lshift
l_int|4
)paren
op_or
(paren
l_int|1
op_lshift
l_int|5
)paren
op_or
(paren
l_int|1
op_lshift
l_int|10
)paren
op_or
(paren
l_int|1
op_lshift
l_int|11
)paren
op_or
(paren
l_int|1
op_lshift
l_int|12
)paren
op_or
(paren
l_int|1
op_lshift
l_int|13
)paren
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|page
op_plus
id|len
comma
l_string|&quot;AC97 Version     : %s&bslash;n&quot;
comma
id|extid
ques
c_cond
l_string|&quot;2.0 or later&quot;
suffix:colon
l_string|&quot;1.0&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|extid
)paren
id|is_ac97_20
op_assign
l_int|1
suffix:semicolon
id|cap
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_RESET
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Capabilities     :%s%s%s%s%s%s&bslash;n&quot;
comma
id|cap
op_amp
l_int|0x0001
ques
c_cond
l_string|&quot; -dedicated MIC PCM IN channel-&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|cap
op_amp
l_int|0x0002
ques
c_cond
l_string|&quot; -reserved1-&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|cap
op_amp
l_int|0x0004
ques
c_cond
l_string|&quot; -bass &amp; treble-&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|cap
op_amp
l_int|0x0008
ques
c_cond
l_string|&quot; -simulated stereo-&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|cap
op_amp
l_int|0x0010
ques
c_cond
l_string|&quot; -headphone out-&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|cap
op_amp
l_int|0x0020
ques
c_cond
l_string|&quot; -loudness-&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|val
op_assign
id|cap
op_amp
l_int|0x00c0
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|page
op_plus
id|len
comma
l_string|&quot;DAC resolutions  :%s%s%s&bslash;n&quot;
comma
l_string|&quot; -16-bit-&quot;
comma
id|val
op_amp
l_int|0x0040
ques
c_cond
l_string|&quot; -18-bit-&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|val
op_amp
l_int|0x0080
ques
c_cond
l_string|&quot; -20-bit-&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|val
op_assign
id|cap
op_amp
l_int|0x0300
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|page
op_plus
id|len
comma
l_string|&quot;ADC resolutions  :%s%s%s&bslash;n&quot;
comma
l_string|&quot; -16-bit-&quot;
comma
id|val
op_amp
l_int|0x0100
ques
c_cond
l_string|&quot; -18-bit-&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|val
op_amp
l_int|0x0200
ques
c_cond
l_string|&quot; -20-bit-&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|page
op_plus
id|len
comma
l_string|&quot;3D enhancement   : %s&bslash;n&quot;
comma
id|ac97_stereo_enhancements
(braket
(paren
id|cap
op_rshift
l_int|10
)paren
op_amp
l_int|0x1f
)braket
)paren
suffix:semicolon
id|val
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_GENERAL_PURPOSE
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|page
op_plus
id|len
comma
l_string|&quot;POP path         : %s 3D&bslash;n&quot;
l_string|&quot;Sim. stereo      : %s&bslash;n&quot;
l_string|&quot;3D enhancement   : %s&bslash;n&quot;
l_string|&quot;Loudness         : %s&bslash;n&quot;
l_string|&quot;Mono output      : %s&bslash;n&quot;
l_string|&quot;MIC select       : %s&bslash;n&quot;
l_string|&quot;ADC/DAC loopback : %s&bslash;n&quot;
comma
id|val
op_amp
l_int|0x8000
ques
c_cond
l_string|&quot;post&quot;
suffix:colon
l_string|&quot;pre&quot;
comma
id|val
op_amp
l_int|0x4000
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
comma
id|val
op_amp
l_int|0x2000
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
comma
id|val
op_amp
l_int|0x1000
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
comma
id|val
op_amp
l_int|0x0200
ques
c_cond
l_string|&quot;MIC&quot;
suffix:colon
l_string|&quot;MIX&quot;
comma
id|val
op_amp
l_int|0x0100
ques
c_cond
l_string|&quot;MIC2&quot;
suffix:colon
l_string|&quot;MIC1&quot;
comma
id|val
op_amp
l_int|0x0080
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
)paren
suffix:semicolon
id|extid
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_EXTENDED_ID
)paren
suffix:semicolon
id|cap
op_assign
id|extid
suffix:semicolon
id|len
op_add_assign
id|sprintf
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Ext Capabilities :%s%s%s%s%s%s%s&bslash;n&quot;
comma
id|cap
op_amp
l_int|0x0001
ques
c_cond
l_string|&quot; -var rate PCM audio-&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|cap
op_amp
l_int|0x0002
ques
c_cond
l_string|&quot; -2x PCM audio out-&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|cap
op_amp
l_int|0x0008
ques
c_cond
l_string|&quot; -var rate MIC in-&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|cap
op_amp
l_int|0x0040
ques
c_cond
l_string|&quot; -PCM center DAC-&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|cap
op_amp
l_int|0x0080
ques
c_cond
l_string|&quot; -PCM surround DAC-&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|cap
op_amp
l_int|0x0100
ques
c_cond
l_string|&quot; -PCM LFE DAC-&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|cap
op_amp
l_int|0x0200
ques
c_cond
l_string|&quot; -slot/DAC mappings-&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is_ac97_20
)paren
(brace
id|len
op_add_assign
id|sprintf
(paren
id|page
op_plus
id|len
comma
l_string|&quot;Front DAC rate   : %d&bslash;n&quot;
comma
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_PCM_FRONT_DAC_RATE
)paren
)paren
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;codec_id&t;-  Turn id1/id2 into a PnP string&n; *&t;@id1: Vendor ID1&n; *&t;@id2: Vendor ID2&n; *&t;@buf: CODEC_ID_BUFSZ byte buffer&n; *&n; *&t;Fills buf with a zero terminated PnP ident string for the id1/id2&n; *&t;pair. For convenience the return is the passed in buffer pointer.&n; */
DECL|function|codec_id
r_static
r_char
op_star
id|codec_id
c_func
(paren
id|u16
id|id1
comma
id|u16
id|id2
comma
r_char
op_star
id|buf
)paren
(brace
r_if
c_cond
(paren
id|id1
op_amp
l_int|0x8080
)paren
(brace
id|snprintf
c_func
(paren
id|buf
comma
id|CODEC_ID_BUFSZ
comma
l_string|&quot;0x%04x:0x%04x&quot;
comma
id|id1
comma
id|id2
)paren
suffix:semicolon
)brace
r_else
(brace
id|buf
(braket
l_int|0
)braket
op_assign
(paren
id|id1
op_rshift
l_int|8
)paren
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
(paren
id|id1
op_amp
l_int|0xFF
)paren
suffix:semicolon
id|buf
(braket
l_int|2
)braket
op_assign
(paren
id|id2
op_rshift
l_int|8
)paren
suffix:semicolon
id|snprintf
c_func
(paren
id|buf
op_plus
l_int|3
comma
id|CODEC_ID_BUFSZ
op_minus
l_int|3
comma
l_string|&quot;%d&quot;
comma
id|id2
op_amp
l_int|0xFF
)paren
suffix:semicolon
)brace
r_return
id|buf
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;ac97_check_modem - Check if the Codec is a modem&n; *&t;@codec: codec to check&n; *&n; *&t;Return true if the device is an AC97 1.0 or AC97 2.0 modem&n; */
DECL|function|ac97_check_modem
r_static
r_int
id|ac97_check_modem
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
(brace
multiline_comment|/* Check for an AC97 1.0 soft modem (ID1) */
r_if
c_cond
(paren
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_RESET
)paren
op_amp
l_int|2
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Check for an AC97 2.x soft modem */
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_EXTENDED_MODEM_ID
comma
l_int|0L
)paren
suffix:semicolon
r_if
c_cond
(paren
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_EXTENDED_MODEM_ID
)paren
op_amp
l_int|1
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;ac97_alloc_codec - Allocate an AC97 codec&n; *&n; *&t;Returns a new AC97 codec structure. AC97 codecs may become&n; *&t;refcounted soon so this interface is needed. Returns with&n; *&t;one reference taken.&n; */
DECL|function|ac97_alloc_codec
r_struct
id|ac97_codec
op_star
id|ac97_alloc_codec
c_func
(paren
r_void
)paren
(brace
r_struct
id|ac97_codec
op_star
id|codec
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|ac97_codec
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|codec
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|codec
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|codec
)paren
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|codec-&gt;lock
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|codec-&gt;list
)paren
suffix:semicolon
r_return
id|codec
suffix:semicolon
)brace
DECL|variable|ac97_alloc_codec
id|EXPORT_SYMBOL
c_func
(paren
id|ac97_alloc_codec
)paren
suffix:semicolon
multiline_comment|/**&n; *&t;ac97_release_codec -&t;Release an AC97 codec&n; *&t;@codec: codec to release&n; *&n; *&t;Release an allocated AC97 codec. This will be refcounted in&n; *&t;time but for the moment is trivial. Calls the unregister&n; *&t;handler if the codec is now defunct.&n; */
DECL|function|ac97_release_codec
r_void
id|ac97_release_codec
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
(brace
multiline_comment|/* Remove from the list first, we don&squot;t want to be&n;&t;   &quot;rediscovered&quot; */
id|down
c_func
(paren
op_amp
id|codec_sem
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|codec-&gt;list
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|codec_sem
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;The driver needs to deal with internal&n;&t; *&t;locking to avoid accidents here. &n;&t; */
r_if
c_cond
(paren
id|codec-&gt;driver
)paren
(brace
id|codec-&gt;driver
op_member_access_from_pointer
id|remove
c_func
(paren
id|codec
comma
id|codec-&gt;driver
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|codec
)paren
suffix:semicolon
)brace
DECL|variable|ac97_release_codec
id|EXPORT_SYMBOL
c_func
(paren
id|ac97_release_codec
)paren
suffix:semicolon
multiline_comment|/**&n; *&t;ac97_probe_codec - Initialize and setup AC97-compatible codec&n; *&t;@codec: (in/out) Kernel info for a single AC97 codec&n; *&n; *&t;Reset the AC97 codec, then initialize the mixer and&n; *&t;the rest of the @codec structure.&n; *&n; *&t;The codec_read and codec_write fields of @codec are&n; *&t;required to be setup and working when this function&n; *&t;is called.  All other fields are set by this function.&n; *&n; *&t;codec_wait field of @codec can optionally be provided&n; *&t;when calling this function.  If codec_wait is not %NULL,&n; *&t;this function will call codec_wait any time it is&n; *&t;necessary to wait for the audio chip to reach the&n; *&t;codec-ready state.  If codec_wait is %NULL, then&n; *&t;the default behavior is to call schedule_timeout.&n; *&t;Currently codec_wait is used to wait for AC97 codec&n; *&t;reset to complete. &n; *&n; *&t;Returns 1 (true) on success, or 0 (false) on failure.&n; */
DECL|function|ac97_probe_codec
r_int
id|ac97_probe_codec
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
(brace
id|u16
id|id1
comma
id|id2
suffix:semicolon
id|u16
id|audio
suffix:semicolon
r_int
id|i
suffix:semicolon
r_char
id|cidbuf
(braket
id|CODEC_ID_BUFSZ
)braket
suffix:semicolon
id|u16
id|f
suffix:semicolon
r_struct
id|list_head
op_star
id|l
suffix:semicolon
r_struct
id|ac97_driver
op_star
id|d
suffix:semicolon
multiline_comment|/* probing AC97 codec, AC97 2.0 says that bit 15 of register 0x00 (reset) should &n;&t; * be read zero.&n;&t; *&n;&t; * FIXME: is the following comment outdated?  -jgarzik &n;&t; * Probing of AC97 in this way is not reliable, it is not even SAFE !!&n;&t; */
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_RESET
comma
l_int|0L
)paren
suffix:semicolon
multiline_comment|/* also according to spec, we wait for codec-ready state */
r_if
c_cond
(paren
id|codec-&gt;codec_wait
)paren
id|codec
op_member_access_from_pointer
id|codec_wait
c_func
(paren
id|codec
)paren
suffix:semicolon
r_else
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|audio
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_RESET
)paren
)paren
op_amp
l_int|0x8000
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ac97_codec: %s ac97 codec not present&bslash;n&quot;
comma
(paren
id|codec-&gt;id
op_amp
l_int|0x2
)paren
ques
c_cond
(paren
id|codec-&gt;id
op_amp
l_int|1
ques
c_cond
l_string|&quot;4th&quot;
suffix:colon
l_string|&quot;Tertiary&quot;
)paren
suffix:colon
(paren
id|codec-&gt;id
op_amp
l_int|1
ques
c_cond
l_string|&quot;Secondary&quot;
suffix:colon
l_string|&quot;Primary&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* probe for Modem Codec */
id|codec-&gt;modem
op_assign
id|ac97_check_modem
c_func
(paren
id|codec
)paren
suffix:semicolon
id|codec-&gt;name
op_assign
l_int|NULL
suffix:semicolon
id|codec-&gt;codec_ops
op_assign
op_amp
id|default_ops
suffix:semicolon
id|id1
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_VENDOR_ID1
)paren
suffix:semicolon
id|id2
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_VENDOR_ID2
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|ac97_codec_ids
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ac97_codec_ids
(braket
id|i
)braket
dot
id|id
op_eq
(paren
(paren
id|id1
op_lshift
l_int|16
)paren
op_or
id|id2
)paren
)paren
(brace
id|codec-&gt;type
op_assign
id|ac97_codec_ids
(braket
id|i
)braket
dot
id|id
suffix:semicolon
id|codec-&gt;name
op_assign
id|ac97_codec_ids
(braket
id|i
)braket
dot
id|name
suffix:semicolon
id|codec-&gt;codec_ops
op_assign
id|ac97_codec_ids
(braket
id|i
)braket
dot
id|ops
suffix:semicolon
id|codec-&gt;flags
op_assign
id|ac97_codec_ids
(braket
id|i
)braket
dot
id|flags
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|codec-&gt;model
op_assign
(paren
id|id1
op_lshift
l_int|16
)paren
op_or
id|id2
suffix:semicolon
id|f
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_EXTENDED_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|f
op_amp
l_int|4
)paren
(brace
id|codec-&gt;codec_ops
op_assign
op_amp
id|default_digital_ops
suffix:semicolon
)brace
multiline_comment|/* A device which thinks its a modem but isnt */
r_if
c_cond
(paren
id|codec-&gt;flags
op_amp
id|AC97_DELUDED_MODEM
)paren
(brace
id|codec-&gt;modem
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|codec-&gt;name
op_eq
l_int|NULL
)paren
id|codec-&gt;name
op_assign
l_string|&quot;Unknown&quot;
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ac97_codec: AC97 %s codec, id: %s (%s)&bslash;n&quot;
comma
id|codec-&gt;modem
ques
c_cond
l_string|&quot;Modem&quot;
suffix:colon
(paren
id|audio
ques
c_cond
l_string|&quot;Audio&quot;
suffix:colon
l_string|&quot;&quot;
)paren
comma
id|codec_id
c_func
(paren
id|id1
comma
id|id2
comma
id|cidbuf
)paren
comma
id|codec-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ac97_init_mixer
c_func
(paren
id|codec
)paren
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* &n;&t; *&t;Attach last so the caller can override the mixer&n;&t; *&t;callbacks.&n;&t; */
id|down
c_func
(paren
op_amp
id|codec_sem
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|codec-&gt;list
comma
op_amp
id|codecs
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|l
comma
op_amp
id|codec_drivers
)paren
(brace
id|d
op_assign
id|list_entry
c_func
(paren
id|l
comma
r_struct
id|ac97_driver
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|codec-&gt;model
op_xor
id|d-&gt;codec_id
)paren
op_amp
id|d-&gt;codec_mask
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|d
op_member_access_from_pointer
id|probe
c_func
(paren
id|codec
comma
id|d
)paren
op_eq
l_int|0
)paren
(brace
id|codec-&gt;driver
op_assign
id|d
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|codec_sem
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|ac97_init_mixer
r_static
r_int
id|ac97_init_mixer
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
(brace
id|u16
id|cap
suffix:semicolon
r_int
id|i
suffix:semicolon
id|cap
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_RESET
)paren
suffix:semicolon
multiline_comment|/* mixer masks */
id|codec-&gt;supported_mixers
op_assign
id|AC97_SUPPORTED_MASK
suffix:semicolon
id|codec-&gt;stereo_mixers
op_assign
id|AC97_STEREO_MASK
suffix:semicolon
id|codec-&gt;record_sources
op_assign
id|AC97_RECORD_MASK
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cap
op_amp
l_int|0x04
)paren
)paren
id|codec-&gt;supported_mixers
op_and_assign
op_complement
(paren
id|SOUND_MASK_BASS
op_or
id|SOUND_MASK_TREBLE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|cap
op_amp
l_int|0x10
)paren
)paren
id|codec-&gt;supported_mixers
op_and_assign
op_complement
id|SOUND_MASK_ALTPCM
suffix:semicolon
multiline_comment|/* detect bit resolution */
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_MASTER_VOL_STEREO
comma
l_int|0x2020
)paren
suffix:semicolon
r_if
c_cond
(paren
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_MASTER_VOL_STEREO
)paren
op_eq
l_int|0x2020
)paren
(brace
id|codec-&gt;bit_resolution
op_assign
l_int|6
suffix:semicolon
)brace
r_else
id|codec-&gt;bit_resolution
op_assign
l_int|5
suffix:semicolon
multiline_comment|/* generic OSS to AC97 wrapper */
id|codec-&gt;read_mixer
op_assign
id|ac97_read_mixer
suffix:semicolon
id|codec-&gt;write_mixer
op_assign
id|ac97_write_mixer
suffix:semicolon
id|codec-&gt;recmask_io
op_assign
id|ac97_recmask_io
suffix:semicolon
id|codec-&gt;mixer_ioctl
op_assign
id|ac97_mixer_ioctl
suffix:semicolon
multiline_comment|/* codec specific initialization for 4-6 channel output or secondary codec stuff */
r_if
c_cond
(paren
id|codec-&gt;codec_ops-&gt;init
op_ne
l_int|NULL
)paren
(brace
id|codec-&gt;codec_ops
op_member_access_from_pointer
id|init
c_func
(paren
id|codec
)paren
suffix:semicolon
)brace
multiline_comment|/* initialize mixer channel volumes */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SOUND_MIXER_NRDEVICES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|mixer_defaults
op_star
id|md
op_assign
op_amp
id|mixer_defaults
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|md-&gt;mixer
op_eq
op_minus
l_int|1
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|supported_mixer
c_func
(paren
id|codec
comma
id|md-&gt;mixer
)paren
)paren
r_continue
suffix:semicolon
id|ac97_set_mixer
c_func
(paren
id|codec
comma
id|md-&gt;mixer
comma
id|md-&gt;value
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *&t;Volume is MUTE only on this device. We have to initialise&n;&t; *&t;it but its useless beyond that.&n;&t; */
r_if
c_cond
(paren
id|codec-&gt;flags
op_amp
id|AC97_NO_PCM_VOLUME
)paren
(brace
id|codec-&gt;supported_mixers
op_and_assign
op_complement
id|SOUND_MASK_PCM
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AC97 codec does not have proper volume support.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|macro|AC97_SIGMATEL_ANALOG
mdefine_line|#define AC97_SIGMATEL_ANALOG    0x6c&t;/* Analog Special */
DECL|macro|AC97_SIGMATEL_DAC2INVERT
mdefine_line|#define AC97_SIGMATEL_DAC2INVERT 0x6e
DECL|macro|AC97_SIGMATEL_BIAS1
mdefine_line|#define AC97_SIGMATEL_BIAS1     0x70
DECL|macro|AC97_SIGMATEL_BIAS2
mdefine_line|#define AC97_SIGMATEL_BIAS2     0x72
DECL|macro|AC97_SIGMATEL_MULTICHN
mdefine_line|#define AC97_SIGMATEL_MULTICHN  0x74&t;/* Multi-Channel programming */
DECL|macro|AC97_SIGMATEL_CIC1
mdefine_line|#define AC97_SIGMATEL_CIC1      0x76
DECL|macro|AC97_SIGMATEL_CIC2
mdefine_line|#define AC97_SIGMATEL_CIC2      0x78
DECL|function|sigmatel_9708_init
r_static
r_int
id|sigmatel_9708_init
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
(brace
id|u16
id|codec72
comma
id|codec6c
suffix:semicolon
id|codec72
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_SIGMATEL_BIAS2
)paren
op_amp
l_int|0x8000
suffix:semicolon
id|codec6c
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_SIGMATEL_ANALOG
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|codec72
op_eq
l_int|0
)paren
op_logical_and
(paren
id|codec6c
op_eq
l_int|0
)paren
)paren
(brace
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_SIGMATEL_CIC1
comma
l_int|0xabba
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_SIGMATEL_CIC2
comma
l_int|0x1000
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_SIGMATEL_BIAS1
comma
l_int|0xabba
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_SIGMATEL_BIAS2
comma
l_int|0x0007
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|codec72
op_eq
l_int|0x8000
)paren
op_logical_and
(paren
id|codec6c
op_eq
l_int|0
)paren
)paren
(brace
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_SIGMATEL_CIC1
comma
l_int|0xabba
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_SIGMATEL_CIC2
comma
l_int|0x1001
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_SIGMATEL_DAC2INVERT
comma
l_int|0x0008
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|codec72
op_eq
l_int|0x8000
)paren
op_logical_and
(paren
id|codec6c
op_eq
l_int|0x0080
)paren
)paren
(brace
multiline_comment|/* nothing */
)brace
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_SIGMATEL_MULTICHN
comma
l_int|0x0000
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sigmatel_9721_init
r_static
r_int
id|sigmatel_9721_init
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
(brace
multiline_comment|/* Only set up secondary codec */
r_if
c_cond
(paren
id|codec-&gt;id
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_SURROUND_MASTER
comma
l_int|0L
)paren
suffix:semicolon
multiline_comment|/* initialize SigmaTel STAC9721/23 as secondary codec, decoding AC link&n;&t;   sloc 3,4 = 0x01, slot 7,8 = 0x00, */
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_SIGMATEL_MULTICHN
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* we don&squot;t have the crystal when we are on an AMR card, so use&n;&t;   BIT_CLK as our clock source. Write the magic word ABBA and read&n;&t;   back to enable register 0x78 */
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_SIGMATEL_CIC1
comma
l_int|0xabba
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_SIGMATEL_CIC1
)paren
suffix:semicolon
multiline_comment|/* sync all the clocks*/
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_SIGMATEL_CIC2
comma
l_int|0x3802
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sigmatel_9744_init
r_static
r_int
id|sigmatel_9744_init
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
(brace
singleline_comment|// patch for SigmaTel
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_SIGMATEL_CIC1
comma
l_int|0xabba
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_SIGMATEL_CIC2
comma
l_int|0x0000
)paren
suffix:semicolon
singleline_comment|// is this correct? --jk
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_SIGMATEL_BIAS1
comma
l_int|0xabba
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_SIGMATEL_BIAS2
comma
l_int|0x0002
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_SIGMATEL_MULTICHN
comma
l_int|0x0000
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cmedia_init
r_static
r_int
id|cmedia_init
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
(brace
multiline_comment|/* Initialise the CMedia 9739 */
multiline_comment|/*&n;&t;&t;We could set various options here&n;&t;&t;Register 0x20 bit 0x100 sets mic as center bass&n;&t;&t;Also do multi_channel_ctrl &amp;=~0x3000 |=0x1000&n;&t;&t;&n;&t;&t;For now we set up the GPIO and PC beep &n;&t;*/
id|u16
id|v
suffix:semicolon
multiline_comment|/* MIC */
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x64
comma
l_int|0x3000
)paren
suffix:semicolon
id|v
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
l_int|0x64
)paren
suffix:semicolon
id|v
op_and_assign
op_complement
l_int|0x8000
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x64
comma
id|v
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x70
comma
l_int|0x0100
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x72
comma
l_int|0x0020
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|AC97_WM97XX_FMIXER_VOL
mdefine_line|#define AC97_WM97XX_FMIXER_VOL 0x72
DECL|macro|AC97_WM97XX_RMIXER_VOL
mdefine_line|#define AC97_WM97XX_RMIXER_VOL 0x74
DECL|macro|AC97_WM97XX_TEST
mdefine_line|#define AC97_WM97XX_TEST 0x5a
DECL|macro|AC97_WM9704_RPCM_VOL
mdefine_line|#define AC97_WM9704_RPCM_VOL 0x70
DECL|macro|AC97_WM9711_OUT3VOL
mdefine_line|#define AC97_WM9711_OUT3VOL 0x16
DECL|function|wolfson_init03
r_static
r_int
id|wolfson_init03
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
(brace
multiline_comment|/* this is known to work for the ViewSonic ViewPad 1000 */
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_WM97XX_FMIXER_VOL
comma
l_int|0x0808
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_GENERAL_PURPOSE
comma
l_int|0x8000
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wolfson_init04
r_static
r_int
id|wolfson_init04
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
(brace
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_WM97XX_FMIXER_VOL
comma
l_int|0x0808
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_WM97XX_RMIXER_VOL
comma
l_int|0x0808
)paren
suffix:semicolon
singleline_comment|// patch for DVD noise
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_WM97XX_TEST
comma
l_int|0x0200
)paren
suffix:semicolon
singleline_comment|// init vol as PCM vol
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_WM9704_RPCM_VOL
comma
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_PCMOUT_VOL
)paren
)paren
suffix:semicolon
multiline_comment|/* set rear surround volume */
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_SURROUND_MASTER
comma
l_int|0x0000
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* WM9705, WM9710 */
DECL|function|wolfson_init05
r_static
r_int
id|wolfson_init05
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
(brace
multiline_comment|/* set front mixer volume */
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_WM97XX_FMIXER_VOL
comma
l_int|0x0808
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* WM9711, WM9712 */
DECL|function|wolfson_init11
r_static
r_int
id|wolfson_init11
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
(brace
multiline_comment|/* stop pop&squot;s during suspend/resume */
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_WM97XX_TEST
comma
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_WM97XX_TEST
)paren
op_amp
l_int|0xffbf
)paren
suffix:semicolon
multiline_comment|/* set out3 volume */
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_WM9711_OUT3VOL
comma
l_int|0x0808
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|tritech_init
r_static
r_int
id|tritech_init
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
(brace
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x26
comma
l_int|0x0300
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x26
comma
l_int|0x0000
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_SURROUND_MASTER
comma
l_int|0x0000
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_RESERVED_3A
comma
l_int|0x0000
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* copied from drivers/sound/maestro.c */
DECL|function|tritech_maestro_init
r_static
r_int
id|tritech_maestro_init
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
(brace
multiline_comment|/* no idea what this does */
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x2A
comma
l_int|0x0001
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x2C
comma
l_int|0x0000
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x2C
comma
l_int|0XFFFF
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* &n; *&t;Presario700 workaround &n; * &t;for Jack Sense/SPDIF Register mis-setting causing&n; *&t;no audible output&n; *&t;by Santiago Nullo 04/05/2002&n; */
DECL|macro|AC97_AD1886_JACK_SENSE
mdefine_line|#define AC97_AD1886_JACK_SENSE 0x72
DECL|function|ad1886_init
r_static
r_int
id|ad1886_init
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
(brace
multiline_comment|/* from AD1886 Specs */
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_AD1886_JACK_SENSE
comma
l_int|0x0010
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;This is basically standard AC97. It should work as a default for&n; *&t;almost all modern codecs. Note that some cards wire EAPD *backwards*&n; *&t;That side of it is up to the card driver not us to cope with.&n; *&n; */
DECL|function|eapd_control
r_static
r_int
id|eapd_control
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
comma
r_int
id|on
)paren
(brace
r_if
c_cond
(paren
id|on
)paren
(brace
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_POWER_CONTROL
comma
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_POWER_CONTROL
)paren
op_or
l_int|0x8000
)paren
suffix:semicolon
)brace
r_else
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_POWER_CONTROL
comma
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_POWER_CONTROL
)paren
op_amp
op_complement
l_int|0x8000
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|generic_digital_control
r_static
r_int
id|generic_digital_control
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
comma
r_int
id|slots
comma
r_int
id|rate
comma
r_int
id|mode
)paren
(brace
id|u16
id|reg
suffix:semicolon
id|reg
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_SPDIF_CONTROL
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|rate
)paren
(brace
multiline_comment|/* Off by default */
r_default
suffix:colon
r_case
l_int|0
suffix:colon
id|reg
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_EXTENDED_STATUS
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_EXTENDED_STATUS
comma
(paren
id|reg
op_amp
op_complement
id|AC97_EA_SPDIF
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rate
op_eq
l_int|0
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
l_int|1
suffix:colon
id|reg
op_assign
(paren
id|reg
op_amp
id|AC97_SC_SPSR_MASK
)paren
op_or
id|AC97_SC_SPSR_48K
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|reg
op_assign
(paren
id|reg
op_amp
id|AC97_SC_SPSR_MASK
)paren
op_or
id|AC97_SC_SPSR_44K
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|reg
op_assign
(paren
id|reg
op_amp
id|AC97_SC_SPSR_MASK
)paren
op_or
id|AC97_SC_SPSR_32K
suffix:semicolon
r_break
suffix:semicolon
)brace
id|reg
op_and_assign
op_complement
id|AC97_SC_CC_MASK
suffix:semicolon
id|reg
op_or_assign
(paren
id|mode
op_amp
id|AUDIO_CCMASK
)paren
op_lshift
l_int|6
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_amp
id|AUDIO_DIGITAL
)paren
(brace
id|reg
op_or_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mode
op_amp
id|AUDIO_PRO
)paren
(brace
id|reg
op_or_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mode
op_amp
id|AUDIO_DRS
)paren
(brace
id|reg
op_or_assign
l_int|0x4000
suffix:semicolon
)brace
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_SPDIF_CONTROL
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_EXTENDED_STATUS
)paren
suffix:semicolon
id|reg
op_and_assign
(paren
id|AC97_EA_SLOT_MASK
)paren
suffix:semicolon
id|reg
op_or_assign
id|AC97_EA_VRA
op_or
id|AC97_EA_SPDIF
op_or
id|slots
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_EXTENDED_STATUS
comma
id|reg
)paren
suffix:semicolon
id|reg
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_EXTENDED_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|reg
op_amp
l_int|0x0400
)paren
)paren
(brace
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_EXTENDED_STATUS
comma
id|reg
op_amp
op_complement
id|AC97_EA_SPDIF
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Crystal digital audio control (CS4299)&n; */
DECL|function|crystal_digital_control
r_static
r_int
id|crystal_digital_control
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
comma
r_int
id|slots
comma
r_int
id|rate
comma
r_int
id|mode
)paren
(brace
id|u16
id|cv
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_amp
id|AUDIO_DIGITAL
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|rate
)paren
(brace
r_case
l_int|0
suffix:colon
id|cv
op_assign
l_int|0x0
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* SPEN off */
r_case
l_int|48000
suffix:colon
id|cv
op_assign
l_int|0x8004
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* 48KHz digital */
r_case
l_int|44100
suffix:colon
id|cv
op_assign
l_int|0x8104
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* 44.1KHz digital */
r_case
l_int|32768
suffix:colon
multiline_comment|/* 32Khz */
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x68
comma
id|cv
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;CMedia digital audio control&n; *&t;Needs more work.&n; */
DECL|function|cmedia_digital_control
r_static
r_int
id|cmedia_digital_control
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
comma
r_int
id|slots
comma
r_int
id|rate
comma
r_int
id|mode
)paren
(brace
id|u16
id|cv
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_amp
id|AUDIO_DIGITAL
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|rate
)paren
(brace
r_case
l_int|0
suffix:colon
id|cv
op_assign
l_int|0x0001
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* SPEN off */
r_case
l_int|48000
suffix:colon
id|cv
op_assign
l_int|0x0009
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* 48KHz digital */
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x2A
comma
l_int|0x05c4
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x6C
comma
id|cv
)paren
suffix:semicolon
multiline_comment|/* Switch on mix to surround */
id|cv
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
l_int|0x64
)paren
suffix:semicolon
id|cv
op_and_assign
op_complement
l_int|0x0200
suffix:semicolon
r_if
c_cond
(paren
id|mode
)paren
(brace
id|cv
op_or_assign
l_int|0x0200
suffix:semicolon
)brace
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x64
comma
id|cv
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* copied from drivers/sound/maestro.c */
macro_line|#if 0  /* there has been 1 person on the planet with a pt101 that we&n;        know of.  If they care, they can put this back in :) */
r_static
r_int
id|pt101_init
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ac97_codec: PT101 Codec detected, initializing but _not_ installing mixer device.&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* who knows.. */
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x2A
comma
l_int|0x0001
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x2C
comma
l_int|0x0000
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x2C
comma
l_int|0xFFFF
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x10
comma
l_int|0x9F1F
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x12
comma
l_int|0x0808
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x14
comma
l_int|0x9F1F
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x16
comma
l_int|0x9F1F
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x18
comma
l_int|0x0404
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x1A
comma
l_int|0x0000
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x1C
comma
l_int|0x0000
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x02
comma
l_int|0x0404
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x04
comma
l_int|0x0808
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x0C
comma
l_int|0x801F
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
l_int|0x0E
comma
l_int|0x801F
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|variable|ac97_read_proc
id|EXPORT_SYMBOL
c_func
(paren
id|ac97_read_proc
)paren
suffix:semicolon
DECL|variable|ac97_probe_codec
id|EXPORT_SYMBOL
c_func
(paren
id|ac97_probe_codec
)paren
suffix:semicolon
multiline_comment|/*&n; *&t;AC97 library support routines&n; */
multiline_comment|/**&n; *&t;ac97_set_dac_rate&t;-&t;set codec rate adaption&n; *&t;@codec: ac97 code&n; *&t;@rate: rate in hertz&n; *&n; *&t;Set the DAC rate. Assumes the codec supports VRA. The caller is&n; *&t;expected to have checked this little detail.&n; */
DECL|function|ac97_set_dac_rate
r_int
r_int
id|ac97_set_dac_rate
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
comma
r_int
r_int
id|rate
)paren
(brace
r_int
r_int
id|new_rate
op_assign
id|rate
suffix:semicolon
id|u32
id|dacp
suffix:semicolon
id|u32
id|mast_vol
comma
id|phone_vol
comma
id|mono_vol
comma
id|pcm_vol
suffix:semicolon
id|u32
id|mute_vol
op_assign
l_int|0x8000
suffix:semicolon
multiline_comment|/* The mute volume? */
r_if
c_cond
(paren
id|rate
op_ne
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_PCM_FRONT_DAC_RATE
)paren
)paren
(brace
multiline_comment|/* Mute several registers */
id|mast_vol
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_MASTER_VOL_STEREO
)paren
suffix:semicolon
id|mono_vol
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_MASTER_VOL_MONO
)paren
suffix:semicolon
id|phone_vol
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_HEADPHONE_VOL
)paren
suffix:semicolon
id|pcm_vol
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_PCMOUT_VOL
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_MASTER_VOL_STEREO
comma
id|mute_vol
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_MASTER_VOL_MONO
comma
id|mute_vol
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_HEADPHONE_VOL
comma
id|mute_vol
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_PCMOUT_VOL
comma
id|mute_vol
)paren
suffix:semicolon
multiline_comment|/* Power down the DAC */
id|dacp
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_POWER_CONTROL
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_POWER_CONTROL
comma
id|dacp
op_or
l_int|0x0200
)paren
suffix:semicolon
multiline_comment|/* Load the rate and read the effective rate */
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_PCM_FRONT_DAC_RATE
comma
id|rate
)paren
suffix:semicolon
id|new_rate
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_PCM_FRONT_DAC_RATE
)paren
suffix:semicolon
multiline_comment|/* Power it back up */
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_POWER_CONTROL
comma
id|dacp
)paren
suffix:semicolon
multiline_comment|/* Restore volumes */
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_MASTER_VOL_STEREO
comma
id|mast_vol
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_MASTER_VOL_MONO
comma
id|mono_vol
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_HEADPHONE_VOL
comma
id|phone_vol
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_PCMOUT_VOL
comma
id|pcm_vol
)paren
suffix:semicolon
)brace
r_return
id|new_rate
suffix:semicolon
)brace
DECL|variable|ac97_set_dac_rate
id|EXPORT_SYMBOL
c_func
(paren
id|ac97_set_dac_rate
)paren
suffix:semicolon
multiline_comment|/**&n; *&t;ac97_set_adc_rate&t;-&t;set codec rate adaption&n; *&t;@codec: ac97 code&n; *&t;@rate: rate in hertz&n; *&n; *&t;Set the ADC rate. Assumes the codec supports VRA. The caller is&n; *&t;expected to have checked this little detail.&n; */
DECL|function|ac97_set_adc_rate
r_int
r_int
id|ac97_set_adc_rate
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
comma
r_int
r_int
id|rate
)paren
(brace
r_int
r_int
id|new_rate
op_assign
id|rate
suffix:semicolon
id|u32
id|dacp
suffix:semicolon
r_if
c_cond
(paren
id|rate
op_ne
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_PCM_LR_ADC_RATE
)paren
)paren
(brace
multiline_comment|/* Power down the ADC */
id|dacp
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_POWER_CONTROL
)paren
suffix:semicolon
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_POWER_CONTROL
comma
id|dacp
op_or
l_int|0x0100
)paren
suffix:semicolon
multiline_comment|/* Load the rate and read the effective rate */
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_PCM_LR_ADC_RATE
comma
id|rate
)paren
suffix:semicolon
id|new_rate
op_assign
id|codec
op_member_access_from_pointer
id|codec_read
c_func
(paren
id|codec
comma
id|AC97_PCM_LR_ADC_RATE
)paren
suffix:semicolon
multiline_comment|/* Power it back up */
id|codec
op_member_access_from_pointer
id|codec_write
c_func
(paren
id|codec
comma
id|AC97_POWER_CONTROL
comma
id|dacp
)paren
suffix:semicolon
)brace
r_return
id|new_rate
suffix:semicolon
)brace
DECL|variable|ac97_set_adc_rate
id|EXPORT_SYMBOL
c_func
(paren
id|ac97_set_adc_rate
)paren
suffix:semicolon
DECL|function|ac97_save_state
r_int
id|ac97_save_state
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ac97_save_state
id|EXPORT_SYMBOL
c_func
(paren
id|ac97_save_state
)paren
suffix:semicolon
DECL|function|ac97_restore_state
r_int
id|ac97_restore_state
c_func
(paren
r_struct
id|ac97_codec
op_star
id|codec
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|left
comma
id|right
comma
id|val
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SOUND_MIXER_NRDEVICES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|supported_mixer
c_func
(paren
id|codec
comma
id|i
)paren
)paren
r_continue
suffix:semicolon
id|val
op_assign
id|codec-&gt;mixer_state
(braket
id|i
)braket
suffix:semicolon
id|right
op_assign
id|val
op_rshift
l_int|8
suffix:semicolon
id|left
op_assign
id|val
op_amp
l_int|0xff
suffix:semicolon
id|codec
op_member_access_from_pointer
id|write_mixer
c_func
(paren
id|codec
comma
id|i
comma
id|left
comma
id|right
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ac97_restore_state
id|EXPORT_SYMBOL
c_func
(paren
id|ac97_restore_state
)paren
suffix:semicolon
multiline_comment|/**&n; *&t;ac97_register_driver&t;-&t;register a codec helper&n; *&t;@driver: Driver handler&n; *&n; *&t;Register a handler for codecs matching the codec id. The handler&n; *&t;attach function is called for all present codecs and will be &n; *&t;called when new codecs are discovered.&n; */
DECL|function|ac97_register_driver
r_int
id|ac97_register_driver
c_func
(paren
r_struct
id|ac97_driver
op_star
id|driver
)paren
(brace
r_struct
id|list_head
op_star
id|l
suffix:semicolon
r_struct
id|ac97_codec
op_star
id|c
suffix:semicolon
id|down
c_func
(paren
op_amp
id|codec_sem
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|driver-&gt;list
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|driver-&gt;list
comma
op_amp
id|codec_drivers
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|l
comma
op_amp
id|codecs
)paren
(brace
id|c
op_assign
id|list_entry
c_func
(paren
id|l
comma
r_struct
id|ac97_codec
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;driver
op_ne
l_int|NULL
op_logical_or
(paren
(paren
id|c-&gt;model
op_xor
id|driver-&gt;codec_id
)paren
op_amp
id|driver-&gt;codec_mask
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|driver
op_member_access_from_pointer
id|probe
c_func
(paren
id|c
comma
id|driver
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
id|c-&gt;driver
op_assign
id|driver
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|codec_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ac97_register_driver
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|ac97_register_driver
)paren
suffix:semicolon
multiline_comment|/**&n; *&t;ac97_unregister_driver&t;-&t;unregister a codec helper&n; *&t;@driver: Driver handler&n; *&n; *&t;Unregister a handler for codecs matching the codec id. The handler&n; *&t;remove function is called for all matching codecs.&n; */
DECL|function|ac97_unregister_driver
r_void
id|ac97_unregister_driver
c_func
(paren
r_struct
id|ac97_driver
op_star
id|driver
)paren
(brace
r_struct
id|list_head
op_star
id|l
suffix:semicolon
r_struct
id|ac97_codec
op_star
id|c
suffix:semicolon
id|down
c_func
(paren
op_amp
id|codec_sem
)paren
suffix:semicolon
id|list_del_init
c_func
(paren
op_amp
id|driver-&gt;list
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|l
comma
op_amp
id|codecs
)paren
(brace
id|c
op_assign
id|list_entry
c_func
(paren
id|l
comma
r_struct
id|ac97_codec
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c-&gt;driver
op_eq
id|driver
)paren
(brace
id|driver
op_member_access_from_pointer
id|remove
c_func
(paren
id|c
comma
id|driver
)paren
suffix:semicolon
id|c-&gt;driver
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|codec_sem
)paren
suffix:semicolon
)brace
DECL|variable|ac97_unregister_driver
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|ac97_unregister_driver
)paren
suffix:semicolon
DECL|function|swap_headphone
r_static
r_int
id|swap_headphone
c_func
(paren
r_int
id|remove_master
)paren
(brace
r_struct
id|list_head
op_star
id|l
suffix:semicolon
r_struct
id|ac97_codec
op_star
id|c
suffix:semicolon
r_if
c_cond
(paren
id|remove_master
)paren
(brace
id|down
c_func
(paren
op_amp
id|codec_sem
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|l
comma
op_amp
id|codecs
)paren
(brace
id|c
op_assign
id|list_entry
c_func
(paren
id|l
comma
r_struct
id|ac97_codec
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|supported_mixer
c_func
(paren
id|c
comma
id|SOUND_MIXER_PHONEOUT
)paren
)paren
id|c-&gt;supported_mixers
op_and_assign
op_complement
id|SOUND_MASK_PHONEOUT
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|codec_sem
)paren
suffix:semicolon
)brace
r_else
id|ac97_hw
(braket
id|SOUND_MIXER_PHONEOUT
)braket
dot
id|offset
op_assign
id|AC97_MASTER_VOL_STEREO
suffix:semicolon
multiline_comment|/* Scale values already match */
id|ac97_hw
(braket
id|SOUND_MIXER_VOLUME
)braket
dot
id|offset
op_assign
id|AC97_MASTER_VOL_MONO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|apply_quirk
r_static
r_int
id|apply_quirk
c_func
(paren
r_int
id|quirk
)paren
(brace
r_switch
c_cond
(paren
id|quirk
)paren
(brace
r_case
id|AC97_TUNE_NONE
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|AC97_TUNE_HP_ONLY
suffix:colon
r_return
id|swap_headphone
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_case
id|AC97_TUNE_SWAP_HP
suffix:colon
r_return
id|swap_headphone
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_case
id|AC97_TUNE_SWAP_SURROUND
suffix:colon
r_return
op_minus
id|ENOSYS
suffix:semicolon
multiline_comment|/* not yet implemented */
r_case
id|AC97_TUNE_AD_SHARING
suffix:colon
r_return
op_minus
id|ENOSYS
suffix:semicolon
multiline_comment|/* not yet implemented */
r_case
id|AC97_TUNE_ALC_JACK
suffix:colon
r_return
op_minus
id|ENOSYS
suffix:semicolon
multiline_comment|/* not yet implemented */
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;ac97_tune_hardware - tune up the hardware&n; *&t;@pdev: pci_dev pointer&n; *&t;@quirk: quirk list&n; *&t;@override: explicit quirk value (overrides if not AC97_TUNE_DEFAULT)&n; *&n; *&t;Do some workaround for each pci device, such as renaming of the&n; *&t;headphone (true line-out) control as &quot;Master&quot;.&n; *&t;The quirk-list must be terminated with a zero-filled entry.&n; *&n; *&t;Returns zero if successful, or a negative error code on failure.&n; */
DECL|function|ac97_tune_hardware
r_int
id|ac97_tune_hardware
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
comma
r_struct
id|ac97_quirk
op_star
id|quirk
comma
r_int
id|override
)paren
(brace
r_int
id|result
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|quirk
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|override
op_ne
id|AC97_TUNE_DEFAULT
)paren
(brace
id|result
op_assign
id|apply_quirk
c_func
(paren
id|override
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;applying quirk type %d failed (%d)&bslash;n&quot;
comma
id|override
comma
id|result
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
r_for
c_loop
(paren
suffix:semicolon
id|quirk-&gt;vendor
suffix:semicolon
id|quirk
op_increment
)paren
(brace
r_if
c_cond
(paren
id|quirk-&gt;vendor
op_ne
id|pdev-&gt;subsystem_vendor
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|quirk-&gt;mask
op_logical_and
id|quirk-&gt;device
op_eq
id|pdev-&gt;subsystem_device
)paren
op_logical_or
id|quirk-&gt;device
op_eq
(paren
id|quirk-&gt;mask
op_amp
id|pdev-&gt;subsystem_device
)paren
)paren
(brace
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
l_string|&quot;ac97 quirk for %s (%04x:%04x)&bslash;n&quot;
comma
id|quirk-&gt;name
comma
id|ac97-&gt;subsystem_vendor
comma
id|pdev-&gt;subsystem_device
)paren
suffix:semicolon
macro_line|#endif
id|result
op_assign
id|apply_quirk
c_func
(paren
id|quirk-&gt;type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;applying quirk type %d for %s failed (%d)&bslash;n&quot;
comma
id|quirk-&gt;type
comma
id|quirk-&gt;name
comma
id|result
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ac97_tune_hardware
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|ac97_tune_hardware
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
