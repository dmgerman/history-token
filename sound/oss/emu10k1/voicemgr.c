multiline_comment|/*&n; **********************************************************************&n; *     voicemgr.c - Voice manager for emu10k1 driver&n; *     Copyright 1999, 2000 Creative Labs, Inc.&n; *&n; **********************************************************************&n; *&n; *     Date                 Author          Summary of changes&n; *     ----                 ------          ------------------&n; *     October 20, 1999     Bertrand Lee    base code release&n; *&n; **********************************************************************&n; *&n; *     This program is free software; you can redistribute it and/or&n; *     modify it under the terms of the GNU General Public License as&n; *     published by the Free Software Foundation; either version 2 of&n; *     the License, or (at your option) any later version.&n; *&n; *     This program is distributed in the hope that it will be useful,&n; *     but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *     GNU General Public License for more details.&n; *&n; *     You should have received a copy of the GNU General Public&n; *     License along with this program; if not, write to the Free&n; *     Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139,&n; *     USA.&n; *&n; **********************************************************************&n; */
macro_line|#include &quot;voicemgr.h&quot;
macro_line|#include &quot;8010.h&quot;
DECL|macro|PITCH_48000
mdefine_line|#define PITCH_48000 0x00004000
DECL|macro|PITCH_96000
mdefine_line|#define PITCH_96000 0x00008000
DECL|macro|PITCH_85000
mdefine_line|#define PITCH_85000 0x00007155
DECL|macro|PITCH_80726
mdefine_line|#define PITCH_80726 0x00006ba2
DECL|macro|PITCH_67882
mdefine_line|#define PITCH_67882 0x00005a82
DECL|macro|PITCH_57081
mdefine_line|#define PITCH_57081 0x00004c1c
DECL|function|emu10k1_select_interprom
r_static
id|u32
id|emu10k1_select_interprom
c_func
(paren
r_struct
id|emu10k1_card
op_star
id|card
comma
r_struct
id|emu_voice
op_star
id|voice
)paren
(brace
r_if
c_cond
(paren
id|voice-&gt;pitch_target
op_eq
id|PITCH_48000
)paren
(brace
r_return
id|CCCA_INTERPROM_0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|voice-&gt;pitch_target
OL
id|PITCH_48000
)paren
(brace
r_return
id|CCCA_INTERPROM_1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|voice-&gt;pitch_target
op_ge
id|PITCH_96000
)paren
(brace
r_return
id|CCCA_INTERPROM_0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|voice-&gt;pitch_target
op_ge
id|PITCH_85000
)paren
(brace
r_return
id|CCCA_INTERPROM_6
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|voice-&gt;pitch_target
op_ge
id|PITCH_80726
)paren
(brace
r_return
id|CCCA_INTERPROM_5
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|voice-&gt;pitch_target
op_ge
id|PITCH_67882
)paren
(brace
r_return
id|CCCA_INTERPROM_4
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|voice-&gt;pitch_target
op_ge
id|PITCH_57081
)paren
(brace
r_return
id|CCCA_INTERPROM_3
suffix:semicolon
)brace
r_else
r_return
id|CCCA_INTERPROM_2
suffix:semicolon
)brace
multiline_comment|/**&n; * emu10k1_voice_alloc_buffer -&n; *&n; * allocates the memory buffer for a voice. Two page tables are kept for each buffer.&n; * One (dma_handle) keeps track of the host memory pages used and the other (virtualpagetable)&n; * is passed to the device so that it can do DMA to host memory.&n; *&n; */
DECL|function|emu10k1_voice_alloc_buffer
r_int
id|emu10k1_voice_alloc_buffer
c_func
(paren
r_struct
id|emu10k1_card
op_star
id|card
comma
r_struct
id|voice_mem
op_star
id|mem
comma
id|u32
id|pages
)paren
(brace
id|u32
id|pageindex
comma
id|pagecount
suffix:semicolon
id|u32
id|busaddx
suffix:semicolon
r_int
id|i
suffix:semicolon
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;requested pages is: %d&bslash;n&quot;
comma
id|pages
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mem-&gt;emupageindex
op_assign
id|emu10k1_addxmgr_alloc
c_func
(paren
id|pages
op_star
id|PAGE_SIZE
comma
id|card
)paren
)paren
OL
l_int|0
)paren
(brace
id|DPF
c_func
(paren
l_int|1
comma
l_string|&quot;couldn&squot;t allocate emu10k1 address space&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Fill in virtual memory table */
r_for
c_loop
(paren
id|pagecount
op_assign
l_int|0
suffix:semicolon
id|pagecount
OL
id|pages
suffix:semicolon
id|pagecount
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|mem-&gt;addr
(braket
id|pagecount
)braket
op_assign
id|pci_alloc_consistent
c_func
(paren
id|card-&gt;pci_dev
comma
id|PAGE_SIZE
comma
op_amp
id|mem-&gt;dma_handle
(braket
id|pagecount
)braket
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|mem-&gt;pages
op_assign
id|pagecount
suffix:semicolon
id|DPF
c_func
(paren
l_int|1
comma
l_string|&quot;couldn&squot;t allocate dma memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot;Virtual Addx: %p&bslash;n&quot;
comma
id|mem-&gt;addr
(braket
id|pagecount
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|PAGE_SIZE
op_div
id|EMUPAGESIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|busaddx
op_assign
(paren
id|u32
)paren
id|mem-&gt;dma_handle
(braket
id|pagecount
)braket
op_plus
id|i
op_star
id|EMUPAGESIZE
suffix:semicolon
id|DPD
c_func
(paren
l_int|3
comma
l_string|&quot;Bus Addx: %#x&bslash;n&quot;
comma
id|busaddx
)paren
suffix:semicolon
id|pageindex
op_assign
id|mem-&gt;emupageindex
op_plus
id|pagecount
op_star
id|PAGE_SIZE
op_div
id|EMUPAGESIZE
op_plus
id|i
suffix:semicolon
(paren
(paren
id|u32
op_star
)paren
id|card-&gt;virtualpagetable.addr
)paren
(braket
id|pageindex
)braket
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|busaddx
op_star
l_int|2
)paren
op_or
id|pageindex
)paren
suffix:semicolon
)brace
)brace
id|mem-&gt;pages
op_assign
id|pagecount
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * emu10k1_voice_free_buffer -&n; *&n; * frees the memory buffer for a voice.&n; */
DECL|function|emu10k1_voice_free_buffer
r_void
id|emu10k1_voice_free_buffer
c_func
(paren
r_struct
id|emu10k1_card
op_star
id|card
comma
r_struct
id|voice_mem
op_star
id|mem
)paren
(brace
id|u32
id|pagecount
comma
id|pageindex
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|mem-&gt;emupageindex
OL
l_int|0
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|pagecount
op_assign
l_int|0
suffix:semicolon
id|pagecount
OL
id|mem-&gt;pages
suffix:semicolon
id|pagecount
op_increment
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|card-&gt;pci_dev
comma
id|PAGE_SIZE
comma
id|mem-&gt;addr
(braket
id|pagecount
)braket
comma
id|mem-&gt;dma_handle
(braket
id|pagecount
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|PAGE_SIZE
op_div
id|EMUPAGESIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pageindex
op_assign
id|mem-&gt;emupageindex
op_plus
id|pagecount
op_star
id|PAGE_SIZE
op_div
id|EMUPAGESIZE
op_plus
id|i
suffix:semicolon
(paren
(paren
id|u32
op_star
)paren
id|card-&gt;virtualpagetable.addr
)paren
(braket
id|pageindex
)braket
op_assign
id|cpu_to_le32
c_func
(paren
(paren
(paren
id|u32
)paren
id|card-&gt;silentpage.dma_handle
op_star
l_int|2
)paren
op_or
id|pageindex
)paren
suffix:semicolon
)brace
)brace
id|emu10k1_addxmgr_free
c_func
(paren
id|card
comma
id|mem-&gt;emupageindex
)paren
suffix:semicolon
id|mem-&gt;emupageindex
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|emu10k1_voice_alloc
r_int
id|emu10k1_voice_alloc
c_func
(paren
r_struct
id|emu10k1_card
op_star
id|card
comma
r_struct
id|emu_voice
op_star
id|voice
)paren
(brace
id|u8
op_star
id|voicetable
op_assign
id|card-&gt;voicetable
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;emu10k1_voice_alloc()&bslash;n&quot;
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;flags
op_amp
id|VOICE_FLAGS_STEREO
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_G
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
r_if
c_cond
(paren
(paren
id|voicetable
(braket
id|i
)braket
op_eq
id|VOICE_USAGE_FREE
)paren
op_logical_and
(paren
id|voicetable
(braket
id|i
op_plus
l_int|1
)braket
op_eq
id|VOICE_USAGE_FREE
)paren
)paren
(brace
id|voicetable
(braket
id|i
)braket
op_assign
id|voice-&gt;usage
suffix:semicolon
id|voicetable
(braket
id|i
op_plus
l_int|1
)braket
op_assign
id|voice-&gt;usage
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_G
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|voicetable
(braket
id|i
)braket
op_eq
id|VOICE_USAGE_FREE
)paren
(brace
id|voicetable
(braket
id|i
)braket
op_assign
id|voice-&gt;usage
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|NUM_G
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|voice-&gt;card
op_assign
id|card
suffix:semicolon
id|voice-&gt;num
op_assign
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|voice-&gt;flags
op_amp
id|VOICE_FLAGS_STEREO
ques
c_cond
l_int|2
suffix:colon
l_int|1
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot; voice allocated -&gt; %d&bslash;n&quot;
comma
id|voice-&gt;num
op_plus
id|i
)paren
suffix:semicolon
id|sblive_writeptr_tag
c_func
(paren
id|card
comma
id|voice-&gt;num
op_plus
id|i
comma
id|IFATN
comma
l_int|0xffff
comma
id|DCYSUSV
comma
l_int|0
comma
id|VTFT
comma
l_int|0x0000ffff
comma
id|PTRX
comma
l_int|0
comma
id|TAGLIST_END
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu10k1_voice_free
r_void
id|emu10k1_voice_free
c_func
(paren
r_struct
id|emu_voice
op_star
id|voice
)paren
(brace
r_struct
id|emu10k1_card
op_star
id|card
op_assign
id|voice-&gt;card
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;emu10k1_voice_free()&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;usage
op_eq
id|VOICE_USAGE_FREE
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|voice-&gt;flags
op_amp
id|VOICE_FLAGS_STEREO
ques
c_cond
l_int|2
suffix:colon
l_int|1
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|DPD
c_func
(paren
l_int|2
comma
l_string|&quot; voice released -&gt; %d&bslash;n&quot;
comma
id|voice-&gt;num
op_plus
id|i
)paren
suffix:semicolon
id|sblive_writeptr_tag
c_func
(paren
id|card
comma
id|voice-&gt;num
op_plus
id|i
comma
id|DCYSUSV
comma
l_int|0
comma
id|VTFT
comma
l_int|0x0000ffff
comma
id|PTRX_PITCHTARGET
comma
l_int|0
comma
id|CVCF
comma
l_int|0x0000ffff
comma
singleline_comment|//CPF, 0,
id|TAGLIST_END
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CPF
comma
id|voice-&gt;num
op_plus
id|i
comma
l_int|0
)paren
suffix:semicolon
)brace
id|voice-&gt;usage
op_assign
id|VOICE_USAGE_FREE
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|card-&gt;voicetable
(braket
id|voice-&gt;num
)braket
op_assign
id|VOICE_USAGE_FREE
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;flags
op_amp
id|VOICE_FLAGS_STEREO
)paren
id|card-&gt;voicetable
(braket
id|voice-&gt;num
op_plus
l_int|1
)braket
op_assign
id|VOICE_USAGE_FREE
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|emu10k1_voice_playback_setup
r_void
id|emu10k1_voice_playback_setup
c_func
(paren
r_struct
id|emu_voice
op_star
id|voice
)paren
(brace
r_struct
id|emu10k1_card
op_star
id|card
op_assign
id|voice-&gt;card
suffix:semicolon
id|u32
id|start
suffix:semicolon
r_int
id|i
suffix:semicolon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;emu10k1_voice_playback_setup()&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;flags
op_amp
id|VOICE_FLAGS_STEREO
)paren
(brace
multiline_comment|/* Set stereo bit */
id|start
op_assign
l_int|28
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CPF
comma
id|voice-&gt;num
comma
id|CPF_STEREO_MASK
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CPF
comma
id|voice-&gt;num
op_plus
l_int|1
comma
id|CPF_STEREO_MASK
)paren
suffix:semicolon
)brace
r_else
(brace
id|start
op_assign
l_int|30
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CPF
comma
id|voice-&gt;num
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|voice-&gt;flags
op_amp
id|VOICE_FLAGS_16BIT
)paren
)paren
(brace
id|start
op_mul_assign
l_int|2
suffix:semicolon
)brace
id|voice-&gt;start
op_add_assign
id|start
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|voice-&gt;flags
op_amp
id|VOICE_FLAGS_STEREO
ques
c_cond
l_int|2
suffix:colon
l_int|1
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;is_audigy
)paren
(brace
id|sblive_writeptr
c_func
(paren
id|card
comma
id|A_FXRT1
comma
id|voice-&gt;num
op_plus
id|i
comma
id|voice-&gt;params
(braket
id|i
)braket
dot
id|send_routing
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|A_FXRT2
comma
id|voice-&gt;num
op_plus
id|i
comma
id|voice-&gt;params
(braket
id|i
)braket
dot
id|send_routing2
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|A_SENDAMOUNTS
comma
id|voice-&gt;num
op_plus
id|i
comma
id|voice-&gt;params
(braket
id|i
)braket
dot
id|send_hgfe
)paren
suffix:semicolon
)brace
r_else
(brace
id|sblive_writeptr
c_func
(paren
id|card
comma
id|FXRT
comma
id|voice-&gt;num
op_plus
id|i
comma
id|voice-&gt;params
(braket
id|i
)braket
dot
id|send_routing
op_lshift
l_int|16
)paren
suffix:semicolon
)brace
multiline_comment|/* Stop CA */
multiline_comment|/* Assumption that PT is already 0 so no harm overwriting */
id|sblive_writeptr
c_func
(paren
id|card
comma
id|PTRX
comma
id|voice-&gt;num
op_plus
id|i
comma
(paren
(paren
id|voice-&gt;params
(braket
id|i
)braket
dot
id|send_dcba
op_amp
l_int|0xff
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|voice-&gt;params
(braket
id|i
)braket
dot
id|send_dcba
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|sblive_writeptr_tag
c_func
(paren
id|card
comma
id|voice-&gt;num
op_plus
id|i
comma
multiline_comment|/* CSL, ST, CA */
id|DSL
comma
id|voice-&gt;endloop
op_or
(paren
id|voice-&gt;params
(braket
id|i
)braket
dot
id|send_dcba
op_amp
l_int|0xff000000
)paren
comma
id|PSST
comma
id|voice-&gt;startloop
op_or
(paren
(paren
id|voice-&gt;params
(braket
id|i
)braket
dot
id|send_dcba
op_amp
l_int|0x00ff0000
)paren
op_lshift
l_int|8
)paren
comma
id|CCCA
comma
(paren
id|voice-&gt;start
)paren
op_or
id|emu10k1_select_interprom
c_func
(paren
id|card
comma
id|voice
)paren
op_or
(paren
(paren
id|voice-&gt;flags
op_amp
id|VOICE_FLAGS_16BIT
)paren
ques
c_cond
l_int|0
suffix:colon
id|CCCA_8BITSELECT
)paren
comma
multiline_comment|/* Clear filter delay memory */
id|Z1
comma
l_int|0
comma
id|Z2
comma
l_int|0
comma
multiline_comment|/* Invalidate maps */
id|MAPA
comma
id|MAP_PTI_MASK
op_or
(paren
(paren
id|u32
)paren
id|card-&gt;silentpage.dma_handle
op_star
l_int|2
)paren
comma
id|MAPB
comma
id|MAP_PTI_MASK
op_or
(paren
(paren
id|u32
)paren
id|card-&gt;silentpage.dma_handle
op_star
l_int|2
)paren
comma
multiline_comment|/* modulation envelope */
id|CVCF
comma
l_int|0x0000ffff
comma
id|VTFT
comma
l_int|0x0000ffff
comma
id|ATKHLDM
comma
l_int|0
comma
id|DCYSUSM
comma
l_int|0x007f
comma
id|LFOVAL1
comma
l_int|0x8000
comma
id|LFOVAL2
comma
l_int|0x8000
comma
id|FMMOD
comma
l_int|0
comma
id|TREMFRQ
comma
l_int|0
comma
id|FM2FRQ2
comma
l_int|0
comma
id|ENVVAL
comma
l_int|0x8000
comma
multiline_comment|/* volume envelope */
id|ATKHLDV
comma
l_int|0x7f7f
comma
id|ENVVOL
comma
l_int|0x8000
comma
multiline_comment|/* filter envelope */
id|PEFE_FILTERAMOUNT
comma
l_int|0x7f
comma
multiline_comment|/* pitch envelope */
id|PEFE_PITCHAMOUNT
comma
l_int|0
comma
id|TAGLIST_END
)paren
suffix:semicolon
id|voice-&gt;params
(braket
id|i
)braket
dot
id|fc_target
op_assign
l_int|0xffff
suffix:semicolon
)brace
)brace
DECL|function|emu10k1_voices_start
r_void
id|emu10k1_voices_start
c_func
(paren
r_struct
id|emu_voice
op_star
id|first_voice
comma
r_int
r_int
id|num_voices
comma
r_int
id|set
)paren
(brace
r_struct
id|emu10k1_card
op_star
id|card
op_assign
id|first_voice-&gt;card
suffix:semicolon
r_struct
id|emu_voice
op_star
id|voice
suffix:semicolon
r_int
r_int
id|voicenum
suffix:semicolon
r_int
id|j
suffix:semicolon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;emu10k1_voices_start()&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|voicenum
op_assign
l_int|0
suffix:semicolon
id|voicenum
OL
id|num_voices
suffix:semicolon
id|voicenum
op_increment
)paren
(brace
id|voice
op_assign
id|first_voice
op_plus
id|voicenum
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|set
)paren
(brace
id|u32
id|cra
comma
id|ccis
comma
id|cs
comma
id|sample
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;flags
op_amp
id|VOICE_FLAGS_STEREO
)paren
(brace
id|cra
op_assign
l_int|64
suffix:semicolon
id|ccis
op_assign
l_int|28
suffix:semicolon
id|cs
op_assign
l_int|4
suffix:semicolon
)brace
r_else
(brace
id|cra
op_assign
l_int|64
suffix:semicolon
id|ccis
op_assign
l_int|30
suffix:semicolon
id|cs
op_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|voice-&gt;flags
op_amp
id|VOICE_FLAGS_16BIT
)paren
(brace
id|sample
op_assign
l_int|0x00000000
suffix:semicolon
)brace
r_else
(brace
id|sample
op_assign
l_int|0x80808080
suffix:semicolon
id|ccis
op_mul_assign
l_int|2
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|cs
suffix:semicolon
id|j
op_increment
)paren
(brace
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CD0
op_plus
id|j
comma
id|voice-&gt;num
comma
id|sample
)paren
suffix:semicolon
)brace
multiline_comment|/* Reset cache */
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CCR_CACHEINVALIDSIZE
comma
id|voice-&gt;num
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;flags
op_amp
id|VOICE_FLAGS_STEREO
)paren
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CCR_CACHEINVALIDSIZE
comma
id|voice-&gt;num
op_plus
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CCR_READADDRESS
comma
id|voice-&gt;num
comma
id|cra
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;flags
op_amp
id|VOICE_FLAGS_STEREO
)paren
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CCR_READADDRESS
comma
id|voice-&gt;num
op_plus
l_int|1
comma
id|cra
)paren
suffix:semicolon
multiline_comment|/* Fill cache */
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CCR_CACHEINVALIDSIZE
comma
id|voice-&gt;num
comma
id|ccis
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
(paren
id|voice-&gt;flags
op_amp
id|VOICE_FLAGS_STEREO
ques
c_cond
l_int|2
suffix:colon
l_int|1
)paren
suffix:semicolon
id|j
op_increment
)paren
(brace
id|sblive_writeptr_tag
c_func
(paren
id|card
comma
id|voice-&gt;num
op_plus
id|j
comma
id|IFATN
comma
(paren
id|voice-&gt;params
(braket
id|j
)braket
dot
id|initial_fc
op_lshift
l_int|8
)paren
op_or
id|voice-&gt;params
(braket
id|j
)braket
dot
id|initial_attn
comma
id|VTFT
comma
(paren
id|voice-&gt;params
(braket
id|j
)braket
dot
id|volume_target
op_lshift
l_int|16
)paren
op_or
id|voice-&gt;params
(braket
id|j
)braket
dot
id|fc_target
comma
id|CVCF
comma
(paren
id|voice-&gt;params
(braket
id|j
)braket
dot
id|volume_target
op_lshift
l_int|16
)paren
op_or
id|voice-&gt;params
(braket
id|j
)braket
dot
id|fc_target
comma
id|DCYSUSV
comma
(paren
id|voice-&gt;params
(braket
id|j
)braket
dot
id|byampl_env_sustain
op_lshift
l_int|8
)paren
op_or
id|voice-&gt;params
(braket
id|j
)braket
dot
id|byampl_env_decay
comma
id|TAGLIST_END
)paren
suffix:semicolon
id|emu10k1_clear_stop_on_loop
c_func
(paren
id|card
comma
id|voice-&gt;num
op_plus
id|j
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|voicenum
op_assign
l_int|0
suffix:semicolon
id|voicenum
OL
id|num_voices
suffix:semicolon
id|voicenum
op_increment
)paren
(brace
id|voice
op_assign
id|first_voice
op_plus
id|voicenum
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
(paren
id|voice-&gt;flags
op_amp
id|VOICE_FLAGS_STEREO
ques
c_cond
l_int|2
suffix:colon
l_int|1
)paren
suffix:semicolon
id|j
op_increment
)paren
(brace
id|sblive_writeptr
c_func
(paren
id|card
comma
id|PTRX_PITCHTARGET
comma
id|voice-&gt;num
op_plus
id|j
comma
id|voice-&gt;pitch_target
)paren
suffix:semicolon
r_if
c_cond
(paren
id|j
op_eq
l_int|0
)paren
id|sblive_writeptr
c_func
(paren
id|card
comma
id|CPF_CURRENTPITCH
comma
id|voice-&gt;num
comma
id|voice-&gt;pitch_target
)paren
suffix:semicolon
id|sblive_writeptr
c_func
(paren
id|card
comma
id|IP
comma
id|voice-&gt;num
op_plus
id|j
comma
id|voice-&gt;initial_pitch
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|emu10k1_voices_stop
r_void
id|emu10k1_voices_stop
c_func
(paren
r_struct
id|emu_voice
op_star
id|first_voice
comma
r_int
id|num_voices
)paren
(brace
r_struct
id|emu10k1_card
op_star
id|card
op_assign
id|first_voice-&gt;card
suffix:semicolon
r_struct
id|emu_voice
op_star
id|voice
suffix:semicolon
r_int
r_int
id|voice_num
suffix:semicolon
r_int
id|j
suffix:semicolon
id|DPF
c_func
(paren
l_int|2
comma
l_string|&quot;emu10k1_voice_stop()&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|voice_num
op_assign
l_int|0
suffix:semicolon
id|voice_num
OL
id|num_voices
suffix:semicolon
id|voice_num
op_increment
)paren
(brace
id|voice
op_assign
id|first_voice
op_plus
id|voice_num
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
(paren
id|voice-&gt;flags
op_amp
id|VOICE_FLAGS_STEREO
ques
c_cond
l_int|2
suffix:colon
l_int|1
)paren
suffix:semicolon
id|j
op_increment
)paren
(brace
id|sblive_writeptr_tag
c_func
(paren
id|card
comma
id|voice-&gt;num
op_plus
id|j
comma
id|PTRX_PITCHTARGET
comma
l_int|0
comma
id|CPF_CURRENTPITCH
comma
l_int|0
comma
id|IFATN
comma
l_int|0xffff
comma
id|VTFT
comma
l_int|0x0000ffff
comma
id|CVCF
comma
l_int|0x0000ffff
comma
id|IP
comma
l_int|0
comma
id|TAGLIST_END
)paren
suffix:semicolon
)brace
)brace
)brace
eof
