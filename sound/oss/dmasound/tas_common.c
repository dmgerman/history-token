macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/sysctl.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/i2c.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/soundcard.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/errno.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/prom.h&gt;
macro_line|#include &quot;tas_common.h&quot;
DECL|macro|CALL0
mdefine_line|#define CALL0(proc)&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;do {&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;struct tas_data_t *self;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;if (!tas_client || driver_hooks == NULL)&t;&t;&t;&bslash;&n;&t;&t;&t;return -1;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;self = dev_get_drvdata(&amp;tas_client-&gt;dev);&t;&t;&t;&bslash;&n;&t;&t;if (driver_hooks-&gt;proc)&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;return driver_hooks-&gt;proc(self);&t;&t;&t;&bslash;&n;&t;&t;else&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;return -EINVAL;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;} while (0)
DECL|macro|CALL
mdefine_line|#define CALL(proc,arg...)&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;do {&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;struct tas_data_t *self;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;if (!tas_client || driver_hooks == NULL)&t;&t;&t;&bslash;&n;&t;&t;&t;return -1;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;self = dev_get_drvdata(&amp;tas_client-&gt;dev);&t;&t;&t;&bslash;&n;&t;&t;if (driver_hooks-&gt;proc)&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;return driver_hooks-&gt;proc(self, ## arg);&t;&t;&bslash;&n;&t;&t;else&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;return -EINVAL;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;} while (0)
DECL|variable|tas_i2c_address
r_static
id|u8
id|tas_i2c_address
op_assign
l_int|0x34
suffix:semicolon
DECL|variable|tas_client
r_static
r_struct
id|i2c_client
op_star
id|tas_client
suffix:semicolon
DECL|variable|tas_node
r_static
r_struct
id|device_node
op_star
id|tas_node
suffix:semicolon
r_static
r_int
id|tas_attach_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
)paren
suffix:semicolon
r_static
r_int
id|tas_detach_client
c_func
(paren
r_struct
id|i2c_client
op_star
)paren
suffix:semicolon
DECL|variable|tas_driver
r_struct
id|i2c_driver
id|tas_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;tas&quot;
comma
dot
id|flags
op_assign
id|I2C_DF_NOTIFY
comma
dot
id|attach_adapter
op_assign
id|tas_attach_adapter
comma
dot
id|detach_client
op_assign
id|tas_detach_client
comma
)brace
suffix:semicolon
DECL|variable|driver_hooks
r_struct
id|tas_driver_hooks_t
op_star
id|driver_hooks
suffix:semicolon
r_int
DECL|function|tas_register_driver
id|tas_register_driver
c_func
(paren
r_struct
id|tas_driver_hooks_t
op_star
id|hooks
)paren
(brace
id|driver_hooks
op_assign
id|hooks
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|tas_get_mixer_level
id|tas_get_mixer_level
c_func
(paren
r_int
id|mixer
comma
id|uint
op_star
id|level
)paren
(brace
id|CALL
c_func
(paren
id|get_mixer_level
comma
id|mixer
comma
id|level
)paren
suffix:semicolon
)brace
r_int
DECL|function|tas_set_mixer_level
id|tas_set_mixer_level
c_func
(paren
r_int
id|mixer
comma
id|uint
id|level
)paren
(brace
id|CALL
c_func
(paren
id|set_mixer_level
comma
id|mixer
comma
id|level
)paren
suffix:semicolon
)brace
r_int
DECL|function|tas_enter_sleep
id|tas_enter_sleep
c_func
(paren
r_void
)paren
(brace
id|CALL0
c_func
(paren
id|enter_sleep
)paren
suffix:semicolon
)brace
r_int
DECL|function|tas_leave_sleep
id|tas_leave_sleep
c_func
(paren
r_void
)paren
(brace
id|CALL0
c_func
(paren
id|leave_sleep
)paren
suffix:semicolon
)brace
r_int
DECL|function|tas_supported_mixers
id|tas_supported_mixers
c_func
(paren
r_void
)paren
(brace
id|CALL0
c_func
(paren
id|supported_mixers
)paren
suffix:semicolon
)brace
r_int
DECL|function|tas_mixer_is_stereo
id|tas_mixer_is_stereo
c_func
(paren
r_int
id|mixer
)paren
(brace
id|CALL
c_func
(paren
id|mixer_is_stereo
comma
id|mixer
)paren
suffix:semicolon
)brace
r_int
DECL|function|tas_stereo_mixers
id|tas_stereo_mixers
c_func
(paren
r_void
)paren
(brace
id|CALL0
c_func
(paren
id|stereo_mixers
)paren
suffix:semicolon
)brace
r_int
DECL|function|tas_output_device_change
id|tas_output_device_change
c_func
(paren
r_int
id|device_id
comma
r_int
id|layout_id
comma
r_int
id|speaker_id
)paren
(brace
id|CALL
c_func
(paren
id|output_device_change
comma
id|device_id
comma
id|layout_id
comma
id|speaker_id
)paren
suffix:semicolon
)brace
r_int
DECL|function|tas_device_ioctl
id|tas_device_ioctl
c_func
(paren
id|u_int
id|cmd
comma
id|u_long
id|arg
)paren
(brace
id|CALL
c_func
(paren
id|device_ioctl
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
r_int
DECL|function|tas_post_init
id|tas_post_init
c_func
(paren
r_void
)paren
(brace
id|CALL0
c_func
(paren
id|post_init
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|tas_detect_client
id|tas_detect_client
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
comma
r_int
id|address
)paren
(brace
r_static
r_const
r_char
op_star
id|client_name
op_assign
l_string|&quot;tas Digital Equalizer&quot;
suffix:semicolon
r_struct
id|i2c_client
op_star
id|new_client
suffix:semicolon
r_int
id|rc
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|driver_hooks
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;tas_detect_client called with no hooks !&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|new_client
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|new_client
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|new_client
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
id|new_client
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|new_client
)paren
)paren
suffix:semicolon
id|new_client-&gt;addr
op_assign
id|address
suffix:semicolon
id|new_client-&gt;adapter
op_assign
id|adapter
suffix:semicolon
id|new_client-&gt;driver
op_assign
op_amp
id|tas_driver
suffix:semicolon
id|strlcpy
c_func
(paren
id|new_client-&gt;name
comma
id|client_name
comma
id|DEVICE_NAME_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|driver_hooks
op_member_access_from_pointer
id|init
c_func
(paren
id|new_client
)paren
)paren
r_goto
id|bail
suffix:semicolon
multiline_comment|/* Tell the i2c layer a new client has arrived */
r_if
c_cond
(paren
id|i2c_attach_client
c_func
(paren
id|new_client
)paren
)paren
(brace
id|driver_hooks
op_member_access_from_pointer
id|uninit
c_func
(paren
id|dev_get_drvdata
c_func
(paren
op_amp
id|new_client-&gt;dev
)paren
)paren
suffix:semicolon
r_goto
id|bail
suffix:semicolon
)brace
id|tas_client
op_assign
id|new_client
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|bail
suffix:colon
id|tas_client
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|new_client
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
r_static
r_int
DECL|function|tas_attach_adapter
id|tas_attach_adapter
c_func
(paren
r_struct
id|i2c_adapter
op_star
id|adapter
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|adapter-&gt;name
comma
l_string|&quot;mac-io&quot;
comma
l_int|6
)paren
)paren
r_return
id|tas_detect_client
c_func
(paren
id|adapter
comma
id|tas_i2c_address
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|tas_detach_client
id|tas_detach_client
c_func
(paren
r_struct
id|i2c_client
op_star
id|client
)paren
(brace
r_if
c_cond
(paren
id|client
op_eq
id|tas_client
)paren
(brace
id|driver_hooks
op_member_access_from_pointer
id|uninit
c_func
(paren
id|dev_get_drvdata
c_func
(paren
op_amp
id|client-&gt;dev
)paren
)paren
suffix:semicolon
id|i2c_detach_client
c_func
(paren
id|client
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|client
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|tas_cleanup
id|tas_cleanup
c_func
(paren
r_void
)paren
(brace
id|i2c_del_driver
c_func
(paren
op_amp
id|tas_driver
)paren
suffix:semicolon
)brace
r_int
id|__init
DECL|function|tas_init
id|tas_init
c_func
(paren
r_int
id|driver_id
comma
r_const
r_char
op_star
id|driver_name
)paren
(brace
id|u32
op_star
id|paddr
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;tas driver [%s])&bslash;n&quot;
comma
id|driver_name
)paren
suffix:semicolon
id|tas_node
op_assign
id|find_devices
c_func
(paren
l_string|&quot;deq&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tas_node
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|paddr
op_assign
(paren
id|u32
op_star
)paren
id|get_property
c_func
(paren
id|tas_node
comma
l_string|&quot;i2c-address&quot;
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|paddr
)paren
(brace
id|tas_i2c_address
op_assign
(paren
op_star
id|paddr
)paren
op_rshift
l_int|1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;using i2c address: 0x%x from device-tree&bslash;n&quot;
comma
id|tas_i2c_address
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;using i2c address: 0x%x (default)&bslash;n&quot;
comma
id|tas_i2c_address
)paren
suffix:semicolon
r_return
id|i2c_add_driver
c_func
(paren
op_amp
id|tas_driver
)paren
suffix:semicolon
)brace
eof
