multiline_comment|/*&n; *      cmpci.c  --  C-Media PCI audio driver.&n; *&n; *      Copyright (C) 1999  C-media support (support@cmedia.com.tw)&n; *&n; *      Based on the PCI drivers by Thomas Sailer (sailer@ife.ee.ethz.ch)&n; *&n; * &t;For update, visit:&n; * &t;&t;http://www.cmedia.com.tw&n; *&n; *      This program is free software; you can redistribute it and/or modify&n; *      it under the terms of the GNU General Public License as published by&n; *      the Free Software Foundation; either version 2 of the License, or&n; *      (at your option) any later version.&n; *&n; *      This program is distributed in the hope that it will be useful,&n; *      but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *      GNU General Public License for more details.&n; *&n; *      You should have received a copy of the GNU General Public License&n; *      along with this program; if not, write to the Free Software&n; *      Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; * Special thanks to David C. Niemi, Jan Pfeifer&n; *&n; *&n; * Module command line parameters:&n; *   none so far&n; *&n; *&n; *  Supported devices:&n; *  /dev/dsp    standard /dev/dsp device, (mostly) OSS compatible&n; *  /dev/mixer  standard /dev/mixer device, (mostly) OSS compatible&n; *  /dev/midi   simple MIDI UART interface, no ioctl&n; *&n; *  The card has both an FM and a Wavetable synth, but I have to figure&n; *  out first how to drive them...&n; *&n; *  Revision history&n; *    06.05.98   0.1   Initial release&n; *    10.05.98   0.2   Fixed many bugs, esp. ADC rate calculation&n; *                     First stab at a simple midi interface (no bells&amp;whistles)&n; *    13.05.98   0.3   Fix stupid cut&amp;paste error: set_adc_rate was called instead of&n; *                     set_dac_rate in the FMODE_WRITE case in cm_open&n; *                     Fix hwptr out of bounds (now mpg123 works)&n; *    14.05.98   0.4   Don&squot;t allow excessive interrupt rates&n; *    08.06.98   0.5   First release using Alan Cox&squot; soundcore instead of miscdevice&n; *    03.08.98   0.6   Do not include modversions.h&n; *                     Now mixer behaviour can basically be selected between&n; *                     &quot;OSS documented&quot; and &quot;OSS actual&quot; behaviour&n; *    31.08.98   0.7   Fix realplayer problems - dac.count issues&n; *    10.12.98   0.8   Fix drain_dac trying to wait on not yet initialized DMA&n; *    16.12.98   0.9   Fix a few f_file &amp; FMODE_ bugs&n; *    06.01.99   0.10  remove the silly SA_INTERRUPT flag.&n; *                     hopefully killed the egcs section type conflict&n; *    12.03.99   0.11  cinfo.blocks should be reset after GETxPTR ioctl.&n; *                     reported by Johan Maes &lt;joma@telindus.be&gt;&n; *    22.03.99   0.12  return EAGAIN instead of EBUSY when O_NONBLOCK&n; *                     read/write cannot be executed&n; *    18.08.99   1.5   Only deallocate DMA buffer when unloading.&n; *    02.09.99   1.6   Enable SPDIF LOOP&n; *                     Change the mixer read back&n; *    21.09.99   2.33  Use RCS version as driver version.&n; *                     Add support for modem, S/PDIF loop and 4 channels.&n; *                     (8738 only)&n; *                     Fix bug cause x11amp cannot play.&n; *&n; *    Fixes:&n; *    Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt;&n; *    18/05/2001 - .bss nitpicks, fix a bug in set_dac_channels where it&n; *    &t;&t;   was calling prog_dmabuf with s-&gt;lock held, call missing&n; *    &t;&t;   unlock_kernel in cm_midi_release&n; *    08/10/2001 - use set_current_state in some more places&n; *&n; *&t;Carlos Eduardo Gorges &lt;carlos@techlinux.com.br&gt;&n; *&t;Fri May 25 2001&n; *&t;- SMP support ( spin[un]lock* revision )&n; *&t;- speaker mixer support&n; *&t;Mon Aug 13 2001&n; *&t;- optimizations and cleanups&n; *&n; *    03/01/2003 - open_mode fixes from Georg Acher &lt;acher@in.tum.de&gt;&n; *&t;Simon Braunschmidt &lt;brasimon@web.de&gt;&n; *     Sat Jan 31 2004&n; *&t;- provide support for opl3 FM by releasing IO range after initialization&n; *&n; *    ChenLi Tien &lt;cltien@cmedia.com.tw&gt;&n; *    Mar 9 2004&n; *&t;- Fix S/PDIF out if spdif_loop enabled&n; *&t;- Load opl3 driver if enabled (fmio in proper range)&n; *&t;- Load mpu401 if enabled (mpuio in proper range)&n; *    Apr 5 2004&n; *&t;- Fix DUAL_DAC dma synchronization bug&n; *&t;- Check exist FM/MPU401 I/O before activate.&n; *&t;- Add AFTM_S16_BE format support, so MPlayer/Xine can play AC3/mutlichannel&n; *&t;  on Mac&n; *&t;- Change to support kernel 2.6 so only small patch needed&n; *&t;- All parameters default to 0&n; *&t;- Add spdif_out to send PCM through S/PDIF out jack&n; *&t;- Add hw_copy to get 4-spaker output for general PCM/analog output&n; *&n; *    Stefan Thater &lt;stefan.thaeter@gmx.de&gt;&n; *    Apr 5 2004&n; *&t;- Fix mute single channel for CD/Line-in/AUX-in&n; */
multiline_comment|/*****************************************************************************/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/sound.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/soundcard.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;linux/wait.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#ifdef CONFIG_SOUND_CMPCI_MIDI
macro_line|#include &quot;sound_config.h&quot;
macro_line|#include &quot;mpu401.h&quot;
macro_line|#endif
macro_line|#ifdef CONFIG_SOUND_CMPCI_FM
macro_line|#include &quot;opl3.h&quot;
macro_line|#endif
macro_line|#ifdef CONFIG_SOUND_CMPCI_JOYSTICK
macro_line|#include &lt;linux/gameport.h&gt;
macro_line|#endif
multiline_comment|/* --------------------------------------------------------------------- */
DECL|macro|OSS_DOCUMENTED_MIXER_SEMANTICS
macro_line|#undef OSS_DOCUMENTED_MIXER_SEMANTICS
DECL|macro|DMABYTEIO
macro_line|#undef DMABYTEIO
DECL|macro|DBG
mdefine_line|#define&t;DBG(x) {}
multiline_comment|/* --------------------------------------------------------------------- */
DECL|macro|CM_MAGIC
mdefine_line|#define CM_MAGIC  ((PCI_VENDOR_ID_CMEDIA&lt;&lt;16)|PCI_DEVICE_ID_CMEDIA_CM8338A)
multiline_comment|/* CM8338 registers definition ****************/
DECL|macro|CODEC_CMI_FUNCTRL0
mdefine_line|#define CODEC_CMI_FUNCTRL0&t;&t;(0x00)
DECL|macro|CODEC_CMI_FUNCTRL1
mdefine_line|#define CODEC_CMI_FUNCTRL1&t;&t;(0x04)
DECL|macro|CODEC_CMI_CHFORMAT
mdefine_line|#define CODEC_CMI_CHFORMAT&t;&t;(0x08)
DECL|macro|CODEC_CMI_INT_HLDCLR
mdefine_line|#define CODEC_CMI_INT_HLDCLR&t;&t;(0x0C)
DECL|macro|CODEC_CMI_INT_STATUS
mdefine_line|#define CODEC_CMI_INT_STATUS&t;&t;(0x10)
DECL|macro|CODEC_CMI_LEGACY_CTRL
mdefine_line|#define CODEC_CMI_LEGACY_CTRL&t;&t;(0x14)
DECL|macro|CODEC_CMI_MISC_CTRL
mdefine_line|#define CODEC_CMI_MISC_CTRL&t;&t;(0x18)
DECL|macro|CODEC_CMI_TDMA_POS
mdefine_line|#define CODEC_CMI_TDMA_POS&t;&t;(0x1C)
DECL|macro|CODEC_CMI_MIXER
mdefine_line|#define CODEC_CMI_MIXER&t;&t;&t;(0x20)
DECL|macro|CODEC_SB16_DATA
mdefine_line|#define CODEC_SB16_DATA&t;&t;&t;(0x22)
DECL|macro|CODEC_SB16_ADDR
mdefine_line|#define CODEC_SB16_ADDR&t;&t;&t;(0x23)
DECL|macro|CODEC_CMI_MIXER1
mdefine_line|#define CODEC_CMI_MIXER1&t;&t;(0x24)
DECL|macro|CODEC_CMI_MIXER2
mdefine_line|#define CODEC_CMI_MIXER2&t;&t;(0x25)
DECL|macro|CODEC_CMI_AUX_VOL
mdefine_line|#define CODEC_CMI_AUX_VOL&t;&t;(0x26)
DECL|macro|CODEC_CMI_MISC
mdefine_line|#define CODEC_CMI_MISC&t;&t;&t;(0x27)
DECL|macro|CODEC_CMI_AC97
mdefine_line|#define CODEC_CMI_AC97&t;&t;&t;(0x28)
DECL|macro|CODEC_CMI_CH0_FRAME1
mdefine_line|#define CODEC_CMI_CH0_FRAME1&t;&t;(0x80)
DECL|macro|CODEC_CMI_CH0_FRAME2
mdefine_line|#define CODEC_CMI_CH0_FRAME2&t;&t;(0x84)
DECL|macro|CODEC_CMI_CH1_FRAME1
mdefine_line|#define CODEC_CMI_CH1_FRAME1&t;&t;(0x88)
DECL|macro|CODEC_CMI_CH1_FRAME2
mdefine_line|#define CODEC_CMI_CH1_FRAME2&t;&t;(0x8C)
DECL|macro|CODEC_CMI_SPDIF_CTRL
mdefine_line|#define CODEC_CMI_SPDIF_CTRL&t;&t;(0x90)
DECL|macro|CODEC_CMI_MISC_CTRL2
mdefine_line|#define CODEC_CMI_MISC_CTRL2&t;&t;(0x92)
DECL|macro|CODEC_CMI_EXT_REG
mdefine_line|#define CODEC_CMI_EXT_REG&t;&t;(0xF0)
multiline_comment|/*  Mixer registers for SB16 ******************/
DECL|macro|DSP_MIX_DATARESETIDX
mdefine_line|#define DSP_MIX_DATARESETIDX&t;&t;((unsigned char)(0x00))
DECL|macro|DSP_MIX_MASTERVOLIDX_L
mdefine_line|#define DSP_MIX_MASTERVOLIDX_L&t;&t;((unsigned char)(0x30))
DECL|macro|DSP_MIX_MASTERVOLIDX_R
mdefine_line|#define DSP_MIX_MASTERVOLIDX_R&t;&t;((unsigned char)(0x31))
DECL|macro|DSP_MIX_VOICEVOLIDX_L
mdefine_line|#define DSP_MIX_VOICEVOLIDX_L&t;&t;((unsigned char)(0x32))
DECL|macro|DSP_MIX_VOICEVOLIDX_R
mdefine_line|#define DSP_MIX_VOICEVOLIDX_R&t;&t;((unsigned char)(0x33))
DECL|macro|DSP_MIX_FMVOLIDX_L
mdefine_line|#define DSP_MIX_FMVOLIDX_L&t;&t;((unsigned char)(0x34))
DECL|macro|DSP_MIX_FMVOLIDX_R
mdefine_line|#define DSP_MIX_FMVOLIDX_R&t;&t;((unsigned char)(0x35))
DECL|macro|DSP_MIX_CDVOLIDX_L
mdefine_line|#define DSP_MIX_CDVOLIDX_L&t;&t;((unsigned char)(0x36))
DECL|macro|DSP_MIX_CDVOLIDX_R
mdefine_line|#define DSP_MIX_CDVOLIDX_R&t;&t;((unsigned char)(0x37))
DECL|macro|DSP_MIX_LINEVOLIDX_L
mdefine_line|#define DSP_MIX_LINEVOLIDX_L&t;&t;((unsigned char)(0x38))
DECL|macro|DSP_MIX_LINEVOLIDX_R
mdefine_line|#define DSP_MIX_LINEVOLIDX_R&t;&t;((unsigned char)(0x39))
DECL|macro|DSP_MIX_MICVOLIDX
mdefine_line|#define DSP_MIX_MICVOLIDX&t;&t;((unsigned char)(0x3A))
DECL|macro|DSP_MIX_SPKRVOLIDX
mdefine_line|#define DSP_MIX_SPKRVOLIDX&t;&t;((unsigned char)(0x3B))
DECL|macro|DSP_MIX_OUTMIXIDX
mdefine_line|#define DSP_MIX_OUTMIXIDX&t;&t;((unsigned char)(0x3C))
DECL|macro|DSP_MIX_ADCMIXIDX_L
mdefine_line|#define DSP_MIX_ADCMIXIDX_L&t;&t;((unsigned char)(0x3D))
DECL|macro|DSP_MIX_ADCMIXIDX_R
mdefine_line|#define DSP_MIX_ADCMIXIDX_R&t;&t;((unsigned char)(0x3E))
DECL|macro|DSP_MIX_INGAINIDX_L
mdefine_line|#define DSP_MIX_INGAINIDX_L&t;&t;((unsigned char)(0x3F))
DECL|macro|DSP_MIX_INGAINIDX_R
mdefine_line|#define DSP_MIX_INGAINIDX_R&t;&t;((unsigned char)(0x40))
DECL|macro|DSP_MIX_OUTGAINIDX_L
mdefine_line|#define DSP_MIX_OUTGAINIDX_L&t;&t;((unsigned char)(0x41))
DECL|macro|DSP_MIX_OUTGAINIDX_R
mdefine_line|#define DSP_MIX_OUTGAINIDX_R&t;&t;((unsigned char)(0x42))
DECL|macro|DSP_MIX_AGCIDX
mdefine_line|#define DSP_MIX_AGCIDX&t;&t;&t;((unsigned char)(0x43))
DECL|macro|DSP_MIX_TREBLEIDX_L
mdefine_line|#define DSP_MIX_TREBLEIDX_L&t;&t;((unsigned char)(0x44))
DECL|macro|DSP_MIX_TREBLEIDX_R
mdefine_line|#define DSP_MIX_TREBLEIDX_R&t;&t;((unsigned char)(0x45))
DECL|macro|DSP_MIX_BASSIDX_L
mdefine_line|#define DSP_MIX_BASSIDX_L&t;&t;((unsigned char)(0x46))
DECL|macro|DSP_MIX_BASSIDX_R
mdefine_line|#define DSP_MIX_BASSIDX_R&t;&t;((unsigned char)(0x47))
DECL|macro|DSP_MIX_EXTENSION
mdefine_line|#define DSP_MIX_EXTENSION&t;&t;((unsigned char)(0xf0))
singleline_comment|// pseudo register for AUX
DECL|macro|DSP_MIX_AUXVOL_L
mdefine_line|#define&t;DSP_MIX_AUXVOL_L&t;&t;((unsigned char)(0x50))
DECL|macro|DSP_MIX_AUXVOL_R
mdefine_line|#define&t;DSP_MIX_AUXVOL_R&t;&t;((unsigned char)(0x51))
singleline_comment|// I/O length
DECL|macro|CM_EXTENT_CODEC
mdefine_line|#define CM_EXTENT_CODEC&t;  0x100
DECL|macro|CM_EXTENT_MIDI
mdefine_line|#define CM_EXTENT_MIDI&t;  0x2
DECL|macro|CM_EXTENT_SYNTH
mdefine_line|#define CM_EXTENT_SYNTH&t;  0x4
DECL|macro|CM_EXTENT_GAME
mdefine_line|#define CM_EXTENT_GAME&t;  0x8
singleline_comment|// Function Control Register 0 (00h)
DECL|macro|CHADC0
mdefine_line|#define CHADC0    &t;0x01
DECL|macro|CHADC1
mdefine_line|#define CHADC1    &t;0x02
DECL|macro|PAUSE0
mdefine_line|#define PAUSE0&t;  &t;0x04
DECL|macro|PAUSE1
mdefine_line|#define PAUSE1&t;  &t;0x08
singleline_comment|// Function Control Register 0+2 (02h)
DECL|macro|CHEN0
mdefine_line|#define CHEN0     &t;0x01
DECL|macro|CHEN1
mdefine_line|#define CHEN1     &t;0x02
DECL|macro|RST_CH0
mdefine_line|#define RST_CH0&t;  &t;0x04
DECL|macro|RST_CH1
mdefine_line|#define RST_CH1&t;  &t;0x08
singleline_comment|// Function Control Register 1 (04h)
DECL|macro|JYSTK_EN
mdefine_line|#define JYSTK_EN&t;0x02
DECL|macro|UART_EN
mdefine_line|#define UART_EN&t;&t;0x04
DECL|macro|SPDO2DAC
mdefine_line|#define&t;SPDO2DAC&t;0x40
DECL|macro|SPDFLOOP
mdefine_line|#define&t;SPDFLOOP&t;0x80
singleline_comment|// Function Control Register 1+1 (05h)
DECL|macro|SPDF_0
mdefine_line|#define&t;SPDF_0&t;&t;0x01
DECL|macro|SPDF_1
mdefine_line|#define&t;SPDF_1&t;&t;0x02
DECL|macro|ASFC
mdefine_line|#define&t;ASFC&t;&t;0x1c
DECL|macro|DSFC
mdefine_line|#define&t;DSFC&t;&t;0xe0
DECL|macro|SPDIF2DAC
mdefine_line|#define&t;SPDIF2DAC&t;(SPDF_1 &lt;&lt; 8 | SPDO2DAC)
singleline_comment|// Channel Format Register (08h)
DECL|macro|CM_CFMT_STEREO
mdefine_line|#define CM_CFMT_STEREO&t;0x01
DECL|macro|CM_CFMT_16BIT
mdefine_line|#define CM_CFMT_16BIT&t;0x02
DECL|macro|CM_CFMT_MASK
mdefine_line|#define CM_CFMT_MASK&t;0x03
DECL|macro|POLVALID
mdefine_line|#define&t;POLVALID&t;0x20
DECL|macro|INVSPDIFI
mdefine_line|#define&t;INVSPDIFI&t;0x80
singleline_comment|// Channel Format Register+2 (0ah)
DECL|macro|SPD24SEL
mdefine_line|#define SPD24SEL&t;0x20
singleline_comment|// Channel Format Register+3 (0bh)
DECL|macro|CHB3D
mdefine_line|#define CHB3D&t;&t;0x20
DECL|macro|CHB3D5C
mdefine_line|#define CHB3D5C&t;&t;0x80
singleline_comment|// Interrupt Hold/Clear Register+2 (0eh)
DECL|macro|CH0_INT_EN
mdefine_line|#define&t;CH0_INT_EN&t;0x01
DECL|macro|CH1_INT_EN
mdefine_line|#define&t;CH1_INT_EN&t;0x02
singleline_comment|// Interrupt Register (10h)
DECL|macro|CHINT0
mdefine_line|#define CHINT0&t;&t;0x01
DECL|macro|CHINT1
mdefine_line|#define CHINT1&t;&t;0x02
DECL|macro|CH0BUSY
mdefine_line|#define&t;CH0BUSY&t;&t;0x04
DECL|macro|CH1BUSY
mdefine_line|#define&t;CH1BUSY&t;&t;0x08
singleline_comment|// Legacy Control/Status Register+1 (15h)
DECL|macro|EXBASEN
mdefine_line|#define&t;EXBASEN&t;&t;0x10
DECL|macro|BASE2LIN
mdefine_line|#define&t;BASE2LIN&t;0x20
DECL|macro|CENTR2LIN
mdefine_line|#define&t;CENTR2LIN&t;0x40
DECL|macro|CB2LIN
mdefine_line|#define&t;CB2LIN&t;&t;(BASE2LIN | CENTR2LIN)
DECL|macro|CHB3D6C
mdefine_line|#define&t;CHB3D6C&t;&t;0x80
singleline_comment|// Legacy Control/Status Register+2 (16h)
DECL|macro|DAC2SPDO
mdefine_line|#define&t;DAC2SPDO&t;0x20
DECL|macro|SPDCOPYRHT
mdefine_line|#define&t;SPDCOPYRHT&t;0x40
DECL|macro|ENSPDOUT
mdefine_line|#define&t;ENSPDOUT&t;0x80
singleline_comment|// Legacy Control/Status Register+3 (17h)
DECL|macro|FMSEL
mdefine_line|#define&t;FMSEL&t;&t;0x03
DECL|macro|VSBSEL
mdefine_line|#define&t;VSBSEL&t;&t;0x0c
DECL|macro|VMPU
mdefine_line|#define&t;VMPU&t;&t;0x60
DECL|macro|NXCHG
mdefine_line|#define&t;NXCHG&t;&t;0x80
singleline_comment|// Miscellaneous Control Register (18h)
DECL|macro|REAR2LIN
mdefine_line|#define&t;REAR2LIN&t;0x20
DECL|macro|MUTECH1
mdefine_line|#define&t;MUTECH1&t;&t;0x40
DECL|macro|ENCENTER
mdefine_line|#define&t;ENCENTER&t;0x80
singleline_comment|// Miscellaneous Control Register+1 (19h)
DECL|macro|SELSPDIFI2
mdefine_line|#define&t;SELSPDIFI2&t;0x01
DECL|macro|SPDF_AC97
mdefine_line|#define&t;SPDF_AC97&t;0x80
singleline_comment|// Miscellaneous Control Register+2 (1ah)
DECL|macro|AC3_EN
mdefine_line|#define&t;AC3_EN&t;&t;0x04
DECL|macro|FM_EN
mdefine_line|#define&t;FM_EN&t;&t;0x08
DECL|macro|SPD32SEL
mdefine_line|#define&t;SPD32SEL&t;0x20
DECL|macro|XCHGDAC
mdefine_line|#define&t;XCHGDAC&t;&t;0x40
DECL|macro|ENDBDAC
mdefine_line|#define&t;ENDBDAC&t;&t;0x80
singleline_comment|// Miscellaneous Control Register+3 (1bh)
DECL|macro|SPDIFI48K
mdefine_line|#define&t;SPDIFI48K&t;0x01
DECL|macro|SPDO5V
mdefine_line|#define&t;SPDO5V&t;&t;0x02
DECL|macro|N4SPK3D
mdefine_line|#define&t;N4SPK3D&t;&t;0x04
DECL|macro|RESET
mdefine_line|#define&t;RESET&t;&t;0x40
DECL|macro|PWD
mdefine_line|#define&t;PWD&t;&t;0x80
DECL|macro|SPDIF48K
mdefine_line|#define&t;SPDIF48K&t;(SPDIFI48K &lt;&lt; 24 | SPDF_AC97 &lt;&lt; 8)
singleline_comment|// Mixer1 (24h)
DECL|macro|CDPLAY
mdefine_line|#define&t;CDPLAY&t;&t;0x01
DECL|macro|X3DEN
mdefine_line|#define&t;X3DEN&t;&t;0x02
DECL|macro|REAR2FRONT
mdefine_line|#define&t;REAR2FRONT&t;0x10
DECL|macro|SPK4
mdefine_line|#define&t;SPK4&t;&t;0x20
DECL|macro|WSMUTE
mdefine_line|#define&t;WSMUTE&t;&t;0x40
DECL|macro|FMMUTE
mdefine_line|#define&t;FMMUTE&t;&t;0x80
singleline_comment|// Miscellaneous Register (27h)
DECL|macro|SPDVALID
mdefine_line|#define&t;SPDVALID&t;0x02
DECL|macro|CENTR2MIC
mdefine_line|#define&t;CENTR2MIC&t;0x04
singleline_comment|// Miscellaneous Register2 (92h)
DECL|macro|SPD32KFMT
mdefine_line|#define&t;SPD32KFMT&t;0x10
DECL|macro|CM_CFMT_DACSHIFT
mdefine_line|#define CM_CFMT_DACSHIFT   2
DECL|macro|CM_CFMT_ADCSHIFT
mdefine_line|#define CM_CFMT_ADCSHIFT   0
DECL|macro|CM_FREQ_DACSHIFT
mdefine_line|#define CM_FREQ_DACSHIFT   5
DECL|macro|CM_FREQ_ADCSHIFT
mdefine_line|#define CM_FREQ_ADCSHIFT   2
DECL|macro|RSTDAC
mdefine_line|#define&t;RSTDAC&t;RST_CH1
DECL|macro|RSTADC
mdefine_line|#define&t;RSTADC&t;RST_CH0
DECL|macro|ENDAC
mdefine_line|#define&t;ENDAC&t;CHEN1
DECL|macro|ENADC
mdefine_line|#define&t;ENADC&t;CHEN0
DECL|macro|PAUSEDAC
mdefine_line|#define&t;PAUSEDAC&t;PAUSE1
DECL|macro|PAUSEADC
mdefine_line|#define&t;PAUSEADC&t;PAUSE0
DECL|macro|CODEC_CMI_ADC_FRAME1
mdefine_line|#define CODEC_CMI_ADC_FRAME1&t;CODEC_CMI_CH0_FRAME1
DECL|macro|CODEC_CMI_ADC_FRAME2
mdefine_line|#define CODEC_CMI_ADC_FRAME2&t;CODEC_CMI_CH0_FRAME2
DECL|macro|CODEC_CMI_DAC_FRAME1
mdefine_line|#define CODEC_CMI_DAC_FRAME1&t;CODEC_CMI_CH1_FRAME1
DECL|macro|CODEC_CMI_DAC_FRAME2
mdefine_line|#define CODEC_CMI_DAC_FRAME2&t;CODEC_CMI_CH1_FRAME2
DECL|macro|DACINT
mdefine_line|#define&t;DACINT&t;CHINT1
DECL|macro|ADCINT
mdefine_line|#define&t;ADCINT&t;CHINT0
DECL|macro|DACBUSY
mdefine_line|#define&t;DACBUSY&t;CH1BUSY
DECL|macro|ADCBUSY
mdefine_line|#define&t;ADCBUSY&t;CH0BUSY
DECL|macro|ENDACINT
mdefine_line|#define&t;ENDACINT&t;CH1_INT_EN
DECL|macro|ENADCINT
mdefine_line|#define&t;ENADCINT&t;CH0_INT_EN
DECL|variable|sample_size
r_static
r_const
r_int
id|sample_size
(braket
)braket
op_assign
(brace
l_int|1
comma
l_int|2
comma
l_int|2
comma
l_int|4
)brace
suffix:semicolon
DECL|variable|sample_shift
r_static
r_const
r_int
id|sample_shift
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_int|2
)brace
suffix:semicolon
DECL|macro|SND_DEV_DSP16
mdefine_line|#define SND_DEV_DSP16   5
DECL|macro|NR_DEVICE
mdefine_line|#define NR_DEVICE 3&t;&t;/* maximum number of devices */
DECL|macro|set_dac1_rate
mdefine_line|#define&t;set_dac1_rate&t;set_adc_rate
DECL|macro|set_dac1_rate_unlocked
mdefine_line|#define&t;set_dac1_rate_unlocked&t;set_adc_rate_unlocked
DECL|macro|stop_dac1
mdefine_line|#define&t;stop_dac1&t;stop_adc
DECL|macro|stop_dac1_unlocked
mdefine_line|#define&t;stop_dac1_unlocked&t;stop_adc_unlocked
DECL|macro|get_dmadac1
mdefine_line|#define&t;get_dmadac1&t;get_dmaadc
DECL|variable|devindex
r_static
r_int
r_int
id|devindex
op_assign
l_int|0
suffix:semicolon
singleline_comment|//*********************************************/
DECL|struct|cm_state
r_struct
id|cm_state
(brace
multiline_comment|/* magic */
DECL|member|magic
r_int
r_int
id|magic
suffix:semicolon
multiline_comment|/* list of cmedia devices */
DECL|member|devs
r_struct
id|list_head
id|devs
suffix:semicolon
multiline_comment|/* the corresponding pci_dev structure */
DECL|member|dev
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
DECL|member|dev_audio
r_int
id|dev_audio
suffix:semicolon
multiline_comment|/* soundcore stuff */
DECL|member|dev_mixer
r_int
id|dev_mixer
suffix:semicolon
DECL|member|iosb
DECL|member|iobase
DECL|member|iosynth
r_int
r_int
id|iosb
comma
id|iobase
comma
id|iosynth
comma
DECL|member|iomidi
DECL|member|iogame
DECL|member|irq
id|iomidi
comma
id|iogame
comma
id|irq
suffix:semicolon
multiline_comment|/* hardware resources */
DECL|member|deviceid
r_int
r_int
id|deviceid
suffix:semicolon
multiline_comment|/* pci_id */
r_struct
(brace
multiline_comment|/* mixer stuff */
DECL|member|modcnt
r_int
r_int
id|modcnt
suffix:semicolon
DECL|member|vol
r_int
r_int
id|vol
(braket
l_int|13
)braket
suffix:semicolon
DECL|member|mix
)brace
id|mix
suffix:semicolon
DECL|member|rateadc
DECL|member|ratedac
r_int
r_int
id|rateadc
comma
id|ratedac
suffix:semicolon
multiline_comment|/* wave stuff */
DECL|member|fmt
DECL|member|enable
r_int
r_char
id|fmt
comma
id|enable
suffix:semicolon
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|open_sem
r_struct
id|semaphore
id|open_sem
suffix:semicolon
DECL|member|open_mode
id|mode_t
id|open_mode
suffix:semicolon
DECL|member|open_wait
id|wait_queue_head_t
id|open_wait
suffix:semicolon
DECL|struct|dmabuf
r_struct
id|dmabuf
(brace
DECL|member|rawbuf
r_void
op_star
id|rawbuf
suffix:semicolon
DECL|member|dmaaddr
id|dma_addr_t
id|dmaaddr
suffix:semicolon
DECL|member|buforder
r_int
id|buforder
suffix:semicolon
DECL|member|numfrag
r_int
id|numfrag
suffix:semicolon
DECL|member|fragshift
r_int
id|fragshift
suffix:semicolon
DECL|member|hwptr
DECL|member|swptr
r_int
id|hwptr
comma
id|swptr
suffix:semicolon
DECL|member|total_bytes
r_int
id|total_bytes
suffix:semicolon
DECL|member|count
r_int
id|count
suffix:semicolon
DECL|member|error
r_int
id|error
suffix:semicolon
multiline_comment|/* over/underrun */
DECL|member|wait
id|wait_queue_head_t
id|wait
suffix:semicolon
DECL|member|fragsize
r_int
id|fragsize
suffix:semicolon
multiline_comment|/* redundant, but makes calculations easier */
DECL|member|dmasize
r_int
id|dmasize
suffix:semicolon
DECL|member|fragsamples
r_int
id|fragsamples
suffix:semicolon
DECL|member|dmasamples
r_int
id|dmasamples
suffix:semicolon
DECL|member|mapped
r_int
id|mapped
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* OSS stuff */
DECL|member|ready
r_int
id|ready
suffix:colon
l_int|1
suffix:semicolon
DECL|member|endcleared
r_int
id|endcleared
suffix:colon
l_int|1
suffix:semicolon
DECL|member|enabled
r_int
id|enabled
suffix:colon
l_int|1
suffix:semicolon
DECL|member|ossfragshift
r_int
id|ossfragshift
suffix:semicolon
DECL|member|ossmaxfrags
r_int
id|ossmaxfrags
suffix:semicolon
DECL|member|subdivision
r_int
id|subdivision
suffix:semicolon
DECL|member|dma_dac
DECL|member|dma_adc
)brace
id|dma_dac
comma
id|dma_adc
suffix:semicolon
macro_line|#ifdef CONFIG_SOUND_CMPCI_MIDI
DECL|member|midi_devc
r_int
id|midi_devc
suffix:semicolon
DECL|member|mpu_data
r_struct
id|address_info
id|mpu_data
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SOUND_CMPCI_JOYSTICK
DECL|member|gameport
r_struct
id|gameport
id|gameport
suffix:semicolon
macro_line|#endif
DECL|member|chip_version
r_int
id|chip_version
suffix:semicolon
DECL|member|max_channels
r_int
id|max_channels
suffix:semicolon
DECL|member|curr_channels
r_int
id|curr_channels
suffix:semicolon
DECL|member|capability
r_int
id|capability
suffix:semicolon
multiline_comment|/* HW capability, various for chip versions */
DECL|member|status
r_int
id|status
suffix:semicolon
multiline_comment|/* HW or SW state */
DECL|member|spdif_counter
r_int
id|spdif_counter
suffix:semicolon
multiline_comment|/* spdif frame counter */
)brace
suffix:semicolon
multiline_comment|/* flags used for capability */
DECL|macro|CAN_AC3_HW
mdefine_line|#define&t;CAN_AC3_HW&t;&t;0x00000001&t;&t;/* 037 or later */
DECL|macro|CAN_AC3_SW
mdefine_line|#define&t;CAN_AC3_SW&t;&t;0x00000002&t;&t;/* 033 or later */
DECL|macro|CAN_AC3
mdefine_line|#define&t;CAN_AC3&t;&t;&t;(CAN_AC3_HW | CAN_AC3_SW)
DECL|macro|CAN_DUAL_DAC
mdefine_line|#define CAN_DUAL_DAC&t;&t;0x00000004&t;&t;/* 033 or later */
DECL|macro|CAN_MULTI_CH_HW
mdefine_line|#define&t;CAN_MULTI_CH_HW&t;&t;0x00000008&t;&t;/* 039 or later */
DECL|macro|CAN_MULTI_CH
mdefine_line|#define&t;CAN_MULTI_CH&t;&t;(CAN_MULTI_CH_HW | CAN_DUAL_DAC)
DECL|macro|CAN_LINE_AS_REAR
mdefine_line|#define&t;CAN_LINE_AS_REAR&t;0x00000010&t;&t;/* 033 or later */
DECL|macro|CAN_LINE_AS_BASS
mdefine_line|#define&t;CAN_LINE_AS_BASS&t;0x00000020&t;&t;/* 039 or later */
DECL|macro|CAN_MIC_AS_BASS
mdefine_line|#define&t;CAN_MIC_AS_BASS&t;&t;0x00000040&t;&t;/* 039 or later */
multiline_comment|/* flags used for status */
DECL|macro|DO_AC3_HW
mdefine_line|#define&t;DO_AC3_HW&t;&t;0x00000001
DECL|macro|DO_AC3_SW
mdefine_line|#define&t;DO_AC3_SW&t;&t;0x00000002
DECL|macro|DO_AC3
mdefine_line|#define&t;DO_AC3&t;&t;&t;(DO_AC3_HW | DO_AC3_SW)
DECL|macro|DO_DUAL_DAC
mdefine_line|#define&t;DO_DUAL_DAC&t;&t;0x00000004
DECL|macro|DO_MULTI_CH_HW
mdefine_line|#define&t;DO_MULTI_CH_HW&t;&t;0x00000008
DECL|macro|DO_MULTI_CH
mdefine_line|#define&t;DO_MULTI_CH&t;&t;(DO_MULTI_CH_HW | DO_DUAL_DAC)
DECL|macro|DO_LINE_AS_REAR
mdefine_line|#define&t;DO_LINE_AS_REAR&t;&t;0x00000010&t;&t;/* 033 or later */
DECL|macro|DO_LINE_AS_BASS
mdefine_line|#define&t;DO_LINE_AS_BASS&t;&t;0x00000020&t;&t;/* 039 or later */
DECL|macro|DO_MIC_AS_BASS
mdefine_line|#define&t;DO_MIC_AS_BASS&t;&t;0x00000040&t;&t;/* 039 or later */
DECL|macro|DO_SPDIF_OUT
mdefine_line|#define&t;DO_SPDIF_OUT&t;&t;0x00000100
DECL|macro|DO_SPDIF_IN
mdefine_line|#define&t;DO_SPDIF_IN&t;&t;0x00000200
DECL|macro|DO_SPDIF_LOOP
mdefine_line|#define&t;DO_SPDIF_LOOP&t;&t;0x00000400
DECL|macro|DO_BIGENDIAN_W
mdefine_line|#define&t;DO_BIGENDIAN_W&t;&t;0x00001000&t;&t;/* used in PowerPC */
DECL|macro|DO_BIGENDIAN_R
mdefine_line|#define&t;DO_BIGENDIAN_R&t;&t;0x00002000&t;&t;/* used in PowerPC */
r_static
id|LIST_HEAD
c_func
(paren
id|devs
)paren
suffix:semicolon
DECL|variable|mpuio
r_static
r_int
id|mpuio
op_assign
l_int|0
suffix:semicolon
DECL|variable|fmio
r_static
r_int
id|fmio
op_assign
l_int|0
suffix:semicolon
DECL|variable|joystick
r_static
r_int
id|joystick
op_assign
l_int|0
suffix:semicolon
DECL|variable|spdif_inverse
r_static
r_int
id|spdif_inverse
op_assign
l_int|0
suffix:semicolon
DECL|variable|spdif_loop
r_static
r_int
id|spdif_loop
op_assign
l_int|0
suffix:semicolon
DECL|variable|spdif_out
r_static
r_int
id|spdif_out
op_assign
l_int|0
suffix:semicolon
DECL|variable|use_line_as_rear
r_static
r_int
id|use_line_as_rear
op_assign
l_int|0
suffix:semicolon
DECL|variable|use_line_as_bass
r_static
r_int
id|use_line_as_bass
op_assign
l_int|0
suffix:semicolon
DECL|variable|use_mic_as_bass
r_static
r_int
id|use_mic_as_bass
op_assign
l_int|0
suffix:semicolon
DECL|variable|mic_boost
r_static
r_int
id|mic_boost
op_assign
l_int|0
suffix:semicolon
DECL|variable|hw_copy
r_static
r_int
id|hw_copy
op_assign
l_int|0
suffix:semicolon
id|module_param
c_func
(paren
id|mpuio
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|fmio
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|joystick
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|spdif_inverse
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|spdif_loop
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|spdif_out
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|use_line_as_rear
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|use_line_as_bass
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|use_mic_as_bass
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|mic_boost
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|hw_copy
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mpuio
comma
l_string|&quot;(0x330, 0x320, 0x310, 0x300) Base of MPU-401, 0 to disable&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|fmio
comma
l_string|&quot;(0x388, 0x3C8, 0x3E0) Base of OPL3, 0 to disable&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|joystick
comma
l_string|&quot;(1/0) Enable joystick interface, still need joystick driver&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|spdif_inverse
comma
l_string|&quot;(1/0) Invert S/PDIF-in signal&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|spdif_loop
comma
l_string|&quot;(1/0) Route S/PDIF-in to S/PDIF-out directly&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|spdif_out
comma
l_string|&quot;(1/0) Send PCM to S/PDIF-out (PCM volume will not function)&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|use_line_as_rear
comma
l_string|&quot;(1/0) Use line-in jack as rear-out&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|use_line_as_bass
comma
l_string|&quot;(1/0) Use line-in jack as bass/center&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|use_mic_as_bass
comma
l_string|&quot;(1/0) Use mic-in jack as bass/center&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mic_boost
comma
l_string|&quot;(1/0) Enable microphone boost&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|hw_copy
comma
l_string|&quot;Copy front channel to surround channel&quot;
)paren
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|ld2
r_static
r_inline
r_int
id|ld2
c_func
(paren
r_int
r_int
id|x
)paren
(brace
r_int
id|exp
op_assign
l_int|16
comma
id|l
op_assign
l_int|5
comma
id|r
op_assign
l_int|0
suffix:semicolon
r_static
r_const
r_int
id|num
(braket
)braket
op_assign
initialization_block
suffix:semicolon
multiline_comment|/* num: 2, 4, 16, 256, 65536 */
multiline_comment|/* exp: 1, 2,  4,   8,    16 */
r_while
c_loop
(paren
id|l
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|x
op_ge
id|num
(braket
id|l
)braket
)paren
(brace
r_if
c_cond
(paren
id|num
(braket
id|l
)braket
OG
l_int|2
)paren
(brace
id|x
op_rshift_assign
id|exp
suffix:semicolon
)brace
id|r
op_add_assign
id|exp
suffix:semicolon
)brace
id|exp
op_rshift_assign
l_int|1
suffix:semicolon
)brace
r_return
id|r
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|maskb
r_static
r_void
id|maskb
c_func
(paren
r_int
r_int
id|addr
comma
r_int
r_int
id|mask
comma
r_int
r_int
id|value
)paren
(brace
id|outb
c_func
(paren
(paren
id|inb
c_func
(paren
id|addr
)paren
op_amp
id|mask
)paren
op_or
id|value
comma
id|addr
)paren
suffix:semicolon
)brace
DECL|function|maskw
r_static
r_void
id|maskw
c_func
(paren
r_int
r_int
id|addr
comma
r_int
r_int
id|mask
comma
r_int
r_int
id|value
)paren
(brace
id|outw
c_func
(paren
(paren
id|inw
c_func
(paren
id|addr
)paren
op_amp
id|mask
)paren
op_or
id|value
comma
id|addr
)paren
suffix:semicolon
)brace
DECL|function|maskl
r_static
r_void
id|maskl
c_func
(paren
r_int
r_int
id|addr
comma
r_int
r_int
id|mask
comma
r_int
r_int
id|value
)paren
(brace
id|outl
c_func
(paren
(paren
id|inl
c_func
(paren
id|addr
)paren
op_amp
id|mask
)paren
op_or
id|value
comma
id|addr
)paren
suffix:semicolon
)brace
DECL|function|set_dmadac1
r_static
r_void
id|set_dmadac1
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
r_int
id|addr
comma
r_int
r_int
id|count
)paren
(brace
r_if
c_cond
(paren
id|addr
)paren
id|outl
c_func
(paren
id|addr
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_ADC_FRAME1
)paren
suffix:semicolon
id|outw
c_func
(paren
id|count
op_minus
l_int|1
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_ADC_FRAME2
)paren
suffix:semicolon
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL0
comma
op_complement
id|CHADC0
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|set_dmaadc
r_static
r_void
id|set_dmaadc
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
r_int
id|addr
comma
r_int
r_int
id|count
)paren
(brace
id|outl
c_func
(paren
id|addr
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_ADC_FRAME1
)paren
suffix:semicolon
id|outw
c_func
(paren
id|count
op_minus
l_int|1
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_ADC_FRAME2
)paren
suffix:semicolon
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL0
comma
op_complement
l_int|0
comma
id|CHADC0
)paren
suffix:semicolon
)brace
DECL|function|set_dmadac
r_static
r_void
id|set_dmadac
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
r_int
id|addr
comma
r_int
r_int
id|count
)paren
(brace
id|outl
c_func
(paren
id|addr
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_DAC_FRAME1
)paren
suffix:semicolon
id|outw
c_func
(paren
id|count
op_minus
l_int|1
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_DAC_FRAME2
)paren
suffix:semicolon
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL0
comma
op_complement
id|CHADC1
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
id|set_dmadac1
c_func
(paren
id|s
comma
l_int|0
comma
id|count
)paren
suffix:semicolon
)brace
DECL|function|set_countadc
r_static
r_void
id|set_countadc
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|count
)paren
(brace
id|outw
c_func
(paren
id|count
op_minus
l_int|1
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_ADC_FRAME2
op_plus
l_int|2
)paren
suffix:semicolon
)brace
DECL|function|set_countdac
r_static
r_void
id|set_countdac
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|count
)paren
(brace
id|outw
c_func
(paren
id|count
op_minus
l_int|1
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_DAC_FRAME2
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
id|set_countadc
c_func
(paren
id|s
comma
id|count
)paren
suffix:semicolon
)brace
DECL|function|get_dmadac
r_static
r_int
id|get_dmadac
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
r_int
r_int
id|curr_addr
suffix:semicolon
id|curr_addr
op_assign
id|inw
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_DAC_FRAME2
)paren
op_plus
l_int|1
suffix:semicolon
id|curr_addr
op_lshift_assign
id|sample_shift
(braket
(paren
id|s-&gt;fmt
op_rshift
id|CM_CFMT_DACSHIFT
)paren
op_amp
id|CM_CFMT_MASK
)braket
suffix:semicolon
id|curr_addr
op_assign
id|s-&gt;dma_dac.dmasize
op_minus
id|curr_addr
suffix:semicolon
r_return
id|curr_addr
suffix:semicolon
)brace
DECL|function|get_dmaadc
r_static
r_int
id|get_dmaadc
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
r_int
r_int
id|curr_addr
suffix:semicolon
id|curr_addr
op_assign
id|inw
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_ADC_FRAME2
)paren
op_plus
l_int|1
suffix:semicolon
id|curr_addr
op_lshift_assign
id|sample_shift
(braket
(paren
id|s-&gt;fmt
op_rshift
id|CM_CFMT_ADCSHIFT
)paren
op_amp
id|CM_CFMT_MASK
)braket
suffix:semicolon
id|curr_addr
op_assign
id|s-&gt;dma_adc.dmasize
op_minus
id|curr_addr
suffix:semicolon
r_return
id|curr_addr
suffix:semicolon
)brace
DECL|function|wrmixer
r_static
r_void
id|wrmixer
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
r_char
id|idx
comma
r_int
r_char
id|data
)paren
(brace
r_int
r_char
id|regval
comma
id|pseudo
suffix:semicolon
singleline_comment|// pseudo register
r_if
c_cond
(paren
id|idx
op_eq
id|DSP_MIX_AUXVOL_L
)paren
(brace
id|data
op_rshift_assign
l_int|4
suffix:semicolon
id|data
op_and_assign
l_int|0x0f
suffix:semicolon
id|regval
op_assign
id|inb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_AUX_VOL
)paren
op_amp
op_complement
l_int|0x0f
suffix:semicolon
id|outb
c_func
(paren
id|regval
op_or
id|data
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_AUX_VOL
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|idx
op_eq
id|DSP_MIX_AUXVOL_R
)paren
(brace
id|data
op_and_assign
l_int|0xf0
suffix:semicolon
id|regval
op_assign
id|inb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_AUX_VOL
)paren
op_amp
op_complement
l_int|0xf0
suffix:semicolon
id|outb
c_func
(paren
id|regval
op_or
id|data
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_AUX_VOL
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|outb
c_func
(paren
id|idx
comma
id|s-&gt;iobase
op_plus
id|CODEC_SB16_ADDR
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
singleline_comment|// pseudo bits
r_if
c_cond
(paren
id|idx
op_eq
id|DSP_MIX_OUTMIXIDX
)paren
(brace
id|pseudo
op_assign
id|data
op_amp
op_complement
l_int|0x1f
suffix:semicolon
id|pseudo
op_rshift_assign
l_int|1
suffix:semicolon
id|regval
op_assign
id|inb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER2
)paren
op_amp
op_complement
l_int|0x30
suffix:semicolon
id|outb
c_func
(paren
id|regval
op_or
id|pseudo
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|idx
op_eq
id|DSP_MIX_ADCMIXIDX_L
)paren
(brace
id|pseudo
op_assign
id|data
op_amp
l_int|0x80
suffix:semicolon
id|pseudo
op_rshift_assign
l_int|1
suffix:semicolon
id|regval
op_assign
id|inb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER2
)paren
op_amp
op_complement
l_int|0x40
suffix:semicolon
id|outb
c_func
(paren
id|regval
op_or
id|pseudo
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|idx
op_eq
id|DSP_MIX_ADCMIXIDX_R
)paren
(brace
id|pseudo
op_assign
id|data
op_amp
l_int|0x80
suffix:semicolon
id|regval
op_assign
id|inb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER2
)paren
op_amp
op_complement
l_int|0x80
suffix:semicolon
id|outb
c_func
(paren
id|regval
op_or
id|pseudo
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER2
)paren
suffix:semicolon
)brace
id|outb
c_func
(paren
id|data
comma
id|s-&gt;iobase
op_plus
id|CODEC_SB16_DATA
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
DECL|function|rdmixer
r_static
r_int
r_char
id|rdmixer
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
r_char
id|idx
)paren
(brace
r_int
r_char
id|v
comma
id|pseudo
suffix:semicolon
singleline_comment|// pseudo register
r_if
c_cond
(paren
id|idx
op_eq
id|DSP_MIX_AUXVOL_L
)paren
(brace
id|v
op_assign
id|inb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_AUX_VOL
)paren
op_amp
l_int|0x0f
suffix:semicolon
id|v
op_lshift_assign
l_int|4
suffix:semicolon
r_return
id|v
suffix:semicolon
)brace
r_if
c_cond
(paren
id|idx
op_eq
id|DSP_MIX_AUXVOL_L
)paren
(brace
id|v
op_assign
id|inb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_AUX_VOL
)paren
op_amp
l_int|0xf0
suffix:semicolon
r_return
id|v
suffix:semicolon
)brace
id|outb
c_func
(paren
id|idx
comma
id|s-&gt;iobase
op_plus
id|CODEC_SB16_ADDR
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|v
op_assign
id|inb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_SB16_DATA
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
singleline_comment|// pseudo bits
r_if
c_cond
(paren
id|idx
op_eq
id|DSP_MIX_OUTMIXIDX
)paren
(brace
id|pseudo
op_assign
id|inb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER2
)paren
op_amp
l_int|0x30
suffix:semicolon
id|pseudo
op_lshift_assign
l_int|1
suffix:semicolon
id|v
op_or_assign
id|pseudo
suffix:semicolon
)brace
r_if
c_cond
(paren
id|idx
op_eq
id|DSP_MIX_ADCMIXIDX_L
)paren
(brace
id|pseudo
op_assign
id|inb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER2
)paren
op_amp
l_int|0x40
suffix:semicolon
id|pseudo
op_lshift_assign
l_int|1
suffix:semicolon
id|v
op_or_assign
id|pseudo
suffix:semicolon
)brace
r_if
c_cond
(paren
id|idx
op_eq
id|DSP_MIX_ADCMIXIDX_R
)paren
(brace
id|pseudo
op_assign
id|inb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER2
)paren
op_amp
l_int|0x80
suffix:semicolon
id|v
op_or_assign
id|pseudo
suffix:semicolon
)brace
r_return
id|v
suffix:semicolon
)brace
DECL|function|set_fmt_unlocked
r_static
r_void
id|set_fmt_unlocked
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
r_char
id|mask
comma
r_int
r_char
id|data
)paren
(brace
r_if
c_cond
(paren
id|mask
op_logical_and
id|s-&gt;chip_version
OG
l_int|0
)paren
(brace
multiline_comment|/* 8338 cannot keep this */
id|s-&gt;fmt
op_assign
id|inb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_CHFORMAT
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|s-&gt;fmt
op_assign
(paren
id|s-&gt;fmt
op_amp
id|mask
)paren
op_or
id|data
suffix:semicolon
id|outb
c_func
(paren
id|s-&gt;fmt
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_CHFORMAT
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
DECL|function|set_fmt
r_static
r_void
id|set_fmt
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
r_char
id|mask
comma
r_int
r_char
id|data
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|set_fmt_unlocked
c_func
(paren
id|s
comma
id|mask
comma
id|data
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|frobindir
r_static
r_void
id|frobindir
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
r_char
id|idx
comma
r_int
r_char
id|mask
comma
r_int
r_char
id|data
)paren
(brace
id|outb
c_func
(paren
id|idx
comma
id|s-&gt;iobase
op_plus
id|CODEC_SB16_ADDR
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
id|inb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_SB16_DATA
)paren
op_amp
id|mask
)paren
op_or
id|data
comma
id|s-&gt;iobase
op_plus
id|CODEC_SB16_DATA
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_static
r_struct
(brace
DECL|member|rate
r_int
id|rate
suffix:semicolon
DECL|member|lower
r_int
id|lower
suffix:semicolon
DECL|member|upper
r_int
id|upper
suffix:semicolon
DECL|member|freq
r_int
r_char
id|freq
suffix:semicolon
DECL|variable|rate_lookup
)brace
id|rate_lookup
(braket
)braket
op_assign
(brace
(brace
l_int|5512
comma
(paren
l_int|0
op_plus
l_int|5512
)paren
op_div
l_int|2
comma
(paren
l_int|5512
op_plus
l_int|8000
)paren
op_div
l_int|2
comma
l_int|0
)brace
comma
(brace
l_int|8000
comma
(paren
l_int|5512
op_plus
l_int|8000
)paren
op_div
l_int|2
comma
(paren
l_int|8000
op_plus
l_int|11025
)paren
op_div
l_int|2
comma
l_int|4
)brace
comma
(brace
l_int|11025
comma
(paren
l_int|8000
op_plus
l_int|11025
)paren
op_div
l_int|2
comma
(paren
l_int|11025
op_plus
l_int|16000
)paren
op_div
l_int|2
comma
l_int|1
)brace
comma
(brace
l_int|16000
comma
(paren
l_int|11025
op_plus
l_int|16000
)paren
op_div
l_int|2
comma
(paren
l_int|16000
op_plus
l_int|22050
)paren
op_div
l_int|2
comma
l_int|5
)brace
comma
(brace
l_int|22050
comma
(paren
l_int|16000
op_plus
l_int|22050
)paren
op_div
l_int|2
comma
(paren
l_int|22050
op_plus
l_int|32000
)paren
op_div
l_int|2
comma
l_int|2
)brace
comma
(brace
l_int|32000
comma
(paren
l_int|22050
op_plus
l_int|32000
)paren
op_div
l_int|2
comma
(paren
l_int|32000
op_plus
l_int|44100
)paren
op_div
l_int|2
comma
l_int|6
)brace
comma
(brace
l_int|44100
comma
(paren
l_int|32000
op_plus
l_int|44100
)paren
op_div
l_int|2
comma
(paren
l_int|44100
op_plus
l_int|48000
)paren
op_div
l_int|2
comma
l_int|3
)brace
comma
(brace
l_int|48000
comma
(paren
l_int|44100
op_plus
l_int|48000
)paren
op_div
l_int|2
comma
l_int|48000
comma
l_int|7
)brace
)brace
suffix:semicolon
DECL|function|set_spdif_copyright
r_static
r_void
id|set_spdif_copyright
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|spdif_copyright
)paren
(brace
multiline_comment|/* enable SPDIF-in Copyright */
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_LEGACY_CTRL
op_plus
l_int|2
comma
op_complement
id|SPDCOPYRHT
comma
id|spdif_copyright
ques
c_cond
id|SPDCOPYRHT
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|set_spdif_loop
r_static
r_void
id|set_spdif_loop
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|spdif_loop
)paren
(brace
multiline_comment|/* enable SPDIF loop */
r_if
c_cond
(paren
id|spdif_loop
)paren
(brace
id|s-&gt;status
op_or_assign
id|DO_SPDIF_LOOP
suffix:semicolon
multiline_comment|/* turn on spdif-in to spdif-out */
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL1
comma
op_complement
l_int|0
comma
id|SPDFLOOP
)paren
suffix:semicolon
)brace
r_else
(brace
id|s-&gt;status
op_and_assign
op_complement
id|DO_SPDIF_LOOP
suffix:semicolon
multiline_comment|/* turn off spdif-in to spdif-out */
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL1
comma
op_complement
id|SPDFLOOP
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
DECL|function|set_spdif_monitor
r_static
r_void
id|set_spdif_monitor
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|channel
)paren
(brace
singleline_comment|// SPDO2DAC
id|maskw
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL1
comma
op_complement
id|SPDO2DAC
comma
id|channel
op_eq
l_int|2
ques
c_cond
id|SPDO2DAC
suffix:colon
l_int|0
)paren
suffix:semicolon
singleline_comment|// CDPLAY
r_if
c_cond
(paren
id|s-&gt;chip_version
op_ge
l_int|39
)paren
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER1
comma
op_complement
id|CDPLAY
comma
id|channel
ques
c_cond
id|CDPLAY
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|set_spdifout_level
r_static
r_void
id|set_spdifout_level
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|level5v
)paren
(brace
multiline_comment|/* SPDO5V */
r_if
c_cond
(paren
id|s-&gt;chip_version
OG
l_int|0
)paren
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC_CTRL
op_plus
l_int|3
comma
op_complement
id|SPDO5V
comma
id|level5v
ques
c_cond
id|SPDO5V
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|set_spdifin_inverse
r_static
r_void
id|set_spdifin_inverse
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|spdif_inverse
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;chip_version
op_eq
l_int|0
)paren
multiline_comment|/* 8338 has not this feature */
r_return
suffix:semicolon
r_if
c_cond
(paren
id|spdif_inverse
)paren
(brace
multiline_comment|/* turn on spdif-in inverse */
r_if
c_cond
(paren
id|s-&gt;chip_version
op_ge
l_int|39
)paren
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_CHFORMAT
comma
op_complement
l_int|0
comma
id|INVSPDIFI
)paren
suffix:semicolon
r_else
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_CHFORMAT
op_plus
l_int|2
comma
op_complement
l_int|0
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* turn off spdif-ininverse */
r_if
c_cond
(paren
id|s-&gt;chip_version
op_ge
l_int|39
)paren
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_CHFORMAT
comma
op_complement
id|INVSPDIFI
comma
l_int|0
)paren
suffix:semicolon
r_else
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_CHFORMAT
op_plus
l_int|2
comma
op_complement
l_int|1
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
DECL|function|set_spdifin_channel2
r_static
r_void
id|set_spdifin_channel2
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|channel2
)paren
(brace
multiline_comment|/* SELSPDIFI2 */
r_if
c_cond
(paren
id|s-&gt;chip_version
op_ge
l_int|39
)paren
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC_CTRL
op_plus
l_int|1
comma
op_complement
id|SELSPDIFI2
comma
id|channel2
ques
c_cond
id|SELSPDIFI2
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|set_spdifin_valid
r_static
r_void
id|set_spdifin_valid
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|valid
)paren
(brace
multiline_comment|/* SPDVALID */
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC
comma
op_complement
id|SPDVALID
comma
id|valid
ques
c_cond
id|SPDVALID
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|set_spdifout_unlocked
r_static
r_void
id|set_spdifout_unlocked
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|rate
)paren
(brace
r_if
c_cond
(paren
id|rate
op_ne
l_int|48000
op_logical_and
id|rate
op_ne
l_int|44100
)paren
id|rate
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rate
op_eq
l_int|48000
op_logical_or
id|rate
op_eq
l_int|44100
)paren
(brace
id|set_spdif_loop
c_func
(paren
id|s
comma
l_int|0
)paren
suffix:semicolon
singleline_comment|// SPDF_1
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL1
op_plus
l_int|1
comma
op_complement
l_int|0
comma
id|SPDF_1
)paren
suffix:semicolon
singleline_comment|// SPDIFI48K SPDF_AC97
id|maskl
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC_CTRL
comma
op_complement
id|SPDIF48K
comma
id|rate
op_eq
l_int|48000
ques
c_cond
id|SPDIF48K
suffix:colon
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;chip_version
op_ge
l_int|55
)paren
singleline_comment|// SPD32KFMT
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC_CTRL2
comma
op_complement
id|SPD32KFMT
comma
id|rate
op_eq
l_int|48000
ques
c_cond
id|SPD32KFMT
suffix:colon
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;chip_version
OG
l_int|0
)paren
singleline_comment|// ENSPDOUT
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_LEGACY_CTRL
op_plus
l_int|2
comma
op_complement
l_int|0
comma
id|ENSPDOUT
)paren
suffix:semicolon
singleline_comment|// monitor SPDIF out
id|set_spdif_monitor
c_func
(paren
id|s
comma
l_int|2
)paren
suffix:semicolon
id|s-&gt;status
op_or_assign
id|DO_SPDIF_OUT
suffix:semicolon
)brace
r_else
(brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL1
op_plus
l_int|1
comma
op_complement
id|SPDF_1
comma
l_int|0
)paren
suffix:semicolon
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_LEGACY_CTRL
op_plus
l_int|2
comma
op_complement
id|ENSPDOUT
comma
l_int|0
)paren
suffix:semicolon
singleline_comment|// monitor none
id|set_spdif_monitor
c_func
(paren
id|s
comma
l_int|0
)paren
suffix:semicolon
id|s-&gt;status
op_and_assign
op_complement
id|DO_SPDIF_OUT
suffix:semicolon
)brace
)brace
DECL|function|set_spdifout
r_static
r_void
id|set_spdifout
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|rate
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|set_spdifout_unlocked
c_func
(paren
id|s
comma
id|rate
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|set_spdifin_unlocked
r_static
r_void
id|set_spdifin_unlocked
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|rate
)paren
(brace
r_if
c_cond
(paren
id|rate
op_eq
l_int|48000
op_logical_or
id|rate
op_eq
l_int|44100
)paren
(brace
singleline_comment|// SPDF_1
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL1
op_plus
l_int|1
comma
op_complement
l_int|0
comma
id|SPDF_1
)paren
suffix:semicolon
singleline_comment|// SPDIFI48K SPDF_AC97
id|maskl
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC_CTRL
comma
op_complement
id|SPDIF48K
comma
id|rate
op_eq
l_int|48000
ques
c_cond
id|SPDIF48K
suffix:colon
l_int|0
)paren
suffix:semicolon
id|s-&gt;status
op_or_assign
id|DO_SPDIF_IN
suffix:semicolon
)brace
r_else
(brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL1
op_plus
l_int|1
comma
op_complement
id|SPDF_1
comma
l_int|0
)paren
suffix:semicolon
id|s-&gt;status
op_and_assign
op_complement
id|DO_SPDIF_IN
suffix:semicolon
)brace
)brace
DECL|function|set_spdifin
r_static
r_void
id|set_spdifin
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|rate
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|set_spdifin_unlocked
c_func
(paren
id|s
comma
id|rate
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* find parity for bit 4~30 */
DECL|function|parity
r_static
r_int
id|parity
c_func
(paren
r_int
id|data
)paren
(brace
r_int
id|parity
op_assign
l_int|0
suffix:semicolon
r_int
id|counter
op_assign
l_int|4
suffix:semicolon
id|data
op_rshift_assign
l_int|4
suffix:semicolon
singleline_comment|// start from bit 4
r_while
c_loop
(paren
id|counter
op_le
l_int|30
)paren
(brace
r_if
c_cond
(paren
id|data
op_amp
l_int|1
)paren
id|parity
op_increment
suffix:semicolon
id|data
op_rshift_assign
l_int|1
suffix:semicolon
id|counter
op_increment
suffix:semicolon
)brace
r_return
id|parity
op_amp
l_int|1
suffix:semicolon
)brace
DECL|function|set_ac3_unlocked
r_static
r_void
id|set_ac3_unlocked
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|rate
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;capability
op_amp
id|CAN_AC3
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* enable AC3 */
r_if
c_cond
(paren
id|rate
op_logical_and
id|rate
op_ne
l_int|44100
)paren
id|rate
op_assign
l_int|48000
suffix:semicolon
r_if
c_cond
(paren
id|rate
op_eq
l_int|48000
op_logical_or
id|rate
op_eq
l_int|44100
)paren
(brace
singleline_comment|// mute DAC
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER1
comma
op_complement
l_int|0
comma
id|WSMUTE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;chip_version
op_ge
l_int|39
)paren
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC_CTRL
comma
op_complement
l_int|0
comma
id|MUTECH1
)paren
suffix:semicolon
singleline_comment|// AC3EN for 039, 0x04
r_if
c_cond
(paren
id|s-&gt;chip_version
op_ge
l_int|39
)paren
(brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC_CTRL
op_plus
l_int|2
comma
op_complement
l_int|0
comma
id|AC3_EN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;chip_version
op_eq
l_int|55
)paren
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_SPDIF_CTRL
comma
op_complement
l_int|2
comma
l_int|0
)paren
suffix:semicolon
singleline_comment|// AC3EN for 037, 0x10
)brace
r_else
r_if
c_cond
(paren
id|s-&gt;chip_version
op_eq
l_int|37
)paren
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_CHFORMAT
op_plus
l_int|2
comma
op_complement
l_int|0
comma
l_int|0x10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;capability
op_amp
id|CAN_AC3_HW
)paren
(brace
singleline_comment|// SPD24SEL for 039, 0x20, but cannot be set
r_if
c_cond
(paren
id|s-&gt;chip_version
op_eq
l_int|39
)paren
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_CHFORMAT
op_plus
l_int|2
comma
op_complement
l_int|0
comma
id|SPD24SEL
)paren
suffix:semicolon
singleline_comment|// SPD24SEL for 037, 0x02
r_else
r_if
c_cond
(paren
id|s-&gt;chip_version
op_eq
l_int|37
)paren
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_CHFORMAT
op_plus
l_int|2
comma
op_complement
l_int|0
comma
l_int|0x02
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;chip_version
op_ge
l_int|39
)paren
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER1
comma
op_complement
id|CDPLAY
comma
l_int|0
)paren
suffix:semicolon
id|s-&gt;status
op_or_assign
id|DO_AC3_HW
suffix:semicolon
)brace
r_else
(brace
singleline_comment|// SPD32SEL for 037 &amp; 039
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC_CTRL
op_plus
l_int|2
comma
op_complement
l_int|0
comma
id|SPD32SEL
)paren
suffix:semicolon
singleline_comment|// set 176K sample rate to fix 033 HW bug
r_if
c_cond
(paren
id|s-&gt;chip_version
op_eq
l_int|33
)paren
(brace
r_if
c_cond
(paren
id|rate
op_eq
l_int|48000
)paren
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_CHFORMAT
op_plus
l_int|1
comma
op_complement
l_int|0
comma
l_int|0x08
)paren
suffix:semicolon
r_else
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_CHFORMAT
op_plus
l_int|1
comma
op_complement
l_int|0x08
comma
l_int|0
)paren
suffix:semicolon
)brace
id|s-&gt;status
op_or_assign
id|DO_AC3_SW
suffix:semicolon
)brace
)brace
r_else
(brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER1
comma
op_complement
id|WSMUTE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;chip_version
op_ge
l_int|39
)paren
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC_CTRL
comma
op_complement
id|MUTECH1
comma
l_int|0
)paren
suffix:semicolon
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_CHFORMAT
op_plus
l_int|2
comma
op_complement
(paren
id|SPD24SEL
op_or
l_int|0x12
)paren
comma
l_int|0
)paren
suffix:semicolon
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC_CTRL
op_plus
l_int|2
comma
op_complement
(paren
id|SPD32SEL
op_or
id|AC3_EN
)paren
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;chip_version
op_eq
l_int|33
)paren
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_CHFORMAT
op_plus
l_int|1
comma
op_complement
l_int|0x08
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;chip_version
op_ge
l_int|39
)paren
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER1
comma
op_complement
l_int|0
comma
id|CDPLAY
)paren
suffix:semicolon
id|s-&gt;status
op_and_assign
op_complement
id|DO_AC3
suffix:semicolon
)brace
id|s-&gt;spdif_counter
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|set_line_as_rear
r_static
r_void
id|set_line_as_rear
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|use_line_as_rear
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;capability
op_amp
id|CAN_LINE_AS_REAR
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|use_line_as_rear
)paren
(brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER1
comma
op_complement
l_int|0
comma
id|SPK4
)paren
suffix:semicolon
id|s-&gt;status
op_or_assign
id|DO_LINE_AS_REAR
suffix:semicolon
)brace
r_else
(brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER1
comma
op_complement
id|SPK4
comma
l_int|0
)paren
suffix:semicolon
id|s-&gt;status
op_and_assign
op_complement
id|DO_LINE_AS_REAR
suffix:semicolon
)brace
)brace
DECL|function|set_line_as_bass
r_static
r_void
id|set_line_as_bass
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|use_line_as_bass
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;capability
op_amp
id|CAN_LINE_AS_BASS
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|use_line_as_bass
)paren
(brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_LEGACY_CTRL
op_plus
l_int|1
comma
op_complement
l_int|0
comma
id|CB2LIN
)paren
suffix:semicolon
id|s-&gt;status
op_or_assign
id|DO_LINE_AS_BASS
suffix:semicolon
)brace
r_else
(brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_LEGACY_CTRL
op_plus
l_int|1
comma
op_complement
id|CB2LIN
comma
l_int|0
)paren
suffix:semicolon
id|s-&gt;status
op_and_assign
op_complement
id|DO_LINE_AS_BASS
suffix:semicolon
)brace
)brace
DECL|function|set_mic_as_bass
r_static
r_void
id|set_mic_as_bass
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|use_mic_as_bass
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;capability
op_amp
id|CAN_MIC_AS_BASS
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|use_mic_as_bass
)paren
(brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC
comma
op_complement
l_int|0
comma
l_int|0x04
)paren
suffix:semicolon
id|s-&gt;status
op_or_assign
id|DO_MIC_AS_BASS
suffix:semicolon
)brace
r_else
(brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC
comma
op_complement
l_int|0x04
comma
l_int|0
)paren
suffix:semicolon
id|s-&gt;status
op_and_assign
op_complement
id|DO_MIC_AS_BASS
suffix:semicolon
)brace
)brace
DECL|function|set_hw_copy
r_static
r_void
id|set_hw_copy
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|hw_copy
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;max_channels
OG
l_int|2
op_logical_and
id|hw_copy
)paren
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC_CTRL
op_plus
l_int|3
comma
op_complement
l_int|0
comma
id|N4SPK3D
)paren
suffix:semicolon
r_else
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC_CTRL
op_plus
l_int|3
comma
op_complement
id|N4SPK3D
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|set_ac3
r_static
r_void
id|set_ac3
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|rate
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|set_spdifout_unlocked
c_func
(paren
id|s
comma
id|rate
)paren
suffix:semicolon
id|set_ac3_unlocked
c_func
(paren
id|s
comma
id|rate
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|trans_ac3
r_static
r_int
id|trans_ac3
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_void
op_star
id|dest
comma
r_const
r_char
id|__user
op_star
id|source
comma
r_int
id|size
)paren
(brace
r_int
id|i
op_assign
id|size
op_div
l_int|2
suffix:semicolon
r_int
r_int
id|data
suffix:semicolon
r_int
r_int
id|data16
suffix:semicolon
r_int
r_int
op_star
id|dst
op_assign
(paren
r_int
r_int
op_star
)paren
id|dest
suffix:semicolon
r_int
r_int
id|__user
op_star
id|src
op_assign
(paren
r_int
r_int
id|__user
op_star
)paren
id|source
suffix:semicolon
r_int
id|err
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|__get_user
c_func
(paren
id|data16
comma
id|src
op_increment
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
id|data
op_assign
(paren
r_int
r_int
)paren
id|le16_to_cpu
c_func
(paren
id|data16
)paren
suffix:semicolon
id|data
op_lshift_assign
l_int|12
suffix:semicolon
singleline_comment|// ok for 16-bit data
r_if
c_cond
(paren
id|s-&gt;spdif_counter
op_eq
l_int|2
op_logical_or
id|s-&gt;spdif_counter
op_eq
l_int|3
)paren
id|data
op_or_assign
l_int|0x40000000
suffix:semicolon
singleline_comment|// indicate AC-3 raw data
r_if
c_cond
(paren
id|parity
c_func
(paren
id|data
)paren
)paren
id|data
op_or_assign
l_int|0x80000000
suffix:semicolon
singleline_comment|// parity
r_if
c_cond
(paren
id|s-&gt;spdif_counter
op_eq
l_int|0
)paren
id|data
op_or_assign
l_int|3
suffix:semicolon
singleline_comment|// preamble &squot;M&squot;
r_else
r_if
c_cond
(paren
id|s-&gt;spdif_counter
op_amp
l_int|1
)paren
id|data
op_or_assign
l_int|5
suffix:semicolon
singleline_comment|// odd, &squot;W&squot;
r_else
id|data
op_or_assign
l_int|9
suffix:semicolon
singleline_comment|// even, &squot;M&squot;
op_star
id|dst
op_increment
op_assign
id|cpu_to_le32
c_func
(paren
id|data
)paren
suffix:semicolon
id|s-&gt;spdif_counter
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;spdif_counter
op_eq
l_int|384
)paren
id|s-&gt;spdif_counter
op_assign
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|i
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|set_adc_rate_unlocked
r_static
r_void
id|set_adc_rate_unlocked
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|rate
)paren
(brace
r_int
r_char
id|freq
op_assign
l_int|4
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|rate
OG
l_int|48000
)paren
id|rate
op_assign
l_int|48000
suffix:semicolon
r_if
c_cond
(paren
id|rate
OL
l_int|8000
)paren
id|rate
op_assign
l_int|8000
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|rate_lookup
)paren
op_div
r_sizeof
(paren
id|rate_lookup
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|rate
OG
id|rate_lookup
(braket
id|i
)braket
dot
id|lower
op_logical_and
id|rate
op_le
id|rate_lookup
(braket
id|i
)braket
dot
id|upper
)paren
(brace
id|rate
op_assign
id|rate_lookup
(braket
id|i
)braket
dot
id|rate
suffix:semicolon
id|freq
op_assign
id|rate_lookup
(braket
id|i
)braket
dot
id|freq
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|s-&gt;rateadc
op_assign
id|rate
suffix:semicolon
id|freq
op_lshift_assign
id|CM_FREQ_ADCSHIFT
suffix:semicolon
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL1
op_plus
l_int|1
comma
op_complement
id|ASFC
comma
id|freq
)paren
suffix:semicolon
)brace
DECL|function|set_adc_rate
r_static
r_void
id|set_adc_rate
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|rate
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|freq
op_assign
l_int|4
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|rate
OG
l_int|48000
)paren
id|rate
op_assign
l_int|48000
suffix:semicolon
r_if
c_cond
(paren
id|rate
OL
l_int|8000
)paren
id|rate
op_assign
l_int|8000
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|rate_lookup
)paren
op_div
r_sizeof
(paren
id|rate_lookup
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|rate
OG
id|rate_lookup
(braket
id|i
)braket
dot
id|lower
op_logical_and
id|rate
op_le
id|rate_lookup
(braket
id|i
)braket
dot
id|upper
)paren
(brace
id|rate
op_assign
id|rate_lookup
(braket
id|i
)braket
dot
id|rate
suffix:semicolon
id|freq
op_assign
id|rate_lookup
(braket
id|i
)braket
dot
id|freq
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|s-&gt;rateadc
op_assign
id|rate
suffix:semicolon
id|freq
op_lshift_assign
id|CM_FREQ_ADCSHIFT
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL1
op_plus
l_int|1
comma
op_complement
id|ASFC
comma
id|freq
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|set_dac_rate
r_static
r_void
id|set_dac_rate
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|rate
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|freq
op_assign
l_int|4
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|rate
OG
l_int|48000
)paren
id|rate
op_assign
l_int|48000
suffix:semicolon
r_if
c_cond
(paren
id|rate
OL
l_int|8000
)paren
id|rate
op_assign
l_int|8000
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|rate_lookup
)paren
op_div
r_sizeof
(paren
id|rate_lookup
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|rate
OG
id|rate_lookup
(braket
id|i
)braket
dot
id|lower
op_logical_and
id|rate
op_le
id|rate_lookup
(braket
id|i
)braket
dot
id|upper
)paren
(brace
id|rate
op_assign
id|rate_lookup
(braket
id|i
)braket
dot
id|rate
suffix:semicolon
id|freq
op_assign
id|rate_lookup
(braket
id|i
)braket
dot
id|freq
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|s-&gt;ratedac
op_assign
id|rate
suffix:semicolon
id|freq
op_lshift_assign
id|CM_FREQ_DACSHIFT
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL1
op_plus
l_int|1
comma
op_complement
id|DSFC
comma
id|freq
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;curr_channels
op_le
l_int|2
op_logical_and
id|spdif_out
)paren
id|set_spdifout
c_func
(paren
id|s
comma
id|rate
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
id|set_dac1_rate
c_func
(paren
id|s
comma
id|rate
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|reset_adc
r_static
r_inline
r_void
id|reset_adc
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
multiline_comment|/* reset bus master */
id|outb
c_func
(paren
id|s-&gt;enable
op_or
id|RSTADC
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL0
op_plus
l_int|2
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|outb
c_func
(paren
id|s-&gt;enable
op_amp
op_complement
id|RSTADC
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL0
op_plus
l_int|2
)paren
suffix:semicolon
)brace
DECL|function|reset_dac
r_static
r_inline
r_void
id|reset_dac
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
multiline_comment|/* reset bus master */
id|outb
c_func
(paren
id|s-&gt;enable
op_or
id|RSTDAC
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL0
op_plus
l_int|2
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|outb
c_func
(paren
id|s-&gt;enable
op_amp
op_complement
id|RSTDAC
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL0
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
id|reset_adc
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
DECL|function|pause_adc
r_static
r_inline
r_void
id|pause_adc
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL0
comma
op_complement
l_int|0
comma
id|PAUSEADC
)paren
suffix:semicolon
)brace
DECL|function|pause_dac
r_static
r_inline
r_void
id|pause_dac
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL0
comma
op_complement
l_int|0
comma
id|PAUSEDAC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
id|pause_adc
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
DECL|function|disable_adc
r_static
r_inline
r_void
id|disable_adc
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
multiline_comment|/* disable channel */
id|s-&gt;enable
op_and_assign
op_complement
id|ENADC
suffix:semicolon
id|outb
c_func
(paren
id|s-&gt;enable
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL0
op_plus
l_int|2
)paren
suffix:semicolon
id|reset_adc
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
DECL|function|disable_dac
r_static
r_inline
r_void
id|disable_dac
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
multiline_comment|/* disable channel */
id|s-&gt;enable
op_and_assign
op_complement
id|ENDAC
suffix:semicolon
id|outb
c_func
(paren
id|s-&gt;enable
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL0
op_plus
l_int|2
)paren
suffix:semicolon
id|reset_dac
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
id|disable_adc
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
DECL|function|enable_adc
r_static
r_inline
r_void
id|enable_adc
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;enable
op_amp
id|ENADC
)paren
)paren
(brace
multiline_comment|/* enable channel */
id|s-&gt;enable
op_or_assign
id|ENADC
suffix:semicolon
id|outb
c_func
(paren
id|s-&gt;enable
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL0
op_plus
l_int|2
)paren
suffix:semicolon
)brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL0
comma
op_complement
id|PAUSEADC
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|enable_dac_unlocked
r_static
r_inline
r_void
id|enable_dac_unlocked
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;enable
op_amp
id|ENDAC
)paren
)paren
(brace
multiline_comment|/* enable channel */
id|s-&gt;enable
op_or_assign
id|ENDAC
suffix:semicolon
id|outb
c_func
(paren
id|s-&gt;enable
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL0
op_plus
l_int|2
)paren
suffix:semicolon
)brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL0
comma
op_complement
id|PAUSEDAC
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
id|enable_adc
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
DECL|function|stop_adc_unlocked
r_static
r_inline
r_void
id|stop_adc_unlocked
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;enable
op_amp
id|ENADC
)paren
(brace
multiline_comment|/* disable interrupt */
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_INT_HLDCLR
op_plus
l_int|2
comma
op_complement
id|ENADCINT
comma
l_int|0
)paren
suffix:semicolon
id|disable_adc
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
)brace
DECL|function|stop_adc
r_static
r_inline
r_void
id|stop_adc
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|stop_adc_unlocked
c_func
(paren
id|s
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|stop_dac_unlocked
r_static
r_inline
r_void
id|stop_dac_unlocked
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;enable
op_amp
id|ENDAC
)paren
(brace
multiline_comment|/* disable interrupt */
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_INT_HLDCLR
op_plus
l_int|2
comma
op_complement
id|ENDACINT
comma
l_int|0
)paren
suffix:semicolon
id|disable_dac
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
id|stop_dac1_unlocked
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
DECL|function|stop_dac
r_static
r_inline
r_void
id|stop_dac
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|stop_dac_unlocked
c_func
(paren
id|s
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|start_adc_unlocked
r_static
r_inline
r_void
id|start_adc_unlocked
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
r_if
c_cond
(paren
(paren
id|s-&gt;dma_adc.mapped
op_logical_or
id|s-&gt;dma_adc.count
OL
(paren
r_int
)paren
(paren
id|s-&gt;dma_adc.dmasize
op_minus
l_int|2
op_star
id|s-&gt;dma_adc.fragsize
)paren
)paren
op_logical_and
id|s-&gt;dma_adc.ready
)paren
(brace
multiline_comment|/* enable interrupt */
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_INT_HLDCLR
op_plus
l_int|2
comma
op_complement
l_int|0
comma
id|ENADCINT
)paren
suffix:semicolon
id|enable_adc
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
)brace
DECL|function|start_adc
r_static
r_void
id|start_adc
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|start_adc_unlocked
c_func
(paren
id|s
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|start_dac1_unlocked
r_static
r_void
id|start_dac1_unlocked
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
r_if
c_cond
(paren
(paren
id|s-&gt;dma_adc.mapped
op_logical_or
id|s-&gt;dma_adc.count
OG
l_int|0
)paren
op_logical_and
id|s-&gt;dma_adc.ready
)paren
(brace
multiline_comment|/* enable interrupt */
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_INT_HLDCLR
op_plus
l_int|2
comma
op_complement
l_int|0
comma
id|ENADCINT
)paren
suffix:semicolon
id|enable_dac_unlocked
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
)brace
DECL|function|start_dac_unlocked
r_static
r_void
id|start_dac_unlocked
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
r_if
c_cond
(paren
(paren
id|s-&gt;dma_dac.mapped
op_logical_or
id|s-&gt;dma_dac.count
OG
l_int|0
)paren
op_logical_and
id|s-&gt;dma_dac.ready
)paren
(brace
multiline_comment|/* enable interrupt */
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_INT_HLDCLR
op_plus
l_int|2
comma
op_complement
l_int|0
comma
id|ENDACINT
)paren
suffix:semicolon
id|enable_dac_unlocked
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
id|start_dac1_unlocked
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
DECL|function|start_dac
r_static
r_void
id|start_dac
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|start_dac_unlocked
c_func
(paren
id|s
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_int
id|prog_dmabuf
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|rec
)paren
suffix:semicolon
DECL|function|set_dac_channels
r_static
r_int
id|set_dac_channels
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|channels
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_static
r_int
r_int
id|fmmute
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|channels
OG
l_int|2
)paren
op_logical_and
(paren
id|channels
op_le
id|s-&gt;max_channels
)paren
op_logical_and
(paren
(paren
(paren
id|s-&gt;fmt
op_rshift
id|CM_CFMT_DACSHIFT
)paren
op_amp
id|CM_CFMT_MASK
)paren
op_eq
(paren
id|CM_CFMT_STEREO
op_or
id|CM_CFMT_16BIT
)paren
)paren
)paren
(brace
id|set_spdifout_unlocked
c_func
(paren
id|s
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;capability
op_amp
id|CAN_MULTI_CH_HW
)paren
(brace
singleline_comment|// NXCHG
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_LEGACY_CTRL
op_plus
l_int|3
comma
op_complement
l_int|0
comma
id|NXCHG
)paren
suffix:semicolon
singleline_comment|// CHB3D or CHB3D5C
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_CHFORMAT
op_plus
l_int|3
comma
op_complement
(paren
id|CHB3D5C
op_or
id|CHB3D
)paren
comma
id|channels
OG
l_int|4
ques
c_cond
id|CHB3D5C
suffix:colon
id|CHB3D
)paren
suffix:semicolon
singleline_comment|// CHB3D6C
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_LEGACY_CTRL
op_plus
l_int|1
comma
op_complement
id|CHB3D6C
comma
id|channels
op_eq
l_int|6
ques
c_cond
id|CHB3D6C
suffix:colon
l_int|0
)paren
suffix:semicolon
singleline_comment|// ENCENTER
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC_CTRL
comma
op_complement
id|ENCENTER
comma
id|channels
op_eq
l_int|6
ques
c_cond
id|ENCENTER
suffix:colon
l_int|0
)paren
suffix:semicolon
id|s-&gt;status
op_or_assign
id|DO_MULTI_CH_HW
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|s-&gt;capability
op_amp
id|CAN_DUAL_DAC
)paren
(brace
r_int
r_char
id|fmtm
op_assign
op_complement
l_int|0
comma
id|fmts
op_assign
l_int|0
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
singleline_comment|// ENDBDAC, turn on double DAC mode
singleline_comment|// XCHGDAC, CH0 -&gt; back, CH1-&gt;front
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC_CTRL
op_plus
l_int|2
comma
op_complement
l_int|0
comma
id|ENDBDAC
op_or
id|XCHGDAC
)paren
suffix:semicolon
singleline_comment|// mute FM
id|fmmute
op_assign
id|inb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER1
)paren
op_amp
id|FMMUTE
suffix:semicolon
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER1
comma
op_complement
l_int|0
comma
id|FMMUTE
)paren
suffix:semicolon
id|s-&gt;status
op_or_assign
id|DO_DUAL_DAC
suffix:semicolon
singleline_comment|// prepare secondary buffer
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
singleline_comment|// copy the hw state
id|fmtm
op_and_assign
op_complement
(paren
(paren
id|CM_CFMT_STEREO
op_or
id|CM_CFMT_16BIT
)paren
op_lshift
id|CM_CFMT_DACSHIFT
)paren
suffix:semicolon
id|fmtm
op_and_assign
op_complement
(paren
(paren
id|CM_CFMT_STEREO
op_or
id|CM_CFMT_16BIT
)paren
op_lshift
id|CM_CFMT_ADCSHIFT
)paren
suffix:semicolon
singleline_comment|// the HW only support 16-bit stereo
id|fmts
op_or_assign
id|CM_CFMT_16BIT
op_lshift
id|CM_CFMT_DACSHIFT
suffix:semicolon
id|fmts
op_or_assign
id|CM_CFMT_16BIT
op_lshift
id|CM_CFMT_ADCSHIFT
suffix:semicolon
id|fmts
op_or_assign
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_DACSHIFT
suffix:semicolon
id|fmts
op_or_assign
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_ADCSHIFT
suffix:semicolon
id|set_fmt_unlocked
c_func
(paren
id|s
comma
id|fmtm
comma
id|fmts
)paren
suffix:semicolon
id|set_adc_rate_unlocked
c_func
(paren
id|s
comma
id|s-&gt;ratedac
)paren
suffix:semicolon
)brace
singleline_comment|// disable 4 speaker mode (analog duplicate)
id|set_hw_copy
c_func
(paren
id|s
comma
l_int|0
)paren
suffix:semicolon
id|s-&gt;curr_channels
op_assign
id|channels
suffix:semicolon
singleline_comment|// enable jack redirect
id|set_line_as_rear
c_func
(paren
id|s
comma
id|use_line_as_rear
)paren
suffix:semicolon
r_if
c_cond
(paren
id|channels
OG
l_int|4
)paren
(brace
id|set_line_as_bass
c_func
(paren
id|s
comma
id|use_line_as_bass
)paren
suffix:semicolon
id|set_mic_as_bass
c_func
(paren
id|s
comma
id|use_mic_as_bass
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_MULTI_CH_HW
)paren
(brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_LEGACY_CTRL
op_plus
l_int|3
comma
op_complement
id|NXCHG
comma
l_int|0
)paren
suffix:semicolon
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_CHFORMAT
op_plus
l_int|3
comma
op_complement
(paren
id|CHB3D5C
op_or
id|CHB3D
)paren
comma
l_int|0
)paren
suffix:semicolon
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_LEGACY_CTRL
op_plus
l_int|1
comma
op_complement
id|CHB3D6C
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
(brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC_CTRL
op_plus
l_int|2
comma
op_complement
id|ENDBDAC
comma
l_int|0
)paren
suffix:semicolon
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER1
comma
op_complement
id|FMMUTE
comma
id|fmmute
)paren
suffix:semicolon
)brace
singleline_comment|// enable 4 speaker mode (analog duplicate)
id|set_hw_copy
c_func
(paren
id|s
comma
id|hw_copy
)paren
suffix:semicolon
id|s-&gt;status
op_and_assign
op_complement
id|DO_MULTI_CH
suffix:semicolon
id|s-&gt;curr_channels
op_assign
id|s-&gt;fmt
op_amp
(paren
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_DACSHIFT
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
suffix:semicolon
singleline_comment|// disable jack redirect
id|set_line_as_rear
c_func
(paren
id|s
comma
id|hw_copy
ques
c_cond
id|use_line_as_rear
suffix:colon
l_int|0
)paren
suffix:semicolon
id|set_line_as_bass
c_func
(paren
id|s
comma
l_int|0
)paren
suffix:semicolon
id|set_mic_as_bass
c_func
(paren
id|s
comma
l_int|0
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|s-&gt;curr_channels
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|macro|DMABUF_DEFAULTORDER
mdefine_line|#define DMABUF_DEFAULTORDER (16-PAGE_SHIFT)
DECL|macro|DMABUF_MINORDER
mdefine_line|#define DMABUF_MINORDER 1
DECL|function|dealloc_dmabuf
r_static
r_void
id|dealloc_dmabuf
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_struct
id|dmabuf
op_star
id|db
)paren
(brace
r_struct
id|page
op_star
id|pstart
comma
op_star
id|pend
suffix:semicolon
r_if
c_cond
(paren
id|db-&gt;rawbuf
)paren
(brace
multiline_comment|/* undo marking the pages as reserved */
id|pend
op_assign
id|virt_to_page
c_func
(paren
id|db-&gt;rawbuf
op_plus
(paren
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|pstart
op_assign
id|virt_to_page
c_func
(paren
id|db-&gt;rawbuf
)paren
suffix:semicolon
id|pstart
op_le
id|pend
suffix:semicolon
id|pstart
op_increment
)paren
id|ClearPageReserved
c_func
(paren
id|pstart
)paren
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|s-&gt;dev
comma
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
comma
id|db-&gt;rawbuf
comma
id|db-&gt;dmaaddr
)paren
suffix:semicolon
)brace
id|db-&gt;rawbuf
op_assign
l_int|NULL
suffix:semicolon
id|db-&gt;mapped
op_assign
id|db-&gt;ready
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Ch1 is used for playback, Ch0 is used for recording */
DECL|function|prog_dmabuf
r_static
r_int
id|prog_dmabuf
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|rec
)paren
(brace
r_struct
id|dmabuf
op_star
id|db
op_assign
id|rec
ques
c_cond
op_amp
id|s-&gt;dma_adc
suffix:colon
op_amp
id|s-&gt;dma_dac
suffix:semicolon
r_int
id|rate
op_assign
id|rec
ques
c_cond
id|s-&gt;rateadc
suffix:colon
id|s-&gt;ratedac
suffix:semicolon
r_int
id|order
suffix:semicolon
r_int
id|bytepersec
suffix:semicolon
r_int
id|bufs
suffix:semicolon
r_struct
id|page
op_star
id|pstart
comma
op_star
id|pend
suffix:semicolon
r_int
r_char
id|fmt
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|fmt
op_assign
id|s-&gt;fmt
suffix:semicolon
r_if
c_cond
(paren
id|rec
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|fmt
op_rshift_assign
id|CM_CFMT_ADCSHIFT
suffix:semicolon
)brace
r_else
(brace
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|fmt
op_rshift_assign
id|CM_CFMT_DACSHIFT
suffix:semicolon
)brace
id|fmt
op_and_assign
id|CM_CFMT_MASK
suffix:semicolon
id|db-&gt;hwptr
op_assign
id|db-&gt;swptr
op_assign
id|db-&gt;total_bytes
op_assign
id|db-&gt;count
op_assign
id|db-&gt;error
op_assign
id|db-&gt;endcleared
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|db-&gt;rawbuf
)paren
(brace
id|db-&gt;ready
op_assign
id|db-&gt;mapped
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|order
op_assign
id|DMABUF_DEFAULTORDER
suffix:semicolon
id|order
op_ge
id|DMABUF_MINORDER
suffix:semicolon
id|order
op_decrement
)paren
r_if
c_cond
(paren
(paren
id|db-&gt;rawbuf
op_assign
id|pci_alloc_consistent
c_func
(paren
id|s-&gt;dev
comma
id|PAGE_SIZE
op_lshift
id|order
comma
op_amp
id|db-&gt;dmaaddr
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|db-&gt;rawbuf
op_logical_or
op_logical_neg
id|db-&gt;dmaaddr
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|db-&gt;buforder
op_assign
id|order
suffix:semicolon
multiline_comment|/* now mark the pages as reserved; otherwise remap_pfn_range doesn&squot;t do what we want */
id|pend
op_assign
id|virt_to_page
c_func
(paren
id|db-&gt;rawbuf
op_plus
(paren
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|pstart
op_assign
id|virt_to_page
c_func
(paren
id|db-&gt;rawbuf
)paren
suffix:semicolon
id|pstart
op_le
id|pend
suffix:semicolon
id|pstart
op_increment
)paren
id|SetPageReserved
c_func
(paren
id|pstart
)paren
suffix:semicolon
)brace
id|bytepersec
op_assign
id|rate
op_lshift
id|sample_shift
(braket
id|fmt
)braket
suffix:semicolon
id|bufs
op_assign
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
suffix:semicolon
r_if
c_cond
(paren
id|db-&gt;ossfragshift
)paren
(brace
r_if
c_cond
(paren
(paren
l_int|1000
op_lshift
id|db-&gt;ossfragshift
)paren
OL
id|bytepersec
)paren
id|db-&gt;fragshift
op_assign
id|ld2
c_func
(paren
id|bytepersec
op_div
l_int|1000
)paren
suffix:semicolon
r_else
id|db-&gt;fragshift
op_assign
id|db-&gt;ossfragshift
suffix:semicolon
)brace
r_else
(brace
id|db-&gt;fragshift
op_assign
id|ld2
c_func
(paren
id|bytepersec
op_div
l_int|100
op_div
(paren
id|db-&gt;subdivision
ques
c_cond
id|db-&gt;subdivision
suffix:colon
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|db-&gt;fragshift
OL
l_int|3
)paren
id|db-&gt;fragshift
op_assign
l_int|3
suffix:semicolon
)brace
id|db-&gt;numfrag
op_assign
id|bufs
op_rshift
id|db-&gt;fragshift
suffix:semicolon
r_while
c_loop
(paren
id|db-&gt;numfrag
template_param
l_int|3
)paren
(brace
id|db-&gt;fragshift
op_decrement
suffix:semicolon
id|db-&gt;numfrag
op_assign
id|bufs
op_rshift
id|db-&gt;fragshift
suffix:semicolon
)brace
id|db-&gt;fragsize
op_assign
l_int|1
op_lshift
id|db-&gt;fragshift
suffix:semicolon
r_if
c_cond
(paren
id|db-&gt;ossmaxfrags
op_ge
l_int|4
op_logical_and
id|db-&gt;ossmaxfrags
OL
id|db-&gt;numfrag
)paren
id|db-&gt;numfrag
op_assign
id|db-&gt;ossmaxfrags
suffix:semicolon
multiline_comment|/* to make fragsize &gt;= 4096 */
id|db-&gt;fragsamples
op_assign
id|db-&gt;fragsize
op_rshift
id|sample_shift
(braket
id|fmt
)braket
suffix:semicolon
id|db-&gt;dmasize
op_assign
id|db-&gt;numfrag
op_lshift
id|db-&gt;fragshift
suffix:semicolon
id|db-&gt;dmasamples
op_assign
id|db-&gt;dmasize
op_rshift
id|sample_shift
(braket
id|fmt
)braket
suffix:semicolon
id|memset
c_func
(paren
id|db-&gt;rawbuf
comma
(paren
id|fmt
op_amp
id|CM_CFMT_16BIT
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|0x80
comma
id|db-&gt;dmasize
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rec
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
id|set_dmadac1
c_func
(paren
id|s
comma
id|db-&gt;dmaaddr
comma
id|db-&gt;dmasize
op_rshift
id|sample_shift
(braket
id|fmt
)braket
)paren
suffix:semicolon
r_else
id|set_dmaadc
c_func
(paren
id|s
comma
id|db-&gt;dmaaddr
comma
id|db-&gt;dmasize
op_rshift
id|sample_shift
(braket
id|fmt
)braket
)paren
suffix:semicolon
multiline_comment|/* program sample counts */
id|set_countdac
c_func
(paren
id|s
comma
id|db-&gt;fragsamples
)paren
suffix:semicolon
)brace
r_else
(brace
id|set_dmadac
c_func
(paren
id|s
comma
id|db-&gt;dmaaddr
comma
id|db-&gt;dmasize
op_rshift
id|sample_shift
(braket
id|fmt
)braket
)paren
suffix:semicolon
multiline_comment|/* program sample counts */
id|set_countdac
c_func
(paren
id|s
comma
id|db-&gt;fragsamples
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|db-&gt;enabled
op_assign
l_int|1
suffix:semicolon
id|db-&gt;ready
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|clear_advance
r_static
r_inline
r_void
id|clear_advance
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
r_int
r_char
id|c
op_assign
(paren
id|s-&gt;fmt
op_amp
(paren
id|CM_CFMT_16BIT
op_lshift
id|CM_CFMT_DACSHIFT
)paren
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|0x80
suffix:semicolon
r_int
r_char
op_star
id|buf
op_assign
id|s-&gt;dma_dac.rawbuf
suffix:semicolon
r_int
r_char
op_star
id|buf1
op_assign
id|s-&gt;dma_adc.rawbuf
suffix:semicolon
r_int
id|bsize
op_assign
id|s-&gt;dma_dac.dmasize
suffix:semicolon
r_int
id|bptr
op_assign
id|s-&gt;dma_dac.swptr
suffix:semicolon
r_int
id|len
op_assign
id|s-&gt;dma_dac.fragsize
suffix:semicolon
r_if
c_cond
(paren
id|bptr
op_plus
id|len
OG
id|bsize
)paren
(brace
r_int
id|x
op_assign
id|bsize
op_minus
id|bptr
suffix:semicolon
id|memset
c_func
(paren
id|buf
op_plus
id|bptr
comma
id|c
comma
id|x
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
id|memset
c_func
(paren
id|buf1
op_plus
id|bptr
comma
id|c
comma
id|x
)paren
suffix:semicolon
id|bptr
op_assign
l_int|0
suffix:semicolon
id|len
op_sub_assign
id|x
suffix:semicolon
)brace
id|memset
c_func
(paren
id|buf
op_plus
id|bptr
comma
id|c
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
id|memset
c_func
(paren
id|buf1
op_plus
id|bptr
comma
id|c
comma
id|len
)paren
suffix:semicolon
)brace
multiline_comment|/* call with spinlock held! */
DECL|function|cm_update_ptr
r_static
r_void
id|cm_update_ptr
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
r_int
id|hwptr
suffix:semicolon
r_int
id|diff
suffix:semicolon
multiline_comment|/* update ADC pointer */
r_if
c_cond
(paren
id|s-&gt;dma_adc.ready
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
(brace
multiline_comment|/* the dac part will finish for this */
)brace
r_else
(brace
id|hwptr
op_assign
id|get_dmaadc
c_func
(paren
id|s
)paren
op_mod
id|s-&gt;dma_adc.dmasize
suffix:semicolon
id|diff
op_assign
(paren
id|s-&gt;dma_adc.dmasize
op_plus
id|hwptr
op_minus
id|s-&gt;dma_adc.hwptr
)paren
op_mod
id|s-&gt;dma_adc.dmasize
suffix:semicolon
id|s-&gt;dma_adc.hwptr
op_assign
id|hwptr
suffix:semicolon
id|s-&gt;dma_adc.total_bytes
op_add_assign
id|diff
suffix:semicolon
id|s-&gt;dma_adc.count
op_add_assign
id|diff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.count
op_ge
(paren
r_int
)paren
id|s-&gt;dma_adc.fragsize
)paren
id|wake_up
c_func
(paren
op_amp
id|s-&gt;dma_adc.wait
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.mapped
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_adc.count
OG
(paren
r_int
)paren
(paren
id|s-&gt;dma_adc.dmasize
op_minus
(paren
(paren
l_int|3
op_star
id|s-&gt;dma_adc.fragsize
)paren
op_rshift
l_int|1
)paren
)paren
)paren
(brace
id|pause_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_adc.error
op_increment
suffix:semicolon
)brace
)brace
)brace
)brace
multiline_comment|/* update DAC pointer */
r_if
c_cond
(paren
id|s-&gt;dma_dac.ready
)paren
(brace
id|hwptr
op_assign
id|get_dmadac
c_func
(paren
id|s
)paren
op_mod
id|s-&gt;dma_dac.dmasize
suffix:semicolon
id|diff
op_assign
(paren
id|s-&gt;dma_dac.dmasize
op_plus
id|hwptr
op_minus
id|s-&gt;dma_dac.hwptr
)paren
op_mod
id|s-&gt;dma_dac.dmasize
suffix:semicolon
id|s-&gt;dma_dac.hwptr
op_assign
id|hwptr
suffix:semicolon
id|s-&gt;dma_dac.total_bytes
op_add_assign
id|diff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
(brace
id|s-&gt;dma_adc.hwptr
op_assign
id|hwptr
suffix:semicolon
id|s-&gt;dma_adc.total_bytes
op_add_assign
id|diff
suffix:semicolon
)brace
r_if
c_cond
(paren
id|s-&gt;dma_dac.mapped
)paren
(brace
id|s-&gt;dma_dac.count
op_add_assign
id|diff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
id|s-&gt;dma_adc.count
op_add_assign
id|diff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
op_ge
(paren
r_int
)paren
id|s-&gt;dma_dac.fragsize
)paren
id|wake_up
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
)paren
suffix:semicolon
)brace
r_else
(brace
id|s-&gt;dma_dac.count
op_sub_assign
id|diff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
id|s-&gt;dma_adc.count
op_sub_assign
id|diff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
op_le
l_int|0
)paren
(brace
id|pause_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_dac.error
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
op_le
(paren
r_int
)paren
id|s-&gt;dma_dac.fragsize
op_logical_and
op_logical_neg
id|s-&gt;dma_dac.endcleared
)paren
(brace
id|clear_advance
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_dac.endcleared
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
id|s-&gt;dma_adc.endcleared
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
op_plus
(paren
r_int
)paren
id|s-&gt;dma_dac.fragsize
op_le
(paren
r_int
)paren
id|s-&gt;dma_dac.dmasize
)paren
id|wake_up
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|cm_interrupt
r_static
id|irqreturn_t
id|cm_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|cm_state
op_star
id|s
op_assign
(paren
r_struct
id|cm_state
op_star
)paren
id|dev_id
suffix:semicolon
r_int
r_int
id|intsrc
comma
id|intstat
suffix:semicolon
r_int
r_char
id|mask
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* fastpath out, to ease interrupt sharing */
id|intsrc
op_assign
id|inl
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_INT_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|intsrc
op_amp
l_int|0x80000000
)paren
)paren
r_return
id|IRQ_NONE
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|s-&gt;lock
)paren
suffix:semicolon
id|intstat
op_assign
id|inb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_INT_HLDCLR
op_plus
l_int|2
)paren
suffix:semicolon
multiline_comment|/* acknowledge interrupt */
r_if
c_cond
(paren
id|intsrc
op_amp
id|ADCINT
)paren
id|mask
op_or_assign
id|ENADCINT
suffix:semicolon
r_if
c_cond
(paren
id|intsrc
op_amp
id|DACINT
)paren
id|mask
op_or_assign
id|ENDACINT
suffix:semicolon
id|outb
c_func
(paren
id|intstat
op_amp
op_complement
id|mask
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_INT_HLDCLR
op_plus
l_int|2
)paren
suffix:semicolon
id|outb
c_func
(paren
id|intstat
op_or
id|mask
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_INT_HLDCLR
op_plus
l_int|2
)paren
suffix:semicolon
id|cm_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|s-&gt;lock
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SOUND_CMPCI_MIDI
r_if
c_cond
(paren
id|intsrc
op_amp
l_int|0x00010000
)paren
(brace
singleline_comment|// UART interrupt
r_if
c_cond
(paren
id|s-&gt;midi_devc
op_logical_and
id|intchk_mpu401
c_func
(paren
(paren
r_void
op_star
)paren
id|s-&gt;midi_devc
)paren
)paren
id|mpuintr
c_func
(paren
id|irq
comma
(paren
r_void
op_star
)paren
id|s-&gt;midi_devc
comma
id|regs
)paren
suffix:semicolon
r_else
id|inb
c_func
(paren
id|s-&gt;iomidi
)paren
suffix:semicolon
singleline_comment|// dummy read
)brace
macro_line|#endif
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|variable|invalid_magic
r_static
r_const
r_char
id|invalid_magic
(braket
)braket
op_assign
id|KERN_CRIT
l_string|&quot;cmpci: invalid magic value&bslash;n&quot;
suffix:semicolon
DECL|macro|VALIDATE_STATE
mdefine_line|#define VALIDATE_STATE(s)                         &bslash;&n;({                                                &bslash;&n;&t;if (!(s) || (s)-&gt;magic != CM_MAGIC) { &bslash;&n;&t;&t;printk(invalid_magic);            &bslash;&n;&t;&t;return -ENXIO;                    &bslash;&n;&t;}                                         &bslash;&n;})
multiline_comment|/* --------------------------------------------------------------------- */
DECL|macro|MT_4
mdefine_line|#define MT_4          1
DECL|macro|MT_5MUTE
mdefine_line|#define MT_5MUTE      2
DECL|macro|MT_4MUTEMONO
mdefine_line|#define MT_4MUTEMONO  3
DECL|macro|MT_6MUTE
mdefine_line|#define MT_6MUTE      4
DECL|macro|MT_5MUTEMONO
mdefine_line|#define MT_5MUTEMONO  5
r_static
r_const
r_struct
(brace
DECL|member|left
r_int
id|left
suffix:semicolon
DECL|member|right
r_int
id|right
suffix:semicolon
DECL|member|type
r_int
id|type
suffix:semicolon
DECL|member|rec
r_int
id|rec
suffix:semicolon
DECL|member|play
r_int
id|play
suffix:semicolon
DECL|variable|mixtable
)brace
id|mixtable
(braket
id|SOUND_MIXER_NRDEVICES
)braket
op_assign
(brace
(braket
id|SOUND_MIXER_CD
)braket
op_assign
(brace
id|DSP_MIX_CDVOLIDX_L
comma
id|DSP_MIX_CDVOLIDX_R
comma
id|MT_5MUTE
comma
l_int|0x04
comma
l_int|0x06
)brace
comma
(braket
id|SOUND_MIXER_LINE
)braket
op_assign
(brace
id|DSP_MIX_LINEVOLIDX_L
comma
id|DSP_MIX_LINEVOLIDX_R
comma
id|MT_5MUTE
comma
l_int|0x10
comma
l_int|0x18
)brace
comma
(braket
id|SOUND_MIXER_MIC
)braket
op_assign
(brace
id|DSP_MIX_MICVOLIDX
comma
id|DSP_MIX_MICVOLIDX
comma
id|MT_5MUTEMONO
comma
l_int|0x01
comma
l_int|0x01
)brace
comma
(braket
id|SOUND_MIXER_SYNTH
)braket
op_assign
(brace
id|DSP_MIX_FMVOLIDX_L
comma
id|DSP_MIX_FMVOLIDX_R
comma
id|MT_5MUTE
comma
l_int|0x40
comma
l_int|0x00
)brace
comma
(braket
id|SOUND_MIXER_VOLUME
)braket
op_assign
(brace
id|DSP_MIX_MASTERVOLIDX_L
comma
id|DSP_MIX_MASTERVOLIDX_R
comma
id|MT_5MUTE
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(braket
id|SOUND_MIXER_PCM
)braket
op_assign
(brace
id|DSP_MIX_VOICEVOLIDX_L
comma
id|DSP_MIX_VOICEVOLIDX_R
comma
id|MT_5MUTE
comma
l_int|0x00
comma
l_int|0x00
)brace
comma
(braket
id|SOUND_MIXER_LINE1
)braket
op_assign
(brace
id|DSP_MIX_AUXVOL_L
comma
id|DSP_MIX_AUXVOL_R
comma
id|MT_5MUTE
comma
l_int|0x80
comma
l_int|0x60
)brace
comma
(braket
id|SOUND_MIXER_SPEAKER
)braket
op_assign
(brace
id|DSP_MIX_SPKRVOLIDX
comma
id|DSP_MIX_SPKRVOLIDX
comma
id|MT_5MUTEMONO
comma
l_int|0x00
comma
l_int|0x01
)brace
)brace
suffix:semicolon
DECL|variable|volidx
r_static
r_const
r_int
r_char
id|volidx
(braket
id|SOUND_MIXER_NRDEVICES
)braket
op_assign
(brace
(braket
id|SOUND_MIXER_CD
)braket
op_assign
l_int|1
comma
(braket
id|SOUND_MIXER_LINE
)braket
op_assign
l_int|2
comma
(braket
id|SOUND_MIXER_MIC
)braket
op_assign
l_int|3
comma
(braket
id|SOUND_MIXER_SYNTH
)braket
op_assign
l_int|4
comma
(braket
id|SOUND_MIXER_VOLUME
)braket
op_assign
l_int|5
comma
(braket
id|SOUND_MIXER_PCM
)braket
op_assign
l_int|6
comma
(braket
id|SOUND_MIXER_LINE1
)braket
op_assign
l_int|7
comma
(braket
id|SOUND_MIXER_SPEAKER
)braket
op_assign
l_int|8
)brace
suffix:semicolon
DECL|function|mixer_outmask
r_static
r_int
id|mixer_outmask
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|k
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|j
op_assign
id|rdmixer
c_func
(paren
id|s
comma
id|DSP_MIX_OUTMIXIDX
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SOUND_MIXER_NRDEVICES
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|j
op_amp
id|mixtable
(braket
id|i
)braket
dot
id|play
)paren
id|k
op_or_assign
l_int|1
op_lshift
id|i
suffix:semicolon
r_return
id|k
suffix:semicolon
)brace
DECL|function|mixer_recmask
r_static
r_int
id|mixer_recmask
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|k
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|j
op_assign
id|rdmixer
c_func
(paren
id|s
comma
id|DSP_MIX_ADCMIXIDX_L
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SOUND_MIXER_NRDEVICES
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|j
op_amp
id|mixtable
(braket
id|i
)braket
dot
id|rec
)paren
id|k
op_or_assign
l_int|1
op_lshift
id|i
suffix:semicolon
r_return
id|k
suffix:semicolon
)brace
DECL|function|mixer_ioctl
r_static
r_int
id|mixer_ioctl
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
comma
id|val
comma
id|j
suffix:semicolon
r_int
r_char
id|l
comma
id|r
comma
id|rl
comma
id|rr
suffix:semicolon
r_void
id|__user
op_star
id|argp
op_assign
(paren
r_void
id|__user
op_star
)paren
id|arg
suffix:semicolon
r_int
id|__user
op_star
id|p
op_assign
id|argp
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_MIXER_INFO
)paren
(brace
id|mixer_info
id|info
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|info
comma
l_int|0
comma
r_sizeof
(paren
id|info
)paren
)paren
suffix:semicolon
id|strlcpy
c_func
(paren
id|info.id
comma
l_string|&quot;cmpci&quot;
comma
r_sizeof
(paren
id|info.id
)paren
)paren
suffix:semicolon
id|strlcpy
c_func
(paren
id|info.name
comma
l_string|&quot;C-Media PCI&quot;
comma
r_sizeof
(paren
id|info.name
)paren
)paren
suffix:semicolon
id|info.modify_counter
op_assign
id|s-&gt;mix.modcnt
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|SOUND_OLD_MIXER_INFO
)paren
(brace
id|_old_mixer_info
id|info
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|info
comma
l_int|0
comma
r_sizeof
(paren
id|info
)paren
)paren
suffix:semicolon
id|strlcpy
c_func
(paren
id|info.id
comma
l_string|&quot;cmpci&quot;
comma
r_sizeof
(paren
id|info.id
)paren
)paren
suffix:semicolon
id|strlcpy
c_func
(paren
id|info.name
comma
l_string|&quot;C-Media cmpci&quot;
comma
r_sizeof
(paren
id|info.name
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|OSS_GETVERSION
)paren
r_return
id|put_user
c_func
(paren
id|SOUND_VERSION
comma
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|_IOC_TYPE
c_func
(paren
id|cmd
)paren
op_ne
l_char|&squot;M&squot;
op_logical_or
id|_SIOC_SIZE
c_func
(paren
id|cmd
)paren
op_ne
r_sizeof
(paren
r_int
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|_SIOC_DIR
c_func
(paren
id|cmd
)paren
op_eq
id|_SIOC_READ
)paren
(brace
r_switch
c_cond
(paren
id|_IOC_NR
c_func
(paren
id|cmd
)paren
)paren
(brace
r_case
id|SOUND_MIXER_RECSRC
suffix:colon
multiline_comment|/* Arg contains a bit for each recording source */
id|val
op_assign
id|mixer_recmask
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
id|p
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_OUTSRC
suffix:colon
multiline_comment|/* Arg contains a bit for each recording source */
id|val
op_assign
id|mixer_outmask
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
id|p
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_DEVMASK
suffix:colon
multiline_comment|/* Arg contains a bit for each supported device */
r_for
c_loop
(paren
id|val
op_assign
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SOUND_MIXER_NRDEVICES
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|mixtable
(braket
id|i
)braket
dot
id|type
)paren
id|val
op_or_assign
l_int|1
op_lshift
id|i
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
id|p
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_RECMASK
suffix:colon
multiline_comment|/* Arg contains a bit for each supported recording source */
r_for
c_loop
(paren
id|val
op_assign
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SOUND_MIXER_NRDEVICES
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|mixtable
(braket
id|i
)braket
dot
id|rec
)paren
id|val
op_or_assign
l_int|1
op_lshift
id|i
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
id|p
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_OUTMASK
suffix:colon
multiline_comment|/* Arg contains a bit for each supported recording source */
r_for
c_loop
(paren
id|val
op_assign
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SOUND_MIXER_NRDEVICES
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|mixtable
(braket
id|i
)braket
dot
id|play
)paren
id|val
op_or_assign
l_int|1
op_lshift
id|i
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
id|p
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_STEREODEVS
suffix:colon
multiline_comment|/* Mixer channels supporting stereo */
r_for
c_loop
(paren
id|val
op_assign
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SOUND_MIXER_NRDEVICES
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|mixtable
(braket
id|i
)braket
dot
id|type
op_logical_and
id|mixtable
(braket
id|i
)braket
dot
id|type
op_ne
id|MT_4MUTEMONO
)paren
id|val
op_or_assign
l_int|1
op_lshift
id|i
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
id|p
)paren
suffix:semicolon
r_case
id|SOUND_MIXER_CAPS
suffix:colon
r_return
id|put_user
c_func
(paren
l_int|0
comma
id|p
)paren
suffix:semicolon
r_default
suffix:colon
id|i
op_assign
id|_IOC_NR
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|SOUND_MIXER_NRDEVICES
op_logical_or
op_logical_neg
id|mixtable
(braket
id|i
)braket
dot
id|type
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|volidx
(braket
id|i
)braket
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|s-&gt;mix.vol
(braket
id|volidx
(braket
id|i
)braket
op_minus
l_int|1
)braket
comma
id|p
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|_SIOC_DIR
c_func
(paren
id|cmd
)paren
op_ne
(paren
id|_SIOC_READ
op_or
id|_SIOC_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|s-&gt;mix.modcnt
op_increment
suffix:semicolon
r_switch
c_cond
(paren
id|_IOC_NR
c_func
(paren
id|cmd
)paren
)paren
(brace
r_case
id|SOUND_MIXER_RECSRC
suffix:colon
multiline_comment|/* Arg contains a bit for each recording source */
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
id|p
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|i
op_assign
id|generic_hweight32
c_func
(paren
id|val
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SOUND_MIXER_NRDEVICES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|val
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mixtable
(braket
id|i
)braket
dot
id|rec
)paren
(brace
id|val
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|j
op_or_assign
id|mixtable
(braket
id|i
)braket
dot
id|rec
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|wrmixer
c_func
(paren
id|s
comma
id|DSP_MIX_ADCMIXIDX_L
comma
id|j
)paren
suffix:semicolon
id|wrmixer
c_func
(paren
id|s
comma
id|DSP_MIX_ADCMIXIDX_R
comma
(paren
id|j
op_amp
l_int|1
)paren
op_or
(paren
id|j
op_rshift
l_int|1
)paren
op_or
(paren
id|j
op_amp
l_int|0x80
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SOUND_MIXER_OUTSRC
suffix:colon
multiline_comment|/* Arg contains a bit for each recording source */
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
id|p
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SOUND_MIXER_NRDEVICES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|val
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mixtable
(braket
id|i
)braket
dot
id|play
)paren
(brace
id|val
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|j
op_or_assign
id|mixtable
(braket
id|i
)braket
dot
id|play
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|wrmixer
c_func
(paren
id|s
comma
id|DSP_MIX_OUTMIXIDX
comma
id|j
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
id|i
op_assign
id|_IOC_NR
c_func
(paren
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
id|SOUND_MIXER_NRDEVICES
op_logical_or
op_logical_neg
id|mixtable
(braket
id|i
)braket
dot
id|type
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
id|p
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|l
op_assign
id|val
op_amp
l_int|0xff
suffix:semicolon
id|r
op_assign
(paren
id|val
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|l
OG
l_int|100
)paren
id|l
op_assign
l_int|100
suffix:semicolon
r_if
c_cond
(paren
id|r
OG
l_int|100
)paren
id|r
op_assign
l_int|100
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|mixtable
(braket
id|i
)braket
dot
id|type
)paren
(brace
r_case
id|MT_4
suffix:colon
r_if
c_cond
(paren
id|l
op_ge
l_int|10
)paren
id|l
op_sub_assign
l_int|10
suffix:semicolon
r_if
c_cond
(paren
id|r
op_ge
l_int|10
)paren
id|r
op_sub_assign
l_int|10
suffix:semicolon
id|frobindir
c_func
(paren
id|s
comma
id|mixtable
(braket
id|i
)braket
dot
id|left
comma
l_int|0xf0
comma
id|l
op_div
l_int|6
)paren
suffix:semicolon
id|frobindir
c_func
(paren
id|s
comma
id|mixtable
(braket
id|i
)braket
dot
id|right
comma
l_int|0xf0
comma
id|l
op_div
l_int|6
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MT_4MUTEMONO
suffix:colon
id|rl
op_assign
(paren
id|l
OL
l_int|4
ques
c_cond
l_int|0
suffix:colon
(paren
id|l
op_minus
l_int|5
)paren
op_div
l_int|3
)paren
op_amp
l_int|31
suffix:semicolon
id|rr
op_assign
(paren
id|rl
op_rshift
l_int|2
)paren
op_amp
l_int|7
suffix:semicolon
id|wrmixer
c_func
(paren
id|s
comma
id|mixtable
(braket
id|i
)braket
dot
id|left
comma
id|rl
op_lshift
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|SOUND_MIXER_MIC
)paren
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER2
comma
op_complement
l_int|0x0e
comma
id|rr
op_lshift
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MT_5MUTEMONO
suffix:colon
id|rl
op_assign
id|l
OL
l_int|4
ques
c_cond
l_int|0
suffix:colon
(paren
id|l
op_minus
l_int|5
)paren
op_div
l_int|3
suffix:semicolon
id|wrmixer
c_func
(paren
id|s
comma
id|mixtable
(braket
id|i
)braket
dot
id|left
comma
id|rl
op_lshift
l_int|3
)paren
suffix:semicolon
id|l
op_assign
id|rdmixer
c_func
(paren
id|s
comma
id|DSP_MIX_OUTMIXIDX
)paren
op_amp
op_complement
id|mixtable
(braket
id|i
)braket
dot
id|play
suffix:semicolon
id|r
op_assign
id|rl
ques
c_cond
id|mixtable
(braket
id|i
)braket
dot
id|play
suffix:colon
l_int|0
suffix:semicolon
id|wrmixer
c_func
(paren
id|s
comma
id|DSP_MIX_OUTMIXIDX
comma
id|l
op_or
id|r
)paren
suffix:semicolon
multiline_comment|/* for recording */
r_if
c_cond
(paren
id|i
op_eq
id|SOUND_MIXER_MIC
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;chip_version
op_ge
l_int|37
)paren
(brace
id|rr
op_assign
id|rl
op_rshift
l_int|1
suffix:semicolon
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER2
comma
op_complement
l_int|0x0e
comma
(paren
id|rr
op_amp
l_int|0x07
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
id|frobindir
c_func
(paren
id|s
comma
id|DSP_MIX_EXTENSION
comma
op_complement
l_int|0x01
comma
id|rr
op_rshift
l_int|3
)paren
suffix:semicolon
)brace
r_else
(brace
id|rr
op_assign
id|rl
op_rshift
l_int|2
suffix:semicolon
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER2
comma
op_complement
l_int|0x0e
comma
id|rr
op_lshift
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
id|MT_5MUTE
suffix:colon
id|rl
op_assign
id|l
OL
l_int|4
ques
c_cond
l_int|0
suffix:colon
(paren
id|l
op_minus
l_int|5
)paren
op_div
l_int|3
suffix:semicolon
id|rr
op_assign
id|r
OL
l_int|4
ques
c_cond
l_int|0
suffix:colon
(paren
id|r
op_minus
l_int|5
)paren
op_div
l_int|3
suffix:semicolon
id|wrmixer
c_func
(paren
id|s
comma
id|mixtable
(braket
id|i
)braket
dot
id|left
comma
id|rl
op_lshift
l_int|3
)paren
suffix:semicolon
id|wrmixer
c_func
(paren
id|s
comma
id|mixtable
(braket
id|i
)braket
dot
id|right
comma
id|rr
op_lshift
l_int|3
)paren
suffix:semicolon
id|l
op_assign
id|rdmixer
c_func
(paren
id|s
comma
id|DSP_MIX_OUTMIXIDX
)paren
suffix:semicolon
id|l
op_and_assign
op_complement
id|mixtable
(braket
id|i
)braket
dot
id|play
suffix:semicolon
id|r
op_assign
(paren
id|rl
op_or
id|rr
)paren
ques
c_cond
id|mixtable
(braket
id|i
)braket
dot
id|play
suffix:colon
l_int|0
suffix:semicolon
id|wrmixer
c_func
(paren
id|s
comma
id|DSP_MIX_OUTMIXIDX
comma
id|l
op_or
id|r
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MT_6MUTE
suffix:colon
r_if
c_cond
(paren
id|l
OL
l_int|6
)paren
id|rl
op_assign
l_int|0x00
suffix:semicolon
r_else
id|rl
op_assign
id|l
op_star
l_int|2
op_div
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|r
OL
l_int|6
)paren
id|rr
op_assign
l_int|0x00
suffix:semicolon
r_else
id|rr
op_assign
id|r
op_star
l_int|2
op_div
l_int|3
suffix:semicolon
id|wrmixer
c_func
(paren
id|s
comma
id|mixtable
(braket
id|i
)braket
dot
id|left
comma
id|rl
)paren
suffix:semicolon
id|wrmixer
c_func
(paren
id|s
comma
id|mixtable
(braket
id|i
)braket
dot
id|right
comma
id|rr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|volidx
(braket
id|i
)braket
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|s-&gt;mix.vol
(braket
id|volidx
(braket
id|i
)braket
op_minus
l_int|1
)braket
op_assign
id|val
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|s-&gt;mix.vol
(braket
id|volidx
(braket
id|i
)braket
op_minus
l_int|1
)braket
comma
id|p
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|cm_open_mixdev
r_static
r_int
id|cm_open_mixdev
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|iminor
c_func
(paren
id|inode
)paren
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|cm_state
op_star
id|s
suffix:semicolon
r_for
c_loop
(paren
id|list
op_assign
id|devs.next
suffix:semicolon
suffix:semicolon
id|list
op_assign
id|list-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|list
op_eq
op_amp
id|devs
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|s
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|cm_state
comma
id|devs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dev_mixer
op_eq
id|minor
)paren
r_break
suffix:semicolon
)brace
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
id|s
suffix:semicolon
r_return
id|nonseekable_open
c_func
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
)brace
DECL|function|cm_release_mixdev
r_static
r_int
id|cm_release_mixdev
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|cm_state
op_star
id|s
op_assign
(paren
r_struct
id|cm_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cm_ioctl_mixdev
r_static
r_int
id|cm_ioctl_mixdev
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_return
id|mixer_ioctl
c_func
(paren
(paren
r_struct
id|cm_state
op_star
)paren
id|file-&gt;private_data
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|variable|cm_mixer_fops
r_static
multiline_comment|/*const*/
r_struct
id|file_operations
id|cm_mixer_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|llseek
op_assign
id|no_llseek
comma
dot
id|ioctl
op_assign
id|cm_ioctl_mixdev
comma
dot
id|open
op_assign
id|cm_open_mixdev
comma
dot
id|release
op_assign
id|cm_release_mixdev
comma
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|drain_dac
r_static
r_int
id|drain_dac
c_func
(paren
r_struct
id|cm_state
op_star
id|s
comma
r_int
id|nonblock
)paren
(brace
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|count
comma
id|tmo
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.mapped
op_logical_or
op_logical_neg
id|s-&gt;dma_dac.ready
)paren
r_return
l_int|0
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_assign
id|s-&gt;dma_dac.count
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_le
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|nonblock
)paren
(brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|tmo
op_assign
l_int|3
op_star
id|HZ
op_star
(paren
id|count
op_plus
id|s-&gt;dma_dac.fragsize
)paren
op_div
l_int|2
op_div
id|s-&gt;ratedac
suffix:semicolon
id|tmo
op_rshift_assign
id|sample_shift
(braket
(paren
id|s-&gt;fmt
op_rshift
id|CM_CFMT_DACSHIFT
)paren
op_amp
id|CM_CFMT_MASK
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|schedule_timeout
c_func
(paren
id|tmo
op_plus
l_int|1
)paren
)paren
id|DBG
c_func
(paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;cmpci: dma timed out??&bslash;n&quot;
)paren
suffix:semicolon
)paren
)brace
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
DECL|function|cm_read
r_static
id|ssize_t
id|cm_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
id|__user
op_star
id|buffer
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|cm_state
op_star
id|s
op_assign
(paren
r_struct
id|cm_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|swptr
suffix:semicolon
r_int
id|cnt
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.mapped
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|1
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|buffer
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_adc.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|swptr
op_assign
id|s-&gt;dma_adc.swptr
suffix:semicolon
id|cnt
op_assign
id|s-&gt;dma_adc.dmasize
op_minus
id|swptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.count
OL
id|cnt
)paren
id|cnt
op_assign
id|s-&gt;dma_adc.count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OG
id|count
)paren
id|cnt
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_adc.enabled
)paren
id|start_adc
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|schedule_timeout
c_func
(paren
id|HZ
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;cmpci: read: chip lockup? dmasz %u fragsz %u count %i hwptr %u swptr %u&bslash;n&quot;
comma
id|s-&gt;dma_adc.dmasize
comma
id|s-&gt;dma_adc.fragsize
comma
id|s-&gt;dma_adc.count
comma
id|s-&gt;dma_adc.hwptr
comma
id|s-&gt;dma_adc.swptr
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|stop_adc_unlocked
c_func
(paren
id|s
)paren
suffix:semicolon
id|set_dmaadc
c_func
(paren
id|s
comma
id|s-&gt;dma_adc.dmaaddr
comma
id|s-&gt;dma_adc.dmasamples
)paren
suffix:semicolon
multiline_comment|/* program sample counts */
id|set_countadc
c_func
(paren
id|s
comma
id|s-&gt;dma_adc.fragsamples
)paren
suffix:semicolon
id|s-&gt;dma_adc.count
op_assign
id|s-&gt;dma_adc.hwptr
op_assign
id|s-&gt;dma_adc.swptr
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_BIGENDIAN_R
)paren
(brace
r_int
id|i
comma
id|err
suffix:semicolon
r_int
r_char
op_star
id|src
suffix:semicolon
r_char
id|__user
op_star
id|dst
op_assign
id|buffer
suffix:semicolon
r_int
r_char
id|data
(braket
l_int|2
)braket
suffix:semicolon
id|src
op_assign
(paren
r_int
r_char
op_star
)paren
(paren
id|s-&gt;dma_adc.rawbuf
op_plus
id|swptr
)paren
suffix:semicolon
singleline_comment|// copy left/right sample at one time
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
op_div
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|data
(braket
l_int|0
)braket
op_assign
id|src
(braket
l_int|1
)braket
suffix:semicolon
id|data
(braket
l_int|1
)braket
op_assign
id|src
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|__put_user
c_func
(paren
id|data
(braket
l_int|0
)braket
comma
id|dst
op_increment
)paren
)paren
)paren
(brace
id|ret
op_assign
id|err
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|__put_user
c_func
(paren
id|data
(braket
l_int|1
)braket
comma
id|dst
op_increment
)paren
)paren
)paren
(brace
id|ret
op_assign
id|err
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|src
op_add_assign
l_int|2
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buffer
comma
id|s-&gt;dma_adc.rawbuf
op_plus
id|swptr
comma
id|cnt
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|swptr
op_assign
(paren
id|swptr
op_plus
id|cnt
)paren
op_mod
id|s-&gt;dma_adc.dmasize
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;dma_adc.swptr
op_assign
id|swptr
suffix:semicolon
id|s-&gt;dma_adc.count
op_sub_assign
id|cnt
suffix:semicolon
id|count
op_sub_assign
id|cnt
suffix:semicolon
id|buffer
op_add_assign
id|cnt
suffix:semicolon
id|ret
op_add_assign
id|cnt
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.enabled
)paren
id|start_adc_unlocked
c_func
(paren
id|s
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_adc.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|cm_write
r_static
id|ssize_t
id|cm_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
id|__user
op_star
id|buffer
comma
r_int
id|count
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|cm_state
op_star
id|s
op_assign
(paren
r_struct
id|cm_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
id|ssize_t
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|swptr
suffix:semicolon
r_int
id|cnt
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.mapped
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|0
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_READ
comma
id|buffer
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_adc.mapped
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|1
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_READ
comma
id|buffer
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
OL
l_int|0
)paren
(brace
id|s-&gt;dma_dac.count
op_assign
l_int|0
suffix:semicolon
id|s-&gt;dma_dac.swptr
op_assign
id|s-&gt;dma_dac.hwptr
suffix:semicolon
)brace
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
(brace
id|s-&gt;dma_adc.swptr
op_assign
id|s-&gt;dma_dac.swptr
suffix:semicolon
id|s-&gt;dma_adc.count
op_assign
id|s-&gt;dma_dac.count
suffix:semicolon
id|s-&gt;dma_adc.endcleared
op_assign
id|s-&gt;dma_dac.endcleared
suffix:semicolon
)brace
id|swptr
op_assign
id|s-&gt;dma_dac.swptr
suffix:semicolon
id|cnt
op_assign
id|s-&gt;dma_dac.dmasize
op_minus
id|swptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_AC3_SW
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
op_plus
l_int|2
op_star
id|cnt
OG
id|s-&gt;dma_dac.dmasize
)paren
id|cnt
op_assign
(paren
id|s-&gt;dma_dac.dmasize
op_minus
id|s-&gt;dma_dac.count
)paren
op_div
l_int|2
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
op_plus
id|cnt
OG
id|s-&gt;dma_dac.dmasize
)paren
id|cnt
op_assign
id|s-&gt;dma_dac.dmasize
op_minus
id|s-&gt;dma_dac.count
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cnt
OG
id|count
)paren
id|cnt
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
op_logical_and
(paren
id|cnt
OG
id|count
op_div
l_int|2
)paren
)paren
id|cnt
op_assign
id|count
op_div
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_le
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_dac.enabled
)paren
id|start_dac
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|schedule_timeout
c_func
(paren
id|HZ
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;cmpci: write: chip lockup? dmasz %u fragsz %u count %i hwptr %u swptr %u&bslash;n&quot;
comma
id|s-&gt;dma_dac.dmasize
comma
id|s-&gt;dma_dac.fragsize
comma
id|s-&gt;dma_dac.count
comma
id|s-&gt;dma_dac.hwptr
comma
id|s-&gt;dma_dac.swptr
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|stop_dac_unlocked
c_func
(paren
id|s
)paren
suffix:semicolon
id|set_dmadac
c_func
(paren
id|s
comma
id|s-&gt;dma_dac.dmaaddr
comma
id|s-&gt;dma_dac.dmasamples
)paren
suffix:semicolon
multiline_comment|/* program sample counts */
id|set_countdac
c_func
(paren
id|s
comma
id|s-&gt;dma_dac.fragsamples
)paren
suffix:semicolon
id|s-&gt;dma_dac.count
op_assign
id|s-&gt;dma_dac.hwptr
op_assign
id|s-&gt;dma_dac.swptr
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
(brace
id|set_dmadac1
c_func
(paren
id|s
comma
id|s-&gt;dma_adc.dmaaddr
comma
id|s-&gt;dma_adc.dmasamples
)paren
suffix:semicolon
id|s-&gt;dma_adc.count
op_assign
id|s-&gt;dma_adc.hwptr
op_assign
id|s-&gt;dma_adc.swptr
op_assign
l_int|0
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_AC3_SW
)paren
(brace
r_int
id|err
suffix:semicolon
singleline_comment|// clip exceeded data, caught by 033 and 037
r_if
c_cond
(paren
id|swptr
op_plus
l_int|2
op_star
id|cnt
OG
id|s-&gt;dma_dac.dmasize
)paren
id|cnt
op_assign
(paren
id|s-&gt;dma_dac.dmasize
op_minus
id|swptr
)paren
op_div
l_int|2
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|trans_ac3
c_func
(paren
id|s
comma
id|s-&gt;dma_dac.rawbuf
op_plus
id|swptr
comma
id|buffer
comma
id|cnt
)paren
)paren
)paren
(brace
id|ret
op_assign
id|err
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|swptr
op_assign
(paren
id|swptr
op_plus
l_int|2
op_star
id|cnt
)paren
op_mod
id|s-&gt;dma_dac.dmasize
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
op_logical_and
(paren
id|s-&gt;status
op_amp
id|DO_BIGENDIAN_W
)paren
)paren
(brace
r_int
id|i
comma
id|err
suffix:semicolon
r_const
r_char
id|__user
op_star
id|src
op_assign
id|buffer
suffix:semicolon
r_int
r_char
op_star
id|dst0
comma
op_star
id|dst1
suffix:semicolon
r_int
r_char
id|data
(braket
l_int|8
)braket
suffix:semicolon
id|dst0
op_assign
(paren
r_int
r_char
op_star
)paren
(paren
id|s-&gt;dma_dac.rawbuf
op_plus
id|swptr
)paren
suffix:semicolon
id|dst1
op_assign
(paren
r_int
r_char
op_star
)paren
(paren
id|s-&gt;dma_adc.rawbuf
op_plus
id|swptr
)paren
suffix:semicolon
singleline_comment|// copy left/right sample at one time
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
op_div
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|__get_user
c_func
(paren
id|data
(braket
l_int|0
)braket
comma
id|src
op_increment
)paren
)paren
)paren
(brace
id|ret
op_assign
id|err
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|__get_user
c_func
(paren
id|data
(braket
l_int|1
)braket
comma
id|src
op_increment
)paren
)paren
)paren
(brace
id|ret
op_assign
id|err
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|__get_user
c_func
(paren
id|data
(braket
l_int|2
)braket
comma
id|src
op_increment
)paren
)paren
)paren
(brace
id|ret
op_assign
id|err
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|__get_user
c_func
(paren
id|data
(braket
l_int|3
)braket
comma
id|src
op_increment
)paren
)paren
)paren
(brace
id|ret
op_assign
id|err
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|__get_user
c_func
(paren
id|data
(braket
l_int|4
)braket
comma
id|src
op_increment
)paren
)paren
)paren
(brace
id|ret
op_assign
id|err
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|__get_user
c_func
(paren
id|data
(braket
l_int|5
)braket
comma
id|src
op_increment
)paren
)paren
)paren
(brace
id|ret
op_assign
id|err
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|__get_user
c_func
(paren
id|data
(braket
l_int|6
)braket
comma
id|src
op_increment
)paren
)paren
)paren
(brace
id|ret
op_assign
id|err
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|__get_user
c_func
(paren
id|data
(braket
l_int|7
)braket
comma
id|src
op_increment
)paren
)paren
)paren
(brace
id|ret
op_assign
id|err
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|dst0
(braket
l_int|0
)braket
op_assign
id|data
(braket
l_int|1
)braket
suffix:semicolon
id|dst0
(braket
l_int|1
)braket
op_assign
id|data
(braket
l_int|0
)braket
suffix:semicolon
id|dst0
(braket
l_int|2
)braket
op_assign
id|data
(braket
l_int|3
)braket
suffix:semicolon
id|dst0
(braket
l_int|3
)braket
op_assign
id|data
(braket
l_int|2
)braket
suffix:semicolon
id|dst1
(braket
l_int|0
)braket
op_assign
id|data
(braket
l_int|5
)braket
suffix:semicolon
id|dst1
(braket
l_int|1
)braket
op_assign
id|data
(braket
l_int|4
)braket
suffix:semicolon
id|dst1
(braket
l_int|2
)braket
op_assign
id|data
(braket
l_int|7
)braket
suffix:semicolon
id|dst1
(braket
l_int|3
)braket
op_assign
id|data
(braket
l_int|6
)braket
suffix:semicolon
id|dst0
op_add_assign
l_int|4
suffix:semicolon
id|dst1
op_add_assign
l_int|4
suffix:semicolon
)brace
id|swptr
op_assign
(paren
id|swptr
op_plus
id|cnt
)paren
op_mod
id|s-&gt;dma_dac.dmasize
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
(brace
r_int
id|i
comma
id|err
suffix:semicolon
r_int
r_int
id|__user
op_star
id|src
op_assign
(paren
r_int
r_int
id|__user
op_star
)paren
id|buffer
suffix:semicolon
r_int
r_int
op_star
id|dst0
comma
op_star
id|dst1
suffix:semicolon
id|dst0
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|s-&gt;dma_dac.rawbuf
op_plus
id|swptr
)paren
suffix:semicolon
id|dst1
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|s-&gt;dma_adc.rawbuf
op_plus
id|swptr
)paren
suffix:semicolon
singleline_comment|// copy left/right sample at one time
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
op_div
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|__get_user
c_func
(paren
op_star
id|dst0
op_increment
comma
id|src
op_increment
)paren
)paren
)paren
(brace
id|ret
op_assign
id|err
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|__get_user
c_func
(paren
op_star
id|dst1
op_increment
comma
id|src
op_increment
)paren
)paren
)paren
(brace
id|ret
op_assign
id|err
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
id|swptr
op_assign
(paren
id|swptr
op_plus
id|cnt
)paren
op_mod
id|s-&gt;dma_dac.dmasize
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_BIGENDIAN_W
)paren
(brace
r_int
id|i
comma
id|err
suffix:semicolon
r_const
r_char
id|__user
op_star
id|src
op_assign
id|buffer
suffix:semicolon
r_int
r_char
op_star
id|dst
suffix:semicolon
r_int
r_char
id|data
(braket
l_int|2
)braket
suffix:semicolon
id|dst
op_assign
(paren
r_int
r_char
op_star
)paren
(paren
id|s-&gt;dma_dac.rawbuf
op_plus
id|swptr
)paren
suffix:semicolon
singleline_comment|// swap hi/lo bytes for each sample
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cnt
op_div
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|__get_user
c_func
(paren
id|data
(braket
l_int|0
)braket
comma
id|src
op_increment
)paren
)paren
)paren
(brace
id|ret
op_assign
id|err
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|__get_user
c_func
(paren
id|data
(braket
l_int|1
)braket
comma
id|src
op_increment
)paren
)paren
)paren
(brace
id|ret
op_assign
id|err
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|dst
(braket
l_int|0
)braket
op_assign
id|data
(braket
l_int|1
)braket
suffix:semicolon
id|dst
(braket
l_int|1
)braket
op_assign
id|data
(braket
l_int|0
)braket
suffix:semicolon
id|dst
op_add_assign
l_int|2
suffix:semicolon
)brace
id|swptr
op_assign
(paren
id|swptr
op_plus
id|cnt
)paren
op_mod
id|s-&gt;dma_dac.dmasize
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|s-&gt;dma_dac.rawbuf
op_plus
id|swptr
comma
id|buffer
comma
id|cnt
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|swptr
op_assign
(paren
id|swptr
op_plus
id|cnt
)paren
op_mod
id|s-&gt;dma_dac.dmasize
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|s-&gt;dma_dac.swptr
op_assign
id|swptr
suffix:semicolon
id|s-&gt;dma_dac.count
op_add_assign
id|cnt
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_AC3_SW
)paren
id|s-&gt;dma_dac.count
op_add_assign
id|cnt
suffix:semicolon
id|s-&gt;dma_dac.endcleared
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|count
op_sub_assign
id|cnt
suffix:semicolon
id|buffer
op_add_assign
id|cnt
suffix:semicolon
id|ret
op_add_assign
id|cnt
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
(brace
id|count
op_sub_assign
id|cnt
suffix:semicolon
id|buffer
op_add_assign
id|cnt
suffix:semicolon
id|ret
op_add_assign
id|cnt
suffix:semicolon
)brace
r_if
c_cond
(paren
id|s-&gt;dma_dac.enabled
)paren
id|start_dac
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|cm_poll
r_static
r_int
r_int
id|cm_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|poll_table_struct
op_star
id|wait
)paren
(brace
r_struct
id|cm_state
op_star
id|s
op_assign
(paren
r_struct
id|cm_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|0
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac.ready
op_logical_and
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|0
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|s-&gt;dma_dac.wait
comma
id|wait
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.ready
op_logical_and
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|1
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|s-&gt;dma_adc.wait
comma
id|wait
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|cm_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_adc.count
op_ge
(paren
r_int
)paren
id|s-&gt;dma_adc.fragsize
)paren
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_dac.mapped
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_dac.count
op_ge
(paren
r_int
)paren
id|s-&gt;dma_dac.fragsize
)paren
id|mask
op_or_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
r_int
)paren
id|s-&gt;dma_dac.dmasize
op_ge
id|s-&gt;dma_dac.count
op_plus
(paren
r_int
)paren
id|s-&gt;dma_dac.fragsize
)paren
id|mask
op_or_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|mask
suffix:semicolon
)brace
DECL|function|cm_mmap
r_static
r_int
id|cm_mmap
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|cm_state
op_star
id|s
op_assign
(paren
r_struct
id|cm_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|dmabuf
op_star
id|db
suffix:semicolon
r_int
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_int
r_int
id|size
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_flags
op_amp
id|VM_WRITE
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|0
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|db
op_assign
op_amp
id|s-&gt;dma_dac
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vma-&gt;vm_flags
op_amp
id|VM_READ
)paren
(brace
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|1
)paren
)paren
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|db
op_assign
op_amp
id|s-&gt;dma_adc
suffix:semicolon
)brace
r_else
r_goto
id|out
suffix:semicolon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|vma-&gt;vm_pgoff
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
id|size
op_assign
id|vma-&gt;vm_end
op_minus
id|vma-&gt;vm_start
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
(paren
id|PAGE_SIZE
op_lshift
id|db-&gt;buforder
)paren
)paren
r_goto
id|out
suffix:semicolon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|remap_pfn_range
c_func
(paren
id|vma
comma
id|vma-&gt;vm_start
comma
id|virt_to_phys
c_func
(paren
id|db-&gt;rawbuf
)paren
op_rshift
id|PAGE_SHIFT
comma
id|size
comma
id|vma-&gt;vm_page_prot
)paren
)paren
r_goto
id|out
suffix:semicolon
id|db-&gt;mapped
op_assign
l_int|1
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|out
suffix:colon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|macro|SNDCTL_SPDIF_COPYRIGHT
mdefine_line|#define SNDCTL_SPDIF_COPYRIGHT&t;_SIOW(&squot;S&squot;,  0, int)       
singleline_comment|// set/reset S/PDIF copy protection
DECL|macro|SNDCTL_SPDIF_LOOP
mdefine_line|#define SNDCTL_SPDIF_LOOP&t;_SIOW(&squot;S&squot;,  1, int)       
singleline_comment|// set/reset S/PDIF loop
DECL|macro|SNDCTL_SPDIF_MONITOR
mdefine_line|#define SNDCTL_SPDIF_MONITOR&t;_SIOW(&squot;S&squot;,  2, int)       
singleline_comment|// set S/PDIF monitor
DECL|macro|SNDCTL_SPDIF_LEVEL
mdefine_line|#define SNDCTL_SPDIF_LEVEL&t;_SIOW(&squot;S&squot;,  3, int)       
singleline_comment|// set/reset S/PDIF out level
DECL|macro|SNDCTL_SPDIF_INV
mdefine_line|#define SNDCTL_SPDIF_INV&t;_SIOW(&squot;S&squot;,  4, int)       
singleline_comment|// set/reset S/PDIF in inverse
DECL|macro|SNDCTL_SPDIF_SEL2
mdefine_line|#define SNDCTL_SPDIF_SEL2&t;_SIOW(&squot;S&squot;,  5, int)       
singleline_comment|// set S/PDIF in #2
DECL|macro|SNDCTL_SPDIF_VALID
mdefine_line|#define SNDCTL_SPDIF_VALID&t;_SIOW(&squot;S&squot;,  6, int)       
singleline_comment|// set S/PDIF valid
DECL|macro|SNDCTL_SPDIFOUT
mdefine_line|#define SNDCTL_SPDIFOUT&t;&t;_SIOW(&squot;S&squot;,  7, int)       
singleline_comment|// set S/PDIF out
DECL|macro|SNDCTL_SPDIFIN
mdefine_line|#define SNDCTL_SPDIFIN&t;&t;_SIOW(&squot;S&squot;,  8, int)       
singleline_comment|// set S/PDIF out
DECL|function|cm_ioctl
r_static
r_int
id|cm_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|cm_state
op_star
id|s
op_assign
(paren
r_struct
id|cm_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|audio_buf_info
id|abinfo
suffix:semicolon
id|count_info
id|cinfo
suffix:semicolon
r_int
id|val
comma
id|mapped
comma
id|ret
suffix:semicolon
r_int
r_char
id|fmtm
comma
id|fmtd
suffix:semicolon
r_void
id|__user
op_star
id|argp
op_assign
(paren
r_void
id|__user
op_star
)paren
id|arg
suffix:semicolon
r_int
id|__user
op_star
id|p
op_assign
id|argp
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|mapped
op_assign
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
op_logical_and
id|s-&gt;dma_dac.mapped
)paren
op_logical_or
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
op_logical_and
id|s-&gt;dma_adc.mapped
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|OSS_GETVERSION
suffix:colon
r_return
id|put_user
c_func
(paren
id|SOUND_VERSION
comma
id|p
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SYNC
suffix:colon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
r_return
id|drain_dac
c_func
(paren
id|s
comma
l_int|0
multiline_comment|/*file-&gt;f_flags &amp; O_NONBLOCK*/
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SETDUPLEX
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETCAPS
suffix:colon
r_return
id|put_user
c_func
(paren
id|DSP_CAP_DUPLEX
op_or
id|DSP_CAP_REALTIME
op_or
id|DSP_CAP_TRIGGER
op_or
id|DSP_CAP_MMAP
op_or
id|DSP_CAP_BIND
comma
id|p
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_RESET
suffix:colon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
id|s-&gt;irq
)paren
suffix:semicolon
id|s-&gt;dma_dac.swptr
op_assign
id|s-&gt;dma_dac.hwptr
op_assign
id|s-&gt;dma_dac.count
op_assign
id|s-&gt;dma_dac.total_bytes
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
id|s-&gt;dma_adc.swptr
op_assign
id|s-&gt;dma_adc.hwptr
op_assign
id|s-&gt;dma_adc.count
op_assign
id|s-&gt;dma_adc.total_bytes
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
id|s-&gt;irq
)paren
suffix:semicolon
id|s-&gt;dma_adc.swptr
op_assign
id|s-&gt;dma_adc.hwptr
op_assign
id|s-&gt;dma_adc.count
op_assign
id|s-&gt;dma_adc.total_bytes
op_assign
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SPEED
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
id|p
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|stop_adc_unlocked
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_adc.ready
op_assign
l_int|0
suffix:semicolon
id|set_adc_rate_unlocked
c_func
(paren
id|s
comma
id|val
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_dac.ready
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
id|s-&gt;dma_adc.ready
op_assign
l_int|0
suffix:semicolon
id|set_dac_rate
c_func
(paren
id|s
comma
id|val
)paren
suffix:semicolon
)brace
)brace
r_return
id|put_user
c_func
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
id|s-&gt;rateadc
suffix:colon
id|s-&gt;ratedac
comma
id|p
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_STEREO
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
id|p
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|fmtd
op_assign
l_int|0
suffix:semicolon
id|fmtm
op_assign
op_complement
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_adc.ready
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
id|fmtd
op_or_assign
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_ADCSHIFT
suffix:semicolon
r_else
id|fmtm
op_and_assign
op_complement
(paren
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_ADCSHIFT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_dac.ready
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
id|fmtd
op_or_assign
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_DACSHIFT
suffix:semicolon
r_else
id|fmtm
op_and_assign
op_complement
(paren
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_DACSHIFT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
(brace
id|s-&gt;dma_adc.ready
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
id|fmtd
op_or_assign
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_ADCSHIFT
suffix:semicolon
r_else
id|fmtm
op_and_assign
op_complement
(paren
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_ADCSHIFT
)paren
suffix:semicolon
)brace
)brace
id|set_fmt
c_func
(paren
id|s
comma
id|fmtm
comma
id|fmtd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_CHANNELS
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
id|p
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
l_int|0
)paren
(brace
id|fmtd
op_assign
l_int|0
suffix:semicolon
id|fmtm
op_assign
op_complement
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_adc.ready
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ge
l_int|2
)paren
id|fmtd
op_or_assign
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_ADCSHIFT
suffix:semicolon
r_else
id|fmtm
op_and_assign
op_complement
(paren
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_ADCSHIFT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_dac.ready
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ge
l_int|2
)paren
id|fmtd
op_or_assign
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_DACSHIFT
suffix:semicolon
r_else
id|fmtm
op_and_assign
op_complement
(paren
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_DACSHIFT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
(brace
id|s-&gt;dma_adc.ready
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ge
l_int|2
)paren
id|fmtd
op_or_assign
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_ADCSHIFT
suffix:semicolon
r_else
id|fmtm
op_and_assign
op_complement
(paren
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_ADCSHIFT
)paren
suffix:semicolon
)brace
)brace
id|set_fmt
c_func
(paren
id|s
comma
id|fmtm
comma
id|fmtd
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|s-&gt;capability
op_amp
id|CAN_MULTI_CH
)paren
op_logical_and
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
(brace
id|val
op_assign
id|set_dac_channels
c_func
(paren
id|s
comma
id|val
)paren
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
id|p
)paren
suffix:semicolon
)brace
)brace
r_return
id|put_user
c_func
(paren
(paren
id|s-&gt;fmt
op_amp
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
(paren
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_ADCSHIFT
)paren
suffix:colon
(paren
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_DACSHIFT
)paren
)paren
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
comma
id|p
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETFMTS
suffix:colon
multiline_comment|/* Returns a mask */
r_return
id|put_user
c_func
(paren
id|AFMT_S16_BE
op_or
id|AFMT_S16_LE
op_or
id|AFMT_U8
op_or
(paren
(paren
id|s-&gt;capability
op_amp
id|CAN_AC3
)paren
ques
c_cond
id|AFMT_AC3
suffix:colon
l_int|0
)paren
comma
id|p
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETFMT
suffix:colon
multiline_comment|/* Selects ONE fmt*/
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
id|p
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
id|AFMT_QUERY
)paren
(brace
id|fmtd
op_assign
l_int|0
suffix:semicolon
id|fmtm
op_assign
op_complement
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_adc.ready
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
id|AFMT_S16_BE
op_logical_or
id|val
op_eq
id|AFMT_S16_LE
)paren
id|fmtd
op_or_assign
id|CM_CFMT_16BIT
op_lshift
id|CM_CFMT_ADCSHIFT
suffix:semicolon
r_else
id|fmtm
op_and_assign
op_complement
(paren
id|CM_CFMT_16BIT
op_lshift
id|CM_CFMT_ADCSHIFT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
id|AFMT_S16_BE
)paren
id|s-&gt;status
op_or_assign
id|DO_BIGENDIAN_R
suffix:semicolon
r_else
id|s-&gt;status
op_and_assign
op_complement
id|DO_BIGENDIAN_R
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_dac.ready
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
id|AFMT_S16_BE
op_logical_or
id|val
op_eq
id|AFMT_S16_LE
op_logical_or
id|val
op_eq
id|AFMT_AC3
)paren
id|fmtd
op_or_assign
id|CM_CFMT_16BIT
op_lshift
id|CM_CFMT_DACSHIFT
suffix:semicolon
r_else
id|fmtm
op_and_assign
op_complement
(paren
id|CM_CFMT_16BIT
op_lshift
id|CM_CFMT_DACSHIFT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
id|AFMT_AC3
)paren
(brace
id|fmtd
op_or_assign
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_DACSHIFT
suffix:semicolon
id|set_ac3
c_func
(paren
id|s
comma
l_int|48000
)paren
suffix:semicolon
)brace
r_else
id|set_ac3
c_func
(paren
id|s
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
(brace
id|s-&gt;dma_adc.ready
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
id|AFMT_S16_BE
op_logical_or
id|val
op_eq
id|AFMT_S16_LE
)paren
id|fmtd
op_or_assign
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_ADCSHIFT
suffix:semicolon
r_else
id|fmtm
op_and_assign
op_complement
(paren
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_ADCSHIFT
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_eq
id|AFMT_S16_BE
)paren
id|s-&gt;status
op_or_assign
id|DO_BIGENDIAN_W
suffix:semicolon
r_else
id|s-&gt;status
op_and_assign
op_complement
id|DO_BIGENDIAN_W
suffix:semicolon
)brace
id|set_fmt
c_func
(paren
id|s
comma
id|fmtm
comma
id|fmtd
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_AC3
)paren
r_return
id|put_user
c_func
(paren
id|AFMT_AC3
comma
id|p
)paren
suffix:semicolon
r_return
id|put_user
c_func
(paren
(paren
id|s-&gt;fmt
op_amp
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
(paren
id|CM_CFMT_16BIT
op_lshift
id|CM_CFMT_ADCSHIFT
)paren
suffix:colon
(paren
id|CM_CFMT_16BIT
op_lshift
id|CM_CFMT_DACSHIFT
)paren
)paren
)paren
ques
c_cond
id|val
suffix:colon
id|AFMT_U8
comma
id|p
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_POST
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETTRIGGER
suffix:colon
id|val
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
op_logical_and
(paren
id|s-&gt;enable
op_amp
id|ENDAC
)paren
op_logical_and
(paren
id|s-&gt;enable
op_amp
id|ENADC
)paren
)paren
id|val
op_or_assign
id|PCM_ENABLE_OUTPUT
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
id|p
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
op_logical_and
id|s-&gt;enable
op_amp
id|ENADC
)paren
id|val
op_or_assign
id|PCM_ENABLE_INPUT
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
op_logical_and
id|s-&gt;enable
op_amp
id|ENDAC
)paren
id|val
op_or_assign
id|PCM_ENABLE_OUTPUT
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
id|p
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETTRIGGER
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
id|p
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
r_if
c_cond
(paren
id|val
op_amp
id|PCM_ENABLE_INPUT
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|1
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
id|s-&gt;dma_adc.enabled
op_assign
l_int|1
suffix:semicolon
id|start_adc
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
r_else
(brace
id|s-&gt;dma_adc.enabled
op_assign
l_int|0
suffix:semicolon
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
id|val
op_amp
id|PCM_ENABLE_OUTPUT
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_dac.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|0
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|s-&gt;dma_adc.ready
op_logical_and
(paren
id|ret
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|1
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
)brace
id|s-&gt;dma_dac.enabled
op_assign
l_int|1
suffix:semicolon
id|start_dac
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
r_else
(brace
id|s-&gt;dma_dac.enabled
op_assign
l_int|0
suffix:semicolon
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETOSPACE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;enable
op_amp
id|ENDAC
)paren
op_logical_and
(paren
id|val
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|0
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|val
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|cm_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|abinfo.fragsize
op_assign
id|s-&gt;dma_dac.fragsize
suffix:semicolon
id|abinfo.bytes
op_assign
id|s-&gt;dma_dac.dmasize
op_minus
id|s-&gt;dma_dac.count
suffix:semicolon
id|abinfo.fragstotal
op_assign
id|s-&gt;dma_dac.numfrag
suffix:semicolon
id|abinfo.fragments
op_assign
id|abinfo.bytes
op_rshift
id|s-&gt;dma_dac.fragshift
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|abinfo
comma
r_sizeof
(paren
id|abinfo
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETISPACE
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;enable
op_amp
id|ENADC
)paren
op_logical_and
(paren
id|val
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|1
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|val
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|cm_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|abinfo.fragsize
op_assign
id|s-&gt;dma_adc.fragsize
suffix:semicolon
id|abinfo.bytes
op_assign
id|s-&gt;dma_adc.count
suffix:semicolon
id|abinfo.fragstotal
op_assign
id|s-&gt;dma_adc.numfrag
suffix:semicolon
id|abinfo.fragments
op_assign
id|abinfo.bytes
op_rshift
id|s-&gt;dma_adc.fragshift
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|abinfo
comma
r_sizeof
(paren
id|abinfo
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_NONBLOCK
suffix:colon
id|file-&gt;f_flags
op_or_assign
id|O_NONBLOCK
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETODELAY
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|cm_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|val
op_assign
id|s-&gt;dma_dac.count
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|val
comma
id|p
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETIPTR
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|cm_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|cinfo.bytes
op_assign
id|s-&gt;dma_adc.total_bytes
suffix:semicolon
id|cinfo.blocks
op_assign
id|s-&gt;dma_adc.count
op_rshift
id|s-&gt;dma_adc.fragshift
suffix:semicolon
id|cinfo.ptr
op_assign
id|s-&gt;dma_adc.hwptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.mapped
)paren
id|s-&gt;dma_adc.count
op_and_assign
id|s-&gt;dma_adc.fragsize
op_minus
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|cinfo
comma
r_sizeof
(paren
id|cinfo
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETOPTR
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|cm_update_ptr
c_func
(paren
id|s
)paren
suffix:semicolon
id|cinfo.bytes
op_assign
id|s-&gt;dma_dac.total_bytes
suffix:semicolon
id|cinfo.blocks
op_assign
id|s-&gt;dma_dac.count
op_rshift
id|s-&gt;dma_dac.fragshift
suffix:semicolon
id|cinfo.ptr
op_assign
id|s-&gt;dma_dac.hwptr
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.mapped
)paren
id|s-&gt;dma_dac.count
op_and_assign
id|s-&gt;dma_dac.fragsize
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
(brace
r_if
c_cond
(paren
id|s-&gt;dma_adc.mapped
)paren
id|s-&gt;dma_adc.count
op_and_assign
id|s-&gt;dma_adc.fragsize
op_minus
l_int|1
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|s-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|cinfo
comma
r_sizeof
(paren
id|cinfo
)paren
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_GETBLKSIZE
suffix:colon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|0
)paren
)paren
)paren
r_return
id|val
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
(brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|1
)paren
)paren
)paren
r_return
id|val
suffix:semicolon
r_return
id|put_user
c_func
(paren
l_int|2
op_star
id|s-&gt;dma_dac.fragsize
comma
id|p
)paren
suffix:semicolon
)brace
r_return
id|put_user
c_func
(paren
id|s-&gt;dma_dac.fragsize
comma
id|p
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|prog_dmabuf
c_func
(paren
id|s
comma
l_int|1
)paren
)paren
)paren
r_return
id|val
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|s-&gt;dma_adc.fragsize
comma
id|p
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_SETFRAGMENT
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
id|p
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|s-&gt;dma_adc.ossfragshift
op_assign
id|val
op_amp
l_int|0xffff
suffix:semicolon
id|s-&gt;dma_adc.ossmaxfrags
op_assign
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.ossfragshift
OL
l_int|4
)paren
id|s-&gt;dma_adc.ossfragshift
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.ossfragshift
OG
l_int|15
)paren
id|s-&gt;dma_adc.ossfragshift
op_assign
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_adc.ossmaxfrags
OL
l_int|4
)paren
id|s-&gt;dma_adc.ossmaxfrags
op_assign
l_int|4
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|s-&gt;dma_dac.ossfragshift
op_assign
id|val
op_amp
l_int|0xffff
suffix:semicolon
id|s-&gt;dma_dac.ossmaxfrags
op_assign
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.ossfragshift
OL
l_int|4
)paren
id|s-&gt;dma_dac.ossfragshift
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.ossfragshift
OG
l_int|15
)paren
id|s-&gt;dma_dac.ossfragshift
op_assign
l_int|15
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;dma_dac.ossmaxfrags
OL
l_int|4
)paren
id|s-&gt;dma_dac.ossmaxfrags
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
(brace
id|s-&gt;dma_adc.ossfragshift
op_assign
id|s-&gt;dma_dac.ossfragshift
suffix:semicolon
id|s-&gt;dma_adc.ossmaxfrags
op_assign
id|s-&gt;dma_dac.ossmaxfrags
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_DSP_SUBDIVIDE
suffix:colon
r_if
c_cond
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
op_logical_and
id|s-&gt;dma_adc.subdivision
)paren
op_logical_or
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
op_logical_and
id|s-&gt;dma_dac.subdivision
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
id|p
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
l_int|1
op_logical_and
id|val
op_ne
l_int|2
op_logical_and
id|val
op_ne
l_int|4
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
id|s-&gt;dma_adc.subdivision
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|s-&gt;dma_dac.subdivision
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
id|s-&gt;dma_adc.subdivision
op_assign
id|val
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|SOUND_PCM_READ_RATE
suffix:colon
r_return
id|put_user
c_func
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
id|s-&gt;rateadc
suffix:colon
id|s-&gt;ratedac
comma
id|p
)paren
suffix:semicolon
r_case
id|SOUND_PCM_READ_CHANNELS
suffix:colon
r_return
id|put_user
c_func
(paren
(paren
id|s-&gt;fmt
op_amp
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
(paren
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_ADCSHIFT
)paren
suffix:colon
(paren
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_DACSHIFT
)paren
)paren
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
comma
id|p
)paren
suffix:semicolon
r_case
id|SOUND_PCM_READ_BITS
suffix:colon
r_return
id|put_user
c_func
(paren
(paren
id|s-&gt;fmt
op_amp
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
(paren
id|CM_CFMT_16BIT
op_lshift
id|CM_CFMT_ADCSHIFT
)paren
suffix:colon
(paren
id|CM_CFMT_16BIT
op_lshift
id|CM_CFMT_DACSHIFT
)paren
)paren
)paren
ques
c_cond
l_int|16
suffix:colon
l_int|8
comma
id|p
)paren
suffix:semicolon
r_case
id|SOUND_PCM_READ_FILTER
suffix:colon
r_return
id|put_user
c_func
(paren
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
ques
c_cond
id|s-&gt;rateadc
suffix:colon
id|s-&gt;ratedac
comma
id|p
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_GETCHANNELMASK
suffix:colon
r_return
id|put_user
c_func
(paren
id|DSP_BIND_FRONT
op_or
id|DSP_BIND_SURR
op_or
id|DSP_BIND_CENTER_LFE
op_or
id|DSP_BIND_SPDIF
comma
id|p
)paren
suffix:semicolon
r_case
id|SNDCTL_DSP_BIND_CHANNEL
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
id|p
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|val
op_eq
id|DSP_BIND_QUERY
)paren
(brace
id|val
op_assign
id|DSP_BIND_FRONT
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_SPDIF_OUT
)paren
id|val
op_or_assign
id|DSP_BIND_SPDIF
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|s-&gt;curr_channels
op_eq
l_int|4
)paren
id|val
op_or_assign
id|DSP_BIND_SURR
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;curr_channels
OG
l_int|4
)paren
id|val
op_or_assign
id|DSP_BIND_CENTER_LFE
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_adc.ready
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
id|DSP_BIND_SPDIF
)paren
(brace
id|set_spdifin
c_func
(paren
id|s
comma
id|s-&gt;rateadc
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;status
op_amp
id|DO_SPDIF_OUT
)paren
)paren
id|val
op_and_assign
op_complement
id|DSP_BIND_SPDIF
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|s-&gt;dma_dac.ready
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|val
op_amp
id|DSP_BIND_SPDIF
)paren
(brace
id|set_spdifout
c_func
(paren
id|s
comma
id|s-&gt;ratedac
)paren
suffix:semicolon
id|set_dac_channels
c_func
(paren
id|s
comma
id|s-&gt;fmt
op_amp
(paren
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_DACSHIFT
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|s-&gt;status
op_amp
id|DO_SPDIF_OUT
)paren
)paren
id|val
op_and_assign
op_complement
id|DSP_BIND_SPDIF
suffix:semicolon
)brace
r_else
(brace
r_int
id|channels
suffix:semicolon
r_int
id|mask
suffix:semicolon
id|mask
op_assign
id|val
op_amp
(paren
id|DSP_BIND_FRONT
op_or
id|DSP_BIND_SURR
op_or
id|DSP_BIND_CENTER_LFE
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|mask
)paren
(brace
r_case
id|DSP_BIND_FRONT
suffix:colon
id|channels
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSP_BIND_FRONT
op_or
id|DSP_BIND_SURR
suffix:colon
id|channels
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DSP_BIND_FRONT
op_or
id|DSP_BIND_SURR
op_or
id|DSP_BIND_CENTER_LFE
suffix:colon
id|channels
op_assign
l_int|6
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|channels
op_assign
id|s-&gt;fmt
op_amp
(paren
id|CM_CFMT_STEREO
op_lshift
id|CM_CFMT_DACSHIFT
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
id|set_dac_channels
c_func
(paren
id|s
comma
id|channels
)paren
suffix:semicolon
)brace
)brace
)brace
r_return
id|put_user
c_func
(paren
id|val
comma
id|p
)paren
suffix:semicolon
r_case
id|SOUND_PCM_WRITE_FILTER
suffix:colon
r_case
id|SNDCTL_DSP_MAPINBUF
suffix:colon
r_case
id|SNDCTL_DSP_MAPOUTBUF
suffix:colon
r_case
id|SNDCTL_DSP_SETSYNCRO
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
r_case
id|SNDCTL_SPDIF_COPYRIGHT
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
id|p
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|set_spdif_copyright
c_func
(paren
id|s
comma
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_SPDIF_LOOP
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
id|p
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|set_spdif_loop
c_func
(paren
id|s
comma
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_SPDIF_MONITOR
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
id|p
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|set_spdif_monitor
c_func
(paren
id|s
comma
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_SPDIF_LEVEL
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
id|p
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|set_spdifout_level
c_func
(paren
id|s
comma
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_SPDIF_INV
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
id|p
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|set_spdifin_inverse
c_func
(paren
id|s
comma
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_SPDIF_SEL2
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
id|p
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|set_spdifin_channel2
c_func
(paren
id|s
comma
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_SPDIF_VALID
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
id|p
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|set_spdifin_valid
c_func
(paren
id|s
comma
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_SPDIFOUT
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
id|p
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|set_spdifout
c_func
(paren
id|s
comma
id|val
ques
c_cond
id|s-&gt;ratedac
suffix:colon
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|SNDCTL_SPDIFIN
suffix:colon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
id|p
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|set_spdifin
c_func
(paren
id|s
comma
id|val
ques
c_cond
id|s-&gt;rateadc
suffix:colon
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
id|mixer_ioctl
c_func
(paren
id|s
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|function|cm_open
r_static
r_int
id|cm_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|minor
op_assign
id|iminor
c_func
(paren
id|inode
)paren
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_int
r_char
id|fmtm
op_assign
op_complement
l_int|0
comma
id|fmts
op_assign
l_int|0
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_struct
id|cm_state
op_star
id|s
suffix:semicolon
r_for
c_loop
(paren
id|list
op_assign
id|devs.next
suffix:semicolon
suffix:semicolon
id|list
op_assign
id|list-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|list
op_eq
op_amp
id|devs
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|s
op_assign
id|list_entry
c_func
(paren
id|list
comma
r_struct
id|cm_state
comma
id|devs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|s-&gt;dev_audio
op_xor
id|minor
)paren
op_amp
op_complement
l_int|0xf
)paren
)paren
r_break
suffix:semicolon
)brace
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
id|s
suffix:semicolon
multiline_comment|/* wait for device to become free */
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_while
c_loop
(paren
id|s-&gt;open_mode
op_amp
id|file-&gt;f_mode
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|add_wait_queue
c_func
(paren
op_amp
id|s-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|__set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|s-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|ERESTARTSYS
suffix:semicolon
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|s-&gt;status
op_and_assign
op_complement
id|DO_BIGENDIAN_R
suffix:semicolon
id|fmtm
op_and_assign
op_complement
(paren
(paren
id|CM_CFMT_STEREO
op_or
id|CM_CFMT_16BIT
)paren
op_lshift
id|CM_CFMT_ADCSHIFT
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|minor
op_amp
l_int|0xf
)paren
op_eq
id|SND_DEV_DSP16
)paren
id|fmts
op_or_assign
id|CM_CFMT_16BIT
op_lshift
id|CM_CFMT_ADCSHIFT
suffix:semicolon
id|s-&gt;dma_adc.ossfragshift
op_assign
id|s-&gt;dma_adc.ossmaxfrags
op_assign
id|s-&gt;dma_adc.subdivision
op_assign
l_int|0
suffix:semicolon
id|s-&gt;dma_adc.enabled
op_assign
l_int|1
suffix:semicolon
id|set_adc_rate
c_func
(paren
id|s
comma
l_int|8000
)paren
suffix:semicolon
singleline_comment|// spdif-in is turnned off by default
id|set_spdifin
c_func
(paren
id|s
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|s-&gt;status
op_and_assign
op_complement
id|DO_BIGENDIAN_W
suffix:semicolon
id|fmtm
op_and_assign
op_complement
(paren
(paren
id|CM_CFMT_STEREO
op_or
id|CM_CFMT_16BIT
)paren
op_lshift
id|CM_CFMT_DACSHIFT
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|minor
op_amp
l_int|0xf
)paren
op_eq
id|SND_DEV_DSP16
)paren
id|fmts
op_or_assign
id|CM_CFMT_16BIT
op_lshift
id|CM_CFMT_DACSHIFT
suffix:semicolon
id|s-&gt;dma_dac.ossfragshift
op_assign
id|s-&gt;dma_dac.ossmaxfrags
op_assign
id|s-&gt;dma_dac.subdivision
op_assign
l_int|0
suffix:semicolon
id|s-&gt;dma_dac.enabled
op_assign
l_int|1
suffix:semicolon
id|set_dac_rate
c_func
(paren
id|s
comma
l_int|8000
)paren
suffix:semicolon
singleline_comment|// clear previous multichannel, spdif, ac3 state
id|set_spdifout
c_func
(paren
id|s
comma
l_int|0
)paren
suffix:semicolon
id|set_ac3
c_func
(paren
id|s
comma
l_int|0
)paren
suffix:semicolon
id|set_dac_channels
c_func
(paren
id|s
comma
l_int|1
)paren
suffix:semicolon
)brace
id|set_fmt
c_func
(paren
id|s
comma
id|fmtm
comma
id|fmts
)paren
suffix:semicolon
id|s-&gt;open_mode
op_or_assign
id|file-&gt;f_mode
op_amp
(paren
id|FMODE_READ
op_or
id|FMODE_WRITE
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_return
id|nonseekable_open
c_func
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
)brace
DECL|function|cm_release
r_static
r_int
id|cm_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|cm_state
op_star
id|s
op_assign
(paren
r_struct
id|cm_state
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|VALIDATE_STATE
c_func
(paren
id|s
)paren
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
id|drain_dac
c_func
(paren
id|s
comma
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_WRITE
)paren
(brace
id|stop_dac
c_func
(paren
id|s
)paren
suffix:semicolon
id|dealloc_dmabuf
c_func
(paren
id|s
comma
op_amp
id|s-&gt;dma_dac
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_DUAL_DAC
)paren
id|dealloc_dmabuf
c_func
(paren
id|s
comma
op_amp
id|s-&gt;dma_adc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_MULTI_CH
)paren
id|set_dac_channels
c_func
(paren
id|s
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_AC3
)paren
id|set_ac3
c_func
(paren
id|s
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;status
op_amp
id|DO_SPDIF_OUT
)paren
id|set_spdifout
c_func
(paren
id|s
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* enable SPDIF loop */
id|set_spdif_loop
c_func
(paren
id|s
comma
id|spdif_loop
)paren
suffix:semicolon
id|s-&gt;status
op_and_assign
op_complement
id|DO_BIGENDIAN_W
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file-&gt;f_mode
op_amp
id|FMODE_READ
)paren
(brace
id|stop_adc
c_func
(paren
id|s
)paren
suffix:semicolon
id|dealloc_dmabuf
c_func
(paren
id|s
comma
op_amp
id|s-&gt;dma_adc
)paren
suffix:semicolon
id|s-&gt;status
op_and_assign
op_complement
id|DO_BIGENDIAN_R
suffix:semicolon
)brace
id|s-&gt;open_mode
op_and_assign
op_complement
(paren
id|file-&gt;f_mode
op_amp
(paren
id|FMODE_READ
op_or
id|FMODE_WRITE
)paren
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|s-&gt;open_wait
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|cm_audio_fops
r_static
multiline_comment|/*const*/
r_struct
id|file_operations
id|cm_audio_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|llseek
op_assign
id|no_llseek
comma
dot
id|read
op_assign
id|cm_read
comma
dot
id|write
op_assign
id|cm_write
comma
dot
id|poll
op_assign
id|cm_poll
comma
dot
id|ioctl
op_assign
id|cm_ioctl
comma
dot
id|mmap
op_assign
id|cm_mmap
comma
dot
id|open
op_assign
id|cm_open
comma
dot
id|release
op_assign
id|cm_release
comma
)brace
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------- */
DECL|struct|initvol
r_static
r_struct
id|initvol
(brace
DECL|member|mixch
r_int
id|mixch
suffix:semicolon
DECL|member|vol
r_int
id|vol
suffix:semicolon
DECL|variable|__devinitdata
)brace
id|initvol
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
id|SOUND_MIXER_WRITE_CD
comma
l_int|0x4f4f
)brace
comma
(brace
id|SOUND_MIXER_WRITE_LINE
comma
l_int|0x4f4f
)brace
comma
(brace
id|SOUND_MIXER_WRITE_MIC
comma
l_int|0x4f4f
)brace
comma
(brace
id|SOUND_MIXER_WRITE_SYNTH
comma
l_int|0x4f4f
)brace
comma
(brace
id|SOUND_MIXER_WRITE_VOLUME
comma
l_int|0x4f4f
)brace
comma
(brace
id|SOUND_MIXER_WRITE_PCM
comma
l_int|0x4f4f
)brace
)brace
suffix:semicolon
multiline_comment|/* check chip version and capability */
DECL|function|query_chip
r_static
r_int
id|query_chip
c_func
(paren
r_struct
id|cm_state
op_star
id|s
)paren
(brace
r_int
id|ChipVersion
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
r_char
id|RegValue
suffix:semicolon
singleline_comment|// check reg 0Ch, bit 24-31
id|RegValue
op_assign
id|inb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_INT_HLDCLR
op_plus
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|RegValue
op_eq
l_int|0
)paren
(brace
singleline_comment|// check reg 08h, bit 24-28
id|RegValue
op_assign
id|inb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_CHFORMAT
op_plus
l_int|3
)paren
suffix:semicolon
id|RegValue
op_and_assign
l_int|0x1f
suffix:semicolon
r_if
c_cond
(paren
id|RegValue
op_eq
l_int|0
)paren
(brace
id|ChipVersion
op_assign
l_int|33
suffix:semicolon
id|s-&gt;max_channels
op_assign
l_int|4
suffix:semicolon
id|s-&gt;capability
op_or_assign
id|CAN_AC3_SW
suffix:semicolon
id|s-&gt;capability
op_or_assign
id|CAN_DUAL_DAC
suffix:semicolon
)brace
r_else
(brace
id|ChipVersion
op_assign
l_int|37
suffix:semicolon
id|s-&gt;max_channels
op_assign
l_int|4
suffix:semicolon
id|s-&gt;capability
op_or_assign
id|CAN_AC3_HW
suffix:semicolon
id|s-&gt;capability
op_or_assign
id|CAN_DUAL_DAC
suffix:semicolon
)brace
)brace
r_else
(brace
singleline_comment|// check reg 0Ch, bit 26
r_if
c_cond
(paren
id|RegValue
op_amp
(paren
l_int|1
op_lshift
(paren
l_int|26
op_minus
l_int|24
)paren
)paren
)paren
(brace
id|ChipVersion
op_assign
l_int|39
suffix:semicolon
r_if
c_cond
(paren
id|RegValue
op_amp
(paren
l_int|1
op_lshift
(paren
l_int|24
op_minus
l_int|24
)paren
)paren
)paren
id|s-&gt;max_channels
op_assign
l_int|6
suffix:semicolon
r_else
id|s-&gt;max_channels
op_assign
l_int|4
suffix:semicolon
id|s-&gt;capability
op_or_assign
id|CAN_AC3_HW
suffix:semicolon
id|s-&gt;capability
op_or_assign
id|CAN_DUAL_DAC
suffix:semicolon
id|s-&gt;capability
op_or_assign
id|CAN_MULTI_CH_HW
suffix:semicolon
id|s-&gt;capability
op_or_assign
id|CAN_LINE_AS_BASS
suffix:semicolon
id|s-&gt;capability
op_or_assign
id|CAN_MIC_AS_BASS
suffix:semicolon
)brace
r_else
(brace
id|ChipVersion
op_assign
l_int|55
suffix:semicolon
singleline_comment|// 4 or 6 channels
id|s-&gt;max_channels
op_assign
l_int|6
suffix:semicolon
id|s-&gt;capability
op_or_assign
id|CAN_AC3_HW
suffix:semicolon
id|s-&gt;capability
op_or_assign
id|CAN_DUAL_DAC
suffix:semicolon
id|s-&gt;capability
op_or_assign
id|CAN_MULTI_CH_HW
suffix:semicolon
id|s-&gt;capability
op_or_assign
id|CAN_LINE_AS_BASS
suffix:semicolon
id|s-&gt;capability
op_or_assign
id|CAN_MIC_AS_BASS
suffix:semicolon
)brace
)brace
id|s-&gt;capability
op_or_assign
id|CAN_LINE_AS_REAR
suffix:semicolon
r_return
id|ChipVersion
suffix:semicolon
)brace
DECL|macro|echo_option
mdefine_line|#define&t;echo_option(x)&bslash;&n;if (x) strcat(options, &quot;&quot; #x &quot; &quot;)
DECL|function|cm_probe
r_static
r_int
id|__devinit
id|cm_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pcidev
comma
r_const
r_struct
id|pci_device_id
op_star
id|pciid
)paren
(brace
r_struct
id|cm_state
op_star
id|s
suffix:semicolon
id|mm_segment_t
id|fs
suffix:semicolon
r_int
id|i
comma
id|val
comma
id|ret
suffix:semicolon
r_int
r_char
id|reg_mask
suffix:semicolon
r_int
id|timeout
suffix:semicolon
r_struct
id|resource
op_star
id|ports
suffix:semicolon
r_struct
(brace
r_int
r_int
id|deviceid
suffix:semicolon
r_char
op_star
id|devicename
suffix:semicolon
)brace
id|devicetable
(braket
)braket
op_assign
(brace
(brace
id|PCI_DEVICE_ID_CMEDIA_CM8338A
comma
l_string|&quot;CM8338A&quot;
)brace
comma
(brace
id|PCI_DEVICE_ID_CMEDIA_CM8338B
comma
l_string|&quot;CM8338B&quot;
)brace
comma
(brace
id|PCI_DEVICE_ID_CMEDIA_CM8738
comma
l_string|&quot;CM8738&quot;
)brace
comma
(brace
id|PCI_DEVICE_ID_CMEDIA_CM8738B
comma
l_string|&quot;CM8738B&quot;
)brace
comma
)brace
suffix:semicolon
r_char
op_star
id|devicename
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
r_char
id|options
(braket
l_int|256
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|pci_enable_device
c_func
(paren
id|pcidev
)paren
)paren
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pci_resource_flags
c_func
(paren
id|pcidev
comma
l_int|0
)paren
op_amp
id|IORESOURCE_IO
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
id|pcidev-&gt;irq
op_eq
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|i
op_assign
id|pci_set_dma_mask
c_func
(paren
id|pcidev
comma
l_int|0xffffffff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;cmpci: architecture does not support 32bit PCI busmaster DMA&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
id|s
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|s
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;cmpci: out of memory&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* search device name */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|devicetable
)paren
op_div
r_sizeof
(paren
id|devicetable
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|devicetable
(braket
id|i
)braket
dot
id|deviceid
op_eq
id|pcidev-&gt;device
)paren
(brace
id|devicename
op_assign
id|devicetable
(braket
id|i
)braket
dot
id|devicename
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|memset
c_func
(paren
id|s
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|cm_state
)paren
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|s-&gt;dma_adc.wait
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|s-&gt;dma_dac.wait
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|s-&gt;open_wait
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|s-&gt;open_sem
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|s-&gt;lock
)paren
suffix:semicolon
id|s-&gt;magic
op_assign
id|CM_MAGIC
suffix:semicolon
id|s-&gt;dev
op_assign
id|pcidev
suffix:semicolon
id|s-&gt;iobase
op_assign
id|pci_resource_start
c_func
(paren
id|pcidev
comma
l_int|0
)paren
suffix:semicolon
id|s-&gt;iosynth
op_assign
id|fmio
suffix:semicolon
id|s-&gt;iomidi
op_assign
id|mpuio
suffix:semicolon
macro_line|#ifdef CONFIG_SOUND_CMPCI_MIDI
id|s-&gt;midi_devc
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|s-&gt;status
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;iobase
op_eq
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|s-&gt;irq
op_assign
id|pcidev-&gt;irq
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|s-&gt;iobase
comma
id|CM_EXTENT_CODEC
comma
l_string|&quot;cmpci&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cmpci: io ports %#x-%#x in use&bslash;n&quot;
comma
id|s-&gt;iobase
comma
id|s-&gt;iobase
op_plus
id|CM_EXTENT_CODEC
op_minus
l_int|1
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|err_region5
suffix:semicolon
)brace
multiline_comment|/* dump parameters */
id|strcpy
c_func
(paren
id|options
comma
l_string|&quot;cmpci: &quot;
)paren
suffix:semicolon
id|echo_option
c_func
(paren
id|joystick
)paren
suffix:semicolon
id|echo_option
c_func
(paren
id|spdif_inverse
)paren
suffix:semicolon
id|echo_option
c_func
(paren
id|spdif_loop
)paren
suffix:semicolon
id|echo_option
c_func
(paren
id|spdif_out
)paren
suffix:semicolon
id|echo_option
c_func
(paren
id|use_line_as_rear
)paren
suffix:semicolon
id|echo_option
c_func
(paren
id|use_line_as_bass
)paren
suffix:semicolon
id|echo_option
c_func
(paren
id|use_mic_as_bass
)paren
suffix:semicolon
id|echo_option
c_func
(paren
id|mic_boost
)paren
suffix:semicolon
id|echo_option
c_func
(paren
id|hw_copy
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%s&bslash;n&quot;
comma
id|options
)paren
suffix:semicolon
multiline_comment|/* initialize codec registers */
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_INT_HLDCLR
op_plus
l_int|2
)paren
suffix:semicolon
multiline_comment|/* disable ints */
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL0
op_plus
l_int|2
)paren
suffix:semicolon
multiline_comment|/* disable channels */
multiline_comment|/* reset mixer */
id|wrmixer
c_func
(paren
id|s
comma
id|DSP_MIX_DATARESETIDX
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* request irq */
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|request_irq
c_func
(paren
id|s-&gt;irq
comma
id|cm_interrupt
comma
id|SA_SHIRQ
comma
l_string|&quot;cmpci&quot;
comma
id|s
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cmpci: irq %u in use&bslash;n&quot;
comma
id|s-&gt;irq
)paren
suffix:semicolon
r_goto
id|err_irq
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;cmpci: found %s adapter at io %#x irq %u&bslash;n&quot;
comma
id|devicename
comma
id|s-&gt;iobase
comma
id|s-&gt;irq
)paren
suffix:semicolon
multiline_comment|/* register devices */
r_if
c_cond
(paren
(paren
id|s-&gt;dev_audio
op_assign
id|register_sound_dsp
c_func
(paren
op_amp
id|cm_audio_fops
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
(brace
id|ret
op_assign
id|s-&gt;dev_audio
suffix:semicolon
r_goto
id|err_dev1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|s-&gt;dev_mixer
op_assign
id|register_sound_mixer
c_func
(paren
op_amp
id|cm_mixer_fops
comma
op_minus
l_int|1
)paren
)paren
OL
l_int|0
)paren
(brace
id|ret
op_assign
id|s-&gt;dev_mixer
suffix:semicolon
r_goto
id|err_dev2
suffix:semicolon
)brace
id|pci_set_master
c_func
(paren
id|pcidev
)paren
suffix:semicolon
multiline_comment|/* enable bus mastering */
multiline_comment|/* initialize the chips */
id|fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
multiline_comment|/* set mixer output */
id|frobindir
c_func
(paren
id|s
comma
id|DSP_MIX_OUTMIXIDX
comma
l_int|0x1f
comma
l_int|0x1f
)paren
suffix:semicolon
multiline_comment|/* set mixer input */
id|val
op_assign
id|SOUND_MASK_LINE
op_or
id|SOUND_MASK_SYNTH
op_or
id|SOUND_MASK_CD
op_or
id|SOUND_MASK_MIC
suffix:semicolon
id|mixer_ioctl
c_func
(paren
id|s
comma
id|SOUND_MIXER_WRITE_RECSRC
comma
(paren
r_int
r_int
)paren
op_amp
id|val
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|initvol
)paren
op_div
r_sizeof
(paren
id|initvol
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|val
op_assign
id|initvol
(braket
id|i
)braket
dot
id|vol
suffix:semicolon
id|mixer_ioctl
c_func
(paren
id|s
comma
id|initvol
(braket
id|i
)braket
dot
id|mixch
comma
(paren
r_int
r_int
)paren
op_amp
id|val
)paren
suffix:semicolon
)brace
id|set_fs
c_func
(paren
id|fs
)paren
suffix:semicolon
multiline_comment|/* use channel 1 for playback, channel 0 for record */
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL0
comma
op_complement
id|CHADC1
comma
id|CHADC0
)paren
suffix:semicolon
multiline_comment|/* turn off VMIC3 - mic boost */
r_if
c_cond
(paren
id|mic_boost
)paren
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER2
comma
op_complement
l_int|1
comma
l_int|0
)paren
suffix:semicolon
r_else
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MIXER2
comma
op_complement
l_int|0
comma
l_int|1
)paren
suffix:semicolon
id|s-&gt;deviceid
op_assign
id|pcidev-&gt;device
suffix:semicolon
r_if
c_cond
(paren
id|pcidev-&gt;device
op_eq
id|PCI_DEVICE_ID_CMEDIA_CM8738
op_logical_or
id|pcidev-&gt;device
op_eq
id|PCI_DEVICE_ID_CMEDIA_CM8738B
)paren
(brace
multiline_comment|/* chip version and hw capability check */
id|s-&gt;chip_version
op_assign
id|query_chip
c_func
(paren
id|s
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;cmpci: chip version = 0%d&bslash;n&quot;
comma
id|s-&gt;chip_version
)paren
suffix:semicolon
multiline_comment|/* set SPDIF-in inverse before enable SPDIF loop */
id|set_spdifin_inverse
c_func
(paren
id|s
comma
id|spdif_inverse
)paren
suffix:semicolon
multiline_comment|/* use SPDIF in #1 */
id|set_spdifin_channel2
c_func
(paren
id|s
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|s-&gt;chip_version
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* 8338 will fall here */
id|s-&gt;max_channels
op_assign
l_int|4
suffix:semicolon
id|s-&gt;capability
op_or_assign
id|CAN_DUAL_DAC
suffix:semicolon
id|s-&gt;capability
op_or_assign
id|CAN_LINE_AS_REAR
suffix:semicolon
)brace
multiline_comment|/* enable SPDIF loop */
id|set_spdif_loop
c_func
(paren
id|s
comma
id|spdif_loop
)paren
suffix:semicolon
singleline_comment|// enable 4 speaker mode (analog duplicate)
id|set_hw_copy
c_func
(paren
id|s
comma
id|hw_copy
)paren
suffix:semicolon
id|reg_mask
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_SOUND_CMPCI_FM
multiline_comment|/* disable FM */
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC_CTRL
op_plus
l_int|2
comma
op_complement
l_int|8
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;iosynth
)paren
(brace
multiline_comment|/* don&squot;t enable OPL3 if there is one */
r_if
c_cond
(paren
id|opl3_detect
c_func
(paren
id|s-&gt;iosynth
comma
l_int|NULL
)paren
)paren
(brace
id|s-&gt;iosynth
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* set IO based at 0x388 */
r_switch
c_cond
(paren
id|s-&gt;iosynth
)paren
(brace
r_case
l_int|0x388
suffix:colon
id|reg_mask
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3C8
suffix:colon
id|reg_mask
op_assign
l_int|0x01
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3E0
suffix:colon
id|reg_mask
op_assign
l_int|0x02
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3E8
suffix:colon
id|reg_mask
op_assign
l_int|0x03
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|s-&gt;iosynth
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_LEGACY_CTRL
op_plus
l_int|3
comma
op_complement
l_int|0x03
comma
id|reg_mask
)paren
suffix:semicolon
multiline_comment|/* enable FM */
r_if
c_cond
(paren
id|s-&gt;iosynth
)paren
(brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC_CTRL
op_plus
l_int|2
comma
op_complement
l_int|0
comma
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opl3_detect
c_func
(paren
id|s-&gt;iosynth
comma
l_int|NULL
)paren
)paren
id|ret
op_assign
id|opl3_init
c_func
(paren
id|s-&gt;iosynth
comma
l_int|NULL
comma
id|THIS_MODULE
)paren
suffix:semicolon
r_else
(brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC_CTRL
op_plus
l_int|2
comma
op_complement
l_int|8
comma
l_int|0
)paren
suffix:semicolon
id|s-&gt;iosynth
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SOUND_CMPCI_MIDI
r_switch
c_cond
(paren
id|s-&gt;iomidi
)paren
(brace
r_case
l_int|0x330
suffix:colon
id|reg_mask
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x320
suffix:colon
id|reg_mask
op_assign
l_int|0x20
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x310
suffix:colon
id|reg_mask
op_assign
l_int|0x40
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x300
suffix:colon
id|reg_mask
op_assign
l_int|0x60
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|s-&gt;iomidi
op_assign
l_int|0
suffix:semicolon
r_goto
id|skip_mpu
suffix:semicolon
)brace
id|ports
op_assign
id|request_region
c_func
(paren
id|s-&gt;iomidi
comma
l_int|2
comma
l_string|&quot;mpu401&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ports
)paren
r_goto
id|skip_mpu
suffix:semicolon
multiline_comment|/* disable MPU-401 */
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL1
comma
op_complement
l_int|0x04
comma
l_int|0
)paren
suffix:semicolon
id|s-&gt;mpu_data.name
op_assign
l_string|&quot;cmpci mpu&quot;
suffix:semicolon
id|s-&gt;mpu_data.io_base
op_assign
id|s-&gt;iomidi
suffix:semicolon
id|s-&gt;mpu_data.irq
op_assign
op_minus
id|s-&gt;irq
suffix:semicolon
singleline_comment|// tell mpu401 to share irq
r_if
c_cond
(paren
id|probe_mpu401
c_func
(paren
op_amp
id|s-&gt;mpu_data
comma
id|ports
)paren
)paren
(brace
id|release_region
c_func
(paren
id|s-&gt;iomidi
comma
l_int|2
)paren
suffix:semicolon
id|s-&gt;iomidi
op_assign
l_int|0
suffix:semicolon
r_goto
id|skip_mpu
suffix:semicolon
)brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_LEGACY_CTRL
op_plus
l_int|3
comma
op_complement
l_int|0x60
comma
id|reg_mask
)paren
suffix:semicolon
multiline_comment|/* enable MPU-401 */
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL1
comma
op_complement
l_int|0
comma
l_int|0x04
)paren
suffix:semicolon
multiline_comment|/* clear all previously received interrupt */
r_for
c_loop
(paren
id|timeout
op_assign
l_int|900000
suffix:semicolon
id|timeout
OG
l_int|0
suffix:semicolon
id|timeout
op_decrement
)paren
(brace
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|s-&gt;iomidi
op_plus
l_int|1
)paren
op_logical_and
l_int|0x80
)paren
op_eq
l_int|0
)paren
id|inb
c_func
(paren
id|s-&gt;iomidi
)paren
suffix:semicolon
r_else
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|probe_mpu401
c_func
(paren
op_amp
id|s-&gt;mpu_data
comma
id|ports
)paren
)paren
(brace
id|release_region
c_func
(paren
id|s-&gt;iomidi
comma
l_int|2
)paren
suffix:semicolon
id|s-&gt;iomidi
op_assign
l_int|0
suffix:semicolon
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL1
comma
op_complement
l_int|0
comma
l_int|0x04
)paren
suffix:semicolon
)brace
r_else
(brace
id|attach_mpu401
c_func
(paren
op_amp
id|s-&gt;mpu_data
comma
id|THIS_MODULE
)paren
suffix:semicolon
id|s-&gt;midi_devc
op_assign
id|s-&gt;mpu_data.slots
(braket
l_int|1
)braket
suffix:semicolon
)brace
id|skip_mpu
suffix:colon
macro_line|#endif
macro_line|#ifdef CONFIG_SOUND_CMPCI_JOYSTICK
multiline_comment|/* enable joystick */
r_if
c_cond
(paren
id|joystick
)paren
(brace
id|s-&gt;gameport.io
op_assign
l_int|0x200
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|s-&gt;gameport.io
comma
id|CM_EXTENT_GAME
comma
l_string|&quot;cmpci GAME&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cmpci: gameport io ports in use&bslash;n&quot;
)paren
suffix:semicolon
id|s-&gt;gameport.io
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL1
comma
op_complement
l_int|0
comma
l_int|0x02
)paren
suffix:semicolon
id|gameport_register_port
c_func
(paren
op_amp
id|s-&gt;gameport
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL1
comma
op_complement
l_int|0x02
comma
l_int|0
)paren
suffix:semicolon
id|s-&gt;gameport.io
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* store it in the driver field */
id|pci_set_drvdata
c_func
(paren
id|pcidev
comma
id|s
)paren
suffix:semicolon
multiline_comment|/* put it into driver list */
id|list_add_tail
c_func
(paren
op_amp
id|s-&gt;devs
comma
op_amp
id|devs
)paren
suffix:semicolon
multiline_comment|/* increment devindex */
r_if
c_cond
(paren
id|devindex
OL
id|NR_DEVICE
op_minus
l_int|1
)paren
id|devindex
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|err_dev2
suffix:colon
id|unregister_sound_dsp
c_func
(paren
id|s-&gt;dev_audio
)paren
suffix:semicolon
id|err_dev1
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cmpci: cannot register misc device&bslash;n&quot;
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|s-&gt;irq
comma
id|s
)paren
suffix:semicolon
id|err_irq
suffix:colon
id|release_region
c_func
(paren
id|s-&gt;iobase
comma
id|CM_EXTENT_CODEC
)paren
suffix:semicolon
id|err_region5
suffix:colon
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------- */
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;ChenLi Tien, cltien@cmedia.com.tw&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;CM8x38 Audio Driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|function|cm_remove
r_static
r_void
id|__devexit
id|cm_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_struct
id|cm_state
op_star
id|s
op_assign
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|s
)paren
r_return
suffix:semicolon
macro_line|#ifdef CONFIG_SOUND_CMPCI_JOYSTICK
r_if
c_cond
(paren
id|s-&gt;gameport.io
)paren
(brace
id|gameport_unregister_port
c_func
(paren
op_amp
id|s-&gt;gameport
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|s-&gt;gameport.io
comma
id|CM_EXTENT_GAME
)paren
suffix:semicolon
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL1
comma
op_complement
l_int|0x02
comma
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SOUND_CMPCI_FM
r_if
c_cond
(paren
id|s-&gt;iosynth
)paren
(brace
multiline_comment|/* disable FM */
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_MISC_CTRL
op_plus
l_int|2
comma
op_complement
l_int|8
comma
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SOUND_CMPCI_MIDI
r_if
c_cond
(paren
id|s-&gt;iomidi
)paren
(brace
id|unload_mpu401
c_func
(paren
op_amp
id|s-&gt;mpu_data
)paren
suffix:semicolon
multiline_comment|/* disable MPU-401 */
id|maskb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL1
comma
op_complement
l_int|0x04
comma
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#endif
id|set_spdif_loop
c_func
(paren
id|s
comma
l_int|0
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|s-&gt;devs
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_INT_HLDCLR
op_plus
l_int|2
)paren
suffix:semicolon
multiline_comment|/* disable ints */
id|synchronize_irq
c_func
(paren
id|s-&gt;irq
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|s-&gt;iobase
op_plus
id|CODEC_CMI_FUNCTRL0
op_plus
l_int|2
)paren
suffix:semicolon
multiline_comment|/* disable channels */
id|free_irq
c_func
(paren
id|s-&gt;irq
comma
id|s
)paren
suffix:semicolon
multiline_comment|/* reset mixer */
id|wrmixer
c_func
(paren
id|s
comma
id|DSP_MIX_DATARESETIDX
comma
l_int|0
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|s-&gt;iobase
comma
id|CM_EXTENT_CODEC
)paren
suffix:semicolon
id|unregister_sound_dsp
c_func
(paren
id|s-&gt;dev_audio
)paren
suffix:semicolon
id|unregister_sound_mixer
c_func
(paren
id|s-&gt;dev_mixer
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|s
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|id_table
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_CMEDIA
comma
id|PCI_DEVICE_ID_CMEDIA_CM8738B
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_CMEDIA
comma
id|PCI_DEVICE_ID_CMEDIA_CM8738
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_CMEDIA
comma
id|PCI_DEVICE_ID_CMEDIA_CM8338A
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_CMEDIA
comma
id|PCI_DEVICE_ID_CMEDIA_CM8338B
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|id_table
)paren
suffix:semicolon
DECL|variable|cm_driver
r_static
r_struct
id|pci_driver
id|cm_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;cmpci&quot;
comma
dot
id|id_table
op_assign
id|id_table
comma
dot
id|probe
op_assign
id|cm_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|cm_remove
)paren
)brace
suffix:semicolon
DECL|function|init_cmpci
r_static
r_int
id|__init
id|init_cmpci
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;cmpci: version $Revision: 6.82 $ time &quot;
id|__TIME__
l_string|&quot; &quot;
id|__DATE__
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|pci_module_init
c_func
(paren
op_amp
id|cm_driver
)paren
suffix:semicolon
)brace
DECL|function|cleanup_cmpci
r_static
r_void
id|__exit
id|cleanup_cmpci
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;cmpci: unloading&bslash;n&quot;
)paren
suffix:semicolon
id|pci_unregister_driver
c_func
(paren
op_amp
id|cm_driver
)paren
suffix:semicolon
)brace
DECL|variable|init_cmpci
id|module_init
c_func
(paren
id|init_cmpci
)paren
suffix:semicolon
DECL|variable|cleanup_cmpci
id|module_exit
c_func
(paren
id|cleanup_cmpci
)paren
suffix:semicolon
eof
