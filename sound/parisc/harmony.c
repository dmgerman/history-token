multiline_comment|/* Hewlett-Packard Harmony audio driver&n; *&n; *   This is a driver for the Harmony audio chipset found&n; *   on the LASI ASIC of various early HP PA-RISC workstations.&n; *&n; *   Copyright (C) 2004, Kyle McMartin &lt;kyle@{debian.org,parisc-linux.org}&gt;&n; *&n; *     Based on the previous Harmony incarnations by,&n; *       Copyright 2000 (c) Linuxcare Canada, Alex deVries&n; *       Copyright 2000-2003 (c) Helge Deller&n; *       Copyright 2001 (c) Matthieu Delahaye&n; *       Copyright 2001 (c) Jean-Christophe Vaugeois&n; *       Copyright 2003 (c) Laurent Canet&n; *       Copyright 2004 (c) Stuart Brady&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License, version 2, as&n; *   published by the Free Software Foundation.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; * Notes:&n; *   - graveyard and silence buffers last for lifetime of&n; *     the driver. playback and capture buffers are allocated&n; *     per _open()/_close().&n; * &n; * TODO:&n; *&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/time.h&gt;
macro_line|#include &lt;linux/wait.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/dma-mapping.h&gt;
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
macro_line|#include &lt;sound/control.h&gt;
macro_line|#include &lt;sound/rawmidi.h&gt;
macro_line|#include &lt;sound/initval.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
macro_line|#include &lt;asm/parisc-device.h&gt;
macro_line|#include &quot;harmony.h&quot;
DECL|variable|snd_harmony_devtable
r_static
r_struct
id|parisc_device_id
id|snd_harmony_devtable
(braket
)braket
op_assign
(brace
multiline_comment|/* bushmaster / flounder */
(brace
id|HPHW_FIO
comma
id|HVERSION_REV_ANY_ID
comma
id|HVERSION_ANY_ID
comma
l_int|0x0007A
)brace
comma
multiline_comment|/* 712 / 715 */
(brace
id|HPHW_FIO
comma
id|HVERSION_REV_ANY_ID
comma
id|HVERSION_ANY_ID
comma
l_int|0x0007B
)brace
comma
multiline_comment|/* pace */
(brace
id|HPHW_FIO
comma
id|HVERSION_REV_ANY_ID
comma
id|HVERSION_ANY_ID
comma
l_int|0x0007E
)brace
comma
multiline_comment|/* outfield / coral II */
(brace
id|HPHW_FIO
comma
id|HVERSION_REV_ANY_ID
comma
id|HVERSION_ANY_ID
comma
l_int|0x0007F
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|parisc
comma
id|snd_harmony_devtable
)paren
suffix:semicolon
DECL|macro|NAME
mdefine_line|#define NAME &quot;harmony&quot;
DECL|macro|PFX
mdefine_line|#define PFX  NAME &quot;: &quot;
DECL|variable|snd_harmony_rates
r_static
r_int
r_int
id|snd_harmony_rates
(braket
)braket
op_assign
(brace
l_int|5512
comma
l_int|6615
comma
l_int|8000
comma
l_int|9600
comma
l_int|11025
comma
l_int|16000
comma
l_int|18900
comma
l_int|22050
comma
l_int|27428
comma
l_int|32000
comma
l_int|33075
comma
l_int|37800
comma
l_int|44100
comma
l_int|48000
)brace
suffix:semicolon
DECL|variable|rate_bits
r_static
r_int
r_int
id|rate_bits
(braket
l_int|14
)braket
op_assign
(brace
id|HARMONY_SR_5KHZ
comma
id|HARMONY_SR_6KHZ
comma
id|HARMONY_SR_8KHZ
comma
id|HARMONY_SR_9KHZ
comma
id|HARMONY_SR_11KHZ
comma
id|HARMONY_SR_16KHZ
comma
id|HARMONY_SR_18KHZ
comma
id|HARMONY_SR_22KHZ
comma
id|HARMONY_SR_27KHZ
comma
id|HARMONY_SR_32KHZ
comma
id|HARMONY_SR_33KHZ
comma
id|HARMONY_SR_37KHZ
comma
id|HARMONY_SR_44KHZ
comma
id|HARMONY_SR_48KHZ
)brace
suffix:semicolon
DECL|variable|hw_constraint_rates
r_static
id|snd_pcm_hw_constraint_list_t
id|hw_constraint_rates
op_assign
(brace
dot
id|count
op_assign
id|ARRAY_SIZE
c_func
(paren
id|snd_harmony_rates
)paren
comma
dot
id|list
op_assign
id|snd_harmony_rates
comma
dot
id|mask
op_assign
l_int|0
comma
)brace
suffix:semicolon
r_inline
r_int
r_int
DECL|function|harmony_read
id|harmony_read
c_func
(paren
id|harmony_t
op_star
id|h
comma
r_int
id|r
)paren
(brace
r_return
id|__raw_readl
c_func
(paren
id|h-&gt;iobase
op_plus
id|r
)paren
suffix:semicolon
)brace
r_inline
r_void
DECL|function|harmony_write
id|harmony_write
c_func
(paren
id|harmony_t
op_star
id|h
comma
r_int
id|r
comma
r_int
r_int
id|v
)paren
(brace
id|__raw_writel
c_func
(paren
id|v
comma
id|h-&gt;iobase
op_plus
id|r
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|harmony_wait_for_control
id|harmony_wait_for_control
c_func
(paren
id|harmony_t
op_star
id|h
)paren
(brace
r_while
c_loop
(paren
id|harmony_read
c_func
(paren
id|h
comma
id|HARMONY_CNTL
)paren
op_amp
id|HARMONY_CNTL_C
)paren
suffix:semicolon
)brace
r_inline
r_void
DECL|function|harmony_reset
id|harmony_reset
c_func
(paren
id|harmony_t
op_star
id|h
)paren
(brace
id|harmony_write
c_func
(paren
id|h
comma
id|HARMONY_RESET
comma
l_int|1
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
id|harmony_write
c_func
(paren
id|h
comma
id|HARMONY_RESET
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|harmony_disable_interrupts
id|harmony_disable_interrupts
c_func
(paren
id|harmony_t
op_star
id|h
)paren
(brace
id|u32
id|dstatus
suffix:semicolon
id|harmony_wait_for_control
c_func
(paren
id|h
)paren
suffix:semicolon
id|dstatus
op_assign
id|harmony_read
c_func
(paren
id|h
comma
id|HARMONY_DSTATUS
)paren
suffix:semicolon
id|dstatus
op_and_assign
op_complement
id|HARMONY_DSTATUS_IE
suffix:semicolon
id|harmony_write
c_func
(paren
id|h
comma
id|HARMONY_DSTATUS
comma
id|dstatus
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|harmony_enable_interrupts
id|harmony_enable_interrupts
c_func
(paren
id|harmony_t
op_star
id|h
)paren
(brace
id|u32
id|dstatus
suffix:semicolon
id|harmony_wait_for_control
c_func
(paren
id|h
)paren
suffix:semicolon
id|dstatus
op_assign
id|harmony_read
c_func
(paren
id|h
comma
id|HARMONY_DSTATUS
)paren
suffix:semicolon
id|dstatus
op_or_assign
id|HARMONY_DSTATUS_IE
suffix:semicolon
id|harmony_write
c_func
(paren
id|h
comma
id|HARMONY_DSTATUS
comma
id|dstatus
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|harmony_mute
id|harmony_mute
c_func
(paren
id|harmony_t
op_star
id|h
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|h-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
id|harmony_wait_for_control
c_func
(paren
id|h
)paren
suffix:semicolon
id|harmony_write
c_func
(paren
id|h
comma
id|HARMONY_GAINCTL
comma
id|HARMONY_GAIN_SILENCE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|h-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|harmony_unmute
id|harmony_unmute
c_func
(paren
id|harmony_t
op_star
id|h
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|h-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
id|harmony_wait_for_control
c_func
(paren
id|h
)paren
suffix:semicolon
id|harmony_write
c_func
(paren
id|h
comma
id|HARMONY_GAINCTL
comma
id|h-&gt;st.gain
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|h-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|harmony_set_control
id|harmony_set_control
c_func
(paren
id|harmony_t
op_star
id|h
)paren
(brace
id|u32
id|ctrl
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|h-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ctrl
op_assign
(paren
id|HARMONY_CNTL_C
op_or
(paren
id|h-&gt;st.format
op_lshift
l_int|6
)paren
op_or
(paren
id|h-&gt;st.stereo
op_lshift
l_int|5
)paren
op_or
(paren
id|h-&gt;st.rate
)paren
)paren
suffix:semicolon
id|harmony_wait_for_control
c_func
(paren
id|h
)paren
suffix:semicolon
id|harmony_write
c_func
(paren
id|h
comma
id|HARMONY_CNTL
comma
id|ctrl
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|h-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
id|irqreturn_t
DECL|function|snd_harmony_interrupt
id|snd_harmony_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|u32
id|dstatus
suffix:semicolon
id|harmony_t
op_star
id|h
op_assign
id|dev
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|h-&gt;lock
)paren
suffix:semicolon
id|harmony_disable_interrupts
c_func
(paren
id|h
)paren
suffix:semicolon
id|harmony_wait_for_control
c_func
(paren
id|h
)paren
suffix:semicolon
id|dstatus
op_assign
id|harmony_read
c_func
(paren
id|h
comma
id|HARMONY_DSTATUS
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|h-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dstatus
op_amp
id|HARMONY_DSTATUS_PN
)paren
(brace
r_if
c_cond
(paren
id|h-&gt;psubs
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|h-&gt;lock
)paren
suffix:semicolon
id|h-&gt;pbuf.buf
op_add_assign
id|h-&gt;pbuf.count
suffix:semicolon
multiline_comment|/* PAGE_SIZE */
id|h-&gt;pbuf.buf
op_mod_assign
id|h-&gt;pbuf.size
suffix:semicolon
multiline_comment|/* MAX_BUFS*PAGE_SIZE */
id|harmony_write
c_func
(paren
id|h
comma
id|HARMONY_PNXTADD
comma
id|h-&gt;pbuf.addr
op_plus
id|h-&gt;pbuf.buf
)paren
suffix:semicolon
id|h-&gt;stats.play_intr
op_increment
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|h-&gt;lock
)paren
suffix:semicolon
id|snd_pcm_period_elapsed
c_func
(paren
id|h-&gt;psubs
)paren
suffix:semicolon
)brace
r_else
(brace
id|spin_lock
c_func
(paren
op_amp
id|h-&gt;lock
)paren
suffix:semicolon
id|harmony_write
c_func
(paren
id|h
comma
id|HARMONY_PNXTADD
comma
id|h-&gt;sdma.addr
)paren
suffix:semicolon
id|h-&gt;stats.silence_intr
op_increment
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|h-&gt;lock
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|dstatus
op_amp
id|HARMONY_DSTATUS_RN
)paren
(brace
r_if
c_cond
(paren
id|h-&gt;csubs
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|h-&gt;lock
)paren
suffix:semicolon
id|h-&gt;cbuf.buf
op_add_assign
id|h-&gt;cbuf.count
suffix:semicolon
id|h-&gt;cbuf.buf
op_mod_assign
id|h-&gt;cbuf.size
suffix:semicolon
id|harmony_write
c_func
(paren
id|h
comma
id|HARMONY_RNXTADD
comma
id|h-&gt;cbuf.addr
op_plus
id|h-&gt;cbuf.buf
)paren
suffix:semicolon
id|h-&gt;stats.rec_intr
op_increment
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|h-&gt;lock
)paren
suffix:semicolon
id|snd_pcm_period_elapsed
c_func
(paren
id|h-&gt;csubs
)paren
suffix:semicolon
)brace
r_else
(brace
id|spin_lock
c_func
(paren
op_amp
id|h-&gt;lock
)paren
suffix:semicolon
id|harmony_write
c_func
(paren
id|h
comma
id|HARMONY_RNXTADD
comma
id|h-&gt;gdma.addr
)paren
suffix:semicolon
id|h-&gt;stats.graveyard_intr
op_increment
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|h-&gt;lock
)paren
suffix:semicolon
)brace
)brace
id|spin_lock
c_func
(paren
op_amp
id|h-&gt;lock
)paren
suffix:semicolon
id|harmony_enable_interrupts
c_func
(paren
id|h
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|h-&gt;lock
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|snd_harmony_rate_bits
id|snd_harmony_rate_bits
c_func
(paren
r_int
id|rate
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|snd_harmony_rates
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|snd_harmony_rates
(braket
id|i
)braket
op_eq
id|rate
)paren
r_return
id|rate_bits
(braket
id|i
)braket
suffix:semicolon
r_return
id|HARMONY_SR_44KHZ
suffix:semicolon
)brace
DECL|variable|snd_harmony_playback
r_static
id|snd_pcm_hardware_t
id|snd_harmony_playback
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_JOINT_DUPLEX
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
)paren
comma
dot
id|formats
op_assign
(paren
id|SNDRV_PCM_FMTBIT_S16_BE
op_or
id|SNDRV_PCM_FMTBIT_MU_LAW
op_or
id|SNDRV_PCM_FMTBIT_A_LAW
)paren
comma
dot
id|rates
op_assign
(paren
id|SNDRV_PCM_RATE_5512
op_or
id|SNDRV_PCM_RATE_8000_48000
op_or
id|SNDRV_PCM_RATE_KNOT
)paren
comma
dot
id|rate_min
op_assign
l_int|5512
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
id|MAX_BUF_SIZE
comma
dot
id|period_bytes_min
op_assign
id|BUF_SIZE
comma
dot
id|period_bytes_max
op_assign
id|BUF_SIZE
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
id|MAX_BUFS
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|snd_harmony_capture
r_static
id|snd_pcm_hardware_t
id|snd_harmony_capture
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_JOINT_DUPLEX
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
)paren
comma
dot
id|formats
op_assign
(paren
id|SNDRV_PCM_FMTBIT_S16_BE
op_or
id|SNDRV_PCM_FMTBIT_MU_LAW
op_or
id|SNDRV_PCM_FMTBIT_A_LAW
)paren
comma
dot
id|rates
op_assign
(paren
id|SNDRV_PCM_RATE_5512
op_or
id|SNDRV_PCM_RATE_8000_48000
op_or
id|SNDRV_PCM_RATE_KNOT
)paren
comma
dot
id|rate_min
op_assign
l_int|5512
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
id|MAX_BUF_SIZE
comma
dot
id|period_bytes_min
op_assign
id|BUF_SIZE
comma
dot
id|period_bytes_max
op_assign
id|BUF_SIZE
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
id|MAX_BUFS
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
r_static
r_int
DECL|function|snd_harmony_playback_trigger
id|snd_harmony_playback_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|ss
comma
r_int
id|cmd
)paren
(brace
id|harmony_t
op_star
id|h
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|ss
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|h-&gt;st.capturing
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|h-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
id|h-&gt;st.playing
op_assign
l_int|1
suffix:semicolon
id|harmony_write
c_func
(paren
id|h
comma
id|HARMONY_PNXTADD
comma
id|h-&gt;pbuf.addr
)paren
suffix:semicolon
id|harmony_write
c_func
(paren
id|h
comma
id|HARMONY_RNXTADD
comma
id|h-&gt;gdma.addr
)paren
suffix:semicolon
id|harmony_unmute
c_func
(paren
id|h
)paren
suffix:semicolon
id|harmony_enable_interrupts
c_func
(paren
id|h
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
id|h-&gt;st.playing
op_assign
l_int|0
suffix:semicolon
id|harmony_mute
c_func
(paren
id|h
)paren
suffix:semicolon
id|harmony_disable_interrupts
c_func
(paren
id|h
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_PUSH
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_RELEASE
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_SUSPEND
suffix:colon
r_default
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|h-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|h-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|snd_harmony_capture_trigger
id|snd_harmony_capture_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|ss
comma
r_int
id|cmd
)paren
(brace
id|harmony_t
op_star
id|h
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|ss
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|h-&gt;st.playing
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|h-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
id|h-&gt;st.capturing
op_assign
l_int|1
suffix:semicolon
id|harmony_write
c_func
(paren
id|h
comma
id|HARMONY_PNXTADD
comma
id|h-&gt;sdma.addr
)paren
suffix:semicolon
id|harmony_write
c_func
(paren
id|h
comma
id|HARMONY_RNXTADD
comma
id|h-&gt;cbuf.addr
)paren
suffix:semicolon
id|harmony_unmute
c_func
(paren
id|h
)paren
suffix:semicolon
id|harmony_enable_interrupts
c_func
(paren
id|h
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
id|h-&gt;st.capturing
op_assign
l_int|0
suffix:semicolon
id|harmony_mute
c_func
(paren
id|h
)paren
suffix:semicolon
id|harmony_disable_interrupts
c_func
(paren
id|h
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_PUSH
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_RELEASE
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_SUSPEND
suffix:colon
r_default
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|h-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|h-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|snd_harmony_set_data_format
id|snd_harmony_set_data_format
c_func
(paren
id|harmony_t
op_star
id|h
comma
r_int
id|fmt
)paren
(brace
r_int
id|o
op_assign
id|h-&gt;st.format
suffix:semicolon
r_int
id|n
suffix:semicolon
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
id|SNDRV_PCM_FORMAT_S16_BE
suffix:colon
id|n
op_assign
id|HARMONY_DF_16BIT_LINEAR
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_FORMAT_A_LAW
suffix:colon
id|n
op_assign
id|HARMONY_DF_8BIT_ALAW
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_FORMAT_MU_LAW
suffix:colon
id|n
op_assign
id|HARMONY_DF_8BIT_ULAW
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|n
op_assign
id|HARMONY_DF_16BIT_LINEAR
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|o
op_ne
id|n
)paren
(brace
id|snd_pcm_format_set_silence
c_func
(paren
id|fmt
comma
id|h-&gt;sdma.area
comma
id|SILENCE_BUFSZ
op_div
id|snd_pcm_format_width
c_func
(paren
id|fmt
)paren
)paren
suffix:semicolon
)brace
r_return
id|n
suffix:semicolon
)brace
r_static
r_int
DECL|function|snd_harmony_playback_prepare
id|snd_harmony_playback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|ss
)paren
(brace
id|harmony_t
op_star
id|h
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|ss
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|rt
op_assign
id|ss-&gt;runtime
suffix:semicolon
r_if
c_cond
(paren
id|h-&gt;st.capturing
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|h-&gt;pbuf.size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|ss
)paren
suffix:semicolon
id|h-&gt;pbuf.count
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|ss
)paren
suffix:semicolon
id|h-&gt;pbuf.buf
op_assign
l_int|0
suffix:semicolon
id|h-&gt;st.playing
op_assign
l_int|0
suffix:semicolon
id|h-&gt;st.rate
op_assign
id|snd_harmony_rate_bits
c_func
(paren
id|rt-&gt;rate
)paren
suffix:semicolon
id|h-&gt;st.format
op_assign
id|snd_harmony_set_data_format
c_func
(paren
id|h
comma
id|rt-&gt;format
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;channels
op_eq
l_int|2
)paren
id|h-&gt;st.stereo
op_assign
id|HARMONY_SS_STEREO
suffix:semicolon
r_else
id|h-&gt;st.stereo
op_assign
id|HARMONY_SS_MONO
suffix:semicolon
id|harmony_set_control
c_func
(paren
id|h
)paren
suffix:semicolon
id|h-&gt;pbuf.addr
op_assign
id|rt-&gt;dma_addr
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|snd_harmony_capture_prepare
id|snd_harmony_capture_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|ss
)paren
(brace
id|harmony_t
op_star
id|h
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|ss
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|rt
op_assign
id|ss-&gt;runtime
suffix:semicolon
r_if
c_cond
(paren
id|h-&gt;st.playing
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|h-&gt;cbuf.size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|ss
)paren
suffix:semicolon
id|h-&gt;cbuf.count
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|ss
)paren
suffix:semicolon
id|h-&gt;cbuf.buf
op_assign
l_int|0
suffix:semicolon
id|h-&gt;st.capturing
op_assign
l_int|0
suffix:semicolon
id|h-&gt;st.rate
op_assign
id|snd_harmony_rate_bits
c_func
(paren
id|rt-&gt;rate
)paren
suffix:semicolon
id|h-&gt;st.format
op_assign
id|snd_harmony_set_data_format
c_func
(paren
id|h
comma
id|rt-&gt;format
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rt-&gt;channels
op_eq
l_int|2
)paren
id|h-&gt;st.stereo
op_assign
id|HARMONY_SS_STEREO
suffix:semicolon
r_else
id|h-&gt;st.stereo
op_assign
id|HARMONY_SS_MONO
suffix:semicolon
id|harmony_set_control
c_func
(paren
id|h
)paren
suffix:semicolon
id|h-&gt;cbuf.addr
op_assign
id|rt-&gt;dma_addr
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
id|snd_pcm_uframes_t
DECL|function|snd_harmony_playback_pointer
id|snd_harmony_playback_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|ss
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|rt
op_assign
id|ss-&gt;runtime
suffix:semicolon
id|harmony_t
op_star
id|h
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|ss
)paren
suffix:semicolon
r_int
r_int
id|pcuradd
suffix:semicolon
r_int
r_int
id|played
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|h-&gt;st.playing
)paren
op_logical_or
(paren
id|h-&gt;psubs
op_eq
l_int|NULL
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|h-&gt;pbuf.addr
op_eq
l_int|0
)paren
op_logical_or
(paren
id|h-&gt;pbuf.size
op_eq
l_int|0
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|pcuradd
op_assign
id|harmony_read
c_func
(paren
id|h
comma
id|HARMONY_PCURADD
)paren
suffix:semicolon
id|played
op_assign
id|pcuradd
op_minus
id|h-&gt;pbuf.addr
suffix:semicolon
macro_line|#ifdef HARMONY_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
id|PFX
l_string|&quot;playback_pointer is 0x%lx-0x%lx = %d bytes&bslash;n&quot;
comma
id|pcuradd
comma
id|h-&gt;pbuf.addr
comma
id|played
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|pcuradd
OG
id|h-&gt;pbuf.addr
op_plus
id|h-&gt;pbuf.size
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_return
id|bytes_to_frames
c_func
(paren
id|rt
comma
id|played
)paren
suffix:semicolon
)brace
r_static
id|snd_pcm_uframes_t
DECL|function|snd_harmony_capture_pointer
id|snd_harmony_capture_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|ss
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|rt
op_assign
id|ss-&gt;runtime
suffix:semicolon
id|harmony_t
op_star
id|h
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|ss
)paren
suffix:semicolon
r_int
r_int
id|rcuradd
suffix:semicolon
r_int
r_int
id|caught
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|h-&gt;st.capturing
)paren
op_logical_or
(paren
id|h-&gt;csubs
op_eq
l_int|NULL
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|h-&gt;cbuf.addr
op_eq
l_int|0
)paren
op_logical_or
(paren
id|h-&gt;cbuf.size
op_eq
l_int|0
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|rcuradd
op_assign
id|harmony_read
c_func
(paren
id|h
comma
id|HARMONY_RCURADD
)paren
suffix:semicolon
id|caught
op_assign
id|rcuradd
op_minus
id|h-&gt;cbuf.addr
suffix:semicolon
macro_line|#ifdef HARMONY_DEBUG
id|printk
c_func
(paren
id|KERN_DEBUG
id|PFX
l_string|&quot;capture_pointer is 0x%lx-0x%lx = %d bytes&bslash;n&quot;
comma
id|rcuradd
comma
id|h-&gt;cbuf.addr
comma
id|caught
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|rcuradd
OG
id|h-&gt;cbuf.addr
op_plus
id|h-&gt;cbuf.size
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_return
id|bytes_to_frames
c_func
(paren
id|rt
comma
id|caught
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|snd_harmony_playback_open
id|snd_harmony_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|ss
)paren
(brace
id|harmony_t
op_star
id|h
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|ss
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|rt
op_assign
id|ss-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
id|h-&gt;psubs
op_assign
id|ss
suffix:semicolon
id|rt-&gt;hw
op_assign
id|snd_harmony_playback
suffix:semicolon
id|snd_pcm_hw_constraint_list
c_func
(paren
id|rt
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
op_amp
id|hw_constraint_rates
)paren
suffix:semicolon
id|err
op_assign
id|snd_pcm_hw_constraint_integer
c_func
(paren
id|rt
comma
id|SNDRV_PCM_HW_PARAM_PERIODS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|snd_harmony_capture_open
id|snd_harmony_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|ss
)paren
(brace
id|harmony_t
op_star
id|h
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|ss
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|rt
op_assign
id|ss-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
id|h-&gt;csubs
op_assign
id|ss
suffix:semicolon
id|rt-&gt;hw
op_assign
id|snd_harmony_capture
suffix:semicolon
id|snd_pcm_hw_constraint_list
c_func
(paren
id|rt
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
op_amp
id|hw_constraint_rates
)paren
suffix:semicolon
id|err
op_assign
id|snd_pcm_hw_constraint_integer
c_func
(paren
id|rt
comma
id|SNDRV_PCM_HW_PARAM_PERIODS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|snd_harmony_playback_close
id|snd_harmony_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|ss
)paren
(brace
id|harmony_t
op_star
id|h
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|ss
)paren
suffix:semicolon
id|h-&gt;psubs
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|snd_harmony_capture_close
id|snd_harmony_capture_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|ss
)paren
(brace
id|harmony_t
op_star
id|h
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|ss
)paren
suffix:semicolon
id|h-&gt;csubs
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|snd_harmony_hw_params
id|snd_harmony_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|ss
comma
id|snd_pcm_hw_params_t
op_star
id|hw
)paren
(brace
r_int
id|err
suffix:semicolon
id|harmony_t
op_star
id|h
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|ss
)paren
suffix:semicolon
id|err
op_assign
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|ss
comma
id|params_buffer_bytes
c_func
(paren
id|hw
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OG
l_int|0
op_logical_and
id|h-&gt;dma.type
op_eq
id|SNDRV_DMA_TYPE_CONTINUOUS
)paren
id|ss-&gt;runtime-&gt;dma_addr
op_assign
id|__pa
c_func
(paren
id|ss-&gt;runtime-&gt;dma_area
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_static
r_int
DECL|function|snd_harmony_hw_free
id|snd_harmony_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|ss
)paren
(brace
r_return
id|snd_pcm_lib_free_pages
c_func
(paren
id|ss
)paren
suffix:semicolon
)brace
DECL|variable|snd_harmony_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_harmony_playback_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_harmony_playback_open
comma
dot
id|close
op_assign
id|snd_harmony_playback_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_harmony_hw_params
comma
dot
id|hw_free
op_assign
id|snd_harmony_hw_free
comma
dot
id|prepare
op_assign
id|snd_harmony_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_harmony_playback_trigger
comma
dot
id|pointer
op_assign
id|snd_harmony_playback_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_harmony_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_harmony_capture_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_harmony_capture_open
comma
dot
id|close
op_assign
id|snd_harmony_capture_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_harmony_hw_params
comma
dot
id|hw_free
op_assign
id|snd_harmony_hw_free
comma
dot
id|prepare
op_assign
id|snd_harmony_capture_prepare
comma
dot
id|trigger
op_assign
id|snd_harmony_capture_trigger
comma
dot
id|pointer
op_assign
id|snd_harmony_capture_pointer
comma
)brace
suffix:semicolon
r_static
r_int
DECL|function|snd_harmony_pcm_init
id|snd_harmony_pcm_init
c_func
(paren
id|harmony_t
op_star
id|h
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
id|harmony_disable_interrupts
c_func
(paren
id|h
)paren
suffix:semicolon
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|h-&gt;card
comma
l_string|&quot;harmony&quot;
comma
l_int|0
comma
l_int|1
comma
l_int|1
comma
op_amp
id|pcm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_harmony_playback_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_harmony_capture_ops
)paren
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|h
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;harmony&quot;
)paren
suffix:semicolon
id|h-&gt;pcm
op_assign
id|pcm
suffix:semicolon
id|h-&gt;psubs
op_assign
l_int|NULL
suffix:semicolon
id|h-&gt;csubs
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* initialize graveyard buffer */
id|h-&gt;dma.type
op_assign
id|SNDRV_DMA_TYPE_DEV
suffix:semicolon
id|h-&gt;dma.dev
op_assign
op_amp
id|h-&gt;dev-&gt;dev
suffix:semicolon
id|err
op_assign
id|snd_dma_alloc_pages
c_func
(paren
id|h-&gt;dma.type
comma
id|h-&gt;dma.dev
comma
id|BUF_SIZE
op_star
id|GRAVEYARD_BUFS
comma
op_amp
id|h-&gt;gdma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;cannot allocate graveyard buffer!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* initialize silence buffers */
id|err
op_assign
id|snd_dma_alloc_pages
c_func
(paren
id|h-&gt;dma.type
comma
id|h-&gt;dma.dev
comma
id|BUF_SIZE
op_star
id|SILENCE_BUFS
comma
op_amp
id|h-&gt;sdma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;cannot allocate silence buffer!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* pre-allocate space for DMA */
id|err
op_assign
id|snd_pcm_lib_preallocate_pages_for_all
c_func
(paren
id|pcm
comma
id|h-&gt;dma.type
comma
id|h-&gt;dma.dev
comma
id|MAX_BUF_SIZE
comma
id|MAX_BUF_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;buffer allocation error: %d&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|snd_harmony_set_new_gain
id|snd_harmony_set_new_gain
c_func
(paren
id|harmony_t
op_star
id|h
)paren
(brace
id|harmony_wait_for_control
c_func
(paren
id|h
)paren
suffix:semicolon
id|harmony_write
c_func
(paren
id|h
comma
id|HARMONY_GAINCTL
comma
id|h-&gt;st.gain
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|snd_harmony_mixercontrol_info
id|snd_harmony_mixercontrol_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kc
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_int
id|mask
op_assign
(paren
id|kc-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|left_shift
op_assign
(paren
id|kc-&gt;private_value
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|right_shift
op_assign
(paren
id|kc-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|mask
op_eq
l_int|1
ques
c_cond
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:colon
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
id|left_shift
op_eq
id|right_shift
ques
c_cond
l_int|1
suffix:colon
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
id|mask
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|snd_harmony_volume_get
id|snd_harmony_volume_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kc
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|harmony_t
op_star
id|h
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kc
)paren
suffix:semicolon
r_int
id|shift_left
op_assign
(paren
id|kc-&gt;private_value
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift_right
op_assign
(paren
id|kc-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kc-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kc-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|left
comma
id|right
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|h-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
id|left
op_assign
(paren
id|h-&gt;st.gain
op_rshift
id|shift_left
)paren
op_amp
id|mask
suffix:semicolon
id|right
op_assign
(paren
id|h-&gt;st.gain
op_rshift
id|shift_right
)paren
op_amp
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
(brace
id|left
op_assign
id|mask
op_minus
id|left
suffix:semicolon
id|right
op_assign
id|mask
op_minus
id|right
suffix:semicolon
)brace
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|left
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
id|right
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|h-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|snd_harmony_volume_put
id|snd_harmony_volume_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kc
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|harmony_t
op_star
id|h
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kc
)paren
suffix:semicolon
r_int
id|shift_left
op_assign
(paren
id|kc-&gt;private_value
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift_right
op_assign
(paren
id|kc-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kc-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kc-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|left
comma
id|right
suffix:semicolon
r_int
id|old_gain
op_assign
id|h-&gt;st.gain
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|left
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
id|mask
suffix:semicolon
id|right
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_amp
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
(brace
id|left
op_assign
id|mask
op_minus
id|left
suffix:semicolon
id|right
op_assign
id|mask
op_minus
id|right
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|h-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
id|h-&gt;st.gain
op_and_assign
op_complement
(paren
(paren
id|mask
op_lshift
id|shift_right
)paren
op_or
(paren
id|mask
op_lshift
id|shift_left
)paren
)paren
suffix:semicolon
id|h-&gt;st.gain
op_or_assign
(paren
(paren
id|left
op_lshift
id|shift_left
)paren
op_or
(paren
id|right
op_lshift
id|shift_right
)paren
)paren
suffix:semicolon
id|snd_harmony_set_new_gain
c_func
(paren
id|h
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|h-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
r_return
(paren
id|old_gain
op_minus
id|h-&gt;st.gain
)paren
suffix:semicolon
)brace
DECL|macro|HARMONY_CONTROLS
mdefine_line|#define HARMONY_CONTROLS (sizeof(snd_harmony_controls)/ &bslash;&n;                          sizeof(snd_kcontrol_new_t))
DECL|macro|HARMONY_VOLUME
mdefine_line|#define HARMONY_VOLUME(xname, left_shift, right_shift, mask, invert) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname,                &bslash;&n;  .info = snd_harmony_mixercontrol_info,                             &bslash;&n;  .get = snd_harmony_volume_get, .put = snd_harmony_volume_put,      &bslash;&n;  .private_value = ((left_shift) | ((right_shift) &lt;&lt; 8) |            &bslash;&n;                   ((mask) &lt;&lt; 16) | ((invert) &lt;&lt; 24)) }
DECL|variable|snd_harmony_controls
r_static
id|snd_kcontrol_new_t
id|snd_harmony_controls
(braket
)braket
op_assign
(brace
id|HARMONY_VOLUME
c_func
(paren
l_string|&quot;Playback Volume&quot;
comma
id|HARMONY_GAIN_LO_SHIFT
comma
id|HARMONY_GAIN_RO_SHIFT
comma
id|HARMONY_GAIN_OUT
comma
l_int|1
)paren
comma
id|HARMONY_VOLUME
c_func
(paren
l_string|&quot;Capture Volume&quot;
comma
id|HARMONY_GAIN_LI_SHIFT
comma
id|HARMONY_GAIN_RI_SHIFT
comma
id|HARMONY_GAIN_IN
comma
l_int|0
)paren
comma
)brace
suffix:semicolon
r_static
r_void
id|__init
DECL|function|snd_harmony_mixer_reset
id|snd_harmony_mixer_reset
c_func
(paren
id|harmony_t
op_star
id|h
)paren
(brace
id|harmony_mute
c_func
(paren
id|h
)paren
suffix:semicolon
id|harmony_reset
c_func
(paren
id|h
)paren
suffix:semicolon
id|h-&gt;st.gain
op_assign
id|HARMONY_GAIN_DEFAULT
suffix:semicolon
id|harmony_unmute
c_func
(paren
id|h
)paren
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|snd_harmony_mixer_init
id|snd_harmony_mixer_init
c_func
(paren
id|harmony_t
op_star
id|h
)paren
(brace
id|snd_card_t
op_star
id|card
op_assign
id|h-&gt;card
suffix:semicolon
r_int
id|idx
comma
id|err
suffix:semicolon
id|snd_assert
c_func
(paren
id|h
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;mixername
comma
l_string|&quot;Harmony Gain control interface&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|HARMONY_CONTROLS
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_harmony_controls
(braket
id|idx
)braket
comma
id|h
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
id|snd_harmony_mixer_reset
c_func
(paren
id|h
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|snd_harmony_free
id|snd_harmony_free
c_func
(paren
id|harmony_t
op_star
id|h
)paren
(brace
r_if
c_cond
(paren
id|h-&gt;gdma.addr
)paren
id|snd_dma_free_pages
c_func
(paren
op_amp
id|h-&gt;gdma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|h-&gt;sdma.addr
)paren
id|snd_dma_free_pages
c_func
(paren
op_amp
id|h-&gt;sdma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|h-&gt;irq
op_ge
l_int|0
)paren
id|free_irq
c_func
(paren
id|h-&gt;irq
comma
id|h
)paren
suffix:semicolon
r_if
c_cond
(paren
id|h-&gt;iobase
)paren
id|iounmap
c_func
(paren
id|h-&gt;iobase
)paren
suffix:semicolon
id|parisc_set_drvdata
c_func
(paren
id|h-&gt;dev
comma
l_int|NULL
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|h
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|snd_harmony_dev_free
id|snd_harmony_dev_free
c_func
(paren
id|snd_device_t
op_star
id|dev
)paren
(brace
id|harmony_t
op_star
id|h
op_assign
id|dev-&gt;device_data
suffix:semicolon
r_return
id|snd_harmony_free
c_func
(paren
id|h
)paren
suffix:semicolon
)brace
r_static
r_int
id|__devinit
DECL|function|snd_harmony_create
id|snd_harmony_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_struct
id|parisc_device
op_star
id|padev
comma
id|harmony_t
op_star
op_star
id|rchip
)paren
(brace
r_int
id|err
suffix:semicolon
id|harmony_t
op_star
id|h
suffix:semicolon
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
dot
id|dev_free
op_assign
id|snd_harmony_dev_free
comma
)brace
suffix:semicolon
op_star
id|rchip
op_assign
l_int|NULL
suffix:semicolon
id|h
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|h
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|h
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|h-&gt;st
comma
l_int|0
comma
r_sizeof
(paren
id|h-&gt;st
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|h-&gt;stats
comma
l_int|0
comma
r_sizeof
(paren
id|h-&gt;stats
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|h-&gt;pbuf
comma
l_int|0
comma
r_sizeof
(paren
id|h-&gt;pbuf
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|h-&gt;cbuf
comma
l_int|0
comma
r_sizeof
(paren
id|h-&gt;cbuf
)paren
)paren
suffix:semicolon
id|h-&gt;hpa
op_assign
id|padev-&gt;hpa
suffix:semicolon
id|h-&gt;card
op_assign
id|card
suffix:semicolon
id|h-&gt;dev
op_assign
id|padev
suffix:semicolon
id|h-&gt;irq
op_assign
id|padev-&gt;irq
suffix:semicolon
id|h-&gt;iobase
op_assign
id|ioremap_nocache
c_func
(paren
id|padev-&gt;hpa
comma
id|HARMONY_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|h-&gt;iobase
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;unable to remap hpa 0x%lx&bslash;n&quot;
comma
id|padev-&gt;hpa
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|free_and_ret
suffix:semicolon
)brace
id|err
op_assign
id|request_irq
c_func
(paren
id|h-&gt;irq
comma
id|snd_harmony_interrupt
comma
l_int|0
comma
l_string|&quot;harmony&quot;
comma
id|h
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;could not obtain interrupt %d&quot;
comma
id|h-&gt;irq
)paren
suffix:semicolon
r_goto
id|free_and_ret
suffix:semicolon
)brace
id|spin_lock_init
c_func
(paren
op_amp
id|h-&gt;mixer_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|h-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|h
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
r_goto
id|free_and_ret
suffix:semicolon
)brace
op_star
id|rchip
op_assign
id|h
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|free_and_ret
suffix:colon
id|snd_harmony_free
c_func
(paren
id|h
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_static
r_int
id|__devinit
DECL|function|snd_harmony_probe
id|snd_harmony_probe
c_func
(paren
r_struct
id|parisc_device
op_star
id|padev
)paren
(brace
r_int
id|err
suffix:semicolon
r_static
r_int
id|dev
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
id|harmony_t
op_star
id|h
suffix:semicolon
r_static
r_int
id|index
op_assign
id|SNDRV_DEFAULT_IDX1
suffix:semicolon
r_static
r_char
op_star
id|id
op_assign
id|SNDRV_DEFAULT_STR1
suffix:semicolon
id|h
op_assign
id|parisc_get_drvdata
c_func
(paren
id|padev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|h
op_ne
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|card
op_assign
id|snd_card_new
c_func
(paren
id|index
comma
id|id
comma
id|THIS_MODULE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|err
op_assign
id|snd_harmony_create
c_func
(paren
id|card
comma
id|padev
comma
op_amp
id|h
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
r_goto
id|free_and_ret
suffix:semicolon
)brace
id|err
op_assign
id|snd_harmony_pcm_init
c_func
(paren
id|h
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
r_goto
id|free_and_ret
suffix:semicolon
)brace
id|err
op_assign
id|snd_harmony_mixer_init
c_func
(paren
id|h
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
r_goto
id|free_and_ret
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;harmony&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;shortname
comma
l_string|&quot;Harmony&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;%s at 0x%lx, irq %i&quot;
comma
id|card-&gt;shortname
comma
id|h-&gt;hpa
comma
id|h-&gt;irq
)paren
suffix:semicolon
id|err
op_assign
id|snd_card_register
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
r_goto
id|free_and_ret
suffix:semicolon
)brace
id|dev
op_increment
suffix:semicolon
id|parisc_set_drvdata
c_func
(paren
id|padev
comma
id|h
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|free_and_ret
suffix:colon
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_static
r_int
id|__devexit
DECL|function|snd_harmony_remove
id|snd_harmony_remove
c_func
(paren
r_struct
id|parisc_device
op_star
id|padev
)paren
(brace
id|harmony_t
op_star
id|h
op_assign
id|parisc_get_drvdata
c_func
(paren
id|padev
)paren
suffix:semicolon
id|snd_card_free
c_func
(paren
id|h-&gt;card
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_harmony_driver
r_static
r_struct
id|parisc_driver
id|snd_harmony_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;harmony&quot;
comma
dot
id|id_table
op_assign
id|snd_harmony_devtable
comma
dot
id|probe
op_assign
id|snd_harmony_probe
comma
dot
id|remove
op_assign
id|snd_harmony_remove
comma
)brace
suffix:semicolon
r_static
r_int
id|__init
DECL|function|alsa_harmony_init
id|alsa_harmony_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
id|err
op_assign
id|register_parisc_driver
c_func
(paren
op_amp
id|snd_harmony_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;device not found&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|alsa_harmony_fini
id|alsa_harmony_fini
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
id|err
op_assign
id|unregister_parisc_driver
c_func
(paren
op_amp
id|snd_harmony_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PFX
l_string|&quot;failed to unregister&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Kyle McMartin &lt;kyle@parisc-linux.org&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Harmony sound driver&quot;
)paren
suffix:semicolon
DECL|variable|alsa_harmony_init
id|module_init
c_func
(paren
id|alsa_harmony_init
)paren
suffix:semicolon
DECL|variable|alsa_harmony_fini
id|module_exit
c_func
(paren
id|alsa_harmony_fini
)paren
suffix:semicolon
eof
