multiline_comment|/*&n; *  MIDI clock event converter&n; *&n; *  Copyright (c) 2000 by Takashi Iwai &lt;tiwai@suse.de&gt;&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &quot;seq_queue.h&quot;
macro_line|#ifdef SNDRV_SEQ_SYNC_SUPPORT
DECL|struct|midi_clock
r_typedef
r_struct
id|midi_clock
(brace
DECL|member|cur_pos
r_int
r_int
id|cur_pos
suffix:semicolon
DECL|typedef|midi_clock_t
)brace
id|midi_clock_t
suffix:semicolon
DECL|function|midi_open
r_static
r_int
id|midi_open
c_func
(paren
id|queue_sync_t
op_star
id|sync_info
comma
id|seq_sync_arg_t
op_star
id|retp
)paren
(brace
id|midi_clock_t
op_star
id|arg
suffix:semicolon
r_if
c_cond
(paren
(paren
id|arg
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|arg
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|sync_info-&gt;param.tick.ppq
op_assign
l_int|24
suffix:semicolon
id|sync_info-&gt;param.tick.ticks
op_assign
l_int|1
suffix:semicolon
id|arg-&gt;cur_pos
op_assign
l_int|0
suffix:semicolon
op_star
id|retp
op_assign
id|arg
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|midi_sync_out
r_static
r_int
id|midi_sync_out
c_func
(paren
id|seq_sync_arg_t
id|_arg
comma
r_const
id|snd_seq_event_t
op_star
id|src
comma
id|snd_seq_event_t
op_star
id|ev
)paren
(brace
r_switch
c_cond
(paren
id|src-&gt;type
)paren
(brace
r_case
id|SNDRV_SEQ_EVENT_SYNC
suffix:colon
id|ev-&gt;type
op_assign
id|SNDRV_SEQ_EVENT_CLOCK
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_SYNC_POS
suffix:colon
id|ev-&gt;type
op_assign
id|SNDRV_SEQ_EVENT_SONGPOS
suffix:semicolon
id|ev-&gt;data.control.value
op_assign
id|src-&gt;data.queue.param.position
op_div
l_int|6
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|midi_sync_in
r_static
r_int
id|midi_sync_in
c_func
(paren
id|seq_sync_arg_t
id|_arg
comma
r_const
id|snd_seq_event_t
op_star
id|src
comma
id|snd_seq_event_t
op_star
id|ev
)paren
(brace
id|midi_clock_t
op_star
id|arg
op_assign
id|_arg
suffix:semicolon
r_switch
c_cond
(paren
id|src-&gt;type
)paren
(brace
r_case
id|SNDRV_SEQ_EVENT_CLOCK
suffix:colon
id|ev-&gt;type
op_assign
id|SNDRV_SEQ_EVENT_SYNC
suffix:semicolon
id|ev-&gt;data.queue.param.position
op_assign
id|arg-&gt;cur_pos
suffix:semicolon
id|arg-&gt;cur_pos
op_increment
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_SONGPOS
suffix:colon
id|ev-&gt;type
op_assign
id|SNDRV_SEQ_EVENT_SYNC_POS
suffix:semicolon
id|arg-&gt;cur_pos
op_assign
id|src-&gt;data.control.value
op_star
l_int|6
suffix:semicolon
id|ev-&gt;data.queue.param.position
op_assign
id|arg-&gt;cur_pos
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* exported */
DECL|variable|snd_seq_midi_clock_parser
id|seq_sync_parser_t
id|snd_seq_midi_clock_parser
op_assign
(brace
id|format
suffix:colon
id|SNDRV_SEQ_SYNC_FMT_MIDI_CLOCK
comma
id|in
suffix:colon
(brace
id|open
suffix:colon
id|midi_open
comma
id|sync
suffix:colon
id|midi_sync_in
comma
)brace
comma
id|out
suffix:colon
(brace
id|open
suffix:colon
id|midi_open
comma
id|sync
suffix:colon
id|midi_sync_out
comma
)brace
comma
)brace
suffix:semicolon
macro_line|#endif /* SNDRV_SEQ_SYNC_SUPPORT */
eof
