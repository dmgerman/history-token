multiline_comment|/*&n; *   ALSA sequencer queue synchronization routine&n; *&n; *   Copyright (c) 2000 by Takashi Iwai &lt;tiwai@suse.de&gt;&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &quot;seq_memory.h&quot;
macro_line|#include &quot;seq_queue.h&quot;
macro_line|#include &quot;seq_clientmgr.h&quot;
macro_line|#include &quot;seq_fifo.h&quot;
macro_line|#include &quot;seq_timer.h&quot;
macro_line|#include &quot;seq_info.h&quot;
macro_line|#ifdef SNDRV_SEQ_SYNC_SUPPORT
DECL|macro|FOR_EACH_LIST
mdefine_line|#define FOR_EACH_LIST(var,list) &bslash;&n;for (var = (list)-&gt;next; var != list; var = var-&gt;next)
multiline_comment|/*&n; * callbacks&n; */
r_static
r_int
id|event_input_sync
c_func
(paren
id|snd_seq_event_t
op_star
id|ev
comma
r_int
id|direct
comma
r_void
op_star
id|private_data
comma
r_int
id|atomic
comma
r_int
id|hop
)paren
suffix:semicolon
r_static
r_int
id|queue_master_add
c_func
(paren
r_void
op_star
id|private_data
comma
id|snd_seq_port_subscribe_t
op_star
id|subs
)paren
suffix:semicolon
r_static
r_int
id|queue_master_remove
c_func
(paren
r_void
op_star
id|private_data
comma
id|snd_seq_port_subscribe_t
op_star
id|subs
)paren
suffix:semicolon
r_static
r_void
id|queue_delete_all_masters
c_func
(paren
id|queue_t
op_star
id|q
)paren
suffix:semicolon
r_static
r_int
id|queue_slave_set
c_func
(paren
r_void
op_star
id|private_data
comma
id|snd_seq_port_subscribe_t
op_star
id|subs
)paren
suffix:semicolon
r_static
r_int
id|queue_slave_reset
c_func
(paren
r_void
op_star
id|private_data
comma
id|snd_seq_port_subscribe_t
op_star
id|subs
)paren
suffix:semicolon
r_static
r_void
id|queue_sync_close_parser
c_func
(paren
id|queue_sync_t
op_star
id|sync
comma
r_int
id|slave
)paren
suffix:semicolon
multiline_comment|/*&n; * pre-defined event parsers&n; */
r_extern
id|seq_sync_parser_t
id|snd_seq_midi_clock_parser
suffix:semicolon
multiline_comment|/* seq_midi_clock.c */
r_extern
id|seq_sync_parser_t
id|snd_seq_mtc_parser
suffix:semicolon
multiline_comment|/* seq_mtc.c */
r_extern
id|seq_sync_parser_t
id|snd_seq_dtl_parser
suffix:semicolon
multiline_comment|/* seq_dtl.c */
DECL|variable|event_parsers
r_static
id|seq_sync_parser_t
op_star
id|event_parsers
(braket
)braket
op_assign
(brace
op_amp
id|snd_seq_midi_clock_parser
comma
op_amp
id|snd_seq_mtc_parser
comma
op_amp
id|snd_seq_dtl_parser
comma
l_int|NULL
)brace
suffix:semicolon
multiline_comment|/*&n; * create a sync port corresponding to the specified queue&n; */
DECL|function|snd_seq_sync_create_port
r_int
id|snd_seq_sync_create_port
c_func
(paren
id|queue_t
op_star
id|queue
)paren
(brace
id|snd_seq_port_info_t
id|port
suffix:semicolon
id|snd_seq_port_callback_t
id|pcallbacks
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|pcallbacks
comma
l_int|0
comma
r_sizeof
(paren
id|pcallbacks
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|port
comma
l_int|0
comma
r_sizeof
(paren
id|port
)paren
)paren
suffix:semicolon
id|pcallbacks.owner
op_assign
id|THIS_MODULE
suffix:semicolon
id|pcallbacks.event_input
op_assign
id|event_input_sync
suffix:semicolon
id|pcallbacks.subscribe
op_assign
id|queue_master_add
suffix:semicolon
id|pcallbacks.unsubscribe
op_assign
id|queue_master_remove
suffix:semicolon
id|pcallbacks.use
op_assign
id|queue_slave_set
suffix:semicolon
id|pcallbacks.unuse
op_assign
id|queue_slave_reset
suffix:semicolon
id|pcallbacks.private_data
op_assign
id|queue
suffix:semicolon
id|pcallbacks.callback_all
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* call callbacks at each subscription */
id|port.capability
op_assign
id|SNDRV_SEQ_PORT_CAP_READ
op_or
id|SNDRV_SEQ_PORT_CAP_SUBS_READ
op_or
id|SNDRV_SEQ_PORT_CAP_WRITE
op_or
id|SNDRV_SEQ_PORT_CAP_SUBS_WRITE
op_or
id|SNDRV_SEQ_PORT_CAP_DUPLEX
op_or
id|SNDRV_SEQ_PORT_CAP_SYNC_READ
op_or
id|SNDRV_SEQ_PORT_CAP_SYNC_WRITE
suffix:semicolon
id|port.type
op_assign
l_int|0
suffix:semicolon
id|sprintf
c_func
(paren
id|port.name
comma
l_string|&quot;Sync Queue %d&quot;
comma
id|queue-&gt;queue
)paren
suffix:semicolon
id|port.kernel
op_assign
op_amp
id|pcallbacks
suffix:semicolon
id|port.flags
op_assign
id|SNDRV_SEQ_PORT_FLG_GIVEN_PORT
suffix:semicolon
id|port.port
op_assign
id|snd_seq_queue_sync_port
c_func
(paren
id|queue-&gt;queue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_seq_kernel_client_ctl
c_func
(paren
id|SNDRV_SEQ_CLIENT_SYSTEM
comma
id|SNDRV_SEQ_IOCTL_CREATE_PORT
comma
op_amp
id|port
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|queue-&gt;sync_port.client
op_assign
id|SNDRV_SEQ_CLIENT_SYSTEM
suffix:semicolon
id|queue-&gt;sync_port.port
op_assign
id|port.port
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * delete attached sync port to the queue&n; */
DECL|function|snd_seq_sync_delete_port
r_int
id|snd_seq_sync_delete_port
c_func
(paren
id|queue_t
op_star
id|queue
)paren
(brace
id|snd_seq_port_info_t
id|port
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|port
comma
l_int|0
comma
r_sizeof
(paren
id|port
)paren
)paren
suffix:semicolon
id|port.client
op_assign
id|queue-&gt;sync_port.client
suffix:semicolon
id|port.port
op_assign
id|queue-&gt;sync_port.port
suffix:semicolon
r_if
c_cond
(paren
id|snd_seq_kernel_client_ctl
c_func
(paren
id|SNDRV_SEQ_CLIENT_SYSTEM
comma
id|SNDRV_SEQ_IOCTL_DELETE_PORT
comma
op_amp
id|port
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|queue_delete_all_masters
c_func
(paren
id|queue
)paren
suffix:semicolon
id|queue_sync_close_parser
c_func
(paren
op_amp
id|queue-&gt;slave
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * send a sync signal to the sync slave client&n; */
DECL|function|queue_send_sync_event
r_static
r_void
id|queue_send_sync_event
c_func
(paren
id|queue_t
op_star
id|q
comma
id|queue_sync_t
op_star
id|master
comma
r_int
id|type
comma
r_int
id|atomic
comma
r_int
id|hop
)paren
(brace
id|snd_seq_event_t
id|event
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|event
comma
l_int|0
comma
r_sizeof
(paren
id|event
)paren
)paren
suffix:semicolon
id|event.flags
op_assign
id|SNDRV_SEQ_TIME_MODE_ABS
suffix:semicolon
multiline_comment|/* since we use direct delivery, we have to convert time stamp here.. */
r_switch
c_cond
(paren
id|master-&gt;format
op_amp
id|SNDRV_SEQ_SYNC_MODE
)paren
(brace
r_case
id|SNDRV_SEQ_SYNC_TICK
suffix:colon
id|event.flags
op_or_assign
id|SNDRV_SEQ_TIME_STAMP_TICK
suffix:semicolon
id|event.time.tick
op_assign
id|q-&gt;timer-&gt;tick.cur_tick
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_SYNC_TIME
suffix:colon
id|event.flags
op_or_assign
id|SNDRV_SEQ_TIME_STAMP_REAL
suffix:semicolon
id|event.time.time
op_assign
id|q-&gt;timer-&gt;cur_time
suffix:semicolon
r_break
suffix:semicolon
)brace
id|event.type
op_assign
id|type
suffix:semicolon
id|event.data.queue.queue
op_assign
id|q-&gt;queue
suffix:semicolon
id|event.data.queue.sync_format
op_assign
id|master-&gt;format
suffix:semicolon
id|event.data.queue.sync_time_format
op_assign
id|master-&gt;time_format
suffix:semicolon
id|event.data.queue.param.position
op_assign
id|master-&gt;counter
suffix:semicolon
id|event.source
op_assign
id|q-&gt;sync_port
suffix:semicolon
id|event.dest
op_assign
id|master-&gt;addr
suffix:semicolon
r_if
c_cond
(paren
id|master-&gt;parser
)paren
(brace
id|snd_seq_event_t
id|newev
suffix:semicolon
id|newev
op_assign
id|event
suffix:semicolon
r_if
c_cond
(paren
id|master-&gt;parser-&gt;out
dot
id|sync
c_func
(paren
id|master-&gt;parser_arg
comma
op_amp
id|event
comma
op_amp
id|newev
)paren
OG
l_int|0
)paren
(brace
id|snd_seq_kernel_client_dispatch
c_func
(paren
id|SNDRV_SEQ_CLIENT_SYSTEM
comma
op_amp
id|newev
comma
id|atomic
comma
id|hop
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|snd_seq_kernel_client_dispatch
c_func
(paren
id|SNDRV_SEQ_CLIENT_SYSTEM
comma
op_amp
id|event
comma
id|atomic
comma
id|hop
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * initialize the sync position&n; */
DECL|function|queue_sync_clear
r_static
r_void
id|queue_sync_clear
c_func
(paren
id|queue_sync_t
op_star
id|sync
)paren
(brace
id|memset
c_func
(paren
op_amp
id|sync-&gt;cur_time
comma
l_int|0
comma
r_sizeof
(paren
id|sync-&gt;cur_time
)paren
)paren
suffix:semicolon
id|sync-&gt;counter
op_assign
l_int|0
suffix:semicolon
id|sync-&gt;sync_tick.cur_tick
op_assign
l_int|0
suffix:semicolon
id|sync-&gt;sync_tick.fraction
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * initialize all sync positions&n; */
DECL|function|snd_seq_sync_clear
r_void
id|snd_seq_sync_clear
c_func
(paren
id|queue_t
op_star
id|q
)paren
(brace
r_struct
id|list_head
op_star
id|head
suffix:semicolon
multiline_comment|/* clear master positions */
id|read_lock
c_func
(paren
op_amp
id|q-&gt;master_lock
)paren
suffix:semicolon
id|FOR_EACH_LIST
c_func
(paren
id|head
comma
op_amp
id|q-&gt;master_head
)paren
(brace
id|queue_sync_t
op_star
id|master
op_assign
id|list_entry
c_func
(paren
id|head
comma
id|queue_sync_t
comma
id|list
)paren
suffix:semicolon
id|queue_sync_clear
c_func
(paren
id|master
)paren
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|q-&gt;master_lock
)paren
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|q-&gt;slave_lock
)paren
suffix:semicolon
id|queue_sync_clear
c_func
(paren
op_amp
id|q-&gt;slave
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|q-&gt;slave_lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * change tick resolution of sync master/slave&n; */
DECL|function|queue_sync_set_tick_resolution
r_static
r_void
id|queue_sync_set_tick_resolution
c_func
(paren
id|queue_t
op_star
id|q
comma
id|queue_sync_t
op_star
id|sync
)paren
(brace
r_int
r_int
id|tempo
comma
id|ppq
suffix:semicolon
id|tempo
op_assign
id|q-&gt;timer-&gt;tempo
suffix:semicolon
r_if
c_cond
(paren
id|sync-&gt;param.tick.ppq
op_eq
l_int|0
)paren
id|ppq
op_assign
id|q-&gt;timer-&gt;ppq
suffix:semicolon
r_else
id|ppq
op_assign
id|sync-&gt;param.tick.ppq
suffix:semicolon
id|snd_seq_timer_set_tick_resolution
c_func
(paren
op_amp
id|sync-&gt;sync_tick
comma
id|tempo
comma
id|ppq
comma
id|sync-&gt;param.tick.ticks
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * update sync-master resolutions&n; */
DECL|function|snd_seq_sync_update_tempo
r_void
id|snd_seq_sync_update_tempo
c_func
(paren
id|queue_t
op_star
id|q
)paren
(brace
r_struct
id|list_head
op_star
id|head
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|q-&gt;master_lock
)paren
suffix:semicolon
id|FOR_EACH_LIST
c_func
(paren
id|head
comma
op_amp
id|q-&gt;master_head
)paren
(brace
id|queue_sync_t
op_star
id|master
op_assign
id|list_entry
c_func
(paren
id|head
comma
id|queue_sync_t
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|master-&gt;format
op_amp
id|SNDRV_SEQ_SYNC_TICK
)paren
id|queue_sync_set_tick_resolution
c_func
(paren
id|q
comma
id|master
)paren
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|q-&gt;master_lock
)paren
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|q-&gt;slave_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;slave.format
op_amp
id|SNDRV_SEQ_SYNC_TICK
)paren
id|queue_sync_set_tick_resolution
c_func
(paren
id|q
comma
op_amp
id|q-&gt;slave
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|q-&gt;slave_lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * change the tick position from the current tick of the queue&n; */
DECL|function|queue_sync_change_tick
r_static
r_void
id|queue_sync_change_tick
c_func
(paren
id|queue_t
op_star
id|q
comma
id|queue_sync_t
op_star
id|sync
)paren
(brace
r_if
c_cond
(paren
id|sync-&gt;param.tick.ppq
op_eq
l_int|0
)paren
id|sync-&gt;counter
op_assign
id|q-&gt;timer-&gt;tick.cur_tick
suffix:semicolon
r_else
id|sync-&gt;counter
op_assign
(paren
id|q-&gt;timer-&gt;tick.cur_tick
op_star
id|sync-&gt;param.tick.ppq
)paren
op_div
id|q-&gt;timer-&gt;ppq
suffix:semicolon
id|sync-&gt;counter
op_div_assign
id|sync-&gt;param.tick.ticks
suffix:semicolon
id|sync-&gt;sync_tick.cur_tick
op_assign
id|sync-&gt;counter
suffix:semicolon
id|sync-&gt;sync_tick.fraction
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * change the time position from the current time of the queue&n; */
DECL|function|queue_sync_change_time
r_static
r_void
id|queue_sync_change_time
c_func
(paren
id|queue_t
op_star
id|q
comma
id|queue_sync_t
op_star
id|sync
)paren
(brace
multiline_comment|/* we need 64bit calculation here.. */
id|u64
id|nsec
suffix:semicolon
id|nsec
op_assign
id|q-&gt;timer-&gt;cur_time.tv_sec
suffix:semicolon
id|nsec
op_mul_assign
l_int|1000000000UL
suffix:semicolon
id|nsec
op_add_assign
id|q-&gt;timer-&gt;cur_time.tv_nsec
suffix:semicolon
id|u64_div
c_func
(paren
id|nsec
comma
id|sync-&gt;param.time.resolution
comma
id|sync-&gt;counter
)paren
suffix:semicolon
id|sync-&gt;counter
op_mul_assign
id|sync-&gt;param.time.subframes
suffix:semicolon
id|sync-&gt;cur_time
op_assign
id|q-&gt;timer-&gt;cur_time
suffix:semicolon
)brace
multiline_comment|/*&n; * update the tick position of all sync&n; */
DECL|function|snd_seq_sync_update_tick
r_void
id|snd_seq_sync_update_tick
c_func
(paren
id|queue_t
op_star
id|q
comma
r_int
id|master_only
comma
r_int
id|atomic
comma
r_int
id|hop
)paren
(brace
r_struct
id|list_head
op_star
id|head
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|q-&gt;master_lock
)paren
suffix:semicolon
id|FOR_EACH_LIST
c_func
(paren
id|head
comma
op_amp
id|q-&gt;master_head
)paren
(brace
id|queue_sync_t
op_star
id|master
op_assign
id|list_entry
c_func
(paren
id|head
comma
id|queue_sync_t
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|master-&gt;format
op_amp
id|SNDRV_SEQ_SYNC_TICK
)paren
(brace
id|queue_sync_change_tick
c_func
(paren
id|q
comma
id|master
)paren
suffix:semicolon
id|queue_send_sync_event
c_func
(paren
id|q
comma
id|master
comma
id|SNDRV_SEQ_EVENT_SYNC_POS
comma
id|atomic
comma
id|hop
)paren
suffix:semicolon
multiline_comment|/* broadcast to client */
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|q-&gt;master_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|master_only
)paren
r_return
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|q-&gt;slave_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;slave.format
op_amp
id|SNDRV_SEQ_SYNC_TICK
)paren
id|queue_sync_change_tick
c_func
(paren
id|q
comma
op_amp
id|q-&gt;slave
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|q-&gt;slave_lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * update the time position of all sync&n; */
DECL|function|snd_seq_sync_update_time
r_void
id|snd_seq_sync_update_time
c_func
(paren
id|queue_t
op_star
id|q
comma
r_int
id|master_only
comma
r_int
id|atomic
comma
r_int
id|hop
)paren
(brace
r_struct
id|list_head
op_star
id|head
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|q-&gt;master_lock
)paren
suffix:semicolon
id|FOR_EACH_LIST
c_func
(paren
id|head
comma
op_amp
id|q-&gt;master_head
)paren
(brace
id|queue_sync_t
op_star
id|master
op_assign
id|list_entry
c_func
(paren
id|head
comma
id|queue_sync_t
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|master-&gt;format
op_amp
id|SNDRV_SEQ_SYNC_TIME
)paren
(brace
id|queue_sync_change_time
c_func
(paren
id|q
comma
id|master
)paren
suffix:semicolon
id|queue_send_sync_event
c_func
(paren
id|q
comma
id|master
comma
id|SNDRV_SEQ_EVENT_SYNC_POS
comma
id|atomic
comma
id|hop
)paren
suffix:semicolon
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|q-&gt;master_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|master_only
)paren
r_return
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|q-&gt;slave_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;slave.format
op_amp
id|SNDRV_SEQ_SYNC_TIME
)paren
id|queue_sync_change_time
c_func
(paren
id|q
comma
op_amp
id|q-&gt;slave
)paren
suffix:semicolon
id|read_unlock
c_func
(paren
op_amp
id|q-&gt;slave_lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * check the current timer value and send sync messages if the sync&n; * time is elapsed&n; */
DECL|function|queue_master_check
r_static
r_void
id|queue_master_check
c_func
(paren
id|queue_t
op_star
id|q
comma
r_int
r_int
id|ticks
comma
r_int
id|atomic
comma
r_int
id|hop
)paren
(brace
r_struct
id|list_head
op_star
id|head
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|q-&gt;master_lock
)paren
suffix:semicolon
id|FOR_EACH_LIST
c_func
(paren
id|head
comma
op_amp
id|q-&gt;master_head
)paren
(brace
id|queue_sync_t
op_star
id|master
op_assign
id|list_entry
c_func
(paren
id|head
comma
id|queue_sync_t
comma
id|list
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|master-&gt;format
op_amp
id|SNDRV_SEQ_SYNC_MODE
)paren
(brace
r_case
id|SNDRV_SEQ_SYNC_TICK
suffix:colon
id|snd_seq_timer_update_tick
c_func
(paren
op_amp
id|master-&gt;sync_tick
comma
id|ticks
)paren
suffix:semicolon
r_while
c_loop
(paren
id|master-&gt;sync_tick.cur_tick
op_ge
id|master-&gt;counter
)paren
(brace
id|queue_send_sync_event
c_func
(paren
id|q
comma
id|master
comma
id|SNDRV_SEQ_EVENT_SYNC
comma
id|atomic
comma
id|hop
)paren
suffix:semicolon
id|master-&gt;counter
op_increment
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_SYNC_TIME
suffix:colon
r_while
c_loop
(paren
id|snd_seq_compare_real_time
c_func
(paren
op_amp
id|q-&gt;timer-&gt;cur_time
comma
op_amp
id|master-&gt;cur_time
)paren
)paren
(brace
id|queue_send_sync_event
c_func
(paren
id|q
comma
id|master
comma
id|SNDRV_SEQ_EVENT_SYNC
comma
id|atomic
comma
id|hop
)paren
suffix:semicolon
id|snd_seq_inc_time_nsec
c_func
(paren
op_amp
id|master-&gt;cur_time
comma
id|master-&gt;resolution
)paren
suffix:semicolon
id|master-&gt;counter
op_increment
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|q-&gt;master_lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * slave stuff&n; */
multiline_comment|/*&n; * update tick&n; */
DECL|function|queue_slave_check
r_static
r_void
id|queue_slave_check
c_func
(paren
id|queue_t
op_star
id|q
comma
r_int
r_int
id|ticks
)paren
(brace
r_switch
c_cond
(paren
id|q-&gt;slave.format
op_amp
id|SNDRV_SEQ_SYNC_MODE
)paren
(brace
r_case
id|SNDRV_SEQ_SYNC_TICK
suffix:colon
id|snd_seq_timer_update_tick
c_func
(paren
op_amp
id|q-&gt;slave.sync_tick
comma
id|ticks
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_SYNC_TIME
suffix:colon
multiline_comment|/* nothing */
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * slave synchronization in real-time unit&n; */
DECL|function|queue_slave_sync_time
r_static
r_int
id|queue_slave_sync_time
c_func
(paren
id|queue_t
op_star
id|q
comma
r_int
r_int
id|position
)paren
(brace
r_struct
id|timeval
id|tm
suffix:semicolon
r_int
id|diff_time
comma
id|new_period
suffix:semicolon
id|queue_sync_t
op_star
id|sync
op_assign
op_amp
id|q-&gt;slave
suffix:semicolon
id|sndrv_seq_queue_time_sync_t
op_star
id|p
op_assign
op_amp
id|sync-&gt;param.time
suffix:semicolon
id|seq_timer_t
op_star
id|tmr
op_assign
id|q-&gt;timer
suffix:semicolon
id|u64
id|external_counter
comma
id|tmp
suffix:semicolon
id|do_gettimeofday
c_func
(paren
op_amp
id|tm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmr-&gt;sync_start
)paren
(brace
multiline_comment|/* XXX: we should use 64bit for diff_time, too. */
id|diff_time
op_assign
(paren
id|tm.tv_sec
op_minus
id|tmr-&gt;sync_last_tm.tv_sec
)paren
op_star
l_int|1000000
op_plus
(paren
(paren
r_int
)paren
id|tm.tv_usec
op_minus
(paren
r_int
)paren
id|tmr-&gt;sync_last_tm.tv_usec
)paren
suffix:semicolon
id|diff_time
op_assign
(paren
id|p-&gt;x0
op_star
id|tmr-&gt;sync_time_diff
op_plus
id|p-&gt;x1
op_star
(paren
id|diff_time
op_star
l_int|1000
)paren
)paren
op_div
(paren
id|p-&gt;x0
op_plus
id|p-&gt;x1
)paren
suffix:semicolon
DECL|macro|MIN_DIFF_TIME
mdefine_line|#define MIN_DIFF_TIME&t;1000&t;/* 1ms minimum */
r_if
c_cond
(paren
id|diff_time
OL
id|MIN_DIFF_TIME
)paren
id|diff_time
op_assign
id|MIN_DIFF_TIME
suffix:semicolon
id|tmr-&gt;sync_time_diff
op_assign
id|diff_time
suffix:semicolon
id|tmp
op_assign
(paren
id|u64
)paren
id|tmr-&gt;base_period
op_star
(paren
id|u64
)paren
id|sync-&gt;resolution
suffix:semicolon
id|u64_div
c_func
(paren
id|tmp
comma
id|diff_time
comma
id|new_period
)paren
suffix:semicolon
multiline_comment|/* phase adjustment */
id|external_counter
op_assign
id|position
suffix:semicolon
id|external_counter
op_mul_assign
id|sync-&gt;resolution
suffix:semicolon
multiline_comment|/* calculate current time */
id|tmp
op_assign
id|snd_seq_timer_get_cur_nsec
c_func
(paren
id|tmr
comma
op_amp
id|tm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|external_counter
OG
id|tmp
)paren
(brace
id|tmp
op_assign
id|external_counter
op_minus
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|tmp
OL
id|p-&gt;max_time_diff
)paren
(brace
multiline_comment|/* locked */
r_int
id|hz
op_assign
id|p-&gt;phase_correct_time
op_div
id|tmr-&gt;base_period
suffix:semicolon
id|diff_time
op_assign
(paren
id|u32
)paren
id|tmp
suffix:semicolon
id|diff_time
op_div_assign
id|hz
suffix:semicolon
id|new_period
op_add_assign
id|diff_time
suffix:semicolon
id|q-&gt;flags
op_and_assign
op_complement
id|SNDRV_SEQ_QUEUE_FLG_SYNC_LOST
suffix:semicolon
)brace
)brace
r_else
(brace
id|tmp
op_assign
id|tmp
op_minus
id|external_counter
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_eq
l_int|0
)paren
id|q-&gt;flags
op_and_assign
op_complement
id|SNDRV_SEQ_QUEUE_FLG_SYNC_LOST
suffix:semicolon
r_else
r_if
c_cond
(paren
id|tmp
OL
id|p-&gt;max_time_diff
)paren
(brace
multiline_comment|/* locked */
r_int
id|hz
op_assign
id|p-&gt;phase_correct_time
op_div
id|tmr-&gt;base_period
suffix:semicolon
id|diff_time
op_assign
(paren
id|u32
)paren
id|tmp
suffix:semicolon
id|diff_time
op_div_assign
id|hz
suffix:semicolon
r_if
c_cond
(paren
id|new_period
op_minus
id|diff_time
OG
id|MIN_DIFF_TIME
)paren
(brace
id|new_period
op_sub_assign
id|diff_time
suffix:semicolon
id|q-&gt;flags
op_and_assign
op_complement
id|SNDRV_SEQ_QUEUE_FLG_SYNC_LOST
suffix:semicolon
)brace
r_else
id|q-&gt;flags
op_or_assign
id|SNDRV_SEQ_QUEUE_FLG_SYNC_LOST
suffix:semicolon
)brace
)brace
id|tmr-&gt;period
op_assign
id|new_period
suffix:semicolon
)brace
r_else
(brace
id|tmr-&gt;sync_start
op_assign
l_int|1
suffix:semicolon
id|tmr-&gt;sync_time_diff
op_assign
id|sync-&gt;resolution
suffix:semicolon
)brace
id|tmr-&gt;sync_last_tm
op_assign
id|tm
suffix:semicolon
id|sync-&gt;counter
op_assign
id|position
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * slave synchronization in tick unit&n; */
DECL|function|queue_slave_sync_tick
r_static
r_int
id|queue_slave_sync_tick
c_func
(paren
id|queue_t
op_star
id|q
comma
r_int
r_int
id|position
)paren
(brace
r_struct
id|timeval
id|tm
suffix:semicolon
r_int
id|diff_time
comma
id|tick_diff
suffix:semicolon
r_int
r_int
id|tick_time
suffix:semicolon
id|queue_sync_t
op_star
id|sync
op_assign
op_amp
id|q-&gt;slave
suffix:semicolon
id|seq_timer_t
op_star
id|tmr
op_assign
id|q-&gt;timer
suffix:semicolon
id|sndrv_seq_queue_tick_sync_t
op_star
id|p
op_assign
op_amp
id|sync-&gt;param.tick
suffix:semicolon
id|do_gettimeofday
c_func
(paren
op_amp
id|tm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmr-&gt;sync_start
)paren
(brace
multiline_comment|/* XXX: diff_time should be 64bit for enough long sync period.. */
id|diff_time
op_assign
(paren
id|tm.tv_sec
op_minus
id|tmr-&gt;sync_last_tm.tv_sec
)paren
op_star
l_int|1000000
op_plus
(paren
(paren
r_int
)paren
id|tm.tv_usec
op_minus
(paren
r_int
)paren
id|tmr-&gt;sync_last_tm.tv_usec
)paren
suffix:semicolon
id|diff_time
op_mul_assign
l_int|1000
suffix:semicolon
multiline_comment|/* in nsec */
id|tick_time
op_assign
(paren
id|p-&gt;x0
op_star
id|sync-&gt;sync_tick.resolution
op_plus
id|p-&gt;x1
op_star
id|diff_time
)paren
op_div
(paren
id|p-&gt;x0
op_plus
id|p-&gt;x1
)paren
suffix:semicolon
multiline_comment|/* phase adjustment */
id|tick_diff
op_assign
(paren
r_int
)paren
id|position
op_minus
(paren
r_int
)paren
id|sync-&gt;sync_tick.cur_tick
suffix:semicolon
r_if
c_cond
(paren
id|tick_diff
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|tick_diff
op_ge
op_minus
id|p-&gt;max_tick_diff
op_logical_and
id|tick_diff
op_le
id|p-&gt;max_tick_diff
)paren
(brace
multiline_comment|/* locked */
id|q-&gt;flags
op_and_assign
op_complement
id|SNDRV_SEQ_QUEUE_FLG_SYNC_LOST
suffix:semicolon
id|tick_time
op_assign
(paren
id|tick_time
op_star
id|p-&gt;max_tick_diff2
)paren
op_div
(paren
id|p-&gt;max_tick_diff2
op_plus
id|tick_diff
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* sync lost.. freewheeling */
id|q-&gt;flags
op_or_assign
id|SNDRV_SEQ_QUEUE_FLG_SYNC_LOST
suffix:semicolon
)brace
)brace
r_else
id|q-&gt;flags
op_and_assign
op_complement
id|SNDRV_SEQ_QUEUE_FLG_SYNC_LOST
suffix:semicolon
DECL|macro|MIN_TICK_TIME
mdefine_line|#define MIN_TICK_TIME&t;1000&t;/* 1ms */
r_if
c_cond
(paren
id|tick_time
OL
id|MIN_TICK_TIME
)paren
id|tick_time
op_assign
id|MIN_TICK_TIME
suffix:semicolon
id|sync-&gt;sync_tick.resolution
op_assign
id|tick_time
suffix:semicolon
id|snd_seq_timer_update_tick
c_func
(paren
op_amp
id|sync-&gt;sync_tick
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;ppq
)paren
id|tmr-&gt;tick.resolution
op_assign
(paren
id|tick_time
op_star
id|p-&gt;ppq
)paren
op_div
id|tmr-&gt;ppq
suffix:semicolon
r_else
id|tmr-&gt;tick.resolution
op_assign
id|tick_time
suffix:semicolon
id|snd_seq_timer_update_tick
c_func
(paren
op_amp
id|tmr-&gt;tick
comma
l_int|0
)paren
suffix:semicolon
id|tmr-&gt;tempo
op_assign
(paren
id|tmr-&gt;tick.resolution
op_star
id|tmr-&gt;ppq
)paren
op_div
l_int|1000
suffix:semicolon
)brace
r_else
id|tmr-&gt;sync_start
op_assign
l_int|1
suffix:semicolon
id|tmr-&gt;sync_last_tm
op_assign
id|tm
suffix:semicolon
id|sync-&gt;counter
op_assign
id|position
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; */
DECL|function|queue_slave_jump_to_time
r_static
r_void
id|queue_slave_jump_to_time
c_func
(paren
id|queue_t
op_star
id|q
comma
r_int
r_int
id|position
comma
r_int
id|atomic
comma
r_int
id|hop
)paren
(brace
id|u64
id|nsec
suffix:semicolon
id|queue_sync_t
op_star
id|sync
op_assign
op_amp
id|q-&gt;slave
suffix:semicolon
id|q-&gt;slave.counter
op_assign
id|position
suffix:semicolon
id|nsec
op_assign
id|sync-&gt;counter
suffix:semicolon
id|nsec
op_mul_assign
id|sync-&gt;resolution
suffix:semicolon
id|u64_divmod
c_func
(paren
id|nsec
comma
l_int|1000000000
comma
id|sync-&gt;cur_time.tv_sec
comma
id|sync-&gt;cur_time.tv_nsec
)paren
suffix:semicolon
id|q-&gt;timer-&gt;cur_time
op_assign
id|sync-&gt;cur_time
suffix:semicolon
multiline_comment|/* update master */
id|snd_seq_sync_update_time
c_func
(paren
id|q
comma
l_int|1
comma
id|atomic
comma
id|hop
)paren
suffix:semicolon
)brace
DECL|function|queue_slave_jump_to_tick
r_static
r_void
id|queue_slave_jump_to_tick
c_func
(paren
id|queue_t
op_star
id|q
comma
r_int
r_int
id|position
comma
r_int
id|atomic
comma
r_int
id|hop
)paren
(brace
r_int
r_int
id|tick
suffix:semicolon
id|queue_sync_t
op_star
id|sync
op_assign
op_amp
id|q-&gt;slave
suffix:semicolon
id|sync-&gt;counter
op_assign
id|position
suffix:semicolon
id|sync-&gt;sync_tick.cur_tick
op_assign
id|sync-&gt;counter
suffix:semicolon
id|sync-&gt;sync_tick.fraction
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* update queue timer */
r_if
c_cond
(paren
id|sync-&gt;param.tick.ppq
op_eq
l_int|0
)paren
id|tick
op_assign
id|sync-&gt;counter
suffix:semicolon
r_else
id|tick
op_assign
id|sync-&gt;counter
op_star
id|q-&gt;timer-&gt;ppq
op_div
id|sync-&gt;param.tick.ppq
suffix:semicolon
id|q-&gt;timer-&gt;tick.cur_tick
op_assign
id|tick
op_star
id|sync-&gt;param.tick.ticks
suffix:semicolon
id|q-&gt;timer-&gt;tick.fraction
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* update master */
id|snd_seq_sync_update_tick
c_func
(paren
id|q
comma
l_int|1
comma
id|atomic
comma
id|hop
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * event input callback&n; */
DECL|function|event_input_sync
r_static
r_int
id|event_input_sync
c_func
(paren
id|snd_seq_event_t
op_star
id|ev
comma
r_int
id|direct
comma
r_void
op_star
id|private_data
comma
r_int
id|atomic
comma
r_int
id|hop
)paren
(brace
id|queue_t
op_star
id|q
op_assign
id|private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|snd_seq_event_t
id|newev
suffix:semicolon
id|snd_assert
c_func
(paren
id|q
op_ne
l_int|NULL
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
multiline_comment|/* lock the queue owner access.. */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|q-&gt;owner_lock
comma
id|flags
)paren
suffix:semicolon
id|q-&gt;klocked
op_assign
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|q-&gt;owner_lock
comma
id|flags
)paren
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|q-&gt;slave_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;slave.format
)paren
(brace
r_if
c_cond
(paren
id|q-&gt;slave.parser
)paren
(brace
id|memset
c_func
(paren
op_amp
id|newev
comma
l_int|0
comma
r_sizeof
(paren
id|newev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;slave.parser-&gt;in
dot
id|sync
c_func
(paren
id|q-&gt;slave.parser_arg
comma
id|ev
comma
op_amp
id|newev
)paren
OG
l_int|0
)paren
id|ev
op_assign
op_amp
id|newev
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ev-&gt;type
op_eq
id|SNDRV_SEQ_EVENT_SYNC
)paren
(brace
multiline_comment|/* slave signal received */
r_switch
c_cond
(paren
id|q-&gt;slave.format
op_amp
id|SNDRV_SEQ_SYNC_MODE
)paren
(brace
r_case
id|SNDRV_SEQ_SYNC_TICK
suffix:colon
id|queue_slave_sync_tick
c_func
(paren
id|q
comma
id|ev-&gt;data.queue.param.position
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_SYNC_TIME
suffix:colon
id|queue_slave_sync_time
c_func
(paren
id|q
comma
id|ev-&gt;data.queue.param.position
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|ev-&gt;type
op_eq
id|SNDRV_SEQ_EVENT_SYNC_POS
)paren
(brace
multiline_comment|/* jump to position */
r_switch
c_cond
(paren
id|q-&gt;slave.format
op_amp
id|SNDRV_SEQ_SYNC_MODE
)paren
(brace
r_case
id|SNDRV_SEQ_SYNC_TICK
suffix:colon
r_if
c_cond
(paren
id|q-&gt;timer-&gt;running
)paren
id|queue_slave_sync_tick
c_func
(paren
id|q
comma
id|ev-&gt;data.queue.param.position
)paren
suffix:semicolon
r_else
id|queue_slave_jump_to_tick
c_func
(paren
id|q
comma
id|ev-&gt;data.queue.param.position
comma
id|atomic
comma
id|hop
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_SYNC_TIME
suffix:colon
r_if
c_cond
(paren
id|q-&gt;timer-&gt;running
)paren
id|queue_slave_sync_time
c_func
(paren
id|q
comma
id|ev-&gt;data.queue.param.position
)paren
suffix:semicolon
r_else
id|queue_slave_jump_to_time
c_func
(paren
id|q
comma
id|ev-&gt;data.queue.param.position
comma
id|atomic
comma
id|hop
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* control queue */
id|snd_seq_queue_process_event
c_func
(paren
id|q
comma
id|ev
comma
l_int|0
comma
id|atomic
comma
id|hop
)paren
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|q-&gt;slave_lock
)paren
suffix:semicolon
multiline_comment|/* unlock */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|q-&gt;owner_lock
comma
id|flags
)paren
suffix:semicolon
id|q-&gt;klocked
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|q-&gt;owner_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * initialize sync parameters&n; */
DECL|function|queue_param_init
r_static
r_int
id|queue_param_init
c_func
(paren
id|queue_t
op_star
id|q
comma
id|queue_sync_t
op_star
id|sync
comma
id|snd_seq_addr_t
op_star
id|addr
comma
id|sndrv_seq_queue_sync_t
op_star
id|info
comma
r_int
id|slave
)paren
(brace
id|seq_sync_parser_t
op_star
id|parser
comma
op_star
op_star
id|list
suffix:semicolon
id|sync-&gt;format
op_assign
id|info-&gt;format
suffix:semicolon
id|sync-&gt;time_format
op_assign
id|info-&gt;time_format
suffix:semicolon
op_star
id|sync-&gt;opt_info
op_assign
op_star
id|info-&gt;info
suffix:semicolon
id|sync-&gt;addr
op_assign
op_star
id|addr
suffix:semicolon
multiline_comment|/* copy params */
r_if
c_cond
(paren
id|info-&gt;format
op_amp
id|SNDRV_SEQ_SYNC_TICK
)paren
id|sync-&gt;param.tick
op_assign
id|info-&gt;param.tick
suffix:semicolon
r_else
id|sync-&gt;param.time
op_assign
id|info-&gt;param.time
suffix:semicolon
id|sync-&gt;parser
op_assign
l_int|NULL
suffix:semicolon
id|sync-&gt;parser_arg
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|list
op_assign
id|event_parsers
suffix:semicolon
(paren
id|parser
op_assign
op_star
id|list
)paren
op_ne
l_int|NULL
suffix:semicolon
id|list
op_increment
)paren
(brace
r_if
c_cond
(paren
id|parser-&gt;format
op_eq
id|sync-&gt;format
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|slave
)paren
id|err
op_assign
id|parser-&gt;in
dot
id|open
c_func
(paren
id|sync
comma
op_amp
id|sync-&gt;parser_arg
)paren
suffix:semicolon
r_else
id|err
op_assign
id|parser-&gt;out
dot
id|open
c_func
(paren
id|sync
comma
op_amp
id|sync-&gt;parser_arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|sync-&gt;parser
op_assign
id|parser
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_switch
c_cond
(paren
id|sync-&gt;format
op_amp
id|SNDRV_SEQ_SYNC_MODE
)paren
(brace
r_case
id|SNDRV_SEQ_SYNC_TICK
suffix:colon
r_if
c_cond
(paren
id|sync-&gt;param.tick.ppq
OG
l_int|200
)paren
r_goto
id|__error
suffix:semicolon
r_if
c_cond
(paren
id|sync-&gt;param.tick.ticks
op_eq
l_int|0
)paren
id|sync-&gt;param.tick.ticks
op_assign
l_int|1
suffix:semicolon
id|queue_sync_set_tick_resolution
c_func
(paren
id|q
comma
id|sync
)paren
suffix:semicolon
multiline_comment|/* sync slave parameters -- will be configurable */
id|sync-&gt;param.tick.x0
op_assign
l_int|4
suffix:semicolon
id|sync-&gt;param.tick.x1
op_assign
l_int|1
suffix:semicolon
id|sync-&gt;param.tick.max_tick_diff
op_assign
l_int|50
suffix:semicolon
id|sync-&gt;param.tick.max_tick_diff2
op_assign
id|sync-&gt;param.tick.max_tick_diff
op_star
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_SYNC_TIME
suffix:colon
id|sync-&gt;resolution
op_assign
id|sync-&gt;param.time.resolution
suffix:semicolon
r_if
c_cond
(paren
id|sync-&gt;param.time.subframes
op_eq
l_int|0
)paren
r_goto
id|__error
suffix:semicolon
id|sync-&gt;resolution
op_div_assign
id|sync-&gt;param.time.subframes
suffix:semicolon
r_if
c_cond
(paren
id|sync-&gt;resolution
OL
l_int|1000000
)paren
multiline_comment|/* minimum = 1ms */
r_goto
id|__error
suffix:semicolon
multiline_comment|/* sync slave parameters -- will be configurable */
id|sync-&gt;param.time.x0
op_assign
l_int|2
suffix:semicolon
id|sync-&gt;param.time.x1
op_assign
l_int|1
suffix:semicolon
id|sync-&gt;param.time.max_time_diff
op_assign
l_int|1000000000UL
suffix:semicolon
multiline_comment|/* 1s */
id|sync-&gt;param.time.phase_correct_time
op_assign
l_int|100000000UL
suffix:semicolon
multiline_comment|/* 0.1s */
r_break
suffix:semicolon
r_default
suffix:colon
id|snd_printd
c_func
(paren
l_string|&quot;seq_sync: invalid format %x&bslash;n&quot;
comma
id|sync-&gt;format
)paren
suffix:semicolon
r_goto
id|__error
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|__error
suffix:colon
id|queue_sync_close_parser
c_func
(paren
id|sync
comma
id|slave
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n; * close event parser if exists&n; */
DECL|function|queue_sync_close_parser
r_static
r_void
id|queue_sync_close_parser
c_func
(paren
id|queue_sync_t
op_star
id|sync
comma
r_int
id|slave
)paren
(brace
r_if
c_cond
(paren
id|sync-&gt;parser
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|slave
)paren
(brace
r_if
c_cond
(paren
id|sync-&gt;parser-&gt;in.close
)paren
id|sync-&gt;parser-&gt;in
dot
id|close
c_func
(paren
id|sync-&gt;parser_arg
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sync-&gt;parser_arg
)paren
id|kfree
c_func
(paren
id|sync-&gt;parser_arg
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|sync-&gt;parser-&gt;out.close
)paren
id|sync-&gt;parser-&gt;out
dot
id|close
c_func
(paren
id|sync-&gt;parser_arg
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|sync-&gt;parser_arg
)paren
id|kfree
c_func
(paren
id|sync-&gt;parser_arg
)paren
suffix:semicolon
)brace
id|sync-&gt;parser
op_assign
l_int|NULL
suffix:semicolon
id|sync-&gt;parser_arg
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * add to master list&n; */
DECL|function|queue_master_add
r_static
r_int
id|queue_master_add
c_func
(paren
r_void
op_star
id|private_data
comma
id|snd_seq_port_subscribe_t
op_star
id|subs
)paren
(brace
id|queue_t
op_star
id|q
op_assign
id|private_data
suffix:semicolon
id|queue_sync_t
op_star
id|master
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|err
suffix:semicolon
id|snd_assert
c_func
(paren
id|q
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|subs-&gt;sync
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|master
op_assign
id|snd_kcalloc
c_func
(paren
r_sizeof
(paren
op_star
id|master
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|master
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|err
op_assign
id|queue_param_init
c_func
(paren
id|q
comma
id|master
comma
op_amp
id|subs-&gt;dest
comma
op_amp
id|subs-&gt;opt.sync_info
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|master
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|write_lock_irqsave
c_func
(paren
op_amp
id|q-&gt;master_lock
comma
id|flags
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|master-&gt;list
comma
op_amp
id|q-&gt;master_head
)paren
suffix:semicolon
id|write_unlock_irqrestore
c_func
(paren
op_amp
id|q-&gt;master_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * remove master&n; */
DECL|function|queue_master_remove
r_static
r_int
id|queue_master_remove
c_func
(paren
r_void
op_star
id|private_data
comma
id|snd_seq_port_subscribe_t
op_star
id|subs
)paren
(brace
id|queue_t
op_star
id|q
op_assign
id|private_data
suffix:semicolon
id|sndrv_seq_queue_sync_t
op_star
id|info
suffix:semicolon
id|snd_seq_addr_t
op_star
id|addr
suffix:semicolon
r_struct
id|list_head
op_star
id|head
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|snd_assert
c_func
(paren
id|q
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|subs-&gt;sync
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|info
op_assign
op_amp
id|subs-&gt;opt.sync_info
suffix:semicolon
id|addr
op_assign
op_amp
id|subs-&gt;dest
suffix:semicolon
id|write_lock_irqsave
c_func
(paren
op_amp
id|q-&gt;master_lock
comma
id|flags
)paren
suffix:semicolon
id|FOR_EACH_LIST
c_func
(paren
id|head
comma
op_amp
id|q-&gt;master_head
)paren
(brace
id|queue_sync_t
op_star
id|master
op_assign
id|list_entry
c_func
(paren
id|head
comma
id|queue_sync_t
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|master-&gt;format
op_eq
id|info-&gt;format
op_logical_and
id|master-&gt;addr.client
op_eq
id|addr-&gt;client
op_logical_and
id|master-&gt;addr.port
op_eq
id|addr-&gt;port
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|master-&gt;list
)paren
suffix:semicolon
id|write_unlock_irqrestore
c_func
(paren
op_amp
id|q-&gt;master_lock
comma
id|flags
)paren
suffix:semicolon
id|queue_sync_close_parser
c_func
(paren
id|master
comma
l_int|0
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|master
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|write_unlock_irqrestore
c_func
(paren
op_amp
id|q-&gt;master_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_printd
c_func
(paren
l_string|&quot;seq_queue: can&squot;t find master from %d.%d format %0x&bslash;n&quot;
comma
id|addr-&gt;client
comma
id|addr-&gt;port
comma
id|info-&gt;format
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
multiline_comment|/* remove all master connections if any exist */
DECL|function|queue_delete_all_masters
r_static
r_void
id|queue_delete_all_masters
c_func
(paren
id|queue_t
op_star
id|q
)paren
(brace
r_struct
id|list_head
op_star
id|head
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|write_lock_irqsave
c_func
(paren
op_amp
id|q-&gt;master_lock
comma
id|flags
)paren
suffix:semicolon
id|FOR_EACH_LIST
c_func
(paren
id|head
comma
op_amp
id|q-&gt;master_head
)paren
(brace
id|queue_sync_t
op_star
id|master
op_assign
id|list_entry
c_func
(paren
id|head
comma
id|queue_sync_t
comma
id|list
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|master-&gt;list
)paren
suffix:semicolon
id|queue_sync_close_parser
c_func
(paren
id|master
comma
l_int|0
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|master
)paren
suffix:semicolon
)brace
id|write_unlock_irqrestore
c_func
(paren
op_amp
id|q-&gt;master_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * set slave mode&n; */
DECL|function|queue_slave_set
r_static
r_int
id|queue_slave_set
c_func
(paren
r_void
op_star
id|private_data
comma
id|snd_seq_port_subscribe_t
op_star
id|subs
)paren
(brace
id|queue_t
op_star
id|q
op_assign
id|private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|err
suffix:semicolon
id|snd_assert
c_func
(paren
id|q
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|subs-&gt;sync
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|write_lock_irqsave
c_func
(paren
op_amp
id|q-&gt;slave_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;slave.format
)paren
(brace
id|write_unlock_irqrestore
c_func
(paren
op_amp
id|q-&gt;slave_lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|err
op_assign
id|queue_param_init
c_func
(paren
id|q
comma
op_amp
id|q-&gt;slave
comma
op_amp
id|subs-&gt;sender
comma
op_amp
id|subs-&gt;opt.sync_info
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|q-&gt;slave.format
op_assign
l_int|0
suffix:semicolon
id|write_unlock_irqrestore
c_func
(paren
op_amp
id|q-&gt;slave_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|write_unlock_irqrestore
c_func
(paren
op_amp
id|q-&gt;slave_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * remove slave mode&n; */
DECL|function|queue_slave_reset
r_static
r_int
id|queue_slave_reset
c_func
(paren
r_void
op_star
id|private_data
comma
id|snd_seq_port_subscribe_t
op_star
id|subs
)paren
(brace
id|queue_t
op_star
id|q
op_assign
id|private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|snd_assert
c_func
(paren
id|q
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|subs-&gt;sync
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|write_lock_irqsave
c_func
(paren
op_amp
id|q-&gt;slave_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;slave.addr.client
op_eq
id|subs-&gt;sender.client
op_logical_and
id|q-&gt;slave.addr.port
op_eq
id|subs-&gt;sender.port
)paren
(brace
id|q-&gt;slave.format
op_assign
l_int|0
suffix:semicolon
id|queue_sync_close_parser
c_func
(paren
op_amp
id|q-&gt;slave
comma
l_int|1
)paren
suffix:semicolon
id|write_unlock_irqrestore
c_func
(paren
op_amp
id|q-&gt;slave_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|write_unlock_irqrestore
c_func
(paren
op_amp
id|q-&gt;slave_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_printd
c_func
(paren
l_string|&quot;seq_queue: can&squot;t match slave condition&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
multiline_comment|/*&n; * sync check&n; * this function is called at each timer interrupt.&n; */
DECL|function|snd_seq_sync_check
r_void
id|snd_seq_sync_check
c_func
(paren
id|queue_t
op_star
id|q
comma
r_int
r_int
id|resolution
comma
r_int
id|atomic
comma
r_int
id|hop
)paren
(brace
id|queue_master_check
c_func
(paren
id|q
comma
id|resolution
comma
id|atomic
comma
id|hop
)paren
suffix:semicolon
id|queue_slave_check
c_func
(paren
id|q
comma
id|resolution
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * support functions for SMPTE time frame&n; */
DECL|function|linear_time_to_position
r_static
r_int
r_int
id|linear_time_to_position
c_func
(paren
id|sndrv_seq_time_frame_t
id|time
comma
r_int
id|nframes
comma
r_int
id|nsubs
)paren
(brace
r_int
r_int
id|count
suffix:semicolon
id|count
op_assign
id|time.hour
op_star
l_int|60
op_plus
id|time.min
suffix:semicolon
id|count
op_assign
id|count
op_star
l_int|60
op_plus
id|time.sec
suffix:semicolon
id|count
op_assign
id|count
op_star
id|nframes
op_plus
id|time.frame
suffix:semicolon
id|count
op_assign
id|count
op_star
id|nsubs
op_plus
id|time.subframe
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|linear_position_to_time
r_static
id|sndrv_seq_time_frame_t
id|linear_position_to_time
c_func
(paren
r_int
r_int
id|count
comma
r_int
id|nframes
comma
r_int
id|nsubs
)paren
(brace
id|sndrv_seq_time_frame_t
id|time
suffix:semicolon
id|time.subframe
op_assign
id|count
op_mod
id|nsubs
suffix:semicolon
id|count
op_div_assign
id|nsubs
suffix:semicolon
id|time.hour
op_assign
id|count
op_div
(paren
l_int|3600
op_star
id|nframes
)paren
suffix:semicolon
id|count
op_mod_assign
l_int|3600
op_star
id|nframes
suffix:semicolon
id|time.min
op_assign
id|count
op_div
(paren
l_int|60
op_star
id|nframes
)paren
suffix:semicolon
id|count
op_mod_assign
l_int|60
op_star
id|nframes
suffix:semicolon
id|time.sec
op_assign
id|count
op_div
id|nframes
suffix:semicolon
id|time.frame
op_assign
id|count
op_mod
id|nframes
suffix:semicolon
r_return
id|time
suffix:semicolon
)brace
multiline_comment|/* drop frame - only 30fps */
DECL|macro|NFRAMES
mdefine_line|#define NFRAMES&t;&t;30
DECL|macro|FRAMES_PER_MIN
mdefine_line|#define FRAMES_PER_MIN&t;&t;(NFRAMES * 60 - 2)
DECL|macro|FRAMES_PER_10MIN
mdefine_line|#define FRAMES_PER_10MIN&t;(FRAMES_PER_MIN * 10 + 2)
DECL|macro|FRAMES_PER_HOUR
mdefine_line|#define FRAMES_PER_HOUR&t;&t;(FRAMES_PER_10MIN * 6)
DECL|function|drop_time_to_position
r_static
r_int
r_int
id|drop_time_to_position
c_func
(paren
id|sndrv_seq_time_frame_t
id|time
comma
r_int
id|nsubs
)paren
(brace
r_int
r_int
id|count
comma
id|min
suffix:semicolon
id|min
op_assign
id|time.min
op_mod
l_int|10
suffix:semicolon
id|count
op_assign
id|time.frame
suffix:semicolon
r_if
c_cond
(paren
id|min
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|time.sec
op_eq
l_int|0
op_logical_and
id|time.frame
OL
l_int|2
)paren
id|count
op_assign
l_int|2
suffix:semicolon
)brace
id|count
op_add_assign
id|time.sec
op_star
id|NFRAMES
suffix:semicolon
id|count
op_add_assign
id|min
op_star
id|FRAMES_PER_MIN
suffix:semicolon
id|count
op_add_assign
(paren
id|time.min
op_div
l_int|10
)paren
op_star
id|FRAMES_PER_10MIN
suffix:semicolon
id|count
op_add_assign
id|time.hour
op_star
(paren
id|FRAMES_PER_HOUR
)paren
suffix:semicolon
id|count
op_mul_assign
id|nsubs
suffix:semicolon
id|count
op_add_assign
id|time.subframe
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|drop_position_to_time
r_static
id|sndrv_seq_time_frame_t
id|drop_position_to_time
c_func
(paren
r_int
id|count
comma
r_int
id|nsubs
)paren
(brace
r_int
r_int
id|min10
suffix:semicolon
id|sndrv_seq_time_frame_t
id|time
suffix:semicolon
id|time.subframe
op_assign
id|count
op_mod
id|nsubs
suffix:semicolon
id|count
op_div_assign
id|nsubs
suffix:semicolon
id|min10
op_assign
id|count
op_div
id|FRAMES_PER_10MIN
suffix:semicolon
id|time.hour
op_assign
id|min10
op_div
l_int|6
suffix:semicolon
id|min10
op_mod_assign
l_int|6
suffix:semicolon
id|count
op_mod_assign
id|FRAMES_PER_10MIN
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|2
)paren
(brace
id|time.min
op_assign
id|min10
op_star
l_int|10
suffix:semicolon
id|time.sec
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|count
op_sub_assign
l_int|2
suffix:semicolon
id|time.min
op_assign
id|count
op_div
id|FRAMES_PER_MIN
suffix:semicolon
id|time.min
op_add_assign
id|min10
op_star
l_int|10
suffix:semicolon
id|count
op_mod_assign
id|FRAMES_PER_MIN
suffix:semicolon
id|count
op_add_assign
l_int|2
suffix:semicolon
id|time.sec
op_assign
id|count
op_div
id|NFRAMES
suffix:semicolon
id|count
op_mod_assign
id|NFRAMES
suffix:semicolon
)brace
id|time.frame
op_assign
id|count
suffix:semicolon
r_return
id|time
suffix:semicolon
)brace
multiline_comment|/* convert from position counter to time frame */
DECL|function|snd_seq_position_to_time_frame
id|sndrv_seq_time_frame_t
id|snd_seq_position_to_time_frame
c_func
(paren
r_int
id|format
comma
r_int
r_int
id|nsubs
comma
r_int
r_int
id|pos
)paren
(brace
r_switch
c_cond
(paren
id|format
)paren
(brace
r_case
id|SNDRV_SEQ_SYNC_FPS_24
suffix:colon
r_return
id|linear_position_to_time
c_func
(paren
id|pos
comma
l_int|24
comma
id|nsubs
)paren
suffix:semicolon
r_case
id|SNDRV_SEQ_SYNC_FPS_25
suffix:colon
r_return
id|linear_position_to_time
c_func
(paren
id|pos
comma
l_int|25
comma
id|nsubs
)paren
suffix:semicolon
r_case
id|SNDRV_SEQ_SYNC_FPS_30_NDP
suffix:colon
r_return
id|linear_position_to_time
c_func
(paren
id|pos
comma
l_int|30
comma
id|nsubs
)paren
suffix:semicolon
r_case
id|SNDRV_SEQ_SYNC_FPS_30_DP
suffix:colon
r_default
suffix:colon
r_return
id|drop_position_to_time
c_func
(paren
id|pos
comma
id|nsubs
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* convert from position counter to time frame */
DECL|function|snd_seq_time_frame_to_position
r_int
r_int
id|snd_seq_time_frame_to_position
c_func
(paren
r_int
id|format
comma
r_int
r_int
id|nsubs
comma
id|sndrv_seq_time_frame_t
op_star
id|rtime
)paren
(brace
r_switch
c_cond
(paren
id|format
)paren
(brace
r_case
id|SNDRV_SEQ_SYNC_FPS_24
suffix:colon
r_return
id|linear_time_to_position
c_func
(paren
op_star
id|rtime
comma
l_int|24
comma
id|nsubs
)paren
suffix:semicolon
r_case
id|SNDRV_SEQ_SYNC_FPS_25
suffix:colon
r_return
id|linear_time_to_position
c_func
(paren
op_star
id|rtime
comma
l_int|25
comma
id|nsubs
)paren
suffix:semicolon
r_case
id|SNDRV_SEQ_SYNC_FPS_30_NDP
suffix:colon
r_return
id|linear_time_to_position
c_func
(paren
op_star
id|rtime
comma
l_int|30
comma
id|nsubs
)paren
suffix:semicolon
r_case
id|SNDRV_SEQ_SYNC_FPS_30_DP
suffix:colon
r_default
suffix:colon
r_return
id|drop_time_to_position
c_func
(paren
op_star
id|rtime
comma
id|nsubs
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* resolution in nsec */
DECL|function|snd_seq_get_smpte_resolution
r_int
r_int
id|snd_seq_get_smpte_resolution
c_func
(paren
r_int
id|time_format
)paren
(brace
r_switch
c_cond
(paren
id|time_format
)paren
(brace
r_case
id|SNDRV_SEQ_SYNC_FPS_24
suffix:colon
r_return
l_int|1000000000UL
op_div
l_int|24
suffix:semicolon
r_case
id|SNDRV_SEQ_SYNC_FPS_25
suffix:colon
r_return
l_int|1000000000UL
op_div
l_int|25
suffix:semicolon
r_case
id|SNDRV_SEQ_SYNC_FPS_30_DP
suffix:colon
r_case
id|SNDRV_SEQ_SYNC_FPS_30_NDP
suffix:colon
r_return
(paren
r_int
r_int
)paren
(paren
l_float|1000000000.0
op_div
l_float|29.97
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * proc interface&n; */
DECL|function|print_sync_info
r_static
r_void
id|print_sync_info
c_func
(paren
id|snd_info_buffer_t
op_star
id|buffer
comma
id|queue_sync_t
op_star
id|sync
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot; [%s] ==&gt; %d:%d&bslash;n&quot;
comma
(paren
id|sync-&gt;format
op_amp
id|SNDRV_SEQ_SYNC_TICK
ques
c_cond
l_string|&quot;tick&quot;
suffix:colon
l_string|&quot;time&quot;
)paren
comma
id|sync-&gt;addr.client
comma
id|sync-&gt;addr.port
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;    format 0x%0x / time_format %d&bslash;n&quot;
comma
id|sync-&gt;format
comma
id|sync-&gt;time_format
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|sync-&gt;format
op_amp
id|SNDRV_SEQ_SYNC_MODE
)paren
(brace
r_case
id|SNDRV_SEQ_SYNC_TICK
suffix:colon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;   ppq: %d, ticks: %d&bslash;n&quot;
comma
id|sync-&gt;param.tick.ppq
comma
id|sync-&gt;param.tick.ticks
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;   resolution: %ld ns, position: %d&bslash;n&quot;
comma
id|sync-&gt;sync_tick.resolution
comma
id|sync-&gt;counter
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_SYNC_TIME
suffix:colon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;   subframes %d, resolution: %ld ns, position: %d&bslash;n&quot;
comma
id|sync-&gt;param.time.subframes
comma
id|sync-&gt;resolution
comma
id|sync-&gt;counter
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|snd_seq_sync_info_read
r_void
id|snd_seq_sync_info_read
c_func
(paren
id|queue_t
op_star
id|q
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
r_struct
id|list_head
op_star
id|head
suffix:semicolon
r_int
id|count
op_assign
l_int|0
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|q-&gt;master_lock
)paren
suffix:semicolon
id|FOR_EACH_LIST
c_func
(paren
id|head
comma
op_amp
id|q-&gt;master_head
)paren
(brace
id|queue_sync_t
op_star
id|master
op_assign
id|list_entry
c_func
(paren
id|head
comma
id|queue_sync_t
comma
id|list
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;master %d&quot;
comma
id|count
)paren
suffix:semicolon
id|print_sync_info
c_func
(paren
id|buffer
comma
id|master
)paren
suffix:semicolon
id|count
op_increment
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|q-&gt;master_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;slave.format
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;slave&quot;
)paren
suffix:semicolon
id|print_sync_info
c_func
(paren
id|buffer
comma
op_amp
id|q-&gt;slave
)paren
suffix:semicolon
id|count
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count
)paren
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif /* SNDRV_SEQ_SYNC_SUPPORT */
eof
