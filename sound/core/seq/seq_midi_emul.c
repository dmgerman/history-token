multiline_comment|/*&n; *  GM/GS/XG midi module.&n; *&n; *  Copyright (C) 1999 Steve Ratcliffe&n; *&n; *  Based on awe_wave.c by Takashi Iwai&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
multiline_comment|/*&n; * This module is used to keep track of the current midi state.&n; * It can be used for drivers that are required to emulate midi when&n; * the hardware doesn&squot;t.&n; *&n; * It was written for a AWE64 driver, but there should be no AWE specific&n; * code in here.  If there is it should be reported as a bug.&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/seq_kernel.h&gt;
macro_line|#include &lt;sound/seq_midi_emul.h&gt;
macro_line|#include &lt;sound/initval.h&gt;
macro_line|#include &lt;sound/asoundef.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Takashi Iwai / Steve Ratcliffe&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Advanced Linux Sound Architecture sequencer MIDI emulation.&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_CLASSES
c_func
(paren
l_string|&quot;{sound}&quot;
)paren
suffix:semicolon
id|MODULE_SUPPORTED_DEVICE
c_func
(paren
l_string|&quot;sound&quot;
)paren
suffix:semicolon
multiline_comment|/* Prototypes for static functions */
r_static
r_void
id|note_off
c_func
(paren
id|snd_midi_op_t
op_star
id|ops
comma
r_void
op_star
id|drv
comma
id|snd_midi_channel_t
op_star
id|chan
comma
r_int
id|note
comma
r_int
id|vel
)paren
suffix:semicolon
r_static
r_void
id|do_control
c_func
(paren
id|snd_midi_op_t
op_star
id|ops
comma
r_void
op_star
r_private
comma
id|snd_midi_channel_set_t
op_star
id|chset
comma
id|snd_midi_channel_t
op_star
id|chan
comma
r_int
id|control
comma
r_int
id|value
)paren
suffix:semicolon
r_static
r_void
id|rpn
c_func
(paren
id|snd_midi_op_t
op_star
id|ops
comma
r_void
op_star
id|drv
comma
id|snd_midi_channel_t
op_star
id|chan
comma
id|snd_midi_channel_set_t
op_star
id|chset
)paren
suffix:semicolon
r_static
r_void
id|nrpn
c_func
(paren
id|snd_midi_op_t
op_star
id|ops
comma
r_void
op_star
id|drv
comma
id|snd_midi_channel_t
op_star
id|chan
comma
id|snd_midi_channel_set_t
op_star
id|chset
)paren
suffix:semicolon
r_static
r_void
id|sysex
c_func
(paren
id|snd_midi_op_t
op_star
id|ops
comma
r_void
op_star
r_private
comma
r_int
r_char
op_star
id|sysex
comma
r_int
id|len
comma
id|snd_midi_channel_set_t
op_star
id|chset
)paren
suffix:semicolon
r_static
r_void
id|all_sounds_off
c_func
(paren
id|snd_midi_op_t
op_star
id|ops
comma
r_void
op_star
r_private
comma
id|snd_midi_channel_t
op_star
id|chan
)paren
suffix:semicolon
r_static
r_void
id|all_notes_off
c_func
(paren
id|snd_midi_op_t
op_star
id|ops
comma
r_void
op_star
r_private
comma
id|snd_midi_channel_t
op_star
id|chan
)paren
suffix:semicolon
r_void
id|snd_midi_reset_controllers
c_func
(paren
id|snd_midi_channel_t
op_star
id|chan
)paren
suffix:semicolon
r_static
r_void
id|reset_all_channels
c_func
(paren
id|snd_midi_channel_set_t
op_star
id|chset
)paren
suffix:semicolon
multiline_comment|/*&n; * Process an event in a driver independent way.  This means dealing&n; * with RPN, NRPN, SysEx etc that are defined for common midi applications&n; * such as GM, GS and XG.&n; * There modes that this module will run in are:&n; *   Generic MIDI - no interpretation at all, it will just save current values&n; *                  of controlers etc.&n; *   GM - You can use all gm_ prefixed elements of chan.  Controls, RPN, NRPN,&n; *        SysEx will be interpreded as defined in General Midi.&n; *   GS - You can use all gs_ prefixed elements of chan. Codes for GS will be&n; *        interpreted.&n; *   XG - You can use all xg_ prefixed elements of chan.  Codes for XG will&n; *        be interpreted.&n; */
r_void
DECL|function|snd_midi_process_event
id|snd_midi_process_event
c_func
(paren
id|snd_midi_op_t
op_star
id|ops
comma
id|snd_seq_event_t
op_star
id|ev
comma
id|snd_midi_channel_set_t
op_star
id|chanset
)paren
(brace
id|snd_midi_channel_t
op_star
id|chan
suffix:semicolon
r_void
op_star
id|drv
suffix:semicolon
r_int
id|dest_channel
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ev
op_eq
l_int|NULL
op_logical_or
id|chanset
op_eq
l_int|NULL
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;ev or chanbase NULL (snd_midi_process_event)&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chanset-&gt;channels
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|snd_seq_ev_is_channel_type
c_func
(paren
id|ev
)paren
)paren
(brace
id|dest_channel
op_assign
id|ev-&gt;data.note.channel
suffix:semicolon
r_if
c_cond
(paren
id|dest_channel
op_ge
id|chanset-&gt;max_channels
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;dest channel is %d, max is %d&bslash;n&quot;
comma
id|dest_channel
comma
id|chanset-&gt;max_channels
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|chan
op_assign
id|chanset-&gt;channels
op_plus
id|dest_channel
suffix:semicolon
id|drv
op_assign
id|chanset-&gt;private_data
suffix:semicolon
multiline_comment|/* EVENT_NOTE should be processed before queued */
r_if
c_cond
(paren
id|ev-&gt;type
op_eq
id|SNDRV_SEQ_EVENT_NOTE
)paren
r_return
suffix:semicolon
multiline_comment|/* Make sure that we don&squot;t have a note on that should really be&n;&t; * a note off */
r_if
c_cond
(paren
id|ev-&gt;type
op_eq
id|SNDRV_SEQ_EVENT_NOTEON
op_logical_and
id|ev-&gt;data.note.velocity
op_eq
l_int|0
)paren
id|ev-&gt;type
op_assign
id|SNDRV_SEQ_EVENT_NOTEOFF
suffix:semicolon
multiline_comment|/* Make sure the note is within array range */
r_if
c_cond
(paren
id|ev-&gt;type
op_eq
id|SNDRV_SEQ_EVENT_NOTEON
op_logical_or
id|ev-&gt;type
op_eq
id|SNDRV_SEQ_EVENT_NOTEOFF
op_logical_or
id|ev-&gt;type
op_eq
id|SNDRV_SEQ_EVENT_KEYPRESS
)paren
(brace
r_if
c_cond
(paren
id|ev-&gt;data.note.note
op_ge
l_int|128
)paren
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ev-&gt;type
)paren
(brace
r_case
id|SNDRV_SEQ_EVENT_NOTEON
suffix:colon
r_if
c_cond
(paren
id|chan-&gt;note
(braket
id|ev-&gt;data.note.note
)braket
op_amp
id|SNDRV_MIDI_NOTE_ON
)paren
(brace
r_if
c_cond
(paren
id|ops-&gt;note_off
)paren
id|ops
op_member_access_from_pointer
id|note_off
c_func
(paren
id|drv
comma
id|ev-&gt;data.note.note
comma
l_int|0
comma
id|chan
)paren
suffix:semicolon
)brace
id|chan-&gt;note
(braket
id|ev-&gt;data.note.note
)braket
op_assign
id|SNDRV_MIDI_NOTE_ON
suffix:semicolon
r_if
c_cond
(paren
id|ops-&gt;note_on
)paren
id|ops
op_member_access_from_pointer
id|note_on
c_func
(paren
id|drv
comma
id|ev-&gt;data.note.note
comma
id|ev-&gt;data.note.velocity
comma
id|chan
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_NOTEOFF
suffix:colon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chan-&gt;note
(braket
id|ev-&gt;data.note.note
)braket
op_amp
id|SNDRV_MIDI_NOTE_ON
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|ops-&gt;note_off
)paren
id|note_off
c_func
(paren
id|ops
comma
id|drv
comma
id|chan
comma
id|ev-&gt;data.note.note
comma
id|ev-&gt;data.note.velocity
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_KEYPRESS
suffix:colon
r_if
c_cond
(paren
id|ops-&gt;key_press
)paren
id|ops
op_member_access_from_pointer
id|key_press
c_func
(paren
id|drv
comma
id|ev-&gt;data.note.note
comma
id|ev-&gt;data.note.velocity
comma
id|chan
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_CONTROLLER
suffix:colon
id|do_control
c_func
(paren
id|ops
comma
id|drv
comma
id|chanset
comma
id|chan
comma
id|ev-&gt;data.control.param
comma
id|ev-&gt;data.control.value
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_PGMCHANGE
suffix:colon
id|chan-&gt;midi_program
op_assign
id|ev-&gt;data.control.value
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_PITCHBEND
suffix:colon
id|chan-&gt;midi_pitchbend
op_assign
id|ev-&gt;data.control.value
suffix:semicolon
r_if
c_cond
(paren
id|ops-&gt;control
)paren
id|ops
op_member_access_from_pointer
id|control
c_func
(paren
id|drv
comma
id|MIDI_CTL_PITCHBEND
comma
id|chan
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_CHANPRESS
suffix:colon
id|chan-&gt;midi_pressure
op_assign
id|ev-&gt;data.control.value
suffix:semicolon
r_if
c_cond
(paren
id|ops-&gt;control
)paren
id|ops
op_member_access_from_pointer
id|control
c_func
(paren
id|drv
comma
id|MIDI_CTL_CHAN_PRESSURE
comma
id|chan
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_CONTROL14
suffix:colon
multiline_comment|/* Best guess is that this is any of the 14 bit controller values */
r_if
c_cond
(paren
id|ev-&gt;data.control.param
OL
l_int|32
)paren
(brace
multiline_comment|/* set low part first */
id|chan-&gt;control
(braket
id|ev-&gt;data.control.param
op_plus
l_int|32
)braket
op_assign
id|ev-&gt;data.control.value
op_amp
l_int|0x7f
suffix:semicolon
id|do_control
c_func
(paren
id|ops
comma
id|drv
comma
id|chanset
comma
id|chan
comma
id|ev-&gt;data.control.param
comma
(paren
(paren
id|ev-&gt;data.control.value
op_rshift
l_int|7
)paren
op_amp
l_int|0x7f
)paren
)paren
suffix:semicolon
)brace
r_else
id|do_control
c_func
(paren
id|ops
comma
id|drv
comma
id|chanset
comma
id|chan
comma
id|ev-&gt;data.control.param
comma
id|ev-&gt;data.control.value
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_NONREGPARAM
suffix:colon
multiline_comment|/* Break it back into its controler values */
id|chan-&gt;param_type
op_assign
id|SNDRV_MIDI_PARAM_TYPE_NONREGISTERED
suffix:semicolon
id|chan-&gt;control
(braket
id|MIDI_CTL_MSB_DATA_ENTRY
)braket
op_assign
(paren
id|ev-&gt;data.control.value
op_rshift
l_int|7
)paren
op_amp
l_int|0x7f
suffix:semicolon
id|chan-&gt;control
(braket
id|MIDI_CTL_LSB_DATA_ENTRY
)braket
op_assign
id|ev-&gt;data.control.value
op_amp
l_int|0x7f
suffix:semicolon
id|chan-&gt;control
(braket
id|MIDI_CTL_NONREG_PARM_NUM_MSB
)braket
op_assign
(paren
id|ev-&gt;data.control.param
op_rshift
l_int|7
)paren
op_amp
l_int|0x7f
suffix:semicolon
id|chan-&gt;control
(braket
id|MIDI_CTL_NONREG_PARM_NUM_LSB
)braket
op_assign
id|ev-&gt;data.control.param
op_amp
l_int|0x7f
suffix:semicolon
id|nrpn
c_func
(paren
id|ops
comma
id|drv
comma
id|chan
comma
id|chanset
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_REGPARAM
suffix:colon
multiline_comment|/* Break it back into its controler values */
id|chan-&gt;param_type
op_assign
id|SNDRV_MIDI_PARAM_TYPE_REGISTERED
suffix:semicolon
id|chan-&gt;control
(braket
id|MIDI_CTL_MSB_DATA_ENTRY
)braket
op_assign
(paren
id|ev-&gt;data.control.value
op_rshift
l_int|7
)paren
op_amp
l_int|0x7f
suffix:semicolon
id|chan-&gt;control
(braket
id|MIDI_CTL_LSB_DATA_ENTRY
)braket
op_assign
id|ev-&gt;data.control.value
op_amp
l_int|0x7f
suffix:semicolon
id|chan-&gt;control
(braket
id|MIDI_CTL_REGIST_PARM_NUM_MSB
)braket
op_assign
(paren
id|ev-&gt;data.control.param
op_rshift
l_int|7
)paren
op_amp
l_int|0x7f
suffix:semicolon
id|chan-&gt;control
(braket
id|MIDI_CTL_REGIST_PARM_NUM_LSB
)braket
op_assign
id|ev-&gt;data.control.param
op_amp
l_int|0x7f
suffix:semicolon
id|rpn
c_func
(paren
id|ops
comma
id|drv
comma
id|chan
comma
id|chanset
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_SYSEX
suffix:colon
r_if
c_cond
(paren
(paren
id|ev-&gt;flags
op_amp
id|SNDRV_SEQ_EVENT_LENGTH_MASK
)paren
op_eq
id|SNDRV_SEQ_EVENT_LENGTH_VARIABLE
)paren
(brace
r_int
r_char
id|sysexbuf
(braket
l_int|64
)braket
suffix:semicolon
r_int
id|len
suffix:semicolon
id|len
op_assign
id|snd_seq_expand_var_event
c_func
(paren
id|ev
comma
r_sizeof
(paren
id|sysexbuf
)paren
comma
id|sysexbuf
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|0
)paren
id|sysex
c_func
(paren
id|ops
comma
id|drv
comma
id|sysexbuf
comma
id|len
comma
id|chanset
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_SONGPOS
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_SONGSEL
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_CLOCK
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_START
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_CONTINUE
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_STOP
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_QFRAME
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_TEMPO
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_TIMESIGN
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_KEYSIGN
suffix:colon
r_goto
id|not_yet
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_SENSING
suffix:colon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_CLIENT_START
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_CLIENT_EXIT
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_CLIENT_CHANGE
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_PORT_START
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_PORT_EXIT
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_PORT_CHANGE
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_SAMPLE
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_SAMPLE_START
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_SAMPLE_STOP
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_SAMPLE_FREQ
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_SAMPLE_VOLUME
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_SAMPLE_LOOP
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_SAMPLE_POSITION
suffix:colon
r_case
id|SNDRV_SEQ_EVENT_ECHO
suffix:colon
id|not_yet
suffix:colon
r_default
suffix:colon
multiline_comment|/*snd_printd(&quot;Unimplemented event %d&bslash;n&quot;, ev-&gt;type);*/
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * release note&n; */
r_static
r_void
DECL|function|note_off
id|note_off
c_func
(paren
id|snd_midi_op_t
op_star
id|ops
comma
r_void
op_star
id|drv
comma
id|snd_midi_channel_t
op_star
id|chan
comma
r_int
id|note
comma
r_int
id|vel
)paren
(brace
r_if
c_cond
(paren
id|chan-&gt;gm_hold
)paren
(brace
multiline_comment|/* Hold this note until pedal is turned off */
id|chan-&gt;note
(braket
id|note
)braket
op_or_assign
id|SNDRV_MIDI_NOTE_RELEASED
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|chan-&gt;note
(braket
id|note
)braket
op_amp
id|SNDRV_MIDI_NOTE_SUSTENUTO
)paren
(brace
multiline_comment|/* Mark this note as release; it will be turned off when sustenuto&n;&t;&t; * is turned off */
id|chan-&gt;note
(braket
id|note
)braket
op_or_assign
id|SNDRV_MIDI_NOTE_RELEASED
suffix:semicolon
)brace
r_else
(brace
id|chan-&gt;note
(braket
id|note
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ops-&gt;note_off
)paren
id|ops
op_member_access_from_pointer
id|note_off
c_func
(paren
id|drv
comma
id|note
comma
id|vel
comma
id|chan
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Do all driver independent operations for this controler and pass&n; * events that need to take place immediately to the driver.&n; */
r_static
r_void
DECL|function|do_control
id|do_control
c_func
(paren
id|snd_midi_op_t
op_star
id|ops
comma
r_void
op_star
id|drv
comma
id|snd_midi_channel_set_t
op_star
id|chset
comma
id|snd_midi_channel_t
op_star
id|chan
comma
r_int
id|control
comma
r_int
id|value
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* Switches */
r_if
c_cond
(paren
(paren
id|control
op_ge
l_int|64
op_logical_and
id|control
op_le
l_int|69
)paren
op_logical_or
(paren
id|control
op_ge
l_int|80
op_logical_and
id|control
op_le
l_int|83
)paren
)paren
(brace
multiline_comment|/* These are all switches; either off or on so set to 0 or 127 */
id|value
op_assign
(paren
id|value
op_ge
l_int|64
)paren
ques
c_cond
l_int|127
suffix:colon
l_int|0
suffix:semicolon
)brace
id|chan-&gt;control
(braket
id|control
)braket
op_assign
id|value
suffix:semicolon
r_switch
c_cond
(paren
id|control
)paren
(brace
r_case
id|MIDI_CTL_SUSTAIN
suffix:colon
r_if
c_cond
(paren
id|value
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Sustain has been released, turn off held notes */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|128
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|chan-&gt;note
(braket
id|i
)braket
op_amp
id|SNDRV_MIDI_NOTE_RELEASED
)paren
(brace
id|chan-&gt;note
(braket
id|i
)braket
op_assign
id|SNDRV_MIDI_NOTE_OFF
suffix:semicolon
r_if
c_cond
(paren
id|ops-&gt;note_off
)paren
id|ops
op_member_access_from_pointer
id|note_off
c_func
(paren
id|drv
comma
id|i
comma
l_int|0
comma
id|chan
)paren
suffix:semicolon
)brace
)brace
)brace
r_break
suffix:semicolon
r_case
id|MIDI_CTL_PORTAMENTO
suffix:colon
r_break
suffix:semicolon
r_case
id|MIDI_CTL_SUSTENUTO
suffix:colon
r_if
c_cond
(paren
id|value
)paren
(brace
multiline_comment|/* Mark each note that is currently held down */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|128
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|chan-&gt;note
(braket
id|i
)braket
op_amp
id|SNDRV_MIDI_NOTE_ON
)paren
id|chan-&gt;note
(braket
id|i
)braket
op_or_assign
id|SNDRV_MIDI_NOTE_SUSTENUTO
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* release all notes that were held */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|128
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|chan-&gt;note
(braket
id|i
)braket
op_amp
id|SNDRV_MIDI_NOTE_SUSTENUTO
)paren
(brace
id|chan-&gt;note
(braket
id|i
)braket
op_and_assign
op_complement
id|SNDRV_MIDI_NOTE_SUSTENUTO
suffix:semicolon
r_if
c_cond
(paren
id|chan-&gt;note
(braket
id|i
)braket
op_amp
id|SNDRV_MIDI_NOTE_RELEASED
)paren
(brace
id|chan-&gt;note
(braket
id|i
)braket
op_assign
id|SNDRV_MIDI_NOTE_OFF
suffix:semicolon
r_if
c_cond
(paren
id|ops-&gt;note_off
)paren
id|ops
op_member_access_from_pointer
id|note_off
c_func
(paren
id|drv
comma
id|i
comma
l_int|0
comma
id|chan
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
r_break
suffix:semicolon
r_case
id|MIDI_CTL_MSB_DATA_ENTRY
suffix:colon
id|chan-&gt;control
(braket
id|MIDI_CTL_LSB_DATA_ENTRY
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* go through here */
r_case
id|MIDI_CTL_LSB_DATA_ENTRY
suffix:colon
r_if
c_cond
(paren
id|chan-&gt;param_type
op_eq
id|SNDRV_MIDI_PARAM_TYPE_REGISTERED
)paren
id|rpn
c_func
(paren
id|ops
comma
id|drv
comma
id|chan
comma
id|chset
)paren
suffix:semicolon
r_else
id|nrpn
c_func
(paren
id|ops
comma
id|drv
comma
id|chan
comma
id|chset
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MIDI_CTL_REGIST_PARM_NUM_LSB
suffix:colon
r_case
id|MIDI_CTL_REGIST_PARM_NUM_MSB
suffix:colon
id|chan-&gt;param_type
op_assign
id|SNDRV_MIDI_PARAM_TYPE_REGISTERED
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MIDI_CTL_NONREG_PARM_NUM_LSB
suffix:colon
r_case
id|MIDI_CTL_NONREG_PARM_NUM_MSB
suffix:colon
id|chan-&gt;param_type
op_assign
id|SNDRV_MIDI_PARAM_TYPE_NONREGISTERED
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MIDI_CTL_ALL_SOUNDS_OFF
suffix:colon
id|all_sounds_off
c_func
(paren
id|ops
comma
id|drv
comma
id|chan
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MIDI_CTL_ALL_NOTES_OFF
suffix:colon
id|all_notes_off
c_func
(paren
id|ops
comma
id|drv
comma
id|chan
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MIDI_CTL_MSB_BANK
suffix:colon
r_if
c_cond
(paren
id|chset-&gt;midi_mode
op_eq
id|SNDRV_MIDI_MODE_XG
)paren
(brace
r_if
c_cond
(paren
id|value
op_eq
l_int|127
)paren
id|chan-&gt;drum_channel
op_assign
l_int|1
suffix:semicolon
r_else
id|chan-&gt;drum_channel
op_assign
l_int|0
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|MIDI_CTL_LSB_BANK
suffix:colon
r_break
suffix:semicolon
r_case
id|MIDI_CTL_RESET_CONTROLLERS
suffix:colon
id|snd_midi_reset_controllers
c_func
(paren
id|chan
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MIDI_CTL_SOFT_PEDAL
suffix:colon
r_case
id|MIDI_CTL_LEGATO_FOOTSWITCH
suffix:colon
r_case
id|MIDI_CTL_HOLD2
suffix:colon
r_case
id|MIDI_CTL_SC1_SOUND_VARIATION
suffix:colon
r_case
id|MIDI_CTL_SC2_TIMBRE
suffix:colon
r_case
id|MIDI_CTL_SC3_RELEASE_TIME
suffix:colon
r_case
id|MIDI_CTL_SC4_ATTACK_TIME
suffix:colon
r_case
id|MIDI_CTL_SC5_BRIGHTNESS
suffix:colon
r_case
id|MIDI_CTL_E1_REVERB_DEPTH
suffix:colon
r_case
id|MIDI_CTL_E2_TREMOLO_DEPTH
suffix:colon
r_case
id|MIDI_CTL_E3_CHORUS_DEPTH
suffix:colon
r_case
id|MIDI_CTL_E4_DETUNE_DEPTH
suffix:colon
r_case
id|MIDI_CTL_E5_PHASER_DEPTH
suffix:colon
r_goto
id|notyet
suffix:semicolon
id|notyet
suffix:colon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|ops-&gt;control
)paren
id|ops
op_member_access_from_pointer
id|control
c_func
(paren
id|drv
comma
id|control
comma
id|chan
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * intialize the MIDI status&n; */
r_void
DECL|function|snd_midi_channel_set_clear
id|snd_midi_channel_set_clear
c_func
(paren
id|snd_midi_channel_set_t
op_star
id|chset
)paren
(brace
r_int
id|i
suffix:semicolon
id|chset-&gt;midi_mode
op_assign
id|SNDRV_MIDI_MODE_GM
suffix:semicolon
id|chset-&gt;gs_master_volume
op_assign
l_int|127
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|chset-&gt;max_channels
suffix:semicolon
id|i
op_increment
)paren
(brace
id|snd_midi_channel_t
op_star
id|chan
op_assign
id|chset-&gt;channels
op_plus
id|i
suffix:semicolon
id|memset
c_func
(paren
id|chan-&gt;note
comma
l_int|0
comma
r_sizeof
(paren
id|chan-&gt;note
)paren
)paren
suffix:semicolon
id|chan-&gt;midi_aftertouch
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;midi_pressure
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;midi_program
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;midi_pitchbend
op_assign
l_int|0
suffix:semicolon
id|snd_midi_reset_controllers
c_func
(paren
id|chan
)paren
suffix:semicolon
id|chan-&gt;gm_rpn_pitch_bend_range
op_assign
l_int|256
suffix:semicolon
multiline_comment|/* 2 semitones */
id|chan-&gt;gm_rpn_fine_tuning
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;gm_rpn_coarse_tuning
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|9
)paren
id|chan-&gt;drum_channel
op_assign
l_int|1
suffix:semicolon
r_else
id|chan-&gt;drum_channel
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Process a rpn message.&n; */
r_static
r_void
DECL|function|rpn
id|rpn
c_func
(paren
id|snd_midi_op_t
op_star
id|ops
comma
r_void
op_star
id|drv
comma
id|snd_midi_channel_t
op_star
id|chan
comma
id|snd_midi_channel_set_t
op_star
id|chset
)paren
(brace
r_int
id|type
suffix:semicolon
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
id|chset-&gt;midi_mode
op_ne
id|SNDRV_MIDI_MODE_NONE
)paren
(brace
id|type
op_assign
(paren
id|chan-&gt;control
(braket
id|MIDI_CTL_REGIST_PARM_NUM_MSB
)braket
op_lshift
l_int|8
)paren
op_or
id|chan-&gt;control
(braket
id|MIDI_CTL_REGIST_PARM_NUM_LSB
)braket
suffix:semicolon
id|val
op_assign
(paren
id|chan-&gt;control
(braket
id|MIDI_CTL_MSB_DATA_ENTRY
)braket
op_lshift
l_int|7
)paren
op_or
id|chan-&gt;control
(braket
id|MIDI_CTL_LSB_DATA_ENTRY
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
l_int|0x0000
suffix:colon
multiline_comment|/* Pitch bend sensitivity */
multiline_comment|/* MSB only / 1 semitone per 128 */
id|chan-&gt;gm_rpn_pitch_bend_range
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0001
suffix:colon
multiline_comment|/* fine tuning: */
multiline_comment|/* MSB/LSB, 8192=center, 100/8192 cent step */
id|chan-&gt;gm_rpn_fine_tuning
op_assign
id|val
op_minus
l_int|8192
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x0002
suffix:colon
multiline_comment|/* coarse tuning */
multiline_comment|/* MSB only / 8192=center, 1 semitone per 128 */
id|chan-&gt;gm_rpn_coarse_tuning
op_assign
id|val
op_minus
l_int|8192
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x7F7F
suffix:colon
multiline_comment|/* &quot;lock-in&quot; RPN */
multiline_comment|/* ignored */
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* should call nrpn or rpn callback here.. */
)brace
multiline_comment|/*&n; * Process an nrpn message.&n; */
r_static
r_void
DECL|function|nrpn
id|nrpn
c_func
(paren
id|snd_midi_op_t
op_star
id|ops
comma
r_void
op_star
id|drv
comma
id|snd_midi_channel_t
op_star
id|chan
comma
id|snd_midi_channel_set_t
op_star
id|chset
)paren
(brace
multiline_comment|/* parse XG NRPNs here if possible */
r_if
c_cond
(paren
id|ops-&gt;nrpn
)paren
id|ops
op_member_access_from_pointer
id|nrpn
c_func
(paren
id|drv
comma
id|chan
comma
id|chset
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * convert channel parameter in GS sysex&n; */
r_static
r_int
DECL|function|get_channel
id|get_channel
c_func
(paren
r_int
r_char
id|cmd
)paren
(brace
r_int
id|p
op_assign
id|cmd
op_amp
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|p
op_eq
l_int|0
)paren
id|p
op_assign
l_int|9
suffix:semicolon
r_else
r_if
c_cond
(paren
id|p
OL
l_int|10
)paren
id|p
op_decrement
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
multiline_comment|/*&n; * Process a sysex message.&n; */
r_static
r_void
DECL|function|sysex
id|sysex
c_func
(paren
id|snd_midi_op_t
op_star
id|ops
comma
r_void
op_star
r_private
comma
r_int
r_char
op_star
id|buf
comma
r_int
id|len
comma
id|snd_midi_channel_set_t
op_star
id|chset
)paren
(brace
multiline_comment|/* GM on */
r_static
r_int
r_char
id|gm_on_macro
(braket
)braket
op_assign
(brace
l_int|0x7e
comma
l_int|0x7f
comma
l_int|0x09
comma
l_int|0x01
comma
)brace
suffix:semicolon
multiline_comment|/* XG on */
r_static
r_int
r_char
id|xg_on_macro
(braket
)braket
op_assign
(brace
l_int|0x43
comma
l_int|0x10
comma
l_int|0x4c
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x7e
comma
l_int|0x00
comma
)brace
suffix:semicolon
multiline_comment|/* GS prefix&n;&t; * drum channel: XX=0x1?(channel), YY=0x15, ZZ=on/off&n;&t; * reverb mode: XX=0x01, YY=0x30, ZZ=0-7&n;&t; * chorus mode: XX=0x01, YY=0x38, ZZ=0-7&n;&t; * master vol:  XX=0x00, YY=0x04, ZZ=0-127&n;&t; */
r_static
r_int
r_char
id|gs_pfx_macro
(braket
)braket
op_assign
(brace
l_int|0x41
comma
l_int|0x10
comma
l_int|0x42
comma
l_int|0x12
comma
l_int|0x40
comma
multiline_comment|/*XX,YY,ZZ*/
)brace
suffix:semicolon
r_int
id|parsed
op_assign
id|SNDRV_MIDI_SYSEX_NOT_PARSED
suffix:semicolon
r_if
c_cond
(paren
id|len
op_le
l_int|0
op_logical_or
id|buf
(braket
l_int|0
)braket
op_ne
l_int|0xf0
)paren
r_return
suffix:semicolon
multiline_comment|/* skip first byte */
id|buf
op_increment
suffix:semicolon
id|len
op_decrement
suffix:semicolon
multiline_comment|/* GM on */
r_if
c_cond
(paren
id|len
op_ge
(paren
r_int
)paren
r_sizeof
(paren
id|gm_on_macro
)paren
op_logical_and
id|memcmp
c_func
(paren
id|buf
comma
id|gm_on_macro
comma
r_sizeof
(paren
id|gm_on_macro
)paren
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|chset-&gt;midi_mode
op_ne
id|SNDRV_MIDI_MODE_GS
op_logical_and
id|chset-&gt;midi_mode
op_ne
id|SNDRV_MIDI_MODE_XG
)paren
(brace
id|chset-&gt;midi_mode
op_assign
id|SNDRV_MIDI_MODE_GM
suffix:semicolon
id|reset_all_channels
c_func
(paren
id|chset
)paren
suffix:semicolon
id|parsed
op_assign
id|SNDRV_MIDI_SYSEX_GM_ON
suffix:semicolon
)brace
)brace
multiline_comment|/* GS macros */
r_else
r_if
c_cond
(paren
id|len
op_ge
l_int|8
op_logical_and
id|memcmp
c_func
(paren
id|buf
comma
id|gs_pfx_macro
comma
r_sizeof
(paren
id|gs_pfx_macro
)paren
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|chset-&gt;midi_mode
op_ne
id|SNDRV_MIDI_MODE_GS
op_logical_and
id|chset-&gt;midi_mode
op_ne
id|SNDRV_MIDI_MODE_XG
)paren
id|chset-&gt;midi_mode
op_assign
id|SNDRV_MIDI_MODE_GS
suffix:semicolon
r_if
c_cond
(paren
id|buf
(braket
l_int|5
)braket
op_eq
l_int|0x00
op_logical_and
id|buf
(braket
l_int|6
)braket
op_eq
l_int|0x7f
op_logical_and
id|buf
(braket
l_int|7
)braket
op_eq
l_int|0x00
)paren
(brace
multiline_comment|/* GS reset */
id|parsed
op_assign
id|SNDRV_MIDI_SYSEX_GS_RESET
suffix:semicolon
id|reset_all_channels
c_func
(paren
id|chset
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|buf
(braket
l_int|5
)braket
op_amp
l_int|0xf0
)paren
op_eq
l_int|0x10
op_logical_and
id|buf
(braket
l_int|6
)braket
op_eq
l_int|0x15
)paren
(brace
multiline_comment|/* drum pattern */
r_int
id|p
op_assign
id|get_channel
c_func
(paren
id|buf
(braket
l_int|5
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
OL
id|chset-&gt;max_channels
)paren
(brace
id|parsed
op_assign
id|SNDRV_MIDI_SYSEX_GS_DRUM_CHANNEL
suffix:semicolon
r_if
c_cond
(paren
id|buf
(braket
l_int|7
)braket
)paren
id|chset-&gt;channels
(braket
id|p
)braket
dot
id|drum_channel
op_assign
l_int|1
suffix:semicolon
r_else
id|chset-&gt;channels
(braket
id|p
)braket
dot
id|drum_channel
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
id|buf
(braket
l_int|5
)braket
op_amp
l_int|0xf0
)paren
op_eq
l_int|0x10
op_logical_and
id|buf
(braket
l_int|6
)braket
op_eq
l_int|0x21
)paren
(brace
multiline_comment|/* program */
r_int
id|p
op_assign
id|get_channel
c_func
(paren
id|buf
(braket
l_int|5
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
OL
id|chset-&gt;max_channels
op_logical_and
op_logical_neg
id|chset-&gt;channels
(braket
id|p
)braket
dot
id|drum_channel
)paren
(brace
id|parsed
op_assign
id|SNDRV_MIDI_SYSEX_GS_DRUM_CHANNEL
suffix:semicolon
id|chset-&gt;channels
(braket
id|p
)braket
dot
id|midi_program
op_assign
id|buf
(braket
l_int|7
)braket
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|buf
(braket
l_int|5
)braket
op_eq
l_int|0x01
op_logical_and
id|buf
(braket
l_int|6
)braket
op_eq
l_int|0x30
)paren
(brace
multiline_comment|/* reverb mode */
id|parsed
op_assign
id|SNDRV_MIDI_SYSEX_GS_CHORUS_MODE
suffix:semicolon
id|chset-&gt;gs_reverb_mode
op_assign
id|buf
(braket
l_int|7
)braket
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|buf
(braket
l_int|5
)braket
op_eq
l_int|0x01
op_logical_and
id|buf
(braket
l_int|6
)braket
op_eq
l_int|0x38
)paren
(brace
multiline_comment|/* chorus mode */
id|parsed
op_assign
id|SNDRV_MIDI_SYSEX_GS_REVERB_MODE
suffix:semicolon
id|chset-&gt;gs_chorus_mode
op_assign
id|buf
(braket
l_int|7
)braket
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|buf
(braket
l_int|5
)braket
op_eq
l_int|0x00
op_logical_and
id|buf
(braket
l_int|6
)braket
op_eq
l_int|0x04
)paren
(brace
multiline_comment|/* master volume */
id|parsed
op_assign
id|SNDRV_MIDI_SYSEX_GS_REVERB_MODE
suffix:semicolon
id|chset-&gt;gs_master_volume
op_assign
id|buf
(braket
l_int|7
)braket
suffix:semicolon
)brace
)brace
multiline_comment|/* XG on */
r_else
r_if
c_cond
(paren
id|len
op_ge
(paren
r_int
)paren
r_sizeof
(paren
id|xg_on_macro
)paren
op_logical_and
id|memcmp
c_func
(paren
id|buf
comma
id|xg_on_macro
comma
r_sizeof
(paren
id|xg_on_macro
)paren
)paren
op_eq
l_int|0
)paren
(brace
r_int
id|i
suffix:semicolon
id|chset-&gt;midi_mode
op_assign
id|SNDRV_MIDI_MODE_XG
suffix:semicolon
id|parsed
op_assign
id|SNDRV_MIDI_SYSEX_XG_ON
suffix:semicolon
multiline_comment|/* reset CC#0 for drums */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|chset-&gt;max_channels
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|chset-&gt;channels
(braket
id|i
)braket
dot
id|drum_channel
)paren
id|chset-&gt;channels
(braket
id|i
)braket
dot
id|control
(braket
id|MIDI_CTL_MSB_BANK
)braket
op_assign
l_int|127
suffix:semicolon
r_else
id|chset-&gt;channels
(braket
id|i
)braket
dot
id|control
(braket
id|MIDI_CTL_MSB_BANK
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ops-&gt;sysex
)paren
id|ops
op_member_access_from_pointer
id|sysex
c_func
(paren
r_private
comma
id|buf
op_minus
l_int|1
comma
id|len
op_plus
l_int|1
comma
id|parsed
comma
id|chset
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * all sound off&n; */
r_static
r_void
DECL|function|all_sounds_off
id|all_sounds_off
c_func
(paren
id|snd_midi_op_t
op_star
id|ops
comma
r_void
op_star
id|drv
comma
id|snd_midi_channel_t
op_star
id|chan
)paren
(brace
r_int
id|n
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ops-&gt;note_terminate
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
l_int|128
suffix:semicolon
id|n
op_increment
)paren
(brace
r_if
c_cond
(paren
id|chan-&gt;note
(braket
id|n
)braket
)paren
(brace
id|ops
op_member_access_from_pointer
id|note_terminate
c_func
(paren
id|drv
comma
id|n
comma
id|chan
)paren
suffix:semicolon
id|chan-&gt;note
(braket
id|n
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; * all notes off&n; */
r_static
r_void
DECL|function|all_notes_off
id|all_notes_off
c_func
(paren
id|snd_midi_op_t
op_star
id|ops
comma
r_void
op_star
id|drv
comma
id|snd_midi_channel_t
op_star
id|chan
)paren
(brace
r_int
id|n
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ops-&gt;note_off
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
l_int|128
suffix:semicolon
id|n
op_increment
)paren
(brace
r_if
c_cond
(paren
id|chan-&gt;note
(braket
id|n
)braket
op_eq
id|SNDRV_MIDI_NOTE_ON
)paren
id|note_off
c_func
(paren
id|ops
comma
id|drv
comma
id|chan
comma
id|n
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Initialise a single midi channel control block.&n; */
DECL|function|snd_midi_channel_init
r_void
id|snd_midi_channel_init
c_func
(paren
id|snd_midi_channel_t
op_star
id|p
comma
r_int
id|n
)paren
(brace
r_if
c_cond
(paren
id|p
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|memset
c_func
(paren
id|p
comma
l_int|0
comma
r_sizeof
(paren
id|snd_midi_channel_t
)paren
)paren
suffix:semicolon
id|p
op_member_access_from_pointer
r_private
op_assign
l_int|NULL
suffix:semicolon
id|p-&gt;number
op_assign
id|n
suffix:semicolon
id|snd_midi_reset_controllers
c_func
(paren
id|p
)paren
suffix:semicolon
id|p-&gt;gm_rpn_pitch_bend_range
op_assign
l_int|256
suffix:semicolon
multiline_comment|/* 2 semitones */
id|p-&gt;gm_rpn_fine_tuning
op_assign
l_int|0
suffix:semicolon
id|p-&gt;gm_rpn_coarse_tuning
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|n
op_eq
l_int|9
)paren
id|p-&gt;drum_channel
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Default ch 10 as drums */
)brace
multiline_comment|/*&n; * Allocate and initialise a set of midi channel control blocks.&n; */
DECL|function|snd_midi_channel_init_set
id|snd_midi_channel_t
op_star
id|snd_midi_channel_init_set
c_func
(paren
r_int
id|n
)paren
(brace
id|snd_midi_channel_t
op_star
id|chan
suffix:semicolon
r_int
id|i
suffix:semicolon
id|chan
op_assign
id|kmalloc
c_func
(paren
id|n
op_star
r_sizeof
(paren
id|snd_midi_channel_t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chan
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|n
suffix:semicolon
id|i
op_increment
)paren
id|snd_midi_channel_init
c_func
(paren
id|chan
op_plus
id|i
comma
id|i
)paren
suffix:semicolon
)brace
r_return
id|chan
suffix:semicolon
)brace
multiline_comment|/*&n; * reset all midi channels&n; */
r_static
r_void
DECL|function|reset_all_channels
id|reset_all_channels
c_func
(paren
id|snd_midi_channel_set_t
op_star
id|chset
)paren
(brace
r_int
id|ch
suffix:semicolon
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
id|chset-&gt;max_channels
suffix:semicolon
id|ch
op_increment
)paren
(brace
id|snd_midi_channel_t
op_star
id|chan
op_assign
id|chset-&gt;channels
op_plus
id|ch
suffix:semicolon
id|snd_midi_reset_controllers
c_func
(paren
id|chan
)paren
suffix:semicolon
id|chan-&gt;gm_rpn_pitch_bend_range
op_assign
l_int|256
suffix:semicolon
multiline_comment|/* 2 semitones */
id|chan-&gt;gm_rpn_fine_tuning
op_assign
l_int|0
suffix:semicolon
id|chan-&gt;gm_rpn_coarse_tuning
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ch
op_eq
l_int|9
)paren
id|chan-&gt;drum_channel
op_assign
l_int|1
suffix:semicolon
r_else
id|chan-&gt;drum_channel
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Allocate and initialise a midi channel set.&n; */
DECL|function|snd_midi_channel_alloc_set
id|snd_midi_channel_set_t
op_star
id|snd_midi_channel_alloc_set
c_func
(paren
r_int
id|n
)paren
(brace
id|snd_midi_channel_set_t
op_star
id|chset
suffix:semicolon
id|chset
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|chset
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chset
)paren
(brace
id|chset-&gt;channels
op_assign
id|snd_midi_channel_init_set
c_func
(paren
id|n
)paren
suffix:semicolon
id|chset-&gt;private_data
op_assign
l_int|NULL
suffix:semicolon
id|chset-&gt;max_channels
op_assign
id|n
suffix:semicolon
)brace
r_return
id|chset
suffix:semicolon
)brace
multiline_comment|/*&n; * Reset the midi controllers on a particular channel to default values.&n; */
DECL|function|snd_midi_reset_controllers
r_void
id|snd_midi_reset_controllers
c_func
(paren
id|snd_midi_channel_t
op_star
id|chan
)paren
(brace
id|memset
c_func
(paren
id|chan-&gt;control
comma
l_int|0
comma
r_sizeof
(paren
id|chan-&gt;control
)paren
)paren
suffix:semicolon
id|chan-&gt;gm_volume
op_assign
l_int|127
suffix:semicolon
id|chan-&gt;gm_expression
op_assign
l_int|127
suffix:semicolon
id|chan-&gt;gm_pan
op_assign
l_int|64
suffix:semicolon
)brace
multiline_comment|/*&n; * Free a midi channel set.&n; */
DECL|function|snd_midi_channel_free_set
r_void
id|snd_midi_channel_free_set
c_func
(paren
id|snd_midi_channel_set_t
op_star
id|chset
)paren
(brace
r_if
c_cond
(paren
id|chset
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|chset-&gt;channels
op_ne
l_int|NULL
)paren
id|kfree
c_func
(paren
id|chset-&gt;channels
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|chset
)paren
suffix:semicolon
)brace
DECL|function|alsa_seq_midi_emul_init
r_static
r_int
id|__init
id|alsa_seq_midi_emul_init
c_func
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|alsa_seq_midi_emul_exit
r_static
r_void
id|__exit
id|alsa_seq_midi_emul_exit
c_func
(paren
r_void
)paren
(brace
)brace
id|module_init
c_func
(paren
id|alsa_seq_midi_emul_init
)paren
id|module_exit
c_func
(paren
id|alsa_seq_midi_emul_exit
)paren
id|EXPORT_SYMBOL
c_func
(paren
id|snd_midi_process_event
)paren
suffix:semicolon
DECL|variable|EXPORT_SYMBOL
id|EXPORT_SYMBOL
c_func
(paren
id|snd_midi_channel_set_clear
)paren
suffix:semicolon
DECL|variable|snd_midi_channel_init
id|EXPORT_SYMBOL
c_func
(paren
id|snd_midi_channel_init
)paren
suffix:semicolon
DECL|variable|snd_midi_channel_init_set
id|EXPORT_SYMBOL
c_func
(paren
id|snd_midi_channel_init_set
)paren
suffix:semicolon
DECL|variable|snd_midi_channel_alloc_set
id|EXPORT_SYMBOL
c_func
(paren
id|snd_midi_channel_alloc_set
)paren
suffix:semicolon
DECL|variable|snd_midi_channel_free_set
id|EXPORT_SYMBOL
c_func
(paren
id|snd_midi_channel_free_set
)paren
suffix:semicolon
eof
