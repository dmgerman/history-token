multiline_comment|/*&n; *   32bit -&gt; 64bit ioctl wrapper for PCM API&n; *   Copyright (c) by Takashi Iwai &lt;tiwai@suse.de&gt;&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
multiline_comment|/* This file included from pcm_native.c */
macro_line|#include &lt;linux/compat.h&gt;
DECL|function|snd_pcm_ioctl_delay_compat
r_static
r_int
id|snd_pcm_ioctl_delay_compat
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|s32
id|__user
op_star
id|src
)paren
(brace
id|snd_pcm_sframes_t
id|delay
suffix:semicolon
id|mm_segment_t
id|fs
suffix:semicolon
r_int
id|err
suffix:semicolon
id|fs
op_assign
id|snd_enter_user
c_func
(paren
)paren
suffix:semicolon
id|err
op_assign
id|snd_pcm_delay
c_func
(paren
id|substream
comma
op_amp
id|delay
)paren
suffix:semicolon
id|snd_leave_user
c_func
(paren
id|fs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|delay
comma
id|src
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|snd_pcm_ioctl_rewind_compat
r_static
r_int
id|snd_pcm_ioctl_rewind_compat
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|u32
id|__user
op_star
id|src
)paren
(brace
id|snd_pcm_uframes_t
id|frames
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|frames
comma
id|src
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|substream-&gt;stream
op_eq
id|SNDRV_PCM_STREAM_PLAYBACK
)paren
id|err
op_assign
id|snd_pcm_playback_rewind
c_func
(paren
id|substream
comma
id|frames
)paren
suffix:semicolon
r_else
id|err
op_assign
id|snd_pcm_capture_rewind
c_func
(paren
id|substream
comma
id|frames
)paren
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|err
comma
id|src
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|err
OL
l_int|0
ques
c_cond
id|err
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pcm_ioctl_forward_compat
r_static
r_int
id|snd_pcm_ioctl_forward_compat
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|u32
id|__user
op_star
id|src
)paren
(brace
id|snd_pcm_uframes_t
id|frames
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|frames
comma
id|src
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|substream-&gt;stream
op_eq
id|SNDRV_PCM_STREAM_PLAYBACK
)paren
id|err
op_assign
id|snd_pcm_playback_forward
c_func
(paren
id|substream
comma
id|frames
)paren
suffix:semicolon
r_else
id|err
op_assign
id|snd_pcm_capture_forward
c_func
(paren
id|substream
comma
id|frames
)paren
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|err
comma
id|src
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|err
OL
l_int|0
ques
c_cond
id|err
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|struct|sndrv_pcm_hw_params32
r_struct
id|sndrv_pcm_hw_params32
(brace
DECL|member|flags
id|u32
id|flags
suffix:semicolon
DECL|member|masks
r_struct
id|sndrv_mask
id|masks
(braket
id|SNDRV_PCM_HW_PARAM_LAST_MASK
op_minus
id|SNDRV_PCM_HW_PARAM_FIRST_MASK
op_plus
l_int|1
)braket
suffix:semicolon
multiline_comment|/* this must be identical */
DECL|member|mres
r_struct
id|sndrv_mask
id|mres
(braket
l_int|5
)braket
suffix:semicolon
multiline_comment|/* reserved masks */
DECL|member|intervals
r_struct
id|sndrv_interval
id|intervals
(braket
id|SNDRV_PCM_HW_PARAM_LAST_INTERVAL
op_minus
id|SNDRV_PCM_HW_PARAM_FIRST_INTERVAL
op_plus
l_int|1
)braket
suffix:semicolon
DECL|member|ires
r_struct
id|sndrv_interval
id|ires
(braket
l_int|9
)braket
suffix:semicolon
multiline_comment|/* reserved intervals */
DECL|member|rmask
id|u32
id|rmask
suffix:semicolon
DECL|member|cmask
id|u32
id|cmask
suffix:semicolon
DECL|member|info
id|u32
id|info
suffix:semicolon
DECL|member|msbits
id|u32
id|msbits
suffix:semicolon
DECL|member|rate_num
id|u32
id|rate_num
suffix:semicolon
DECL|member|rate_den
id|u32
id|rate_den
suffix:semicolon
DECL|member|fifo_size
id|u32
id|fifo_size
suffix:semicolon
DECL|member|reserved
r_int
r_char
id|reserved
(braket
l_int|64
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sndrv_pcm_sw_params32
r_struct
id|sndrv_pcm_sw_params32
(brace
DECL|member|tstamp_mode
id|s32
id|tstamp_mode
suffix:semicolon
DECL|member|period_step
id|u32
id|period_step
suffix:semicolon
DECL|member|sleep_min
id|u32
id|sleep_min
suffix:semicolon
DECL|member|avail_min
id|u32
id|avail_min
suffix:semicolon
DECL|member|xfer_align
id|u32
id|xfer_align
suffix:semicolon
DECL|member|start_threshold
id|u32
id|start_threshold
suffix:semicolon
DECL|member|stop_threshold
id|u32
id|stop_threshold
suffix:semicolon
DECL|member|silence_threshold
id|u32
id|silence_threshold
suffix:semicolon
DECL|member|silence_size
id|u32
id|silence_size
suffix:semicolon
DECL|member|boundary
id|u32
id|boundary
suffix:semicolon
DECL|member|reserved
r_int
r_char
id|reserved
(braket
l_int|64
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|function|snd_pcm_ioctl_sw_params_compat
r_static
r_int
id|snd_pcm_ioctl_sw_params_compat
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_struct
id|sndrv_pcm_sw_params32
id|__user
op_star
id|src
)paren
(brace
id|snd_pcm_sw_params_t
id|params
suffix:semicolon
r_int
id|err
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|params
comma
l_int|0
comma
r_sizeof
(paren
id|params
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|params.tstamp_mode
comma
op_amp
id|src-&gt;tstamp_mode
)paren
op_logical_or
id|get_user
c_func
(paren
id|params.period_step
comma
op_amp
id|src-&gt;period_step
)paren
op_logical_or
id|get_user
c_func
(paren
id|params.sleep_min
comma
op_amp
id|src-&gt;sleep_min
)paren
op_logical_or
id|get_user
c_func
(paren
id|params.avail_min
comma
op_amp
id|src-&gt;avail_min
)paren
op_logical_or
id|get_user
c_func
(paren
id|params.xfer_align
comma
op_amp
id|src-&gt;xfer_align
)paren
op_logical_or
id|get_user
c_func
(paren
id|params.start_threshold
comma
op_amp
id|src-&gt;start_threshold
)paren
op_logical_or
id|get_user
c_func
(paren
id|params.stop_threshold
comma
op_amp
id|src-&gt;stop_threshold
)paren
op_logical_or
id|get_user
c_func
(paren
id|params.silence_threshold
comma
op_amp
id|src-&gt;silence_threshold
)paren
op_logical_or
id|get_user
c_func
(paren
id|params.silence_size
comma
op_amp
id|src-&gt;silence_size
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|err
op_assign
id|snd_pcm_sw_params
c_func
(paren
id|substream
comma
op_amp
id|params
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|params.boundary
comma
op_amp
id|src-&gt;boundary
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|struct|sndrv_pcm_channel_info32
r_struct
id|sndrv_pcm_channel_info32
(brace
DECL|member|channel
id|u32
id|channel
suffix:semicolon
DECL|member|offset
id|u32
id|offset
suffix:semicolon
DECL|member|first
id|u32
id|first
suffix:semicolon
DECL|member|step
id|u32
id|step
suffix:semicolon
)brace
suffix:semicolon
DECL|function|snd_pcm_ioctl_channel_info_compat
r_static
r_int
id|snd_pcm_ioctl_channel_info_compat
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_struct
id|sndrv_pcm_channel_info32
id|__user
op_star
id|src
)paren
(brace
id|snd_pcm_channel_info_t
id|info
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|info.channel
comma
op_amp
id|src-&gt;channel
)paren
op_logical_or
id|get_user
c_func
(paren
id|info.offset
comma
op_amp
id|src-&gt;offset
)paren
op_logical_or
id|get_user
c_func
(paren
id|info.first
comma
op_amp
id|src-&gt;first
)paren
op_logical_or
id|get_user
c_func
(paren
id|info.step
comma
op_amp
id|src-&gt;step
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|err
op_assign
id|snd_pcm_channel_info
c_func
(paren
id|substream
comma
op_amp
id|info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|info.channel
comma
op_amp
id|src-&gt;channel
)paren
op_logical_or
id|put_user
c_func
(paren
id|info.offset
comma
op_amp
id|src-&gt;offset
)paren
op_logical_or
id|put_user
c_func
(paren
id|info.first
comma
op_amp
id|src-&gt;first
)paren
op_logical_or
id|put_user
c_func
(paren
id|info.step
comma
op_amp
id|src-&gt;step
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|struct|sndrv_pcm_status32
r_struct
id|sndrv_pcm_status32
(brace
DECL|member|state
id|s32
id|state
suffix:semicolon
DECL|member|trigger_tstamp
r_struct
id|compat_timespec
id|trigger_tstamp
suffix:semicolon
DECL|member|tstamp
r_struct
id|compat_timespec
id|tstamp
suffix:semicolon
DECL|member|appl_ptr
id|u32
id|appl_ptr
suffix:semicolon
DECL|member|hw_ptr
id|u32
id|hw_ptr
suffix:semicolon
DECL|member|delay
id|s32
id|delay
suffix:semicolon
DECL|member|avail
id|u32
id|avail
suffix:semicolon
DECL|member|avail_max
id|u32
id|avail_max
suffix:semicolon
DECL|member|overrange
id|u32
id|overrange
suffix:semicolon
DECL|member|suspended_state
id|s32
id|suspended_state
suffix:semicolon
DECL|member|reserved
r_int
r_char
id|reserved
(braket
l_int|60
)braket
suffix:semicolon
)brace
id|__attribute__
c_func
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|function|snd_pcm_status_user_compat
r_static
r_int
id|snd_pcm_status_user_compat
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_struct
id|sndrv_pcm_status32
id|__user
op_star
id|src
)paren
(brace
id|snd_pcm_status_t
id|status
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|snd_pcm_status
c_func
(paren
id|substream
comma
op_amp
id|status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|status.state
comma
op_amp
id|src-&gt;state
)paren
op_logical_or
id|put_user
c_func
(paren
id|status.trigger_tstamp.tv_sec
comma
op_amp
id|src-&gt;trigger_tstamp.tv_sec
)paren
op_logical_or
id|put_user
c_func
(paren
id|status.trigger_tstamp.tv_nsec
comma
op_amp
id|src-&gt;trigger_tstamp.tv_nsec
)paren
op_logical_or
id|put_user
c_func
(paren
id|status.tstamp.tv_sec
comma
op_amp
id|src-&gt;tstamp.tv_sec
)paren
op_logical_or
id|put_user
c_func
(paren
id|status.tstamp.tv_nsec
comma
op_amp
id|src-&gt;tstamp.tv_nsec
)paren
op_logical_or
id|put_user
c_func
(paren
id|status.appl_ptr
comma
op_amp
id|src-&gt;appl_ptr
)paren
op_logical_or
id|put_user
c_func
(paren
id|status.hw_ptr
comma
op_amp
id|src-&gt;hw_ptr
)paren
op_logical_or
id|put_user
c_func
(paren
id|status.delay
comma
op_amp
id|src-&gt;delay
)paren
op_logical_or
id|put_user
c_func
(paren
id|status.avail
comma
op_amp
id|src-&gt;avail
)paren
op_logical_or
id|put_user
c_func
(paren
id|status.avail_max
comma
op_amp
id|src-&gt;avail_max
)paren
op_logical_or
id|put_user
c_func
(paren
id|status.overrange
comma
op_amp
id|src-&gt;overrange
)paren
op_logical_or
id|put_user
c_func
(paren
id|status.suspended_state
comma
op_amp
id|src-&gt;suspended_state
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* recalcuate the boundary within 32bit */
DECL|function|recalculate_boundary
r_static
r_void
id|recalculate_boundary
c_func
(paren
id|snd_pcm_runtime_t
op_star
id|runtime
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|runtime-&gt;buffer_size
)paren
r_return
suffix:semicolon
id|runtime-&gt;boundary
op_assign
id|runtime-&gt;buffer_size
suffix:semicolon
r_while
c_loop
(paren
id|runtime-&gt;boundary
op_star
l_int|2
op_le
l_int|0x7fffffffUL
op_minus
id|runtime-&gt;buffer_size
)paren
id|runtime-&gt;boundary
op_mul_assign
l_int|2
suffix:semicolon
)brace
multiline_comment|/* both for HW_PARAMS and HW_REFINE */
DECL|function|snd_pcm_ioctl_hw_params_compat
r_static
r_int
id|snd_pcm_ioctl_hw_params_compat
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|refine
comma
r_struct
id|sndrv_pcm_hw_params32
id|__user
op_star
id|data32
)paren
(brace
r_struct
id|sndrv_pcm_hw_params
op_star
id|data
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|runtime
op_assign
id|substream-&gt;runtime
)paren
)paren
r_return
op_minus
id|ENOTTY
suffix:semicolon
id|data
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|data
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/* only fifo_size is different, so just copy all */
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|data
comma
id|data32
comma
r_sizeof
(paren
op_star
id|data32
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|refine
)paren
id|err
op_assign
id|snd_pcm_hw_refine
c_func
(paren
id|substream
comma
id|data
)paren
suffix:semicolon
r_else
id|err
op_assign
id|snd_pcm_hw_params
c_func
(paren
id|substream
comma
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_goto
id|error
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|data32
comma
id|data
comma
r_sizeof
(paren
op_star
id|data32
)paren
)paren
op_logical_or
id|put_user
c_func
(paren
id|data-&gt;fifo_size
comma
op_amp
id|data32-&gt;fifo_size
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|error
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|refine
)paren
id|recalculate_boundary
c_func
(paren
id|runtime
)paren
suffix:semicolon
id|error
suffix:colon
id|kfree
c_func
(paren
id|data
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; */
DECL|struct|sndrv_xferi32
r_struct
id|sndrv_xferi32
(brace
DECL|member|result
id|s32
id|result
suffix:semicolon
DECL|member|buf
id|u32
id|buf
suffix:semicolon
DECL|member|frames
id|u32
id|frames
suffix:semicolon
)brace
suffix:semicolon
DECL|function|snd_pcm_ioctl_xferi_compat
r_static
r_int
id|snd_pcm_ioctl_xferi_compat
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|dir
comma
r_struct
id|sndrv_xferi32
id|__user
op_star
id|data32
)paren
(brace
id|compat_caddr_t
id|buf
suffix:semicolon
id|u32
id|frames
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|substream-&gt;runtime
)paren
r_return
op_minus
id|ENOTTY
suffix:semicolon
r_if
c_cond
(paren
id|substream-&gt;stream
op_ne
id|dir
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|substream-&gt;runtime-&gt;status-&gt;state
op_eq
id|SNDRV_PCM_STATE_OPEN
)paren
r_return
op_minus
id|EBADFD
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|buf
comma
op_amp
id|data32-&gt;buf
)paren
op_logical_or
id|get_user
c_func
(paren
id|frames
comma
op_amp
id|data32-&gt;frames
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|dir
op_eq
id|SNDRV_PCM_STREAM_PLAYBACK
)paren
id|err
op_assign
id|snd_pcm_lib_write
c_func
(paren
id|substream
comma
id|compat_ptr
c_func
(paren
id|buf
)paren
comma
id|frames
)paren
suffix:semicolon
r_else
id|err
op_assign
id|snd_pcm_lib_read
c_func
(paren
id|substream
comma
id|compat_ptr
c_func
(paren
id|buf
)paren
comma
id|frames
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* copy the result */
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|err
comma
op_amp
id|data32-&gt;result
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* snd_xfern needs remapping of bufs */
DECL|struct|sndrv_xfern32
r_struct
id|sndrv_xfern32
(brace
DECL|member|result
id|s32
id|result
suffix:semicolon
DECL|member|bufs
id|u32
id|bufs
suffix:semicolon
multiline_comment|/* this is void **; */
DECL|member|frames
id|u32
id|frames
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/*&n; * xfern ioctl nees to copy (up to) 128 pointers on stack.&n; * although we may pass the copied pointers through f_op-&gt;ioctl, but the ioctl&n; * handler there expands again the same 128 pointers on stack, so it is better&n; * to handle the function (calling pcm_readv/writev) directly in this handler.&n; */
DECL|function|snd_pcm_ioctl_xfern_compat
r_static
r_int
id|snd_pcm_ioctl_xfern_compat
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|dir
comma
r_struct
id|sndrv_xfern32
id|__user
op_star
id|data32
)paren
(brace
id|compat_caddr_t
id|buf
suffix:semicolon
id|compat_caddr_t
id|__user
op_star
id|bufptr
suffix:semicolon
id|u32
id|frames
suffix:semicolon
r_void
id|__user
op_star
op_star
id|bufs
suffix:semicolon
r_int
id|err
comma
id|ch
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|substream-&gt;runtime
)paren
r_return
op_minus
id|ENOTTY
suffix:semicolon
r_if
c_cond
(paren
id|substream-&gt;stream
op_ne
id|dir
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ch
op_assign
id|substream-&gt;runtime-&gt;channels
)paren
OG
l_int|128
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|buf
comma
op_amp
id|data32-&gt;bufs
)paren
op_logical_or
id|get_user
c_func
(paren
id|frames
comma
op_amp
id|data32-&gt;frames
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|bufptr
op_assign
id|compat_ptr
c_func
(paren
id|buf
)paren
suffix:semicolon
id|bufs
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_void
id|__user
op_star
)paren
op_star
id|ch
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bufs
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ch
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u32
id|ptr
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|ptr
comma
id|bufptr
)paren
)paren
(brace
id|kfree
c_func
(paren
id|bufs
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|bufs
(braket
id|ch
)braket
op_assign
id|compat_ptr
c_func
(paren
id|ptr
)paren
suffix:semicolon
id|bufptr
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dir
op_eq
id|SNDRV_PCM_STREAM_PLAYBACK
)paren
id|err
op_assign
id|snd_pcm_lib_writev
c_func
(paren
id|substream
comma
id|bufs
comma
id|frames
)paren
suffix:semicolon
r_else
id|err
op_assign
id|snd_pcm_lib_readv
c_func
(paren
id|substream
comma
id|bufs
comma
id|frames
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ge
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|err
comma
op_amp
id|data32-&gt;result
)paren
)paren
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|bufs
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|struct|sndrv_pcm_mmap_status32
r_struct
id|sndrv_pcm_mmap_status32
(brace
DECL|member|state
id|s32
id|state
suffix:semicolon
DECL|member|pad1
id|s32
id|pad1
suffix:semicolon
DECL|member|hw_ptr
id|u32
id|hw_ptr
suffix:semicolon
DECL|member|tstamp
r_struct
id|compat_timespec
id|tstamp
suffix:semicolon
DECL|member|suspended_state
id|s32
id|suspended_state
suffix:semicolon
)brace
id|__attribute__
c_func
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|struct|sndrv_pcm_mmap_control32
r_struct
id|sndrv_pcm_mmap_control32
(brace
DECL|member|appl_ptr
id|u32
id|appl_ptr
suffix:semicolon
DECL|member|avail_min
id|u32
id|avail_min
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|sndrv_pcm_sync_ptr32
r_struct
id|sndrv_pcm_sync_ptr32
(brace
DECL|member|flags
id|u32
id|flags
suffix:semicolon
r_union
(brace
DECL|member|status
r_struct
id|sndrv_pcm_mmap_status32
id|status
suffix:semicolon
DECL|member|reserved
r_int
r_char
id|reserved
(braket
l_int|64
)braket
suffix:semicolon
DECL|member|s
)brace
id|s
suffix:semicolon
r_union
(brace
DECL|member|control
r_struct
id|sndrv_pcm_mmap_control32
id|control
suffix:semicolon
DECL|member|reserved
r_int
r_char
id|reserved
(braket
l_int|64
)braket
suffix:semicolon
DECL|member|c
)brace
id|c
suffix:semicolon
)brace
id|__attribute__
c_func
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|function|snd_pcm_ioctl_sync_ptr_compat
r_static
r_int
id|snd_pcm_ioctl_sync_ptr_compat
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_struct
id|sndrv_pcm_sync_ptr32
id|__user
op_star
id|src
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_volatile
r_struct
id|sndrv_pcm_mmap_status
op_star
id|status
suffix:semicolon
r_volatile
r_struct
id|sndrv_pcm_mmap_control
op_star
id|control
suffix:semicolon
id|u32
id|sflags
suffix:semicolon
r_struct
id|sndrv_pcm_mmap_control
id|scontrol
suffix:semicolon
r_struct
id|sndrv_pcm_mmap_status
id|sstatus
suffix:semicolon
r_int
id|err
suffix:semicolon
id|snd_assert
c_func
(paren
id|runtime
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|sflags
comma
op_amp
id|src-&gt;flags
)paren
op_logical_or
id|get_user
c_func
(paren
id|scontrol.appl_ptr
comma
op_amp
id|src-&gt;c.control.appl_ptr
)paren
op_logical_or
id|get_user
c_func
(paren
id|scontrol.avail_min
comma
op_amp
id|src-&gt;c.control.avail_min
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|sflags
op_amp
id|SNDRV_PCM_SYNC_PTR_HWSYNC
)paren
(brace
id|err
op_assign
id|snd_pcm_hwsync
c_func
(paren
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
id|status
op_assign
id|runtime-&gt;status
suffix:semicolon
id|control
op_assign
id|runtime-&gt;control
suffix:semicolon
id|snd_pcm_stream_lock_irq
c_func
(paren
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sflags
op_amp
id|SNDRV_PCM_SYNC_PTR_APPL
)paren
)paren
id|control-&gt;appl_ptr
op_assign
id|scontrol.appl_ptr
suffix:semicolon
r_else
id|scontrol.appl_ptr
op_assign
id|control-&gt;appl_ptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sflags
op_amp
id|SNDRV_PCM_SYNC_PTR_AVAIL_MIN
)paren
)paren
id|control-&gt;avail_min
op_assign
id|scontrol.avail_min
suffix:semicolon
r_else
id|scontrol.avail_min
op_assign
id|control-&gt;avail_min
suffix:semicolon
id|sstatus.state
op_assign
id|status-&gt;state
suffix:semicolon
id|sstatus.hw_ptr
op_assign
id|status-&gt;hw_ptr
suffix:semicolon
id|sstatus.tstamp
op_assign
id|status-&gt;tstamp
suffix:semicolon
id|sstatus.suspended_state
op_assign
id|status-&gt;suspended_state
suffix:semicolon
id|snd_pcm_stream_unlock_irq
c_func
(paren
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|sstatus.state
comma
op_amp
id|src-&gt;s.status.state
)paren
op_logical_or
id|put_user
c_func
(paren
id|sstatus.hw_ptr
comma
op_amp
id|src-&gt;s.status.hw_ptr
)paren
op_logical_or
id|put_user
c_func
(paren
id|sstatus.tstamp.tv_sec
comma
op_amp
id|src-&gt;s.status.tstamp.tv_sec
)paren
op_logical_or
id|put_user
c_func
(paren
id|sstatus.tstamp.tv_nsec
comma
op_amp
id|src-&gt;s.status.tstamp.tv_nsec
)paren
op_logical_or
id|put_user
c_func
(paren
id|sstatus.suspended_state
comma
op_amp
id|src-&gt;s.status.suspended_state
)paren
op_logical_or
id|put_user
c_func
(paren
id|scontrol.appl_ptr
comma
op_amp
id|src-&gt;c.control.appl_ptr
)paren
op_logical_or
id|put_user
c_func
(paren
id|scontrol.avail_min
comma
op_amp
id|src-&gt;c.control.avail_min
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; */
r_enum
(brace
DECL|enumerator|SNDRV_PCM_IOCTL_HW_REFINE32
id|SNDRV_PCM_IOCTL_HW_REFINE32
op_assign
id|_IOWR
c_func
(paren
l_char|&squot;A&squot;
comma
l_int|0x10
comma
r_struct
id|sndrv_pcm_hw_params32
)paren
comma
DECL|enumerator|SNDRV_PCM_IOCTL_HW_PARAMS32
id|SNDRV_PCM_IOCTL_HW_PARAMS32
op_assign
id|_IOWR
c_func
(paren
l_char|&squot;A&squot;
comma
l_int|0x11
comma
r_struct
id|sndrv_pcm_hw_params32
)paren
comma
DECL|enumerator|SNDRV_PCM_IOCTL_SW_PARAMS32
id|SNDRV_PCM_IOCTL_SW_PARAMS32
op_assign
id|_IOWR
c_func
(paren
l_char|&squot;A&squot;
comma
l_int|0x13
comma
r_struct
id|sndrv_pcm_sw_params32
)paren
comma
DECL|enumerator|SNDRV_PCM_IOCTL_STATUS32
id|SNDRV_PCM_IOCTL_STATUS32
op_assign
id|_IOR
c_func
(paren
l_char|&squot;A&squot;
comma
l_int|0x20
comma
r_struct
id|sndrv_pcm_status32
)paren
comma
DECL|enumerator|SNDRV_PCM_IOCTL_DELAY32
id|SNDRV_PCM_IOCTL_DELAY32
op_assign
id|_IOR
c_func
(paren
l_char|&squot;A&squot;
comma
l_int|0x21
comma
id|s32
)paren
comma
DECL|enumerator|SNDRV_PCM_IOCTL_CHANNEL_INFO32
id|SNDRV_PCM_IOCTL_CHANNEL_INFO32
op_assign
id|_IOR
c_func
(paren
l_char|&squot;A&squot;
comma
l_int|0x32
comma
r_struct
id|sndrv_pcm_channel_info32
)paren
comma
DECL|enumerator|SNDRV_PCM_IOCTL_REWIND32
id|SNDRV_PCM_IOCTL_REWIND32
op_assign
id|_IOW
c_func
(paren
l_char|&squot;A&squot;
comma
l_int|0x46
comma
id|u32
)paren
comma
DECL|enumerator|SNDRV_PCM_IOCTL_FORWARD32
id|SNDRV_PCM_IOCTL_FORWARD32
op_assign
id|_IOW
c_func
(paren
l_char|&squot;A&squot;
comma
l_int|0x49
comma
id|u32
)paren
comma
DECL|enumerator|SNDRV_PCM_IOCTL_WRITEI_FRAMES32
id|SNDRV_PCM_IOCTL_WRITEI_FRAMES32
op_assign
id|_IOW
c_func
(paren
l_char|&squot;A&squot;
comma
l_int|0x50
comma
r_struct
id|sndrv_xferi32
)paren
comma
DECL|enumerator|SNDRV_PCM_IOCTL_READI_FRAMES32
id|SNDRV_PCM_IOCTL_READI_FRAMES32
op_assign
id|_IOR
c_func
(paren
l_char|&squot;A&squot;
comma
l_int|0x51
comma
r_struct
id|sndrv_xferi32
)paren
comma
DECL|enumerator|SNDRV_PCM_IOCTL_WRITEN_FRAMES32
id|SNDRV_PCM_IOCTL_WRITEN_FRAMES32
op_assign
id|_IOW
c_func
(paren
l_char|&squot;A&squot;
comma
l_int|0x52
comma
r_struct
id|sndrv_xfern32
)paren
comma
DECL|enumerator|SNDRV_PCM_IOCTL_READN_FRAMES32
id|SNDRV_PCM_IOCTL_READN_FRAMES32
op_assign
id|_IOR
c_func
(paren
l_char|&squot;A&squot;
comma
l_int|0x53
comma
r_struct
id|sndrv_xfern32
)paren
comma
DECL|enumerator|SNDRV_PCM_IOCTL_SYNC_PTR32
id|SNDRV_PCM_IOCTL_SYNC_PTR32
op_assign
id|_IOWR
c_func
(paren
l_char|&squot;A&squot;
comma
l_int|0x23
comma
r_struct
id|sndrv_pcm_sync_ptr32
)paren
comma
)brace
suffix:semicolon
DECL|function|snd_pcm_ioctl_compat
r_static
r_int
id|snd_pcm_ioctl_compat
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|snd_pcm_file_t
op_star
id|pcm_file
suffix:semicolon
id|snd_pcm_substream_t
op_star
id|substream
suffix:semicolon
r_void
id|__user
op_star
id|argp
op_assign
id|compat_ptr
c_func
(paren
id|arg
)paren
suffix:semicolon
id|pcm_file
op_assign
id|file-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pcm_file
)paren
r_return
op_minus
id|ENOTTY
suffix:semicolon
id|substream
op_assign
id|pcm_file-&gt;substream
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|substream
)paren
r_return
op_minus
id|ENOTTY
suffix:semicolon
multiline_comment|/*&n;&t; * When PCM is used on 32bit mode, we need to disable&n;&t; * mmap of PCM status/control records because of the size&n;&t; * incompatibility.&n;&t; */
id|substream-&gt;no_mmap_ctrl
op_assign
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_IOCTL_PVERSION
suffix:colon
r_case
id|SNDRV_PCM_IOCTL_INFO
suffix:colon
r_case
id|SNDRV_PCM_IOCTL_TSTAMP
suffix:colon
r_case
id|SNDRV_PCM_IOCTL_HWSYNC
suffix:colon
r_case
id|SNDRV_PCM_IOCTL_PREPARE
suffix:colon
r_case
id|SNDRV_PCM_IOCTL_RESET
suffix:colon
r_case
id|SNDRV_PCM_IOCTL_START
suffix:colon
r_case
id|SNDRV_PCM_IOCTL_DROP
suffix:colon
r_case
id|SNDRV_PCM_IOCTL_DRAIN
suffix:colon
r_case
id|SNDRV_PCM_IOCTL_PAUSE
suffix:colon
r_case
id|SNDRV_PCM_IOCTL_HW_FREE
suffix:colon
r_case
id|SNDRV_PCM_IOCTL_RESUME
suffix:colon
r_case
id|SNDRV_PCM_IOCTL_XRUN
suffix:colon
r_case
id|SNDRV_PCM_IOCTL_LINK
suffix:colon
r_case
id|SNDRV_PCM_IOCTL_UNLINK
suffix:colon
r_if
c_cond
(paren
id|substream-&gt;stream
op_eq
id|SNDRV_PCM_STREAM_PLAYBACK
)paren
r_return
id|snd_pcm_playback_ioctl1
c_func
(paren
id|substream
comma
id|cmd
comma
id|argp
)paren
suffix:semicolon
r_else
r_return
id|snd_pcm_capture_ioctl1
c_func
(paren
id|substream
comma
id|cmd
comma
id|argp
)paren
suffix:semicolon
r_case
id|SNDRV_PCM_IOCTL_HW_REFINE32
suffix:colon
r_return
id|snd_pcm_ioctl_hw_params_compat
c_func
(paren
id|substream
comma
l_int|1
comma
id|argp
)paren
suffix:semicolon
r_case
id|SNDRV_PCM_IOCTL_HW_PARAMS32
suffix:colon
r_return
id|snd_pcm_ioctl_hw_params_compat
c_func
(paren
id|substream
comma
l_int|0
comma
id|argp
)paren
suffix:semicolon
r_case
id|SNDRV_PCM_IOCTL_SW_PARAMS32
suffix:colon
r_return
id|snd_pcm_ioctl_sw_params_compat
c_func
(paren
id|substream
comma
id|argp
)paren
suffix:semicolon
r_case
id|SNDRV_PCM_IOCTL_STATUS32
suffix:colon
r_return
id|snd_pcm_status_user_compat
c_func
(paren
id|substream
comma
id|argp
)paren
suffix:semicolon
r_case
id|SNDRV_PCM_IOCTL_SYNC_PTR32
suffix:colon
r_return
id|snd_pcm_ioctl_sync_ptr_compat
c_func
(paren
id|substream
comma
id|argp
)paren
suffix:semicolon
r_case
id|SNDRV_PCM_IOCTL_CHANNEL_INFO32
suffix:colon
r_return
id|snd_pcm_ioctl_channel_info_compat
c_func
(paren
id|substream
comma
id|argp
)paren
suffix:semicolon
r_case
id|SNDRV_PCM_IOCTL_WRITEI_FRAMES32
suffix:colon
r_return
id|snd_pcm_ioctl_xferi_compat
c_func
(paren
id|substream
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
id|argp
)paren
suffix:semicolon
r_case
id|SNDRV_PCM_IOCTL_READI_FRAMES32
suffix:colon
r_return
id|snd_pcm_ioctl_xferi_compat
c_func
(paren
id|substream
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
id|argp
)paren
suffix:semicolon
r_case
id|SNDRV_PCM_IOCTL_WRITEN_FRAMES32
suffix:colon
r_return
id|snd_pcm_ioctl_xfern_compat
c_func
(paren
id|substream
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
id|argp
)paren
suffix:semicolon
r_case
id|SNDRV_PCM_IOCTL_READN_FRAMES32
suffix:colon
r_return
id|snd_pcm_ioctl_xfern_compat
c_func
(paren
id|substream
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
id|argp
)paren
suffix:semicolon
r_case
id|SNDRV_PCM_IOCTL_DELAY32
suffix:colon
r_return
id|snd_pcm_ioctl_delay_compat
c_func
(paren
id|substream
comma
id|argp
)paren
suffix:semicolon
r_case
id|SNDRV_PCM_IOCTL_REWIND32
suffix:colon
r_return
id|snd_pcm_ioctl_rewind_compat
c_func
(paren
id|substream
comma
id|argp
)paren
suffix:semicolon
r_case
id|SNDRV_PCM_IOCTL_FORWARD32
suffix:colon
r_return
id|snd_pcm_ioctl_forward_compat
c_func
(paren
id|substream
comma
id|argp
)paren
suffix:semicolon
)brace
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
eof
