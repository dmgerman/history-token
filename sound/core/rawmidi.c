multiline_comment|/*&n; *  Abstract layer for MIDI v1.0 stream&n; *  Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/time.h&gt;
macro_line|#include &lt;linux/wait.h&gt;
macro_line|#include &lt;sound/rawmidi.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#include &lt;sound/control.h&gt;
macro_line|#include &lt;sound/minors.h&gt;
macro_line|#include &lt;sound/initval.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jaroslav Kysela &lt;perex@suse.cz&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Midlevel RawMidi code for ALSA.&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SND_OSSEMUL
DECL|variable|snd_midi_map
r_static
r_int
id|snd_midi_map
(braket
id|SNDRV_CARDS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
(paren
id|SNDRV_CARDS
op_minus
l_int|1
)paren
)braket
op_assign
l_int|0
)brace
suffix:semicolon
DECL|variable|snd_amidi_map
r_static
r_int
id|snd_amidi_map
(braket
id|SNDRV_CARDS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
(paren
id|SNDRV_CARDS
op_minus
l_int|1
)paren
)braket
op_assign
l_int|1
)brace
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_midi_map
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_midi_map
comma
l_string|&quot;Raw MIDI device number assigned to 1st OSS device.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_midi_map
comma
l_string|&quot;default:0,skill:advanced&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_amidi_map
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_amidi_map
comma
l_string|&quot;Raw MIDI device number assigned to 2nd OSS device.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_amidi_map
comma
l_string|&quot;default:1,skill:advanced&quot;
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_SND_OSSEMUL */
r_static
r_int
id|snd_rawmidi_free
c_func
(paren
id|snd_rawmidi_t
op_star
id|rawmidi
)paren
suffix:semicolon
r_static
r_int
id|snd_rawmidi_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
suffix:semicolon
r_static
r_int
id|snd_rawmidi_dev_register
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
suffix:semicolon
r_static
r_int
id|snd_rawmidi_dev_unregister
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
suffix:semicolon
DECL|variable|snd_rawmidi_devices
id|snd_rawmidi_t
op_star
id|snd_rawmidi_devices
(braket
id|SNDRV_CARDS
op_star
id|SNDRV_RAWMIDI_DEVICES
)braket
suffix:semicolon
r_static
id|DECLARE_MUTEX
c_func
(paren
id|register_mutex
)paren
suffix:semicolon
DECL|function|dec_mod_count
r_static
r_inline
r_void
id|dec_mod_count
c_func
(paren
r_struct
id|module
op_star
id|module
)paren
(brace
r_if
c_cond
(paren
id|module
)paren
id|__MOD_DEC_USE_COUNT
c_func
(paren
id|module
)paren
suffix:semicolon
)brace
DECL|function|snd_rawmidi_file_flags
r_static
r_inline
r_int
r_int
id|snd_rawmidi_file_flags
c_func
(paren
r_struct
id|file
op_star
id|file
)paren
(brace
r_switch
c_cond
(paren
id|file-&gt;f_mode
op_amp
(paren
id|FMODE_READ
op_or
id|FMODE_WRITE
)paren
)paren
(brace
r_case
id|FMODE_WRITE
suffix:colon
r_return
id|SNDRV_RAWMIDI_LFLG_OUTPUT
suffix:semicolon
r_case
id|FMODE_READ
suffix:colon
r_return
id|SNDRV_RAWMIDI_LFLG_INPUT
suffix:semicolon
r_default
suffix:colon
r_return
id|SNDRV_RAWMIDI_LFLG_OPEN
suffix:semicolon
)brace
)brace
DECL|function|snd_rawmidi_ready
r_static
r_inline
r_int
id|snd_rawmidi_ready
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
id|snd_rawmidi_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_return
id|runtime-&gt;avail
op_ge
id|runtime-&gt;avail_min
suffix:semicolon
)brace
DECL|function|snd_rawmidi_ready_append
r_static
r_inline
r_int
id|snd_rawmidi_ready_append
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
r_int
id|count
)paren
(brace
id|snd_rawmidi_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_return
id|runtime-&gt;avail
op_ge
id|runtime-&gt;avail_min
op_logical_and
id|runtime-&gt;avail
op_ge
id|count
suffix:semicolon
)brace
DECL|function|snd_rawmidi_init
r_static
r_int
id|snd_rawmidi_init
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
id|snd_rawmidi_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|runtime-&gt;sleep
)paren
suffix:semicolon
id|runtime-&gt;event
op_assign
l_int|NULL
suffix:semicolon
id|runtime-&gt;buffer_size
op_assign
id|PAGE_SIZE
suffix:semicolon
id|runtime-&gt;avail_min
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|substream-&gt;stream
op_eq
id|SNDRV_RAWMIDI_STREAM_INPUT
)paren
id|runtime-&gt;avail
op_assign
l_int|0
suffix:semicolon
r_else
id|runtime-&gt;avail
op_assign
id|runtime-&gt;buffer_size
suffix:semicolon
r_if
c_cond
(paren
(paren
id|runtime-&gt;buffer
op_assign
id|kmalloc
c_func
(paren
id|runtime-&gt;buffer_size
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|runtime-&gt;appl_ptr
op_assign
id|runtime-&gt;hw_ptr
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_rawmidi_done_buffer
r_static
r_int
id|snd_rawmidi_done_buffer
c_func
(paren
id|snd_rawmidi_runtime_t
op_star
id|runtime
)paren
(brace
r_if
c_cond
(paren
id|runtime-&gt;buffer
)paren
(brace
id|kfree
c_func
(paren
id|runtime-&gt;buffer
)paren
suffix:semicolon
id|runtime-&gt;buffer
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_rawmidi_drop_output
r_int
id|snd_rawmidi_drop_output
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
id|snd_rawmidi_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|substream-&gt;ops
op_member_access_from_pointer
id|trigger
c_func
(paren
id|substream
comma
l_int|0
)paren
suffix:semicolon
id|runtime-&gt;trigger
op_assign
l_int|0
suffix:semicolon
id|runtime-&gt;drain
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* interrupts are not enabled at this moment,&n;&t;   so spinlock is not required */
id|runtime-&gt;appl_ptr
op_assign
id|runtime-&gt;hw_ptr
op_assign
l_int|0
suffix:semicolon
id|runtime-&gt;avail
op_assign
id|runtime-&gt;buffer_size
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_rawmidi_drain_output
r_int
id|snd_rawmidi_drain_output
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
r_int
id|err
suffix:semicolon
r_int
id|timeout
suffix:semicolon
id|snd_rawmidi_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
id|runtime-&gt;drain
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|runtime-&gt;avail
OL
id|runtime-&gt;buffer_size
)paren
(brace
id|timeout
op_assign
id|interruptible_sleep_on_timeout
c_func
(paren
op_amp
id|runtime-&gt;sleep
comma
l_int|10
op_star
id|HZ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|err
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|runtime-&gt;avail
OL
id|runtime-&gt;buffer_size
op_logical_and
op_logical_neg
id|timeout
)paren
(brace
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|runtime-&gt;drain
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
op_minus
id|ERESTARTSYS
)paren
(brace
multiline_comment|/* we need wait a while to make sure that Tx FIFOs are empty */
r_if
c_cond
(paren
id|substream-&gt;ops-&gt;drain
)paren
id|substream-&gt;ops
op_member_access_from_pointer
id|drain
c_func
(paren
id|substream
)paren
suffix:semicolon
r_else
(brace
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
op_div
l_int|20
)paren
suffix:semicolon
)brace
id|snd_rawmidi_drop_output
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|snd_rawmidi_drain_input
r_int
id|snd_rawmidi_drain_input
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
id|snd_rawmidi_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|substream-&gt;ops
op_member_access_from_pointer
id|trigger
c_func
(paren
id|substream
comma
l_int|0
)paren
suffix:semicolon
id|runtime-&gt;trigger
op_assign
l_int|0
suffix:semicolon
id|runtime-&gt;drain
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* interrupts aren&squot;t enabled at this moment, so spinlock isn&squot;t needed */
id|runtime-&gt;appl_ptr
op_assign
id|runtime-&gt;hw_ptr
op_assign
l_int|0
suffix:semicolon
id|runtime-&gt;avail
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_rawmidi_kernel_open
r_int
id|snd_rawmidi_kernel_open
c_func
(paren
r_int
id|cardnum
comma
r_int
id|device
comma
r_int
id|subdevice
comma
r_int
id|mode
comma
id|snd_rawmidi_file_t
op_star
id|rfile
)paren
(brace
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
r_struct
id|list_head
op_star
id|list1
comma
op_star
id|list2
suffix:semicolon
id|snd_rawmidi_substream_t
op_star
id|sinput
comma
op_star
id|soutput
suffix:semicolon
id|snd_rawmidi_runtime_t
op_star
id|input
op_assign
l_int|NULL
comma
op_star
id|output
op_assign
l_int|NULL
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rfile
)paren
id|rfile-&gt;input
op_assign
id|rfile-&gt;output
op_assign
l_int|NULL
suffix:semicolon
macro_line|#ifdef LINUX_2_2
id|MOD_INC_USE_COUNT
suffix:semicolon
macro_line|#endif
id|rmidi
op_assign
id|snd_rawmidi_devices
(braket
(paren
id|cardnum
op_star
id|SNDRV_RAWMIDI_DEVICES
)paren
op_plus
id|device
)braket
suffix:semicolon
r_if
c_cond
(paren
id|rmidi
op_eq
l_int|NULL
)paren
(brace
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|__error1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|try_inc_mod_count
c_func
(paren
id|rmidi-&gt;card-&gt;module
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|__error1
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|rmidi-&gt;open_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_amp
id|SNDRV_RAWMIDI_LFLG_INPUT
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|rmidi-&gt;info_flags
op_amp
id|SNDRV_RAWMIDI_INFO_INPUT
)paren
)paren
(brace
id|err
op_assign
op_minus
id|ENXIO
suffix:semicolon
r_goto
id|__error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|subdevice
op_ge
l_int|0
op_logical_and
id|subdevice
op_ge
id|rmidi-&gt;streams
(braket
id|SNDRV_RAWMIDI_STREAM_INPUT
)braket
dot
id|substream_count
)paren
(brace
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|__error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rmidi-&gt;streams
(braket
id|SNDRV_RAWMIDI_STREAM_INPUT
)braket
dot
id|substream_opened
op_ge
id|rmidi-&gt;streams
(braket
id|SNDRV_RAWMIDI_STREAM_INPUT
)braket
dot
id|substream_count
)paren
(brace
id|err
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_goto
id|__error
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|mode
op_amp
id|SNDRV_RAWMIDI_LFLG_OUTPUT
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|rmidi-&gt;info_flags
op_amp
id|SNDRV_RAWMIDI_INFO_OUTPUT
)paren
)paren
(brace
id|err
op_assign
op_minus
id|ENXIO
suffix:semicolon
r_goto
id|__error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|subdevice
op_ge
l_int|0
op_logical_and
id|subdevice
op_ge
id|rmidi-&gt;streams
(braket
id|SNDRV_RAWMIDI_STREAM_OUTPUT
)braket
dot
id|substream_count
)paren
(brace
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|__error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rmidi-&gt;streams
(braket
id|SNDRV_RAWMIDI_STREAM_OUTPUT
)braket
dot
id|substream_opened
op_ge
id|rmidi-&gt;streams
(braket
id|SNDRV_RAWMIDI_STREAM_OUTPUT
)braket
dot
id|substream_count
)paren
(brace
id|err
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_goto
id|__error
suffix:semicolon
)brace
)brace
id|list1
op_assign
id|rmidi-&gt;streams
(braket
id|SNDRV_RAWMIDI_STREAM_INPUT
)braket
dot
id|substreams.next
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|list1
op_eq
op_amp
id|rmidi-&gt;streams
(braket
id|SNDRV_RAWMIDI_STREAM_INPUT
)braket
dot
id|substreams
)paren
(brace
id|sinput
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_amp
id|SNDRV_RAWMIDI_LFLG_INPUT
)paren
(brace
id|err
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_goto
id|__error
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
id|sinput
op_assign
id|list_entry
c_func
(paren
id|list1
comma
id|snd_rawmidi_substream_t
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mode
op_amp
id|SNDRV_RAWMIDI_LFLG_INPUT
)paren
op_logical_and
id|sinput-&gt;opened
)paren
r_goto
id|__nexti
suffix:semicolon
r_if
c_cond
(paren
id|subdevice
OL
l_int|0
op_logical_or
(paren
id|subdevice
op_ge
l_int|0
op_logical_and
id|subdevice
op_eq
id|sinput-&gt;number
)paren
)paren
r_break
suffix:semicolon
id|__nexti
suffix:colon
id|list1
op_assign
id|list1-&gt;next
suffix:semicolon
)brace
id|list2
op_assign
id|rmidi-&gt;streams
(braket
id|SNDRV_RAWMIDI_STREAM_OUTPUT
)braket
dot
id|substreams.next
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|list2
op_eq
op_amp
id|rmidi-&gt;streams
(braket
id|SNDRV_RAWMIDI_STREAM_OUTPUT
)braket
dot
id|substreams
)paren
(brace
id|soutput
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_amp
id|SNDRV_RAWMIDI_LFLG_OUTPUT
)paren
(brace
id|err
op_assign
op_minus
id|EAGAIN
suffix:semicolon
r_goto
id|__error
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
id|soutput
op_assign
id|list_entry
c_func
(paren
id|list2
comma
id|snd_rawmidi_substream_t
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_amp
id|SNDRV_RAWMIDI_LFLG_OUTPUT
)paren
(brace
r_if
c_cond
(paren
id|mode
op_amp
id|SNDRV_RAWMIDI_LFLG_APPEND
)paren
(brace
r_if
c_cond
(paren
id|soutput-&gt;opened
op_logical_and
op_logical_neg
id|soutput-&gt;append
)paren
r_goto
id|__nexto
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|soutput-&gt;opened
)paren
r_goto
id|__nexto
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|subdevice
OL
l_int|0
op_logical_or
(paren
id|subdevice
op_ge
l_int|0
op_logical_and
id|subdevice
op_eq
id|soutput-&gt;number
)paren
)paren
r_break
suffix:semicolon
id|__nexto
suffix:colon
id|list2
op_assign
id|list2-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mode
op_amp
id|SNDRV_RAWMIDI_LFLG_INPUT
)paren
(brace
id|input
op_assign
id|snd_kcalloc
c_func
(paren
r_sizeof
(paren
id|snd_rawmidi_runtime_t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|input
op_eq
l_int|NULL
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|__error
suffix:semicolon
)brace
id|sinput-&gt;runtime
op_assign
id|input
suffix:semicolon
r_if
c_cond
(paren
id|snd_rawmidi_init
c_func
(paren
id|sinput
)paren
OL
l_int|0
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|__error
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|sinput-&gt;ops
op_member_access_from_pointer
id|open
c_func
(paren
id|sinput
)paren
)paren
OL
l_int|0
)paren
(brace
id|sinput-&gt;runtime
op_assign
l_int|NULL
suffix:semicolon
r_goto
id|__error
suffix:semicolon
)brace
id|sinput-&gt;opened
op_assign
l_int|1
suffix:semicolon
id|rmidi-&gt;streams
(braket
id|SNDRV_RAWMIDI_STREAM_INPUT
)braket
dot
id|substream_opened
op_increment
suffix:semicolon
)brace
r_else
(brace
id|sinput
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mode
op_amp
id|SNDRV_RAWMIDI_LFLG_OUTPUT
)paren
(brace
r_if
c_cond
(paren
id|soutput-&gt;opened
)paren
r_goto
id|__skip_output
suffix:semicolon
id|output
op_assign
id|snd_kcalloc
c_func
(paren
r_sizeof
(paren
id|snd_rawmidi_runtime_t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|output
op_eq
l_int|NULL
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|__error
suffix:semicolon
)brace
id|soutput-&gt;runtime
op_assign
id|output
suffix:semicolon
r_if
c_cond
(paren
id|snd_rawmidi_init
c_func
(paren
id|soutput
)paren
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|mode
op_amp
id|SNDRV_RAWMIDI_LFLG_INPUT
)paren
(brace
id|sinput-&gt;ops
op_member_access_from_pointer
id|close
c_func
(paren
id|sinput
)paren
suffix:semicolon
id|sinput-&gt;runtime
op_assign
l_int|NULL
suffix:semicolon
)brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|__error
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|soutput-&gt;ops
op_member_access_from_pointer
id|open
c_func
(paren
id|soutput
)paren
)paren
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|mode
op_amp
id|SNDRV_RAWMIDI_LFLG_INPUT
)paren
(brace
id|sinput-&gt;ops
op_member_access_from_pointer
id|close
c_func
(paren
id|sinput
)paren
suffix:semicolon
id|sinput-&gt;runtime
op_assign
l_int|NULL
suffix:semicolon
)brace
id|soutput-&gt;runtime
op_assign
l_int|NULL
suffix:semicolon
r_goto
id|__error
suffix:semicolon
)brace
id|__skip_output
suffix:colon
id|soutput-&gt;opened
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|mode
op_amp
id|SNDRV_RAWMIDI_LFLG_APPEND
)paren
id|soutput-&gt;append
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|soutput-&gt;use_count
op_increment
op_eq
l_int|0
)paren
id|soutput-&gt;active_sensing
op_assign
l_int|1
suffix:semicolon
id|rmidi-&gt;streams
(braket
id|SNDRV_RAWMIDI_STREAM_OUTPUT
)braket
dot
id|substream_opened
op_increment
suffix:semicolon
)brace
r_else
(brace
id|soutput
op_assign
l_int|NULL
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|rmidi-&gt;open_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rfile
)paren
(brace
id|rfile-&gt;rmidi
op_assign
id|rmidi
suffix:semicolon
id|rfile-&gt;input
op_assign
id|sinput
suffix:semicolon
id|rfile-&gt;output
op_assign
id|soutput
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
id|__error
suffix:colon
r_if
c_cond
(paren
id|input
op_ne
l_int|NULL
)paren
id|kfree
c_func
(paren
id|input
)paren
suffix:semicolon
r_if
c_cond
(paren
id|output
op_ne
l_int|NULL
)paren
id|kfree
c_func
(paren
id|output
)paren
suffix:semicolon
id|dec_mod_count
c_func
(paren
id|rmidi-&gt;card-&gt;module
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|rmidi-&gt;open_mutex
)paren
suffix:semicolon
id|__error1
suffix:colon
macro_line|#ifdef LINUX_2_2
id|MOD_DEC_USE_COUNT
suffix:semicolon
macro_line|#endif
r_return
id|err
suffix:semicolon
)brace
DECL|function|snd_rawmidi_open
r_static
r_int
id|snd_rawmidi_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|maj
op_assign
id|major
c_func
(paren
id|inode-&gt;i_rdev
)paren
suffix:semicolon
r_int
id|cardnum
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
r_int
id|device
comma
id|subdevice
suffix:semicolon
r_int
r_int
id|fflags
suffix:semicolon
r_int
id|err
suffix:semicolon
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
id|snd_rawmidi_file_t
op_star
id|rawmidi_file
suffix:semicolon
id|wait_queue_t
id|wait
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
id|snd_ctl_file_t
op_star
id|kctl
suffix:semicolon
r_switch
c_cond
(paren
id|maj
)paren
(brace
r_case
id|CONFIG_SND_MAJOR
suffix:colon
id|cardnum
op_assign
id|SNDRV_MINOR_CARD
c_func
(paren
id|minor
c_func
(paren
id|inode-&gt;i_rdev
)paren
)paren
suffix:semicolon
id|cardnum
op_mod_assign
id|SNDRV_CARDS
suffix:semicolon
id|device
op_assign
id|SNDRV_MINOR_DEVICE
c_func
(paren
id|minor
c_func
(paren
id|inode-&gt;i_rdev
)paren
)paren
op_minus
id|SNDRV_MINOR_RAWMIDI
suffix:semicolon
id|device
op_mod_assign
id|SNDRV_MINOR_RAWMIDIS
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_SND_OSSEMUL
r_case
id|SOUND_MAJOR
suffix:colon
id|cardnum
op_assign
id|SNDRV_MINOR_OSS_CARD
c_func
(paren
id|minor
c_func
(paren
id|inode-&gt;i_rdev
)paren
)paren
suffix:semicolon
id|cardnum
op_mod_assign
id|SNDRV_CARDS
suffix:semicolon
id|device
op_assign
id|SNDRV_MINOR_OSS_DEVICE
c_func
(paren
id|minor
c_func
(paren
id|inode-&gt;i_rdev
)paren
)paren
op_eq
id|SNDRV_MINOR_OSS_MIDI
ques
c_cond
id|snd_midi_map
(braket
id|cardnum
)braket
suffix:colon
id|snd_amidi_map
(braket
id|cardnum
)braket
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
id|rmidi
op_assign
id|snd_rawmidi_devices
(braket
(paren
id|cardnum
op_star
id|SNDRV_RAWMIDI_DEVICES
)paren
op_plus
id|device
)braket
suffix:semicolon
r_if
c_cond
(paren
id|rmidi
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|card
op_assign
id|rmidi-&gt;card
suffix:semicolon
macro_line|#ifdef CONFIG_SND_OSSEMUL
r_if
c_cond
(paren
id|maj
op_eq
id|SOUND_MAJOR
op_logical_and
op_logical_neg
id|rmidi-&gt;ossreg
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
macro_line|#endif
id|fflags
op_assign
id|snd_rawmidi_file_flags
c_func
(paren
id|file
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_APPEND
)paren
op_logical_and
op_logical_neg
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* invalid combination */
r_if
c_cond
(paren
(paren
id|file-&gt;f_flags
op_amp
id|O_APPEND
)paren
op_logical_or
id|maj
op_ne
id|CONFIG_SND_MAJOR
)paren
multiline_comment|/* OSS emul? */
id|fflags
op_or_assign
id|SNDRV_RAWMIDI_LFLG_APPEND
suffix:semicolon
id|rawmidi_file
op_assign
id|snd_magic_kmalloc
c_func
(paren
id|snd_rawmidi_file_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rawmidi_file
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|init_waitqueue_entry
c_func
(paren
op_amp
id|wait
comma
id|current
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|rmidi-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|subdevice
op_assign
op_minus
l_int|1
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|card-&gt;control_rwlock
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|list
comma
op_amp
id|card-&gt;ctl_files
)paren
(brace
id|kctl
op_assign
id|snd_ctl_file
c_func
(paren
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kctl-&gt;pid
op_eq
id|current-&gt;pid
)paren
(brace
id|subdevice
op_assign
id|kctl-&gt;prefer_rawmidi_subdevice
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|read_unlock
c_func
(paren
op_amp
id|card-&gt;control_rwlock
)paren
suffix:semicolon
id|err
op_assign
id|snd_rawmidi_kernel_open
c_func
(paren
id|cardnum
comma
id|device
comma
id|subdevice
comma
id|fflags
comma
id|rawmidi_file
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ge
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
op_minus
id|EAGAIN
)paren
(brace
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|err
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
r_break
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|err
op_assign
op_minus
id|ERESTARTSYS
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_SND_OSSEMUL
r_if
c_cond
(paren
id|rawmidi_file-&gt;input
op_logical_and
id|rawmidi_file-&gt;input-&gt;runtime
)paren
id|rawmidi_file-&gt;input-&gt;runtime-&gt;oss
op_assign
(paren
id|maj
op_eq
id|SOUND_MAJOR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rawmidi_file-&gt;output
op_logical_and
id|rawmidi_file-&gt;output-&gt;runtime
)paren
id|rawmidi_file-&gt;output-&gt;runtime-&gt;oss
op_assign
(paren
id|maj
op_eq
id|SOUND_MAJOR
)paren
suffix:semicolon
macro_line|#endif
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|rmidi-&gt;open_wait
comma
op_amp
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ge
l_int|0
)paren
(brace
id|file-&gt;private_data
op_assign
id|rawmidi_file
suffix:semicolon
)brace
r_else
(brace
id|snd_magic_kfree
c_func
(paren
id|rawmidi_file
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|snd_rawmidi_kernel_release
r_int
id|snd_rawmidi_kernel_release
c_func
(paren
id|snd_rawmidi_file_t
op_star
id|rfile
)paren
(brace
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
id|snd_rawmidi_substream_t
op_star
id|substream
suffix:semicolon
id|snd_rawmidi_runtime_t
op_star
id|runtime
suffix:semicolon
id|snd_assert
c_func
(paren
id|rfile
op_ne
l_int|NULL
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|rfile-&gt;input
op_ne
l_int|NULL
op_logical_or
id|rfile-&gt;output
op_ne
l_int|NULL
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|rmidi
op_assign
id|rfile-&gt;rmidi
suffix:semicolon
id|down
c_func
(paren
op_amp
id|rmidi-&gt;open_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rfile-&gt;input
op_ne
l_int|NULL
)paren
(brace
id|substream
op_assign
id|rfile-&gt;input
suffix:semicolon
id|rfile-&gt;input
op_assign
l_int|NULL
suffix:semicolon
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|runtime-&gt;trigger
op_assign
l_int|0
suffix:semicolon
id|substream-&gt;ops
op_member_access_from_pointer
id|trigger
c_func
(paren
id|substream
comma
l_int|0
)paren
suffix:semicolon
id|substream-&gt;ops
op_member_access_from_pointer
id|close
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_rawmidi_done_buffer
c_func
(paren
id|runtime
)paren
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;private_free
op_ne
l_int|NULL
)paren
id|runtime
op_member_access_from_pointer
id|private_free
c_func
(paren
id|substream
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|runtime
)paren
suffix:semicolon
id|substream-&gt;runtime
op_assign
l_int|NULL
suffix:semicolon
id|substream-&gt;opened
op_assign
l_int|0
suffix:semicolon
id|rmidi-&gt;streams
(braket
id|SNDRV_RAWMIDI_STREAM_INPUT
)braket
dot
id|substream_opened
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rfile-&gt;output
op_ne
l_int|NULL
)paren
(brace
id|substream
op_assign
id|rfile-&gt;output
suffix:semicolon
id|rfile-&gt;output
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|substream-&gt;use_count
op_eq
l_int|0
)paren
(brace
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_if
c_cond
(paren
id|substream-&gt;active_sensing
)paren
(brace
r_int
r_char
id|buf
op_assign
l_int|0xfe
suffix:semicolon
multiline_comment|/* sending single active sensing message to shut the device up */
id|snd_rawmidi_kernel_write
c_func
(paren
id|substream
comma
op_amp
id|buf
comma
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|snd_rawmidi_drain_output
c_func
(paren
id|substream
)paren
op_eq
op_minus
id|ERESTARTSYS
)paren
id|substream-&gt;ops
op_member_access_from_pointer
id|trigger
c_func
(paren
id|substream
comma
l_int|0
)paren
suffix:semicolon
id|substream-&gt;ops
op_member_access_from_pointer
id|close
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_rawmidi_done_buffer
c_func
(paren
id|runtime
)paren
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;private_free
op_ne
l_int|NULL
)paren
id|runtime
op_member_access_from_pointer
id|private_free
c_func
(paren
id|substream
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|runtime
)paren
suffix:semicolon
id|substream-&gt;runtime
op_assign
l_int|NULL
suffix:semicolon
id|substream-&gt;opened
op_assign
l_int|0
suffix:semicolon
id|substream-&gt;append
op_assign
l_int|0
suffix:semicolon
)brace
id|rmidi-&gt;streams
(braket
id|SNDRV_RAWMIDI_STREAM_OUTPUT
)braket
dot
id|substream_opened
op_decrement
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|rmidi-&gt;open_mutex
)paren
suffix:semicolon
id|dec_mod_count
c_func
(paren
id|rmidi-&gt;card-&gt;module
)paren
suffix:semicolon
macro_line|#ifdef LINUX_2_2
id|MOD_DEC_USE_COUNT
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_rawmidi_release
r_static
r_int
id|snd_rawmidi_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
id|snd_rawmidi_file_t
op_star
id|rfile
suffix:semicolon
r_int
id|err
suffix:semicolon
id|rfile
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_rawmidi_file_t
comma
id|file-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|err
op_assign
id|snd_rawmidi_kernel_release
c_func
(paren
id|rfile
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|rfile-&gt;rmidi-&gt;open_wait
)paren
suffix:semicolon
id|snd_magic_kfree
c_func
(paren
id|rfile
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|snd_rawmidi_info
r_int
id|snd_rawmidi_info
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
id|snd_rawmidi_info_t
op_star
id|info
)paren
(brace
id|snd_rawmidi_t
op_star
id|rmidi
op_assign
id|substream-&gt;rmidi
suffix:semicolon
id|memset
c_func
(paren
id|info
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|info
)paren
)paren
suffix:semicolon
id|info-&gt;card
op_assign
id|rmidi-&gt;card-&gt;number
suffix:semicolon
id|info-&gt;device
op_assign
id|rmidi-&gt;device
suffix:semicolon
id|info-&gt;subdevice
op_assign
id|substream-&gt;number
suffix:semicolon
id|info-&gt;stream
op_assign
id|substream-&gt;stream
suffix:semicolon
id|info-&gt;flags
op_assign
id|rmidi-&gt;info_flags
suffix:semicolon
id|strcpy
c_func
(paren
id|info-&gt;id
comma
id|rmidi-&gt;id
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|info-&gt;name
comma
id|rmidi-&gt;name
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|info-&gt;subname
comma
id|substream-&gt;name
)paren
suffix:semicolon
id|info-&gt;subdevices_count
op_assign
id|substream-&gt;pstr-&gt;substream_count
suffix:semicolon
id|info-&gt;subdevices_avail
op_assign
(paren
id|substream-&gt;pstr-&gt;substream_count
op_minus
id|substream-&gt;pstr-&gt;substream_opened
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_rawmidi_info_user
r_static
r_int
id|snd_rawmidi_info_user
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
id|snd_rawmidi_info_t
op_star
id|_info
)paren
(brace
id|snd_rawmidi_info_t
id|info
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_rawmidi_info
c_func
(paren
id|substream
comma
op_amp
id|info
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|_info
comma
op_amp
id|info
comma
r_sizeof
(paren
id|snd_rawmidi_info_t
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_rawmidi_info_select
r_int
id|snd_rawmidi_info_select
c_func
(paren
id|snd_card_t
op_star
id|card
comma
id|snd_rawmidi_info_t
op_star
id|info
)paren
(brace
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
id|snd_rawmidi_str_t
op_star
id|pstr
suffix:semicolon
id|snd_rawmidi_substream_t
op_star
id|substream
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;device
op_ge
id|SNDRV_RAWMIDI_DEVICES
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|rmidi
op_assign
id|snd_rawmidi_devices
(braket
id|card-&gt;number
op_star
id|SNDRV_RAWMIDI_DEVICES
op_plus
id|info-&gt;device
)braket
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;stream
template_param
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|pstr
op_assign
op_amp
id|rmidi-&gt;streams
(braket
id|info-&gt;stream
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pstr-&gt;substream_count
op_eq
l_int|0
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;subdevice
op_ge
id|pstr-&gt;substream_count
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|list_for_each
c_func
(paren
id|list
comma
op_amp
id|pstr-&gt;substreams
)paren
(brace
id|substream
op_assign
id|list_entry
c_func
(paren
id|list
comma
id|snd_rawmidi_substream_t
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|substream-&gt;number
op_eq
id|info-&gt;subdevice
)paren
r_return
id|snd_rawmidi_info
c_func
(paren
id|substream
comma
id|info
)paren
suffix:semicolon
)brace
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
DECL|function|snd_rawmidi_info_select_user
r_static
r_int
id|snd_rawmidi_info_select_user
c_func
(paren
id|snd_card_t
op_star
id|card
comma
id|snd_rawmidi_info_t
op_star
id|_info
)paren
(brace
r_int
id|err
suffix:semicolon
id|snd_rawmidi_info_t
id|info
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|info.device
comma
op_amp
id|_info-&gt;device
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|info.stream
comma
op_amp
id|_info-&gt;stream
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|info.subdevice
comma
op_amp
id|_info-&gt;subdevice
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_rawmidi_info_select
c_func
(paren
id|card
comma
op_amp
id|info
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|_info
comma
op_amp
id|info
comma
r_sizeof
(paren
id|snd_rawmidi_info_t
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_rawmidi_output_params
r_int
id|snd_rawmidi_output_params
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
id|snd_rawmidi_params_t
op_star
id|params
)paren
(brace
r_char
op_star
id|newbuf
suffix:semicolon
id|snd_rawmidi_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_if
c_cond
(paren
id|substream-&gt;append
op_logical_and
id|substream-&gt;use_count
OG
l_int|1
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|snd_rawmidi_drain_output
c_func
(paren
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|params-&gt;buffer_size
template_param
l_int|1024L
op_star
l_int|1024L
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|params-&gt;avail_min
template_param
id|params-&gt;buffer_size
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|params-&gt;buffer_size
op_ne
id|runtime-&gt;buffer_size
)paren
(brace
r_if
c_cond
(paren
(paren
id|newbuf
op_assign
(paren
r_char
op_star
)paren
id|kmalloc
c_func
(paren
id|params-&gt;buffer_size
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|kfree
c_func
(paren
id|runtime-&gt;buffer
)paren
suffix:semicolon
id|runtime-&gt;buffer
op_assign
id|newbuf
suffix:semicolon
id|runtime-&gt;buffer_size
op_assign
id|params-&gt;buffer_size
suffix:semicolon
)brace
id|runtime-&gt;avail_min
op_assign
id|params-&gt;avail_min
suffix:semicolon
id|substream-&gt;active_sensing
op_assign
op_logical_neg
id|params-&gt;no_active_sensing
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_rawmidi_input_params
r_int
id|snd_rawmidi_input_params
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
id|snd_rawmidi_params_t
op_star
id|params
)paren
(brace
r_char
op_star
id|newbuf
suffix:semicolon
id|snd_rawmidi_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_rawmidi_drain_input
c_func
(paren
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|params-&gt;buffer_size
template_param
l_int|1024L
op_star
l_int|1024L
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|params-&gt;avail_min
template_param
id|params-&gt;buffer_size
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|params-&gt;buffer_size
op_ne
id|runtime-&gt;buffer_size
)paren
(brace
r_if
c_cond
(paren
(paren
id|newbuf
op_assign
(paren
r_char
op_star
)paren
id|kmalloc
c_func
(paren
id|params-&gt;buffer_size
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|kfree
c_func
(paren
id|runtime-&gt;buffer
)paren
suffix:semicolon
id|runtime-&gt;buffer
op_assign
id|newbuf
suffix:semicolon
id|runtime-&gt;buffer_size
op_assign
id|params-&gt;buffer_size
suffix:semicolon
)brace
id|runtime-&gt;avail_min
op_assign
id|params-&gt;avail_min
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_rawmidi_output_status
r_static
r_int
id|snd_rawmidi_output_status
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
id|snd_rawmidi_status_t
op_star
id|status
)paren
(brace
id|snd_rawmidi_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|memset
c_func
(paren
id|status
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|status
)paren
)paren
suffix:semicolon
id|status-&gt;stream
op_assign
id|SNDRV_RAWMIDI_STREAM_OUTPUT
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
id|status-&gt;avail
op_assign
id|runtime-&gt;avail
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_rawmidi_input_status
r_static
r_int
id|snd_rawmidi_input_status
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
id|snd_rawmidi_status_t
op_star
id|status
)paren
(brace
id|snd_rawmidi_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|memset
c_func
(paren
id|status
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|status
)paren
)paren
suffix:semicolon
id|status-&gt;stream
op_assign
id|SNDRV_RAWMIDI_STREAM_INPUT
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
id|status-&gt;avail
op_assign
id|runtime-&gt;avail
suffix:semicolon
id|status-&gt;xruns
op_assign
id|runtime-&gt;xruns
suffix:semicolon
id|runtime-&gt;xruns
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_rawmidi_ioctl
r_static
r_int
id|snd_rawmidi_ioctl
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
id|snd_rawmidi_file_t
op_star
id|rfile
suffix:semicolon
id|rfile
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_rawmidi_file_t
comma
id|file-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|cmd
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
op_ne
l_char|&squot;W&squot;
)paren
r_return
op_minus
id|ENOTTY
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_RAWMIDI_IOCTL_PVERSION
suffix:colon
r_return
id|put_user
c_func
(paren
id|SNDRV_RAWMIDI_VERSION
comma
(paren
r_int
op_star
)paren
id|arg
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
r_case
id|SNDRV_RAWMIDI_IOCTL_INFO
suffix:colon
(brace
id|snd_rawmidi_stream_t
id|stream
suffix:semicolon
id|snd_rawmidi_info_t
op_star
id|info
op_assign
(paren
id|snd_rawmidi_info_t
op_star
)paren
id|arg
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|stream
comma
op_amp
id|info-&gt;stream
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|stream
)paren
(brace
r_case
id|SNDRV_RAWMIDI_STREAM_INPUT
suffix:colon
r_return
id|snd_rawmidi_info_user
c_func
(paren
id|rfile-&gt;input
comma
id|info
)paren
suffix:semicolon
r_case
id|SNDRV_RAWMIDI_STREAM_OUTPUT
suffix:colon
r_return
id|snd_rawmidi_info_user
c_func
(paren
id|rfile-&gt;output
comma
id|info
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_case
id|SNDRV_RAWMIDI_IOCTL_PARAMS
suffix:colon
(brace
id|snd_rawmidi_params_t
id|params
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|params
comma
(paren
id|snd_rawmidi_params_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|snd_rawmidi_params_t
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|params.stream
)paren
(brace
r_case
id|SNDRV_RAWMIDI_STREAM_OUTPUT
suffix:colon
r_if
c_cond
(paren
id|rfile-&gt;output
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|snd_rawmidi_output_params
c_func
(paren
id|rfile-&gt;output
comma
op_amp
id|params
)paren
suffix:semicolon
r_case
id|SNDRV_RAWMIDI_STREAM_INPUT
suffix:colon
r_if
c_cond
(paren
id|rfile-&gt;input
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|snd_rawmidi_input_params
c_func
(paren
id|rfile-&gt;input
comma
op_amp
id|params
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
id|snd_rawmidi_params_t
op_star
)paren
id|arg
comma
op_amp
id|params
comma
r_sizeof
(paren
id|snd_rawmidi_params_t
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_case
id|SNDRV_RAWMIDI_IOCTL_STATUS
suffix:colon
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|snd_rawmidi_status_t
id|status
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|status
comma
(paren
id|snd_rawmidi_status_t
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|snd_rawmidi_status_t
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|status.stream
)paren
(brace
r_case
id|SNDRV_RAWMIDI_STREAM_OUTPUT
suffix:colon
r_if
c_cond
(paren
id|rfile-&gt;output
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|err
op_assign
id|snd_rawmidi_output_status
c_func
(paren
id|rfile-&gt;output
comma
op_amp
id|status
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_RAWMIDI_STREAM_INPUT
suffix:colon
r_if
c_cond
(paren
id|rfile-&gt;input
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|err
op_assign
id|snd_rawmidi_input_status
c_func
(paren
id|rfile-&gt;input
comma
op_amp
id|status
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
id|snd_rawmidi_status_t
op_star
)paren
id|arg
comma
op_amp
id|status
comma
r_sizeof
(paren
id|snd_rawmidi_status_t
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|SNDRV_RAWMIDI_IOCTL_DROP
suffix:colon
(brace
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
id|SNDRV_RAWMIDI_STREAM_OUTPUT
suffix:colon
r_if
c_cond
(paren
id|rfile-&gt;output
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|snd_rawmidi_drop_output
c_func
(paren
id|rfile-&gt;output
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_case
id|SNDRV_RAWMIDI_IOCTL_DRAIN
suffix:colon
(brace
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
id|SNDRV_RAWMIDI_STREAM_OUTPUT
suffix:colon
r_if
c_cond
(paren
id|rfile-&gt;output
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|snd_rawmidi_drain_output
c_func
(paren
id|rfile-&gt;output
)paren
suffix:semicolon
r_case
id|SNDRV_RAWMIDI_STREAM_INPUT
suffix:colon
r_if
c_cond
(paren
id|rfile-&gt;input
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|snd_rawmidi_drain_input
c_func
(paren
id|rfile-&gt;input
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_SND_DEBUG
r_default
suffix:colon
id|snd_printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;rawmidi: unknown command = 0x%x&bslash;n&quot;
comma
id|cmd
)paren
suffix:semicolon
macro_line|#endif
)brace
r_return
op_minus
id|ENOTTY
suffix:semicolon
)brace
DECL|function|snd_rawmidi_control_ioctl
r_int
id|snd_rawmidi_control_ioctl
c_func
(paren
id|snd_card_t
op_star
id|card
comma
id|snd_ctl_file_t
op_star
id|control
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
id|tmp
op_assign
id|card-&gt;number
op_star
id|SNDRV_RAWMIDI_DEVICES
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_CTL_IOCTL_RAWMIDI_NEXT_DEVICE
suffix:colon
(brace
r_int
id|device
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|device
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|device
op_assign
id|device
OL
l_int|0
ques
c_cond
l_int|0
suffix:colon
id|device
op_plus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|device
OL
id|SNDRV_RAWMIDI_DEVICES
)paren
(brace
r_if
c_cond
(paren
id|snd_rawmidi_devices
(braket
id|tmp
op_plus
id|device
)braket
)paren
r_break
suffix:semicolon
id|device
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|device
op_eq
id|SNDRV_RAWMIDI_DEVICES
)paren
id|device
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|device
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|SNDRV_CTL_IOCTL_RAWMIDI_PREFER_SUBDEVICE
suffix:colon
(brace
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|val
comma
(paren
r_int
op_star
)paren
id|arg
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|control-&gt;prefer_rawmidi_subdevice
op_assign
id|val
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|SNDRV_CTL_IOCTL_RAWMIDI_INFO
suffix:colon
r_return
id|snd_rawmidi_info_select_user
c_func
(paren
id|card
comma
(paren
id|snd_rawmidi_info_t
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
DECL|function|snd_rawmidi_receive_reset
r_void
id|snd_rawmidi_receive_reset
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
multiline_comment|/* TODO: reset current state */
)brace
DECL|function|snd_rawmidi_receive
r_int
id|snd_rawmidi_receive
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
r_int
r_char
op_star
id|buffer
comma
r_int
id|count
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|result
op_assign
l_int|0
comma
id|count1
suffix:semicolon
id|snd_rawmidi_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;buffer
op_eq
l_int|NULL
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;snd_rawmidi_receive: input is not active!!!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|runtime-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
op_eq
l_int|1
)paren
(brace
multiline_comment|/* special case, faster code */
id|substream-&gt;bytes
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;avail
OL
id|runtime-&gt;buffer_size
)paren
(brace
id|runtime-&gt;buffer
(braket
id|runtime-&gt;hw_ptr
op_increment
)braket
op_assign
id|buffer
(braket
l_int|0
)braket
suffix:semicolon
id|runtime-&gt;hw_ptr
op_mod_assign
id|runtime-&gt;buffer_size
suffix:semicolon
id|runtime-&gt;avail
op_increment
suffix:semicolon
id|result
op_increment
suffix:semicolon
)brace
r_else
(brace
id|runtime-&gt;xruns
op_increment
suffix:semicolon
)brace
)brace
r_else
(brace
id|substream-&gt;bytes
op_add_assign
id|count
suffix:semicolon
id|count1
op_assign
id|runtime-&gt;buffer_size
op_minus
id|runtime-&gt;hw_ptr
suffix:semicolon
r_if
c_cond
(paren
id|count1
OG
id|count
)paren
id|count1
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|count1
OG
id|runtime-&gt;buffer_size
op_minus
id|runtime-&gt;avail
)paren
id|count1
op_assign
id|runtime-&gt;buffer_size
op_minus
id|runtime-&gt;avail
suffix:semicolon
id|memcpy
c_func
(paren
id|runtime-&gt;buffer
op_plus
id|runtime-&gt;hw_ptr
comma
id|buffer
comma
id|count1
)paren
suffix:semicolon
id|runtime-&gt;hw_ptr
op_add_assign
id|count1
suffix:semicolon
id|runtime-&gt;hw_ptr
op_mod_assign
id|runtime-&gt;buffer_size
suffix:semicolon
id|runtime-&gt;avail
op_add_assign
id|count1
suffix:semicolon
id|count
op_sub_assign
id|count1
suffix:semicolon
id|result
op_add_assign
id|count1
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
l_int|0
)paren
(brace
id|buffer
op_add_assign
id|count1
suffix:semicolon
id|count1
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|count1
OG
id|runtime-&gt;buffer_size
op_minus
id|runtime-&gt;avail
)paren
(brace
id|count1
op_assign
id|runtime-&gt;buffer_size
op_minus
id|runtime-&gt;avail
suffix:semicolon
id|runtime-&gt;xruns
op_assign
id|count
op_minus
id|count1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count1
OG
l_int|0
)paren
(brace
id|memcpy
c_func
(paren
id|runtime-&gt;buffer
comma
id|buffer
comma
id|count1
)paren
suffix:semicolon
id|runtime-&gt;hw_ptr
op_assign
id|count1
suffix:semicolon
id|runtime-&gt;avail
op_add_assign
id|count1
suffix:semicolon
id|result
op_add_assign
id|count1
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|result
OG
l_int|0
op_logical_and
id|runtime-&gt;event
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|snd_rawmidi_ready
c_func
(paren
id|substream
)paren
)paren
id|wake_up
c_func
(paren
op_amp
id|runtime-&gt;sleep
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|runtime-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OG
l_int|0
op_logical_and
id|runtime-&gt;event
)paren
id|runtime
op_member_access_from_pointer
id|event
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_rawmidi_kernel_read1
r_static
r_int
id|snd_rawmidi_kernel_read1
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
r_int
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|kernel
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|result
op_assign
l_int|0
comma
id|count1
suffix:semicolon
id|snd_rawmidi_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
op_logical_and
id|runtime-&gt;avail
)paren
(brace
id|count1
op_assign
id|runtime-&gt;buffer_size
op_minus
id|runtime-&gt;appl_ptr
suffix:semicolon
r_if
c_cond
(paren
id|count1
OG
id|count
)paren
id|count1
op_assign
id|count
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|runtime-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count1
OG
id|runtime-&gt;avail
)paren
id|count1
op_assign
id|runtime-&gt;avail
suffix:semicolon
r_if
c_cond
(paren
id|kernel
)paren
(brace
id|memcpy
c_func
(paren
id|buf
op_plus
id|result
comma
id|runtime-&gt;buffer
op_plus
id|runtime-&gt;appl_ptr
comma
id|count1
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
op_plus
id|result
comma
id|runtime-&gt;buffer
op_plus
id|runtime-&gt;appl_ptr
comma
id|count1
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|runtime-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|result
OG
l_int|0
ques
c_cond
id|result
suffix:colon
op_minus
id|EFAULT
suffix:semicolon
)brace
)brace
id|runtime-&gt;appl_ptr
op_add_assign
id|count1
suffix:semicolon
id|runtime-&gt;appl_ptr
op_mod_assign
id|runtime-&gt;buffer_size
suffix:semicolon
id|runtime-&gt;avail
op_sub_assign
id|count1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|runtime-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|result
op_add_assign
id|count1
suffix:semicolon
id|count
op_sub_assign
id|count1
suffix:semicolon
)brace
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_rawmidi_kernel_read
r_int
id|snd_rawmidi_kernel_read
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
r_int
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
id|substream-&gt;runtime-&gt;trigger
op_assign
l_int|1
suffix:semicolon
id|substream-&gt;ops
op_member_access_from_pointer
id|trigger
c_func
(paren
id|substream
comma
l_int|1
)paren
suffix:semicolon
r_return
id|snd_rawmidi_kernel_read1
c_func
(paren
id|substream
comma
id|buf
comma
id|count
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|snd_rawmidi_read
r_static
id|ssize_t
id|snd_rawmidi_read
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|offset
)paren
(brace
r_int
id|result
suffix:semicolon
r_int
id|count1
suffix:semicolon
id|snd_rawmidi_file_t
op_star
id|rfile
suffix:semicolon
id|snd_rawmidi_substream_t
op_star
id|substream
suffix:semicolon
id|snd_rawmidi_runtime_t
op_star
id|runtime
suffix:semicolon
id|rfile
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_rawmidi_file_t
comma
id|file-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|substream
op_assign
id|rfile-&gt;input
suffix:semicolon
r_if
c_cond
(paren
id|substream
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|runtime-&gt;trigger
op_assign
l_int|1
suffix:semicolon
id|substream-&gt;ops
op_member_access_from_pointer
id|trigger
c_func
(paren
id|substream
comma
l_int|1
)paren
suffix:semicolon
id|result
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|spin_lock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|snd_rawmidi_ready
c_func
(paren
id|substream
)paren
)paren
(brace
id|wait_queue_t
id|wait
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
r_return
id|result
OG
l_int|0
ques
c_cond
id|result
suffix:colon
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|init_waitqueue_entry
c_func
(paren
op_amp
id|wait
comma
id|current
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|runtime-&gt;sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|schedule
c_func
(paren
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|runtime-&gt;sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
id|result
OG
l_int|0
ques
c_cond
id|result
suffix:colon
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|runtime-&gt;avail
)paren
r_return
id|result
OG
l_int|0
ques
c_cond
id|result
suffix:colon
op_minus
id|EIO
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
id|count1
op_assign
id|snd_rawmidi_kernel_read1
c_func
(paren
id|substream
comma
id|buf
comma
id|count
comma
l_int|0
)paren
suffix:semicolon
id|result
op_add_assign
id|count1
suffix:semicolon
id|buf
op_add_assign
id|count1
suffix:semicolon
id|count
op_sub_assign
id|count1
suffix:semicolon
)brace
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_rawmidi_transmit_reset
r_void
id|snd_rawmidi_transmit_reset
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
multiline_comment|/* TODO: reset current state */
)brace
DECL|function|snd_rawmidi_transmit_empty
r_int
id|snd_rawmidi_transmit_empty
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
id|snd_rawmidi_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|result
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;buffer
op_eq
l_int|NULL
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;snd_rawmidi_transmit_empty: output is not active!!!&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|runtime-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|result
op_assign
id|runtime-&gt;avail
op_ge
id|runtime-&gt;buffer_size
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
id|runtime-&gt;trigger
op_assign
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|runtime-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_rawmidi_transmit_peek
r_int
id|snd_rawmidi_transmit_peek
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
r_int
r_char
op_star
id|buffer
comma
r_int
id|count
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|result
comma
id|count1
suffix:semicolon
id|snd_rawmidi_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;buffer
op_eq
l_int|NULL
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;snd_rawmidi_transmit_peek: output is not active!!!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|result
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|runtime-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;avail
op_ge
id|runtime-&gt;buffer_size
)paren
(brace
multiline_comment|/* warning: lowlevel layer MUST trigger down the hardware */
id|runtime-&gt;trigger
op_assign
l_int|0
suffix:semicolon
r_goto
id|__skip
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count
op_eq
l_int|1
)paren
(brace
multiline_comment|/* special case, faster code */
op_star
id|buffer
op_assign
id|runtime-&gt;buffer
(braket
id|runtime-&gt;hw_ptr
)braket
suffix:semicolon
id|result
op_increment
suffix:semicolon
)brace
r_else
(brace
id|count1
op_assign
id|runtime-&gt;buffer_size
op_minus
id|runtime-&gt;hw_ptr
suffix:semicolon
r_if
c_cond
(paren
id|count1
OG
id|count
)paren
id|count1
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|count1
OG
id|runtime-&gt;buffer_size
op_minus
id|runtime-&gt;avail
)paren
id|count1
op_assign
id|runtime-&gt;buffer_size
op_minus
id|runtime-&gt;avail
suffix:semicolon
id|memcpy
c_func
(paren
id|buffer
comma
id|runtime-&gt;buffer
op_plus
id|runtime-&gt;hw_ptr
comma
id|count1
)paren
suffix:semicolon
id|count
op_sub_assign
id|count1
suffix:semicolon
id|result
op_add_assign
id|count1
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
l_int|0
)paren
id|memcpy
c_func
(paren
id|buffer
op_plus
id|count1
comma
id|runtime-&gt;buffer
comma
id|count
)paren
suffix:semicolon
)brace
id|__skip
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|runtime-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_rawmidi_transmit_ack
r_int
id|snd_rawmidi_transmit_ack
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
r_int
id|count
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|snd_rawmidi_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;buffer
op_eq
l_int|NULL
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;snd_rawmidi_transmit_ack: output is not active!!!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|runtime-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|runtime-&gt;avail
op_plus
id|count
op_le
id|runtime-&gt;buffer_size
comma
)paren
suffix:semicolon
id|runtime-&gt;hw_ptr
op_add_assign
id|count
suffix:semicolon
id|runtime-&gt;hw_ptr
op_mod_assign
id|runtime-&gt;buffer_size
suffix:semicolon
id|runtime-&gt;avail
op_add_assign
id|count
suffix:semicolon
id|substream-&gt;bytes
op_add_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;drain
)paren
id|wake_up
c_func
(paren
op_amp
id|runtime-&gt;sleep
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|count
OG
l_int|0
op_logical_and
id|runtime-&gt;event
op_eq
l_int|NULL
)paren
r_if
c_cond
(paren
id|snd_rawmidi_ready
c_func
(paren
id|substream
)paren
)paren
id|wake_up
c_func
(paren
op_amp
id|runtime-&gt;sleep
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|runtime-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
OG
l_int|0
op_logical_and
id|runtime-&gt;event
)paren
id|runtime
op_member_access_from_pointer
id|event
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
DECL|function|snd_rawmidi_transmit
r_int
id|snd_rawmidi_transmit
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
r_int
r_char
op_star
id|buffer
comma
r_int
id|count
)paren
(brace
id|count
op_assign
id|snd_rawmidi_transmit_peek
c_func
(paren
id|substream
comma
id|buffer
comma
id|count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count
OL
l_int|0
)paren
r_return
id|count
suffix:semicolon
r_return
id|snd_rawmidi_transmit_ack
c_func
(paren
id|substream
comma
id|count
)paren
suffix:semicolon
)brace
DECL|function|snd_rawmidi_kernel_write1
r_static
r_int
id|snd_rawmidi_kernel_write1
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
r_const
r_int
r_char
op_star
id|buf
comma
r_int
id|count
comma
r_int
id|kernel
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|count1
comma
id|result
suffix:semicolon
id|snd_rawmidi_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_assert
c_func
(paren
id|buf
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|runtime-&gt;buffer
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|result
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|runtime-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|substream-&gt;append
)paren
(brace
r_if
c_cond
(paren
id|runtime-&gt;avail
OL
id|count
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|runtime-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|count
OG
l_int|0
op_logical_and
id|runtime-&gt;avail
OG
l_int|0
)paren
(brace
id|count1
op_assign
id|runtime-&gt;buffer_size
op_minus
id|runtime-&gt;appl_ptr
suffix:semicolon
r_if
c_cond
(paren
id|count1
OG
id|count
)paren
id|count1
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|count1
OG
id|runtime-&gt;avail
)paren
id|count1
op_assign
id|runtime-&gt;avail
suffix:semicolon
r_if
c_cond
(paren
id|kernel
)paren
(brace
id|memcpy
c_func
(paren
id|runtime-&gt;buffer
op_plus
id|runtime-&gt;appl_ptr
comma
id|buf
comma
id|count1
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|runtime-&gt;buffer
op_plus
id|runtime-&gt;appl_ptr
comma
id|buf
comma
id|count1
)paren
)paren
(brace
id|result
op_assign
id|result
OG
l_int|0
ques
c_cond
id|result
suffix:colon
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|__end
suffix:semicolon
)brace
)brace
id|runtime-&gt;appl_ptr
op_add_assign
id|count1
suffix:semicolon
id|runtime-&gt;appl_ptr
op_mod_assign
id|runtime-&gt;buffer_size
suffix:semicolon
id|runtime-&gt;avail
op_sub_assign
id|count1
suffix:semicolon
id|result
op_add_assign
id|count1
suffix:semicolon
id|buf
op_add_assign
id|count1
suffix:semicolon
id|count
op_sub_assign
id|count1
suffix:semicolon
)brace
id|__end
suffix:colon
r_if
c_cond
(paren
id|result
OG
l_int|0
)paren
id|runtime-&gt;trigger
op_assign
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|runtime-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|substream-&gt;ops
op_member_access_from_pointer
id|trigger
c_func
(paren
id|substream
comma
l_int|1
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_rawmidi_kernel_write
r_int
id|snd_rawmidi_kernel_write
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
r_const
r_int
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_return
id|snd_rawmidi_kernel_write1
c_func
(paren
id|substream
comma
id|buf
comma
id|count
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|snd_rawmidi_write
r_static
id|ssize_t
id|snd_rawmidi_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
comma
id|loff_t
op_star
id|offset
)paren
(brace
r_int
id|result
comma
id|timeout
suffix:semicolon
r_int
id|count1
suffix:semicolon
id|snd_rawmidi_file_t
op_star
id|rfile
suffix:semicolon
id|snd_rawmidi_runtime_t
op_star
id|runtime
suffix:semicolon
id|snd_rawmidi_substream_t
op_star
id|substream
suffix:semicolon
id|rfile
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_rawmidi_file_t
comma
id|file-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|substream
op_assign
id|rfile-&gt;output
suffix:semicolon
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
multiline_comment|/* we cannot put an atomic message to our buffer */
r_if
c_cond
(paren
id|substream-&gt;append
op_logical_and
id|count
OG
id|runtime-&gt;buffer_size
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|result
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|count
OG
l_int|0
)paren
(brace
id|spin_lock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|snd_rawmidi_ready_append
c_func
(paren
id|substream
comma
id|count
)paren
)paren
(brace
id|wait_queue_t
id|wait
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
(brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
r_return
id|result
OG
l_int|0
ques
c_cond
id|result
suffix:colon
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|init_waitqueue_entry
c_func
(paren
op_amp
id|wait
comma
id|current
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|runtime-&gt;sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|timeout
op_assign
id|schedule_timeout
c_func
(paren
l_int|30
op_star
id|HZ
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|runtime-&gt;sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
id|result
OG
l_int|0
ques
c_cond
id|result
suffix:colon
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|runtime-&gt;avail
op_logical_and
op_logical_neg
id|timeout
)paren
r_return
id|result
OG
l_int|0
ques
c_cond
id|result
suffix:colon
op_minus
id|EIO
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
id|count1
op_assign
id|snd_rawmidi_kernel_write1
c_func
(paren
id|substream
comma
id|buf
comma
id|count
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|count1
OL
l_int|0
)paren
r_continue
suffix:semicolon
id|result
op_add_assign
id|count1
suffix:semicolon
id|buf
op_add_assign
id|count1
suffix:semicolon
r_if
c_cond
(paren
id|count1
OL
id|count
op_logical_and
(paren
id|file-&gt;f_flags
op_amp
id|O_NONBLOCK
)paren
)paren
r_break
suffix:semicolon
id|count
op_sub_assign
id|count1
suffix:semicolon
)brace
r_while
c_loop
(paren
id|file-&gt;f_flags
op_amp
id|O_SYNC
)paren
(brace
id|spin_lock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
r_while
c_loop
(paren
id|runtime-&gt;avail
op_ne
id|runtime-&gt;buffer_size
)paren
(brace
id|wait_queue_t
id|wait
suffix:semicolon
r_int
r_int
id|last_avail
op_assign
id|runtime-&gt;avail
suffix:semicolon
id|init_waitqueue_entry
c_func
(paren
op_amp
id|wait
comma
id|current
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|runtime-&gt;sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|timeout
op_assign
id|schedule_timeout
c_func
(paren
l_int|30
op_star
id|HZ
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|runtime-&gt;sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
id|result
OG
l_int|0
ques
c_cond
id|result
suffix:colon
op_minus
id|ERESTARTSYS
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;avail
op_eq
id|last_avail
op_logical_and
op_logical_neg
id|timeout
)paren
r_return
id|result
OG
l_int|0
ques
c_cond
id|result
suffix:colon
op_minus
id|EIO
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
)brace
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_rawmidi_poll
r_static
r_int
r_int
id|snd_rawmidi_poll
c_func
(paren
r_struct
id|file
op_star
id|file
comma
id|poll_table
op_star
id|wait
)paren
(brace
id|snd_rawmidi_file_t
op_star
id|rfile
suffix:semicolon
id|snd_rawmidi_runtime_t
op_star
id|runtime
suffix:semicolon
r_int
r_int
id|mask
suffix:semicolon
id|rfile
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_rawmidi_file_t
comma
id|file-&gt;private_data
comma
r_return
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rfile-&gt;input
op_ne
l_int|NULL
)paren
(brace
id|runtime
op_assign
id|rfile-&gt;input-&gt;runtime
suffix:semicolon
id|runtime-&gt;trigger
op_assign
l_int|1
suffix:semicolon
id|rfile-&gt;input-&gt;ops
op_member_access_from_pointer
id|trigger
c_func
(paren
id|rfile-&gt;input
comma
l_int|1
)paren
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|runtime-&gt;sleep
comma
id|wait
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rfile-&gt;output
op_ne
l_int|NULL
)paren
(brace
id|runtime
op_assign
id|rfile-&gt;output-&gt;runtime
suffix:semicolon
id|poll_wait
c_func
(paren
id|file
comma
op_amp
id|runtime-&gt;sleep
comma
id|wait
)paren
suffix:semicolon
)brace
id|mask
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rfile-&gt;input
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|snd_rawmidi_ready
c_func
(paren
id|rfile-&gt;input
)paren
)paren
id|mask
op_or_assign
id|POLLIN
op_or
id|POLLRDNORM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rfile-&gt;output
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|snd_rawmidi_ready
c_func
(paren
id|rfile-&gt;output
)paren
)paren
id|mask
op_or_assign
id|POLLOUT
op_or
id|POLLWRNORM
suffix:semicolon
)brace
r_return
id|mask
suffix:semicolon
)brace
multiline_comment|/*&n;&n; */
DECL|function|snd_rawmidi_proc_info_read
r_static
r_void
id|snd_rawmidi_proc_info_read
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
id|snd_rawmidi_substream_t
op_star
id|substream
suffix:semicolon
id|snd_rawmidi_runtime_t
op_star
id|runtime
suffix:semicolon
r_struct
id|list_head
op_star
id|list
suffix:semicolon
id|rmidi
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_rawmidi_t
comma
id|entry-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%s&bslash;n&bslash;n&quot;
comma
id|rmidi-&gt;name
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|rmidi-&gt;open_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rmidi-&gt;info_flags
op_amp
id|SNDRV_RAWMIDI_INFO_OUTPUT
)paren
(brace
id|list_for_each
c_func
(paren
id|list
comma
op_amp
id|rmidi-&gt;streams
(braket
id|SNDRV_RAWMIDI_STREAM_OUTPUT
)braket
dot
id|substreams
)paren
(brace
id|substream
op_assign
id|list_entry
c_func
(paren
id|list
comma
id|snd_rawmidi_substream_t
comma
id|list
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Output %d&bslash;n&quot;
l_string|&quot;  Tx bytes     : %lu&bslash;n&quot;
comma
id|substream-&gt;number
comma
(paren
r_int
r_int
)paren
id|substream-&gt;bytes
)paren
suffix:semicolon
r_if
c_cond
(paren
id|substream-&gt;opened
)paren
(brace
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;  Mode         : %s&bslash;n&quot;
l_string|&quot;  Buffer size  : %lu&bslash;n&quot;
l_string|&quot;  Avail        : %lu&bslash;n&quot;
comma
id|runtime-&gt;oss
ques
c_cond
l_string|&quot;OSS compatible&quot;
suffix:colon
l_string|&quot;native&quot;
comma
(paren
r_int
r_int
)paren
id|runtime-&gt;buffer_size
comma
(paren
r_int
r_int
)paren
id|runtime-&gt;avail
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|rmidi-&gt;info_flags
op_amp
id|SNDRV_RAWMIDI_INFO_INPUT
)paren
(brace
id|list_for_each
c_func
(paren
id|list
comma
op_amp
id|rmidi-&gt;streams
(braket
id|SNDRV_RAWMIDI_STREAM_INPUT
)braket
dot
id|substreams
)paren
(brace
id|substream
op_assign
id|list_entry
c_func
(paren
id|list
comma
id|snd_rawmidi_substream_t
comma
id|list
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Input %d&bslash;n&quot;
l_string|&quot;  Rx bytes     : %lu&bslash;n&quot;
comma
id|substream-&gt;number
comma
(paren
r_int
r_int
)paren
id|substream-&gt;bytes
)paren
suffix:semicolon
r_if
c_cond
(paren
id|substream-&gt;opened
)paren
(brace
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;  Buffer size  : %lu&bslash;n&quot;
l_string|&quot;  Avail        : %lu&bslash;n&quot;
l_string|&quot;  Overruns     : %lu&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|runtime-&gt;buffer_size
comma
(paren
r_int
r_int
)paren
id|runtime-&gt;avail
comma
(paren
r_int
r_int
)paren
id|runtime-&gt;xruns
)paren
suffix:semicolon
)brace
)brace
)brace
id|up
c_func
(paren
op_amp
id|rmidi-&gt;open_mutex
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Register functions&n; */
DECL|variable|snd_rawmidi_f_ops
r_static
r_struct
id|file_operations
id|snd_rawmidi_f_ops
op_assign
(brace
macro_line|#ifndef LINUX_2_2
id|owner
suffix:colon
id|THIS_MODULE
comma
macro_line|#endif
id|read
suffix:colon
id|snd_rawmidi_read
comma
id|write
suffix:colon
id|snd_rawmidi_write
comma
id|open
suffix:colon
id|snd_rawmidi_open
comma
id|release
suffix:colon
id|snd_rawmidi_release
comma
id|poll
suffix:colon
id|snd_rawmidi_poll
comma
id|ioctl
suffix:colon
id|snd_rawmidi_ioctl
comma
)brace
suffix:semicolon
DECL|variable|snd_rawmidi_reg
r_static
id|snd_minor_t
id|snd_rawmidi_reg
op_assign
(brace
id|comment
suffix:colon
l_string|&quot;raw midi&quot;
comma
id|f_ops
suffix:colon
op_amp
id|snd_rawmidi_f_ops
comma
)brace
suffix:semicolon
DECL|function|snd_rawmidi_alloc_substreams
r_static
r_int
id|snd_rawmidi_alloc_substreams
c_func
(paren
id|snd_rawmidi_t
op_star
id|rmidi
comma
id|snd_rawmidi_str_t
op_star
id|stream
comma
r_int
id|direction
comma
r_int
id|count
)paren
(brace
id|snd_rawmidi_substream_t
op_star
id|substream
suffix:semicolon
r_int
id|idx
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|stream-&gt;substreams
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|count
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|substream
op_assign
id|snd_kcalloc
c_func
(paren
r_sizeof
(paren
id|snd_rawmidi_substream_t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|substream
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|substream-&gt;stream
op_assign
id|direction
suffix:semicolon
id|substream-&gt;number
op_assign
id|idx
suffix:semicolon
id|substream-&gt;rmidi
op_assign
id|rmidi
suffix:semicolon
id|substream-&gt;pstr
op_assign
id|stream
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|substream-&gt;list
comma
op_amp
id|stream-&gt;substreams
)paren
suffix:semicolon
id|stream-&gt;substream_count
op_increment
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_rawmidi_new
r_int
id|snd_rawmidi_new
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_char
op_star
id|id
comma
r_int
id|device
comma
r_int
id|output_count
comma
r_int
id|input_count
comma
id|snd_rawmidi_t
op_star
op_star
id|rrawmidi
)paren
(brace
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
r_int
id|err
suffix:semicolon
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
id|dev_free
suffix:colon
id|snd_rawmidi_dev_free
comma
id|dev_register
suffix:colon
id|snd_rawmidi_dev_register
comma
id|dev_unregister
suffix:colon
id|snd_rawmidi_dev_unregister
)brace
suffix:semicolon
id|snd_assert
c_func
(paren
id|rrawmidi
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
op_star
id|rrawmidi
op_assign
l_int|NULL
suffix:semicolon
id|snd_assert
c_func
(paren
id|card
op_ne
l_int|NULL
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|rmidi
op_assign
id|snd_magic_kcalloc
c_func
(paren
id|snd_rawmidi_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rmidi
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|rmidi-&gt;card
op_assign
id|card
suffix:semicolon
id|rmidi-&gt;device
op_assign
id|device
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|rmidi-&gt;open_mutex
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|rmidi-&gt;open_wait
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
op_ne
l_int|NULL
)paren
id|strncpy
c_func
(paren
id|rmidi-&gt;id
comma
id|id
comma
r_sizeof
(paren
id|rmidi-&gt;id
)paren
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_rawmidi_alloc_substreams
c_func
(paren
id|rmidi
comma
op_amp
id|rmidi-&gt;streams
(braket
id|SNDRV_RAWMIDI_STREAM_INPUT
)braket
comma
id|SNDRV_RAWMIDI_STREAM_INPUT
comma
id|input_count
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_rawmidi_free
c_func
(paren
id|rmidi
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_rawmidi_alloc_substreams
c_func
(paren
id|rmidi
comma
op_amp
id|rmidi-&gt;streams
(braket
id|SNDRV_RAWMIDI_STREAM_OUTPUT
)braket
comma
id|SNDRV_RAWMIDI_STREAM_OUTPUT
comma
id|output_count
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_rawmidi_free
c_func
(paren
id|rmidi
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_RAWMIDI
comma
id|rmidi
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_rawmidi_free
c_func
(paren
id|rmidi
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
op_star
id|rrawmidi
op_assign
id|rmidi
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_rawmidi_free_substreams
r_static
r_void
id|snd_rawmidi_free_substreams
c_func
(paren
id|snd_rawmidi_str_t
op_star
id|stream
)paren
(brace
id|snd_rawmidi_substream_t
op_star
id|substream
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|stream-&gt;substreams
)paren
)paren
(brace
id|substream
op_assign
id|list_entry
c_func
(paren
id|stream-&gt;substreams.next
comma
id|snd_rawmidi_substream_t
comma
id|list
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|substream-&gt;list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_rawmidi_free
r_static
r_int
id|snd_rawmidi_free
c_func
(paren
id|snd_rawmidi_t
op_star
id|rmidi
)paren
(brace
id|snd_assert
c_func
(paren
id|rmidi
op_ne
l_int|NULL
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|snd_rawmidi_free_substreams
c_func
(paren
op_amp
id|rmidi-&gt;streams
(braket
id|SNDRV_RAWMIDI_STREAM_INPUT
)braket
)paren
suffix:semicolon
id|snd_rawmidi_free_substreams
c_func
(paren
op_amp
id|rmidi-&gt;streams
(braket
id|SNDRV_RAWMIDI_STREAM_OUTPUT
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rmidi-&gt;private_free
)paren
id|rmidi
op_member_access_from_pointer
id|private_free
c_func
(paren
id|rmidi
)paren
suffix:semicolon
id|snd_magic_kfree
c_func
(paren
id|rmidi
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_rawmidi_dev_free
r_static
r_int
id|snd_rawmidi_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|snd_rawmidi_t
op_star
id|rmidi
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_rawmidi_t
comma
id|device-&gt;device_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_return
id|snd_rawmidi_free
c_func
(paren
id|rmidi
)paren
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_SND_SEQUENCER) || defined(CONFIG_SND_SEQUENCER_MODULE)
DECL|function|snd_rawmidi_dev_seq_free
r_static
r_void
id|snd_rawmidi_dev_seq_free
c_func
(paren
id|snd_seq_device_t
op_star
id|device
)paren
(brace
id|snd_rawmidi_t
op_star
id|rmidi
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_rawmidi_t
comma
id|device-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|rmidi-&gt;seq_dev
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif
DECL|function|snd_rawmidi_dev_register
r_static
r_int
id|snd_rawmidi_dev_register
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
r_int
id|idx
comma
id|err
suffix:semicolon
id|snd_info_entry_t
op_star
id|entry
suffix:semicolon
r_char
id|name
(braket
l_int|16
)braket
suffix:semicolon
id|snd_rawmidi_t
op_star
id|rmidi
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_rawmidi_t
comma
id|device-&gt;device_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rmidi-&gt;device
op_ge
id|SNDRV_RAWMIDI_DEVICES
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|down
c_func
(paren
op_amp
id|register_mutex
)paren
suffix:semicolon
id|idx
op_assign
(paren
id|rmidi-&gt;card-&gt;number
op_star
id|SNDRV_RAWMIDI_DEVICES
)paren
op_plus
id|rmidi-&gt;device
suffix:semicolon
r_if
c_cond
(paren
id|snd_rawmidi_devices
(braket
id|idx
)braket
op_ne
l_int|NULL
)paren
(brace
id|up
c_func
(paren
op_amp
id|register_mutex
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|snd_rawmidi_devices
(braket
id|idx
)braket
op_assign
id|rmidi
suffix:semicolon
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;midiC%iD%i&quot;
comma
id|rmidi-&gt;card-&gt;number
comma
id|rmidi-&gt;device
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_register_device
c_func
(paren
id|SNDRV_DEVICE_TYPE_RAWMIDI
comma
id|rmidi-&gt;card
comma
id|rmidi-&gt;device
comma
op_amp
id|snd_rawmidi_reg
comma
id|name
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;unable to register rawmidi device %i:%i&bslash;n&quot;
comma
id|rmidi-&gt;card-&gt;number
comma
id|rmidi-&gt;device
)paren
suffix:semicolon
id|snd_rawmidi_devices
(braket
id|idx
)braket
op_assign
l_int|NULL
suffix:semicolon
id|up
c_func
(paren
op_amp
id|register_mutex
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rmidi-&gt;ops
op_logical_and
id|rmidi-&gt;ops-&gt;dev_register
op_logical_and
(paren
id|err
op_assign
id|rmidi-&gt;ops
op_member_access_from_pointer
id|dev_register
c_func
(paren
id|rmidi
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_unregister_device
c_func
(paren
id|SNDRV_DEVICE_TYPE_RAWMIDI
comma
id|rmidi-&gt;card
comma
id|rmidi-&gt;device
)paren
suffix:semicolon
id|snd_rawmidi_devices
(braket
id|idx
)braket
op_assign
l_int|NULL
suffix:semicolon
id|up
c_func
(paren
op_amp
id|register_mutex
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SND_OSSEMUL
id|rmidi-&gt;ossreg
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rmidi-&gt;device
op_eq
id|snd_midi_map
(braket
id|rmidi-&gt;card-&gt;number
)braket
)paren
(brace
r_if
c_cond
(paren
id|snd_register_oss_device
c_func
(paren
id|SNDRV_OSS_DEVICE_TYPE_MIDI
comma
id|rmidi-&gt;card
comma
l_int|0
comma
op_amp
id|snd_rawmidi_reg
comma
id|name
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;unable to register OSS rawmidi device %i:%i&bslash;n&quot;
comma
id|rmidi-&gt;card-&gt;number
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|rmidi-&gt;ossreg
op_increment
suffix:semicolon
id|snd_oss_info_register
c_func
(paren
id|SNDRV_OSS_INFO_DEV_MIDI
comma
id|rmidi-&gt;card-&gt;number
comma
id|rmidi-&gt;name
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|rmidi-&gt;device
op_eq
id|snd_amidi_map
(braket
id|rmidi-&gt;card-&gt;number
)braket
)paren
(brace
r_if
c_cond
(paren
id|snd_register_oss_device
c_func
(paren
id|SNDRV_OSS_DEVICE_TYPE_MIDI
comma
id|rmidi-&gt;card
comma
l_int|1
comma
op_amp
id|snd_rawmidi_reg
comma
id|name
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;unable to register OSS rawmidi device %i:%i&bslash;n&quot;
comma
id|rmidi-&gt;card-&gt;number
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|rmidi-&gt;ossreg
op_increment
suffix:semicolon
)brace
)brace
macro_line|#endif
id|up
c_func
(paren
op_amp
id|register_mutex
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;midi%d&quot;
comma
id|rmidi-&gt;device
)paren
suffix:semicolon
id|entry
op_assign
id|snd_info_create_card_entry
c_func
(paren
id|rmidi-&gt;card
comma
id|name
comma
id|rmidi-&gt;card-&gt;proc_root
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
)paren
(brace
id|entry-&gt;content
op_assign
id|SNDRV_INFO_CONTENT_TEXT
suffix:semicolon
id|entry-&gt;private_data
op_assign
id|rmidi
suffix:semicolon
id|entry-&gt;c.text.read_size
op_assign
l_int|1024
suffix:semicolon
id|entry-&gt;c.text.read
op_assign
id|snd_rawmidi_proc_info_read
suffix:semicolon
r_if
c_cond
(paren
id|snd_info_register
c_func
(paren
id|entry
)paren
OL
l_int|0
)paren
(brace
id|snd_info_free_entry
c_func
(paren
id|entry
)paren
suffix:semicolon
id|entry
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|rmidi-&gt;proc_entry
op_assign
id|entry
suffix:semicolon
macro_line|#if defined(CONFIG_SND_SEQUENCER) || defined(CONFIG_SND_SEQUENCER_MODULE)
r_if
c_cond
(paren
op_logical_neg
id|rmidi-&gt;ops
op_logical_or
op_logical_neg
id|rmidi-&gt;ops-&gt;dev_register
)paren
(brace
multiline_comment|/* own registration mechanism */
r_if
c_cond
(paren
id|snd_seq_device_new
c_func
(paren
id|rmidi-&gt;card
comma
id|rmidi-&gt;device
comma
id|SNDRV_SEQ_DEV_ID_MIDISYNTH
comma
l_int|0
comma
op_amp
id|rmidi-&gt;seq_dev
)paren
op_ge
l_int|0
)paren
(brace
id|rmidi-&gt;seq_dev-&gt;private_data
op_assign
id|rmidi
suffix:semicolon
id|rmidi-&gt;seq_dev-&gt;private_free
op_assign
id|snd_rawmidi_dev_seq_free
suffix:semicolon
id|sprintf
c_func
(paren
id|rmidi-&gt;seq_dev-&gt;name
comma
l_string|&quot;MIDI %d-%d&quot;
comma
id|rmidi-&gt;card-&gt;number
comma
id|rmidi-&gt;device
)paren
suffix:semicolon
id|snd_device_register
c_func
(paren
id|rmidi-&gt;card
comma
id|rmidi-&gt;seq_dev
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_rawmidi_dev_unregister
r_static
r_int
id|snd_rawmidi_dev_unregister
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
r_int
id|idx
suffix:semicolon
id|snd_rawmidi_t
op_star
id|rmidi
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_rawmidi_t
comma
id|device-&gt;device_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|rmidi
op_ne
l_int|NULL
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|register_mutex
)paren
suffix:semicolon
id|idx
op_assign
(paren
id|rmidi-&gt;card-&gt;number
op_star
id|SNDRV_RAWMIDI_DEVICES
)paren
op_plus
id|rmidi-&gt;device
suffix:semicolon
r_if
c_cond
(paren
id|snd_rawmidi_devices
(braket
id|idx
)braket
op_ne
id|rmidi
)paren
(brace
id|up
c_func
(paren
op_amp
id|register_mutex
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rmidi-&gt;proc_entry
)paren
(brace
id|snd_info_unregister
c_func
(paren
id|rmidi-&gt;proc_entry
)paren
suffix:semicolon
id|rmidi-&gt;proc_entry
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SND_OSSEMUL
r_if
c_cond
(paren
id|rmidi-&gt;ossreg
)paren
(brace
r_if
c_cond
(paren
id|rmidi-&gt;device
op_eq
id|snd_midi_map
(braket
id|rmidi-&gt;card-&gt;number
)braket
)paren
(brace
id|snd_unregister_oss_device
c_func
(paren
id|SNDRV_OSS_DEVICE_TYPE_MIDI
comma
id|rmidi-&gt;card
comma
l_int|0
)paren
suffix:semicolon
id|snd_oss_info_unregister
c_func
(paren
id|SNDRV_OSS_INFO_DEV_MIDI
comma
id|rmidi-&gt;card-&gt;number
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rmidi-&gt;device
op_eq
id|snd_amidi_map
(braket
id|rmidi-&gt;card-&gt;number
)braket
)paren
id|snd_unregister_oss_device
c_func
(paren
id|SNDRV_OSS_DEVICE_TYPE_MIDI
comma
id|rmidi-&gt;card
comma
l_int|1
)paren
suffix:semicolon
id|rmidi-&gt;ossreg
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|rmidi-&gt;ops
op_logical_and
id|rmidi-&gt;ops-&gt;dev_unregister
)paren
id|rmidi-&gt;ops
op_member_access_from_pointer
id|dev_unregister
c_func
(paren
id|rmidi
)paren
suffix:semicolon
id|snd_unregister_device
c_func
(paren
id|SNDRV_DEVICE_TYPE_RAWMIDI
comma
id|rmidi-&gt;card
comma
id|rmidi-&gt;device
)paren
suffix:semicolon
id|snd_rawmidi_devices
(braket
id|idx
)braket
op_assign
l_int|NULL
suffix:semicolon
id|up
c_func
(paren
op_amp
id|register_mutex
)paren
suffix:semicolon
macro_line|#if defined(CONFIG_SND_SEQUENCER) || defined(CONFIG_SND_SEQUENCER_MODULE)
r_if
c_cond
(paren
id|rmidi-&gt;seq_dev
)paren
(brace
id|snd_device_free
c_func
(paren
id|rmidi-&gt;card
comma
id|rmidi-&gt;seq_dev
)paren
suffix:semicolon
id|rmidi-&gt;seq_dev
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif
r_return
id|snd_rawmidi_free
c_func
(paren
id|rmidi
)paren
suffix:semicolon
)brace
DECL|function|snd_rawmidi_set_ops
r_void
id|snd_rawmidi_set_ops
c_func
(paren
id|snd_rawmidi_t
op_star
id|rmidi
comma
r_int
id|stream
comma
id|snd_rawmidi_ops_t
op_star
id|ops
)paren
(brace
r_struct
id|list_head
op_star
id|list
suffix:semicolon
id|snd_rawmidi_substream_t
op_star
id|substream
suffix:semicolon
id|list_for_each
c_func
(paren
id|list
comma
op_amp
id|rmidi-&gt;streams
(braket
id|stream
)braket
dot
id|substreams
)paren
(brace
id|substream
op_assign
id|list_entry
c_func
(paren
id|list
comma
id|snd_rawmidi_substream_t
comma
id|list
)paren
suffix:semicolon
id|substream-&gt;ops
op_assign
id|ops
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *  ENTRY functions&n; */
DECL|function|alsa_rawmidi_init
r_static
r_int
id|__init
id|alsa_rawmidi_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|snd_ctl_register_ioctl
c_func
(paren
id|snd_rawmidi_control_ioctl
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SND_OSSEMUL
multiline_comment|/* check device map table */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SNDRV_CARDS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|snd_midi_map
(braket
id|i
)braket
OL
l_int|0
op_logical_or
id|snd_midi_map
(braket
id|i
)braket
op_ge
id|SNDRV_RAWMIDI_DEVICES
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;invalid midi_map[%d] = %d&bslash;n&quot;
comma
id|i
comma
id|snd_midi_map
(braket
id|i
)braket
)paren
suffix:semicolon
id|snd_midi_map
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|snd_amidi_map
(braket
id|i
)braket
OL
l_int|0
op_logical_or
id|snd_amidi_map
(braket
id|i
)braket
op_ge
id|SNDRV_RAWMIDI_DEVICES
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;invalid amidi_map[%d] = %d&bslash;n&quot;
comma
id|i
comma
id|snd_amidi_map
(braket
id|i
)braket
)paren
suffix:semicolon
id|snd_amidi_map
(braket
id|i
)braket
op_assign
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_SND_OSSEMUL */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|alsa_rawmidi_exit
r_static
r_void
id|__exit
id|alsa_rawmidi_exit
c_func
(paren
r_void
)paren
(brace
id|snd_ctl_unregister_ioctl
c_func
(paren
id|snd_rawmidi_control_ioctl
)paren
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|alsa_rawmidi_init
)paren
id|module_exit
c_func
(paren
id|alsa_rawmidi_exit
)paren
id|EXPORT_SYMBOL
c_func
(paren
id|snd_rawmidi_output_params
)paren
suffix:semicolon
DECL|variable|EXPORT_SYMBOL
id|EXPORT_SYMBOL
c_func
(paren
id|snd_rawmidi_input_params
)paren
suffix:semicolon
DECL|variable|snd_rawmidi_drop_output
id|EXPORT_SYMBOL
c_func
(paren
id|snd_rawmidi_drop_output
)paren
suffix:semicolon
DECL|variable|snd_rawmidi_drain_output
id|EXPORT_SYMBOL
c_func
(paren
id|snd_rawmidi_drain_output
)paren
suffix:semicolon
DECL|variable|snd_rawmidi_drain_input
id|EXPORT_SYMBOL
c_func
(paren
id|snd_rawmidi_drain_input
)paren
suffix:semicolon
DECL|variable|snd_rawmidi_receive_reset
id|EXPORT_SYMBOL
c_func
(paren
id|snd_rawmidi_receive_reset
)paren
suffix:semicolon
DECL|variable|snd_rawmidi_receive
id|EXPORT_SYMBOL
c_func
(paren
id|snd_rawmidi_receive
)paren
suffix:semicolon
DECL|variable|snd_rawmidi_transmit_reset
id|EXPORT_SYMBOL
c_func
(paren
id|snd_rawmidi_transmit_reset
)paren
suffix:semicolon
DECL|variable|snd_rawmidi_transmit_empty
id|EXPORT_SYMBOL
c_func
(paren
id|snd_rawmidi_transmit_empty
)paren
suffix:semicolon
DECL|variable|snd_rawmidi_transmit_peek
id|EXPORT_SYMBOL
c_func
(paren
id|snd_rawmidi_transmit_peek
)paren
suffix:semicolon
DECL|variable|snd_rawmidi_transmit_ack
id|EXPORT_SYMBOL
c_func
(paren
id|snd_rawmidi_transmit_ack
)paren
suffix:semicolon
DECL|variable|snd_rawmidi_transmit
id|EXPORT_SYMBOL
c_func
(paren
id|snd_rawmidi_transmit
)paren
suffix:semicolon
DECL|variable|snd_rawmidi_new
id|EXPORT_SYMBOL
c_func
(paren
id|snd_rawmidi_new
)paren
suffix:semicolon
DECL|variable|snd_rawmidi_set_ops
id|EXPORT_SYMBOL
c_func
(paren
id|snd_rawmidi_set_ops
)paren
suffix:semicolon
DECL|variable|snd_rawmidi_info
id|EXPORT_SYMBOL
c_func
(paren
id|snd_rawmidi_info
)paren
suffix:semicolon
DECL|variable|snd_rawmidi_info_select
id|EXPORT_SYMBOL
c_func
(paren
id|snd_rawmidi_info_select
)paren
suffix:semicolon
DECL|variable|snd_rawmidi_kernel_open
id|EXPORT_SYMBOL
c_func
(paren
id|snd_rawmidi_kernel_open
)paren
suffix:semicolon
DECL|variable|snd_rawmidi_kernel_release
id|EXPORT_SYMBOL
c_func
(paren
id|snd_rawmidi_kernel_release
)paren
suffix:semicolon
DECL|variable|snd_rawmidi_kernel_read
id|EXPORT_SYMBOL
c_func
(paren
id|snd_rawmidi_kernel_read
)paren
suffix:semicolon
DECL|variable|snd_rawmidi_kernel_write
id|EXPORT_SYMBOL
c_func
(paren
id|snd_rawmidi_kernel_write
)paren
suffix:semicolon
eof
