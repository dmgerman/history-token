multiline_comment|/*&n; *  PCM Plug-In shared (kernel/library) code&n; *  Copyright (c) 1999 by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *  Copyright (c) 2000 by Abramo Bagnara &lt;abramo@alsa-project.org&gt;&n; *&n; *&n; *   This library is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU Library General Public License as&n; *   published by the Free Software Foundation; either version 2 of&n; *   the License, or (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU Library General Public License for more details.&n; *&n; *   You should have received a copy of the GNU Library General Public&n; *   License along with this library; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#if 0
mdefine_line|#define PLUGIN_DEBUG
macro_line|#endif
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/time.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
macro_line|#include &lt;sound/pcm_params.h&gt;
macro_line|#include &quot;pcm_plugin.h&quot;
DECL|macro|snd_pcm_plug_first
mdefine_line|#define snd_pcm_plug_first(plug) ((plug)-&gt;runtime-&gt;oss.plugin_first)
DECL|macro|snd_pcm_plug_last
mdefine_line|#define snd_pcm_plug_last(plug) ((plug)-&gt;runtime-&gt;oss.plugin_last)
DECL|function|snd_pcm_plugin_src_channels_mask
r_static
r_int
id|snd_pcm_plugin_src_channels_mask
c_func
(paren
id|snd_pcm_plugin_t
op_star
id|plugin
comma
id|bitset_t
op_star
id|dst_vmask
comma
id|bitset_t
op_star
op_star
id|src_vmask
)paren
(brace
id|bitset_t
op_star
id|vmask
op_assign
id|plugin-&gt;src_vmask
suffix:semicolon
id|bitset_copy
c_func
(paren
id|vmask
comma
id|dst_vmask
comma
id|plugin-&gt;src_format.channels
)paren
suffix:semicolon
op_star
id|src_vmask
op_assign
id|vmask
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pcm_plugin_dst_channels_mask
r_static
r_int
id|snd_pcm_plugin_dst_channels_mask
c_func
(paren
id|snd_pcm_plugin_t
op_star
id|plugin
comma
id|bitset_t
op_star
id|src_vmask
comma
id|bitset_t
op_star
op_star
id|dst_vmask
)paren
(brace
id|bitset_t
op_star
id|vmask
op_assign
id|plugin-&gt;dst_vmask
suffix:semicolon
id|bitset_copy
c_func
(paren
id|vmask
comma
id|src_vmask
comma
id|plugin-&gt;dst_format.channels
)paren
suffix:semicolon
op_star
id|dst_vmask
op_assign
id|vmask
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  because some cards might have rates &quot;very close&quot;, we ignore&n; *  all &quot;resampling&quot; requests within +-5%&n; */
DECL|function|rate_match
r_static
r_int
id|rate_match
c_func
(paren
r_int
r_int
id|src_rate
comma
r_int
r_int
id|dst_rate
)paren
(brace
r_int
r_int
id|low
op_assign
(paren
id|src_rate
op_star
l_int|95
)paren
op_div
l_int|100
suffix:semicolon
r_int
r_int
id|high
op_assign
(paren
id|src_rate
op_star
l_int|105
)paren
op_div
l_int|100
suffix:semicolon
r_return
id|dst_rate
op_ge
id|low
op_logical_and
id|dst_rate
op_le
id|high
suffix:semicolon
)brace
DECL|function|snd_pcm_plugin_alloc
r_static
r_int
id|snd_pcm_plugin_alloc
c_func
(paren
id|snd_pcm_plugin_t
op_star
id|plugin
comma
id|snd_pcm_uframes_t
id|frames
)paren
(brace
id|snd_pcm_plugin_format_t
op_star
id|format
suffix:semicolon
id|ssize_t
id|width
suffix:semicolon
r_int
id|size
suffix:semicolon
r_int
r_int
id|channel
suffix:semicolon
id|snd_pcm_plugin_channel_t
op_star
id|c
suffix:semicolon
r_if
c_cond
(paren
id|plugin-&gt;stream
op_eq
id|SNDRV_PCM_STREAM_PLAYBACK
)paren
(brace
id|format
op_assign
op_amp
id|plugin-&gt;src_format
suffix:semicolon
)brace
r_else
(brace
id|format
op_assign
op_amp
id|plugin-&gt;dst_format
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|width
op_assign
id|snd_pcm_format_physical_width
c_func
(paren
id|format-&gt;format
)paren
)paren
OL
l_int|0
)paren
r_return
id|width
suffix:semicolon
id|size
op_assign
id|frames
op_star
id|format-&gt;channels
op_star
id|width
suffix:semicolon
id|snd_assert
c_func
(paren
(paren
id|size
op_mod
l_int|8
)paren
op_eq
l_int|0
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|size
op_div_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|plugin-&gt;buf_frames
OL
id|frames
)paren
(brace
r_if
c_cond
(paren
id|plugin-&gt;buf
)paren
id|vfree
c_func
(paren
id|plugin-&gt;buf
)paren
suffix:semicolon
id|plugin-&gt;buf
op_assign
id|vmalloc
c_func
(paren
id|size
)paren
suffix:semicolon
id|plugin-&gt;buf_frames
op_assign
id|frames
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|plugin-&gt;buf
)paren
(brace
id|plugin-&gt;buf_frames
op_assign
l_int|0
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|c
op_assign
id|plugin-&gt;buf_channels
suffix:semicolon
r_if
c_cond
(paren
id|plugin-&gt;access
op_eq
id|SNDRV_PCM_ACCESS_RW_INTERLEAVED
)paren
(brace
r_for
c_loop
(paren
id|channel
op_assign
l_int|0
suffix:semicolon
id|channel
OL
id|format-&gt;channels
suffix:semicolon
id|channel
op_increment
comma
id|c
op_increment
)paren
(brace
id|c-&gt;frames
op_assign
id|frames
suffix:semicolon
id|c-&gt;enabled
op_assign
l_int|1
suffix:semicolon
id|c-&gt;wanted
op_assign
l_int|0
suffix:semicolon
id|c-&gt;area.addr
op_assign
id|plugin-&gt;buf
suffix:semicolon
id|c-&gt;area.first
op_assign
id|channel
op_star
id|width
suffix:semicolon
id|c-&gt;area.step
op_assign
id|format-&gt;channels
op_star
id|width
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|plugin-&gt;access
op_eq
id|SNDRV_PCM_ACCESS_RW_NONINTERLEAVED
)paren
(brace
id|snd_assert
c_func
(paren
(paren
id|size
op_mod
id|format-&gt;channels
)paren
op_eq
l_int|0
comma
)paren
suffix:semicolon
id|size
op_div_assign
id|format-&gt;channels
suffix:semicolon
r_for
c_loop
(paren
id|channel
op_assign
l_int|0
suffix:semicolon
id|channel
OL
id|format-&gt;channels
suffix:semicolon
id|channel
op_increment
comma
id|c
op_increment
)paren
(brace
id|c-&gt;frames
op_assign
id|frames
suffix:semicolon
id|c-&gt;enabled
op_assign
l_int|1
suffix:semicolon
id|c-&gt;wanted
op_assign
l_int|0
suffix:semicolon
id|c-&gt;area.addr
op_assign
id|plugin-&gt;buf
op_plus
(paren
id|channel
op_star
id|size
)paren
suffix:semicolon
id|c-&gt;area.first
op_assign
l_int|0
suffix:semicolon
id|c-&gt;area.step
op_assign
id|width
suffix:semicolon
)brace
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pcm_plug_alloc
r_int
id|snd_pcm_plug_alloc
c_func
(paren
id|snd_pcm_plug_t
op_star
id|plug
comma
id|snd_pcm_uframes_t
id|frames
)paren
(brace
r_int
id|err
suffix:semicolon
id|snd_assert
c_func
(paren
id|snd_pcm_plug_first
c_func
(paren
id|plug
)paren
op_ne
l_int|NULL
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_plug_stream
c_func
(paren
id|plug
)paren
op_eq
id|SNDRV_PCM_STREAM_PLAYBACK
)paren
(brace
id|snd_pcm_plugin_t
op_star
id|plugin
op_assign
id|snd_pcm_plug_first
c_func
(paren
id|plug
)paren
suffix:semicolon
r_while
c_loop
(paren
id|plugin-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|plugin-&gt;dst_frames
)paren
id|frames
op_assign
id|plugin
op_member_access_from_pointer
id|dst_frames
c_func
(paren
id|plugin
comma
id|frames
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|frames
OG
l_int|0
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|plugin
op_assign
id|plugin-&gt;next
suffix:semicolon
id|err
op_assign
id|snd_pcm_plugin_alloc
c_func
(paren
id|plugin
comma
id|frames
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
)brace
r_else
(brace
id|snd_pcm_plugin_t
op_star
id|plugin
op_assign
id|snd_pcm_plug_last
c_func
(paren
id|plug
)paren
suffix:semicolon
r_while
c_loop
(paren
id|plugin-&gt;prev
)paren
(brace
r_if
c_cond
(paren
id|plugin-&gt;src_frames
)paren
id|frames
op_assign
id|plugin
op_member_access_from_pointer
id|src_frames
c_func
(paren
id|plugin
comma
id|frames
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|frames
OG
l_int|0
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|plugin
op_assign
id|plugin-&gt;prev
suffix:semicolon
id|err
op_assign
id|snd_pcm_plugin_alloc
c_func
(paren
id|plugin
comma
id|frames
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pcm_plugin_client_channels
id|snd_pcm_sframes_t
id|snd_pcm_plugin_client_channels
c_func
(paren
id|snd_pcm_plugin_t
op_star
id|plugin
comma
id|snd_pcm_uframes_t
id|frames
comma
id|snd_pcm_plugin_channel_t
op_star
op_star
id|channels
)paren
(brace
op_star
id|channels
op_assign
id|plugin-&gt;buf_channels
suffix:semicolon
r_return
id|frames
suffix:semicolon
)brace
DECL|function|snd_pcm_plugin_build
r_int
id|snd_pcm_plugin_build
c_func
(paren
id|snd_pcm_plug_t
op_star
id|plug
comma
r_const
r_char
op_star
id|name
comma
id|snd_pcm_plugin_format_t
op_star
id|src_format
comma
id|snd_pcm_plugin_format_t
op_star
id|dst_format
comma
r_int
id|extra
comma
id|snd_pcm_plugin_t
op_star
op_star
id|ret
)paren
(brace
id|snd_pcm_plugin_t
op_star
id|plugin
suffix:semicolon
r_int
r_int
id|channels
suffix:semicolon
id|snd_assert
c_func
(paren
id|plug
op_ne
l_int|NULL
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|src_format
op_ne
l_int|NULL
op_logical_and
id|dst_format
op_ne
l_int|NULL
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|plugin
op_assign
(paren
id|snd_pcm_plugin_t
op_star
)paren
id|snd_kcalloc
c_func
(paren
r_sizeof
(paren
op_star
id|plugin
)paren
op_plus
id|extra
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|plugin
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|plugin-&gt;name
op_assign
id|name
suffix:semicolon
id|plugin-&gt;plug
op_assign
id|plug
suffix:semicolon
id|plugin-&gt;stream
op_assign
id|snd_pcm_plug_stream
c_func
(paren
id|plug
)paren
suffix:semicolon
id|plugin-&gt;access
op_assign
id|SNDRV_PCM_ACCESS_RW_INTERLEAVED
suffix:semicolon
id|plugin-&gt;src_format
op_assign
op_star
id|src_format
suffix:semicolon
id|plugin-&gt;src_width
op_assign
id|snd_pcm_format_physical_width
c_func
(paren
id|src_format-&gt;format
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|plugin-&gt;src_width
OG
l_int|0
comma
)paren
suffix:semicolon
id|plugin-&gt;dst_format
op_assign
op_star
id|dst_format
suffix:semicolon
id|plugin-&gt;dst_width
op_assign
id|snd_pcm_format_physical_width
c_func
(paren
id|dst_format-&gt;format
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|plugin-&gt;dst_width
OG
l_int|0
comma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|plugin-&gt;stream
op_eq
id|SNDRV_PCM_STREAM_PLAYBACK
)paren
id|channels
op_assign
id|src_format-&gt;channels
suffix:semicolon
r_else
id|channels
op_assign
id|dst_format-&gt;channels
suffix:semicolon
id|plugin-&gt;buf_channels
op_assign
id|snd_kcalloc
c_func
(paren
id|channels
op_star
r_sizeof
(paren
op_star
id|plugin-&gt;buf_channels
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|plugin-&gt;buf_channels
op_eq
l_int|NULL
)paren
(brace
id|snd_pcm_plugin_free
c_func
(paren
id|plugin
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|plugin-&gt;src_vmask
op_assign
id|bitset_alloc
c_func
(paren
id|src_format-&gt;channels
)paren
suffix:semicolon
r_if
c_cond
(paren
id|plugin-&gt;src_vmask
op_eq
l_int|NULL
)paren
(brace
id|snd_pcm_plugin_free
c_func
(paren
id|plugin
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|plugin-&gt;dst_vmask
op_assign
id|bitset_alloc
c_func
(paren
id|dst_format-&gt;channels
)paren
suffix:semicolon
r_if
c_cond
(paren
id|plugin-&gt;dst_vmask
op_eq
l_int|NULL
)paren
(brace
id|snd_pcm_plugin_free
c_func
(paren
id|plugin
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|plugin-&gt;client_channels
op_assign
id|snd_pcm_plugin_client_channels
suffix:semicolon
id|plugin-&gt;src_channels_mask
op_assign
id|snd_pcm_plugin_src_channels_mask
suffix:semicolon
id|plugin-&gt;dst_channels_mask
op_assign
id|snd_pcm_plugin_dst_channels_mask
suffix:semicolon
op_star
id|ret
op_assign
id|plugin
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pcm_plugin_free
r_int
id|snd_pcm_plugin_free
c_func
(paren
id|snd_pcm_plugin_t
op_star
id|plugin
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|plugin
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|plugin-&gt;private_free
)paren
id|plugin
op_member_access_from_pointer
id|private_free
c_func
(paren
id|plugin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|plugin-&gt;buf_channels
)paren
id|kfree
c_func
(paren
id|plugin-&gt;buf_channels
)paren
suffix:semicolon
r_if
c_cond
(paren
id|plugin-&gt;buf
)paren
id|vfree
c_func
(paren
id|plugin-&gt;buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|plugin-&gt;src_vmask
)paren
id|kfree
c_func
(paren
id|plugin-&gt;src_vmask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|plugin-&gt;dst_vmask
)paren
id|kfree
c_func
(paren
id|plugin-&gt;dst_vmask
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|plugin
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pcm_plug_client_size
id|snd_pcm_sframes_t
id|snd_pcm_plug_client_size
c_func
(paren
id|snd_pcm_plug_t
op_star
id|plug
comma
id|snd_pcm_uframes_t
id|drv_frames
)paren
(brace
id|snd_pcm_plugin_t
op_star
id|plugin
comma
op_star
id|plugin_prev
comma
op_star
id|plugin_next
suffix:semicolon
r_int
id|stream
op_assign
id|snd_pcm_plug_stream
c_func
(paren
id|plug
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|plug
op_ne
l_int|NULL
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|drv_frames
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|stream
op_eq
id|SNDRV_PCM_STREAM_PLAYBACK
)paren
(brace
id|plugin
op_assign
id|snd_pcm_plug_last
c_func
(paren
id|plug
)paren
suffix:semicolon
r_while
c_loop
(paren
id|plugin
op_logical_and
id|drv_frames
OG
l_int|0
)paren
(brace
id|plugin_prev
op_assign
id|plugin-&gt;prev
suffix:semicolon
r_if
c_cond
(paren
id|plugin-&gt;src_frames
)paren
id|drv_frames
op_assign
id|plugin
op_member_access_from_pointer
id|src_frames
c_func
(paren
id|plugin
comma
id|drv_frames
)paren
suffix:semicolon
id|plugin
op_assign
id|plugin_prev
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|stream
op_eq
id|SNDRV_PCM_STREAM_CAPTURE
)paren
(brace
id|plugin
op_assign
id|snd_pcm_plug_first
c_func
(paren
id|plug
)paren
suffix:semicolon
r_while
c_loop
(paren
id|plugin
op_logical_and
id|drv_frames
OG
l_int|0
)paren
(brace
id|plugin_next
op_assign
id|plugin-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|plugin-&gt;dst_frames
)paren
id|drv_frames
op_assign
id|plugin
op_member_access_from_pointer
id|dst_frames
c_func
(paren
id|plugin
comma
id|drv_frames
)paren
suffix:semicolon
id|plugin
op_assign
id|plugin_next
suffix:semicolon
)brace
)brace
r_else
id|snd_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
id|drv_frames
suffix:semicolon
)brace
DECL|function|snd_pcm_plug_slave_size
id|snd_pcm_sframes_t
id|snd_pcm_plug_slave_size
c_func
(paren
id|snd_pcm_plug_t
op_star
id|plug
comma
id|snd_pcm_uframes_t
id|clt_frames
)paren
(brace
id|snd_pcm_plugin_t
op_star
id|plugin
comma
op_star
id|plugin_prev
comma
op_star
id|plugin_next
suffix:semicolon
id|snd_pcm_sframes_t
id|frames
suffix:semicolon
r_int
id|stream
op_assign
id|snd_pcm_plug_stream
c_func
(paren
id|plug
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|plug
op_ne
l_int|NULL
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|clt_frames
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|frames
op_assign
id|clt_frames
suffix:semicolon
r_if
c_cond
(paren
id|stream
op_eq
id|SNDRV_PCM_STREAM_PLAYBACK
)paren
(brace
id|plugin
op_assign
id|snd_pcm_plug_first
c_func
(paren
id|plug
)paren
suffix:semicolon
r_while
c_loop
(paren
id|plugin
op_logical_and
id|frames
OG
l_int|0
)paren
(brace
id|plugin_next
op_assign
id|plugin-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|plugin-&gt;dst_frames
)paren
(brace
id|frames
op_assign
id|plugin
op_member_access_from_pointer
id|dst_frames
c_func
(paren
id|plugin
comma
id|frames
)paren
suffix:semicolon
r_if
c_cond
(paren
id|frames
OL
l_int|0
)paren
r_return
id|frames
suffix:semicolon
)brace
id|plugin
op_assign
id|plugin_next
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|stream
op_eq
id|SNDRV_PCM_STREAM_CAPTURE
)paren
(brace
id|plugin
op_assign
id|snd_pcm_plug_last
c_func
(paren
id|plug
)paren
suffix:semicolon
r_while
c_loop
(paren
id|plugin
)paren
(brace
id|plugin_prev
op_assign
id|plugin-&gt;prev
suffix:semicolon
r_if
c_cond
(paren
id|plugin-&gt;src_frames
)paren
(brace
id|frames
op_assign
id|plugin
op_member_access_from_pointer
id|src_frames
c_func
(paren
id|plugin
comma
id|frames
)paren
suffix:semicolon
r_if
c_cond
(paren
id|frames
OL
l_int|0
)paren
r_return
id|frames
suffix:semicolon
)brace
id|plugin
op_assign
id|plugin_prev
suffix:semicolon
)brace
)brace
r_else
id|snd_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
id|frames
suffix:semicolon
)brace
DECL|function|snd_pcm_plug_formats
r_static
r_int
id|snd_pcm_plug_formats
c_func
(paren
id|snd_mask_t
op_star
id|mask
comma
r_int
id|format
)paren
(brace
id|snd_mask_t
id|formats
op_assign
op_star
id|mask
suffix:semicolon
id|u64
id|linfmts
op_assign
(paren
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S8
op_or
id|SNDRV_PCM_FMTBIT_U16_LE
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
op_or
id|SNDRV_PCM_FMTBIT_U16_BE
op_or
id|SNDRV_PCM_FMTBIT_S16_BE
op_or
id|SNDRV_PCM_FMTBIT_U24_LE
op_or
id|SNDRV_PCM_FMTBIT_S24_LE
op_or
id|SNDRV_PCM_FMTBIT_U24_BE
op_or
id|SNDRV_PCM_FMTBIT_S24_BE
op_or
id|SNDRV_PCM_FMTBIT_U32_LE
op_or
id|SNDRV_PCM_FMTBIT_S32_LE
op_or
id|SNDRV_PCM_FMTBIT_U32_BE
op_or
id|SNDRV_PCM_FMTBIT_S32_BE
)paren
suffix:semicolon
id|snd_mask_set
c_func
(paren
op_amp
id|formats
comma
id|SNDRV_PCM_FORMAT_MU_LAW
)paren
suffix:semicolon
r_if
c_cond
(paren
id|formats.bits
(braket
l_int|0
)braket
op_amp
(paren
id|u32
)paren
id|linfmts
)paren
id|formats.bits
(braket
l_int|0
)braket
op_or_assign
(paren
id|u32
)paren
id|linfmts
suffix:semicolon
r_if
c_cond
(paren
id|formats.bits
(braket
l_int|1
)braket
op_amp
(paren
id|u32
)paren
(paren
id|linfmts
op_rshift
l_int|32
)paren
)paren
id|formats.bits
(braket
l_int|1
)braket
op_or_assign
(paren
id|u32
)paren
(paren
id|linfmts
op_rshift
l_int|32
)paren
suffix:semicolon
r_return
id|snd_mask_test
c_func
(paren
op_amp
id|formats
comma
id|format
)paren
suffix:semicolon
)brace
DECL|variable|preferred_formats
r_static
r_int
id|preferred_formats
(braket
)braket
op_assign
(brace
id|SNDRV_PCM_FORMAT_S16_LE
comma
id|SNDRV_PCM_FORMAT_S16_BE
comma
id|SNDRV_PCM_FORMAT_U16_LE
comma
id|SNDRV_PCM_FORMAT_U16_BE
comma
id|SNDRV_PCM_FORMAT_S24_LE
comma
id|SNDRV_PCM_FORMAT_S24_BE
comma
id|SNDRV_PCM_FORMAT_U24_LE
comma
id|SNDRV_PCM_FORMAT_U24_BE
comma
id|SNDRV_PCM_FORMAT_S32_LE
comma
id|SNDRV_PCM_FORMAT_S32_BE
comma
id|SNDRV_PCM_FORMAT_U32_LE
comma
id|SNDRV_PCM_FORMAT_U32_BE
comma
id|SNDRV_PCM_FORMAT_S8
comma
id|SNDRV_PCM_FORMAT_U8
)brace
suffix:semicolon
DECL|function|snd_pcm_plug_slave_format
r_int
id|snd_pcm_plug_slave_format
c_func
(paren
r_int
id|format
comma
id|snd_mask_t
op_star
id|format_mask
)paren
(brace
r_if
c_cond
(paren
id|snd_mask_test
c_func
(paren
id|format_mask
comma
id|format
)paren
)paren
r_return
id|format
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_pcm_plug_formats
c_func
(paren
id|format_mask
comma
id|format
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_linear
c_func
(paren
id|format
)paren
)paren
(brace
r_int
id|width
op_assign
id|snd_pcm_format_width
c_func
(paren
id|format
)paren
suffix:semicolon
r_int
id|unsignd
op_assign
id|snd_pcm_format_unsigned
c_func
(paren
id|format
)paren
suffix:semicolon
r_int
id|big
op_assign
id|snd_pcm_format_big_endian
c_func
(paren
id|format
)paren
suffix:semicolon
r_int
id|format1
suffix:semicolon
r_int
id|wid
comma
id|width1
op_assign
id|width
suffix:semicolon
r_int
id|dwidth1
op_assign
l_int|8
suffix:semicolon
r_for
c_loop
(paren
id|wid
op_assign
l_int|0
suffix:semicolon
id|wid
OL
l_int|4
suffix:semicolon
op_increment
id|wid
)paren
(brace
r_int
id|end
comma
id|big1
op_assign
id|big
suffix:semicolon
r_for
c_loop
(paren
id|end
op_assign
l_int|0
suffix:semicolon
id|end
OL
l_int|2
suffix:semicolon
op_increment
id|end
)paren
(brace
r_int
id|sgn
comma
id|unsignd1
op_assign
id|unsignd
suffix:semicolon
r_for
c_loop
(paren
id|sgn
op_assign
l_int|0
suffix:semicolon
id|sgn
OL
l_int|2
suffix:semicolon
op_increment
id|sgn
)paren
(brace
id|format1
op_assign
id|snd_pcm_build_linear_format
c_func
(paren
id|width1
comma
id|unsignd1
comma
id|big1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|format1
op_ge
l_int|0
op_logical_and
id|snd_mask_test
c_func
(paren
id|format_mask
comma
id|format1
)paren
)paren
r_goto
id|_found
suffix:semicolon
id|unsignd1
op_assign
op_logical_neg
id|unsignd1
suffix:semicolon
)brace
id|big1
op_assign
op_logical_neg
id|big1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|width1
op_eq
l_int|32
)paren
(brace
id|dwidth1
op_assign
op_minus
id|dwidth1
suffix:semicolon
id|width1
op_assign
id|width
suffix:semicolon
)brace
id|width1
op_add_assign
id|dwidth1
suffix:semicolon
)brace
r_return
op_minus
id|EINVAL
suffix:semicolon
id|_found
suffix:colon
r_return
id|format1
suffix:semicolon
)brace
r_else
(brace
r_int
r_int
id|i
suffix:semicolon
r_switch
c_cond
(paren
id|format
)paren
(brace
r_case
id|SNDRV_PCM_FORMAT_MU_LAW
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|preferred_formats
)paren
op_div
r_sizeof
(paren
id|preferred_formats
(braket
l_int|0
)braket
)paren
suffix:semicolon
op_increment
id|i
)paren
(brace
r_int
id|format1
op_assign
id|preferred_formats
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|snd_mask_test
c_func
(paren
id|format_mask
comma
id|format1
)paren
)paren
r_return
id|format1
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
)brace
DECL|function|snd_pcm_plug_format_plugins
r_int
id|snd_pcm_plug_format_plugins
c_func
(paren
id|snd_pcm_plug_t
op_star
id|plug
comma
id|snd_pcm_hw_params_t
op_star
id|params
comma
id|snd_pcm_hw_params_t
op_star
id|slave_params
)paren
(brace
id|snd_pcm_plugin_format_t
id|tmpformat
suffix:semicolon
id|snd_pcm_plugin_format_t
id|dstformat
suffix:semicolon
id|snd_pcm_plugin_format_t
id|srcformat
suffix:semicolon
r_int
id|src_access
comma
id|dst_access
suffix:semicolon
id|snd_pcm_plugin_t
op_star
id|plugin
op_assign
l_int|NULL
suffix:semicolon
r_int
id|err
comma
id|first
suffix:semicolon
r_int
id|stream
op_assign
id|snd_pcm_plug_stream
c_func
(paren
id|plug
)paren
suffix:semicolon
r_int
id|slave_interleaved
op_assign
(paren
id|params_channels
c_func
(paren
id|slave_params
)paren
op_eq
l_int|1
op_logical_or
id|params_access
c_func
(paren
id|slave_params
)paren
op_eq
id|SNDRV_PCM_ACCESS_RW_INTERLEAVED
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|stream
)paren
(brace
r_case
id|SNDRV_PCM_STREAM_PLAYBACK
suffix:colon
id|dstformat.format
op_assign
id|params_format
c_func
(paren
id|slave_params
)paren
suffix:semicolon
id|dstformat.rate
op_assign
id|params_rate
c_func
(paren
id|slave_params
)paren
suffix:semicolon
id|dstformat.channels
op_assign
id|params_channels
c_func
(paren
id|slave_params
)paren
suffix:semicolon
id|srcformat.format
op_assign
id|params_format
c_func
(paren
id|params
)paren
suffix:semicolon
id|srcformat.rate
op_assign
id|params_rate
c_func
(paren
id|params
)paren
suffix:semicolon
id|srcformat.channels
op_assign
id|params_channels
c_func
(paren
id|params
)paren
suffix:semicolon
id|src_access
op_assign
id|SNDRV_PCM_ACCESS_RW_INTERLEAVED
suffix:semicolon
id|dst_access
op_assign
(paren
id|slave_interleaved
ques
c_cond
id|SNDRV_PCM_ACCESS_RW_INTERLEAVED
suffix:colon
id|SNDRV_PCM_ACCESS_RW_NONINTERLEAVED
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_STREAM_CAPTURE
suffix:colon
id|dstformat.format
op_assign
id|params_format
c_func
(paren
id|params
)paren
suffix:semicolon
id|dstformat.rate
op_assign
id|params_rate
c_func
(paren
id|params
)paren
suffix:semicolon
id|dstformat.channels
op_assign
id|params_channels
c_func
(paren
id|params
)paren
suffix:semicolon
id|srcformat.format
op_assign
id|params_format
c_func
(paren
id|slave_params
)paren
suffix:semicolon
id|srcformat.rate
op_assign
id|params_rate
c_func
(paren
id|slave_params
)paren
suffix:semicolon
id|srcformat.channels
op_assign
id|params_channels
c_func
(paren
id|slave_params
)paren
suffix:semicolon
id|src_access
op_assign
(paren
id|slave_interleaved
ques
c_cond
id|SNDRV_PCM_ACCESS_RW_INTERLEAVED
suffix:colon
id|SNDRV_PCM_ACCESS_RW_NONINTERLEAVED
)paren
suffix:semicolon
id|dst_access
op_assign
id|SNDRV_PCM_ACCESS_RW_INTERLEAVED
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|snd_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|tmpformat
op_assign
id|srcformat
suffix:semicolon
id|pdprintf
c_func
(paren
l_string|&quot;srcformat: format=%i, rate=%i, channels=%i&bslash;n&quot;
comma
id|srcformat.format
comma
id|srcformat.rate
comma
id|srcformat.channels
)paren
suffix:semicolon
id|pdprintf
c_func
(paren
l_string|&quot;dstformat: format=%i, rate=%i, channels=%i&bslash;n&quot;
comma
id|dstformat.format
comma
id|dstformat.rate
comma
id|dstformat.channels
)paren
suffix:semicolon
multiline_comment|/* Format change (linearization) */
r_if
c_cond
(paren
(paren
id|srcformat.format
op_ne
id|dstformat.format
op_logical_or
op_logical_neg
id|rate_match
c_func
(paren
id|srcformat.rate
comma
id|dstformat.rate
)paren
op_logical_or
id|srcformat.channels
op_ne
id|dstformat.channels
)paren
op_logical_and
op_logical_neg
id|snd_pcm_format_linear
c_func
(paren
id|srcformat.format
)paren
)paren
(brace
r_if
c_cond
(paren
id|snd_pcm_format_linear
c_func
(paren
id|dstformat.format
)paren
)paren
id|tmpformat.format
op_assign
id|dstformat.format
suffix:semicolon
r_else
id|tmpformat.format
op_assign
id|SNDRV_PCM_FORMAT_S16
suffix:semicolon
id|first
op_assign
id|plugin
op_eq
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|srcformat.format
)paren
(brace
r_case
id|SNDRV_PCM_FORMAT_MU_LAW
suffix:colon
id|err
op_assign
id|snd_pcm_plugin_build_mulaw
c_func
(paren
id|plug
comma
op_amp
id|srcformat
comma
op_amp
id|tmpformat
comma
op_amp
id|plugin
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|pdprintf
c_func
(paren
l_string|&quot;format change: src=%i, dst=%i returns %i&bslash;n&quot;
comma
id|srcformat.format
comma
id|tmpformat.format
comma
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|err
op_assign
id|snd_pcm_plugin_append
c_func
(paren
id|plugin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_pcm_plugin_free
c_func
(paren
id|plugin
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|srcformat
op_assign
id|tmpformat
suffix:semicolon
id|src_access
op_assign
id|dst_access
suffix:semicolon
)brace
multiline_comment|/* channels reduction */
r_if
c_cond
(paren
id|srcformat.channels
OG
id|dstformat.channels
)paren
(brace
r_int
id|sv
op_assign
id|srcformat.channels
suffix:semicolon
r_int
id|dv
op_assign
id|dstformat.channels
suffix:semicolon
id|route_ttable_entry_t
op_star
id|ttable
op_assign
id|snd_kcalloc
c_func
(paren
id|dv
op_star
id|sv
op_star
r_sizeof
(paren
op_star
id|ttable
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ttable
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
macro_line|#if 1
r_if
c_cond
(paren
id|sv
op_eq
l_int|2
op_logical_and
id|dv
op_eq
l_int|1
)paren
(brace
id|ttable
(braket
l_int|0
)braket
op_assign
id|HALF
suffix:semicolon
id|ttable
(braket
l_int|1
)braket
op_assign
id|HALF
suffix:semicolon
)brace
r_else
macro_line|#endif
(brace
r_int
id|v
suffix:semicolon
r_for
c_loop
(paren
id|v
op_assign
l_int|0
suffix:semicolon
id|v
OL
id|dv
suffix:semicolon
op_increment
id|v
)paren
id|ttable
(braket
id|v
op_star
id|sv
op_plus
id|v
)braket
op_assign
id|FULL
suffix:semicolon
)brace
id|tmpformat.channels
op_assign
id|dstformat.channels
suffix:semicolon
r_if
c_cond
(paren
id|rate_match
c_func
(paren
id|srcformat.rate
comma
id|dstformat.rate
)paren
op_logical_and
id|snd_pcm_format_linear
c_func
(paren
id|dstformat.format
)paren
)paren
id|tmpformat.format
op_assign
id|dstformat.format
suffix:semicolon
id|err
op_assign
id|snd_pcm_plugin_build_route
c_func
(paren
id|plug
comma
op_amp
id|srcformat
comma
op_amp
id|tmpformat
comma
id|ttable
comma
op_amp
id|plugin
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ttable
)paren
suffix:semicolon
id|pdprintf
c_func
(paren
l_string|&quot;channels reduction: src=%i, dst=%i returns %i&bslash;n&quot;
comma
id|srcformat.channels
comma
id|tmpformat.channels
comma
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_pcm_plugin_free
c_func
(paren
id|plugin
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|err
op_assign
id|snd_pcm_plugin_append
c_func
(paren
id|plugin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_pcm_plugin_free
c_func
(paren
id|plugin
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|srcformat
op_assign
id|tmpformat
suffix:semicolon
id|src_access
op_assign
id|dst_access
suffix:semicolon
)brace
multiline_comment|/* rate resampling */
r_if
c_cond
(paren
op_logical_neg
id|rate_match
c_func
(paren
id|srcformat.rate
comma
id|dstformat.rate
)paren
)paren
(brace
id|tmpformat.rate
op_assign
id|dstformat.rate
suffix:semicolon
r_if
c_cond
(paren
id|srcformat.channels
op_eq
id|dstformat.channels
op_logical_and
id|snd_pcm_format_linear
c_func
(paren
id|dstformat.format
)paren
)paren
id|tmpformat.format
op_assign
id|dstformat.format
suffix:semicolon
id|err
op_assign
id|snd_pcm_plugin_build_rate
c_func
(paren
id|plug
comma
op_amp
id|srcformat
comma
op_amp
id|tmpformat
comma
op_amp
id|plugin
)paren
suffix:semicolon
id|pdprintf
c_func
(paren
l_string|&quot;rate down resampling: src=%i, dst=%i returns %i&bslash;n&quot;
comma
id|srcformat.rate
comma
id|tmpformat.rate
comma
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_pcm_plugin_free
c_func
(paren
id|plugin
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|err
op_assign
id|snd_pcm_plugin_append
c_func
(paren
id|plugin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_pcm_plugin_free
c_func
(paren
id|plugin
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|srcformat
op_assign
id|tmpformat
suffix:semicolon
id|src_access
op_assign
id|dst_access
suffix:semicolon
)brace
multiline_comment|/* channels extension  */
r_if
c_cond
(paren
id|srcformat.channels
OL
id|dstformat.channels
)paren
(brace
r_int
id|sv
op_assign
id|srcformat.channels
suffix:semicolon
r_int
id|dv
op_assign
id|dstformat.channels
suffix:semicolon
id|route_ttable_entry_t
op_star
id|ttable
op_assign
id|snd_kcalloc
c_func
(paren
id|dv
op_star
id|sv
op_star
r_sizeof
(paren
op_star
id|ttable
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ttable
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
macro_line|#if 0
(brace
r_int
id|v
suffix:semicolon
r_for
c_loop
(paren
id|v
op_assign
l_int|0
suffix:semicolon
id|v
OL
id|sv
suffix:semicolon
op_increment
id|v
)paren
id|ttable
(braket
id|v
op_star
id|sv
op_plus
id|v
)braket
op_assign
id|FULL
suffix:semicolon
)brace
macro_line|#else
(brace
multiline_comment|/* Playback is spreaded on all channels */
r_int
id|vd
comma
id|vs
suffix:semicolon
r_for
c_loop
(paren
id|vd
op_assign
l_int|0
comma
id|vs
op_assign
l_int|0
suffix:semicolon
id|vd
OL
id|dv
suffix:semicolon
op_increment
id|vd
)paren
(brace
id|ttable
(braket
id|vd
op_star
id|sv
op_plus
id|vs
)braket
op_assign
id|FULL
suffix:semicolon
id|vs
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|vs
op_eq
id|sv
)paren
id|vs
op_assign
l_int|0
suffix:semicolon
)brace
)brace
macro_line|#endif
id|tmpformat.channels
op_assign
id|dstformat.channels
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_linear
c_func
(paren
id|dstformat.format
)paren
)paren
id|tmpformat.format
op_assign
id|dstformat.format
suffix:semicolon
id|err
op_assign
id|snd_pcm_plugin_build_route
c_func
(paren
id|plug
comma
op_amp
id|srcformat
comma
op_amp
id|tmpformat
comma
id|ttable
comma
op_amp
id|plugin
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ttable
)paren
suffix:semicolon
id|pdprintf
c_func
(paren
l_string|&quot;channels extension: src=%i, dst=%i returns %i&bslash;n&quot;
comma
id|srcformat.channels
comma
id|tmpformat.channels
comma
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_pcm_plugin_free
c_func
(paren
id|plugin
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|err
op_assign
id|snd_pcm_plugin_append
c_func
(paren
id|plugin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_pcm_plugin_free
c_func
(paren
id|plugin
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|srcformat
op_assign
id|tmpformat
suffix:semicolon
id|src_access
op_assign
id|dst_access
suffix:semicolon
)brace
multiline_comment|/* format change */
r_if
c_cond
(paren
id|srcformat.format
op_ne
id|dstformat.format
)paren
(brace
id|tmpformat.format
op_assign
id|dstformat.format
suffix:semicolon
r_if
c_cond
(paren
id|tmpformat.format
op_eq
id|SNDRV_PCM_FORMAT_MU_LAW
)paren
(brace
id|err
op_assign
id|snd_pcm_plugin_build_mulaw
c_func
(paren
id|plug
comma
op_amp
id|srcformat
comma
op_amp
id|tmpformat
comma
op_amp
id|plugin
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|snd_pcm_format_linear
c_func
(paren
id|srcformat.format
)paren
op_logical_and
id|snd_pcm_format_linear
c_func
(paren
id|tmpformat.format
)paren
)paren
(brace
id|err
op_assign
id|snd_pcm_plugin_build_linear
c_func
(paren
id|plug
comma
op_amp
id|srcformat
comma
op_amp
id|tmpformat
comma
op_amp
id|plugin
)paren
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
id|pdprintf
c_func
(paren
l_string|&quot;format change: src=%i, dst=%i returns %i&bslash;n&quot;
comma
id|srcformat.format
comma
id|tmpformat.format
comma
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|err
op_assign
id|snd_pcm_plugin_append
c_func
(paren
id|plugin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_pcm_plugin_free
c_func
(paren
id|plugin
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|srcformat
op_assign
id|tmpformat
suffix:semicolon
id|src_access
op_assign
id|dst_access
suffix:semicolon
)brace
multiline_comment|/* de-interleave */
r_if
c_cond
(paren
id|src_access
op_ne
id|dst_access
)paren
(brace
id|err
op_assign
id|snd_pcm_plugin_build_copy
c_func
(paren
id|plug
comma
op_amp
id|srcformat
comma
op_amp
id|tmpformat
comma
op_amp
id|plugin
)paren
suffix:semicolon
id|pdprintf
c_func
(paren
l_string|&quot;interleave change (copy: returns %i)&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|err
op_assign
id|snd_pcm_plugin_append
c_func
(paren
id|plugin
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_pcm_plugin_free
c_func
(paren
id|plugin
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pcm_plug_client_channels_buf
id|snd_pcm_sframes_t
id|snd_pcm_plug_client_channels_buf
c_func
(paren
id|snd_pcm_plug_t
op_star
id|plug
comma
r_char
op_star
id|buf
comma
id|snd_pcm_uframes_t
id|count
comma
id|snd_pcm_plugin_channel_t
op_star
op_star
id|channels
)paren
(brace
id|snd_pcm_plugin_t
op_star
id|plugin
suffix:semicolon
id|snd_pcm_plugin_channel_t
op_star
id|v
suffix:semicolon
id|snd_pcm_plugin_format_t
op_star
id|format
suffix:semicolon
r_int
id|width
comma
id|nchannels
comma
id|channel
suffix:semicolon
r_int
id|stream
op_assign
id|snd_pcm_plug_stream
c_func
(paren
id|plug
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|buf
op_ne
l_int|NULL
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stream
op_eq
id|SNDRV_PCM_STREAM_PLAYBACK
)paren
(brace
id|plugin
op_assign
id|snd_pcm_plug_first
c_func
(paren
id|plug
)paren
suffix:semicolon
id|format
op_assign
op_amp
id|plugin-&gt;src_format
suffix:semicolon
)brace
r_else
(brace
id|plugin
op_assign
id|snd_pcm_plug_last
c_func
(paren
id|plug
)paren
suffix:semicolon
id|format
op_assign
op_amp
id|plugin-&gt;dst_format
suffix:semicolon
)brace
id|v
op_assign
id|plugin-&gt;buf_channels
suffix:semicolon
op_star
id|channels
op_assign
id|v
suffix:semicolon
r_if
c_cond
(paren
(paren
id|width
op_assign
id|snd_pcm_format_physical_width
c_func
(paren
id|format-&gt;format
)paren
)paren
OL
l_int|0
)paren
r_return
id|width
suffix:semicolon
id|nchannels
op_assign
id|format-&gt;channels
suffix:semicolon
id|snd_assert
c_func
(paren
id|plugin-&gt;access
op_eq
id|SNDRV_PCM_ACCESS_RW_INTERLEAVED
op_logical_or
id|format-&gt;channels
op_le
l_int|1
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_for
c_loop
(paren
id|channel
op_assign
l_int|0
suffix:semicolon
id|channel
OL
id|nchannels
suffix:semicolon
id|channel
op_increment
comma
id|v
op_increment
)paren
(brace
id|v-&gt;enabled
op_assign
l_int|1
suffix:semicolon
id|v-&gt;wanted
op_assign
(paren
id|stream
op_eq
id|SNDRV_PCM_STREAM_CAPTURE
)paren
suffix:semicolon
id|v-&gt;area.addr
op_assign
id|buf
suffix:semicolon
id|v-&gt;area.first
op_assign
id|channel
op_star
id|width
suffix:semicolon
id|v-&gt;area.step
op_assign
id|nchannels
op_star
id|width
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
DECL|function|snd_pcm_plug_playback_channels_mask
r_int
id|snd_pcm_plug_playback_channels_mask
c_func
(paren
id|snd_pcm_plug_t
op_star
id|plug
comma
id|bitset_t
op_star
id|client_vmask
)paren
(brace
id|snd_pcm_plugin_t
op_star
id|plugin
op_assign
id|snd_pcm_plug_last
c_func
(paren
id|plug
)paren
suffix:semicolon
r_if
c_cond
(paren
id|plugin
op_eq
l_int|NULL
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_int
id|schannels
op_assign
id|plugin-&gt;dst_format.channels
suffix:semicolon
id|bitset_t
id|bs
(braket
id|bitset_size
c_func
(paren
id|schannels
)paren
)braket
suffix:semicolon
id|bitset_t
op_star
id|srcmask
suffix:semicolon
id|bitset_t
op_star
id|dstmask
op_assign
id|bs
suffix:semicolon
r_int
id|err
suffix:semicolon
id|bitset_one
c_func
(paren
id|dstmask
comma
id|schannels
)paren
suffix:semicolon
r_if
c_cond
(paren
id|plugin
op_eq
l_int|NULL
)paren
(brace
id|bitset_and
c_func
(paren
id|client_vmask
comma
id|dstmask
comma
id|schannels
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|err
op_assign
id|plugin
op_member_access_from_pointer
id|src_channels_mask
c_func
(paren
id|plugin
comma
id|dstmask
comma
op_amp
id|srcmask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|dstmask
op_assign
id|srcmask
suffix:semicolon
r_if
c_cond
(paren
id|plugin-&gt;prev
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|plugin
op_assign
id|plugin-&gt;prev
suffix:semicolon
)brace
id|bitset_and
c_func
(paren
id|client_vmask
comma
id|dstmask
comma
id|plugin-&gt;src_format.channels
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|snd_pcm_plug_capture_channels_mask
r_int
id|snd_pcm_plug_capture_channels_mask
c_func
(paren
id|snd_pcm_plug_t
op_star
id|plug
comma
id|bitset_t
op_star
id|client_vmask
)paren
(brace
id|snd_pcm_plugin_t
op_star
id|plugin
op_assign
id|snd_pcm_plug_first
c_func
(paren
id|plug
)paren
suffix:semicolon
r_if
c_cond
(paren
id|plugin
op_eq
l_int|NULL
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_int
id|schannels
op_assign
id|plugin-&gt;src_format.channels
suffix:semicolon
id|bitset_t
id|bs
(braket
id|bitset_size
c_func
(paren
id|schannels
)paren
)braket
suffix:semicolon
id|bitset_t
op_star
id|srcmask
op_assign
id|bs
suffix:semicolon
id|bitset_t
op_star
id|dstmask
suffix:semicolon
r_int
id|err
suffix:semicolon
id|bitset_one
c_func
(paren
id|srcmask
comma
id|schannels
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|err
op_assign
id|plugin
op_member_access_from_pointer
id|dst_channels_mask
c_func
(paren
id|plugin
comma
id|srcmask
comma
op_amp
id|dstmask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|srcmask
op_assign
id|dstmask
suffix:semicolon
r_if
c_cond
(paren
id|plugin-&gt;next
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
id|plugin
op_assign
id|plugin-&gt;next
suffix:semicolon
)brace
id|bitset_and
c_func
(paren
id|client_vmask
comma
id|srcmask
comma
id|plugin-&gt;dst_format.channels
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|snd_pcm_plug_playback_disable_useless_channels
r_static
r_int
id|snd_pcm_plug_playback_disable_useless_channels
c_func
(paren
id|snd_pcm_plug_t
op_star
id|plug
comma
id|snd_pcm_plugin_channel_t
op_star
id|src_channels
)paren
(brace
id|snd_pcm_plugin_t
op_star
id|plugin
op_assign
id|snd_pcm_plug_first
c_func
(paren
id|plug
)paren
suffix:semicolon
r_int
r_int
id|nchannels
op_assign
id|plugin-&gt;src_format.channels
suffix:semicolon
id|bitset_t
id|bs
(braket
id|bitset_size
c_func
(paren
id|nchannels
)paren
)braket
suffix:semicolon
id|bitset_t
op_star
id|srcmask
op_assign
id|bs
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
r_int
id|channel
suffix:semicolon
r_for
c_loop
(paren
id|channel
op_assign
l_int|0
suffix:semicolon
id|channel
OL
id|nchannels
suffix:semicolon
id|channel
op_increment
)paren
(brace
r_if
c_cond
(paren
id|src_channels
(braket
id|channel
)braket
dot
id|enabled
)paren
id|bitset_set
c_func
(paren
id|srcmask
comma
id|channel
)paren
suffix:semicolon
r_else
id|bitset_reset
c_func
(paren
id|srcmask
comma
id|channel
)paren
suffix:semicolon
)brace
id|err
op_assign
id|snd_pcm_plug_playback_channels_mask
c_func
(paren
id|plug
comma
id|srcmask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_for
c_loop
(paren
id|channel
op_assign
l_int|0
suffix:semicolon
id|channel
OL
id|nchannels
suffix:semicolon
id|channel
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|bitset_get
c_func
(paren
id|srcmask
comma
id|channel
)paren
)paren
id|src_channels
(braket
id|channel
)braket
dot
id|enabled
op_assign
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pcm_plug_capture_disable_useless_channels
r_static
r_int
id|snd_pcm_plug_capture_disable_useless_channels
c_func
(paren
id|snd_pcm_plug_t
op_star
id|plug
comma
id|snd_pcm_plugin_channel_t
op_star
id|src_channels
comma
id|snd_pcm_plugin_channel_t
op_star
id|client_channels
)paren
(brace
id|snd_pcm_plugin_t
op_star
id|plugin
op_assign
id|snd_pcm_plug_last
c_func
(paren
id|plug
)paren
suffix:semicolon
r_int
r_int
id|nchannels
op_assign
id|plugin-&gt;dst_format.channels
suffix:semicolon
id|bitset_t
id|bs
(braket
id|bitset_size
c_func
(paren
id|nchannels
)paren
)braket
suffix:semicolon
id|bitset_t
op_star
id|dstmask
op_assign
id|bs
suffix:semicolon
id|bitset_t
op_star
id|srcmask
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
r_int
id|channel
suffix:semicolon
r_for
c_loop
(paren
id|channel
op_assign
l_int|0
suffix:semicolon
id|channel
OL
id|nchannels
suffix:semicolon
id|channel
op_increment
)paren
(brace
r_if
c_cond
(paren
id|client_channels
(braket
id|channel
)braket
dot
id|enabled
)paren
id|bitset_set
c_func
(paren
id|dstmask
comma
id|channel
)paren
suffix:semicolon
r_else
id|bitset_reset
c_func
(paren
id|dstmask
comma
id|channel
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|plugin
)paren
(brace
id|err
op_assign
id|plugin
op_member_access_from_pointer
id|src_channels_mask
c_func
(paren
id|plugin
comma
id|dstmask
comma
op_amp
id|srcmask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|dstmask
op_assign
id|srcmask
suffix:semicolon
id|plugin
op_assign
id|plugin-&gt;prev
suffix:semicolon
)brace
id|plugin
op_assign
id|snd_pcm_plug_first
c_func
(paren
id|plug
)paren
suffix:semicolon
id|nchannels
op_assign
id|plugin-&gt;src_format.channels
suffix:semicolon
r_for
c_loop
(paren
id|channel
op_assign
l_int|0
suffix:semicolon
id|channel
OL
id|nchannels
suffix:semicolon
id|channel
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|bitset_get
c_func
(paren
id|dstmask
comma
id|channel
)paren
)paren
id|src_channels
(braket
id|channel
)braket
dot
id|enabled
op_assign
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pcm_plug_write_transfer
id|snd_pcm_sframes_t
id|snd_pcm_plug_write_transfer
c_func
(paren
id|snd_pcm_plug_t
op_star
id|plug
comma
id|snd_pcm_plugin_channel_t
op_star
id|src_channels
comma
id|snd_pcm_uframes_t
id|size
)paren
(brace
id|snd_pcm_plugin_t
op_star
id|plugin
comma
op_star
id|next
suffix:semicolon
id|snd_pcm_plugin_channel_t
op_star
id|dst_channels
suffix:semicolon
r_int
id|err
suffix:semicolon
id|snd_pcm_sframes_t
id|frames
op_assign
id|size
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_plug_playback_disable_useless_channels
c_func
(paren
id|plug
comma
id|src_channels
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|plugin
op_assign
id|snd_pcm_plug_first
c_func
(paren
id|plug
)paren
suffix:semicolon
r_while
c_loop
(paren
id|plugin
op_logical_and
id|frames
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|next
op_assign
id|plugin-&gt;next
)paren
op_ne
l_int|NULL
)paren
(brace
id|snd_pcm_sframes_t
id|frames1
op_assign
id|frames
suffix:semicolon
r_if
c_cond
(paren
id|plugin-&gt;dst_frames
)paren
id|frames1
op_assign
id|plugin
op_member_access_from_pointer
id|dst_frames
c_func
(paren
id|plugin
comma
id|frames
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|next
op_member_access_from_pointer
id|client_channels
c_func
(paren
id|next
comma
id|frames1
comma
op_amp
id|dst_channels
)paren
)paren
OL
l_int|0
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
op_ne
id|frames1
)paren
(brace
id|frames
op_assign
id|err
suffix:semicolon
r_if
c_cond
(paren
id|plugin-&gt;src_frames
)paren
id|frames
op_assign
id|plugin
op_member_access_from_pointer
id|src_frames
c_func
(paren
id|plugin
comma
id|frames1
)paren
suffix:semicolon
)brace
)brace
r_else
id|dst_channels
op_assign
l_int|0
suffix:semicolon
id|pdprintf
c_func
(paren
l_string|&quot;write plugin: %s, %li&bslash;n&quot;
comma
id|plugin-&gt;name
comma
id|frames
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|frames
op_assign
id|plugin
op_member_access_from_pointer
id|transfer
c_func
(paren
id|plugin
comma
id|src_channels
comma
id|dst_channels
comma
id|frames
)paren
)paren
OL
l_int|0
)paren
r_return
id|frames
suffix:semicolon
id|src_channels
op_assign
id|dst_channels
suffix:semicolon
id|plugin
op_assign
id|next
suffix:semicolon
)brace
r_return
id|snd_pcm_plug_client_size
c_func
(paren
id|plug
comma
id|frames
)paren
suffix:semicolon
)brace
DECL|function|snd_pcm_plug_read_transfer
id|snd_pcm_sframes_t
id|snd_pcm_plug_read_transfer
c_func
(paren
id|snd_pcm_plug_t
op_star
id|plug
comma
id|snd_pcm_plugin_channel_t
op_star
id|dst_channels_final
comma
id|snd_pcm_uframes_t
id|size
)paren
(brace
id|snd_pcm_plugin_t
op_star
id|plugin
comma
op_star
id|next
suffix:semicolon
id|snd_pcm_plugin_channel_t
op_star
id|src_channels
comma
op_star
id|dst_channels
suffix:semicolon
id|snd_pcm_sframes_t
id|frames
op_assign
id|size
suffix:semicolon
r_int
id|err
suffix:semicolon
id|frames
op_assign
id|snd_pcm_plug_slave_size
c_func
(paren
id|plug
comma
id|frames
)paren
suffix:semicolon
r_if
c_cond
(paren
id|frames
OL
l_int|0
)paren
r_return
id|frames
suffix:semicolon
id|src_channels
op_assign
l_int|0
suffix:semicolon
id|plugin
op_assign
id|snd_pcm_plug_first
c_func
(paren
id|plug
)paren
suffix:semicolon
r_while
c_loop
(paren
id|plugin
op_logical_and
id|frames
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|next
op_assign
id|plugin-&gt;next
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|plugin
op_member_access_from_pointer
id|client_channels
c_func
(paren
id|plugin
comma
id|frames
comma
op_amp
id|dst_channels
)paren
)paren
OL
l_int|0
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|frames
op_assign
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|plugin-&gt;prev
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_plug_capture_disable_useless_channels
c_func
(paren
id|plug
comma
id|dst_channels
comma
id|dst_channels_final
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
)brace
r_else
(brace
id|dst_channels
op_assign
id|dst_channels_final
suffix:semicolon
)brace
id|pdprintf
c_func
(paren
l_string|&quot;read plugin: %s, %li&bslash;n&quot;
comma
id|plugin-&gt;name
comma
id|frames
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|frames
op_assign
id|plugin
op_member_access_from_pointer
id|transfer
c_func
(paren
id|plugin
comma
id|src_channels
comma
id|dst_channels
comma
id|frames
)paren
)paren
OL
l_int|0
)paren
r_return
id|frames
suffix:semicolon
id|plugin
op_assign
id|next
suffix:semicolon
id|src_channels
op_assign
id|dst_channels
suffix:semicolon
)brace
r_return
id|frames
suffix:semicolon
)brace
DECL|function|snd_pcm_area_silence
r_int
id|snd_pcm_area_silence
c_func
(paren
r_const
id|snd_pcm_channel_area_t
op_star
id|dst_area
comma
r_int
id|dst_offset
comma
r_int
id|samples
comma
r_int
id|format
)paren
(brace
multiline_comment|/* FIXME: sub byte resolution and odd dst_offset */
r_char
op_star
id|dst
suffix:semicolon
r_int
r_int
id|dst_step
suffix:semicolon
r_int
id|width
suffix:semicolon
id|u_int64_t
id|silence
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dst_area-&gt;addr
)paren
r_return
l_int|0
suffix:semicolon
id|dst
op_assign
id|dst_area-&gt;addr
op_plus
(paren
id|dst_area-&gt;first
op_plus
id|dst_area-&gt;step
op_star
id|dst_offset
)paren
op_div
l_int|8
suffix:semicolon
id|width
op_assign
id|snd_pcm_format_physical_width
c_func
(paren
id|format
)paren
suffix:semicolon
id|silence
op_assign
id|snd_pcm_format_silence_64
c_func
(paren
id|format
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dst_area-&gt;step
op_eq
(paren
r_int
r_int
)paren
id|width
)paren
(brace
r_int
id|dwords
op_assign
id|samples
op_star
id|width
op_div
l_int|64
suffix:semicolon
id|samples
op_sub_assign
id|dwords
op_star
l_int|64
op_div
id|width
suffix:semicolon
r_while
c_loop
(paren
id|dwords
op_decrement
OG
l_int|0
)paren
op_star
(paren
(paren
id|u_int64_t
op_star
)paren
id|dst
)paren
op_increment
op_assign
id|silence
suffix:semicolon
r_if
c_cond
(paren
id|samples
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
)brace
id|dst_step
op_assign
id|dst_area-&gt;step
op_div
l_int|8
suffix:semicolon
r_switch
c_cond
(paren
id|width
)paren
(brace
r_case
l_int|4
suffix:colon
(brace
id|u_int8_t
id|s0
op_assign
id|silence
op_amp
l_int|0xf0
suffix:semicolon
id|u_int8_t
id|s1
op_assign
id|silence
op_amp
l_int|0x0f
suffix:semicolon
r_int
id|dstbit
op_assign
id|dst_area-&gt;first
op_mod
l_int|8
suffix:semicolon
r_int
id|dstbit_step
op_assign
id|dst_area-&gt;step
op_mod
l_int|8
suffix:semicolon
r_while
c_loop
(paren
id|samples
op_decrement
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|dstbit
)paren
(brace
op_star
id|dst
op_and_assign
l_int|0xf0
suffix:semicolon
op_star
id|dst
op_or_assign
id|s1
suffix:semicolon
)brace
r_else
(brace
op_star
id|dst
op_and_assign
l_int|0x0f
suffix:semicolon
op_star
id|dst
op_or_assign
id|s0
suffix:semicolon
)brace
id|dst
op_add_assign
id|dst_step
suffix:semicolon
id|dstbit
op_add_assign
id|dstbit_step
suffix:semicolon
r_if
c_cond
(paren
id|dstbit
op_eq
l_int|8
)paren
(brace
id|dst
op_increment
suffix:semicolon
id|dstbit
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
)brace
r_case
l_int|8
suffix:colon
(brace
id|u_int8_t
id|sil
op_assign
id|silence
suffix:semicolon
r_while
c_loop
(paren
id|samples
op_decrement
OG
l_int|0
)paren
(brace
op_star
id|dst
op_assign
id|sil
suffix:semicolon
id|dst
op_add_assign
id|dst_step
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
l_int|16
suffix:colon
(brace
id|u_int16_t
id|sil
op_assign
id|silence
suffix:semicolon
r_while
c_loop
(paren
id|samples
op_decrement
OG
l_int|0
)paren
(brace
op_star
(paren
id|u_int16_t
op_star
)paren
id|dst
op_assign
id|sil
suffix:semicolon
id|dst
op_add_assign
id|dst_step
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
l_int|32
suffix:colon
(brace
id|u_int32_t
id|sil
op_assign
id|silence
suffix:semicolon
r_while
c_loop
(paren
id|samples
op_decrement
OG
l_int|0
)paren
(brace
op_star
(paren
id|u_int32_t
op_star
)paren
id|dst
op_assign
id|sil
suffix:semicolon
id|dst
op_add_assign
id|dst_step
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
l_int|64
suffix:colon
(brace
r_while
c_loop
(paren
id|samples
op_decrement
OG
l_int|0
)paren
(brace
op_star
(paren
id|u_int64_t
op_star
)paren
id|dst
op_assign
id|silence
suffix:semicolon
id|dst
op_add_assign
id|dst_step
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_default
suffix:colon
id|snd_BUG
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pcm_area_copy
r_int
id|snd_pcm_area_copy
c_func
(paren
r_const
id|snd_pcm_channel_area_t
op_star
id|src_area
comma
r_int
id|src_offset
comma
r_const
id|snd_pcm_channel_area_t
op_star
id|dst_area
comma
r_int
id|dst_offset
comma
r_int
id|samples
comma
r_int
id|format
)paren
(brace
multiline_comment|/* FIXME: sub byte resolution and odd dst_offset */
r_char
op_star
id|src
comma
op_star
id|dst
suffix:semicolon
r_int
id|width
suffix:semicolon
r_int
id|src_step
comma
id|dst_step
suffix:semicolon
id|src
op_assign
id|src_area-&gt;addr
op_plus
(paren
id|src_area-&gt;first
op_plus
id|src_area-&gt;step
op_star
id|src_offset
)paren
op_div
l_int|8
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|src_area-&gt;addr
)paren
r_return
id|snd_pcm_area_silence
c_func
(paren
id|dst_area
comma
id|dst_offset
comma
id|samples
comma
id|format
)paren
suffix:semicolon
id|dst
op_assign
id|dst_area-&gt;addr
op_plus
(paren
id|dst_area-&gt;first
op_plus
id|dst_area-&gt;step
op_star
id|dst_offset
)paren
op_div
l_int|8
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dst_area-&gt;addr
)paren
r_return
l_int|0
suffix:semicolon
id|width
op_assign
id|snd_pcm_format_physical_width
c_func
(paren
id|format
)paren
suffix:semicolon
r_if
c_cond
(paren
id|src_area-&gt;step
op_eq
(paren
r_int
r_int
)paren
id|width
op_logical_and
id|dst_area-&gt;step
op_eq
(paren
r_int
r_int
)paren
id|width
)paren
(brace
r_int
id|bytes
op_assign
id|samples
op_star
id|width
op_div
l_int|8
suffix:semicolon
id|samples
op_sub_assign
id|bytes
op_star
l_int|8
op_div
id|width
suffix:semicolon
id|memcpy
c_func
(paren
id|dst
comma
id|src
comma
id|bytes
)paren
suffix:semicolon
r_if
c_cond
(paren
id|samples
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
)brace
id|src_step
op_assign
id|src_area-&gt;step
op_div
l_int|8
suffix:semicolon
id|dst_step
op_assign
id|dst_area-&gt;step
op_div
l_int|8
suffix:semicolon
r_switch
c_cond
(paren
id|width
)paren
(brace
r_case
l_int|4
suffix:colon
(brace
r_int
id|srcbit
op_assign
id|src_area-&gt;first
op_mod
l_int|8
suffix:semicolon
r_int
id|srcbit_step
op_assign
id|src_area-&gt;step
op_mod
l_int|8
suffix:semicolon
r_int
id|dstbit
op_assign
id|dst_area-&gt;first
op_mod
l_int|8
suffix:semicolon
r_int
id|dstbit_step
op_assign
id|dst_area-&gt;step
op_mod
l_int|8
suffix:semicolon
r_while
c_loop
(paren
id|samples
op_decrement
OG
l_int|0
)paren
(brace
r_int
r_char
id|srcval
suffix:semicolon
r_if
c_cond
(paren
id|srcbit
)paren
id|srcval
op_assign
op_star
id|src
op_amp
l_int|0x0f
suffix:semicolon
r_else
id|srcval
op_assign
op_star
id|src
op_amp
l_int|0xf0
suffix:semicolon
r_if
c_cond
(paren
id|dstbit
)paren
op_star
id|dst
op_and_assign
l_int|0xf0
suffix:semicolon
r_else
op_star
id|dst
op_and_assign
l_int|0x0f
suffix:semicolon
op_star
id|dst
op_or_assign
id|srcval
suffix:semicolon
id|src
op_add_assign
id|src_step
suffix:semicolon
id|srcbit
op_add_assign
id|srcbit_step
suffix:semicolon
r_if
c_cond
(paren
id|srcbit
op_eq
l_int|8
)paren
(brace
id|src
op_increment
suffix:semicolon
id|srcbit
op_assign
l_int|0
suffix:semicolon
)brace
id|dst
op_add_assign
id|dst_step
suffix:semicolon
id|dstbit
op_add_assign
id|dstbit_step
suffix:semicolon
r_if
c_cond
(paren
id|dstbit
op_eq
l_int|8
)paren
(brace
id|dst
op_increment
suffix:semicolon
id|dstbit
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
)brace
r_case
l_int|8
suffix:colon
(brace
r_while
c_loop
(paren
id|samples
op_decrement
OG
l_int|0
)paren
(brace
op_star
id|dst
op_assign
op_star
id|src
suffix:semicolon
id|src
op_add_assign
id|src_step
suffix:semicolon
id|dst
op_add_assign
id|dst_step
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
l_int|16
suffix:colon
(brace
r_while
c_loop
(paren
id|samples
op_decrement
OG
l_int|0
)paren
(brace
op_star
(paren
id|u_int16_t
op_star
)paren
id|dst
op_assign
op_star
(paren
id|u_int16_t
op_star
)paren
id|src
suffix:semicolon
id|src
op_add_assign
id|src_step
suffix:semicolon
id|dst
op_add_assign
id|dst_step
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
l_int|32
suffix:colon
(brace
r_while
c_loop
(paren
id|samples
op_decrement
OG
l_int|0
)paren
(brace
op_star
(paren
id|u_int32_t
op_star
)paren
id|dst
op_assign
op_star
(paren
id|u_int32_t
op_star
)paren
id|src
suffix:semicolon
id|src
op_add_assign
id|src_step
suffix:semicolon
id|dst
op_add_assign
id|dst_step
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_case
l_int|64
suffix:colon
(brace
r_while
c_loop
(paren
id|samples
op_decrement
OG
l_int|0
)paren
(brace
op_star
(paren
id|u_int64_t
op_star
)paren
id|dst
op_assign
op_star
(paren
id|u_int64_t
op_star
)paren
id|src
suffix:semicolon
id|src
op_add_assign
id|src_step
suffix:semicolon
id|dst
op_add_assign
id|dst_step
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_default
suffix:colon
id|snd_BUG
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
eof
