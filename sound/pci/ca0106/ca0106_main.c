multiline_comment|/*&n; *  Copyright (c) 2004 James Courtier-Dutton &lt;James@superbug.demon.co.uk&gt;&n; *  Driver CA0106 chips. e.g. Sound Blaster Audigy LS and Live 24bit&n; *  Version: 0.0.21&n; *&n; *  FEATURES currently supported:&n; *    Front, Rear and Center/LFE.&n; *    Surround40 and Surround51.&n; *    Capture from MIC an LINE IN input.&n; *    SPDIF digital playback of PCM stereo and AC3/DTS works.&n; *    (One can use a standard mono mini-jack to one RCA plugs cable.&n; *     or one can use a standard stereo mini-jack to two RCA plugs cable.&n; *     Plug one of the RCA plugs into the Coax input of the external decoder/receiver.)&n; *    ( In theory one could output 3 different AC3 streams at once, to 3 different SPDIF outputs. )&n; *    Notes on how to capture sound:&n; *      The AC97 is used in the PLAYBACK direction.&n; *      The output from the AC97 chip, instead of reaching the speakers, is fed into the Philips 1361T ADC.&n; *      So, to record from the MIC, set the MIC Playback volume to max,&n; *      unmute the MIC and turn up the MASTER Playback volume.&n; *      So, to prevent feedback when capturing, minimise the &quot;Capture feedback into Playback&quot; volume.&n; *   &n; *    The only playback controls that currently do anything are: -&n; *    Analog Front&n; *    Analog Rear&n; *    Analog Center/LFE&n; *    SPDIF Front&n; *    SPDIF Rear&n; *    SPDIF Center/LFE&n; *   &n; *    For capture from Mic in or Line in.&n; *    Digital/Analog ( switch must be in Analog mode for CAPTURE. )&n; * &n; *    CAPTURE feedback into PLAYBACK&n; * &n; *  Changelog:&n; *    Support interrupts per period.&n; *    Removed noise from Center/LFE channel when in Analog mode.&n; *    Rename and remove mixer controls.&n; *  0.0.6&n; *    Use separate card based DMA buffer for periods table list.&n; *  0.0.7&n; *    Change remove and rename ctrls into lists.&n; *  0.0.8&n; *    Try to fix capture sources.&n; *  0.0.9&n; *    Fix AC3 output.&n; *    Enable S32_LE format support.&n; *  0.0.10&n; *    Enable playback 48000 and 96000 rates. (Rates other that these do not work, even with &quot;plug:front&quot;.)&n; *  0.0.11&n; *    Add Model name recognition.&n; *  0.0.12&n; *    Correct interrupt timing. interrupt at end of period, instead of in the middle of a playback period.&n; *    Remove redundent &quot;voice&quot; handling.&n; *  0.0.13&n; *    Single trigger call for multi channels.&n; *  0.0.14&n; *    Set limits based on what the sound card hardware can do.&n; *    playback periods_min=2, periods_max=8&n; *    capture hw constraints require period_size = n * 64 bytes.&n; *    playback hw constraints require period_size = n * 64 bytes.&n; *  0.0.15&n; *    Minor updates.&n; *  0.0.16&n; *    Implement 192000 sample rate.&n; *  0.0.17&n; *    Add support for SB0410 and SB0413.&n; *  0.0.18&n; *    Modified Copyright message.&n; *  0.0.19&n; *    Finally fix support for SB Live 24 bit. SB0410 and SB0413.&n; *    The output codec needs resetting, otherwise all output is muted.&n; *  0.0.20&n; *    Merge &quot;pci_disable_device(pci);&quot; fixes.&n; *  0.0.21&n; *    Add 4 capture channels. (SPDIF only comes in on channel 0. )&n; *    Add SPDIF capture using optional digital I/O module for SB Live 24bit. (Analog capture does not yet work.)&n; *&n; *  BUGS:&n; *    Some stability problems when unloading the snd-ca0106 kernel module.&n; *    --&n; *&n; *  TODO:&n; *    4 Capture channels, only one implemented so far.&n; *    Other capture rates apart from 48khz not implemented.&n; *    MIDI&n; *    --&n; *  GENERAL INFO:&n; *    Model: SB0310&n; *    P17 Chip: CA0106-DAT&n; *    AC97 Codec: STAC 9721&n; *    ADC: Philips 1361T (Stereo 24bit)&n; *    DAC: WM8746EDS (6-channel, 24bit, 192Khz)&n; *&n; *  GENERAL INFO:&n; *    Model: SB0410&n; *    P17 Chip: CA0106-DAT&n; *    AC97 Codec: None&n; *    ADC: WM8775EDS (4 Channel)&n; *    DAC: CS4382 (114 dB, 24-Bit, 192 kHz, 8-Channel D/A Converter with DSD Support)&n; *    SPDIF Out control switches between Mic in and SPDIF out.&n; *    No sound out or mic input working yet.&n; * &n; *  GENERAL INFO:&n; *    Model: SB0413&n; *    P17 Chip: CA0106-DAT&n; *    AC97 Codec: None.&n; *    ADC: Unknown&n; *    DAC: Unknown&n; *    Trying to handle it like the SB0410.&n; *&n; *  This code was initally based on code from ALSA&squot;s emu10k1x.c which is:&n; *  Copyright (c) by Francisco Moraes &lt;fmoraes@nc.rr.com&gt;&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/initval.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
macro_line|#include &lt;sound/ac97_codec.h&gt;
macro_line|#include &lt;sound/info.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;James Courtier-Dutton &lt;James@superbug.demon.co.uk&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;CA0106&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_SUPPORTED_DEVICE
c_func
(paren
l_string|&quot;{{Creative,SB CA0106 chip}}&quot;
)paren
suffix:semicolon
singleline_comment|// module parameters (see &quot;Module Parameters&quot;)
DECL|variable|index
r_static
r_int
id|index
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_IDX
suffix:semicolon
DECL|variable|id
r_static
r_char
op_star
id|id
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_STR
suffix:semicolon
DECL|variable|enable
r_static
r_int
id|enable
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_ENABLE_PNP
suffix:semicolon
id|module_param_array
c_func
(paren
id|index
comma
r_int
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|index
comma
l_string|&quot;Index value for the CA0106 soundcard.&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|id
comma
id|charp
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|id
comma
l_string|&quot;ID string for the CA0106 soundcard.&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|enable
comma
r_bool
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|enable
comma
l_string|&quot;Enable the CA0106 soundcard.&quot;
)paren
suffix:semicolon
macro_line|#include &quot;ca0106.h&quot;
r_typedef
r_struct
(brace
DECL|member|serial
id|u32
id|serial
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|typedef|ca0106_names_t
)brace
id|ca0106_names_t
suffix:semicolon
DECL|variable|ca0106_chip_names
r_static
id|ca0106_names_t
id|ca0106_chip_names
(braket
)braket
op_assign
(brace
(brace
l_int|0x10021102
comma
l_string|&quot;AudigyLS [SB0310]&quot;
)brace
comma
(brace
l_int|0x10051102
comma
l_string|&quot;AudigyLS [SB0310b]&quot;
)brace
comma
multiline_comment|/* Unknown AudigyLS that also says SB0310 on it */
(brace
l_int|0x10061102
comma
l_string|&quot;Live! 7.1 24bit [SB0410]&quot;
)brace
comma
multiline_comment|/* New Sound Blaster Live! 7.1 24bit. This does not have an AC97. 53SB041000001 */
(brace
l_int|0x10071102
comma
l_string|&quot;Live! 7.1 24bit [SB0413]&quot;
)brace
comma
multiline_comment|/* New Dell Sound Blaster Live! 7.1 24bit. This does not have an AC97.  */
(brace
l_int|0
comma
l_string|&quot;AudigyLS [Unknown]&quot;
)brace
)brace
suffix:semicolon
multiline_comment|/* hardware definition */
DECL|variable|snd_ca0106_playback_hw
r_static
id|snd_pcm_hardware_t
id|snd_ca0106_playback_hw
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_S16_LE
op_or
id|SNDRV_PCM_FMTBIT_S32_LE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_48000
op_or
id|SNDRV_PCM_RATE_96000
op_or
id|SNDRV_PCM_RATE_192000
comma
dot
id|rate_min
op_assign
l_int|48000
comma
dot
id|rate_max
op_assign
l_int|192000
comma
dot
id|channels_min
op_assign
l_int|2
comma
singleline_comment|//1,
dot
id|channels_max
op_assign
l_int|2
comma
singleline_comment|//6,
dot
id|buffer_bytes_max
op_assign
(paren
l_int|32
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|16
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|2
comma
dot
id|periods_max
op_assign
l_int|8
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|snd_ca0106_capture_hw
r_static
id|snd_pcm_hardware_t
id|snd_ca0106_capture_hw
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_48000
comma
dot
id|rate_min
op_assign
l_int|48000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|2
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|32
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|16
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|2
comma
dot
id|periods_max
op_assign
l_int|2
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|function|snd_ca0106_ptr_read
r_int
r_int
id|snd_ca0106_ptr_read
c_func
(paren
id|ca0106_t
op_star
id|emu
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|chn
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|regptr
comma
id|val
suffix:semicolon
id|regptr
op_assign
(paren
id|reg
op_lshift
l_int|16
)paren
op_or
id|chn
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
id|outl
c_func
(paren
id|regptr
comma
id|emu-&gt;port
op_plus
id|PTR
)paren
suffix:semicolon
id|val
op_assign
id|inl
c_func
(paren
id|emu-&gt;port
op_plus
id|DATA
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
DECL|function|snd_ca0106_ptr_write
r_void
id|snd_ca0106_ptr_write
c_func
(paren
id|ca0106_t
op_star
id|emu
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|chn
comma
r_int
r_int
id|data
)paren
(brace
r_int
r_int
id|regptr
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|regptr
op_assign
(paren
id|reg
op_lshift
l_int|16
)paren
op_or
id|chn
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
id|outl
c_func
(paren
id|regptr
comma
id|emu-&gt;port
op_plus
id|PTR
)paren
suffix:semicolon
id|outl
c_func
(paren
id|data
comma
id|emu-&gt;port
op_plus
id|DATA
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_ca0106_intr_enable
r_static
r_void
id|snd_ca0106_intr_enable
c_func
(paren
id|ca0106_t
op_star
id|emu
comma
r_int
r_int
id|intrenb
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|enable
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
id|enable
op_assign
id|inl
c_func
(paren
id|emu-&gt;port
op_plus
id|INTE
)paren
op_or
id|intrenb
suffix:semicolon
id|outl
c_func
(paren
id|enable
comma
id|emu-&gt;port
op_plus
id|INTE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_ca0106_pcm_free_substream
r_static
r_void
id|snd_ca0106_pcm_free_substream
c_func
(paren
id|snd_pcm_runtime_t
op_star
id|runtime
)paren
(brace
id|ca0106_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
id|epcm
)paren
(brace
id|kfree
c_func
(paren
id|epcm
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* open_playback callback */
DECL|function|snd_ca0106_pcm_open_playback_channel
r_static
r_int
id|snd_ca0106_pcm_open_playback_channel
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|channel_id
)paren
(brace
id|ca0106_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|ca0106_channel_t
op_star
id|channel
op_assign
op_amp
(paren
id|chip-&gt;playback_channels
(braket
id|channel_id
)braket
)paren
suffix:semicolon
id|ca0106_pcm_t
op_star
id|epcm
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
id|epcm
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|epcm
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|epcm
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|epcm-&gt;emu
op_assign
id|chip
suffix:semicolon
id|epcm-&gt;substream
op_assign
id|substream
suffix:semicolon
id|epcm-&gt;channel_id
op_assign
id|channel_id
suffix:semicolon
id|runtime-&gt;private_data
op_assign
id|epcm
suffix:semicolon
id|runtime-&gt;private_free
op_assign
id|snd_ca0106_pcm_free_substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_ca0106_playback_hw
suffix:semicolon
id|channel-&gt;emu
op_assign
id|chip
suffix:semicolon
id|channel-&gt;number
op_assign
id|channel_id
suffix:semicolon
id|channel-&gt;use
op_assign
l_int|1
suffix:semicolon
singleline_comment|//printk(&quot;open:channel_id=%d, chip=%p, channel=%p&bslash;n&quot;,channel_id, chip, channel);
singleline_comment|//channel-&gt;interrupt = snd_ca0106_pcm_channel_interrupt;
id|channel-&gt;epcm
op_assign
id|epcm
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_integer
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_PERIODS
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_step
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_PERIOD_BYTES
comma
l_int|64
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* close callback */
DECL|function|snd_ca0106_pcm_close_playback
r_static
r_int
id|snd_ca0106_pcm_close_playback
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ca0106_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|ca0106_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
id|chip-&gt;playback_channels
(braket
id|epcm-&gt;channel_id
)braket
dot
id|use
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* FIXME: maybe zero others */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ca0106_pcm_open_playback_front
r_static
r_int
id|snd_ca0106_pcm_open_playback_front
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_ca0106_pcm_open_playback_channel
c_func
(paren
id|substream
comma
id|PCM_FRONT_CHANNEL
)paren
suffix:semicolon
)brace
DECL|function|snd_ca0106_pcm_open_playback_center_lfe
r_static
r_int
id|snd_ca0106_pcm_open_playback_center_lfe
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_ca0106_pcm_open_playback_channel
c_func
(paren
id|substream
comma
id|PCM_CENTER_LFE_CHANNEL
)paren
suffix:semicolon
)brace
DECL|function|snd_ca0106_pcm_open_playback_unknown
r_static
r_int
id|snd_ca0106_pcm_open_playback_unknown
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_ca0106_pcm_open_playback_channel
c_func
(paren
id|substream
comma
id|PCM_UNKNOWN_CHANNEL
)paren
suffix:semicolon
)brace
DECL|function|snd_ca0106_pcm_open_playback_rear
r_static
r_int
id|snd_ca0106_pcm_open_playback_rear
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_ca0106_pcm_open_playback_channel
c_func
(paren
id|substream
comma
id|PCM_REAR_CHANNEL
)paren
suffix:semicolon
)brace
multiline_comment|/* open_capture callback */
DECL|function|snd_ca0106_pcm_open_capture_channel
r_static
r_int
id|snd_ca0106_pcm_open_capture_channel
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|channel_id
)paren
(brace
id|ca0106_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|ca0106_channel_t
op_star
id|channel
op_assign
op_amp
(paren
id|chip-&gt;capture_channels
(braket
id|channel_id
)braket
)paren
suffix:semicolon
id|ca0106_pcm_t
op_star
id|epcm
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
id|epcm
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|epcm
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|epcm
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;open_capture_channel: failed epcm alloc&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|epcm-&gt;emu
op_assign
id|chip
suffix:semicolon
id|epcm-&gt;substream
op_assign
id|substream
suffix:semicolon
id|epcm-&gt;channel_id
op_assign
id|channel_id
suffix:semicolon
id|runtime-&gt;private_data
op_assign
id|epcm
suffix:semicolon
id|runtime-&gt;private_free
op_assign
id|snd_ca0106_pcm_free_substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_ca0106_capture_hw
suffix:semicolon
id|channel-&gt;emu
op_assign
id|chip
suffix:semicolon
id|channel-&gt;number
op_assign
id|channel_id
suffix:semicolon
id|channel-&gt;use
op_assign
l_int|1
suffix:semicolon
singleline_comment|//printk(&quot;open:channel_id=%d, chip=%p, channel=%p&bslash;n&quot;,channel_id, chip, channel);
singleline_comment|//channel-&gt;interrupt = snd_ca0106_pcm_channel_interrupt;
id|channel-&gt;epcm
op_assign
id|epcm
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_integer
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_PERIODS
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
singleline_comment|//snd_pcm_hw_constraint_list(runtime, 0, SNDRV_PCM_HW_PARAM_PERIOD_SIZE, &amp;hw_constraints_capture_period_sizes);
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_step
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_PERIOD_BYTES
comma
l_int|64
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* close callback */
DECL|function|snd_ca0106_pcm_close_capture
r_static
r_int
id|snd_ca0106_pcm_close_capture
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ca0106_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|ca0106_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
id|chip-&gt;capture_channels
(braket
id|epcm-&gt;channel_id
)braket
dot
id|use
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* FIXME: maybe zero others */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ca0106_pcm_open_0_capture
r_static
r_int
id|snd_ca0106_pcm_open_0_capture
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_ca0106_pcm_open_capture_channel
c_func
(paren
id|substream
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|snd_ca0106_pcm_open_1_capture
r_static
r_int
id|snd_ca0106_pcm_open_1_capture
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_ca0106_pcm_open_capture_channel
c_func
(paren
id|substream
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|snd_ca0106_pcm_open_2_capture
r_static
r_int
id|snd_ca0106_pcm_open_2_capture
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_ca0106_pcm_open_capture_channel
c_func
(paren
id|substream
comma
l_int|2
)paren
suffix:semicolon
)brace
DECL|function|snd_ca0106_pcm_open_3_capture
r_static
r_int
id|snd_ca0106_pcm_open_3_capture
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_ca0106_pcm_open_capture_channel
c_func
(paren
id|substream
comma
l_int|3
)paren
suffix:semicolon
)brace
multiline_comment|/* hw_params callback */
DECL|function|snd_ca0106_pcm_hw_params_playback
r_static
r_int
id|snd_ca0106_pcm_hw_params_playback
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
r_return
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* hw_free callback */
DECL|function|snd_ca0106_pcm_hw_free_playback
r_static
r_int
id|snd_ca0106_pcm_hw_free_playback
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
multiline_comment|/* hw_params callback */
DECL|function|snd_ca0106_pcm_hw_params_capture
r_static
r_int
id|snd_ca0106_pcm_hw_params_capture
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
r_return
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* hw_free callback */
DECL|function|snd_ca0106_pcm_hw_free_capture
r_static
r_int
id|snd_ca0106_pcm_hw_free_capture
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
multiline_comment|/* prepare playback callback */
DECL|function|snd_ca0106_pcm_prepare_playback
r_static
r_int
id|snd_ca0106_pcm_prepare_playback
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ca0106_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|ca0106_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_int
id|channel
op_assign
id|epcm-&gt;channel_id
suffix:semicolon
id|u32
op_star
id|table_base
op_assign
(paren
id|u32
op_star
)paren
(paren
id|emu-&gt;buffer.area
op_plus
(paren
l_int|8
op_star
l_int|16
op_star
id|channel
)paren
)paren
suffix:semicolon
id|u32
id|period_size_bytes
op_assign
id|frames_to_bytes
c_func
(paren
id|runtime
comma
id|runtime-&gt;period_size
)paren
suffix:semicolon
id|u32
id|hcfg_mask
op_assign
id|HCFG_PLAYBACK_S32_LE
suffix:semicolon
id|u32
id|hcfg_set
op_assign
l_int|0x00000000
suffix:semicolon
id|u32
id|hcfg
suffix:semicolon
id|u32
id|reg40_mask
op_assign
l_int|0x30000
op_lshift
(paren
id|channel
op_lshift
l_int|1
)paren
suffix:semicolon
id|u32
id|reg40_set
op_assign
l_int|0
suffix:semicolon
id|u32
id|reg40
suffix:semicolon
multiline_comment|/* FIXME: Depending on mixer selection of SPDIF out or not, select the spdif rate or the DAC rate. */
id|u32
id|reg71_mask
op_assign
l_int|0x03030000
suffix:semicolon
multiline_comment|/* Global. Set SPDIF rate. We only support 44100 to spdif, not to DAC. */
id|u32
id|reg71_set
op_assign
l_int|0
suffix:semicolon
id|u32
id|reg71
suffix:semicolon
r_int
id|i
suffix:semicolon
singleline_comment|//snd_printk(&quot;prepare:channel_number=%d, rate=%d, format=0x%x, channels=%d, buffer_size=%ld, period_size=%ld, periods=%u, frames_to_bytes=%d&bslash;n&quot;,channel, runtime-&gt;rate, runtime-&gt;format, runtime-&gt;channels, runtime-&gt;buffer_size, runtime-&gt;period_size, runtime-&gt;periods, frames_to_bytes(runtime, 1));
singleline_comment|//snd_printk(&quot;dma_addr=%x, dma_area=%p, table_base=%p&bslash;n&quot;,runtime-&gt;dma_addr, runtime-&gt;dma_area, table_base);
singleline_comment|//snd_printk(&quot;dma_addr=%x, dma_area=%p, dma_bytes(size)=%x&bslash;n&quot;,emu-&gt;buffer.addr, emu-&gt;buffer.area, emu-&gt;buffer.bytes);
multiline_comment|/* Rate can be set per channel. */
multiline_comment|/* reg40 control host to fifo */
multiline_comment|/* reg71 controls DAC rate. */
r_switch
c_cond
(paren
id|runtime-&gt;rate
)paren
(brace
r_case
l_int|44100
suffix:colon
id|reg40_set
op_assign
l_int|0x10000
op_lshift
(paren
id|channel
op_lshift
l_int|1
)paren
suffix:semicolon
id|reg71_set
op_assign
l_int|0x01010000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|48000
suffix:colon
id|reg40_set
op_assign
l_int|0
suffix:semicolon
id|reg71_set
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|96000
suffix:colon
id|reg40_set
op_assign
l_int|0x20000
op_lshift
(paren
id|channel
op_lshift
l_int|1
)paren
suffix:semicolon
id|reg71_set
op_assign
l_int|0x02020000
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|192000
suffix:colon
id|reg40_set
op_assign
l_int|0x30000
op_lshift
(paren
id|channel
op_lshift
l_int|1
)paren
suffix:semicolon
id|reg71_set
op_assign
l_int|0x03030000
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|reg40_set
op_assign
l_int|0
suffix:semicolon
id|reg71_set
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Format is a global setting */
multiline_comment|/* FIXME: Only let the first channel accessed set this. */
r_switch
c_cond
(paren
id|runtime-&gt;format
)paren
(brace
r_case
id|SNDRV_PCM_FORMAT_S16_LE
suffix:colon
id|hcfg_set
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_FORMAT_S32_LE
suffix:colon
id|hcfg_set
op_assign
id|HCFG_PLAYBACK_S32_LE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|hcfg_set
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|hcfg
op_assign
id|inl
c_func
(paren
id|emu-&gt;port
op_plus
id|HCFG
)paren
suffix:semicolon
id|hcfg
op_assign
(paren
id|hcfg
op_amp
op_complement
id|hcfg_mask
)paren
op_or
id|hcfg_set
suffix:semicolon
id|outl
c_func
(paren
id|hcfg
comma
id|emu-&gt;port
op_plus
id|HCFG
)paren
suffix:semicolon
id|reg40
op_assign
id|snd_ca0106_ptr_read
c_func
(paren
id|emu
comma
l_int|0x40
comma
l_int|0
)paren
suffix:semicolon
id|reg40
op_assign
(paren
id|reg40
op_amp
op_complement
id|reg40_mask
)paren
op_or
id|reg40_set
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
l_int|0x40
comma
l_int|0
comma
id|reg40
)paren
suffix:semicolon
id|reg71
op_assign
id|snd_ca0106_ptr_read
c_func
(paren
id|emu
comma
l_int|0x71
comma
l_int|0
)paren
suffix:semicolon
id|reg71
op_assign
(paren
id|reg71
op_amp
op_complement
id|reg71_mask
)paren
op_or
id|reg71_set
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
l_int|0x71
comma
l_int|0
comma
id|reg71
)paren
suffix:semicolon
multiline_comment|/* FIXME: Check emu-&gt;buffer.size before actually writing to it. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|runtime-&gt;periods
suffix:semicolon
id|i
op_increment
)paren
(brace
id|table_base
(braket
id|i
op_star
l_int|2
)braket
op_assign
id|runtime-&gt;dma_addr
op_plus
(paren
id|i
op_star
id|period_size_bytes
)paren
suffix:semicolon
id|table_base
(braket
(paren
id|i
op_star
l_int|2
)paren
op_plus
l_int|1
)braket
op_assign
id|period_size_bytes
op_lshift
l_int|16
suffix:semicolon
)brace
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
id|PLAYBACK_LIST_ADDR
comma
id|channel
comma
id|emu-&gt;buffer.addr
op_plus
(paren
l_int|8
op_star
l_int|16
op_star
id|channel
)paren
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
id|PLAYBACK_LIST_SIZE
comma
id|channel
comma
(paren
id|runtime-&gt;periods
op_minus
l_int|1
)paren
op_lshift
l_int|19
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
id|PLAYBACK_LIST_PTR
comma
id|channel
comma
l_int|0
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
id|PLAYBACK_DMA_ADDR
comma
id|channel
comma
id|runtime-&gt;dma_addr
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
id|PLAYBACK_PERIOD_SIZE
comma
id|channel
comma
id|frames_to_bytes
c_func
(paren
id|runtime
comma
id|runtime-&gt;period_size
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
singleline_comment|// buffer size in bytes
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
id|PLAYBACK_POINTER
comma
id|channel
comma
l_int|0
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
l_int|0x07
comma
id|channel
comma
l_int|0x0
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
l_int|0x08
comma
id|channel
comma
l_int|0
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
id|PLAYBACK_MUTE
comma
l_int|0x0
comma
l_int|0x0
)paren
suffix:semicolon
multiline_comment|/* Unmute output */
macro_line|#if 0
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
id|SPCS0
comma
l_int|0
comma
id|SPCS_CLKACCY_1000PPM
op_or
id|SPCS_SAMPLERATE_48
op_or
id|SPCS_CHANNELNUM_LEFT
op_or
id|SPCS_SOURCENUM_UNSPEC
op_or
id|SPCS_GENERATIONSTATUS
op_or
l_int|0x00001200
op_or
l_int|0x00000000
op_or
id|SPCS_EMPHASIS_NONE
op_or
id|SPCS_COPYRIGHT
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* prepare capture callback */
DECL|function|snd_ca0106_pcm_prepare_capture
r_static
r_int
id|snd_ca0106_pcm_prepare_capture
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ca0106_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|ca0106_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_int
id|channel
op_assign
id|epcm-&gt;channel_id
suffix:semicolon
singleline_comment|//printk(&quot;prepare:channel_number=%d, rate=%d, format=0x%x, channels=%d, buffer_size=%ld, period_size=%ld, frames_to_bytes=%d&bslash;n&quot;,channel, runtime-&gt;rate, runtime-&gt;format, runtime-&gt;channels, runtime-&gt;buffer_size, runtime-&gt;period_size,  frames_to_bytes(runtime, 1));
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
l_int|0x13
comma
id|channel
comma
l_int|0
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
id|CAPTURE_DMA_ADDR
comma
id|channel
comma
id|runtime-&gt;dma_addr
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
id|CAPTURE_BUFFER_SIZE
comma
id|channel
comma
id|frames_to_bytes
c_func
(paren
id|runtime
comma
id|runtime-&gt;buffer_size
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
singleline_comment|// buffer size in bytes
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
id|CAPTURE_POINTER
comma
id|channel
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* trigger_playback callback */
DECL|function|snd_ca0106_pcm_trigger_playback
r_static
r_int
id|snd_ca0106_pcm_trigger_playback
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|ca0106_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
suffix:semicolon
id|ca0106_pcm_t
op_star
id|epcm
suffix:semicolon
r_int
id|channel
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
r_struct
id|list_head
op_star
id|pos
suffix:semicolon
id|snd_pcm_substream_t
op_star
id|s
suffix:semicolon
id|u32
id|basic
op_assign
l_int|0
suffix:semicolon
id|u32
id|extended
op_assign
l_int|0
suffix:semicolon
r_int
id|running
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
id|running
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
r_default
suffix:colon
id|running
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
id|snd_pcm_group_for_each
c_func
(paren
id|pos
comma
id|substream
)paren
(brace
id|s
op_assign
id|snd_pcm_group_substream_entry
c_func
(paren
id|pos
)paren
suffix:semicolon
id|runtime
op_assign
id|s-&gt;runtime
suffix:semicolon
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
id|channel
op_assign
id|epcm-&gt;channel_id
suffix:semicolon
singleline_comment|//snd_printk(&quot;channel=%d&bslash;n&quot;,channel);
id|epcm-&gt;running
op_assign
id|running
suffix:semicolon
id|basic
op_or_assign
(paren
l_int|0x1
op_lshift
id|channel
)paren
suffix:semicolon
id|extended
op_or_assign
(paren
l_int|0x10
op_lshift
id|channel
)paren
suffix:semicolon
id|snd_pcm_trigger_done
c_func
(paren
id|s
comma
id|substream
)paren
suffix:semicolon
)brace
singleline_comment|//snd_printk(&quot;basic=0x%x, extended=0x%x&bslash;n&quot;,basic, extended);
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
id|EXTENDED_INT_MASK
comma
l_int|0
comma
id|snd_ca0106_ptr_read
c_func
(paren
id|emu
comma
id|EXTENDED_INT_MASK
comma
l_int|0
)paren
op_or
(paren
id|extended
)paren
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
id|BASIC_INTERRUPT
comma
l_int|0
comma
id|snd_ca0106_ptr_read
c_func
(paren
id|emu
comma
id|BASIC_INTERRUPT
comma
l_int|0
)paren
op_or
(paren
id|basic
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
id|BASIC_INTERRUPT
comma
l_int|0
comma
id|snd_ca0106_ptr_read
c_func
(paren
id|emu
comma
id|BASIC_INTERRUPT
comma
l_int|0
)paren
op_amp
op_complement
(paren
id|basic
)paren
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
id|EXTENDED_INT_MASK
comma
l_int|0
comma
id|snd_ca0106_ptr_read
c_func
(paren
id|emu
comma
id|EXTENDED_INT_MASK
comma
l_int|0
)paren
op_amp
op_complement
(paren
id|extended
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/* trigger_capture callback */
DECL|function|snd_ca0106_pcm_trigger_capture
r_static
r_int
id|snd_ca0106_pcm_trigger_capture
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|ca0106_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|ca0106_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_int
id|channel
op_assign
id|epcm-&gt;channel_id
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
id|EXTENDED_INT_MASK
comma
l_int|0
comma
id|snd_ca0106_ptr_read
c_func
(paren
id|emu
comma
id|EXTENDED_INT_MASK
comma
l_int|0
)paren
op_or
(paren
l_int|0x110000
op_lshift
id|channel
)paren
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
id|BASIC_INTERRUPT
comma
l_int|0
comma
id|snd_ca0106_ptr_read
c_func
(paren
id|emu
comma
id|BASIC_INTERRUPT
comma
l_int|0
)paren
op_or
(paren
l_int|0x100
op_lshift
id|channel
)paren
)paren
suffix:semicolon
id|epcm-&gt;running
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
id|BASIC_INTERRUPT
comma
l_int|0
comma
id|snd_ca0106_ptr_read
c_func
(paren
id|emu
comma
id|BASIC_INTERRUPT
comma
l_int|0
)paren
op_amp
op_complement
(paren
l_int|0x100
op_lshift
id|channel
)paren
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|emu
comma
id|EXTENDED_INT_MASK
comma
l_int|0
comma
id|snd_ca0106_ptr_read
c_func
(paren
id|emu
comma
id|EXTENDED_INT_MASK
comma
l_int|0
)paren
op_amp
op_complement
(paren
l_int|0x110000
op_lshift
id|channel
)paren
)paren
suffix:semicolon
id|epcm-&gt;running
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/* pointer_playback callback */
r_static
id|snd_pcm_uframes_t
DECL|function|snd_ca0106_pcm_pointer_playback
id|snd_ca0106_pcm_pointer_playback
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ca0106_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|ca0106_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
id|snd_pcm_uframes_t
id|ptr
comma
id|ptr1
comma
id|ptr2
comma
id|ptr3
comma
id|ptr4
op_assign
l_int|0
suffix:semicolon
r_int
id|channel
op_assign
id|epcm-&gt;channel_id
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|epcm-&gt;running
)paren
r_return
l_int|0
suffix:semicolon
id|ptr3
op_assign
id|snd_ca0106_ptr_read
c_func
(paren
id|emu
comma
id|PLAYBACK_LIST_PTR
comma
id|channel
)paren
suffix:semicolon
id|ptr1
op_assign
id|snd_ca0106_ptr_read
c_func
(paren
id|emu
comma
id|PLAYBACK_POINTER
comma
id|channel
)paren
suffix:semicolon
id|ptr4
op_assign
id|snd_ca0106_ptr_read
c_func
(paren
id|emu
comma
id|PLAYBACK_LIST_PTR
comma
id|channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr3
op_ne
id|ptr4
)paren
id|ptr1
op_assign
id|snd_ca0106_ptr_read
c_func
(paren
id|emu
comma
id|PLAYBACK_POINTER
comma
id|channel
)paren
suffix:semicolon
id|ptr2
op_assign
id|bytes_to_frames
c_func
(paren
id|runtime
comma
id|ptr1
)paren
suffix:semicolon
id|ptr2
op_add_assign
(paren
id|ptr4
op_rshift
l_int|3
)paren
op_star
id|runtime-&gt;period_size
suffix:semicolon
id|ptr
op_assign
id|ptr2
suffix:semicolon
r_if
c_cond
(paren
id|ptr
op_ge
id|runtime-&gt;buffer_size
)paren
id|ptr
op_sub_assign
id|runtime-&gt;buffer_size
suffix:semicolon
singleline_comment|//printk(&quot;ptr1 = 0x%lx, ptr2=0x%lx, ptr=0x%lx, buffer_size = 0x%x, period_size = 0x%x, bits=%d, rate=%d&bslash;n&quot;, ptr1, ptr2, ptr, (int)runtime-&gt;buffer_size, (int)runtime-&gt;period_size, (int)runtime-&gt;frame_bits, (int)runtime-&gt;rate);
r_return
id|ptr
suffix:semicolon
)brace
multiline_comment|/* pointer_capture callback */
r_static
id|snd_pcm_uframes_t
DECL|function|snd_ca0106_pcm_pointer_capture
id|snd_ca0106_pcm_pointer_capture
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ca0106_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|ca0106_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
id|snd_pcm_uframes_t
id|ptr
comma
id|ptr1
comma
id|ptr2
op_assign
l_int|0
suffix:semicolon
r_int
id|channel
op_assign
id|channel
op_assign
id|epcm-&gt;channel_id
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|epcm-&gt;running
)paren
r_return
l_int|0
suffix:semicolon
id|ptr1
op_assign
id|snd_ca0106_ptr_read
c_func
(paren
id|emu
comma
id|CAPTURE_POINTER
comma
id|channel
)paren
suffix:semicolon
id|ptr2
op_assign
id|bytes_to_frames
c_func
(paren
id|runtime
comma
id|ptr1
)paren
suffix:semicolon
id|ptr
op_assign
id|ptr2
suffix:semicolon
r_if
c_cond
(paren
id|ptr
op_ge
id|runtime-&gt;buffer_size
)paren
id|ptr
op_sub_assign
id|runtime-&gt;buffer_size
suffix:semicolon
singleline_comment|//printk(&quot;ptr1 = 0x%lx, ptr2=0x%lx, ptr=0x%lx, buffer_size = 0x%x, period_size = 0x%x, bits=%d, rate=%d&bslash;n&quot;, ptr1, ptr2, ptr, (int)runtime-&gt;buffer_size, (int)runtime-&gt;period_size, (int)runtime-&gt;frame_bits, (int)runtime-&gt;rate);
r_return
id|ptr
suffix:semicolon
)brace
multiline_comment|/* operators */
DECL|variable|snd_ca0106_playback_front_ops
r_static
id|snd_pcm_ops_t
id|snd_ca0106_playback_front_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_ca0106_pcm_open_playback_front
comma
dot
id|close
op_assign
id|snd_ca0106_pcm_close_playback
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_ca0106_pcm_hw_params_playback
comma
dot
id|hw_free
op_assign
id|snd_ca0106_pcm_hw_free_playback
comma
dot
id|prepare
op_assign
id|snd_ca0106_pcm_prepare_playback
comma
dot
id|trigger
op_assign
id|snd_ca0106_pcm_trigger_playback
comma
dot
id|pointer
op_assign
id|snd_ca0106_pcm_pointer_playback
comma
)brace
suffix:semicolon
DECL|variable|snd_ca0106_capture_0_ops
r_static
id|snd_pcm_ops_t
id|snd_ca0106_capture_0_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_ca0106_pcm_open_0_capture
comma
dot
id|close
op_assign
id|snd_ca0106_pcm_close_capture
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_ca0106_pcm_hw_params_capture
comma
dot
id|hw_free
op_assign
id|snd_ca0106_pcm_hw_free_capture
comma
dot
id|prepare
op_assign
id|snd_ca0106_pcm_prepare_capture
comma
dot
id|trigger
op_assign
id|snd_ca0106_pcm_trigger_capture
comma
dot
id|pointer
op_assign
id|snd_ca0106_pcm_pointer_capture
comma
)brace
suffix:semicolon
DECL|variable|snd_ca0106_capture_1_ops
r_static
id|snd_pcm_ops_t
id|snd_ca0106_capture_1_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_ca0106_pcm_open_1_capture
comma
dot
id|close
op_assign
id|snd_ca0106_pcm_close_capture
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_ca0106_pcm_hw_params_capture
comma
dot
id|hw_free
op_assign
id|snd_ca0106_pcm_hw_free_capture
comma
dot
id|prepare
op_assign
id|snd_ca0106_pcm_prepare_capture
comma
dot
id|trigger
op_assign
id|snd_ca0106_pcm_trigger_capture
comma
dot
id|pointer
op_assign
id|snd_ca0106_pcm_pointer_capture
comma
)brace
suffix:semicolon
DECL|variable|snd_ca0106_capture_2_ops
r_static
id|snd_pcm_ops_t
id|snd_ca0106_capture_2_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_ca0106_pcm_open_2_capture
comma
dot
id|close
op_assign
id|snd_ca0106_pcm_close_capture
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_ca0106_pcm_hw_params_capture
comma
dot
id|hw_free
op_assign
id|snd_ca0106_pcm_hw_free_capture
comma
dot
id|prepare
op_assign
id|snd_ca0106_pcm_prepare_capture
comma
dot
id|trigger
op_assign
id|snd_ca0106_pcm_trigger_capture
comma
dot
id|pointer
op_assign
id|snd_ca0106_pcm_pointer_capture
comma
)brace
suffix:semicolon
DECL|variable|snd_ca0106_capture_3_ops
r_static
id|snd_pcm_ops_t
id|snd_ca0106_capture_3_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_ca0106_pcm_open_3_capture
comma
dot
id|close
op_assign
id|snd_ca0106_pcm_close_capture
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_ca0106_pcm_hw_params_capture
comma
dot
id|hw_free
op_assign
id|snd_ca0106_pcm_hw_free_capture
comma
dot
id|prepare
op_assign
id|snd_ca0106_pcm_prepare_capture
comma
dot
id|trigger
op_assign
id|snd_ca0106_pcm_trigger_capture
comma
dot
id|pointer
op_assign
id|snd_ca0106_pcm_pointer_capture
comma
)brace
suffix:semicolon
DECL|variable|snd_ca0106_playback_center_lfe_ops
r_static
id|snd_pcm_ops_t
id|snd_ca0106_playback_center_lfe_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_ca0106_pcm_open_playback_center_lfe
comma
dot
id|close
op_assign
id|snd_ca0106_pcm_close_playback
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_ca0106_pcm_hw_params_playback
comma
dot
id|hw_free
op_assign
id|snd_ca0106_pcm_hw_free_playback
comma
dot
id|prepare
op_assign
id|snd_ca0106_pcm_prepare_playback
comma
dot
id|trigger
op_assign
id|snd_ca0106_pcm_trigger_playback
comma
dot
id|pointer
op_assign
id|snd_ca0106_pcm_pointer_playback
comma
)brace
suffix:semicolon
DECL|variable|snd_ca0106_playback_unknown_ops
r_static
id|snd_pcm_ops_t
id|snd_ca0106_playback_unknown_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_ca0106_pcm_open_playback_unknown
comma
dot
id|close
op_assign
id|snd_ca0106_pcm_close_playback
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_ca0106_pcm_hw_params_playback
comma
dot
id|hw_free
op_assign
id|snd_ca0106_pcm_hw_free_playback
comma
dot
id|prepare
op_assign
id|snd_ca0106_pcm_prepare_playback
comma
dot
id|trigger
op_assign
id|snd_ca0106_pcm_trigger_playback
comma
dot
id|pointer
op_assign
id|snd_ca0106_pcm_pointer_playback
comma
)brace
suffix:semicolon
DECL|variable|snd_ca0106_playback_rear_ops
r_static
id|snd_pcm_ops_t
id|snd_ca0106_playback_rear_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_ca0106_pcm_open_playback_rear
comma
dot
id|close
op_assign
id|snd_ca0106_pcm_close_playback
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_ca0106_pcm_hw_params_playback
comma
dot
id|hw_free
op_assign
id|snd_ca0106_pcm_hw_free_playback
comma
dot
id|prepare
op_assign
id|snd_ca0106_pcm_prepare_playback
comma
dot
id|trigger
op_assign
id|snd_ca0106_pcm_trigger_playback
comma
dot
id|pointer
op_assign
id|snd_ca0106_pcm_pointer_playback
comma
)brace
suffix:semicolon
DECL|function|snd_ca0106_ac97_read
r_static
r_int
r_int
id|snd_ca0106_ac97_read
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
)paren
(brace
id|ca0106_t
op_star
id|emu
op_assign
id|ac97-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
id|reg
comma
id|emu-&gt;port
op_plus
id|AC97ADDRESS
)paren
suffix:semicolon
id|val
op_assign
id|inw
c_func
(paren
id|emu-&gt;port
op_plus
id|AC97DATA
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
DECL|function|snd_ca0106_ac97_write
r_static
r_void
id|snd_ca0106_ac97_write
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
id|ca0106_t
op_star
id|emu
op_assign
id|ac97-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
id|reg
comma
id|emu-&gt;port
op_plus
id|AC97ADDRESS
)paren
suffix:semicolon
id|outw
c_func
(paren
id|val
comma
id|emu-&gt;port
op_plus
id|AC97DATA
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_ca0106_ac97
r_static
r_int
id|snd_ca0106_ac97
c_func
(paren
id|ca0106_t
op_star
id|chip
)paren
(brace
id|ac97_bus_t
op_star
id|pbus
suffix:semicolon
id|ac97_template_t
id|ac97
suffix:semicolon
r_int
id|err
suffix:semicolon
r_static
id|ac97_bus_ops_t
id|ops
op_assign
(brace
dot
id|write
op_assign
id|snd_ca0106_ac97_write
comma
dot
id|read
op_assign
id|snd_ca0106_ac97_read
comma
)brace
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_bus
c_func
(paren
id|chip-&gt;card
comma
l_int|0
comma
op_amp
id|ops
comma
l_int|NULL
comma
op_amp
id|pbus
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ac97
comma
l_int|0
comma
r_sizeof
(paren
id|ac97
)paren
)paren
suffix:semicolon
id|ac97.private_data
op_assign
id|chip
suffix:semicolon
r_return
id|snd_ac97_mixer
c_func
(paren
id|pbus
comma
op_amp
id|ac97
comma
op_amp
id|chip-&gt;ac97
)paren
suffix:semicolon
)brace
DECL|function|snd_ca0106_free
r_static
r_int
id|snd_ca0106_free
c_func
(paren
id|ca0106_t
op_star
id|chip
)paren
(brace
r_if
c_cond
(paren
id|chip-&gt;res_port
op_ne
l_int|NULL
)paren
(brace
multiline_comment|/* avoid access to already used hardware */
singleline_comment|// disable interrupts
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|BASIC_INTERRUPT
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|chip-&gt;port
op_plus
id|INTE
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|EXTENDED_INT_MASK
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
singleline_comment|// disable audio
singleline_comment|//outl(HCFG_LOCKSOUNDCACHE, chip-&gt;port + HCFG);
id|outl
c_func
(paren
l_int|0
comma
id|chip-&gt;port
op_plus
id|HCFG
)paren
suffix:semicolon
multiline_comment|/* FIXME: We need to stop and DMA transfers here.&n;&t;&t; *        But as I am not sure how yet, we cannot from the dma pages.&n;&t;&t; * So we can fix: snd-malloc: Memory leak?  pages not freed = 8&n;&t;&t; */
)brace
singleline_comment|// release the data
macro_line|#if 1
r_if
c_cond
(paren
id|chip-&gt;buffer.area
)paren
id|snd_dma_free_pages
c_func
(paren
op_amp
id|chip-&gt;buffer
)paren
suffix:semicolon
macro_line|#endif
singleline_comment|// release the i/o port
r_if
c_cond
(paren
id|chip-&gt;res_port
)paren
(brace
id|release_resource
c_func
(paren
id|chip-&gt;res_port
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|chip-&gt;res_port
)paren
suffix:semicolon
)brace
singleline_comment|// release the irq
r_if
c_cond
(paren
id|chip-&gt;irq
op_ge
l_int|0
)paren
id|free_irq
c_func
(paren
id|chip-&gt;irq
comma
(paren
r_void
op_star
)paren
id|chip
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|chip-&gt;pci
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ca0106_dev_free
r_static
r_int
id|snd_ca0106_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|ca0106_t
op_star
id|chip
op_assign
id|device-&gt;device_data
suffix:semicolon
r_return
id|snd_ca0106_free
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
DECL|function|snd_ca0106_interrupt
r_static
id|irqreturn_t
id|snd_ca0106_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|status
suffix:semicolon
id|ca0106_t
op_star
id|chip
op_assign
id|dev_id
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|mask
suffix:semicolon
r_int
r_int
id|stat76
suffix:semicolon
id|ca0106_channel_t
op_star
id|pchannel
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;emu_lock
)paren
suffix:semicolon
id|status
op_assign
id|inl
c_func
(paren
id|chip-&gt;port
op_plus
id|IPR
)paren
suffix:semicolon
singleline_comment|// call updater, unlock before it
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;emu_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
r_return
id|IRQ_NONE
suffix:semicolon
id|stat76
op_assign
id|snd_ca0106_ptr_read
c_func
(paren
id|chip
comma
id|EXTENDED_INT
comma
l_int|0
)paren
suffix:semicolon
singleline_comment|//snd_printk(&quot;interrupt status = 0x%08x, stat76=0x%08x&bslash;n&quot;, status, stat76);
singleline_comment|//snd_printk(&quot;ptr=0x%08x&bslash;n&quot;,snd_ca0106_ptr_read(chip, PLAYBACK_POINTER, 0));
id|mask
op_assign
l_int|0x11
suffix:semicolon
multiline_comment|/* 0x1 for one half, 0x10 for the other half period. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pchannel
op_assign
op_amp
(paren
id|chip-&gt;playback_channels
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat76
op_amp
id|mask
)paren
(brace
multiline_comment|/* FIXME: Select the correct substream for period elapsed */
r_if
c_cond
(paren
id|pchannel-&gt;use
)paren
(brace
id|snd_pcm_period_elapsed
c_func
(paren
id|pchannel-&gt;epcm-&gt;substream
)paren
suffix:semicolon
singleline_comment|//printk(KERN_INFO &quot;interrupt [%d] used&bslash;n&quot;, i);
)brace
)brace
singleline_comment|//printk(KERN_INFO &quot;channel=%p&bslash;n&quot;,pchannel);
singleline_comment|//printk(KERN_INFO &quot;interrupt stat76[%d] = %08x, use=%d, channel=%d&bslash;n&quot;, i, stat76, pchannel-&gt;use, pchannel-&gt;number);
id|mask
op_lshift_assign
l_int|1
suffix:semicolon
)brace
id|mask
op_assign
l_int|0x110000
suffix:semicolon
multiline_comment|/* 0x1 for one half, 0x10 for the other half period. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pchannel
op_assign
op_amp
(paren
id|chip-&gt;capture_channels
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat76
op_amp
id|mask
)paren
(brace
multiline_comment|/* FIXME: Select the correct substream for period elapsed */
r_if
c_cond
(paren
id|pchannel-&gt;use
)paren
(brace
id|snd_pcm_period_elapsed
c_func
(paren
id|pchannel-&gt;epcm-&gt;substream
)paren
suffix:semicolon
singleline_comment|//printk(KERN_INFO &quot;interrupt [%d] used&bslash;n&quot;, i);
)brace
)brace
singleline_comment|//printk(KERN_INFO &quot;channel=%p&bslash;n&quot;,pchannel);
singleline_comment|//printk(KERN_INFO &quot;interrupt stat76[%d] = %08x, use=%d, channel=%d&bslash;n&quot;, i, stat76, pchannel-&gt;use, pchannel-&gt;number);
id|mask
op_lshift_assign
l_int|1
suffix:semicolon
)brace
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|EXTENDED_INT
comma
l_int|0
comma
id|stat76
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;emu_lock
)paren
suffix:semicolon
singleline_comment|// acknowledge the interrupt if necessary
id|outl
c_func
(paren
id|status
comma
id|chip-&gt;port
op_plus
id|IPR
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;emu_lock
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|snd_ca0106_pcm_free
r_static
r_void
id|snd_ca0106_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|ca0106_t
op_star
id|emu
op_assign
id|pcm-&gt;private_data
suffix:semicolon
id|emu-&gt;pcm
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_ca0106_pcm
r_static
r_int
id|__devinit
id|snd_ca0106_pcm
c_func
(paren
id|ca0106_t
op_star
id|emu
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
id|snd_pcm_substream_t
op_star
id|substream
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|emu-&gt;card
comma
l_string|&quot;ca0106&quot;
comma
id|device
comma
l_int|1
comma
l_int|1
comma
op_amp
id|pcm
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|emu
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_ca0106_pcm_free
suffix:semicolon
r_switch
c_cond
(paren
id|device
)paren
(brace
r_case
l_int|0
suffix:colon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_ca0106_playback_front_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_ca0106_capture_0_ops
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_ca0106_playback_rear_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_ca0106_capture_1_ops
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_ca0106_playback_center_lfe_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_ca0106_capture_2_ops
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_ca0106_playback_unknown_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_ca0106_capture_3_ops
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|pcm-&gt;dev_subclass
op_assign
id|SNDRV_PCM_SUBCLASS_GENERIC_MIX
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;CA0106&quot;
)paren
suffix:semicolon
id|emu-&gt;pcm
op_assign
id|pcm
suffix:semicolon
r_for
c_loop
(paren
id|substream
op_assign
id|pcm-&gt;streams
(braket
id|SNDRV_PCM_STREAM_PLAYBACK
)braket
dot
id|substream
suffix:semicolon
id|substream
suffix:semicolon
id|substream
op_assign
id|substream-&gt;next
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_lib_preallocate_pages
c_func
(paren
id|substream
comma
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|emu-&gt;pci
)paren
comma
l_int|64
op_star
l_int|1024
comma
l_int|64
op_star
l_int|1024
)paren
)paren
OL
l_int|0
)paren
multiline_comment|/* FIXME: 32*1024 for sound buffer, between 32and64 for Periods table. */
r_return
id|err
suffix:semicolon
)brace
r_for
c_loop
(paren
id|substream
op_assign
id|pcm-&gt;streams
(braket
id|SNDRV_PCM_STREAM_CAPTURE
)braket
dot
id|substream
suffix:semicolon
id|substream
suffix:semicolon
id|substream
op_assign
id|substream-&gt;next
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_lib_preallocate_pages
c_func
(paren
id|substream
comma
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|emu-&gt;pci
)paren
comma
l_int|64
op_star
l_int|1024
comma
l_int|64
op_star
l_int|1024
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ca0106_create
r_static
r_int
id|__devinit
id|snd_ca0106_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_struct
id|pci_dev
op_star
id|pci
comma
id|ca0106_t
op_star
op_star
id|rchip
)paren
(brace
id|ca0106_t
op_star
id|chip
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|ch
suffix:semicolon
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
dot
id|dev_free
op_assign
id|snd_ca0106_dev_free
comma
)brace
suffix:semicolon
op_star
id|rchip
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pci
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|pci_set_dma_mask
c_func
(paren
id|pci
comma
l_int|0xffffffffUL
)paren
OL
l_int|0
op_logical_or
id|pci_set_consistent_dma_mask
c_func
(paren
id|pci
comma
l_int|0xffffffffUL
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;error to set 32bit mask DMA&bslash;n&quot;
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pci
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
id|chip
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|chip
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip
op_eq
l_int|NULL
)paren
(brace
id|pci_disable_device
c_func
(paren
id|pci
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|chip-&gt;card
op_assign
id|card
suffix:semicolon
id|chip-&gt;pci
op_assign
id|pci
suffix:semicolon
id|chip-&gt;irq
op_assign
op_minus
l_int|1
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|chip-&gt;emu_lock
)paren
suffix:semicolon
id|chip-&gt;port
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chip-&gt;res_port
op_assign
id|request_region
c_func
(paren
id|chip-&gt;port
comma
l_int|0x20
comma
l_string|&quot;snd_ca0106&quot;
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_ca0106_free
c_func
(paren
id|chip
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cannot allocate the port&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|pci-&gt;irq
comma
id|snd_ca0106_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
l_string|&quot;snd_ca0106&quot;
comma
(paren
r_void
op_star
)paren
id|chip
)paren
)paren
(brace
id|snd_ca0106_free
c_func
(paren
id|chip
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cannot grab irq&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|chip-&gt;irq
op_assign
id|pci-&gt;irq
suffix:semicolon
multiline_comment|/* This stores the periods table. */
r_if
c_cond
(paren
id|snd_dma_alloc_pages
c_func
(paren
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|pci
)paren
comma
l_int|1024
comma
op_amp
id|chip-&gt;buffer
)paren
OL
l_int|0
)paren
(brace
id|snd_ca0106_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|pci_set_master
c_func
(paren
id|pci
)paren
suffix:semicolon
multiline_comment|/* read revision &amp; serial */
id|pci_read_config_byte
c_func
(paren
id|pci
comma
id|PCI_REVISION_ID
comma
(paren
r_char
op_star
)paren
op_amp
id|chip-&gt;revision
)paren
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|pci
comma
id|PCI_SUBSYSTEM_VENDOR_ID
comma
op_amp
id|chip-&gt;serial
)paren
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pci
comma
id|PCI_SUBSYSTEM_ID
comma
op_amp
id|chip-&gt;model
)paren
suffix:semicolon
macro_line|#if 1
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Model %04x Rev %08x Serial %08x&bslash;n&quot;
comma
id|chip-&gt;model
comma
id|chip-&gt;revision
comma
id|chip-&gt;serial
)paren
suffix:semicolon
macro_line|#endif
id|outl
c_func
(paren
l_int|0
comma
id|chip-&gt;port
op_plus
id|INTE
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Init to 0x02109204 :&n;&t; *  Clock accuracy    = 0     (1000ppm)&n;&t; *  Sample Rate       = 2     (48kHz)&n;&t; *  Audio Channel     = 1     (Left of 2)&n;&t; *  Source Number     = 0     (Unspecified)&n;&t; *  Generation Status = 1     (Original for Cat Code 12)&n;&t; *  Cat Code          = 12    (Digital Signal Mixer)&n;&t; *  Mode              = 0     (Mode 0)&n;&t; *  Emphasis          = 0     (None)&n;&t; *  CP                = 1     (Copyright unasserted)&n;&t; *  AN                = 0     (Audio data)&n;&t; *  P                 = 0     (Consumer)&n;&t; */
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|SPCS0
comma
l_int|0
comma
id|chip-&gt;spdif_bits
(braket
l_int|0
)braket
op_assign
id|SPCS_CLKACCY_1000PPM
op_or
id|SPCS_SAMPLERATE_48
op_or
id|SPCS_CHANNELNUM_LEFT
op_or
id|SPCS_SOURCENUM_UNSPEC
op_or
id|SPCS_GENERATIONSTATUS
op_or
l_int|0x00001200
op_or
l_int|0x00000000
op_or
id|SPCS_EMPHASIS_NONE
op_or
id|SPCS_COPYRIGHT
)paren
suffix:semicolon
multiline_comment|/* Only SPCS1 has been tested */
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|SPCS1
comma
l_int|0
comma
id|chip-&gt;spdif_bits
(braket
l_int|1
)braket
op_assign
id|SPCS_CLKACCY_1000PPM
op_or
id|SPCS_SAMPLERATE_48
op_or
id|SPCS_CHANNELNUM_LEFT
op_or
id|SPCS_SOURCENUM_UNSPEC
op_or
id|SPCS_GENERATIONSTATUS
op_or
l_int|0x00001200
op_or
l_int|0x00000000
op_or
id|SPCS_EMPHASIS_NONE
op_or
id|SPCS_COPYRIGHT
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|SPCS2
comma
l_int|0
comma
id|chip-&gt;spdif_bits
(braket
l_int|2
)braket
op_assign
id|SPCS_CLKACCY_1000PPM
op_or
id|SPCS_SAMPLERATE_48
op_or
id|SPCS_CHANNELNUM_LEFT
op_or
id|SPCS_SOURCENUM_UNSPEC
op_or
id|SPCS_GENERATIONSTATUS
op_or
l_int|0x00001200
op_or
l_int|0x00000000
op_or
id|SPCS_EMPHASIS_NONE
op_or
id|SPCS_COPYRIGHT
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|SPCS3
comma
l_int|0
comma
id|chip-&gt;spdif_bits
(braket
l_int|3
)braket
op_assign
id|SPCS_CLKACCY_1000PPM
op_or
id|SPCS_SAMPLERATE_48
op_or
id|SPCS_CHANNELNUM_LEFT
op_or
id|SPCS_SOURCENUM_UNSPEC
op_or
id|SPCS_GENERATIONSTATUS
op_or
l_int|0x00001200
op_or
l_int|0x00000000
op_or
id|SPCS_EMPHASIS_NONE
op_or
id|SPCS_COPYRIGHT
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|PLAYBACK_MUTE
comma
l_int|0
comma
l_int|0x00fc0000
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|CAPTURE_MUTE
comma
l_int|0
comma
l_int|0x00fc0000
)paren
suffix:semicolon
multiline_comment|/* Write 0x8000 to AC97_REC_GAIN to mute it. */
id|outb
c_func
(paren
id|AC97_REC_GAIN
comma
id|chip-&gt;port
op_plus
id|AC97ADDRESS
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x8000
comma
id|chip-&gt;port
op_plus
id|AC97DATA
)paren
suffix:semicolon
macro_line|#if 0
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|SPCS0
comma
l_int|0
comma
l_int|0x2108006
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
l_int|0x42
comma
l_int|0
comma
l_int|0x2108006
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
l_int|0x43
comma
l_int|0
comma
l_int|0x2108006
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
l_int|0x44
comma
l_int|0
comma
l_int|0x2108006
)paren
suffix:semicolon
macro_line|#endif
singleline_comment|//snd_ca0106_ptr_write(chip, SPDIF_SELECT2, 0, 0xf0f003f); /* OSS drivers set this. */
multiline_comment|/* Analog or Digital output */
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|SPDIF_SELECT1
comma
l_int|0
comma
l_int|0xf
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|SPDIF_SELECT2
comma
l_int|0
comma
l_int|0x000b0000
)paren
suffix:semicolon
multiline_comment|/* 0x0b000000 for digital, 0x000b0000 for analog, from win2000 drivers */
id|chip-&gt;spdif_enable
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Set digital SPDIF output off */
id|chip-&gt;capture_source
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* Set CAPTURE_SOURCE */
singleline_comment|//snd_ca0106_ptr_write(chip, 0x45, 0, 0); /* Analogue out */
singleline_comment|//snd_ca0106_ptr_write(chip, 0x45, 0, 0xf00); /* Digital out */
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|CAPTURE_CONTROL
comma
l_int|0
comma
l_int|0x40c81000
)paren
suffix:semicolon
multiline_comment|/* goes to 0x40c80000 when doing SPDIF IN/OUT */
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|CAPTURE_CONTROL
comma
l_int|1
comma
l_int|0xffffffff
)paren
suffix:semicolon
multiline_comment|/* (Mute) CAPTURE feedback into PLAYBACK volume. Only lower 16 bits matter. */
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|CAPTURE_CONTROL
comma
l_int|2
comma
l_int|0x30300000
)paren
suffix:semicolon
multiline_comment|/* SPDIF IN Volume */
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|CAPTURE_CONTROL
comma
l_int|3
comma
l_int|0x00700000
)paren
suffix:semicolon
multiline_comment|/* SPDIF IN Volume, 0x70 = (vol &amp; 0x3f) | 0x40 */
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|PLAYBACK_ROUTING1
comma
l_int|0
comma
l_int|0x32765410
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|PLAYBACK_ROUTING2
comma
l_int|0
comma
l_int|0x76767676
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|CAPTURE_ROUTING1
comma
l_int|0
comma
l_int|0x32765410
)paren
suffix:semicolon
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|CAPTURE_ROUTING2
comma
l_int|0
comma
l_int|0x76767676
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
l_int|4
suffix:semicolon
id|ch
op_increment
)paren
(brace
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|CAPTURE_VOLUME1
comma
id|ch
comma
l_int|0x30303030
)paren
suffix:semicolon
multiline_comment|/* Only high 16 bits matter */
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|CAPTURE_VOLUME2
comma
id|ch
comma
l_int|0x30303030
)paren
suffix:semicolon
singleline_comment|//snd_ca0106_ptr_write(chip, PLAYBACK_VOLUME1, ch, 0x40404040); /* Mute */
singleline_comment|//snd_ca0106_ptr_write(chip, PLAYBACK_VOLUME2, ch, 0x40404040); /* Mute */
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|PLAYBACK_VOLUME1
comma
id|ch
comma
l_int|0xffffffff
)paren
suffix:semicolon
multiline_comment|/* Mute */
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|PLAYBACK_VOLUME2
comma
id|ch
comma
l_int|0xffffffff
)paren
suffix:semicolon
multiline_comment|/* Mute */
)brace
id|snd_ca0106_ptr_write
c_func
(paren
id|chip
comma
id|CAPTURE_SOURCE
comma
l_int|0x0
comma
l_int|0x333300e4
)paren
suffix:semicolon
multiline_comment|/* Select MIC, Line in, TAD in, AUX in */
id|chip-&gt;capture_source
op_assign
l_int|3
suffix:semicolon
multiline_comment|/* Set CAPTURE_SOURCE */
r_if
c_cond
(paren
(paren
id|chip-&gt;serial
op_eq
l_int|0x10061102
)paren
op_logical_or
(paren
id|chip-&gt;serial
op_eq
l_int|0x10071102
)paren
)paren
(brace
multiline_comment|/* The SB0410 and SB0413 use GPIO differently. */
multiline_comment|/* FIXME: Still need to find out what the other GPIO bits do. E.g. For digital spdif out. */
id|outl
c_func
(paren
l_int|0x0
comma
id|chip-&gt;port
op_plus
id|GPIO
)paren
suffix:semicolon
singleline_comment|//outl(0x00f0e000, chip-&gt;port+GPIO); /* Analog */
id|outl
c_func
(paren
l_int|0x005f4300
comma
id|chip-&gt;port
op_plus
id|GPIO
)paren
suffix:semicolon
multiline_comment|/* Analog */
)brace
r_else
(brace
id|outl
c_func
(paren
l_int|0x0
comma
id|chip-&gt;port
op_plus
id|GPIO
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x005f03a3
comma
id|chip-&gt;port
op_plus
id|GPIO
)paren
suffix:semicolon
multiline_comment|/* Analog */
singleline_comment|//outl(0x005f02a2, chip-&gt;port+GPIO);   /* SPDIF */
)brace
id|snd_ca0106_intr_enable
c_func
(paren
id|chip
comma
l_int|0x105
)paren
suffix:semicolon
multiline_comment|/* Win2000 uses 0x1e0 */
singleline_comment|//outl(HCFG_LOCKSOUNDCACHE|HCFG_AUDIOENABLE, chip-&gt;port+HCFG);
singleline_comment|//outl(0x00001409, chip-&gt;port+HCFG); /* 0x1000 causes AC3 to fails. Maybe it effects 24 bit output. */
singleline_comment|//outl(0x00000009, chip-&gt;port+HCFG);
id|outl
c_func
(paren
id|HCFG_AC97
op_or
id|HCFG_AUDIOENABLE
comma
id|chip-&gt;port
op_plus
id|HCFG
)paren
suffix:semicolon
multiline_comment|/* AC97 2.0, Enable outputs. */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|chip
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_ca0106_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
op_star
id|rchip
op_assign
id|chip
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ca0106_probe
r_static
r_int
id|__devinit
id|snd_ca0106_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_const
r_struct
id|pci_device_id
op_star
id|pci_id
)paren
(brace
r_static
r_int
id|dev
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
id|ca0106_t
op_star
id|chip
suffix:semicolon
id|ca0106_names_t
op_star
id|c
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_ge
id|SNDRV_CARDS
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|enable
(braket
id|dev
)braket
)paren
(brace
id|dev
op_increment
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|card
op_assign
id|snd_card_new
c_func
(paren
id|index
(braket
id|dev
)braket
comma
id|id
(braket
id|dev
)braket
comma
id|THIS_MODULE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ca0106_create
c_func
(paren
id|card
comma
id|pci
comma
op_amp
id|chip
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ca0106_pcm
c_func
(paren
id|chip
comma
l_int|0
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ca0106_pcm
c_func
(paren
id|chip
comma
l_int|1
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ca0106_pcm
c_func
(paren
id|chip
comma
l_int|2
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ca0106_pcm
c_func
(paren
id|chip
comma
l_int|3
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|chip-&gt;serial
op_ne
l_int|0x10061102
)paren
op_logical_and
(paren
id|chip-&gt;serial
op_ne
l_int|0x10071102
)paren
)paren
(brace
multiline_comment|/* The SB0410 and SB0413 do not have an ac97 chip. */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ca0106_ac97
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ca0106_mixer
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|snd_ca0106_proc_init
c_func
(paren
id|chip
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;CA0106&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;shortname
comma
l_string|&quot;CA0106&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|c
op_assign
id|ca0106_chip_names
suffix:semicolon
id|c-&gt;serial
suffix:semicolon
id|c
op_increment
)paren
(brace
r_if
c_cond
(paren
id|c-&gt;serial
op_eq
id|chip-&gt;serial
)paren
r_break
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;%s at 0x%lx irq %i&quot;
comma
id|c-&gt;name
comma
id|chip-&gt;port
comma
id|chip-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_card_register
c_func
(paren
id|card
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pci
comma
id|card
)paren
suffix:semicolon
id|dev
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ca0106_remove
r_static
r_void
id|__devexit
id|snd_ca0106_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
id|snd_card_free
c_func
(paren
id|pci_get_drvdata
c_func
(paren
id|pci
)paren
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci
comma
l_int|NULL
)paren
suffix:semicolon
)brace
singleline_comment|// PCI IDs
DECL|variable|snd_ca0106_ids
r_static
r_struct
id|pci_device_id
id|snd_ca0106_ids
(braket
)braket
op_assign
(brace
(brace
l_int|0x1102
comma
l_int|0x0007
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* Audigy LS or Live 24bit */
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|snd_ca0106_ids
)paren
suffix:semicolon
singleline_comment|// pci_driver definition
DECL|variable|driver
r_static
r_struct
id|pci_driver
id|driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;CA0106&quot;
comma
dot
id|id_table
op_assign
id|snd_ca0106_ids
comma
dot
id|probe
op_assign
id|snd_ca0106_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|snd_ca0106_remove
)paren
comma
)brace
suffix:semicolon
singleline_comment|// initialization of the module
DECL|function|alsa_card_ca0106_init
r_static
r_int
id|__init
id|alsa_card_ca0106_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_module_init
c_func
(paren
op_amp
id|driver
)paren
)paren
OG
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
singleline_comment|// clean up the module
DECL|function|alsa_card_ca0106_exit
r_static
r_void
id|__exit
id|alsa_card_ca0106_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|alsa_card_ca0106_init
)paren
id|module_exit
c_func
(paren
id|alsa_card_ca0106_exit
)paren
eof
