multiline_comment|/*&n; *   ALSA driver for VIA VT82C686A (South Bridge)&n; *&n; *&t;Copyright (c) 2000 Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
macro_line|#include &lt;sound/pcm_sgbuf.h&gt;
macro_line|#include &lt;sound/pcm_params.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#include &lt;sound/ac97_codec.h&gt;
macro_line|#include &lt;sound/mpu401.h&gt;
DECL|macro|SNDRV_GET_ID
mdefine_line|#define SNDRV_GET_ID
macro_line|#include &lt;sound/initval.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jaroslav Kysela &lt;perex@suse.cz&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;VIA VT82C686A&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_CLASSES
c_func
(paren
l_string|&quot;{sound}&quot;
)paren
suffix:semicolon
id|MODULE_DEVICES
c_func
(paren
l_string|&quot;{{VIA,VT82C686A,pci},{VIA,VT82C686B}}&quot;
)paren
suffix:semicolon
DECL|variable|snd_index
r_static
r_int
id|snd_index
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_IDX
suffix:semicolon
multiline_comment|/* Index 0-MAX */
DECL|variable|snd_id
r_static
r_char
op_star
id|snd_id
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_STR
suffix:semicolon
multiline_comment|/* ID for this card */
DECL|variable|snd_enable
r_static
r_int
id|snd_enable
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_ENABLE_PNP
suffix:semicolon
multiline_comment|/* Enable this card */
DECL|variable|snd_mpu_port
r_static
r_int
id|snd_mpu_port
(braket
id|SNDRV_CARDS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
(paren
id|SNDRV_CARDS
op_minus
l_int|1
)paren
)braket
op_assign
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|snd_ac97_clock
r_static
r_int
id|snd_ac97_clock
(braket
id|SNDRV_CARDS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
(paren
id|SNDRV_CARDS
op_minus
l_int|1
)paren
)braket
op_assign
l_int|48000
)brace
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_index
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_index
comma
l_string|&quot;Index value for VIA 82C686A bridge.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_index
comma
id|SNDRV_INDEX_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_id
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_id
comma
l_string|&quot;ID string for VIA 82C686A bridge.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_id
comma
id|SNDRV_ID_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_enable
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_enable
comma
l_string|&quot;Enable audio part of VIA 82C686A bridge.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_enable
comma
id|SNDRV_ENABLE_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_mpu_port
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;l&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_mpu_port
comma
l_string|&quot;MPU-401 port.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_mpu_port
comma
id|SNDRV_PORT_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_ac97_clock
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;l&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_ac97_clock
comma
l_string|&quot;AC&squot;97 codec clock (default 48000Hz).&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_ac97_clock
comma
id|SNDRV_ENABLED
l_string|&quot;,default:48000&quot;
)paren
suffix:semicolon
multiline_comment|/*&n; *  Direct registers&n; */
macro_line|#ifndef PCI_DEVICE_ID_VIA_82C686_5
DECL|macro|PCI_DEVICE_ID_VIA_82C686_5
mdefine_line|#define PCI_DEVICE_ID_VIA_82C686_5&t;0x3058
macro_line|#endif
DECL|macro|VIAREG
mdefine_line|#define VIAREG(via, x) ((via)-&gt;port + VIA_REG_##x)
multiline_comment|/* offsets */
DECL|macro|VIA_REG_OFFSET_STATUS
mdefine_line|#define VIA_REG_OFFSET_STATUS&t;&t;0x00&t;/* byte - channel status */
DECL|macro|VIA_REG_STAT_ACTIVE
mdefine_line|#define   VIA_REG_STAT_ACTIVE&t;&t;0x80&t;/* RO */
DECL|macro|VIA_REG_STAT_PAUSED
mdefine_line|#define   VIA_REG_STAT_PAUSED&t;&t;0x40&t;/* RO */
DECL|macro|VIA_REG_STAT_TRIGGER_QUEUED
mdefine_line|#define   VIA_REG_STAT_TRIGGER_QUEUED&t;0x08&t;/* RO */
DECL|macro|VIA_REG_STAT_STOPPED
mdefine_line|#define   VIA_REG_STAT_STOPPED&t;&t;0x04&t;/* RWC */
DECL|macro|VIA_REG_STAT_EOL
mdefine_line|#define   VIA_REG_STAT_EOL&t;&t;0x02&t;/* RWC */
DECL|macro|VIA_REG_STAT_FLAG
mdefine_line|#define   VIA_REG_STAT_FLAG&t;&t;0x01&t;/* RWC */
DECL|macro|VIA_REG_OFFSET_CONTROL
mdefine_line|#define VIA_REG_OFFSET_CONTROL&t;&t;0x01&t;/* byte - channel control */
DECL|macro|VIA_REG_CTRL_START
mdefine_line|#define   VIA_REG_CTRL_START&t;&t;0x80&t;/* WO */
DECL|macro|VIA_REG_CTRL_TERMINATE
mdefine_line|#define   VIA_REG_CTRL_TERMINATE&t;0x40&t;/* WO */
DECL|macro|VIA_REG_CTRL_PAUSE
mdefine_line|#define   VIA_REG_CTRL_PAUSE&t;&t;0x08&t;/* RW */
DECL|macro|VIA_REG_CTRL_RESET
mdefine_line|#define   VIA_REG_CTRL_RESET&t;&t;0x01&t;/* RW - probably reset? undocumented */
DECL|macro|VIA_REG_OFFSET_TYPE
mdefine_line|#define VIA_REG_OFFSET_TYPE&t;&t;0x02&t;/* byte - channel type */
DECL|macro|VIA_REG_TYPE_AUTOSTART
mdefine_line|#define   VIA_REG_TYPE_AUTOSTART&t;0x80&t;/* RW - autostart at EOL */
DECL|macro|VIA_REG_TYPE_16BIT
mdefine_line|#define   VIA_REG_TYPE_16BIT&t;&t;0x20&t;/* RW */
DECL|macro|VIA_REG_TYPE_STEREO
mdefine_line|#define   VIA_REG_TYPE_STEREO&t;&t;0x10&t;/* RW */
DECL|macro|VIA_REG_TYPE_INT_LLINE
mdefine_line|#define   VIA_REG_TYPE_INT_LLINE&t;0x00
DECL|macro|VIA_REG_TYPE_INT_LSAMPLE
mdefine_line|#define   VIA_REG_TYPE_INT_LSAMPLE&t;0x04
DECL|macro|VIA_REG_TYPE_INT_LESSONE
mdefine_line|#define   VIA_REG_TYPE_INT_LESSONE&t;0x08
DECL|macro|VIA_REG_TYPE_INT_MASK
mdefine_line|#define   VIA_REG_TYPE_INT_MASK&t;&t;0x0c
DECL|macro|VIA_REG_TYPE_INT_EOL
mdefine_line|#define   VIA_REG_TYPE_INT_EOL&t;&t;0x02
DECL|macro|VIA_REG_TYPE_INT_FLAG
mdefine_line|#define   VIA_REG_TYPE_INT_FLAG&t;&t;0x01
DECL|macro|VIA_REG_OFFSET_TABLE_PTR
mdefine_line|#define VIA_REG_OFFSET_TABLE_PTR&t;0x04&t;/* dword - channel table pointer */
DECL|macro|VIA_REG_OFFSET_CURR_PTR
mdefine_line|#define VIA_REG_OFFSET_CURR_PTR&t;&t;0x04&t;/* dword - channel current pointer */
DECL|macro|VIA_REG_OFFSET_CURR_COUNT
mdefine_line|#define VIA_REG_OFFSET_CURR_COUNT&t;0x0c&t;/* dword - channel current count */
multiline_comment|/* playback block */
DECL|macro|VIA_REG_PLAYBACK_STATUS
mdefine_line|#define VIA_REG_PLAYBACK_STATUS&t;&t;0x00&t;/* byte - channel status */
DECL|macro|VIA_REG_PLAYBACK_CONTROL
mdefine_line|#define VIA_REG_PLAYBACK_CONTROL&t;0x01&t;/* byte - channel control */
DECL|macro|VIA_REG_PLAYBACK_TYPE
mdefine_line|#define VIA_REG_PLAYBACK_TYPE&t;&t;0x02&t;/* byte - channel type */
DECL|macro|VIA_REG_PLAYBACK_TABLE_PTR
mdefine_line|#define VIA_REG_PLAYBACK_TABLE_PTR&t;0x04&t;/* dword - channel table pointer */
DECL|macro|VIA_REG_PLAYBACK_CURR_PTR
mdefine_line|#define VIA_REG_PLAYBACK_CURR_PTR&t;0x04&t;/* dword - channel current pointer */
DECL|macro|VIA_REG_PLAYBACK_CURR_COUNT
mdefine_line|#define VIA_REG_PLAYBACK_CURR_COUNT&t;0x0c&t;/* dword - channel current count */
multiline_comment|/* capture block */
DECL|macro|VIA_REG_CAPTURE_STATUS
mdefine_line|#define VIA_REG_CAPTURE_STATUS&t;&t;0x10&t;/* byte - channel status */
DECL|macro|VIA_REG_CAPTURE_CONTROL
mdefine_line|#define VIA_REG_CAPTURE_CONTROL&t;&t;0x11&t;/* byte - channel control */
DECL|macro|VIA_REG_CAPTURE_TYPE
mdefine_line|#define VIA_REG_CAPTURE_TYPE&t;&t;0x12&t;/* byte - channel type */
DECL|macro|VIA_REG_CAPTURE_TABLE_PTR
mdefine_line|#define VIA_REG_CAPTURE_TABLE_PTR&t;0x14&t;/* dword - channel table pointer */
DECL|macro|VIA_REG_CAPTURE_CURR_PTR
mdefine_line|#define VIA_REG_CAPTURE_CURR_PTR&t;0x14&t;/* dword - channel current pointer */
DECL|macro|VIA_REG_CAPTURE_CURR_COUNT
mdefine_line|#define VIA_REG_CAPTURE_CURR_COUNT&t;0x1c&t;/* dword - channel current count */
multiline_comment|/* FM block */
DECL|macro|VIA_REG_FM_STATUS
mdefine_line|#define VIA_REG_FM_STATUS&t;&t;0x20&t;/* byte - channel status */
DECL|macro|VIA_REG_FM_CONTROL
mdefine_line|#define VIA_REG_FM_CONTROL&t;&t;0x21&t;/* byte - channel control */
DECL|macro|VIA_REG_FM_TYPE
mdefine_line|#define VIA_REG_FM_TYPE&t;&t;&t;0x22&t;/* byte - channel type */
DECL|macro|VIA_REG_FM_TABLE_PTR
mdefine_line|#define VIA_REG_FM_TABLE_PTR&t;&t;0x24&t;/* dword - channel table pointer */
DECL|macro|VIA_REG_FM_CURR_PTR
mdefine_line|#define VIA_REG_FM_CURR_PTR&t;&t;0x24&t;/* dword - channel current pointer */
DECL|macro|VIA_REG_FM_CURR_COUNT
mdefine_line|#define VIA_REG_FM_CURR_COUNT&t;&t;0x2c&t;/* dword - channel current count */
multiline_comment|/* AC&squot;97 */
DECL|macro|VIA_REG_AC97
mdefine_line|#define VIA_REG_AC97&t;&t;&t;0x80&t;/* dword */
DECL|macro|VIA_REG_AC97_CODEC_ID_MASK
mdefine_line|#define   VIA_REG_AC97_CODEC_ID_MASK&t;(3&lt;&lt;30)
DECL|macro|VIA_REG_AC97_CODEC_ID_SHIFT
mdefine_line|#define   VIA_REG_AC97_CODEC_ID_SHIFT&t;30
DECL|macro|VIA_REG_AC97_CODEC_ID_PRIMARY
mdefine_line|#define   VIA_REG_AC97_CODEC_ID_PRIMARY&t;0x00
DECL|macro|VIA_REG_AC97_CODEC_ID_SECONDARY
mdefine_line|#define   VIA_REG_AC97_CODEC_ID_SECONDARY 0x01
DECL|macro|VIA_REG_AC97_SECONDARY_VALID
mdefine_line|#define   VIA_REG_AC97_SECONDARY_VALID&t;(1&lt;&lt;27)
DECL|macro|VIA_REG_AC97_PRIMARY_VALID
mdefine_line|#define   VIA_REG_AC97_PRIMARY_VALID&t;(1&lt;&lt;25)
DECL|macro|VIA_REG_AC97_BUSY
mdefine_line|#define   VIA_REG_AC97_BUSY&t;&t;(1&lt;&lt;24)
DECL|macro|VIA_REG_AC97_READ
mdefine_line|#define   VIA_REG_AC97_READ&t;&t;(1&lt;&lt;23)
DECL|macro|VIA_REG_AC97_CMD_SHIFT
mdefine_line|#define   VIA_REG_AC97_CMD_SHIFT&t;16
DECL|macro|VIA_REG_AC97_CMD_MASK
mdefine_line|#define   VIA_REG_AC97_CMD_MASK&t;&t;0x7e
DECL|macro|VIA_REG_AC97_DATA_SHIFT
mdefine_line|#define   VIA_REG_AC97_DATA_SHIFT&t;0
DECL|macro|VIA_REG_AC97_DATA_MASK
mdefine_line|#define   VIA_REG_AC97_DATA_MASK&t;0xffff
DECL|macro|VIA_REG_SGD_SHADOW
mdefine_line|#define VIA_REG_SGD_SHADOW&t;&t;0x84&t;/* dword */
DECL|macro|VIA_TBL_BIT_FLAG
mdefine_line|#define VIA_TBL_BIT_FLAG&t;0x40000000
DECL|macro|VIA_TBL_BIT_EOL
mdefine_line|#define VIA_TBL_BIT_EOL&t;&t;0x80000000
multiline_comment|/*&n; * pcm stream&n; */
r_typedef
r_struct
(brace
DECL|member|reg_offset
r_int
r_int
id|reg_offset
suffix:semicolon
DECL|member|substream
id|snd_pcm_substream_t
op_star
id|substream
suffix:semicolon
DECL|member|running
r_int
id|running
suffix:semicolon
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
DECL|member|fragsize
r_int
r_int
id|fragsize
suffix:semicolon
DECL|member|frags
r_int
r_int
id|frags
suffix:semicolon
DECL|member|lastptr
r_int
r_int
id|lastptr
suffix:semicolon
DECL|member|lastcount
r_int
r_int
id|lastcount
suffix:semicolon
DECL|member|page_per_frag
r_int
r_int
id|page_per_frag
suffix:semicolon
DECL|member|curidx
r_int
r_int
id|curidx
suffix:semicolon
DECL|member|tbl_entries
r_int
r_int
id|tbl_entries
suffix:semicolon
multiline_comment|/* number of descriptor table entries */
DECL|member|tbl_size
r_int
r_int
id|tbl_size
suffix:semicolon
multiline_comment|/* size of a table entry */
DECL|member|table
id|u32
op_star
id|table
suffix:semicolon
multiline_comment|/* physical address + flag */
DECL|member|table_addr
id|dma_addr_t
id|table_addr
suffix:semicolon
DECL|typedef|viadev_t
)brace
id|viadev_t
suffix:semicolon
DECL|function|build_via_table
r_static
r_int
id|build_via_table
c_func
(paren
id|viadev_t
op_star
id|dev
comma
id|snd_pcm_substream_t
op_star
id|substream
comma
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
r_int
id|i
comma
id|size
suffix:semicolon
r_struct
id|snd_sg_buf
op_star
id|sgbuf
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_pcm_sgbuf_t
comma
id|substream-&gt;dma_private
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;table
)paren
(brace
id|snd_free_pci_pages
c_func
(paren
id|pci
comma
id|PAGE_ALIGN
c_func
(paren
id|dev-&gt;tbl_entries
op_star
l_int|8
)paren
comma
id|dev-&gt;table
comma
id|dev-&gt;table_addr
)paren
suffix:semicolon
id|dev-&gt;table
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* allocate buffer descriptor lists */
r_if
c_cond
(paren
id|dev-&gt;fragsize
OL
id|PAGE_SIZE
)paren
(brace
id|dev-&gt;tbl_size
op_assign
id|dev-&gt;fragsize
suffix:semicolon
id|dev-&gt;tbl_entries
op_assign
id|dev-&gt;frags
suffix:semicolon
id|dev-&gt;page_per_frag
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|dev-&gt;tbl_size
op_assign
id|PAGE_SIZE
suffix:semicolon
id|dev-&gt;tbl_entries
op_assign
id|sgbuf-&gt;pages
suffix:semicolon
id|dev-&gt;page_per_frag
op_assign
id|dev-&gt;fragsize
op_rshift
id|PAGE_SHIFT
suffix:semicolon
)brace
multiline_comment|/* the start of each lists must be aligned to 8 bytes,&n;&t; * but the kernel pages are much bigger, so we don&squot;t care&n;&t; */
id|dev-&gt;table
op_assign
(paren
id|u32
op_star
)paren
id|snd_malloc_pci_pages
c_func
(paren
id|pci
comma
id|PAGE_ALIGN
c_func
(paren
id|dev-&gt;tbl_entries
op_star
l_int|8
)paren
comma
op_amp
id|dev-&gt;table_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;table
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;tbl_size
OL
id|PAGE_SIZE
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;tbl_entries
suffix:semicolon
id|i
op_increment
)paren
id|dev-&gt;table
(braket
id|i
op_lshift
l_int|1
)braket
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|u32
)paren
id|sgbuf-&gt;table
(braket
l_int|0
)braket
dot
id|addr
op_plus
id|dev-&gt;fragsize
op_star
id|i
)paren
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;tbl_entries
suffix:semicolon
id|i
op_increment
)paren
id|dev-&gt;table
(braket
id|i
op_lshift
l_int|1
)braket
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|u32
)paren
id|sgbuf-&gt;table
(braket
id|i
)braket
dot
id|addr
)paren
suffix:semicolon
)brace
id|size
op_assign
id|dev-&gt;size
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dev-&gt;tbl_entries
op_minus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev-&gt;table
(braket
(paren
id|i
op_lshift
l_int|1
)paren
op_plus
l_int|1
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|VIA_TBL_BIT_FLAG
op_or
id|dev-&gt;tbl_size
)paren
suffix:semicolon
id|size
op_sub_assign
id|dev-&gt;tbl_size
suffix:semicolon
)brace
id|dev-&gt;table
(braket
(paren
id|dev-&gt;tbl_entries
op_lshift
l_int|1
)paren
op_minus
l_int|1
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|VIA_TBL_BIT_EOL
op_or
id|size
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|clean_via_table
r_static
r_void
id|clean_via_table
c_func
(paren
id|viadev_t
op_star
id|dev
comma
id|snd_pcm_substream_t
op_star
id|substream
comma
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;table
)paren
(brace
id|snd_free_pci_pages
c_func
(paren
id|pci
comma
id|PAGE_ALIGN
c_func
(paren
id|dev-&gt;tbl_entries
op_star
l_int|8
)paren
comma
id|dev-&gt;table
comma
id|dev-&gt;table_addr
)paren
suffix:semicolon
id|dev-&gt;table
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; */
DECL|typedef|via686a_t
r_typedef
r_struct
id|_snd_via686a
id|via686a_t
suffix:semicolon
DECL|macro|chip_t
mdefine_line|#define chip_t via686a_t
DECL|struct|_snd_via686a
r_struct
id|_snd_via686a
(brace
DECL|member|irq
r_int
id|irq
suffix:semicolon
DECL|member|port
r_int
r_int
id|port
suffix:semicolon
DECL|member|res_port
r_struct
id|resource
op_star
id|res_port
suffix:semicolon
DECL|member|revision
r_int
r_char
id|revision
suffix:semicolon
DECL|member|old_legacy
r_int
r_char
id|old_legacy
suffix:semicolon
DECL|member|old_legacy_cfg
r_int
r_char
id|old_legacy_cfg
suffix:semicolon
DECL|member|pci
r_struct
id|pci_dev
op_star
id|pci
suffix:semicolon
DECL|member|card
id|snd_card_t
op_star
id|card
suffix:semicolon
DECL|member|pcm
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
multiline_comment|/*snd_pcm_t *pcm_fm;*/
DECL|member|playback
id|viadev_t
id|playback
suffix:semicolon
DECL|member|capture
id|viadev_t
id|capture
suffix:semicolon
multiline_comment|/*viadev_t playback_fm;*/
DECL|member|rmidi
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
DECL|member|ac97
id|ac97_t
op_star
id|ac97
suffix:semicolon
DECL|member|ac97_clock
r_int
r_int
id|ac97_clock
suffix:semicolon
DECL|member|ac97_secondary
r_int
r_int
id|ac97_secondary
suffix:semicolon
multiline_comment|/* secondary AC&squot;97 codec is present */
DECL|member|reg_lock
id|spinlock_t
id|reg_lock
suffix:semicolon
DECL|member|proc_entry
id|snd_info_entry_t
op_star
id|proc_entry
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|snd_via686a_ids
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
l_int|0x1106
comma
l_int|0x3058
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
comma
multiline_comment|/* 686A */
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|snd_via686a_ids
)paren
suffix:semicolon
multiline_comment|/*&n; *  Basic I/O&n; */
DECL|function|snd_via686a_codec_xread
r_static
r_inline
r_int
r_int
id|snd_via686a_codec_xread
c_func
(paren
id|via686a_t
op_star
id|chip
)paren
(brace
r_return
id|inl
c_func
(paren
id|VIAREG
c_func
(paren
id|chip
comma
id|AC97
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_via686a_codec_xwrite
r_static
r_inline
r_void
id|snd_via686a_codec_xwrite
c_func
(paren
id|via686a_t
op_star
id|chip
comma
r_int
r_int
id|val
)paren
(brace
id|outl
c_func
(paren
id|val
comma
id|VIAREG
c_func
(paren
id|chip
comma
id|AC97
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_via686a_codec_ready
r_static
r_int
id|snd_via686a_codec_ready
c_func
(paren
id|via686a_t
op_star
id|chip
comma
r_int
id|secondary
)paren
(brace
r_int
r_int
id|timeout
op_assign
l_int|1000
suffix:semicolon
multiline_comment|/* 1ms */
r_int
r_int
id|val
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_decrement
OG
l_int|0
)paren
(brace
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|val
op_assign
id|snd_via686a_codec_xread
c_func
(paren
id|chip
)paren
)paren
op_amp
id|VIA_REG_AC97_BUSY
)paren
)paren
r_return
id|val
op_amp
l_int|0xffff
suffix:semicolon
)brace
id|snd_printk
c_func
(paren
l_string|&quot;codec_ready: codec %i is not ready [0x%x]&bslash;n&quot;
comma
id|secondary
comma
id|snd_via686a_codec_xread
c_func
(paren
id|chip
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|snd_via686a_codec_valid
r_static
r_int
id|snd_via686a_codec_valid
c_func
(paren
id|via686a_t
op_star
id|chip
comma
r_int
id|secondary
)paren
(brace
r_int
r_int
id|timeout
op_assign
l_int|1000
suffix:semicolon
multiline_comment|/* 1ms */
r_int
r_int
id|val
suffix:semicolon
r_int
r_int
id|stat
op_assign
op_logical_neg
id|secondary
ques
c_cond
id|VIA_REG_AC97_PRIMARY_VALID
suffix:colon
id|VIA_REG_AC97_SECONDARY_VALID
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_decrement
OG
l_int|0
)paren
(brace
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_assign
id|snd_via686a_codec_xread
c_func
(paren
id|chip
)paren
)paren
op_amp
id|stat
)paren
r_return
id|val
op_amp
l_int|0xffff
suffix:semicolon
)brace
id|snd_printk
c_func
(paren
l_string|&quot;codec_valid: codec %i is not valid [0x%x]&bslash;n&quot;
comma
id|secondary
comma
id|snd_via686a_codec_xread
c_func
(paren
id|chip
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|snd_via686a_codec_wait
r_static
r_void
id|snd_via686a_codec_wait
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
id|via686a_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|via686a_t
comma
id|ac97-&gt;private_data
comma
r_return
)paren
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|snd_via686a_codec_ready
c_func
(paren
id|chip
comma
id|ac97-&gt;num
)paren
suffix:semicolon
multiline_comment|/* here we need to wait fairly for long time.. */
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
)brace
DECL|function|snd_via686a_codec_write
r_static
r_void
id|snd_via686a_codec_write
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
id|via686a_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|via686a_t
comma
id|ac97-&gt;private_data
comma
r_return
)paren
suffix:semicolon
r_int
r_int
id|xval
suffix:semicolon
id|xval
op_assign
op_logical_neg
id|ac97-&gt;num
ques
c_cond
id|VIA_REG_AC97_CODEC_ID_PRIMARY
suffix:colon
id|VIA_REG_AC97_CODEC_ID_SECONDARY
suffix:semicolon
id|xval
op_lshift_assign
id|VIA_REG_AC97_CODEC_ID_SHIFT
suffix:semicolon
id|xval
op_or_assign
id|reg
op_lshift
id|VIA_REG_AC97_CMD_SHIFT
suffix:semicolon
id|xval
op_or_assign
id|val
op_lshift
id|VIA_REG_AC97_DATA_SHIFT
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|snd_via686a_codec_xwrite
c_func
(paren
id|chip
comma
id|xval
)paren
suffix:semicolon
id|snd_via686a_codec_ready
c_func
(paren
id|chip
comma
id|ac97-&gt;num
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
)brace
DECL|function|snd_via686a_codec_read
r_static
r_int
r_int
id|snd_via686a_codec_read
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
)paren
(brace
id|via686a_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|via686a_t
comma
id|ac97-&gt;private_data
comma
r_return
op_complement
l_int|0
)paren
suffix:semicolon
r_int
r_int
id|xval
comma
id|val
op_assign
l_int|0xffff
suffix:semicolon
r_int
id|again
op_assign
l_int|0
suffix:semicolon
id|xval
op_assign
op_logical_neg
id|ac97-&gt;num
ques
c_cond
id|VIA_REG_AC97_CODEC_ID_PRIMARY
suffix:colon
id|VIA_REG_AC97_CODEC_ID_SECONDARY
suffix:semicolon
id|xval
op_lshift_assign
id|VIA_REG_AC97_CODEC_ID_SHIFT
suffix:semicolon
id|xval
op_assign
(paren
op_logical_neg
id|ac97-&gt;num
ques
c_cond
id|VIA_REG_AC97_PRIMARY_VALID
suffix:colon
id|VIA_REG_AC97_SECONDARY_VALID
)paren
suffix:semicolon
id|xval
op_or_assign
id|VIA_REG_AC97_READ
suffix:semicolon
id|xval
op_or_assign
id|reg
op_lshift
id|VIA_REG_AC97_CMD_SHIFT
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|again
op_increment
OG
l_int|3
)paren
(brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0xffff
suffix:semicolon
)brace
id|snd_via686a_codec_xwrite
c_func
(paren
id|chip
comma
id|xval
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_via686a_codec_ready
c_func
(paren
id|chip
comma
id|ac97-&gt;num
)paren
OL
l_int|0
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|snd_via686a_codec_valid
c_func
(paren
id|chip
comma
id|ac97-&gt;num
)paren
op_ge
l_int|0
)paren
(brace
id|udelay
c_func
(paren
l_int|25
)paren
suffix:semicolon
id|val
op_assign
id|snd_via686a_codec_xread
c_func
(paren
id|chip
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|val
op_amp
l_int|0xffff
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_void
id|snd_via686a_channel_print
c_func
(paren
id|via686a_t
op_star
id|chip
comma
id|viadev_t
op_star
id|viadev
)paren
(brace
r_int
r_int
id|port
op_assign
id|chip-&gt;port
op_plus
id|viadev-&gt;reg_offset
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;[0x%x] status = 0x%x, control = 0x%x, type = 0x%x, ptr = 0x%x, count = 0x%x&bslash;n&quot;
comma
id|port
comma
id|inb
c_func
(paren
id|port
op_plus
id|VIA_REG_OFFSET_STATUS
)paren
comma
id|inb
c_func
(paren
id|port
op_plus
id|VIA_REG_OFFSET_CONTROL
)paren
comma
id|inb
c_func
(paren
id|port
op_plus
id|VIA_REG_OFFSET_TYPE
)paren
comma
id|inl
c_func
(paren
id|port
op_plus
id|VIA_REG_OFFSET_CURR_PTR
)paren
comma
id|inl
c_func
(paren
id|port
op_plus
id|VIA_REG_OFFSET_CURR_COUNT
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|snd_via686a_channel_reset
r_static
r_void
id|snd_via686a_channel_reset
c_func
(paren
id|via686a_t
op_star
id|chip
comma
id|viadev_t
op_star
id|viadev
)paren
(brace
r_int
r_int
id|port
op_assign
id|chip-&gt;port
op_plus
id|viadev-&gt;reg_offset
suffix:semicolon
id|outb
c_func
(paren
id|VIA_REG_CTRL_PAUSE
op_or
id|VIA_REG_CTRL_TERMINATE
op_or
id|VIA_REG_CTRL_RESET
comma
id|port
op_plus
id|VIA_REG_OFFSET_CONTROL
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|port
op_plus
id|VIA_REG_OFFSET_CONTROL
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|port
op_plus
id|VIA_REG_OFFSET_STATUS
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|port
op_plus
id|VIA_REG_OFFSET_TYPE
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|port
op_plus
id|VIA_REG_OFFSET_CURR_PTR
)paren
suffix:semicolon
)brace
DECL|function|snd_via686a_trigger
r_static
r_int
id|snd_via686a_trigger
c_func
(paren
id|via686a_t
op_star
id|chip
comma
id|viadev_t
op_star
id|viadev
comma
r_int
id|cmd
)paren
(brace
r_int
r_char
id|val
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|port
op_assign
id|chip-&gt;port
op_plus
id|viadev-&gt;reg_offset
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
id|val
op_assign
id|VIA_REG_CTRL_START
suffix:semicolon
id|viadev-&gt;running
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
id|val
op_assign
id|VIA_REG_CTRL_TERMINATE
op_or
id|VIA_REG_CTRL_RESET
suffix:semicolon
id|viadev-&gt;running
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_PUSH
suffix:colon
id|val
op_assign
id|VIA_REG_CTRL_PAUSE
suffix:semicolon
id|viadev-&gt;running
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_RELEASE
suffix:colon
id|val
op_assign
l_int|0
suffix:semicolon
id|viadev-&gt;running
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|outb
c_func
(paren
id|val
comma
id|port
op_plus
id|VIA_REG_OFFSET_CONTROL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_STOP
)paren
id|snd_via686a_channel_reset
c_func
(paren
id|chip
comma
id|viadev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_via686a_setup_periods
r_static
r_int
id|snd_via686a_setup_periods
c_func
(paren
id|via686a_t
op_star
id|chip
comma
id|viadev_t
op_star
id|viadev
comma
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
r_int
id|port
op_assign
id|chip-&gt;port
op_plus
id|viadev-&gt;reg_offset
suffix:semicolon
r_int
id|v
comma
id|err
suffix:semicolon
id|viadev-&gt;size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|viadev-&gt;fragsize
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|viadev-&gt;frags
op_assign
id|runtime-&gt;periods
suffix:semicolon
id|viadev-&gt;lastptr
op_assign
op_complement
l_int|0
suffix:semicolon
id|viadev-&gt;lastcount
op_assign
op_complement
l_int|0
suffix:semicolon
id|viadev-&gt;curidx
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* the period size must be in power of 2 */
id|v
op_assign
id|ld2
c_func
(paren
id|viadev-&gt;fragsize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|viadev-&gt;fragsize
op_ne
(paren
l_int|1
op_lshift
id|v
)paren
)paren
(brace
id|snd_printd
c_func
(paren
id|KERN_ERR
l_string|&quot;invalid fragment size %d&bslash;n&quot;
comma
id|viadev-&gt;fragsize
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|snd_via686a_channel_reset
c_func
(paren
id|chip
comma
id|viadev
)paren
suffix:semicolon
id|err
op_assign
id|build_via_table
c_func
(paren
id|viadev
comma
id|substream
comma
id|chip-&gt;pci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|runtime-&gt;dma_bytes
op_assign
id|viadev-&gt;size
suffix:semicolon
id|outl
c_func
(paren
(paren
id|u32
)paren
id|viadev-&gt;table_addr
comma
id|port
op_plus
id|VIA_REG_OFFSET_TABLE_PTR
)paren
suffix:semicolon
id|outb
c_func
(paren
id|VIA_REG_TYPE_AUTOSTART
op_or
(paren
id|runtime-&gt;format
op_eq
id|SNDRV_PCM_FORMAT_S16_LE
ques
c_cond
id|VIA_REG_TYPE_16BIT
suffix:colon
l_int|0
)paren
op_or
(paren
id|runtime-&gt;channels
OG
l_int|1
ques
c_cond
id|VIA_REG_TYPE_STEREO
suffix:colon
l_int|0
)paren
op_or
(paren
(paren
id|viadev-&gt;reg_offset
op_amp
l_int|0x10
)paren
op_eq
l_int|0
ques
c_cond
id|VIA_REG_TYPE_INT_LSAMPLE
suffix:colon
l_int|0
)paren
op_or
id|VIA_REG_TYPE_INT_EOL
op_or
id|VIA_REG_TYPE_INT_FLAG
comma
id|port
op_plus
id|VIA_REG_OFFSET_TYPE
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Interrupt handler&n; */
DECL|function|snd_via686a_update
r_static
r_inline
r_void
id|snd_via686a_update
c_func
(paren
id|via686a_t
op_star
id|chip
comma
id|viadev_t
op_star
id|viadev
)paren
(brace
id|outb
c_func
(paren
id|VIA_REG_STAT_FLAG
op_or
id|VIA_REG_STAT_EOL
comma
id|VIAREG
c_func
(paren
id|chip
comma
id|OFFSET_STATUS
)paren
op_plus
id|viadev-&gt;reg_offset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|viadev-&gt;substream
op_logical_and
id|viadev-&gt;running
)paren
(brace
id|viadev-&gt;curidx
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|viadev-&gt;curidx
op_ge
id|viadev-&gt;page_per_frag
)paren
(brace
id|viadev-&gt;curidx
op_assign
l_int|0
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|snd_pcm_period_elapsed
c_func
(paren
id|viadev-&gt;substream
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|snd_via686a_interrupt
r_static
r_void
id|snd_via686a_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|via686a_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|via686a_t
comma
id|dev_id
comma
r_return
)paren
suffix:semicolon
r_int
r_int
id|status
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|status
op_assign
id|inl
c_func
(paren
id|VIAREG
c_func
(paren
id|chip
comma
id|SGD_SHADOW
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
l_int|0x00000077
)paren
op_eq
l_int|0
)paren
(brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;rmidi
op_ne
l_int|NULL
)paren
(brace
id|snd_mpu401_uart_interrupt
c_func
(paren
id|irq
comma
id|chip-&gt;rmidi-&gt;private_data
comma
id|regs
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|inb
c_func
(paren
id|VIAREG
c_func
(paren
id|chip
comma
id|PLAYBACK_STATUS
)paren
)paren
op_amp
(paren
id|VIA_REG_STAT_EOL
op_or
id|VIA_REG_STAT_FLAG
)paren
)paren
id|snd_via686a_update
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;playback
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inb
c_func
(paren
id|VIAREG
c_func
(paren
id|chip
comma
id|CAPTURE_STATUS
)paren
)paren
op_amp
(paren
id|VIA_REG_STAT_EOL
op_or
id|VIA_REG_STAT_FLAG
)paren
)paren
id|snd_via686a_update
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;capture
)paren
suffix:semicolon
multiline_comment|/*if (inb(VIAREG(chip, FM_STATUS)) &amp; (VIA_REG_STAT_EOL|VIA_REG_STAT_FLAG))&n;&t;  snd_via686a_update(chip, &amp;chip-&gt;playback_fm);*/
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  PCM part&n; */
DECL|function|snd_via686a_playback_trigger
r_static
r_int
id|snd_via686a_playback_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|via686a_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|snd_via686a_trigger
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;playback
comma
id|cmd
)paren
suffix:semicolon
)brace
DECL|function|snd_via686a_capture_trigger
r_static
r_int
id|snd_via686a_capture_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|via686a_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|snd_via686a_trigger
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;capture
comma
id|cmd
)paren
suffix:semicolon
)brace
DECL|function|snd_via686a_hw_params
r_static
r_int
id|snd_via686a_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
r_return
id|snd_pcm_sgbuf_alloc
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_via686a_hw_free
r_static
r_int
id|snd_via686a_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_via686a_playback_prepare
r_static
r_int
id|snd_via686a_playback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|via686a_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_ac97_set_rate
c_func
(paren
id|chip-&gt;ac97
comma
id|AC97_PCM_FRONT_DAC_RATE
comma
id|runtime-&gt;rate
)paren
suffix:semicolon
r_return
id|snd_via686a_setup_periods
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;playback
comma
id|substream
)paren
suffix:semicolon
)brace
DECL|function|snd_via686a_capture_prepare
r_static
r_int
id|snd_via686a_capture_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|via686a_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_ac97_set_rate
c_func
(paren
id|chip-&gt;ac97
comma
id|AC97_PCM_LR_ADC_RATE
comma
id|runtime-&gt;rate
)paren
suffix:semicolon
r_return
id|snd_via686a_setup_periods
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;capture
comma
id|substream
)paren
suffix:semicolon
)brace
DECL|function|snd_via686a_cur_ptr
r_static
r_inline
r_int
r_int
id|snd_via686a_cur_ptr
c_func
(paren
id|via686a_t
op_star
id|chip
comma
id|viadev_t
op_star
id|viadev
)paren
(brace
r_int
r_int
id|val
comma
id|ptr
comma
id|count
suffix:semicolon
id|ptr
op_assign
id|inl
c_func
(paren
id|VIAREG
c_func
(paren
id|chip
comma
id|OFFSET_CURR_PTR
)paren
op_plus
id|viadev-&gt;reg_offset
)paren
suffix:semicolon
id|count
op_assign
id|inl
c_func
(paren
id|VIAREG
c_func
(paren
id|chip
comma
id|OFFSET_CURR_COUNT
)paren
op_plus
id|viadev-&gt;reg_offset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr
op_eq
id|viadev-&gt;lastptr
op_logical_and
id|count
OG
id|viadev-&gt;lastcount
)paren
id|ptr
op_add_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|inb
c_func
(paren
id|VIAREG
c_func
(paren
id|chip
comma
id|OFFSET_STATUS
)paren
op_plus
id|viadev-&gt;reg_offset
)paren
op_amp
id|VIA_REG_STAT_ACTIVE
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|snd_assert
c_func
(paren
id|viadev-&gt;tbl_entries
comma
r_return
l_int|0
)paren
suffix:semicolon
multiline_comment|/* get index */
r_if
c_cond
(paren
id|ptr
op_le
(paren
r_int
r_int
)paren
id|viadev-&gt;table_addr
)paren
id|val
op_assign
l_int|0
suffix:semicolon
r_else
id|val
op_assign
(paren
(paren
id|ptr
op_minus
(paren
r_int
r_int
)paren
id|viadev-&gt;table_addr
)paren
op_div
l_int|8
op_minus
l_int|1
)paren
op_mod
id|viadev-&gt;tbl_entries
suffix:semicolon
r_if
c_cond
(paren
id|val
OL
id|viadev-&gt;tbl_entries
op_minus
l_int|1
)paren
(brace
id|val
op_mul_assign
id|viadev-&gt;tbl_size
suffix:semicolon
id|val
op_add_assign
id|viadev-&gt;tbl_size
op_minus
id|count
suffix:semicolon
)brace
r_else
(brace
id|val
op_mul_assign
id|viadev-&gt;tbl_size
suffix:semicolon
id|val
op_add_assign
(paren
id|viadev-&gt;size
op_mod
id|viadev-&gt;tbl_size
)paren
op_plus
l_int|1
op_minus
id|count
suffix:semicolon
)brace
id|viadev-&gt;lastptr
op_assign
id|ptr
suffix:semicolon
id|viadev-&gt;lastcount
op_assign
id|count
suffix:semicolon
singleline_comment|// printk(&quot;pointer: ptr = 0x%x (%i), count = 0x%x, val = 0x%x&bslash;n&quot;, ptr, count, val);
r_return
id|val
suffix:semicolon
)brace
DECL|function|snd_via686a_playback_pointer
r_static
id|snd_pcm_uframes_t
id|snd_via686a_playback_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|via686a_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|snd_via686a_cur_ptr
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;playback
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_via686a_capture_pointer
r_static
id|snd_pcm_uframes_t
id|snd_via686a_capture_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|via686a_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|snd_via686a_cur_ptr
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;capture
)paren
)paren
suffix:semicolon
)brace
DECL|variable|snd_via686a_playback
r_static
id|snd_pcm_hardware_t
id|snd_via686a_playback
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_PAUSE
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
l_int|0
comma
dot
id|rate_min
op_assign
l_int|8000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
l_int|128
op_star
l_int|1024
comma
dot
id|period_bytes_min
op_assign
l_int|32
comma
dot
id|period_bytes_max
op_assign
l_int|128
op_star
l_int|1024
comma
dot
id|periods_min
op_assign
l_int|2
comma
dot
id|periods_max
op_assign
l_int|1024
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|snd_via686a_capture
r_static
id|snd_pcm_hardware_t
id|snd_via686a_capture
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
l_int|0
comma
dot
id|rate_min
op_assign
l_int|8000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
l_int|128
op_star
l_int|1024
comma
dot
id|period_bytes_min
op_assign
l_int|32
comma
dot
id|period_bytes_max
op_assign
l_int|128
op_star
l_int|1024
comma
dot
id|periods_min
op_assign
l_int|2
comma
dot
id|periods_max
op_assign
l_int|1024
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|function|snd_via686a_playback_open
r_static
r_int
id|snd_via686a_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|via686a_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
id|chip-&gt;playback.substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_via686a_playback
suffix:semicolon
id|runtime-&gt;hw.rates
op_assign
id|chip-&gt;ac97-&gt;rates_front_dac
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|runtime-&gt;hw.rates
op_amp
id|SNDRV_PCM_RATE_8000
)paren
)paren
id|runtime-&gt;hw.rate_min
op_assign
l_int|48000
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_sgbuf_init
c_func
(paren
id|substream
comma
id|chip-&gt;pci
comma
l_int|32
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_pow2
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_PERIOD_BYTES
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
macro_line|#if 0
multiline_comment|/* applying the following constraint together with the power-of-2 rule&n;&t; * above may result in too narrow space.&n;&t; * this one is not strictly necessary, so let&squot;s disable it.&n;&t; */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_integer
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_PERIODS
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_via686a_capture_open
r_static
r_int
id|snd_via686a_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|via686a_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
id|chip-&gt;capture.substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_via686a_capture
suffix:semicolon
id|runtime-&gt;hw.rates
op_assign
id|chip-&gt;ac97-&gt;rates_adc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|runtime-&gt;hw.rates
op_amp
id|SNDRV_PCM_RATE_8000
)paren
)paren
id|runtime-&gt;hw.rate_min
op_assign
l_int|48000
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_sgbuf_init
c_func
(paren
id|substream
comma
id|chip-&gt;pci
comma
l_int|32
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_pow2
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_PERIOD_BYTES
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_integer
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_PERIODS
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_via686a_playback_close
r_static
r_int
id|snd_via686a_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|via686a_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|clean_via_table
c_func
(paren
op_amp
id|chip-&gt;playback
comma
id|substream
comma
id|chip-&gt;pci
)paren
suffix:semicolon
id|snd_pcm_sgbuf_delete
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;playback.substream
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* disable DAC power */
id|snd_ac97_update_bits
c_func
(paren
id|chip-&gt;ac97
comma
id|AC97_POWERDOWN
comma
l_int|0x0200
comma
l_int|0x0200
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_via686a_capture_close
r_static
r_int
id|snd_via686a_capture_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|via686a_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|clean_via_table
c_func
(paren
op_amp
id|chip-&gt;capture
comma
id|substream
comma
id|chip-&gt;pci
)paren
suffix:semicolon
id|snd_pcm_sgbuf_delete
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;capture.substream
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* disable ADC power */
id|snd_ac97_update_bits
c_func
(paren
id|chip-&gt;ac97
comma
id|AC97_POWERDOWN
comma
l_int|0x0100
comma
l_int|0x0100
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_via686a_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_via686a_playback_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_via686a_playback_open
comma
dot
id|close
op_assign
id|snd_via686a_playback_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_via686a_hw_params
comma
dot
id|hw_free
op_assign
id|snd_via686a_hw_free
comma
dot
id|prepare
op_assign
id|snd_via686a_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_via686a_playback_trigger
comma
dot
id|pointer
op_assign
id|snd_via686a_playback_pointer
comma
dot
id|copy
op_assign
id|snd_pcm_sgbuf_ops_copy_playback
comma
dot
id|silence
op_assign
id|snd_pcm_sgbuf_ops_silence
comma
dot
id|page
op_assign
id|snd_pcm_sgbuf_ops_page
comma
)brace
suffix:semicolon
DECL|variable|snd_via686a_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_via686a_capture_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_via686a_capture_open
comma
dot
id|close
op_assign
id|snd_via686a_capture_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_via686a_hw_params
comma
dot
id|hw_free
op_assign
id|snd_via686a_hw_free
comma
dot
id|prepare
op_assign
id|snd_via686a_capture_prepare
comma
dot
id|trigger
op_assign
id|snd_via686a_capture_trigger
comma
dot
id|pointer
op_assign
id|snd_via686a_capture_pointer
comma
dot
id|copy
op_assign
id|snd_pcm_sgbuf_ops_copy_capture
comma
dot
id|silence
op_assign
id|snd_pcm_sgbuf_ops_silence
comma
dot
id|page
op_assign
id|snd_pcm_sgbuf_ops_page
comma
)brace
suffix:semicolon
DECL|function|snd_via686a_pcm_free
r_static
r_void
id|snd_via686a_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|via686a_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|via686a_t
comma
id|pcm-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|chip-&gt;pcm
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|snd_via686a_pcm
r_static
r_int
id|__devinit
id|snd_via686a_pcm
c_func
(paren
id|via686a_t
op_star
id|chip
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;VIA 82C686A&quot;
comma
id|device
comma
l_int|1
comma
l_int|1
comma
op_amp
id|pcm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_via686a_playback_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_via686a_capture_ops
)paren
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_via686a_pcm_free
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;VIA 82C686A&quot;
)paren
suffix:semicolon
id|chip-&gt;pcm
op_assign
id|pcm
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Mixer part&n; */
DECL|function|snd_via686a_codec_init
r_static
r_void
id|snd_via686a_codec_init
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
singleline_comment|// via686a_t *chip = snd_magic_cast(via686a_t, ac97-&gt;private_data, return);
multiline_comment|/* disable DAC &amp; ADC power */
id|snd_ac97_update_bits
c_func
(paren
id|ac97
comma
id|AC97_POWERDOWN
comma
l_int|0x0300
comma
l_int|0x0300
)paren
suffix:semicolon
multiline_comment|/* disable center DAC/surround DAC/LFE DAC/MIC ADC */
id|snd_ac97_update_bits
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_STATUS
comma
l_int|0xe800
comma
l_int|0xe800
)paren
suffix:semicolon
)brace
DECL|function|snd_via686a_mixer_free_ac97
r_static
r_void
id|snd_via686a_mixer_free_ac97
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
id|via686a_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|via686a_t
comma
id|ac97-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|chip-&gt;ac97
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|snd_via686a_mixer
r_static
r_int
id|__devinit
id|snd_via686a_mixer
c_func
(paren
id|via686a_t
op_star
id|chip
)paren
(brace
id|ac97_t
id|ac97
suffix:semicolon
r_int
id|err
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ac97
comma
l_int|0
comma
r_sizeof
(paren
id|ac97
)paren
)paren
suffix:semicolon
id|ac97.write
op_assign
id|snd_via686a_codec_write
suffix:semicolon
id|ac97.read
op_assign
id|snd_via686a_codec_read
suffix:semicolon
id|ac97.init
op_assign
id|snd_via686a_codec_init
suffix:semicolon
id|ac97.wait
op_assign
id|snd_via686a_codec_wait
suffix:semicolon
id|ac97.private_data
op_assign
id|chip
suffix:semicolon
id|ac97.private_free
op_assign
id|snd_via686a_mixer_free_ac97
suffix:semicolon
id|ac97.clock
op_assign
id|chip-&gt;ac97_clock
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_mixer
c_func
(paren
id|chip-&gt;card
comma
op_amp
id|ac97
comma
op_amp
id|chip-&gt;ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * joystick&n; */
DECL|function|snd_via686a_joystick_info
r_static
r_int
id|snd_via686a_joystick_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_via686a_joystick_get
r_static
r_int
id|snd_via686a_joystick_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|via686a_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|u16
id|val
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|chip-&gt;pci
comma
l_int|0x42
comma
op_amp
id|val
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|val
op_amp
l_int|0x08
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_via686a_joystick_put
r_static
r_int
id|snd_via686a_joystick_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|via686a_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|u16
id|val
comma
id|oval
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|chip-&gt;pci
comma
l_int|0x42
comma
op_amp
id|oval
)paren
suffix:semicolon
id|val
op_assign
id|oval
op_amp
op_complement
l_int|0x08
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
id|val
op_or_assign
l_int|0x08
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
id|oval
)paren
(brace
id|pci_write_config_word
c_func
(paren
id|chip-&gt;pci
comma
l_int|0x42
comma
id|val
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_via686a_joystick_control
id|__devinitdata
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;Joystick&quot;
comma
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_CARD
comma
dot
id|info
op_assign
id|snd_via686a_joystick_info
comma
dot
id|get
op_assign
id|snd_via686a_joystick_get
comma
dot
id|put
op_assign
id|snd_via686a_joystick_put
comma
)brace
suffix:semicolon
multiline_comment|/*&n; *&n; */
DECL|function|snd_via686a_chip_init
r_static
r_int
id|__devinit
id|snd_via686a_chip_init
c_func
(paren
id|via686a_t
op_star
id|chip
)paren
(brace
id|ac97_t
id|ac97
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|max_count
suffix:semicolon
r_int
r_char
id|pval
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ac97
comma
l_int|0
comma
r_sizeof
(paren
id|ac97
)paren
)paren
suffix:semicolon
id|ac97.private_data
op_assign
id|chip
suffix:semicolon
macro_line|#if 0 /* broken on K7M? */
multiline_comment|/* disable all legacy ports */
id|pci_write_config_byte
c_func
(paren
id|chip-&gt;pci
comma
l_int|0x42
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* cold reset only when link is down */
id|pci_read_config_byte
c_func
(paren
id|chip-&gt;pci
comma
l_int|0x40
comma
op_amp
id|pval
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pval
op_amp
l_int|0x01
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* deassert ACLink reset, force SYNC */
id|pci_write_config_byte
c_func
(paren
id|chip-&gt;pci
comma
l_int|0x41
comma
l_int|0xe0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|chip-&gt;pci
comma
l_int|0x41
comma
l_int|0x00
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* ACLink on, deassert ACLink reset, VSR, SGD data out */
multiline_comment|/* note - FM data out has trouble with non VRA codecs !! */
id|pci_write_config_byte
c_func
(paren
id|chip-&gt;pci
comma
l_int|0x41
comma
l_int|0xcc
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
multiline_comment|/* Make sure VRA is enabled, in case we didn&squot;t do a&n;&t; * complete codec reset, above */
id|pci_read_config_byte
c_func
(paren
id|chip-&gt;pci
comma
l_int|0x41
comma
op_amp
id|pval
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pval
op_amp
l_int|0xcc
)paren
op_ne
l_int|0xcc
)paren
(brace
multiline_comment|/* ACLink on, deassert ACLink reset, VSR, SGD data out */
multiline_comment|/* note - FM data out has trouble with non VRA codecs !! */
id|pci_write_config_byte
c_func
(paren
id|chip-&gt;pci
comma
l_int|0x41
comma
l_int|0xcc
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
multiline_comment|/* wait until codec ready */
id|max_count
op_assign
(paren
(paren
l_int|3
op_star
id|HZ
)paren
op_div
l_int|4
)paren
op_plus
l_int|1
suffix:semicolon
r_do
(brace
id|pci_read_config_byte
c_func
(paren
id|chip-&gt;pci
comma
l_int|0x40
comma
op_amp
id|pval
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pval
op_amp
l_int|0x01
)paren
multiline_comment|/* primary codec ready */
r_break
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|max_count
OG
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_assign
id|snd_via686a_codec_xread
c_func
(paren
id|chip
)paren
)paren
op_amp
id|VIA_REG_AC97_BUSY
)paren
id|snd_printk
c_func
(paren
l_string|&quot;AC&squot;97 codec is not ready [0x%x]&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
multiline_comment|/* and then reset codec.. */
id|snd_via686a_codec_write
c_func
(paren
op_amp
id|ac97
comma
id|AC97_RESET
comma
l_int|0x0000
)paren
suffix:semicolon
multiline_comment|/* check the primary codec */
id|snd_via686a_codec_xwrite
c_func
(paren
id|chip
comma
id|VIA_REG_AC97_READ
op_or
id|VIA_REG_AC97_PRIMARY_VALID
op_or
(paren
id|VIA_REG_AC97_CODEC_ID_PRIMARY
op_lshift
id|VIA_REG_AC97_CODEC_ID_SHIFT
)paren
)paren
suffix:semicolon
id|max_count
op_assign
(paren
(paren
l_int|3
op_star
id|HZ
)paren
op_div
l_int|4
)paren
op_plus
l_int|1
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|snd_via686a_codec_xread
c_func
(paren
id|chip
)paren
)paren
op_amp
id|VIA_REG_AC97_PRIMARY_VALID
)paren
r_goto
id|__ac97_ok1
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|max_count
OG
l_int|0
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;Primary AC&squot;97 codec is not valid [0x%x]&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
id|__ac97_ok1
suffix:colon
macro_line|#if 0 /* FIXME: we don&squot;t support the second codec yet so skip the detection now.. */
id|snd_via686a_codec_xwrite
c_func
(paren
id|chip
comma
id|VIA_REG_AC97_READ
op_or
id|VIA_REG_AC97_SECONDARY_VALID
op_or
(paren
id|VIA_REG_AC97_CODEC_ID_SECONDARY
op_lshift
id|VIA_REG_AC97_CODEC_ID_SHIFT
)paren
)paren
suffix:semicolon
id|max_count
op_assign
(paren
(paren
l_int|3
op_star
id|HZ
)paren
op_div
l_int|4
)paren
op_plus
l_int|1
suffix:semicolon
id|snd_via686a_codec_xwrite
c_func
(paren
id|chip
comma
id|VIA_REG_AC97_READ
op_or
id|VIA_REG_AC97_SECONDARY_VALID
op_or
(paren
id|VIA_REG_AC97_CODEC_ID_SECONDARY
op_lshift
id|VIA_REG_AC97_CODEC_ID_SHIFT
)paren
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|snd_via686a_codec_xread
c_func
(paren
id|chip
)paren
)paren
op_amp
id|VIA_REG_AC97_SECONDARY_VALID
)paren
(brace
id|chip-&gt;ac97_secondary
op_assign
l_int|1
suffix:semicolon
r_goto
id|__ac97_ok2
suffix:semicolon
)brace
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|max_count
OG
l_int|0
)paren
suffix:semicolon
multiline_comment|/* This is ok, the most of motherboards have only one codec */
id|__ac97_ok2
suffix:colon
macro_line|#endif
macro_line|#if 0
(brace
r_int
r_char
id|cmdb
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|chip-&gt;pci
comma
l_int|0x40
comma
op_amp
id|cmdb
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;PCI[0x40] = 0x%x&bslash;n&quot;
comma
id|cmdb
)paren
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|chip-&gt;pci
comma
l_int|0x42
comma
op_amp
id|cmdb
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;PCI[0x42] = 0x%x&bslash;n&quot;
comma
id|cmdb
)paren
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|chip-&gt;pci
comma
l_int|0x43
comma
op_amp
id|cmdb
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;PCI[0x43] = 0x%x&bslash;n&quot;
comma
id|cmdb
)paren
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|chip-&gt;pci
comma
l_int|0x44
comma
op_amp
id|cmdb
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;PCI[0x44] = 0x%x&bslash;n&quot;
comma
id|cmdb
)paren
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|chip-&gt;pci
comma
l_int|0x48
comma
op_amp
id|cmdb
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;PCI[0x48] = 0x%x&bslash;n&quot;
comma
id|cmdb
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* route FM trap to IRQ, disable FM trap */
id|pci_write_config_byte
c_func
(paren
id|chip-&gt;pci
comma
l_int|0x48
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* disable all GPI interrupts */
id|outl
c_func
(paren
l_int|0
comma
id|chip-&gt;port
op_plus
l_int|0x8c
)paren
suffix:semicolon
multiline_comment|/* disable interrupts */
id|snd_via686a_channel_reset
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;playback
)paren
suffix:semicolon
id|snd_via686a_channel_reset
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;capture
)paren
suffix:semicolon
multiline_comment|/*snd_via686a_channel_reset(chip, &amp;chip-&gt;playback_fm);*/
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_via686a_free
r_static
r_int
id|snd_via686a_free
c_func
(paren
id|via686a_t
op_star
id|chip
)paren
(brace
r_if
c_cond
(paren
id|chip-&gt;irq
OL
l_int|0
)paren
r_goto
id|__end_hw
suffix:semicolon
multiline_comment|/* disable interrupts */
id|snd_via686a_channel_reset
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;playback
)paren
suffix:semicolon
id|snd_via686a_channel_reset
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;capture
)paren
suffix:semicolon
multiline_comment|/*snd_via686a_channel_reset(chip, &amp;chip-&gt;playback_fm);*/
multiline_comment|/* --- */
id|synchronize_irq
c_func
(paren
id|chip-&gt;irq
)paren
suffix:semicolon
id|__end_hw
suffix:colon
r_if
c_cond
(paren
id|chip-&gt;res_port
)paren
(brace
id|release_resource
c_func
(paren
id|chip-&gt;res_port
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|chip-&gt;res_port
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chip-&gt;irq
op_ge
l_int|0
)paren
id|free_irq
c_func
(paren
id|chip-&gt;irq
comma
(paren
r_void
op_star
)paren
id|chip
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|chip-&gt;pci
comma
l_int|0x42
comma
id|chip-&gt;old_legacy
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|chip-&gt;pci
comma
l_int|0x43
comma
id|chip-&gt;old_legacy_cfg
)paren
suffix:semicolon
id|snd_magic_kfree
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_via686a_dev_free
r_static
r_int
id|snd_via686a_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|via686a_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|via686a_t
comma
id|device-&gt;device_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_return
id|snd_via686a_free
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
DECL|function|snd_via686a_create
r_static
r_int
id|__devinit
id|snd_via686a_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_struct
id|pci_dev
op_star
id|pci
comma
r_int
r_int
id|ac97_clock
comma
r_int
r_char
id|old_legacy
comma
r_int
r_char
id|old_legacy_cfg
comma
id|via686a_t
op_star
op_star
id|r_via
)paren
(brace
id|via686a_t
op_star
id|chip
suffix:semicolon
r_int
id|err
suffix:semicolon
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
dot
id|dev_free
op_assign
id|snd_via686a_dev_free
comma
)brace
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pci
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chip
op_assign
id|snd_magic_kcalloc
c_func
(paren
id|via686a_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|chip-&gt;old_legacy
op_assign
id|old_legacy
suffix:semicolon
id|chip-&gt;old_legacy_cfg
op_assign
id|old_legacy_cfg
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|chip-&gt;card
op_assign
id|card
suffix:semicolon
id|chip-&gt;pci
op_assign
id|pci
suffix:semicolon
id|chip-&gt;irq
op_assign
op_minus
l_int|1
suffix:semicolon
id|chip-&gt;port
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chip-&gt;res_port
op_assign
id|request_region
c_func
(paren
id|chip-&gt;port
comma
l_int|256
comma
l_string|&quot;VIA686A&quot;
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_via686a_free
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab ports 0x%lx-0x%lx&bslash;n&quot;
comma
id|chip-&gt;port
comma
id|chip-&gt;port
op_plus
l_int|256
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|pci-&gt;irq
comma
id|snd_via686a_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
l_string|&quot;VIA686A&quot;
comma
(paren
r_void
op_star
)paren
id|chip
)paren
)paren
(brace
id|snd_via686a_free
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab IRQ %d&bslash;n&quot;
comma
id|chip-&gt;irq
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|chip-&gt;irq
op_assign
id|pci-&gt;irq
suffix:semicolon
r_if
c_cond
(paren
id|ac97_clock
op_ge
l_int|8000
op_logical_and
id|ac97_clock
op_le
l_int|48000
)paren
id|chip-&gt;ac97_clock
op_assign
id|ac97_clock
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pci
comma
id|PCI_REVISION_ID
comma
op_amp
id|chip-&gt;revision
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
id|chip-&gt;irq
)paren
suffix:semicolon
multiline_comment|/* initialize offsets */
id|chip-&gt;playback.reg_offset
op_assign
id|VIA_REG_PLAYBACK_STATUS
suffix:semicolon
id|chip-&gt;capture.reg_offset
op_assign
id|VIA_REG_CAPTURE_STATUS
suffix:semicolon
multiline_comment|/*chip-&gt;playback_fm.reg_offset = VIA_REG_FM_STATUS;*/
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_via686a_chip_init
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_via686a_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|chip
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_via686a_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
op_star
id|r_via
op_assign
id|chip
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_via686a_probe
r_static
r_int
id|__devinit
id|snd_via686a_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
r_static
r_int
id|dev
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
id|via686a_t
op_star
id|chip
suffix:semicolon
r_int
id|pcm_dev
op_assign
l_int|0
suffix:semicolon
r_int
r_char
id|legacy
suffix:semicolon
r_int
r_char
id|legacy_cfg
suffix:semicolon
r_int
id|rev_h
op_assign
l_int|0
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_ge
id|SNDRV_CARDS
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_enable
(braket
id|dev
)braket
)paren
(brace
id|dev
op_increment
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|card
op_assign
id|snd_card_new
c_func
(paren
id|snd_index
(braket
id|dev
)braket
comma
id|snd_id
(braket
id|dev
)braket
comma
id|THIS_MODULE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pci
comma
l_int|0x42
comma
op_amp
id|legacy
)paren
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pci
comma
l_int|0x43
comma
op_amp
id|legacy_cfg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_via686a_create
c_func
(paren
id|card
comma
id|pci
comma
id|snd_ac97_clock
(braket
id|dev
)braket
comma
id|legacy
comma
id|legacy_cfg
comma
op_amp
id|chip
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|snd_via686a_mixer
c_func
(paren
id|chip
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|snd_via686a_pcm
c_func
(paren
id|chip
comma
id|pcm_dev
op_increment
comma
l_int|NULL
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#if 0
r_if
c_cond
(paren
id|snd_via686a_pcm_fm
c_func
(paren
id|chip
comma
id|pcm_dev
op_increment
comma
l_int|NULL
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#endif
id|legacy
op_or_assign
l_int|0x40
suffix:semicolon
multiline_comment|/* disable MIDI */
id|legacy
op_and_assign
op_complement
l_int|0x08
suffix:semicolon
multiline_comment|/* disable joystick */
r_if
c_cond
(paren
id|chip-&gt;revision
op_ge
l_int|0x20
)paren
(brace
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|2
)paren
comma
l_int|4
)paren
)paren
(brace
id|rev_h
op_assign
l_int|0
suffix:semicolon
id|legacy
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
multiline_comment|/* disable PCI I/O 2 */
)brace
r_else
(brace
id|rev_h
op_assign
l_int|1
suffix:semicolon
id|legacy
op_or_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* enable PCI I/O 2 */
)brace
)brace
id|pci_write_config_byte
c_func
(paren
id|pci
comma
l_int|0x42
comma
id|legacy
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pci
comma
l_int|0x43
comma
id|legacy_cfg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rev_h
op_logical_and
id|snd_mpu_port
(braket
id|dev
)braket
op_ge
l_int|0x200
)paren
(brace
multiline_comment|/* force MIDI */
id|legacy
op_or_assign
l_int|0x02
suffix:semicolon
multiline_comment|/* enable MPU */
id|pci_write_config_dword
c_func
(paren
id|pci
comma
l_int|0x18
comma
(paren
id|snd_mpu_port
(braket
id|dev
)braket
op_amp
l_int|0xfffc
)paren
op_or
l_int|0x01
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|rev_h
op_logical_and
(paren
id|legacy
op_amp
l_int|0x02
)paren
)paren
(brace
id|snd_mpu_port
(braket
id|dev
)braket
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_mpu_port
(braket
id|dev
)braket
OL
l_int|0x200
)paren
multiline_comment|/* bad value */
id|legacy
op_and_assign
op_complement
l_int|0x02
suffix:semicolon
multiline_comment|/* disable MIDI */
)brace
r_else
(brace
r_switch
c_cond
(paren
id|snd_mpu_port
(braket
id|dev
)braket
)paren
(brace
multiline_comment|/* force MIDI */
r_case
l_int|0x300
suffix:colon
r_case
l_int|0x310
suffix:colon
r_case
l_int|0x320
suffix:colon
r_case
l_int|0x330
suffix:colon
id|legacy_cfg
op_and_assign
op_complement
(paren
l_int|3
op_lshift
l_int|2
)paren
suffix:semicolon
id|legacy_cfg
op_or_assign
(paren
id|snd_mpu_port
(braket
id|dev
)braket
op_amp
l_int|0x0030
)paren
op_rshift
l_int|2
suffix:semicolon
id|legacy
op_or_assign
l_int|0x02
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
multiline_comment|/* no, use BIOS settings */
r_if
c_cond
(paren
id|legacy
op_amp
l_int|0x02
)paren
id|snd_mpu_port
(braket
id|dev
)braket
op_assign
l_int|0x300
op_plus
(paren
(paren
id|legacy_cfg
op_amp
l_int|0x000c
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
)brace
)brace
)brace
id|pci_write_config_byte
c_func
(paren
id|pci
comma
l_int|0x42
comma
id|legacy
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pci
comma
l_int|0x43
comma
id|legacy_cfg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|legacy
op_amp
l_int|0x02
)paren
(brace
r_if
c_cond
(paren
id|check_region
c_func
(paren
id|snd_mpu_port
(braket
id|dev
)braket
comma
l_int|2
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;unable to get MPU-401 port at 0x%lx, skipping&bslash;n&quot;
comma
id|snd_mpu_port
(braket
id|dev
)braket
)paren
suffix:semicolon
id|legacy
op_and_assign
op_complement
l_int|0x02
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pci
comma
l_int|0x42
comma
id|legacy
)paren
suffix:semicolon
r_goto
id|__skip_mpu
suffix:semicolon
)brace
r_if
c_cond
(paren
id|snd_mpu401_uart_new
c_func
(paren
id|card
comma
l_int|0
comma
id|MPU401_HW_VIA686A
comma
id|snd_mpu_port
(braket
id|dev
)braket
comma
l_int|0
comma
id|pci-&gt;irq
comma
l_int|0
comma
op_amp
id|chip-&gt;rmidi
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;unable to initialize MPU-401 at 0x%lx, skipping&bslash;n&quot;
comma
id|snd_mpu_port
(braket
id|dev
)braket
)paren
suffix:semicolon
id|legacy
op_and_assign
op_complement
l_int|0x02
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pci
comma
l_int|0x42
comma
id|legacy
)paren
suffix:semicolon
r_goto
id|__skip_mpu
suffix:semicolon
)brace
id|legacy
op_and_assign
op_complement
l_int|0x40
suffix:semicolon
multiline_comment|/* enable MIDI interrupt */
id|pci_write_config_byte
c_func
(paren
id|pci
comma
l_int|0x42
comma
id|legacy
)paren
suffix:semicolon
id|__skip_mpu
suffix:colon
suffix:semicolon
)brace
multiline_comment|/* card switches */
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_via686a_joystick_control
comma
id|chip
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;VIA686A&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;shortname
comma
l_string|&quot;VIA 82C686A/B&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;%s at 0x%lx, irq %d&quot;
comma
id|card-&gt;shortname
comma
id|chip-&gt;port
comma
id|chip-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_card_register
c_func
(paren
id|card
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pci
comma
id|card
)paren
suffix:semicolon
id|dev
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_via686a_remove
r_static
r_void
id|__devexit
id|snd_via686a_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
id|snd_card_free
c_func
(paren
id|pci_get_drvdata
c_func
(paren
id|pci
)paren
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|driver
r_static
r_struct
id|pci_driver
id|driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;VIA 82C686A/B&quot;
comma
dot
id|id_table
op_assign
id|snd_via686a_ids
comma
dot
id|probe
op_assign
id|snd_via686a_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|snd_via686a_remove
)paren
comma
)brace
suffix:semicolon
DECL|function|alsa_card_via686a_init
r_static
r_int
id|__init
id|alsa_card_via686a_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_module_init
c_func
(paren
op_amp
id|driver
)paren
)paren
OL
l_int|0
)paren
(brace
macro_line|#ifdef MODULE
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;VIA 82C686A soundcard not found or device busy&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|alsa_card_via686a_exit
r_static
r_void
id|__exit
id|alsa_card_via686a_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|alsa_card_via686a_init
)paren
id|module_exit
c_func
(paren
id|alsa_card_via686a_exit
)paren
macro_line|#ifndef MODULE
multiline_comment|/* format is: snd-via686a=snd_enable,snd_index,snd_id,&n;&t;&t;&t;  snd_mpu_port,snd_ac97_clock */
DECL|function|alsa_card_via686a_setup
r_static
r_int
id|__init
id|alsa_card_via686a_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_static
r_int
id|__initdata
id|nr_dev
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|nr_dev
op_ge
id|SNDRV_CARDS
)paren
r_return
l_int|0
suffix:semicolon
(paren
r_void
)paren
(paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_enable
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_index
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_id
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_id
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_option
c_func
(paren
op_amp
id|str
comma
(paren
r_int
op_star
)paren
op_amp
id|snd_mpu_port
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_ac97_clock
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
)paren
suffix:semicolon
id|nr_dev
op_increment
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;snd-via686a=&quot;
comma
id|alsa_card_via686a_setup
)paren
suffix:semicolon
macro_line|#endif /* ifndef MODULE */
eof
