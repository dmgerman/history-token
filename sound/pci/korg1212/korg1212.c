multiline_comment|/*&n; *   Driver for the Korg 1212 IO PCI card&n; *&n; *&t;Copyright (c) 2001 Haroldo Gamal &lt;gamal@alternex.com.br&gt;&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#include &lt;sound/control.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
DECL|macro|SNDRV_GET_ID
mdefine_line|#define SNDRV_GET_ID
macro_line|#include &lt;sound/initval.h&gt;
DECL|macro|DEBUG
mdefine_line|#define DEBUG                    1
singleline_comment|//#define LARGEALLOC               1
DECL|macro|PRINTK
mdefine_line|#define PRINTK&t;printk
singleline_comment|// ----------------------------------------------------------------------------
singleline_comment|// the following enum defines the valid states of the Korg 1212 I/O card.
singleline_comment|// ----------------------------------------------------------------------------
r_typedef
r_enum
(brace
DECL|enumerator|K1212_STATE_NONEXISTENT
id|K1212_STATE_NONEXISTENT
comma
singleline_comment|// there is no card here
DECL|enumerator|K1212_STATE_UNINITIALIZED
id|K1212_STATE_UNINITIALIZED
comma
singleline_comment|// the card is awaiting DSP download
DECL|enumerator|K1212_STATE_DSP_IN_PROCESS
id|K1212_STATE_DSP_IN_PROCESS
comma
singleline_comment|// the card is currently downloading its DSP code
DECL|enumerator|K1212_STATE_DSP_COMPLETE
id|K1212_STATE_DSP_COMPLETE
comma
singleline_comment|// the card has finished the DSP download
DECL|enumerator|K1212_STATE_READY
id|K1212_STATE_READY
comma
singleline_comment|// the card can be opened by an application.  Any application
singleline_comment|//    requests prior to this state should fail.  Only an open
singleline_comment|//    request can be made at this state.
DECL|enumerator|K1212_STATE_OPEN
id|K1212_STATE_OPEN
comma
singleline_comment|// an application has opened the card
DECL|enumerator|K1212_STATE_SETUP
id|K1212_STATE_SETUP
comma
singleline_comment|// the card has been setup for play
DECL|enumerator|K1212_STATE_PLAYING
id|K1212_STATE_PLAYING
comma
singleline_comment|// the card is playing
DECL|enumerator|K1212_STATE_MONITOR
id|K1212_STATE_MONITOR
comma
singleline_comment|// the card is in the monitor mode
DECL|enumerator|K1212_STATE_CALIBRATING
id|K1212_STATE_CALIBRATING
comma
singleline_comment|// the card is currently calibrating
DECL|enumerator|K1212_STATE_ERRORSTOP
id|K1212_STATE_ERRORSTOP
comma
singleline_comment|// the card has stopped itself because of an error and we
singleline_comment|//    are in the process of cleaning things up.
DECL|enumerator|K1212_STATE_MAX_STATE
id|K1212_STATE_MAX_STATE
singleline_comment|// state values of this and beyond are invalid
DECL|typedef|CardState
)brace
id|CardState
suffix:semicolon
singleline_comment|// ----------------------------------------------------------------------------
singleline_comment|// The following enumeration defines the constants written to the card&squot;s
singleline_comment|// host-to-card doorbell to initiate a command.
singleline_comment|// ----------------------------------------------------------------------------
r_typedef
r_enum
(brace
DECL|enumerator|K1212_DB_RequestForData
id|K1212_DB_RequestForData
op_assign
l_int|0
comma
singleline_comment|// sent by the card to request a buffer fill.
DECL|enumerator|K1212_DB_TriggerPlay
id|K1212_DB_TriggerPlay
op_assign
l_int|1
comma
singleline_comment|// starts playback/record on the card.
DECL|enumerator|K1212_DB_SelectPlayMode
id|K1212_DB_SelectPlayMode
op_assign
l_int|2
comma
singleline_comment|// select monitor, playback setup, or stop.
DECL|enumerator|K1212_DB_ConfigureBufferMemory
id|K1212_DB_ConfigureBufferMemory
op_assign
l_int|3
comma
singleline_comment|// tells card where the host audio buffers are.
DECL|enumerator|K1212_DB_RequestAdatTimecode
id|K1212_DB_RequestAdatTimecode
op_assign
l_int|4
comma
singleline_comment|// asks the card for the latest ADAT timecode value.
DECL|enumerator|K1212_DB_SetClockSourceRate
id|K1212_DB_SetClockSourceRate
op_assign
l_int|5
comma
singleline_comment|// sets the clock source and rate for the card.
DECL|enumerator|K1212_DB_ConfigureMiscMemory
id|K1212_DB_ConfigureMiscMemory
op_assign
l_int|6
comma
singleline_comment|// tells card where other buffers are.
DECL|enumerator|K1212_DB_TriggerFromAdat
id|K1212_DB_TriggerFromAdat
op_assign
l_int|7
comma
singleline_comment|// tells card to trigger from Adat at a specific
singleline_comment|//    timecode value.
DECL|enumerator|K1212_DB_RebootCard
id|K1212_DB_RebootCard
op_assign
l_int|0xA0
comma
singleline_comment|// instructs the card to reboot.
DECL|enumerator|K1212_DB_BootFromDSPPage4
id|K1212_DB_BootFromDSPPage4
op_assign
l_int|0xA4
comma
singleline_comment|// instructs the card to boot from the DSP microcode
singleline_comment|//    on page 4 (local page to card).
DECL|enumerator|K1212_DB_DSPDownloadDone
id|K1212_DB_DSPDownloadDone
op_assign
l_int|0xAE
comma
singleline_comment|// sent by the card to indicate the download has
singleline_comment|//    completed.
DECL|enumerator|K1212_DB_StartDSPDownload
id|K1212_DB_StartDSPDownload
op_assign
l_int|0xAF
singleline_comment|// tells the card to download its DSP firmware.
DECL|typedef|korg1212_dbcnst_t
)brace
id|korg1212_dbcnst_t
suffix:semicolon
DECL|macro|K1212_ISRCODE_DMAERROR
mdefine_line|#define K1212_ISRCODE_DMAERROR      0x80
DECL|macro|K1212_ISRCODE_CARDSTOPPED
mdefine_line|#define K1212_ISRCODE_CARDSTOPPED   0x81
singleline_comment|// ----------------------------------------------------------------------------
singleline_comment|// The following enumeration defines return codes for DeviceIoControl() calls
singleline_comment|// to the Korg 1212 I/O driver.
singleline_comment|// ----------------------------------------------------------------------------
r_typedef
r_enum
(brace
DECL|enumerator|K1212_CMDRET_Success
id|K1212_CMDRET_Success
op_assign
l_int|0
comma
singleline_comment|// command was successfully placed
DECL|enumerator|K1212_CMDRET_DIOCFailure
id|K1212_CMDRET_DIOCFailure
comma
singleline_comment|// the DeviceIoControl call failed
DECL|enumerator|K1212_CMDRET_PMFailure
id|K1212_CMDRET_PMFailure
comma
singleline_comment|// the protected mode call failed
DECL|enumerator|K1212_CMDRET_FailUnspecified
id|K1212_CMDRET_FailUnspecified
comma
singleline_comment|// unspecified failure
DECL|enumerator|K1212_CMDRET_FailBadState
id|K1212_CMDRET_FailBadState
comma
singleline_comment|// the specified command can not be given in
singleline_comment|//    the card&squot;s current state. (or the wave device&squot;s
singleline_comment|//    state)
DECL|enumerator|K1212_CMDRET_CardUninitialized
id|K1212_CMDRET_CardUninitialized
comma
singleline_comment|// the card is uninitialized and cannot be used
DECL|enumerator|K1212_CMDRET_BadIndex
id|K1212_CMDRET_BadIndex
comma
singleline_comment|// an out of range card index was specified
DECL|enumerator|K1212_CMDRET_BadHandle
id|K1212_CMDRET_BadHandle
comma
singleline_comment|// an invalid card handle was specified
DECL|enumerator|K1212_CMDRET_NoFillRoutine
id|K1212_CMDRET_NoFillRoutine
comma
singleline_comment|// a play request has been made before a fill routine set
DECL|enumerator|K1212_CMDRET_FillRoutineInUse
id|K1212_CMDRET_FillRoutineInUse
comma
singleline_comment|// can&squot;t set a new fill routine while one is in use
DECL|enumerator|K1212_CMDRET_NoAckFromCard
id|K1212_CMDRET_NoAckFromCard
comma
singleline_comment|// the card never acknowledged a command
DECL|enumerator|K1212_CMDRET_BadParams
id|K1212_CMDRET_BadParams
comma
singleline_comment|// bad parameters were provided by the caller
singleline_comment|// --------------------------------------------------------------
singleline_comment|// the following return errors are specific to the wave device
singleline_comment|// driver interface.  These will not be encountered by users of
singleline_comment|// the 32 bit DIOC interface (a.k.a. custom or native API).
singleline_comment|// --------------------------------------------------------------
DECL|enumerator|K1212_CMDRET_BadDevice
id|K1212_CMDRET_BadDevice
comma
singleline_comment|// the specified wave device was out of range
DECL|enumerator|K1212_CMDRET_BadFormat
id|K1212_CMDRET_BadFormat
singleline_comment|// the specified wave format is unsupported
DECL|typedef|snd_korg1212rc
)brace
id|snd_korg1212rc
suffix:semicolon
singleline_comment|// ----------------------------------------------------------------------------
singleline_comment|// The following enumeration defines the constants used to select the play
singleline_comment|// mode for the card in the SelectPlayMode command.
singleline_comment|// ----------------------------------------------------------------------------
r_typedef
r_enum
(brace
DECL|enumerator|K1212_MODE_SetupPlay
id|K1212_MODE_SetupPlay
op_assign
l_int|0x00000001
comma
singleline_comment|// provides card with pre-play information
DECL|enumerator|K1212_MODE_MonitorOn
id|K1212_MODE_MonitorOn
op_assign
l_int|0x00000002
comma
singleline_comment|// tells card to turn on monitor mode
DECL|enumerator|K1212_MODE_MonitorOff
id|K1212_MODE_MonitorOff
op_assign
l_int|0x00000004
comma
singleline_comment|// tells card to turn off monitor mode
DECL|enumerator|K1212_MODE_StopPlay
id|K1212_MODE_StopPlay
op_assign
l_int|0x00000008
singleline_comment|// stops playback on the card
DECL|typedef|PlayModeSelector
)brace
id|PlayModeSelector
suffix:semicolon
singleline_comment|// ----------------------------------------------------------------------------
singleline_comment|// The following enumeration defines the constants used to select the monitor
singleline_comment|// mode for the card in the SetMonitorMode command.
singleline_comment|// ----------------------------------------------------------------------------
r_typedef
r_enum
(brace
DECL|enumerator|K1212_MONMODE_Off
id|K1212_MONMODE_Off
op_assign
l_int|0
comma
singleline_comment|// tells card to turn off monitor mode
DECL|enumerator|K1212_MONMODE_On
id|K1212_MONMODE_On
singleline_comment|// tells card to turn on monitor mode
DECL|typedef|MonitorModeSelector
)brace
id|MonitorModeSelector
suffix:semicolon
DECL|macro|MAILBOX0_OFFSET
mdefine_line|#define MAILBOX0_OFFSET      0x40&t;
singleline_comment|// location of mailbox 0 relative to base address
DECL|macro|MAILBOX1_OFFSET
mdefine_line|#define MAILBOX1_OFFSET      0x44&t;
singleline_comment|// location of mailbox 1 relative to base address
DECL|macro|MAILBOX2_OFFSET
mdefine_line|#define MAILBOX2_OFFSET      0x48&t;
singleline_comment|// location of mailbox 2 relative to base address
DECL|macro|MAILBOX3_OFFSET
mdefine_line|#define MAILBOX3_OFFSET      0x4c&t;
singleline_comment|// location of mailbox 3 relative to base address
DECL|macro|OUT_DOORBELL_OFFSET
mdefine_line|#define OUT_DOORBELL_OFFSET  0x60&t;
singleline_comment|// location of PCI to local doorbell &quot;
DECL|macro|IN_DOORBELL_OFFSET
mdefine_line|#define IN_DOORBELL_OFFSET   0x64&t;
singleline_comment|// location of local to PCI doorbell &quot;
DECL|macro|STATUS_REG_OFFSET
mdefine_line|#define STATUS_REG_OFFSET    0x68&t;
singleline_comment|// location of interrupt control/status register &quot;
DECL|macro|PCI_CONTROL_OFFSET
mdefine_line|#define PCI_CONTROL_OFFSET   0x6c&t;
singleline_comment|// location of the EEPROM, PCI, User I/O, init control
singleline_comment|//    register
DECL|macro|SENS_CONTROL_OFFSET
mdefine_line|#define SENS_CONTROL_OFFSET  0x6e&t;
singleline_comment|// location of the input sensitivity setting register.
singleline_comment|//    this is the upper word of the PCI control reg.
DECL|macro|DEV_VEND_ID_OFFSET
mdefine_line|#define DEV_VEND_ID_OFFSET   0x70&t;
singleline_comment|// location of the device and vendor ID register
DECL|macro|COMMAND_ACK_DELAY
mdefine_line|#define COMMAND_ACK_DELAY    13        
singleline_comment|// number of RTC ticks to wait for an acknowledgement
singleline_comment|//    from the card after sending a command.
DECL|macro|INTERCOMMAND_DELAY
mdefine_line|#define INTERCOMMAND_DELAY   40
DECL|macro|MAX_COMMAND_RETRIES
mdefine_line|#define MAX_COMMAND_RETRIES  5         
singleline_comment|// maximum number of times the driver will attempt
singleline_comment|//    to send a command before giving up.
DECL|macro|COMMAND_ACK_MASK
mdefine_line|#define COMMAND_ACK_MASK     0x8000    
singleline_comment|// the MSB is set in the command acknowledgment from
singleline_comment|//    the card.
DECL|macro|DOORBELL_VAL_MASK
mdefine_line|#define DOORBELL_VAL_MASK    0x00FF    
singleline_comment|// the doorbell value is one byte
DECL|macro|CARD_BOOT_DELAY_IN_MS
mdefine_line|#define CARD_BOOT_DELAY_IN_MS  10
DECL|macro|DSP_BOOT_DELAY_IN_MS
mdefine_line|#define DSP_BOOT_DELAY_IN_MS   200
DECL|macro|kNumBuffers
mdefine_line|#define kNumBuffers&t;&t;8
DECL|macro|k1212MaxCards
mdefine_line|#define k1212MaxCards&t;&t;4
DECL|macro|k1212NumWaveDevices
mdefine_line|#define k1212NumWaveDevices&t;6
DECL|macro|k16BitChannels
mdefine_line|#define k16BitChannels&t;&t;10
DECL|macro|k32BitChannels
mdefine_line|#define k32BitChannels&t;&t;2
DECL|macro|kAudioChannels
mdefine_line|#define kAudioChannels&t;&t;(k16BitChannels + k32BitChannels)
DECL|macro|kPlayBufferFrames
mdefine_line|#define kPlayBufferFrames&t;1024
DECL|macro|K1212_CHANNELS
mdefine_line|#define K1212_CHANNELS     &t;16
DECL|macro|K1212_FRAME_SIZE
mdefine_line|#define K1212_FRAME_SIZE        (sizeof(KorgAudioFrame))
DECL|macro|K1212_MAX_SAMPLES
mdefine_line|#define K1212_MAX_SAMPLES&t;(kPlayBufferFrames*kNumBuffers)
DECL|macro|K1212_PERIODS
mdefine_line|#define K1212_PERIODS&t;&t;(K1212_BUF_SIZE/K1212_BLOCK_SIZE)
DECL|macro|K1212_PERIOD_BYTES
mdefine_line|#define K1212_PERIOD_BYTES&t;(K1212_BLOCK_SIZE)
DECL|macro|K1212_BLOCK_SIZE
mdefine_line|#define K1212_BLOCK_SIZE        (K1212_FRAME_SIZE*kPlayBufferFrames)
DECL|macro|K1212_BUF_SIZE
mdefine_line|#define K1212_BUF_SIZE          (K1212_BLOCK_SIZE*kNumBuffers)
DECL|macro|k1212MinADCSens
mdefine_line|#define k1212MinADCSens     0x7f
DECL|macro|k1212MaxADCSens
mdefine_line|#define k1212MaxADCSens     0x00
DECL|macro|k1212MaxVolume
mdefine_line|#define k1212MaxVolume      0x7fff
DECL|macro|k1212MaxWaveVolume
mdefine_line|#define k1212MaxWaveVolume  0xffff
DECL|macro|k1212MinVolume
mdefine_line|#define k1212MinVolume      0x0000
DECL|macro|k1212MaxVolInverted
mdefine_line|#define k1212MaxVolInverted 0x8000
singleline_comment|// -----------------------------------------------------------------
singleline_comment|// the following bits are used for controlling interrupts in the
singleline_comment|// interrupt control/status reg
singleline_comment|// -----------------------------------------------------------------
DECL|macro|PCI_INT_ENABLE_BIT
mdefine_line|#define  PCI_INT_ENABLE_BIT               0x00000100
DECL|macro|PCI_DOORBELL_INT_ENABLE_BIT
mdefine_line|#define  PCI_DOORBELL_INT_ENABLE_BIT      0x00000200
DECL|macro|LOCAL_INT_ENABLE_BIT
mdefine_line|#define  LOCAL_INT_ENABLE_BIT             0x00010000
DECL|macro|LOCAL_DOORBELL_INT_ENABLE_BIT
mdefine_line|#define  LOCAL_DOORBELL_INT_ENABLE_BIT    0x00020000
DECL|macro|LOCAL_DMA1_INT_ENABLE_BIT
mdefine_line|#define  LOCAL_DMA1_INT_ENABLE_BIT        0x00080000
singleline_comment|// -----------------------------------------------------------------
singleline_comment|// the following bits are defined for the PCI command register
singleline_comment|// -----------------------------------------------------------------
DECL|macro|PCI_CMD_MEM_SPACE_ENABLE_BIT
mdefine_line|#define  PCI_CMD_MEM_SPACE_ENABLE_BIT     0x0002
DECL|macro|PCI_CMD_IO_SPACE_ENABLE_BIT
mdefine_line|#define  PCI_CMD_IO_SPACE_ENABLE_BIT      0x0001
DECL|macro|PCI_CMD_BUS_MASTER_ENABLE_BIT
mdefine_line|#define  PCI_CMD_BUS_MASTER_ENABLE_BIT    0x0004
singleline_comment|// -----------------------------------------------------------------
singleline_comment|// the following bits are defined for the PCI status register
singleline_comment|// -----------------------------------------------------------------
DECL|macro|PCI_STAT_PARITY_ERROR_BIT
mdefine_line|#define  PCI_STAT_PARITY_ERROR_BIT        0x8000
DECL|macro|PCI_STAT_SYSTEM_ERROR_BIT
mdefine_line|#define  PCI_STAT_SYSTEM_ERROR_BIT        0x4000
DECL|macro|PCI_STAT_MASTER_ABORT_RCVD_BIT
mdefine_line|#define  PCI_STAT_MASTER_ABORT_RCVD_BIT   0x2000
DECL|macro|PCI_STAT_TARGET_ABORT_RCVD_BIT
mdefine_line|#define  PCI_STAT_TARGET_ABORT_RCVD_BIT   0x1000
DECL|macro|PCI_STAT_TARGET_ABORT_SENT_BIT
mdefine_line|#define  PCI_STAT_TARGET_ABORT_SENT_BIT   0x0800
singleline_comment|// ------------------------------------------------------------------------
singleline_comment|// the following constants are used in setting the 1212 I/O card&squot;s input
singleline_comment|// sensitivity.
singleline_comment|// ------------------------------------------------------------------------
DECL|macro|SET_SENS_LOCALINIT_BITPOS
mdefine_line|#define  SET_SENS_LOCALINIT_BITPOS        15
DECL|macro|SET_SENS_DATA_BITPOS
mdefine_line|#define  SET_SENS_DATA_BITPOS             10
DECL|macro|SET_SENS_CLOCK_BITPOS
mdefine_line|#define  SET_SENS_CLOCK_BITPOS            8
DECL|macro|SET_SENS_LOADSHIFT_BITPOS
mdefine_line|#define  SET_SENS_LOADSHIFT_BITPOS        0
DECL|macro|SET_SENS_LEFTCHANID
mdefine_line|#define  SET_SENS_LEFTCHANID              0x00
DECL|macro|SET_SENS_RIGHTCHANID
mdefine_line|#define  SET_SENS_RIGHTCHANID             0x01
DECL|macro|K1212SENSUPDATE_DELAY_IN_MS
mdefine_line|#define  K1212SENSUPDATE_DELAY_IN_MS      50
singleline_comment|// --------------------------------------------------------------------------
singleline_comment|// WaitRTCTicks
singleline_comment|//
singleline_comment|//    This function waits the specified number of real time clock ticks.
singleline_comment|//    According to the DDK, each tick is ~0.8 microseconds.
singleline_comment|//    The defines following the function declaration can be used for the
singleline_comment|//    numTicksToWait parameter.
singleline_comment|// --------------------------------------------------------------------------
DECL|macro|ONE_RTC_TICK
mdefine_line|#define ONE_RTC_TICK         1
DECL|macro|SENSCLKPULSE_WIDTH
mdefine_line|#define SENSCLKPULSE_WIDTH   4
DECL|macro|LOADSHIFT_DELAY
mdefine_line|#define LOADSHIFT_DELAY      4
DECL|macro|INTERCOMMAND_DELAY
mdefine_line|#define INTERCOMMAND_DELAY  40
DECL|macro|STOPCARD_DELAY
mdefine_line|#define STOPCARD_DELAY      300        
singleline_comment|// max # RTC ticks for the card to stop once we write
singleline_comment|//    the command register.  (could be up to 180 us)
DECL|macro|COMMAND_ACK_DELAY
mdefine_line|#define COMMAND_ACK_DELAY   13         
singleline_comment|// number of RTC ticks to wait for an acknowledgement
singleline_comment|//    from the card after sending a command.
macro_line|#include &quot;korg1212-firmware.h&quot;
DECL|typedef|korg1212_t
r_typedef
r_struct
id|_snd_korg1212
id|korg1212_t
suffix:semicolon
DECL|typedef|K1212Sample
r_typedef
id|u16
id|K1212Sample
suffix:semicolon
singleline_comment|// channels 0-9 use 16 bit samples
DECL|typedef|K1212SpdifSample
r_typedef
id|u32
id|K1212SpdifSample
suffix:semicolon
singleline_comment|// channels 10-11 use 32 bits - only 20 are sent
singleline_comment|//  across S/PDIF.
DECL|typedef|K1212TimeCodeSample
r_typedef
id|u32
id|K1212TimeCodeSample
suffix:semicolon
singleline_comment|// holds the ADAT timecode value
r_typedef
r_enum
(brace
DECL|enumerator|K1212_CLKIDX_AdatAt44_1K
id|K1212_CLKIDX_AdatAt44_1K
op_assign
l_int|0
comma
singleline_comment|// selects source as ADAT at 44.1 kHz
DECL|enumerator|K1212_CLKIDX_AdatAt48K
id|K1212_CLKIDX_AdatAt48K
comma
singleline_comment|// selects source as ADAT at 48 kHz
DECL|enumerator|K1212_CLKIDX_WordAt44_1K
id|K1212_CLKIDX_WordAt44_1K
comma
singleline_comment|// selects source as S/PDIF at 44.1 kHz
DECL|enumerator|K1212_CLKIDX_WordAt48K
id|K1212_CLKIDX_WordAt48K
comma
singleline_comment|// selects source as S/PDIF at 48 kHz
DECL|enumerator|K1212_CLKIDX_LocalAt44_1K
id|K1212_CLKIDX_LocalAt44_1K
comma
singleline_comment|// selects source as local clock at 44.1 kHz
DECL|enumerator|K1212_CLKIDX_LocalAt48K
id|K1212_CLKIDX_LocalAt48K
comma
singleline_comment|// selects source as local clock at 48 kHz
DECL|enumerator|K1212_CLKIDX_Invalid
id|K1212_CLKIDX_Invalid
singleline_comment|// used to check validity of the index
DECL|typedef|ClockSourceIndex
)brace
id|ClockSourceIndex
suffix:semicolon
r_typedef
r_enum
(brace
DECL|enumerator|K1212_CLKIDX_Adat
id|K1212_CLKIDX_Adat
op_assign
l_int|0
comma
singleline_comment|// selects source as ADAT
DECL|enumerator|K1212_CLKIDX_Word
id|K1212_CLKIDX_Word
comma
singleline_comment|// selects source as S/PDIF
DECL|enumerator|K1212_CLKIDX_Local
id|K1212_CLKIDX_Local
singleline_comment|// selects source as local clock
DECL|typedef|ClockSourceType
)brace
id|ClockSourceType
suffix:semicolon
DECL|struct|KorgAudioFrame
r_typedef
r_struct
id|KorgAudioFrame
(brace
DECL|member|frameData16
id|K1212Sample
id|frameData16
(braket
id|k16BitChannels
)braket
suffix:semicolon
DECL|member|frameData32
id|K1212SpdifSample
id|frameData32
(braket
id|k32BitChannels
)braket
suffix:semicolon
DECL|member|timeCodeVal
id|K1212TimeCodeSample
id|timeCodeVal
suffix:semicolon
DECL|typedef|KorgAudioFrame
)brace
id|KorgAudioFrame
suffix:semicolon
DECL|struct|KorgAudioBuffer
r_typedef
r_struct
id|KorgAudioBuffer
(brace
DECL|member|bufferData
id|KorgAudioFrame
id|bufferData
(braket
id|kPlayBufferFrames
)braket
suffix:semicolon
multiline_comment|/* buffer definition */
DECL|typedef|KorgAudioBuffer
)brace
id|KorgAudioBuffer
suffix:semicolon
DECL|struct|KorgSharedBuffer
r_typedef
r_struct
id|KorgSharedBuffer
(brace
macro_line|#ifdef LARGEALLOC
DECL|member|playDataBufs
id|KorgAudioBuffer
id|playDataBufs
(braket
id|kNumBuffers
)braket
suffix:semicolon
DECL|member|recordDataBufs
id|KorgAudioBuffer
id|recordDataBufs
(braket
id|kNumBuffers
)braket
suffix:semicolon
macro_line|#endif
DECL|member|volumeData
r_int
id|volumeData
(braket
id|kAudioChannels
)braket
suffix:semicolon
DECL|member|cardCommand
id|u32
id|cardCommand
suffix:semicolon
DECL|member|routeData
id|u16
id|routeData
(braket
id|kAudioChannels
)braket
suffix:semicolon
DECL|member|AdatTimeCode
id|u32
id|AdatTimeCode
suffix:semicolon
singleline_comment|// ADAT timecode value
DECL|typedef|KorgSharedBuffer
)brace
id|KorgSharedBuffer
suffix:semicolon
DECL|struct|SensBits
r_typedef
r_struct
id|SensBits
(brace
r_union
(brace
r_struct
(brace
DECL|member|leftChanVal
r_int
r_int
id|leftChanVal
suffix:colon
l_int|8
suffix:semicolon
DECL|member|leftChanId
r_int
r_int
id|leftChanId
suffix:colon
l_int|8
suffix:semicolon
DECL|member|v
)brace
id|v
suffix:semicolon
DECL|member|leftSensBits
id|u16
id|leftSensBits
suffix:semicolon
DECL|member|l
)brace
id|l
suffix:semicolon
r_union
(brace
r_struct
(brace
DECL|member|rightChanVal
r_int
r_int
id|rightChanVal
suffix:colon
l_int|8
suffix:semicolon
DECL|member|rightChanId
r_int
r_int
id|rightChanId
suffix:colon
l_int|8
suffix:semicolon
DECL|member|v
)brace
id|v
suffix:semicolon
DECL|member|rightSensBits
id|u16
id|rightSensBits
suffix:semicolon
DECL|member|r
)brace
id|r
suffix:semicolon
DECL|typedef|SensBits
)brace
id|SensBits
suffix:semicolon
DECL|struct|_snd_korg1212
r_struct
id|_snd_korg1212
(brace
DECL|member|pci
r_struct
id|pci_dev
op_star
id|pci
suffix:semicolon
DECL|member|card
id|snd_card_t
op_star
id|card
suffix:semicolon
DECL|member|pcm16
id|snd_pcm_t
op_star
id|pcm16
suffix:semicolon
DECL|member|irq
r_int
id|irq
suffix:semicolon
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|wait
id|wait_queue_head_t
id|wait
suffix:semicolon
DECL|member|iomem
r_int
r_int
id|iomem
suffix:semicolon
DECL|member|ioport
r_int
r_int
id|ioport
suffix:semicolon
DECL|member|iomem2
r_int
r_int
id|iomem2
suffix:semicolon
DECL|member|irqcount
r_int
r_int
id|irqcount
suffix:semicolon
DECL|member|inIRQ
r_int
r_int
id|inIRQ
suffix:semicolon
DECL|member|iobase
r_int
r_int
id|iobase
suffix:semicolon
DECL|member|res_iomem
r_struct
id|resource
op_star
id|res_iomem
suffix:semicolon
DECL|member|res_ioport
r_struct
id|resource
op_star
id|res_ioport
suffix:semicolon
DECL|member|res_iomem2
r_struct
id|resource
op_star
id|res_iomem2
suffix:semicolon
DECL|member|dspCodeSize
id|u32
id|dspCodeSize
suffix:semicolon
DECL|member|dspMemPhy
id|u32
id|dspMemPhy
suffix:semicolon
singleline_comment|// DSP memory block handle (Physical Address)
DECL|member|dspMemPtr
r_void
op_star
id|dspMemPtr
suffix:semicolon
singleline_comment|//            block memory (Virtual Address)
DECL|member|DataBufsSize
id|u32
id|DataBufsSize
suffix:semicolon
DECL|member|playDataBufsPtr
id|KorgAudioBuffer
op_star
id|playDataBufsPtr
suffix:semicolon
DECL|member|recordDataBufsPtr
id|KorgAudioBuffer
op_star
id|recordDataBufsPtr
suffix:semicolon
DECL|member|sharedBufferPtr
id|KorgSharedBuffer
op_star
id|sharedBufferPtr
suffix:semicolon
DECL|member|RecDataPhy
id|u32
id|RecDataPhy
suffix:semicolon
DECL|member|PlayDataPhy
id|u32
id|PlayDataPhy
suffix:semicolon
DECL|member|sharedBufferPhy
r_int
r_int
id|sharedBufferPhy
suffix:semicolon
DECL|member|VolumeTablePhy
id|u32
id|VolumeTablePhy
suffix:semicolon
DECL|member|RoutingTablePhy
id|u32
id|RoutingTablePhy
suffix:semicolon
DECL|member|AdatTimeCodePhy
id|u32
id|AdatTimeCodePhy
suffix:semicolon
DECL|member|statusRegPtr
id|u32
op_star
id|statusRegPtr
suffix:semicolon
singleline_comment|// address of the interrupt status/control register
DECL|member|outDoorbellPtr
id|u32
op_star
id|outDoorbellPtr
suffix:semicolon
singleline_comment|// address of the host-&gt;card doorbell register
DECL|member|inDoorbellPtr
id|u32
op_star
id|inDoorbellPtr
suffix:semicolon
singleline_comment|// address of the card-&gt;host doorbell register
DECL|member|mailbox0Ptr
id|u32
op_star
id|mailbox0Ptr
suffix:semicolon
singleline_comment|// address of mailbox 0 on the card
DECL|member|mailbox1Ptr
id|u32
op_star
id|mailbox1Ptr
suffix:semicolon
singleline_comment|// address of mailbox 1 on the card
DECL|member|mailbox2Ptr
id|u32
op_star
id|mailbox2Ptr
suffix:semicolon
singleline_comment|// address of mailbox 2 on the card
DECL|member|mailbox3Ptr
id|u32
op_star
id|mailbox3Ptr
suffix:semicolon
singleline_comment|// address of mailbox 3 on the card
DECL|member|controlRegPtr
id|u32
op_star
id|controlRegPtr
suffix:semicolon
singleline_comment|// address of the EEPROM, PCI, I/O, Init ctrl reg
DECL|member|sensRegPtr
id|u16
op_star
id|sensRegPtr
suffix:semicolon
singleline_comment|// address of the sensitivity setting register
DECL|member|idRegPtr
id|u32
op_star
id|idRegPtr
suffix:semicolon
singleline_comment|// address of the device and vendor ID registers
DECL|member|periodsize
r_int
id|periodsize
suffix:semicolon
DECL|member|currentBuffer
r_int
id|currentBuffer
suffix:semicolon
DECL|member|playback_substream
id|snd_pcm_substream_t
op_star
id|playback_substream
suffix:semicolon
DECL|member|capture_substream
id|snd_pcm_substream_t
op_star
id|capture_substream
suffix:semicolon
DECL|member|proc_entry
id|snd_info_entry_t
op_star
id|proc_entry
suffix:semicolon
DECL|member|cardState
id|CardState
id|cardState
suffix:semicolon
DECL|member|running
r_int
id|running
suffix:semicolon
DECL|member|idleMonitorOn
r_int
id|idleMonitorOn
suffix:semicolon
singleline_comment|// indicates whether the card is in idle monitor mode.
DECL|member|cmdRetryCount
id|u32
id|cmdRetryCount
suffix:semicolon
singleline_comment|// tracks how many times we have retried sending to the card.
DECL|member|clkSrcRate
id|ClockSourceIndex
id|clkSrcRate
suffix:semicolon
singleline_comment|// sample rate and clock source
DECL|member|clkSource
id|ClockSourceType
id|clkSource
suffix:semicolon
singleline_comment|// clock source
DECL|member|clkRate
r_int
id|clkRate
suffix:semicolon
singleline_comment|// clock rate
DECL|member|volumePhase
r_int
id|volumePhase
(braket
id|kAudioChannels
)braket
suffix:semicolon
DECL|member|leftADCInSens
id|u16
id|leftADCInSens
suffix:semicolon
singleline_comment|// ADC left channel input sensitivity
DECL|member|rightADCInSens
id|u16
id|rightADCInSens
suffix:semicolon
singleline_comment|// ADC right channel input sensitivity
)brace
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;korg1212&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_CLASSES
c_func
(paren
l_string|&quot;{sound}&quot;
)paren
suffix:semicolon
id|MODULE_DEVICES
c_func
(paren
l_string|&quot;{{KORG,korg1212}}&quot;
)paren
suffix:semicolon
DECL|variable|snd_index
r_static
r_int
id|snd_index
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_IDX
suffix:semicolon
multiline_comment|/* Index 0-MAX */
DECL|variable|snd_id
r_static
r_char
op_star
id|snd_id
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_STR
suffix:semicolon
multiline_comment|/* ID for this card */
DECL|variable|snd_enable
r_static
r_int
id|snd_enable
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_ENABLE
suffix:semicolon
multiline_comment|/* Enable this card */
id|MODULE_PARM
c_func
(paren
id|snd_index
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_index
comma
l_string|&quot;Index value for Korg 1212 soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_index
comma
id|SNDRV_INDEX_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_id
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_id
comma
l_string|&quot;ID string for Korg 1212 soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_id
comma
id|SNDRV_ID_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_enable
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_enable
comma
l_string|&quot;Enable Korg 1212 soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_enable
comma
id|SNDRV_ENABLE_DESC
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Haroldo Gamal &lt;gamal@alternex.com.br&gt;&quot;
)paren
suffix:semicolon
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|snd_korg1212_ids
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
l_int|0x10b5
comma
l_int|0x906d
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
DECL|variable|stateName
r_static
r_char
op_star
id|stateName
(braket
)braket
op_assign
(brace
l_string|&quot;Non-existent&quot;
comma
l_string|&quot;Uninitialized&quot;
comma
l_string|&quot;DSP download in process&quot;
comma
l_string|&quot;DSP download complete&quot;
comma
l_string|&quot;Ready&quot;
comma
l_string|&quot;Open&quot;
comma
l_string|&quot;Setup for play&quot;
comma
l_string|&quot;Playing&quot;
comma
l_string|&quot;Monitor mode on&quot;
comma
l_string|&quot;Calibrating&quot;
l_string|&quot;Invalid&quot;
)brace
suffix:semicolon
DECL|variable|clockSourceTypeName
r_static
r_char
op_star
id|clockSourceTypeName
(braket
)braket
op_assign
(brace
l_string|&quot;ADAT&quot;
comma
l_string|&quot;S/PDIF&quot;
comma
l_string|&quot;local&quot;
)brace
suffix:semicolon
DECL|variable|clockSourceName
r_static
r_char
op_star
id|clockSourceName
(braket
)braket
op_assign
(brace
l_string|&quot;ADAT at 44.1 kHz&quot;
comma
l_string|&quot;ADAT at 48 kHz&quot;
comma
l_string|&quot;S/PDIF at 44.1 kHz&quot;
comma
l_string|&quot;S/PDIF at 48 kHz&quot;
comma
l_string|&quot;local clock at 44.1 kHz&quot;
comma
l_string|&quot;local clock at 48 kHz&quot;
)brace
suffix:semicolon
DECL|variable|channelName
r_static
r_char
op_star
id|channelName
(braket
)braket
op_assign
(brace
l_string|&quot;ADAT-1&quot;
comma
l_string|&quot;ADAT-2&quot;
comma
l_string|&quot;ADAT-3&quot;
comma
l_string|&quot;ADAT-4&quot;
comma
l_string|&quot;ADAT-5&quot;
comma
l_string|&quot;ADAT-6&quot;
comma
l_string|&quot;ADAT-7&quot;
comma
l_string|&quot;ADAT-8&quot;
comma
l_string|&quot;Analog-L&quot;
comma
l_string|&quot;Analog-R&quot;
comma
l_string|&quot;SPDIF-L&quot;
comma
l_string|&quot;SPDIF-R&quot;
comma
)brace
suffix:semicolon
DECL|variable|ClockSourceSelector
id|u16
id|ClockSourceSelector
(braket
)braket
op_assign
(brace
l_int|0x8000
comma
singleline_comment|// selects source as ADAT at 44.1 kHz
l_int|0x0000
comma
singleline_comment|// selects source as ADAT at 48 kHz
l_int|0x8001
comma
singleline_comment|// selects source as S/PDIF at 44.1 kHz
l_int|0x0001
comma
singleline_comment|// selects source as S/PDIF at 48 kHz
l_int|0x8002
comma
singleline_comment|// selects source as local clock at 44.1 kHz
l_int|0x0002
singleline_comment|// selects source as local clock at 48 kHz
)brace
suffix:semicolon
DECL|variable|rc
id|snd_korg1212rc
id|rc
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|snd_korg1212_ids
)paren
suffix:semicolon
DECL|typedef|swap_u32
DECL|member|c
DECL|member|i
DECL|typedef|swap_u32
r_typedef
r_union
id|swap_u32
(brace
r_int
r_char
id|c
(braket
l_int|4
)braket
suffix:semicolon
id|u32
id|i
suffix:semicolon
)brace
id|swap_u32
suffix:semicolon
macro_line|#ifdef SNDRV_BIG_ENDIAN
DECL|function|LowerWordSwap
r_static
id|u32
id|LowerWordSwap
c_func
(paren
id|u32
id|swappee
)paren
macro_line|#else
r_static
id|u32
id|UpperWordSwap
c_func
(paren
id|u32
id|swappee
)paren
macro_line|#endif
(brace
id|swap_u32
id|retVal
comma
id|swapper
suffix:semicolon
id|swapper.i
op_assign
id|swappee
suffix:semicolon
id|retVal.c
(braket
l_int|2
)braket
op_assign
id|swapper.c
(braket
l_int|3
)braket
suffix:semicolon
id|retVal.c
(braket
l_int|3
)braket
op_assign
id|swapper.c
(braket
l_int|2
)braket
suffix:semicolon
id|retVal.c
(braket
l_int|1
)braket
op_assign
id|swapper.c
(braket
l_int|1
)braket
suffix:semicolon
id|retVal.c
(braket
l_int|0
)braket
op_assign
id|swapper.c
(braket
l_int|0
)braket
suffix:semicolon
r_return
id|retVal.i
suffix:semicolon
)brace
macro_line|#ifdef SNDRV_BIG_ENDIAN
DECL|function|UpperWordSwap
r_static
id|u32
id|UpperWordSwap
c_func
(paren
id|u32
id|swappee
)paren
macro_line|#else
r_static
id|u32
id|LowerWordSwap
c_func
(paren
id|u32
id|swappee
)paren
macro_line|#endif
(brace
id|swap_u32
id|retVal
comma
id|swapper
suffix:semicolon
id|swapper.i
op_assign
id|swappee
suffix:semicolon
id|retVal.c
(braket
l_int|2
)braket
op_assign
id|swapper.c
(braket
l_int|2
)braket
suffix:semicolon
id|retVal.c
(braket
l_int|3
)braket
op_assign
id|swapper.c
(braket
l_int|3
)braket
suffix:semicolon
id|retVal.c
(braket
l_int|1
)braket
op_assign
id|swapper.c
(braket
l_int|0
)braket
suffix:semicolon
id|retVal.c
(braket
l_int|0
)braket
op_assign
id|swapper.c
(braket
l_int|1
)braket
suffix:semicolon
r_return
id|retVal.i
suffix:semicolon
)brace
macro_line|#if 0 /* not used */
r_static
id|u32
id|EndianSwap
c_func
(paren
id|u32
id|swappee
)paren
(brace
id|swap_u32
id|retVal
comma
id|swapper
suffix:semicolon
id|swapper.i
op_assign
id|swappee
suffix:semicolon
id|retVal.c
(braket
l_int|0
)braket
op_assign
id|swapper.c
(braket
l_int|3
)braket
suffix:semicolon
id|retVal.c
(braket
l_int|1
)braket
op_assign
id|swapper.c
(braket
l_int|2
)braket
suffix:semicolon
id|retVal.c
(braket
l_int|2
)braket
op_assign
id|swapper.c
(braket
l_int|1
)braket
suffix:semicolon
id|retVal.c
(braket
l_int|3
)braket
op_assign
id|swapper.c
(braket
l_int|0
)braket
suffix:semicolon
r_return
id|retVal.i
suffix:semicolon
)brace
macro_line|#endif /* not used */
DECL|function|TickDelay
r_void
id|TickDelay
c_func
(paren
r_int
id|time
)paren
(brace
id|udelay
c_func
(paren
id|time
)paren
suffix:semicolon
)brace
DECL|macro|SetBitInWord
mdefine_line|#define SetBitInWord(theWord,bitPosition)       (*theWord) |= (0x0001 &lt;&lt; bitPosition)
DECL|macro|SetBitInDWord
mdefine_line|#define SetBitInDWord(theWord,bitPosition)      (*theWord) |= (0x00000001 &lt;&lt; bitPosition)
DECL|macro|ClearBitInWord
mdefine_line|#define ClearBitInWord(theWord,bitPosition)     (*theWord) &amp;= ~(0x0001 &lt;&lt; bitPosition)
DECL|macro|ClearBitInDWord
mdefine_line|#define ClearBitInDWord(theWord,bitPosition)    (*theWord) &amp;= ~(0x00000001 &lt;&lt; bitPosition)
DECL|function|snd_korg1212_Send1212Command
r_static
id|snd_korg1212rc
id|snd_korg1212_Send1212Command
c_func
(paren
id|korg1212_t
op_star
id|korg1212
comma
id|korg1212_dbcnst_t
id|doorbellVal
comma
id|u32
id|mailBox0Val
comma
id|u32
id|mailBox1Val
comma
id|u32
id|mailBox2Val
comma
id|u32
id|mailBox3Val
)paren
(brace
id|u32
id|retryCount
suffix:semicolon
id|u16
id|mailBox3Lo
suffix:semicolon
r_if
c_cond
(paren
id|korg1212-&gt;outDoorbellPtr
)paren
(brace
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: Card &lt;- 0x%08x 0x%08x [%s]&bslash;n&quot;
comma
id|doorbellVal
comma
id|mailBox0Val
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
id|retryCount
op_assign
l_int|0
suffix:semicolon
id|retryCount
OL
id|MAX_COMMAND_RETRIES
suffix:semicolon
id|retryCount
op_increment
)paren
(brace
id|writel
c_func
(paren
id|mailBox3Val
comma
id|korg1212-&gt;mailbox3Ptr
)paren
suffix:semicolon
id|writel
c_func
(paren
id|mailBox2Val
comma
id|korg1212-&gt;mailbox2Ptr
)paren
suffix:semicolon
id|writel
c_func
(paren
id|mailBox1Val
comma
id|korg1212-&gt;mailbox1Ptr
)paren
suffix:semicolon
id|writel
c_func
(paren
id|mailBox0Val
comma
id|korg1212-&gt;mailbox0Ptr
)paren
suffix:semicolon
id|writel
c_func
(paren
id|doorbellVal
comma
id|korg1212-&gt;outDoorbellPtr
)paren
suffix:semicolon
singleline_comment|// interrupt the card
singleline_comment|// --------------------------------------------------------------
singleline_comment|// the reboot command will not give an acknowledgement.
singleline_comment|// --------------------------------------------------------------
r_switch
c_cond
(paren
id|doorbellVal
)paren
(brace
r_case
id|K1212_DB_RebootCard
suffix:colon
r_case
id|K1212_DB_BootFromDSPPage4
suffix:colon
r_case
id|K1212_DB_StartDSPDownload
suffix:colon
r_return
id|K1212_CMDRET_Success
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
singleline_comment|// --------------------------------------------------------------
singleline_comment|// See if the card acknowledged the command.  Wait a bit, then
singleline_comment|// read in the low word of mailbox3.  If the MSB is set and the
singleline_comment|// low byte is equal to the doorbell value, then it ack&squot;d.
singleline_comment|// --------------------------------------------------------------
id|TickDelay
c_func
(paren
id|COMMAND_ACK_DELAY
)paren
suffix:semicolon
id|mailBox3Lo
op_assign
id|readl
c_func
(paren
id|korg1212-&gt;mailbox3Ptr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mailBox3Lo
op_amp
id|COMMAND_ACK_MASK
)paren
(brace
r_if
c_cond
(paren
(paren
id|mailBox3Lo
op_amp
id|DOORBELL_VAL_MASK
)paren
op_eq
(paren
id|doorbellVal
op_amp
id|DOORBELL_VAL_MASK
)paren
)paren
(brace
id|korg1212-&gt;cmdRetryCount
op_add_assign
id|retryCount
suffix:semicolon
r_return
id|K1212_CMDRET_Success
suffix:semicolon
)brace
)brace
)brace
id|korg1212-&gt;cmdRetryCount
op_add_assign
id|retryCount
suffix:semicolon
r_return
id|K1212_CMDRET_NoAckFromCard
suffix:semicolon
)brace
r_else
(brace
r_return
id|K1212_CMDRET_CardUninitialized
suffix:semicolon
)brace
)brace
DECL|function|snd_korg1212_WaitForCardStopAck
r_static
r_void
id|snd_korg1212_WaitForCardStopAck
c_func
(paren
id|korg1212_t
op_star
id|korg1212
)paren
(brace
r_int
r_int
id|endtime
op_assign
id|jiffies
op_plus
l_int|20
op_star
id|HZ
suffix:semicolon
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: WaitForCardStopAck [%s]&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif 
singleline_comment|// DEBUG
r_if
c_cond
(paren
id|korg1212-&gt;inIRQ
)paren
r_return
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|readl
c_func
(paren
op_amp
id|korg1212-&gt;sharedBufferPtr-&gt;cardCommand
)paren
op_eq
l_int|0
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|korg1212-&gt;inIRQ
)paren
id|schedule
c_func
(paren
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|jiffies
OL
id|endtime
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
op_amp
id|korg1212-&gt;sharedBufferPtr-&gt;cardCommand
)paren
suffix:semicolon
)brace
DECL|function|snd_korg1212_TurnOnIdleMonitor
r_static
r_void
id|snd_korg1212_TurnOnIdleMonitor
c_func
(paren
id|korg1212_t
op_star
id|korg1212
)paren
(brace
id|TickDelay
c_func
(paren
id|INTERCOMMAND_DELAY
)paren
suffix:semicolon
id|korg1212-&gt;idleMonitorOn
op_assign
l_int|1
suffix:semicolon
id|rc
op_assign
id|snd_korg1212_Send1212Command
c_func
(paren
id|korg1212
comma
id|K1212_DB_SelectPlayMode
comma
id|K1212_MODE_MonitorOn
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|snd_korg1212_TurnOffIdleMonitor
r_static
r_void
id|snd_korg1212_TurnOffIdleMonitor
c_func
(paren
id|korg1212_t
op_star
id|korg1212
)paren
(brace
r_if
c_cond
(paren
id|korg1212-&gt;idleMonitorOn
)paren
(brace
id|writel
c_func
(paren
l_int|0xffffffff
comma
op_amp
id|korg1212-&gt;sharedBufferPtr-&gt;cardCommand
)paren
suffix:semicolon
id|snd_korg1212_WaitForCardStopAck
c_func
(paren
id|korg1212
)paren
suffix:semicolon
id|korg1212-&gt;idleMonitorOn
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|snd_korg1212_setCardState
r_static
r_void
id|snd_korg1212_setCardState
c_func
(paren
id|korg1212_t
op_star
id|korg1212
comma
id|CardState
id|csState
)paren
(brace
r_switch
c_cond
(paren
id|csState
)paren
(brace
r_case
id|K1212_STATE_READY
suffix:colon
id|snd_korg1212_TurnOnIdleMonitor
c_func
(paren
id|korg1212
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|K1212_STATE_OPEN
suffix:colon
id|snd_korg1212_TurnOffIdleMonitor
c_func
(paren
id|korg1212
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|korg1212-&gt;cardState
op_assign
id|csState
suffix:semicolon
)brace
DECL|function|snd_korg1212_OpenCard
r_static
r_int
id|snd_korg1212_OpenCard
c_func
(paren
id|korg1212_t
op_star
id|korg1212
)paren
(brace
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: OpenCard [%s]&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|snd_korg1212_setCardState
c_func
(paren
id|korg1212
comma
id|K1212_STATE_OPEN
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|snd_korg1212_CloseCard
r_static
r_int
id|snd_korg1212_CloseCard
c_func
(paren
id|korg1212_t
op_star
id|korg1212
)paren
(brace
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: CloseCard [%s]&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|korg1212-&gt;cardState
op_eq
id|K1212_STATE_SETUP
)paren
(brace
id|rc
op_assign
id|snd_korg1212_Send1212Command
c_func
(paren
id|korg1212
comma
id|K1212_DB_SelectPlayMode
comma
id|K1212_MODE_StopPlay
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|rc
)paren
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: CloseCard - RC = %d [%s]&bslash;n&quot;
comma
id|rc
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|rc
op_ne
id|K1212_CMDRET_Success
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|korg1212-&gt;cardState
OG
id|K1212_STATE_SETUP
)paren
(brace
id|writel
c_func
(paren
l_int|0xffffffff
comma
op_amp
id|korg1212-&gt;sharedBufferPtr-&gt;cardCommand
)paren
suffix:semicolon
id|snd_korg1212_WaitForCardStopAck
c_func
(paren
id|korg1212
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|korg1212-&gt;cardState
OG
id|K1212_STATE_READY
)paren
id|snd_korg1212_setCardState
c_func
(paren
id|korg1212
comma
id|K1212_STATE_READY
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_SetupForPlay
r_static
r_int
id|snd_korg1212_SetupForPlay
c_func
(paren
id|korg1212_t
op_star
id|korg1212
)paren
(brace
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: SetupForPlay [%s]&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|snd_korg1212_setCardState
c_func
(paren
id|korg1212
comma
id|K1212_STATE_SETUP
)paren
suffix:semicolon
id|rc
op_assign
id|snd_korg1212_Send1212Command
c_func
(paren
id|korg1212
comma
id|K1212_DB_SelectPlayMode
comma
id|K1212_MODE_SetupPlay
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|rc
)paren
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: SetupForPlay - RC = %d [%s]&bslash;n&quot;
comma
id|rc
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|rc
op_ne
id|K1212_CMDRET_Success
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|snd_korg1212_TriggerPlay
r_static
r_int
id|snd_korg1212_TriggerPlay
c_func
(paren
id|korg1212_t
op_star
id|korg1212
)paren
(brace
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: TriggerPlay [%s]&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|snd_korg1212_setCardState
c_func
(paren
id|korg1212
comma
id|K1212_STATE_PLAYING
)paren
suffix:semicolon
id|rc
op_assign
id|snd_korg1212_Send1212Command
c_func
(paren
id|korg1212
comma
id|K1212_DB_TriggerPlay
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|rc
)paren
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: TriggerPlay - RC = %d [%s]&bslash;n&quot;
comma
id|rc
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|rc
op_ne
id|K1212_CMDRET_Success
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|snd_korg1212_StopPlay
r_static
r_int
id|snd_korg1212_StopPlay
c_func
(paren
id|korg1212_t
op_star
id|korg1212
)paren
(brace
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: StopPlay [%s]&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|korg1212-&gt;cardState
op_ne
id|K1212_STATE_ERRORSTOP
)paren
(brace
id|writel
c_func
(paren
l_int|0xffffffff
comma
op_amp
id|korg1212-&gt;sharedBufferPtr-&gt;cardCommand
)paren
suffix:semicolon
id|snd_korg1212_WaitForCardStopAck
c_func
(paren
id|korg1212
)paren
suffix:semicolon
)brace
id|snd_korg1212_setCardState
c_func
(paren
id|korg1212
comma
id|K1212_STATE_OPEN
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|snd_korg1212_EnableCardInterrupts
r_static
r_void
id|snd_korg1212_EnableCardInterrupts
c_func
(paren
id|korg1212_t
op_star
id|korg1212
)paren
(brace
op_star
id|korg1212-&gt;statusRegPtr
op_assign
id|PCI_INT_ENABLE_BIT
op_or
id|PCI_DOORBELL_INT_ENABLE_BIT
op_or
id|LOCAL_INT_ENABLE_BIT
op_or
id|LOCAL_DOORBELL_INT_ENABLE_BIT
op_or
id|LOCAL_DMA1_INT_ENABLE_BIT
suffix:semicolon
)brace
macro_line|#if 0 /* not used */
r_static
r_int
id|snd_korg1212_SetMonitorMode
c_func
(paren
id|korg1212_t
op_star
id|korg1212
comma
id|MonitorModeSelector
id|mode
)paren
(brace
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: SetMonitorMode [%s]&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|K1212_MONMODE_Off
suffix:colon
r_if
c_cond
(paren
id|korg1212-&gt;cardState
op_ne
id|K1212_STATE_MONITOR
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|writel
c_func
(paren
l_int|0xffffffff
comma
op_amp
id|korg1212-&gt;sharedBufferPtr-&gt;cardCommand
)paren
suffix:semicolon
id|snd_korg1212_WaitForCardStopAck
c_func
(paren
id|korg1212
)paren
suffix:semicolon
id|snd_korg1212_setCardState
c_func
(paren
id|korg1212
comma
id|K1212_STATE_OPEN
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|K1212_MONMODE_On
suffix:colon
r_if
c_cond
(paren
id|korg1212-&gt;cardState
op_ne
id|K1212_STATE_OPEN
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|snd_korg1212_setCardState
c_func
(paren
id|korg1212
comma
id|K1212_STATE_MONITOR
)paren
suffix:semicolon
id|rc
op_assign
id|snd_korg1212_Send1212Command
c_func
(paren
id|korg1212
comma
id|K1212_DB_SelectPlayMode
comma
id|K1212_MODE_MonitorOn
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
id|K1212_CMDRET_Success
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#endif /* not used */
DECL|function|snd_korg1212_SetRate
r_static
r_int
id|snd_korg1212_SetRate
c_func
(paren
id|korg1212_t
op_star
id|korg1212
comma
r_int
id|rate
)paren
(brace
r_static
id|ClockSourceIndex
id|s44
(braket
)braket
op_assign
(brace
id|K1212_CLKIDX_AdatAt44_1K
comma
id|K1212_CLKIDX_WordAt44_1K
comma
id|K1212_CLKIDX_LocalAt44_1K
)brace
suffix:semicolon
r_static
id|ClockSourceIndex
id|s48
(braket
)braket
op_assign
(brace
id|K1212_CLKIDX_AdatAt48K
comma
id|K1212_CLKIDX_WordAt48K
comma
id|K1212_CLKIDX_LocalAt48K
)brace
suffix:semicolon
r_int
id|parm
suffix:semicolon
r_switch
c_cond
(paren
id|rate
)paren
(brace
r_case
l_int|44100
suffix:colon
id|parm
op_assign
id|s44
(braket
id|korg1212-&gt;clkSource
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|48000
suffix:colon
id|parm
op_assign
id|s48
(braket
id|korg1212-&gt;clkSource
)braket
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|korg1212-&gt;clkSrcRate
op_assign
id|parm
suffix:semicolon
id|korg1212-&gt;clkRate
op_assign
id|rate
suffix:semicolon
id|TickDelay
c_func
(paren
id|INTERCOMMAND_DELAY
)paren
suffix:semicolon
id|rc
op_assign
id|snd_korg1212_Send1212Command
c_func
(paren
id|korg1212
comma
id|K1212_DB_SetClockSourceRate
comma
id|ClockSourceSelector
(braket
id|korg1212-&gt;clkSrcRate
)braket
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|rc
)paren
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: Set Clock Source Selector - RC = %d [%s]&bslash;n&quot;
comma
id|rc
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_SetClockSource
r_static
r_int
id|snd_korg1212_SetClockSource
c_func
(paren
id|korg1212_t
op_star
id|korg1212
comma
r_int
id|source
)paren
(brace
r_if
c_cond
(paren
id|source
l_int|2
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|korg1212-&gt;clkSource
op_assign
id|source
suffix:semicolon
id|snd_korg1212_SetRate
c_func
(paren
id|korg1212
comma
id|korg1212-&gt;clkRate
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_DisableCardInterrupts
r_static
r_void
id|snd_korg1212_DisableCardInterrupts
c_func
(paren
id|korg1212_t
op_star
id|korg1212
)paren
(brace
op_star
id|korg1212-&gt;statusRegPtr
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_WriteADCSensitivity
r_static
r_int
id|snd_korg1212_WriteADCSensitivity
c_func
(paren
id|korg1212_t
op_star
id|korg1212
)paren
(brace
id|SensBits
id|sensVals
suffix:semicolon
r_int
id|bitPosition
suffix:semicolon
r_int
id|channel
suffix:semicolon
r_int
id|clkIs48K
suffix:semicolon
r_int
id|monModeSet
suffix:semicolon
id|u16
id|controlValue
suffix:semicolon
singleline_comment|// this keeps the current value to be written to
singleline_comment|//  the card&squot;s eeprom control register.
id|u16
id|count
suffix:semicolon
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: WriteADCSensivity [%s]&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
singleline_comment|// ----------------------------------------------------------------------------
singleline_comment|// initialize things.  The local init bit is always set when writing to the
singleline_comment|// card&squot;s control register.
singleline_comment|// ----------------------------------------------------------------------------
id|controlValue
op_assign
l_int|0
suffix:semicolon
id|SetBitInWord
c_func
(paren
op_amp
id|controlValue
comma
id|SET_SENS_LOCALINIT_BITPOS
)paren
suffix:semicolon
singleline_comment|// init the control value
singleline_comment|// ----------------------------------------------------------------------------
singleline_comment|// make sure the card is not in monitor mode when we do this update.
singleline_comment|// ----------------------------------------------------------------------------
r_if
c_cond
(paren
id|korg1212-&gt;cardState
op_eq
id|K1212_STATE_MONITOR
op_logical_or
id|korg1212-&gt;idleMonitorOn
)paren
(brace
id|writel
c_func
(paren
l_int|0xffffffff
comma
op_amp
id|korg1212-&gt;sharedBufferPtr-&gt;cardCommand
)paren
suffix:semicolon
id|monModeSet
op_assign
l_int|1
suffix:semicolon
id|snd_korg1212_WaitForCardStopAck
c_func
(paren
id|korg1212
)paren
suffix:semicolon
)brace
r_else
id|monModeSet
op_assign
l_int|0
suffix:semicolon
singleline_comment|// ----------------------------------------------------------------------------
singleline_comment|// we are about to send new values to the card, so clear the new values queued
singleline_comment|// flag.  Also, clear out mailbox 3, so we don&squot;t lockup.
singleline_comment|// ----------------------------------------------------------------------------
id|writel
c_func
(paren
l_int|0
comma
id|korg1212-&gt;mailbox3Ptr
)paren
suffix:semicolon
id|TickDelay
c_func
(paren
id|LOADSHIFT_DELAY
)paren
suffix:semicolon
singleline_comment|// ----------------------------------------------------------------------------
singleline_comment|// determine whether we are running a 48K or 44.1K clock.  This info is used
singleline_comment|// later when setting the SPDIF FF after the volume has been shifted in.
singleline_comment|// ----------------------------------------------------------------------------
r_switch
c_cond
(paren
id|korg1212-&gt;clkSrcRate
)paren
(brace
r_case
id|K1212_CLKIDX_AdatAt44_1K
suffix:colon
r_case
id|K1212_CLKIDX_WordAt44_1K
suffix:colon
r_case
id|K1212_CLKIDX_LocalAt44_1K
suffix:colon
id|clkIs48K
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|K1212_CLKIDX_WordAt48K
suffix:colon
r_case
id|K1212_CLKIDX_AdatAt48K
suffix:colon
r_case
id|K1212_CLKIDX_LocalAt48K
suffix:colon
r_default
suffix:colon
id|clkIs48K
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
singleline_comment|// ----------------------------------------------------------------------------
singleline_comment|// start the update.  Setup the bit structure and then shift the bits.
singleline_comment|// ----------------------------------------------------------------------------
id|sensVals.l.v.leftChanId
op_assign
id|SET_SENS_LEFTCHANID
suffix:semicolon
id|sensVals.r.v.rightChanId
op_assign
id|SET_SENS_RIGHTCHANID
suffix:semicolon
id|sensVals.l.v.leftChanVal
op_assign
id|korg1212-&gt;leftADCInSens
suffix:semicolon
id|sensVals.r.v.rightChanVal
op_assign
id|korg1212-&gt;rightADCInSens
suffix:semicolon
singleline_comment|// ----------------------------------------------------------------------------
singleline_comment|// now start shifting the bits in.  Start with the left channel then the right.
singleline_comment|// ----------------------------------------------------------------------------
r_for
c_loop
(paren
id|channel
op_assign
l_int|0
suffix:semicolon
id|channel
OL
l_int|2
suffix:semicolon
id|channel
op_increment
)paren
(brace
singleline_comment|// ----------------------------------------------------------------------------
singleline_comment|// Bring the load/shift line low, then wait - the spec says &gt;150ns from load/
singleline_comment|// shift low to the first rising edge of the clock.
singleline_comment|// ----------------------------------------------------------------------------
id|ClearBitInWord
c_func
(paren
op_amp
id|controlValue
comma
id|SET_SENS_LOADSHIFT_BITPOS
)paren
suffix:semicolon
id|ClearBitInWord
c_func
(paren
op_amp
id|controlValue
comma
id|SET_SENS_DATA_BITPOS
)paren
suffix:semicolon
id|writew
c_func
(paren
id|controlValue
comma
id|korg1212-&gt;sensRegPtr
)paren
suffix:semicolon
singleline_comment|// load/shift goes low
id|TickDelay
c_func
(paren
id|LOADSHIFT_DELAY
)paren
suffix:semicolon
r_for
c_loop
(paren
id|bitPosition
op_assign
l_int|15
suffix:semicolon
id|bitPosition
op_ge
l_int|0
suffix:semicolon
id|bitPosition
op_decrement
)paren
(brace
singleline_comment|// for all the bits
r_if
c_cond
(paren
id|channel
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|sensVals.l.leftSensBits
op_amp
(paren
l_int|0x0001
op_lshift
id|bitPosition
)paren
)paren
(brace
id|SetBitInWord
c_func
(paren
op_amp
id|controlValue
comma
id|SET_SENS_DATA_BITPOS
)paren
suffix:semicolon
singleline_comment|// data bit set high
)brace
r_else
(brace
id|ClearBitInWord
c_func
(paren
op_amp
id|controlValue
comma
id|SET_SENS_DATA_BITPOS
)paren
suffix:semicolon
singleline_comment|// data bit set low
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|sensVals.r.rightSensBits
op_amp
(paren
l_int|0x0001
op_lshift
id|bitPosition
)paren
)paren
(brace
id|SetBitInWord
c_func
(paren
op_amp
id|controlValue
comma
id|SET_SENS_DATA_BITPOS
)paren
suffix:semicolon
singleline_comment|// data bit set high
)brace
r_else
(brace
id|ClearBitInWord
c_func
(paren
op_amp
id|controlValue
comma
id|SET_SENS_DATA_BITPOS
)paren
suffix:semicolon
singleline_comment|// data bit set low
)brace
)brace
id|ClearBitInWord
c_func
(paren
op_amp
id|controlValue
comma
id|SET_SENS_CLOCK_BITPOS
)paren
suffix:semicolon
id|writew
c_func
(paren
id|controlValue
comma
id|korg1212-&gt;sensRegPtr
)paren
suffix:semicolon
singleline_comment|// clock goes low
id|TickDelay
c_func
(paren
id|SENSCLKPULSE_WIDTH
)paren
suffix:semicolon
id|SetBitInWord
c_func
(paren
op_amp
id|controlValue
comma
id|SET_SENS_CLOCK_BITPOS
)paren
suffix:semicolon
id|writew
c_func
(paren
id|controlValue
comma
id|korg1212-&gt;sensRegPtr
)paren
suffix:semicolon
singleline_comment|// clock goes high
id|TickDelay
c_func
(paren
id|SENSCLKPULSE_WIDTH
)paren
suffix:semicolon
)brace
singleline_comment|// ----------------------------------------------------------------------------
singleline_comment|// finish up SPDIF for left.  Bring the load/shift line high, then write a one
singleline_comment|// bit if the clock rate is 48K otherwise write 0.
singleline_comment|// ----------------------------------------------------------------------------
id|ClearBitInWord
c_func
(paren
op_amp
id|controlValue
comma
id|SET_SENS_DATA_BITPOS
)paren
suffix:semicolon
id|ClearBitInWord
c_func
(paren
op_amp
id|controlValue
comma
id|SET_SENS_CLOCK_BITPOS
)paren
suffix:semicolon
id|SetBitInWord
c_func
(paren
op_amp
id|controlValue
comma
id|SET_SENS_LOADSHIFT_BITPOS
)paren
suffix:semicolon
id|writew
c_func
(paren
id|controlValue
comma
id|korg1212-&gt;sensRegPtr
)paren
suffix:semicolon
singleline_comment|// load shift goes high - clk low
id|TickDelay
c_func
(paren
id|SENSCLKPULSE_WIDTH
)paren
suffix:semicolon
r_if
c_cond
(paren
id|clkIs48K
)paren
id|SetBitInWord
c_func
(paren
op_amp
id|controlValue
comma
id|SET_SENS_DATA_BITPOS
)paren
suffix:semicolon
id|writew
c_func
(paren
id|controlValue
comma
id|korg1212-&gt;sensRegPtr
)paren
suffix:semicolon
singleline_comment|// set/clear data bit
id|TickDelay
c_func
(paren
id|ONE_RTC_TICK
)paren
suffix:semicolon
id|SetBitInWord
c_func
(paren
op_amp
id|controlValue
comma
id|SET_SENS_CLOCK_BITPOS
)paren
suffix:semicolon
id|writew
c_func
(paren
id|controlValue
comma
id|korg1212-&gt;sensRegPtr
)paren
suffix:semicolon
singleline_comment|// clock goes high
id|TickDelay
c_func
(paren
id|SENSCLKPULSE_WIDTH
)paren
suffix:semicolon
id|ClearBitInWord
c_func
(paren
op_amp
id|controlValue
comma
id|SET_SENS_CLOCK_BITPOS
)paren
suffix:semicolon
id|writew
c_func
(paren
id|controlValue
comma
id|korg1212-&gt;sensRegPtr
)paren
suffix:semicolon
singleline_comment|// clock goes low
id|TickDelay
c_func
(paren
id|SENSCLKPULSE_WIDTH
)paren
suffix:semicolon
)brace
singleline_comment|// ----------------------------------------------------------------------------
singleline_comment|// The update is complete.  Set a timeout.  This is the inter-update delay.
singleline_comment|// Also, if the card was in monitor mode, restore it.
singleline_comment|// ----------------------------------------------------------------------------
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
l_int|10
suffix:semicolon
id|count
op_increment
)paren
id|TickDelay
c_func
(paren
id|SENSCLKPULSE_WIDTH
)paren
suffix:semicolon
r_if
c_cond
(paren
id|monModeSet
)paren
(brace
id|rc
op_assign
id|snd_korg1212_Send1212Command
c_func
(paren
id|korg1212
comma
id|K1212_DB_SelectPlayMode
comma
id|K1212_MODE_MonitorOn
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|rc
)paren
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: WriteADCSensivity - RC = %d [%s]&bslash;n&quot;
comma
id|rc
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|snd_korg1212_OnDSPDownloadComplete
r_static
r_void
id|snd_korg1212_OnDSPDownloadComplete
c_func
(paren
id|korg1212_t
op_star
id|korg1212
)paren
(brace
r_int
id|channel
suffix:semicolon
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: DSP download is complete. [%s]&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
singleline_comment|// ----------------------------------------------------
singleline_comment|// tell the card to boot
singleline_comment|// ----------------------------------------------------
id|rc
op_assign
id|snd_korg1212_Send1212Command
c_func
(paren
id|korg1212
comma
id|K1212_DB_BootFromDSPPage4
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|rc
)paren
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: Boot from Page 4 - RC = %d [%s]&bslash;n&quot;
comma
id|rc
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|mdelay
c_func
(paren
id|DSP_BOOT_DELAY_IN_MS
)paren
suffix:semicolon
singleline_comment|// --------------------------------------------------------------------------------
singleline_comment|// Let the card know where all the buffers are.
singleline_comment|// --------------------------------------------------------------------------------
id|rc
op_assign
id|snd_korg1212_Send1212Command
c_func
(paren
id|korg1212
comma
id|K1212_DB_ConfigureBufferMemory
comma
id|LowerWordSwap
c_func
(paren
id|korg1212-&gt;PlayDataPhy
)paren
comma
id|LowerWordSwap
c_func
(paren
id|korg1212-&gt;RecDataPhy
)paren
comma
(paren
(paren
id|kNumBuffers
op_star
id|kPlayBufferFrames
)paren
op_div
l_int|2
)paren
comma
singleline_comment|// size given to the card
singleline_comment|// is based on 2 buffers
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|rc
)paren
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: Configure Buffer Memory - RC = %d [%s]&bslash;n&quot;
comma
id|rc
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|TickDelay
c_func
(paren
id|INTERCOMMAND_DELAY
)paren
suffix:semicolon
id|rc
op_assign
id|snd_korg1212_Send1212Command
c_func
(paren
id|korg1212
comma
id|K1212_DB_ConfigureMiscMemory
comma
id|LowerWordSwap
c_func
(paren
id|korg1212-&gt;VolumeTablePhy
)paren
comma
id|LowerWordSwap
c_func
(paren
id|korg1212-&gt;RoutingTablePhy
)paren
comma
id|LowerWordSwap
c_func
(paren
id|korg1212-&gt;AdatTimeCodePhy
)paren
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|rc
)paren
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: Configure Misc Memory - RC = %d [%s]&bslash;n&quot;
comma
id|rc
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
singleline_comment|// --------------------------------------------------------------------------------
singleline_comment|// Initialize the routing and volume tables, then update the card&squot;s state.
singleline_comment|// --------------------------------------------------------------------------------
id|TickDelay
c_func
(paren
id|INTERCOMMAND_DELAY
)paren
suffix:semicolon
r_for
c_loop
(paren
id|channel
op_assign
l_int|0
suffix:semicolon
id|channel
OL
id|kAudioChannels
suffix:semicolon
id|channel
op_increment
)paren
(brace
id|korg1212-&gt;sharedBufferPtr-&gt;volumeData
(braket
id|channel
)braket
op_assign
id|k1212MaxVolume
suffix:semicolon
singleline_comment|//korg1212-&gt;sharedBufferPtr-&gt;routeData[channel] = channel;
id|korg1212-&gt;sharedBufferPtr-&gt;routeData
(braket
id|channel
)braket
op_assign
l_int|8
op_plus
(paren
id|channel
op_amp
l_int|1
)paren
suffix:semicolon
)brace
id|snd_korg1212_WriteADCSensitivity
c_func
(paren
id|korg1212
)paren
suffix:semicolon
id|TickDelay
c_func
(paren
id|INTERCOMMAND_DELAY
)paren
suffix:semicolon
id|rc
op_assign
id|snd_korg1212_Send1212Command
c_func
(paren
id|korg1212
comma
id|K1212_DB_SetClockSourceRate
comma
id|ClockSourceSelector
(braket
id|korg1212-&gt;clkSrcRate
)braket
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|rc
)paren
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: Set Clock Source Selector - RC = %d [%s]&bslash;n&quot;
comma
id|rc
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|snd_korg1212_setCardState
c_func
(paren
id|korg1212
comma
id|K1212_STATE_READY
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|rc
)paren
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: Set Monitor On - RC = %d [%s]&bslash;n&quot;
comma
id|rc
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|wake_up_interruptible
c_func
(paren
op_amp
id|korg1212-&gt;wait
)paren
suffix:semicolon
)brace
DECL|function|snd_korg1212_interrupt
r_static
r_void
id|snd_korg1212_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|u32
id|doorbellValue
suffix:semicolon
id|korg1212_t
op_star
id|korg1212
op_assign
id|snd_magic_cast
c_func
(paren
id|korg1212_t
comma
id|dev_id
comma
r_return
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_ne
id|korg1212-&gt;irq
)paren
(brace
r_return
suffix:semicolon
)brace
id|doorbellValue
op_assign
id|readl
c_func
(paren
id|korg1212-&gt;inDoorbellPtr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|doorbellValue
)paren
r_return
suffix:semicolon
id|writel
c_func
(paren
id|doorbellValue
comma
id|korg1212-&gt;inDoorbellPtr
)paren
suffix:semicolon
id|korg1212-&gt;irqcount
op_increment
suffix:semicolon
id|korg1212-&gt;inIRQ
op_increment
suffix:semicolon
r_switch
c_cond
(paren
id|doorbellValue
)paren
(brace
r_case
id|K1212_DB_DSPDownloadDone
suffix:colon
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: IRQ DNLD count - %ld, %x, [%s].&bslash;n&quot;
comma
id|korg1212-&gt;irqcount
comma
id|doorbellValue
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|korg1212-&gt;cardState
op_eq
id|K1212_STATE_DSP_IN_PROCESS
)paren
(brace
id|snd_korg1212_setCardState
c_func
(paren
id|korg1212
comma
id|K1212_STATE_DSP_COMPLETE
)paren
suffix:semicolon
id|snd_korg1212_OnDSPDownloadComplete
c_func
(paren
id|korg1212
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
singleline_comment|// ------------------------------------------------------------------------
singleline_comment|// an error occurred - stop the card
singleline_comment|// ------------------------------------------------------------------------
r_case
id|K1212_ISRCODE_DMAERROR
suffix:colon
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: IRQ DMAE count - %ld, %x, [%s].&bslash;n&quot;
comma
id|korg1212-&gt;irqcount
comma
id|doorbellValue
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|writel
c_func
(paren
l_int|0
comma
op_amp
id|korg1212-&gt;sharedBufferPtr-&gt;cardCommand
)paren
suffix:semicolon
r_break
suffix:semicolon
singleline_comment|// ------------------------------------------------------------------------
singleline_comment|// the card has stopped by our request.  Clear the command word and signal
singleline_comment|// the semaphore in case someone is waiting for this.
singleline_comment|// ------------------------------------------------------------------------
r_case
id|K1212_ISRCODE_CARDSTOPPED
suffix:colon
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: IRQ CSTP count - %ld, %x, [%s].&bslash;n&quot;
comma
id|korg1212-&gt;irqcount
comma
id|doorbellValue
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|writel
c_func
(paren
l_int|0
comma
op_amp
id|korg1212-&gt;sharedBufferPtr-&gt;cardCommand
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
macro_line|#ifdef XDEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: IRQ DFLT count - %ld, %x, cpos=%d [%s].&bslash;n&quot;
comma
id|korg1212-&gt;irqcount
comma
id|doorbellValue
comma
id|korg1212-&gt;currentBuffer
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
id|korg1212-&gt;cardState
OG
id|K1212_STATE_SETUP
)paren
op_logical_or
id|korg1212-&gt;idleMonitorOn
)paren
(brace
id|korg1212-&gt;currentBuffer
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|korg1212-&gt;currentBuffer
op_ge
id|kNumBuffers
)paren
id|korg1212-&gt;currentBuffer
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|korg1212-&gt;running
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|korg1212-&gt;capture_substream
)paren
(brace
id|snd_pcm_period_elapsed
c_func
(paren
id|korg1212-&gt;capture_substream
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|korg1212-&gt;playback_substream
)paren
(brace
id|snd_pcm_period_elapsed
c_func
(paren
id|korg1212-&gt;playback_substream
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
)brace
id|korg1212-&gt;inIRQ
op_decrement
suffix:semicolon
)brace
DECL|function|snd_korg1212_downloadDSPCode
r_static
r_int
id|snd_korg1212_downloadDSPCode
c_func
(paren
id|korg1212_t
op_star
id|korg1212
)paren
(brace
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: DSP download is starting... [%s]&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
singleline_comment|// ---------------------------------------------------------------
singleline_comment|// verify the state of the card before proceeding.
singleline_comment|// ---------------------------------------------------------------
r_if
c_cond
(paren
id|korg1212-&gt;cardState
op_ge
id|K1212_STATE_DSP_IN_PROCESS
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
id|snd_korg1212_setCardState
c_func
(paren
id|korg1212
comma
id|K1212_STATE_DSP_IN_PROCESS
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|korg1212-&gt;dspMemPtr
comma
id|dspCode
comma
id|korg1212-&gt;dspCodeSize
)paren
suffix:semicolon
id|rc
op_assign
id|snd_korg1212_Send1212Command
c_func
(paren
id|korg1212
comma
id|K1212_DB_StartDSPDownload
comma
id|UpperWordSwap
c_func
(paren
id|korg1212-&gt;dspMemPhy
)paren
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|rc
)paren
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: Start DSP Download RC = %d [%s]&bslash;n&quot;
comma
id|rc
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|interruptible_sleep_on_timeout
c_func
(paren
op_amp
id|korg1212-&gt;wait
comma
id|HZ
op_star
l_int|4
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_korg1212_playback_info
r_static
id|snd_pcm_hardware_t
id|snd_korg1212_playback_info
op_assign
(brace
id|info
suffix:colon
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
)paren
comma
id|formats
suffix:colon
id|SNDRV_PCM_FMTBIT_S16_LE
comma
id|rates
suffix:colon
(paren
id|SNDRV_PCM_RATE_44100
op_or
id|SNDRV_PCM_RATE_48000
)paren
comma
id|rate_min
suffix:colon
l_int|44100
comma
id|rate_max
suffix:colon
l_int|48000
comma
id|channels_min
suffix:colon
id|K1212_CHANNELS
comma
id|channels_max
suffix:colon
id|K1212_CHANNELS
comma
id|buffer_bytes_max
suffix:colon
id|K1212_BUF_SIZE
comma
id|period_bytes_min
suffix:colon
id|K1212_PERIOD_BYTES
comma
id|period_bytes_max
suffix:colon
id|K1212_PERIOD_BYTES
comma
id|periods_min
suffix:colon
id|K1212_PERIODS
comma
id|periods_max
suffix:colon
id|K1212_PERIODS
comma
id|fifo_size
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|snd_korg1212_capture_info
r_static
id|snd_pcm_hardware_t
id|snd_korg1212_capture_info
op_assign
(brace
id|info
suffix:colon
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
)paren
comma
id|formats
suffix:colon
id|SNDRV_PCM_FMTBIT_S16_LE
comma
id|rates
suffix:colon
(paren
id|SNDRV_PCM_RATE_44100
op_or
id|SNDRV_PCM_RATE_48000
)paren
comma
id|rate_min
suffix:colon
l_int|44100
comma
id|rate_max
suffix:colon
l_int|48000
comma
id|channels_min
suffix:colon
id|K1212_CHANNELS
comma
id|channels_max
suffix:colon
id|K1212_CHANNELS
comma
id|buffer_bytes_max
suffix:colon
id|K1212_BUF_SIZE
comma
id|period_bytes_min
suffix:colon
id|K1212_PERIOD_BYTES
comma
id|period_bytes_max
suffix:colon
id|K1212_PERIOD_BYTES
comma
id|periods_min
suffix:colon
id|K1212_PERIODS
comma
id|periods_max
suffix:colon
id|K1212_PERIODS
comma
id|fifo_size
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
DECL|function|snd_korg1212_free_pcm
r_static
r_void
id|snd_korg1212_free_pcm
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|korg1212_t
op_star
id|korg1212
op_assign
(paren
id|korg1212_t
op_star
)paren
id|pcm-&gt;private_data
suffix:semicolon
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: snd_korg1212_free_pcm [%s]&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|korg1212-&gt;pcm16
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|variable|period_bytes
r_static
r_int
r_int
id|period_bytes
(braket
)braket
op_assign
(brace
id|K1212_PERIOD_BYTES
)brace
suffix:semicolon
DECL|macro|PERIOD_BYTES
mdefine_line|#define PERIOD_BYTES sizeof(period_bytes) / sizeof(period_bytes[0])
DECL|variable|hw_constraints_period_bytes
r_static
id|snd_pcm_hw_constraint_list_t
id|hw_constraints_period_bytes
op_assign
(brace
id|count
suffix:colon
id|PERIOD_BYTES
comma
id|list
suffix:colon
id|period_bytes
comma
id|mask
suffix:colon
l_int|0
)brace
suffix:semicolon
DECL|function|snd_korg1212_playback_open
r_static
r_int
id|snd_korg1212_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|korg1212_t
op_star
id|korg1212
op_assign
id|_snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: snd_korg1212_playback_open [%s]&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|spin_lock_irqsave
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_korg1212_OpenCard
c_func
(paren
id|korg1212
)paren
suffix:semicolon
id|snd_pcm_set_sync
c_func
(paren
id|substream
)paren
suffix:semicolon
singleline_comment|// ???
id|runtime-&gt;hw
op_assign
id|snd_korg1212_playback_info
suffix:semicolon
id|runtime-&gt;dma_area
op_assign
(paren
r_char
op_star
)paren
id|korg1212-&gt;playDataBufsPtr
suffix:semicolon
id|runtime-&gt;dma_bytes
op_assign
id|K1212_BUF_SIZE
suffix:semicolon
id|korg1212-&gt;playback_substream
op_assign
id|substream
suffix:semicolon
id|korg1212-&gt;periodsize
op_assign
id|K1212_PERIODS
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_pcm_hw_constraint_minmax
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_BUFFER_BYTES
comma
id|K1212_BUF_SIZE
comma
id|K1212_BUF_SIZE
)paren
suffix:semicolon
id|snd_pcm_hw_constraint_list
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_PERIOD_BYTES
comma
op_amp
id|hw_constraints_period_bytes
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_capture_open
r_static
r_int
id|snd_korg1212_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|korg1212_t
op_star
id|korg1212
op_assign
id|_snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: snd_korg1212_capture_open [%s]&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|spin_lock_irqsave
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_korg1212_OpenCard
c_func
(paren
id|korg1212
)paren
suffix:semicolon
id|snd_pcm_set_sync
c_func
(paren
id|substream
)paren
suffix:semicolon
singleline_comment|// ???
id|runtime-&gt;hw
op_assign
id|snd_korg1212_capture_info
suffix:semicolon
id|runtime-&gt;dma_area
op_assign
(paren
r_char
op_star
)paren
id|korg1212-&gt;recordDataBufsPtr
suffix:semicolon
id|runtime-&gt;dma_bytes
op_assign
id|K1212_BUF_SIZE
suffix:semicolon
id|korg1212-&gt;capture_substream
op_assign
id|substream
suffix:semicolon
id|korg1212-&gt;periodsize
op_assign
id|K1212_PERIODS
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_pcm_hw_constraint_minmax
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_BUFFER_BYTES
comma
id|K1212_BUF_SIZE
comma
id|K1212_BUF_SIZE
)paren
suffix:semicolon
id|snd_pcm_hw_constraint_list
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_PERIOD_BYTES
comma
op_amp
id|hw_constraints_period_bytes
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_playback_close
r_static
r_int
id|snd_korg1212_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|korg1212_t
op_star
id|korg1212
op_assign
id|_snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: snd_korg1212_playback_close [%s]&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|spin_lock_irqsave
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|korg1212-&gt;playback_substream
op_assign
l_int|NULL
suffix:semicolon
id|korg1212-&gt;periodsize
op_assign
l_int|0
suffix:semicolon
id|snd_korg1212_CloseCard
c_func
(paren
id|korg1212
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_capture_close
r_static
r_int
id|snd_korg1212_capture_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|korg1212_t
op_star
id|korg1212
op_assign
id|_snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: snd_korg1212_capture_close [%s]&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|spin_lock_irqsave
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|korg1212-&gt;capture_substream
op_assign
l_int|NULL
suffix:semicolon
id|korg1212-&gt;periodsize
op_assign
l_int|0
suffix:semicolon
id|snd_korg1212_CloseCard
c_func
(paren
id|korg1212
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_channel_info
r_static
r_int
id|snd_korg1212_channel_info
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_channel_info_t
op_star
id|info
)paren
(brace
r_int
id|chn
op_assign
id|info-&gt;channel
suffix:semicolon
singleline_comment|// snd_assert(info-&gt;channel &lt; kAudioChannels + 1, return -EINVAL);
id|info-&gt;offset
op_assign
l_int|0
suffix:semicolon
singleline_comment|// if (chn &lt; k16BitChannels) {
id|info-&gt;first
op_assign
id|chn
op_star
l_int|16
suffix:semicolon
singleline_comment|// } else {
singleline_comment|//         info-&gt;first = k16BitChannels * 16 + (chn - k16BitChannels - 1) * 32;
singleline_comment|// }
id|info-&gt;step
op_assign
r_sizeof
(paren
id|KorgAudioFrame
)paren
op_star
l_int|8
suffix:semicolon
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: snd_korg1212_channel_info %d:, offset=%ld, first=%d, step=%d&bslash;n&quot;
comma
id|chn
comma
id|info-&gt;offset
comma
id|info-&gt;first
comma
id|info-&gt;step
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_ioctl
r_static
r_int
id|snd_korg1212_ioctl
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: snd_korg1212_ioctl: cmd=%d&bslash;n&quot;
comma
id|cmd
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_IOCTL1_CHANNEL_INFO
)paren
(brace
id|snd_pcm_channel_info_t
op_star
id|info
op_assign
id|arg
suffix:semicolon
r_return
id|snd_korg1212_channel_info
c_func
(paren
id|substream
comma
id|info
)paren
suffix:semicolon
)brace
r_return
id|snd_pcm_lib_ioctl
c_func
(paren
id|substream
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|function|snd_korg1212_hw_params
r_static
r_int
id|snd_korg1212_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|params
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|korg1212_t
op_star
id|korg1212
op_assign
id|_snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|err
suffix:semicolon
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: snd_korg1212_hw_params [%s]&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|spin_lock_irqsave
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_korg1212_SetRate
c_func
(paren
id|korg1212
comma
id|params_rate
c_func
(paren
id|params
)paren
)paren
)paren
OL
l_int|0
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|params_format
c_func
(paren
id|params
)paren
op_ne
id|SNDRV_PCM_FORMAT_S16_LE
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|korg1212-&gt;periodsize
op_assign
id|K1212_BLOCK_SIZE
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_prepare
r_static
r_int
id|snd_korg1212_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|korg1212_t
op_star
id|korg1212
op_assign
id|_snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: snd_korg1212_prepare [%s]&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|spin_lock_irqsave
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_korg1212_SetupForPlay
c_func
(paren
id|korg1212
)paren
suffix:semicolon
id|korg1212-&gt;currentBuffer
op_assign
op_minus
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_trigger
r_static
r_int
id|snd_korg1212_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|korg1212_t
op_star
id|korg1212
op_assign
id|_snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: snd_korg1212_trigger [%s] cmd=%d&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
comma
id|cmd
)paren
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
id|korg1212-&gt;running
op_assign
l_int|1
suffix:semicolon
id|snd_korg1212_TriggerPlay
c_func
(paren
id|korg1212
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
id|korg1212-&gt;running
op_assign
l_int|0
suffix:semicolon
id|snd_korg1212_StopPlay
c_func
(paren
id|korg1212
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_pointer
r_static
id|snd_pcm_uframes_t
id|snd_korg1212_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|korg1212_t
op_star
id|korg1212
op_assign
id|_snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_uframes_t
id|pos
suffix:semicolon
r_if
c_cond
(paren
id|korg1212-&gt;currentBuffer
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|pos
op_assign
id|korg1212-&gt;currentBuffer
op_star
id|kPlayBufferFrames
suffix:semicolon
macro_line|#ifdef XDEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: snd_korg1212_pointer [%s] %ld&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
comma
id|pos
)paren
suffix:semicolon
macro_line|#endif
r_return
id|pos
suffix:semicolon
)brace
DECL|function|snd_korg1212_playback_copy
r_static
r_int
id|snd_korg1212_playback_copy
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|channel
comma
multiline_comment|/* not used (interleaved data) */
id|snd_pcm_uframes_t
id|pos
comma
r_void
op_star
id|src
comma
id|snd_pcm_uframes_t
id|count
)paren
(brace
id|korg1212_t
op_star
id|korg1212
op_assign
id|_snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|KorgAudioFrame
op_star
id|dst
op_assign
id|korg1212-&gt;playDataBufsPtr
(braket
l_int|0
)braket
dot
id|bufferData
op_plus
id|pos
suffix:semicolon
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: snd_korg1212_playback_copy [%s] %ld %ld&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
comma
id|pos
comma
id|count
)paren
suffix:semicolon
macro_line|#endif
id|snd_assert
c_func
(paren
id|pos
op_plus
id|count
op_le
id|K1212_MAX_SAMPLES
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
r_return
id|copy_from_user
c_func
(paren
id|dst
comma
id|src
comma
id|count
op_star
id|K1212_FRAME_SIZE
)paren
suffix:colon
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_capture_copy
r_static
r_int
id|snd_korg1212_capture_copy
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|channel
comma
multiline_comment|/* not used (interleaved data) */
id|snd_pcm_uframes_t
id|pos
comma
r_void
op_star
id|dst
comma
id|snd_pcm_uframes_t
id|count
)paren
(brace
id|korg1212_t
op_star
id|korg1212
op_assign
id|_snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|KorgAudioFrame
op_star
id|src
op_assign
id|korg1212-&gt;recordDataBufsPtr
(braket
l_int|0
)braket
dot
id|bufferData
op_plus
id|pos
suffix:semicolon
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: snd_korg1212_capture_copy [%s] %ld %ld&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
comma
id|pos
comma
id|count
)paren
suffix:semicolon
macro_line|#endif
id|snd_assert
c_func
(paren
id|pos
op_plus
id|count
op_le
id|K1212_MAX_SAMPLES
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
r_return
id|copy_to_user
c_func
(paren
id|dst
comma
id|src
comma
id|count
op_star
id|K1212_FRAME_SIZE
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_playback_silence
r_static
r_int
id|snd_korg1212_playback_silence
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|channel
comma
multiline_comment|/* not used (interleaved data) */
id|snd_pcm_uframes_t
id|pos
comma
id|snd_pcm_uframes_t
id|count
)paren
(brace
id|korg1212_t
op_star
id|korg1212
op_assign
id|_snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|KorgAudioFrame
op_star
id|dst
op_assign
id|korg1212-&gt;playDataBufsPtr
(braket
l_int|0
)braket
dot
id|bufferData
op_plus
id|pos
suffix:semicolon
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: snd_korg1212_playback_silence [%s]&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|snd_assert
c_func
(paren
id|pos
op_plus
id|count
op_le
id|K1212_MAX_SAMPLES
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|memset
c_func
(paren
id|dst
comma
l_int|0
comma
id|count
op_star
id|K1212_FRAME_SIZE
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_korg1212_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_korg1212_playback_ops
op_assign
(brace
id|open
suffix:colon
id|snd_korg1212_playback_open
comma
id|close
suffix:colon
id|snd_korg1212_playback_close
comma
id|ioctl
suffix:colon
id|snd_korg1212_ioctl
comma
id|hw_params
suffix:colon
id|snd_korg1212_hw_params
comma
id|prepare
suffix:colon
id|snd_korg1212_prepare
comma
id|trigger
suffix:colon
id|snd_korg1212_trigger
comma
id|pointer
suffix:colon
id|snd_korg1212_pointer
comma
id|copy
suffix:colon
id|snd_korg1212_playback_copy
comma
id|silence
suffix:colon
id|snd_korg1212_playback_silence
comma
)brace
suffix:semicolon
DECL|variable|snd_korg1212_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_korg1212_capture_ops
op_assign
(brace
id|open
suffix:colon
id|snd_korg1212_capture_open
comma
id|close
suffix:colon
id|snd_korg1212_capture_close
comma
id|ioctl
suffix:colon
id|snd_korg1212_ioctl
comma
id|hw_params
suffix:colon
id|snd_korg1212_hw_params
comma
id|prepare
suffix:colon
id|snd_korg1212_prepare
comma
id|trigger
suffix:colon
id|snd_korg1212_trigger
comma
id|pointer
suffix:colon
id|snd_korg1212_pointer
comma
id|copy
suffix:colon
id|snd_korg1212_capture_copy
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Control Interface&n; */
DECL|function|snd_korg1212_control_phase_info
r_static
r_int
id|snd_korg1212_control_phase_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:semicolon
id|uinfo-&gt;count
op_assign
(paren
id|kcontrol-&gt;private_value
op_ge
l_int|8
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_control_phase_get
r_static
r_int
id|snd_korg1212_control_phase_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|u
)paren
(brace
id|korg1212_t
op_star
id|korg1212
op_assign
id|_snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|u-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|korg1212-&gt;volumePhase
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
l_int|8
)paren
id|u-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
id|korg1212-&gt;volumePhase
(braket
id|i
op_plus
l_int|1
)braket
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_control_phase_put
r_static
r_int
id|snd_korg1212_control_phase_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|u
)paren
(brace
id|korg1212_t
op_star
id|korg1212
op_assign
id|_snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|change
op_assign
l_int|0
suffix:semicolon
r_int
id|i
comma
id|val
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|i
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
id|korg1212-&gt;volumePhase
(braket
id|i
)braket
op_assign
id|u-&gt;value.integer.value
(braket
l_int|0
)braket
suffix:semicolon
id|val
op_assign
id|korg1212-&gt;sharedBufferPtr-&gt;volumeData
(braket
id|kcontrol-&gt;private_value
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|u-&gt;value.integer.value
(braket
l_int|0
)braket
OG
l_int|0
)paren
op_ne
(paren
id|val
OL
l_int|0
)paren
)paren
(brace
id|val
op_assign
id|abs
c_func
(paren
id|val
)paren
op_star
(paren
id|korg1212-&gt;volumePhase
(braket
id|i
)braket
OG
l_int|0
ques
c_cond
op_minus
l_int|1
suffix:colon
l_int|1
)paren
suffix:semicolon
id|korg1212-&gt;sharedBufferPtr-&gt;volumeData
(braket
id|i
)braket
op_assign
id|val
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ge
l_int|8
)paren
(brace
id|korg1212-&gt;volumePhase
(braket
id|i
op_plus
l_int|1
)braket
op_assign
id|u-&gt;value.integer.value
(braket
l_int|1
)braket
suffix:semicolon
id|val
op_assign
id|korg1212-&gt;sharedBufferPtr-&gt;volumeData
(braket
id|kcontrol-&gt;private_value
op_plus
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|u-&gt;value.integer.value
(braket
l_int|1
)braket
OG
l_int|0
)paren
op_ne
(paren
id|val
OL
l_int|0
)paren
)paren
(brace
id|val
op_assign
id|abs
c_func
(paren
id|val
)paren
op_star
(paren
id|korg1212-&gt;volumePhase
(braket
id|i
op_plus
l_int|1
)braket
OG
l_int|0
ques
c_cond
op_minus
l_int|1
suffix:colon
l_int|1
)paren
suffix:semicolon
id|korg1212-&gt;sharedBufferPtr-&gt;volumeData
(braket
id|i
op_plus
l_int|1
)braket
op_assign
id|val
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|function|snd_korg1212_control_volume_info
r_static
r_int
id|snd_korg1212_control_volume_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
(paren
id|kcontrol-&gt;private_value
op_ge
l_int|8
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
id|k1212MinVolume
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
id|k1212MaxVolume
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_control_volume_get
r_static
r_int
id|snd_korg1212_control_volume_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|u
)paren
(brace
id|korg1212_t
op_star
id|korg1212
op_assign
id|_snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|i
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
id|u-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|abs
c_func
(paren
id|korg1212-&gt;sharedBufferPtr-&gt;volumeData
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
l_int|8
)paren
id|u-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
id|abs
c_func
(paren
id|korg1212-&gt;sharedBufferPtr-&gt;volumeData
(braket
id|i
op_plus
l_int|1
)braket
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_control_volume_put
r_static
r_int
id|snd_korg1212_control_volume_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|u
)paren
(brace
id|korg1212_t
op_star
id|korg1212
op_assign
id|_snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|change
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|val
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|i
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;value.integer.value
(braket
l_int|0
)braket
op_ne
id|abs
c_func
(paren
id|korg1212-&gt;sharedBufferPtr-&gt;volumeData
(braket
id|i
)braket
)paren
)paren
(brace
id|val
op_assign
id|korg1212-&gt;volumePhase
(braket
id|i
)braket
OG
l_int|0
ques
c_cond
op_minus
l_int|1
suffix:colon
l_int|1
suffix:semicolon
id|val
op_mul_assign
id|u-&gt;value.integer.value
(braket
l_int|0
)braket
suffix:semicolon
id|korg1212-&gt;sharedBufferPtr-&gt;volumeData
(braket
id|i
)braket
op_assign
id|val
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ge
l_int|8
)paren
(brace
r_if
c_cond
(paren
id|u-&gt;value.integer.value
(braket
l_int|1
)braket
op_ne
id|abs
c_func
(paren
id|korg1212-&gt;sharedBufferPtr-&gt;volumeData
(braket
id|i
op_plus
l_int|1
)braket
)paren
)paren
(brace
id|val
op_assign
id|korg1212-&gt;volumePhase
(braket
id|i
op_plus
l_int|1
)braket
OG
l_int|0
ques
c_cond
op_minus
l_int|1
suffix:colon
l_int|1
suffix:semicolon
id|val
op_mul_assign
id|u-&gt;value.integer.value
(braket
l_int|1
)braket
suffix:semicolon
id|korg1212-&gt;sharedBufferPtr-&gt;volumeData
(braket
id|i
op_plus
l_int|1
)braket
op_assign
id|val
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|function|snd_korg1212_control_route_info
r_static
r_int
id|snd_korg1212_control_route_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_ENUMERATED
suffix:semicolon
id|uinfo-&gt;count
op_assign
(paren
id|kcontrol-&gt;private_value
op_ge
l_int|8
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
suffix:semicolon
id|uinfo-&gt;value.enumerated.items
op_assign
id|kAudioChannels
suffix:semicolon
r_if
c_cond
(paren
id|uinfo-&gt;value.enumerated.item
OG
id|kAudioChannels
op_minus
l_int|1
)paren
(brace
id|uinfo-&gt;value.enumerated.item
op_assign
id|kAudioChannels
op_minus
l_int|1
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|uinfo-&gt;value.enumerated.name
comma
id|channelName
(braket
id|uinfo-&gt;value.enumerated.item
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_control_route_get
r_static
r_int
id|snd_korg1212_control_route_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|u
)paren
(brace
id|korg1212_t
op_star
id|korg1212
op_assign
id|_snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|i
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
id|u-&gt;value.enumerated.item
(braket
l_int|0
)braket
op_assign
id|korg1212-&gt;sharedBufferPtr-&gt;routeData
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ge
l_int|8
)paren
id|u-&gt;value.enumerated.item
(braket
l_int|1
)braket
op_assign
id|korg1212-&gt;sharedBufferPtr-&gt;routeData
(braket
id|i
op_plus
l_int|1
)braket
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_control_route_put
r_static
r_int
id|snd_korg1212_control_route_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|u
)paren
(brace
id|korg1212_t
op_star
id|korg1212
op_assign
id|_snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|change
op_assign
l_int|0
comma
id|i
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|i
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;value.enumerated.item
(braket
l_int|0
)braket
op_ne
id|korg1212-&gt;sharedBufferPtr-&gt;volumeData
(braket
id|i
)braket
)paren
(brace
id|korg1212-&gt;sharedBufferPtr-&gt;routeData
(braket
id|i
)braket
op_assign
id|u-&gt;value.enumerated.item
(braket
l_int|0
)braket
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_ge
l_int|8
)paren
(brace
r_if
c_cond
(paren
id|u-&gt;value.enumerated.item
(braket
l_int|1
)braket
op_ne
id|korg1212-&gt;sharedBufferPtr-&gt;volumeData
(braket
id|i
op_plus
l_int|1
)braket
)paren
(brace
id|korg1212-&gt;sharedBufferPtr-&gt;routeData
(braket
id|i
op_plus
l_int|1
)braket
op_assign
id|u-&gt;value.enumerated.item
(braket
l_int|1
)braket
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|function|snd_korg1212_control_analog_info
r_static
r_int
id|snd_korg1212_control_analog_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
id|k1212MaxADCSens
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
id|k1212MinADCSens
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_control_analog_get
r_static
r_int
id|snd_korg1212_control_analog_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|u
)paren
(brace
id|korg1212_t
op_star
id|korg1212
op_assign
id|_snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|u-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|korg1212-&gt;leftADCInSens
suffix:semicolon
id|u-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
id|korg1212-&gt;rightADCInSens
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_control_analog_put
r_static
r_int
id|snd_korg1212_control_analog_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|u
)paren
(brace
id|korg1212_t
op_star
id|korg1212
op_assign
id|_snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|change
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|u-&gt;value.integer.value
(braket
l_int|0
)braket
op_ne
id|korg1212-&gt;leftADCInSens
)paren
(brace
id|korg1212-&gt;leftADCInSens
op_assign
id|u-&gt;value.integer.value
(braket
l_int|0
)braket
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|u-&gt;value.integer.value
(braket
l_int|1
)braket
op_ne
id|korg1212-&gt;rightADCInSens
)paren
(brace
id|korg1212-&gt;rightADCInSens
op_assign
id|u-&gt;value.integer.value
(braket
l_int|1
)braket
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|change
)paren
id|snd_korg1212_WriteADCSensitivity
c_func
(paren
id|korg1212
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|function|snd_korg1212_control_sync_info
r_static
r_int
id|snd_korg1212_control_sync_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_ENUMERATED
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.enumerated.items
op_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|uinfo-&gt;value.enumerated.item
OG
l_int|2
)paren
(brace
id|uinfo-&gt;value.enumerated.item
op_assign
l_int|2
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|uinfo-&gt;value.enumerated.name
comma
id|clockSourceTypeName
(braket
id|uinfo-&gt;value.enumerated.item
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_control_sync_get
r_static
r_int
id|snd_korg1212_control_sync_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|korg1212_t
op_star
id|korg1212
op_assign
id|_snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
op_assign
id|korg1212-&gt;clkSource
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_control_sync_put
r_static
r_int
id|snd_korg1212_control_sync_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|korg1212_t
op_star
id|korg1212
op_assign
id|_snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|change
suffix:semicolon
id|val
op_assign
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
op_mod
l_int|3
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|change
op_assign
id|val
op_ne
id|korg1212-&gt;clkSource
suffix:semicolon
id|snd_korg1212_SetClockSource
c_func
(paren
id|korg1212
comma
id|val
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|korg1212-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|macro|MON_MIXER
mdefine_line|#define MON_MIXER(ord,c_name)&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;        {&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;                access:&t;&t;SNDRV_CTL_ELEM_ACCESS_READ | SNDRV_CTL_ELEM_ACCESS_WRITE,&t;&bslash;&n;                iface:          SNDRV_CTL_ELEM_IFACE_MIXER,&t;&t;&t;&t;&t;&bslash;&n;                name:&t;&t;c_name &quot; Monitor Volume&quot;,&t;&t;&t;&t;&t;&t;&bslash;&n;                info:&t;&t;snd_korg1212_control_volume_info,&t;&t;&t;&t;&bslash;&n;                get:&t;&t;snd_korg1212_control_volume_get,&t;&t;&t;&t;&bslash;&n;                put:&t;&t;snd_korg1212_control_volume_put,&t;&t;&t;&t;&bslash;&n;&t;&t;private_value:&t;ord,&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;        },                                                                                      &bslash;&n;        {&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;                access:&t;&t;SNDRV_CTL_ELEM_ACCESS_READ | SNDRV_CTL_ELEM_ACCESS_WRITE,&t;&bslash;&n;                iface:          SNDRV_CTL_ELEM_IFACE_MIXER,&t;&t;&t;&t;&t;&bslash;&n;                name:&t;&t;c_name &quot; Monitor Route&quot;,&t;&t;&t;&t;&t;&t;&bslash;&n;                info:&t;&t;snd_korg1212_control_route_info,&t;&t;&t;&t;&bslash;&n;                get:&t;&t;snd_korg1212_control_route_get,&t;&t;&t;&t;&t;&bslash;&n;                put:&t;&t;snd_korg1212_control_route_put,&t;&t;&t;&t;&t;&bslash;&n;&t;&t;private_value:&t;ord,&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;        },                                                                                      &bslash;&n;        {&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;                access:&t;&t;SNDRV_CTL_ELEM_ACCESS_READ | SNDRV_CTL_ELEM_ACCESS_WRITE,&t;&bslash;&n;                iface:          SNDRV_CTL_ELEM_IFACE_PCM,&t;&t;&t;&t;&t;&bslash;&n;                name:&t;&t;c_name &quot; Monitor Phase Invert&quot;,&t;&t;&t;&t;&t;&t;&bslash;&n;                info:&t;&t;snd_korg1212_control_phase_info,&t;&t;&t;&t;&bslash;&n;                get:&t;&t;snd_korg1212_control_phase_get,&t;&t;&t;&t;&t;&bslash;&n;                put:&t;&t;snd_korg1212_control_phase_put,&t;&t;&t;&t;&t;&bslash;&n;&t;&t;private_value:&t;ord,&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;        }
DECL|variable|snd_korg1212_controls
r_static
id|snd_kcontrol_new_t
id|snd_korg1212_controls
(braket
)braket
op_assign
(brace
id|MON_MIXER
c_func
(paren
l_int|8
comma
l_string|&quot;Analog&quot;
)paren
comma
id|MON_MIXER
c_func
(paren
l_int|10
comma
l_string|&quot;SPDIF&quot;
)paren
comma
id|MON_MIXER
c_func
(paren
l_int|0
comma
l_string|&quot;ADAT-1&quot;
)paren
comma
id|MON_MIXER
c_func
(paren
l_int|1
comma
l_string|&quot;ADAT-2&quot;
)paren
comma
id|MON_MIXER
c_func
(paren
l_int|2
comma
l_string|&quot;ADAT-3&quot;
)paren
comma
id|MON_MIXER
c_func
(paren
l_int|3
comma
l_string|&quot;ADAT-4&quot;
)paren
comma
id|MON_MIXER
c_func
(paren
l_int|4
comma
l_string|&quot;ADAT-5&quot;
)paren
comma
id|MON_MIXER
c_func
(paren
l_int|5
comma
l_string|&quot;ADAT-6&quot;
)paren
comma
id|MON_MIXER
c_func
(paren
l_int|6
comma
l_string|&quot;ADAT-7&quot;
)paren
comma
id|MON_MIXER
c_func
(paren
l_int|7
comma
l_string|&quot;ADAT-8&quot;
)paren
comma
(brace
id|access
suffix:colon
id|SNDRV_CTL_ELEM_ACCESS_READ
op_or
id|SNDRV_CTL_ELEM_ACCESS_WRITE
comma
id|iface
suffix:colon
id|SNDRV_CTL_ELEM_IFACE_PCM
comma
id|name
suffix:colon
l_string|&quot;Sync Source&quot;
comma
id|info
suffix:colon
id|snd_korg1212_control_sync_info
comma
id|get
suffix:colon
id|snd_korg1212_control_sync_get
comma
id|put
suffix:colon
id|snd_korg1212_control_sync_put
comma
)brace
comma
(brace
id|access
suffix:colon
id|SNDRV_CTL_ELEM_ACCESS_READ
op_or
id|SNDRV_CTL_ELEM_ACCESS_WRITE
comma
id|iface
suffix:colon
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
id|name
suffix:colon
l_string|&quot;ADC Attenuation&quot;
comma
id|info
suffix:colon
id|snd_korg1212_control_analog_info
comma
id|get
suffix:colon
id|snd_korg1212_control_analog_get
comma
id|put
suffix:colon
id|snd_korg1212_control_analog_put
comma
)brace
)brace
suffix:semicolon
DECL|macro|K1212_CONTROL_ELEMENTS
mdefine_line|#define K1212_CONTROL_ELEMENTS (sizeof(snd_korg1212_controls) / sizeof(snd_korg1212_controls[0]))
multiline_comment|/*&n; * proc interface&n; */
DECL|function|snd_korg1212_proc_read
r_static
r_void
id|snd_korg1212_proc_read
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
r_int
id|n
suffix:semicolon
id|korg1212_t
op_star
id|korg1212
op_assign
(paren
id|korg1212_t
op_star
)paren
id|entry-&gt;private_data
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
id|korg1212-&gt;card-&gt;longname
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot; (index #%d)&bslash;n&quot;
comma
id|korg1212-&gt;card-&gt;number
op_plus
l_int|1
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;nGeneral settings&bslash;n&quot;
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;    period size: %d bytes&bslash;n&quot;
comma
id|K1212_BLOCK_SIZE
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;     clock mode: %s&bslash;n&quot;
comma
id|clockSourceName
(braket
id|korg1212-&gt;clkSrcRate
)braket
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;  left ADC Sens: %d&bslash;n&quot;
comma
id|korg1212-&gt;leftADCInSens
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot; right ADC Sens: %d&bslash;n&quot;
comma
id|korg1212-&gt;rightADCInSens
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;    Volume Info:&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|kAudioChannels
suffix:semicolon
id|n
op_increment
)paren
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot; Channel %d: %s -&gt; %s [%d]&bslash;n&quot;
comma
id|n
comma
id|channelName
(braket
id|n
)braket
comma
id|channelName
(braket
id|korg1212-&gt;sharedBufferPtr-&gt;routeData
(braket
id|n
)braket
)braket
comma
id|korg1212-&gt;sharedBufferPtr-&gt;volumeData
(braket
id|n
)braket
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;nGeneral status&bslash;n&quot;
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot; ADAT Time Code: %d&bslash;n&quot;
comma
id|korg1212-&gt;sharedBufferPtr-&gt;AdatTimeCode
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;     Card State: %s&bslash;n&quot;
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Idle mon. State: %d&bslash;n&quot;
comma
id|korg1212-&gt;idleMonitorOn
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Cmd retry count: %d&bslash;n&quot;
comma
id|korg1212-&gt;cmdRetryCount
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;      Irq count: %ld&bslash;n&quot;
comma
id|korg1212-&gt;irqcount
)paren
suffix:semicolon
)brace
DECL|function|snd_korg1212_proc_init
r_static
r_void
id|__init
id|snd_korg1212_proc_init
c_func
(paren
id|korg1212_t
op_star
id|korg1212
)paren
(brace
id|snd_info_entry_t
op_star
id|entry
suffix:semicolon
r_if
c_cond
(paren
(paren
id|entry
op_assign
id|snd_info_create_card_entry
c_func
(paren
id|korg1212-&gt;card
comma
l_string|&quot;korg1212&quot;
comma
id|korg1212-&gt;card-&gt;proc_root
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|entry-&gt;content
op_assign
id|SNDRV_INFO_CONTENT_TEXT
suffix:semicolon
id|entry-&gt;private_data
op_assign
id|korg1212
suffix:semicolon
id|entry-&gt;mode
op_assign
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IWUSR
suffix:semicolon
id|entry-&gt;c.text.read_size
op_assign
l_int|256
suffix:semicolon
id|entry-&gt;c.text.read
op_assign
id|snd_korg1212_proc_read
suffix:semicolon
r_if
c_cond
(paren
id|snd_info_register
c_func
(paren
id|entry
)paren
OL
l_int|0
)paren
(brace
id|snd_info_free_entry
c_func
(paren
id|entry
)paren
suffix:semicolon
id|entry
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|korg1212-&gt;proc_entry
op_assign
id|entry
suffix:semicolon
)brace
DECL|function|snd_korg1212_proc_done
r_static
r_void
id|snd_korg1212_proc_done
c_func
(paren
id|korg1212_t
op_star
id|korg1212
)paren
(brace
r_if
c_cond
(paren
id|korg1212-&gt;proc_entry
)paren
(brace
id|snd_info_unregister
c_func
(paren
id|korg1212-&gt;proc_entry
)paren
suffix:semicolon
id|korg1212-&gt;proc_entry
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
DECL|function|snd_korg1212_create
r_static
r_int
id|__init
id|snd_korg1212_create
c_func
(paren
id|korg1212_t
op_star
id|korg1212
)paren
(brace
r_struct
id|pci_dev
op_star
id|pci
op_assign
id|korg1212-&gt;pci
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|ioport_size
comma
id|iomem_size
comma
id|iomem2_size
suffix:semicolon
id|dma_addr_t
id|phys_addr
suffix:semicolon
id|korg1212-&gt;irq
op_assign
op_minus
l_int|1
suffix:semicolon
id|korg1212-&gt;clkSource
op_assign
id|K1212_CLKIDX_Local
suffix:semicolon
id|korg1212-&gt;clkRate
op_assign
l_int|44100
suffix:semicolon
id|korg1212-&gt;inIRQ
op_assign
l_int|0
suffix:semicolon
id|korg1212-&gt;running
op_assign
l_int|0
suffix:semicolon
id|snd_korg1212_setCardState
c_func
(paren
id|korg1212
comma
id|K1212_STATE_UNINITIALIZED
)paren
suffix:semicolon
id|korg1212-&gt;idleMonitorOn
op_assign
l_int|0
suffix:semicolon
id|korg1212-&gt;clkSrcRate
op_assign
id|K1212_CLKIDX_LocalAt44_1K
suffix:semicolon
id|korg1212-&gt;leftADCInSens
op_assign
id|k1212MaxADCSens
suffix:semicolon
id|korg1212-&gt;rightADCInSens
op_assign
id|k1212MaxADCSens
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|kAudioChannels
suffix:semicolon
id|i
op_increment
)paren
id|korg1212-&gt;volumePhase
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pci
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|korg1212-&gt;iomem
op_assign
id|pci_resource_start
c_func
(paren
id|korg1212-&gt;pci
comma
l_int|0
)paren
suffix:semicolon
id|korg1212-&gt;ioport
op_assign
id|pci_resource_start
c_func
(paren
id|korg1212-&gt;pci
comma
l_int|1
)paren
suffix:semicolon
id|korg1212-&gt;iomem2
op_assign
id|pci_resource_start
c_func
(paren
id|korg1212-&gt;pci
comma
l_int|2
)paren
suffix:semicolon
id|iomem_size
op_assign
id|pci_resource_len
c_func
(paren
id|korg1212-&gt;pci
comma
l_int|0
)paren
suffix:semicolon
id|ioport_size
op_assign
id|pci_resource_len
c_func
(paren
id|korg1212-&gt;pci
comma
l_int|1
)paren
suffix:semicolon
id|iomem2_size
op_assign
id|pci_resource_len
c_func
(paren
id|korg1212-&gt;pci
comma
l_int|2
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: resources:&bslash;n&quot;
l_string|&quot;    iomem = 0x%lx (%d)&bslash;n&quot;
l_string|&quot;    ioport  = 0x%lx (%d)&bslash;n&quot;
l_string|&quot;    iomem = 0x%lx (%d)&bslash;n&quot;
l_string|&quot;    [%s]&bslash;n&quot;
comma
id|korg1212-&gt;iomem
comma
id|iomem_size
comma
id|korg1212-&gt;ioport
comma
id|ioport_size
comma
id|korg1212-&gt;iomem2
comma
id|iomem2_size
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|korg1212-&gt;res_iomem
op_assign
id|request_mem_region
c_func
(paren
id|korg1212-&gt;iomem
comma
id|iomem_size
comma
l_string|&quot;korg1212&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|korg1212-&gt;res_iomem
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab region 0x%lx-0x%lx&bslash;n&quot;
comma
id|korg1212-&gt;iomem
comma
id|korg1212-&gt;iomem
op_plus
id|iomem_size
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|korg1212-&gt;res_ioport
op_assign
id|request_region
c_func
(paren
id|korg1212-&gt;ioport
comma
id|ioport_size
comma
l_string|&quot;korg1212&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|korg1212-&gt;res_ioport
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab region 0x%lx-0x%lx&bslash;n&quot;
comma
id|korg1212-&gt;ioport
comma
id|korg1212-&gt;ioport
op_plus
id|ioport_size
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|korg1212-&gt;res_iomem2
op_assign
id|request_mem_region
c_func
(paren
id|korg1212-&gt;iomem2
comma
id|iomem2_size
comma
l_string|&quot;korg1212&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|korg1212-&gt;res_iomem2
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab region 0x%lx-0x%lx&bslash;n&quot;
comma
id|korg1212-&gt;iomem2
comma
id|korg1212-&gt;iomem2
op_plus
id|iomem2_size
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|korg1212-&gt;iobase
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|korg1212-&gt;iomem
comma
id|iomem_size
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unable to remap memory region 0x%lx-0x%lx&bslash;n&quot;
comma
id|korg1212-&gt;iobase
comma
id|korg1212-&gt;iobase
op_plus
id|iomem_size
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|err
op_assign
id|request_irq
c_func
(paren
id|pci-&gt;irq
comma
id|snd_korg1212_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
l_string|&quot;korg1212&quot;
comma
(paren
r_void
op_star
)paren
id|korg1212
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab IRQ %d&bslash;n&quot;
comma
id|pci-&gt;irq
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|korg1212-&gt;irq
op_assign
id|pci-&gt;irq
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|korg1212-&gt;wait
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|korg1212-&gt;lock
)paren
suffix:semicolon
id|pci_set_master
c_func
(paren
id|korg1212-&gt;pci
)paren
suffix:semicolon
id|korg1212-&gt;statusRegPtr
op_assign
(paren
id|u32
op_star
)paren
(paren
id|korg1212-&gt;iobase
op_plus
id|STATUS_REG_OFFSET
)paren
suffix:semicolon
id|korg1212-&gt;outDoorbellPtr
op_assign
(paren
id|u32
op_star
)paren
(paren
id|korg1212-&gt;iobase
op_plus
id|OUT_DOORBELL_OFFSET
)paren
suffix:semicolon
id|korg1212-&gt;inDoorbellPtr
op_assign
(paren
id|u32
op_star
)paren
(paren
id|korg1212-&gt;iobase
op_plus
id|IN_DOORBELL_OFFSET
)paren
suffix:semicolon
id|korg1212-&gt;mailbox0Ptr
op_assign
(paren
id|u32
op_star
)paren
(paren
id|korg1212-&gt;iobase
op_plus
id|MAILBOX0_OFFSET
)paren
suffix:semicolon
id|korg1212-&gt;mailbox1Ptr
op_assign
(paren
id|u32
op_star
)paren
(paren
id|korg1212-&gt;iobase
op_plus
id|MAILBOX1_OFFSET
)paren
suffix:semicolon
id|korg1212-&gt;mailbox2Ptr
op_assign
(paren
id|u32
op_star
)paren
(paren
id|korg1212-&gt;iobase
op_plus
id|MAILBOX2_OFFSET
)paren
suffix:semicolon
id|korg1212-&gt;mailbox3Ptr
op_assign
(paren
id|u32
op_star
)paren
(paren
id|korg1212-&gt;iobase
op_plus
id|MAILBOX3_OFFSET
)paren
suffix:semicolon
id|korg1212-&gt;controlRegPtr
op_assign
(paren
id|u32
op_star
)paren
(paren
id|korg1212-&gt;iobase
op_plus
id|PCI_CONTROL_OFFSET
)paren
suffix:semicolon
id|korg1212-&gt;sensRegPtr
op_assign
(paren
id|u16
op_star
)paren
(paren
id|korg1212-&gt;iobase
op_plus
id|SENS_CONTROL_OFFSET
)paren
suffix:semicolon
id|korg1212-&gt;idRegPtr
op_assign
(paren
id|u32
op_star
)paren
(paren
id|korg1212-&gt;iobase
op_plus
id|DEV_VEND_ID_OFFSET
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: card registers:&bslash;n&quot;
l_string|&quot;    Status register = 0x%p&bslash;n&quot;
l_string|&quot;    OutDoorbell     = 0x%p&bslash;n&quot;
l_string|&quot;    InDoorbell      = 0x%p&bslash;n&quot;
l_string|&quot;    Mailbox0        = 0x%p&bslash;n&quot;
l_string|&quot;    Mailbox1        = 0x%p&bslash;n&quot;
l_string|&quot;    Mailbox2        = 0x%p&bslash;n&quot;
l_string|&quot;    Mailbox3        = 0x%p&bslash;n&quot;
l_string|&quot;    ControlReg      = 0x%p&bslash;n&quot;
l_string|&quot;    SensReg         = 0x%p&bslash;n&quot;
l_string|&quot;    IDReg           = 0x%p&bslash;n&quot;
l_string|&quot;    [%s]&bslash;n&quot;
comma
id|korg1212-&gt;statusRegPtr
comma
id|korg1212-&gt;outDoorbellPtr
comma
id|korg1212-&gt;inDoorbellPtr
comma
id|korg1212-&gt;mailbox0Ptr
comma
id|korg1212-&gt;mailbox1Ptr
comma
id|korg1212-&gt;mailbox2Ptr
comma
id|korg1212-&gt;mailbox3Ptr
comma
id|korg1212-&gt;controlRegPtr
comma
id|korg1212-&gt;sensRegPtr
comma
id|korg1212-&gt;idRegPtr
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|korg1212-&gt;sharedBufferPtr
op_assign
(paren
id|KorgSharedBuffer
op_star
)paren
id|snd_malloc_pci_pages
c_func
(paren
id|korg1212-&gt;pci
comma
r_sizeof
(paren
id|KorgSharedBuffer
)paren
comma
op_amp
id|phys_addr
)paren
suffix:semicolon
id|korg1212-&gt;sharedBufferPhy
op_assign
(paren
r_int
r_int
)paren
id|phys_addr
suffix:semicolon
r_if
c_cond
(paren
id|korg1212-&gt;sharedBufferPtr
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;can not allocate shared buffer memory (%d bytes)&bslash;n&quot;
comma
r_sizeof
(paren
id|KorgSharedBuffer
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: Shared Buffer Area = 0x%p (0x%08lx), %d bytes&bslash;n&quot;
comma
id|korg1212-&gt;sharedBufferPtr
comma
id|korg1212-&gt;sharedBufferPhy
comma
r_sizeof
(paren
id|KorgSharedBuffer
)paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifndef LARGEALLOC
id|korg1212-&gt;DataBufsSize
op_assign
r_sizeof
(paren
id|KorgAudioBuffer
)paren
op_star
id|kNumBuffers
suffix:semicolon
id|korg1212-&gt;playDataBufsPtr
op_assign
(paren
id|KorgAudioBuffer
op_star
)paren
id|snd_malloc_pci_pages
c_func
(paren
id|korg1212-&gt;pci
comma
id|korg1212-&gt;DataBufsSize
comma
op_amp
id|phys_addr
)paren
suffix:semicolon
id|korg1212-&gt;PlayDataPhy
op_assign
(paren
id|u32
)paren
id|phys_addr
suffix:semicolon
r_if
c_cond
(paren
id|korg1212-&gt;playDataBufsPtr
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;can not allocate play data buffer memory (%d bytes)&bslash;n&quot;
comma
id|korg1212-&gt;DataBufsSize
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: Play Data Area = 0x%p (0x%08x), %d bytes&bslash;n&quot;
comma
id|korg1212-&gt;playDataBufsPtr
comma
id|korg1212-&gt;PlayDataPhy
comma
id|korg1212-&gt;DataBufsSize
)paren
suffix:semicolon
macro_line|#endif
id|korg1212-&gt;recordDataBufsPtr
op_assign
(paren
id|KorgAudioBuffer
op_star
)paren
id|snd_malloc_pci_pages
c_func
(paren
id|korg1212-&gt;pci
comma
id|korg1212-&gt;DataBufsSize
comma
op_amp
id|phys_addr
)paren
suffix:semicolon
id|korg1212-&gt;RecDataPhy
op_assign
(paren
id|u32
)paren
id|phys_addr
suffix:semicolon
r_if
c_cond
(paren
id|korg1212-&gt;recordDataBufsPtr
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;can not allocate record data buffer memory (%d bytes)&bslash;n&quot;
comma
id|korg1212-&gt;DataBufsSize
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: Record Data Area = 0x%p (0x%08x), %d bytes&bslash;n&quot;
comma
id|korg1212-&gt;recordDataBufsPtr
comma
id|korg1212-&gt;RecDataPhy
comma
id|korg1212-&gt;DataBufsSize
)paren
suffix:semicolon
macro_line|#endif
macro_line|#else 
singleline_comment|// LARGEALLOC
id|korg1212-&gt;recordDataBufsPtr
op_assign
id|korg1212-&gt;sharedBufferPtr-&gt;recordDataBufs
suffix:semicolon
id|korg1212-&gt;playDataBufsPtr
op_assign
id|korg1212-&gt;sharedBufferPtr-&gt;playDataBufs
suffix:semicolon
id|korg1212-&gt;PlayDataPhy
op_assign
(paren
id|u32
)paren
op_amp
(paren
(paren
id|KorgSharedBuffer
op_star
)paren
id|korg1212-&gt;sharedBufferPhy
)paren
op_member_access_from_pointer
id|playDataBufs
suffix:semicolon
id|korg1212-&gt;RecDataPhy
op_assign
(paren
id|u32
)paren
op_amp
(paren
(paren
id|KorgSharedBuffer
op_star
)paren
id|korg1212-&gt;sharedBufferPhy
)paren
op_member_access_from_pointer
id|recordDataBufs
suffix:semicolon
macro_line|#endif 
singleline_comment|// LARGEALLOC
id|korg1212-&gt;dspCodeSize
op_assign
r_sizeof
(paren
id|dspCode
)paren
suffix:semicolon
id|korg1212-&gt;VolumeTablePhy
op_assign
(paren
id|u32
)paren
op_amp
(paren
(paren
id|KorgSharedBuffer
op_star
)paren
id|korg1212-&gt;sharedBufferPhy
)paren
op_member_access_from_pointer
id|volumeData
suffix:semicolon
id|korg1212-&gt;RoutingTablePhy
op_assign
(paren
id|u32
)paren
op_amp
(paren
(paren
id|KorgSharedBuffer
op_star
)paren
id|korg1212-&gt;sharedBufferPhy
)paren
op_member_access_from_pointer
id|routeData
suffix:semicolon
id|korg1212-&gt;AdatTimeCodePhy
op_assign
(paren
id|u32
)paren
op_amp
(paren
(paren
id|KorgSharedBuffer
op_star
)paren
id|korg1212-&gt;sharedBufferPhy
)paren
op_member_access_from_pointer
id|AdatTimeCode
suffix:semicolon
id|korg1212-&gt;dspMemPtr
op_assign
id|snd_malloc_pci_pages
c_func
(paren
id|korg1212-&gt;pci
comma
id|korg1212-&gt;dspCodeSize
comma
op_amp
id|phys_addr
)paren
suffix:semicolon
id|korg1212-&gt;dspMemPhy
op_assign
(paren
id|u32
)paren
id|phys_addr
suffix:semicolon
r_if
c_cond
(paren
id|korg1212-&gt;dspMemPtr
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;can not allocate dsp code memory (%d bytes)&bslash;n&quot;
comma
id|korg1212-&gt;dspCodeSize
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: DSP Code area = 0x%p (0x%08x) %d bytes [%s]&bslash;n&quot;
comma
id|korg1212-&gt;dspMemPtr
comma
id|korg1212-&gt;dspMemPhy
comma
id|korg1212-&gt;dspCodeSize
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|rc
op_assign
id|snd_korg1212_Send1212Command
c_func
(paren
id|korg1212
comma
id|K1212_DB_RebootCard
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|rc
)paren
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: Reboot Card - RC = %d [%s]&bslash;n&quot;
comma
id|rc
comma
id|stateName
(braket
id|korg1212-&gt;cardState
)braket
)paren
suffix:semicolon
macro_line|#endif
id|snd_korg1212_EnableCardInterrupts
c_func
(paren
id|korg1212
)paren
suffix:semicolon
id|mdelay
c_func
(paren
id|CARD_BOOT_DELAY_IN_MS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_korg1212_downloadDSPCode
c_func
(paren
id|korg1212
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;dspMemPhy       = %08x U[%08x]&bslash;n&quot;
l_string|&quot;PlayDataPhy     = %08x L[%08x]&bslash;n&quot;
l_string|&quot;RecDataPhy      = %08x L[%08x]&bslash;n&quot;
l_string|&quot;VolumeTablePhy  = %08x L[%08x]&bslash;n&quot;
l_string|&quot;RoutingTablePhy = %08x L[%08x]&bslash;n&quot;
l_string|&quot;AdatTimeCodePhy = %08x L[%08x]&bslash;n&quot;
comma
id|korg1212-&gt;dspMemPhy
comma
id|UpperWordSwap
c_func
(paren
id|korg1212-&gt;dspMemPhy
)paren
comma
id|korg1212-&gt;PlayDataPhy
comma
id|LowerWordSwap
c_func
(paren
id|korg1212-&gt;PlayDataPhy
)paren
comma
id|korg1212-&gt;RecDataPhy
comma
id|LowerWordSwap
c_func
(paren
id|korg1212-&gt;RecDataPhy
)paren
comma
id|korg1212-&gt;VolumeTablePhy
comma
id|LowerWordSwap
c_func
(paren
id|korg1212-&gt;VolumeTablePhy
)paren
comma
id|korg1212-&gt;RoutingTablePhy
comma
id|LowerWordSwap
c_func
(paren
id|korg1212-&gt;RoutingTablePhy
)paren
comma
id|korg1212-&gt;AdatTimeCodePhy
comma
id|LowerWordSwap
c_func
(paren
id|korg1212-&gt;AdatTimeCodePhy
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|korg1212-&gt;card
comma
l_string|&quot;korg1212&quot;
comma
l_int|0
comma
l_int|1
comma
l_int|1
comma
op_amp
id|korg1212-&gt;pcm16
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|korg1212-&gt;pcm16-&gt;private_data
op_assign
id|korg1212
suffix:semicolon
id|korg1212-&gt;pcm16-&gt;private_free
op_assign
id|snd_korg1212_free_pcm
suffix:semicolon
id|strcpy
c_func
(paren
id|korg1212-&gt;pcm16-&gt;name
comma
l_string|&quot;korg1212&quot;
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|korg1212-&gt;pcm16
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_korg1212_playback_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|korg1212-&gt;pcm16
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_korg1212_capture_ops
)paren
suffix:semicolon
id|korg1212-&gt;pcm16-&gt;info_flags
op_assign
id|SNDRV_PCM_INFO_JOINT_DUPLEX
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|K1212_CONTROL_ELEMENTS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|korg1212-&gt;card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_korg1212_controls
(braket
id|i
)braket
comma
id|korg1212
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
id|snd_korg1212_proc_init
c_func
(paren
id|korg1212
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|snd_korg1212_free
id|snd_korg1212_free
c_func
(paren
r_void
op_star
id|private_data
)paren
(brace
id|korg1212_t
op_star
id|korg1212
op_assign
(paren
id|korg1212_t
op_star
)paren
id|private_data
suffix:semicolon
r_if
c_cond
(paren
id|korg1212
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
id|snd_korg1212_proc_done
c_func
(paren
id|korg1212
)paren
suffix:semicolon
id|snd_korg1212_TurnOffIdleMonitor
c_func
(paren
id|korg1212
)paren
suffix:semicolon
id|snd_korg1212_DisableCardInterrupts
c_func
(paren
id|korg1212
)paren
suffix:semicolon
r_if
c_cond
(paren
id|korg1212-&gt;irq
op_ge
l_int|0
)paren
(brace
id|free_irq
c_func
(paren
id|korg1212-&gt;irq
comma
(paren
r_void
op_star
)paren
id|korg1212
)paren
suffix:semicolon
id|korg1212-&gt;irq
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|korg1212-&gt;iobase
op_ne
l_int|0
)paren
(brace
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|korg1212-&gt;iobase
)paren
suffix:semicolon
id|korg1212-&gt;iobase
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|korg1212-&gt;res_iomem
op_ne
l_int|NULL
)paren
(brace
id|release_resource
c_func
(paren
id|korg1212-&gt;res_iomem
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|korg1212-&gt;res_iomem
)paren
suffix:semicolon
id|korg1212-&gt;res_iomem
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|korg1212-&gt;res_ioport
op_ne
l_int|NULL
)paren
(brace
id|release_resource
c_func
(paren
id|korg1212-&gt;res_ioport
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|korg1212-&gt;res_ioport
)paren
suffix:semicolon
id|korg1212-&gt;res_ioport
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|korg1212-&gt;res_iomem2
op_ne
l_int|NULL
)paren
(brace
id|release_resource
c_func
(paren
id|korg1212-&gt;res_iomem2
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|korg1212-&gt;res_iomem2
)paren
suffix:semicolon
id|korg1212-&gt;res_iomem2
op_assign
l_int|NULL
suffix:semicolon
)brace
singleline_comment|// ----------------------------------------------------
singleline_comment|// free up memory resources used for the DSP download.
singleline_comment|// ----------------------------------------------------
r_if
c_cond
(paren
id|korg1212-&gt;dspMemPtr
)paren
(brace
id|snd_free_pci_pages
c_func
(paren
id|korg1212-&gt;pci
comma
id|korg1212-&gt;dspCodeSize
comma
id|korg1212-&gt;dspMemPtr
comma
(paren
id|dma_addr_t
)paren
id|korg1212-&gt;dspMemPhy
)paren
suffix:semicolon
id|korg1212-&gt;dspMemPhy
op_assign
l_int|0
suffix:semicolon
id|korg1212-&gt;dspMemPtr
op_assign
l_int|0
suffix:semicolon
id|korg1212-&gt;dspCodeSize
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#ifndef LARGEALLOC
singleline_comment|// ------------------------------------------------------
singleline_comment|// free up memory resources used for the Play/Rec Buffers
singleline_comment|// ------------------------------------------------------
r_if
c_cond
(paren
id|korg1212-&gt;playDataBufsPtr
)paren
(brace
id|snd_free_pci_pages
c_func
(paren
id|korg1212-&gt;pci
comma
id|korg1212-&gt;DataBufsSize
comma
id|korg1212-&gt;playDataBufsPtr
comma
(paren
id|dma_addr_t
)paren
id|korg1212-&gt;PlayDataPhy
)paren
suffix:semicolon
id|korg1212-&gt;PlayDataPhy
op_assign
l_int|0
suffix:semicolon
id|korg1212-&gt;playDataBufsPtr
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|korg1212-&gt;recordDataBufsPtr
)paren
(brace
id|snd_free_pci_pages
c_func
(paren
id|korg1212-&gt;pci
comma
id|korg1212-&gt;DataBufsSize
comma
id|korg1212-&gt;recordDataBufsPtr
comma
(paren
id|dma_addr_t
)paren
id|korg1212-&gt;RecDataPhy
)paren
suffix:semicolon
id|korg1212-&gt;RecDataPhy
op_assign
l_int|0
suffix:semicolon
id|korg1212-&gt;recordDataBufsPtr
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif
singleline_comment|// ----------------------------------------------------
singleline_comment|// free up memory resources used for the Shared Buffers
singleline_comment|// ----------------------------------------------------
r_if
c_cond
(paren
id|korg1212-&gt;sharedBufferPtr
)paren
(brace
id|snd_free_pci_pages
c_func
(paren
id|korg1212-&gt;pci
comma
(paren
id|u32
)paren
r_sizeof
(paren
id|KorgSharedBuffer
)paren
comma
id|korg1212-&gt;sharedBufferPtr
comma
(paren
id|dma_addr_t
)paren
id|korg1212-&gt;sharedBufferPhy
)paren
suffix:semicolon
id|korg1212-&gt;sharedBufferPhy
op_assign
l_int|0
suffix:semicolon
id|korg1212-&gt;sharedBufferPtr
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Card initialisation&n; */
DECL|function|snd_korg1212_card_free
r_static
r_void
id|snd_korg1212_card_free
c_func
(paren
id|snd_card_t
op_star
id|card
)paren
(brace
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: Freeing card&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|snd_korg1212_free
c_func
(paren
id|card-&gt;private_data
)paren
suffix:semicolon
)brace
r_static
r_int
id|__devinit
DECL|function|snd_korg1212_probe
id|snd_korg1212_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
r_static
r_int
id|dev
suffix:semicolon
id|korg1212_t
op_star
id|korg1212
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_ge
id|SNDRV_CARDS
)paren
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|snd_enable
(braket
id|dev
)braket
)paren
(brace
id|dev
op_increment
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|card
op_assign
id|snd_card_new
c_func
(paren
id|snd_index
(braket
id|dev
)braket
comma
id|snd_id
(braket
id|dev
)braket
comma
id|THIS_MODULE
comma
r_sizeof
(paren
id|korg1212_t
)paren
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|card-&gt;private_free
op_assign
id|snd_korg1212_card_free
suffix:semicolon
id|korg1212
op_assign
(paren
id|korg1212_t
op_star
)paren
id|card-&gt;private_data
suffix:semicolon
id|korg1212-&gt;card
op_assign
id|card
suffix:semicolon
id|korg1212-&gt;pci
op_assign
id|pci
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_korg1212_create
c_func
(paren
id|korg1212
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;korg1212&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;shortname
comma
l_string|&quot;korg1212&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;%s at 0x%lx, irq %d&quot;
comma
id|card-&gt;shortname
comma
id|korg1212-&gt;iomem
comma
id|korg1212-&gt;irq
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
id|PRINTK
c_func
(paren
l_string|&quot;DEBUG: %s&bslash;n&quot;
comma
id|card-&gt;longname
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_card_register
c_func
(paren
id|card
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pci
comma
id|card
)paren
suffix:semicolon
id|dev
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_korg1212_remove
r_static
r_void
id|__devexit
id|snd_korg1212_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
id|snd_card_free
c_func
(paren
id|pci_get_drvdata
c_func
(paren
id|pci
)paren
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|driver
r_static
r_struct
id|pci_driver
id|driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;korg1212&quot;
comma
id|id_table
suffix:colon
id|snd_korg1212_ids
comma
id|probe
suffix:colon
id|snd_korg1212_probe
comma
id|remove
suffix:colon
id|__devexit_p
c_func
(paren
id|snd_korg1212_remove
)paren
comma
)brace
suffix:semicolon
DECL|function|alsa_card_korg1212_init
r_static
r_int
id|__init
id|alsa_card_korg1212_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_module_init
c_func
(paren
op_amp
id|driver
)paren
)paren
OL
l_int|0
)paren
(brace
macro_line|#ifdef MODULE
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;No Korg 1212IO cards found&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|alsa_card_korg1212_exit
r_static
r_void
id|__exit
id|alsa_card_korg1212_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|alsa_card_korg1212_init
)paren
id|module_exit
c_func
(paren
id|alsa_card_korg1212_exit
)paren
macro_line|#ifndef MODULE
multiline_comment|/* format is: snd-korg1212=snd_enable,snd_index,snd_id */
DECL|function|alsa_card_korg1212_setup
r_static
r_int
id|__init
id|alsa_card_korg1212_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_static
r_int
id|__initdata
id|nr_dev
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|nr_dev
op_ge
id|SNDRV_CARDS
)paren
r_return
l_int|0
suffix:semicolon
(paren
r_void
)paren
(paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_enable
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_index
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_id
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_id
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
)paren
suffix:semicolon
id|nr_dev
op_increment
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;snd-korg1212=&quot;
comma
id|alsa_card_korg1212_setup
)paren
suffix:semicolon
macro_line|#endif /* ifndef MODULE */
eof
