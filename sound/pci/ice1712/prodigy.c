multiline_comment|/*&n; *   ALSA driver for ICEnsemble VT1724 (Envy24HT)&n; *&n; *   Lowlevel functions for AudioTrak Prodigy 7.1 (and possibly 192) cards&n; *      Copyright (c) 2003 Dimitromanolakis Apostolos &lt;apostol@cs.utoronto.ca&gt;&n; *&t;based on the aureon.c code (c) 2003 by Takashi Iwai &lt;tiwai@suse.de&gt;&n; *&n; *   version 0.82: Stable / not all features work yet (no communication with AC97 secondary)&n; *       added 64x/128x oversampling switch (should be 64x only for 96khz)&n; *       fixed some recording labels (still need to check the rest)&n; *       recording is working probably thanks to correct wm8770 initialization&n; *&n; *   version 0.5: Initial release:&n; *           working: analog output, mixer, headphone amplifier switch&n; *       not working: prety much everything else, at least i could verify that&n; *                    we have no digital output, no capture, pretty bad clicks and poops&n; *                    on mixer switch and other coll stuff.&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; *&n; * NOTES:&n; *&n; *&n; *&n; * - we reuse the akm4xxx_t record for storing the wm8770 codec data.&n; *   both wm and akm codecs are pretty similar, so we can integrate&n; *   both controls in the future, once if wm codecs are reused in&n; *   many boards.&n; *&n; * - writing over SPI is implemented but reading is not yet.&n; *   the SPDIF-in channel status, etc. can be read from CS chip.&n; *&n; * - DAC digital volumes are not implemented in the mixer.&n; *   if they show better response than DAC analog volumes, we can use them&n; *   instead.&n; *&n; * - Prodigy boards are equipped with AC97 STAC9744 chip , too.  it&squot;s used to do&n; *   the analog mixing but not easily controllable (it&squot;s not connected&n; *   directly from envy24ht chip).  so let&squot;s leave it as it is.&n; *&n; */
DECL|macro|REVISION
mdefine_line|#define REVISION 0.82b
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &quot;ice1712.h&quot;
macro_line|#include &quot;envy24ht.h&quot;
macro_line|#include &quot;prodigy.h&quot;
DECL|function|prodigy_set_headphone_amp
r_static
r_int
id|prodigy_set_headphone_amp
c_func
(paren
id|ice1712_t
op_star
id|ice
comma
r_int
id|enable
)paren
(brace
r_int
r_int
id|tmp
comma
id|tmp2
suffix:semicolon
id|tmp2
op_assign
id|tmp
op_assign
id|snd_ice1712_gpio_read
c_func
(paren
id|ice
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enable
)paren
id|tmp
op_or_assign
id|PRODIGY_HP_AMP_EN
suffix:semicolon
r_else
id|tmp
op_and_assign
op_complement
id|PRODIGY_HP_AMP_EN
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_ne
id|tmp2
)paren
(brace
id|snd_ice1712_gpio_write
c_func
(paren
id|ice
comma
id|tmp
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|prodigy_get_headphone_amp
r_static
r_int
id|prodigy_get_headphone_amp
c_func
(paren
id|ice1712_t
op_star
id|ice
)paren
(brace
r_int
r_int
id|tmp
op_assign
id|snd_ice1712_gpio_read
c_func
(paren
id|ice
)paren
suffix:semicolon
r_return
(paren
id|tmp
op_amp
id|PRODIGY_HP_AMP_EN
)paren
op_ne
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * write data in the SPI mode&n; */
DECL|function|prodigy_spi_write
r_static
r_void
id|prodigy_spi_write
c_func
(paren
id|ice1712_t
op_star
id|ice
comma
r_int
r_int
id|cs
comma
r_int
r_int
id|data
comma
r_int
id|bits
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
r_int
id|i
suffix:semicolon
id|tmp
op_assign
id|snd_ice1712_gpio_read
c_func
(paren
id|ice
)paren
suffix:semicolon
id|snd_ice1712_gpio_set_mask
c_func
(paren
id|ice
comma
op_complement
(paren
id|PRODIGY_WM_RW
op_or
id|PRODIGY_WM_DATA
op_or
id|PRODIGY_WM_CLK
op_or
id|PRODIGY_WM_CS
op_or
id|PRODIGY_CS8415_CS
op_or
id|PRODIGY_HP_AMP_EN
)paren
)paren
suffix:semicolon
id|tmp
op_or_assign
id|PRODIGY_WM_RW
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|cs
suffix:semicolon
id|snd_ice1712_gpio_write
c_func
(paren
id|ice
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|bits
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|tmp
op_and_assign
op_complement
id|PRODIGY_WM_CLK
suffix:semicolon
id|snd_ice1712_gpio_write
c_func
(paren
id|ice
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
id|tmp
op_or_assign
id|PRODIGY_WM_DATA
suffix:semicolon
r_else
id|tmp
op_and_assign
op_complement
id|PRODIGY_WM_DATA
suffix:semicolon
id|snd_ice1712_gpio_write
c_func
(paren
id|ice
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|tmp
op_or_assign
id|PRODIGY_WM_CLK
suffix:semicolon
id|snd_ice1712_gpio_write
c_func
(paren
id|ice
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|tmp
op_and_assign
op_complement
id|PRODIGY_WM_CLK
suffix:semicolon
id|tmp
op_or_assign
id|cs
suffix:semicolon
id|snd_ice1712_gpio_write
c_func
(paren
id|ice
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|tmp
op_or_assign
id|PRODIGY_WM_CLK
suffix:semicolon
id|snd_ice1712_gpio_write
c_func
(paren
id|ice
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * get the current register value of WM codec&n; */
DECL|function|wm_get
r_static
r_int
r_int
id|wm_get
c_func
(paren
id|ice1712_t
op_star
id|ice
comma
r_int
id|reg
)paren
(brace
id|reg
op_lshift_assign
l_int|1
suffix:semicolon
r_return
(paren
(paren
r_int
r_int
)paren
id|ice-&gt;akm
(braket
l_int|0
)braket
dot
id|images
(braket
id|reg
)braket
op_lshift
l_int|8
)paren
op_or
id|ice-&gt;akm
(braket
l_int|0
)braket
dot
id|images
(braket
id|reg
op_plus
l_int|1
)braket
suffix:semicolon
)brace
multiline_comment|/*&n; * set the register value of WM codec and remember it&n; */
DECL|function|wm_put
r_static
r_void
id|wm_put
c_func
(paren
id|ice1712_t
op_star
id|ice
comma
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
id|prodigy_spi_write
c_func
(paren
id|ice
comma
id|PRODIGY_WM_CS
comma
(paren
id|reg
op_lshift
l_int|9
)paren
op_or
(paren
id|val
op_amp
l_int|0x1ff
)paren
comma
l_int|16
)paren
suffix:semicolon
id|reg
op_lshift_assign
l_int|1
suffix:semicolon
id|ice-&gt;akm
(braket
l_int|0
)braket
dot
id|images
(braket
id|reg
)braket
op_assign
id|val
op_rshift
l_int|8
suffix:semicolon
id|ice-&gt;akm
(braket
l_int|0
)braket
dot
id|images
(braket
id|reg
op_plus
l_int|1
)braket
op_assign
id|val
suffix:semicolon
)brace
multiline_comment|/*********************************&n; ********* Controls section ******&n; *********************************/
DECL|macro|PRODIGY_CON_HPAMP
mdefine_line|#define PRODIGY_CON_HPAMP &bslash;&n;        {                                            &bslash;&n;                .iface = SNDRV_CTL_ELEM_IFACE_MIXER,      &bslash;&n;                .name =  &quot;Headphone Amplifier&quot;, &bslash;&n;                .info =  prodigy_hpamp_info,         &bslash;&n;                .get =   prodigy_hpamp_get, &bslash;&n;                .put =   prodigy_hpamp_put  &bslash;&n;        }
DECL|function|prodigy_hpamp_info
r_static
r_int
id|prodigy_hpamp_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|k
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_static
r_char
op_star
id|texts
(braket
l_int|2
)braket
op_assign
(brace
l_string|&quot;Off&quot;
comma
l_string|&quot;On&quot;
)brace
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_ENUMERATED
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.enumerated.items
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|uinfo-&gt;value.enumerated.item
op_ge
id|uinfo-&gt;value.enumerated.items
)paren
id|uinfo-&gt;value.enumerated.item
op_assign
id|uinfo-&gt;value.enumerated.items
op_minus
l_int|1
suffix:semicolon
id|strcpy
c_func
(paren
id|uinfo-&gt;value.enumerated.name
comma
id|texts
(braket
id|uinfo-&gt;value.enumerated.item
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|prodigy_hpamp_get
r_static
r_int
id|prodigy_hpamp_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|prodigy_get_headphone_amp
c_func
(paren
id|ice
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|prodigy_hpamp_put
r_static
r_int
id|prodigy_hpamp_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_return
id|prodigy_set_headphone_amp
c_func
(paren
id|ice
comma
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
DECL|macro|PRODIGY_CON_DEEMP
mdefine_line|#define PRODIGY_CON_DEEMP &bslash;&n;        {                                            &bslash;&n;                .iface = SNDRV_CTL_ELEM_IFACE_MIXER,      &bslash;&n;                .name =  &quot;DAC De-emphasis&quot;, &bslash;&n;                .info =  prodigy_deemp_info,         &bslash;&n;                .get =   prodigy_deemp_get, &bslash;&n;                .put =   prodigy_deemp_put  &bslash;&n;        }
DECL|function|prodigy_deemp_info
r_static
r_int
id|prodigy_deemp_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|k
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_static
r_char
op_star
id|texts
(braket
l_int|2
)braket
op_assign
(brace
l_string|&quot;Off&quot;
comma
l_string|&quot;On&quot;
)brace
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_ENUMERATED
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.enumerated.items
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|uinfo-&gt;value.enumerated.item
op_ge
id|uinfo-&gt;value.enumerated.items
)paren
id|uinfo-&gt;value.enumerated.item
op_assign
id|uinfo-&gt;value.enumerated.items
op_minus
l_int|1
suffix:semicolon
id|strcpy
c_func
(paren
id|uinfo-&gt;value.enumerated.name
comma
id|texts
(braket
id|uinfo-&gt;value.enumerated.item
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|prodigy_deemp_get
r_static
r_int
id|prodigy_deemp_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|wm_get
c_func
(paren
id|ice
comma
l_int|0x15
)paren
op_amp
l_int|0xf
)paren
op_eq
l_int|0xf
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|prodigy_deemp_put
r_static
r_int
id|prodigy_deemp_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|temp
comma
id|temp2
suffix:semicolon
id|temp2
op_assign
id|temp
op_assign
id|wm_get
c_func
(paren
id|ice
comma
l_int|0x15
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|temp
op_amp
op_complement
l_int|0xf
)paren
op_or
(paren
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
op_star
l_int|0xf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_ne
id|temp2
)paren
(brace
id|wm_put
c_func
(paren
id|ice
comma
l_int|0x15
comma
id|temp
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|PRODIGY_CON_OVERSAMPLING
mdefine_line|#define PRODIGY_CON_OVERSAMPLING &bslash;&n;        {                                            &bslash;&n;                .iface = SNDRV_CTL_ELEM_IFACE_MIXER,      &bslash;&n;                .name =  &quot;ADC Oversampling&quot;, &bslash;&n;                .info =  prodigy_oversampling_info,         &bslash;&n;                .get =   prodigy_oversampling_get, &bslash;&n;                .put =   prodigy_oversampling_put  &bslash;&n;        }
DECL|function|prodigy_oversampling_info
r_static
r_int
id|prodigy_oversampling_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|k
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_static
r_char
op_star
id|texts
(braket
l_int|2
)braket
op_assign
(brace
l_string|&quot;128x&quot;
comma
l_string|&quot;64x&quot;
)brace
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_ENUMERATED
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.enumerated.items
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|uinfo-&gt;value.enumerated.item
op_ge
id|uinfo-&gt;value.enumerated.items
)paren
id|uinfo-&gt;value.enumerated.item
op_assign
id|uinfo-&gt;value.enumerated.items
op_minus
l_int|1
suffix:semicolon
id|strcpy
c_func
(paren
id|uinfo-&gt;value.enumerated.name
comma
id|texts
(braket
id|uinfo-&gt;value.enumerated.item
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|prodigy_oversampling_get
r_static
r_int
id|prodigy_oversampling_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|wm_get
c_func
(paren
id|ice
comma
l_int|0x17
)paren
op_amp
l_int|0x8
)paren
op_eq
l_int|0x8
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|prodigy_oversampling_put
r_static
r_int
id|prodigy_oversampling_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
r_int
id|temp
comma
id|temp2
suffix:semicolon
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|temp2
op_assign
id|temp
op_assign
id|wm_get
c_func
(paren
id|ice
comma
l_int|0x17
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
(brace
id|temp
op_or_assign
l_int|0x8
suffix:semicolon
)brace
r_else
(brace
id|temp
op_and_assign
op_complement
l_int|0x8
suffix:semicolon
)brace
r_if
c_cond
(paren
id|temp
op_ne
id|temp2
)paren
(brace
id|wm_put
c_func
(paren
id|ice
comma
l_int|0x17
comma
id|temp
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * DAC volume attenuation mixer control&n; */
DECL|function|wm_dac_vol_info
r_static
r_int
id|wm_dac_vol_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* mute */
id|uinfo-&gt;value.integer.max
op_assign
l_int|101
suffix:semicolon
multiline_comment|/* 0dB */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_dac_vol_get
r_static
r_int
id|wm_dac_vol_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|idx
suffix:semicolon
r_int
r_int
id|vol
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kcontrol-&gt;private_value
)paren
id|idx
op_assign
id|WM_DAC_MASTER_ATTEN
suffix:semicolon
r_else
id|idx
op_assign
id|snd_ctl_get_ioffidx
c_func
(paren
id|kcontrol
comma
op_amp
id|ucontrol-&gt;id
)paren
op_plus
id|WM_DAC_ATTEN
suffix:semicolon
id|vol
op_assign
id|wm_get
c_func
(paren
id|ice
comma
id|idx
)paren
op_amp
l_int|0x7f
suffix:semicolon
r_if
c_cond
(paren
id|vol
op_le
l_int|0x1a
)paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_else
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|vol
op_minus
l_int|0x1a
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_dac_vol_put
r_static
r_int
id|wm_dac_vol_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|idx
suffix:semicolon
r_int
r_int
id|ovol
comma
id|nvol
suffix:semicolon
r_int
id|change
suffix:semicolon
id|snd_ice1712_save_gpio_status
c_func
(paren
id|ice
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kcontrol-&gt;private_value
)paren
id|idx
op_assign
id|WM_DAC_MASTER_ATTEN
suffix:semicolon
r_else
id|idx
op_assign
id|snd_ctl_get_ioffidx
c_func
(paren
id|kcontrol
comma
op_amp
id|ucontrol-&gt;id
)paren
op_plus
id|WM_DAC_ATTEN
suffix:semicolon
id|nvol
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_plus
l_int|0x1a
suffix:semicolon
id|ovol
op_assign
id|wm_get
c_func
(paren
id|ice
comma
id|idx
)paren
op_amp
l_int|0x7f
suffix:semicolon
id|change
op_assign
(paren
id|ovol
op_ne
id|nvol
)paren
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
(brace
r_if
c_cond
(paren
id|nvol
op_le
l_int|0x1a
op_logical_and
id|ovol
op_le
l_int|0x1a
)paren
id|change
op_assign
l_int|0
suffix:semicolon
r_else
id|wm_put
c_func
(paren
id|ice
comma
id|idx
comma
id|nvol
op_or
l_int|0x180
)paren
suffix:semicolon
multiline_comment|/* update on zero detect */
)brace
id|snd_ice1712_restore_gpio_status
c_func
(paren
id|ice
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
multiline_comment|/*&n; * ADC gain mixer control&n; */
DECL|function|wm_adc_vol_info
r_static
r_int
id|wm_adc_vol_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* -12dB */
id|uinfo-&gt;value.integer.max
op_assign
l_int|0x1f
suffix:semicolon
multiline_comment|/* 19dB */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_adc_vol_get
r_static
r_int
id|wm_adc_vol_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|idx
suffix:semicolon
r_int
r_int
id|vol
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
id|idx
op_assign
id|snd_ctl_get_ioffidx
c_func
(paren
id|kcontrol
comma
op_amp
id|ucontrol-&gt;id
)paren
op_plus
id|WM_ADC_GAIN
suffix:semicolon
id|vol
op_assign
id|wm_get
c_func
(paren
id|ice
comma
id|idx
)paren
op_amp
l_int|0x1f
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|vol
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_adc_vol_put
r_static
r_int
id|wm_adc_vol_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|idx
suffix:semicolon
r_int
r_int
id|ovol
comma
id|nvol
suffix:semicolon
r_int
id|change
suffix:semicolon
id|snd_ice1712_save_gpio_status
c_func
(paren
id|ice
)paren
suffix:semicolon
id|idx
op_assign
id|snd_ctl_get_ioffidx
c_func
(paren
id|kcontrol
comma
op_amp
id|ucontrol-&gt;id
)paren
op_plus
id|WM_ADC_GAIN
suffix:semicolon
id|nvol
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
suffix:semicolon
id|ovol
op_assign
id|wm_get
c_func
(paren
id|ice
comma
id|idx
)paren
op_amp
l_int|0x1f
suffix:semicolon
id|change
op_assign
(paren
id|ovol
op_ne
id|nvol
)paren
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
id|wm_put
c_func
(paren
id|ice
comma
id|idx
comma
id|nvol
)paren
suffix:semicolon
id|snd_ice1712_restore_gpio_status
c_func
(paren
id|ice
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
multiline_comment|/*&n; * ADC input mux mixer control&n; */
DECL|function|wm_adc_mux_info
r_static
r_int
id|wm_adc_mux_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_static
r_char
op_star
id|texts
(braket
)braket
op_assign
(brace
l_string|&quot;CD Left&quot;
comma
l_string|&quot;CD Right&quot;
comma
l_string|&quot;Line Left&quot;
comma
l_string|&quot;Line Right&quot;
comma
l_string|&quot;Aux Left&quot;
comma
l_string|&quot;Aux Right&quot;
comma
l_string|&quot;Mic Left&quot;
comma
l_string|&quot;Mic Right&quot;
comma
)brace
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_ENUMERATED
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.enumerated.items
op_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|uinfo-&gt;value.enumerated.item
op_ge
id|uinfo-&gt;value.enumerated.items
)paren
id|uinfo-&gt;value.enumerated.item
op_assign
id|uinfo-&gt;value.enumerated.items
op_minus
l_int|1
suffix:semicolon
id|strcpy
c_func
(paren
id|uinfo-&gt;value.enumerated.name
comma
id|texts
(braket
id|uinfo-&gt;value.enumerated.item
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_adc_mux_get
r_static
r_int
id|wm_adc_mux_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
id|val
op_assign
id|wm_get
c_func
(paren
id|ice
comma
id|WM_ADC_MUX
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|val
op_amp
l_int|7
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
(paren
id|val
op_rshift
l_int|4
)paren
op_amp
l_int|7
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_adc_mux_put
r_static
r_int
id|wm_adc_mux_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|oval
comma
id|nval
suffix:semicolon
r_int
id|change
suffix:semicolon
id|snd_ice1712_save_gpio_status
c_func
(paren
id|ice
)paren
suffix:semicolon
id|oval
op_assign
id|wm_get
c_func
(paren
id|ice
comma
id|WM_ADC_MUX
)paren
suffix:semicolon
id|nval
op_assign
id|oval
op_amp
op_complement
l_int|0x77
suffix:semicolon
id|nval
op_or_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|7
suffix:semicolon
id|nval
op_or_assign
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_amp
l_int|7
)paren
op_lshift
l_int|4
suffix:semicolon
id|change
op_assign
(paren
id|oval
op_ne
id|nval
)paren
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
id|wm_put
c_func
(paren
id|ice
comma
id|WM_ADC_MUX
comma
id|nval
)paren
suffix:semicolon
id|snd_ice1712_restore_gpio_status
c_func
(paren
id|ice
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * mixers&n; */
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|prodigy71_dac_control
id|__devinitdata
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;DAC Volume&quot;
comma
dot
id|count
op_assign
l_int|8
comma
dot
id|info
op_assign
id|wm_dac_vol_info
comma
dot
id|get
op_assign
id|wm_dac_vol_get
comma
dot
id|put
op_assign
id|wm_dac_vol_put
comma
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|wm_controls
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Master Playback Volume&quot;
comma
dot
id|info
op_assign
id|wm_dac_vol_info
comma
dot
id|get
op_assign
id|wm_dac_vol_get
comma
dot
id|put
op_assign
id|wm_dac_vol_put
comma
dot
id|private_value
op_assign
l_int|1
comma
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;ADC Volume&quot;
comma
dot
id|count
op_assign
l_int|2
comma
dot
id|info
op_assign
id|wm_adc_vol_info
comma
dot
id|get
op_assign
id|wm_adc_vol_get
comma
dot
id|put
op_assign
id|wm_adc_vol_put
comma
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Capture Route&quot;
comma
dot
id|info
op_assign
id|wm_adc_mux_info
comma
dot
id|get
op_assign
id|wm_adc_mux_get
comma
dot
id|put
op_assign
id|wm_adc_mux_put
comma
)brace
comma
id|PRODIGY_CON_HPAMP
comma
id|PRODIGY_CON_DEEMP
comma
id|PRODIGY_CON_OVERSAMPLING
)brace
suffix:semicolon
DECL|function|prodigy_add_controls
r_static
r_int
id|__devinit
id|prodigy_add_controls
c_func
(paren
id|ice1712_t
op_star
id|ice
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|ice-&gt;card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|prodigy71_dac_control
comma
id|ice
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|wm_controls
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|ice-&gt;card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|wm_controls
(braket
id|i
)braket
comma
id|ice
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * initialize the chip&n; */
DECL|function|prodigy_init
r_static
r_int
id|__devinit
id|prodigy_init
c_func
(paren
id|ice1712_t
op_star
id|ice
)paren
(brace
r_static
r_int
r_int
id|wm_inits
(braket
)braket
op_assign
(brace
multiline_comment|/* These come first to reduce init pop noise */
l_int|0x1b
comma
l_int|0x000
comma
multiline_comment|/* ADC Mux */
l_int|0x1c
comma
l_int|0x009
comma
multiline_comment|/* Out Mux1 */
l_int|0x1d
comma
l_int|0x009
comma
multiline_comment|/* Out Mux2 */
l_int|0x18
comma
l_int|0x000
comma
multiline_comment|/* All power-up */
l_int|0x16
comma
l_int|0x022
comma
multiline_comment|/* I2S, normal polarity, 24bit, high-pass on */
l_int|0x17
comma
l_int|0x006
comma
multiline_comment|/* 128fs, slave mode */
l_int|0x00
comma
l_int|0
comma
multiline_comment|/* DAC1 analog mute */
l_int|0x01
comma
l_int|0
comma
multiline_comment|/* DAC2 analog mute */
l_int|0x02
comma
l_int|0
comma
multiline_comment|/* DAC3 analog mute */
l_int|0x03
comma
l_int|0
comma
multiline_comment|/* DAC4 analog mute */
l_int|0x04
comma
l_int|0
comma
multiline_comment|/* DAC5 analog mute */
l_int|0x05
comma
l_int|0
comma
multiline_comment|/* DAC6 analog mute */
l_int|0x06
comma
l_int|0
comma
multiline_comment|/* DAC7 analog mute */
l_int|0x07
comma
l_int|0
comma
multiline_comment|/* DAC8 analog mute */
l_int|0x08
comma
l_int|0x100
comma
multiline_comment|/* master analog mute */
l_int|0x09
comma
l_int|0x7f
comma
multiline_comment|/* DAC1 digital full */
l_int|0x0a
comma
l_int|0x7f
comma
multiline_comment|/* DAC2 digital full */
l_int|0x0b
comma
l_int|0x7f
comma
multiline_comment|/* DAC3 digital full */
l_int|0x0c
comma
l_int|0x7f
comma
multiline_comment|/* DAC4 digital full */
l_int|0x0d
comma
l_int|0x7f
comma
multiline_comment|/* DAC5 digital full */
l_int|0x0e
comma
l_int|0x7f
comma
multiline_comment|/* DAC6 digital full */
l_int|0x0f
comma
l_int|0x7f
comma
multiline_comment|/* DAC7 digital full */
l_int|0x10
comma
l_int|0x7f
comma
multiline_comment|/* DAC8 digital full */
l_int|0x11
comma
l_int|0x1FF
comma
multiline_comment|/* master digital full */
l_int|0x12
comma
l_int|0x000
comma
multiline_comment|/* phase normal */
l_int|0x13
comma
l_int|0x090
comma
multiline_comment|/* unmute DAC L/R */
l_int|0x14
comma
l_int|0x000
comma
multiline_comment|/* all unmute */
l_int|0x15
comma
l_int|0x000
comma
multiline_comment|/* no deemphasis, no ZFLG */
l_int|0x19
comma
l_int|0x000
comma
multiline_comment|/* -12dB ADC/L */
l_int|0x1a
comma
l_int|0x000
multiline_comment|/* -12dB ADC/R */
)brace
suffix:semicolon
r_static
r_int
r_int
id|cs_inits
(braket
)braket
op_assign
(brace
l_int|0x0441
comma
multiline_comment|/* RUN */
l_int|0x0100
comma
multiline_comment|/* no mute */
l_int|0x0200
comma
multiline_comment|/* */
l_int|0x0600
comma
multiline_comment|/* slave, 24bit */
)brace
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ice1724: AudioTrak Prodigy 7.1 driver rev. 0.82b&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ice1724:   This driver is in beta stage. Forsuccess/failure reporting contact&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ice1724:   Apostolos Dimitromanolakis &lt;apostol@cs.utoronto.ca&gt;&bslash;n&quot;
)paren
suffix:semicolon
id|ice-&gt;num_total_dacs
op_assign
l_int|8
suffix:semicolon
id|ice-&gt;num_total_adcs
op_assign
l_int|8
suffix:semicolon
multiline_comment|/* to remeber the register values */
id|ice-&gt;akm
op_assign
id|snd_kcalloc
c_func
(paren
r_sizeof
(paren
id|akm4xxx_t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ice-&gt;akm
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|ice-&gt;akm_codecs
op_assign
l_int|1
suffix:semicolon
id|snd_ice1712_gpio_set_dir
c_func
(paren
id|ice
comma
l_int|0xbfffff
)paren
suffix:semicolon
multiline_comment|/* fix this for the time being */
multiline_comment|/* reset the wm codec as the SPI mode */
id|snd_ice1712_save_gpio_status
c_func
(paren
id|ice
)paren
suffix:semicolon
id|snd_ice1712_gpio_set_mask
c_func
(paren
id|ice
comma
op_complement
(paren
id|PRODIGY_WM_RESET
op_or
id|PRODIGY_WM_CS
op_or
id|PRODIGY_CS8415_CS
op_or
id|PRODIGY_HP_AMP_EN
)paren
)paren
suffix:semicolon
id|tmp
op_assign
id|snd_ice1712_gpio_read
c_func
(paren
id|ice
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|PRODIGY_WM_RESET
suffix:semicolon
id|snd_ice1712_gpio_write
c_func
(paren
id|ice
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|tmp
op_or_assign
id|PRODIGY_WM_CS
op_or
id|PRODIGY_CS8415_CS
suffix:semicolon
id|snd_ice1712_gpio_write
c_func
(paren
id|ice
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|tmp
op_or_assign
id|PRODIGY_WM_RESET
suffix:semicolon
id|snd_ice1712_gpio_write
c_func
(paren
id|ice
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* initialize WM8770 codec */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|wm_inits
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
id|wm_put
c_func
(paren
id|ice
comma
id|wm_inits
(braket
id|i
)braket
comma
id|wm_inits
(braket
id|i
op_plus
l_int|1
)braket
)paren
suffix:semicolon
multiline_comment|/* initialize CS8415A codec */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|cs_inits
)paren
suffix:semicolon
id|i
op_increment
)paren
id|prodigy_spi_write
c_func
(paren
id|ice
comma
id|PRODIGY_CS8415_CS
comma
id|cs_inits
(braket
id|i
)braket
op_or
l_int|0x200000
comma
l_int|24
)paren
suffix:semicolon
id|prodigy_set_headphone_amp
c_func
(paren
id|ice
comma
l_int|1
)paren
suffix:semicolon
id|snd_ice1712_restore_gpio_status
c_func
(paren
id|ice
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Prodigy boards don&squot;t provide the EEPROM data except for the vendor IDs.&n; * hence the driver needs to sets up it properly.&n; */
DECL|variable|__devinitdata
r_static
r_int
r_char
id|prodigy71_eeprom
(braket
)braket
id|__devinitdata
op_assign
(brace
l_int|0x2b
comma
multiline_comment|/* SYSCONF: clock 512, mpu401, spdif-in/ADC, 4DACs */
l_int|0x80
comma
multiline_comment|/* ACLINK: I2S */
l_int|0xf8
comma
multiline_comment|/* I2S: vol, 96k, 24bit, 192k */
l_int|0xc3
comma
multiline_comment|/* SPDIF: out-en, out-int, spdif-in */
l_int|0xff
comma
multiline_comment|/* GPIO_DIR */
l_int|0xff
comma
multiline_comment|/* GPIO_DIR1 */
l_int|0xbf
comma
multiline_comment|/* GPIO_DIR2 */
l_int|0x00
comma
multiline_comment|/* GPIO_MASK */
l_int|0x00
comma
multiline_comment|/* GPIO_MASK1 */
l_int|0x00
comma
multiline_comment|/* GPIO_MASK2 */
l_int|0x00
comma
multiline_comment|/* GPIO_STATE */
l_int|0x00
comma
multiline_comment|/* GPIO_STATE1 */
l_int|0x00
comma
multiline_comment|/* GPIO_STATE2 */
)brace
suffix:semicolon
multiline_comment|/* entry point */
DECL|variable|__devinitdata
r_struct
id|snd_ice1712_card_info
id|snd_vt1724_prodigy_cards
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
dot
id|subvendor
op_assign
id|VT1724_SUBDEVICE_PRODIGY71
comma
dot
id|name
op_assign
l_string|&quot;Audiotrak Prodigy 7.1&quot;
comma
dot
id|model
op_assign
l_string|&quot;prodigy71&quot;
comma
dot
id|chip_init
op_assign
id|prodigy_init
comma
dot
id|build_controls
op_assign
id|prodigy_add_controls
comma
dot
id|eeprom_size
op_assign
r_sizeof
(paren
id|prodigy71_eeprom
)paren
comma
dot
id|eeprom_data
op_assign
id|prodigy71_eeprom
comma
)brace
comma
(brace
)brace
multiline_comment|/* terminator */
)brace
suffix:semicolon
eof
