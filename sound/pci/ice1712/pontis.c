multiline_comment|/*&n; *   ALSA driver for ICEnsemble VT1724 (Envy24HT)&n; *&n; *   Lowlevel functions for Pontis MS300&n; *&n; *&t;Copyright (c) 2004 Takashi Iwai &lt;tiwai@suse.de&gt;&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#include &quot;ice1712.h&quot;
macro_line|#include &quot;envy24ht.h&quot;
macro_line|#include &quot;pontis.h&quot;
multiline_comment|/* I2C addresses */
DECL|macro|WM_DEV
mdefine_line|#define WM_DEV&t;&t;0x34
DECL|macro|CS_DEV
mdefine_line|#define CS_DEV&t;&t;0x20
multiline_comment|/* WM8776 registers */
DECL|macro|WM_HP_ATTEN_L
mdefine_line|#define WM_HP_ATTEN_L&t;&t;0x00&t;/* headphone left attenuation */
DECL|macro|WM_HP_ATTEN_R
mdefine_line|#define WM_HP_ATTEN_R&t;&t;0x01&t;/* headphone left attenuation */
DECL|macro|WM_HP_MASTER
mdefine_line|#define WM_HP_MASTER&t;&t;0x02&t;/* headphone master (both channels), override LLR */
DECL|macro|WM_DAC_ATTEN_L
mdefine_line|#define WM_DAC_ATTEN_L&t;&t;0x03&t;/* digital left attenuation */
DECL|macro|WM_DAC_ATTEN_R
mdefine_line|#define WM_DAC_ATTEN_R&t;&t;0x04
DECL|macro|WM_DAC_MASTER
mdefine_line|#define WM_DAC_MASTER&t;&t;0x05
DECL|macro|WM_PHASE_SWAP
mdefine_line|#define WM_PHASE_SWAP&t;&t;0x06&t;/* DAC phase swap */
DECL|macro|WM_DAC_CTRL1
mdefine_line|#define WM_DAC_CTRL1&t;&t;0x07
DECL|macro|WM_DAC_MUTE
mdefine_line|#define WM_DAC_MUTE&t;&t;0x08
DECL|macro|WM_DAC_CTRL2
mdefine_line|#define WM_DAC_CTRL2&t;&t;0x09
DECL|macro|WM_DAC_INT
mdefine_line|#define WM_DAC_INT&t;&t;0x0a
DECL|macro|WM_ADC_INT
mdefine_line|#define WM_ADC_INT&t;&t;0x0b
DECL|macro|WM_MASTER_CTRL
mdefine_line|#define WM_MASTER_CTRL&t;&t;0x0c
DECL|macro|WM_POWERDOWN
mdefine_line|#define WM_POWERDOWN&t;&t;0x0d
DECL|macro|WM_ADC_ATTEN_L
mdefine_line|#define WM_ADC_ATTEN_L&t;&t;0x0e
DECL|macro|WM_ADC_ATTEN_R
mdefine_line|#define WM_ADC_ATTEN_R&t;&t;0x0f
DECL|macro|WM_ALC_CTRL1
mdefine_line|#define WM_ALC_CTRL1&t;&t;0x10
DECL|macro|WM_ALC_CTRL2
mdefine_line|#define WM_ALC_CTRL2&t;&t;0x11
DECL|macro|WM_ALC_CTRL3
mdefine_line|#define WM_ALC_CTRL3&t;&t;0x12
DECL|macro|WM_NOISE_GATE
mdefine_line|#define WM_NOISE_GATE&t;&t;0x13
DECL|macro|WM_LIMITER
mdefine_line|#define WM_LIMITER&t;&t;0x14
DECL|macro|WM_ADC_MUX
mdefine_line|#define WM_ADC_MUX&t;&t;0x15
DECL|macro|WM_OUT_MUX
mdefine_line|#define WM_OUT_MUX&t;&t;0x16
DECL|macro|WM_RESET
mdefine_line|#define WM_RESET&t;&t;0x17
multiline_comment|/*&n; * GPIO&n; */
DECL|macro|PONTIS_CS_CS
mdefine_line|#define PONTIS_CS_CS&t;&t;(1&lt;&lt;4)&t;/* CS */
DECL|macro|PONTIS_CS_CLK
mdefine_line|#define PONTIS_CS_CLK&t;&t;(1&lt;&lt;5)&t;/* CLK */
DECL|macro|PONTIS_CS_RDATA
mdefine_line|#define PONTIS_CS_RDATA&t;&t;(1&lt;&lt;6)&t;/* CS8416 -&gt; VT1720 */
DECL|macro|PONTIS_CS_WDATA
mdefine_line|#define PONTIS_CS_WDATA&t;&t;(1&lt;&lt;7)&t;/* VT1720 -&gt; CS8416 */
multiline_comment|/*&n; * get the current register value of WM codec&n; */
DECL|function|wm_get
r_static
r_int
r_int
id|wm_get
c_func
(paren
id|ice1712_t
op_star
id|ice
comma
r_int
id|reg
)paren
(brace
id|reg
op_lshift_assign
l_int|1
suffix:semicolon
r_return
(paren
(paren
r_int
r_int
)paren
id|ice-&gt;akm
(braket
l_int|0
)braket
dot
id|images
(braket
id|reg
)braket
op_lshift
l_int|8
)paren
op_or
id|ice-&gt;akm
(braket
l_int|0
)braket
dot
id|images
(braket
id|reg
op_plus
l_int|1
)braket
suffix:semicolon
)brace
multiline_comment|/*&n; * set the register value of WM codec and remember it&n; */
DECL|function|wm_put_nocache
r_static
r_void
id|wm_put_nocache
c_func
(paren
id|ice1712_t
op_star
id|ice
comma
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
r_int
r_int
id|cval
suffix:semicolon
id|cval
op_assign
(paren
id|reg
op_lshift
l_int|9
)paren
op_or
id|val
suffix:semicolon
id|snd_vt1724_write_i2c
c_func
(paren
id|ice
comma
id|WM_DEV
comma
id|cval
op_rshift
l_int|8
comma
id|cval
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
DECL|function|wm_put
r_static
r_void
id|wm_put
c_func
(paren
id|ice1712_t
op_star
id|ice
comma
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
id|wm_put_nocache
c_func
(paren
id|ice
comma
id|reg
comma
id|val
)paren
suffix:semicolon
id|reg
op_lshift_assign
l_int|1
suffix:semicolon
id|ice-&gt;akm
(braket
l_int|0
)braket
dot
id|images
(braket
id|reg
)braket
op_assign
id|val
op_rshift
l_int|8
suffix:semicolon
id|ice-&gt;akm
(braket
l_int|0
)braket
dot
id|images
(braket
id|reg
op_plus
l_int|1
)braket
op_assign
id|val
suffix:semicolon
)brace
multiline_comment|/*&n; * DAC volume attenuation mixer control (-64dB to 0dB)&n; */
DECL|macro|DAC_0dB
mdefine_line|#define DAC_0dB&t;0xff
DECL|macro|DAC_RES
mdefine_line|#define DAC_RES&t;128
DECL|macro|DAC_MIN
mdefine_line|#define DAC_MIN&t;(DAC_0dB - DAC_RES)
DECL|function|wm_dac_vol_info
r_static
r_int
id|wm_dac_vol_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* mute */
id|uinfo-&gt;value.integer.max
op_assign
id|DAC_RES
suffix:semicolon
multiline_comment|/* 0dB, 0.5dB step */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_dac_vol_get
r_static
r_int
id|wm_dac_vol_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|i
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|val
op_assign
id|wm_get
c_func
(paren
id|ice
comma
id|WM_DAC_ATTEN_L
op_plus
id|i
)paren
op_amp
l_int|0xff
suffix:semicolon
id|val
op_assign
id|val
OG
id|DAC_MIN
ques
c_cond
(paren
id|val
op_minus
id|DAC_MIN
)paren
suffix:colon
l_int|0
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
id|i
)braket
op_assign
id|val
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_dac_vol_put
r_static
r_int
id|wm_dac_vol_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|oval
comma
id|nval
suffix:semicolon
r_int
id|i
comma
id|idx
comma
id|change
op_assign
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|nval
op_assign
id|ucontrol-&gt;value.integer.value
(braket
id|i
)braket
suffix:semicolon
id|nval
op_assign
(paren
id|nval
ques
c_cond
(paren
id|nval
op_plus
id|DAC_MIN
)paren
suffix:colon
l_int|0
)paren
op_amp
l_int|0xff
suffix:semicolon
id|idx
op_assign
id|WM_DAC_ATTEN_L
op_plus
id|i
suffix:semicolon
id|oval
op_assign
id|wm_get
c_func
(paren
id|ice
comma
id|idx
)paren
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|oval
op_ne
id|nval
)paren
(brace
id|wm_put
c_func
(paren
id|ice
comma
id|idx
comma
id|nval
)paren
suffix:semicolon
id|wm_put_nocache
c_func
(paren
id|ice
comma
id|idx
comma
id|nval
op_or
l_int|0x100
)paren
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
multiline_comment|/*&n; * ADC gain mixer control (-64dB to 0dB)&n; */
DECL|macro|ADC_0dB
mdefine_line|#define ADC_0dB&t;0xcf
DECL|macro|ADC_RES
mdefine_line|#define ADC_RES&t;128
DECL|macro|ADC_MIN
mdefine_line|#define ADC_MIN&t;(ADC_0dB - ADC_RES)
DECL|function|wm_adc_vol_info
r_static
r_int
id|wm_adc_vol_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* mute (-64dB) */
id|uinfo-&gt;value.integer.max
op_assign
id|ADC_RES
suffix:semicolon
multiline_comment|/* 0dB, 0.5dB step */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_adc_vol_get
r_static
r_int
id|wm_adc_vol_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|i
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|val
op_assign
id|wm_get
c_func
(paren
id|ice
comma
id|WM_ADC_ATTEN_L
op_plus
id|i
)paren
op_amp
l_int|0xff
suffix:semicolon
id|val
op_assign
id|val
OG
id|ADC_MIN
ques
c_cond
(paren
id|val
op_minus
id|ADC_MIN
)paren
suffix:colon
l_int|0
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
id|i
)braket
op_assign
id|val
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_adc_vol_put
r_static
r_int
id|wm_adc_vol_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|ovol
comma
id|nvol
suffix:semicolon
r_int
id|i
comma
id|idx
comma
id|change
op_assign
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|nvol
op_assign
id|ucontrol-&gt;value.integer.value
(braket
id|i
)braket
suffix:semicolon
id|nvol
op_assign
id|nvol
ques
c_cond
(paren
id|nvol
op_plus
id|ADC_MIN
)paren
suffix:colon
l_int|0
suffix:semicolon
id|idx
op_assign
id|WM_ADC_ATTEN_L
op_plus
id|i
suffix:semicolon
id|ovol
op_assign
id|wm_get
c_func
(paren
id|ice
comma
id|idx
)paren
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|ovol
op_ne
id|nvol
)paren
(brace
id|wm_put
c_func
(paren
id|ice
comma
id|idx
comma
id|nvol
)paren
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
multiline_comment|/*&n; * ADC input mux mixer control&n; */
DECL|function|wm_adc_mux_info
r_static
r_int
id|wm_adc_mux_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_adc_mux_get
r_static
r_int
id|wm_adc_mux_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|bit
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|wm_get
c_func
(paren
id|ice
comma
id|WM_ADC_MUX
)paren
op_amp
(paren
l_int|1
op_lshift
id|bit
)paren
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_adc_mux_put
r_static
r_int
id|wm_adc_mux_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|bit
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
r_int
r_int
id|oval
comma
id|nval
suffix:semicolon
r_int
id|change
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
id|nval
op_assign
id|oval
op_assign
id|wm_get
c_func
(paren
id|ice
comma
id|WM_ADC_MUX
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
id|nval
op_or_assign
(paren
l_int|1
op_lshift
id|bit
)paren
suffix:semicolon
r_else
id|nval
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|bit
)paren
suffix:semicolon
id|change
op_assign
id|nval
op_ne
id|oval
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
(brace
id|wm_put
c_func
(paren
id|ice
comma
id|WM_ADC_MUX
comma
id|nval
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Analog bypass (In -&gt; Out)&n; */
DECL|function|wm_bypass_info
r_static
r_int
id|wm_bypass_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_bypass_get
r_static
r_int
id|wm_bypass_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|wm_get
c_func
(paren
id|ice
comma
id|WM_OUT_MUX
)paren
op_amp
l_int|0x04
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_bypass_put
r_static
r_int
id|wm_bypass_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|val
comma
id|oval
suffix:semicolon
r_int
id|change
op_assign
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
id|val
op_assign
id|oval
op_assign
id|wm_get
c_func
(paren
id|ice
comma
id|WM_OUT_MUX
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
id|val
op_or_assign
l_int|0x04
suffix:semicolon
r_else
id|val
op_and_assign
op_complement
l_int|0x04
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
id|oval
)paren
(brace
id|wm_put
c_func
(paren
id|ice
comma
id|WM_OUT_MUX
comma
id|val
)paren
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
multiline_comment|/*&n; * Left/Right swap&n; */
DECL|function|wm_chswap_info
r_static
r_int
id|wm_chswap_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_chswap_get
r_static
r_int
id|wm_chswap_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|wm_get
c_func
(paren
id|ice
comma
id|WM_DAC_CTRL1
)paren
op_amp
l_int|0xf0
)paren
op_ne
l_int|0x90
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_chswap_put
r_static
r_int
id|wm_chswap_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|val
comma
id|oval
suffix:semicolon
r_int
id|change
op_assign
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
id|oval
op_assign
id|wm_get
c_func
(paren
id|ice
comma
id|WM_DAC_CTRL1
)paren
suffix:semicolon
id|val
op_assign
id|oval
op_amp
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
id|val
op_or_assign
l_int|0x60
suffix:semicolon
r_else
id|val
op_or_assign
l_int|0x90
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
id|oval
)paren
(brace
id|wm_put
c_func
(paren
id|ice
comma
id|WM_DAC_CTRL1
comma
id|val
)paren
suffix:semicolon
id|wm_put_nocache
c_func
(paren
id|ice
comma
id|WM_DAC_CTRL1
comma
id|val
)paren
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
multiline_comment|/*&n; * write data in the SPI mode&n; */
DECL|function|set_gpio_bit
r_static
r_void
id|set_gpio_bit
c_func
(paren
id|ice1712_t
op_star
id|ice
comma
r_int
r_int
id|bit
comma
r_int
id|val
)paren
(brace
r_int
r_int
id|tmp
op_assign
id|snd_ice1712_gpio_read
c_func
(paren
id|ice
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
id|tmp
op_or_assign
id|bit
suffix:semicolon
r_else
id|tmp
op_and_assign
op_complement
id|bit
suffix:semicolon
id|snd_ice1712_gpio_write
c_func
(paren
id|ice
comma
id|tmp
)paren
suffix:semicolon
)brace
DECL|function|spi_send_byte
r_static
r_void
id|spi_send_byte
c_func
(paren
id|ice1712_t
op_star
id|ice
comma
r_int
r_char
id|data
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|set_gpio_bit
c_func
(paren
id|ice
comma
id|PONTIS_CS_CLK
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|set_gpio_bit
c_func
(paren
id|ice
comma
id|PONTIS_CS_WDATA
comma
id|data
op_amp
l_int|0x80
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|set_gpio_bit
c_func
(paren
id|ice
comma
id|PONTIS_CS_CLK
comma
l_int|1
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|data
op_lshift_assign
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|spi_read_byte
r_static
r_int
r_int
id|spi_read_byte
c_func
(paren
id|ice1712_t
op_star
id|ice
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|val
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|val
op_lshift_assign
l_int|1
suffix:semicolon
id|set_gpio_bit
c_func
(paren
id|ice
comma
id|PONTIS_CS_CLK
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_ice1712_gpio_read
c_func
(paren
id|ice
)paren
op_amp
id|PONTIS_CS_RDATA
)paren
id|val
op_or_assign
l_int|1
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|set_gpio_bit
c_func
(paren
id|ice
comma
id|PONTIS_CS_CLK
comma
l_int|1
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_return
id|val
suffix:semicolon
)brace
DECL|function|spi_write
r_static
r_void
id|spi_write
c_func
(paren
id|ice1712_t
op_star
id|ice
comma
r_int
r_int
id|dev
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|data
)paren
(brace
id|snd_ice1712_gpio_set_dir
c_func
(paren
id|ice
comma
id|PONTIS_CS_CS
op_or
id|PONTIS_CS_WDATA
op_or
id|PONTIS_CS_CLK
)paren
suffix:semicolon
id|snd_ice1712_gpio_set_mask
c_func
(paren
id|ice
comma
op_complement
(paren
id|PONTIS_CS_CS
op_or
id|PONTIS_CS_WDATA
op_or
id|PONTIS_CS_CLK
)paren
)paren
suffix:semicolon
id|set_gpio_bit
c_func
(paren
id|ice
comma
id|PONTIS_CS_CS
comma
l_int|0
)paren
suffix:semicolon
id|spi_send_byte
c_func
(paren
id|ice
comma
id|dev
op_amp
op_complement
l_int|1
)paren
suffix:semicolon
multiline_comment|/* WRITE */
id|spi_send_byte
c_func
(paren
id|ice
comma
id|reg
)paren
suffix:semicolon
multiline_comment|/* MAP */
id|spi_send_byte
c_func
(paren
id|ice
comma
id|data
)paren
suffix:semicolon
multiline_comment|/* DATA */
multiline_comment|/* trigger */
id|set_gpio_bit
c_func
(paren
id|ice
comma
id|PONTIS_CS_CS
comma
l_int|1
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* restore */
id|snd_ice1712_gpio_set_mask
c_func
(paren
id|ice
comma
id|ice-&gt;gpio.write_mask
)paren
suffix:semicolon
id|snd_ice1712_gpio_set_dir
c_func
(paren
id|ice
comma
id|ice-&gt;gpio.direction
)paren
suffix:semicolon
)brace
DECL|function|spi_read
r_static
r_int
r_int
id|spi_read
c_func
(paren
id|ice1712_t
op_star
id|ice
comma
r_int
r_int
id|dev
comma
r_int
r_int
id|reg
)paren
(brace
r_int
r_int
id|val
suffix:semicolon
id|snd_ice1712_gpio_set_dir
c_func
(paren
id|ice
comma
id|PONTIS_CS_CS
op_or
id|PONTIS_CS_WDATA
op_or
id|PONTIS_CS_CLK
)paren
suffix:semicolon
id|snd_ice1712_gpio_set_mask
c_func
(paren
id|ice
comma
op_complement
(paren
id|PONTIS_CS_CS
op_or
id|PONTIS_CS_WDATA
op_or
id|PONTIS_CS_CLK
)paren
)paren
suffix:semicolon
id|set_gpio_bit
c_func
(paren
id|ice
comma
id|PONTIS_CS_CS
comma
l_int|0
)paren
suffix:semicolon
id|spi_send_byte
c_func
(paren
id|ice
comma
id|dev
op_amp
op_complement
l_int|1
)paren
suffix:semicolon
multiline_comment|/* WRITE */
id|spi_send_byte
c_func
(paren
id|ice
comma
id|reg
)paren
suffix:semicolon
multiline_comment|/* MAP */
multiline_comment|/* trigger */
id|set_gpio_bit
c_func
(paren
id|ice
comma
id|PONTIS_CS_CS
comma
l_int|1
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|set_gpio_bit
c_func
(paren
id|ice
comma
id|PONTIS_CS_CS
comma
l_int|0
)paren
suffix:semicolon
id|spi_send_byte
c_func
(paren
id|ice
comma
id|dev
op_or
l_int|1
)paren
suffix:semicolon
multiline_comment|/* READ */
id|val
op_assign
id|spi_read_byte
c_func
(paren
id|ice
)paren
suffix:semicolon
multiline_comment|/* trigger */
id|set_gpio_bit
c_func
(paren
id|ice
comma
id|PONTIS_CS_CS
comma
l_int|1
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* restore */
id|snd_ice1712_gpio_set_mask
c_func
(paren
id|ice
comma
id|ice-&gt;gpio.write_mask
)paren
suffix:semicolon
id|snd_ice1712_gpio_set_dir
c_func
(paren
id|ice
comma
id|ice-&gt;gpio.direction
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
multiline_comment|/*&n; * SPDIF input source&n; */
DECL|function|cs_source_info
r_static
r_int
id|cs_source_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_static
r_char
op_star
id|texts
(braket
)braket
op_assign
(brace
l_string|&quot;Coax&quot;
comma
multiline_comment|/* RXP0 */
l_string|&quot;Optical&quot;
comma
multiline_comment|/* RXP1 */
l_string|&quot;CD&quot;
comma
multiline_comment|/* RXP2 */
)brace
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_ENUMERATED
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.enumerated.items
op_assign
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|uinfo-&gt;value.enumerated.item
op_ge
id|uinfo-&gt;value.enumerated.items
)paren
id|uinfo-&gt;value.enumerated.item
op_assign
id|uinfo-&gt;value.enumerated.items
op_minus
l_int|1
suffix:semicolon
id|strcpy
c_func
(paren
id|uinfo-&gt;value.enumerated.name
comma
id|texts
(braket
id|uinfo-&gt;value.enumerated.item
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs_source_get
r_static
r_int
id|cs_source_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
op_assign
id|ice-&gt;gpio.saved
(braket
l_int|0
)braket
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs_source_put
r_static
r_int
id|cs_source_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_char
id|val
suffix:semicolon
r_int
id|change
op_assign
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
op_ne
id|ice-&gt;gpio.saved
(braket
l_int|0
)braket
)paren
(brace
id|ice-&gt;gpio.saved
(braket
l_int|0
)braket
op_assign
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
op_amp
l_int|3
suffix:semicolon
id|val
op_assign
l_int|0x80
op_or
(paren
id|ice-&gt;gpio.saved
(braket
l_int|0
)braket
op_lshift
l_int|3
)paren
suffix:semicolon
id|spi_write
c_func
(paren
id|ice
comma
id|CS_DEV
comma
l_int|0x04
comma
id|val
)paren
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * GPIO controls&n; */
DECL|function|pontis_gpio_mask_info
r_static
r_int
id|pontis_gpio_mask_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|0xffff
suffix:semicolon
multiline_comment|/* 16bit */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pontis_gpio_mask_get
r_static
r_int
id|pontis_gpio_mask_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
multiline_comment|/* 4-7 reserved */
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
op_complement
id|ice-&gt;gpio.write_mask
op_amp
l_int|0xffff
)paren
op_or
l_int|0x00f0
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pontis_gpio_mask_put
r_static
r_int
id|pontis_gpio_mask_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|changed
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
multiline_comment|/* 4-7 reserved */
id|val
op_assign
(paren
op_complement
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|0xffff
)paren
op_or
l_int|0x00f0
suffix:semicolon
id|changed
op_assign
id|val
op_ne
id|ice-&gt;gpio.write_mask
suffix:semicolon
id|ice-&gt;gpio.write_mask
op_assign
id|val
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
id|changed
suffix:semicolon
)brace
DECL|function|pontis_gpio_dir_get
r_static
r_int
id|pontis_gpio_dir_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
multiline_comment|/* 4-7 reserved */
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|ice-&gt;gpio.direction
op_amp
l_int|0xff0f
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pontis_gpio_dir_put
r_static
r_int
id|pontis_gpio_dir_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|changed
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
multiline_comment|/* 4-7 reserved */
id|val
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|0xff0f
suffix:semicolon
id|changed
op_assign
(paren
id|val
op_ne
id|ice-&gt;gpio.direction
)paren
suffix:semicolon
id|ice-&gt;gpio.direction
op_assign
id|val
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
id|changed
suffix:semicolon
)brace
DECL|function|pontis_gpio_data_get
r_static
r_int
id|pontis_gpio_data_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
id|snd_ice1712_gpio_set_dir
c_func
(paren
id|ice
comma
id|ice-&gt;gpio.direction
)paren
suffix:semicolon
id|snd_ice1712_gpio_set_mask
c_func
(paren
id|ice
comma
id|ice-&gt;gpio.write_mask
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|snd_ice1712_gpio_read
c_func
(paren
id|ice
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pontis_gpio_data_put
r_static
r_int
id|pontis_gpio_data_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|val
comma
id|nval
suffix:semicolon
r_int
id|changed
op_assign
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
id|snd_ice1712_gpio_set_dir
c_func
(paren
id|ice
comma
id|ice-&gt;gpio.direction
)paren
suffix:semicolon
id|snd_ice1712_gpio_set_mask
c_func
(paren
id|ice
comma
id|ice-&gt;gpio.write_mask
)paren
suffix:semicolon
id|val
op_assign
id|snd_ice1712_gpio_read
c_func
(paren
id|ice
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|nval
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
id|nval
)paren
(brace
id|snd_ice1712_gpio_write
c_func
(paren
id|ice
comma
id|nval
)paren
suffix:semicolon
id|changed
op_assign
l_int|1
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
id|changed
suffix:semicolon
)brace
multiline_comment|/*&n; * mixers&n; */
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|pontis_controls
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;PCM Playback Volume&quot;
comma
dot
id|info
op_assign
id|wm_dac_vol_info
comma
dot
id|get
op_assign
id|wm_dac_vol_get
comma
dot
id|put
op_assign
id|wm_dac_vol_put
comma
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Capture Volume&quot;
comma
dot
id|info
op_assign
id|wm_adc_vol_info
comma
dot
id|get
op_assign
id|wm_adc_vol_get
comma
dot
id|put
op_assign
id|wm_adc_vol_put
comma
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;CD Capture Switch&quot;
comma
dot
id|info
op_assign
id|wm_adc_mux_info
comma
dot
id|get
op_assign
id|wm_adc_mux_get
comma
dot
id|put
op_assign
id|wm_adc_mux_put
comma
dot
id|private_value
op_assign
l_int|0
comma
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Line Capture Switch&quot;
comma
dot
id|info
op_assign
id|wm_adc_mux_info
comma
dot
id|get
op_assign
id|wm_adc_mux_get
comma
dot
id|put
op_assign
id|wm_adc_mux_put
comma
dot
id|private_value
op_assign
l_int|1
comma
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Analog Bypass Switch&quot;
comma
dot
id|info
op_assign
id|wm_bypass_info
comma
dot
id|get
op_assign
id|wm_bypass_get
comma
dot
id|put
op_assign
id|wm_bypass_put
comma
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Swap Output Channels&quot;
comma
dot
id|info
op_assign
id|wm_chswap_info
comma
dot
id|get
op_assign
id|wm_chswap_get
comma
dot
id|put
op_assign
id|wm_chswap_put
comma
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;IEC958 Input Source&quot;
comma
dot
id|info
op_assign
id|cs_source_info
comma
dot
id|get
op_assign
id|cs_source_get
comma
dot
id|put
op_assign
id|cs_source_put
comma
)brace
comma
multiline_comment|/* FIXME: which interface? */
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_CARD
comma
dot
id|name
op_assign
l_string|&quot;GPIO Mask&quot;
comma
dot
id|info
op_assign
id|pontis_gpio_mask_info
comma
dot
id|get
op_assign
id|pontis_gpio_mask_get
comma
dot
id|put
op_assign
id|pontis_gpio_mask_put
comma
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_CARD
comma
dot
id|name
op_assign
l_string|&quot;GPIO Direction&quot;
comma
dot
id|info
op_assign
id|pontis_gpio_mask_info
comma
dot
id|get
op_assign
id|pontis_gpio_dir_get
comma
dot
id|put
op_assign
id|pontis_gpio_dir_put
comma
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_CARD
comma
dot
id|name
op_assign
l_string|&quot;GPIO Data&quot;
comma
dot
id|info
op_assign
id|pontis_gpio_mask_info
comma
dot
id|get
op_assign
id|pontis_gpio_data_get
comma
dot
id|put
op_assign
id|pontis_gpio_data_put
comma
)brace
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * WM codec registers&n; */
DECL|function|wm_proc_regs_write
r_static
r_void
id|wm_proc_regs_write
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
(paren
id|ice1712_t
op_star
)paren
id|entry-&gt;private_data
suffix:semicolon
r_char
id|line
(braket
l_int|64
)braket
suffix:semicolon
r_int
r_int
id|reg
comma
id|val
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|snd_info_get_line
c_func
(paren
id|buffer
comma
id|line
comma
r_sizeof
(paren
id|line
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|sscanf
c_func
(paren
id|line
comma
l_string|&quot;%x %x&quot;
comma
op_amp
id|reg
comma
op_amp
id|val
)paren
op_ne
l_int|2
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_le
l_int|0x17
op_logical_and
id|val
op_le
l_int|0xffff
)paren
id|wm_put
c_func
(paren
id|ice
comma
id|reg
comma
id|val
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
)brace
DECL|function|wm_proc_regs_read
r_static
r_void
id|wm_proc_regs_read
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
(paren
id|ice1712_t
op_star
)paren
id|entry-&gt;private_data
suffix:semicolon
r_int
id|reg
comma
id|val
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_for
c_loop
(paren
id|reg
op_assign
l_int|0
suffix:semicolon
id|reg
op_le
l_int|0x17
suffix:semicolon
id|reg
op_increment
)paren
(brace
id|val
op_assign
id|wm_get
c_func
(paren
id|ice
comma
id|reg
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%02x = %04x&bslash;n&quot;
comma
id|reg
comma
id|val
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
)brace
DECL|function|wm_proc_init
r_static
r_void
id|wm_proc_init
c_func
(paren
id|ice1712_t
op_star
id|ice
)paren
(brace
id|snd_info_entry_t
op_star
id|entry
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_card_proc_new
c_func
(paren
id|ice-&gt;card
comma
l_string|&quot;wm_codec&quot;
comma
op_amp
id|entry
)paren
)paren
(brace
id|snd_info_set_text_ops
c_func
(paren
id|entry
comma
id|ice
comma
l_int|1024
comma
id|wm_proc_regs_read
)paren
suffix:semicolon
id|entry-&gt;mode
op_or_assign
id|S_IWUSR
suffix:semicolon
id|entry-&gt;c.text.write_size
op_assign
l_int|1024
suffix:semicolon
id|entry-&gt;c.text.write
op_assign
id|wm_proc_regs_write
suffix:semicolon
)brace
)brace
DECL|function|cs_proc_regs_read
r_static
r_void
id|cs_proc_regs_read
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
(paren
id|ice1712_t
op_star
)paren
id|entry-&gt;private_data
suffix:semicolon
r_int
id|reg
comma
id|val
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_for
c_loop
(paren
id|reg
op_assign
l_int|0
suffix:semicolon
id|reg
op_le
l_int|0x26
suffix:semicolon
id|reg
op_increment
)paren
(brace
id|val
op_assign
id|spi_read
c_func
(paren
id|ice
comma
id|CS_DEV
comma
id|reg
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%02x = %02x&bslash;n&quot;
comma
id|reg
comma
id|val
)paren
suffix:semicolon
)brace
id|val
op_assign
id|spi_read
c_func
(paren
id|ice
comma
id|CS_DEV
comma
l_int|0x7f
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%02x = %02x&bslash;n&quot;
comma
l_int|0x7f
comma
id|val
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
)brace
DECL|function|cs_proc_init
r_static
r_void
id|cs_proc_init
c_func
(paren
id|ice1712_t
op_star
id|ice
)paren
(brace
id|snd_info_entry_t
op_star
id|entry
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_card_proc_new
c_func
(paren
id|ice-&gt;card
comma
l_string|&quot;cs_codec&quot;
comma
op_amp
id|entry
)paren
)paren
(brace
id|snd_info_set_text_ops
c_func
(paren
id|entry
comma
id|ice
comma
l_int|1024
comma
id|cs_proc_regs_read
)paren
suffix:semicolon
)brace
)brace
DECL|function|pontis_add_controls
r_static
r_int
id|__devinit
id|pontis_add_controls
c_func
(paren
id|ice1712_t
op_star
id|ice
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_int
id|err
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|pontis_controls
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|ice-&gt;card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|pontis_controls
(braket
id|i
)braket
comma
id|ice
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
id|wm_proc_init
c_func
(paren
id|ice
)paren
suffix:semicolon
id|cs_proc_init
c_func
(paren
id|ice
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * initialize the chip&n; */
DECL|function|pontis_init
r_static
r_int
id|__devinit
id|pontis_init
c_func
(paren
id|ice1712_t
op_star
id|ice
)paren
(brace
r_static
r_int
r_int
id|wm_inits
(braket
)braket
op_assign
(brace
multiline_comment|/* These come first to reduce init pop noise */
id|WM_ADC_MUX
comma
l_int|0x00c0
comma
multiline_comment|/* ADC mute */
id|WM_DAC_MUTE
comma
l_int|0x0001
comma
multiline_comment|/* DAC softmute */
id|WM_DAC_CTRL1
comma
l_int|0x0000
comma
multiline_comment|/* DAC mute */
id|WM_POWERDOWN
comma
l_int|0x0008
comma
multiline_comment|/* All power-up except HP */
id|WM_RESET
comma
l_int|0x0000
comma
multiline_comment|/* reset */
)brace
suffix:semicolon
r_static
r_int
r_int
id|wm_inits2
(braket
)braket
op_assign
(brace
id|WM_MASTER_CTRL
comma
l_int|0x0022
comma
multiline_comment|/* 256fs, slave mode */
id|WM_DAC_INT
comma
l_int|0x0022
comma
multiline_comment|/* I2S, normal polarity, 24bit */
id|WM_ADC_INT
comma
l_int|0x0022
comma
multiline_comment|/* I2S, normal polarity, 24bit */
id|WM_DAC_CTRL1
comma
l_int|0x0090
comma
multiline_comment|/* DAC L/R */
id|WM_OUT_MUX
comma
l_int|0x0001
comma
multiline_comment|/* OUT DAC */
id|WM_HP_ATTEN_L
comma
l_int|0x0179
comma
multiline_comment|/* HP 0dB */
id|WM_HP_ATTEN_R
comma
l_int|0x0179
comma
multiline_comment|/* HP 0dB */
id|WM_DAC_ATTEN_L
comma
l_int|0x0000
comma
multiline_comment|/* DAC 0dB */
id|WM_DAC_ATTEN_L
comma
l_int|0x0100
comma
multiline_comment|/* DAC 0dB */
id|WM_DAC_ATTEN_R
comma
l_int|0x0000
comma
multiline_comment|/* DAC 0dB */
id|WM_DAC_ATTEN_R
comma
l_int|0x0100
comma
multiline_comment|/* DAC 0dB */
singleline_comment|// WM_DAC_MASTER,&t;0x0100,&t;/* DAC master muted */
id|WM_PHASE_SWAP
comma
l_int|0x0000
comma
multiline_comment|/* phase normal */
id|WM_DAC_CTRL2
comma
l_int|0x0000
comma
multiline_comment|/* no deemphasis, no ZFLG */
id|WM_ADC_ATTEN_L
comma
l_int|0x0000
comma
multiline_comment|/* ADC muted */
id|WM_ADC_ATTEN_R
comma
l_int|0x0000
comma
multiline_comment|/* ADC muted */
macro_line|#if 0
id|WM_ALC_CTRL1
comma
l_int|0x007b
comma
multiline_comment|/* */
id|WM_ALC_CTRL2
comma
l_int|0x0000
comma
multiline_comment|/* */
id|WM_ALC_CTRL3
comma
l_int|0x0000
comma
multiline_comment|/* */
id|WM_NOISE_GATE
comma
l_int|0x0000
comma
multiline_comment|/* */
macro_line|#endif
id|WM_DAC_MUTE
comma
l_int|0x0000
comma
multiline_comment|/* DAC unmute */
id|WM_ADC_MUX
comma
l_int|0x0003
comma
multiline_comment|/* ADC unmute, both CD/Line On */
)brace
suffix:semicolon
r_static
r_int
r_char
id|cs_inits
(braket
)braket
op_assign
(brace
l_int|0x04
comma
l_int|0x80
comma
multiline_comment|/* RUN, RXP0 */
l_int|0x05
comma
l_int|0x05
comma
multiline_comment|/* slave, 24bit */
l_int|0x01
comma
l_int|0x00
comma
l_int|0x02
comma
l_int|0x00
comma
l_int|0x03
comma
l_int|0x00
comma
)brace
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
id|ice-&gt;vt1720
op_assign
l_int|1
suffix:semicolon
id|ice-&gt;num_total_dacs
op_assign
l_int|2
suffix:semicolon
id|ice-&gt;num_total_adcs
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* to remeber the register values */
id|ice-&gt;akm
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
id|akm4xxx_t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ice-&gt;akm
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|ice-&gt;akm_codecs
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* HACK - use this as the SPDIF source.&n;&t; * don&squot;t call snd_ice1712_gpio_get/put(), otherwise it&squot;s overwritten&n;&t; */
id|ice-&gt;gpio.saved
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* initialize WM8776 codec */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|wm_inits
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
id|wm_put
c_func
(paren
id|ice
comma
id|wm_inits
(braket
id|i
)braket
comma
id|wm_inits
(braket
id|i
op_plus
l_int|1
)braket
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|wm_inits2
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
id|wm_put
c_func
(paren
id|ice
comma
id|wm_inits2
(braket
id|i
)braket
comma
id|wm_inits2
(braket
id|i
op_plus
l_int|1
)braket
)paren
suffix:semicolon
multiline_comment|/* initialize CS8416 codec */
multiline_comment|/* assert PRST#; MT05 bit 7 */
id|outb
c_func
(paren
id|inb
c_func
(paren
id|ICEMT1724
c_func
(paren
id|ice
comma
id|AC97_CMD
)paren
)paren
op_or
l_int|0x80
comma
id|ICEMT1724
c_func
(paren
id|ice
comma
id|AC97_CMD
)paren
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
multiline_comment|/* deassert PRST# */
id|outb
c_func
(paren
id|inb
c_func
(paren
id|ICEMT1724
c_func
(paren
id|ice
comma
id|AC97_CMD
)paren
)paren
op_amp
op_complement
l_int|0x80
comma
id|ICEMT1724
c_func
(paren
id|ice
comma
id|AC97_CMD
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|cs_inits
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
id|spi_write
c_func
(paren
id|ice
comma
id|CS_DEV
comma
id|cs_inits
(braket
id|i
)braket
comma
id|cs_inits
(braket
id|i
op_plus
l_int|1
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Pontis boards don&squot;t provide the EEPROM data at all.&n; * hence the driver needs to sets up it properly.&n; */
DECL|variable|__devinitdata
r_static
r_int
r_char
id|pontis_eeprom
(braket
)braket
id|__devinitdata
op_assign
(brace
l_int|0x08
comma
multiline_comment|/* SYSCONF: clock 256, mpu401, spdif-in/ADC, 1DAC */
l_int|0x80
comma
multiline_comment|/* ACLINK: I2S */
l_int|0xf8
comma
multiline_comment|/* I2S: vol, 96k, 24bit, 192k */
l_int|0xc3
comma
multiline_comment|/* SPDIF: out-en, out-int, spdif-in */
l_int|0x07
comma
multiline_comment|/* GPIO_DIR */
l_int|0x00
comma
multiline_comment|/* GPIO_DIR1 */
l_int|0x00
comma
multiline_comment|/* GPIO_DIR2 (ignored) */
l_int|0x0f
comma
multiline_comment|/* GPIO_MASK (4-7 reserved for CS8416) */
l_int|0xff
comma
multiline_comment|/* GPIO_MASK1 */
l_int|0x00
comma
multiline_comment|/* GPIO_MASK2 (ignored) */
l_int|0x06
comma
multiline_comment|/* GPIO_STATE (0-low, 1-high, 2-high) */
l_int|0x00
comma
multiline_comment|/* GPIO_STATE1 */
l_int|0x00
comma
multiline_comment|/* GPIO_STATE2 (ignored) */
)brace
suffix:semicolon
multiline_comment|/* entry point */
DECL|variable|__devinitdata
r_struct
id|snd_ice1712_card_info
id|snd_vt1720_pontis_cards
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
dot
id|subvendor
op_assign
id|VT1720_SUBDEVICE_PONTIS_MS300
comma
dot
id|name
op_assign
l_string|&quot;Pontis MS300&quot;
comma
dot
id|model
op_assign
l_string|&quot;ms300&quot;
comma
dot
id|chip_init
op_assign
id|pontis_init
comma
dot
id|build_controls
op_assign
id|pontis_add_controls
comma
dot
id|eeprom_size
op_assign
r_sizeof
(paren
id|pontis_eeprom
)paren
comma
dot
id|eeprom_data
op_assign
id|pontis_eeprom
comma
)brace
comma
(brace
)brace
multiline_comment|/* terminator */
)brace
suffix:semicolon
eof
