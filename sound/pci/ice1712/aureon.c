multiline_comment|/*&n; *   ALSA driver for ICEnsemble VT1724 (Envy24HT)&n; *&n; *   Lowlevel functions for Terratec Aureon cards&n; *&n; *&t;Copyright (c) 2003 Takashi Iwai &lt;tiwai@suse.de&gt;&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; *&n; * NOTES:&n; *&n; * - we reuse the akm4xxx_t record for storing the wm8770 codec data.&n; *   both wm and akm codecs are pretty similar, so we can integrate&n; *   both controls in the future, once if wm codecs are reused in&n; *   many boards.&n; *&n; * - writing over SPI is implemented but reading is not yet.&n; *   the SPDIF-in channel status, etc. can be read from CS chip.&n; *&n; * - DAC digital volumes are not implemented in the mixer.&n; *   if they show better response than DAC analog volumes, we can use them&n; *   instead.&n; *&n; * - Aureon boards are equipped with AC97 codec, too.  it&squot;s used to do&n; *   the analog mixing but not easily controllable (it&squot;s not connected&n; *   directly from envy24ht chip).  so let&squot;s leave it as it is.&n; *&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &quot;ice1712.h&quot;
macro_line|#include &quot;envy24ht.h&quot;
macro_line|#include &quot;aureon.h&quot;
multiline_comment|/* WM8770 registers */
DECL|macro|WM_DAC_ATTEN
mdefine_line|#define WM_DAC_ATTEN&t;&t;0x00&t;/* DAC1-8 analog attenuation */
DECL|macro|WM_DAC_MASTER_ATTEN
mdefine_line|#define WM_DAC_MASTER_ATTEN&t;0x08&t;/* DAC master analog attenuation */
DECL|macro|WM_DAC_DIG_ATTEN
mdefine_line|#define WM_DAC_DIG_ATTEN&t;0x09&t;/* DAC1-8 digital attenuation */
DECL|macro|WM_DAC_DIG_MATER_ATTEN
mdefine_line|#define WM_DAC_DIG_MATER_ATTEN&t;0x11&t;/* DAC master digital attenuation */
DECL|macro|WM_PHASE_SWAP
mdefine_line|#define WM_PHASE_SWAP&t;&t;0x12&t;/* DAC phase */
DECL|macro|WM_DAC_CTRL1
mdefine_line|#define WM_DAC_CTRL1&t;&t;0x13&t;/* DAC control bits */
DECL|macro|WM_MUTE
mdefine_line|#define WM_MUTE&t;&t;&t;0x14&t;/* mute controls */
DECL|macro|WM_DAC_CTRL2
mdefine_line|#define WM_DAC_CTRL2&t;&t;0x15&t;/* de-emphasis and zefo-flag */
DECL|macro|WM_INT_CTRL
mdefine_line|#define WM_INT_CTRL&t;&t;0x16&t;/* interface control */
DECL|macro|WM_MASTER
mdefine_line|#define WM_MASTER&t;&t;0x17&t;/* master clock and mode */
DECL|macro|WM_POWERDOWN
mdefine_line|#define WM_POWERDOWN&t;&t;0x18&t;/* power-down controls */
DECL|macro|WM_ADC_GAIN
mdefine_line|#define WM_ADC_GAIN&t;&t;0x19&t;/* ADC gain L(19)/R(1a) */
DECL|macro|WM_ADC_MUX
mdefine_line|#define WM_ADC_MUX&t;&t;0x1b&t;/* input MUX */
DECL|macro|WM_OUT_MUX1
mdefine_line|#define WM_OUT_MUX1&t;&t;0x1c&t;/* output MUX */
DECL|macro|WM_OUT_MUX2
mdefine_line|#define WM_OUT_MUX2&t;&t;0x1e&t;/* output MUX */
DECL|macro|WM_RESET
mdefine_line|#define WM_RESET&t;&t;0x1f&t;/* software reset */
multiline_comment|/*&n; * write data in the SPI mode&n; */
DECL|function|aureon_spi_write
r_static
r_void
id|aureon_spi_write
c_func
(paren
id|ice1712_t
op_star
id|ice
comma
r_int
r_int
id|cs
comma
r_int
r_int
id|data
comma
r_int
id|bits
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
r_int
id|i
suffix:semicolon
id|tmp
op_assign
id|snd_ice1712_gpio_read
c_func
(paren
id|ice
)paren
suffix:semicolon
id|snd_ice1712_gpio_set_mask
c_func
(paren
id|ice
comma
op_complement
(paren
id|AUREON_WM_RW
op_or
id|AUREON_WM_DATA
op_or
id|AUREON_WM_CLK
op_or
id|AUREON_WM_CS
op_or
id|AUREON_CS8415_CS
)paren
)paren
suffix:semicolon
id|tmp
op_or_assign
id|AUREON_WM_RW
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|cs
suffix:semicolon
id|snd_ice1712_gpio_write
c_func
(paren
id|ice
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|bits
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|tmp
op_and_assign
op_complement
id|AUREON_WM_CLK
suffix:semicolon
id|snd_ice1712_gpio_write
c_func
(paren
id|ice
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
id|tmp
op_or_assign
id|AUREON_WM_DATA
suffix:semicolon
r_else
id|tmp
op_and_assign
op_complement
id|AUREON_WM_DATA
suffix:semicolon
id|snd_ice1712_gpio_write
c_func
(paren
id|ice
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|tmp
op_or_assign
id|AUREON_WM_CLK
suffix:semicolon
id|snd_ice1712_gpio_write
c_func
(paren
id|ice
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
id|tmp
op_and_assign
op_complement
id|AUREON_WM_CLK
suffix:semicolon
id|tmp
op_or_assign
id|cs
suffix:semicolon
id|snd_ice1712_gpio_write
c_func
(paren
id|ice
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|tmp
op_or_assign
id|AUREON_WM_CLK
suffix:semicolon
id|snd_ice1712_gpio_write
c_func
(paren
id|ice
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * get the current register value of WM codec&n; */
DECL|function|wm_get
r_static
r_int
r_int
id|wm_get
c_func
(paren
id|ice1712_t
op_star
id|ice
comma
r_int
id|reg
)paren
(brace
id|reg
op_lshift_assign
l_int|1
suffix:semicolon
r_return
(paren
(paren
r_int
r_int
)paren
id|ice-&gt;akm
(braket
l_int|0
)braket
dot
id|images
(braket
id|reg
)braket
op_lshift
l_int|8
)paren
op_or
id|ice-&gt;akm
(braket
l_int|0
)braket
dot
id|images
(braket
id|reg
op_plus
l_int|1
)braket
suffix:semicolon
)brace
multiline_comment|/*&n; * set the register value of WM codec and remember it&n; */
DECL|function|wm_put
r_static
r_void
id|wm_put
c_func
(paren
id|ice1712_t
op_star
id|ice
comma
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
id|aureon_spi_write
c_func
(paren
id|ice
comma
id|AUREON_WM_CS
comma
(paren
id|reg
op_lshift
l_int|9
)paren
op_or
(paren
id|val
op_amp
l_int|0x1ff
)paren
comma
l_int|16
)paren
suffix:semicolon
id|reg
op_lshift_assign
l_int|1
suffix:semicolon
id|ice-&gt;akm
(braket
l_int|0
)braket
dot
id|images
(braket
id|reg
)braket
op_assign
id|val
op_rshift
l_int|8
suffix:semicolon
id|ice-&gt;akm
(braket
l_int|0
)braket
dot
id|images
(braket
id|reg
op_plus
l_int|1
)braket
op_assign
id|val
suffix:semicolon
)brace
multiline_comment|/*&n; * DAC volume attenuation mixer control&n; */
DECL|function|wm_dac_vol_info
r_static
r_int
id|wm_dac_vol_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* mute */
id|uinfo-&gt;value.integer.max
op_assign
l_int|101
suffix:semicolon
multiline_comment|/* 0dB */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_dac_vol_get
r_static
r_int
id|wm_dac_vol_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|idx
suffix:semicolon
r_int
r_int
id|vol
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kcontrol-&gt;private_value
)paren
id|idx
op_assign
id|WM_DAC_MASTER_ATTEN
suffix:semicolon
r_else
id|idx
op_assign
id|snd_ctl_get_ioffidx
c_func
(paren
id|kcontrol
comma
op_amp
id|ucontrol-&gt;id
)paren
op_plus
id|WM_DAC_ATTEN
suffix:semicolon
id|vol
op_assign
id|wm_get
c_func
(paren
id|ice
comma
id|idx
)paren
op_amp
l_int|0x7f
suffix:semicolon
r_if
c_cond
(paren
id|vol
op_le
l_int|0x1a
)paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_else
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|vol
op_minus
l_int|0x1a
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_dac_vol_put
r_static
r_int
id|wm_dac_vol_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|idx
suffix:semicolon
r_int
r_int
id|ovol
comma
id|nvol
suffix:semicolon
r_int
id|change
suffix:semicolon
id|snd_ice1712_save_gpio_status
c_func
(paren
id|ice
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kcontrol-&gt;private_value
)paren
id|idx
op_assign
id|WM_DAC_MASTER_ATTEN
suffix:semicolon
r_else
id|idx
op_assign
id|snd_ctl_get_ioffidx
c_func
(paren
id|kcontrol
comma
op_amp
id|ucontrol-&gt;id
)paren
op_plus
id|WM_DAC_ATTEN
suffix:semicolon
id|nvol
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_plus
l_int|0x1a
suffix:semicolon
id|ovol
op_assign
id|wm_get
c_func
(paren
id|ice
comma
id|idx
)paren
op_amp
l_int|0x7f
suffix:semicolon
id|change
op_assign
(paren
id|ovol
op_ne
id|nvol
)paren
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
(brace
r_if
c_cond
(paren
id|nvol
op_le
l_int|0x1a
op_logical_and
id|ovol
op_le
l_int|0x1a
)paren
id|change
op_assign
l_int|0
suffix:semicolon
r_else
id|wm_put
c_func
(paren
id|ice
comma
id|idx
comma
id|nvol
op_or
l_int|0x100
)paren
suffix:semicolon
)brace
id|snd_ice1712_restore_gpio_status
c_func
(paren
id|ice
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
multiline_comment|/*&n; * ADC gain mixer control&n; */
DECL|function|wm_adc_vol_info
r_static
r_int
id|wm_adc_vol_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* -12dB */
id|uinfo-&gt;value.integer.max
op_assign
l_int|0x1f
suffix:semicolon
multiline_comment|/* 19dB */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_adc_vol_get
r_static
r_int
id|wm_adc_vol_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|idx
suffix:semicolon
r_int
r_int
id|vol
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
id|idx
op_assign
id|snd_ctl_get_ioffidx
c_func
(paren
id|kcontrol
comma
op_amp
id|ucontrol-&gt;id
)paren
op_plus
id|WM_ADC_GAIN
suffix:semicolon
id|vol
op_assign
id|wm_get
c_func
(paren
id|ice
comma
id|idx
)paren
op_amp
l_int|0x1f
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|vol
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_adc_vol_put
r_static
r_int
id|wm_adc_vol_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|idx
suffix:semicolon
r_int
r_int
id|ovol
comma
id|nvol
suffix:semicolon
r_int
id|change
suffix:semicolon
id|snd_ice1712_save_gpio_status
c_func
(paren
id|ice
)paren
suffix:semicolon
id|idx
op_assign
id|snd_ctl_get_ioffidx
c_func
(paren
id|kcontrol
comma
op_amp
id|ucontrol-&gt;id
)paren
op_plus
id|WM_ADC_GAIN
suffix:semicolon
id|nvol
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
suffix:semicolon
id|ovol
op_assign
id|wm_get
c_func
(paren
id|ice
comma
id|idx
)paren
op_amp
l_int|0x1f
suffix:semicolon
id|change
op_assign
(paren
id|ovol
op_ne
id|nvol
)paren
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
id|wm_put
c_func
(paren
id|ice
comma
id|idx
comma
id|nvol
)paren
suffix:semicolon
id|snd_ice1712_restore_gpio_status
c_func
(paren
id|ice
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
multiline_comment|/*&n; * ADC input mux mixer control&n; */
DECL|function|wm_adc_mux_info
r_static
r_int
id|wm_adc_mux_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_static
r_char
op_star
id|texts
(braket
)braket
op_assign
(brace
l_string|&quot;CD Left&quot;
comma
l_string|&quot;CD Right&quot;
comma
l_string|&quot;Aux Left&quot;
comma
l_string|&quot;Aux Right&quot;
comma
l_string|&quot;Line Left&quot;
comma
l_string|&quot;Line Right&quot;
comma
l_string|&quot;Mic Left&quot;
comma
l_string|&quot;Mic Right&quot;
comma
)brace
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_ENUMERATED
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.enumerated.items
op_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|uinfo-&gt;value.enumerated.item
op_ge
id|uinfo-&gt;value.enumerated.items
)paren
id|uinfo-&gt;value.enumerated.item
op_assign
id|uinfo-&gt;value.enumerated.items
op_minus
l_int|1
suffix:semicolon
id|strcpy
c_func
(paren
id|uinfo-&gt;value.enumerated.name
comma
id|texts
(braket
id|uinfo-&gt;value.enumerated.item
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_adc_mux_get
r_static
r_int
id|wm_adc_mux_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
id|val
op_assign
id|wm_get
c_func
(paren
id|ice
comma
id|WM_ADC_MUX
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|val
op_amp
l_int|7
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
(paren
id|val
op_rshift
l_int|4
)paren
op_amp
l_int|7
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ice-&gt;gpio_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|wm_adc_mux_put
r_static
r_int
id|wm_adc_mux_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ice1712_t
op_star
id|ice
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|oval
comma
id|nval
suffix:semicolon
r_int
id|change
suffix:semicolon
id|snd_ice1712_save_gpio_status
c_func
(paren
id|ice
)paren
suffix:semicolon
id|oval
op_assign
id|wm_get
c_func
(paren
id|ice
comma
id|WM_ADC_MUX
)paren
suffix:semicolon
id|nval
op_assign
id|oval
op_amp
op_complement
l_int|0x77
suffix:semicolon
id|nval
op_or_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|7
suffix:semicolon
id|nval
op_or_assign
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_amp
l_int|7
)paren
op_lshift
l_int|4
suffix:semicolon
id|change
op_assign
(paren
id|oval
op_ne
id|nval
)paren
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
id|wm_put
c_func
(paren
id|ice
comma
id|WM_ADC_MUX
comma
id|nval
)paren
suffix:semicolon
id|snd_ice1712_restore_gpio_status
c_func
(paren
id|ice
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * mixers&n; */
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|aureon51_dac_control
id|__devinitdata
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;DAC Volume&quot;
comma
dot
id|count
op_assign
l_int|6
comma
dot
id|info
op_assign
id|wm_dac_vol_info
comma
dot
id|get
op_assign
id|wm_dac_vol_get
comma
dot
id|put
op_assign
id|wm_dac_vol_put
comma
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|aureon71_dac_control
id|__devinitdata
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;DAC Volume&quot;
comma
dot
id|count
op_assign
l_int|8
comma
dot
id|info
op_assign
id|wm_dac_vol_info
comma
dot
id|get
op_assign
id|wm_dac_vol_get
comma
dot
id|put
op_assign
id|wm_dac_vol_put
comma
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|wm_controls
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Master Playback Volume&quot;
comma
dot
id|info
op_assign
id|wm_dac_vol_info
comma
dot
id|get
op_assign
id|wm_dac_vol_get
comma
dot
id|put
op_assign
id|wm_dac_vol_put
comma
dot
id|private_value
op_assign
l_int|1
comma
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;ADC Volume&quot;
comma
dot
id|count
op_assign
l_int|2
comma
dot
id|info
op_assign
id|wm_adc_vol_info
comma
dot
id|get
op_assign
id|wm_adc_vol_get
comma
dot
id|put
op_assign
id|wm_adc_vol_put
comma
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Capture Route&quot;
comma
dot
id|info
op_assign
id|wm_adc_mux_info
comma
dot
id|get
op_assign
id|wm_adc_mux_get
comma
dot
id|put
op_assign
id|wm_adc_mux_put
comma
)brace
comma
)brace
suffix:semicolon
DECL|function|aureon_add_controls
r_static
r_int
id|__devinit
id|aureon_add_controls
c_func
(paren
id|ice1712_t
op_star
id|ice
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|ice-&gt;eeprom.subvendor
op_eq
id|VT1724_SUBDEVICE_AUREON51_SKY
)paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|ice-&gt;card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|aureon51_dac_control
comma
id|ice
)paren
)paren
suffix:semicolon
r_else
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|ice-&gt;card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|aureon71_dac_control
comma
id|ice
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|wm_controls
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|ice-&gt;card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|wm_controls
(braket
id|i
)braket
comma
id|ice
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * initialize the chip&n; */
DECL|function|aureon_init
r_static
r_int
id|__devinit
id|aureon_init
c_func
(paren
id|ice1712_t
op_star
id|ice
)paren
(brace
r_static
r_int
r_int
id|wm_inits
(braket
)braket
op_assign
(brace
l_int|0x16
comma
l_int|0x122
comma
multiline_comment|/* I2S, normal polarity, 24bit */
l_int|0x17
comma
l_int|0x022
comma
multiline_comment|/* 256fs, slave mode */
l_int|0x18
comma
l_int|0x000
comma
multiline_comment|/* All power-up */
l_int|0x00
comma
l_int|0
comma
multiline_comment|/* DAC1 analog mute */
l_int|0x01
comma
l_int|0
comma
multiline_comment|/* DAC2 analog mute */
l_int|0x02
comma
l_int|0
comma
multiline_comment|/* DAC3 analog mute */
l_int|0x03
comma
l_int|0
comma
multiline_comment|/* DAC4 analog mute */
l_int|0x04
comma
l_int|0
comma
multiline_comment|/* DAC5 analog mute */
l_int|0x05
comma
l_int|0
comma
multiline_comment|/* DAC6 analog mute */
l_int|0x06
comma
l_int|0
comma
multiline_comment|/* DAC7 analog mute */
l_int|0x07
comma
l_int|0
comma
multiline_comment|/* DAC8 analog mute */
l_int|0x08
comma
l_int|0x100
comma
multiline_comment|/* master analog mute */
l_int|0x09
comma
l_int|0xff
comma
multiline_comment|/* DAC1 digital full */
l_int|0x0a
comma
l_int|0xff
comma
multiline_comment|/* DAC2 digital full */
l_int|0x0b
comma
l_int|0xff
comma
multiline_comment|/* DAC3 digital full */
l_int|0x0c
comma
l_int|0xff
comma
multiline_comment|/* DAC4 digital full */
l_int|0x0d
comma
l_int|0xff
comma
multiline_comment|/* DAC5 digital full */
l_int|0x0e
comma
l_int|0xff
comma
multiline_comment|/* DAC6 digital full */
l_int|0x0f
comma
l_int|0xff
comma
multiline_comment|/* DAC7 digital full */
l_int|0x10
comma
l_int|0xff
comma
multiline_comment|/* DAC8 digital full */
l_int|0x11
comma
l_int|0x1ff
comma
multiline_comment|/* master digital full */
l_int|0x12
comma
l_int|0x000
comma
multiline_comment|/* phase normal */
l_int|0x13
comma
l_int|0x090
comma
multiline_comment|/* unmute DAC L/R */
l_int|0x14
comma
l_int|0x000
comma
multiline_comment|/* all unmute */
l_int|0x15
comma
l_int|0x000
comma
multiline_comment|/* no deemphasis, no ZFLG */
l_int|0x19
comma
l_int|0x000
comma
multiline_comment|/* -12dB ADC/L */
l_int|0x1a
comma
l_int|0x000
comma
multiline_comment|/* -12dB ADC/R */
l_int|0x1b
comma
l_int|0x000
comma
multiline_comment|/* ADC Mux */
l_int|0x1c
comma
l_int|0x009
comma
multiline_comment|/* Out Mux1 */
l_int|0x1d
comma
l_int|0x009
comma
multiline_comment|/* Out Mux2 */
)brace
suffix:semicolon
r_static
r_int
r_int
id|cs_inits
(braket
)braket
op_assign
(brace
l_int|0x0441
comma
multiline_comment|/* RUN */
l_int|0x0100
comma
multiline_comment|/* no mute */
l_int|0x0200
comma
multiline_comment|/* */
l_int|0x0600
comma
multiline_comment|/* slave, 24bit */
)brace
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|ice-&gt;eeprom.subvendor
op_eq
id|VT1724_SUBDEVICE_AUREON51_SKY
)paren
id|ice-&gt;num_total_dacs
op_assign
l_int|6
suffix:semicolon
r_else
id|ice-&gt;num_total_dacs
op_assign
l_int|8
suffix:semicolon
multiline_comment|/* to remeber the register values */
id|ice-&gt;akm
op_assign
id|snd_kcalloc
c_func
(paren
r_sizeof
(paren
id|akm4xxx_t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ice-&gt;akm
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|ice-&gt;akm_codecs
op_assign
l_int|1
suffix:semicolon
id|snd_ice1712_gpio_set_dir
c_func
(paren
id|ice
comma
l_int|0xbfffff
)paren
suffix:semicolon
multiline_comment|/* fix this for the time being */
multiline_comment|/* reset the wm codec as the SPI mode */
id|snd_ice1712_save_gpio_status
c_func
(paren
id|ice
)paren
suffix:semicolon
id|snd_ice1712_gpio_set_mask
c_func
(paren
id|ice
comma
op_complement
(paren
id|AUREON_WM_RESET
op_or
id|AUREON_WM_CS
op_or
id|AUREON_CS8415_CS
)paren
)paren
suffix:semicolon
id|tmp
op_assign
id|snd_ice1712_gpio_read
c_func
(paren
id|ice
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|AUREON_WM_RESET
suffix:semicolon
id|snd_ice1712_gpio_write
c_func
(paren
id|ice
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|tmp
op_or_assign
id|AUREON_WM_CS
op_or
id|AUREON_CS8415_CS
suffix:semicolon
id|snd_ice1712_gpio_write
c_func
(paren
id|ice
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|tmp
op_or_assign
id|AUREON_WM_RESET
suffix:semicolon
id|snd_ice1712_gpio_write
c_func
(paren
id|ice
comma
id|tmp
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* initialize WM8770 codec */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|wm_inits
)paren
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
id|wm_put
c_func
(paren
id|ice
comma
id|wm_inits
(braket
id|i
)braket
comma
id|wm_inits
(braket
id|i
op_plus
l_int|1
)braket
)paren
suffix:semicolon
multiline_comment|/* initialize CS8415A codec */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|cs_inits
)paren
suffix:semicolon
id|i
op_increment
)paren
id|aureon_spi_write
c_func
(paren
id|ice
comma
id|AUREON_CS8415_CS
comma
id|cs_inits
(braket
id|i
)braket
op_or
l_int|0x200000
comma
l_int|24
)paren
suffix:semicolon
id|snd_ice1712_restore_gpio_status
c_func
(paren
id|ice
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Aureon boards don&squot;t provide the EEPROM data except for the vendor IDs.&n; * hence the driver needs to sets up it properly.&n; */
DECL|variable|__devinitdata
r_static
r_int
r_char
id|aureon51_eeprom
(braket
)braket
id|__devinitdata
op_assign
(brace
l_int|0x12
comma
multiline_comment|/* SYSCONF: clock 512, mpu401, spdif-in/ADC, 3DACs */
l_int|0x80
comma
multiline_comment|/* ACLINK: I2S */
l_int|0xf8
comma
multiline_comment|/* I2S: vol, 96k, 24bit, 192k */
l_int|0xc2
comma
multiline_comment|/* SPDIF: out-en, out-int, spdif-in */
l_int|0xff
comma
multiline_comment|/* GPIO_DIR */
l_int|0xff
comma
multiline_comment|/* GPIO_DIR1 */
l_int|0xbf
comma
multiline_comment|/* GPIO_DIR2 */
l_int|0xff
comma
multiline_comment|/* GPIO_MASK */
l_int|0xff
comma
multiline_comment|/* GPIO_MASK1 */
l_int|0xff
comma
multiline_comment|/* GPIO_MASK2 */
l_int|0x00
comma
multiline_comment|/* GPIO_STATE */
l_int|0x00
comma
multiline_comment|/* GPIO_STATE1 */
l_int|0x00
comma
multiline_comment|/* GPIO_STATE2 */
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_static
r_int
r_char
id|aureon71_eeprom
(braket
)braket
id|__devinitdata
op_assign
(brace
l_int|0x13
comma
multiline_comment|/* SYSCONF: clock 512, mpu401, spdif-in/ADC, 4DACs */
l_int|0x80
comma
multiline_comment|/* ACLINK: I2S */
l_int|0xf8
comma
multiline_comment|/* I2S: vol, 96k, 24bit, 192k */
l_int|0xc2
comma
multiline_comment|/* SPDIF: out-en, out-int, spdif-in */
l_int|0xff
comma
multiline_comment|/* GPIO_DIR */
l_int|0xff
comma
multiline_comment|/* GPIO_DIR1 */
l_int|0xbf
comma
multiline_comment|/* GPIO_DIR2 */
l_int|0x00
comma
multiline_comment|/* GPIO_MASK */
l_int|0x00
comma
multiline_comment|/* GPIO_MASK1 */
l_int|0x00
comma
multiline_comment|/* GPIO_MASK2 */
l_int|0x00
comma
multiline_comment|/* GPIO_STATE */
l_int|0x00
comma
multiline_comment|/* GPIO_STATE1 */
l_int|0x00
comma
multiline_comment|/* GPIO_STATE2 */
)brace
suffix:semicolon
multiline_comment|/* entry point */
DECL|variable|__devinitdata
r_struct
id|snd_ice1712_card_info
id|snd_vt1724_aureon_cards
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
dot
id|subvendor
op_assign
id|VT1724_SUBDEVICE_AUREON51_SKY
comma
dot
id|name
op_assign
l_string|&quot;Terratec Aureon 5.1-Sky&quot;
comma
dot
id|chip_init
op_assign
id|aureon_init
comma
dot
id|build_controls
op_assign
id|aureon_add_controls
comma
dot
id|eeprom_size
op_assign
r_sizeof
(paren
id|aureon51_eeprom
)paren
comma
dot
id|eeprom_data
op_assign
id|aureon51_eeprom
comma
)brace
comma
(brace
dot
id|subvendor
op_assign
id|VT1724_SUBDEVICE_AUREON71_SPACE
comma
dot
id|name
op_assign
l_string|&quot;Terratec Aureon 7.1-Space&quot;
comma
dot
id|chip_init
op_assign
id|aureon_init
comma
dot
id|build_controls
op_assign
id|aureon_add_controls
comma
dot
id|eeprom_size
op_assign
r_sizeof
(paren
id|aureon71_eeprom
)paren
comma
dot
id|eeprom_data
op_assign
id|aureon71_eeprom
comma
)brace
comma
(brace
)brace
multiline_comment|/* terminator */
)brace
suffix:semicolon
eof
