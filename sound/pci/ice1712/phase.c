multiline_comment|/*&n; *   ALSA driver for ICEnsemble ICE1724 (Envy24)&n; *&n; *   Lowlevel functions for Terratec PHASE 22&n; *&n; *&t;Copyright (c) 2005 Misha Zhilin &lt;misha@epiphan.com&gt;&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
multiline_comment|/* PHASE 22 overview:&n; *   Audio controller: VIA Envy24HT-S (slightly trimmed down version of Envy24HT)&n; *   Analog chip: AK4524 (partially via Philip&squot;s 74HCT125)&n; *   Digital receiver: CS8414-CS (not supported in this release)&n; *&n; *   Envy connects to AK4524&n; *&t;- CS directly from GPIO 10&n; *&t;- CCLK via 74HCT125&squot;s gate #4 from GPIO 4&n; *&t;- CDTI via 74HCT125&squot;s gate #2 from GPIO 5&n; *&t;&t;CDTI may be completely blocked by 74HCT125&squot;s gate #1 controlled by GPIO 3&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &quot;ice1712.h&quot;
macro_line|#include &quot;envy24ht.h&quot;
macro_line|#include &quot;phase.h&quot;
DECL|variable|__devinitdata
r_static
id|akm4xxx_t
id|akm_phase22
id|__devinitdata
op_assign
(brace
dot
id|type
op_assign
id|SND_AK4524
comma
dot
id|num_dacs
op_assign
l_int|2
comma
dot
id|num_adcs
op_assign
l_int|2
comma
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_static
r_struct
id|snd_ak4xxx_private
id|akm_phase22_priv
id|__devinitdata
op_assign
(brace
dot
id|caddr
op_assign
l_int|2
comma
dot
id|cif
op_assign
l_int|1
comma
dot
id|data_mask
op_assign
l_int|1
op_lshift
l_int|4
comma
dot
id|clk_mask
op_assign
l_int|1
op_lshift
l_int|5
comma
dot
id|cs_mask
op_assign
l_int|1
op_lshift
l_int|10
comma
dot
id|cs_addr
op_assign
l_int|1
op_lshift
l_int|10
comma
dot
id|cs_none
op_assign
l_int|0
comma
dot
id|add_flags
op_assign
l_int|1
op_lshift
l_int|3
comma
dot
id|mask_flags
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|function|phase22_init
r_static
r_int
id|__devinit
id|phase22_init
c_func
(paren
id|ice1712_t
op_star
id|ice
)paren
(brace
id|akm4xxx_t
op_star
id|ak
suffix:semicolon
r_int
id|err
suffix:semicolon
singleline_comment|// Configure DAC/ADC description for generic part of ice1724
r_switch
c_cond
(paren
id|ice-&gt;eeprom.subvendor
)paren
(brace
r_case
id|VT1724_SUBDEVICE_PHASE22
suffix:colon
id|ice-&gt;num_total_dacs
op_assign
l_int|2
suffix:semicolon
id|ice-&gt;num_total_adcs
op_assign
l_int|2
suffix:semicolon
id|ice-&gt;vt1720
op_assign
l_int|1
suffix:semicolon
singleline_comment|// Envy24HT-S have 16 bit wide GPIO
r_break
suffix:semicolon
r_default
suffix:colon
id|snd_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
singleline_comment|// Initialize analog chips
id|ak
op_assign
id|ice-&gt;akm
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
id|akm4xxx_t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ak
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|ice-&gt;akm_codecs
op_assign
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|ice-&gt;eeprom.subvendor
)paren
(brace
r_case
id|VT1724_SUBDEVICE_PHASE22
suffix:colon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ice1712_akm4xxx_init
c_func
(paren
id|ak
comma
op_amp
id|akm_phase22
comma
op_amp
id|akm_phase22_priv
comma
id|ice
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|phase22_add_controls
r_static
r_int
id|__devinit
id|phase22_add_controls
c_func
(paren
id|ice1712_t
op_star
id|ice
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|ice-&gt;eeprom.subvendor
)paren
(brace
r_case
id|VT1724_SUBDEVICE_PHASE22
suffix:colon
id|err
op_assign
id|snd_ice1712_akm4xxx_build_controls
c_func
(paren
id|ice
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
r_int
r_char
id|phase22_eeprom
(braket
)braket
id|__devinitdata
op_assign
(brace
l_int|0x00
comma
multiline_comment|/* SYSCONF: 1xADC, 1xDACs */
l_int|0x80
comma
multiline_comment|/* ACLINK: I2S */
l_int|0xf8
comma
multiline_comment|/* I2S: vol, 96k, 24bit*/
l_int|0xc3
comma
multiline_comment|/* SPDIF: out-en, out-int, spdif-in */
l_int|0xFF
comma
multiline_comment|/* GPIO_DIR */
l_int|0xFF
comma
multiline_comment|/* GPIO_DIR1 */
l_int|0xFF
comma
multiline_comment|/* GPIO_DIR2 */
l_int|0x00
comma
multiline_comment|/* GPIO_MASK */
l_int|0x00
comma
multiline_comment|/* GPIO_MASK1 */
l_int|0x00
comma
multiline_comment|/* GPIO_MASK2 */
l_int|0x00
comma
multiline_comment|/* GPIO_STATE: */
l_int|0x00
comma
multiline_comment|/* GPIO_STATE1: */
l_int|0x00
comma
multiline_comment|/* GPIO_STATE2 */
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_struct
id|snd_ice1712_card_info
id|snd_vt1724_phase_cards
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
dot
id|subvendor
op_assign
id|VT1724_SUBDEVICE_PHASE22
comma
dot
id|name
op_assign
l_string|&quot;Terratec PHASE 22&quot;
comma
dot
id|model
op_assign
l_string|&quot;phase22&quot;
comma
dot
id|chip_init
op_assign
id|phase22_init
comma
dot
id|build_controls
op_assign
id|phase22_add_controls
comma
dot
id|eeprom_size
op_assign
r_sizeof
(paren
id|phase22_eeprom
)paren
comma
dot
id|eeprom_data
op_assign
id|phase22_eeprom
comma
)brace
comma
(brace
)brace
multiline_comment|/* terminator */
)brace
suffix:semicolon
eof
