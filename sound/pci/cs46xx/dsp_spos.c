multiline_comment|/*&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
multiline_comment|/*&n; * 2002-07 Benny Sjostrand benny@hostmobility.com&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/pm.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/control.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#include &lt;sound/asoundef.h&gt;
macro_line|#include &lt;sound/cs46xx.h&gt;
macro_line|#include &quot;cs46xx_lib.h&quot;
macro_line|#include &quot;dsp_spos.h&quot;
DECL|variable|wide_opcodes
r_static
id|wide_opcode_t
id|wide_opcodes
(braket
)braket
op_assign
(brace
id|WIDE_FOR_BEGIN_LOOP
comma
id|WIDE_FOR_BEGIN_LOOP2
comma
id|WIDE_COND_GOTO_ADDR
comma
id|WIDE_COND_GOTO_CALL
comma
id|WIDE_TBEQ_COND_GOTO_ADDR
comma
id|WIDE_TBEQ_COND_CALL_ADDR
comma
id|WIDE_TBEQ_NCOND_GOTO_ADDR
comma
id|WIDE_TBEQ_NCOND_CALL_ADDR
comma
id|WIDE_TBEQ_COND_GOTO1_ADDR
comma
id|WIDE_TBEQ_COND_CALL1_ADDR
comma
id|WIDE_TBEQ_NCOND_GOTOI_ADDR
comma
id|WIDE_TBEQ_NCOND_CALL1_ADDR
)brace
suffix:semicolon
DECL|function|shadow_and_reallocate_code
r_static
r_int
id|shadow_and_reallocate_code
(paren
id|cs46xx_t
op_star
id|chip
comma
id|u32
op_star
id|data
comma
id|u32
id|size
comma
id|u32
id|overlay_begin_address
)paren
(brace
r_int
r_int
id|i
op_assign
l_int|0
comma
id|j
comma
id|nreallocated
op_assign
l_int|0
suffix:semicolon
id|u32
id|hival
comma
id|loval
comma
id|address
suffix:semicolon
id|u32
id|mop_operands
comma
id|mop_type
comma
id|wide_op
suffix:semicolon
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|snd_assert
c_func
(paren
(paren
(paren
id|size
op_mod
l_int|2
)paren
op_eq
l_int|0
)paren
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
id|size
)paren
(brace
id|loval
op_assign
id|data
(braket
id|i
op_increment
)braket
suffix:semicolon
id|hival
op_assign
id|data
(braket
id|i
op_increment
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;code.offset
OG
l_int|0
)paren
(brace
id|mop_operands
op_assign
(paren
id|hival
op_rshift
l_int|6
)paren
op_amp
l_int|0x03fff
suffix:semicolon
id|mop_type
op_assign
id|mop_operands
op_rshift
l_int|10
suffix:semicolon
multiline_comment|/* check for wide type instruction */
r_if
c_cond
(paren
id|mop_type
op_eq
l_int|0
op_logical_and
(paren
id|mop_operands
op_amp
id|WIDE_LADD_INSTR_MASK
)paren
op_eq
l_int|0
op_logical_and
(paren
id|mop_operands
op_amp
id|WIDE_INSTR_MASK
)paren
op_ne
l_int|0
)paren
(brace
id|wide_op
op_assign
id|loval
op_amp
l_int|0x7f
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
r_sizeof
(paren
id|wide_opcodes
)paren
op_div
r_sizeof
(paren
id|wide_opcode_t
)paren
suffix:semicolon
op_increment
id|j
)paren
(brace
r_if
c_cond
(paren
id|wide_opcodes
(braket
id|j
)braket
op_eq
id|wide_op
)paren
(brace
multiline_comment|/* need to reallocate instruction */
id|address
op_assign
(paren
id|hival
op_amp
l_int|0x00FFF
)paren
op_lshift
l_int|5
suffix:semicolon
id|address
op_or_assign
id|loval
op_rshift
l_int|15
suffix:semicolon
id|snd_printdd
c_func
(paren
l_string|&quot;handle_wideop[1]: %05x:%05x addr %04x&bslash;n&quot;
comma
id|hival
comma
id|loval
comma
id|address
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|address
op_amp
l_int|0x8000
)paren
)paren
(brace
id|address
op_add_assign
(paren
id|ins-&gt;code.offset
op_div
l_int|2
)paren
op_minus
id|overlay_begin_address
suffix:semicolon
)brace
r_else
(brace
id|snd_printdd
c_func
(paren
l_string|&quot;handle_wideop[1]: ROM symbol not reallocated&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|hival
op_and_assign
l_int|0xFF000
suffix:semicolon
id|loval
op_and_assign
l_int|0x07FFF
suffix:semicolon
id|hival
op_or_assign
(paren
(paren
id|address
op_rshift
l_int|5
)paren
op_amp
l_int|0x00FFF
)paren
suffix:semicolon
id|loval
op_or_assign
(paren
(paren
id|address
op_lshift
l_int|15
)paren
op_amp
l_int|0xF8000
)paren
suffix:semicolon
id|address
op_assign
(paren
id|hival
op_amp
l_int|0x00FFF
)paren
op_lshift
l_int|5
suffix:semicolon
id|address
op_or_assign
id|loval
op_rshift
l_int|15
suffix:semicolon
id|snd_printdd
c_func
(paren
l_string|&quot;handle_wideop:[2] %05x:%05x addr %04x&bslash;n&quot;
comma
id|hival
comma
id|loval
comma
id|address
)paren
suffix:semicolon
id|nreallocated
op_increment
suffix:semicolon
)brace
multiline_comment|/* wide_opcodes[j] == wide_op */
)brace
multiline_comment|/* for */
)brace
multiline_comment|/* mod_type == 0 ... */
)brace
multiline_comment|/* ins-&gt;code.offset &gt; 0 */
id|ins-&gt;code.data
(braket
id|ins-&gt;code.size
op_increment
)braket
op_assign
id|loval
suffix:semicolon
id|ins-&gt;code.data
(braket
id|ins-&gt;code.size
op_increment
)braket
op_assign
id|hival
suffix:semicolon
)brace
id|snd_printdd
c_func
(paren
l_string|&quot;dsp_spos: %d instructions reallocated&bslash;n&quot;
comma
id|nreallocated
)paren
suffix:semicolon
r_return
id|nreallocated
suffix:semicolon
)brace
DECL|function|get_segment_desc
r_static
id|segment_desc_t
op_star
id|get_segment_desc
(paren
id|dsp_module_desc_t
op_star
id|module
comma
r_int
id|seg_type
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|module-&gt;nsegments
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|module-&gt;segments
(braket
id|i
)braket
dot
id|segment_type
op_eq
id|seg_type
)paren
(brace
r_return
(paren
id|module-&gt;segments
op_plus
id|i
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
suffix:semicolon
DECL|function|find_free_symbol_index
r_static
r_int
id|find_free_symbol_index
(paren
id|dsp_spos_instance_t
op_star
id|ins
)paren
(brace
r_int
id|index
op_assign
id|ins-&gt;symbol_table.nsymbols
comma
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|ins-&gt;symbol_table.highest_frag_index
suffix:semicolon
id|i
OL
id|ins-&gt;symbol_table.nsymbols
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|ins-&gt;symbol_table.symbols
(braket
id|i
)braket
dot
id|deleted
)paren
(brace
id|index
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
id|index
suffix:semicolon
)brace
DECL|function|add_symbols
r_static
r_int
id|add_symbols
(paren
id|cs46xx_t
op_star
id|chip
comma
id|dsp_module_desc_t
op_star
id|module
)paren
(brace
r_int
id|i
suffix:semicolon
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
r_if
c_cond
(paren
id|module-&gt;symbol_table.nsymbols
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|module-&gt;symbol_table.symbols
(braket
l_int|0
)braket
dot
id|symbol_name
comma
l_string|&quot;OVERLAYBEGINADDRESS&quot;
)paren
op_logical_and
id|module-&gt;symbol_table.symbols
(braket
l_int|0
)braket
dot
id|symbol_type
op_eq
id|SYMBOL_CONSTANT
)paren
(brace
id|module-&gt;overlay_begin_address
op_assign
id|module-&gt;symbol_table.symbols
(braket
l_int|0
)braket
dot
id|address
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|module-&gt;symbol_table.nsymbols
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|ins-&gt;symbol_table.nsymbols
op_eq
(paren
id|DSP_MAX_SYMBOLS
op_minus
l_int|1
)paren
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: symbol table is full&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs46xx_dsp_lookup_symbol
c_func
(paren
id|chip
comma
id|module-&gt;symbol_table.symbols
(braket
id|i
)braket
dot
id|symbol_name
comma
id|module-&gt;symbol_table.symbols
(braket
id|i
)braket
dot
id|symbol_type
)paren
op_eq
l_int|NULL
)paren
(brace
id|ins-&gt;symbol_table.symbols
(braket
id|ins-&gt;symbol_table.nsymbols
)braket
op_assign
id|module-&gt;symbol_table.symbols
(braket
id|i
)braket
suffix:semicolon
id|ins-&gt;symbol_table.symbols
(braket
id|ins-&gt;symbol_table.nsymbols
)braket
dot
id|address
op_add_assign
(paren
(paren
id|ins-&gt;code.offset
op_div
l_int|2
)paren
op_minus
id|module-&gt;overlay_begin_address
)paren
suffix:semicolon
id|ins-&gt;symbol_table.symbols
(braket
id|ins-&gt;symbol_table.nsymbols
)braket
dot
id|module
op_assign
id|module
suffix:semicolon
id|ins-&gt;symbol_table.symbols
(braket
id|ins-&gt;symbol_table.nsymbols
)braket
dot
id|deleted
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;symbol_table.nsymbols
OG
id|ins-&gt;symbol_table.highest_frag_index
)paren
id|ins-&gt;symbol_table.highest_frag_index
op_assign
id|ins-&gt;symbol_table.nsymbols
suffix:semicolon
id|ins-&gt;symbol_table.nsymbols
op_increment
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* if (0) printk (&quot;dsp_spos: symbol &lt;%s&gt; duplicated, probably nothing wrong with that (Cirrus?)&bslash;n&quot;,&n;                             module-&gt;symbol_table.symbols[i].symbol_name); */
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|add_symbol
r_static
id|symbol_entry_t
op_star
id|add_symbol
(paren
id|cs46xx_t
op_star
id|chip
comma
r_char
op_star
id|symbol_name
comma
id|u32
id|address
comma
r_int
id|type
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|symbol_entry_t
op_star
id|symbol
op_assign
l_int|NULL
suffix:semicolon
r_int
id|index
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;symbol_table.nsymbols
op_eq
(paren
id|DSP_MAX_SYMBOLS
op_minus
l_int|1
)paren
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: symbol table is full&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs46xx_dsp_lookup_symbol
c_func
(paren
id|chip
comma
id|symbol_name
comma
id|type
)paren
op_ne
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: symbol &lt;%s&gt; duplicated&bslash;n&quot;
comma
id|symbol_name
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|index
op_assign
id|find_free_symbol_index
(paren
id|ins
)paren
suffix:semicolon
id|strcpy
(paren
id|ins-&gt;symbol_table.symbols
(braket
id|index
)braket
dot
id|symbol_name
comma
id|symbol_name
)paren
suffix:semicolon
id|ins-&gt;symbol_table.symbols
(braket
id|index
)braket
dot
id|address
op_assign
id|address
suffix:semicolon
id|ins-&gt;symbol_table.symbols
(braket
id|index
)braket
dot
id|symbol_type
op_assign
id|type
suffix:semicolon
id|ins-&gt;symbol_table.symbols
(braket
id|index
)braket
dot
id|module
op_assign
l_int|NULL
suffix:semicolon
id|ins-&gt;symbol_table.symbols
(braket
id|index
)braket
dot
id|deleted
op_assign
l_int|0
suffix:semicolon
id|symbol
op_assign
(paren
id|ins-&gt;symbol_table.symbols
op_plus
id|index
)paren
suffix:semicolon
r_if
c_cond
(paren
id|index
OG
id|ins-&gt;symbol_table.highest_frag_index
)paren
id|ins-&gt;symbol_table.highest_frag_index
op_assign
id|index
suffix:semicolon
r_if
c_cond
(paren
id|index
op_eq
id|ins-&gt;symbol_table.nsymbols
)paren
id|ins-&gt;symbol_table.nsymbols
op_increment
suffix:semicolon
multiline_comment|/* no frag. in list */
r_return
id|symbol
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_spos_create
id|dsp_spos_instance_t
op_star
id|cs46xx_dsp_spos_create
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|dsp_spos_instance_t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ins
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|ins
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|ins
)paren
)paren
suffix:semicolon
multiline_comment|/* better to use vmalloc for this big table */
id|ins-&gt;symbol_table.nsymbols
op_assign
l_int|0
suffix:semicolon
id|ins-&gt;symbol_table.symbols
op_assign
id|vmalloc
c_func
(paren
r_sizeof
(paren
id|symbol_entry_t
)paren
op_star
id|DSP_MAX_SYMBOLS
)paren
suffix:semicolon
id|ins-&gt;symbol_table.highest_frag_index
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;symbol_table.symbols
op_eq
l_int|NULL
)paren
(brace
id|cs46xx_dsp_spos_destroy
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|ins-&gt;code.offset
op_assign
l_int|0
suffix:semicolon
id|ins-&gt;code.size
op_assign
l_int|0
suffix:semicolon
id|ins-&gt;code.data
op_assign
id|kmalloc
c_func
(paren
id|DSP_CODE_BYTE_SIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;code.data
op_eq
l_int|NULL
)paren
(brace
id|cs46xx_dsp_spos_destroy
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|ins-&gt;nscb
op_assign
l_int|0
suffix:semicolon
id|ins-&gt;ntask
op_assign
l_int|0
suffix:semicolon
id|ins-&gt;nmodules
op_assign
l_int|0
suffix:semicolon
id|ins-&gt;modules
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|dsp_module_desc_t
)paren
op_star
id|DSP_MAX_MODULES
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;modules
op_eq
l_int|NULL
)paren
(brace
id|cs46xx_dsp_spos_destroy
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* default SPDIF input sample rate&n;&t;   to 48000 khz */
id|ins-&gt;spdif_in_sample_rate
op_assign
l_int|48000
suffix:semicolon
multiline_comment|/* maximize volume */
id|ins-&gt;dac_volume_right
op_assign
l_int|0x8000
suffix:semicolon
id|ins-&gt;dac_volume_left
op_assign
l_int|0x8000
suffix:semicolon
id|ins-&gt;spdif_input_volume_right
op_assign
l_int|0x8000
suffix:semicolon
id|ins-&gt;spdif_input_volume_left
op_assign
l_int|0x8000
suffix:semicolon
multiline_comment|/* set left and right validity bits and&n;&t;   default channel status */
id|ins-&gt;spdif_csuv_default
op_assign
id|ins-&gt;spdif_csuv_stream
op_assign
multiline_comment|/* byte 0 */
(paren
(paren
r_int
r_int
)paren
id|_wrap_all_bits
c_func
(paren
(paren
id|SNDRV_PCM_DEFAULT_CON_SPDIF
op_amp
l_int|0xff
)paren
)paren
op_lshift
l_int|24
)paren
op_or
multiline_comment|/* byte 1 */
(paren
(paren
r_int
r_int
)paren
id|_wrap_all_bits
c_func
(paren
(paren
(paren
id|SNDRV_PCM_DEFAULT_CON_SPDIF
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
)paren
op_lshift
l_int|16
)paren
op_or
multiline_comment|/* byte 3 */
(paren
r_int
r_int
)paren
id|_wrap_all_bits
c_func
(paren
(paren
id|SNDRV_PCM_DEFAULT_CON_SPDIF
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
)paren
op_or
multiline_comment|/* left and right validity bits */
(paren
l_int|1
op_lshift
l_int|13
)paren
op_or
(paren
l_int|1
op_lshift
l_int|12
)paren
suffix:semicolon
r_return
id|ins
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_spos_destroy
r_void
id|cs46xx_dsp_spos_destroy
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
r_int
id|i
suffix:semicolon
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|snd_assert
c_func
(paren
id|ins
op_ne
l_int|NULL
comma
r_return
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ins-&gt;nscb
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|ins-&gt;scbs
(braket
id|i
)braket
dot
id|deleted
)paren
r_continue
suffix:semicolon
id|cs46xx_dsp_proc_free_scb_desc
(paren
(paren
id|ins-&gt;scbs
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ins-&gt;code.data
)paren
id|kfree
c_func
(paren
id|ins-&gt;code.data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;symbol_table.symbols
)paren
id|vfree
c_func
(paren
id|ins-&gt;symbol_table.symbols
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;modules
)paren
id|kfree
c_func
(paren
id|ins-&gt;modules
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ins
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_load_module
r_int
id|cs46xx_dsp_load_module
(paren
id|cs46xx_t
op_star
id|chip
comma
id|dsp_module_desc_t
op_star
id|module
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|segment_desc_t
op_star
id|code
op_assign
id|get_segment_desc
(paren
id|module
comma
id|SEGTYPE_SP_PROGRAM
)paren
suffix:semicolon
id|segment_desc_t
op_star
id|parameter
op_assign
id|get_segment_desc
(paren
id|module
comma
id|SEGTYPE_SP_PARAMETER
)paren
suffix:semicolon
id|segment_desc_t
op_star
id|sample
op_assign
id|get_segment_desc
(paren
id|module
comma
id|SEGTYPE_SP_SAMPLE
)paren
suffix:semicolon
id|u32
id|doffset
comma
id|dsize
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;nmodules
op_eq
id|DSP_MAX_MODULES
op_minus
l_int|1
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: to many modules loaded into DSP&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|snd_printdd
c_func
(paren
l_string|&quot;dsp_spos: loading module %s into DSP&bslash;n&quot;
comma
id|module-&gt;module_name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;nmodules
op_eq
l_int|0
)paren
(brace
id|snd_printdd
c_func
(paren
l_string|&quot;dsp_spos: clearing parameter area&bslash;n&quot;
)paren
suffix:semicolon
id|snd_cs46xx_clear_BA1
c_func
(paren
id|chip
comma
id|DSP_PARAMETER_BYTE_OFFSET
comma
id|DSP_PARAMETER_BYTE_SIZE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|parameter
op_eq
l_int|NULL
)paren
(brace
id|snd_printdd
c_func
(paren
l_string|&quot;dsp_spos: module got no parameter segment&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ins-&gt;nmodules
OG
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;dsp_spos: WARNING current parameter data may be overwriten!&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|doffset
op_assign
(paren
id|parameter-&gt;offset
op_star
l_int|4
op_plus
id|DSP_PARAMETER_BYTE_OFFSET
)paren
suffix:semicolon
id|dsize
op_assign
id|parameter-&gt;size
op_star
l_int|4
suffix:semicolon
id|snd_printdd
c_func
(paren
l_string|&quot;dsp_spos: downloading parameter data to chip (%08x-%08x)&bslash;n&quot;
comma
id|doffset
comma
id|doffset
op_plus
id|dsize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_cs46xx_download
(paren
id|chip
comma
id|parameter-&gt;data
comma
id|doffset
comma
id|dsize
)paren
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: failed to download parameter data to DSP&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ins-&gt;nmodules
op_eq
l_int|0
)paren
(brace
id|snd_printdd
c_func
(paren
l_string|&quot;dsp_spos: clearing sample area&bslash;n&quot;
)paren
suffix:semicolon
id|snd_cs46xx_clear_BA1
c_func
(paren
id|chip
comma
id|DSP_SAMPLE_BYTE_OFFSET
comma
id|DSP_SAMPLE_BYTE_SIZE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sample
op_eq
l_int|NULL
)paren
(brace
id|snd_printdd
c_func
(paren
l_string|&quot;dsp_spos: module got no sample segment&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ins-&gt;nmodules
OG
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;dsp_spos: WARNING current sample data may be overwriten&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|doffset
op_assign
(paren
id|sample-&gt;offset
op_star
l_int|4
op_plus
id|DSP_SAMPLE_BYTE_OFFSET
)paren
suffix:semicolon
id|dsize
op_assign
id|sample-&gt;size
op_star
l_int|4
suffix:semicolon
id|snd_printdd
c_func
(paren
l_string|&quot;dsp_spos: downloading sample data to chip (%08x-%08x)&bslash;n&quot;
comma
id|doffset
comma
id|doffset
op_plus
id|dsize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_cs46xx_download
(paren
id|chip
comma
id|sample-&gt;data
comma
id|doffset
comma
id|dsize
)paren
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: failed to sample data to DSP&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ins-&gt;nmodules
op_eq
l_int|0
)paren
(brace
id|snd_printdd
c_func
(paren
l_string|&quot;dsp_spos: clearing code area&bslash;n&quot;
)paren
suffix:semicolon
id|snd_cs46xx_clear_BA1
c_func
(paren
id|chip
comma
id|DSP_CODE_BYTE_OFFSET
comma
id|DSP_CODE_BYTE_SIZE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|code
op_eq
l_int|NULL
)paren
(brace
id|snd_printdd
c_func
(paren
l_string|&quot;dsp_spos: module got no code segment&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ins-&gt;code.offset
op_plus
id|code-&gt;size
OG
id|DSP_CODE_BYTE_SIZE
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: no space available in DSP&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|module-&gt;load_address
op_assign
id|ins-&gt;code.offset
suffix:semicolon
id|module-&gt;overlay_begin_address
op_assign
l_int|0x000
suffix:semicolon
multiline_comment|/* if module has a code segment it must have&n;&t;&t;   symbol table */
id|snd_assert
c_func
(paren
id|module-&gt;symbol_table.symbols
op_ne
l_int|NULL
comma
r_return
op_minus
id|ENOMEM
)paren
suffix:semicolon
r_if
c_cond
(paren
id|add_symbols
c_func
(paren
id|chip
comma
id|module
)paren
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: failed to load symbol table&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|doffset
op_assign
(paren
id|code-&gt;offset
op_star
l_int|4
op_plus
id|ins-&gt;code.offset
op_star
l_int|4
op_plus
id|DSP_CODE_BYTE_OFFSET
)paren
suffix:semicolon
id|dsize
op_assign
id|code-&gt;size
op_star
l_int|4
suffix:semicolon
id|snd_printdd
c_func
(paren
l_string|&quot;dsp_spos: downloading code to chip (%08x-%08x)&bslash;n&quot;
comma
id|doffset
comma
id|doffset
op_plus
id|dsize
)paren
suffix:semicolon
id|module-&gt;nfixups
op_assign
id|shadow_and_reallocate_code
c_func
(paren
id|chip
comma
id|code-&gt;data
comma
id|code-&gt;size
comma
id|module-&gt;overlay_begin_address
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_cs46xx_download
(paren
id|chip
comma
(paren
id|ins-&gt;code.data
op_plus
id|ins-&gt;code.offset
)paren
comma
id|doffset
comma
id|dsize
)paren
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: failed to download code to DSP&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|ins-&gt;code.offset
op_add_assign
id|code-&gt;size
suffix:semicolon
)brace
multiline_comment|/* NOTE: module segments and symbol table must be&n;&t;   statically allocated. Case that module data is&n;&t;   not generated by the ospparser */
id|ins-&gt;modules
(braket
id|ins-&gt;nmodules
)braket
op_assign
op_star
id|module
suffix:semicolon
id|ins-&gt;nmodules
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_lookup_symbol
id|symbol_entry_t
op_star
id|cs46xx_dsp_lookup_symbol
(paren
id|cs46xx_t
op_star
id|chip
comma
r_char
op_star
id|symbol_name
comma
r_int
id|symbol_type
)paren
(brace
r_int
id|i
suffix:semicolon
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ins-&gt;symbol_table.nsymbols
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|ins-&gt;symbol_table.symbols
(braket
id|i
)braket
dot
id|deleted
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|ins-&gt;symbol_table.symbols
(braket
id|i
)braket
dot
id|symbol_name
comma
id|symbol_name
)paren
op_logical_and
id|ins-&gt;symbol_table.symbols
(braket
id|i
)braket
dot
id|symbol_type
op_eq
id|symbol_type
)paren
(brace
r_return
(paren
id|ins-&gt;symbol_table.symbols
op_plus
id|i
)paren
suffix:semicolon
)brace
)brace
macro_line|#if 0
id|printk
(paren
l_string|&quot;dsp_spos: symbol &lt;%s&gt; type %02x not found&bslash;n&quot;
comma
id|symbol_name
comma
id|symbol_type
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_lookup_symbol_addr
id|symbol_entry_t
op_star
id|cs46xx_dsp_lookup_symbol_addr
(paren
id|cs46xx_t
op_star
id|chip
comma
id|u32
id|address
comma
r_int
id|symbol_type
)paren
(brace
r_int
id|i
suffix:semicolon
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ins-&gt;symbol_table.nsymbols
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|ins-&gt;symbol_table.symbols
(braket
id|i
)braket
dot
id|deleted
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;symbol_table.symbols
(braket
id|i
)braket
dot
id|address
op_eq
id|address
op_logical_and
id|ins-&gt;symbol_table.symbols
(braket
id|i
)braket
dot
id|symbol_type
op_eq
id|symbol_type
)paren
(brace
r_return
(paren
id|ins-&gt;symbol_table.symbols
op_plus
id|i
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_proc_symbol_table_read
r_static
r_void
id|cs46xx_dsp_proc_symbol_table_read
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|entry-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
r_int
id|i
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;SYMBOLS:&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ins-&gt;symbol_table.nsymbols
suffix:semicolon
op_increment
id|i
)paren
(brace
r_char
op_star
id|module_str
op_assign
l_string|&quot;system&quot;
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;symbol_table.symbols
(braket
id|i
)braket
dot
id|deleted
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;symbol_table.symbols
(braket
id|i
)braket
dot
id|module
op_ne
l_int|NULL
)paren
(brace
id|module_str
op_assign
id|ins-&gt;symbol_table.symbols
(braket
id|i
)braket
dot
id|module-&gt;module_name
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%04X &lt;%02X&gt; %s [%s]&bslash;n&quot;
comma
id|ins-&gt;symbol_table.symbols
(braket
id|i
)braket
dot
id|address
comma
id|ins-&gt;symbol_table.symbols
(braket
id|i
)braket
dot
id|symbol_type
comma
id|ins-&gt;symbol_table.symbols
(braket
id|i
)braket
dot
id|symbol_name
comma
id|module_str
)paren
suffix:semicolon
)brace
)brace
DECL|function|cs46xx_dsp_proc_modules_read
r_static
r_void
id|cs46xx_dsp_proc_modules_read
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|entry-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|down
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;MODULES:&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ins-&gt;nmodules
suffix:semicolon
op_increment
id|i
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n%s:&bslash;n&quot;
comma
id|ins-&gt;modules
(braket
id|i
)braket
dot
id|module_name
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;   %d symbols&bslash;n&quot;
comma
id|ins-&gt;modules
(braket
id|i
)braket
dot
id|symbol_table.nsymbols
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;   %d fixups&bslash;n&quot;
comma
id|ins-&gt;modules
(braket
id|i
)braket
dot
id|nfixups
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|ins-&gt;modules
(braket
id|i
)braket
dot
id|nsegments
suffix:semicolon
op_increment
id|j
)paren
(brace
id|segment_desc_t
op_star
id|desc
op_assign
(paren
id|ins-&gt;modules
(braket
id|i
)braket
dot
id|segments
op_plus
id|j
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;   segment %02x offset %08x size %08x&bslash;n&quot;
comma
id|desc-&gt;segment_type
comma
id|desc-&gt;offset
comma
id|desc-&gt;size
)paren
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_proc_task_tree_read
r_static
r_void
id|cs46xx_dsp_proc_task_tree_read
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|entry-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|col
suffix:semicolon
r_int
r_int
id|dst
op_assign
id|chip-&gt;region.idx
(braket
l_int|1
)braket
dot
id|remap_addr
op_plus
id|DSP_PARAMETER_BYTE_OFFSET
suffix:semicolon
id|down
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;TASK TREES:&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ins-&gt;ntask
suffix:semicolon
op_increment
id|i
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n%04x %s:&bslash;n&quot;
comma
id|ins-&gt;tasks
(braket
id|i
)braket
dot
id|address
comma
id|ins-&gt;tasks
(braket
id|i
)braket
dot
id|task_name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|col
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|ins-&gt;tasks
(braket
id|i
)braket
dot
id|size
suffix:semicolon
id|j
op_increment
comma
id|col
op_increment
)paren
(brace
id|u32
id|val
suffix:semicolon
r_if
c_cond
(paren
id|col
op_eq
l_int|4
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|col
op_assign
l_int|0
suffix:semicolon
)brace
id|val
op_assign
id|readl
c_func
(paren
id|dst
op_plus
(paren
id|ins-&gt;tasks
(braket
id|i
)braket
dot
id|address
op_plus
id|j
)paren
op_star
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%08x &quot;
comma
id|val
)paren
suffix:semicolon
)brace
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_proc_scb_read
r_static
r_void
id|cs46xx_dsp_proc_scb_read
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|entry-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
r_int
id|i
suffix:semicolon
id|down
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;SCB&squot;s:&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ins-&gt;nscb
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|ins-&gt;scbs
(braket
id|i
)braket
dot
id|deleted
)paren
r_continue
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n%04x %s:&bslash;n&bslash;n&quot;
comma
id|ins-&gt;scbs
(braket
id|i
)braket
dot
id|address
comma
id|ins-&gt;scbs
(braket
id|i
)braket
dot
id|scb_name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;scbs
(braket
id|i
)braket
dot
id|parent_scb_ptr
op_ne
l_int|NULL
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;parent [%s:%04x] &quot;
comma
id|ins-&gt;scbs
(braket
id|i
)braket
dot
id|parent_scb_ptr-&gt;scb_name
comma
id|ins-&gt;scbs
(braket
id|i
)braket
dot
id|parent_scb_ptr-&gt;address
)paren
suffix:semicolon
)brace
r_else
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;parent [none] &quot;
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;sub_list_ptr [%s:%04x]&bslash;nnext_scb_ptr [%s:%04x]  task_entry [%s:%04x]&bslash;n&quot;
comma
id|ins-&gt;scbs
(braket
id|i
)braket
dot
id|sub_list_ptr-&gt;scb_name
comma
id|ins-&gt;scbs
(braket
id|i
)braket
dot
id|sub_list_ptr-&gt;address
comma
id|ins-&gt;scbs
(braket
id|i
)braket
dot
id|next_scb_ptr-&gt;scb_name
comma
id|ins-&gt;scbs
(braket
id|i
)braket
dot
id|next_scb_ptr-&gt;address
comma
id|ins-&gt;scbs
(braket
id|i
)braket
dot
id|task_entry-&gt;symbol_name
comma
id|ins-&gt;scbs
(braket
id|i
)braket
dot
id|task_entry-&gt;address
)paren
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_proc_parameter_dump_read
r_static
r_void
id|cs46xx_dsp_proc_parameter_dump_read
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|entry-&gt;private_data
comma
r_return
)paren
suffix:semicolon
multiline_comment|/*dsp_spos_instance_t * ins = chip-&gt;dsp_spos_instance; */
r_int
r_int
id|i
comma
id|col
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|dst
op_assign
id|chip-&gt;region.idx
(braket
l_int|1
)braket
dot
id|remap_addr
op_plus
id|DSP_PARAMETER_BYTE_OFFSET
suffix:semicolon
id|symbol_entry_t
op_star
id|symbol
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DSP_PARAMETER_BYTE_SIZE
suffix:semicolon
id|i
op_add_assign
r_sizeof
(paren
id|u32
)paren
comma
id|col
op_increment
)paren
(brace
r_if
c_cond
(paren
id|col
op_eq
l_int|4
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|col
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|symbol
op_assign
id|cs46xx_dsp_lookup_symbol_addr
(paren
id|chip
comma
id|i
op_div
r_sizeof
(paren
id|u32
)paren
comma
id|SYMBOL_PARAMETER
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|col
op_assign
l_int|0
suffix:semicolon
id|snd_iprintf
(paren
id|buffer
comma
l_string|&quot;&bslash;n%s:&bslash;n&quot;
comma
id|symbol-&gt;symbol_name
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|col
op_eq
l_int|0
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%04X &quot;
comma
id|i
op_div
(paren
r_int
r_int
)paren
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%08X &quot;
comma
id|readl
c_func
(paren
id|dst
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|cs46xx_dsp_proc_sample_dump_read
r_static
r_void
id|cs46xx_dsp_proc_sample_dump_read
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|entry-&gt;private_data
comma
r_return
)paren
suffix:semicolon
r_int
id|i
comma
id|col
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|dst
op_assign
id|chip-&gt;region.idx
(braket
l_int|2
)braket
dot
id|remap_addr
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;PCMREADER:&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|PCM_READER_BUF1
suffix:semicolon
id|i
OL
id|PCM_READER_BUF1
op_plus
l_int|0x30
suffix:semicolon
id|i
op_add_assign
r_sizeof
(paren
id|u32
)paren
comma
id|col
op_increment
)paren
(brace
r_if
c_cond
(paren
id|col
op_eq
l_int|4
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|col
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|col
op_eq
l_int|0
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%04X &quot;
comma
id|i
)paren
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%08X &quot;
comma
id|readl
c_func
(paren
id|dst
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;nMIX_SAMPLE_BUF1:&bslash;n&quot;
)paren
suffix:semicolon
id|col
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|MIX_SAMPLE_BUF1
suffix:semicolon
id|i
OL
id|MIX_SAMPLE_BUF1
op_plus
l_int|0x40
suffix:semicolon
id|i
op_add_assign
r_sizeof
(paren
id|u32
)paren
comma
id|col
op_increment
)paren
(brace
r_if
c_cond
(paren
id|col
op_eq
l_int|4
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|col
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|col
op_eq
l_int|0
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%04X &quot;
comma
id|i
)paren
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%08X &quot;
comma
id|readl
c_func
(paren
id|dst
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;nSRC_TASK_SCB1:&bslash;n&quot;
)paren
suffix:semicolon
id|col
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0x2480
suffix:semicolon
id|i
OL
l_int|0x2480
op_plus
l_int|0x40
suffix:semicolon
id|i
op_add_assign
r_sizeof
(paren
id|u32
)paren
comma
id|col
op_increment
)paren
(brace
r_if
c_cond
(paren
id|col
op_eq
l_int|4
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|col
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|col
op_eq
l_int|0
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%04X &quot;
comma
id|i
)paren
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%08X &quot;
comma
id|readl
c_func
(paren
id|dst
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;nSPDIFO_BUFFER:&bslash;n&quot;
)paren
suffix:semicolon
id|col
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|SPDIFO_IP_OUTPUT_BUFFER1
suffix:semicolon
id|i
OL
id|SPDIFO_IP_OUTPUT_BUFFER1
op_plus
l_int|0x30
suffix:semicolon
id|i
op_add_assign
r_sizeof
(paren
id|u32
)paren
comma
id|col
op_increment
)paren
(brace
r_if
c_cond
(paren
id|col
op_eq
l_int|4
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|col
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|col
op_eq
l_int|0
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%04X &quot;
comma
id|i
)paren
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%08X &quot;
comma
id|readl
c_func
(paren
id|dst
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n...&bslash;n&quot;
)paren
suffix:semicolon
id|col
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|SPDIFO_IP_OUTPUT_BUFFER1
op_plus
l_int|0xD0
suffix:semicolon
id|i
OL
id|SPDIFO_IP_OUTPUT_BUFFER1
op_plus
l_int|0x110
suffix:semicolon
id|i
op_add_assign
r_sizeof
(paren
id|u32
)paren
comma
id|col
op_increment
)paren
(brace
r_if
c_cond
(paren
id|col
op_eq
l_int|4
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|col
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|col
op_eq
l_int|0
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%04X &quot;
comma
id|i
)paren
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%08X &quot;
comma
id|readl
c_func
(paren
id|dst
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;nOUTPUT_SNOOP:&bslash;n&quot;
)paren
suffix:semicolon
id|col
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|OUTPUT_SNOOP_BUFFER
suffix:semicolon
id|i
OL
id|OUTPUT_SNOOP_BUFFER
op_plus
l_int|0x40
suffix:semicolon
id|i
op_add_assign
r_sizeof
(paren
id|u32
)paren
comma
id|col
op_increment
)paren
(brace
r_if
c_cond
(paren
id|col
op_eq
l_int|4
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|col
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|col
op_eq
l_int|0
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%04X &quot;
comma
id|i
)paren
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%08X &quot;
comma
id|readl
c_func
(paren
id|dst
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;nCODEC_INPUT_BUF1: &bslash;n&quot;
)paren
suffix:semicolon
id|col
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|CODEC_INPUT_BUF1
suffix:semicolon
id|i
OL
id|CODEC_INPUT_BUF1
op_plus
l_int|0x40
suffix:semicolon
id|i
op_add_assign
r_sizeof
(paren
id|u32
)paren
comma
id|col
op_increment
)paren
(brace
r_if
c_cond
(paren
id|col
op_eq
l_int|4
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|col
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|col
op_eq
l_int|0
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%04X &quot;
comma
id|i
)paren
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%08X &quot;
comma
id|readl
c_func
(paren
id|dst
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
macro_line|#if 0
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;nWRITE_BACK_BUF1: &bslash;n&quot;
)paren
suffix:semicolon
id|col
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|WRITE_BACK_BUF1
suffix:semicolon
id|i
OL
id|WRITE_BACK_BUF1
op_plus
l_int|0x40
suffix:semicolon
id|i
op_add_assign
r_sizeof
(paren
id|u32
)paren
comma
id|col
op_increment
)paren
(brace
r_if
c_cond
(paren
id|col
op_eq
l_int|4
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|col
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|col
op_eq
l_int|0
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%04X &quot;
comma
id|i
)paren
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%08X &quot;
comma
id|readl
c_func
(paren
id|dst
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;nSPDIFI_IP_OUTPUT_BUFFER1: &bslash;n&quot;
)paren
suffix:semicolon
id|col
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|SPDIFI_IP_OUTPUT_BUFFER1
suffix:semicolon
id|i
OL
id|SPDIFI_IP_OUTPUT_BUFFER1
op_plus
l_int|0x80
suffix:semicolon
id|i
op_add_assign
r_sizeof
(paren
id|u32
)paren
comma
id|col
op_increment
)paren
(brace
r_if
c_cond
(paren
id|col
op_eq
l_int|4
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|col
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|col
op_eq
l_int|0
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%04X &quot;
comma
id|i
)paren
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%08X &quot;
comma
id|readl
c_func
(paren
id|dst
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_proc_init
r_int
id|cs46xx_dsp_proc_init
(paren
id|snd_card_t
op_star
id|card
comma
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|snd_info_entry_t
op_star
id|entry
suffix:semicolon
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
r_int
id|i
suffix:semicolon
id|ins-&gt;snd_card
op_assign
id|card
suffix:semicolon
r_if
c_cond
(paren
(paren
id|entry
op_assign
id|snd_info_create_card_entry
c_func
(paren
id|card
comma
l_string|&quot;dsp&quot;
comma
id|card-&gt;proc_root
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|entry-&gt;content
op_assign
id|SNDRV_INFO_CONTENT_TEXT
suffix:semicolon
id|entry-&gt;mode
op_assign
id|S_IFDIR
op_or
id|S_IRUGO
op_or
id|S_IXUGO
suffix:semicolon
id|entry-&gt;c.text.read_size
op_assign
l_int|512
suffix:semicolon
r_if
c_cond
(paren
id|snd_info_register
c_func
(paren
id|entry
)paren
OL
l_int|0
)paren
(brace
id|snd_info_free_entry
c_func
(paren
id|entry
)paren
suffix:semicolon
id|entry
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|ins-&gt;proc_dsp_dir
op_assign
id|entry
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ins-&gt;proc_dsp_dir
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
(paren
id|entry
op_assign
id|snd_info_create_card_entry
c_func
(paren
id|card
comma
l_string|&quot;spos_symbols&quot;
comma
id|ins-&gt;proc_dsp_dir
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|entry-&gt;content
op_assign
id|SNDRV_INFO_CONTENT_TEXT
suffix:semicolon
id|entry-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|entry-&gt;mode
op_assign
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IWUSR
suffix:semicolon
id|entry-&gt;c.text.read_size
op_assign
l_int|512
suffix:semicolon
id|entry-&gt;c.text.read
op_assign
id|cs46xx_dsp_proc_symbol_table_read
suffix:semicolon
r_if
c_cond
(paren
id|snd_info_register
c_func
(paren
id|entry
)paren
OL
l_int|0
)paren
(brace
id|snd_info_free_entry
c_func
(paren
id|entry
)paren
suffix:semicolon
id|entry
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|ins-&gt;proc_sym_info_entry
op_assign
id|entry
suffix:semicolon
r_if
c_cond
(paren
(paren
id|entry
op_assign
id|snd_info_create_card_entry
c_func
(paren
id|card
comma
l_string|&quot;spos_modules&quot;
comma
id|ins-&gt;proc_dsp_dir
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|entry-&gt;content
op_assign
id|SNDRV_INFO_CONTENT_TEXT
suffix:semicolon
id|entry-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|entry-&gt;mode
op_assign
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IWUSR
suffix:semicolon
id|entry-&gt;c.text.read_size
op_assign
l_int|512
suffix:semicolon
id|entry-&gt;c.text.read
op_assign
id|cs46xx_dsp_proc_modules_read
suffix:semicolon
r_if
c_cond
(paren
id|snd_info_register
c_func
(paren
id|entry
)paren
OL
l_int|0
)paren
(brace
id|snd_info_free_entry
c_func
(paren
id|entry
)paren
suffix:semicolon
id|entry
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|ins-&gt;proc_modules_info_entry
op_assign
id|entry
suffix:semicolon
r_if
c_cond
(paren
(paren
id|entry
op_assign
id|snd_info_create_card_entry
c_func
(paren
id|card
comma
l_string|&quot;parameter&quot;
comma
id|ins-&gt;proc_dsp_dir
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|entry-&gt;content
op_assign
id|SNDRV_INFO_CONTENT_TEXT
suffix:semicolon
id|entry-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|entry-&gt;mode
op_assign
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IWUSR
suffix:semicolon
id|entry-&gt;c.text.read_size
op_assign
l_int|512
suffix:semicolon
id|entry-&gt;c.text.read
op_assign
id|cs46xx_dsp_proc_parameter_dump_read
suffix:semicolon
r_if
c_cond
(paren
id|snd_info_register
c_func
(paren
id|entry
)paren
OL
l_int|0
)paren
(brace
id|snd_info_free_entry
c_func
(paren
id|entry
)paren
suffix:semicolon
id|entry
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|ins-&gt;proc_parameter_dump_info_entry
op_assign
id|entry
suffix:semicolon
r_if
c_cond
(paren
(paren
id|entry
op_assign
id|snd_info_create_card_entry
c_func
(paren
id|card
comma
l_string|&quot;sample&quot;
comma
id|ins-&gt;proc_dsp_dir
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|entry-&gt;content
op_assign
id|SNDRV_INFO_CONTENT_TEXT
suffix:semicolon
id|entry-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|entry-&gt;mode
op_assign
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IWUSR
suffix:semicolon
id|entry-&gt;c.text.read_size
op_assign
l_int|512
suffix:semicolon
id|entry-&gt;c.text.read
op_assign
id|cs46xx_dsp_proc_sample_dump_read
suffix:semicolon
r_if
c_cond
(paren
id|snd_info_register
c_func
(paren
id|entry
)paren
OL
l_int|0
)paren
(brace
id|snd_info_free_entry
c_func
(paren
id|entry
)paren
suffix:semicolon
id|entry
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|ins-&gt;proc_sample_dump_info_entry
op_assign
id|entry
suffix:semicolon
r_if
c_cond
(paren
(paren
id|entry
op_assign
id|snd_info_create_card_entry
c_func
(paren
id|card
comma
l_string|&quot;task_tree&quot;
comma
id|ins-&gt;proc_dsp_dir
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|entry-&gt;content
op_assign
id|SNDRV_INFO_CONTENT_TEXT
suffix:semicolon
id|entry-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|entry-&gt;mode
op_assign
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IWUSR
suffix:semicolon
id|entry-&gt;c.text.read_size
op_assign
l_int|512
suffix:semicolon
id|entry-&gt;c.text.read
op_assign
id|cs46xx_dsp_proc_task_tree_read
suffix:semicolon
r_if
c_cond
(paren
id|snd_info_register
c_func
(paren
id|entry
)paren
OL
l_int|0
)paren
(brace
id|snd_info_free_entry
c_func
(paren
id|entry
)paren
suffix:semicolon
id|entry
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|ins-&gt;proc_task_info_entry
op_assign
id|entry
suffix:semicolon
r_if
c_cond
(paren
(paren
id|entry
op_assign
id|snd_info_create_card_entry
c_func
(paren
id|card
comma
l_string|&quot;scb_info&quot;
comma
id|ins-&gt;proc_dsp_dir
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|entry-&gt;content
op_assign
id|SNDRV_INFO_CONTENT_TEXT
suffix:semicolon
id|entry-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|entry-&gt;mode
op_assign
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IWUSR
suffix:semicolon
id|entry-&gt;c.text.read_size
op_assign
l_int|1024
suffix:semicolon
id|entry-&gt;c.text.read
op_assign
id|cs46xx_dsp_proc_scb_read
suffix:semicolon
r_if
c_cond
(paren
id|snd_info_register
c_func
(paren
id|entry
)paren
OL
l_int|0
)paren
(brace
id|snd_info_free_entry
c_func
(paren
id|entry
)paren
suffix:semicolon
id|entry
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|ins-&gt;proc_scb_info_entry
op_assign
id|entry
suffix:semicolon
id|down
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
multiline_comment|/* register/update SCB&squot;s entries on proc */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ins-&gt;nscb
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|ins-&gt;scbs
(braket
id|i
)braket
dot
id|deleted
)paren
r_continue
suffix:semicolon
id|cs46xx_dsp_proc_register_scb_desc
(paren
id|chip
comma
(paren
id|ins-&gt;scbs
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_proc_done
r_int
id|cs46xx_dsp_proc_done
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;proc_sym_info_entry
)paren
(brace
id|snd_info_unregister
c_func
(paren
id|ins-&gt;proc_sym_info_entry
)paren
suffix:semicolon
id|ins-&gt;proc_sym_info_entry
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ins-&gt;proc_modules_info_entry
)paren
(brace
id|snd_info_unregister
c_func
(paren
id|ins-&gt;proc_modules_info_entry
)paren
suffix:semicolon
id|ins-&gt;proc_modules_info_entry
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ins-&gt;proc_parameter_dump_info_entry
)paren
(brace
id|snd_info_unregister
c_func
(paren
id|ins-&gt;proc_parameter_dump_info_entry
)paren
suffix:semicolon
id|ins-&gt;proc_parameter_dump_info_entry
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ins-&gt;proc_sample_dump_info_entry
)paren
(brace
id|snd_info_unregister
c_func
(paren
id|ins-&gt;proc_sample_dump_info_entry
)paren
suffix:semicolon
id|ins-&gt;proc_sample_dump_info_entry
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ins-&gt;proc_scb_info_entry
)paren
(brace
id|snd_info_unregister
c_func
(paren
id|ins-&gt;proc_scb_info_entry
)paren
suffix:semicolon
id|ins-&gt;proc_scb_info_entry
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ins-&gt;proc_task_info_entry
)paren
(brace
id|snd_info_unregister
c_func
(paren
id|ins-&gt;proc_task_info_entry
)paren
suffix:semicolon
id|ins-&gt;proc_task_info_entry
op_assign
l_int|NULL
suffix:semicolon
)brace
id|down
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ins-&gt;nscb
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|ins-&gt;scbs
(braket
id|i
)braket
dot
id|deleted
)paren
r_continue
suffix:semicolon
id|cs46xx_dsp_proc_free_scb_desc
(paren
(paren
id|ins-&gt;scbs
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;proc_dsp_dir
)paren
(brace
id|snd_info_unregister
(paren
id|ins-&gt;proc_dsp_dir
)paren
suffix:semicolon
id|ins-&gt;proc_dsp_dir
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|debug_tree
r_static
r_int
id|debug_tree
suffix:semicolon
DECL|function|_dsp_create_task_tree
r_static
r_void
id|_dsp_create_task_tree
(paren
id|cs46xx_t
op_star
id|chip
comma
id|u32
op_star
id|task_data
comma
id|u32
id|dest
comma
r_int
id|size
)paren
(brace
r_int
r_int
id|spdst
op_assign
id|chip-&gt;region.idx
(braket
l_int|1
)braket
dot
id|remap_addr
op_plus
id|DSP_PARAMETER_BYTE_OFFSET
op_plus
id|dest
op_star
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|debug_tree
)paren
id|printk
(paren
l_string|&quot;addr %08x, val %08x&bslash;n&quot;
comma
(paren
r_int
)paren
id|spdst
comma
id|task_data
(braket
id|i
)braket
)paren
suffix:semicolon
id|writel
c_func
(paren
id|task_data
(braket
id|i
)braket
comma
id|spdst
)paren
suffix:semicolon
id|spdst
op_add_assign
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
)brace
)brace
DECL|variable|debug_scb
r_static
r_int
id|debug_scb
suffix:semicolon
DECL|function|_dsp_create_scb
r_static
r_void
id|_dsp_create_scb
(paren
id|cs46xx_t
op_star
id|chip
comma
id|u32
op_star
id|scb_data
comma
id|u32
id|dest
)paren
(brace
r_int
r_int
id|spdst
op_assign
id|chip-&gt;region.idx
(braket
l_int|1
)braket
dot
id|remap_addr
op_plus
id|DSP_PARAMETER_BYTE_OFFSET
op_plus
id|dest
op_star
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x10
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|debug_scb
)paren
id|printk
(paren
l_string|&quot;addr %08x, val %08x&bslash;n&quot;
comma
(paren
r_int
)paren
id|spdst
comma
id|scb_data
(braket
id|i
)braket
)paren
suffix:semicolon
id|writel
c_func
(paren
id|scb_data
(braket
id|i
)braket
comma
id|spdst
)paren
suffix:semicolon
id|spdst
op_add_assign
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
)brace
)brace
DECL|function|find_free_scb_index
r_static
r_int
id|find_free_scb_index
(paren
id|dsp_spos_instance_t
op_star
id|ins
)paren
(brace
r_int
id|index
op_assign
id|ins-&gt;nscb
comma
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|ins-&gt;scb_highest_frag_index
suffix:semicolon
id|i
OL
id|ins-&gt;nscb
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|ins-&gt;scbs
(braket
id|i
)braket
dot
id|deleted
)paren
(brace
id|index
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
id|index
suffix:semicolon
)brace
DECL|function|_map_scb
r_static
id|dsp_scb_descriptor_t
op_star
id|_map_scb
(paren
id|cs46xx_t
op_star
id|chip
comma
r_char
op_star
id|name
comma
id|u32
id|dest
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|desc
op_assign
l_int|NULL
suffix:semicolon
r_int
id|index
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;nscb
op_eq
id|DSP_MAX_SCB_DESC
op_minus
l_int|1
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: got no place for other SCB&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|index
op_assign
id|find_free_scb_index
(paren
id|ins
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|ins-&gt;scbs
(braket
id|index
)braket
dot
id|scb_name
comma
id|name
)paren
suffix:semicolon
id|ins-&gt;scbs
(braket
id|index
)braket
dot
id|address
op_assign
id|dest
suffix:semicolon
id|ins-&gt;scbs
(braket
id|index
)braket
dot
id|index
op_assign
id|index
suffix:semicolon
id|ins-&gt;scbs
(braket
id|index
)braket
dot
id|proc_info
op_assign
l_int|NULL
suffix:semicolon
id|ins-&gt;scbs
(braket
id|index
)braket
dot
id|ref_count
op_assign
l_int|1
suffix:semicolon
id|ins-&gt;scbs
(braket
id|index
)braket
dot
id|deleted
op_assign
l_int|0
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|ins-&gt;scbs
(braket
id|index
)braket
dot
id|lock
)paren
suffix:semicolon
id|desc
op_assign
(paren
id|ins-&gt;scbs
op_plus
id|index
)paren
suffix:semicolon
id|ins-&gt;scbs
(braket
id|index
)braket
dot
id|scb_symbol
op_assign
id|add_symbol
(paren
id|chip
comma
id|name
comma
id|dest
comma
id|SYMBOL_PARAMETER
)paren
suffix:semicolon
r_if
c_cond
(paren
id|index
OG
id|ins-&gt;scb_highest_frag_index
)paren
id|ins-&gt;scb_highest_frag_index
op_assign
id|index
suffix:semicolon
r_if
c_cond
(paren
id|index
op_eq
id|ins-&gt;nscb
)paren
id|ins-&gt;nscb
op_increment
suffix:semicolon
r_return
id|desc
suffix:semicolon
)brace
DECL|function|_map_task_tree
r_static
id|dsp_task_descriptor_t
op_star
id|_map_task_tree
(paren
id|cs46xx_t
op_star
id|chip
comma
r_char
op_star
id|name
comma
id|u32
id|dest
comma
id|u32
id|size
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|dsp_task_descriptor_t
op_star
id|desc
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;ntask
op_eq
id|DSP_MAX_TASK_DESC
op_minus
l_int|1
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: got no place for other TASK&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|ins-&gt;tasks
(braket
id|ins-&gt;ntask
)braket
dot
id|task_name
comma
id|name
)paren
suffix:semicolon
id|ins-&gt;tasks
(braket
id|ins-&gt;ntask
)braket
dot
id|address
op_assign
id|dest
suffix:semicolon
id|ins-&gt;tasks
(braket
id|ins-&gt;ntask
)braket
dot
id|size
op_assign
id|size
suffix:semicolon
multiline_comment|/* quick find in list */
id|ins-&gt;tasks
(braket
id|ins-&gt;ntask
)braket
dot
id|index
op_assign
id|ins-&gt;ntask
suffix:semicolon
id|desc
op_assign
(paren
id|ins-&gt;tasks
op_plus
id|ins-&gt;ntask
)paren
suffix:semicolon
id|ins-&gt;ntask
op_increment
suffix:semicolon
id|add_symbol
(paren
id|chip
comma
id|name
comma
id|dest
comma
id|SYMBOL_PARAMETER
)paren
suffix:semicolon
r_return
id|desc
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_create_scb
id|dsp_scb_descriptor_t
op_star
id|cs46xx_dsp_create_scb
(paren
id|cs46xx_t
op_star
id|chip
comma
r_char
op_star
id|name
comma
id|u32
op_star
id|scb_data
comma
id|u32
id|dest
)paren
(brace
id|dsp_scb_descriptor_t
op_star
id|desc
suffix:semicolon
id|desc
op_assign
id|_map_scb
(paren
id|chip
comma
id|name
comma
id|dest
)paren
suffix:semicolon
r_if
c_cond
(paren
id|desc
)paren
(brace
id|_dsp_create_scb
c_func
(paren
id|chip
comma
id|scb_data
comma
id|dest
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: failed to map SCB&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|desc
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_create_task_tree
id|dsp_task_descriptor_t
op_star
id|cs46xx_dsp_create_task_tree
(paren
id|cs46xx_t
op_star
id|chip
comma
r_char
op_star
id|name
comma
id|u32
op_star
id|task_data
comma
id|u32
id|dest
comma
r_int
id|size
)paren
(brace
id|dsp_task_descriptor_t
op_star
id|desc
suffix:semicolon
id|desc
op_assign
id|_map_task_tree
(paren
id|chip
comma
id|name
comma
id|dest
comma
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|desc
)paren
(brace
id|_dsp_create_task_tree
c_func
(paren
id|chip
comma
id|task_data
comma
id|dest
comma
id|size
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: failed to map TASK&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|desc
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_scb_and_task_init
r_int
id|cs46xx_dsp_scb_and_task_init
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|symbol_entry_t
op_star
id|fg_task_tree_header_code
suffix:semicolon
id|symbol_entry_t
op_star
id|task_tree_header_code
suffix:semicolon
id|symbol_entry_t
op_star
id|task_tree_thread
suffix:semicolon
id|symbol_entry_t
op_star
id|null_algorithm
suffix:semicolon
id|symbol_entry_t
op_star
id|magic_snoop_task
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|timing_master_scb
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|codec_out_scb
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|codec_in_scb
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|src_task_scb
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|master_mix_scb
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|rear_mix_scb
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|record_mix_scb
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|write_back_scb
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|vari_decimate_scb
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|rear_codec_out_scb
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|clfe_codec_out_scb
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|magic_snoop_scb
suffix:semicolon
r_int
id|fifo_addr
comma
id|fifo_span
comma
id|valid_slots
suffix:semicolon
id|spos_control_block_t
id|sposcb
op_assign
(brace
multiline_comment|/* 0 */
id|HFG_TREE_SCB
comma
id|HFG_STACK
comma
multiline_comment|/* 1 */
id|SPOSCB_ADDR
comma
id|BG_TREE_SCB_ADDR
comma
multiline_comment|/* 2 */
id|DSP_SPOS_DC
comma
l_int|0
comma
multiline_comment|/* 3 */
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
comma
multiline_comment|/* 4 */
l_int|0
comma
l_int|0
comma
multiline_comment|/* 5 */
id|DSP_SPOS_UU
comma
l_int|0
comma
multiline_comment|/* 6 */
id|FG_TASK_HEADER_ADDR
comma
l_int|0
comma
multiline_comment|/* 7 */
l_int|0
comma
l_int|0
comma
multiline_comment|/* 8 */
id|DSP_SPOS_UU
comma
id|DSP_SPOS_DC
comma
multiline_comment|/* 9 */
l_int|0
comma
multiline_comment|/* A */
l_int|0
comma
id|HFG_FIRST_EXECUTE_MODE
comma
multiline_comment|/* B */
id|DSP_SPOS_UU
comma
id|DSP_SPOS_UU
comma
multiline_comment|/* C */
id|DSP_SPOS_DC_DC
comma
multiline_comment|/* D */
id|DSP_SPOS_DC_DC
comma
multiline_comment|/* E */
id|DSP_SPOS_DC_DC
comma
multiline_comment|/* F */
id|DSP_SPOS_DC_DC
)brace
suffix:semicolon
id|cs46xx_dsp_create_task_tree
c_func
(paren
id|chip
comma
l_string|&quot;sposCB&quot;
comma
(paren
id|u32
op_star
)paren
op_amp
id|sposcb
comma
id|SPOSCB_ADDR
comma
l_int|0x10
)paren
suffix:semicolon
id|null_algorithm
op_assign
id|cs46xx_dsp_lookup_symbol
c_func
(paren
id|chip
comma
l_string|&quot;NULLALGORITHM&quot;
comma
id|SYMBOL_CODE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|null_algorithm
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: symbol NULLALGORITHM not found&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|fg_task_tree_header_code
op_assign
id|cs46xx_dsp_lookup_symbol
c_func
(paren
id|chip
comma
l_string|&quot;FGTASKTREEHEADERCODE&quot;
comma
id|SYMBOL_CODE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fg_task_tree_header_code
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: symbol FGTASKTREEHEADERCODE not found&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|task_tree_header_code
op_assign
id|cs46xx_dsp_lookup_symbol
c_func
(paren
id|chip
comma
l_string|&quot;TASKTREEHEADERCODE&quot;
comma
id|SYMBOL_CODE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|task_tree_header_code
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: symbol TASKTREEHEADERCODE not found&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|task_tree_thread
op_assign
id|cs46xx_dsp_lookup_symbol
c_func
(paren
id|chip
comma
l_string|&quot;TASKTREETHREAD&quot;
comma
id|SYMBOL_CODE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|task_tree_thread
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: symbol TASKTREETHREAD not found&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|magic_snoop_task
op_assign
id|cs46xx_dsp_lookup_symbol
c_func
(paren
id|chip
comma
l_string|&quot;MAGICSNOOPTASK&quot;
comma
id|SYMBOL_CODE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|magic_snoop_task
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: symbol MAGICSNOOPTASK not found&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
(brace
multiline_comment|/* create the null SCB */
id|generic_scb_t
id|null_scb
op_assign
(brace
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
id|NULL_SCB_ADDR
comma
id|NULL_SCB_ADDR
comma
id|null_algorithm-&gt;address
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
)brace
suffix:semicolon
id|ins-&gt;the_null_scb
op_assign
id|cs46xx_dsp_create_scb
c_func
(paren
id|chip
comma
l_string|&quot;nullSCB&quot;
comma
(paren
id|u32
op_star
)paren
op_amp
id|null_scb
comma
id|NULL_SCB_ADDR
)paren
suffix:semicolon
id|ins-&gt;the_null_scb-&gt;task_entry
op_assign
id|null_algorithm
suffix:semicolon
id|ins-&gt;the_null_scb-&gt;sub_list_ptr
op_assign
id|ins-&gt;the_null_scb
suffix:semicolon
id|ins-&gt;the_null_scb-&gt;next_scb_ptr
op_assign
id|ins-&gt;the_null_scb
suffix:semicolon
id|ins-&gt;the_null_scb-&gt;parent_scb_ptr
op_assign
l_int|NULL
suffix:semicolon
id|cs46xx_dsp_proc_register_scb_desc
(paren
id|chip
comma
id|ins-&gt;the_null_scb
)paren
suffix:semicolon
)brace
(brace
multiline_comment|/* setup foreground task tree */
id|task_tree_control_block_t
id|fg_task_tree_hdr
op_assign
(brace
(brace
id|FG_TASK_HEADER_ADDR
op_or
(paren
id|DSP_SPOS_DC
op_lshift
l_int|0x10
)paren
comma
id|DSP_SPOS_DC_DC
comma
id|DSP_SPOS_DC_DC
comma
l_int|0x0000
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC_DC
comma
id|DSP_SPOS_DC_DC
comma
id|DSP_SPOS_DC_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
)brace
comma
(brace
id|BG_TREE_SCB_ADDR
comma
id|TIMINGMASTER_SCB_ADDR
comma
id|fg_task_tree_header_code-&gt;address
comma
id|FG_TASK_HEADER_ADDR
op_plus
id|TCBData
comma
)brace
comma
(brace
l_int|4
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|2
comma
id|SPOSCB_ADDR
op_plus
id|HFGFlags
comma
l_int|0
comma
l_int|0
comma
id|FG_TASK_HEADER_ADDR
op_plus
id|TCBContextBlk
comma
id|FG_STACK
)brace
comma
(brace
id|DSP_SPOS_DC
comma
id|task_tree_thread-&gt;address
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_UU
comma
l_int|1
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
)brace
comma
(brace
id|FG_INTERVAL_TIMER_PERIOD
comma
id|DSP_SPOS_UU
comma
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
id|cs46xx_dsp_create_task_tree
c_func
(paren
id|chip
comma
l_string|&quot;FGtaskTreeHdr&quot;
comma
(paren
id|u32
op_star
)paren
op_amp
id|fg_task_tree_hdr
comma
id|FG_TASK_HEADER_ADDR
comma
l_int|0x35
)paren
suffix:semicolon
)brace
(brace
multiline_comment|/* setup foreground task tree */
id|task_tree_control_block_t
id|bg_task_tree_hdr
op_assign
(brace
(brace
id|DSP_SPOS_DC_DC
comma
id|DSP_SPOS_DC_DC
comma
id|DSP_SPOS_DC_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC_DC
comma
id|DSP_SPOS_DC_DC
comma
id|DSP_SPOS_DC_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
)brace
comma
(brace
id|NULL_SCB_ADDR
comma
id|NULL_SCB_ADDR
comma
multiline_comment|/* Set up the background to do nothing */
id|task_tree_header_code-&gt;address
comma
id|BG_TREE_SCB_ADDR
op_plus
id|TCBData
comma
)brace
comma
(brace
l_int|9999
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
id|SPOSCB_ADDR
op_plus
id|HFGFlags
comma
l_int|0
comma
l_int|0
comma
id|BG_TREE_SCB_ADDR
op_plus
id|TCBContextBlk
comma
id|BG_STACK
)brace
comma
(brace
id|DSP_SPOS_DC
comma
id|task_tree_thread-&gt;address
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_UU
comma
l_int|1
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
comma
id|DSP_SPOS_DCDC
)brace
comma
(brace
id|BG_INTERVAL_TIMER_PERIOD
comma
id|DSP_SPOS_UU
comma
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
id|cs46xx_dsp_create_task_tree
c_func
(paren
id|chip
comma
l_string|&quot;BGtaskTreeHdr&quot;
comma
(paren
id|u32
op_star
)paren
op_amp
id|bg_task_tree_hdr
comma
id|BG_TREE_SCB_ADDR
comma
l_int|0x35
)paren
suffix:semicolon
)brace
multiline_comment|/* create timing master SCB */
id|timing_master_scb
op_assign
id|cs46xx_dsp_create_timing_master_scb
c_func
(paren
id|chip
)paren
suffix:semicolon
multiline_comment|/* create the CODEC output task */
id|codec_out_scb
op_assign
id|cs46xx_dsp_create_codec_out_scb
c_func
(paren
id|chip
comma
l_string|&quot;CodecOutSCB_I&quot;
comma
l_int|0x0010
comma
l_int|0x0000
comma
id|MASTERMIX_SCB_ADDR
comma
id|CODECOUT_SCB_ADDR
comma
id|timing_master_scb
comma
id|SCB_ON_PARENT_SUBLIST_SCB
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|codec_out_scb
)paren
r_goto
id|_fail_end
suffix:semicolon
multiline_comment|/* create the master mix SCB */
id|master_mix_scb
op_assign
id|cs46xx_dsp_create_mix_only_scb
c_func
(paren
id|chip
comma
l_string|&quot;MasterMixSCB&quot;
comma
id|MIX_SAMPLE_BUF1
comma
id|MASTERMIX_SCB_ADDR
comma
id|codec_out_scb
comma
id|SCB_ON_PARENT_SUBLIST_SCB
)paren
suffix:semicolon
id|ins-&gt;master_mix_scb
op_assign
id|master_mix_scb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|master_mix_scb
)paren
r_goto
id|_fail_end
suffix:semicolon
multiline_comment|/* create codec in */
id|codec_in_scb
op_assign
id|cs46xx_dsp_create_codec_in_scb
c_func
(paren
id|chip
comma
l_string|&quot;CodecInSCB&quot;
comma
l_int|0x0010
comma
l_int|0x00A0
comma
id|CODEC_INPUT_BUF1
comma
id|CODECIN_SCB_ADDR
comma
id|codec_out_scb
comma
id|SCB_ON_PARENT_NEXT_SCB
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|codec_in_scb
)paren
r_goto
id|_fail_end
suffix:semicolon
id|ins-&gt;codec_in_scb
op_assign
id|codec_in_scb
suffix:semicolon
multiline_comment|/* create write back scb */
id|write_back_scb
op_assign
id|cs46xx_dsp_create_mix_to_ostream_scb
c_func
(paren
id|chip
comma
l_string|&quot;WriteBackSCB&quot;
comma
id|WRITE_BACK_BUF1
comma
id|WRITE_BACK_SPB
comma
id|WRITEBACK_SCB_ADDR
comma
id|timing_master_scb
comma
id|SCB_ON_PARENT_NEXT_SCB
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|write_back_scb
)paren
r_goto
id|_fail_end
suffix:semicolon
(brace
id|mix2_ostream_spb_t
id|mix2_ostream_spb
op_assign
(brace
l_int|0x00020000
comma
l_int|0x0000ffff
)brace
suffix:semicolon
multiline_comment|/* dirty hack ... */
id|_dsp_create_task_tree
(paren
id|chip
comma
(paren
id|u32
op_star
)paren
op_amp
id|mix2_ostream_spb
comma
id|WRITE_BACK_SPB
comma
l_int|2
)paren
suffix:semicolon
)brace
multiline_comment|/* input sample converter */
id|vari_decimate_scb
op_assign
id|cs46xx_dsp_create_vari_decimate_scb
c_func
(paren
id|chip
comma
l_string|&quot;VariDecimateSCB&quot;
comma
id|VARI_DECIMATE_BUF0
comma
id|VARI_DECIMATE_BUF1
comma
id|VARIDECIMATE_SCB_ADDR
comma
id|write_back_scb
comma
id|SCB_ON_PARENT_SUBLIST_SCB
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vari_decimate_scb
)paren
r_goto
id|_fail_end
suffix:semicolon
multiline_comment|/* create the record mixer SCB */
id|record_mix_scb
op_assign
id|cs46xx_dsp_create_mix_only_scb
c_func
(paren
id|chip
comma
l_string|&quot;RecordMixerSCB&quot;
comma
id|MIX_SAMPLE_BUF2
comma
id|RECORD_MIXER_SCB_ADDR
comma
id|vari_decimate_scb
comma
id|SCB_ON_PARENT_SUBLIST_SCB
)paren
suffix:semicolon
id|ins-&gt;record_mixer_scb
op_assign
id|record_mix_scb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|record_mix_scb
)paren
r_goto
id|_fail_end
suffix:semicolon
id|valid_slots
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACOSV
)paren
suffix:semicolon
id|snd_assert
(paren
id|chip-&gt;nr_ac97_codecs
op_eq
l_int|1
op_logical_or
id|chip-&gt;nr_ac97_codecs
op_eq
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;nr_ac97_codecs
op_eq
l_int|1
)paren
(brace
multiline_comment|/* output on slot 5 and 11 &n;&t;&t;   on primary CODEC */
id|fifo_addr
op_assign
l_int|0x20
suffix:semicolon
id|fifo_span
op_assign
l_int|0x60
suffix:semicolon
multiline_comment|/* enable slot 5 and 11 */
id|valid_slots
op_or_assign
id|ACOSV_SLV5
op_or
id|ACOSV_SLV11
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* output on slot 7 and 8 &n;&t;&t;   on secondary CODEC */
id|fifo_addr
op_assign
l_int|0x40
suffix:semicolon
id|fifo_span
op_assign
l_int|0x10
suffix:semicolon
multiline_comment|/* enable slot 7 and 8 */
id|valid_slots
op_or_assign
id|ACOSV_SLV7
op_or
id|ACOSV_SLV8
suffix:semicolon
)brace
multiline_comment|/* create CODEC tasklet for rear speakers output*/
id|rear_codec_out_scb
op_assign
id|cs46xx_dsp_create_codec_out_scb
c_func
(paren
id|chip
comma
l_string|&quot;CodecOutSCB_Rear&quot;
comma
id|fifo_span
comma
id|fifo_addr
comma
id|REAR_MIXER_SCB_ADDR
comma
id|REAR_CODECOUT_SCB_ADDR
comma
id|codec_in_scb
comma
id|SCB_ON_PARENT_NEXT_SCB
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rear_codec_out_scb
)paren
r_goto
id|_fail_end
suffix:semicolon
multiline_comment|/* create the rear PCM channel  mixer SCB */
id|rear_mix_scb
op_assign
id|cs46xx_dsp_create_mix_only_scb
c_func
(paren
id|chip
comma
l_string|&quot;RearMixerSCB&quot;
comma
id|MIX_SAMPLE_BUF3
comma
id|REAR_MIXER_SCB_ADDR
comma
id|rear_codec_out_scb
comma
id|SCB_ON_PARENT_SUBLIST_SCB
)paren
suffix:semicolon
id|ins-&gt;rear_mix_scb
op_assign
id|rear_mix_scb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rear_mix_scb
)paren
r_goto
id|_fail_end
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;nr_ac97_codecs
op_eq
l_int|2
)paren
(brace
multiline_comment|/* create CODEC tasklet for rear Center/LFE output &n;&t;&t;   slot 6 and 9 on seconadry CODEC */
id|clfe_codec_out_scb
op_assign
id|cs46xx_dsp_create_codec_out_scb
c_func
(paren
id|chip
comma
l_string|&quot;CodecOutSCB_CLFE&quot;
comma
l_int|0x0030
comma
l_int|0x0030
comma
id|CLFE_MIXER_SCB_ADDR
comma
id|CLFE_CODEC_SCB_ADDR
comma
id|rear_codec_out_scb
comma
id|SCB_ON_PARENT_NEXT_SCB
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|clfe_codec_out_scb
)paren
r_goto
id|_fail_end
suffix:semicolon
multiline_comment|/* create the rear PCM channel  mixer SCB */
id|ins-&gt;center_lfe_mix_scb
op_assign
id|cs46xx_dsp_create_mix_only_scb
c_func
(paren
id|chip
comma
l_string|&quot;CLFEMixerSCB&quot;
comma
id|MIX_SAMPLE_BUF4
comma
id|CLFE_MIXER_SCB_ADDR
comma
id|clfe_codec_out_scb
comma
id|SCB_ON_PARENT_SUBLIST_SCB
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ins-&gt;center_lfe_mix_scb
)paren
r_goto
id|_fail_end
suffix:semicolon
multiline_comment|/* enable slot 6 and 9 */
id|valid_slots
op_or_assign
id|ACOSV_SLV6
op_or
id|ACOSV_SLV9
suffix:semicolon
)brace
r_else
(brace
id|clfe_codec_out_scb
op_assign
id|rear_codec_out_scb
suffix:semicolon
id|ins-&gt;center_lfe_mix_scb
op_assign
id|rear_mix_scb
suffix:semicolon
)brace
multiline_comment|/* enable slots depending on CODEC configuration */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACOSV
comma
id|valid_slots
)paren
suffix:semicolon
multiline_comment|/* the magic snooper */
id|magic_snoop_scb
op_assign
id|cs46xx_dsp_create_magic_snoop_scb
(paren
id|chip
comma
l_string|&quot;MagicSnoopSCB_I&quot;
comma
id|OUTPUTSNOOP_SCB_ADDR
comma
id|OUTPUT_SNOOP_BUFFER
comma
id|codec_out_scb
comma
id|clfe_codec_out_scb
comma
id|SCB_ON_PARENT_NEXT_SCB
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|magic_snoop_scb
)paren
r_goto
id|_fail_end
suffix:semicolon
id|ins-&gt;ref_snoop_scb
op_assign
id|magic_snoop_scb
suffix:semicolon
multiline_comment|/* SP IO access */
r_if
c_cond
(paren
op_logical_neg
id|cs46xx_dsp_create_spio_write_scb
c_func
(paren
id|chip
comma
l_string|&quot;SPIOWriteSCB&quot;
comma
id|SPIOWRITE_SCB_ADDR
comma
id|magic_snoop_scb
comma
id|SCB_ON_PARENT_NEXT_SCB
)paren
)paren
r_goto
id|_fail_end
suffix:semicolon
multiline_comment|/* SPDIF input sampel rate converter */
id|src_task_scb
op_assign
id|cs46xx_dsp_create_src_task_scb
c_func
(paren
id|chip
comma
l_string|&quot;SrcTaskSCB_SPDIFI&quot;
comma
id|ins-&gt;spdif_in_sample_rate
comma
id|SRC_OUTPUT_BUF1
comma
id|SRC_DELAY_BUF1
comma
id|SRCTASK_SCB_ADDR
comma
id|master_mix_scb
comma
id|SCB_ON_PARENT_SUBLIST_SCB
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|src_task_scb
)paren
r_goto
id|_fail_end
suffix:semicolon
id|cs46xx_src_unlink
c_func
(paren
id|chip
comma
id|src_task_scb
)paren
suffix:semicolon
multiline_comment|/* NOTE: when we now how to detect the SPDIF input&n;&t;   sample rate we will use this SRC to adjust it */
id|ins-&gt;spdif_in_src
op_assign
id|src_task_scb
suffix:semicolon
id|cs46xx_dsp_async_init
c_func
(paren
id|chip
comma
id|timing_master_scb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|_fail_end
suffix:colon
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: failed to setup SCB&squot;s in DSP&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_async_init
r_int
id|cs46xx_dsp_async_init
(paren
id|cs46xx_t
op_star
id|chip
comma
id|dsp_scb_descriptor_t
op_star
id|fg_entry
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|symbol_entry_t
op_star
id|s16_async_codec_input_task
suffix:semicolon
id|symbol_entry_t
op_star
id|spdifo_task
suffix:semicolon
id|symbol_entry_t
op_star
id|spdifi_task
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|spdifi_scb_desc
comma
op_star
id|spdifo_scb_desc
comma
op_star
id|async_codec_scb_desc
suffix:semicolon
id|s16_async_codec_input_task
op_assign
id|cs46xx_dsp_lookup_symbol
c_func
(paren
id|chip
comma
l_string|&quot;S16_ASYNCCODECINPUTTASK&quot;
comma
id|SYMBOL_CODE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s16_async_codec_input_task
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: symbol S16_ASYNCCODECINPUTTASK not found&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|spdifo_task
op_assign
id|cs46xx_dsp_lookup_symbol
c_func
(paren
id|chip
comma
l_string|&quot;SPDIFOTASK&quot;
comma
id|SYMBOL_CODE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|spdifo_task
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: symbol SPDIFOTASK not found&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|spdifi_task
op_assign
id|cs46xx_dsp_lookup_symbol
c_func
(paren
id|chip
comma
l_string|&quot;SPDIFITASK&quot;
comma
id|SYMBOL_CODE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|spdifi_task
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: symbol SPDIFITASK not found&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
(brace
multiline_comment|/* 0xBC0 */
id|spdifoscb_t
id|spdifo_scb
op_assign
(brace
multiline_comment|/* 0 */
id|DSP_SPOS_UUUU
comma
(brace
multiline_comment|/* 1 */
l_int|0xb0
comma
multiline_comment|/* 2 */
l_int|0
comma
multiline_comment|/* 3 */
l_int|0
comma
multiline_comment|/* 4 */
l_int|0
comma
)brace
comma
multiline_comment|/* NOTE: the SPDIF output task read samples in mono&n;&t;&t;&t;   format, the AsynchFGTxSCB task writes to buffer&n;&t;&t;&t;   in stereo format&n;&t;&t;&t;*/
multiline_comment|/* 5 */
id|RSCONFIG_SAMPLE_16MONO
op_plus
id|RSCONFIG_MODULO_256
comma
multiline_comment|/* 6 */
(paren
id|SPDIFO_IP_OUTPUT_BUFFER1
op_lshift
l_int|0x10
)paren
op_or
l_int|0xFFFC
comma
multiline_comment|/* 7 */
l_int|0
comma
l_int|0
comma
multiline_comment|/* 8 */
l_int|0
comma
multiline_comment|/* 9 */
id|FG_TASK_HEADER_ADDR
comma
id|NULL_SCB_ADDR
comma
multiline_comment|/* A */
id|spdifo_task-&gt;address
comma
id|SPDIFO_SCB_INST
op_plus
id|SPDIFOFIFOPointer
comma
(brace
multiline_comment|/* B */
l_int|0x0040
comma
multiline_comment|/*DSP_SPOS_UUUU,*/
multiline_comment|/* C */
l_int|0x20ff
comma
multiline_comment|/*DSP_SPOS_UUUU,*/
)brace
comma
multiline_comment|/* D */
l_int|0x804c
comma
l_int|0
comma
multiline_comment|/* SPDIFOFIFOPointer:SPDIFOStatRegAddr; */
multiline_comment|/* E */
l_int|0x0108
comma
l_int|0x0001
comma
multiline_comment|/* SPDIFOStMoFormat:SPDIFOFIFOBaseAddr; */
multiline_comment|/* F */
id|DSP_SPOS_UUUU
multiline_comment|/* SPDIFOFree; */
)brace
suffix:semicolon
multiline_comment|/* 0xBB0 */
id|spdifiscb_t
id|spdifi_scb
op_assign
(brace
multiline_comment|/* 0 */
id|DSP_SPOS_UULO
comma
id|DSP_SPOS_UUHI
comma
multiline_comment|/* 1 */
l_int|0
comma
multiline_comment|/* 2 */
l_int|0
comma
multiline_comment|/* 3 */
l_int|1
comma
l_int|4000
comma
multiline_comment|/* SPDIFICountLimit SPDIFICount */
multiline_comment|/* 4 */
id|DSP_SPOS_UUUU
comma
multiline_comment|/* SPDIFIStatusData */
multiline_comment|/* 5 */
l_int|0
comma
id|DSP_SPOS_UUHI
comma
multiline_comment|/* StatusData, Free4 */
multiline_comment|/* 6 */
id|DSP_SPOS_UUUU
comma
multiline_comment|/* Free3 */
multiline_comment|/* 7 */
id|DSP_SPOS_UU
comma
id|DSP_SPOS_DC
comma
multiline_comment|/* Free2 BitCount*/
multiline_comment|/* 8 */
id|DSP_SPOS_UUUU
comma
multiline_comment|/* TempStatus */
multiline_comment|/* 9 */
id|SPDIFO_SCB_INST
comma
id|NULL_SCB_ADDR
comma
multiline_comment|/* A */
id|spdifi_task-&gt;address
comma
id|SPDIFI_SCB_INST
op_plus
id|SPDIFIFIFOPointer
comma
multiline_comment|/* NOTE: The SPDIF input task write the sample in mono&n;&t;&t;&t;   format from the HW FIFO, the AsynchFGRxSCB task  reads &n;&t;&t;&t;   them in stereo &n;&t;&t;&t;*/
multiline_comment|/* B */
id|RSCONFIG_SAMPLE_16MONO
op_plus
id|RSCONFIG_MODULO_128
comma
multiline_comment|/* C */
(paren
id|SPDIFI_IP_OUTPUT_BUFFER1
op_lshift
l_int|0x10
)paren
op_or
l_int|0xFFFC
comma
multiline_comment|/* D */
l_int|0x8048
comma
l_int|0
comma
multiline_comment|/* E */
l_int|0x01f0
comma
l_int|0x0001
comma
multiline_comment|/* F */
id|DSP_SPOS_UUUU
multiline_comment|/* SPDIN_STATUS monitor */
)brace
suffix:semicolon
multiline_comment|/* 0xBA0 */
id|async_codec_input_scb_t
id|async_codec_input_scb
op_assign
(brace
multiline_comment|/* 0 */
id|DSP_SPOS_UUUU
comma
multiline_comment|/* 1 */
l_int|0
comma
multiline_comment|/* 2 */
l_int|0
comma
multiline_comment|/* 3 */
l_int|1
comma
l_int|4000
comma
multiline_comment|/* 4 */
l_int|0x0118
comma
l_int|0x0001
comma
multiline_comment|/* 5 */
id|RSCONFIG_SAMPLE_16MONO
op_plus
id|RSCONFIG_MODULO_64
comma
multiline_comment|/* 6 */
(paren
id|ASYNC_IP_OUTPUT_BUFFER1
op_lshift
l_int|0x10
)paren
op_or
l_int|0xFFFC
comma
multiline_comment|/* 7 */
id|DSP_SPOS_UU
comma
l_int|0x3
comma
multiline_comment|/* 8 */
id|DSP_SPOS_UUUU
comma
multiline_comment|/* 9 */
id|SPDIFI_SCB_INST
comma
id|NULL_SCB_ADDR
comma
multiline_comment|/* A */
id|s16_async_codec_input_task-&gt;address
comma
id|HFG_TREE_SCB
op_plus
id|AsyncCIOFIFOPointer
comma
multiline_comment|/* B */
id|RSCONFIG_SAMPLE_16STEREO
op_plus
id|RSCONFIG_MODULO_64
comma
multiline_comment|/* C */
(paren
id|ASYNC_IP_OUTPUT_BUFFER1
op_lshift
l_int|0x10
)paren
comma
multiline_comment|/*(ASYNC_IP_OUTPUT_BUFFER1 &lt;&lt; 0x10) | 0xFFFC,*/
macro_line|#ifdef UseASER1Input
multiline_comment|/* short AsyncCIFIFOPointer:AsyncCIStatRegAddr;&t;       &n;&t;&t;&t;   Init. 0000:8042: for ASER1&n;&t;&t;&t;   0000:8044: for ASER2 */
multiline_comment|/* D */
l_int|0x8042
comma
l_int|0
comma
multiline_comment|/* short AsyncCIStMoFormat:AsyncCIFIFOBaseAddr;&n;&t;&t;&t;   Init 1 stero:8050 ASER1&n;&t;&t;&t;   Init 0  mono:8070 ASER2&n;&t;&t;&t;   Init 1 Stereo : 0100 ASER1 (Set by script) */
multiline_comment|/* E */
l_int|0x0100
comma
l_int|0x0001
comma
macro_line|#endif
macro_line|#ifdef UseASER2Input
multiline_comment|/* short AsyncCIFIFOPointer:AsyncCIStatRegAddr;&n;&t;&t;&t;   Init. 0000:8042: for ASER1&n;&t;&t;&t;   0000:8044: for ASER2 */
multiline_comment|/* D */
l_int|0x8044
comma
l_int|0
comma
multiline_comment|/* short AsyncCIStMoFormat:AsyncCIFIFOBaseAddr;&n;&t;&t;&t;   Init 1 stero:8050 ASER1&n;&t;&t;&t;   Init 0  mono:8070 ASER2&n;&t;&t;&t;   Init 1 Stereo : 0100 ASER1 (Set by script) */
multiline_comment|/* E */
l_int|0x0110
comma
l_int|0x0001
comma
macro_line|#endif
multiline_comment|/* short AsyncCIOutputBufModulo:AsyncCIFree;&n;&t;&t;&t;   AsyncCIOutputBufModulo: The modulo size for   &n;&t;&t;&t;   the output buffer of this task */
multiline_comment|/* F */
l_int|0
comma
multiline_comment|/* DSP_SPOS_UUUU */
)brace
suffix:semicolon
id|spdifo_scb_desc
op_assign
id|cs46xx_dsp_create_scb
c_func
(paren
id|chip
comma
l_string|&quot;SPDIFOSCB&quot;
comma
(paren
id|u32
op_star
)paren
op_amp
id|spdifo_scb
comma
id|SPDIFO_SCB_INST
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|spdifo_scb_desc
comma
r_return
op_minus
id|EIO
)paren
suffix:semicolon
id|spdifi_scb_desc
op_assign
id|cs46xx_dsp_create_scb
c_func
(paren
id|chip
comma
l_string|&quot;SPDIFISCB&quot;
comma
(paren
id|u32
op_star
)paren
op_amp
id|spdifi_scb
comma
id|SPDIFI_SCB_INST
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|spdifi_scb_desc
comma
r_return
op_minus
id|EIO
)paren
suffix:semicolon
id|async_codec_scb_desc
op_assign
id|cs46xx_dsp_create_scb
c_func
(paren
id|chip
comma
l_string|&quot;AsynCodecInputSCB&quot;
comma
(paren
id|u32
op_star
)paren
op_amp
id|async_codec_input_scb
comma
id|HFG_TREE_SCB
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|async_codec_scb_desc
comma
r_return
op_minus
id|EIO
)paren
suffix:semicolon
id|async_codec_scb_desc-&gt;parent_scb_ptr
op_assign
l_int|NULL
suffix:semicolon
id|async_codec_scb_desc-&gt;next_scb_ptr
op_assign
id|spdifi_scb_desc
suffix:semicolon
id|async_codec_scb_desc-&gt;sub_list_ptr
op_assign
id|ins-&gt;the_null_scb
suffix:semicolon
id|async_codec_scb_desc-&gt;task_entry
op_assign
id|s16_async_codec_input_task
suffix:semicolon
id|spdifi_scb_desc-&gt;parent_scb_ptr
op_assign
id|async_codec_scb_desc
suffix:semicolon
id|spdifi_scb_desc-&gt;next_scb_ptr
op_assign
id|spdifo_scb_desc
suffix:semicolon
id|spdifi_scb_desc-&gt;sub_list_ptr
op_assign
id|ins-&gt;the_null_scb
suffix:semicolon
id|spdifi_scb_desc-&gt;task_entry
op_assign
id|spdifi_task
suffix:semicolon
id|spdifo_scb_desc-&gt;parent_scb_ptr
op_assign
id|spdifi_scb_desc
suffix:semicolon
id|spdifo_scb_desc-&gt;next_scb_ptr
op_assign
id|fg_entry
suffix:semicolon
id|spdifo_scb_desc-&gt;sub_list_ptr
op_assign
id|ins-&gt;the_null_scb
suffix:semicolon
id|spdifo_scb_desc-&gt;task_entry
op_assign
id|spdifo_task
suffix:semicolon
multiline_comment|/* this one is faked, as the parnet of SPDIFO task&n;&t;&t;   is the FG task tree */
id|fg_entry-&gt;parent_scb_ptr
op_assign
id|spdifo_scb_desc
suffix:semicolon
multiline_comment|/* for proc fs */
id|cs46xx_dsp_proc_register_scb_desc
(paren
id|chip
comma
id|spdifo_scb_desc
)paren
suffix:semicolon
id|cs46xx_dsp_proc_register_scb_desc
(paren
id|chip
comma
id|spdifi_scb_desc
)paren
suffix:semicolon
id|cs46xx_dsp_proc_register_scb_desc
(paren
id|chip
comma
id|async_codec_scb_desc
)paren
suffix:semicolon
multiline_comment|/* Async MASTER ENABLE, affects both SPDIF input and output */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ASER_MASTER
comma
l_int|0x1
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_disable_spdif_hw
r_static
r_void
id|cs46xx_dsp_disable_spdif_hw
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
multiline_comment|/* set SPDIF output FIFO slot */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ASER_FADDR
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* SPDIF output MASTER ENABLE */
id|cs46xx_poke_via_dsp
(paren
id|chip
comma
id|SP_SPDOUT_CONTROL
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* right and left validate bit */
multiline_comment|/*cs46xx_poke_via_dsp (chip,SP_SPDOUT_CSUV, ins-&gt;spdif_csuv_default);*/
id|cs46xx_poke_via_dsp
(paren
id|chip
comma
id|SP_SPDOUT_CSUV
comma
l_int|0x0
)paren
suffix:semicolon
multiline_comment|/* clear fifo pointer */
id|cs46xx_poke_via_dsp
(paren
id|chip
comma
id|SP_SPDIN_FIFOPTR
comma
l_int|0x0
)paren
suffix:semicolon
multiline_comment|/* monitor state */
id|ins-&gt;spdif_status_out
op_and_assign
op_complement
id|DSP_SPDIF_STATUS_HW_ENABLED
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_enable_spdif_hw
r_int
id|cs46xx_dsp_enable_spdif_hw
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
multiline_comment|/* if hw-ctrl already enabled, turn off to reset logic ... */
id|cs46xx_dsp_disable_spdif_hw
(paren
id|chip
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
multiline_comment|/* set SPDIF output FIFO slot */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ASER_FADDR
comma
(paren
l_int|0x8000
op_or
(paren
(paren
id|SP_SPDOUT_FIFO
op_rshift
l_int|4
)paren
op_lshift
l_int|4
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/* SPDIF output MASTER ENABLE */
id|cs46xx_poke_via_dsp
(paren
id|chip
comma
id|SP_SPDOUT_CONTROL
comma
l_int|0x80000000
)paren
suffix:semicolon
multiline_comment|/* right and left validate bit */
id|cs46xx_poke_via_dsp
(paren
id|chip
comma
id|SP_SPDOUT_CSUV
comma
id|ins-&gt;spdif_csuv_default
)paren
suffix:semicolon
multiline_comment|/* monitor state */
id|ins-&gt;spdif_status_out
op_or_assign
id|DSP_SPDIF_STATUS_HW_ENABLED
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_enable_spdif_in
r_int
id|cs46xx_dsp_enable_spdif_in
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
multiline_comment|/* turn on amplifier */
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
id|chip
op_member_access_from_pointer
id|amplifier_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
id|snd_assert
(paren
id|ins-&gt;asynch_rx_scb
op_eq
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|snd_assert
(paren
id|ins-&gt;spdif_in_src
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ins-&gt;spdif_status_out
op_amp
id|DSP_SPDIF_STATUS_INPUT_CTRL_ENABLED
)paren
)paren
(brace
multiline_comment|/* time countdown enable */
id|cs46xx_poke_via_dsp
(paren
id|chip
comma
id|SP_ASER_COUNTDOWN
comma
l_int|0x80000005
)paren
suffix:semicolon
multiline_comment|/* NOTE: 80000005 value is just magic. With all values&n;&t;&t;   that I&squot;ve tested this one seem to give the best result.&n;&t;&t;   Got no explication why. (Benny) */
multiline_comment|/* SPDIF input MASTER ENABLE */
id|cs46xx_poke_via_dsp
(paren
id|chip
comma
id|SP_SPDIN_CONTROL
comma
l_int|0x800003ff
)paren
suffix:semicolon
id|ins-&gt;spdif_status_out
op_or_assign
id|DSP_SPDIF_STATUS_INPUT_CTRL_ENABLED
suffix:semicolon
)brace
multiline_comment|/* create and start the asynchronous receiver SCB */
id|ins-&gt;asynch_rx_scb
op_assign
id|cs46xx_dsp_create_asynch_fg_rx_scb
c_func
(paren
id|chip
comma
l_string|&quot;AsynchFGRxSCB&quot;
comma
id|ASYNCRX_SCB_ADDR
comma
id|SPDIFI_SCB_INST
comma
id|SPDIFI_IP_OUTPUT_BUFFER1
comma
id|ins-&gt;spdif_in_src
comma
id|SCB_ON_PARENT_SUBLIST_SCB
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
multiline_comment|/* reset SPDIF input sample buffer pointer */
multiline_comment|/*snd_cs46xx_poke (chip, (SPDIFI_SCB_INST + 0x0c) &lt;&lt; 2,&n;&t;  (SPDIFI_IP_OUTPUT_BUFFER1 &lt;&lt; 0x10) | 0xFFFC);*/
multiline_comment|/* reset FIFO ptr */
multiline_comment|/*cs46xx_poke_via_dsp (chip,SP_SPDIN_FIFOPTR, 0x0);*/
id|cs46xx_src_link
c_func
(paren
id|chip
comma
id|ins-&gt;spdif_in_src
)paren
suffix:semicolon
multiline_comment|/* unmute SRC volume */
id|cs46xx_dsp_scb_set_volume
(paren
id|chip
comma
id|ins-&gt;spdif_in_src
comma
l_int|0x7fff
comma
l_int|0x7fff
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
multiline_comment|/* set SPDIF input sample rate and unmute&n;&t;   NOTE: only 48khz support for SPDIF input this time */
multiline_comment|/* cs46xx_dsp_set_src_sample_rate(chip,ins-&gt;spdif_in_src,48000); */
multiline_comment|/* monitor state */
id|ins-&gt;spdif_status_in
op_assign
l_int|1
suffix:semicolon
id|up
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_disable_spdif_in
r_int
id|cs46xx_dsp_disable_spdif_in
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|snd_assert
(paren
id|ins-&gt;asynch_rx_scb
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|snd_assert
(paren
id|ins-&gt;spdif_in_src
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
multiline_comment|/* Remove the asynchronous receiver SCB */
id|cs46xx_dsp_remove_scb
(paren
id|chip
comma
id|ins-&gt;asynch_rx_scb
)paren
suffix:semicolon
id|ins-&gt;asynch_rx_scb
op_assign
l_int|NULL
suffix:semicolon
id|cs46xx_src_unlink
c_func
(paren
id|chip
comma
id|ins-&gt;spdif_in_src
)paren
suffix:semicolon
multiline_comment|/* monitor state */
id|ins-&gt;spdif_status_in
op_assign
l_int|0
suffix:semicolon
id|up
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
multiline_comment|/* restore amplifier */
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|chip
op_member_access_from_pointer
id|amplifier_ctrl
c_func
(paren
id|chip
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_enable_pcm_capture
r_int
id|cs46xx_dsp_enable_pcm_capture
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|snd_assert
(paren
id|ins-&gt;pcm_input
op_eq
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|snd_assert
(paren
id|ins-&gt;ref_snoop_scb
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
id|ins-&gt;pcm_input
op_assign
id|cs46xx_add_record_source
c_func
(paren
id|chip
comma
id|ins-&gt;ref_snoop_scb
comma
id|PCMSERIALIN_PCM_SCB_ADDR
comma
l_string|&quot;PCMSerialInput_Wave&quot;
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_disable_pcm_capture
r_int
id|cs46xx_dsp_disable_pcm_capture
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|snd_assert
(paren
id|ins-&gt;pcm_input
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
id|cs46xx_dsp_remove_scb
(paren
id|chip
comma
id|ins-&gt;pcm_input
)paren
suffix:semicolon
id|ins-&gt;pcm_input
op_assign
l_int|NULL
suffix:semicolon
id|up
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_enable_adc_capture
r_int
id|cs46xx_dsp_enable_adc_capture
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|snd_assert
(paren
id|ins-&gt;adc_input
op_eq
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|snd_assert
(paren
id|ins-&gt;codec_in_scb
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
id|ins-&gt;adc_input
op_assign
id|cs46xx_add_record_source
c_func
(paren
id|chip
comma
id|ins-&gt;codec_in_scb
comma
id|PCMSERIALIN_SCB_ADDR
comma
l_string|&quot;PCMSerialInput_ADC&quot;
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_disable_adc_capture
r_int
id|cs46xx_dsp_disable_adc_capture
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|snd_assert
(paren
id|ins-&gt;adc_input
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
id|cs46xx_dsp_remove_scb
(paren
id|chip
comma
id|ins-&gt;adc_input
)paren
suffix:semicolon
id|ins-&gt;adc_input
op_assign
l_int|NULL
suffix:semicolon
id|up
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs46xx_poke_via_dsp
r_int
id|cs46xx_poke_via_dsp
(paren
id|cs46xx_t
op_star
id|chip
comma
id|u32
id|address
comma
id|u32
id|data
)paren
(brace
id|u32
id|temp
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* santiy check the parameters.  (These numbers are not 100% correct.  They are&n;&t;   a rough guess from looking at the controller spec.) */
r_if
c_cond
(paren
id|address
OL
l_int|0x8000
op_logical_or
id|address
op_ge
l_int|0x9000
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* initialize the SP_IO_WRITE SCB with the data. */
id|temp
op_assign
(paren
id|address
op_lshift
l_int|16
)paren
op_or
(paren
id|address
op_amp
l_int|0x0000FFFF
)paren
suffix:semicolon
multiline_comment|/* offset 0 &lt;-- address2 : address1 */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
(paren
id|SPIOWRITE_SCB_ADDR
op_lshift
l_int|2
)paren
comma
id|temp
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
(paren
(paren
id|SPIOWRITE_SCB_ADDR
op_plus
l_int|1
)paren
op_lshift
l_int|2
)paren
comma
id|data
)paren
suffix:semicolon
multiline_comment|/* offset 1 &lt;-- data1 */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
(paren
(paren
id|SPIOWRITE_SCB_ADDR
op_plus
l_int|2
)paren
op_lshift
l_int|2
)paren
comma
id|data
)paren
suffix:semicolon
multiline_comment|/* offset 1 &lt;-- data2 */
multiline_comment|/* Poke this location to tell the task to start */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
(paren
(paren
id|SPIOWRITE_SCB_ADDR
op_plus
l_int|6
)paren
op_lshift
l_int|2
)paren
comma
id|SPIOWRITE_SCB_ADDR
op_lshift
l_int|0x10
)paren
suffix:semicolon
multiline_comment|/* Verify that the task ran */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|25
suffix:semicolon
id|i
op_increment
)paren
(brace
id|udelay
c_func
(paren
l_int|125
)paren
suffix:semicolon
id|temp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
(paren
(paren
id|SPIOWRITE_SCB_ADDR
op_plus
l_int|6
)paren
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_eq
l_int|0x00000000
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|25
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: SPIOWriteTask not responding&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_set_dac_volume
r_int
id|cs46xx_dsp_set_dac_volume
(paren
id|cs46xx_t
op_star
id|chip
comma
id|u16
id|left
comma
id|u16
id|right
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|scb
suffix:semicolon
id|down
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
multiline_comment|/* main output */
id|scb
op_assign
id|ins-&gt;master_mix_scb-&gt;sub_list_ptr
suffix:semicolon
r_while
c_loop
(paren
id|scb
op_ne
id|ins-&gt;the_null_scb
)paren
(brace
id|cs46xx_dsp_scb_set_volume
(paren
id|chip
comma
id|scb
comma
id|left
comma
id|right
)paren
suffix:semicolon
id|scb
op_assign
id|scb-&gt;next_scb_ptr
suffix:semicolon
)brace
multiline_comment|/* rear output */
id|scb
op_assign
id|ins-&gt;rear_mix_scb-&gt;sub_list_ptr
suffix:semicolon
r_while
c_loop
(paren
id|scb
op_ne
id|ins-&gt;the_null_scb
)paren
(brace
id|cs46xx_dsp_scb_set_volume
(paren
id|chip
comma
id|scb
comma
id|left
comma
id|right
)paren
suffix:semicolon
id|scb
op_assign
id|scb-&gt;next_scb_ptr
suffix:semicolon
)brace
id|ins-&gt;dac_volume_left
op_assign
id|left
suffix:semicolon
id|ins-&gt;dac_volume_right
op_assign
id|right
suffix:semicolon
id|up
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_set_iec958_volume
r_int
id|cs46xx_dsp_set_iec958_volume
(paren
id|cs46xx_t
op_star
id|chip
comma
id|u16
id|left
comma
id|u16
id|right
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|down
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;asynch_rx_scb
op_ne
l_int|NULL
)paren
id|cs46xx_dsp_scb_set_volume
(paren
id|chip
comma
id|ins-&gt;asynch_rx_scb
comma
id|left
comma
id|right
)paren
suffix:semicolon
id|ins-&gt;spdif_input_volume_left
op_assign
id|left
suffix:semicolon
id|ins-&gt;spdif_input_volume_right
op_assign
id|right
suffix:semicolon
id|up
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
