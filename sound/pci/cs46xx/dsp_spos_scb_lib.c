multiline_comment|/*&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
multiline_comment|/*&n; * 2002-07 Benny Sjostrand benny@hostmobility.com&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/pm.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/control.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#include &lt;sound/cs46xx.h&gt;
macro_line|#include &quot;cs46xx_lib.h&quot;
macro_line|#include &quot;dsp_spos.h&quot;
DECL|struct|_proc_scb_info_t
r_typedef
r_struct
id|_proc_scb_info_t
(brace
DECL|member|scb_desc
id|dsp_scb_descriptor_t
op_star
id|scb_desc
suffix:semicolon
DECL|member|chip
id|cs46xx_t
op_star
id|chip
suffix:semicolon
DECL|typedef|proc_scb_info_t
)brace
id|proc_scb_info_t
suffix:semicolon
DECL|function|remove_symbol
r_static
r_void
id|remove_symbol
(paren
id|cs46xx_t
op_star
id|chip
comma
id|symbol_entry_t
op_star
id|symbol
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
r_int
id|symbol_index
op_assign
(paren
r_int
)paren
(paren
id|symbol
op_minus
id|ins-&gt;symbol_table.symbols
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|ins-&gt;symbol_table.nsymbols
OG
l_int|0
comma
r_return
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|symbol_index
op_ge
l_int|0
op_logical_and
id|symbol_index
OL
id|ins-&gt;symbol_table.nsymbols
comma
r_return
)paren
suffix:semicolon
id|ins-&gt;symbol_table.symbols
(braket
id|symbol_index
)braket
dot
id|deleted
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|symbol_index
OL
id|ins-&gt;symbol_table.highest_frag_index
)paren
(brace
id|ins-&gt;symbol_table.highest_frag_index
op_assign
id|symbol_index
suffix:semicolon
)brace
r_if
c_cond
(paren
id|symbol_index
op_eq
id|ins-&gt;symbol_table.nsymbols
op_minus
l_int|1
)paren
id|ins-&gt;symbol_table.nsymbols
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;symbol_table.highest_frag_index
OG
id|ins-&gt;symbol_table.nsymbols
)paren
(brace
id|ins-&gt;symbol_table.highest_frag_index
op_assign
id|ins-&gt;symbol_table.nsymbols
suffix:semicolon
)brace
)brace
DECL|function|cs46xx_dsp_proc_scb_info_read
r_static
r_void
id|cs46xx_dsp_proc_scb_info_read
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|proc_scb_info_t
op_star
id|scb_info
op_assign
(paren
id|proc_scb_info_t
op_star
)paren
id|entry-&gt;private_data
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|scb
op_assign
id|scb_info-&gt;scb_desc
suffix:semicolon
id|dsp_spos_instance_t
op_star
id|ins
suffix:semicolon
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|scb_info-&gt;chip
comma
r_return
)paren
suffix:semicolon
r_int
id|j
comma
id|col
suffix:semicolon
r_int
r_int
id|dst
op_assign
id|chip-&gt;region.idx
(braket
l_int|1
)braket
dot
id|remap_addr
op_plus
id|DSP_PARAMETER_BYTE_OFFSET
suffix:semicolon
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ins-&gt;scb_mutex
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%04x %s:&bslash;n&quot;
comma
id|scb-&gt;address
comma
id|scb-&gt;scb_name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|col
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|0x10
suffix:semicolon
id|j
op_increment
comma
id|col
op_increment
)paren
(brace
r_if
c_cond
(paren
id|col
op_eq
l_int|4
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|col
op_assign
l_int|0
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%08x &quot;
comma
id|readl
c_func
(paren
id|dst
op_plus
(paren
id|scb-&gt;address
op_plus
id|j
)paren
op_star
r_sizeof
(paren
id|u32
)paren
)paren
)paren
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scb-&gt;parent_scb_ptr
op_ne
l_int|NULL
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;parent [%s:%04x] &quot;
comma
id|scb-&gt;parent_scb_ptr-&gt;scb_name
comma
id|scb-&gt;parent_scb_ptr-&gt;address
)paren
suffix:semicolon
)brace
r_else
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;parent [none] &quot;
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;sub_list_ptr [%s:%04x]&bslash;nnext_scb_ptr [%s:%04x]  task_entry [%s:%04x]&bslash;n&quot;
comma
id|scb-&gt;sub_list_ptr-&gt;scb_name
comma
id|scb-&gt;sub_list_ptr-&gt;address
comma
id|scb-&gt;next_scb_ptr-&gt;scb_name
comma
id|scb-&gt;next_scb_ptr-&gt;address
comma
id|scb-&gt;task_entry-&gt;symbol_name
comma
id|scb-&gt;task_entry-&gt;address
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;index [%d] ref_count [%d]&bslash;n&quot;
comma
id|scb-&gt;index
comma
id|scb-&gt;ref_count
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ins-&gt;scb_mutex
)paren
suffix:semicolon
)brace
DECL|function|_dsp_unlink_scb
r_static
r_void
id|_dsp_unlink_scb
(paren
id|cs46xx_t
op_star
id|chip
comma
id|dsp_scb_descriptor_t
op_star
id|scb
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|scb-&gt;parent_scb_ptr
)paren
(brace
multiline_comment|/* unlink parent SCB */
id|snd_assert
(paren
(paren
id|scb-&gt;parent_scb_ptr-&gt;sub_list_ptr
op_eq
id|scb
op_logical_or
id|scb-&gt;parent_scb_ptr-&gt;next_scb_ptr
op_eq
id|scb
)paren
comma
r_return
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scb-&gt;parent_scb_ptr-&gt;sub_list_ptr
op_eq
id|scb
)paren
(brace
r_if
c_cond
(paren
id|scb-&gt;next_scb_ptr
op_eq
id|ins-&gt;the_null_scb
)paren
(brace
multiline_comment|/* last and only node in parent sublist */
id|scb-&gt;parent_scb_ptr-&gt;sub_list_ptr
op_assign
id|scb-&gt;sub_list_ptr
suffix:semicolon
r_if
c_cond
(paren
id|scb-&gt;sub_list_ptr
op_ne
id|ins-&gt;the_null_scb
)paren
(brace
id|scb-&gt;sub_list_ptr-&gt;parent_scb_ptr
op_assign
id|scb-&gt;parent_scb_ptr
suffix:semicolon
)brace
id|scb-&gt;sub_list_ptr
op_assign
id|ins-&gt;the_null_scb
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* first node in parent sublist */
id|scb-&gt;parent_scb_ptr-&gt;sub_list_ptr
op_assign
id|scb-&gt;next_scb_ptr
suffix:semicolon
r_if
c_cond
(paren
id|scb-&gt;next_scb_ptr
op_ne
id|ins-&gt;the_null_scb
)paren
(brace
multiline_comment|/* update next node parent ptr. */
id|scb-&gt;next_scb_ptr-&gt;parent_scb_ptr
op_assign
id|scb-&gt;parent_scb_ptr
suffix:semicolon
)brace
id|scb-&gt;next_scb_ptr
op_assign
id|ins-&gt;the_null_scb
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* snd_assert ( (scb-&gt;sub_list_ptr == ins-&gt;the_null_scb), return); */
id|scb-&gt;parent_scb_ptr-&gt;next_scb_ptr
op_assign
id|scb-&gt;next_scb_ptr
suffix:semicolon
r_if
c_cond
(paren
id|scb-&gt;next_scb_ptr
op_ne
id|ins-&gt;the_null_scb
)paren
(brace
multiline_comment|/* update next node parent ptr. */
id|scb-&gt;next_scb_ptr-&gt;parent_scb_ptr
op_assign
id|scb-&gt;parent_scb_ptr
suffix:semicolon
)brace
id|scb-&gt;next_scb_ptr
op_assign
id|ins-&gt;the_null_scb
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* update parent first entry in DSP RAM */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
(paren
id|scb-&gt;parent_scb_ptr-&gt;address
op_plus
id|SCBsubListPtr
)paren
op_lshift
l_int|2
comma
(paren
id|scb-&gt;parent_scb_ptr-&gt;sub_list_ptr-&gt;address
op_lshift
l_int|0x10
)paren
op_or
(paren
id|scb-&gt;parent_scb_ptr-&gt;next_scb_ptr-&gt;address
)paren
)paren
suffix:semicolon
multiline_comment|/* then update entry in DSP RAM */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
(paren
id|scb-&gt;address
op_plus
id|SCBsubListPtr
)paren
op_lshift
l_int|2
comma
(paren
id|scb-&gt;sub_list_ptr-&gt;address
op_lshift
l_int|0x10
)paren
op_or
(paren
id|scb-&gt;next_scb_ptr-&gt;address
)paren
)paren
suffix:semicolon
id|scb-&gt;parent_scb_ptr
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
DECL|function|_dsp_clear_sample_buffer
r_static
r_void
id|_dsp_clear_sample_buffer
(paren
id|cs46xx_t
op_star
id|chip
comma
id|u32
id|sample_buffer_addr
comma
r_int
id|dword_count
)paren
(brace
id|u32
id|dst
op_assign
id|chip-&gt;region.idx
(braket
l_int|2
)braket
dot
id|remap_addr
op_plus
id|sample_buffer_addr
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dword_count
suffix:semicolon
op_increment
id|i
)paren
(brace
id|writel
c_func
(paren
l_int|0
comma
id|dst
)paren
suffix:semicolon
)brace
)brace
DECL|function|cs46xx_dsp_remove_scb
r_void
id|cs46xx_dsp_remove_scb
(paren
id|cs46xx_t
op_star
id|chip
comma
id|dsp_scb_descriptor_t
op_star
id|scb
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ins-&gt;scb_mutex
)paren
suffix:semicolon
multiline_comment|/* check integrety */
id|snd_assert
(paren
(paren
id|scb-&gt;index
op_ge
l_int|0
op_logical_and
id|scb-&gt;index
OL
id|ins-&gt;nscb
op_logical_and
(paren
id|ins-&gt;scbs
op_plus
id|scb-&gt;index
)paren
op_eq
id|scb
)paren
comma
r_goto
id|_end
)paren
suffix:semicolon
macro_line|#if 0
multiline_comment|/* cant remove a SCB with childs before &n;&t;   removing childs first  */
id|snd_assert
(paren
(paren
id|scb-&gt;sub_list_ptr
op_eq
id|ins-&gt;the_null_scb
op_logical_and
id|scb-&gt;next_scb_ptr
op_eq
id|ins-&gt;the_null_scb
)paren
comma
r_goto
id|_end
)paren
suffix:semicolon
macro_line|#endif
id|_dsp_unlink_scb
(paren
id|chip
comma
id|scb
)paren
suffix:semicolon
id|cs46xx_dsp_proc_free_scb_desc
c_func
(paren
id|scb
)paren
suffix:semicolon
id|snd_assert
(paren
id|scb-&gt;scb_symbol
op_ne
l_int|NULL
comma
r_goto
id|_end
)paren
suffix:semicolon
id|remove_symbol
(paren
id|chip
comma
id|scb-&gt;scb_symbol
)paren
suffix:semicolon
id|ins-&gt;scbs
(braket
id|scb-&gt;index
)braket
dot
id|deleted
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|scb-&gt;index
OL
id|ins-&gt;scb_highest_frag_index
)paren
id|ins-&gt;scb_highest_frag_index
op_assign
id|scb-&gt;index
suffix:semicolon
r_if
c_cond
(paren
id|scb-&gt;index
op_eq
id|ins-&gt;nscb
op_minus
l_int|1
)paren
(brace
id|ins-&gt;nscb
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ins-&gt;scb_highest_frag_index
OG
id|ins-&gt;nscb
)paren
(brace
id|ins-&gt;scb_highest_frag_index
op_assign
id|ins-&gt;nscb
suffix:semicolon
)brace
macro_line|#if 0
multiline_comment|/* !!!! THIS IS A PIECE OF SHIT MADE BY ME !!! */
r_for
c_loop
(paren
id|i
op_assign
id|scb-&gt;index
op_plus
l_int|1
suffix:semicolon
id|i
OL
id|ins-&gt;nscb
suffix:semicolon
op_increment
id|i
)paren
(brace
id|ins-&gt;scbs
(braket
id|i
op_minus
l_int|1
)braket
dot
id|index
op_assign
id|i
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SND_DEBUG
id|_end
suffix:colon
macro_line|#endif
id|up
c_func
(paren
op_amp
id|ins-&gt;scb_mutex
)paren
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_proc_free_scb_desc
r_void
id|cs46xx_dsp_proc_free_scb_desc
(paren
id|dsp_scb_descriptor_t
op_star
id|scb
)paren
(brace
r_if
c_cond
(paren
id|scb-&gt;proc_info
)paren
(brace
id|proc_scb_info_t
op_star
id|scb_info
op_assign
(paren
id|proc_scb_info_t
op_star
)paren
id|scb-&gt;proc_info-&gt;private_data
suffix:semicolon
id|snd_printdd
c_func
(paren
l_string|&quot;cs46xx_dsp_proc_free_scb_desc: freeing %s&bslash;n&quot;
comma
id|scb-&gt;scb_name
)paren
suffix:semicolon
id|snd_info_unregister
c_func
(paren
id|scb-&gt;proc_info
)paren
suffix:semicolon
id|scb-&gt;proc_info
op_assign
l_int|NULL
suffix:semicolon
id|snd_assert
(paren
id|scb_info
op_ne
l_int|NULL
comma
r_return
)paren
suffix:semicolon
id|kfree
(paren
id|scb_info
)paren
suffix:semicolon
)brace
)brace
DECL|function|cs46xx_dsp_proc_register_scb_desc
r_void
id|cs46xx_dsp_proc_register_scb_desc
(paren
id|cs46xx_t
op_star
id|chip
comma
id|dsp_scb_descriptor_t
op_star
id|scb
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|snd_info_entry_t
op_star
id|entry
suffix:semicolon
id|proc_scb_info_t
op_star
id|scb_info
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ins-&gt;scb_mutex
)paren
suffix:semicolon
multiline_comment|/* register to proc */
r_if
c_cond
(paren
id|ins-&gt;snd_card
op_ne
l_int|NULL
op_logical_and
id|ins-&gt;proc_dsp_dir
op_ne
l_int|NULL
op_logical_and
id|scb-&gt;proc_info
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
(paren
id|entry
op_assign
id|snd_info_create_card_entry
c_func
(paren
id|ins-&gt;snd_card
comma
id|scb-&gt;scb_name
comma
id|ins-&gt;proc_dsp_dir
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|scb_info
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|proc_scb_info_t
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|scb_info-&gt;chip
op_assign
id|chip
suffix:semicolon
id|scb_info-&gt;scb_desc
op_assign
id|scb
suffix:semicolon
id|entry-&gt;content
op_assign
id|SNDRV_INFO_CONTENT_TEXT
suffix:semicolon
id|entry-&gt;private_data
op_assign
id|scb_info
suffix:semicolon
id|entry-&gt;mode
op_assign
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IWUSR
suffix:semicolon
id|entry-&gt;c.text.read_size
op_assign
l_int|512
suffix:semicolon
id|entry-&gt;c.text.read
op_assign
id|cs46xx_dsp_proc_scb_info_read
suffix:semicolon
r_if
c_cond
(paren
id|snd_info_register
c_func
(paren
id|entry
)paren
OL
l_int|0
)paren
(brace
id|snd_info_free_entry
c_func
(paren
id|entry
)paren
suffix:semicolon
id|kfree
(paren
id|scb_info
)paren
suffix:semicolon
id|entry
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|scb-&gt;proc_info
op_assign
id|entry
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|ins-&gt;scb_mutex
)paren
suffix:semicolon
)brace
r_static
id|dsp_scb_descriptor_t
op_star
DECL|function|_dsp_create_generic_scb
id|_dsp_create_generic_scb
(paren
id|cs46xx_t
op_star
id|chip
comma
r_char
op_star
id|name
comma
id|u32
op_star
id|scb_data
comma
id|u32
id|dest
comma
id|symbol_entry_t
op_star
id|task_entry
comma
id|dsp_scb_descriptor_t
op_star
id|parent_scb
comma
r_int
id|scb_child_type
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|scb
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ins-&gt;scb_mutex
)paren
suffix:semicolon
id|snd_assert
(paren
id|ins-&gt;the_null_scb
op_ne
l_int|NULL
comma
r_goto
id|_fail_end
)paren
suffix:semicolon
multiline_comment|/* fill the data that will be wroten to DSP */
id|scb_data
(braket
id|SCBsubListPtr
)braket
op_assign
(paren
id|ins-&gt;the_null_scb-&gt;address
op_lshift
l_int|0x10
)paren
op_or
id|ins-&gt;the_null_scb-&gt;address
suffix:semicolon
id|scb_data
(braket
id|SCBfuncEntryPtr
)braket
op_and_assign
l_int|0xFFFF0000
suffix:semicolon
id|scb_data
(braket
id|SCBfuncEntryPtr
)braket
op_or_assign
id|task_entry-&gt;address
suffix:semicolon
id|snd_printdd
c_func
(paren
l_string|&quot;dsp_spos: creating SCB &lt;%s&gt;&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
id|scb
op_assign
id|cs46xx_dsp_create_scb
c_func
(paren
id|chip
comma
id|name
comma
id|scb_data
comma
id|dest
)paren
suffix:semicolon
id|scb-&gt;sub_list_ptr
op_assign
id|ins-&gt;the_null_scb
suffix:semicolon
id|scb-&gt;next_scb_ptr
op_assign
id|ins-&gt;the_null_scb
suffix:semicolon
id|scb-&gt;parent_scb_ptr
op_assign
id|parent_scb
suffix:semicolon
id|scb-&gt;task_entry
op_assign
id|task_entry
suffix:semicolon
multiline_comment|/* update parent SCB */
r_if
c_cond
(paren
id|scb-&gt;parent_scb_ptr
)paren
(brace
macro_line|#if 0
id|printk
(paren
l_string|&quot;scb-&gt;parent_scb_ptr = %s&bslash;n&quot;
comma
id|scb-&gt;parent_scb_ptr-&gt;scb_name
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;scb-&gt;parent_scb_ptr-&gt;next_scb_ptr = %s&bslash;n&quot;
comma
id|scb-&gt;parent_scb_ptr-&gt;next_scb_ptr-&gt;scb_name
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;scb-&gt;parent_scb_ptr-&gt;sub_list_ptr = %s&bslash;n&quot;
comma
id|scb-&gt;parent_scb_ptr-&gt;sub_list_ptr-&gt;scb_name
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* link to  parent SCB */
r_if
c_cond
(paren
id|scb_child_type
op_eq
id|SCB_ON_PARENT_NEXT_SCB
)paren
(brace
id|snd_assert
(paren
(paren
id|scb-&gt;parent_scb_ptr-&gt;next_scb_ptr
op_eq
id|ins-&gt;the_null_scb
)paren
comma
r_goto
id|_fail_end
)paren
suffix:semicolon
id|scb-&gt;parent_scb_ptr-&gt;next_scb_ptr
op_assign
id|scb
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|scb_child_type
op_eq
id|SCB_ON_PARENT_SUBLIST_SCB
)paren
(brace
id|snd_assert
(paren
(paren
id|scb-&gt;parent_scb_ptr-&gt;sub_list_ptr
op_eq
id|ins-&gt;the_null_scb
)paren
comma
r_goto
id|_fail_end
)paren
suffix:semicolon
id|scb-&gt;parent_scb_ptr-&gt;sub_list_ptr
op_assign
id|scb
suffix:semicolon
)brace
r_else
(brace
id|snd_assert
(paren
l_int|0
comma
r_goto
id|_fail_end
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* update entry in DSP RAM */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
(paren
id|scb-&gt;parent_scb_ptr-&gt;address
op_plus
id|SCBsubListPtr
)paren
op_lshift
l_int|2
comma
(paren
id|scb-&gt;parent_scb_ptr-&gt;sub_list_ptr-&gt;address
op_lshift
l_int|0x10
)paren
op_or
(paren
id|scb-&gt;parent_scb_ptr-&gt;next_scb_ptr-&gt;address
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|ins-&gt;scb_mutex
)paren
suffix:semicolon
id|cs46xx_dsp_proc_register_scb_desc
(paren
id|chip
comma
id|scb
)paren
suffix:semicolon
r_return
id|scb
suffix:semicolon
macro_line|#ifdef CONFIG_SND_DEBUG
id|_fail_end
suffix:colon
id|up
c_func
(paren
op_amp
id|ins-&gt;scb_mutex
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
macro_line|#endif
)brace
id|dsp_scb_descriptor_t
op_star
DECL|function|cs46xx_dsp_create_generic_scb
id|cs46xx_dsp_create_generic_scb
(paren
id|cs46xx_t
op_star
id|chip
comma
r_char
op_star
id|name
comma
id|u32
op_star
id|scb_data
comma
id|u32
id|dest
comma
r_char
op_star
id|task_entry_name
comma
id|dsp_scb_descriptor_t
op_star
id|parent_scb
comma
r_int
id|scb_child_type
)paren
(brace
id|symbol_entry_t
op_star
id|task_entry
suffix:semicolon
id|task_entry
op_assign
id|cs46xx_dsp_lookup_symbol
(paren
id|chip
comma
id|task_entry_name
comma
id|SYMBOL_CODE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|task_entry
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: symbol %s not found&bslash;n&quot;
comma
id|task_entry_name
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
id|_dsp_create_generic_scb
(paren
id|chip
comma
id|name
comma
id|scb_data
comma
id|dest
comma
id|task_entry
comma
id|parent_scb
comma
id|scb_child_type
)paren
suffix:semicolon
)brace
id|dsp_scb_descriptor_t
op_star
DECL|function|cs46xx_dsp_create_timing_master_scb
id|cs46xx_dsp_create_timing_master_scb
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|dsp_scb_descriptor_t
op_star
id|scb
suffix:semicolon
id|timing_master_scb_t
id|timing_master_scb
op_assign
(brace
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|NULL_SCB_ADDR
comma
l_int|0
comma
l_int|0
comma
multiline_comment|/* extraSampleAccum:TMreserved */
l_int|0
comma
l_int|0
comma
multiline_comment|/* codecFIFOptr:codecFIFOsyncd */
l_int|0x0001
comma
l_int|0x8000
comma
multiline_comment|/* fracSampAccumQm1:TMfrmsLeftInGroup */
l_int|0x0001
comma
l_int|0x0000
comma
multiline_comment|/* fracSampCorrectionQm1:TMfrmGroupLength */
l_int|0x00060000
multiline_comment|/* nSampPerFrmQ15 */
)brace
suffix:semicolon
id|scb
op_assign
id|cs46xx_dsp_create_generic_scb
c_func
(paren
id|chip
comma
l_string|&quot;TimingMasterSCBInst&quot;
comma
(paren
id|u32
op_star
)paren
op_amp
id|timing_master_scb
comma
id|TIMINGMASTER_SCB_ADDR
comma
l_string|&quot;TIMINGMASTER&quot;
comma
l_int|NULL
comma
id|SCB_NO_PARENT
)paren
suffix:semicolon
r_return
id|scb
suffix:semicolon
)brace
id|dsp_scb_descriptor_t
op_star
DECL|function|cs46xx_dsp_create_codec_out_scb
id|cs46xx_dsp_create_codec_out_scb
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_char
op_star
id|codec_name
comma
id|u16
id|channel_disp
comma
id|u16
id|fifo_addr
comma
id|u16
id|child_scb_addr
comma
id|u32
id|dest
comma
id|dsp_scb_descriptor_t
op_star
id|parent_scb
comma
r_int
id|scb_child_type
)paren
(brace
id|dsp_scb_descriptor_t
op_star
id|scb
suffix:semicolon
id|codec_output_scb_t
id|codec_out_scb
op_assign
(brace
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|NULL_SCB_ADDR
comma
l_int|0
comma
multiline_comment|/* COstrmRsConfig */
l_int|0
comma
multiline_comment|/* COstrmBufPtr */
id|channel_disp
comma
id|fifo_addr
comma
multiline_comment|/* leftChanBaseIOaddr:rightChanIOdisp */
l_int|0x0000
comma
l_int|0x0080
comma
multiline_comment|/* (!AC97!) COexpVolChangeRate:COscaleShiftCount */
l_int|0
comma
id|child_scb_addr
multiline_comment|/* COreserved - need child scb to work with rom code */
)brace
suffix:semicolon
id|scb
op_assign
id|cs46xx_dsp_create_generic_scb
c_func
(paren
id|chip
comma
id|codec_name
comma
(paren
id|u32
op_star
)paren
op_amp
id|codec_out_scb
comma
id|dest
comma
l_string|&quot;S16_CODECOUTPUTTASK&quot;
comma
id|parent_scb
comma
id|scb_child_type
)paren
suffix:semicolon
r_return
id|scb
suffix:semicolon
)brace
id|dsp_scb_descriptor_t
op_star
DECL|function|cs46xx_dsp_create_codec_in_scb
id|cs46xx_dsp_create_codec_in_scb
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_char
op_star
id|codec_name
comma
id|u16
id|channel_disp
comma
id|u16
id|fifo_addr
comma
id|u16
id|sample_buffer_addr
comma
id|u32
id|dest
comma
id|dsp_scb_descriptor_t
op_star
id|parent_scb
comma
r_int
id|scb_child_type
)paren
(brace
id|dsp_scb_descriptor_t
op_star
id|scb
suffix:semicolon
id|codec_input_scb_t
id|codec_input_scb
op_assign
(brace
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
macro_line|#if 0  /* cs4620 */
id|SyncIOSCB
comma
id|NULL_SCB_ADDR
macro_line|#else
l_int|0
comma
l_int|0
comma
macro_line|#endif
l_int|0
comma
l_int|0
comma
id|RSCONFIG_SAMPLE_16STEREO
op_plus
id|RSCONFIG_MODULO_64
comma
multiline_comment|/* strmRsConfig */
id|sample_buffer_addr
op_lshift
l_int|0x10
comma
multiline_comment|/* strmBufPtr; defined as a dword ptr, used as a byte ptr */
id|channel_disp
comma
id|fifo_addr
comma
multiline_comment|/* (!AC97!) leftChanBaseINaddr=AC97primary &n;&t;&t;&t;&t;&t;&t;     link input slot 3 :rightChanINdisp=&quot;&quot;slot 4 */
l_int|0x0000
comma
l_int|0x0000
comma
multiline_comment|/* (!AC97!) ????:scaleShiftCount; no shift needed &n;&t;&t;&t;&t;&t;&t;     because AC97 is already 20 bits */
l_int|0x80008000
multiline_comment|/* ??clw cwcgame.scb has 0 */
)brace
suffix:semicolon
id|scb
op_assign
id|cs46xx_dsp_create_generic_scb
c_func
(paren
id|chip
comma
id|codec_name
comma
(paren
id|u32
op_star
)paren
op_amp
id|codec_input_scb
comma
id|dest
comma
l_string|&quot;S16_CODECINPUTTASK&quot;
comma
id|parent_scb
comma
id|scb_child_type
)paren
suffix:semicolon
r_return
id|scb
suffix:semicolon
)brace
id|dsp_scb_descriptor_t
op_star
DECL|function|cs46xx_dsp_create_pcm_reader_scb
id|cs46xx_dsp_create_pcm_reader_scb
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_char
op_star
id|scb_name
comma
id|u16
id|sample_buffer_addr
comma
id|u32
id|dest
comma
r_int
id|virtual_channel
comma
id|u32
id|playback_hw_addr
comma
id|dsp_scb_descriptor_t
op_star
id|parent_scb
comma
r_int
id|scb_child_type
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|scb
suffix:semicolon
id|generic_scb_t
id|pcm_reader_scb
op_assign
(brace
multiline_comment|/*&n;&t;&t;  Play DMA Task xfers data from host buffer to SP buffer&n;&t;&t;  init/runtime variables:&n;&t;&t;  PlayAC: Play Audio Data Conversion - SCB loc: 2nd dword, mask: 0x0000F000L&n;&t;&t;  DATA_FMT_16BIT_ST_LTLEND(0x00000000L)   from 16-bit stereo, little-endian&n;&t;&t;  DATA_FMT_8_BIT_ST_SIGNED(0x00001000L)   from 8-bit stereo, signed&n;&t;&t;  DATA_FMT_16BIT_MN_LTLEND(0x00002000L)   from 16-bit mono, little-endian&n;&t;&t;  DATA_FMT_8_BIT_MN_SIGNED(0x00003000L)   from 8-bit mono, signed&n;&t;&t;  DATA_FMT_16BIT_ST_BIGEND(0x00004000L)   from 16-bit stereo, big-endian&n;&t;&t;  DATA_FMT_16BIT_MN_BIGEND(0x00006000L)   from 16-bit mono, big-endian&n;&t;&t;  DATA_FMT_8_BIT_ST_UNSIGNED(0x00009000L) from 8-bit stereo, unsigned&n;&t;&t;  DATA_FMT_8_BIT_MN_UNSIGNED(0x0000b000L) from 8-bit mono, unsigned&n;&t;&t;  ? Other combinations possible from:&n;&t;&t;  DMA_RQ_C2_AUDIO_CONVERT_MASK    0x0000F000L&n;&t;&t;  DMA_RQ_C2_AC_NONE               0x00000000L&n;&t;&t;  DMA_RQ_C2_AC_8_TO_16_BIT        0x00001000L&n;&t;&t;  DMA_RQ_C2_AC_MONO_TO_STEREO     0x00002000L&n;&t;&t;  DMA_RQ_C2_AC_ENDIAN_CONVERT     0x00004000L&n;&t;&t;  DMA_RQ_C2_AC_SIGNED_CONVERT     0x00008000L&n;        &n;&t;&t;  HostBuffAddr: Host Buffer Physical Byte Address - SCB loc:3rd dword, Mask: 0xFFFFFFFFL&n;&t;&t;  aligned to dword boundary&n;&t;&t;*/
multiline_comment|/* Basic (non scatter/gather) DMA requestor (4 ints) */
(brace
id|DMA_RQ_C1_SOURCE_ON_HOST
op_plus
multiline_comment|/* source buffer is on the host */
id|DMA_RQ_C1_SOURCE_MOD1024
op_plus
multiline_comment|/* source buffer is 1024 dwords (4096 bytes) */
id|DMA_RQ_C1_DEST_MOD32
op_plus
multiline_comment|/* dest buffer(PCMreaderBuf) is 32 dwords*/
id|DMA_RQ_C1_WRITEBACK_SRC_FLAG
op_plus
multiline_comment|/* ?? */
id|DMA_RQ_C1_WRITEBACK_DEST_FLAG
op_plus
multiline_comment|/* ?? */
l_int|15
comma
multiline_comment|/* DwordCount-1: picked 16 for DwordCount because Jim */
multiline_comment|/*        Barnette said that is what we should use since */
multiline_comment|/*        we are not running in optimized mode? */
id|DMA_RQ_C2_AC_NONE
op_plus
id|DMA_RQ_C2_SIGNAL_SOURCE_PINGPONG
op_plus
multiline_comment|/* set play interrupt (bit0) in HISR when source */
multiline_comment|/*   buffer (on host) crosses half-way point */
id|virtual_channel
comma
multiline_comment|/* Play DMA channel arbitrarily set to 0 */
id|playback_hw_addr
comma
multiline_comment|/* HostBuffAddr (source) */
id|DMA_RQ_SD_SP_SAMPLE_ADDR
op_plus
multiline_comment|/* destination buffer is in SP Sample Memory */
id|sample_buffer_addr
multiline_comment|/* SP Buffer Address (destination) */
)brace
comma
multiline_comment|/* Scatter/gather DMA requestor extension   (5 ints) */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* Sublist pointer &amp; next stream control block (SCB) link. */
id|NULL_SCB_ADDR
comma
id|NULL_SCB_ADDR
comma
multiline_comment|/* Pointer to this tasks parameter block &amp; stream function pointer */
l_int|0
comma
id|NULL_SCB_ADDR
comma
multiline_comment|/* rsConfig register for stream buffer (rsDMA reg. is loaded from basicReq.daw */
multiline_comment|/*   for incoming streams, or basicReq.saw, for outgoing streams) */
id|RSCONFIG_DMA_ENABLE
op_plus
multiline_comment|/* enable DMA */
(paren
l_int|19
op_lshift
id|RSCONFIG_MAX_DMA_SIZE_SHIFT
)paren
op_plus
multiline_comment|/* MAX_DMA_SIZE picked to be 19 since SPUD  */
multiline_comment|/*  uses it for some reason */
(paren
(paren
id|dest
op_rshift
l_int|4
)paren
op_lshift
id|RSCONFIG_STREAM_NUM_SHIFT
)paren
op_plus
multiline_comment|/* stream number = SCBaddr/16 */
id|RSCONFIG_SAMPLE_16STEREO
op_plus
id|RSCONFIG_MODULO_32
comma
multiline_comment|/* dest buffer(PCMreaderBuf) is 32 dwords (256 bytes) */
multiline_comment|/* Stream sample pointer &amp; MAC-unit mode for this stream */
(paren
id|sample_buffer_addr
op_lshift
l_int|0x10
)paren
comma
multiline_comment|/* Fractional increment per output sample in the input sample buffer */
l_int|0
comma
(brace
multiline_comment|/* Standard stereo volume control&n;&t;&t;&t;   default muted */
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
)brace
)brace
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;null_algorithm
op_eq
l_int|NULL
)paren
(brace
id|ins-&gt;null_algorithm
op_assign
id|cs46xx_dsp_lookup_symbol
(paren
id|chip
comma
l_string|&quot;NULLALGORITHM&quot;
comma
id|SYMBOL_CODE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;null_algorithm
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: symbol NULLALGORITHM not found&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
id|scb
op_assign
id|_dsp_create_generic_scb
c_func
(paren
id|chip
comma
id|scb_name
comma
(paren
id|u32
op_star
)paren
op_amp
id|pcm_reader_scb
comma
id|dest
comma
id|ins-&gt;null_algorithm
comma
id|parent_scb
comma
id|scb_child_type
)paren
suffix:semicolon
r_return
id|scb
suffix:semicolon
)brace
id|dsp_scb_descriptor_t
op_star
DECL|function|cs46xx_dsp_create_src_task_scb
id|cs46xx_dsp_create_src_task_scb
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_char
op_star
id|scb_name
comma
id|u16
id|src_buffer_addr
comma
id|u16
id|src_delay_buffer_addr
comma
id|u32
id|dest
comma
id|dsp_scb_descriptor_t
op_star
id|parent_scb
comma
r_int
id|scb_child_type
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|scb
suffix:semicolon
id|src_task_scb_t
id|src_task_scb
op_assign
(brace
l_int|0x0028
comma
l_int|0x00c8
comma
l_int|0x5555
comma
l_int|0x0000
comma
l_int|0x0000
comma
l_int|0x0000
comma
id|src_buffer_addr
comma
l_int|1
comma
l_int|0x0028
comma
l_int|0x00c8
comma
id|RSCONFIG_SAMPLE_16STEREO
op_plus
id|RSCONFIG_MODULO_32
comma
l_int|0x0000
comma
id|src_delay_buffer_addr
comma
l_int|0x0
comma
l_int|0x80
comma
(paren
id|src_delay_buffer_addr
op_plus
(paren
l_int|24
op_star
l_int|4
)paren
)paren
comma
l_int|0
comma
l_int|0
comma
multiline_comment|/* next_scb, sub_list_ptr */
l_int|0
comma
l_int|0
comma
multiline_comment|/* entry, this_spb */
id|RSCONFIG_SAMPLE_16STEREO
op_plus
id|RSCONFIG_MODULO_8
comma
id|src_buffer_addr
op_lshift
l_int|0x10
comma
l_int|0x04000000
comma
(brace
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
comma
l_int|0xffff
)brace
)brace
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;s16_up
op_eq
l_int|NULL
)paren
(brace
id|ins-&gt;s16_up
op_assign
id|cs46xx_dsp_lookup_symbol
(paren
id|chip
comma
l_string|&quot;S16_UPSRC&quot;
comma
id|SYMBOL_CODE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;s16_up
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: symbol S16_UPSRC not found&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
multiline_comment|/* clear buffers */
id|_dsp_clear_sample_buffer
(paren
id|chip
comma
id|src_buffer_addr
comma
l_int|8
)paren
suffix:semicolon
id|_dsp_clear_sample_buffer
(paren
id|chip
comma
id|src_delay_buffer_addr
comma
l_int|32
)paren
suffix:semicolon
id|scb
op_assign
id|_dsp_create_generic_scb
c_func
(paren
id|chip
comma
id|scb_name
comma
(paren
id|u32
op_star
)paren
op_amp
id|src_task_scb
comma
id|dest
comma
id|ins-&gt;s16_up
comma
id|parent_scb
comma
id|scb_child_type
)paren
suffix:semicolon
r_return
id|scb
suffix:semicolon
)brace
id|dsp_scb_descriptor_t
op_star
DECL|function|cs46xx_dsp_create_mix_only_scb
id|cs46xx_dsp_create_mix_only_scb
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_char
op_star
id|scb_name
comma
id|u16
id|mix_buffer_addr
comma
id|u32
id|dest
comma
id|dsp_scb_descriptor_t
op_star
id|parent_scb
comma
r_int
id|scb_child_type
)paren
(brace
id|dsp_scb_descriptor_t
op_star
id|scb
suffix:semicolon
id|mix_only_scb_t
id|master_mix_scb
op_assign
(brace
multiline_comment|/* 0 */
(brace
l_int|0
comma
multiline_comment|/* 1 */
l_int|0
comma
multiline_comment|/* 2 */
id|mix_buffer_addr
comma
multiline_comment|/* 3 */
l_int|0
multiline_comment|/*   */
)brace
comma
(brace
multiline_comment|/* 4 */
l_int|0
comma
multiline_comment|/* 5 */
l_int|0
comma
multiline_comment|/* 6 */
l_int|0
comma
multiline_comment|/* 7 */
l_int|0
comma
multiline_comment|/* 8 */
l_int|0x00000080
)brace
comma
multiline_comment|/* 9 */
l_int|0
comma
l_int|0
comma
multiline_comment|/* A */
l_int|0
comma
l_int|0
comma
multiline_comment|/* B */
id|RSCONFIG_SAMPLE_16STEREO
op_plus
id|RSCONFIG_MODULO_64
comma
multiline_comment|/* C */
(paren
id|mix_buffer_addr
op_plus
(paren
l_int|32
op_star
l_int|4
)paren
)paren
op_lshift
l_int|0x10
comma
multiline_comment|/* D */
l_int|0
comma
(brace
multiline_comment|/* E */
l_int|0x8000
comma
l_int|0x8000
comma
multiline_comment|/* F */
l_int|0x8000
comma
l_int|0x8000
)brace
)brace
suffix:semicolon
id|scb
op_assign
id|cs46xx_dsp_create_generic_scb
c_func
(paren
id|chip
comma
id|scb_name
comma
(paren
id|u32
op_star
)paren
op_amp
id|master_mix_scb
comma
id|dest
comma
l_string|&quot;S16_MIX&quot;
comma
id|parent_scb
comma
id|scb_child_type
)paren
suffix:semicolon
r_return
id|scb
suffix:semicolon
)brace
id|dsp_scb_descriptor_t
op_star
DECL|function|cs46xx_dsp_create_mix_to_ostream_scb
id|cs46xx_dsp_create_mix_to_ostream_scb
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_char
op_star
id|scb_name
comma
id|u16
id|mix_buffer_addr
comma
id|u16
id|writeback_spb
comma
id|u32
id|dest
comma
id|dsp_scb_descriptor_t
op_star
id|parent_scb
comma
r_int
id|scb_child_type
)paren
(brace
id|dsp_scb_descriptor_t
op_star
id|scb
suffix:semicolon
id|mix2_ostream_scb_t
id|mix2_ostream_scb
op_assign
(brace
multiline_comment|/* Basic (non scatter/gather) DMA requestor (4 ints) */
(brace
id|DMA_RQ_C1_SOURCE_MOD64
op_plus
id|DMA_RQ_C1_DEST_ON_HOST
op_plus
id|DMA_RQ_C1_DEST_MOD1024
op_plus
id|DMA_RQ_C1_WRITEBACK_SRC_FLAG
op_plus
id|DMA_RQ_C1_WRITEBACK_DEST_FLAG
op_plus
l_int|15
comma
id|DMA_RQ_C2_AC_NONE
op_plus
id|DMA_RQ_C2_SIGNAL_DEST_PINGPONG
op_plus
id|CS46XX_DSP_CAPTURE_CHANNEL
comma
id|DMA_RQ_SD_SP_SAMPLE_ADDR
op_plus
id|mix_buffer_addr
comma
l_int|0x0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|writeback_spb
comma
id|RSCONFIG_DMA_ENABLE
op_plus
(paren
l_int|19
op_lshift
id|RSCONFIG_MAX_DMA_SIZE_SHIFT
)paren
op_plus
(paren
(paren
id|dest
op_rshift
l_int|4
)paren
op_lshift
id|RSCONFIG_STREAM_NUM_SHIFT
)paren
op_plus
id|RSCONFIG_DMA_TO_HOST
op_plus
id|RSCONFIG_SAMPLE_16STEREO
op_plus
id|RSCONFIG_MODULO_64
comma
(paren
id|mix_buffer_addr
op_plus
(paren
l_int|32
op_star
l_int|4
)paren
)paren
op_lshift
l_int|0x10
comma
l_int|1
comma
l_int|0
comma
l_int|0x0001
comma
l_int|0x0080
comma
l_int|0xFFFF
comma
l_int|0
)brace
suffix:semicolon
id|scb
op_assign
id|cs46xx_dsp_create_generic_scb
c_func
(paren
id|chip
comma
id|scb_name
comma
(paren
id|u32
op_star
)paren
op_amp
id|mix2_ostream_scb
comma
id|dest
comma
l_string|&quot;S16_MIX_TO_OSTREAM&quot;
comma
id|parent_scb
comma
id|scb_child_type
)paren
suffix:semicolon
r_return
id|scb
suffix:semicolon
)brace
id|dsp_scb_descriptor_t
op_star
DECL|function|cs46xx_dsp_create_vari_decimate_scb
id|cs46xx_dsp_create_vari_decimate_scb
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_char
op_star
id|scb_name
comma
id|u16
id|vari_buffer_addr0
comma
id|u16
id|vari_buffer_addr1
comma
id|u32
id|dest
comma
id|dsp_scb_descriptor_t
op_star
id|parent_scb
comma
r_int
id|scb_child_type
)paren
(brace
id|dsp_scb_descriptor_t
op_star
id|scb
suffix:semicolon
id|vari_decimate_scb_t
id|vari_decimate_scb
op_assign
(brace
l_int|0x0028
comma
l_int|0x00c8
comma
l_int|0x5555
comma
l_int|0x0000
comma
l_int|0x0000
comma
l_int|0x0000
comma
id|vari_buffer_addr0
comma
id|vari_buffer_addr1
comma
l_int|0x0028
comma
l_int|0x00c8
comma
id|RSCONFIG_SAMPLE_16STEREO
op_plus
id|RSCONFIG_MODULO_256
comma
l_int|0xFF800000
comma
l_int|0
comma
l_int|0x0080
comma
id|vari_buffer_addr1
op_plus
(paren
l_int|25
op_star
l_int|4
)paren
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|RSCONFIG_SAMPLE_16STEREO
op_plus
id|RSCONFIG_MODULO_8
comma
id|vari_buffer_addr0
op_lshift
l_int|0x10
comma
l_int|0x04000000
comma
(brace
l_int|0x8000
comma
l_int|0x8000
comma
l_int|0xFFFF
comma
l_int|0xFFFF
)brace
)brace
suffix:semicolon
id|scb
op_assign
id|cs46xx_dsp_create_generic_scb
c_func
(paren
id|chip
comma
id|scb_name
comma
(paren
id|u32
op_star
)paren
op_amp
id|vari_decimate_scb
comma
id|dest
comma
l_string|&quot;VARIDECIMATE&quot;
comma
id|parent_scb
comma
id|scb_child_type
)paren
suffix:semicolon
r_return
id|scb
suffix:semicolon
)brace
id|dsp_scb_descriptor_t
op_star
DECL|function|cs46xx_dsp_create_pcm_serial_input_scb
id|cs46xx_dsp_create_pcm_serial_input_scb
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_char
op_star
id|scb_name
comma
id|u32
id|dest
comma
id|dsp_scb_descriptor_t
op_star
id|input_scb
comma
id|dsp_scb_descriptor_t
op_star
id|parent_scb
comma
r_int
id|scb_child_type
)paren
(brace
id|dsp_scb_descriptor_t
op_star
id|scb
suffix:semicolon
id|pcm_serial_input_scb_t
id|pcm_serial_input_scb
op_assign
(brace
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|RSCONFIG_SAMPLE_16STEREO
op_plus
id|RSCONFIG_MODULO_16
comma
l_int|0
comma
l_int|0
comma
id|input_scb-&gt;address
comma
(brace
l_int|0x8000
comma
l_int|0x8000
comma
l_int|0x8000
comma
l_int|0x8000
)brace
)brace
suffix:semicolon
id|scb
op_assign
id|cs46xx_dsp_create_generic_scb
c_func
(paren
id|chip
comma
id|scb_name
comma
(paren
id|u32
op_star
)paren
op_amp
id|pcm_serial_input_scb
comma
id|dest
comma
l_string|&quot;PCMSERIALINPUTTASK&quot;
comma
id|parent_scb
comma
id|scb_child_type
)paren
suffix:semicolon
r_return
id|scb
suffix:semicolon
)brace
id|dsp_scb_descriptor_t
op_star
DECL|function|cs46xx_dsp_create_asynch_fg_tx_scb
id|cs46xx_dsp_create_asynch_fg_tx_scb
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_char
op_star
id|scb_name
comma
id|u32
id|dest
comma
id|u16
id|hfg_scb_address
comma
id|u16
id|asynch_buffer_address
comma
id|dsp_scb_descriptor_t
op_star
id|parent_scb
comma
r_int
id|scb_child_type
)paren
(brace
id|dsp_scb_descriptor_t
op_star
id|scb
suffix:semicolon
id|asynch_fg_tx_scb_t
id|asynch_fg_tx_scb
op_assign
(brace
l_int|0xfc00
comma
l_int|0x03ff
comma
multiline_comment|/*  Prototype sample buffer size of 256 dwords */
l_int|0x0058
comma
l_int|0x0028
comma
multiline_comment|/* Min Delta 7 dwords == 28 bytes */
multiline_comment|/* : Max delta 25 dwords == 100 bytes */
l_int|0
comma
id|hfg_scb_address
comma
multiline_comment|/* Point to HFG task SCB */
l_int|0
comma
l_int|0
comma
multiline_comment|/* Initialize current Delta and Consumer ptr adjustment count */
l_int|0
comma
multiline_comment|/* Initialize accumulated Phi to 0 */
l_int|0
comma
l_int|0x2aab
comma
multiline_comment|/* Const 1/3 */
(brace
l_int|0
comma
multiline_comment|/* Define the unused elements */
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|dest
op_plus
id|AFGTxAccumPhi
comma
id|RSCONFIG_SAMPLE_16STEREO
op_plus
id|RSCONFIG_MODULO_256
comma
multiline_comment|/* Stereo, 256 dword */
(paren
id|asynch_buffer_address
)paren
op_lshift
l_int|0x10
comma
multiline_comment|/* This should be automagically synchronized&n;                                             to the producer pointer */
multiline_comment|/* There is no correct initial value, it will depend upon the detected&n;&t;&t;   rate etc  */
l_int|0x18000000
comma
multiline_comment|/* Phi increment for approx 32k operation */
l_int|0x8000
comma
l_int|0x8000
comma
multiline_comment|/* Volume controls are unused at this time */
l_int|0x8000
comma
l_int|0x8000
)brace
suffix:semicolon
id|scb
op_assign
id|cs46xx_dsp_create_generic_scb
c_func
(paren
id|chip
comma
id|scb_name
comma
(paren
id|u32
op_star
)paren
op_amp
id|asynch_fg_tx_scb
comma
id|dest
comma
l_string|&quot;ASYNCHFGTXCODE&quot;
comma
id|parent_scb
comma
id|scb_child_type
)paren
suffix:semicolon
r_return
id|scb
suffix:semicolon
)brace
id|dsp_scb_descriptor_t
op_star
DECL|function|cs46xx_dsp_create_asynch_fg_rx_scb
id|cs46xx_dsp_create_asynch_fg_rx_scb
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_char
op_star
id|scb_name
comma
id|u32
id|dest
comma
id|u16
id|hfg_scb_address
comma
id|u16
id|asynch_buffer_address
comma
id|dsp_scb_descriptor_t
op_star
id|parent_scb
comma
r_int
id|scb_child_type
)paren
(brace
id|dsp_scb_descriptor_t
op_star
id|scb
suffix:semicolon
id|asynch_fg_rx_scb_t
id|asynch_fg_rx_scb
op_assign
(brace
l_int|0xfe00
comma
l_int|0x01ff
comma
multiline_comment|/*  Prototype sample buffer size of 128 dwords */
l_int|0x0064
comma
l_int|0x001c
comma
multiline_comment|/* Min Delta 7 dwords == 28 bytes */
multiline_comment|/* : Max delta 25 dwords == 100 bytes */
l_int|0
comma
id|hfg_scb_address
comma
multiline_comment|/* Point to HFG task SCB */
l_int|0
comma
l_int|0
comma
multiline_comment|/* Initialize current Delta and Consumer ptr adjustment count */
(brace
l_int|0
comma
multiline_comment|/* Define the unused elements */
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|dest
comma
id|RSCONFIG_MODULO_128
op_or
id|RSCONFIG_SAMPLE_16STEREO
comma
multiline_comment|/* Stereo, 128 dword */
(paren
(paren
id|asynch_buffer_address
op_plus
(paren
l_int|16
op_star
l_int|4
)paren
)paren
op_lshift
l_int|0x10
)paren
comma
multiline_comment|/* This should be automagically &n;&t;&t;&t;&t;&t;&t;&t;                                  synchrinized to the producer pointer */
multiline_comment|/* There is no correct initial value, it will depend upon the detected&n;&t;&t;   rate etc  */
l_int|0x18000000
comma
multiline_comment|/* Mute stream */
l_int|0x8000
comma
l_int|0x8000
comma
l_int|0xffff
comma
l_int|0xffff
)brace
suffix:semicolon
id|scb
op_assign
id|cs46xx_dsp_create_generic_scb
c_func
(paren
id|chip
comma
id|scb_name
comma
(paren
id|u32
op_star
)paren
op_amp
id|asynch_fg_rx_scb
comma
id|dest
comma
l_string|&quot;ASYNCHFGRXCODE&quot;
comma
id|parent_scb
comma
id|scb_child_type
)paren
suffix:semicolon
r_return
id|scb
suffix:semicolon
)brace
id|dsp_scb_descriptor_t
op_star
DECL|function|cs46xx_dsp_create_output_snoop_scb
id|cs46xx_dsp_create_output_snoop_scb
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_char
op_star
id|scb_name
comma
id|u32
id|dest
comma
id|u16
id|snoop_buffer_address
comma
id|dsp_scb_descriptor_t
op_star
id|snoop_scb
comma
id|dsp_scb_descriptor_t
op_star
id|parent_scb
comma
r_int
id|scb_child_type
)paren
(brace
id|dsp_scb_descriptor_t
op_star
id|scb
suffix:semicolon
id|output_snoop_scb_t
id|output_snoop_scb
op_assign
(brace
(brace
l_int|0
comma
multiline_comment|/*  not used.  Zero */
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
comma
(brace
l_int|0
comma
multiline_comment|/* not used.  Zero */
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|RSCONFIG_SAMPLE_16STEREO
op_plus
id|RSCONFIG_MODULO_64
comma
id|snoop_buffer_address
op_lshift
l_int|0x10
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|snoop_scb-&gt;address
)brace
suffix:semicolon
id|scb
op_assign
id|cs46xx_dsp_create_generic_scb
c_func
(paren
id|chip
comma
id|scb_name
comma
(paren
id|u32
op_star
)paren
op_amp
id|output_snoop_scb
comma
id|dest
comma
l_string|&quot;OUTPUTSNOOP&quot;
comma
id|parent_scb
comma
id|scb_child_type
)paren
suffix:semicolon
r_return
id|scb
suffix:semicolon
)brace
id|dsp_scb_descriptor_t
op_star
DECL|function|cs46xx_dsp_create_spio_write_scb
id|cs46xx_dsp_create_spio_write_scb
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_char
op_star
id|scb_name
comma
id|u32
id|dest
comma
id|dsp_scb_descriptor_t
op_star
id|parent_scb
comma
r_int
id|scb_child_type
)paren
(brace
id|dsp_scb_descriptor_t
op_star
id|scb
suffix:semicolon
id|spio_write_scb_t
id|spio_write_scb
op_assign
(brace
l_int|0
comma
l_int|0
comma
multiline_comment|/*   SPIOWAddress2:SPIOWAddress1; */
l_int|0
comma
multiline_comment|/*   SPIOWData1; */
l_int|0
comma
multiline_comment|/*   SPIOWData2; */
l_int|0
comma
l_int|0
comma
multiline_comment|/*   SPIOWAddress4:SPIOWAddress3; */
l_int|0
comma
multiline_comment|/*   SPIOWData3; */
l_int|0
comma
multiline_comment|/*   SPIOWData4; */
l_int|0
comma
l_int|0
comma
multiline_comment|/*   SPIOWDataPtr:Unused1; */
(brace
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/*   Unused2[2]; */
l_int|0
comma
l_int|0
comma
multiline_comment|/*   SPIOWChildPtr:SPIOWSiblingPtr; */
l_int|0
comma
l_int|0
comma
multiline_comment|/*   SPIOWThisPtr:SPIOWEntryPoint; */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
multiline_comment|/*   Unused3[5];  */
)brace
)brace
suffix:semicolon
id|scb
op_assign
id|cs46xx_dsp_create_generic_scb
c_func
(paren
id|chip
comma
id|scb_name
comma
(paren
id|u32
op_star
)paren
op_amp
id|spio_write_scb
comma
id|dest
comma
l_string|&quot;SPIOWRITE&quot;
comma
id|parent_scb
comma
id|scb_child_type
)paren
suffix:semicolon
r_return
id|scb
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_create_magic_snoop_scb
id|dsp_scb_descriptor_t
op_star
id|cs46xx_dsp_create_magic_snoop_scb
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_char
op_star
id|scb_name
comma
id|u32
id|dest
comma
id|u16
id|snoop_buffer_address
comma
id|dsp_scb_descriptor_t
op_star
id|snoop_scb
comma
id|dsp_scb_descriptor_t
op_star
id|parent_scb
comma
r_int
id|scb_child_type
)paren
(brace
id|dsp_scb_descriptor_t
op_star
id|scb
suffix:semicolon
id|magic_snoop_task_t
id|magic_snoop_scb
op_assign
(brace
multiline_comment|/* 0 */
l_int|0
comma
multiline_comment|/* i0 */
multiline_comment|/* 1 */
l_int|0
comma
multiline_comment|/* i1 */
multiline_comment|/* 2 */
id|snoop_buffer_address
op_lshift
l_int|0x10
comma
multiline_comment|/* 3 */
l_int|0
comma
id|snoop_scb-&gt;address
comma
multiline_comment|/* 4 */
l_int|0
comma
multiline_comment|/* i3 */
multiline_comment|/* 5 */
l_int|0
comma
multiline_comment|/* i4 */
multiline_comment|/* 6 */
l_int|0
comma
multiline_comment|/* i5 */
multiline_comment|/* 7 */
l_int|0
comma
multiline_comment|/* i6 */
multiline_comment|/* 8 */
l_int|0
comma
multiline_comment|/* i7 */
multiline_comment|/* 9 */
l_int|0
comma
l_int|0
comma
multiline_comment|/* next_scb, sub_list_ptr */
multiline_comment|/* A */
l_int|0
comma
l_int|0
comma
multiline_comment|/* entry_point, this_ptr */
multiline_comment|/* B */
id|RSCONFIG_SAMPLE_16STEREO
op_plus
id|RSCONFIG_MODULO_64
comma
multiline_comment|/* C */
id|snoop_buffer_address
op_lshift
l_int|0x10
comma
multiline_comment|/* D */
l_int|0
comma
multiline_comment|/* E */
(brace
l_int|0x8000
comma
l_int|0x8000
comma
multiline_comment|/* F */
l_int|0xffff
comma
l_int|0xffff
)brace
)brace
suffix:semicolon
id|scb
op_assign
id|cs46xx_dsp_create_generic_scb
c_func
(paren
id|chip
comma
id|scb_name
comma
(paren
id|u32
op_star
)paren
op_amp
id|magic_snoop_scb
comma
id|dest
comma
l_string|&quot;MAGICSNOOPTASK&quot;
comma
id|parent_scb
comma
id|scb_child_type
)paren
suffix:semicolon
r_return
id|scb
suffix:semicolon
)brace
DECL|function|find_next_free_scb
r_static
id|dsp_scb_descriptor_t
op_star
id|find_next_free_scb
(paren
id|cs46xx_t
op_star
id|chip
comma
id|dsp_scb_descriptor_t
op_star
id|from
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|scb
op_assign
id|from
suffix:semicolon
r_while
c_loop
(paren
id|scb-&gt;next_scb_ptr
op_ne
id|ins-&gt;the_null_scb
)paren
(brace
id|snd_assert
(paren
id|scb-&gt;next_scb_ptr
op_ne
l_int|NULL
comma
r_return
l_int|NULL
)paren
suffix:semicolon
id|scb
op_assign
id|scb-&gt;next_scb_ptr
suffix:semicolon
)brace
r_return
id|scb
suffix:semicolon
)brace
DECL|variable|pcm_reader_buffer_addr
r_static
id|u32
id|pcm_reader_buffer_addr
(braket
id|DSP_MAX_PCM_CHANNELS
)braket
op_assign
(brace
l_int|0x0600
comma
multiline_comment|/* 1 */
l_int|0x1500
comma
multiline_comment|/* 2 */
l_int|0x1580
comma
multiline_comment|/* 3 */
l_int|0x1600
comma
multiline_comment|/* 4 */
l_int|0x1680
comma
multiline_comment|/* 5 */
l_int|0x1700
comma
multiline_comment|/* 6 */
l_int|0x1780
comma
multiline_comment|/* 7 */
l_int|0x1800
comma
multiline_comment|/* 8 */
l_int|0x1880
comma
multiline_comment|/* 9 */
l_int|0x1900
comma
multiline_comment|/* 10 */
l_int|0x1980
comma
multiline_comment|/* 11 */
l_int|0x1A00
comma
multiline_comment|/* 12 */
l_int|0x1A80
comma
multiline_comment|/* 13 */
l_int|0x1B00
comma
multiline_comment|/* 14 */
l_int|0x1B80
comma
multiline_comment|/* 15 */
l_int|0x1C00
comma
multiline_comment|/* 16 */
l_int|0x1C80
comma
multiline_comment|/* 17 */
l_int|0x1D00
comma
multiline_comment|/* 18 */
l_int|0x1D80
comma
multiline_comment|/* 19 */
l_int|0x1E00
comma
multiline_comment|/* 20 */
l_int|0x1E80
comma
multiline_comment|/* 21 */
l_int|0x1F00
comma
multiline_comment|/* 22 */
l_int|0x1F80
comma
multiline_comment|/* 23 */
l_int|0x2000
comma
multiline_comment|/* 24 */
l_int|0x2080
comma
multiline_comment|/* 25 */
l_int|0x2100
comma
multiline_comment|/* 26 */
l_int|0x2180
comma
multiline_comment|/* 27 */
l_int|0x2200
comma
multiline_comment|/* 28 */
l_int|0x2280
comma
multiline_comment|/* 29 */
l_int|0x2300
comma
multiline_comment|/* 30 */
l_int|0x2380
comma
multiline_comment|/* 31 */
l_int|0x2400
comma
multiline_comment|/* 32 */
)brace
suffix:semicolon
DECL|variable|src_output_buffer_addr
r_static
id|u32
id|src_output_buffer_addr
(braket
id|DSP_MAX_SRC_NR
)braket
op_assign
(brace
l_int|0x2580
comma
l_int|0x2680
comma
l_int|0x2780
comma
l_int|0x2980
comma
l_int|0x2A80
comma
l_int|0x2B80
comma
)brace
suffix:semicolon
DECL|variable|src_delay_buffer_addr
r_static
id|u32
id|src_delay_buffer_addr
(braket
id|DSP_MAX_SRC_NR
)braket
op_assign
(brace
l_int|0x2600
comma
l_int|0x2700
comma
l_int|0x2800
comma
l_int|0x2900
comma
l_int|0x2A00
comma
l_int|0x2B00
comma
)brace
suffix:semicolon
DECL|function|cs46xx_dsp_create_pcm_channel
id|pcm_channel_descriptor_t
op_star
id|cs46xx_dsp_create_pcm_channel
(paren
id|cs46xx_t
op_star
id|chip
comma
id|u32
id|sample_rate
comma
r_void
op_star
id|private_data
comma
id|u32
id|hw_dma_addr
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|src_scb
op_assign
l_int|NULL
comma
op_star
id|pcm_scb
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|pcm_parent_scb
suffix:semicolon
r_char
id|scb_name
(braket
id|DSP_MAX_SCB_NAME
)braket
suffix:semicolon
r_int
id|i
comma
id|pcm_index
op_assign
op_minus
l_int|1
comma
id|insert_point
comma
id|src_index
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ins-&gt;pcm_mutex
)paren
suffix:semicolon
multiline_comment|/* default sample rate is 44100 */
r_if
c_cond
(paren
op_logical_neg
id|sample_rate
)paren
id|sample_rate
op_assign
l_int|44100
suffix:semicolon
multiline_comment|/* search for a already created SRC SCB with the same sample rate */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DSP_MAX_PCM_CHANNELS
op_logical_and
(paren
id|pcm_index
op_eq
op_minus
l_int|1
op_logical_or
id|src_scb
op_eq
l_int|NULL
)paren
suffix:semicolon
op_increment
id|i
)paren
(brace
multiline_comment|/* virtual channel reserved &n;&t;&t;   for capture */
r_if
c_cond
(paren
id|i
op_eq
id|CS46XX_DSP_CAPTURE_CHANNEL
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;pcm_channels
(braket
id|i
)braket
dot
id|active
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|src_scb
op_logical_and
id|ins-&gt;pcm_channels
(braket
id|i
)braket
dot
id|sample_rate
op_eq
id|sample_rate
)paren
(brace
id|src_scb
op_assign
id|ins-&gt;pcm_channels
(braket
id|i
)braket
dot
id|src_scb
suffix:semicolon
id|ins-&gt;pcm_channels
(braket
id|i
)braket
dot
id|src_scb-&gt;ref_count
op_increment
suffix:semicolon
id|src_index
op_assign
id|ins-&gt;pcm_channels
(braket
id|i
)braket
dot
id|src_slot
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|pcm_index
op_eq
op_minus
l_int|1
)paren
(brace
id|pcm_index
op_assign
id|i
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|pcm_index
op_eq
op_minus
l_int|1
)paren
(brace
id|snd_printk
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: no free PCM channel&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|_end
suffix:semicolon
)brace
r_if
c_cond
(paren
id|src_scb
op_eq
l_int|NULL
)paren
(brace
id|dsp_scb_descriptor_t
op_star
id|src_parent_scb
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;nsrc_scb
op_ge
id|DSP_MAX_SRC_NR
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: to many SRC instances&bslash;n!&quot;
)paren
suffix:semicolon
r_goto
id|_end
suffix:semicolon
)brace
multiline_comment|/* find a free slot */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DSP_MAX_SRC_NR
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|ins-&gt;src_scb_slots
(braket
id|i
)braket
op_eq
l_int|0
)paren
(brace
id|src_index
op_assign
id|i
suffix:semicolon
id|ins-&gt;src_scb_slots
(braket
id|i
)braket
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|snd_assert
(paren
id|src_index
op_ne
op_minus
l_int|1
comma
r_goto
id|_end
)paren
suffix:semicolon
multiline_comment|/* we need to create a new SRC SCB */
r_if
c_cond
(paren
id|ins-&gt;master_mix_scb-&gt;sub_list_ptr
op_eq
id|ins-&gt;the_null_scb
)paren
(brace
id|src_parent_scb
op_assign
id|ins-&gt;master_mix_scb
suffix:semicolon
id|insert_point
op_assign
id|SCB_ON_PARENT_SUBLIST_SCB
suffix:semicolon
)brace
r_else
(brace
id|src_parent_scb
op_assign
id|find_next_free_scb
c_func
(paren
id|chip
comma
id|ins-&gt;master_mix_scb-&gt;sub_list_ptr
)paren
suffix:semicolon
id|insert_point
op_assign
id|SCB_ON_PARENT_NEXT_SCB
suffix:semicolon
)brace
id|snprintf
(paren
id|scb_name
comma
id|DSP_MAX_SCB_NAME
comma
l_string|&quot;SrcTask_SCB%d&quot;
comma
id|src_index
)paren
suffix:semicolon
id|snd_printdd
c_func
(paren
l_string|&quot;dsp_spos: creating SRC &bslash;&quot;%s&bslash;&quot;&bslash;n&quot;
comma
id|scb_name
)paren
suffix:semicolon
id|src_scb
op_assign
id|cs46xx_dsp_create_src_task_scb
c_func
(paren
id|chip
comma
id|scb_name
comma
id|src_output_buffer_addr
(braket
id|src_index
)braket
comma
id|src_delay_buffer_addr
(braket
id|src_index
)braket
comma
multiline_comment|/* 0x400 - 0x600 source SCBs */
l_int|0x400
op_plus
(paren
id|src_index
op_star
l_int|0x10
)paren
comma
id|src_parent_scb
comma
id|insert_point
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|src_scb
)paren
(brace
id|snd_printk
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: failed to create SRCtaskSCB&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|_end
suffix:semicolon
)brace
id|cs46xx_dsp_set_src_sample_rate
c_func
(paren
id|chip
comma
id|src_scb
comma
id|sample_rate
)paren
suffix:semicolon
id|ins-&gt;nsrc_scb
op_increment
suffix:semicolon
multiline_comment|/* insert point for the PCMreader task */
id|pcm_parent_scb
op_assign
id|src_scb
suffix:semicolon
id|insert_point
op_assign
id|SCB_ON_PARENT_SUBLIST_SCB
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* if channel is unlinked then src_scb-&gt;sub_list_ptr == null_scb, and&n;         that&squot;s a correct state.&n;        snd_assert (src_scb-&gt;sub_list_ptr != ins-&gt;the_null_scb, goto _end); &n;      */
r_if
c_cond
(paren
id|src_scb-&gt;sub_list_ptr
op_ne
id|ins-&gt;the_null_scb
)paren
(brace
id|pcm_parent_scb
op_assign
id|find_next_free_scb
c_func
(paren
id|chip
comma
id|src_scb-&gt;sub_list_ptr
)paren
suffix:semicolon
id|insert_point
op_assign
id|SCB_ON_PARENT_NEXT_SCB
suffix:semicolon
)brace
r_else
(brace
id|pcm_parent_scb
op_assign
id|src_scb
suffix:semicolon
id|insert_point
op_assign
id|SCB_ON_PARENT_SUBLIST_SCB
suffix:semicolon
)brace
)brace
id|snprintf
(paren
id|scb_name
comma
id|DSP_MAX_SCB_NAME
comma
l_string|&quot;PCMReader_SCB%d&quot;
comma
id|pcm_index
)paren
suffix:semicolon
id|snd_printdd
c_func
(paren
l_string|&quot;dsp_spos: creating PCM &bslash;&quot;%s&bslash;&quot;&bslash;n&quot;
comma
id|scb_name
)paren
suffix:semicolon
id|pcm_scb
op_assign
id|cs46xx_dsp_create_pcm_reader_scb
c_func
(paren
id|chip
comma
id|scb_name
comma
id|pcm_reader_buffer_addr
(braket
id|pcm_index
)braket
comma
multiline_comment|/* 0x200 - 400 PCMreader SCBs */
(paren
id|pcm_index
op_star
l_int|0x10
)paren
op_plus
l_int|0x200
comma
id|pcm_index
comma
multiline_comment|/* virtual channel 0-31 */
id|hw_dma_addr
comma
multiline_comment|/* pcm hw addr */
id|pcm_parent_scb
comma
id|insert_point
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pcm_scb
)paren
(brace
id|snd_printk
(paren
id|KERN_ERR
l_string|&quot;dsp_spos: failed to create PCMreaderSCB&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|_end
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|ins-&gt;pcm_channels
(braket
id|pcm_index
)braket
dot
id|sample_rate
op_assign
id|sample_rate
suffix:semicolon
id|ins-&gt;pcm_channels
(braket
id|pcm_index
)braket
dot
id|pcm_reader_scb
op_assign
id|pcm_scb
suffix:semicolon
id|ins-&gt;pcm_channels
(braket
id|pcm_index
)braket
dot
id|src_scb
op_assign
id|src_scb
suffix:semicolon
id|ins-&gt;pcm_channels
(braket
id|pcm_index
)braket
dot
id|unlinked
op_assign
l_int|0
suffix:semicolon
id|ins-&gt;pcm_channels
(braket
id|pcm_index
)braket
dot
id|private_data
op_assign
id|private_data
suffix:semicolon
id|ins-&gt;pcm_channels
(braket
id|pcm_index
)braket
dot
id|src_slot
op_assign
id|src_index
suffix:semicolon
id|ins-&gt;pcm_channels
(braket
id|pcm_index
)braket
dot
id|active
op_assign
l_int|1
suffix:semicolon
id|ins-&gt;pcm_channels
(braket
id|pcm_index
)braket
dot
id|pcm_slot
op_assign
id|pcm_index
suffix:semicolon
id|ins-&gt;npcm_channels
op_increment
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ins-&gt;pcm_mutex
)paren
suffix:semicolon
r_return
(paren
id|ins-&gt;pcm_channels
op_plus
id|pcm_index
)paren
suffix:semicolon
id|_end
suffix:colon
id|up
c_func
(paren
op_amp
id|ins-&gt;pcm_mutex
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_destroy_pcm_channel
r_void
id|cs46xx_dsp_destroy_pcm_channel
(paren
id|cs46xx_t
op_star
id|chip
comma
id|pcm_channel_descriptor_t
op_star
id|pcm_channel
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ins-&gt;pcm_mutex
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|pcm_channel-&gt;active
comma
r_goto
id|_end
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|ins-&gt;npcm_channels
OG
l_int|0
comma
r_goto
id|_end
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|pcm_channel-&gt;src_scb-&gt;ref_count
OG
l_int|0
comma
r_goto
id|_end
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|pcm_channel-&gt;unlinked
op_assign
l_int|1
suffix:semicolon
id|pcm_channel-&gt;active
op_assign
l_int|0
suffix:semicolon
id|pcm_channel-&gt;private_data
op_assign
l_int|NULL
suffix:semicolon
id|pcm_channel-&gt;src_scb-&gt;ref_count
op_decrement
suffix:semicolon
id|ins-&gt;npcm_channels
op_decrement
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|cs46xx_dsp_remove_scb
c_func
(paren
id|chip
comma
id|pcm_channel-&gt;pcm_reader_scb
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pcm_channel-&gt;src_scb-&gt;ref_count
)paren
(brace
id|cs46xx_dsp_remove_scb
c_func
(paren
id|chip
comma
id|pcm_channel-&gt;src_scb
)paren
suffix:semicolon
id|snd_assert
(paren
id|pcm_channel-&gt;src_slot
op_ge
l_int|0
op_logical_and
id|pcm_channel-&gt;src_slot
op_le
id|DSP_MAX_SRC_NR
comma
r_goto
id|_end
)paren
suffix:semicolon
id|ins-&gt;src_scb_slots
(braket
id|pcm_channel-&gt;src_slot
)braket
op_assign
l_int|0
suffix:semicolon
id|ins-&gt;nsrc_scb
op_decrement
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SND_DEBUG
id|_end
suffix:colon
macro_line|#endif
id|up
c_func
(paren
op_amp
id|ins-&gt;pcm_mutex
)paren
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_pcm_unlink
r_int
id|cs46xx_dsp_pcm_unlink
(paren
id|cs46xx_t
op_star
id|chip
comma
id|pcm_channel_descriptor_t
op_star
id|pcm_channel
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ins-&gt;pcm_mutex
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ins-&gt;scb_mutex
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|pcm_channel-&gt;active
comma
r_goto
id|_end
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|ins-&gt;npcm_channels
OG
l_int|0
comma
r_goto
id|_end
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcm_channel-&gt;unlinked
)paren
r_goto
id|_end
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|pcm_channel-&gt;unlinked
op_assign
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|_dsp_unlink_scb
(paren
id|chip
comma
id|pcm_channel-&gt;pcm_reader_scb
)paren
suffix:semicolon
id|_end
suffix:colon
id|up
c_func
(paren
op_amp
id|ins-&gt;scb_mutex
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ins-&gt;pcm_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs46xx_dsp_pcm_link
r_int
id|cs46xx_dsp_pcm_link
(paren
id|cs46xx_t
op_star
id|chip
comma
id|pcm_channel_descriptor_t
op_star
id|pcm_channel
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|parent_scb
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|src_scb
op_assign
id|pcm_channel-&gt;src_scb
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ins-&gt;pcm_mutex
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ins-&gt;scb_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcm_channel-&gt;unlinked
op_eq
l_int|0
)paren
r_goto
id|_end
suffix:semicolon
r_if
c_cond
(paren
id|src_scb-&gt;sub_list_ptr
op_eq
id|ins-&gt;the_null_scb
)paren
(brace
id|parent_scb
op_assign
id|src_scb
suffix:semicolon
id|parent_scb-&gt;sub_list_ptr
op_assign
id|pcm_channel-&gt;pcm_reader_scb
suffix:semicolon
)brace
r_else
(brace
id|parent_scb
op_assign
id|find_next_free_scb
c_func
(paren
id|chip
comma
id|src_scb-&gt;sub_list_ptr
)paren
suffix:semicolon
id|parent_scb-&gt;next_scb_ptr
op_assign
id|pcm_channel-&gt;pcm_reader_scb
suffix:semicolon
)brace
id|snd_assert
(paren
id|pcm_channel-&gt;pcm_reader_scb-&gt;parent_scb_ptr
op_eq
l_int|NULL
comma
suffix:semicolon
)paren
suffix:semicolon
id|pcm_channel-&gt;pcm_reader_scb-&gt;parent_scb_ptr
op_assign
id|parent_scb
suffix:semicolon
multiline_comment|/* update entry in DSP RAM */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
(paren
id|parent_scb-&gt;address
op_plus
id|SCBsubListPtr
)paren
op_lshift
l_int|2
comma
(paren
id|parent_scb-&gt;sub_list_ptr-&gt;address
op_lshift
l_int|0x10
)paren
op_or
(paren
id|parent_scb-&gt;next_scb_ptr-&gt;address
)paren
)paren
suffix:semicolon
id|pcm_channel-&gt;unlinked
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|_end
suffix:colon
id|up
c_func
(paren
op_amp
id|ins-&gt;scb_mutex
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ins-&gt;pcm_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|GOF_PER_SEC
mdefine_line|#define GOF_PER_SEC 200
DECL|function|cs46xx_dsp_set_src_sample_rate
r_void
id|cs46xx_dsp_set_src_sample_rate
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
id|dsp_scb_descriptor_t
op_star
id|src
comma
id|u32
id|rate
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|tmp1
comma
id|tmp2
suffix:semicolon
r_int
r_int
id|phiIncr
suffix:semicolon
r_int
r_int
id|correctionPerGOF
comma
id|correctionPerSec
suffix:semicolon
id|snd_printdd
c_func
(paren
l_string|&quot;dsp_spos: setting SRC rate to %u&bslash;n&quot;
comma
id|rate
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Compute the values used to drive the actual sample rate conversion.&n;&t; *  The following formulas are being computed, using inline assembly&n;&t; *  since we need to use 64 bit arithmetic to compute the values:&n;&t; *&n;&t; *  phiIncr = floor((Fs,in * 2^26) / Fs,out)&n;&t; *  correctionPerGOF = floor((Fs,in * 2^26 - Fs,out * phiIncr) /&n;&t; *                                   GOF_PER_SEC)&n;&t; *  ulCorrectionPerSec = Fs,in * 2^26 - Fs,out * phiIncr -M&n;&t; *                       GOF_PER_SEC * correctionPerGOF&n;&t; *&n;&t; *  i.e.&n;&t; *&n;&t; *  phiIncr:other = dividend:remainder((Fs,in * 2^26) / Fs,out)&n;&t; *  correctionPerGOF:correctionPerSec =&n;&t; *      dividend:remainder(ulOther / GOF_PER_SEC)&n;&t; */
id|tmp1
op_assign
id|rate
op_lshift
l_int|16
suffix:semicolon
id|phiIncr
op_assign
id|tmp1
op_div
l_int|48000
suffix:semicolon
id|tmp1
op_sub_assign
id|phiIncr
op_star
l_int|48000
suffix:semicolon
id|tmp1
op_lshift_assign
l_int|10
suffix:semicolon
id|phiIncr
op_lshift_assign
l_int|10
suffix:semicolon
id|tmp2
op_assign
id|tmp1
op_div
l_int|48000
suffix:semicolon
id|phiIncr
op_add_assign
id|tmp2
suffix:semicolon
id|tmp1
op_sub_assign
id|tmp2
op_star
l_int|48000
suffix:semicolon
id|correctionPerGOF
op_assign
id|tmp1
op_div
id|GOF_PER_SEC
suffix:semicolon
id|tmp1
op_sub_assign
id|correctionPerGOF
op_star
id|GOF_PER_SEC
suffix:semicolon
id|correctionPerSec
op_assign
id|tmp1
suffix:semicolon
multiline_comment|/*&n;&t; *  Fill in the SampleRateConverter control block.&n;&t; */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* mute SCB */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
(paren
id|src-&gt;address
op_plus
l_int|0xE
)paren
op_lshift
l_int|2
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
(paren
id|src-&gt;address
op_plus
id|SRCCorPerGof
)paren
op_lshift
l_int|2
comma
(paren
(paren
id|correctionPerSec
op_lshift
l_int|16
)paren
op_amp
l_int|0xFFFF0000
)paren
op_or
(paren
id|correctionPerGOF
op_amp
l_int|0xFFFF
)paren
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
(paren
id|src-&gt;address
op_plus
id|SRCPhiIncr6Int26Frac
)paren
op_lshift
l_int|2
comma
id|phiIncr
)paren
suffix:semicolon
multiline_comment|/* raise volume */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
(paren
id|src-&gt;address
op_plus
l_int|0xE
)paren
op_lshift
l_int|2
comma
l_int|0x80008000
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
id|dsp_scb_descriptor_t
op_star
DECL|function|cs46xx_add_record_source
id|cs46xx_add_record_source
(paren
id|cs46xx_t
op_star
id|chip
comma
id|dsp_scb_descriptor_t
op_star
id|source
comma
id|u16
id|addr
comma
r_char
op_star
id|scb_name
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|parent
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|pcm_input
suffix:semicolon
r_int
id|insert_point
suffix:semicolon
id|snd_assert
(paren
id|ins-&gt;record_mixer_scb
op_ne
l_int|NULL
comma
r_return
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;record_mixer_scb-&gt;sub_list_ptr
op_ne
id|ins-&gt;the_null_scb
)paren
(brace
id|parent
op_assign
id|find_next_free_scb
(paren
id|chip
comma
id|ins-&gt;record_mixer_scb-&gt;sub_list_ptr
)paren
suffix:semicolon
id|insert_point
op_assign
id|SCB_ON_PARENT_NEXT_SCB
suffix:semicolon
)brace
r_else
(brace
id|parent
op_assign
id|ins-&gt;record_mixer_scb
suffix:semicolon
id|insert_point
op_assign
id|SCB_ON_PARENT_SUBLIST_SCB
suffix:semicolon
)brace
id|pcm_input
op_assign
id|cs46xx_dsp_create_pcm_serial_input_scb
c_func
(paren
id|chip
comma
id|scb_name
comma
id|addr
comma
id|source
comma
id|parent
comma
id|insert_point
)paren
suffix:semicolon
r_return
id|pcm_input
suffix:semicolon
)brace
DECL|function|cs46xx_src_unlink
r_int
id|cs46xx_src_unlink
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
id|dsp_scb_descriptor_t
op_star
id|src
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ins-&gt;pcm_mutex
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ins-&gt;scb_mutex
)paren
suffix:semicolon
id|snd_assert
(paren
id|src-&gt;parent_scb_ptr
op_ne
l_int|NULL
comma
r_goto
id|_fail_end
)paren
suffix:semicolon
multiline_comment|/* mute SCB */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
(paren
id|src-&gt;address
op_plus
l_int|0xE
)paren
op_lshift
l_int|2
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|_dsp_unlink_scb
(paren
id|chip
comma
id|src
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ins-&gt;scb_mutex
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ins-&gt;pcm_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|_fail_end
suffix:colon
id|up
c_func
(paren
op_amp
id|ins-&gt;scb_mutex
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ins-&gt;pcm_mutex
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|cs46xx_src_link
r_int
id|cs46xx_src_link
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
id|dsp_scb_descriptor_t
op_star
id|src
)paren
(brace
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|dsp_scb_descriptor_t
op_star
id|parent_scb
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ins-&gt;pcm_mutex
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ins-&gt;scb_mutex
)paren
suffix:semicolon
id|snd_assert
(paren
id|src-&gt;parent_scb_ptr
op_eq
l_int|NULL
comma
r_goto
id|_fail_end
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|ins-&gt;master_mix_scb
op_ne
l_int|NULL
comma
r_goto
id|_fail_end
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;master_mix_scb-&gt;sub_list_ptr
op_ne
id|ins-&gt;the_null_scb
)paren
(brace
id|parent_scb
op_assign
id|find_next_free_scb
(paren
id|chip
comma
id|ins-&gt;master_mix_scb-&gt;sub_list_ptr
)paren
suffix:semicolon
id|parent_scb-&gt;next_scb_ptr
op_assign
id|src
suffix:semicolon
)brace
r_else
(brace
id|parent_scb
op_assign
id|ins-&gt;master_mix_scb
suffix:semicolon
id|parent_scb-&gt;sub_list_ptr
op_assign
id|src
suffix:semicolon
)brace
id|src-&gt;parent_scb_ptr
op_assign
id|parent_scb
suffix:semicolon
multiline_comment|/* update entry in DSP RAM */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
(paren
id|parent_scb-&gt;address
op_plus
id|SCBsubListPtr
)paren
op_lshift
l_int|2
comma
(paren
id|parent_scb-&gt;sub_list_ptr-&gt;address
op_lshift
l_int|0x10
)paren
op_or
(paren
id|parent_scb-&gt;next_scb_ptr-&gt;address
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ins-&gt;scb_mutex
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ins-&gt;pcm_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|_fail_end
suffix:colon
id|up
c_func
(paren
op_amp
id|ins-&gt;scb_mutex
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ins-&gt;pcm_mutex
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
eof
