multiline_comment|/*&n; *  Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *                   Abramo Bagnara &lt;abramo@alsa-project.org&gt;&n; *                   Cirrus Logic, Inc.&n; *  Routines for control of Cirrus Logic CS461x chips&n; *&n; *  BUGS:&n; *    --&n; *&n; *  TODO:&n; *    We need a DSP code to support multichannel outputs and S/PDIF.&n; *    Unfortunately, it seems that Cirrus Logic, Inc. is not willing&n; *    to provide us sufficient information about the DSP processor,&n; *    so we can&squot;t update the driver.&n; *&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/pm.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/control.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#include &lt;sound/cs46xx.h&gt;
macro_line|#ifndef LINUX_2_2
macro_line|#include &lt;linux/gameport.h&gt;
macro_line|#endif
DECL|macro|chip_t
mdefine_line|#define chip_t cs46xx_t
multiline_comment|/*&n; *  constants&n; */
DECL|macro|CS46XX_BA0_SIZE
mdefine_line|#define CS46XX_BA0_SIZE&t;&t;0x1000
DECL|macro|CS46XX_BA1_DATA0_SIZE
mdefine_line|#define CS46XX_BA1_DATA0_SIZE&t;0x3000
DECL|macro|CS46XX_BA1_DATA1_SIZE
mdefine_line|#define CS46XX_BA1_DATA1_SIZE&t;0x3800
DECL|macro|CS46XX_BA1_PRG_SIZE
mdefine_line|#define CS46XX_BA1_PRG_SIZE&t;0x7000
DECL|macro|CS46XX_BA1_REG_SIZE
mdefine_line|#define CS46XX_BA1_REG_SIZE&t;0x0100
DECL|macro|CS46XX_PERIOD_SIZE
mdefine_line|#define CS46XX_PERIOD_SIZE 2048
DECL|macro|CS46XX_FRAGS
mdefine_line|#define CS46XX_FRAGS 2
DECL|macro|CS46XX_BUFFER_SIZE
mdefine_line|#define CS46XX_BUFFER_SIZE CS46XX_PERIOD_SIZE * CS46XX_FRAGS
r_extern
id|snd_pcm_ops_t
id|snd_cs46xx_playback_ops
suffix:semicolon
r_extern
id|snd_pcm_ops_t
id|snd_cs46xx_playback_indirect_ops
suffix:semicolon
r_extern
id|snd_pcm_ops_t
id|snd_cs46xx_capture_ops
suffix:semicolon
r_extern
id|snd_pcm_ops_t
id|snd_cs46xx_capture_indirect_ops
suffix:semicolon
multiline_comment|/*&n; *  common I/O routines&n; */
DECL|function|snd_cs46xx_poke
r_static
r_inline
r_void
id|snd_cs46xx_poke
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
r_int
r_int
id|bank
op_assign
id|reg
op_rshift
l_int|16
suffix:semicolon
r_int
r_int
id|offset
op_assign
id|reg
op_amp
l_int|0xffff
suffix:semicolon
id|writel
c_func
(paren
id|val
comma
id|chip-&gt;region.idx
(braket
id|bank
op_plus
l_int|1
)braket
dot
id|remap_addr
op_plus
id|offset
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_peek
r_static
r_inline
r_int
r_int
id|snd_cs46xx_peek
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
r_int
id|reg
)paren
(brace
r_int
r_int
id|bank
op_assign
id|reg
op_rshift
l_int|16
suffix:semicolon
r_int
r_int
id|offset
op_assign
id|reg
op_amp
l_int|0xffff
suffix:semicolon
r_return
id|readl
c_func
(paren
id|chip-&gt;region.idx
(braket
id|bank
op_plus
l_int|1
)braket
dot
id|remap_addr
op_plus
id|offset
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_pokeBA0
r_static
r_inline
r_void
id|snd_cs46xx_pokeBA0
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
r_int
id|offset
comma
r_int
r_int
id|val
)paren
(brace
id|writel
c_func
(paren
id|val
comma
id|chip-&gt;region.name.ba0.remap_addr
op_plus
id|offset
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_peekBA0
r_static
r_inline
r_int
r_int
id|snd_cs46xx_peekBA0
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
r_int
id|offset
)paren
(brace
r_return
id|readl
c_func
(paren
id|chip-&gt;region.name.ba0.remap_addr
op_plus
id|offset
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_codec_read
r_static
r_int
r_int
id|snd_cs46xx_codec_read
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
r_int
id|reg
)paren
(brace
r_int
id|count
suffix:semicolon
r_int
r_int
id|result
suffix:semicolon
multiline_comment|/*&n;&t; *  1. Write ACCAD = Command Address Register = 46Ch for AC97 register address&n;&t; *  2. Write ACCDA = Command Data Register = 470h    for data to write to AC97 &n;&t; *  3. Write ACCTL = Control Register = 460h for initiating the write&n;&t; *  4. Read ACCTL = 460h, DCV should be reset by now and 460h = 17h&n;&t; *  5. if DCV not cleared, break and return error&n;&t; *  6. Read ACSTS = Status Register = 464h, check VSTS bit&n;&t; */
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACSDA
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Setup the AC97 control registers on the CS461x to send the&n;&t; *  appropriate command to the AC97 to perform the read.&n;&t; *  ACCAD = Command Address Register = 46Ch&n;&t; *  ACCDA = Command Data Register = 470h&n;&t; *  ACCTL = Control Register = 460h&n;&t; *  set DCV - will clear when process completed&n;&t; *  set CRW - Read command&n;&t; *  set VFRM - valid frame enabled&n;&t; *  set ESYN - ASYNC generation enabled&n;&t; *  set RSTN - ARST# inactive, AC97 codec not reset&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCAD
comma
id|reg
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCDA
comma
l_int|0
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
id|ACCTL_DCV
op_or
id|ACCTL_CRW
op_or
id|ACCTL_VFRM
op_or
id|ACCTL_ESYN
op_or
id|ACCTL_RSTN
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Wait for the read to occur.&n;&t; */
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
l_int|1000
suffix:semicolon
id|count
op_increment
)paren
(brace
multiline_comment|/*&n;&t;&t; *  First, we want to wait for a short time.&n;&t; &t; */
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; *  Now, check to see if the read has completed.&n;&t;&t; *  ACCTL = 460h, DCV should be reset by now and 460h = 17h&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
)paren
op_amp
id|ACCTL_DCV
)paren
)paren
r_goto
id|ok1
suffix:semicolon
)brace
id|snd_printk
c_func
(paren
l_string|&quot;AC&squot;97 read problem (ACCTL_DCV), reg = 0x%x&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
id|result
op_assign
l_int|0xffff
suffix:semicolon
r_goto
id|end
suffix:semicolon
id|ok1
suffix:colon
multiline_comment|/*&n;&t; *  Wait for the valid status bit to go active.&n;&t; */
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
l_int|100
suffix:semicolon
id|count
op_increment
)paren
(brace
multiline_comment|/*&n;&t;&t; *  Read the AC97 status register.&n;&t;&t; *  ACSTS = Status Register = 464h&n;&t;&t; *  VSTS - Valid Status&n;&t;&t; */
r_if
c_cond
(paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACSTS
)paren
op_amp
id|ACSTS_VSTS
)paren
r_goto
id|ok2
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|snd_printk
c_func
(paren
l_string|&quot;AC&squot;97 read problem (ACSTS_VSTS), reg = 0x%x&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
id|result
op_assign
l_int|0xffff
suffix:semicolon
r_goto
id|end
suffix:semicolon
id|ok2
suffix:colon
multiline_comment|/*&n;&t; *  Read the data returned from the AC97 register.&n;&t; *  ACSDA = Status Data Register = 474h&n;&t; */
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;e) reg = 0x%x, val = 0x%x, BA0_ACCAD = 0x%x&bslash;n&quot;
comma
id|reg
comma
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACSDA
)paren
comma
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACCAD
)paren
)paren
suffix:semicolon
macro_line|#endif
id|result
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACSDA
)paren
suffix:semicolon
id|end
suffix:colon
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_cs46xx_ac97_read
r_static
r_int
r_int
id|snd_cs46xx_ac97_read
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|ac97-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
id|val
op_assign
id|snd_cs46xx_codec_read
c_func
(paren
id|chip
comma
id|reg
)paren
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
DECL|function|snd_cs46xx_codec_write
r_static
r_void
id|snd_cs46xx_codec_write
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
multiline_comment|/*&n;&t; *  1. Write ACCAD = Command Address Register = 46Ch for AC97 register address&n;&t; *  2. Write ACCDA = Command Data Register = 470h    for data to write to AC97&n;&t; *  3. Write ACCTL = Control Register = 460h for initiating the write&n;&t; *  4. Read ACCTL = 460h, DCV should be reset by now and 460h = 07h&n;&t; *  5. if DCV not cleared, break and return error&n;&t; */
r_int
id|count
suffix:semicolon
multiline_comment|/*&n;&t; *  Setup the AC97 control registers on the CS461x to send the&n;&t; *  appropriate command to the AC97 to perform the read.&n;&t; *  ACCAD = Command Address Register = 46Ch&n;&t; *  ACCDA = Command Data Register = 470h&n;&t; *  ACCTL = Control Register = 460h&n;&t; *  set DCV - will clear when process completed&n;&t; *  reset CRW - Write command&n;&t; *  set VFRM - valid frame enabled&n;&t; *  set ESYN - ASYNC generation enabled&n;&t; *  set RSTN - ARST# inactive, AC97 codec not reset&n;         */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCAD
comma
id|reg
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCDA
comma
id|val
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
id|ACCTL_DCV
op_or
id|ACCTL_VFRM
op_or
id|ACCTL_ESYN
op_or
id|ACCTL_RSTN
)paren
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
l_int|4000
suffix:semicolon
id|count
op_increment
)paren
(brace
multiline_comment|/*&n;&t;&t; *  First, we want to wait for a short time.&n;&t;&t; */
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; *  Now, check to see if the write has completed.&n;&t;&t; *  ACCTL = 460h, DCV should be reset by now and 460h = 07h&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
)paren
op_amp
id|ACCTL_DCV
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
)brace
id|snd_printk
c_func
(paren
l_string|&quot;AC&squot;97 write problem, reg = 0x%x, val = 0x%x&bslash;n&quot;
comma
id|reg
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_ac97_write
r_static
r_void
id|snd_cs46xx_ac97_write
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|ac97-&gt;private_data
comma
r_return
)paren
suffix:semicolon
r_int
id|val2
op_assign
l_int|0
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_eq
id|AC97_CD
)paren
id|val2
op_assign
id|snd_cs46xx_codec_read
c_func
(paren
id|chip
comma
id|AC97_CD
)paren
suffix:semicolon
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
id|reg
comma
id|val
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;Adjust power if the mixer is selected/deselected according&n;&t; *&t;to the CD.&n;&t; *&n;&t; *&t;IF the CD is a valid input source (mixer or direct) AND&n;&t; *&t;&t;the CD is not muted THEN power is needed&n;&t; *&n;&t; *&t;We do two things. When record select changes the input to&n;&t; *&t;add/remove the CD we adjust the power count if the CD is&n;&t; *&t;unmuted.&n;&t; *&n;&t; *&t;When the CD mute changes we adjust the power level if the&n;&t; *&t;CD was a valid input.&n;&t; *&n;&t; *      We also check for CD volume != 0, as the CD mute isn&squot;t&n;&t; *      normally tweaked from userspace.&n;&t; */
multiline_comment|/* CD mute change ? */
r_if
c_cond
(paren
id|reg
op_eq
id|AC97_CD
)paren
(brace
multiline_comment|/* Mute bit change ? */
r_if
c_cond
(paren
(paren
id|val2
op_xor
id|val
)paren
op_amp
l_int|0x8000
op_logical_or
(paren
(paren
id|val2
op_eq
l_int|0x1f1f
op_logical_or
id|val
op_eq
l_int|0x1f1f
)paren
op_logical_and
id|val2
op_ne
id|val
)paren
)paren
(brace
multiline_comment|/* Mute on */
r_if
c_cond
(paren
id|val
op_amp
l_int|0x8000
op_logical_or
id|val
op_eq
l_int|0x1f1f
)paren
(brace
id|chip
op_member_access_from_pointer
id|amplifier_ctrl
c_func
(paren
id|chip
comma
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_else
multiline_comment|/* Mute off power on */
id|chip
op_member_access_from_pointer
id|amplifier_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
)brace
)brace
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
op_minus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Chip initialization&n; */
DECL|function|snd_cs46xx_download
r_int
id|snd_cs46xx_download
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
id|u32
op_star
id|src
comma
r_int
r_int
id|offset
comma
r_int
r_int
id|len
)paren
(brace
r_int
r_int
id|dst
suffix:semicolon
r_int
r_int
id|bank
op_assign
id|offset
op_rshift
l_int|16
suffix:semicolon
id|offset
op_assign
id|offset
op_amp
l_int|0xffff
suffix:semicolon
id|snd_assert
c_func
(paren
op_logical_neg
(paren
id|offset
op_amp
l_int|3
)paren
op_logical_and
op_logical_neg
(paren
id|len
op_amp
l_int|3
)paren
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|dst
op_assign
id|chip-&gt;region.idx
(braket
id|bank
op_plus
l_int|1
)braket
dot
id|remap_addr
op_plus
id|offset
suffix:semicolon
id|len
op_div_assign
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
multiline_comment|/* writel already converts 32-bit value to right endianess */
r_while
c_loop
(paren
id|len
op_decrement
OG
l_int|0
)paren
(brace
id|writel
c_func
(paren
op_star
id|src
op_increment
comma
id|dst
)paren
suffix:semicolon
id|dst
op_add_assign
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* 3*1024 parameter, 3.5*1024 sample, 2*3.5*1024 code */
DECL|macro|BA1_DWORD_SIZE
mdefine_line|#define BA1_DWORD_SIZE&t;&t;(13 * 1024 + 512)
DECL|macro|BA1_MEMORY_COUNT
mdefine_line|#define BA1_MEMORY_COUNT&t;3
DECL|struct|BA1struct
r_struct
id|BA1struct
(brace
r_struct
(brace
DECL|member|offset
r_int
r_int
id|offset
suffix:semicolon
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
DECL|member|memory
)brace
id|memory
(braket
id|BA1_MEMORY_COUNT
)braket
suffix:semicolon
DECL|member|map
id|u32
id|map
(braket
id|BA1_DWORD_SIZE
)braket
suffix:semicolon
)brace
suffix:semicolon
r_static
macro_line|#include &quot;cs46xx_image.h&quot;
DECL|function|snd_cs46xx_download_image
r_int
id|snd_cs46xx_download_image
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
r_int
id|idx
comma
id|err
suffix:semicolon
r_int
r_int
id|offset
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|BA1_MEMORY_COUNT
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_cs46xx_download
c_func
(paren
id|chip
comma
op_amp
id|BA1Struct.map
(braket
id|offset
)braket
comma
id|BA1Struct.memory
(braket
id|idx
)braket
dot
id|offset
comma
id|BA1Struct.memory
(braket
id|idx
)braket
dot
id|size
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|offset
op_add_assign
id|BA1Struct.memory
(braket
id|idx
)braket
dot
id|size
op_rshift
l_int|2
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Chip reset&n; */
DECL|function|snd_cs46xx_reset
r_static
r_void
id|snd_cs46xx_reset
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
r_int
id|idx
suffix:semicolon
multiline_comment|/*&n;&t; *  Write the reset bit of the SP control register.&n;&t; */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_SPCR
comma
id|SPCR_RSTSP
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Write the control register.&n;&t; */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_SPCR
comma
id|SPCR_DRQEN
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Clear the trap registers.&n;&t; */
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|8
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_DREG
comma
id|DREG_REGID_TRAP_SELECT
op_plus
id|idx
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_TWPR
comma
l_int|0xFFFF
)paren
suffix:semicolon
)brace
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_DREG
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Set the frame timer to reflect the number of cycles per frame.&n;&t; */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_FRMT
comma
l_int|0xadf
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_clear_serial_FIFOs
r_static
r_void
id|snd_cs46xx_clear_serial_FIFOs
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
r_int
id|idx
comma
id|loop
comma
id|powerdown
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
multiline_comment|/*&n;&t; *  See if the devices are powered down.  If so, we must power them up first&n;&t; *  or they will not respond.&n;&t; */
id|tmp
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tmp
op_amp
id|CLKCR1_SWCE
)paren
)paren
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
id|tmp
op_or
id|CLKCR1_SWCE
)paren
suffix:semicolon
id|powerdown
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *  We want to clear out the serial port FIFOs so we don&squot;t end up playing&n;&t; *  whatever random garbage happens to be in them.  We fill the sample FIFOS&n;&t; *  with zero (silence).&n;         */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERBWP
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Fill all 256 sample FIFO locations.&n;&t; */
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|256
suffix:semicolon
id|idx
op_increment
)paren
(brace
multiline_comment|/*&n;&t;&t; *  Make sure the previous FIFO write operation has completed.&n;&t;&t; */
r_for
c_loop
(paren
id|loop
op_assign
l_int|0
suffix:semicolon
id|loop
OL
l_int|5
suffix:semicolon
id|loop
op_increment
)paren
(brace
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_SERBST
)paren
op_amp
id|SERBST_WBSY
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_SERBST
)paren
op_amp
id|SERBST_WBSY
)paren
(brace
r_if
c_cond
(paren
id|powerdown
)paren
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
id|tmp
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; *  Write the serial port FIFO index.&n;&t;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERBAD
comma
id|idx
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; *  Tell the serial port to load the new value into the FIFO location.&n;&t;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERBCM
comma
id|SERBCM_WRC
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *  Now, if we powered up the devices, then power them back down again.&n;&t; *  This is kinda ugly, but should never happen.&n;&t; */
r_if
c_cond
(paren
id|powerdown
)paren
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
id|tmp
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_proc_start
r_static
r_void
id|snd_cs46xx_proc_start
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
r_int
id|cnt
suffix:semicolon
multiline_comment|/*&n;&t; *  Set the frame timer to reflect the number of cycles per frame.&n;&t; */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_FRMT
comma
l_int|0xadf
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Turn on the run, run at frame, and DMA enable bits in the local copy of&n;&t; *  the SP control register.&n;&t; */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_SPCR
comma
id|SPCR_RUN
op_or
id|SPCR_RUNFR
op_or
id|SPCR_DRQEN
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Wait until the run at frame bit resets itself in the SP control&n;&t; *  register.&n;&t; */
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
l_int|25
suffix:semicolon
id|cnt
op_increment
)paren
(brace
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_SPCR
)paren
op_amp
id|SPCR_RUNFR
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_SPCR
)paren
op_amp
id|SPCR_RUNFR
)paren
id|snd_printk
c_func
(paren
l_string|&quot;SPCR_RUNFR never reset&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_proc_stop
r_static
r_void
id|snd_cs46xx_proc_stop
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
multiline_comment|/*&n;&t; *  Turn off the run, run at frame, and DMA enable bits in the local copy of&n;&t; *  the SP control register.&n;&t; */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_SPCR
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Sample rate routines&n; */
DECL|macro|GOF_PER_SEC
mdefine_line|#define GOF_PER_SEC 200
DECL|function|snd_cs46xx_set_play_sample_rate
r_static
r_void
id|snd_cs46xx_set_play_sample_rate
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
r_int
id|rate
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|tmp1
comma
id|tmp2
suffix:semicolon
r_int
r_int
id|phiIncr
suffix:semicolon
r_int
r_int
id|correctionPerGOF
comma
id|correctionPerSec
suffix:semicolon
multiline_comment|/*&n;&t; *  Compute the values used to drive the actual sample rate conversion.&n;&t; *  The following formulas are being computed, using inline assembly&n;&t; *  since we need to use 64 bit arithmetic to compute the values:&n;&t; *&n;&t; *  phiIncr = floor((Fs,in * 2^26) / Fs,out)&n;&t; *  correctionPerGOF = floor((Fs,in * 2^26 - Fs,out * phiIncr) /&n;         *                                   GOF_PER_SEC)&n;         *  ulCorrectionPerSec = Fs,in * 2^26 - Fs,out * phiIncr -M&n;         *                       GOF_PER_SEC * correctionPerGOF&n;&t; *&n;&t; *  i.e.&n;&t; *&n;&t; *  phiIncr:other = dividend:remainder((Fs,in * 2^26) / Fs,out)&n;&t; *  correctionPerGOF:correctionPerSec =&n;&t; *      dividend:remainder(ulOther / GOF_PER_SEC)&n;&t; */
id|tmp1
op_assign
id|rate
op_lshift
l_int|16
suffix:semicolon
id|phiIncr
op_assign
id|tmp1
op_div
l_int|48000
suffix:semicolon
id|tmp1
op_sub_assign
id|phiIncr
op_star
l_int|48000
suffix:semicolon
id|tmp1
op_lshift_assign
l_int|10
suffix:semicolon
id|phiIncr
op_lshift_assign
l_int|10
suffix:semicolon
id|tmp2
op_assign
id|tmp1
op_div
l_int|48000
suffix:semicolon
id|phiIncr
op_add_assign
id|tmp2
suffix:semicolon
id|tmp1
op_sub_assign
id|tmp2
op_star
l_int|48000
suffix:semicolon
id|correctionPerGOF
op_assign
id|tmp1
op_div
id|GOF_PER_SEC
suffix:semicolon
id|tmp1
op_sub_assign
id|correctionPerGOF
op_star
id|GOF_PER_SEC
suffix:semicolon
id|correctionPerSec
op_assign
id|tmp1
suffix:semicolon
multiline_comment|/*&n;&t; *  Fill in the SampleRateConverter control block.&n;&t; */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PSRC
comma
(paren
(paren
id|correctionPerSec
op_lshift
l_int|16
)paren
op_amp
l_int|0xFFFF0000
)paren
op_or
(paren
id|correctionPerGOF
op_amp
l_int|0xFFFF
)paren
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PPI
comma
id|phiIncr
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_set_capture_sample_rate
r_static
r_void
id|snd_cs46xx_set_capture_sample_rate
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
r_int
id|rate
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|phiIncr
comma
id|coeffIncr
comma
id|tmp1
comma
id|tmp2
suffix:semicolon
r_int
r_int
id|correctionPerGOF
comma
id|correctionPerSec
comma
id|initialDelay
suffix:semicolon
r_int
r_int
id|frameGroupLength
comma
id|cnt
suffix:semicolon
multiline_comment|/*&n;&t; *  We can only decimate by up to a factor of 1/9th the hardware rate.&n;&t; *  Correct the value if an attempt is made to stray outside that limit.&n;&t; */
r_if
c_cond
(paren
(paren
id|rate
op_star
l_int|9
)paren
OL
l_int|48000
)paren
id|rate
op_assign
l_int|48000
op_div
l_int|9
suffix:semicolon
multiline_comment|/*&n;&t; *  We can not capture at at rate greater than the Input Rate (48000).&n;&t; *  Return an error if an attempt is made to stray outside that limit.&n;&t; */
r_if
c_cond
(paren
id|rate
OG
l_int|48000
)paren
id|rate
op_assign
l_int|48000
suffix:semicolon
multiline_comment|/*&n;&t; *  Compute the values used to drive the actual sample rate conversion.&n;&t; *  The following formulas are being computed, using inline assembly&n;&t; *  since we need to use 64 bit arithmetic to compute the values:&n;&t; *&n;&t; *     coeffIncr = -floor((Fs,out * 2^23) / Fs,in)&n;&t; *     phiIncr = floor((Fs,in * 2^26) / Fs,out)&n;&t; *     correctionPerGOF = floor((Fs,in * 2^26 - Fs,out * phiIncr) /&n;&t; *                                GOF_PER_SEC)&n;&t; *     correctionPerSec = Fs,in * 2^26 - Fs,out * phiIncr -&n;&t; *                          GOF_PER_SEC * correctionPerGOF&n;&t; *     initialDelay = ceil((24 * Fs,in) / Fs,out)&n;&t; *&n;&t; * i.e.&n;&t; *&n;&t; *     coeffIncr = neg(dividend((Fs,out * 2^23) / Fs,in))&n;&t; *     phiIncr:ulOther = dividend:remainder((Fs,in * 2^26) / Fs,out)&n;&t; *     correctionPerGOF:correctionPerSec =&n;&t; * &t;    dividend:remainder(ulOther / GOF_PER_SEC)&n;&t; *     initialDelay = dividend(((24 * Fs,in) + Fs,out - 1) / Fs,out)&n;&t; */
id|tmp1
op_assign
id|rate
op_lshift
l_int|16
suffix:semicolon
id|coeffIncr
op_assign
id|tmp1
op_div
l_int|48000
suffix:semicolon
id|tmp1
op_sub_assign
id|coeffIncr
op_star
l_int|48000
suffix:semicolon
id|tmp1
op_lshift_assign
l_int|7
suffix:semicolon
id|coeffIncr
op_lshift_assign
l_int|7
suffix:semicolon
id|coeffIncr
op_add_assign
id|tmp1
op_div
l_int|48000
suffix:semicolon
id|coeffIncr
op_xor_assign
l_int|0xFFFFFFFF
suffix:semicolon
id|coeffIncr
op_increment
suffix:semicolon
id|tmp1
op_assign
l_int|48000
op_lshift
l_int|16
suffix:semicolon
id|phiIncr
op_assign
id|tmp1
op_div
id|rate
suffix:semicolon
id|tmp1
op_sub_assign
id|phiIncr
op_star
id|rate
suffix:semicolon
id|tmp1
op_lshift_assign
l_int|10
suffix:semicolon
id|phiIncr
op_lshift_assign
l_int|10
suffix:semicolon
id|tmp2
op_assign
id|tmp1
op_div
id|rate
suffix:semicolon
id|phiIncr
op_add_assign
id|tmp2
suffix:semicolon
id|tmp1
op_sub_assign
id|tmp2
op_star
id|rate
suffix:semicolon
id|correctionPerGOF
op_assign
id|tmp1
op_div
id|GOF_PER_SEC
suffix:semicolon
id|tmp1
op_sub_assign
id|correctionPerGOF
op_star
id|GOF_PER_SEC
suffix:semicolon
id|correctionPerSec
op_assign
id|tmp1
suffix:semicolon
id|initialDelay
op_assign
(paren
(paren
l_int|48000
op_star
l_int|24
)paren
op_plus
id|rate
op_minus
l_int|1
)paren
op_div
id|rate
suffix:semicolon
multiline_comment|/*&n;&t; *  Fill in the VariDecimate control block.&n;&t; */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CSRC
comma
(paren
(paren
id|correctionPerSec
op_lshift
l_int|16
)paren
op_amp
l_int|0xFFFF0000
)paren
op_or
(paren
id|correctionPerGOF
op_amp
l_int|0xFFFF
)paren
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CCI
comma
id|coeffIncr
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CD
comma
(paren
(paren
(paren
id|BA1_VARIDEC_BUF_1
op_plus
(paren
id|initialDelay
op_lshift
l_int|2
)paren
)paren
op_lshift
l_int|16
)paren
op_amp
l_int|0xFFFF0000
)paren
op_or
l_int|0x80
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CPI
comma
id|phiIncr
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Figure out the frame group length for the write back task.  Basically,&n;&t; *  this is just the factors of 24000 (2^6*3*5^3) that are not present in&n;&t; *  the output sample rate.&n;&t; */
id|frameGroupLength
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|2
suffix:semicolon
id|cnt
op_le
l_int|64
suffix:semicolon
id|cnt
op_mul_assign
l_int|2
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|rate
op_div
id|cnt
)paren
op_star
id|cnt
)paren
op_ne
id|rate
)paren
id|frameGroupLength
op_mul_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|rate
op_div
l_int|3
)paren
op_star
l_int|3
)paren
op_ne
id|rate
)paren
(brace
id|frameGroupLength
op_mul_assign
l_int|3
suffix:semicolon
)brace
r_for
c_loop
(paren
id|cnt
op_assign
l_int|5
suffix:semicolon
id|cnt
op_le
l_int|125
suffix:semicolon
id|cnt
op_mul_assign
l_int|5
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|rate
op_div
id|cnt
)paren
op_star
id|cnt
)paren
op_ne
id|rate
)paren
id|frameGroupLength
op_mul_assign
l_int|5
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Fill in the WriteBack control block.&n;&t; */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CFG1
comma
id|frameGroupLength
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CFG2
comma
(paren
l_int|0x00800000
op_or
id|frameGroupLength
)paren
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CCST
comma
l_int|0x0000FFFF
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CSPB
comma
(paren
(paren
l_int|65536
op_star
id|rate
)paren
op_div
l_int|24000
)paren
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
(paren
id|BA1_CSPB
op_plus
l_int|4
)paren
comma
l_int|0x0000FFFF
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  PCM part&n; */
DECL|function|snd_cs46xx_playback_transfer
r_static
r_int
id|snd_cs46xx_playback_transfer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_uframes_t
id|frames
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_pcm_sframes_t
id|diff
op_assign
id|runtime-&gt;control-&gt;appl_ptr
op_minus
id|chip-&gt;play.appl_ptr
suffix:semicolon
r_if
c_cond
(paren
id|diff
)paren
(brace
r_if
c_cond
(paren
id|diff
OL
op_minus
(paren
id|snd_pcm_sframes_t
)paren
(paren
id|runtime-&gt;boundary
op_div
l_int|2
)paren
)paren
id|diff
op_add_assign
id|runtime-&gt;boundary
suffix:semicolon
id|chip-&gt;play.sw_ready
op_add_assign
id|diff
op_lshift
id|chip-&gt;play.shift
suffix:semicolon
)brace
id|chip-&gt;play.sw_ready
op_add_assign
id|frames
op_lshift
id|chip-&gt;play.shift
suffix:semicolon
id|chip-&gt;play.appl_ptr
op_assign
id|runtime-&gt;control-&gt;appl_ptr
op_plus
id|frames
suffix:semicolon
r_while
c_loop
(paren
id|chip-&gt;play.hw_ready
template_param
l_int|0
)paren
(brace
r_int
id|hw_to_end
op_assign
id|CS46XX_BUFFER_SIZE
op_minus
id|chip-&gt;play.hw_data
suffix:semicolon
r_int
id|sw_to_end
op_assign
id|chip-&gt;play.sw_bufsize
op_minus
id|chip-&gt;play.sw_data
suffix:semicolon
r_int
id|bytes
op_assign
id|CS46XX_BUFFER_SIZE
op_minus
id|chip-&gt;play.hw_ready
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;play.sw_ready
OL
id|bytes
)paren
id|bytes
op_assign
id|chip-&gt;play.sw_ready
suffix:semicolon
r_if
c_cond
(paren
id|hw_to_end
OL
id|bytes
)paren
id|bytes
op_assign
id|hw_to_end
suffix:semicolon
r_if
c_cond
(paren
id|sw_to_end
OL
id|bytes
)paren
id|bytes
op_assign
id|sw_to_end
suffix:semicolon
id|memcpy
c_func
(paren
id|chip-&gt;play.hw_area
op_plus
id|chip-&gt;play.hw_data
comma
id|runtime-&gt;dma_area
op_plus
id|chip-&gt;play.sw_data
comma
id|bytes
)paren
suffix:semicolon
id|chip-&gt;play.hw_data
op_add_assign
id|bytes
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;play.hw_data
op_eq
id|CS46XX_BUFFER_SIZE
)paren
id|chip-&gt;play.hw_data
op_assign
l_int|0
suffix:semicolon
id|chip-&gt;play.sw_data
op_add_assign
id|bytes
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;play.sw_data
op_eq
id|chip-&gt;play.sw_bufsize
)paren
id|chip-&gt;play.sw_data
op_assign
l_int|0
suffix:semicolon
id|chip-&gt;play.hw_ready
op_add_assign
id|bytes
suffix:semicolon
id|chip-&gt;play.sw_ready
op_sub_assign
id|bytes
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_capture_transfer
r_static
r_int
id|snd_cs46xx_capture_transfer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_uframes_t
id|frames
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_pcm_sframes_t
id|diff
op_assign
id|runtime-&gt;control-&gt;appl_ptr
op_minus
id|chip-&gt;capt.appl_ptr
suffix:semicolon
r_if
c_cond
(paren
id|diff
)paren
(brace
r_if
c_cond
(paren
id|diff
OL
op_minus
(paren
id|snd_pcm_sframes_t
)paren
(paren
id|runtime-&gt;boundary
op_div
l_int|2
)paren
)paren
id|diff
op_add_assign
id|runtime-&gt;boundary
suffix:semicolon
id|chip-&gt;capt.sw_ready
op_sub_assign
id|diff
op_lshift
id|chip-&gt;capt.shift
suffix:semicolon
)brace
id|chip-&gt;capt.sw_ready
op_sub_assign
id|frames
op_lshift
id|chip-&gt;capt.shift
suffix:semicolon
id|chip-&gt;capt.appl_ptr
op_assign
id|runtime-&gt;control-&gt;appl_ptr
op_plus
id|frames
suffix:semicolon
r_while
c_loop
(paren
id|chip-&gt;capt.hw_ready
OG
l_int|0
op_logical_and
id|chip-&gt;capt.sw_ready
OL
id|chip-&gt;capt.sw_bufsize
)paren
(brace
r_int
id|hw_to_end
op_assign
id|CS46XX_BUFFER_SIZE
op_minus
id|chip-&gt;capt.hw_data
suffix:semicolon
r_int
id|sw_to_end
op_assign
id|chip-&gt;capt.sw_bufsize
op_minus
id|chip-&gt;capt.sw_data
suffix:semicolon
r_int
id|bytes
op_assign
id|chip-&gt;capt.sw_bufsize
op_minus
id|chip-&gt;capt.sw_ready
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;capt.hw_ready
OL
id|bytes
)paren
id|bytes
op_assign
id|chip-&gt;capt.hw_ready
suffix:semicolon
r_if
c_cond
(paren
id|hw_to_end
OL
id|bytes
)paren
id|bytes
op_assign
id|hw_to_end
suffix:semicolon
r_if
c_cond
(paren
id|sw_to_end
OL
id|bytes
)paren
id|bytes
op_assign
id|sw_to_end
suffix:semicolon
id|memcpy
c_func
(paren
id|runtime-&gt;dma_area
op_plus
id|chip-&gt;capt.sw_data
comma
id|chip-&gt;capt.hw_area
op_plus
id|chip-&gt;capt.hw_data
comma
id|bytes
)paren
suffix:semicolon
id|chip-&gt;capt.hw_data
op_add_assign
id|bytes
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;capt.hw_data
op_eq
id|CS46XX_BUFFER_SIZE
)paren
id|chip-&gt;capt.hw_data
op_assign
l_int|0
suffix:semicolon
id|chip-&gt;capt.sw_data
op_add_assign
id|bytes
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;capt.sw_data
op_eq
id|chip-&gt;capt.sw_bufsize
)paren
id|chip-&gt;capt.sw_data
op_assign
l_int|0
suffix:semicolon
id|chip-&gt;capt.hw_ready
op_sub_assign
id|bytes
suffix:semicolon
id|chip-&gt;capt.sw_ready
op_add_assign
id|bytes
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_playback_direct_pointer
r_static
id|snd_pcm_uframes_t
id|snd_cs46xx_playback_direct_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_PBA
)paren
op_minus
id|chip-&gt;play.hw_addr
suffix:semicolon
r_return
id|ptr
op_rshift
id|chip-&gt;play.shift
suffix:semicolon
)brace
DECL|function|snd_cs46xx_playback_indirect_pointer
r_static
id|snd_pcm_uframes_t
id|snd_cs46xx_playback_indirect_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_PBA
)paren
op_minus
id|chip-&gt;play.hw_addr
suffix:semicolon
id|ssize_t
id|bytes
op_assign
id|ptr
op_minus
id|chip-&gt;play.hw_io
suffix:semicolon
r_if
c_cond
(paren
id|bytes
OL
l_int|0
)paren
id|bytes
op_add_assign
id|CS46XX_BUFFER_SIZE
suffix:semicolon
id|chip-&gt;play.hw_io
op_assign
id|ptr
suffix:semicolon
id|chip-&gt;play.hw_ready
op_sub_assign
id|bytes
suffix:semicolon
id|chip-&gt;play.sw_io
op_add_assign
id|bytes
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;play.sw_io
OG
id|chip-&gt;play.sw_bufsize
)paren
id|chip-&gt;play.sw_io
op_sub_assign
id|chip-&gt;play.sw_bufsize
suffix:semicolon
id|snd_cs46xx_playback_transfer
c_func
(paren
id|substream
comma
l_int|0
)paren
suffix:semicolon
r_return
id|chip-&gt;play.sw_io
op_rshift
id|chip-&gt;play.shift
suffix:semicolon
)brace
DECL|function|snd_cs46xx_capture_direct_pointer
r_static
id|snd_pcm_uframes_t
id|snd_cs46xx_capture_direct_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_CBA
)paren
op_minus
id|chip-&gt;capt.hw_addr
suffix:semicolon
r_return
id|ptr
op_rshift
id|chip-&gt;capt.shift
suffix:semicolon
)brace
DECL|function|snd_cs46xx_capture_indirect_pointer
r_static
id|snd_pcm_uframes_t
id|snd_cs46xx_capture_indirect_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_CBA
)paren
op_minus
id|chip-&gt;capt.hw_addr
suffix:semicolon
id|ssize_t
id|bytes
op_assign
id|ptr
op_minus
id|chip-&gt;capt.hw_io
suffix:semicolon
r_if
c_cond
(paren
id|bytes
OL
l_int|0
)paren
id|bytes
op_add_assign
id|CS46XX_BUFFER_SIZE
suffix:semicolon
id|chip-&gt;capt.hw_io
op_assign
id|ptr
suffix:semicolon
id|chip-&gt;capt.hw_ready
op_add_assign
id|bytes
suffix:semicolon
id|chip-&gt;capt.sw_io
op_add_assign
id|bytes
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;capt.sw_io
OG
id|chip-&gt;capt.sw_bufsize
)paren
id|chip-&gt;capt.sw_io
op_sub_assign
id|chip-&gt;capt.sw_bufsize
suffix:semicolon
id|snd_cs46xx_capture_transfer
c_func
(paren
id|substream
comma
l_int|0
)paren
suffix:semicolon
r_return
id|chip-&gt;capt.sw_io
op_rshift
id|chip-&gt;capt.shift
suffix:semicolon
)brace
DECL|function|snd_cs46xx_playback_copy
r_static
r_int
id|snd_cs46xx_playback_copy
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|channel
comma
id|snd_pcm_uframes_t
id|hwoff
comma
r_void
op_star
id|src
comma
id|snd_pcm_uframes_t
id|frames
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|hwoffb
op_assign
id|hwoff
op_lshift
id|chip-&gt;play.shift
suffix:semicolon
r_int
id|bytes
op_assign
id|frames
op_lshift
id|chip-&gt;play.shift
suffix:semicolon
r_char
op_star
id|hwbuf
op_assign
id|runtime-&gt;dma_area
op_plus
id|hwoffb
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|hwbuf
comma
id|src
comma
id|bytes
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
id|snd_cs46xx_playback_transfer
c_func
(paren
id|substream
comma
id|frames
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_capture_copy
r_static
r_int
id|snd_cs46xx_capture_copy
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|channel
comma
id|snd_pcm_uframes_t
id|hwoff
comma
r_void
op_star
id|dst
comma
id|snd_pcm_uframes_t
id|frames
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|hwoffb
op_assign
id|hwoff
op_lshift
id|chip-&gt;capt.shift
suffix:semicolon
r_int
id|bytes
op_assign
id|frames
op_lshift
id|chip-&gt;capt.shift
suffix:semicolon
r_char
op_star
id|hwbuf
op_assign
id|runtime-&gt;dma_area
op_plus
id|hwoffb
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|dst
comma
id|hwbuf
comma
id|bytes
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
id|snd_cs46xx_capture_transfer
c_func
(paren
id|substream
comma
id|frames
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|runtime-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_playback_trigger
r_static
r_int
id|snd_cs46xx_playback_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_RESUME
suffix:colon
r_if
c_cond
(paren
id|substream-&gt;runtime-&gt;periods
op_ne
id|CS46XX_FRAGS
)paren
id|snd_cs46xx_playback_transfer
c_func
(paren
id|substream
comma
l_int|0
)paren
suffix:semicolon
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_PCTL
)paren
suffix:semicolon
id|tmp
op_and_assign
l_int|0x0000ffff
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PCTL
comma
id|chip-&gt;play.ctl
op_or
id|tmp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_SUSPEND
suffix:colon
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_PCTL
)paren
suffix:semicolon
id|tmp
op_and_assign
l_int|0x0000ffff
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PCTL
comma
id|tmp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_cs46xx_capture_trigger
r_static
r_int
id|snd_cs46xx_capture_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_RESUME
suffix:colon
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_CCTL
)paren
suffix:semicolon
id|tmp
op_and_assign
l_int|0xffff0000
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CCTL
comma
id|chip-&gt;capt.ctl
op_or
id|tmp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_SUSPEND
suffix:colon
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_CCTL
)paren
suffix:semicolon
id|tmp
op_and_assign
l_int|0xffff0000
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CCTL
comma
id|tmp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_cs46xx_playback_hw_params
r_static
r_int
id|snd_cs46xx_playback_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|params_periods
c_func
(paren
id|hw_params
)paren
op_eq
id|CS46XX_FRAGS
)paren
(brace
r_if
c_cond
(paren
id|runtime-&gt;dma_area
op_ne
id|chip-&gt;play.hw_area
)paren
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
id|runtime-&gt;dma_area
op_assign
id|chip-&gt;play.hw_area
suffix:semicolon
id|runtime-&gt;dma_addr
op_assign
id|chip-&gt;play.hw_addr
suffix:semicolon
id|runtime-&gt;dma_bytes
op_assign
id|chip-&gt;play.hw_size
suffix:semicolon
id|substream-&gt;ops
op_assign
op_amp
id|snd_cs46xx_playback_ops
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|runtime-&gt;dma_area
op_eq
id|chip-&gt;play.hw_area
)paren
(brace
id|runtime-&gt;dma_area
op_assign
l_int|NULL
suffix:semicolon
id|runtime-&gt;dma_addr
op_assign
l_int|0
suffix:semicolon
id|runtime-&gt;dma_bytes
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|substream-&gt;ops
op_assign
op_amp
id|snd_cs46xx_playback_indirect_ops
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_playback_hw_free
r_static
r_int
id|snd_cs46xx_playback_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;dma_area
op_ne
id|chip-&gt;play.hw_area
)paren
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
id|runtime-&gt;dma_area
op_assign
l_int|NULL
suffix:semicolon
id|runtime-&gt;dma_addr
op_assign
l_int|0
suffix:semicolon
id|runtime-&gt;dma_bytes
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_playback_prepare
r_static
r_int
id|snd_cs46xx_playback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
r_int
r_int
id|pfie
suffix:semicolon
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|pfie
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_PFIE
)paren
suffix:semicolon
id|pfie
op_and_assign
op_complement
l_int|0x0000f03f
suffix:semicolon
id|chip-&gt;play.shift
op_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;channels
op_eq
l_int|1
)paren
(brace
id|chip-&gt;play.shift
op_decrement
suffix:semicolon
id|pfie
op_or_assign
l_int|0x00002000
suffix:semicolon
)brace
r_if
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|8
)paren
(brace
id|chip-&gt;play.shift
op_decrement
suffix:semicolon
id|pfie
op_or_assign
l_int|0x00001000
suffix:semicolon
)brace
r_if
c_cond
(paren
id|snd_pcm_format_unsigned
c_func
(paren
id|runtime-&gt;format
)paren
)paren
id|pfie
op_or_assign
l_int|0x00008000
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_big_endian
c_func
(paren
id|runtime-&gt;format
)paren
)paren
id|pfie
op_or_assign
l_int|0x00004000
suffix:semicolon
id|chip-&gt;play.sw_bufsize
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;play.sw_data
op_assign
id|chip-&gt;play.sw_io
op_assign
id|chip-&gt;play.sw_ready
op_assign
l_int|0
suffix:semicolon
id|chip-&gt;play.hw_data
op_assign
id|chip-&gt;play.hw_io
op_assign
id|chip-&gt;play.hw_ready
op_assign
l_int|0
suffix:semicolon
id|chip-&gt;play.appl_ptr
op_assign
l_int|0
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PBA
comma
id|chip-&gt;play.hw_addr
)paren
suffix:semicolon
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_PDTC
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
l_int|0x000003ff
suffix:semicolon
id|tmp
op_or_assign
(paren
l_int|4
op_lshift
id|chip-&gt;play.shift
)paren
op_minus
l_int|1
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PDTC
comma
id|tmp
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PFIE
comma
id|pfie
)paren
suffix:semicolon
id|snd_cs46xx_set_play_sample_rate
c_func
(paren
id|chip
comma
id|runtime-&gt;rate
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_capture_hw_params
r_static
r_int
id|snd_cs46xx_capture_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;periods
op_eq
id|CS46XX_FRAGS
)paren
(brace
r_if
c_cond
(paren
id|runtime-&gt;dma_area
op_ne
id|chip-&gt;capt.hw_area
)paren
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
id|runtime-&gt;dma_area
op_assign
id|chip-&gt;capt.hw_area
suffix:semicolon
id|runtime-&gt;dma_addr
op_assign
id|chip-&gt;capt.hw_addr
suffix:semicolon
id|runtime-&gt;dma_bytes
op_assign
id|chip-&gt;capt.hw_size
suffix:semicolon
id|substream-&gt;ops
op_assign
op_amp
id|snd_cs46xx_capture_ops
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|runtime-&gt;dma_area
op_eq
id|chip-&gt;capt.hw_area
)paren
(brace
id|runtime-&gt;dma_area
op_assign
l_int|NULL
suffix:semicolon
id|runtime-&gt;dma_addr
op_assign
l_int|0
suffix:semicolon
id|runtime-&gt;dma_bytes
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|substream-&gt;ops
op_assign
op_amp
id|snd_cs46xx_capture_indirect_ops
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_capture_hw_free
r_static
r_int
id|snd_cs46xx_capture_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;dma_area
op_ne
id|chip-&gt;capt.hw_area
)paren
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
id|runtime-&gt;dma_area
op_assign
l_int|NULL
suffix:semicolon
id|runtime-&gt;dma_addr
op_assign
l_int|0
suffix:semicolon
id|runtime-&gt;dma_bytes
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_capture_prepare
r_static
r_int
id|snd_cs46xx_capture_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CBA
comma
id|chip-&gt;capt.hw_addr
)paren
suffix:semicolon
id|chip-&gt;capt.shift
op_assign
l_int|2
suffix:semicolon
id|chip-&gt;capt.sw_bufsize
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;capt.sw_data
op_assign
id|chip-&gt;capt.sw_io
op_assign
id|chip-&gt;capt.sw_ready
op_assign
l_int|0
suffix:semicolon
id|chip-&gt;capt.hw_data
op_assign
id|chip-&gt;capt.hw_io
op_assign
id|chip-&gt;capt.hw_ready
op_assign
l_int|0
suffix:semicolon
id|chip-&gt;capt.appl_ptr
op_assign
l_int|0
suffix:semicolon
id|snd_cs46xx_set_capture_sample_rate
c_func
(paren
id|chip
comma
id|runtime-&gt;rate
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_interrupt
r_static
r_void
id|snd_cs46xx_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|dev_id
comma
r_return
)paren
suffix:semicolon
r_int
r_int
id|status
suffix:semicolon
multiline_comment|/*&n;&t; *  Read the Interrupt Status Register to clear the interrupt&n;&t; */
id|status
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_HISR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
l_int|0x7fffffff
)paren
op_eq
l_int|0
)paren
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_HICR
comma
id|HICR_CHGM
op_or
id|HICR_IEV
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|status
op_amp
id|HISR_VC0
)paren
op_logical_and
id|chip-&gt;pcm
)paren
(brace
r_if
c_cond
(paren
id|chip-&gt;play.substream
)paren
id|snd_pcm_period_elapsed
c_func
(paren
id|chip-&gt;play.substream
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|status
op_amp
id|HISR_VC1
)paren
op_logical_and
id|chip-&gt;pcm
)paren
(brace
r_if
c_cond
(paren
id|chip-&gt;capt.substream
)paren
id|snd_pcm_period_elapsed
c_func
(paren
id|chip-&gt;capt.substream
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|status
op_amp
id|HISR_MIDI
)paren
op_logical_and
id|chip-&gt;rmidi
)paren
(brace
r_int
r_char
id|c
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_MIDSR
)paren
op_amp
id|MIDSR_RBE
)paren
op_eq
l_int|0
)paren
(brace
id|c
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_MIDRP
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chip-&gt;midcr
op_amp
id|MIDCR_RIE
)paren
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
id|snd_rawmidi_receive
c_func
(paren
id|chip-&gt;midi_input
comma
op_amp
id|c
comma
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_MIDSR
)paren
op_amp
id|MIDSR_TBF
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|chip-&gt;midcr
op_amp
id|MIDCR_TIE
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|snd_rawmidi_transmit
c_func
(paren
id|chip-&gt;midi_output
comma
op_amp
id|c
comma
l_int|1
)paren
op_ne
l_int|1
)paren
(brace
id|chip-&gt;midcr
op_and_assign
op_complement
id|MIDCR_TIE
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDWP
comma
id|c
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *  EOI to the PCI part....reenables interrupts&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_HICR
comma
id|HICR_CHGM
op_or
id|HICR_IEV
)paren
suffix:semicolon
)brace
DECL|variable|snd_cs46xx_playback
r_static
id|snd_pcm_hardware_t
id|snd_cs46xx_playback
op_assign
(brace
id|info
suffix:colon
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_RESUME
)paren
comma
id|formats
suffix:colon
(paren
id|SNDRV_PCM_FMTBIT_S8
op_or
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
op_or
id|SNDRV_PCM_FMTBIT_S16_BE
op_or
id|SNDRV_PCM_FMTBIT_U16_LE
op_or
id|SNDRV_PCM_FMTBIT_U16_BE
)paren
comma
id|rates
suffix:colon
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
id|rate_min
suffix:colon
l_int|5500
comma
id|rate_max
suffix:colon
l_int|48000
comma
id|channels_min
suffix:colon
l_int|1
comma
id|channels_max
suffix:colon
l_int|2
comma
id|buffer_bytes_max
suffix:colon
(paren
l_int|256
op_star
l_int|1024
)paren
comma
id|period_bytes_min
suffix:colon
id|CS46XX_PERIOD_SIZE
comma
id|period_bytes_max
suffix:colon
id|CS46XX_PERIOD_SIZE
comma
id|periods_min
suffix:colon
id|CS46XX_FRAGS
comma
id|periods_max
suffix:colon
l_int|1024
comma
id|fifo_size
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|snd_cs46xx_capture
r_static
id|snd_pcm_hardware_t
id|snd_cs46xx_capture
op_assign
(brace
id|info
suffix:colon
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_RESUME
)paren
comma
id|formats
suffix:colon
id|SNDRV_PCM_FMTBIT_S16_LE
comma
id|rates
suffix:colon
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
id|rate_min
suffix:colon
l_int|5500
comma
id|rate_max
suffix:colon
l_int|48000
comma
id|channels_min
suffix:colon
l_int|2
comma
id|channels_max
suffix:colon
l_int|2
comma
id|buffer_bytes_max
suffix:colon
(paren
l_int|256
op_star
l_int|1024
)paren
comma
id|period_bytes_min
suffix:colon
id|CS46XX_PERIOD_SIZE
comma
id|period_bytes_max
suffix:colon
id|CS46XX_PERIOD_SIZE
comma
id|periods_min
suffix:colon
id|CS46XX_FRAGS
comma
id|periods_max
suffix:colon
l_int|1024
comma
id|fifo_size
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
DECL|function|snd_cs46xx_playback_open
r_static
r_int
id|snd_cs46xx_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chip-&gt;play.hw_area
op_assign
id|snd_malloc_pci_pages
c_func
(paren
id|chip-&gt;pci
comma
id|chip-&gt;play.hw_size
comma
op_amp
id|chip-&gt;play.hw_addr
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|chip-&gt;play.substream
op_assign
id|substream
suffix:semicolon
id|substream-&gt;runtime-&gt;hw
op_assign
id|snd_cs46xx_playback
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;accept_valid
)paren
id|substream-&gt;runtime-&gt;hw.info
op_or_assign
id|SNDRV_PCM_INFO_MMAP_VALID
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
id|chip
op_member_access_from_pointer
id|amplifier_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_capture_open
r_static
r_int
id|snd_cs46xx_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chip-&gt;capt.hw_area
op_assign
id|snd_malloc_pci_pages
c_func
(paren
id|chip-&gt;pci
comma
id|chip-&gt;capt.hw_size
comma
op_amp
id|chip-&gt;capt.hw_addr
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|chip-&gt;capt.substream
op_assign
id|substream
suffix:semicolon
id|substream-&gt;runtime-&gt;hw
op_assign
id|snd_cs46xx_capture
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;accept_valid
)paren
id|substream-&gt;runtime-&gt;hw.info
op_or_assign
id|SNDRV_PCM_INFO_MMAP_VALID
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
id|chip
op_member_access_from_pointer
id|amplifier_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_playback_close
r_static
r_int
id|snd_cs46xx_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;play.substream
op_assign
l_int|NULL
suffix:semicolon
id|snd_free_pci_pages
c_func
(paren
id|chip-&gt;pci
comma
id|chip-&gt;play.hw_size
comma
id|chip-&gt;play.hw_area
comma
id|chip-&gt;play.hw_addr
)paren
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|chip
op_member_access_from_pointer
id|amplifier_ctrl
c_func
(paren
id|chip
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_capture_close
r_static
r_int
id|snd_cs46xx_capture_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;capt.substream
op_assign
l_int|NULL
suffix:semicolon
id|snd_free_pci_pages
c_func
(paren
id|chip-&gt;pci
comma
id|chip-&gt;capt.hw_size
comma
id|chip-&gt;capt.hw_area
comma
id|chip-&gt;capt.hw_addr
)paren
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
op_minus
l_int|1
)paren
suffix:semicolon
id|chip
op_member_access_from_pointer
id|amplifier_ctrl
c_func
(paren
id|chip
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_cs46xx_playback_ops
id|snd_pcm_ops_t
id|snd_cs46xx_playback_ops
op_assign
(brace
id|open
suffix:colon
id|snd_cs46xx_playback_open
comma
id|close
suffix:colon
id|snd_cs46xx_playback_close
comma
id|ioctl
suffix:colon
id|snd_pcm_lib_ioctl
comma
id|hw_params
suffix:colon
id|snd_cs46xx_playback_hw_params
comma
id|hw_free
suffix:colon
id|snd_cs46xx_playback_hw_free
comma
id|prepare
suffix:colon
id|snd_cs46xx_playback_prepare
comma
id|trigger
suffix:colon
id|snd_cs46xx_playback_trigger
comma
id|pointer
suffix:colon
id|snd_cs46xx_playback_direct_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_cs46xx_playback_indirect_ops
id|snd_pcm_ops_t
id|snd_cs46xx_playback_indirect_ops
op_assign
(brace
id|open
suffix:colon
id|snd_cs46xx_playback_open
comma
id|close
suffix:colon
id|snd_cs46xx_playback_close
comma
id|ioctl
suffix:colon
id|snd_pcm_lib_ioctl
comma
id|hw_params
suffix:colon
id|snd_cs46xx_playback_hw_params
comma
id|hw_free
suffix:colon
id|snd_cs46xx_playback_hw_free
comma
id|prepare
suffix:colon
id|snd_cs46xx_playback_prepare
comma
id|trigger
suffix:colon
id|snd_cs46xx_playback_trigger
comma
id|copy
suffix:colon
id|snd_cs46xx_playback_copy
comma
id|pointer
suffix:colon
id|snd_cs46xx_playback_indirect_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_cs46xx_capture_ops
id|snd_pcm_ops_t
id|snd_cs46xx_capture_ops
op_assign
(brace
id|open
suffix:colon
id|snd_cs46xx_capture_open
comma
id|close
suffix:colon
id|snd_cs46xx_capture_close
comma
id|ioctl
suffix:colon
id|snd_pcm_lib_ioctl
comma
id|hw_params
suffix:colon
id|snd_cs46xx_capture_hw_params
comma
id|hw_free
suffix:colon
id|snd_cs46xx_capture_hw_free
comma
id|prepare
suffix:colon
id|snd_cs46xx_capture_prepare
comma
id|trigger
suffix:colon
id|snd_cs46xx_capture_trigger
comma
id|pointer
suffix:colon
id|snd_cs46xx_capture_direct_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_cs46xx_capture_indirect_ops
id|snd_pcm_ops_t
id|snd_cs46xx_capture_indirect_ops
op_assign
(brace
id|open
suffix:colon
id|snd_cs46xx_capture_open
comma
id|close
suffix:colon
id|snd_cs46xx_capture_close
comma
id|ioctl
suffix:colon
id|snd_pcm_lib_ioctl
comma
id|hw_params
suffix:colon
id|snd_cs46xx_capture_hw_params
comma
id|hw_free
suffix:colon
id|snd_cs46xx_capture_hw_free
comma
id|prepare
suffix:colon
id|snd_cs46xx_capture_prepare
comma
id|trigger
suffix:colon
id|snd_cs46xx_capture_trigger
comma
id|copy
suffix:colon
id|snd_cs46xx_capture_copy
comma
id|pointer
suffix:colon
id|snd_cs46xx_capture_indirect_pointer
comma
)brace
suffix:semicolon
DECL|function|snd_cs46xx_pcm_free
r_static
r_void
id|snd_cs46xx_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|pcm-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|chip-&gt;pcm
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_pcm
r_int
id|__devinit
id|snd_cs46xx_pcm
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;CS46xx&quot;
comma
id|device
comma
l_int|1
comma
l_int|1
comma
op_amp
id|pcm
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_cs46xx_pcm_free
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_cs46xx_playback_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_cs46xx_capture_ops
)paren
suffix:semicolon
multiline_comment|/* global setup */
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;CS46xx&quot;
)paren
suffix:semicolon
id|chip-&gt;pcm
op_assign
id|pcm
suffix:semicolon
id|snd_pcm_lib_preallocate_pci_pages_for_all
c_func
(paren
id|chip-&gt;pci
comma
id|pcm
comma
l_int|64
op_star
l_int|1024
comma
l_int|256
op_star
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Mixer routines&n; */
DECL|function|snd_cs46xx_mixer_free_ac97
r_static
r_void
id|snd_cs46xx_mixer_free_ac97
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|ac97-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|chip-&gt;ac97
op_assign
l_int|NULL
suffix:semicolon
id|chip-&gt;eapd_switch
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|snd_cs46xx_vol_info
r_static
r_int
id|snd_cs46xx_vol_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|32767
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_vol_get
r_static
r_int
id|snd_cs46xx_vol_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
r_int
r_int
id|val
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|reg
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
l_int|0xffff
op_minus
(paren
id|val
op_rshift
l_int|16
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
l_int|0xffff
op_minus
(paren
id|val
op_amp
l_int|0xffff
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_vol_put
r_static
r_int
id|snd_cs46xx_vol_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
r_int
r_int
id|val
op_assign
(paren
(paren
l_int|0xffff
op_minus
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
op_lshift
l_int|16
op_or
(paren
l_int|0xffff
op_minus
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
)paren
)paren
suffix:semicolon
r_int
r_int
id|old
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|reg
)paren
suffix:semicolon
r_int
id|change
op_assign
(paren
id|old
op_ne
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|reg
comma
id|val
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_cs46xx_controls
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
id|iface
suffix:colon
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
id|name
suffix:colon
l_string|&quot;DAC Volume&quot;
comma
id|info
suffix:colon
id|snd_cs46xx_vol_info
comma
id|get
suffix:colon
id|snd_cs46xx_vol_get
comma
id|put
suffix:colon
id|snd_cs46xx_vol_put
comma
id|private_value
suffix:colon
id|BA1_PVOL
comma
)brace
comma
(brace
id|iface
suffix:colon
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
id|name
suffix:colon
l_string|&quot;ADC Volume&quot;
comma
id|info
suffix:colon
id|snd_cs46xx_vol_info
comma
id|get
suffix:colon
id|snd_cs46xx_vol_get
comma
id|put
suffix:colon
id|snd_cs46xx_vol_put
comma
id|private_value
suffix:colon
id|BA1_CVOL
comma
)brace
)brace
suffix:semicolon
DECL|function|snd_cs46xx_mixer
r_int
id|__devinit
id|snd_cs46xx_mixer
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|snd_card_t
op_star
id|card
op_assign
id|chip-&gt;card
suffix:semicolon
id|ac97_t
id|ac97
suffix:semicolon
id|snd_ctl_elem_id_t
id|id
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|idx
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ac97
comma
l_int|0
comma
r_sizeof
(paren
id|ac97
)paren
)paren
suffix:semicolon
id|ac97.write
op_assign
id|snd_cs46xx_ac97_write
suffix:semicolon
id|ac97.read
op_assign
id|snd_cs46xx_ac97_read
suffix:semicolon
id|ac97.private_data
op_assign
id|chip
suffix:semicolon
id|ac97.private_free
op_assign
id|snd_cs46xx_mixer_free_ac97
suffix:semicolon
id|snd_cs46xx_ac97_write
c_func
(paren
op_amp
id|ac97
comma
id|AC97_MASTER
comma
l_int|0x8000
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|100
suffix:semicolon
op_increment
id|idx
)paren
(brace
r_if
c_cond
(paren
id|snd_cs46xx_ac97_read
c_func
(paren
op_amp
id|ac97
comma
id|AC97_MASTER
)paren
op_eq
l_int|0x8000
)paren
r_goto
id|_ok
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
op_div
l_int|100
)paren
suffix:semicolon
)brace
r_return
op_minus
id|ENXIO
suffix:semicolon
id|_ok
suffix:colon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_mixer
c_func
(paren
id|card
comma
op_amp
id|ac97
comma
op_amp
id|chip-&gt;ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
r_sizeof
(paren
id|snd_cs46xx_controls
)paren
op_div
r_sizeof
(paren
id|snd_cs46xx_controls
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|snd_kcontrol_t
op_star
id|kctl
suffix:semicolon
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_cs46xx_controls
(braket
id|idx
)braket
comma
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* get EAPD mixer switch (for voyetra hack) */
id|memset
c_func
(paren
op_amp
id|id
comma
l_int|0
comma
r_sizeof
(paren
id|id
)paren
)paren
suffix:semicolon
id|id.iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
suffix:semicolon
id|strcpy
c_func
(paren
id|id.name
comma
l_string|&quot;External Amplifier Power Down&quot;
)paren
suffix:semicolon
id|chip-&gt;eapd_switch
op_assign
id|snd_ctl_find_id
c_func
(paren
id|chip-&gt;card
comma
op_amp
id|id
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  RawMIDI interface&n; */
DECL|function|snd_cs46xx_midi_reset
r_static
r_void
id|snd_cs46xx_midi_reset
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|MIDCR_MRST
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_midi_input_open
r_static
r_int
id|snd_cs46xx_midi_input_open
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|substream-&gt;rmidi-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|chip-&gt;uartm
op_or_assign
id|CS46XX_MODE_INPUT
suffix:semicolon
id|chip-&gt;midcr
op_or_assign
id|MIDCR_RXE
suffix:semicolon
id|chip-&gt;midi_input
op_assign
id|substream
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chip-&gt;uartm
op_amp
id|CS46XX_MODE_OUTPUT
)paren
)paren
(brace
id|snd_cs46xx_midi_reset
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_midi_input_close
r_static
r_int
id|snd_cs46xx_midi_input_close
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|substream-&gt;rmidi-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|chip-&gt;midcr
op_and_assign
op_complement
(paren
id|MIDCR_RXE
op_or
id|MIDCR_RIE
)paren
suffix:semicolon
id|chip-&gt;midi_input
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chip-&gt;uartm
op_amp
id|CS46XX_MODE_OUTPUT
)paren
)paren
(brace
id|snd_cs46xx_midi_reset
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
id|chip-&gt;uartm
op_and_assign
op_complement
id|CS46XX_MODE_INPUT
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_midi_output_open
r_static
r_int
id|snd_cs46xx_midi_output_open
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|substream-&gt;rmidi-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|chip-&gt;uartm
op_or_assign
id|CS46XX_MODE_OUTPUT
suffix:semicolon
id|chip-&gt;midcr
op_or_assign
id|MIDCR_TXE
suffix:semicolon
id|chip-&gt;midi_output
op_assign
id|substream
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chip-&gt;uartm
op_amp
id|CS46XX_MODE_INPUT
)paren
)paren
(brace
id|snd_cs46xx_midi_reset
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_midi_output_close
r_static
r_int
id|snd_cs46xx_midi_output_close
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|substream-&gt;rmidi-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|chip-&gt;midcr
op_and_assign
op_complement
(paren
id|MIDCR_TXE
op_or
id|MIDCR_TIE
)paren
suffix:semicolon
id|chip-&gt;midi_output
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chip-&gt;uartm
op_amp
id|CS46XX_MODE_INPUT
)paren
)paren
(brace
id|snd_cs46xx_midi_reset
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
id|chip-&gt;uartm
op_and_assign
op_complement
id|CS46XX_MODE_OUTPUT
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_midi_input_trigger
r_static
r_void
id|snd_cs46xx_midi_input_trigger
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
r_int
id|up
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|substream-&gt;rmidi-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|up
)paren
(brace
r_if
c_cond
(paren
(paren
id|chip-&gt;midcr
op_amp
id|MIDCR_RIE
)paren
op_eq
l_int|0
)paren
(brace
id|chip-&gt;midcr
op_or_assign
id|MIDCR_RIE
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|chip-&gt;midcr
op_amp
id|MIDCR_RIE
)paren
(brace
id|chip-&gt;midcr
op_and_assign
op_complement
id|MIDCR_RIE
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_midi_output_trigger
r_static
r_void
id|snd_cs46xx_midi_output_trigger
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
r_int
id|up
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|substream-&gt;rmidi-&gt;private_data
comma
r_return
)paren
suffix:semicolon
r_int
r_char
id|byte
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|up
)paren
(brace
r_if
c_cond
(paren
(paren
id|chip-&gt;midcr
op_amp
id|MIDCR_TIE
)paren
op_eq
l_int|0
)paren
(brace
id|chip-&gt;midcr
op_or_assign
id|MIDCR_TIE
suffix:semicolon
multiline_comment|/* fill UART FIFO buffer at first, and turn Tx interrupts only if necessary */
r_while
c_loop
(paren
(paren
id|chip-&gt;midcr
op_amp
id|MIDCR_TIE
)paren
op_logical_and
(paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_MIDSR
)paren
op_amp
id|MIDSR_TBF
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|snd_rawmidi_transmit
c_func
(paren
id|substream
comma
op_amp
id|byte
comma
l_int|1
)paren
op_ne
l_int|1
)paren
(brace
id|chip-&gt;midcr
op_and_assign
op_complement
id|MIDCR_TIE
suffix:semicolon
)brace
r_else
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDWP
comma
id|byte
)paren
suffix:semicolon
)brace
)brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|chip-&gt;midcr
op_amp
id|MIDCR_TIE
)paren
(brace
id|chip-&gt;midcr
op_and_assign
op_complement
id|MIDCR_TIE
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|variable|snd_cs46xx_midi_output
r_static
id|snd_rawmidi_ops_t
id|snd_cs46xx_midi_output
op_assign
(brace
id|open
suffix:colon
id|snd_cs46xx_midi_output_open
comma
id|close
suffix:colon
id|snd_cs46xx_midi_output_close
comma
id|trigger
suffix:colon
id|snd_cs46xx_midi_output_trigger
comma
)brace
suffix:semicolon
DECL|variable|snd_cs46xx_midi_input
r_static
id|snd_rawmidi_ops_t
id|snd_cs46xx_midi_input
op_assign
(brace
id|open
suffix:colon
id|snd_cs46xx_midi_input_open
comma
id|close
suffix:colon
id|snd_cs46xx_midi_input_close
comma
id|trigger
suffix:colon
id|snd_cs46xx_midi_input_trigger
comma
)brace
suffix:semicolon
DECL|function|snd_cs46xx_midi
r_int
id|__devinit
id|snd_cs46xx_midi
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
id|device
comma
id|snd_rawmidi_t
op_star
op_star
id|rrawmidi
)paren
(brace
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rrawmidi
)paren
op_star
id|rrawmidi
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_rawmidi_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;CS46XX&quot;
comma
id|device
comma
l_int|1
comma
l_int|1
comma
op_amp
id|rmidi
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|strcpy
c_func
(paren
id|rmidi-&gt;name
comma
l_string|&quot;CS46XX&quot;
)paren
suffix:semicolon
id|snd_rawmidi_set_ops
c_func
(paren
id|rmidi
comma
id|SNDRV_RAWMIDI_STREAM_OUTPUT
comma
op_amp
id|snd_cs46xx_midi_output
)paren
suffix:semicolon
id|snd_rawmidi_set_ops
c_func
(paren
id|rmidi
comma
id|SNDRV_RAWMIDI_STREAM_INPUT
comma
op_amp
id|snd_cs46xx_midi_input
)paren
suffix:semicolon
id|rmidi-&gt;info_flags
op_or_assign
id|SNDRV_RAWMIDI_INFO_OUTPUT
op_or
id|SNDRV_RAWMIDI_INFO_INPUT
op_or
id|SNDRV_RAWMIDI_INFO_DUPLEX
suffix:semicolon
id|rmidi-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|chip-&gt;rmidi
op_assign
id|rmidi
suffix:semicolon
r_if
c_cond
(paren
id|rrawmidi
)paren
op_star
id|rrawmidi
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * gameport interface&n; */
macro_line|#ifndef LINUX_2_2
DECL|struct|snd_cs46xx_gameport
r_typedef
r_struct
id|snd_cs46xx_gameport
(brace
DECL|member|info
r_struct
id|gameport
id|info
suffix:semicolon
DECL|member|chip
id|cs46xx_t
op_star
id|chip
suffix:semicolon
DECL|typedef|cs46xx_gameport_t
)brace
id|cs46xx_gameport_t
suffix:semicolon
DECL|function|snd_cs46xx_gameport_trigger
r_static
r_void
id|snd_cs46xx_gameport_trigger
c_func
(paren
r_struct
id|gameport
op_star
id|gameport
)paren
(brace
id|cs46xx_gameport_t
op_star
id|gp
op_assign
(paren
id|cs46xx_gameport_t
op_star
)paren
id|gameport
suffix:semicolon
id|cs46xx_t
op_star
id|chip
suffix:semicolon
id|snd_assert
c_func
(paren
id|gp
comma
r_return
)paren
suffix:semicolon
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|gp-&gt;chip
comma
r_return
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_JSPT
comma
l_int|0xFF
)paren
suffix:semicolon
singleline_comment|//outb(gameport-&gt;io, 0xFF);
)brace
DECL|function|snd_cs46xx_gameport_read
r_static
r_int
r_char
id|snd_cs46xx_gameport_read
c_func
(paren
r_struct
id|gameport
op_star
id|gameport
)paren
(brace
id|cs46xx_gameport_t
op_star
id|gp
op_assign
(paren
id|cs46xx_gameport_t
op_star
)paren
id|gameport
suffix:semicolon
id|cs46xx_t
op_star
id|chip
suffix:semicolon
id|snd_assert
c_func
(paren
id|gp
comma
r_return
l_int|0
)paren
suffix:semicolon
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|gp-&gt;chip
comma
r_return
l_int|0
)paren
suffix:semicolon
r_return
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_JSPT
)paren
suffix:semicolon
singleline_comment|//inb(gameport-&gt;io);
)brace
DECL|function|snd_cs46xx_gameport_cooked_read
r_static
r_int
id|snd_cs46xx_gameport_cooked_read
c_func
(paren
r_struct
id|gameport
op_star
id|gameport
comma
r_int
op_star
id|axes
comma
r_int
op_star
id|buttons
)paren
(brace
id|cs46xx_gameport_t
op_star
id|gp
op_assign
(paren
id|cs46xx_gameport_t
op_star
)paren
id|gameport
suffix:semicolon
id|cs46xx_t
op_star
id|chip
suffix:semicolon
r_int
id|js1
comma
id|js2
comma
id|jst
suffix:semicolon
id|snd_assert
c_func
(paren
id|gp
comma
r_return
l_int|0
)paren
suffix:semicolon
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|gp-&gt;chip
comma
r_return
l_int|0
)paren
suffix:semicolon
id|js1
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_JSC1
)paren
suffix:semicolon
id|js2
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_JSC2
)paren
suffix:semicolon
id|jst
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_JSPT
)paren
suffix:semicolon
op_star
id|buttons
op_assign
(paren
op_complement
id|jst
op_rshift
l_int|4
)paren
op_amp
l_int|0x0F
suffix:semicolon
id|axes
(braket
l_int|0
)braket
op_assign
(paren
(paren
id|js1
op_amp
id|JSC1_Y1V_MASK
)paren
op_rshift
id|JSC1_Y1V_SHIFT
)paren
op_amp
l_int|0xFFFF
suffix:semicolon
id|axes
(braket
l_int|1
)braket
op_assign
(paren
(paren
id|js1
op_amp
id|JSC1_X1V_MASK
)paren
op_rshift
id|JSC1_X1V_SHIFT
)paren
op_amp
l_int|0xFFFF
suffix:semicolon
id|axes
(braket
l_int|2
)braket
op_assign
(paren
(paren
id|js2
op_amp
id|JSC2_Y2V_MASK
)paren
op_rshift
id|JSC2_Y2V_SHIFT
)paren
op_amp
l_int|0xFFFF
suffix:semicolon
id|axes
(braket
l_int|3
)braket
op_assign
(paren
(paren
id|js2
op_amp
id|JSC2_X2V_MASK
)paren
op_rshift
id|JSC2_X2V_SHIFT
)paren
op_amp
l_int|0xFFFF
suffix:semicolon
r_for
c_loop
(paren
id|jst
op_assign
l_int|0
suffix:semicolon
id|jst
OL
l_int|4
suffix:semicolon
op_increment
id|jst
)paren
r_if
c_cond
(paren
id|axes
(braket
id|jst
)braket
op_eq
l_int|0xFFFF
)paren
(brace
id|axes
(braket
id|jst
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_gameport_open
r_static
r_int
id|snd_cs46xx_gameport_open
c_func
(paren
r_struct
id|gameport
op_star
id|gameport
comma
r_int
id|mode
)paren
(brace
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|GAMEPORT_MODE_COOKED
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|GAMEPORT_MODE_RAW
suffix:colon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_gameport
r_void
id|__devinit
id|snd_cs46xx_gameport
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|cs46xx_gameport_t
op_star
id|gp
suffix:semicolon
id|gp
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|gp
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gp
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;cannot allocate gameport area&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memset
c_func
(paren
id|gp
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|gp
)paren
)paren
suffix:semicolon
id|gp-&gt;info.open
op_assign
id|snd_cs46xx_gameport_open
suffix:semicolon
id|gp-&gt;info.read
op_assign
id|snd_cs46xx_gameport_read
suffix:semicolon
id|gp-&gt;info.trigger
op_assign
id|snd_cs46xx_gameport_trigger
suffix:semicolon
id|gp-&gt;info.cooked_read
op_assign
id|snd_cs46xx_gameport_cooked_read
suffix:semicolon
id|gp-&gt;chip
op_assign
id|chip
suffix:semicolon
id|chip-&gt;gameport
op_assign
id|gp
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_JSIO
comma
l_int|0xFF
)paren
suffix:semicolon
singleline_comment|// ?
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_JSCTL
comma
id|JSCTL_SP_MEDIUM_SLOW
)paren
suffix:semicolon
id|gameport_register_port
c_func
(paren
op_amp
id|gp-&gt;info
)paren
suffix:semicolon
)brace
macro_line|#else /* LINUX_2_2 */
DECL|function|snd_cs46xx_gameport
r_void
id|__devinit
id|snd_cs46xx_gameport
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
)brace
macro_line|#endif /* !LINUX_2_2 */
multiline_comment|/*&n; *  proc interface&n; */
DECL|function|snd_cs46xx_io_read
r_static
r_int
id|snd_cs46xx_io_read
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
r_void
op_star
id|file_private_data
comma
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|size
suffix:semicolon
id|snd_cs46xx_region_t
op_star
id|region
op_assign
(paren
id|snd_cs46xx_region_t
op_star
)paren
id|entry-&gt;private_data
suffix:semicolon
id|size
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_pos
op_plus
id|size
OG
id|region-&gt;size
)paren
id|size
op_assign
id|region-&gt;size
op_minus
id|file-&gt;f_pos
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
l_int|0
)paren
(brace
r_char
op_star
id|tmp
suffix:semicolon
r_int
id|res
suffix:semicolon
r_int
r_int
id|virt
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|virt
op_assign
id|region-&gt;remap_addr
op_plus
id|file-&gt;f_pos
suffix:semicolon
id|memcpy_fromio
c_func
(paren
id|tmp
comma
id|virt
comma
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|tmp
comma
id|size
)paren
)paren
id|res
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
(brace
id|res
op_assign
id|size
suffix:semicolon
id|file-&gt;f_pos
op_add_assign
id|size
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|tmp
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_cs46xx_proc_io_ops
r_static
r_struct
id|snd_info_entry_ops
id|snd_cs46xx_proc_io_ops
op_assign
(brace
id|read
suffix:colon
id|snd_cs46xx_io_read
comma
)brace
suffix:semicolon
DECL|function|snd_cs46xx_proc_init
r_static
r_int
id|__devinit
id|snd_cs46xx_proc_init
c_func
(paren
id|snd_card_t
op_star
id|card
comma
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|snd_info_entry_t
op_star
id|entry
suffix:semicolon
r_int
id|idx
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|5
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|snd_cs46xx_region_t
op_star
id|region
op_assign
op_amp
id|chip-&gt;region.idx
(braket
id|idx
)braket
suffix:semicolon
id|entry
op_assign
id|snd_info_create_card_entry
c_func
(paren
id|card
comma
id|region-&gt;name
comma
id|card-&gt;proc_root
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
)paren
(brace
id|entry-&gt;content
op_assign
id|SNDRV_INFO_CONTENT_DATA
suffix:semicolon
id|entry-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|entry-&gt;c.ops
op_assign
op_amp
id|snd_cs46xx_proc_io_ops
suffix:semicolon
id|entry-&gt;size
op_assign
id|region-&gt;size
suffix:semicolon
id|entry-&gt;mode
op_assign
id|S_IFREG
op_or
id|S_IRUSR
suffix:semicolon
r_if
c_cond
(paren
id|snd_info_register
c_func
(paren
id|entry
)paren
OL
l_int|0
)paren
(brace
id|snd_info_unregister
c_func
(paren
id|entry
)paren
suffix:semicolon
id|entry
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|region-&gt;proc_entry
op_assign
id|entry
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_proc_done
r_static
r_int
id|snd_cs46xx_proc_done
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
r_int
id|idx
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|5
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|snd_cs46xx_region_t
op_star
id|region
op_assign
op_amp
id|chip-&gt;region.idx
(braket
id|idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|region-&gt;proc_entry
)paren
(brace
id|snd_info_unregister
c_func
(paren
(paren
id|snd_info_entry_t
op_star
)paren
id|region-&gt;proc_entry
)paren
suffix:semicolon
id|region-&gt;proc_entry
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * stop the h/w&n; */
DECL|function|snd_cs46xx_hw_stop
r_static
r_void
id|snd_cs46xx_hw_stop
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_PFIE
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
l_int|0x0000f03f
suffix:semicolon
id|tmp
op_or_assign
l_int|0x00000010
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PFIE
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* playback interrupt disable */
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_CIE
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
l_int|0x0000003f
suffix:semicolon
id|tmp
op_or_assign
l_int|0x00000011
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CIE
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* capture interrupt disable */
multiline_comment|/*&n;         *  Stop playback DMA.&n;&t; */
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_PCTL
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PCTL
comma
id|tmp
op_amp
l_int|0x0000ffff
)paren
suffix:semicolon
multiline_comment|/*&n;         *  Stop capture DMA.&n;&t; */
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_CCTL
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CCTL
comma
id|tmp
op_amp
l_int|0xffff0000
)paren
suffix:semicolon
multiline_comment|/*&n;         *  Reset the processor.&n;         */
id|snd_cs46xx_reset
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_cs46xx_proc_stop
c_func
(paren
id|chip
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Power down the PLL.&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Turn off the Processor by turning off the software clock enable flag in &n;&t; *  the clock control register.&n;&t; */
id|tmp
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
)paren
op_amp
op_complement
id|CLKCR1_SWCE
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
id|tmp
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_free
r_static
r_int
id|snd_cs46xx_free
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
r_int
id|idx
suffix:semicolon
id|snd_assert
c_func
(paren
id|chip
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;active_ctrl
)paren
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
macro_line|#ifndef LINUX_2_2
r_if
c_cond
(paren
id|chip-&gt;gameport
)paren
(brace
id|gameport_unregister_port
c_func
(paren
op_amp
id|chip-&gt;gameport-&gt;info
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|chip-&gt;gameport
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_PM
r_if
c_cond
(paren
id|chip-&gt;pm_dev
)paren
id|pm_unregister
c_func
(paren
id|chip-&gt;pm_dev
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|chip-&gt;amplifier_ctrl
)paren
id|chip
op_member_access_from_pointer
id|amplifier_ctrl
c_func
(paren
id|chip
comma
op_minus
id|chip-&gt;amplifier
)paren
suffix:semicolon
multiline_comment|/* force to off */
id|snd_cs46xx_proc_done
c_func
(paren
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;region.idx
(braket
l_int|0
)braket
dot
id|resource
)paren
id|snd_cs46xx_hw_stop
c_func
(paren
id|chip
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|5
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|snd_cs46xx_region_t
op_star
id|region
op_assign
op_amp
id|chip-&gt;region.idx
(braket
id|idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|region-&gt;remap_addr
)paren
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|region-&gt;remap_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|region-&gt;resource
)paren
(brace
id|release_resource
c_func
(paren
id|region-&gt;resource
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|region-&gt;resource
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|chip-&gt;irq
op_ge
l_int|0
)paren
id|free_irq
c_func
(paren
id|chip-&gt;irq
comma
(paren
r_void
op_star
)paren
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;active_ctrl
)paren
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
op_minus
id|chip-&gt;amplifier
)paren
suffix:semicolon
id|snd_magic_kfree
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_dev_free
r_static
r_int
id|snd_cs46xx_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|device-&gt;device_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_return
id|snd_cs46xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  initialize chip&n; */
DECL|function|snd_cs46xx_chip_init
r_static
r_int
id|snd_cs46xx_chip_init
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
id|busywait
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
r_int
id|timeout
suffix:semicolon
multiline_comment|/* &n;&t; *  First, blast the clock control register to zero so that the PLL starts&n;         *  out in a known state, and blast the master serial port control register&n;         *  to zero so that the serial ports also start out in a known state.&n;         */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
l_int|0
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERMC1
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  If we are in AC97 mode, then we must set the part to a host controlled&n;         *  AC-link.  Otherwise, we won&squot;t be able to bring up the link.&n;         */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERACC
comma
id|SERACC_HSP
op_or
id|SERACC_CHIP_TYPE_1_03
)paren
suffix:semicolon
multiline_comment|/* 1.03 codec */
multiline_comment|/* snd_cs46xx_pokeBA0(chip, BA0_SERACC, SERACC_HSP | SERACC_CHIP_TYPE_2_0); */
multiline_comment|/* 2.00 codec */
multiline_comment|/*&n;         *  Drive the ARST# pin low for a minimum of 1uS (as defined in the AC97&n;         *  spec) and then drive it high.  This is done for non AC97 modes since&n;         *  there might be logic external to the CS461x that uses the ARST# line&n;         *  for a reset.&n;         */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
id|ACCTL_RSTN
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  The first thing we do here is to enable sync generation.  As soon&n;&t; *  as we start receiving bit clock, we&squot;ll start producing the SYNC&n;&t; *  signal.&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
id|ACCTL_ESYN
op_or
id|ACCTL_RSTN
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Now wait for a short while to allow the AC97 part to start&n;&t; *  generating bit clock (so we don&squot;t try to start the PLL without an&n;&t; *  input clock).&n;&t; */
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Set the serial port timing configuration, so that&n;&t; *  the clock control circuit gets its clock from the correct place.&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERMC1
comma
id|SERMC1_PTC_AC97
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Write the selected clock control setup to the hardware.  Do not turn on&n;&t; *  SWCE yet (if requested), so that the devices clocked by the output of&n;&t; *  PLL are not clocked until the PLL is stable.&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_PLLCC
comma
id|PLLCC_LPF_1050_2780_KHZ
op_or
id|PLLCC_CDR_73_104_MHZ
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_PLLM
comma
l_int|0x3a
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR2
comma
id|CLKCR2_PDIVS_8
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Power up the PLL.&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
id|CLKCR1_PLLP
)paren
suffix:semicolon
multiline_comment|/*&n;         *  Wait until the PLL has stabilized.&n;&t; */
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Turn on clocking of the core so that we can setup the serial ports.&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
id|CLKCR1_PLLP
op_or
id|CLKCR1_SWCE
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Fill the serial port FIFOs with silence.&n;&t; */
id|snd_cs46xx_clear_serial_FIFOs
c_func
(paren
id|chip
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Set the serial port FIFO pointer to the first sample in the FIFO.&n;&t; */
multiline_comment|/* snd_cs46xx_pokeBA0(chip, BA0_SERBSP, 0); */
multiline_comment|/*&n;&t; *  Write the serial port configuration to the part.  The master&n;&t; *  enable bit is not set until all other values have been written.&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERC1
comma
id|SERC1_SO1F_AC97
op_or
id|SERC1_SO1EN
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERC2
comma
id|SERC2_SI1F_AC97
op_or
id|SERC1_SO1EN
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERMC1
comma
id|SERMC1_PTC_AC97
op_or
id|SERMC1_MSPE
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Wait for the codec ready signal from the AC97 codec.&n;&t; */
id|timeout
op_assign
l_int|150
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_decrement
OG
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t; *  Read the AC97 status register to see if we&squot;ve seen a CODEC READY&n;&t;&t; *  signal from the AC97 codec.&n;&t;&t; */
r_if
c_cond
(paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACSTS
)paren
op_amp
id|ACSTS_CRDY
)paren
r_goto
id|ok1
suffix:semicolon
r_if
c_cond
(paren
id|busywait
)paren
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_else
(brace
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
(paren
id|HZ
op_plus
l_int|99
)paren
op_div
l_int|100
)paren
suffix:semicolon
)brace
)brace
id|snd_printk
c_func
(paren
l_string|&quot;create - never read codec ready from AC&squot;97&bslash;n&quot;
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;it is not probably bug, try to use CS4236 driver&bslash;n&quot;
)paren
suffix:semicolon
id|snd_cs46xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
id|ok1
suffix:colon
multiline_comment|/*&n;&t; *  Assert the vaid frame signal so that we can start sending commands&n;&t; *  to the AC97 codec.&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
id|ACCTL_VFRM
op_or
id|ACCTL_ESYN
op_or
id|ACCTL_RSTN
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Wait until we&squot;ve sampled input slots 3 and 4 as valid, meaning that&n;&t; *  the codec is pumping ADC data across the AC-link.&n;&t; */
id|timeout
op_assign
l_int|150
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_decrement
OG
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t; *  Read the input slot valid register and see if input slots 3 and&n;&t;&t; *  4 are valid yet.&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACISV
)paren
op_amp
(paren
id|ACISV_ISV3
op_or
id|ACISV_ISV4
)paren
)paren
op_eq
(paren
id|ACISV_ISV3
op_or
id|ACISV_ISV4
)paren
)paren
r_goto
id|ok2
suffix:semicolon
r_if
c_cond
(paren
id|busywait
)paren
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_else
(brace
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
(paren
id|HZ
op_plus
l_int|99
)paren
op_div
l_int|100
)paren
suffix:semicolon
)brace
)brace
id|snd_printk
c_func
(paren
l_string|&quot;create - never read ISV3 &amp; ISV4 from AC&squot;97&bslash;n&quot;
)paren
suffix:semicolon
id|snd_cs46xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
id|ok2
suffix:colon
multiline_comment|/*&n;&t; *  Now, assert valid frame and the slot 3 and 4 valid bits.  This will&n;&t; *  commense the transfer of digital audio data to the AC97 codec.&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACOSV
comma
id|ACOSV_SLV3
op_or
id|ACOSV_SLV4
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Power down the DAC and ADC.  We will power them up (if) when we need&n;&t; *  them.&n;&t; */
multiline_comment|/* snd_cs46xx_pokeBA0(chip, BA0_AC97_POWERDOWN, 0x300); */
multiline_comment|/*&n;&t; *  Turn off the Processor by turning off the software clock enable flag in &n;&t; *  the clock control register.&n;&t; */
multiline_comment|/* tmp = snd_cs46xx_peekBA0(chip, BA0_CLKCR1) &amp; ~CLKCR1_SWCE; */
multiline_comment|/* snd_cs46xx_pokeBA0(chip, BA0_CLKCR1, tmp); */
multiline_comment|/*&n;         *  Reset the processor.&n;         */
id|snd_cs46xx_reset
c_func
(paren
id|chip
)paren
suffix:semicolon
multiline_comment|/*&n;         *  Download the image to the processor.&n;&t; */
r_if
c_cond
(paren
id|snd_cs46xx_download_image
c_func
(paren
id|chip
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;image download error&bslash;n&quot;
)paren
suffix:semicolon
id|snd_cs46xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/*&n;         *  Stop playback DMA.&n;&t; */
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_PCTL
)paren
suffix:semicolon
id|chip-&gt;play.ctl
op_assign
id|tmp
op_amp
l_int|0xffff0000
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PCTL
comma
id|tmp
op_amp
l_int|0x0000ffff
)paren
suffix:semicolon
multiline_comment|/*&n;         *  Stop capture DMA.&n;&t; */
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_CCTL
)paren
suffix:semicolon
id|chip-&gt;capt.ctl
op_assign
id|tmp
op_amp
l_int|0x0000ffff
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CCTL
comma
id|tmp
op_amp
l_int|0xffff0000
)paren
suffix:semicolon
id|snd_cs46xx_set_play_sample_rate
c_func
(paren
id|chip
comma
l_int|8000
)paren
suffix:semicolon
id|snd_cs46xx_set_capture_sample_rate
c_func
(paren
id|chip
comma
l_int|8000
)paren
suffix:semicolon
id|snd_cs46xx_proc_start
c_func
(paren
id|chip
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Enable interrupts on the part.&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_HICR
comma
id|HICR_IEV
op_or
id|HICR_CHGM
)paren
suffix:semicolon
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_PFIE
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
l_int|0x0000f03f
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PFIE
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* playback interrupt enable */
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_CIE
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
l_int|0x0000003f
suffix:semicolon
id|tmp
op_or_assign
l_int|0x00000001
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CIE
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* capture interrupt enable */
multiline_comment|/* set the attenuation to 0dB */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PVOL
comma
l_int|0x80008000
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CVOL
comma
l_int|0x80008000
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;AMP control - null AMP&n; */
DECL|function|amp_none
r_static
r_void
id|amp_none
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
id|change
)paren
(brace
)brace
multiline_comment|/*&n; *&t;Crystal EAPD mode&n; */
DECL|function|amp_voyetra
r_static
r_void
id|amp_voyetra
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
id|change
)paren
(brace
multiline_comment|/* Manage the EAPD bit on the Crystal 4297 &n;&t;   and the Analog AD1885 */
r_int
id|old
op_assign
id|chip-&gt;amplifier
suffix:semicolon
r_int
id|oval
comma
id|val
suffix:semicolon
id|chip-&gt;amplifier
op_add_assign
id|change
suffix:semicolon
id|oval
op_assign
id|snd_cs46xx_codec_read
c_func
(paren
id|chip
comma
id|AC97_POWERDOWN
)paren
suffix:semicolon
id|val
op_assign
id|oval
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;amplifier
op_logical_and
op_logical_neg
id|old
)paren
(brace
multiline_comment|/* Turn the EAPD amp on */
id|val
op_or_assign
l_int|0x8000
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|old
op_logical_and
op_logical_neg
id|chip-&gt;amplifier
)paren
(brace
multiline_comment|/* Turn the EAPD amp off */
id|val
op_and_assign
op_complement
l_int|0x8000
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_ne
id|oval
)paren
(brace
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
id|AC97_POWERDOWN
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;eapd_switch
)paren
id|snd_ctl_notify
c_func
(paren
id|chip-&gt;card
comma
id|SNDRV_CTL_EVENT_MASK_VALUE
comma
op_amp
id|chip-&gt;eapd_switch-&gt;id
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *&t;Game Theatre XP card - EGPIO[2] is used to enable the external amp.&n; */
DECL|function|amp_hercules
r_static
r_void
id|amp_hercules
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
id|change
)paren
(brace
r_int
id|old
op_assign
id|chip-&gt;amplifier
suffix:semicolon
id|chip-&gt;amplifier
op_add_assign
id|change
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;amplifier
op_logical_and
op_logical_neg
id|old
)paren
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIODR
comma
id|EGPIODR_GPOE2
)paren
suffix:semicolon
multiline_comment|/* enable EGPIO2 output */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIOPTR
comma
id|EGPIOPTR_GPPT2
)paren
suffix:semicolon
multiline_comment|/* open-drain on output */
)brace
r_else
r_if
c_cond
(paren
id|old
op_logical_and
op_logical_neg
id|chip-&gt;amplifier
)paren
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIODR
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* disable */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIOPTR
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* disable */
)brace
)brace
macro_line|#if 0
multiline_comment|/*&n; *&t;Untested&n; */
r_static
r_void
id|amp_voyetra_4294
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
id|change
)paren
(brace
id|chip-&gt;amplifier
op_add_assign
id|change
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;amplifier
)paren
(brace
multiline_comment|/* Switch the GPIO pins 7 and 8 to open drain */
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
l_int|0x4C
comma
id|snd_cs46xx_codec_read
c_func
(paren
id|chip
comma
l_int|0x4C
)paren
op_amp
l_int|0xFE7F
)paren
suffix:semicolon
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
l_int|0x4E
comma
id|snd_cs46xx_codec_read
c_func
(paren
id|chip
comma
l_int|0x4E
)paren
op_or
l_int|0x0180
)paren
suffix:semicolon
multiline_comment|/* Now wake the AMP (this might be backwards) */
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
l_int|0x54
comma
id|snd_cs46xx_codec_read
c_func
(paren
id|chip
comma
l_int|0x54
)paren
op_amp
op_complement
l_int|0x0180
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
l_int|0x54
comma
id|snd_cs46xx_codec_read
c_func
(paren
id|chip
comma
l_int|0x54
)paren
op_or
l_int|0x0180
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/*&n; * piix4 pci ids&n; */
macro_line|#ifndef PCI_VENDOR_ID_INTEL
DECL|macro|PCI_VENDOR_ID_INTEL
mdefine_line|#define PCI_VENDOR_ID_INTEL 0x8086
macro_line|#endif /* PCI_VENDOR_ID_INTEL */
macro_line|#ifndef PCI_DEVICE_ID_INTEL_82371AB_3
DECL|macro|PCI_DEVICE_ID_INTEL_82371AB_3
mdefine_line|#define PCI_DEVICE_ID_INTEL_82371AB_3 0x7113
macro_line|#endif /* PCI_DEVICE_ID_INTEL_82371AB_3 */
multiline_comment|/*&n; *&t;Handle the CLKRUN on a thinkpad. We must disable CLKRUN support&n; *&t;whenever we need to beat on the chip.&n; *&n; *&t;The original idea and code for this hack comes from David Kaiser at&n; *&t;Linuxcare. Perhaps one day Crystal will document their chips well&n; *&t;enough to make them useful.&n; */
DECL|function|clkrun_hack
r_static
r_void
id|clkrun_hack
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
id|change
)paren
(brace
id|u16
id|control
suffix:semicolon
r_int
id|old
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;acpi_dev
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|old
op_assign
id|chip-&gt;amplifier
suffix:semicolon
id|chip-&gt;amplifier
op_add_assign
id|change
suffix:semicolon
multiline_comment|/* Read ACPI port */
id|control
op_assign
id|inw
c_func
(paren
id|chip-&gt;acpi_port
op_plus
l_int|0x10
)paren
suffix:semicolon
multiline_comment|/* Flip CLKRUN off while running */
r_if
c_cond
(paren
op_logical_neg
id|chip-&gt;amplifier
op_logical_and
id|old
)paren
id|outw
c_func
(paren
id|control
op_or
l_int|0x2000
comma
id|chip-&gt;acpi_port
op_plus
l_int|0x10
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|chip-&gt;amplifier
op_logical_and
op_logical_neg
id|old
)paren
id|outw
c_func
(paren
id|control
op_amp
op_complement
l_int|0x2000
comma
id|chip-&gt;acpi_port
op_plus
l_int|0x10
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * detect intel piix4&n; */
DECL|function|clkrun_init
r_static
r_void
id|clkrun_init
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|u8
id|pp
suffix:semicolon
id|chip-&gt;acpi_dev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_INTEL
comma
id|PCI_DEVICE_ID_INTEL_82371AB_3
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;acpi_dev
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
multiline_comment|/* Not a thinkpad thats for sure */
multiline_comment|/* Find the control port */
id|pci_read_config_byte
c_func
(paren
id|chip-&gt;acpi_dev
comma
l_int|0x41
comma
op_amp
id|pp
)paren
suffix:semicolon
id|chip-&gt;acpi_port
op_assign
id|pp
op_lshift
l_int|8
suffix:semicolon
)brace
multiline_comment|/*&n; * Card subid table&n; */
DECL|struct|cs_card_type
r_struct
id|cs_card_type
(brace
DECL|member|vendor
id|u16
id|vendor
suffix:semicolon
DECL|member|id
id|u16
id|id
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|init
r_void
(paren
op_star
id|init
)paren
(paren
id|cs46xx_t
op_star
)paren
suffix:semicolon
DECL|member|amp
r_void
(paren
op_star
id|amp
)paren
(paren
id|cs46xx_t
op_star
comma
r_int
)paren
suffix:semicolon
DECL|member|active
r_void
(paren
op_star
id|active
)paren
(paren
id|cs46xx_t
op_star
comma
r_int
)paren
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|cards
r_static
r_struct
id|cs_card_type
id|__initdata
id|cards
(braket
)braket
op_assign
(brace
(brace
l_int|0x1489
comma
l_int|0x7001
comma
l_string|&quot;Genius Soundmaker 128 value&quot;
comma
l_int|NULL
comma
id|amp_none
comma
l_int|NULL
)brace
comma
(brace
l_int|0x5053
comma
l_int|0x3357
comma
l_string|&quot;Voyetra&quot;
comma
l_int|NULL
comma
id|amp_voyetra
comma
l_int|NULL
)brace
comma
(brace
l_int|0x1071
comma
l_int|0x6003
comma
l_string|&quot;Mitac MI6020/21&quot;
comma
l_int|NULL
comma
id|amp_voyetra
comma
l_int|NULL
)brace
comma
(brace
l_int|0x14AF
comma
l_int|0x0050
comma
l_string|&quot;Hercules Game Theatre XP&quot;
comma
l_int|NULL
comma
id|amp_hercules
comma
l_int|NULL
)brace
comma
(brace
l_int|0x1681
comma
l_int|0x0050
comma
l_string|&quot;Hercules Game Theatre XP&quot;
comma
l_int|NULL
comma
id|amp_hercules
comma
l_int|NULL
)brace
comma
(brace
l_int|0x1681
comma
l_int|0x0051
comma
l_string|&quot;Hercules Game Theatre XP&quot;
comma
l_int|NULL
comma
id|amp_hercules
comma
l_int|NULL
)brace
comma
(brace
l_int|0x1681
comma
l_int|0x0052
comma
l_string|&quot;Hercules Game Theatre XP&quot;
comma
l_int|NULL
comma
id|amp_hercules
comma
l_int|NULL
)brace
comma
(brace
l_int|0x1681
comma
l_int|0x0053
comma
l_string|&quot;Hercules Game Theatre XP&quot;
comma
l_int|NULL
comma
id|amp_hercules
comma
l_int|NULL
)brace
comma
(brace
l_int|0x1681
comma
l_int|0x0054
comma
l_string|&quot;Hercules Game Theatre XP&quot;
comma
l_int|NULL
comma
id|amp_hercules
comma
l_int|NULL
)brace
comma
multiline_comment|/* Not sure if the 570 needs the clkrun hack */
(brace
id|PCI_VENDOR_ID_IBM
comma
l_int|0x0132
comma
l_string|&quot;Thinkpad 570&quot;
comma
id|clkrun_init
comma
l_int|NULL
comma
id|clkrun_hack
)brace
comma
(brace
id|PCI_VENDOR_ID_IBM
comma
l_int|0x0153
comma
l_string|&quot;Thinkpad 600X/A20/T20&quot;
comma
id|clkrun_init
comma
l_int|NULL
comma
id|clkrun_hack
)brace
comma
(brace
id|PCI_VENDOR_ID_IBM
comma
l_int|0x1010
comma
l_string|&quot;Thinkpad 600E (unsupported)&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_string|&quot;Card without SSID set&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
)brace
suffix:semicolon
multiline_comment|/*&n; * APM support&n; */
macro_line|#ifdef CONFIG_PM
DECL|function|snd_cs46xx_suspend
r_void
id|snd_cs46xx_suspend
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|snd_card_t
op_star
id|card
op_assign
id|chip-&gt;card
suffix:semicolon
id|snd_power_lock
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;power_state
op_eq
id|SNDRV_CTL_POWER_D3hot
)paren
r_goto
id|__skip
suffix:semicolon
id|snd_pcm_suspend_all
c_func
(paren
id|chip-&gt;pcm
)paren
suffix:semicolon
singleline_comment|// chip-&gt;ac97_powerdown = snd_cs46xx_codec_read(chip, AC97_POWER_CONTROL);
singleline_comment|// chip-&gt;ac97_general_purpose = snd_cs46xx_codec_read(chip, BA0_AC97_GENERAL_PURPOSE);
id|snd_cs46xx_hw_stop
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_power_change_state
c_func
(paren
id|card
comma
id|SNDRV_CTL_POWER_D3hot
)paren
suffix:semicolon
id|__skip
suffix:colon
id|snd_power_unlock
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_resume
r_void
id|snd_cs46xx_resume
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|snd_card_t
op_star
id|card
op_assign
id|chip-&gt;card
suffix:semicolon
r_int
id|amp_saved
suffix:semicolon
id|snd_power_lock
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;power_state
op_eq
id|SNDRV_CTL_POWER_D0
)paren
r_goto
id|__skip
suffix:semicolon
id|pci_enable_device
c_func
(paren
id|chip-&gt;pci
)paren
suffix:semicolon
id|amp_saved
op_assign
id|chip-&gt;amplifier
suffix:semicolon
id|chip-&gt;amplifier
op_assign
l_int|0
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* force to on */
id|snd_cs46xx_chip_init
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
macro_line|#if 0
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
id|BA0_AC97_GENERAL_PURPOSE
comma
id|chip-&gt;ac97_general_purpose
)paren
suffix:semicolon
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
id|AC97_POWER_CONTROL
comma
id|chip-&gt;ac97_powerdown
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
id|BA0_AC97_POWERDOWN
comma
id|chip-&gt;ac97_powerdown
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
macro_line|#endif
id|snd_ac97_resume
c_func
(paren
id|chip-&gt;ac97
)paren
suffix:semicolon
r_if
c_cond
(paren
id|amp_saved
)paren
id|chip
op_member_access_from_pointer
id|amplifier_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* try to turn on */
r_if
c_cond
(paren
op_logical_neg
id|amp_saved
)paren
(brace
id|chip-&gt;amplifier
op_assign
l_int|1
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|snd_power_change_state
c_func
(paren
id|card
comma
id|SNDRV_CTL_POWER_D0
)paren
suffix:semicolon
id|__skip
suffix:colon
id|snd_power_unlock
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_set_power_state
r_static
r_int
id|snd_cs46xx_set_power_state
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_int
r_int
id|power_state
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs46xx_t
comma
id|card-&gt;power_state_private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|power_state
)paren
(brace
r_case
id|SNDRV_CTL_POWER_D0
suffix:colon
r_case
id|SNDRV_CTL_POWER_D1
suffix:colon
r_case
id|SNDRV_CTL_POWER_D2
suffix:colon
id|snd_cs46xx_resume
c_func
(paren
id|chip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_CTL_POWER_D3hot
suffix:colon
r_case
id|SNDRV_CTL_POWER_D3cold
suffix:colon
id|snd_cs46xx_suspend
c_func
(paren
id|chip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PM */
multiline_comment|/*&n; */
DECL|function|snd_cs46xx_create
r_int
id|__devinit
id|snd_cs46xx_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_struct
id|pci_dev
op_star
id|pci
comma
r_int
id|external_amp
comma
r_int
id|thinkpad
comma
id|cs46xx_t
op_star
op_star
id|rchip
)paren
(brace
id|cs46xx_t
op_star
id|chip
suffix:semicolon
r_int
id|err
comma
id|idx
suffix:semicolon
id|snd_cs46xx_region_t
op_star
id|region
suffix:semicolon
r_struct
id|cs_card_type
op_star
id|cp
suffix:semicolon
id|u16
id|ss_card
comma
id|ss_vendor
suffix:semicolon
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
id|dev_free
suffix:colon
id|snd_cs46xx_dev_free
comma
)brace
suffix:semicolon
op_star
id|rchip
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* enable PCI device */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pci
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|chip
op_assign
id|snd_magic_kcalloc
c_func
(paren
id|cs46xx_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|chip-&gt;card
op_assign
id|card
suffix:semicolon
id|chip-&gt;pci
op_assign
id|pci
suffix:semicolon
id|chip-&gt;play.hw_size
op_assign
id|PAGE_SIZE
suffix:semicolon
id|chip-&gt;capt.hw_size
op_assign
id|PAGE_SIZE
suffix:semicolon
id|chip-&gt;irq
op_assign
op_minus
l_int|1
suffix:semicolon
id|chip-&gt;ba0_addr
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
suffix:semicolon
id|chip-&gt;ba1_addr
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;ba0_addr
op_eq
l_int|0
op_logical_or
id|chip-&gt;ba0_addr
op_eq
op_complement
l_int|0
op_logical_or
id|chip-&gt;ba1_addr
op_eq
l_int|0
op_logical_or
id|chip-&gt;ba1_addr
op_eq
op_complement
l_int|0
)paren
(brace
id|snd_cs46xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;wrong address(es) - ba0 = 0x%lx, ba1 = 0x%lx&bslash;n&quot;
comma
id|chip-&gt;ba0_addr
comma
id|chip-&gt;ba1_addr
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|region
op_assign
op_amp
id|chip-&gt;region.name.ba0
suffix:semicolon
id|strcpy
c_func
(paren
id|region-&gt;name
comma
l_string|&quot;CS46xx_BA0&quot;
)paren
suffix:semicolon
id|region-&gt;base
op_assign
id|chip-&gt;ba0_addr
suffix:semicolon
id|region-&gt;size
op_assign
id|CS46XX_BA0_SIZE
suffix:semicolon
id|region
op_assign
op_amp
id|chip-&gt;region.name.data0
suffix:semicolon
id|strcpy
c_func
(paren
id|region-&gt;name
comma
l_string|&quot;CS46xx_BA1_data0&quot;
)paren
suffix:semicolon
id|region-&gt;base
op_assign
id|chip-&gt;ba1_addr
op_plus
id|BA1_SP_DMEM0
suffix:semicolon
id|region-&gt;size
op_assign
id|CS46XX_BA1_DATA0_SIZE
suffix:semicolon
id|region
op_assign
op_amp
id|chip-&gt;region.name.data1
suffix:semicolon
id|strcpy
c_func
(paren
id|region-&gt;name
comma
l_string|&quot;CS46xx_BA1_data1&quot;
)paren
suffix:semicolon
id|region-&gt;base
op_assign
id|chip-&gt;ba1_addr
op_plus
id|BA1_SP_DMEM1
suffix:semicolon
id|region-&gt;size
op_assign
id|CS46XX_BA1_DATA1_SIZE
suffix:semicolon
id|region
op_assign
op_amp
id|chip-&gt;region.name.pmem
suffix:semicolon
id|strcpy
c_func
(paren
id|region-&gt;name
comma
l_string|&quot;CS46xx_BA1_pmem&quot;
)paren
suffix:semicolon
id|region-&gt;base
op_assign
id|chip-&gt;ba1_addr
op_plus
id|BA1_SP_PMEM
suffix:semicolon
id|region-&gt;size
op_assign
id|CS46XX_BA1_PRG_SIZE
suffix:semicolon
id|region
op_assign
op_amp
id|chip-&gt;region.name.reg
suffix:semicolon
id|strcpy
c_func
(paren
id|region-&gt;name
comma
l_string|&quot;CS46xx_BA1_reg&quot;
)paren
suffix:semicolon
id|region-&gt;base
op_assign
id|chip-&gt;ba1_addr
op_plus
id|BA1_SP_REG
suffix:semicolon
id|region-&gt;size
op_assign
id|CS46XX_BA1_REG_SIZE
suffix:semicolon
multiline_comment|/* set up amp and clkrun hack */
id|pci_read_config_word
c_func
(paren
id|pci
comma
id|PCI_SUBSYSTEM_VENDOR_ID
comma
op_amp
id|ss_vendor
)paren
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pci
comma
id|PCI_SUBSYSTEM_ID
comma
op_amp
id|ss_card
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cp
op_assign
op_amp
id|cards
(braket
l_int|0
)braket
suffix:semicolon
id|cp-&gt;name
suffix:semicolon
id|cp
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cp-&gt;vendor
op_eq
id|ss_vendor
op_logical_and
id|cp-&gt;id
op_eq
id|ss_card
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;hack for %s enabled&bslash;n&quot;
comma
id|cp-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cp-&gt;init
)paren
id|cp
op_member_access_from_pointer
id|init
c_func
(paren
id|chip
)paren
suffix:semicolon
id|chip-&gt;amplifier_ctrl
op_assign
id|cp-&gt;amp
suffix:semicolon
id|chip-&gt;active_ctrl
op_assign
id|cp-&gt;active
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|external_amp
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;Crystal EAPD support forced on.&bslash;n&quot;
)paren
suffix:semicolon
id|chip-&gt;amplifier_ctrl
op_assign
id|amp_voyetra
suffix:semicolon
)brace
r_if
c_cond
(paren
id|thinkpad
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;Activating CLKRUN hack for Thinkpad.&bslash;n&quot;
)paren
suffix:semicolon
id|chip-&gt;active_ctrl
op_assign
id|clkrun_hack
suffix:semicolon
id|clkrun_init
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chip-&gt;amplifier_ctrl
op_eq
l_int|NULL
)paren
id|chip-&gt;amplifier_ctrl
op_assign
id|amp_none
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;active_ctrl
op_eq
l_int|NULL
)paren
id|chip-&gt;active_ctrl
op_assign
id|amp_none
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pci
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|5
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|region
op_assign
op_amp
id|chip-&gt;region.idx
(braket
id|idx
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|region-&gt;resource
op_assign
id|request_mem_region
c_func
(paren
id|region-&gt;base
comma
id|region-&gt;size
comma
id|region-&gt;name
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_cs46xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;unable to request memory region 0x%lx-0x%lx&bslash;n&quot;
comma
id|region-&gt;base
comma
id|region-&gt;base
op_plus
id|region-&gt;size
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|region-&gt;remap_addr
op_assign
(paren
r_int
r_int
)paren
id|ioremap_nocache
c_func
(paren
id|region-&gt;base
comma
id|region-&gt;size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|region-&gt;remap_addr
op_eq
l_int|0
)paren
(brace
id|snd_cs46xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;%s ioremap problem&bslash;n&quot;
comma
id|region-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|pci-&gt;irq
comma
id|snd_cs46xx_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
l_string|&quot;CS46XX&quot;
comma
(paren
r_void
op_star
)paren
id|chip
)paren
)paren
(brace
id|snd_cs46xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab IRQ %d&bslash;n&quot;
comma
id|pci-&gt;irq
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|chip-&gt;irq
op_assign
id|pci-&gt;irq
suffix:semicolon
id|err
op_assign
id|snd_cs46xx_chip_init
c_func
(paren
id|chip
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_cs46xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|snd_cs46xx_proc_init
c_func
(paren
id|card
comma
id|chip
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PM
id|card-&gt;set_power_state
op_assign
id|snd_cs46xx_set_power_state
suffix:semicolon
id|card-&gt;power_state_private_data
op_assign
id|chip
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|chip
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_cs46xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
op_minus
l_int|1
)paren
suffix:semicolon
op_star
id|rchip
op_assign
id|chip
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
