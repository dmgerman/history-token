multiline_comment|/*&n; *  Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *                   Abramo Bagnara &lt;abramo@alsa-project.org&gt;&n; *                   Cirrus Logic, Inc.&n; *  Routines for control of Cirrus Logic CS461x chips&n; *&n; *  KNOWN BUGS:&n; *    - Sometimes the SPDIF input DSP tasks get&squot;s unsynchronized&n; *      and the SPDIF get somewhat &quot;distorcionated&quot;, or/and left right channel&n; *      are swapped. To get around this problem when it happens, mute and unmute &n; *      the SPDIF input mixer controll.&n; *    - On the Hercules Game Theater XP the amplifier are sometimes turned&n; *      off on inadecuate moments which causes distorcions on sound.&n; *&n; *  TODO:&n; *    - Secondary CODEC on some soundcards&n; *    - SPDIF input support for other sample rates then 48khz&n; *    - Posibility to mix the SPDIF output with analog sources.&n; *    - PCM channels for Center and LFE on secondary codec&n; *&n; *  NOTE: with CONFIG_SND_CS46XX_NEW_DSP unset uses old DSP image (which&n; *        is default configuration), no SPDIF, no secondary codec, no&n; *        multi channel PCM.  But known to work.&n; *&n; *  FINALLY: A credit to the developers Tom and Jordan &n; *           at Cirrus for have helping me out with the DSP, however we&n; *           still don&squot;t have sufficient documentation and technical&n; *           references to be able to implement all fancy feutures&n; *           supported by the cs46xx DSP&squot;s. &n; *           Benny &lt;benny@hostmobility.com&gt;&n; *                &n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/pm.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/gameport.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/control.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
macro_line|#include &lt;sound/pcm_params.h&gt;
macro_line|#include &lt;sound/cs46xx.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;cs46xx_lib.h&quot;
macro_line|#include &quot;dsp_spos.h&quot;
r_static
r_void
id|amp_voyetra
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
id|change
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
DECL|variable|snd_cs46xx_playback_rear_ops
r_static
id|snd_pcm_ops_t
id|snd_cs46xx_playback_rear_ops
suffix:semicolon
DECL|variable|snd_cs46xx_playback_indirect_rear_ops
r_static
id|snd_pcm_ops_t
id|snd_cs46xx_playback_indirect_rear_ops
suffix:semicolon
DECL|variable|snd_cs46xx_playback_clfe_ops
r_static
id|snd_pcm_ops_t
id|snd_cs46xx_playback_clfe_ops
suffix:semicolon
DECL|variable|snd_cs46xx_playback_indirect_clfe_ops
r_static
id|snd_pcm_ops_t
id|snd_cs46xx_playback_indirect_clfe_ops
suffix:semicolon
DECL|variable|snd_cs46xx_playback_iec958_ops
r_static
id|snd_pcm_ops_t
id|snd_cs46xx_playback_iec958_ops
suffix:semicolon
DECL|variable|snd_cs46xx_playback_indirect_iec958_ops
r_static
id|snd_pcm_ops_t
id|snd_cs46xx_playback_indirect_iec958_ops
suffix:semicolon
macro_line|#endif
DECL|variable|snd_cs46xx_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_cs46xx_playback_ops
suffix:semicolon
DECL|variable|snd_cs46xx_playback_indirect_ops
r_static
id|snd_pcm_ops_t
id|snd_cs46xx_playback_indirect_ops
suffix:semicolon
DECL|variable|snd_cs46xx_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_cs46xx_capture_ops
suffix:semicolon
DECL|variable|snd_cs46xx_capture_indirect_ops
r_static
id|snd_pcm_ops_t
id|snd_cs46xx_capture_indirect_ops
suffix:semicolon
DECL|function|snd_cs46xx_codec_read
r_static
r_int
r_int
id|snd_cs46xx_codec_read
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
r_int
id|reg
comma
r_int
id|codec_index
)paren
(brace
r_int
id|count
suffix:semicolon
r_int
r_int
id|result
comma
id|tmp
suffix:semicolon
id|u32
id|offset
op_assign
l_int|0
suffix:semicolon
id|snd_assert
(paren
(paren
id|codec_index
op_eq
id|CS46XX_PRIMARY_CODEC_INDEX
)paren
op_logical_or
(paren
id|codec_index
op_eq
id|CS46XX_SECONDARY_CODEC_INDEX
)paren
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|codec_index
op_eq
id|CS46XX_SECONDARY_CODEC_INDEX
)paren
id|offset
op_assign
id|CS46XX_SECONDARY_CODEC_OFFSET
suffix:semicolon
multiline_comment|/*&n;&t; *  1. Write ACCAD = Command Address Register = 46Ch for AC97 register address&n;&t; *  2. Write ACCDA = Command Data Register = 470h    for data to write to AC97 &n;&t; *  3. Write ACCTL = Control Register = 460h for initiating the write7---55&n;&t; *  4. Read ACCTL = 460h, DCV should be reset by now and 460h = 17h&n;&t; *  5. if DCV not cleared, break and return error&n;&t; *  6. Read ACSTS = Status Register = 464h, check VSTS bit&n;&t; */
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACSDA
op_plus
id|offset
)paren
suffix:semicolon
id|tmp
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_amp
id|ACCTL_VFRM
)paren
op_eq
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;cs46xx: ACCTL_VFRM not set 0x%x&bslash;n&quot;
comma
id|tmp
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
(paren
id|tmp
op_amp
(paren
op_complement
id|ACCTL_ESYN
)paren
)paren
op_or
id|ACCTL_VFRM
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
id|tmp
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
op_plus
id|offset
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
id|tmp
op_or
id|ACCTL_ESYN
op_or
id|ACCTL_VFRM
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *  Setup the AC97 control registers on the CS461x to send the&n;&t; *  appropriate command to the AC97 to perform the read.&n;&t; *  ACCAD = Command Address Register = 46Ch&n;&t; *  ACCDA = Command Data Register = 470h&n;&t; *  ACCTL = Control Register = 460h&n;&t; *  set DCV - will clear when process completed&n;&t; *  set CRW - Read command&n;&t; *  set VFRM - valid frame enabled&n;&t; *  set ESYN - ASYNC generation enabled&n;&t; *  set RSTN - ARST# inactive, AC97 codec not reset&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCAD
comma
id|reg
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCDA
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|codec_index
op_eq
id|CS46XX_PRIMARY_CODEC_INDEX
)paren
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
multiline_comment|/* clear ACCTL_DCV */
id|ACCTL_CRW
op_or
id|ACCTL_VFRM
op_or
id|ACCTL_ESYN
op_or
id|ACCTL_RSTN
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
id|ACCTL_DCV
op_or
id|ACCTL_CRW
op_or
id|ACCTL_VFRM
op_or
id|ACCTL_ESYN
op_or
id|ACCTL_RSTN
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
id|ACCTL_DCV
op_or
id|ACCTL_TC
op_or
id|ACCTL_CRW
op_or
id|ACCTL_VFRM
op_or
id|ACCTL_ESYN
op_or
id|ACCTL_RSTN
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *  Wait for the read to occur.&n;&t; */
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
l_int|1000
suffix:semicolon
id|count
op_increment
)paren
(brace
multiline_comment|/*&n;&t;&t; *  First, we want to wait for a short time.&n;&t; &t; */
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; *  Now, check to see if the read has completed.&n;&t;&t; *  ACCTL = 460h, DCV should be reset by now and 460h = 17h&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
)paren
op_amp
id|ACCTL_DCV
)paren
)paren
r_goto
id|ok1
suffix:semicolon
)brace
id|snd_printk
c_func
(paren
l_string|&quot;AC&squot;97 read problem (ACCTL_DCV), reg = 0x%x&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
id|result
op_assign
l_int|0xffff
suffix:semicolon
r_goto
id|end
suffix:semicolon
id|ok1
suffix:colon
multiline_comment|/*&n;&t; *  Wait for the valid status bit to go active.&n;&t; */
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
l_int|100
suffix:semicolon
id|count
op_increment
)paren
(brace
multiline_comment|/*&n;&t;&t; *  Read the AC97 status register.&n;&t;&t; *  ACSTS = Status Register = 464h&n;&t;&t; *  VSTS - Valid Status&n;&t;&t; */
r_if
c_cond
(paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACSTS
op_plus
id|offset
)paren
op_amp
id|ACSTS_VSTS
)paren
r_goto
id|ok2
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|snd_printk
c_func
(paren
l_string|&quot;AC&squot;97 read problem (ACSTS_VSTS), codec_index %d, reg = 0x%x&bslash;n&quot;
comma
id|codec_index
comma
id|reg
)paren
suffix:semicolon
id|result
op_assign
l_int|0xffff
suffix:semicolon
r_goto
id|end
suffix:semicolon
id|ok2
suffix:colon
multiline_comment|/*&n;&t; *  Read the data returned from the AC97 register.&n;&t; *  ACSDA = Status Data Register = 474h&n;&t; */
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;e) reg = 0x%x, val = 0x%x, BA0_ACCAD = 0x%x&bslash;n&quot;
comma
id|reg
comma
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACSDA
)paren
comma
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACCAD
)paren
)paren
suffix:semicolon
macro_line|#endif
singleline_comment|//snd_cs46xx_peekBA0(chip, BA0_ACCAD);
id|result
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACSDA
op_plus
id|offset
)paren
suffix:semicolon
id|end
suffix:colon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_cs46xx_ac97_read
r_static
r_int
r_int
id|snd_cs46xx_ac97_read
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|ac97-&gt;private_data
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|codec_index
op_assign
id|ac97-&gt;num
suffix:semicolon
id|snd_assert
c_func
(paren
id|codec_index
op_eq
id|CS46XX_PRIMARY_CODEC_INDEX
op_logical_or
id|codec_index
op_eq
id|CS46XX_SECONDARY_CODEC_INDEX
comma
r_return
l_int|0xffff
)paren
suffix:semicolon
id|val
op_assign
id|snd_cs46xx_codec_read
c_func
(paren
id|chip
comma
id|reg
comma
id|codec_index
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
DECL|function|snd_cs46xx_codec_write
r_static
r_void
id|snd_cs46xx_codec_write
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|val
comma
r_int
id|codec_index
)paren
(brace
r_int
id|count
suffix:semicolon
id|snd_assert
(paren
(paren
id|codec_index
op_eq
id|CS46XX_PRIMARY_CODEC_INDEX
)paren
op_logical_or
(paren
id|codec_index
op_eq
id|CS46XX_SECONDARY_CODEC_INDEX
)paren
comma
r_return
)paren
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  1. Write ACCAD = Command Address Register = 46Ch for AC97 register address&n;&t; *  2. Write ACCDA = Command Data Register = 470h    for data to write to AC97&n;&t; *  3. Write ACCTL = Control Register = 460h for initiating the write&n;&t; *  4. Read ACCTL = 460h, DCV should be reset by now and 460h = 07h&n;&t; *  5. if DCV not cleared, break and return error&n;&t; */
multiline_comment|/*&n;&t; *  Setup the AC97 control registers on the CS461x to send the&n;&t; *  appropriate command to the AC97 to perform the read.&n;&t; *  ACCAD = Command Address Register = 46Ch&n;&t; *  ACCDA = Command Data Register = 470h&n;&t; *  ACCTL = Control Register = 460h&n;&t; *  set DCV - will clear when process completed&n;&t; *  reset CRW - Write command&n;&t; *  set VFRM - valid frame enabled&n;&t; *  set ESYN - ASYNC generation enabled&n;&t; *  set RSTN - ARST# inactive, AC97 codec not reset&n;         */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCAD
comma
id|reg
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCDA
comma
id|val
)paren
suffix:semicolon
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|codec_index
op_eq
id|CS46XX_PRIMARY_CODEC_INDEX
)paren
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
multiline_comment|/* clear ACCTL_DCV */
id|ACCTL_VFRM
op_or
id|ACCTL_ESYN
op_or
id|ACCTL_RSTN
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
id|ACCTL_DCV
op_or
id|ACCTL_VFRM
op_or
id|ACCTL_ESYN
op_or
id|ACCTL_RSTN
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
id|ACCTL_DCV
op_or
id|ACCTL_TC
op_or
id|ACCTL_VFRM
op_or
id|ACCTL_ESYN
op_or
id|ACCTL_RSTN
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
l_int|4000
suffix:semicolon
id|count
op_increment
)paren
(brace
multiline_comment|/*&n;&t;&t; *  First, we want to wait for a short time.&n;&t;&t; */
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; *  Now, check to see if the write has completed.&n;&t;&t; *  ACCTL = 460h, DCV should be reset by now and 460h = 07h&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
)paren
op_amp
id|ACCTL_DCV
)paren
)paren
(brace
r_goto
id|end
suffix:semicolon
)brace
)brace
id|snd_printk
c_func
(paren
l_string|&quot;AC&squot;97 write problem, codec_index = %d, reg = 0x%x, val = 0x%x&bslash;n&quot;
comma
id|codec_index
comma
id|reg
comma
id|val
)paren
suffix:semicolon
id|end
suffix:colon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
op_minus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_ac97_write
r_static
r_void
id|snd_cs46xx_ac97_write
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|ac97-&gt;private_data
suffix:semicolon
r_int
id|codec_index
op_assign
id|ac97-&gt;num
suffix:semicolon
id|snd_assert
c_func
(paren
id|codec_index
op_eq
id|CS46XX_PRIMARY_CODEC_INDEX
op_logical_or
id|codec_index
op_eq
id|CS46XX_SECONDARY_CODEC_INDEX
comma
r_return
)paren
suffix:semicolon
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
id|reg
comma
id|val
comma
id|codec_index
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Chip initialization&n; */
DECL|function|snd_cs46xx_download
r_int
id|snd_cs46xx_download
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
id|u32
op_star
id|src
comma
r_int
r_int
id|offset
comma
r_int
r_int
id|len
)paren
(brace
r_void
id|__iomem
op_star
id|dst
suffix:semicolon
r_int
r_int
id|bank
op_assign
id|offset
op_rshift
l_int|16
suffix:semicolon
id|offset
op_assign
id|offset
op_amp
l_int|0xffff
suffix:semicolon
id|snd_assert
c_func
(paren
op_logical_neg
(paren
id|offset
op_amp
l_int|3
)paren
op_logical_and
op_logical_neg
(paren
id|len
op_amp
l_int|3
)paren
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|dst
op_assign
id|chip-&gt;region.idx
(braket
id|bank
op_plus
l_int|1
)braket
dot
id|remap_addr
op_plus
id|offset
suffix:semicolon
id|len
op_div_assign
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
multiline_comment|/* writel already converts 32-bit value to right endianess */
r_while
c_loop
(paren
id|len
op_decrement
OG
l_int|0
)paren
(brace
id|writel
c_func
(paren
op_star
id|src
op_increment
comma
id|dst
)paren
suffix:semicolon
id|dst
op_add_assign
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
macro_line|#include &quot;imgs/cwc4630.h&quot;
macro_line|#include &quot;imgs/cwcasync.h&quot;
macro_line|#include &quot;imgs/cwcsnoop.h&quot;
macro_line|#include &quot;imgs/cwcbinhack.h&quot;
macro_line|#include &quot;imgs/cwcdma.h&quot;
DECL|function|snd_cs46xx_clear_BA1
r_int
id|snd_cs46xx_clear_BA1
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
r_int
id|offset
comma
r_int
r_int
id|len
)paren
(brace
r_void
id|__iomem
op_star
id|dst
suffix:semicolon
r_int
r_int
id|bank
op_assign
id|offset
op_rshift
l_int|16
suffix:semicolon
id|offset
op_assign
id|offset
op_amp
l_int|0xffff
suffix:semicolon
id|snd_assert
c_func
(paren
op_logical_neg
(paren
id|offset
op_amp
l_int|3
)paren
op_logical_and
op_logical_neg
(paren
id|len
op_amp
l_int|3
)paren
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|dst
op_assign
id|chip-&gt;region.idx
(braket
id|bank
op_plus
l_int|1
)braket
dot
id|remap_addr
op_plus
id|offset
suffix:semicolon
id|len
op_div_assign
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
multiline_comment|/* writel already converts 32-bit value to right endianess */
r_while
c_loop
(paren
id|len
op_decrement
OG
l_int|0
)paren
(brace
id|writel
c_func
(paren
l_int|0
comma
id|dst
)paren
suffix:semicolon
id|dst
op_add_assign
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#else /* old DSP image */
macro_line|#include &quot;cs46xx_image.h&quot;
DECL|function|snd_cs46xx_download_image
r_int
id|snd_cs46xx_download_image
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
r_int
id|idx
comma
id|err
suffix:semicolon
r_int
r_int
id|offset
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|BA1_MEMORY_COUNT
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_cs46xx_download
c_func
(paren
id|chip
comma
op_amp
id|BA1Struct.map
(braket
id|offset
)braket
comma
id|BA1Struct.memory
(braket
id|idx
)braket
dot
id|offset
comma
id|BA1Struct.memory
(braket
id|idx
)braket
dot
id|size
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|offset
op_add_assign
id|BA1Struct.memory
(braket
id|idx
)braket
dot
id|size
op_rshift
l_int|2
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_SND_CS46XX_NEW_DSP */
multiline_comment|/*&n; *  Chip reset&n; */
DECL|function|snd_cs46xx_reset
r_static
r_void
id|snd_cs46xx_reset
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
r_int
id|idx
suffix:semicolon
multiline_comment|/*&n;&t; *  Write the reset bit of the SP control register.&n;&t; */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_SPCR
comma
id|SPCR_RSTSP
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Write the control register.&n;&t; */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_SPCR
comma
id|SPCR_DRQEN
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Clear the trap registers.&n;&t; */
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|8
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_DREG
comma
id|DREG_REGID_TRAP_SELECT
op_plus
id|idx
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_TWPR
comma
l_int|0xFFFF
)paren
suffix:semicolon
)brace
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_DREG
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Set the frame timer to reflect the number of cycles per frame.&n;&t; */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_FRMT
comma
l_int|0xadf
)paren
suffix:semicolon
)brace
DECL|function|cs46xx_wait_for_fifo
r_static
r_int
id|cs46xx_wait_for_fifo
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
id|retry_timeout
)paren
(brace
id|u32
id|i
comma
id|status
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Make sure the previous FIFO write operation has completed.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|50
suffix:semicolon
id|i
op_increment
)paren
(brace
id|status
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_SERBST
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
id|SERBST_WBSY
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
id|mdelay
c_func
(paren
id|retry_timeout
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|SERBST_WBSY
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cs46xx: failure waiting for FIFO command to complete&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_clear_serial_FIFOs
r_static
r_void
id|snd_cs46xx_clear_serial_FIFOs
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
r_int
id|idx
comma
id|powerdown
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
multiline_comment|/*&n;&t; *  See if the devices are powered down.  If so, we must power them up first&n;&t; *  or they will not respond.&n;&t; */
id|tmp
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tmp
op_amp
id|CLKCR1_SWCE
)paren
)paren
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
id|tmp
op_or
id|CLKCR1_SWCE
)paren
suffix:semicolon
id|powerdown
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *  We want to clear out the serial port FIFOs so we don&squot;t end up playing&n;&t; *  whatever random garbage happens to be in them.  We fill the sample FIFOS&n;&t; *  with zero (silence).&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERBWP
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Fill all 256 sample FIFO locations.&n;&t; */
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|0xFF
suffix:semicolon
id|idx
op_increment
)paren
(brace
multiline_comment|/*&n;&t;&t; *  Make sure the previous FIFO write operation has completed.&n;&t;&t; */
r_if
c_cond
(paren
id|cs46xx_wait_for_fifo
c_func
(paren
id|chip
comma
l_int|1
)paren
)paren
(brace
id|snd_printdd
(paren
l_string|&quot;failed waiting for FIFO at addr (%02X)&bslash;n&quot;
comma
id|idx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|powerdown
)paren
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
id|tmp
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; *  Write the serial port FIFO index.&n;&t;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERBAD
comma
id|idx
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; *  Tell the serial port to load the new value into the FIFO location.&n;&t;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERBCM
comma
id|SERBCM_WRC
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *  Now, if we powered up the devices, then power them back down again.&n;&t; *  This is kinda ugly, but should never happen.&n;&t; */
r_if
c_cond
(paren
id|powerdown
)paren
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
id|tmp
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_proc_start
r_static
r_void
id|snd_cs46xx_proc_start
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
r_int
id|cnt
suffix:semicolon
multiline_comment|/*&n;&t; *  Set the frame timer to reflect the number of cycles per frame.&n;&t; */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_FRMT
comma
l_int|0xadf
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Turn on the run, run at frame, and DMA enable bits in the local copy of&n;&t; *  the SP control register.&n;&t; */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_SPCR
comma
id|SPCR_RUN
op_or
id|SPCR_RUNFR
op_or
id|SPCR_DRQEN
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Wait until the run at frame bit resets itself in the SP control&n;&t; *  register.&n;&t; */
r_for
c_loop
(paren
id|cnt
op_assign
l_int|0
suffix:semicolon
id|cnt
OL
l_int|25
suffix:semicolon
id|cnt
op_increment
)paren
(brace
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_SPCR
)paren
op_amp
id|SPCR_RUNFR
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_SPCR
)paren
op_amp
id|SPCR_RUNFR
)paren
id|snd_printk
c_func
(paren
l_string|&quot;SPCR_RUNFR never reset&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_proc_stop
r_static
r_void
id|snd_cs46xx_proc_stop
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
multiline_comment|/*&n;&t; *  Turn off the run, run at frame, and DMA enable bits in the local copy of&n;&t; *  the SP control register.&n;&t; */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_SPCR
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Sample rate routines&n; */
DECL|macro|GOF_PER_SEC
mdefine_line|#define GOF_PER_SEC 200
DECL|function|snd_cs46xx_set_play_sample_rate
r_static
r_void
id|snd_cs46xx_set_play_sample_rate
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
r_int
id|rate
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|tmp1
comma
id|tmp2
suffix:semicolon
r_int
r_int
id|phiIncr
suffix:semicolon
r_int
r_int
id|correctionPerGOF
comma
id|correctionPerSec
suffix:semicolon
multiline_comment|/*&n;&t; *  Compute the values used to drive the actual sample rate conversion.&n;&t; *  The following formulas are being computed, using inline assembly&n;&t; *  since we need to use 64 bit arithmetic to compute the values:&n;&t; *&n;&t; *  phiIncr = floor((Fs,in * 2^26) / Fs,out)&n;&t; *  correctionPerGOF = floor((Fs,in * 2^26 - Fs,out * phiIncr) /&n;         *                                   GOF_PER_SEC)&n;         *  ulCorrectionPerSec = Fs,in * 2^26 - Fs,out * phiIncr -M&n;         *                       GOF_PER_SEC * correctionPerGOF&n;&t; *&n;&t; *  i.e.&n;&t; *&n;&t; *  phiIncr:other = dividend:remainder((Fs,in * 2^26) / Fs,out)&n;&t; *  correctionPerGOF:correctionPerSec =&n;&t; *      dividend:remainder(ulOther / GOF_PER_SEC)&n;&t; */
id|tmp1
op_assign
id|rate
op_lshift
l_int|16
suffix:semicolon
id|phiIncr
op_assign
id|tmp1
op_div
l_int|48000
suffix:semicolon
id|tmp1
op_sub_assign
id|phiIncr
op_star
l_int|48000
suffix:semicolon
id|tmp1
op_lshift_assign
l_int|10
suffix:semicolon
id|phiIncr
op_lshift_assign
l_int|10
suffix:semicolon
id|tmp2
op_assign
id|tmp1
op_div
l_int|48000
suffix:semicolon
id|phiIncr
op_add_assign
id|tmp2
suffix:semicolon
id|tmp1
op_sub_assign
id|tmp2
op_star
l_int|48000
suffix:semicolon
id|correctionPerGOF
op_assign
id|tmp1
op_div
id|GOF_PER_SEC
suffix:semicolon
id|tmp1
op_sub_assign
id|correctionPerGOF
op_star
id|GOF_PER_SEC
suffix:semicolon
id|correctionPerSec
op_assign
id|tmp1
suffix:semicolon
multiline_comment|/*&n;&t; *  Fill in the SampleRateConverter control block.&n;&t; */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PSRC
comma
(paren
(paren
id|correctionPerSec
op_lshift
l_int|16
)paren
op_amp
l_int|0xFFFF0000
)paren
op_or
(paren
id|correctionPerGOF
op_amp
l_int|0xFFFF
)paren
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PPI
comma
id|phiIncr
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_set_capture_sample_rate
r_static
r_void
id|snd_cs46xx_set_capture_sample_rate
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
r_int
id|rate
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|phiIncr
comma
id|coeffIncr
comma
id|tmp1
comma
id|tmp2
suffix:semicolon
r_int
r_int
id|correctionPerGOF
comma
id|correctionPerSec
comma
id|initialDelay
suffix:semicolon
r_int
r_int
id|frameGroupLength
comma
id|cnt
suffix:semicolon
multiline_comment|/*&n;&t; *  We can only decimate by up to a factor of 1/9th the hardware rate.&n;&t; *  Correct the value if an attempt is made to stray outside that limit.&n;&t; */
r_if
c_cond
(paren
(paren
id|rate
op_star
l_int|9
)paren
OL
l_int|48000
)paren
id|rate
op_assign
l_int|48000
op_div
l_int|9
suffix:semicolon
multiline_comment|/*&n;&t; *  We can not capture at at rate greater than the Input Rate (48000).&n;&t; *  Return an error if an attempt is made to stray outside that limit.&n;&t; */
r_if
c_cond
(paren
id|rate
OG
l_int|48000
)paren
id|rate
op_assign
l_int|48000
suffix:semicolon
multiline_comment|/*&n;&t; *  Compute the values used to drive the actual sample rate conversion.&n;&t; *  The following formulas are being computed, using inline assembly&n;&t; *  since we need to use 64 bit arithmetic to compute the values:&n;&t; *&n;&t; *     coeffIncr = -floor((Fs,out * 2^23) / Fs,in)&n;&t; *     phiIncr = floor((Fs,in * 2^26) / Fs,out)&n;&t; *     correctionPerGOF = floor((Fs,in * 2^26 - Fs,out * phiIncr) /&n;&t; *                                GOF_PER_SEC)&n;&t; *     correctionPerSec = Fs,in * 2^26 - Fs,out * phiIncr -&n;&t; *                          GOF_PER_SEC * correctionPerGOF&n;&t; *     initialDelay = ceil((24 * Fs,in) / Fs,out)&n;&t; *&n;&t; * i.e.&n;&t; *&n;&t; *     coeffIncr = neg(dividend((Fs,out * 2^23) / Fs,in))&n;&t; *     phiIncr:ulOther = dividend:remainder((Fs,in * 2^26) / Fs,out)&n;&t; *     correctionPerGOF:correctionPerSec =&n;&t; * &t;    dividend:remainder(ulOther / GOF_PER_SEC)&n;&t; *     initialDelay = dividend(((24 * Fs,in) + Fs,out - 1) / Fs,out)&n;&t; */
id|tmp1
op_assign
id|rate
op_lshift
l_int|16
suffix:semicolon
id|coeffIncr
op_assign
id|tmp1
op_div
l_int|48000
suffix:semicolon
id|tmp1
op_sub_assign
id|coeffIncr
op_star
l_int|48000
suffix:semicolon
id|tmp1
op_lshift_assign
l_int|7
suffix:semicolon
id|coeffIncr
op_lshift_assign
l_int|7
suffix:semicolon
id|coeffIncr
op_add_assign
id|tmp1
op_div
l_int|48000
suffix:semicolon
id|coeffIncr
op_xor_assign
l_int|0xFFFFFFFF
suffix:semicolon
id|coeffIncr
op_increment
suffix:semicolon
id|tmp1
op_assign
l_int|48000
op_lshift
l_int|16
suffix:semicolon
id|phiIncr
op_assign
id|tmp1
op_div
id|rate
suffix:semicolon
id|tmp1
op_sub_assign
id|phiIncr
op_star
id|rate
suffix:semicolon
id|tmp1
op_lshift_assign
l_int|10
suffix:semicolon
id|phiIncr
op_lshift_assign
l_int|10
suffix:semicolon
id|tmp2
op_assign
id|tmp1
op_div
id|rate
suffix:semicolon
id|phiIncr
op_add_assign
id|tmp2
suffix:semicolon
id|tmp1
op_sub_assign
id|tmp2
op_star
id|rate
suffix:semicolon
id|correctionPerGOF
op_assign
id|tmp1
op_div
id|GOF_PER_SEC
suffix:semicolon
id|tmp1
op_sub_assign
id|correctionPerGOF
op_star
id|GOF_PER_SEC
suffix:semicolon
id|correctionPerSec
op_assign
id|tmp1
suffix:semicolon
id|initialDelay
op_assign
(paren
(paren
l_int|48000
op_star
l_int|24
)paren
op_plus
id|rate
op_minus
l_int|1
)paren
op_div
id|rate
suffix:semicolon
multiline_comment|/*&n;&t; *  Fill in the VariDecimate control block.&n;&t; */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CSRC
comma
(paren
(paren
id|correctionPerSec
op_lshift
l_int|16
)paren
op_amp
l_int|0xFFFF0000
)paren
op_or
(paren
id|correctionPerGOF
op_amp
l_int|0xFFFF
)paren
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CCI
comma
id|coeffIncr
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CD
comma
(paren
(paren
(paren
id|BA1_VARIDEC_BUF_1
op_plus
(paren
id|initialDelay
op_lshift
l_int|2
)paren
)paren
op_lshift
l_int|16
)paren
op_amp
l_int|0xFFFF0000
)paren
op_or
l_int|0x80
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CPI
comma
id|phiIncr
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Figure out the frame group length for the write back task.  Basically,&n;&t; *  this is just the factors of 24000 (2^6*3*5^3) that are not present in&n;&t; *  the output sample rate.&n;&t; */
id|frameGroupLength
op_assign
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|2
suffix:semicolon
id|cnt
op_le
l_int|64
suffix:semicolon
id|cnt
op_mul_assign
l_int|2
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|rate
op_div
id|cnt
)paren
op_star
id|cnt
)paren
op_ne
id|rate
)paren
id|frameGroupLength
op_mul_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|rate
op_div
l_int|3
)paren
op_star
l_int|3
)paren
op_ne
id|rate
)paren
(brace
id|frameGroupLength
op_mul_assign
l_int|3
suffix:semicolon
)brace
r_for
c_loop
(paren
id|cnt
op_assign
l_int|5
suffix:semicolon
id|cnt
op_le
l_int|125
suffix:semicolon
id|cnt
op_mul_assign
l_int|5
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|rate
op_div
id|cnt
)paren
op_star
id|cnt
)paren
op_ne
id|rate
)paren
id|frameGroupLength
op_mul_assign
l_int|5
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Fill in the WriteBack control block.&n;&t; */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CFG1
comma
id|frameGroupLength
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CFG2
comma
(paren
l_int|0x00800000
op_or
id|frameGroupLength
)paren
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CCST
comma
l_int|0x0000FFFF
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CSPB
comma
(paren
(paren
l_int|65536
op_star
id|rate
)paren
op_div
l_int|24000
)paren
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
(paren
id|BA1_CSPB
op_plus
l_int|4
)paren
comma
l_int|0x0000FFFF
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  PCM part&n; */
DECL|function|snd_cs46xx_pb_trans_copy
r_static
r_void
id|snd_cs46xx_pb_trans_copy
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_indirect_t
op_star
id|rec
comma
r_int
id|bytes
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|cs46xx_pcm_t
op_star
id|cpcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
id|memcpy
c_func
(paren
id|cpcm-&gt;hw_buf.area
op_plus
id|rec-&gt;hw_data
comma
id|runtime-&gt;dma_area
op_plus
id|rec-&gt;sw_data
comma
id|bytes
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_playback_transfer
r_static
r_int
id|snd_cs46xx_playback_transfer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|cs46xx_pcm_t
op_star
id|cpcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
id|snd_pcm_indirect_playback_transfer
c_func
(paren
id|substream
comma
op_amp
id|cpcm-&gt;pcm_rec
comma
id|snd_cs46xx_pb_trans_copy
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_cp_trans_copy
r_static
r_void
id|snd_cs46xx_cp_trans_copy
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_indirect_t
op_star
id|rec
comma
r_int
id|bytes
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|memcpy
c_func
(paren
id|runtime-&gt;dma_area
op_plus
id|rec-&gt;sw_data
comma
id|chip-&gt;capt.hw_buf.area
op_plus
id|rec-&gt;hw_data
comma
id|bytes
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_capture_transfer
r_static
r_int
id|snd_cs46xx_capture_transfer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_indirect_capture_transfer
c_func
(paren
id|substream
comma
op_amp
id|chip-&gt;capt.pcm_rec
comma
id|snd_cs46xx_cp_trans_copy
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_playback_direct_pointer
r_static
id|snd_pcm_uframes_t
id|snd_cs46xx_playback_direct_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
suffix:semicolon
id|cs46xx_pcm_t
op_star
id|cpcm
op_assign
id|substream-&gt;runtime-&gt;private_data
suffix:semicolon
id|snd_assert
(paren
id|cpcm-&gt;pcm_channel
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|ptr
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
(paren
id|cpcm-&gt;pcm_channel-&gt;pcm_reader_scb-&gt;address
op_plus
l_int|2
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
macro_line|#else
id|ptr
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_PBA
)paren
suffix:semicolon
macro_line|#endif
id|ptr
op_sub_assign
id|cpcm-&gt;hw_buf.addr
suffix:semicolon
r_return
id|ptr
op_rshift
id|cpcm-&gt;shift
suffix:semicolon
)brace
DECL|function|snd_cs46xx_playback_indirect_pointer
r_static
id|snd_pcm_uframes_t
id|snd_cs46xx_playback_indirect_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
suffix:semicolon
id|cs46xx_pcm_t
op_star
id|cpcm
op_assign
id|substream-&gt;runtime-&gt;private_data
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|snd_assert
(paren
id|cpcm-&gt;pcm_channel
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|ptr
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
(paren
id|cpcm-&gt;pcm_channel-&gt;pcm_reader_scb-&gt;address
op_plus
l_int|2
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
macro_line|#else
id|ptr
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_PBA
)paren
suffix:semicolon
macro_line|#endif
id|ptr
op_sub_assign
id|cpcm-&gt;hw_buf.addr
suffix:semicolon
r_return
id|snd_pcm_indirect_playback_pointer
c_func
(paren
id|substream
comma
op_amp
id|cpcm-&gt;pcm_rec
comma
id|ptr
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_capture_direct_pointer
r_static
id|snd_pcm_uframes_t
id|snd_cs46xx_capture_direct_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_CBA
)paren
op_minus
id|chip-&gt;capt.hw_buf.addr
suffix:semicolon
r_return
id|ptr
op_rshift
id|chip-&gt;capt.shift
suffix:semicolon
)brace
DECL|function|snd_cs46xx_capture_indirect_pointer
r_static
id|snd_pcm_uframes_t
id|snd_cs46xx_capture_indirect_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_CBA
)paren
op_minus
id|chip-&gt;capt.hw_buf.addr
suffix:semicolon
r_return
id|snd_pcm_indirect_capture_pointer
c_func
(paren
id|substream
comma
op_amp
id|chip-&gt;capt.pcm_rec
comma
id|ptr
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_playback_trigger
r_static
r_int
id|snd_cs46xx_playback_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
multiline_comment|/*snd_pcm_runtime_t *runtime = substream-&gt;runtime;*/
r_int
id|result
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|cs46xx_pcm_t
op_star
id|cpcm
op_assign
id|substream-&gt;runtime-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpcm-&gt;pcm_channel
)paren
(brace
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
macro_line|#endif
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_RESUME
suffix:colon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
multiline_comment|/* magic value to unmute PCM stream  playback volume */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
(paren
id|cpcm-&gt;pcm_channel-&gt;pcm_reader_scb-&gt;address
op_plus
id|SCBVolumeCtrl
)paren
op_lshift
l_int|2
comma
l_int|0x80008000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpcm-&gt;pcm_channel-&gt;unlinked
)paren
id|cs46xx_dsp_pcm_link
c_func
(paren
id|chip
comma
id|cpcm-&gt;pcm_channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|substream-&gt;runtime-&gt;periods
op_ne
id|CS46XX_FRAGS
)paren
id|snd_cs46xx_playback_transfer
c_func
(paren
id|substream
)paren
suffix:semicolon
macro_line|#else
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|substream-&gt;runtime-&gt;periods
op_ne
id|CS46XX_FRAGS
)paren
id|snd_cs46xx_playback_transfer
c_func
(paren
id|substream
)paren
suffix:semicolon
(brace
r_int
r_int
id|tmp
suffix:semicolon
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_PCTL
)paren
suffix:semicolon
id|tmp
op_and_assign
l_int|0x0000ffff
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PCTL
comma
id|chip-&gt;play_ctl
op_or
id|tmp
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_SUSPEND
suffix:colon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
multiline_comment|/* magic mute channel */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
(paren
id|cpcm-&gt;pcm_channel-&gt;pcm_reader_scb-&gt;address
op_plus
id|SCBVolumeCtrl
)paren
op_lshift
l_int|2
comma
l_int|0xffffffff
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpcm-&gt;pcm_channel-&gt;unlinked
)paren
id|cs46xx_dsp_pcm_unlink
c_func
(paren
id|chip
comma
id|cpcm-&gt;pcm_channel
)paren
suffix:semicolon
macro_line|#else
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
(brace
r_int
r_int
id|tmp
suffix:semicolon
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_PCTL
)paren
suffix:semicolon
id|tmp
op_and_assign
l_int|0x0000ffff
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PCTL
comma
id|tmp
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_default
suffix:colon
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_cs46xx_capture_trigger
r_static
r_int
id|snd_cs46xx_capture_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_RESUME
suffix:colon
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_CCTL
)paren
suffix:semicolon
id|tmp
op_and_assign
l_int|0xffff0000
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CCTL
comma
id|chip-&gt;capt.ctl
op_or
id|tmp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_SUSPEND
suffix:colon
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_CCTL
)paren
suffix:semicolon
id|tmp
op_and_assign
l_int|0xffff0000
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CCTL
comma
id|tmp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
DECL|function|_cs46xx_adjust_sample_rate
r_static
r_int
id|_cs46xx_adjust_sample_rate
(paren
id|cs46xx_t
op_star
id|chip
comma
id|cs46xx_pcm_t
op_star
id|cpcm
comma
r_int
id|sample_rate
)paren
(brace
multiline_comment|/* If PCMReaderSCB and SrcTaskSCB not created yet ... */
r_if
c_cond
(paren
id|cpcm-&gt;pcm_channel
op_eq
l_int|NULL
)paren
(brace
id|cpcm-&gt;pcm_channel
op_assign
id|cs46xx_dsp_create_pcm_channel
(paren
id|chip
comma
id|sample_rate
comma
id|cpcm
comma
id|cpcm-&gt;hw_buf.addr
comma
id|cpcm-&gt;pcm_channel_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpcm-&gt;pcm_channel
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cs46xx: failed to create virtual PCM channel&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|cpcm-&gt;pcm_channel-&gt;sample_rate
op_assign
id|sample_rate
suffix:semicolon
)brace
r_else
multiline_comment|/* if sample rate is changed */
r_if
c_cond
(paren
(paren
r_int
)paren
id|cpcm-&gt;pcm_channel-&gt;sample_rate
op_ne
id|sample_rate
)paren
(brace
r_int
id|unlinked
op_assign
id|cpcm-&gt;pcm_channel-&gt;unlinked
suffix:semicolon
id|cs46xx_dsp_destroy_pcm_channel
(paren
id|chip
comma
id|cpcm-&gt;pcm_channel
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cpcm-&gt;pcm_channel
op_assign
id|cs46xx_dsp_create_pcm_channel
(paren
id|chip
comma
id|sample_rate
comma
id|cpcm
comma
id|cpcm-&gt;hw_buf.addr
comma
id|cpcm-&gt;pcm_channel_id
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cs46xx: failed to re-create virtual PCM channel&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|unlinked
)paren
id|cs46xx_dsp_pcm_link
(paren
id|chip
comma
id|cpcm-&gt;pcm_channel
)paren
suffix:semicolon
id|cpcm-&gt;pcm_channel-&gt;sample_rate
op_assign
id|sample_rate
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|function|snd_cs46xx_playback_hw_params
r_static
r_int
id|snd_cs46xx_playback_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|cs46xx_pcm_t
op_star
id|cpcm
suffix:semicolon
r_int
id|err
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|sample_rate
op_assign
id|params_rate
c_func
(paren
id|hw_params
)paren
suffix:semicolon
r_int
id|period_size
op_assign
id|params_period_bytes
c_func
(paren
id|hw_params
)paren
suffix:semicolon
macro_line|#endif
id|cpcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|snd_assert
(paren
id|sample_rate
op_ne
l_int|0
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|down
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|_cs46xx_adjust_sample_rate
(paren
id|chip
comma
id|cpcm
comma
id|sample_rate
)paren
)paren
(brace
id|up
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
id|snd_assert
(paren
id|cpcm-&gt;pcm_channel
op_ne
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpcm-&gt;pcm_channel
)paren
(brace
id|up
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs46xx_dsp_pcm_channel_set_period
(paren
id|chip
comma
id|cpcm-&gt;pcm_channel
comma
id|period_size
)paren
)paren
(brace
id|up
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|snd_printdd
(paren
l_string|&quot;period_size (%d), periods (%d) buffer_size(%d)&bslash;n&quot;
comma
id|period_size
comma
id|params_periods
c_func
(paren
id|hw_params
)paren
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|params_periods
c_func
(paren
id|hw_params
)paren
op_eq
id|CS46XX_FRAGS
)paren
(brace
r_if
c_cond
(paren
id|runtime-&gt;dma_area
op_ne
id|cpcm-&gt;hw_buf.area
)paren
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
id|runtime-&gt;dma_area
op_assign
id|cpcm-&gt;hw_buf.area
suffix:semicolon
id|runtime-&gt;dma_addr
op_assign
id|cpcm-&gt;hw_buf.addr
suffix:semicolon
id|runtime-&gt;dma_bytes
op_assign
id|cpcm-&gt;hw_buf.bytes
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
r_if
c_cond
(paren
id|cpcm-&gt;pcm_channel_id
op_eq
id|DSP_PCM_MAIN_CHANNEL
)paren
(brace
id|substream-&gt;ops
op_assign
op_amp
id|snd_cs46xx_playback_ops
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cpcm-&gt;pcm_channel_id
op_eq
id|DSP_PCM_REAR_CHANNEL
)paren
(brace
id|substream-&gt;ops
op_assign
op_amp
id|snd_cs46xx_playback_rear_ops
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cpcm-&gt;pcm_channel_id
op_eq
id|DSP_PCM_CENTER_LFE_CHANNEL
)paren
(brace
id|substream-&gt;ops
op_assign
op_amp
id|snd_cs46xx_playback_clfe_ops
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cpcm-&gt;pcm_channel_id
op_eq
id|DSP_IEC958_CHANNEL
)paren
(brace
id|substream-&gt;ops
op_assign
op_amp
id|snd_cs46xx_playback_iec958_ops
suffix:semicolon
)brace
r_else
(brace
id|snd_assert
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#else
id|substream-&gt;ops
op_assign
op_amp
id|snd_cs46xx_playback_ops
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
r_if
c_cond
(paren
id|runtime-&gt;dma_area
op_eq
id|cpcm-&gt;hw_buf.area
)paren
(brace
id|runtime-&gt;dma_area
op_assign
l_int|NULL
suffix:semicolon
id|runtime-&gt;dma_addr
op_assign
l_int|0
suffix:semicolon
id|runtime-&gt;dma_bytes
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
)paren
OL
l_int|0
)paren
(brace
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|up
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
macro_line|#endif
r_return
id|err
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
r_if
c_cond
(paren
id|cpcm-&gt;pcm_channel_id
op_eq
id|DSP_PCM_MAIN_CHANNEL
)paren
(brace
id|substream-&gt;ops
op_assign
op_amp
id|snd_cs46xx_playback_indirect_ops
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cpcm-&gt;pcm_channel_id
op_eq
id|DSP_PCM_REAR_CHANNEL
)paren
(brace
id|substream-&gt;ops
op_assign
op_amp
id|snd_cs46xx_playback_indirect_rear_ops
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cpcm-&gt;pcm_channel_id
op_eq
id|DSP_PCM_CENTER_LFE_CHANNEL
)paren
(brace
id|substream-&gt;ops
op_assign
op_amp
id|snd_cs46xx_playback_indirect_clfe_ops
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cpcm-&gt;pcm_channel_id
op_eq
id|DSP_IEC958_CHANNEL
)paren
(brace
id|substream-&gt;ops
op_assign
op_amp
id|snd_cs46xx_playback_indirect_iec958_ops
suffix:semicolon
)brace
r_else
(brace
id|snd_assert
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#else
id|substream-&gt;ops
op_assign
op_amp
id|snd_cs46xx_playback_indirect_ops
suffix:semicolon
macro_line|#endif
)brace
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|up
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_playback_hw_free
r_static
r_int
id|snd_cs46xx_playback_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
multiline_comment|/*cs46xx_t *chip = snd_pcm_substream_chip(substream);*/
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|cs46xx_pcm_t
op_star
id|cpcm
suffix:semicolon
id|cpcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
multiline_comment|/* if play_back open fails, then this function&n;&t;   is called and cpcm can actually be NULL here */
r_if
c_cond
(paren
op_logical_neg
id|cpcm
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;dma_area
op_ne
id|cpcm-&gt;hw_buf.area
)paren
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
id|runtime-&gt;dma_area
op_assign
l_int|NULL
suffix:semicolon
id|runtime-&gt;dma_addr
op_assign
l_int|0
suffix:semicolon
id|runtime-&gt;dma_bytes
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_playback_prepare
r_static
r_int
id|snd_cs46xx_playback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
r_int
r_int
id|pfie
suffix:semicolon
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|cs46xx_pcm_t
op_star
id|cpcm
suffix:semicolon
id|cpcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|snd_assert
(paren
id|cpcm-&gt;pcm_channel
op_ne
l_int|NULL
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|pfie
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
(paren
id|cpcm-&gt;pcm_channel-&gt;pcm_reader_scb-&gt;address
op_plus
l_int|1
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
id|pfie
op_and_assign
op_complement
l_int|0x0000f03f
suffix:semicolon
macro_line|#else
multiline_comment|/* old dsp */
id|pfie
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_PFIE
)paren
suffix:semicolon
id|pfie
op_and_assign
op_complement
l_int|0x0000f03f
suffix:semicolon
macro_line|#endif
id|cpcm-&gt;shift
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* if to convert from stereo to mono */
r_if
c_cond
(paren
id|runtime-&gt;channels
op_eq
l_int|1
)paren
(brace
id|cpcm-&gt;shift
op_decrement
suffix:semicolon
id|pfie
op_or_assign
l_int|0x00002000
suffix:semicolon
)brace
multiline_comment|/* if to convert from 8 bit to 16 bit */
r_if
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|8
)paren
(brace
id|cpcm-&gt;shift
op_decrement
suffix:semicolon
id|pfie
op_or_assign
l_int|0x00001000
suffix:semicolon
)brace
multiline_comment|/* if to convert to unsigned */
r_if
c_cond
(paren
id|snd_pcm_format_unsigned
c_func
(paren
id|runtime-&gt;format
)paren
)paren
id|pfie
op_or_assign
l_int|0x00008000
suffix:semicolon
multiline_comment|/* Never convert byte order when sample stream is 8 bit */
r_if
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_ne
l_int|8
)paren
(brace
multiline_comment|/* convert from big endian to little endian */
r_if
c_cond
(paren
id|snd_pcm_format_big_endian
c_func
(paren
id|runtime-&gt;format
)paren
)paren
id|pfie
op_or_assign
l_int|0x00004000
suffix:semicolon
)brace
id|memset
c_func
(paren
op_amp
id|cpcm-&gt;pcm_rec
comma
l_int|0
comma
r_sizeof
(paren
id|cpcm-&gt;pcm_rec
)paren
)paren
suffix:semicolon
id|cpcm-&gt;pcm_rec.sw_buffer_size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|cpcm-&gt;pcm_rec.hw_buffer_size
op_assign
id|runtime-&gt;period_size
op_star
id|CS46XX_FRAGS
op_lshift
id|cpcm-&gt;shift
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
(paren
id|cpcm-&gt;pcm_channel-&gt;pcm_reader_scb-&gt;address
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
l_int|0x000003ff
suffix:semicolon
id|tmp
op_or_assign
(paren
l_int|4
op_lshift
id|cpcm-&gt;shift
)paren
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* playback transaction count register */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
(paren
id|cpcm-&gt;pcm_channel-&gt;pcm_reader_scb-&gt;address
)paren
op_lshift
l_int|2
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* playback format &amp;&amp; interrupt enable */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
(paren
id|cpcm-&gt;pcm_channel-&gt;pcm_reader_scb-&gt;address
op_plus
l_int|1
)paren
op_lshift
l_int|2
comma
id|pfie
op_or
id|cpcm-&gt;pcm_channel-&gt;pcm_slot
)paren
suffix:semicolon
macro_line|#else
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PBA
comma
id|cpcm-&gt;hw_buf.addr
)paren
suffix:semicolon
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_PDTC
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
l_int|0x000003ff
suffix:semicolon
id|tmp
op_or_assign
(paren
l_int|4
op_lshift
id|cpcm-&gt;shift
)paren
op_minus
l_int|1
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PDTC
comma
id|tmp
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PFIE
comma
id|pfie
)paren
suffix:semicolon
id|snd_cs46xx_set_play_sample_rate
c_func
(paren
id|chip
comma
id|runtime-&gt;rate
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_capture_hw_params
r_static
r_int
id|snd_cs46xx_capture_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|cs46xx_dsp_pcm_ostream_set_period
(paren
id|chip
comma
id|params_period_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|runtime-&gt;periods
op_eq
id|CS46XX_FRAGS
)paren
(brace
r_if
c_cond
(paren
id|runtime-&gt;dma_area
op_ne
id|chip-&gt;capt.hw_buf.area
)paren
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
id|runtime-&gt;dma_area
op_assign
id|chip-&gt;capt.hw_buf.area
suffix:semicolon
id|runtime-&gt;dma_addr
op_assign
id|chip-&gt;capt.hw_buf.addr
suffix:semicolon
id|runtime-&gt;dma_bytes
op_assign
id|chip-&gt;capt.hw_buf.bytes
suffix:semicolon
id|substream-&gt;ops
op_assign
op_amp
id|snd_cs46xx_capture_ops
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|runtime-&gt;dma_area
op_eq
id|chip-&gt;capt.hw_buf.area
)paren
(brace
id|runtime-&gt;dma_area
op_assign
l_int|NULL
suffix:semicolon
id|runtime-&gt;dma_addr
op_assign
l_int|0
suffix:semicolon
id|runtime-&gt;dma_bytes
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|substream-&gt;ops
op_assign
op_amp
id|snd_cs46xx_capture_indirect_ops
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_capture_hw_free
r_static
r_int
id|snd_cs46xx_capture_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;dma_area
op_ne
id|chip-&gt;capt.hw_buf.area
)paren
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
id|runtime-&gt;dma_area
op_assign
l_int|NULL
suffix:semicolon
id|runtime-&gt;dma_addr
op_assign
l_int|0
suffix:semicolon
id|runtime-&gt;dma_bytes
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_capture_prepare
r_static
r_int
id|snd_cs46xx_capture_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CBA
comma
id|chip-&gt;capt.hw_buf.addr
)paren
suffix:semicolon
id|chip-&gt;capt.shift
op_assign
l_int|2
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|chip-&gt;capt.pcm_rec
comma
l_int|0
comma
r_sizeof
(paren
id|chip-&gt;capt.pcm_rec
)paren
)paren
suffix:semicolon
id|chip-&gt;capt.pcm_rec.sw_buffer_size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;capt.pcm_rec.hw_buffer_size
op_assign
id|runtime-&gt;period_size
op_star
id|CS46XX_FRAGS
op_lshift
l_int|2
suffix:semicolon
id|snd_cs46xx_set_capture_sample_rate
c_func
(paren
id|chip
comma
id|runtime-&gt;rate
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_interrupt
r_static
id|irqreturn_t
id|snd_cs46xx_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|dev_id
suffix:semicolon
id|u32
id|status1
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|u32
id|status2
suffix:semicolon
r_int
id|i
suffix:semicolon
id|cs46xx_pcm_t
op_star
id|cpcm
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; *  Read the Interrupt Status Register to clear the interrupt&n;&t; */
id|status1
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_HISR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status1
op_amp
l_int|0x7fffffff
)paren
op_eq
l_int|0
)paren
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_HICR
comma
id|HICR_CHGM
op_or
id|HICR_IEV
)paren
suffix:semicolon
r_return
id|IRQ_NONE
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|status2
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_HSR0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DSP_MAX_PCM_CHANNELS
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|i
op_le
l_int|15
)paren
(brace
r_if
c_cond
(paren
id|status1
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
(brace
r_if
c_cond
(paren
id|i
op_eq
id|CS46XX_DSP_CAPTURE_CHANNEL
)paren
(brace
r_if
c_cond
(paren
id|chip-&gt;capt.substream
)paren
id|snd_pcm_period_elapsed
c_func
(paren
id|chip-&gt;capt.substream
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ins-&gt;pcm_channels
(braket
id|i
)braket
dot
id|active
op_logical_and
id|ins-&gt;pcm_channels
(braket
id|i
)braket
dot
id|private_data
op_logical_and
op_logical_neg
id|ins-&gt;pcm_channels
(braket
id|i
)braket
dot
id|unlinked
)paren
(brace
id|cpcm
op_assign
id|ins-&gt;pcm_channels
(braket
id|i
)braket
dot
id|private_data
suffix:semicolon
id|snd_pcm_period_elapsed
c_func
(paren
id|cpcm-&gt;substream
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|status2
op_amp
(paren
l_int|1
op_lshift
(paren
id|i
op_minus
l_int|16
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|ins-&gt;pcm_channels
(braket
id|i
)braket
dot
id|active
op_logical_and
id|ins-&gt;pcm_channels
(braket
id|i
)braket
dot
id|private_data
op_logical_and
op_logical_neg
id|ins-&gt;pcm_channels
(braket
id|i
)braket
dot
id|unlinked
)paren
(brace
id|cpcm
op_assign
id|ins-&gt;pcm_channels
(braket
id|i
)braket
dot
id|private_data
suffix:semicolon
id|snd_pcm_period_elapsed
c_func
(paren
id|cpcm-&gt;substream
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
macro_line|#else
multiline_comment|/* old dsp */
r_if
c_cond
(paren
(paren
id|status1
op_amp
id|HISR_VC0
)paren
op_logical_and
id|chip-&gt;playback_pcm
)paren
(brace
r_if
c_cond
(paren
id|chip-&gt;playback_pcm-&gt;substream
)paren
id|snd_pcm_period_elapsed
c_func
(paren
id|chip-&gt;playback_pcm-&gt;substream
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|status1
op_amp
id|HISR_VC1
)paren
op_logical_and
id|chip-&gt;pcm
)paren
(brace
r_if
c_cond
(paren
id|chip-&gt;capt.substream
)paren
id|snd_pcm_period_elapsed
c_func
(paren
id|chip-&gt;capt.substream
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
(paren
id|status1
op_amp
id|HISR_MIDI
)paren
op_logical_and
id|chip-&gt;rmidi
)paren
(brace
r_int
r_char
id|c
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_MIDSR
)paren
op_amp
id|MIDSR_RBE
)paren
op_eq
l_int|0
)paren
(brace
id|c
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_MIDRP
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chip-&gt;midcr
op_amp
id|MIDCR_RIE
)paren
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|snd_rawmidi_receive
c_func
(paren
id|chip-&gt;midi_input
comma
op_amp
id|c
comma
l_int|1
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_MIDSR
)paren
op_amp
id|MIDSR_TBF
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|chip-&gt;midcr
op_amp
id|MIDCR_TIE
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|snd_rawmidi_transmit
c_func
(paren
id|chip-&gt;midi_output
comma
op_amp
id|c
comma
l_int|1
)paren
op_ne
l_int|1
)paren
(brace
id|chip-&gt;midcr
op_and_assign
op_complement
id|MIDCR_TIE
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDWP
comma
id|c
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *  EOI to the PCI part....reenables interrupts&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_HICR
comma
id|HICR_CHGM
op_or
id|HICR_IEV
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|variable|snd_cs46xx_playback
r_static
id|snd_pcm_hardware_t
id|snd_cs46xx_playback
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_RESUME
)paren
comma
dot
id|formats
op_assign
(paren
id|SNDRV_PCM_FMTBIT_S8
op_or
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
op_or
id|SNDRV_PCM_FMTBIT_S16_BE
op_or
id|SNDRV_PCM_FMTBIT_U16_LE
op_or
id|SNDRV_PCM_FMTBIT_U16_BE
)paren
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
dot
id|rate_min
op_assign
l_int|5500
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|256
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
id|CS46XX_MIN_PERIOD_SIZE
comma
dot
id|period_bytes_max
op_assign
id|CS46XX_MAX_PERIOD_SIZE
comma
dot
id|periods_min
op_assign
id|CS46XX_FRAGS
comma
dot
id|periods_max
op_assign
l_int|1024
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|snd_cs46xx_capture
r_static
id|snd_pcm_hardware_t
id|snd_cs46xx_capture
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_RESUME
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
dot
id|rate_min
op_assign
l_int|5500
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|2
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|256
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
id|CS46XX_MIN_PERIOD_SIZE
comma
dot
id|period_bytes_max
op_assign
id|CS46XX_MAX_PERIOD_SIZE
comma
dot
id|periods_min
op_assign
id|CS46XX_FRAGS
comma
dot
id|periods_max
op_assign
l_int|1024
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
DECL|variable|period_sizes
r_static
r_int
r_int
id|period_sizes
(braket
)braket
op_assign
(brace
l_int|32
comma
l_int|64
comma
l_int|128
comma
l_int|256
comma
l_int|512
comma
l_int|1024
comma
l_int|2048
)brace
suffix:semicolon
DECL|variable|hw_constraints_period_sizes
r_static
id|snd_pcm_hw_constraint_list_t
id|hw_constraints_period_sizes
op_assign
(brace
dot
id|count
op_assign
id|ARRAY_SIZE
c_func
(paren
id|period_sizes
)paren
comma
dot
id|list
op_assign
id|period_sizes
comma
dot
id|mask
op_assign
l_int|0
)brace
suffix:semicolon
macro_line|#endif
DECL|function|snd_cs46xx_pcm_free_substream
r_static
r_void
id|snd_cs46xx_pcm_free_substream
c_func
(paren
id|snd_pcm_runtime_t
op_star
id|runtime
)paren
(brace
id|cs46xx_pcm_t
op_star
id|cpcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
id|kfree
c_func
(paren
id|cpcm
)paren
suffix:semicolon
)brace
DECL|function|_cs46xx_playback_open_channel
r_static
r_int
id|_cs46xx_playback_open_channel
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|pcm_channel_id
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|cs46xx_pcm_t
op_star
id|cpcm
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|cpcm
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|cpcm
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpcm
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|snd_dma_alloc_pages
c_func
(paren
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|chip-&gt;pci
)paren
comma
id|PAGE_SIZE
comma
op_amp
id|cpcm-&gt;hw_buf
)paren
OL
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|cpcm
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|runtime-&gt;hw
op_assign
id|snd_cs46xx_playback
suffix:semicolon
id|runtime-&gt;private_data
op_assign
id|cpcm
suffix:semicolon
id|runtime-&gt;private_free
op_assign
id|snd_cs46xx_pcm_free_substream
suffix:semicolon
id|cpcm-&gt;substream
op_assign
id|substream
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|down
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
id|cpcm-&gt;pcm_channel
op_assign
l_int|NULL
suffix:semicolon
id|cpcm-&gt;pcm_channel_id
op_assign
id|pcm_channel_id
suffix:semicolon
id|snd_pcm_hw_constraint_list
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_PERIOD_BYTES
comma
op_amp
id|hw_constraints_period_sizes
)paren
suffix:semicolon
id|up
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
macro_line|#else
id|chip-&gt;playback_pcm
op_assign
id|cpcm
suffix:semicolon
multiline_comment|/* HACK */
macro_line|#endif
r_if
c_cond
(paren
id|chip-&gt;accept_valid
)paren
id|substream-&gt;runtime-&gt;hw.info
op_or_assign
id|SNDRV_PCM_INFO_MMAP_VALID
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_playback_open
r_static
r_int
id|snd_cs46xx_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_printdd
c_func
(paren
l_string|&quot;open front channel&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|_cs46xx_playback_open_channel
c_func
(paren
id|substream
comma
id|DSP_PCM_MAIN_CHANNEL
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
DECL|function|snd_cs46xx_playback_open_rear
r_static
r_int
id|snd_cs46xx_playback_open_rear
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_printdd
c_func
(paren
l_string|&quot;open rear channel&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|_cs46xx_playback_open_channel
c_func
(paren
id|substream
comma
id|DSP_PCM_REAR_CHANNEL
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_playback_open_clfe
r_static
r_int
id|snd_cs46xx_playback_open_clfe
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_printdd
c_func
(paren
l_string|&quot;open center - LFE channel&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|_cs46xx_playback_open_channel
c_func
(paren
id|substream
comma
id|DSP_PCM_CENTER_LFE_CHANNEL
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_playback_open_iec958
r_static
r_int
id|snd_cs46xx_playback_open_iec958
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_printdd
c_func
(paren
l_string|&quot;open raw iec958 channel&bslash;n&quot;
)paren
suffix:semicolon
id|down
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
id|cs46xx_iec958_pre_open
(paren
id|chip
)paren
suffix:semicolon
id|up
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_return
id|_cs46xx_playback_open_channel
c_func
(paren
id|substream
comma
id|DSP_IEC958_CHANNEL
)paren
suffix:semicolon
)brace
r_static
r_int
id|snd_cs46xx_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
suffix:semicolon
DECL|function|snd_cs46xx_playback_close_iec958
r_static
r_int
id|snd_cs46xx_playback_close_iec958
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_int
id|err
suffix:semicolon
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_printdd
c_func
(paren
l_string|&quot;close raw iec958 channel&bslash;n&quot;
)paren
suffix:semicolon
id|err
op_assign
id|snd_cs46xx_playback_close
c_func
(paren
id|substream
)paren
suffix:semicolon
id|down
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
id|cs46xx_iec958_post_close
(paren
id|chip
)paren
suffix:semicolon
id|up
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#endif
DECL|function|snd_cs46xx_capture_open
r_static
r_int
id|snd_cs46xx_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_dma_alloc_pages
c_func
(paren
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|chip-&gt;pci
)paren
comma
id|PAGE_SIZE
comma
op_amp
id|chip-&gt;capt.hw_buf
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|chip-&gt;capt.substream
op_assign
id|substream
suffix:semicolon
id|substream-&gt;runtime-&gt;hw
op_assign
id|snd_cs46xx_capture
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;accept_valid
)paren
id|substream-&gt;runtime-&gt;hw.info
op_or_assign
id|SNDRV_PCM_INFO_MMAP_VALID
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|snd_pcm_hw_constraint_list
c_func
(paren
id|substream-&gt;runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_PERIOD_BYTES
comma
op_amp
id|hw_constraints_period_sizes
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_playback_close
r_static
r_int
id|snd_cs46xx_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|cs46xx_pcm_t
op_star
id|cpcm
suffix:semicolon
id|cpcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
multiline_comment|/* when playback_open fails, then cpcm can be NULL */
r_if
c_cond
(paren
op_logical_neg
id|cpcm
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|down
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpcm-&gt;pcm_channel
)paren
(brace
id|cs46xx_dsp_destroy_pcm_channel
c_func
(paren
id|chip
comma
id|cpcm-&gt;pcm_channel
)paren
suffix:semicolon
id|cpcm-&gt;pcm_channel
op_assign
l_int|NULL
suffix:semicolon
)brace
id|up
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
macro_line|#else
id|chip-&gt;playback_pcm
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
id|cpcm-&gt;substream
op_assign
l_int|NULL
suffix:semicolon
id|snd_dma_free_pages
c_func
(paren
op_amp
id|cpcm-&gt;hw_buf
)paren
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_capture_close
r_static
r_int
id|snd_cs46xx_capture_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;capt.substream
op_assign
l_int|NULL
suffix:semicolon
id|snd_dma_free_pages
c_func
(paren
op_amp
id|chip-&gt;capt.hw_buf
)paren
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
DECL|variable|snd_cs46xx_playback_rear_ops
r_static
id|snd_pcm_ops_t
id|snd_cs46xx_playback_rear_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_cs46xx_playback_open_rear
comma
dot
id|close
op_assign
id|snd_cs46xx_playback_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_cs46xx_playback_hw_params
comma
dot
id|hw_free
op_assign
id|snd_cs46xx_playback_hw_free
comma
dot
id|prepare
op_assign
id|snd_cs46xx_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_cs46xx_playback_trigger
comma
dot
id|pointer
op_assign
id|snd_cs46xx_playback_direct_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_cs46xx_playback_indirect_rear_ops
r_static
id|snd_pcm_ops_t
id|snd_cs46xx_playback_indirect_rear_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_cs46xx_playback_open_rear
comma
dot
id|close
op_assign
id|snd_cs46xx_playback_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_cs46xx_playback_hw_params
comma
dot
id|hw_free
op_assign
id|snd_cs46xx_playback_hw_free
comma
dot
id|prepare
op_assign
id|snd_cs46xx_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_cs46xx_playback_trigger
comma
dot
id|pointer
op_assign
id|snd_cs46xx_playback_indirect_pointer
comma
dot
id|ack
op_assign
id|snd_cs46xx_playback_transfer
comma
)brace
suffix:semicolon
DECL|variable|snd_cs46xx_playback_clfe_ops
r_static
id|snd_pcm_ops_t
id|snd_cs46xx_playback_clfe_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_cs46xx_playback_open_clfe
comma
dot
id|close
op_assign
id|snd_cs46xx_playback_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_cs46xx_playback_hw_params
comma
dot
id|hw_free
op_assign
id|snd_cs46xx_playback_hw_free
comma
dot
id|prepare
op_assign
id|snd_cs46xx_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_cs46xx_playback_trigger
comma
dot
id|pointer
op_assign
id|snd_cs46xx_playback_direct_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_cs46xx_playback_indirect_clfe_ops
r_static
id|snd_pcm_ops_t
id|snd_cs46xx_playback_indirect_clfe_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_cs46xx_playback_open_clfe
comma
dot
id|close
op_assign
id|snd_cs46xx_playback_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_cs46xx_playback_hw_params
comma
dot
id|hw_free
op_assign
id|snd_cs46xx_playback_hw_free
comma
dot
id|prepare
op_assign
id|snd_cs46xx_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_cs46xx_playback_trigger
comma
dot
id|pointer
op_assign
id|snd_cs46xx_playback_indirect_pointer
comma
dot
id|ack
op_assign
id|snd_cs46xx_playback_transfer
comma
)brace
suffix:semicolon
DECL|variable|snd_cs46xx_playback_iec958_ops
r_static
id|snd_pcm_ops_t
id|snd_cs46xx_playback_iec958_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_cs46xx_playback_open_iec958
comma
dot
id|close
op_assign
id|snd_cs46xx_playback_close_iec958
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_cs46xx_playback_hw_params
comma
dot
id|hw_free
op_assign
id|snd_cs46xx_playback_hw_free
comma
dot
id|prepare
op_assign
id|snd_cs46xx_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_cs46xx_playback_trigger
comma
dot
id|pointer
op_assign
id|snd_cs46xx_playback_direct_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_cs46xx_playback_indirect_iec958_ops
r_static
id|snd_pcm_ops_t
id|snd_cs46xx_playback_indirect_iec958_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_cs46xx_playback_open_iec958
comma
dot
id|close
op_assign
id|snd_cs46xx_playback_close_iec958
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_cs46xx_playback_hw_params
comma
dot
id|hw_free
op_assign
id|snd_cs46xx_playback_hw_free
comma
dot
id|prepare
op_assign
id|snd_cs46xx_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_cs46xx_playback_trigger
comma
dot
id|pointer
op_assign
id|snd_cs46xx_playback_indirect_pointer
comma
dot
id|ack
op_assign
id|snd_cs46xx_playback_transfer
comma
)brace
suffix:semicolon
macro_line|#endif
DECL|variable|snd_cs46xx_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_cs46xx_playback_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_cs46xx_playback_open
comma
dot
id|close
op_assign
id|snd_cs46xx_playback_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_cs46xx_playback_hw_params
comma
dot
id|hw_free
op_assign
id|snd_cs46xx_playback_hw_free
comma
dot
id|prepare
op_assign
id|snd_cs46xx_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_cs46xx_playback_trigger
comma
dot
id|pointer
op_assign
id|snd_cs46xx_playback_direct_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_cs46xx_playback_indirect_ops
r_static
id|snd_pcm_ops_t
id|snd_cs46xx_playback_indirect_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_cs46xx_playback_open
comma
dot
id|close
op_assign
id|snd_cs46xx_playback_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_cs46xx_playback_hw_params
comma
dot
id|hw_free
op_assign
id|snd_cs46xx_playback_hw_free
comma
dot
id|prepare
op_assign
id|snd_cs46xx_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_cs46xx_playback_trigger
comma
dot
id|pointer
op_assign
id|snd_cs46xx_playback_indirect_pointer
comma
dot
id|ack
op_assign
id|snd_cs46xx_playback_transfer
comma
)brace
suffix:semicolon
DECL|variable|snd_cs46xx_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_cs46xx_capture_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_cs46xx_capture_open
comma
dot
id|close
op_assign
id|snd_cs46xx_capture_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_cs46xx_capture_hw_params
comma
dot
id|hw_free
op_assign
id|snd_cs46xx_capture_hw_free
comma
dot
id|prepare
op_assign
id|snd_cs46xx_capture_prepare
comma
dot
id|trigger
op_assign
id|snd_cs46xx_capture_trigger
comma
dot
id|pointer
op_assign
id|snd_cs46xx_capture_direct_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_cs46xx_capture_indirect_ops
r_static
id|snd_pcm_ops_t
id|snd_cs46xx_capture_indirect_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_cs46xx_capture_open
comma
dot
id|close
op_assign
id|snd_cs46xx_capture_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_cs46xx_capture_hw_params
comma
dot
id|hw_free
op_assign
id|snd_cs46xx_capture_hw_free
comma
dot
id|prepare
op_assign
id|snd_cs46xx_capture_prepare
comma
dot
id|trigger
op_assign
id|snd_cs46xx_capture_trigger
comma
dot
id|pointer
op_assign
id|snd_cs46xx_capture_indirect_pointer
comma
dot
id|ack
op_assign
id|snd_cs46xx_capture_transfer
comma
)brace
suffix:semicolon
DECL|function|snd_cs46xx_pcm_free
r_static
r_void
id|snd_cs46xx_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|pcm-&gt;private_data
suffix:semicolon
id|chip-&gt;pcm
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
DECL|function|snd_cs46xx_pcm_rear_free
r_static
r_void
id|snd_cs46xx_pcm_rear_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|pcm-&gt;private_data
suffix:semicolon
id|chip-&gt;pcm_rear
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_pcm_center_lfe_free
r_static
r_void
id|snd_cs46xx_pcm_center_lfe_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|pcm-&gt;private_data
suffix:semicolon
id|chip-&gt;pcm_center_lfe
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_pcm_iec958_free
r_static
r_void
id|snd_cs46xx_pcm_iec958_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|pcm-&gt;private_data
suffix:semicolon
id|chip-&gt;pcm_iec958
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|macro|MAX_PLAYBACK_CHANNELS
mdefine_line|#define MAX_PLAYBACK_CHANNELS&t;(DSP_MAX_PCM_CHANNELS - 1)
macro_line|#else
DECL|macro|MAX_PLAYBACK_CHANNELS
mdefine_line|#define MAX_PLAYBACK_CHANNELS&t;1
macro_line|#endif
DECL|function|snd_cs46xx_pcm
r_int
id|__devinit
id|snd_cs46xx_pcm
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;CS46xx&quot;
comma
id|device
comma
id|MAX_PLAYBACK_CHANNELS
comma
l_int|1
comma
op_amp
id|pcm
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_cs46xx_pcm_free
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_cs46xx_playback_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_cs46xx_capture_ops
)paren
suffix:semicolon
multiline_comment|/* global setup */
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;CS46xx&quot;
)paren
suffix:semicolon
id|chip-&gt;pcm
op_assign
id|pcm
suffix:semicolon
id|snd_pcm_lib_preallocate_pages_for_all
c_func
(paren
id|pcm
comma
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|chip-&gt;pci
)paren
comma
l_int|64
op_star
l_int|1024
comma
l_int|256
op_star
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
DECL|function|snd_cs46xx_pcm_rear
r_int
id|__devinit
id|snd_cs46xx_pcm_rear
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;CS46xx - Rear&quot;
comma
id|device
comma
id|MAX_PLAYBACK_CHANNELS
comma
l_int|0
comma
op_amp
id|pcm
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_cs46xx_pcm_rear_free
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_cs46xx_playback_rear_ops
)paren
suffix:semicolon
multiline_comment|/* global setup */
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;CS46xx - Rear&quot;
)paren
suffix:semicolon
id|chip-&gt;pcm_rear
op_assign
id|pcm
suffix:semicolon
id|snd_pcm_lib_preallocate_pages_for_all
c_func
(paren
id|pcm
comma
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|chip-&gt;pci
)paren
comma
l_int|64
op_star
l_int|1024
comma
l_int|256
op_star
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_pcm_center_lfe
r_int
id|__devinit
id|snd_cs46xx_pcm_center_lfe
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;CS46xx - Center LFE&quot;
comma
id|device
comma
id|MAX_PLAYBACK_CHANNELS
comma
l_int|0
comma
op_amp
id|pcm
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_cs46xx_pcm_center_lfe_free
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_cs46xx_playback_clfe_ops
)paren
suffix:semicolon
multiline_comment|/* global setup */
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;CS46xx - Center LFE&quot;
)paren
suffix:semicolon
id|chip-&gt;pcm_center_lfe
op_assign
id|pcm
suffix:semicolon
id|snd_pcm_lib_preallocate_pages_for_all
c_func
(paren
id|pcm
comma
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|chip-&gt;pci
)paren
comma
l_int|64
op_star
l_int|1024
comma
l_int|256
op_star
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_pcm_iec958
r_int
id|__devinit
id|snd_cs46xx_pcm_iec958
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;CS46xx - IEC958&quot;
comma
id|device
comma
l_int|1
comma
l_int|0
comma
op_amp
id|pcm
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_cs46xx_pcm_iec958_free
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_cs46xx_playback_iec958_ops
)paren
suffix:semicolon
multiline_comment|/* global setup */
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;CS46xx - IEC958&quot;
)paren
suffix:semicolon
id|chip-&gt;pcm_rear
op_assign
id|pcm
suffix:semicolon
id|snd_pcm_lib_preallocate_pages_for_all
c_func
(paren
id|pcm
comma
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|chip-&gt;pci
)paren
comma
l_int|64
op_star
l_int|1024
comma
l_int|256
op_star
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; *  Mixer routines&n; */
DECL|function|snd_cs46xx_mixer_free_ac97_bus
r_static
r_void
id|snd_cs46xx_mixer_free_ac97_bus
c_func
(paren
id|ac97_bus_t
op_star
id|bus
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|bus-&gt;private_data
suffix:semicolon
id|chip-&gt;ac97_bus
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|snd_cs46xx_mixer_free_ac97
r_static
r_void
id|snd_cs46xx_mixer_free_ac97
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|ac97-&gt;private_data
suffix:semicolon
id|snd_assert
(paren
(paren
id|ac97
op_eq
id|chip-&gt;ac97
(braket
id|CS46XX_PRIMARY_CODEC_INDEX
)braket
)paren
op_logical_or
(paren
id|ac97
op_eq
id|chip-&gt;ac97
(braket
id|CS46XX_SECONDARY_CODEC_INDEX
)braket
)paren
comma
r_return
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac97
op_eq
id|chip-&gt;ac97
(braket
id|CS46XX_PRIMARY_CODEC_INDEX
)braket
)paren
(brace
id|chip-&gt;ac97
(braket
id|CS46XX_PRIMARY_CODEC_INDEX
)braket
op_assign
l_int|NULL
suffix:semicolon
id|chip-&gt;eapd_switch
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
id|chip-&gt;ac97
(braket
id|CS46XX_SECONDARY_CODEC_INDEX
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|snd_cs46xx_vol_info
r_static
r_int
id|snd_cs46xx_vol_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|0x7fff
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_vol_get
r_static
r_int
id|snd_cs46xx_vol_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
r_int
r_int
id|val
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|reg
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
l_int|0xffff
op_minus
(paren
id|val
op_rshift
l_int|16
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
l_int|0xffff
op_minus
(paren
id|val
op_amp
l_int|0xffff
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_vol_put
r_static
r_int
id|snd_cs46xx_vol_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
r_int
r_int
id|val
op_assign
(paren
(paren
l_int|0xffff
op_minus
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
op_lshift
l_int|16
op_or
(paren
l_int|0xffff
op_minus
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
)paren
)paren
suffix:semicolon
r_int
r_int
id|old
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|reg
)paren
suffix:semicolon
r_int
id|change
op_assign
(paren
id|old
op_ne
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
(brace
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|reg
comma
id|val
)paren
suffix:semicolon
)brace
r_return
id|change
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
DECL|function|snd_cs46xx_vol_dac_get
r_static
r_int
id|snd_cs46xx_vol_dac_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|chip-&gt;dsp_spos_instance-&gt;dac_volume_left
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
id|chip-&gt;dsp_spos_instance-&gt;dac_volume_right
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_vol_dac_put
r_static
r_int
id|snd_cs46xx_vol_dac_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|change
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;dsp_spos_instance-&gt;dac_volume_right
op_ne
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_logical_or
id|chip-&gt;dsp_spos_instance-&gt;dac_volume_left
op_ne
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
)paren
(brace
id|cs46xx_dsp_set_dac_volume
c_func
(paren
id|chip
comma
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
comma
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|change
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_int
id|snd_cs46xx_vol_iec958_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|chip-&gt;dsp_spos_instance-&gt;spdif_input_volume_left
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
id|chip-&gt;dsp_spos_instance-&gt;spdif_input_volume_right
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|snd_cs46xx_vol_iec958_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|change
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;dsp_spos_instance-&gt;spdif_input_volume_left
op_ne
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_logical_or
id|chip-&gt;dsp_spos_instance-&gt;spdif_input_volume_right
op_ne
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
)paren
(brace
id|cs46xx_dsp_set_iec958_volume
(paren
id|chip
comma
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
comma
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|change
suffix:semicolon
)brace
macro_line|#endif
DECL|function|snd_mixer_boolean_info
r_static
r_int
id|snd_mixer_boolean_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_iec958_get
r_static
r_int
id|snd_cs46xx_iec958_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_eq
id|CS46XX_MIXER_SPDIF_OUTPUT_ELEMENT
)paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|chip-&gt;dsp_spos_instance-&gt;spdif_status_out
op_amp
id|DSP_SPDIF_STATUS_OUTPUT_ENABLED
)paren
suffix:semicolon
r_else
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|chip-&gt;dsp_spos_instance-&gt;spdif_status_in
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_iec958_put
r_static
r_int
id|snd_cs46xx_iec958_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|change
comma
id|res
suffix:semicolon
r_switch
c_cond
(paren
id|kcontrol-&gt;private_value
)paren
(brace
r_case
id|CS46XX_MIXER_SPDIF_OUTPUT_ELEMENT
suffix:colon
id|down
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
id|change
op_assign
(paren
id|chip-&gt;dsp_spos_instance-&gt;spdif_status_out
op_amp
id|DSP_SPDIF_STATUS_OUTPUT_ENABLED
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_logical_and
op_logical_neg
id|change
)paren
id|cs46xx_dsp_enable_spdif_out
c_func
(paren
id|chip
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|change
op_logical_and
op_logical_neg
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
id|cs46xx_dsp_disable_spdif_out
c_func
(paren
id|chip
)paren
suffix:semicolon
id|res
op_assign
(paren
id|change
op_ne
(paren
id|chip-&gt;dsp_spos_instance-&gt;spdif_status_out
op_amp
id|DSP_SPDIF_STATUS_OUTPUT_ENABLED
)paren
)paren
suffix:semicolon
id|up
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS46XX_MIXER_SPDIF_INPUT_ELEMENT
suffix:colon
id|change
op_assign
id|chip-&gt;dsp_spos_instance-&gt;spdif_status_in
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_logical_and
op_logical_neg
id|change
)paren
(brace
id|cs46xx_dsp_enable_spdif_in
c_func
(paren
id|chip
)paren
suffix:semicolon
multiline_comment|/* restore volume */
)brace
r_else
r_if
c_cond
(paren
id|change
op_logical_and
op_logical_neg
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
id|cs46xx_dsp_disable_spdif_in
c_func
(paren
id|chip
)paren
suffix:semicolon
id|res
op_assign
(paren
id|change
op_ne
id|chip-&gt;dsp_spos_instance-&gt;spdif_status_in
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|res
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|snd_assert
c_func
(paren
l_int|0
comma
(paren
r_void
)paren
l_int|0
)paren
suffix:semicolon
)brace
r_return
id|res
suffix:semicolon
)brace
DECL|function|snd_cs46xx_adc_capture_get
r_static
r_int
id|snd_cs46xx_adc_capture_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;adc_input
op_ne
l_int|NULL
)paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
r_else
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_adc_capture_put
r_static
r_int
id|snd_cs46xx_adc_capture_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
r_int
id|change
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_logical_and
op_logical_neg
id|ins-&gt;adc_input
)paren
(brace
id|cs46xx_dsp_enable_adc_capture
c_func
(paren
id|chip
)paren
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_logical_and
id|ins-&gt;adc_input
)paren
(brace
id|cs46xx_dsp_disable_adc_capture
c_func
(paren
id|chip
)paren
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|change
suffix:semicolon
)brace
DECL|function|snd_cs46xx_pcm_capture_get
r_static
r_int
id|snd_cs46xx_pcm_capture_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;pcm_input
op_ne
l_int|NULL
)paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
r_else
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_pcm_capture_put
r_static
r_int
id|snd_cs46xx_pcm_capture_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
r_int
id|change
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_logical_and
op_logical_neg
id|ins-&gt;pcm_input
)paren
(brace
id|cs46xx_dsp_enable_pcm_capture
c_func
(paren
id|chip
)paren
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_logical_and
id|ins-&gt;pcm_input
)paren
(brace
id|cs46xx_dsp_disable_pcm_capture
c_func
(paren
id|chip
)paren
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|change
suffix:semicolon
)brace
DECL|function|snd_herc_spdif_select_get
r_static
r_int
id|snd_herc_spdif_select_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|val1
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIODR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val1
op_amp
id|EGPIODR_GPOE0
)paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
l_int|1
suffix:semicolon
r_else
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Game Theatre XP card - EGPIO[0] is used to select SPDIF input optical or coaxial.&n; */
DECL|function|snd_herc_spdif_select_put
r_static
r_int
id|snd_herc_spdif_select_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|val1
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIODR
)paren
suffix:semicolon
r_int
id|val2
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIOPTR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
(brace
multiline_comment|/* optical is default */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIODR
comma
id|EGPIODR_GPOE0
op_or
id|val1
)paren
suffix:semicolon
multiline_comment|/* enable EGPIO0 output */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIOPTR
comma
id|EGPIOPTR_GPPT0
op_or
id|val2
)paren
suffix:semicolon
multiline_comment|/* open-drain on output */
)brace
r_else
(brace
multiline_comment|/* coaxial */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIODR
comma
id|val1
op_amp
op_complement
id|EGPIODR_GPOE0
)paren
suffix:semicolon
multiline_comment|/* disable */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIOPTR
comma
id|val2
op_amp
op_complement
id|EGPIOPTR_GPPT0
)paren
suffix:semicolon
multiline_comment|/* disable */
)brace
multiline_comment|/* checking diff from the EGPIO direction register &n;&t;   should be enough */
r_return
(paren
id|val1
op_ne
(paren
r_int
)paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIODR
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_spdif_info
r_static
r_int
id|snd_cs46xx_spdif_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_IEC958
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_spdif_default_get
r_static
r_int
id|snd_cs46xx_spdif_default_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|down
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_assign
id|_wrap_all_bits
c_func
(paren
(paren
id|ins-&gt;spdif_csuv_default
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|1
)braket
op_assign
id|_wrap_all_bits
c_func
(paren
(paren
id|ins-&gt;spdif_csuv_default
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
op_assign
id|_wrap_all_bits
c_func
(paren
(paren
id|ins-&gt;spdif_csuv_default
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|up
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_spdif_default_put
r_static
r_int
id|snd_cs46xx_spdif_default_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|change
suffix:semicolon
id|down
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
id|val
op_assign
(paren
(paren
r_int
r_int
)paren
id|_wrap_all_bits
c_func
(paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
)paren
op_lshift
l_int|24
)paren
op_or
(paren
(paren
r_int
r_int
)paren
id|_wrap_all_bits
c_func
(paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|2
)braket
)paren
op_lshift
l_int|16
)paren
op_or
(paren
(paren
r_int
r_int
)paren
id|_wrap_all_bits
c_func
(paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
)paren
)paren
op_or
multiline_comment|/* left and right validity bit */
(paren
l_int|1
op_lshift
l_int|13
)paren
op_or
(paren
l_int|1
op_lshift
l_int|12
)paren
suffix:semicolon
id|change
op_assign
(paren
r_int
r_int
)paren
id|ins-&gt;spdif_csuv_default
op_ne
id|val
suffix:semicolon
id|ins-&gt;spdif_csuv_default
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ins-&gt;spdif_status_out
op_amp
id|DSP_SPDIF_STATUS_PLAYBACK_OPEN
)paren
)paren
id|cs46xx_poke_via_dsp
(paren
id|chip
comma
id|SP_SPDOUT_CSUV
comma
id|val
)paren
suffix:semicolon
id|up
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|function|snd_cs46xx_spdif_mask_get
r_static
r_int
id|snd_cs46xx_spdif_mask_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_assign
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|1
)braket
op_assign
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|2
)braket
op_assign
l_int|0x00
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
op_assign
l_int|0xff
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_spdif_stream_get
r_static
r_int
id|snd_cs46xx_spdif_stream_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
id|down
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_assign
id|_wrap_all_bits
c_func
(paren
(paren
id|ins-&gt;spdif_csuv_stream
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|1
)braket
op_assign
id|_wrap_all_bits
c_func
(paren
(paren
id|ins-&gt;spdif_csuv_stream
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
op_assign
id|_wrap_all_bits
c_func
(paren
(paren
id|ins-&gt;spdif_csuv_stream
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|up
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_spdif_stream_put
r_static
r_int
id|snd_cs46xx_spdif_stream_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|dsp_spos_instance_t
op_star
id|ins
op_assign
id|chip-&gt;dsp_spos_instance
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|change
suffix:semicolon
id|down
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
id|val
op_assign
(paren
(paren
r_int
r_int
)paren
id|_wrap_all_bits
c_func
(paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
)paren
op_lshift
l_int|24
)paren
op_or
(paren
(paren
r_int
r_int
)paren
id|_wrap_all_bits
c_func
(paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|1
)braket
)paren
op_lshift
l_int|16
)paren
op_or
(paren
(paren
r_int
r_int
)paren
id|_wrap_all_bits
c_func
(paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
)paren
)paren
op_or
multiline_comment|/* left and right validity bit */
(paren
l_int|1
op_lshift
l_int|13
)paren
op_or
(paren
l_int|1
op_lshift
l_int|12
)paren
suffix:semicolon
id|change
op_assign
id|ins-&gt;spdif_csuv_stream
op_ne
id|val
suffix:semicolon
id|ins-&gt;spdif_csuv_stream
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|ins-&gt;spdif_status_out
op_amp
id|DSP_SPDIF_STATUS_PLAYBACK_OPEN
)paren
id|cs46xx_poke_via_dsp
(paren
id|chip
comma
id|SP_SPDOUT_CSUV
comma
id|val
)paren
suffix:semicolon
id|up
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_SND_CS46XX_NEW_DSP */
macro_line|#ifdef CONFIG_SND_CS46XX_DEBUG_GPIO
DECL|function|snd_cs46xx_egpio_select_info
r_static
r_int
id|snd_cs46xx_egpio_select_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|8
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_egpio_select_get
r_static
r_int
id|snd_cs46xx_egpio_select_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|chip-&gt;current_gpio
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_egpio_select_put
r_static
r_int
id|snd_cs46xx_egpio_select_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|change
op_assign
(paren
id|chip-&gt;current_gpio
op_ne
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|chip-&gt;current_gpio
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|function|snd_cs46xx_egpio_get
r_static
r_int
id|snd_cs46xx_egpio_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
id|snd_printdd
(paren
l_string|&quot;put: reg = %04x, gpio %02x&bslash;n&quot;
comma
id|reg
comma
id|chip-&gt;current_gpio
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|reg
)paren
op_amp
(paren
l_int|1
op_lshift
id|chip-&gt;current_gpio
)paren
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_egpio_put
r_static
r_int
id|snd_cs46xx_egpio_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
r_int
id|val
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|reg
)paren
suffix:semicolon
r_int
id|oldval
op_assign
id|val
suffix:semicolon
id|snd_printdd
(paren
l_string|&quot;put: reg = %04x, gpio %02x&bslash;n&quot;
comma
id|reg
comma
id|chip-&gt;current_gpio
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
id|val
op_or_assign
(paren
l_int|1
op_lshift
id|chip-&gt;current_gpio
)paren
suffix:semicolon
r_else
id|val
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|chip-&gt;current_gpio
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|reg
comma
id|val
)paren
suffix:semicolon
id|snd_printdd
(paren
l_string|&quot;put: val %08x oldval %08x&bslash;n&quot;
comma
id|val
comma
id|oldval
)paren
suffix:semicolon
r_return
(paren
id|oldval
op_ne
id|val
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_SND_CS46XX_DEBUG_GPIO */
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_cs46xx_controls
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;DAC Volume&quot;
comma
dot
id|info
op_assign
id|snd_cs46xx_vol_info
comma
macro_line|#ifndef CONFIG_SND_CS46XX_NEW_DSP
dot
id|get
op_assign
id|snd_cs46xx_vol_get
comma
dot
id|put
op_assign
id|snd_cs46xx_vol_put
comma
dot
id|private_value
op_assign
id|BA1_PVOL
comma
macro_line|#else
dot
id|get
op_assign
id|snd_cs46xx_vol_dac_get
comma
dot
id|put
op_assign
id|snd_cs46xx_vol_dac_put
comma
macro_line|#endif
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;ADC Volume&quot;
comma
dot
id|info
op_assign
id|snd_cs46xx_vol_info
comma
dot
id|get
op_assign
id|snd_cs46xx_vol_get
comma
dot
id|put
op_assign
id|snd_cs46xx_vol_put
comma
macro_line|#ifndef CONFIG_SND_CS46XX_NEW_DSP
dot
id|private_value
op_assign
id|BA1_CVOL
comma
macro_line|#else
dot
id|private_value
op_assign
(paren
id|VARIDECIMATE_SCB_ADDR
op_plus
l_int|0xE
)paren
op_lshift
l_int|2
comma
macro_line|#endif
)brace
comma
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;ADC Capture Switch&quot;
comma
dot
id|info
op_assign
id|snd_mixer_boolean_info
comma
dot
id|get
op_assign
id|snd_cs46xx_adc_capture_get
comma
dot
id|put
op_assign
id|snd_cs46xx_adc_capture_put
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;DAC Capture Switch&quot;
comma
dot
id|info
op_assign
id|snd_mixer_boolean_info
comma
dot
id|get
op_assign
id|snd_cs46xx_pcm_capture_get
comma
dot
id|put
op_assign
id|snd_cs46xx_pcm_capture_put
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;IEC958 Output Switch&quot;
comma
dot
id|info
op_assign
id|snd_mixer_boolean_info
comma
dot
id|get
op_assign
id|snd_cs46xx_iec958_get
comma
dot
id|put
op_assign
id|snd_cs46xx_iec958_put
comma
dot
id|private_value
op_assign
id|CS46XX_MIXER_SPDIF_OUTPUT_ELEMENT
comma
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;IEC958 Input Switch&quot;
comma
dot
id|info
op_assign
id|snd_mixer_boolean_info
comma
dot
id|get
op_assign
id|snd_cs46xx_iec958_get
comma
dot
id|put
op_assign
id|snd_cs46xx_iec958_put
comma
dot
id|private_value
op_assign
id|CS46XX_MIXER_SPDIF_INPUT_ELEMENT
comma
)brace
comma
macro_line|#if 0
multiline_comment|/* Input IEC958 volume does not work for the moment. (Benny) */
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;IEC958 Input Volume&quot;
comma
dot
id|info
op_assign
id|snd_cs46xx_vol_info
comma
dot
id|get
op_assign
id|snd_cs46xx_vol_iec958_get
comma
dot
id|put
op_assign
id|snd_cs46xx_vol_iec958_put
comma
dot
id|private_value
op_assign
(paren
id|ASYNCRX_SCB_ADDR
op_plus
l_int|0xE
)paren
op_lshift
l_int|2
comma
)brace
comma
macro_line|#endif
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_PCM
comma
dot
id|name
op_assign
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|PLAYBACK
comma
id|DEFAULT
)paren
comma
dot
id|info
op_assign
id|snd_cs46xx_spdif_info
comma
dot
id|get
op_assign
id|snd_cs46xx_spdif_default_get
comma
dot
id|put
op_assign
id|snd_cs46xx_spdif_default_put
comma
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_PCM
comma
dot
id|name
op_assign
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|PLAYBACK
comma
id|MASK
)paren
comma
dot
id|info
op_assign
id|snd_cs46xx_spdif_info
comma
dot
id|get
op_assign
id|snd_cs46xx_spdif_mask_get
comma
dot
id|access
op_assign
id|SNDRV_CTL_ELEM_ACCESS_READ
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_PCM
comma
dot
id|name
op_assign
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|PLAYBACK
comma
id|PCM_STREAM
)paren
comma
dot
id|info
op_assign
id|snd_cs46xx_spdif_info
comma
dot
id|get
op_assign
id|snd_cs46xx_spdif_stream_get
comma
dot
id|put
op_assign
id|snd_cs46xx_spdif_stream_put
)brace
comma
macro_line|#endif
macro_line|#ifdef CONFIG_SND_CS46XX_DEBUG_GPIO
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;EGPIO select&quot;
comma
dot
id|info
op_assign
id|snd_cs46xx_egpio_select_info
comma
dot
id|get
op_assign
id|snd_cs46xx_egpio_select_get
comma
dot
id|put
op_assign
id|snd_cs46xx_egpio_select_put
comma
dot
id|private_value
op_assign
l_int|0
comma
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;EGPIO Input/Output&quot;
comma
dot
id|info
op_assign
id|snd_mixer_boolean_info
comma
dot
id|get
op_assign
id|snd_cs46xx_egpio_get
comma
dot
id|put
op_assign
id|snd_cs46xx_egpio_put
comma
dot
id|private_value
op_assign
id|BA0_EGPIODR
comma
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;EGPIO CMOS/Open drain&quot;
comma
dot
id|info
op_assign
id|snd_mixer_boolean_info
comma
dot
id|get
op_assign
id|snd_cs46xx_egpio_get
comma
dot
id|put
op_assign
id|snd_cs46xx_egpio_put
comma
dot
id|private_value
op_assign
id|BA0_EGPIOPTR
comma
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;EGPIO On/Off&quot;
comma
dot
id|info
op_assign
id|snd_mixer_boolean_info
comma
dot
id|get
op_assign
id|snd_cs46xx_egpio_get
comma
dot
id|put
op_assign
id|snd_cs46xx_egpio_put
comma
dot
id|private_value
op_assign
id|BA0_EGPIOSR
comma
)brace
comma
macro_line|#endif
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
multiline_comment|/* set primary cs4294 codec into Extended Audio Mode */
DECL|function|snd_cs46xx_front_dup_get
r_static
r_int
id|snd_cs46xx_front_dup_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
id|snd_ac97_read
c_func
(paren
id|chip-&gt;ac97
(braket
id|CS46XX_PRIMARY_CODEC_INDEX
)braket
comma
id|AC97_CSR_ACMODE
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|val
op_amp
l_int|0x200
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_front_dup_put
r_static
r_int
id|snd_cs46xx_front_dup_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_return
id|snd_ac97_update_bits
c_func
(paren
id|chip-&gt;ac97
(braket
id|CS46XX_PRIMARY_CODEC_INDEX
)braket
comma
id|AC97_CSR_ACMODE
comma
l_int|0x200
comma
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
ques
c_cond
l_int|0
suffix:colon
l_int|0x200
)paren
suffix:semicolon
)brace
DECL|variable|snd_cs46xx_front_dup_ctl
r_static
id|snd_kcontrol_new_t
id|snd_cs46xx_front_dup_ctl
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Duplicate Front&quot;
comma
dot
id|info
op_assign
id|snd_mixer_boolean_info
comma
dot
id|get
op_assign
id|snd_cs46xx_front_dup_get
comma
dot
id|put
op_assign
id|snd_cs46xx_front_dup_put
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
multiline_comment|/* Only available on the Hercules Game Theater XP soundcard */
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_hercules_controls
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Optical/Coaxial SPDIF Input Switch&quot;
comma
dot
id|info
op_assign
id|snd_mixer_boolean_info
comma
dot
id|get
op_assign
id|snd_herc_spdif_select_get
comma
dot
id|put
op_assign
id|snd_herc_spdif_select_put
comma
)brace
comma
)brace
suffix:semicolon
DECL|function|snd_cs46xx_codec_reset
r_static
r_void
id|snd_cs46xx_codec_reset
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
r_int
r_int
id|end_time
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* reset to defaults */
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_RESET
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* set the desired CODEC mode */
r_if
c_cond
(paren
id|ac97-&gt;num
op_eq
id|CS46XX_PRIMARY_CODEC_INDEX
)paren
(brace
id|snd_printdd
c_func
(paren
l_string|&quot;cs46xx: CODOEC1 mode %04x&bslash;n&quot;
comma
l_int|0x0
)paren
suffix:semicolon
id|snd_cs46xx_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_CSR_ACMODE
comma
l_int|0x0
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ac97-&gt;num
op_eq
id|CS46XX_SECONDARY_CODEC_INDEX
)paren
(brace
id|snd_printdd
c_func
(paren
l_string|&quot;cs46xx: CODOEC2 mode %04x&bslash;n&quot;
comma
l_int|0x3
)paren
suffix:semicolon
id|snd_cs46xx_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_CSR_ACMODE
comma
l_int|0x3
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_assert
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* should never happen ... */
)brace
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
multiline_comment|/* it&squot;s necessary to wait awhile until registers are accessible after RESET */
multiline_comment|/* because the PCM or MASTER volume registers can be modified, */
multiline_comment|/* the REC_GAIN register is used for tests */
id|end_time
op_assign
id|jiffies
op_plus
id|HZ
suffix:semicolon
r_do
(brace
r_int
r_int
id|ext_mid
suffix:semicolon
multiline_comment|/* use preliminary reads to settle the communication */
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_RESET
)paren
suffix:semicolon
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_VENDOR_ID1
)paren
suffix:semicolon
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_VENDOR_ID2
)paren
suffix:semicolon
multiline_comment|/* modem? */
id|ext_mid
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_MID
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ext_mid
op_ne
l_int|0xffff
op_logical_and
(paren
id|ext_mid
op_amp
l_int|1
)paren
op_ne
l_int|0
)paren
r_return
suffix:semicolon
multiline_comment|/* test if we can write to the record gain volume register */
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_REC_GAIN
comma
l_int|0x8a05
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_REC_GAIN
)paren
)paren
op_eq
l_int|0x8a05
)paren
r_return
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
op_div
l_int|100
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|time_after_eq
c_func
(paren
id|end_time
comma
id|jiffies
)paren
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;CS46xx secondary codec dont respond!&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|cs46xx_detect_codec
r_static
r_int
id|__devinit
id|cs46xx_detect_codec
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
id|codec
)paren
(brace
r_int
id|idx
comma
id|err
suffix:semicolon
id|ac97_template_t
id|ac97
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ac97
comma
l_int|0
comma
r_sizeof
(paren
id|ac97
)paren
)paren
suffix:semicolon
id|ac97.private_data
op_assign
id|chip
suffix:semicolon
id|ac97.private_free
op_assign
id|snd_cs46xx_mixer_free_ac97
suffix:semicolon
id|ac97.num
op_assign
id|codec
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;amplifier_ctrl
op_eq
id|amp_voyetra
)paren
id|ac97.scaps
op_assign
id|AC97_SCAP_INV_EAPD
suffix:semicolon
r_if
c_cond
(paren
id|codec
op_eq
id|CS46XX_SECONDARY_CODEC_INDEX
)paren
(brace
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
id|AC97_RESET
comma
l_int|0
comma
id|codec
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_cs46xx_codec_read
c_func
(paren
id|chip
comma
id|AC97_RESET
comma
id|codec
)paren
op_amp
l_int|0x8000
)paren
(brace
id|snd_printdd
c_func
(paren
l_string|&quot;snd_cs46xx: seconadry codec not present&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
)brace
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
id|AC97_MASTER
comma
l_int|0x8000
comma
id|codec
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|100
suffix:semicolon
op_increment
id|idx
)paren
(brace
r_if
c_cond
(paren
id|snd_cs46xx_codec_read
c_func
(paren
id|chip
comma
id|AC97_MASTER
comma
id|codec
)paren
op_eq
l_int|0x8000
)paren
(brace
id|err
op_assign
id|snd_ac97_mixer
c_func
(paren
id|chip-&gt;ac97_bus
comma
op_amp
id|ac97
comma
op_amp
id|chip-&gt;ac97
(braket
id|codec
)braket
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
op_div
l_int|100
)paren
suffix:semicolon
)brace
id|snd_printdd
c_func
(paren
l_string|&quot;snd_cs46xx: codec %d detection timeout&bslash;n&quot;
comma
id|codec
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
DECL|function|snd_cs46xx_mixer
r_int
id|__devinit
id|snd_cs46xx_mixer
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|snd_card_t
op_star
id|card
op_assign
id|chip-&gt;card
suffix:semicolon
id|snd_ctl_elem_id_t
id|id
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
r_int
id|idx
suffix:semicolon
r_static
id|ac97_bus_ops_t
id|ops
op_assign
(brace
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
dot
id|reset
op_assign
id|snd_cs46xx_codec_reset
comma
macro_line|#endif
dot
id|write
op_assign
id|snd_cs46xx_ac97_write
comma
dot
id|read
op_assign
id|snd_cs46xx_ac97_read
comma
)brace
suffix:semicolon
multiline_comment|/* detect primary codec */
id|chip-&gt;nr_ac97_codecs
op_assign
l_int|0
suffix:semicolon
id|snd_printdd
c_func
(paren
l_string|&quot;snd_cs46xx: detecting primary codec&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_bus
c_func
(paren
id|card
comma
l_int|0
comma
op_amp
id|ops
comma
id|chip
comma
op_amp
id|chip-&gt;ac97_bus
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|chip-&gt;ac97_bus-&gt;private_free
op_assign
id|snd_cs46xx_mixer_free_ac97_bus
suffix:semicolon
r_if
c_cond
(paren
id|cs46xx_detect_codec
c_func
(paren
id|chip
comma
id|CS46XX_PRIMARY_CODEC_INDEX
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|chip-&gt;nr_ac97_codecs
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|snd_printdd
c_func
(paren
l_string|&quot;snd_cs46xx: detecting seconadry codec&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* try detect a secondary codec */
r_if
c_cond
(paren
op_logical_neg
id|cs46xx_detect_codec
c_func
(paren
id|chip
comma
id|CS46XX_SECONDARY_CODEC_INDEX
)paren
)paren
id|chip-&gt;nr_ac97_codecs
op_assign
l_int|2
suffix:semicolon
macro_line|#endif /* CONFIG_SND_CS46XX_NEW_DSP */
multiline_comment|/* add cs4630 mixer controls */
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|ARRAY_SIZE
c_func
(paren
id|snd_cs46xx_controls
)paren
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|snd_kcontrol_t
op_star
id|kctl
suffix:semicolon
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_cs46xx_controls
(braket
id|idx
)braket
comma
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* get EAPD mixer switch (for voyetra hack) */
id|memset
c_func
(paren
op_amp
id|id
comma
l_int|0
comma
r_sizeof
(paren
id|id
)paren
)paren
suffix:semicolon
id|id.iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
suffix:semicolon
id|strcpy
c_func
(paren
id|id.name
comma
l_string|&quot;External Amplifier&quot;
)paren
suffix:semicolon
id|chip-&gt;eapd_switch
op_assign
id|snd_ctl_find_id
c_func
(paren
id|chip-&gt;card
comma
op_amp
id|id
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
r_if
c_cond
(paren
id|chip-&gt;nr_ac97_codecs
op_eq
l_int|1
)paren
(brace
r_int
r_int
id|id2
op_assign
id|chip-&gt;ac97
(braket
id|CS46XX_PRIMARY_CODEC_INDEX
)braket
op_member_access_from_pointer
id|id
op_amp
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|id2
op_eq
l_int|0x592b
op_logical_or
id|id2
op_eq
l_int|0x592d
)paren
(brace
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_cs46xx_front_dup_ctl
comma
id|chip
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_ac97_write_cache
c_func
(paren
id|chip-&gt;ac97
(braket
id|CS46XX_PRIMARY_CODEC_INDEX
)braket
comma
id|AC97_CSR_ACMODE
comma
l_int|0x200
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* do soundcard specific mixer setup */
r_if
c_cond
(paren
id|chip-&gt;mixer_init
)paren
(brace
id|snd_printdd
(paren
l_string|&quot;calling chip-&gt;mixer_init(chip);&bslash;n&quot;
)paren
suffix:semicolon
id|chip
op_member_access_from_pointer
id|mixer_init
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* turn on amplifier */
id|chip
op_member_access_from_pointer
id|amplifier_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  RawMIDI interface&n; */
DECL|function|snd_cs46xx_midi_reset
r_static
r_void
id|snd_cs46xx_midi_reset
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|MIDCR_MRST
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_midi_input_open
r_static
r_int
id|snd_cs46xx_midi_input_open
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|substream-&gt;rmidi-&gt;private_data
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|chip-&gt;uartm
op_or_assign
id|CS46XX_MODE_INPUT
suffix:semicolon
id|chip-&gt;midcr
op_or_assign
id|MIDCR_RXE
suffix:semicolon
id|chip-&gt;midi_input
op_assign
id|substream
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chip-&gt;uartm
op_amp
id|CS46XX_MODE_OUTPUT
)paren
)paren
(brace
id|snd_cs46xx_midi_reset
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_midi_input_close
r_static
r_int
id|snd_cs46xx_midi_input_close
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|substream-&gt;rmidi-&gt;private_data
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|chip-&gt;midcr
op_and_assign
op_complement
(paren
id|MIDCR_RXE
op_or
id|MIDCR_RIE
)paren
suffix:semicolon
id|chip-&gt;midi_input
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chip-&gt;uartm
op_amp
id|CS46XX_MODE_OUTPUT
)paren
)paren
(brace
id|snd_cs46xx_midi_reset
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
id|chip-&gt;uartm
op_and_assign
op_complement
id|CS46XX_MODE_INPUT
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_midi_output_open
r_static
r_int
id|snd_cs46xx_midi_output_open
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|substream-&gt;rmidi-&gt;private_data
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|chip-&gt;uartm
op_or_assign
id|CS46XX_MODE_OUTPUT
suffix:semicolon
id|chip-&gt;midcr
op_or_assign
id|MIDCR_TXE
suffix:semicolon
id|chip-&gt;midi_output
op_assign
id|substream
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chip-&gt;uartm
op_amp
id|CS46XX_MODE_INPUT
)paren
)paren
(brace
id|snd_cs46xx_midi_reset
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_midi_output_close
r_static
r_int
id|snd_cs46xx_midi_output_close
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|substream-&gt;rmidi-&gt;private_data
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|chip-&gt;midcr
op_and_assign
op_complement
(paren
id|MIDCR_TXE
op_or
id|MIDCR_TIE
)paren
suffix:semicolon
id|chip-&gt;midi_output
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chip-&gt;uartm
op_amp
id|CS46XX_MODE_INPUT
)paren
)paren
(brace
id|snd_cs46xx_midi_reset
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
id|chip-&gt;uartm
op_and_assign
op_complement
id|CS46XX_MODE_OUTPUT
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_midi_input_trigger
r_static
r_void
id|snd_cs46xx_midi_input_trigger
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
r_int
id|up
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|cs46xx_t
op_star
id|chip
op_assign
id|substream-&gt;rmidi-&gt;private_data
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|up
)paren
(brace
r_if
c_cond
(paren
(paren
id|chip-&gt;midcr
op_amp
id|MIDCR_RIE
)paren
op_eq
l_int|0
)paren
(brace
id|chip-&gt;midcr
op_or_assign
id|MIDCR_RIE
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|chip-&gt;midcr
op_amp
id|MIDCR_RIE
)paren
(brace
id|chip-&gt;midcr
op_and_assign
op_complement
id|MIDCR_RIE
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_midi_output_trigger
r_static
r_void
id|snd_cs46xx_midi_output_trigger
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
r_int
id|up
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|cs46xx_t
op_star
id|chip
op_assign
id|substream-&gt;rmidi-&gt;private_data
suffix:semicolon
r_int
r_char
id|byte
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|up
)paren
(brace
r_if
c_cond
(paren
(paren
id|chip-&gt;midcr
op_amp
id|MIDCR_TIE
)paren
op_eq
l_int|0
)paren
(brace
id|chip-&gt;midcr
op_or_assign
id|MIDCR_TIE
suffix:semicolon
multiline_comment|/* fill UART FIFO buffer at first, and turn Tx interrupts only if necessary */
r_while
c_loop
(paren
(paren
id|chip-&gt;midcr
op_amp
id|MIDCR_TIE
)paren
op_logical_and
(paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_MIDSR
)paren
op_amp
id|MIDSR_TBF
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|snd_rawmidi_transmit
c_func
(paren
id|substream
comma
op_amp
id|byte
comma
l_int|1
)paren
op_ne
l_int|1
)paren
(brace
id|chip-&gt;midcr
op_and_assign
op_complement
id|MIDCR_TIE
suffix:semicolon
)brace
r_else
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDWP
comma
id|byte
)paren
suffix:semicolon
)brace
)brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|chip-&gt;midcr
op_amp
id|MIDCR_TIE
)paren
(brace
id|chip-&gt;midcr
op_and_assign
op_complement
id|MIDCR_TIE
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|variable|snd_cs46xx_midi_output
r_static
id|snd_rawmidi_ops_t
id|snd_cs46xx_midi_output
op_assign
(brace
dot
id|open
op_assign
id|snd_cs46xx_midi_output_open
comma
dot
id|close
op_assign
id|snd_cs46xx_midi_output_close
comma
dot
id|trigger
op_assign
id|snd_cs46xx_midi_output_trigger
comma
)brace
suffix:semicolon
DECL|variable|snd_cs46xx_midi_input
r_static
id|snd_rawmidi_ops_t
id|snd_cs46xx_midi_input
op_assign
(brace
dot
id|open
op_assign
id|snd_cs46xx_midi_input_open
comma
dot
id|close
op_assign
id|snd_cs46xx_midi_input_close
comma
dot
id|trigger
op_assign
id|snd_cs46xx_midi_input_trigger
comma
)brace
suffix:semicolon
DECL|function|snd_cs46xx_midi
r_int
id|__devinit
id|snd_cs46xx_midi
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
id|device
comma
id|snd_rawmidi_t
op_star
op_star
id|rrawmidi
)paren
(brace
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rrawmidi
)paren
op_star
id|rrawmidi
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_rawmidi_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;CS46XX&quot;
comma
id|device
comma
l_int|1
comma
l_int|1
comma
op_amp
id|rmidi
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|strcpy
c_func
(paren
id|rmidi-&gt;name
comma
l_string|&quot;CS46XX&quot;
)paren
suffix:semicolon
id|snd_rawmidi_set_ops
c_func
(paren
id|rmidi
comma
id|SNDRV_RAWMIDI_STREAM_OUTPUT
comma
op_amp
id|snd_cs46xx_midi_output
)paren
suffix:semicolon
id|snd_rawmidi_set_ops
c_func
(paren
id|rmidi
comma
id|SNDRV_RAWMIDI_STREAM_INPUT
comma
op_amp
id|snd_cs46xx_midi_input
)paren
suffix:semicolon
id|rmidi-&gt;info_flags
op_or_assign
id|SNDRV_RAWMIDI_INFO_OUTPUT
op_or
id|SNDRV_RAWMIDI_INFO_INPUT
op_or
id|SNDRV_RAWMIDI_INFO_DUPLEX
suffix:semicolon
id|rmidi-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|chip-&gt;rmidi
op_assign
id|rmidi
suffix:semicolon
r_if
c_cond
(paren
id|rrawmidi
)paren
op_star
id|rrawmidi
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * gameport interface&n; */
macro_line|#if defined(CONFIG_GAMEPORT) || (defined(MODULE) &amp;&amp; defined(CONFIG_GAMEPORT_MODULE))
DECL|struct|snd_cs46xx_gameport
r_typedef
r_struct
id|snd_cs46xx_gameport
(brace
DECL|member|info
r_struct
id|gameport
id|info
suffix:semicolon
DECL|member|chip
id|cs46xx_t
op_star
id|chip
suffix:semicolon
DECL|typedef|cs46xx_gameport_t
)brace
id|cs46xx_gameport_t
suffix:semicolon
DECL|function|snd_cs46xx_gameport_trigger
r_static
r_void
id|snd_cs46xx_gameport_trigger
c_func
(paren
r_struct
id|gameport
op_star
id|gameport
)paren
(brace
id|cs46xx_gameport_t
op_star
id|gp
op_assign
(paren
id|cs46xx_gameport_t
op_star
)paren
id|gameport
suffix:semicolon
id|cs46xx_t
op_star
id|chip
suffix:semicolon
id|snd_assert
c_func
(paren
id|gp
comma
r_return
)paren
suffix:semicolon
id|chip
op_assign
id|gp-&gt;chip
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_JSPT
comma
l_int|0xFF
)paren
suffix:semicolon
singleline_comment|//outb(gameport-&gt;io, 0xFF);
)brace
DECL|function|snd_cs46xx_gameport_read
r_static
r_int
r_char
id|snd_cs46xx_gameport_read
c_func
(paren
r_struct
id|gameport
op_star
id|gameport
)paren
(brace
id|cs46xx_gameport_t
op_star
id|gp
op_assign
(paren
id|cs46xx_gameport_t
op_star
)paren
id|gameport
suffix:semicolon
id|cs46xx_t
op_star
id|chip
suffix:semicolon
id|snd_assert
c_func
(paren
id|gp
comma
r_return
l_int|0
)paren
suffix:semicolon
id|chip
op_assign
id|gp-&gt;chip
suffix:semicolon
r_return
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_JSPT
)paren
suffix:semicolon
singleline_comment|//inb(gameport-&gt;io);
)brace
DECL|function|snd_cs46xx_gameport_cooked_read
r_static
r_int
id|snd_cs46xx_gameport_cooked_read
c_func
(paren
r_struct
id|gameport
op_star
id|gameport
comma
r_int
op_star
id|axes
comma
r_int
op_star
id|buttons
)paren
(brace
id|cs46xx_gameport_t
op_star
id|gp
op_assign
(paren
id|cs46xx_gameport_t
op_star
)paren
id|gameport
suffix:semicolon
id|cs46xx_t
op_star
id|chip
suffix:semicolon
r_int
id|js1
comma
id|js2
comma
id|jst
suffix:semicolon
id|snd_assert
c_func
(paren
id|gp
comma
r_return
l_int|0
)paren
suffix:semicolon
id|chip
op_assign
id|gp-&gt;chip
suffix:semicolon
id|js1
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_JSC1
)paren
suffix:semicolon
id|js2
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_JSC2
)paren
suffix:semicolon
id|jst
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_JSPT
)paren
suffix:semicolon
op_star
id|buttons
op_assign
(paren
op_complement
id|jst
op_rshift
l_int|4
)paren
op_amp
l_int|0x0F
suffix:semicolon
id|axes
(braket
l_int|0
)braket
op_assign
(paren
(paren
id|js1
op_amp
id|JSC1_Y1V_MASK
)paren
op_rshift
id|JSC1_Y1V_SHIFT
)paren
op_amp
l_int|0xFFFF
suffix:semicolon
id|axes
(braket
l_int|1
)braket
op_assign
(paren
(paren
id|js1
op_amp
id|JSC1_X1V_MASK
)paren
op_rshift
id|JSC1_X1V_SHIFT
)paren
op_amp
l_int|0xFFFF
suffix:semicolon
id|axes
(braket
l_int|2
)braket
op_assign
(paren
(paren
id|js2
op_amp
id|JSC2_Y2V_MASK
)paren
op_rshift
id|JSC2_Y2V_SHIFT
)paren
op_amp
l_int|0xFFFF
suffix:semicolon
id|axes
(braket
l_int|3
)braket
op_assign
(paren
(paren
id|js2
op_amp
id|JSC2_X2V_MASK
)paren
op_rshift
id|JSC2_X2V_SHIFT
)paren
op_amp
l_int|0xFFFF
suffix:semicolon
r_for
c_loop
(paren
id|jst
op_assign
l_int|0
suffix:semicolon
id|jst
OL
l_int|4
suffix:semicolon
op_increment
id|jst
)paren
r_if
c_cond
(paren
id|axes
(braket
id|jst
)braket
op_eq
l_int|0xFFFF
)paren
(brace
id|axes
(braket
id|jst
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_gameport_open
r_static
r_int
id|snd_cs46xx_gameport_open
c_func
(paren
r_struct
id|gameport
op_star
id|gameport
comma
r_int
id|mode
)paren
(brace
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|GAMEPORT_MODE_COOKED
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|GAMEPORT_MODE_RAW
suffix:colon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_gameport
r_void
id|__devinit
id|snd_cs46xx_gameport
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|cs46xx_gameport_t
op_star
id|gp
suffix:semicolon
id|gp
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|gp
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gp
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;cannot allocate gameport area&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memset
c_func
(paren
id|gp
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|gp
)paren
)paren
suffix:semicolon
id|gp-&gt;info.open
op_assign
id|snd_cs46xx_gameport_open
suffix:semicolon
id|gp-&gt;info.read
op_assign
id|snd_cs46xx_gameport_read
suffix:semicolon
id|gp-&gt;info.trigger
op_assign
id|snd_cs46xx_gameport_trigger
suffix:semicolon
id|gp-&gt;info.cooked_read
op_assign
id|snd_cs46xx_gameport_cooked_read
suffix:semicolon
id|gp-&gt;chip
op_assign
id|chip
suffix:semicolon
id|chip-&gt;gameport
op_assign
id|gp
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_JSIO
comma
l_int|0xFF
)paren
suffix:semicolon
singleline_comment|// ?
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_JSCTL
comma
id|JSCTL_SP_MEDIUM_SLOW
)paren
suffix:semicolon
id|gameport_register_port
c_func
(paren
op_amp
id|gp-&gt;info
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|function|snd_cs46xx_gameport
r_void
id|__devinit
id|snd_cs46xx_gameport
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
)brace
macro_line|#endif /* CONFIG_GAMEPORT */
multiline_comment|/*&n; *  proc interface&n; */
DECL|function|snd_cs46xx_io_read
r_static
r_int
id|snd_cs46xx_io_read
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
r_void
op_star
id|file_private_data
comma
r_struct
id|file
op_star
id|file
comma
r_char
id|__user
op_star
id|buf
comma
r_int
r_int
id|count
comma
r_int
r_int
id|pos
)paren
(brace
r_int
id|size
suffix:semicolon
id|snd_cs46xx_region_t
op_star
id|region
op_assign
(paren
id|snd_cs46xx_region_t
op_star
)paren
id|entry-&gt;private_data
suffix:semicolon
id|size
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|pos
op_plus
(paren
r_int
)paren
id|size
OG
id|region-&gt;size
)paren
id|size
op_assign
id|region-&gt;size
op_minus
id|pos
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user_fromio
c_func
(paren
id|buf
comma
id|region-&gt;remap_addr
op_plus
id|pos
comma
id|size
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
id|size
suffix:semicolon
)brace
DECL|variable|snd_cs46xx_proc_io_ops
r_static
r_struct
id|snd_info_entry_ops
id|snd_cs46xx_proc_io_ops
op_assign
(brace
dot
id|read
op_assign
id|snd_cs46xx_io_read
comma
)brace
suffix:semicolon
DECL|function|snd_cs46xx_proc_init
r_static
r_int
id|__devinit
id|snd_cs46xx_proc_init
c_func
(paren
id|snd_card_t
op_star
id|card
comma
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|snd_info_entry_t
op_star
id|entry
suffix:semicolon
r_int
id|idx
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|5
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|snd_cs46xx_region_t
op_star
id|region
op_assign
op_amp
id|chip-&gt;region.idx
(braket
id|idx
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_card_proc_new
c_func
(paren
id|card
comma
id|region-&gt;name
comma
op_amp
id|entry
)paren
)paren
(brace
id|entry-&gt;content
op_assign
id|SNDRV_INFO_CONTENT_DATA
suffix:semicolon
id|entry-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|entry-&gt;c.ops
op_assign
op_amp
id|snd_cs46xx_proc_io_ops
suffix:semicolon
id|entry-&gt;size
op_assign
id|region-&gt;size
suffix:semicolon
id|entry-&gt;mode
op_assign
id|S_IFREG
op_or
id|S_IRUSR
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|cs46xx_dsp_proc_init
c_func
(paren
id|card
comma
id|chip
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_proc_done
r_static
r_int
id|snd_cs46xx_proc_done
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|cs46xx_dsp_proc_done
c_func
(paren
id|chip
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * stop the h/w&n; */
DECL|function|snd_cs46xx_hw_stop
r_static
r_void
id|snd_cs46xx_hw_stop
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_PFIE
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
l_int|0x0000f03f
suffix:semicolon
id|tmp
op_or_assign
l_int|0x00000010
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PFIE
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* playback interrupt disable */
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_CIE
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
l_int|0x0000003f
suffix:semicolon
id|tmp
op_or_assign
l_int|0x00000011
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CIE
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* capture interrupt disable */
multiline_comment|/*&n;         *  Stop playback DMA.&n;&t; */
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_PCTL
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PCTL
comma
id|tmp
op_amp
l_int|0x0000ffff
)paren
suffix:semicolon
multiline_comment|/*&n;         *  Stop capture DMA.&n;&t; */
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_CCTL
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CCTL
comma
id|tmp
op_amp
l_int|0xffff0000
)paren
suffix:semicolon
multiline_comment|/*&n;         *  Reset the processor.&n;         */
id|snd_cs46xx_reset
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_cs46xx_proc_stop
c_func
(paren
id|chip
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Power down the PLL.&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Turn off the Processor by turning off the software clock enable flag in &n;&t; *  the clock control register.&n;&t; */
id|tmp
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
)paren
op_amp
op_complement
id|CLKCR1_SWCE
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
id|tmp
)paren
suffix:semicolon
)brace
DECL|function|snd_cs46xx_free
r_static
r_int
id|snd_cs46xx_free
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
r_int
id|idx
suffix:semicolon
id|snd_assert
c_func
(paren
id|chip
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;active_ctrl
)paren
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
macro_line|#if defined(CONFIG_GAMEPORT) || (defined(MODULE) &amp;&amp; defined(CONFIG_GAMEPORT_MODULE))
r_if
c_cond
(paren
id|chip-&gt;gameport
)paren
(brace
id|gameport_unregister_port
c_func
(paren
op_amp
id|chip-&gt;gameport-&gt;info
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|chip-&gt;gameport
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|chip-&gt;amplifier_ctrl
)paren
id|chip
op_member_access_from_pointer
id|amplifier_ctrl
c_func
(paren
id|chip
comma
op_minus
id|chip-&gt;amplifier
)paren
suffix:semicolon
multiline_comment|/* force to off */
id|snd_cs46xx_proc_done
c_func
(paren
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;region.idx
(braket
l_int|0
)braket
dot
id|resource
)paren
id|snd_cs46xx_hw_stop
c_func
(paren
id|chip
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|5
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|snd_cs46xx_region_t
op_star
id|region
op_assign
op_amp
id|chip-&gt;region.idx
(braket
id|idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|region-&gt;remap_addr
)paren
id|iounmap
c_func
(paren
id|region-&gt;remap_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|region-&gt;resource
)paren
(brace
id|release_resource
c_func
(paren
id|region-&gt;resource
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|region-&gt;resource
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|chip-&gt;irq
op_ge
l_int|0
)paren
id|free_irq
c_func
(paren
id|chip-&gt;irq
comma
(paren
r_void
op_star
)paren
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;active_ctrl
)paren
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
op_minus
id|chip-&gt;amplifier
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
r_if
c_cond
(paren
id|chip-&gt;dsp_spos_instance
)paren
(brace
id|cs46xx_dsp_spos_destroy
c_func
(paren
id|chip
)paren
suffix:semicolon
id|chip-&gt;dsp_spos_instance
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif
id|pci_disable_device
c_func
(paren
id|chip-&gt;pci
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_dev_free
r_static
r_int
id|snd_cs46xx_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|device-&gt;device_data
suffix:semicolon
r_return
id|snd_cs46xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  initialize chip&n; */
DECL|function|snd_cs46xx_chip_init
r_static
r_int
id|snd_cs46xx_chip_init
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
r_int
id|timeout
suffix:semicolon
multiline_comment|/* &n;&t; *  First, blast the clock control register to zero so that the PLL starts&n;         *  out in a known state, and blast the master serial port control register&n;         *  to zero so that the serial ports also start out in a known state.&n;         */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
l_int|0
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERMC1
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  If we are in AC97 mode, then we must set the part to a host controlled&n;         *  AC-link.  Otherwise, we won&squot;t be able to bring up the link.&n;         */
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERACC
comma
id|SERACC_HSP
op_or
id|SERACC_CHIP_TYPE_2_0
op_or
id|SERACC_TWO_CODECS
)paren
suffix:semicolon
multiline_comment|/* 2.00 dual codecs */
multiline_comment|/* snd_cs46xx_pokeBA0(chip, BA0_SERACC, SERACC_HSP | SERACC_CHIP_TYPE_2_0); */
multiline_comment|/* 2.00 codec */
macro_line|#else
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERACC
comma
id|SERACC_HSP
op_or
id|SERACC_CHIP_TYPE_1_03
)paren
suffix:semicolon
multiline_comment|/* 1.03 codec */
macro_line|#endif
multiline_comment|/*&n;         *  Drive the ARST# pin low for a minimum of 1uS (as defined in the AC97&n;         *  spec) and then drive it high.  This is done for non AC97 modes since&n;         *  there might be logic external to the CS461x that uses the ARST# line&n;         *  for a reset.&n;         */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL2
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
id|ACCTL_RSTN
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL2
comma
id|ACCTL_RSTN
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; *  The first thing we do here is to enable sync generation.  As soon&n;&t; *  as we start receiving bit clock, we&squot;ll start producing the SYNC&n;&t; *  signal.&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
id|ACCTL_ESYN
op_or
id|ACCTL_RSTN
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL2
comma
id|ACCTL_ESYN
op_or
id|ACCTL_RSTN
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; *  Now wait for a short while to allow the AC97 part to start&n;&t; *  generating bit clock (so we don&squot;t try to start the PLL without an&n;&t; *  input clock).&n;&t; */
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Set the serial port timing configuration, so that&n;&t; *  the clock control circuit gets its clock from the correct place.&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERMC1
comma
id|SERMC1_PTC_AC97
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Write the selected clock control setup to the hardware.  Do not turn on&n;&t; *  SWCE yet (if requested), so that the devices clocked by the output of&n;&t; *  PLL are not clocked until the PLL is stable.&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_PLLCC
comma
id|PLLCC_LPF_1050_2780_KHZ
op_or
id|PLLCC_CDR_73_104_MHZ
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_PLLM
comma
l_int|0x3a
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR2
comma
id|CLKCR2_PDIVS_8
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Power up the PLL.&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
id|CLKCR1_PLLP
)paren
suffix:semicolon
multiline_comment|/*&n;         *  Wait until the PLL has stabilized.&n;&t; */
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
op_div
l_int|10
)paren
suffix:semicolon
multiline_comment|/* 100ms */
multiline_comment|/*&n;&t; *  Turn on clocking of the core so that we can setup the serial ports.&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
id|CLKCR1_PLLP
op_or
id|CLKCR1_SWCE
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Enable FIFO  Host Bypass&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERBCF
comma
id|SERBCF_HBP
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Fill the serial port FIFOs with silence.&n;&t; */
id|snd_cs46xx_clear_serial_FIFOs
c_func
(paren
id|chip
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Set the serial port FIFO pointer to the first sample in the FIFO.&n;&t; */
multiline_comment|/* snd_cs46xx_pokeBA0(chip, BA0_SERBSP, 0); */
multiline_comment|/*&n;&t; *  Write the serial port configuration to the part.  The master&n;&t; *  enable bit is not set until all other values have been written.&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERC1
comma
id|SERC1_SO1F_AC97
op_or
id|SERC1_SO1EN
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERC2
comma
id|SERC2_SI1F_AC97
op_or
id|SERC1_SO1EN
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERMC1
comma
id|SERMC1_PTC_AC97
op_or
id|SERMC1_MSPE
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERC7
comma
id|SERC7_ASDI2EN
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERC3
comma
l_int|0
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERC4
comma
l_int|0
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERC5
comma
l_int|0
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERC6
comma
l_int|1
)paren
suffix:semicolon
macro_line|#endif
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Wait for the codec ready signal from the AC97 codec.&n;&t; */
id|timeout
op_assign
l_int|150
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_decrement
OG
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t; *  Read the AC97 status register to see if we&squot;ve seen a CODEC READY&n;&t;&t; *  signal from the AC97 codec.&n;&t;&t; */
r_if
c_cond
(paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACSTS
)paren
op_amp
id|ACSTS_CRDY
)paren
r_goto
id|ok1
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
(paren
id|HZ
op_plus
l_int|99
)paren
op_div
l_int|100
)paren
suffix:semicolon
)brace
id|snd_printk
c_func
(paren
l_string|&quot;create - never read codec ready from AC&squot;97&bslash;n&quot;
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;it is not probably bug, try to use CS4236 driver&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
id|ok1
suffix:colon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
(brace
r_int
id|count
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
l_int|150
suffix:semicolon
id|count
op_increment
)paren
(brace
multiline_comment|/* First, we want to wait for a short time. */
id|udelay
c_func
(paren
l_int|25
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACSTS2
)paren
op_amp
id|ACSTS_CRDY
)paren
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; *  Make sure CODEC is READY.&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACSTS2
)paren
op_amp
id|ACSTS_CRDY
)paren
)paren
id|snd_printdd
c_func
(paren
l_string|&quot;cs46xx: never read card ready from secondary AC&squot;97&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n;&t; *  Assert the vaid frame signal so that we can start sending commands&n;&t; *  to the AC97 codec.&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
id|ACCTL_VFRM
op_or
id|ACCTL_ESYN
op_or
id|ACCTL_RSTN
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL2
comma
id|ACCTL_VFRM
op_or
id|ACCTL_ESYN
op_or
id|ACCTL_RSTN
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; *  Wait until we&squot;ve sampled input slots 3 and 4 as valid, meaning that&n;&t; *  the codec is pumping ADC data across the AC-link.&n;&t; */
id|timeout
op_assign
l_int|150
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_decrement
OG
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t; *  Read the input slot valid register and see if input slots 3 and&n;&t;&t; *  4 are valid yet.&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACISV
)paren
op_amp
(paren
id|ACISV_ISV3
op_or
id|ACISV_ISV4
)paren
)paren
op_eq
(paren
id|ACISV_ISV3
op_or
id|ACISV_ISV4
)paren
)paren
r_goto
id|ok2
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
(paren
id|HZ
op_plus
l_int|99
)paren
op_div
l_int|100
)paren
suffix:semicolon
)brace
macro_line|#ifndef CONFIG_SND_CS46XX_NEW_DSP
id|snd_printk
c_func
(paren
l_string|&quot;create - never read ISV3 &amp; ISV4 from AC&squot;97&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
macro_line|#else
multiline_comment|/* This may happen on a cold boot with a Terratec SiXPack 5.1.&n;&t;   Reloading the driver may help, if there&squot;s other soundcards &n;&t;   with the same problem I would like to know. (Benny) */
id|snd_printk
c_func
(paren
l_string|&quot;ERROR: snd-cs46xx: never read ISV3 &amp; ISV4 from AC&squot;97&bslash;n&quot;
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;       Try reloading the ALSA driver, if you find something&bslash;n&quot;
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;       broken or not working on your soundcard upon&bslash;n&quot;
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;       this message please report to alsa-devel@lists.sourceforge.net&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
macro_line|#endif
id|ok2
suffix:colon
multiline_comment|/*&n;&t; *  Now, assert valid frame and the slot 3 and 4 valid bits.  This will&n;&t; *  commense the transfer of digital audio data to the AC97 codec.&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACOSV
comma
id|ACOSV_SLV3
op_or
id|ACOSV_SLV4
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Power down the DAC and ADC.  We will power them up (if) when we need&n;&t; *  them.&n;&t; */
multiline_comment|/* snd_cs46xx_pokeBA0(chip, BA0_AC97_POWERDOWN, 0x300); */
multiline_comment|/*&n;&t; *  Turn off the Processor by turning off the software clock enable flag in &n;&t; *  the clock control register.&n;&t; */
multiline_comment|/* tmp = snd_cs46xx_peekBA0(chip, BA0_CLKCR1) &amp; ~CLKCR1_SWCE; */
multiline_comment|/* snd_cs46xx_pokeBA0(chip, BA0_CLKCR1, tmp); */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  start and load DSP &n; */
DECL|function|snd_cs46xx_start_dsp
r_int
id|__devinit
id|snd_cs46xx_start_dsp
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
multiline_comment|/*&n;&t; *  Reset the processor.&n;&t; */
id|snd_cs46xx_reset
c_func
(paren
id|chip
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Download the image to the processor.&n;&t; */
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
macro_line|#if 0
r_if
c_cond
(paren
id|cs46xx_dsp_load_module
c_func
(paren
id|chip
comma
op_amp
id|cwcemb80_module
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;image download error&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|cs46xx_dsp_load_module
c_func
(paren
id|chip
comma
op_amp
id|cwc4630_module
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;image download error [cwc4630]&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs46xx_dsp_load_module
c_func
(paren
id|chip
comma
op_amp
id|cwcasync_module
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;image download error [cwcasync]&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs46xx_dsp_load_module
c_func
(paren
id|chip
comma
op_amp
id|cwcsnoop_module
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;image download error [cwcsnoop]&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs46xx_dsp_load_module
c_func
(paren
id|chip
comma
op_amp
id|cwcbinhack_module
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;image download error [cwcbinhack]&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs46xx_dsp_load_module
c_func
(paren
id|chip
comma
op_amp
id|cwcdma_module
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;image download error [cwcdma]&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cs46xx_dsp_scb_and_task_init
c_func
(paren
id|chip
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
macro_line|#else
multiline_comment|/* old image */
r_if
c_cond
(paren
id|snd_cs46xx_download_image
c_func
(paren
id|chip
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;image download error&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/*&n;         *  Stop playback DMA.&n;&t; */
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_PCTL
)paren
suffix:semicolon
id|chip-&gt;play_ctl
op_assign
id|tmp
op_amp
l_int|0xffff0000
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PCTL
comma
id|tmp
op_amp
l_int|0x0000ffff
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;         *  Stop capture DMA.&n;&t; */
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_CCTL
)paren
suffix:semicolon
id|chip-&gt;capt.ctl
op_assign
id|tmp
op_amp
l_int|0x0000ffff
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CCTL
comma
id|tmp
op_amp
l_int|0xffff0000
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|snd_cs46xx_set_play_sample_rate
c_func
(paren
id|chip
comma
l_int|8000
)paren
suffix:semicolon
id|snd_cs46xx_set_capture_sample_rate
c_func
(paren
id|chip
comma
l_int|8000
)paren
suffix:semicolon
id|snd_cs46xx_proc_start
c_func
(paren
id|chip
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Enable interrupts on the part.&n;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_HICR
comma
id|HICR_IEV
op_or
id|HICR_CHGM
)paren
suffix:semicolon
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_PFIE
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
l_int|0x0000f03f
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PFIE
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* playback interrupt enable */
id|tmp
op_assign
id|snd_cs46xx_peek
c_func
(paren
id|chip
comma
id|BA1_CIE
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
l_int|0x0000003f
suffix:semicolon
id|tmp
op_or_assign
l_int|0x00000001
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CIE
comma
id|tmp
)paren
suffix:semicolon
multiline_comment|/* capture interrupt enable */
macro_line|#ifndef CONFIG_SND_CS46XX_NEW_DSP
multiline_comment|/* set the attenuation to 0dB */
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_PVOL
comma
l_int|0x80008000
)paren
suffix:semicolon
id|snd_cs46xx_poke
c_func
(paren
id|chip
comma
id|BA1_CVOL
comma
l_int|0x80008000
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;AMP control - null AMP&n; */
DECL|function|amp_none
r_static
r_void
id|amp_none
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
id|change
)paren
(brace
)brace
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
DECL|function|voyetra_setup_eapd_slot
r_static
r_int
id|voyetra_setup_eapd_slot
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|u32
id|idx
comma
id|valid_slots
comma
id|tmp
comma
id|powerdown
op_assign
l_int|0
suffix:semicolon
id|u16
id|modem_power
comma
id|pin_config
comma
id|logic_type
suffix:semicolon
id|snd_printdd
(paren
l_string|&quot;cs46xx: cs46xx_setup_eapd_slot()+&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  See if the devices are powered down.  If so, we must power them up first&n;&t; *  or they will not respond.&n;&t; */
id|tmp
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tmp
op_amp
id|CLKCR1_SWCE
)paren
)paren
(brace
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
id|tmp
op_or
id|CLKCR1_SWCE
)paren
suffix:semicolon
id|powerdown
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Clear PRA.  The Bonzo chip will be used for GPIO not for modem&n;&t; * stuff.&n;&t; */
r_if
c_cond
(paren
id|chip-&gt;nr_ac97_codecs
op_ne
l_int|2
)paren
(brace
id|snd_printk
(paren
id|KERN_ERR
l_string|&quot;cs46xx: cs46xx_setup_eapd_slot() - no secondary codec configured&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|modem_power
op_assign
id|snd_cs46xx_codec_read
(paren
id|chip
comma
id|AC97_EXTENDED_MSTATUS
comma
id|CS46XX_SECONDARY_CODEC_INDEX
)paren
suffix:semicolon
id|modem_power
op_and_assign
l_int|0xFEFF
suffix:semicolon
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
id|AC97_EXTENDED_MSTATUS
comma
id|modem_power
comma
id|CS46XX_SECONDARY_CODEC_INDEX
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Set GPIO pin&squot;s 7 and 8 so that they are configured for output.&n;&t; */
id|pin_config
op_assign
id|snd_cs46xx_codec_read
(paren
id|chip
comma
id|AC97_GPIO_CFG
comma
id|CS46XX_SECONDARY_CODEC_INDEX
)paren
suffix:semicolon
id|pin_config
op_and_assign
l_int|0x27F
suffix:semicolon
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
id|AC97_GPIO_CFG
comma
id|pin_config
comma
id|CS46XX_SECONDARY_CODEC_INDEX
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Set GPIO pin&squot;s 7 and 8 so that they are compatible with CMOS logic.&n;&t; */
id|logic_type
op_assign
id|snd_cs46xx_codec_read
c_func
(paren
id|chip
comma
id|AC97_GPIO_POLARITY
comma
id|CS46XX_SECONDARY_CODEC_INDEX
)paren
suffix:semicolon
id|logic_type
op_and_assign
l_int|0x27F
suffix:semicolon
id|snd_cs46xx_codec_write
(paren
id|chip
comma
id|AC97_GPIO_POLARITY
comma
id|logic_type
comma
id|CS46XX_SECONDARY_CODEC_INDEX
)paren
suffix:semicolon
id|valid_slots
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACOSV
)paren
suffix:semicolon
id|valid_slots
op_or_assign
l_int|0x200
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACOSV
comma
id|valid_slots
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cs46xx_wait_for_fifo
c_func
(paren
id|chip
comma
l_int|1
)paren
)paren
(brace
id|snd_printdd
c_func
(paren
l_string|&quot;FIFO is busy&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Fill slots 12 with the correct value for the GPIO pins. &n;&t; */
r_for
c_loop
(paren
id|idx
op_assign
l_int|0x90
suffix:semicolon
id|idx
op_le
l_int|0x9F
suffix:semicolon
id|idx
op_increment
)paren
(brace
multiline_comment|/*&n;&t;&t; * Initialize the fifo so that bits 7 and 8 are on.&n;&t;&t; *&n;&t;&t; * Remember that the GPIO pins in bonzo are shifted by 4 bits to&n;&t;&t; * the left.  0x1800 corresponds to bits 7 and 8.&n;&t;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERBWP
comma
l_int|0x1800
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Wait for command to complete&n;&t;&t; */
r_if
c_cond
(paren
id|cs46xx_wait_for_fifo
c_func
(paren
id|chip
comma
l_int|200
)paren
)paren
(brace
id|snd_printdd
c_func
(paren
l_string|&quot;failed waiting for FIFO at addr (%02X)&bslash;n&quot;
comma
id|idx
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Write the serial port FIFO index.&n;&t;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERBAD
comma
id|idx
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Tell the serial port to load the new value into the FIFO location.&n;&t;&t; */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERBCM
comma
id|SERBCM_WRC
)paren
suffix:semicolon
)brace
multiline_comment|/* wait for last command to complete */
id|cs46xx_wait_for_fifo
c_func
(paren
id|chip
comma
l_int|200
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Now, if we powered up the devices, then power them back down again.&n;&t; *  This is kinda ugly, but should never happen.&n;&t; */
r_if
c_cond
(paren
id|powerdown
)paren
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
id|tmp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; *&t;Crystal EAPD mode&n; */
DECL|function|amp_voyetra
r_static
r_void
id|amp_voyetra
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
id|change
)paren
(brace
multiline_comment|/* Manage the EAPD bit on the Crystal 4297 &n;&t;   and the Analog AD1885 */
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
r_int
id|old
op_assign
id|chip-&gt;amplifier
suffix:semicolon
macro_line|#endif
r_int
id|oval
comma
id|val
suffix:semicolon
id|chip-&gt;amplifier
op_add_assign
id|change
suffix:semicolon
id|oval
op_assign
id|snd_cs46xx_codec_read
c_func
(paren
id|chip
comma
id|AC97_POWERDOWN
comma
id|CS46XX_PRIMARY_CODEC_INDEX
)paren
suffix:semicolon
id|val
op_assign
id|oval
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;amplifier
)paren
(brace
multiline_comment|/* Turn the EAPD amp on */
id|val
op_or_assign
l_int|0x8000
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Turn the EAPD amp off */
id|val
op_and_assign
op_complement
l_int|0x8000
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_ne
id|oval
)paren
(brace
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
id|AC97_POWERDOWN
comma
id|val
comma
id|CS46XX_PRIMARY_CODEC_INDEX
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;eapd_switch
)paren
id|snd_ctl_notify
c_func
(paren
id|chip-&gt;card
comma
id|SNDRV_CTL_EVENT_MASK_VALUE
comma
op_amp
id|chip-&gt;eapd_switch-&gt;id
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
r_if
c_cond
(paren
id|chip-&gt;amplifier
op_logical_and
op_logical_neg
id|old
)paren
(brace
id|voyetra_setup_eapd_slot
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
DECL|function|hercules_init
r_static
r_void
id|hercules_init
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
multiline_comment|/* default: AMP off, and SPDIF input optical */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIODR
comma
id|EGPIODR_GPOE0
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIOPTR
comma
id|EGPIODR_GPOE0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;Game Theatre XP card - EGPIO[2] is used to enable the external amp.&n; */
DECL|function|amp_hercules
r_static
r_void
id|amp_hercules
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
id|change
)paren
(brace
r_int
id|old
op_assign
id|chip-&gt;amplifier
suffix:semicolon
r_int
id|val1
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIODR
)paren
suffix:semicolon
r_int
id|val2
op_assign
id|snd_cs46xx_peekBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIOPTR
)paren
suffix:semicolon
id|chip-&gt;amplifier
op_add_assign
id|change
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;amplifier
op_logical_and
op_logical_neg
id|old
)paren
(brace
id|snd_printdd
(paren
l_string|&quot;Hercules amplifier ON&bslash;n&quot;
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIODR
comma
id|EGPIODR_GPOE2
op_or
id|val1
)paren
suffix:semicolon
multiline_comment|/* enable EGPIO2 output */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIOPTR
comma
id|EGPIOPTR_GPPT2
op_or
id|val2
)paren
suffix:semicolon
multiline_comment|/* open-drain on output */
)brace
r_else
r_if
c_cond
(paren
id|old
op_logical_and
op_logical_neg
id|chip-&gt;amplifier
)paren
(brace
id|snd_printdd
(paren
l_string|&quot;Hercules amplifier OFF&bslash;n&quot;
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIODR
comma
id|val1
op_amp
op_complement
id|EGPIODR_GPOE2
)paren
suffix:semicolon
multiline_comment|/* disable */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIOPTR
comma
id|val2
op_amp
op_complement
id|EGPIOPTR_GPPT2
)paren
suffix:semicolon
multiline_comment|/* disable */
)brace
)brace
DECL|function|voyetra_mixer_init
r_static
r_void
id|voyetra_mixer_init
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|snd_printdd
(paren
l_string|&quot;initializing Voyetra mixer&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Enable SPDIF out */
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIODR
comma
id|EGPIODR_GPOE0
)paren
suffix:semicolon
id|snd_cs46xx_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_EGPIOPTR
comma
id|EGPIODR_GPOE0
)paren
suffix:semicolon
)brace
DECL|function|hercules_mixer_init
r_static
r_void
id|hercules_mixer_init
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
r_int
r_int
id|idx
suffix:semicolon
r_int
id|err
suffix:semicolon
id|snd_card_t
op_star
id|card
op_assign
id|chip-&gt;card
suffix:semicolon
macro_line|#endif
multiline_comment|/* set EGPIO to default */
id|hercules_init
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_printdd
(paren
l_string|&quot;initializing Hercules mixer&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|ARRAY_SIZE
c_func
(paren
id|snd_hercules_controls
)paren
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|snd_kcontrol_t
op_star
id|kctl
suffix:semicolon
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_hercules_controls
(braket
id|idx
)braket
comma
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
(paren
id|KERN_ERR
l_string|&quot;cs46xx: failed to initialize Hercules mixer (%d)&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
macro_line|#endif
)brace
macro_line|#if 0
multiline_comment|/*&n; *&t;Untested&n; */
r_static
r_void
id|amp_voyetra_4294
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
id|change
)paren
(brace
id|chip-&gt;amplifier
op_add_assign
id|change
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;amplifier
)paren
(brace
multiline_comment|/* Switch the GPIO pins 7 and 8 to open drain */
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
l_int|0x4C
comma
id|snd_cs46xx_codec_read
c_func
(paren
id|chip
comma
l_int|0x4C
)paren
op_amp
l_int|0xFE7F
)paren
suffix:semicolon
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
l_int|0x4E
comma
id|snd_cs46xx_codec_read
c_func
(paren
id|chip
comma
l_int|0x4E
)paren
op_or
l_int|0x0180
)paren
suffix:semicolon
multiline_comment|/* Now wake the AMP (this might be backwards) */
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
l_int|0x54
comma
id|snd_cs46xx_codec_read
c_func
(paren
id|chip
comma
l_int|0x54
)paren
op_amp
op_complement
l_int|0x0180
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
l_int|0x54
comma
id|snd_cs46xx_codec_read
c_func
(paren
id|chip
comma
l_int|0x54
)paren
op_or
l_int|0x0180
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/*&n; * piix4 pci ids&n; */
macro_line|#ifndef PCI_VENDOR_ID_INTEL
DECL|macro|PCI_VENDOR_ID_INTEL
mdefine_line|#define PCI_VENDOR_ID_INTEL 0x8086
macro_line|#endif /* PCI_VENDOR_ID_INTEL */
macro_line|#ifndef PCI_DEVICE_ID_INTEL_82371AB_3
DECL|macro|PCI_DEVICE_ID_INTEL_82371AB_3
mdefine_line|#define PCI_DEVICE_ID_INTEL_82371AB_3 0x7113
macro_line|#endif /* PCI_DEVICE_ID_INTEL_82371AB_3 */
multiline_comment|/*&n; *&t;Handle the CLKRUN on a thinkpad. We must disable CLKRUN support&n; *&t;whenever we need to beat on the chip.&n; *&n; *&t;The original idea and code for this hack comes from David Kaiser at&n; *&t;Linuxcare. Perhaps one day Crystal will document their chips well&n; *&t;enough to make them useful.&n; */
DECL|function|clkrun_hack
r_static
r_void
id|clkrun_hack
c_func
(paren
id|cs46xx_t
op_star
id|chip
comma
r_int
id|change
)paren
(brace
id|u16
id|control
comma
id|nval
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;acpi_dev
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|chip-&gt;amplifier
op_add_assign
id|change
suffix:semicolon
multiline_comment|/* Read ACPI port */
id|nval
op_assign
id|control
op_assign
id|inw
c_func
(paren
id|chip-&gt;acpi_port
op_plus
l_int|0x10
)paren
suffix:semicolon
multiline_comment|/* Flip CLKRUN off while running */
r_if
c_cond
(paren
op_logical_neg
id|chip-&gt;amplifier
)paren
id|nval
op_or_assign
l_int|0x2000
suffix:semicolon
r_else
id|nval
op_and_assign
op_complement
l_int|0x2000
suffix:semicolon
r_if
c_cond
(paren
id|nval
op_ne
id|control
)paren
id|outw
c_func
(paren
id|nval
comma
id|chip-&gt;acpi_port
op_plus
l_int|0x10
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * detect intel piix4&n; */
DECL|function|clkrun_init
r_static
r_void
id|clkrun_init
c_func
(paren
id|cs46xx_t
op_star
id|chip
)paren
(brace
id|u8
id|pp
suffix:semicolon
id|chip-&gt;acpi_dev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_INTEL
comma
id|PCI_DEVICE_ID_INTEL_82371AB_3
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;acpi_dev
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
multiline_comment|/* Not a thinkpad thats for sure */
multiline_comment|/* Find the control port */
id|pci_read_config_byte
c_func
(paren
id|chip-&gt;acpi_dev
comma
l_int|0x41
comma
op_amp
id|pp
)paren
suffix:semicolon
id|chip-&gt;acpi_port
op_assign
id|pp
op_lshift
l_int|8
suffix:semicolon
)brace
multiline_comment|/*&n; * Card subid table&n; */
DECL|struct|cs_card_type
r_struct
id|cs_card_type
(brace
DECL|member|vendor
id|u16
id|vendor
suffix:semicolon
DECL|member|id
id|u16
id|id
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|init
r_void
(paren
op_star
id|init
)paren
(paren
id|cs46xx_t
op_star
)paren
suffix:semicolon
DECL|member|amp
r_void
(paren
op_star
id|amp
)paren
(paren
id|cs46xx_t
op_star
comma
r_int
)paren
suffix:semicolon
DECL|member|active
r_void
(paren
op_star
id|active
)paren
(paren
id|cs46xx_t
op_star
comma
r_int
)paren
suffix:semicolon
DECL|member|mixer_init
r_void
(paren
op_star
id|mixer_init
)paren
(paren
id|cs46xx_t
op_star
)paren
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|cards
r_static
r_struct
id|cs_card_type
id|__devinitdata
id|cards
(braket
)braket
op_assign
(brace
(brace
dot
id|vendor
op_assign
l_int|0x1489
comma
dot
id|id
op_assign
l_int|0x7001
comma
dot
id|name
op_assign
l_string|&quot;Genius Soundmaker 128 value&quot;
comma
multiline_comment|/* nothing special */
)brace
comma
(brace
dot
id|vendor
op_assign
l_int|0x5053
comma
dot
id|id
op_assign
l_int|0x3357
comma
dot
id|name
op_assign
l_string|&quot;Voyetra&quot;
comma
dot
id|amp
op_assign
id|amp_voyetra
comma
dot
id|mixer_init
op_assign
id|voyetra_mixer_init
comma
)brace
comma
(brace
dot
id|vendor
op_assign
l_int|0x1071
comma
dot
id|id
op_assign
l_int|0x6003
comma
dot
id|name
op_assign
l_string|&quot;Mitac MI6020/21&quot;
comma
dot
id|amp
op_assign
id|amp_voyetra
comma
)brace
comma
(brace
dot
id|vendor
op_assign
l_int|0x14AF
comma
dot
id|id
op_assign
l_int|0x0050
comma
dot
id|name
op_assign
l_string|&quot;Hercules Game Theatre XP&quot;
comma
dot
id|amp
op_assign
id|amp_hercules
comma
dot
id|mixer_init
op_assign
id|hercules_mixer_init
comma
)brace
comma
(brace
dot
id|vendor
op_assign
l_int|0x1681
comma
dot
id|id
op_assign
l_int|0x0050
comma
dot
id|name
op_assign
l_string|&quot;Hercules Game Theatre XP&quot;
comma
dot
id|amp
op_assign
id|amp_hercules
comma
dot
id|mixer_init
op_assign
id|hercules_mixer_init
comma
)brace
comma
(brace
dot
id|vendor
op_assign
l_int|0x1681
comma
dot
id|id
op_assign
l_int|0x0051
comma
dot
id|name
op_assign
l_string|&quot;Hercules Game Theatre XP&quot;
comma
dot
id|amp
op_assign
id|amp_hercules
comma
dot
id|mixer_init
op_assign
id|hercules_mixer_init
comma
)brace
comma
(brace
dot
id|vendor
op_assign
l_int|0x1681
comma
dot
id|id
op_assign
l_int|0x0052
comma
dot
id|name
op_assign
l_string|&quot;Hercules Game Theatre XP&quot;
comma
dot
id|amp
op_assign
id|amp_hercules
comma
dot
id|mixer_init
op_assign
id|hercules_mixer_init
comma
)brace
comma
(brace
dot
id|vendor
op_assign
l_int|0x1681
comma
dot
id|id
op_assign
l_int|0x0053
comma
dot
id|name
op_assign
l_string|&quot;Hercules Game Theatre XP&quot;
comma
dot
id|amp
op_assign
id|amp_hercules
comma
dot
id|mixer_init
op_assign
id|hercules_mixer_init
comma
)brace
comma
(brace
dot
id|vendor
op_assign
l_int|0x1681
comma
dot
id|id
op_assign
l_int|0x0054
comma
dot
id|name
op_assign
l_string|&quot;Hercules Game Theatre XP&quot;
comma
dot
id|amp
op_assign
id|amp_hercules
comma
dot
id|mixer_init
op_assign
id|hercules_mixer_init
comma
)brace
comma
multiline_comment|/* Teratec */
(brace
dot
id|vendor
op_assign
l_int|0x153b
comma
dot
id|id
op_assign
l_int|0x1136
comma
dot
id|name
op_assign
l_string|&quot;Terratec SiXPack 5.1&quot;
comma
)brace
comma
multiline_comment|/* Not sure if the 570 needs the clkrun hack */
(brace
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_IBM
comma
dot
id|id
op_assign
l_int|0x0132
comma
dot
id|name
op_assign
l_string|&quot;Thinkpad 570&quot;
comma
dot
id|init
op_assign
id|clkrun_init
comma
dot
id|active
op_assign
id|clkrun_hack
comma
)brace
comma
(brace
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_IBM
comma
dot
id|id
op_assign
l_int|0x0153
comma
dot
id|name
op_assign
l_string|&quot;Thinkpad 600X/A20/T20&quot;
comma
dot
id|init
op_assign
id|clkrun_init
comma
dot
id|active
op_assign
id|clkrun_hack
comma
)brace
comma
(brace
dot
id|vendor
op_assign
id|PCI_VENDOR_ID_IBM
comma
dot
id|id
op_assign
l_int|0x1010
comma
dot
id|name
op_assign
l_string|&quot;Thinkpad 600E (unsupported)&quot;
comma
)brace
comma
(brace
)brace
multiline_comment|/* terminator */
)brace
suffix:semicolon
multiline_comment|/*&n; * APM support&n; */
macro_line|#ifdef CONFIG_PM
DECL|function|snd_cs46xx_suspend
r_static
r_int
id|snd_cs46xx_suspend
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_int
r_int
id|state
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|card-&gt;pm_private_data
suffix:semicolon
r_int
id|amp_saved
suffix:semicolon
id|snd_pcm_suspend_all
c_func
(paren
id|chip-&gt;pcm
)paren
suffix:semicolon
singleline_comment|// chip-&gt;ac97_powerdown = snd_cs46xx_codec_read(chip, AC97_POWER_CONTROL);
singleline_comment|// chip-&gt;ac97_general_purpose = snd_cs46xx_codec_read(chip, BA0_AC97_GENERAL_PURPOSE);
id|snd_ac97_suspend
c_func
(paren
id|chip-&gt;ac97
(braket
id|CS46XX_PRIMARY_CODEC_INDEX
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;ac97
(braket
id|CS46XX_SECONDARY_CODEC_INDEX
)braket
)paren
id|snd_ac97_suspend
c_func
(paren
id|chip-&gt;ac97
(braket
id|CS46XX_SECONDARY_CODEC_INDEX
)braket
)paren
suffix:semicolon
id|amp_saved
op_assign
id|chip-&gt;amplifier
suffix:semicolon
multiline_comment|/* turn off amp */
id|chip
op_member_access_from_pointer
id|amplifier_ctrl
c_func
(paren
id|chip
comma
op_minus
id|chip-&gt;amplifier
)paren
suffix:semicolon
id|snd_cs46xx_hw_stop
c_func
(paren
id|chip
)paren
suffix:semicolon
multiline_comment|/* disable CLKRUN */
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
op_minus
id|chip-&gt;amplifier
)paren
suffix:semicolon
id|chip-&gt;amplifier
op_assign
id|amp_saved
suffix:semicolon
multiline_comment|/* restore the status */
id|pci_disable_device
c_func
(paren
id|chip-&gt;pci
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs46xx_resume
r_static
r_int
id|snd_cs46xx_resume
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_int
r_int
id|state
)paren
(brace
id|cs46xx_t
op_star
id|chip
op_assign
id|card-&gt;pm_private_data
suffix:semicolon
r_int
id|amp_saved
suffix:semicolon
id|pci_enable_device
c_func
(paren
id|chip-&gt;pci
)paren
suffix:semicolon
id|pci_set_master
c_func
(paren
id|chip-&gt;pci
)paren
suffix:semicolon
id|amp_saved
op_assign
id|chip-&gt;amplifier
suffix:semicolon
id|chip-&gt;amplifier
op_assign
l_int|0
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* force to on */
id|snd_cs46xx_chip_init
c_func
(paren
id|chip
)paren
suffix:semicolon
macro_line|#if 0
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
id|BA0_AC97_GENERAL_PURPOSE
comma
id|chip-&gt;ac97_general_purpose
)paren
suffix:semicolon
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
id|AC97_POWER_CONTROL
comma
id|chip-&gt;ac97_powerdown
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|snd_cs46xx_codec_write
c_func
(paren
id|chip
comma
id|BA0_AC97_POWERDOWN
comma
id|chip-&gt;ac97_powerdown
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
macro_line|#endif
id|snd_ac97_resume
c_func
(paren
id|chip-&gt;ac97
(braket
id|CS46XX_PRIMARY_CODEC_INDEX
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;ac97
(braket
id|CS46XX_SECONDARY_CODEC_INDEX
)braket
)paren
id|snd_ac97_resume
c_func
(paren
id|chip-&gt;ac97
(braket
id|CS46XX_SECONDARY_CODEC_INDEX
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|amp_saved
)paren
id|chip
op_member_access_from_pointer
id|amplifier_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* turn amp on */
r_else
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* disable CLKRUN */
id|chip-&gt;amplifier
op_assign
id|amp_saved
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PM */
multiline_comment|/*&n; */
DECL|function|snd_cs46xx_create
r_int
id|__devinit
id|snd_cs46xx_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_struct
id|pci_dev
op_star
id|pci
comma
r_int
id|external_amp
comma
r_int
id|thinkpad
comma
id|cs46xx_t
op_star
op_star
id|rchip
)paren
(brace
id|cs46xx_t
op_star
id|chip
suffix:semicolon
r_int
id|err
comma
id|idx
suffix:semicolon
id|snd_cs46xx_region_t
op_star
id|region
suffix:semicolon
r_struct
id|cs_card_type
op_star
id|cp
suffix:semicolon
id|u16
id|ss_card
comma
id|ss_vendor
suffix:semicolon
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
dot
id|dev_free
op_assign
id|snd_cs46xx_dev_free
comma
)brace
suffix:semicolon
op_star
id|rchip
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* enable PCI device */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pci
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|chip
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|chip
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip
op_eq
l_int|NULL
)paren
(brace
id|pci_disable_device
c_func
(paren
id|pci
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|spin_lock_init
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|init_MUTEX
c_func
(paren
op_amp
id|chip-&gt;spos_mutex
)paren
suffix:semicolon
macro_line|#endif
id|chip-&gt;card
op_assign
id|card
suffix:semicolon
id|chip-&gt;pci
op_assign
id|pci
suffix:semicolon
id|chip-&gt;irq
op_assign
op_minus
l_int|1
suffix:semicolon
id|chip-&gt;ba0_addr
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
suffix:semicolon
id|chip-&gt;ba1_addr
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;ba0_addr
op_eq
l_int|0
op_logical_or
id|chip-&gt;ba0_addr
op_eq
(paren
r_int
r_int
)paren
op_complement
l_int|0
op_logical_or
id|chip-&gt;ba1_addr
op_eq
l_int|0
op_logical_or
id|chip-&gt;ba1_addr
op_eq
(paren
r_int
r_int
)paren
op_complement
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;wrong address(es) - ba0 = 0x%lx, ba1 = 0x%lx&bslash;n&quot;
comma
id|chip-&gt;ba0_addr
comma
id|chip-&gt;ba1_addr
)paren
suffix:semicolon
id|snd_cs46xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|region
op_assign
op_amp
id|chip-&gt;region.name.ba0
suffix:semicolon
id|strcpy
c_func
(paren
id|region-&gt;name
comma
l_string|&quot;CS46xx_BA0&quot;
)paren
suffix:semicolon
id|region-&gt;base
op_assign
id|chip-&gt;ba0_addr
suffix:semicolon
id|region-&gt;size
op_assign
id|CS46XX_BA0_SIZE
suffix:semicolon
id|region
op_assign
op_amp
id|chip-&gt;region.name.data0
suffix:semicolon
id|strcpy
c_func
(paren
id|region-&gt;name
comma
l_string|&quot;CS46xx_BA1_data0&quot;
)paren
suffix:semicolon
id|region-&gt;base
op_assign
id|chip-&gt;ba1_addr
op_plus
id|BA1_SP_DMEM0
suffix:semicolon
id|region-&gt;size
op_assign
id|CS46XX_BA1_DATA0_SIZE
suffix:semicolon
id|region
op_assign
op_amp
id|chip-&gt;region.name.data1
suffix:semicolon
id|strcpy
c_func
(paren
id|region-&gt;name
comma
l_string|&quot;CS46xx_BA1_data1&quot;
)paren
suffix:semicolon
id|region-&gt;base
op_assign
id|chip-&gt;ba1_addr
op_plus
id|BA1_SP_DMEM1
suffix:semicolon
id|region-&gt;size
op_assign
id|CS46XX_BA1_DATA1_SIZE
suffix:semicolon
id|region
op_assign
op_amp
id|chip-&gt;region.name.pmem
suffix:semicolon
id|strcpy
c_func
(paren
id|region-&gt;name
comma
l_string|&quot;CS46xx_BA1_pmem&quot;
)paren
suffix:semicolon
id|region-&gt;base
op_assign
id|chip-&gt;ba1_addr
op_plus
id|BA1_SP_PMEM
suffix:semicolon
id|region-&gt;size
op_assign
id|CS46XX_BA1_PRG_SIZE
suffix:semicolon
id|region
op_assign
op_amp
id|chip-&gt;region.name.reg
suffix:semicolon
id|strcpy
c_func
(paren
id|region-&gt;name
comma
l_string|&quot;CS46xx_BA1_reg&quot;
)paren
suffix:semicolon
id|region-&gt;base
op_assign
id|chip-&gt;ba1_addr
op_plus
id|BA1_SP_REG
suffix:semicolon
id|region-&gt;size
op_assign
id|CS46XX_BA1_REG_SIZE
suffix:semicolon
multiline_comment|/* set up amp and clkrun hack */
id|pci_read_config_word
c_func
(paren
id|pci
comma
id|PCI_SUBSYSTEM_VENDOR_ID
comma
op_amp
id|ss_vendor
)paren
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pci
comma
id|PCI_SUBSYSTEM_ID
comma
op_amp
id|ss_card
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cp
op_assign
op_amp
id|cards
(braket
l_int|0
)braket
suffix:semicolon
id|cp-&gt;name
suffix:semicolon
id|cp
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cp-&gt;vendor
op_eq
id|ss_vendor
op_logical_and
id|cp-&gt;id
op_eq
id|ss_card
)paren
(brace
id|snd_printdd
(paren
l_string|&quot;hack for %s enabled&bslash;n&quot;
comma
id|cp-&gt;name
)paren
suffix:semicolon
id|chip-&gt;amplifier_ctrl
op_assign
id|cp-&gt;amp
suffix:semicolon
id|chip-&gt;active_ctrl
op_assign
id|cp-&gt;active
suffix:semicolon
id|chip-&gt;mixer_init
op_assign
id|cp-&gt;mixer_init
suffix:semicolon
r_if
c_cond
(paren
id|cp-&gt;init
)paren
id|cp
op_member_access_from_pointer
id|init
c_func
(paren
id|chip
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|external_amp
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;Crystal EAPD support forced on.&bslash;n&quot;
)paren
suffix:semicolon
id|chip-&gt;amplifier_ctrl
op_assign
id|amp_voyetra
suffix:semicolon
)brace
r_if
c_cond
(paren
id|thinkpad
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;Activating CLKRUN hack for Thinkpad.&bslash;n&quot;
)paren
suffix:semicolon
id|chip-&gt;active_ctrl
op_assign
id|clkrun_hack
suffix:semicolon
id|clkrun_init
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chip-&gt;amplifier_ctrl
op_eq
l_int|NULL
)paren
id|chip-&gt;amplifier_ctrl
op_assign
id|amp_none
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;active_ctrl
op_eq
l_int|NULL
)paren
id|chip-&gt;active_ctrl
op_assign
id|amp_none
suffix:semicolon
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* enable CLKRUN */
id|pci_set_master
c_func
(paren
id|pci
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|5
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|region
op_assign
op_amp
id|chip-&gt;region.idx
(braket
id|idx
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|region-&gt;resource
op_assign
id|request_mem_region
c_func
(paren
id|region-&gt;base
comma
id|region-&gt;size
comma
id|region-&gt;name
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unable to request memory region 0x%lx-0x%lx&bslash;n&quot;
comma
id|region-&gt;base
comma
id|region-&gt;base
op_plus
id|region-&gt;size
op_minus
l_int|1
)paren
suffix:semicolon
id|snd_cs46xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|region-&gt;remap_addr
op_assign
id|ioremap_nocache
c_func
(paren
id|region-&gt;base
comma
id|region-&gt;size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|region-&gt;remap_addr
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;%s ioremap problem&bslash;n&quot;
comma
id|region-&gt;name
)paren
suffix:semicolon
id|snd_cs46xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|pci-&gt;irq
comma
id|snd_cs46xx_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
l_string|&quot;CS46XX&quot;
comma
(paren
r_void
op_star
)paren
id|chip
)paren
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab IRQ %d&bslash;n&quot;
comma
id|pci-&gt;irq
)paren
suffix:semicolon
id|snd_cs46xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|chip-&gt;irq
op_assign
id|pci-&gt;irq
suffix:semicolon
macro_line|#ifdef CONFIG_SND_CS46XX_NEW_DSP
id|chip-&gt;dsp_spos_instance
op_assign
id|cs46xx_dsp_spos_create
c_func
(paren
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;dsp_spos_instance
op_eq
l_int|NULL
)paren
(brace
id|snd_cs46xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
macro_line|#endif
id|err
op_assign
id|snd_cs46xx_chip_init
c_func
(paren
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_cs46xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|snd_cs46xx_proc_init
c_func
(paren
id|card
comma
id|chip
)paren
suffix:semicolon
id|snd_card_set_pm_callback
c_func
(paren
id|card
comma
id|snd_cs46xx_suspend
comma
id|snd_cs46xx_resume
comma
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|chip
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_cs46xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|chip
op_member_access_from_pointer
id|active_ctrl
c_func
(paren
id|chip
comma
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* disable CLKRUN */
id|snd_card_set_dev
c_func
(paren
id|card
comma
op_amp
id|pci-&gt;dev
)paren
suffix:semicolon
op_star
id|rchip
op_assign
id|chip
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
