multiline_comment|/*&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or&n; *  (at your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU Library General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.&n; */
multiline_comment|/*&n;    Vortex core low level functions.&n;&t;&n; Author: Manuel Jander (mjander@users.sourceforge.cl)&n; These functions are mainly the result of translations made&n; from the original disassembly of the au88x0 binary drivers,&n; written by Aureal before they went down.&n; Many thanks to the Jeff Muizelar, Kester Maddock, and whoever&n; contributed to the OpenVortex project.&n; The author of this file, put the few available pieces together&n; and translated the rest of the riddle (Mix, Src and connection stuff).&n; Some things are still to be discovered, and their meanings are unclear.&n;&n; Some of these functions aren&squot;t intended to be really used, rather&n; to help to understand how does the AU88X0 chips work. Keep them in, because&n; they could be used somewhere in the future.&n;&n; This code hasn&squot;t been tested or proof read thoroughly. If you wanna help,&n; take a look at the AU88X0 assembly and check if this matches.&n; Functions tested ok so far are (they show the desired effect&n; at least):&n;   vortex_routes(); (1 bug fixed).&n;   vortex_adb_addroute();&n;   vortex_adb_addroutes();&n;   vortex_connect_codecplay();&n;   vortex_src_flushbuffers();&n;   vortex_adbdma_setmode();  note: still some unknown arguments!&n;   vortex_adbdma_startfifo();&n;   vortex_adbdma_stopfifo();&n;   vortex_fifo_setadbctrl(); note: still some unknown arguments!&n;   vortex_mix_setinputvolumebyte();&n;   vortex_mix_enableinput();&n;   vortex_mixer_addWTD(); (fixed)&n;   vortex_connection_adbdma_src_src();&n;   vortex_connection_adbdma_src();&n;   vortex_src_change_convratio();&n;   vortex_src_addWTD(); (fixed)&n;&n; History:&n;&n; 01-03-2003 First revision.&n; 01-21-2003 Some bug fixes.&n; 17-02-2003 many bugfixes after a big versioning mess.&n; 18-02-2003 JAAAAAHHHUUUUUU!!!! The mixer works !! I&squot;m just so happy !&n;&t;&t;&t; (2 hours later...) I cant believe it! Im really lucky today.&n;&t;&t;&t; Now the SRC is working too! Yeah! XMMS works !&n; 20-02-2003 First steps into the ALSA world.&n; 28-02-2003 As my birthday present, i discovered how the DMA buffer pages really&n;            work :-). It was all wrong.&n; 12-03-2003 ALSA driver starts working (2 channels).&n; 16-03-2003 More srcblock_setupchannel discoveries.&n; 12-04-2003 AU8830 playback support. Recording in the works.&n; 17-04-2003 vortex_route() and vortex_routes() bug fixes. AU8830 recording&n; &t;&t;&t;works now, but chipn&squot; dale effect is still there.&n; 16-05-2003 SrcSetupChannel cleanup. Moved the Src setup stuff entirely&n;            into au88x0_pcm.c .&n; 06-06-2003 Buffer shifter bugfix. Mixer volume fix.&n; 07-12-2003 A3D routing finally fixed. Believed to be OK.&n; &n;*/
macro_line|#include &quot;au88x0.h&quot;
macro_line|#include &quot;au88x0_a3d.h&quot;
macro_line|#include &lt;linux/delay.h&gt;
multiline_comment|/*  MIXER (CAsp4Mix.s and CAsp4Mixer.s) */
singleline_comment|// FIXME: get rid of this.
DECL|variable|mchannels
r_int
id|mchannels
(braket
id|NR_MIXIN
)braket
suffix:semicolon
DECL|variable|rampchs
r_int
id|rampchs
(braket
id|NR_MIXIN
)braket
suffix:semicolon
DECL|function|vortex_mixer_en_sr
r_static
r_void
id|vortex_mixer_en_sr
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|channel
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIXER_SR
comma
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIXER_SR
)paren
op_or
(paren
l_int|0x1
op_lshift
id|channel
)paren
)paren
suffix:semicolon
)brace
DECL|function|vortex_mixer_dis_sr
r_static
r_void
id|vortex_mixer_dis_sr
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|channel
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIXER_SR
comma
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIXER_SR
)paren
op_amp
op_complement
(paren
l_int|0x1
op_lshift
id|channel
)paren
)paren
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_void
id|vortex_mix_muteinputgain
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|mix
comma
r_int
r_char
id|channel
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIX_INVOL_A
op_plus
(paren
(paren
id|mix
op_lshift
l_int|5
)paren
op_plus
id|channel
)paren
comma
l_int|0x80
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIX_INVOL_B
op_plus
(paren
(paren
id|mix
op_lshift
l_int|5
)paren
op_plus
id|channel
)paren
comma
l_int|0x80
)paren
suffix:semicolon
)brace
r_static
r_int
id|vortex_mix_getvolume
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|mix
)paren
(brace
r_int
id|a
suffix:semicolon
id|a
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIX_VOL_A
op_plus
(paren
id|mix
op_lshift
l_int|2
)paren
)paren
op_amp
l_int|0xff
suffix:semicolon
singleline_comment|//FP2LinearFrac(a);
r_return
(paren
id|a
)paren
suffix:semicolon
)brace
r_static
r_int
id|vortex_mix_getinputvolume
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|mix
comma
r_int
id|channel
comma
r_int
op_star
id|vol
)paren
(brace
r_int
id|a
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mchannels
(braket
id|mix
)braket
op_amp
(paren
l_int|1
op_lshift
id|channel
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|a
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIX_INVOL_A
op_plus
(paren
(paren
(paren
id|mix
op_lshift
l_int|5
)paren
op_plus
id|channel
)paren
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;   if (rampchs[mix] == 0)&n;&t;   a = FP2LinearFrac(a);&n;&t;   else&n;&t;   a = FP2LinearFracWT(a);&n;&t; */
op_star
id|vol
op_assign
id|a
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
r_int
id|vortex_mix_boost6db
c_func
(paren
r_int
r_char
id|vol
)paren
(brace
r_return
(paren
id|vol
op_plus
l_int|8
)paren
suffix:semicolon
multiline_comment|/* WOW! what a complex function! */
)brace
r_static
r_void
id|vortex_mix_rampvolume
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|mix
)paren
(brace
r_int
id|ch
suffix:semicolon
r_char
id|a
suffix:semicolon
singleline_comment|// This function is intended for ramping down only (see vortex_disableinput()).
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
l_int|0x20
suffix:semicolon
id|ch
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
l_int|1
op_lshift
id|ch
)paren
op_amp
id|rampchs
(braket
id|mix
)braket
)paren
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
id|a
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIX_INVOL_B
op_plus
(paren
(paren
(paren
id|mix
op_lshift
l_int|5
)paren
op_plus
id|ch
)paren
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|a
OG
op_minus
l_int|126
)paren
(brace
id|a
op_sub_assign
l_int|2
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIX_INVOL_A
op_plus
(paren
(paren
(paren
id|mix
op_lshift
l_int|5
)paren
op_plus
id|ch
)paren
op_lshift
l_int|2
)paren
comma
id|a
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIX_INVOL_B
op_plus
(paren
(paren
(paren
id|mix
op_lshift
l_int|5
)paren
op_plus
id|ch
)paren
op_lshift
l_int|2
)paren
comma
id|a
)paren
suffix:semicolon
)brace
r_else
id|vortex_mix_killinput
c_func
(paren
id|vortex
comma
id|mix
comma
id|ch
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
id|vortex_mix_getenablebit
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|mix
comma
r_int
id|mixin
)paren
(brace
r_int
id|addr
comma
id|temp
suffix:semicolon
r_if
c_cond
(paren
id|mixin
op_ge
l_int|0
)paren
id|addr
op_assign
id|mixin
suffix:semicolon
r_else
id|addr
op_assign
id|mixin
op_plus
l_int|3
suffix:semicolon
id|addr
op_assign
(paren
(paren
id|mix
op_lshift
l_int|3
)paren
op_plus
(paren
id|addr
op_rshift
l_int|2
)paren
)paren
op_lshift
l_int|2
suffix:semicolon
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIX_ENIN
op_plus
id|addr
)paren
suffix:semicolon
r_return
(paren
(paren
id|temp
op_rshift
(paren
id|mixin
op_amp
l_int|3
)paren
)paren
op_amp
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#endif
r_static
r_void
DECL|function|vortex_mix_setvolumebyte
id|vortex_mix_setvolumebyte
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|mix
comma
r_int
r_char
id|vol
)paren
(brace
r_int
id|temp
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIX_VOL_A
op_plus
(paren
id|mix
op_lshift
l_int|2
)paren
comma
id|vol
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|1
)paren
(brace
multiline_comment|/*if (this_10) */
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIX_VOL_B
op_plus
(paren
id|mix
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp
op_ne
l_int|0x80
)paren
op_logical_or
(paren
id|vol
op_eq
l_int|0x80
)paren
)paren
r_return
suffix:semicolon
)brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIX_VOL_B
op_plus
(paren
id|mix
op_lshift
l_int|2
)paren
comma
id|vol
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|vortex_mix_setinputvolumebyte
id|vortex_mix_setinputvolumebyte
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|mix
comma
r_int
id|mixin
comma
r_int
r_char
id|vol
)paren
(brace
r_int
id|temp
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIX_INVOL_A
op_plus
(paren
(paren
(paren
id|mix
op_lshift
l_int|5
)paren
op_plus
id|mixin
)paren
op_lshift
l_int|2
)paren
comma
id|vol
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|1
)paren
(brace
multiline_comment|/* this_10, initialized to 1. */
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIX_INVOL_B
op_plus
(paren
(paren
(paren
id|mix
op_lshift
l_int|5
)paren
op_plus
id|mixin
)paren
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp
op_ne
l_int|0x80
)paren
op_logical_or
(paren
id|vol
op_eq
l_int|0x80
)paren
)paren
r_return
suffix:semicolon
)brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIX_INVOL_B
op_plus
(paren
(paren
(paren
id|mix
op_lshift
l_int|5
)paren
op_plus
id|mixin
)paren
op_lshift
l_int|2
)paren
comma
id|vol
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|vortex_mix_setenablebit
id|vortex_mix_setenablebit
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|mix
comma
r_int
id|mixin
comma
r_int
id|en
)paren
(brace
r_int
id|temp
comma
id|addr
suffix:semicolon
r_if
c_cond
(paren
id|mixin
OL
l_int|0
)paren
id|addr
op_assign
(paren
id|mixin
op_plus
l_int|3
)paren
suffix:semicolon
r_else
id|addr
op_assign
id|mixin
suffix:semicolon
id|addr
op_assign
(paren
(paren
id|mix
op_lshift
l_int|3
)paren
op_plus
(paren
id|addr
op_rshift
l_int|2
)paren
)paren
op_lshift
l_int|2
suffix:semicolon
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIX_ENIN
op_plus
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|en
)paren
id|temp
op_or_assign
(paren
l_int|1
op_lshift
(paren
id|mixin
op_amp
l_int|3
)paren
)paren
suffix:semicolon
r_else
id|temp
op_and_assign
op_complement
(paren
l_int|1
op_lshift
(paren
id|mixin
op_amp
l_int|3
)paren
)paren
suffix:semicolon
multiline_comment|/* Mute input. Astatic void crackling? */
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIX_INVOL_B
op_plus
(paren
(paren
(paren
id|mix
op_lshift
l_int|5
)paren
op_plus
id|mixin
)paren
op_lshift
l_int|2
)paren
comma
l_int|0x80
)paren
suffix:semicolon
multiline_comment|/* Looks like clear buffer. */
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIX_SMP
op_plus
(paren
id|mixin
op_lshift
l_int|2
)paren
comma
l_int|0x0
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIX_SMP
op_plus
l_int|4
op_plus
(paren
id|mixin
op_lshift
l_int|2
)paren
comma
l_int|0x0
)paren
suffix:semicolon
multiline_comment|/* Write enable bit. */
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIX_ENIN
op_plus
id|addr
comma
id|temp
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|vortex_mix_killinput
id|vortex_mix_killinput
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|mix
comma
r_int
id|mixin
)paren
(brace
id|rampchs
(braket
id|mix
)braket
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|mixin
)paren
suffix:semicolon
id|vortex_mix_setinputvolumebyte
c_func
(paren
id|vortex
comma
id|mix
comma
id|mixin
comma
l_int|0x80
)paren
suffix:semicolon
id|mchannels
(braket
id|mix
)braket
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|mixin
)paren
suffix:semicolon
id|vortex_mix_setenablebit
c_func
(paren
id|vortex
comma
id|mix
comma
id|mixin
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|vortex_mix_enableinput
id|vortex_mix_enableinput
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|mix
comma
r_int
id|mixin
)paren
(brace
id|vortex_mix_killinput
c_func
(paren
id|vortex
comma
id|mix
comma
id|mixin
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mchannels
(braket
id|mix
)braket
op_amp
(paren
l_int|1
op_lshift
id|mixin
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|vortex_mix_setinputvolumebyte
c_func
(paren
id|vortex
comma
id|mix
comma
id|mixin
comma
l_int|0x80
)paren
suffix:semicolon
multiline_comment|/*0x80 : mute */
id|mchannels
(braket
id|mix
)braket
op_or_assign
(paren
l_int|1
op_lshift
id|mixin
)paren
suffix:semicolon
)brace
id|vortex_mix_setenablebit
c_func
(paren
id|vortex
comma
id|mix
comma
id|mixin
comma
l_int|1
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|vortex_mix_disableinput
id|vortex_mix_disableinput
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|mix
comma
r_int
id|channel
comma
r_int
id|ramp
)paren
(brace
r_if
c_cond
(paren
id|ramp
)paren
(brace
id|rampchs
(braket
id|mix
)braket
op_or_assign
(paren
l_int|1
op_lshift
id|channel
)paren
suffix:semicolon
singleline_comment|// Register callback.
singleline_comment|//vortex_mix_startrampvolume(vortex);
id|vortex_mix_killinput
c_func
(paren
id|vortex
comma
id|mix
comma
id|channel
)paren
suffix:semicolon
)brace
r_else
id|vortex_mix_killinput
c_func
(paren
id|vortex
comma
id|mix
comma
id|channel
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|vortex_mixer_addWTD
id|vortex_mixer_addWTD
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|mix
comma
r_int
r_char
id|ch
)paren
(brace
r_int
id|temp
comma
id|lifeboat
op_assign
l_int|0
comma
id|prev
suffix:semicolon
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIXER_SR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp
op_amp
(paren
l_int|1
op_lshift
id|ch
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIXER_CHNBASE
op_plus
(paren
id|ch
op_lshift
l_int|2
)paren
comma
id|mix
)paren
suffix:semicolon
id|vortex_mixer_en_sr
c_func
(paren
id|vortex
comma
id|ch
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|prev
op_assign
id|VORTEX_MIXER_CHNBASE
op_plus
(paren
id|ch
op_lshift
l_int|2
)paren
suffix:semicolon
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|prev
)paren
suffix:semicolon
r_while
c_loop
(paren
id|temp
op_amp
l_int|0x10
)paren
(brace
id|prev
op_assign
id|VORTEX_MIXER_RTBASE
op_plus
(paren
(paren
id|temp
op_amp
l_int|0xf
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|prev
)paren
suffix:semicolon
singleline_comment|//printk(KERN_INFO &quot;vortex: mixAddWTD: while addr=%x, val=%x&bslash;n&quot;, prev, temp);
r_if
c_cond
(paren
(paren
op_increment
id|lifeboat
)paren
OG
l_int|0xf
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;vortex_mixer_addWTD: lifeboat overflow&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIXER_RTBASE
op_plus
(paren
(paren
id|temp
op_amp
l_int|0xf
)paren
op_lshift
l_int|2
)paren
comma
id|mix
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|prev
comma
(paren
id|temp
op_amp
l_int|0xf
)paren
op_or
l_int|0x10
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_static
r_int
DECL|function|vortex_mixer_delWTD
id|vortex_mixer_delWTD
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|mix
comma
r_int
r_char
id|ch
)paren
(brace
r_int
id|esp14
op_assign
op_minus
l_int|1
comma
id|esp18
comma
id|eax
comma
id|ebx
comma
id|edx
comma
id|ebp
comma
id|esi
op_assign
l_int|0
suffix:semicolon
singleline_comment|//int esp1f=edi(while)=src, esp10=ch;
id|eax
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIXER_SR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
l_int|1
op_lshift
id|ch
)paren
op_amp
id|eax
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;mix ALARM %x&bslash;n&quot;
comma
id|eax
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ebp
op_assign
id|VORTEX_MIXER_CHNBASE
op_plus
(paren
id|ch
op_lshift
l_int|2
)paren
suffix:semicolon
id|esp18
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|ebp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|esp18
op_amp
l_int|0x10
)paren
(brace
id|ebx
op_assign
(paren
id|esp18
op_amp
l_int|0xf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mix
op_eq
id|ebx
)paren
(brace
id|ebx
op_assign
id|VORTEX_MIXER_RTBASE
op_plus
(paren
id|mix
op_lshift
l_int|2
)paren
suffix:semicolon
id|edx
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|ebx
)paren
suffix:semicolon
singleline_comment|//7b60
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|ebp
comma
id|edx
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|ebx
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
singleline_comment|//7ad3
id|edx
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIXER_RTBASE
op_plus
(paren
id|ebx
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
singleline_comment|//printk(KERN_INFO &quot;vortex: mixdelWTD: 1 addr=%x, val=%x, src=%x&bslash;n&quot;, ebx, edx, src);
r_while
c_loop
(paren
(paren
id|edx
op_amp
l_int|0xf
)paren
op_ne
id|mix
)paren
(brace
r_if
c_cond
(paren
(paren
id|esi
)paren
OG
l_int|0xf
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;vortex: mixdelWTD: error lifeboat overflow&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|esp14
op_assign
id|ebx
suffix:semicolon
id|ebx
op_assign
id|edx
op_amp
l_int|0xf
suffix:semicolon
id|ebp
op_assign
id|ebx
op_lshift
l_int|2
suffix:semicolon
id|edx
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIXER_RTBASE
op_plus
id|ebp
)paren
suffix:semicolon
singleline_comment|//printk(KERN_INFO &quot;vortex: mixdelWTD: while addr=%x, val=%x&bslash;n&quot;, ebp, edx);
id|esi
op_increment
suffix:semicolon
)brace
singleline_comment|//7b30
id|ebp
op_assign
id|ebx
op_lshift
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|edx
op_amp
l_int|0x10
)paren
(brace
multiline_comment|/* Delete entry in between others */
id|ebx
op_assign
id|VORTEX_MIXER_RTBASE
op_plus
(paren
(paren
id|edx
op_amp
l_int|0xf
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
id|edx
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|ebx
)paren
suffix:semicolon
singleline_comment|//7b60
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIXER_RTBASE
op_plus
id|ebp
comma
id|edx
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|ebx
comma
l_int|0
)paren
suffix:semicolon
singleline_comment|//printk(KERN_INFO &quot;vortex mixdelWTD between addr= 0x%x, val= 0x%x&bslash;n&quot;, ebp, edx);
)brace
r_else
(brace
multiline_comment|/* Delete last entry */
singleline_comment|//7b83
r_if
c_cond
(paren
id|esp14
op_eq
op_minus
l_int|1
)paren
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIXER_CHNBASE
op_plus
(paren
id|ch
op_lshift
l_int|2
)paren
comma
id|esp18
op_amp
l_int|0xef
)paren
suffix:semicolon
r_else
(brace
id|ebx
op_assign
(paren
l_int|0xffffffe0
op_amp
id|edx
)paren
op_or
(paren
l_int|0xf
op_amp
id|ebx
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIXER_RTBASE
op_plus
(paren
id|esp14
op_lshift
l_int|2
)paren
comma
id|ebx
)paren
suffix:semicolon
singleline_comment|//printk(KERN_INFO &quot;vortex mixdelWTD last addr= 0x%x, val= 0x%x&bslash;n&quot;, esp14, ebx);
)brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIXER_RTBASE
op_plus
id|ebp
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
singleline_comment|//printk(KERN_INFO &quot;removed last mix&bslash;n&quot;);
singleline_comment|//7be0
id|vortex_mixer_dis_sr
c_func
(paren
id|vortex
comma
id|ch
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|ebp
comma
l_int|0
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|vortex_mixer_init
r_static
r_void
id|vortex_mixer_init
c_func
(paren
id|vortex_t
op_star
id|vortex
)paren
(brace
r_int
r_int
id|addr
suffix:semicolon
r_int
id|x
suffix:semicolon
singleline_comment|// FIXME: get rid of this crap.
id|memset
c_func
(paren
id|mchannels
comma
l_int|0
comma
id|NR_MIXOUT
op_star
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|rampchs
comma
l_int|0
comma
id|NR_MIXOUT
op_star
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|addr
op_assign
id|VORTEX_MIX_SMP
op_plus
l_int|0x17c
suffix:semicolon
r_for
c_loop
(paren
id|x
op_assign
l_int|0x5f
suffix:semicolon
id|x
op_ge
l_int|0
suffix:semicolon
id|x
op_decrement
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|addr
comma
l_int|0
)paren
suffix:semicolon
id|addr
op_sub_assign
l_int|4
suffix:semicolon
)brace
id|addr
op_assign
id|VORTEX_MIX_ENIN
op_plus
l_int|0x1fc
suffix:semicolon
r_for
c_loop
(paren
id|x
op_assign
l_int|0x7f
suffix:semicolon
id|x
op_ge
l_int|0
suffix:semicolon
id|x
op_decrement
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|addr
comma
l_int|0
)paren
suffix:semicolon
id|addr
op_sub_assign
l_int|4
suffix:semicolon
)brace
id|addr
op_assign
id|VORTEX_MIX_SMP
op_plus
l_int|0x17c
suffix:semicolon
r_for
c_loop
(paren
id|x
op_assign
l_int|0x5f
suffix:semicolon
id|x
op_ge
l_int|0
suffix:semicolon
id|x
op_decrement
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|addr
comma
l_int|0
)paren
suffix:semicolon
id|addr
op_sub_assign
l_int|4
suffix:semicolon
)brace
id|addr
op_assign
id|VORTEX_MIX_INVOL_A
op_plus
l_int|0x7fc
suffix:semicolon
r_for
c_loop
(paren
id|x
op_assign
l_int|0x1ff
suffix:semicolon
id|x
op_ge
l_int|0
suffix:semicolon
id|x
op_decrement
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|addr
comma
l_int|0x80
)paren
suffix:semicolon
id|addr
op_sub_assign
l_int|4
suffix:semicolon
)brace
id|addr
op_assign
id|VORTEX_MIX_VOL_A
op_plus
l_int|0x3c
suffix:semicolon
r_for
c_loop
(paren
id|x
op_assign
l_int|0xf
suffix:semicolon
id|x
op_ge
l_int|0
suffix:semicolon
id|x
op_decrement
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|addr
comma
l_int|0x80
)paren
suffix:semicolon
id|addr
op_sub_assign
l_int|4
suffix:semicolon
)brace
id|addr
op_assign
id|VORTEX_MIX_INVOL_B
op_plus
l_int|0x7fc
suffix:semicolon
r_for
c_loop
(paren
id|x
op_assign
l_int|0x1ff
suffix:semicolon
id|x
op_ge
l_int|0
suffix:semicolon
id|x
op_decrement
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|addr
comma
l_int|0x80
)paren
suffix:semicolon
id|addr
op_sub_assign
l_int|4
suffix:semicolon
)brace
id|addr
op_assign
id|VORTEX_MIX_VOL_B
op_plus
l_int|0x3c
suffix:semicolon
r_for
c_loop
(paren
id|x
op_assign
l_int|0xf
suffix:semicolon
id|x
op_ge
l_int|0
suffix:semicolon
id|x
op_decrement
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|addr
comma
l_int|0x80
)paren
suffix:semicolon
id|addr
op_sub_assign
l_int|4
suffix:semicolon
)brace
id|addr
op_assign
id|VORTEX_MIXER_RTBASE
op_plus
(paren
id|MIXER_RTBASE_SIZE
op_minus
l_int|1
)paren
op_star
l_int|4
suffix:semicolon
r_for
c_loop
(paren
id|x
op_assign
(paren
id|MIXER_RTBASE_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|x
op_ge
l_int|0
suffix:semicolon
id|x
op_decrement
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|addr
comma
l_int|0x0
)paren
suffix:semicolon
id|addr
op_sub_assign
l_int|4
suffix:semicolon
)brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_MIXER_SR
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Set clipping ceiling (this may be all wrong). */
multiline_comment|/*&n;&t;for (x = 0; x &gt; 0x80; x++) {&n;&t;&t;hwwrite(vortex-&gt;mmio, VORTEX_MIXER_CLIP + (x &lt;&lt; 2), 0x3ffff);&n;&t;}&n;&t;*/
multiline_comment|/*&n;&t;   call CAsp4Mix__Initialize_CAsp4HwIO____CAsp4Mixer____&n;&t;   Register ISR callback for volume smooth fade out.&n;&t;   Maybe this avoids clicks when press &quot;stop&quot; ?&n;&t; */
)brace
multiline_comment|/*  SRC (CAsp4Src.s and CAsp4SrcBlock) */
DECL|function|vortex_src_en_sr
r_static
r_void
id|vortex_src_en_sr
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|channel
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRCBLOCK_SR
comma
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRCBLOCK_SR
)paren
op_or
(paren
l_int|0x1
op_lshift
id|channel
)paren
)paren
suffix:semicolon
)brace
DECL|function|vortex_src_dis_sr
r_static
r_void
id|vortex_src_dis_sr
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|channel
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRCBLOCK_SR
comma
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRCBLOCK_SR
)paren
op_amp
op_complement
(paren
l_int|0x1
op_lshift
id|channel
)paren
)paren
suffix:semicolon
)brace
DECL|function|vortex_src_flushbuffers
r_static
r_void
id|vortex_src_flushbuffers
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|src
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0x1f
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_DATA0
op_plus
(paren
id|src
op_lshift
l_int|7
)paren
op_plus
(paren
id|i
op_lshift
l_int|2
)paren
comma
l_int|0
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_DATA
op_plus
(paren
id|src
op_lshift
l_int|3
)paren
comma
l_int|0
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_DATA
op_plus
(paren
id|src
op_lshift
l_int|3
)paren
op_plus
l_int|4
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|vortex_src_cleardrift
r_static
r_void
id|vortex_src_cleardrift
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|src
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_DRIFT0
op_plus
(paren
id|src
op_lshift
l_int|2
)paren
comma
l_int|0
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_DRIFT1
op_plus
(paren
id|src
op_lshift
l_int|2
)paren
comma
l_int|0
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_DRIFT2
op_plus
(paren
id|src
op_lshift
l_int|2
)paren
comma
l_int|1
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|vortex_src_set_throttlesource
id|vortex_src_set_throttlesource
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|src
comma
r_int
id|en
)paren
(brace
r_int
id|temp
suffix:semicolon
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_SOURCE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|en
)paren
id|temp
op_or_assign
l_int|1
op_lshift
id|src
suffix:semicolon
r_else
id|temp
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|src
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_SOURCE
comma
id|temp
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|vortex_src_persist_convratio
id|vortex_src_persist_convratio
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|src
comma
r_int
id|ratio
)paren
(brace
r_int
id|temp
comma
id|lifeboat
op_assign
l_int|0
suffix:semicolon
r_do
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_CONVRATIO
op_plus
(paren
id|src
op_lshift
l_int|2
)paren
comma
id|ratio
)paren
suffix:semicolon
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_CONVRATIO
op_plus
(paren
id|src
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_increment
id|lifeboat
)paren
OG
l_int|0x9
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Vortex: Src cvr fail&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|temp
op_ne
id|ratio
)paren
suffix:semicolon
r_return
id|temp
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_void
id|vortex_src_slowlock
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|src
)paren
(brace
r_int
id|temp
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_DRIFT2
op_plus
(paren
id|src
op_lshift
l_int|2
)paren
comma
l_int|1
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_DRIFT0
op_plus
(paren
id|src
op_lshift
l_int|2
)paren
comma
l_int|0
)paren
suffix:semicolon
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_U0
op_plus
(paren
id|src
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_amp
l_int|0x200
)paren
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_U0
op_plus
(paren
id|src
op_lshift
l_int|2
)paren
comma
id|temp
op_amp
op_complement
l_int|0x200L
)paren
suffix:semicolon
)brace
r_static
r_void
id|vortex_src_change_convratio
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|src
comma
r_int
id|ratio
)paren
(brace
r_int
id|temp
comma
id|a
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ratio
op_amp
l_int|0x10000
)paren
op_logical_and
(paren
id|ratio
op_ne
l_int|0x10000
)paren
)paren
(brace
r_if
c_cond
(paren
id|ratio
op_amp
l_int|0x3fff
)paren
id|a
op_assign
(paren
l_int|0x11
op_minus
(paren
(paren
id|ratio
op_rshift
l_int|0xe
)paren
op_amp
l_int|0x3
)paren
)paren
op_minus
l_int|1
suffix:semicolon
r_else
id|a
op_assign
(paren
l_int|0x11
op_minus
(paren
(paren
id|ratio
op_rshift
l_int|0xe
)paren
op_amp
l_int|0x3
)paren
)paren
op_minus
l_int|2
suffix:semicolon
)brace
r_else
id|a
op_assign
l_int|0xc
suffix:semicolon
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_U0
op_plus
(paren
id|src
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|temp
op_rshift
l_int|4
)paren
op_amp
l_int|0xf
)paren
op_ne
id|a
)paren
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_U0
op_plus
(paren
id|src
op_lshift
l_int|2
)paren
comma
(paren
id|temp
op_amp
l_int|0xf
)paren
op_or
(paren
(paren
id|a
op_amp
l_int|0xf
)paren
op_lshift
l_int|4
)paren
)paren
suffix:semicolon
id|vortex_src_persist_convratio
c_func
(paren
id|vortex
comma
id|src
comma
id|ratio
)paren
suffix:semicolon
)brace
r_static
r_int
id|vortex_src_checkratio
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|src
comma
r_int
r_int
id|desired_ratio
)paren
(brace
r_int
id|hw_ratio
comma
id|lifeboat
op_assign
l_int|0
suffix:semicolon
id|hw_ratio
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_CONVRATIO
op_plus
(paren
id|src
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|hw_ratio
op_ne
id|desired_ratio
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_CONVRATIO
op_plus
(paren
id|src
op_lshift
l_int|2
)paren
comma
id|desired_ratio
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|lifeboat
op_increment
)paren
OG
l_int|15
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Vortex: could not set src-%d from %d to %d&bslash;n&quot;
comma
id|src
comma
id|hw_ratio
comma
id|desired_ratio
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
id|hw_ratio
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; Objective: Set samplerate for given SRC module.&n; Arguments:&n;&t;card:&t;pointer to vortex_t strcut.&n;&t;src:&t;Integer index of the SRC module.&n;&t;cr:&t;&t;Current sample rate conversion factor.&n;&t;b:&t;&t;unknown 16 bit value.&n;&t;sweep:&t;Enable Samplerate fade from cr toward tr flag.&n;&t;dirplay: 1: playback, 0: recording.&n;&t;sl:&t;&t;Slow Lock flag.&n;&t;tr:&t;&t;Target samplerate conversion.&n;&t;thsource: Throttle source flag (no idea what that means).&n;*/
DECL|function|vortex_src_setupchannel
r_static
r_void
id|vortex_src_setupchannel
c_func
(paren
id|vortex_t
op_star
id|card
comma
r_int
r_char
id|src
comma
r_int
r_int
id|cr
comma
r_int
r_int
id|b
comma
r_int
id|sweep
comma
r_int
id|d
comma
r_int
id|dirplay
comma
r_int
id|sl
comma
r_int
r_int
id|tr
comma
r_int
id|thsource
)paren
(brace
singleline_comment|// noplayback: d=2,4,7,0xa,0xb when using first 2 src&squot;s.
singleline_comment|// c: enables pitch sweep.
singleline_comment|// looks like g is c related. Maybe g is a sweep parameter ?
singleline_comment|// g = cvr
singleline_comment|// dirplay: 0 = recording, 1 = playback
singleline_comment|// d = src hw index.
r_int
id|esi
comma
id|ebp
op_assign
l_int|0
comma
id|esp10
suffix:semicolon
id|vortex_src_flushbuffers
c_func
(paren
id|card
comma
id|src
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sweep
)paren
(brace
r_if
c_cond
(paren
(paren
id|tr
op_amp
l_int|0x10000
)paren
op_logical_and
(paren
id|tr
op_ne
l_int|0x10000
)paren
)paren
(brace
id|tr
op_assign
l_int|0
suffix:semicolon
id|esi
op_assign
l_int|0x7
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
(paren
(paren
r_int
)paren
id|tr
)paren
OL
l_int|0
)paren
op_logical_and
(paren
id|tr
op_ne
l_int|0x8000
)paren
)paren
(brace
id|tr
op_assign
l_int|0
suffix:semicolon
id|esi
op_assign
l_int|0x8
suffix:semicolon
)brace
r_else
(brace
id|tr
op_assign
l_int|1
suffix:semicolon
id|esi
op_assign
l_int|0xc
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|cr
op_amp
l_int|0x10000
)paren
op_logical_and
(paren
id|cr
op_ne
l_int|0x10000
)paren
)paren
(brace
id|tr
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*ebx = 0 */
id|esi
op_assign
l_int|0x11
op_minus
(paren
(paren
id|cr
op_rshift
l_int|0xe
)paren
op_amp
l_int|7
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cr
op_amp
l_int|0x3fff
)paren
id|esi
op_sub_assign
l_int|1
suffix:semicolon
r_else
id|esi
op_sub_assign
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|tr
op_assign
l_int|1
suffix:semicolon
id|esi
op_assign
l_int|0xc
suffix:semicolon
)brace
)brace
id|vortex_src_cleardrift
c_func
(paren
id|card
comma
id|src
)paren
suffix:semicolon
id|vortex_src_set_throttlesource
c_func
(paren
id|card
comma
id|src
comma
id|thsource
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dirplay
op_eq
l_int|0
)paren
op_logical_and
(paren
id|sweep
op_eq
l_int|0
)paren
)paren
(brace
r_if
c_cond
(paren
id|tr
)paren
id|esp10
op_assign
l_int|0xf
suffix:semicolon
r_else
id|esp10
op_assign
l_int|0xc
suffix:semicolon
id|ebp
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|tr
)paren
id|ebp
op_assign
l_int|0xf
suffix:semicolon
r_else
id|ebp
op_assign
l_int|0xc
suffix:semicolon
id|esp10
op_assign
l_int|0
suffix:semicolon
)brace
id|hwwrite
c_func
(paren
id|card-&gt;mmio
comma
id|VORTEX_SRC_U0
op_plus
(paren
id|src
op_lshift
l_int|2
)paren
comma
(paren
id|sl
op_lshift
l_int|0x9
)paren
op_or
(paren
id|sweep
op_lshift
l_int|0x8
)paren
op_or
(paren
(paren
id|esi
op_amp
l_int|0xf
)paren
op_lshift
l_int|4
)paren
op_or
id|d
)paren
suffix:semicolon
multiline_comment|/* 0xc0   esi=0xc c=f=0 d=0 */
id|vortex_src_persist_convratio
c_func
(paren
id|card
comma
id|src
comma
id|cr
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|card-&gt;mmio
comma
id|VORTEX_SRC_U1
op_plus
(paren
id|src
op_lshift
l_int|2
)paren
comma
id|b
op_amp
l_int|0xffff
)paren
suffix:semicolon
multiline_comment|/* 0   b=0 */
id|hwwrite
c_func
(paren
id|card-&gt;mmio
comma
id|VORTEX_SRC_U2
op_plus
(paren
id|src
op_lshift
l_int|2
)paren
comma
(paren
id|tr
op_lshift
l_int|0x11
)paren
op_or
(paren
id|dirplay
op_lshift
l_int|0x10
)paren
op_or
(paren
id|ebp
op_lshift
l_int|0x8
)paren
op_or
id|esp10
)paren
suffix:semicolon
multiline_comment|/* 0x30f00 e=g=1 esp10=0 ebp=f */
singleline_comment|//printk(KERN_INFO &quot;vortex: SRC %d, d=0x%x, esi=0x%x, esp10=0x%x, ebp=0x%x&bslash;n&quot;, src, d, esi, esp10, ebp);
)brace
DECL|function|vortex_srcblock_init
r_static
r_void
id|vortex_srcblock_init
c_func
(paren
id|vortex_t
op_star
id|vortex
)paren
(brace
r_int
r_int
id|addr
suffix:semicolon
r_int
id|x
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_SOURCESIZE
comma
l_int|0x1ff
)paren
suffix:semicolon
multiline_comment|/*&n;&t;   for (x=0; x&lt;0x10; x++) {&n;&t;   vortex_src_init(&amp;vortex_src[x], x);&n;&t;   }&n;&t; */
singleline_comment|//addr = 0xcc3c;
singleline_comment|//addr = 0x26c3c;
id|addr
op_assign
id|VORTEX_SRC_RTBASE
op_plus
l_int|0x3c
suffix:semicolon
r_for
c_loop
(paren
id|x
op_assign
l_int|0xf
suffix:semicolon
id|x
op_ge
l_int|0
suffix:semicolon
id|x
op_decrement
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|addr
comma
l_int|0
)paren
suffix:semicolon
id|addr
op_sub_assign
l_int|4
suffix:semicolon
)brace
singleline_comment|//addr = 0xcc94;
singleline_comment|//addr = 0x26c94;
id|addr
op_assign
id|VORTEX_SRC_CHNBASE
op_plus
l_int|0x54
suffix:semicolon
r_for
c_loop
(paren
id|x
op_assign
l_int|0x15
suffix:semicolon
id|x
op_ge
l_int|0
suffix:semicolon
id|x
op_decrement
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|addr
comma
l_int|0
)paren
suffix:semicolon
id|addr
op_sub_assign
l_int|4
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|vortex_src_addWTD
id|vortex_src_addWTD
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|src
comma
r_int
r_char
id|ch
)paren
(brace
r_int
id|temp
comma
id|lifeboat
op_assign
l_int|0
comma
id|prev
suffix:semicolon
singleline_comment|// esp13 = src
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRCBLOCK_SR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp
op_amp
(paren
l_int|1
op_lshift
id|ch
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_CHNBASE
op_plus
(paren
id|ch
op_lshift
l_int|2
)paren
comma
id|src
)paren
suffix:semicolon
id|vortex_src_en_sr
c_func
(paren
id|vortex
comma
id|ch
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|prev
op_assign
id|VORTEX_SRC_CHNBASE
op_plus
(paren
id|ch
op_lshift
l_int|2
)paren
suffix:semicolon
multiline_comment|/*ebp */
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|prev
)paren
suffix:semicolon
singleline_comment|//while (temp &amp; NR_SRC) {
r_while
c_loop
(paren
id|temp
op_amp
l_int|0x10
)paren
(brace
id|prev
op_assign
id|VORTEX_SRC_RTBASE
op_plus
(paren
(paren
id|temp
op_amp
l_int|0xf
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
multiline_comment|/*esp12 */
singleline_comment|//prev = VORTEX_SRC_RTBASE + ((temp &amp; (NR_SRC-1)) &lt;&lt; 2); /*esp12*/
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|prev
)paren
suffix:semicolon
singleline_comment|//printk(KERN_INFO &quot;vortex: srcAddWTD: while addr=%x, val=%x&bslash;n&quot;, prev, temp);
r_if
c_cond
(paren
(paren
op_increment
id|lifeboat
)paren
OG
l_int|0xf
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;vortex_src_addWTD: lifeboat overflow&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_RTBASE
op_plus
(paren
(paren
id|temp
op_amp
l_int|0xf
)paren
op_lshift
l_int|2
)paren
comma
id|src
)paren
suffix:semicolon
singleline_comment|//hwwrite(vortex-&gt;mmio, prev, (temp &amp; (NR_SRC-1)) | NR_SRC);
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|prev
comma
(paren
id|temp
op_amp
l_int|0xf
)paren
op_or
l_int|0x10
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_static
r_int
DECL|function|vortex_src_delWTD
id|vortex_src_delWTD
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|src
comma
r_int
r_char
id|ch
)paren
(brace
r_int
id|esp14
op_assign
op_minus
l_int|1
comma
id|esp18
comma
id|eax
comma
id|ebx
comma
id|edx
comma
id|ebp
comma
id|esi
op_assign
l_int|0
suffix:semicolon
singleline_comment|//int esp1f=edi(while)=src, esp10=ch;
id|eax
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRCBLOCK_SR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
l_int|1
op_lshift
id|ch
)paren
op_amp
id|eax
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;src alarm&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ebp
op_assign
id|VORTEX_SRC_CHNBASE
op_plus
(paren
id|ch
op_lshift
l_int|2
)paren
suffix:semicolon
id|esp18
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|ebp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|esp18
op_amp
l_int|0x10
)paren
(brace
id|ebx
op_assign
(paren
id|esp18
op_amp
l_int|0xf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|src
op_eq
id|ebx
)paren
(brace
id|ebx
op_assign
id|VORTEX_SRC_RTBASE
op_plus
(paren
id|src
op_lshift
l_int|2
)paren
suffix:semicolon
id|edx
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|ebx
)paren
suffix:semicolon
singleline_comment|//7b60
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|ebp
comma
id|edx
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|ebx
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
singleline_comment|//7ad3
id|edx
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_RTBASE
op_plus
(paren
id|ebx
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
singleline_comment|//printk(KERN_INFO &quot;vortex: srcdelWTD: 1 addr=%x, val=%x, src=%x&bslash;n&quot;, ebx, edx, src);
r_while
c_loop
(paren
(paren
id|edx
op_amp
l_int|0xf
)paren
op_ne
id|src
)paren
(brace
r_if
c_cond
(paren
(paren
id|esi
)paren
OG
l_int|0xf
)paren
(brace
id|printk
(paren
l_string|&quot;vortex: srcdelWTD: error, lifeboat overflow&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|esp14
op_assign
id|ebx
suffix:semicolon
id|ebx
op_assign
id|edx
op_amp
l_int|0xf
suffix:semicolon
id|ebp
op_assign
id|ebx
op_lshift
l_int|2
suffix:semicolon
id|edx
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_RTBASE
op_plus
id|ebp
)paren
suffix:semicolon
singleline_comment|//printk(KERN_INFO &quot;vortex: srcdelWTD: while addr=%x, val=%x&bslash;n&quot;, ebp, edx);
id|esi
op_increment
suffix:semicolon
)brace
singleline_comment|//7b30
id|ebp
op_assign
id|ebx
op_lshift
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|edx
op_amp
l_int|0x10
)paren
(brace
multiline_comment|/* Delete entry in between others */
id|ebx
op_assign
id|VORTEX_SRC_RTBASE
op_plus
(paren
(paren
id|edx
op_amp
l_int|0xf
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
id|edx
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|ebx
)paren
suffix:semicolon
singleline_comment|//7b60
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_RTBASE
op_plus
id|ebp
comma
id|edx
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|ebx
comma
l_int|0
)paren
suffix:semicolon
singleline_comment|//printk(KERN_INFO &quot;vortex srcdelWTD between addr= 0x%x, val= 0x%x&bslash;n&quot;, ebp, edx);
)brace
r_else
(brace
multiline_comment|/* Delete last entry */
singleline_comment|//7b83
r_if
c_cond
(paren
id|esp14
op_eq
op_minus
l_int|1
)paren
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_CHNBASE
op_plus
(paren
id|ch
op_lshift
l_int|2
)paren
comma
id|esp18
op_amp
l_int|0xef
)paren
suffix:semicolon
r_else
(brace
id|ebx
op_assign
(paren
l_int|0xffffffe0
op_amp
id|edx
)paren
op_or
(paren
l_int|0xf
op_amp
id|ebx
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_RTBASE
op_plus
(paren
id|esp14
op_lshift
l_int|2
)paren
comma
id|ebx
)paren
suffix:semicolon
singleline_comment|//printk(KERN_INFO&quot;vortex srcdelWTD last addr= 0x%x, val= 0x%x&bslash;n&quot;, esp14, ebx);
)brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SRC_RTBASE
op_plus
id|ebp
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
singleline_comment|//7be0
id|vortex_src_dis_sr
c_func
(paren
id|vortex
comma
id|ch
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|ebp
comma
l_int|0
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*FIFO*/
r_static
r_void
DECL|function|vortex_fifo_clearadbdata
id|vortex_fifo_clearadbdata
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|fifo
comma
r_int
id|x
)paren
(brace
r_for
c_loop
(paren
id|x
op_decrement
suffix:semicolon
id|x
op_ge
l_int|0
suffix:semicolon
id|x
op_decrement
)paren
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_FIFO_ADBDATA
op_plus
(paren
(paren
(paren
id|fifo
op_lshift
id|FIFO_SIZE_BITS
)paren
op_plus
id|x
)paren
op_lshift
l_int|2
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_void
id|vortex_fifo_adbinitialize
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|fifo
comma
r_int
id|j
)paren
(brace
id|vortex_fifo_clearadbdata
c_func
(paren
id|vortex
comma
id|fifo
comma
id|FIFO_SIZE
)paren
suffix:semicolon
macro_line|#ifdef CHIP_AU8820
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_FIFO_ADBCTRL
op_plus
(paren
id|fifo
op_lshift
l_int|2
)paren
comma
(paren
id|FIFO_U1
op_or
(paren
(paren
id|j
op_amp
id|FIFO_MASK
)paren
op_lshift
l_int|0xb
)paren
)paren
)paren
suffix:semicolon
macro_line|#else
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_FIFO_ADBCTRL
op_plus
(paren
id|fifo
op_lshift
l_int|2
)paren
comma
(paren
id|FIFO_U1
op_or
(paren
(paren
id|j
op_amp
id|FIFO_MASK
)paren
op_lshift
l_int|0xc
)paren
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif
DECL|function|vortex_fifo_setadbvalid
r_static
r_void
id|vortex_fifo_setadbvalid
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|fifo
comma
r_int
id|en
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_FIFO_ADBCTRL
op_plus
(paren
id|fifo
op_lshift
l_int|2
)paren
comma
(paren
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_FIFO_ADBCTRL
op_plus
(paren
id|fifo
op_lshift
l_int|2
)paren
)paren
op_amp
l_int|0xffffffef
)paren
op_or
(paren
(paren
l_int|1
op_amp
id|en
)paren
op_lshift
l_int|4
)paren
op_or
id|FIFO_U1
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|vortex_fifo_setadbctrl
id|vortex_fifo_setadbctrl
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|fifo
comma
r_int
id|b
comma
r_int
id|priority
comma
r_int
id|empty
comma
r_int
id|valid
comma
r_int
id|f
)paren
(brace
r_int
id|temp
comma
id|lifeboat
op_assign
l_int|0
suffix:semicolon
singleline_comment|//int this_8[NR_ADB] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}; /* position */
r_int
id|this_4
op_assign
l_int|0x2
suffix:semicolon
multiline_comment|/* f seems priority related.&n;&t; * CAsp4AdbDma::SetPriority is the only place that calls SetAdbCtrl with f set to 1&n;&t; * every where else it is set to 0. It seems, however, that CAsp4AdbDma::SetPriority&n;&t; * is never called, thus the f related bits remain a mystery for now.&n;&t; */
r_do
(brace
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_FIFO_ADBCTRL
op_plus
(paren
id|fifo
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lifeboat
op_increment
OG
l_int|0xbb8
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Vortex: vortex_fifo_setadbctrl fail&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|temp
op_amp
id|FIFO_RDONLY
)paren
suffix:semicolon
singleline_comment|// AU8830 semes to take some special care about fifo content (data).
singleline_comment|// But i&squot;m just to lazy to translate that :)
r_if
c_cond
(paren
id|valid
)paren
(brace
r_if
c_cond
(paren
(paren
id|temp
op_amp
id|FIFO_VALID
)paren
op_eq
l_int|0
)paren
(brace
singleline_comment|//this_8[fifo] = 0;
id|vortex_fifo_clearadbdata
c_func
(paren
id|vortex
comma
id|fifo
comma
id|FIFO_SIZE
)paren
suffix:semicolon
singleline_comment|// this_4
macro_line|#ifdef CHIP_AU8820
id|temp
op_assign
(paren
id|this_4
op_amp
l_int|0x1f
)paren
op_lshift
l_int|0xb
suffix:semicolon
macro_line|#else
id|temp
op_assign
(paren
id|this_4
op_amp
l_int|0x3f
)paren
op_lshift
l_int|0xc
suffix:semicolon
macro_line|#endif
id|temp
op_assign
(paren
id|temp
op_amp
l_int|0xfffffffd
)paren
op_or
(paren
(paren
id|b
op_amp
l_int|1
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|temp
op_amp
l_int|0xfffffff3
)paren
op_or
(paren
(paren
id|priority
op_amp
l_int|3
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|temp
op_amp
l_int|0xffffffef
)paren
op_or
(paren
(paren
id|valid
op_amp
l_int|1
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|temp
op_or_assign
id|FIFO_U1
suffix:semicolon
id|temp
op_assign
(paren
id|temp
op_amp
l_int|0xffffffdf
)paren
op_or
(paren
(paren
id|empty
op_amp
l_int|1
)paren
op_lshift
l_int|5
)paren
suffix:semicolon
macro_line|#ifdef CHIP_AU8820
id|temp
op_assign
(paren
id|temp
op_amp
l_int|0xfffbffff
)paren
op_or
(paren
(paren
id|f
op_amp
l_int|1
)paren
op_lshift
l_int|0x12
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CHIP_AU8830
id|temp
op_assign
(paren
id|temp
op_amp
l_int|0xf7ffffff
)paren
op_or
(paren
(paren
id|f
op_amp
l_int|1
)paren
op_lshift
l_int|0x1b
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|temp
op_amp
l_int|0xefffffff
)paren
op_or
(paren
(paren
id|f
op_amp
l_int|1
)paren
op_lshift
l_int|0x1c
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CHIP_AU8810
id|temp
op_assign
(paren
id|temp
op_amp
l_int|0xfeffffff
)paren
op_or
(paren
(paren
id|f
op_amp
l_int|1
)paren
op_lshift
l_int|0x18
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|temp
op_amp
l_int|0xfdffffff
)paren
op_or
(paren
(paren
id|f
op_amp
l_int|1
)paren
op_lshift
l_int|0x19
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|temp
op_amp
id|FIFO_VALID
)paren
(brace
macro_line|#ifdef CHIP_AU8820
id|temp
op_assign
(paren
(paren
id|f
op_amp
l_int|1
)paren
op_lshift
l_int|0x12
)paren
op_or
(paren
id|temp
op_amp
l_int|0xfffbffef
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CHIP_AU8830
id|temp
op_assign
(paren
(paren
id|f
op_amp
l_int|1
)paren
op_lshift
l_int|0x1b
)paren
op_or
(paren
id|temp
op_amp
l_int|0xe7ffffef
)paren
op_or
id|FIFO_BITS
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CHIP_AU8810
id|temp
op_assign
(paren
(paren
id|f
op_amp
l_int|1
)paren
op_lshift
l_int|0x18
)paren
op_or
(paren
id|temp
op_amp
l_int|0xfcffffef
)paren
op_or
id|FIFO_BITS
suffix:semicolon
macro_line|#endif
)brace
r_else
multiline_comment|/*if (this_8[fifo]) */
id|vortex_fifo_clearadbdata
c_func
(paren
id|vortex
comma
id|fifo
comma
id|FIFO_SIZE
)paren
suffix:semicolon
)brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_FIFO_ADBCTRL
op_plus
(paren
id|fifo
op_lshift
l_int|2
)paren
comma
id|temp
)paren
suffix:semicolon
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_FIFO_ADBCTRL
op_plus
(paren
id|fifo
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
)brace
macro_line|#ifndef CHIP_AU8810
DECL|function|vortex_fifo_clearwtdata
r_static
r_void
id|vortex_fifo_clearwtdata
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|fifo
comma
r_int
id|x
)paren
(brace
r_if
c_cond
(paren
id|x
OL
l_int|1
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|x
op_decrement
suffix:semicolon
id|x
op_ge
l_int|0
suffix:semicolon
id|x
op_decrement
)paren
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_FIFO_WTDATA
op_plus
(paren
(paren
(paren
id|fifo
op_lshift
id|FIFO_SIZE_BITS
)paren
op_plus
id|x
)paren
op_lshift
l_int|2
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|vortex_fifo_wtinitialize
r_static
r_void
id|vortex_fifo_wtinitialize
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|fifo
comma
r_int
id|j
)paren
(brace
id|vortex_fifo_clearwtdata
c_func
(paren
id|vortex
comma
id|fifo
comma
id|FIFO_SIZE
)paren
suffix:semicolon
macro_line|#ifdef CHIP_AU8820
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_FIFO_WTCTRL
op_plus
(paren
id|fifo
op_lshift
l_int|2
)paren
comma
(paren
id|FIFO_U1
op_or
(paren
(paren
id|j
op_amp
id|FIFO_MASK
)paren
op_lshift
l_int|0xb
)paren
)paren
)paren
suffix:semicolon
macro_line|#else
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_FIFO_WTCTRL
op_plus
(paren
id|fifo
op_lshift
l_int|2
)paren
comma
(paren
id|FIFO_U1
op_or
(paren
(paren
id|j
op_amp
id|FIFO_MASK
)paren
op_lshift
l_int|0xc
)paren
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|vortex_fifo_setwtvalid
r_static
r_void
id|vortex_fifo_setwtvalid
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|fifo
comma
r_int
id|en
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_FIFO_WTCTRL
op_plus
(paren
id|fifo
op_lshift
l_int|2
)paren
comma
(paren
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_FIFO_WTCTRL
op_plus
(paren
id|fifo
op_lshift
l_int|2
)paren
)paren
op_amp
l_int|0xffffffef
)paren
op_or
(paren
(paren
id|en
op_amp
l_int|1
)paren
op_lshift
l_int|4
)paren
op_or
id|FIFO_U1
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|vortex_fifo_setwtctrl
id|vortex_fifo_setwtctrl
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|fifo
comma
r_int
id|ctrl
comma
r_int
id|priority
comma
r_int
id|empty
comma
r_int
id|valid
comma
r_int
id|f
)paren
(brace
r_int
id|temp
op_assign
l_int|0
comma
id|lifeboat
op_assign
l_int|0
suffix:semicolon
r_int
id|this_4
op_assign
l_int|2
suffix:semicolon
r_do
(brace
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_FIFO_WTCTRL
op_plus
(paren
id|fifo
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lifeboat
op_increment
OG
l_int|0xbb8
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Vortex: vortex_fifo_setwtctrl fail&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|temp
op_amp
id|FIFO_RDONLY
)paren
suffix:semicolon
r_if
c_cond
(paren
id|valid
)paren
(brace
r_if
c_cond
(paren
(paren
id|temp
op_amp
id|FIFO_VALID
)paren
op_eq
l_int|0
)paren
(brace
id|vortex_fifo_clearwtdata
c_func
(paren
id|vortex
comma
id|fifo
comma
id|FIFO_SIZE
)paren
suffix:semicolon
singleline_comment|// this_4
macro_line|#ifdef CHIP_AU8820
id|temp
op_assign
(paren
id|this_4
op_amp
l_int|0x1f
)paren
op_lshift
l_int|0xb
suffix:semicolon
macro_line|#else
id|temp
op_assign
(paren
id|this_4
op_amp
l_int|0x3f
)paren
op_lshift
l_int|0xc
suffix:semicolon
macro_line|#endif
id|temp
op_assign
(paren
id|temp
op_amp
l_int|0xfffffffd
)paren
op_or
(paren
(paren
id|ctrl
op_amp
l_int|1
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|temp
op_amp
l_int|0xfffffff3
)paren
op_or
(paren
(paren
id|priority
op_amp
l_int|3
)paren
op_lshift
l_int|2
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|temp
op_amp
l_int|0xffffffef
)paren
op_or
(paren
(paren
id|valid
op_amp
l_int|1
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|temp
op_or_assign
id|FIFO_U1
suffix:semicolon
id|temp
op_assign
(paren
id|temp
op_amp
l_int|0xffffffdf
)paren
op_or
(paren
(paren
id|empty
op_amp
l_int|1
)paren
op_lshift
l_int|5
)paren
suffix:semicolon
macro_line|#ifdef CHIP_AU8820
id|temp
op_assign
(paren
id|temp
op_amp
l_int|0xfffbffff
)paren
op_or
(paren
(paren
id|f
op_amp
l_int|1
)paren
op_lshift
l_int|0x12
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CHIP_AU8830
id|temp
op_assign
(paren
id|temp
op_amp
l_int|0xf7ffffff
)paren
op_or
(paren
(paren
id|f
op_amp
l_int|1
)paren
op_lshift
l_int|0x1b
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|temp
op_amp
l_int|0xefffffff
)paren
op_or
(paren
(paren
id|f
op_amp
l_int|1
)paren
op_lshift
l_int|0x1c
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CHIP_AU8810
id|temp
op_assign
(paren
id|temp
op_amp
l_int|0xfeffffff
)paren
op_or
(paren
(paren
id|f
op_amp
l_int|1
)paren
op_lshift
l_int|0x18
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|temp
op_amp
l_int|0xfdffffff
)paren
op_or
(paren
(paren
id|f
op_amp
l_int|1
)paren
op_lshift
l_int|0x19
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|temp
op_amp
id|FIFO_VALID
)paren
(brace
macro_line|#ifdef CHIP_AU8820
id|temp
op_assign
(paren
(paren
id|f
op_amp
l_int|1
)paren
op_lshift
l_int|0x12
)paren
op_or
(paren
id|temp
op_amp
l_int|0xfffbffef
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CHIP_AU8830
id|temp
op_assign
(paren
(paren
id|f
op_amp
l_int|1
)paren
op_lshift
l_int|0x1b
)paren
op_or
(paren
id|temp
op_amp
l_int|0xe7ffffef
)paren
op_or
id|FIFO_BITS
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CHIP_AU8810
id|temp
op_assign
(paren
(paren
id|f
op_amp
l_int|1
)paren
op_lshift
l_int|0x18
)paren
op_or
(paren
id|temp
op_amp
l_int|0xfcffffef
)paren
op_or
id|FIFO_BITS
suffix:semicolon
macro_line|#endif
)brace
r_else
multiline_comment|/*if (this_8[fifo]) */
id|vortex_fifo_clearwtdata
c_func
(paren
id|vortex
comma
id|fifo
comma
id|FIFO_SIZE
)paren
suffix:semicolon
)brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_FIFO_WTCTRL
op_plus
(paren
id|fifo
op_lshift
l_int|2
)paren
comma
id|temp
)paren
suffix:semicolon
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_FIFO_WTCTRL
op_plus
(paren
id|fifo
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
multiline_comment|/*&t;&n;    do {&n;&t;&t;temp = hwread(vortex-&gt;mmio, VORTEX_FIFO_WTCTRL + (fifo &lt;&lt; 2));&n;&t;&t;if (lifeboat++ &gt; 0xbb8) {&n;&t;&t;&t;printk(KERN_ERR &quot;Vortex: vortex_fifo_setwtctrl fail (hanging)&bslash;n&quot;);&n;&t;&t;&t;break;&n;&t;&t;}&n;    } while ((temp &amp; FIFO_RDONLY)&amp;&amp;(temp &amp; FIFO_VALID)&amp;&amp;(temp != 0xFFFFFFFF));&n;&t;&n;&t;&n;&t;if (valid) {&n;&t;&t;if (temp &amp; FIFO_VALID) {&n;&t;&t;&t;temp = 0x40000;&n;&t;&t;&t;//temp |= 0x08000000;&n;&t;&t;&t;//temp |= 0x10000000;&n;&t;&t;&t;//temp |= 0x04000000;&n;&t;&t;&t;//temp |= 0x00400000;&n;&t;&t;&t;temp |= 0x1c400000;&n;&t;&t;&t;temp &amp;= 0xFFFFFFF3;&n;&t;&t;&t;temp &amp;= 0xFFFFFFEF;&n;&t;&t;&t;temp |= (valid &amp; 1) &lt;&lt; 4;&n;&t;&t;&t;hwwrite(vortex-&gt;mmio, VORTEX_FIFO_WTCTRL + (fifo &lt;&lt; 2), temp);&n;&t;&t;&t;return;&n;&t;&t;} else {&n;&t;&t;&t;vortex_fifo_clearwtdata(vortex, fifo, FIFO_SIZE);&n;&t;&t;&t;return;&n;&t;&t;}&n;&t;} else {&n;&t;&t;temp &amp;= 0xffffffef;&n;&t;&t;temp |= 0x08000000;&n;&t;&t;temp |= 0x10000000;&n;&t;&t;temp |= 0x04000000;&n;&t;&t;temp |= 0x00400000;&n;&t;&t;hwwrite(vortex-&gt;mmio, VORTEX_FIFO_WTCTRL + (fifo &lt;&lt; 2), temp);&n;&t;&t;temp = hwread(vortex-&gt;mmio, VORTEX_FIFO_WTCTRL + (fifo &lt;&lt; 2));&n;&t;&t;//((temp &gt;&gt; 6) &amp; 0x3f) &n;&t;&t;&n;&t;&t;priority = 0;&n;&t;&t;if (((temp &amp; 0x0fc0) ^ ((temp &gt;&gt; 6) &amp; 0x0fc0)) &amp; 0FFFFFFC0)&n;&t;&t;&t;vortex_fifo_clearwtdata(vortex, fifo, FIFO_SIZE);&n;&t;&t;valid = 0xfb;&n;&t;&t;temp = (temp &amp; 0xfffffffd) | ((ctrl &amp; 1) &lt;&lt; 1);&n;&t;&t;temp = (temp &amp; 0xfffdffff) | ((f &amp; 1) &lt;&lt; 0x11);&n;&t;&t;temp = (temp &amp; 0xfffffff3) | ((priority &amp; 3) &lt;&lt; 2);&n;&t;&t;temp = (temp &amp; 0xffffffef) | ((valid &amp; 1) &lt;&lt; 4);&n;&t;&t;temp = (temp &amp; 0xffffffdf) | ((empty &amp; 1) &lt;&lt; 5);&n;&t;&t;hwwrite(vortex-&gt;mmio, VORTEX_FIFO_WTCTRL + (fifo &lt;&lt; 2), temp);&n;&t;}&n;&t;&n;&t;*/
multiline_comment|/*&n;&t;   temp = (temp &amp; 0xfffffffd) | ((ctrl &amp; 1) &lt;&lt; 1);&n;&t;   temp = (temp &amp; 0xfffdffff) | ((f &amp; 1) &lt;&lt; 0x11);&n;&t;   temp = (temp &amp; 0xfffffff3) | ((priority &amp; 3) &lt;&lt; 2);&n;&t;   temp = (temp &amp; 0xffffffef) | ((valid &amp; 1) &lt;&lt; 4);&n;&t;   temp = (temp &amp; 0xffffffdf) | ((empty &amp; 1) &lt;&lt; 5);&n;&t;   #ifdef FIFO_BITS&n;&t;   temp = temp | FIFO_BITS | 40000;&n;&t;   #endif&n;&t;   // 0x1c440010, 0x1c400000&n;&t;   hwwrite(vortex-&gt;mmio, VORTEX_FIFO_WTCTRL + (fifo &lt;&lt; 2), temp);&n;&t; */
)brace
macro_line|#endif
DECL|function|vortex_fifo_init
r_static
r_void
id|vortex_fifo_init
c_func
(paren
id|vortex_t
op_star
id|vortex
)paren
(brace
r_int
id|x
suffix:semicolon
r_int
r_int
id|addr
suffix:semicolon
multiline_comment|/* ADB DMA channels fifos. */
id|addr
op_assign
id|VORTEX_FIFO_ADBCTRL
op_plus
(paren
(paren
id|NR_ADB
op_minus
l_int|1
)paren
op_star
l_int|4
)paren
suffix:semicolon
r_for
c_loop
(paren
id|x
op_assign
id|NR_ADB
op_minus
l_int|1
suffix:semicolon
id|x
op_ge
l_int|0
suffix:semicolon
id|x
op_decrement
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|addr
comma
(paren
id|FIFO_U0
op_or
id|FIFO_U1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|addr
)paren
op_ne
(paren
id|FIFO_U0
op_or
id|FIFO_U1
)paren
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;bad adb fifo reset!&quot;
)paren
suffix:semicolon
id|vortex_fifo_clearadbdata
c_func
(paren
id|vortex
comma
id|x
comma
id|FIFO_SIZE
)paren
suffix:semicolon
id|addr
op_sub_assign
l_int|4
suffix:semicolon
)brace
macro_line|#ifndef CHIP_AU8810
multiline_comment|/* WT DMA channels fifos. */
id|addr
op_assign
id|VORTEX_FIFO_WTCTRL
op_plus
(paren
(paren
id|NR_WT
op_minus
l_int|1
)paren
op_star
l_int|4
)paren
suffix:semicolon
r_for
c_loop
(paren
id|x
op_assign
id|NR_WT
op_minus
l_int|1
suffix:semicolon
id|x
op_ge
l_int|0
suffix:semicolon
id|x
op_decrement
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|addr
comma
id|FIFO_U0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|addr
)paren
op_ne
id|FIFO_U0
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;bad wt fifo reset (0x%08lx, 0x%08x)!&bslash;n&quot;
comma
id|addr
comma
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|addr
)paren
)paren
suffix:semicolon
id|vortex_fifo_clearwtdata
c_func
(paren
id|vortex
comma
id|x
comma
id|FIFO_SIZE
)paren
suffix:semicolon
id|addr
op_sub_assign
l_int|4
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* trigger... */
macro_line|#ifdef CHIP_AU8820
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
l_int|0xf8c0
comma
l_int|0xd03
)paren
suffix:semicolon
singleline_comment|//0x0843 0xd6b
macro_line|#else
macro_line|#ifdef CHIP_AU8830
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
l_int|0x17000
comma
l_int|0x61
)paren
suffix:semicolon
multiline_comment|/* wt a */
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
l_int|0x17004
comma
l_int|0x61
)paren
suffix:semicolon
multiline_comment|/* wt b */
macro_line|#endif
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
l_int|0x17008
comma
l_int|0x61
)paren
suffix:semicolon
multiline_comment|/* adb */
macro_line|#endif
)brace
multiline_comment|/* ADBDMA */
DECL|function|vortex_adbdma_init
r_static
r_void
id|vortex_adbdma_init
c_func
(paren
id|vortex_t
op_star
id|vortex
)paren
(brace
)brace
DECL|function|vortex_adbdma_setfirstbuffer
r_static
r_void
id|vortex_adbdma_setfirstbuffer
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|adbdma
)paren
(brace
id|stream_t
op_star
id|dma
op_assign
op_amp
id|vortex-&gt;dma_adb
(braket
id|adbdma
)braket
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADBDMA_CTRL
op_plus
(paren
id|adbdma
op_lshift
l_int|2
)paren
comma
id|dma-&gt;dma_ctrl
)paren
suffix:semicolon
)brace
DECL|function|vortex_adbdma_setstartbuffer
r_static
r_void
id|vortex_adbdma_setstartbuffer
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|adbdma
comma
r_int
id|sb
)paren
(brace
id|stream_t
op_star
id|dma
op_assign
op_amp
id|vortex-&gt;dma_adb
(braket
id|adbdma
)braket
suffix:semicolon
singleline_comment|//hwwrite(vortex-&gt;mmio, VORTEX_ADBDMA_START + (adbdma &lt;&lt; 2), sb &lt;&lt; (((NR_ADB-1)-((adbdma&amp;0xf)*2))));
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADBDMA_START
op_plus
(paren
id|adbdma
op_lshift
l_int|2
)paren
comma
id|sb
op_lshift
(paren
(paren
l_int|0xf
op_minus
(paren
id|adbdma
op_amp
l_int|0xf
)paren
)paren
op_star
l_int|2
)paren
)paren
suffix:semicolon
id|dma-&gt;period_real
op_assign
id|dma-&gt;period_virt
op_assign
id|sb
suffix:semicolon
)brace
r_static
r_void
DECL|function|vortex_adbdma_setbuffers
id|vortex_adbdma_setbuffers
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|adbdma
comma
id|snd_pcm_sgbuf_t
op_star
id|sgbuf
comma
r_int
id|psize
comma
r_int
id|count
)paren
(brace
id|stream_t
op_star
id|dma
op_assign
op_amp
id|vortex-&gt;dma_adb
(braket
id|adbdma
)braket
suffix:semicolon
r_if
c_cond
(paren
id|sgbuf
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;vortex: FATAL: sgbuf is NULL!&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
singleline_comment|//printk(KERN_INFO &quot;vortex: page count = %d, tblcount = %d&bslash;n&quot;, count, sgbuf-&gt;tblsize);
id|dma-&gt;period_bytes
op_assign
id|psize
suffix:semicolon
id|dma-&gt;nr_periods
op_assign
id|count
suffix:semicolon
id|dma-&gt;sgbuf
op_assign
id|sgbuf
suffix:semicolon
id|dma-&gt;cfg0
op_assign
l_int|0
suffix:semicolon
id|dma-&gt;cfg1
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|count
)paren
(brace
multiline_comment|/* Four or more pages */
r_default
suffix:colon
r_case
l_int|4
suffix:colon
id|dma-&gt;cfg1
op_or_assign
l_int|0x88000000
op_or
l_int|0x44000000
op_or
l_int|0x30000000
op_or
(paren
id|psize
op_minus
l_int|1
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADBDMA_BUFBASE
op_plus
(paren
id|adbdma
op_lshift
l_int|4
)paren
op_plus
l_int|0xc
comma
id|snd_sgbuf_get_addr
c_func
(paren
id|sgbuf
comma
id|psize
op_star
l_int|3
)paren
)paren
suffix:semicolon
multiline_comment|/* 3 pages */
r_case
l_int|3
suffix:colon
id|dma-&gt;cfg0
op_or_assign
l_int|0x12000000
suffix:semicolon
id|dma-&gt;cfg1
op_or_assign
l_int|0x80000000
op_or
l_int|0x40000000
op_or
(paren
(paren
id|psize
op_minus
l_int|1
)paren
op_lshift
l_int|0xc
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADBDMA_BUFBASE
op_plus
(paren
id|adbdma
op_lshift
l_int|4
)paren
op_plus
l_int|0x8
comma
id|snd_sgbuf_get_addr
c_func
(paren
id|sgbuf
comma
id|psize
op_star
l_int|2
)paren
)paren
suffix:semicolon
multiline_comment|/* 2 pages */
r_case
l_int|2
suffix:colon
id|dma-&gt;cfg0
op_or_assign
l_int|0x88000000
op_or
l_int|0x44000000
op_or
l_int|0x10000000
op_or
(paren
id|psize
op_minus
l_int|1
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADBDMA_BUFBASE
op_plus
(paren
id|adbdma
op_lshift
l_int|4
)paren
op_plus
l_int|0x4
comma
id|snd_sgbuf_get_addr
c_func
(paren
id|sgbuf
comma
id|psize
)paren
)paren
suffix:semicolon
multiline_comment|/* 1 page */
r_case
l_int|1
suffix:colon
id|dma-&gt;cfg0
op_or_assign
l_int|0x80000000
op_or
l_int|0x40000000
op_or
(paren
(paren
id|psize
op_minus
l_int|1
)paren
op_lshift
l_int|0xc
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADBDMA_BUFBASE
op_plus
(paren
id|adbdma
op_lshift
l_int|4
)paren
comma
id|snd_sgbuf_get_addr
c_func
(paren
id|sgbuf
comma
l_int|0
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
singleline_comment|//printk(&quot;vortex: cfg0 = 0x%x&bslash;nvortex: cfg1=0x%x&bslash;n&quot;, dma-&gt;cfg0, dma-&gt;cfg1);
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADBDMA_BUFCFG0
op_plus
(paren
id|adbdma
op_lshift
l_int|3
)paren
comma
id|dma-&gt;cfg0
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADBDMA_BUFCFG1
op_plus
(paren
id|adbdma
op_lshift
l_int|3
)paren
comma
id|dma-&gt;cfg1
)paren
suffix:semicolon
id|vortex_adbdma_setfirstbuffer
c_func
(paren
id|vortex
comma
id|adbdma
)paren
suffix:semicolon
id|vortex_adbdma_setstartbuffer
c_func
(paren
id|vortex
comma
id|adbdma
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|vortex_adbdma_setmode
id|vortex_adbdma_setmode
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|adbdma
comma
r_int
id|ie
comma
r_int
id|dir
comma
r_int
id|fmt
comma
r_int
id|d
comma
r_int
r_int
id|offset
)paren
(brace
id|stream_t
op_star
id|dma
op_assign
op_amp
id|vortex-&gt;dma_adb
(braket
id|adbdma
)braket
suffix:semicolon
id|dma-&gt;dma_unknown
op_assign
id|d
suffix:semicolon
id|dma-&gt;dma_ctrl
op_assign
(paren
(paren
id|offset
op_amp
id|OFFSET_MASK
)paren
op_or
(paren
id|dma-&gt;dma_ctrl
op_amp
op_complement
id|OFFSET_MASK
)paren
)paren
suffix:semicolon
multiline_comment|/* Enable PCMOUT interrupts. */
id|dma-&gt;dma_ctrl
op_assign
(paren
id|dma-&gt;dma_ctrl
op_amp
op_complement
id|IE_MASK
)paren
op_or
(paren
(paren
id|ie
op_lshift
id|IE_SHIFT
)paren
op_amp
id|IE_MASK
)paren
suffix:semicolon
id|dma-&gt;dma_ctrl
op_assign
(paren
id|dma-&gt;dma_ctrl
op_amp
op_complement
id|DIR_MASK
)paren
op_or
(paren
(paren
id|dir
op_lshift
id|DIR_SHIFT
)paren
op_amp
id|DIR_MASK
)paren
suffix:semicolon
id|dma-&gt;dma_ctrl
op_assign
(paren
id|dma-&gt;dma_ctrl
op_amp
op_complement
id|FMT_MASK
)paren
op_or
(paren
(paren
id|fmt
op_lshift
id|FMT_SHIFT
)paren
op_amp
id|FMT_MASK
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADBDMA_CTRL
op_plus
(paren
id|adbdma
op_lshift
l_int|2
)paren
comma
id|dma-&gt;dma_ctrl
)paren
suffix:semicolon
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADBDMA_CTRL
op_plus
(paren
id|adbdma
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
)brace
DECL|function|vortex_adbdma_bufshift
r_static
r_int
id|vortex_adbdma_bufshift
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|adbdma
)paren
(brace
id|stream_t
op_star
id|dma
op_assign
op_amp
id|vortex-&gt;dma_adb
(braket
id|adbdma
)braket
suffix:semicolon
r_int
id|page
comma
id|p
comma
id|pp
comma
id|delta
comma
id|i
suffix:semicolon
id|page
op_assign
(paren
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADBDMA_STAT
op_plus
(paren
id|adbdma
op_lshift
l_int|2
)paren
)paren
op_amp
id|ADB_SUBBUF_MASK
)paren
op_rshift
id|ADB_SUBBUF_SHIFT
suffix:semicolon
r_if
c_cond
(paren
id|dma-&gt;nr_periods
op_ge
l_int|4
)paren
id|delta
op_assign
(paren
id|page
op_minus
id|dma-&gt;period_real
)paren
op_amp
l_int|3
suffix:semicolon
r_else
(brace
id|delta
op_assign
(paren
id|page
op_minus
id|dma-&gt;period_real
)paren
suffix:semicolon
r_if
c_cond
(paren
id|delta
OL
l_int|0
)paren
id|delta
op_add_assign
id|dma-&gt;nr_periods
suffix:semicolon
)brace
r_if
c_cond
(paren
id|delta
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* refresh hw page table */
r_if
c_cond
(paren
id|dma-&gt;nr_periods
OG
l_int|4
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|delta
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* p: audio buffer page index */
id|p
op_assign
id|dma-&gt;period_virt
op_plus
id|i
op_plus
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|p
op_ge
id|dma-&gt;nr_periods
)paren
id|p
op_sub_assign
id|dma-&gt;nr_periods
suffix:semicolon
multiline_comment|/* pp: hardware DMA page index. */
id|pp
op_assign
id|dma-&gt;period_real
op_plus
id|i
suffix:semicolon
r_if
c_cond
(paren
id|pp
op_ge
l_int|4
)paren
id|pp
op_sub_assign
l_int|4
suffix:semicolon
singleline_comment|//hwwrite(vortex-&gt;mmio, VORTEX_ADBDMA_BUFBASE+(((adbdma &lt;&lt; 2)+pp) &lt;&lt; 2), dma-&gt;table[p].addr);
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADBDMA_BUFBASE
op_plus
(paren
(paren
(paren
id|adbdma
op_lshift
l_int|2
)paren
op_plus
id|pp
)paren
op_lshift
l_int|2
)paren
comma
id|snd_sgbuf_get_addr
c_func
(paren
id|dma-&gt;sgbuf
comma
id|dma-&gt;period_bytes
op_star
id|p
)paren
)paren
suffix:semicolon
multiline_comment|/* Force write thru cache. */
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADBDMA_BUFBASE
op_plus
(paren
(paren
(paren
id|adbdma
op_lshift
l_int|2
)paren
op_plus
id|pp
)paren
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
)brace
)brace
id|dma-&gt;period_virt
op_add_assign
id|delta
suffix:semicolon
id|dma-&gt;period_real
op_assign
id|page
suffix:semicolon
r_if
c_cond
(paren
id|dma-&gt;period_virt
op_ge
id|dma-&gt;nr_periods
)paren
id|dma-&gt;period_virt
op_sub_assign
id|dma-&gt;nr_periods
suffix:semicolon
r_if
c_cond
(paren
id|delta
op_ne
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;vortex: %d virt=%d, real=%d, delta=%d&bslash;n&quot;
comma
id|adbdma
comma
id|dma-&gt;period_virt
comma
id|dma-&gt;period_real
comma
id|delta
)paren
suffix:semicolon
r_return
id|delta
suffix:semicolon
)brace
DECL|function|vortex_adbdma_getlinearpos
r_static
r_int
r_inline
id|vortex_adbdma_getlinearpos
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|adbdma
)paren
(brace
id|stream_t
op_star
id|dma
op_assign
op_amp
id|vortex-&gt;dma_adb
(braket
id|adbdma
)braket
suffix:semicolon
r_int
id|temp
suffix:semicolon
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADBDMA_STAT
op_plus
(paren
id|adbdma
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|temp
op_assign
(paren
id|dma-&gt;period_virt
op_star
id|dma-&gt;period_bytes
)paren
op_plus
(paren
id|temp
op_amp
id|POS_MASK
)paren
suffix:semicolon
r_return
(paren
id|temp
)paren
suffix:semicolon
)brace
DECL|function|vortex_adbdma_startfifo
r_static
r_void
id|vortex_adbdma_startfifo
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|adbdma
)paren
(brace
r_int
id|this_8
op_assign
l_int|0
multiline_comment|/*empty */
comma
id|this_4
op_assign
l_int|0
multiline_comment|/*priority */
suffix:semicolon
id|stream_t
op_star
id|dma
op_assign
op_amp
id|vortex-&gt;dma_adb
(braket
id|adbdma
)braket
suffix:semicolon
r_switch
c_cond
(paren
id|dma-&gt;fifo_status
)paren
(brace
r_case
id|FIFO_START
suffix:colon
id|vortex_fifo_setadbvalid
c_func
(paren
id|vortex
comma
id|adbdma
comma
id|dma-&gt;fifo_enabled
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FIFO_STOP
suffix:colon
id|this_8
op_assign
l_int|1
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADBDMA_CTRL
op_plus
(paren
id|adbdma
op_lshift
l_int|2
)paren
comma
id|dma-&gt;dma_ctrl
)paren
suffix:semicolon
id|vortex_fifo_setadbctrl
c_func
(paren
id|vortex
comma
id|adbdma
comma
id|dma-&gt;dma_unknown
comma
id|this_4
comma
id|this_8
comma
id|dma-&gt;fifo_enabled
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FIFO_PAUSE
suffix:colon
id|vortex_fifo_setadbctrl
c_func
(paren
id|vortex
comma
id|adbdma
comma
id|dma-&gt;dma_unknown
comma
id|this_4
comma
id|this_8
comma
id|dma-&gt;fifo_enabled
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|dma-&gt;fifo_status
op_assign
id|FIFO_START
suffix:semicolon
)brace
DECL|function|vortex_adbdma_resumefifo
r_static
r_void
id|vortex_adbdma_resumefifo
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|adbdma
)paren
(brace
id|stream_t
op_star
id|dma
op_assign
op_amp
id|vortex-&gt;dma_adb
(braket
id|adbdma
)braket
suffix:semicolon
r_int
id|this_8
op_assign
l_int|1
comma
id|this_4
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|dma-&gt;fifo_status
)paren
(brace
r_case
id|FIFO_STOP
suffix:colon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADBDMA_CTRL
op_plus
(paren
id|adbdma
op_lshift
l_int|2
)paren
comma
id|dma-&gt;dma_ctrl
)paren
suffix:semicolon
id|vortex_fifo_setadbctrl
c_func
(paren
id|vortex
comma
id|adbdma
comma
id|dma-&gt;dma_unknown
comma
id|this_4
comma
id|this_8
comma
id|dma-&gt;fifo_enabled
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FIFO_PAUSE
suffix:colon
id|vortex_fifo_setadbctrl
c_func
(paren
id|vortex
comma
id|adbdma
comma
id|dma-&gt;dma_unknown
comma
id|this_4
comma
id|this_8
comma
id|dma-&gt;fifo_enabled
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|dma-&gt;fifo_status
op_assign
id|FIFO_START
suffix:semicolon
)brace
DECL|function|vortex_adbdma_pausefifo
r_static
r_void
id|vortex_adbdma_pausefifo
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|adbdma
)paren
(brace
id|stream_t
op_star
id|dma
op_assign
op_amp
id|vortex-&gt;dma_adb
(braket
id|adbdma
)braket
suffix:semicolon
r_int
id|this_8
op_assign
l_int|0
comma
id|this_4
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|dma-&gt;fifo_status
)paren
(brace
r_case
id|FIFO_START
suffix:colon
id|vortex_fifo_setadbctrl
c_func
(paren
id|vortex
comma
id|adbdma
comma
id|dma-&gt;dma_unknown
comma
id|this_4
comma
id|this_8
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FIFO_STOP
suffix:colon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADBDMA_CTRL
op_plus
(paren
id|adbdma
op_lshift
l_int|2
)paren
comma
id|dma-&gt;dma_ctrl
)paren
suffix:semicolon
id|vortex_fifo_setadbctrl
c_func
(paren
id|vortex
comma
id|adbdma
comma
id|dma-&gt;dma_unknown
comma
id|this_4
comma
id|this_8
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|dma-&gt;fifo_status
op_assign
id|FIFO_PAUSE
suffix:semicolon
)brace
macro_line|#if 0&t;&t;&t;&t;
singleline_comment|// Using pause instead
r_static
r_void
id|vortex_adbdma_stopfifo
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|adbdma
)paren
(brace
id|stream_t
op_star
id|dma
op_assign
op_amp
id|vortex-&gt;dma_adb
(braket
id|adbdma
)braket
suffix:semicolon
r_int
id|this_4
op_assign
l_int|0
comma
id|this_8
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dma-&gt;fifo_status
op_eq
id|FIFO_START
)paren
id|vortex_fifo_setadbctrl
c_func
(paren
id|vortex
comma
id|adbdma
comma
id|dma-&gt;dma_unknown
comma
id|this_4
comma
id|this_8
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|dma-&gt;fifo_status
op_eq
id|FIFO_STOP
)paren
r_return
suffix:semicolon
id|dma-&gt;fifo_status
op_assign
id|FIFO_STOP
suffix:semicolon
id|dma-&gt;fifo_enabled
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* WTDMA */
macro_line|#ifndef CHIP_AU8810
DECL|function|vortex_wtdma_setfirstbuffer
r_static
r_void
id|vortex_wtdma_setfirstbuffer
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|wtdma
)paren
(brace
singleline_comment|//int this_7c=dma_ctrl;
id|stream_t
op_star
id|dma
op_assign
op_amp
id|vortex-&gt;dma_wt
(braket
id|wtdma
)braket
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_WTDMA_CTRL
op_plus
(paren
id|wtdma
op_lshift
l_int|2
)paren
comma
id|dma-&gt;dma_ctrl
)paren
suffix:semicolon
)brace
DECL|function|vortex_wtdma_setstartbuffer
r_static
r_void
id|vortex_wtdma_setstartbuffer
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|wtdma
comma
r_int
id|sb
)paren
(brace
id|stream_t
op_star
id|dma
op_assign
op_amp
id|vortex-&gt;dma_wt
(braket
id|wtdma
)braket
suffix:semicolon
singleline_comment|//hwwrite(vortex-&gt;mmio, VORTEX_WTDMA_START + (wtdma &lt;&lt; 2), sb &lt;&lt; ((0x1f-(wtdma&amp;0xf)*2)));
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_WTDMA_START
op_plus
(paren
id|wtdma
op_lshift
l_int|2
)paren
comma
id|sb
op_lshift
(paren
(paren
l_int|0xf
op_minus
(paren
id|wtdma
op_amp
l_int|0xf
)paren
)paren
op_star
l_int|2
)paren
)paren
suffix:semicolon
id|dma-&gt;period_real
op_assign
id|dma-&gt;period_virt
op_assign
id|sb
suffix:semicolon
)brace
r_static
r_void
DECL|function|vortex_wtdma_setbuffers
id|vortex_wtdma_setbuffers
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|wtdma
comma
id|snd_pcm_sgbuf_t
op_star
id|sgbuf
comma
r_int
id|psize
comma
r_int
id|count
)paren
(brace
id|stream_t
op_star
id|dma
op_assign
op_amp
id|vortex-&gt;dma_wt
(braket
id|wtdma
)braket
suffix:semicolon
id|dma-&gt;period_bytes
op_assign
id|psize
suffix:semicolon
id|dma-&gt;nr_periods
op_assign
id|count
suffix:semicolon
id|dma-&gt;sgbuf
op_assign
id|sgbuf
suffix:semicolon
id|psize
op_decrement
suffix:semicolon
id|dma-&gt;cfg0
op_assign
l_int|0
suffix:semicolon
id|dma-&gt;cfg1
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|count
)paren
(brace
multiline_comment|/* Four or more pages */
r_default
suffix:colon
r_case
l_int|4
suffix:colon
id|dma-&gt;cfg1
op_or_assign
l_int|0x88000000
op_or
l_int|0x44000000
op_or
l_int|0x30000000
op_or
id|psize
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_WTDMA_BUFBASE
op_plus
(paren
id|wtdma
op_lshift
l_int|4
)paren
comma
id|snd_sgbuf_get_addr
c_func
(paren
id|sgbuf
comma
id|psize
op_star
l_int|3
)paren
)paren
suffix:semicolon
multiline_comment|/* 3 pages */
r_case
l_int|3
suffix:colon
id|dma-&gt;cfg0
op_or_assign
l_int|0x12000000
suffix:semicolon
id|dma-&gt;cfg1
op_or_assign
l_int|0x80000000
op_or
l_int|0x40000000
op_or
(paren
id|psize
op_lshift
l_int|0xc
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_WTDMA_BUFBASE
op_plus
(paren
id|wtdma
op_lshift
l_int|4
)paren
comma
id|snd_sgbuf_get_addr
c_func
(paren
id|sgbuf
comma
id|psize
op_star
l_int|2
)paren
)paren
suffix:semicolon
multiline_comment|/* 2 pages */
r_case
l_int|2
suffix:colon
id|dma-&gt;cfg0
op_or_assign
l_int|0x88000000
op_or
l_int|0x44000000
op_or
l_int|0x10000000
op_or
id|psize
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_WTDMA_BUFBASE
op_plus
(paren
id|wtdma
op_lshift
l_int|4
)paren
comma
id|snd_sgbuf_get_addr
c_func
(paren
id|sgbuf
comma
id|psize
)paren
)paren
suffix:semicolon
multiline_comment|/* 1 page */
r_case
l_int|1
suffix:colon
id|dma-&gt;cfg0
op_or_assign
l_int|0x80000000
op_or
l_int|0x40000000
op_or
(paren
id|psize
op_lshift
l_int|0xc
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_WTDMA_BUFBASE
op_plus
(paren
id|wtdma
op_lshift
l_int|4
)paren
comma
id|snd_sgbuf_get_addr
c_func
(paren
id|sgbuf
comma
l_int|0
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_WTDMA_BUFCFG0
op_plus
(paren
id|wtdma
op_lshift
l_int|3
)paren
comma
id|dma-&gt;cfg0
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_WTDMA_BUFCFG1
op_plus
(paren
id|wtdma
op_lshift
l_int|3
)paren
comma
id|dma-&gt;cfg1
)paren
suffix:semicolon
id|vortex_wtdma_setfirstbuffer
c_func
(paren
id|vortex
comma
id|wtdma
)paren
suffix:semicolon
id|vortex_wtdma_setstartbuffer
c_func
(paren
id|vortex
comma
id|wtdma
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|vortex_wtdma_setmode
id|vortex_wtdma_setmode
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|wtdma
comma
r_int
id|ie
comma
r_int
id|fmt
comma
r_int
id|d
comma
multiline_comment|/*int e, */
r_int
r_int
id|offset
)paren
(brace
id|stream_t
op_star
id|dma
op_assign
op_amp
id|vortex-&gt;dma_wt
(braket
id|wtdma
)braket
suffix:semicolon
singleline_comment|//dma-&gt;this_08 = e;
id|dma-&gt;dma_unknown
op_assign
id|d
suffix:semicolon
id|dma-&gt;dma_ctrl
op_assign
l_int|0
suffix:semicolon
id|dma-&gt;dma_ctrl
op_assign
(paren
(paren
id|offset
op_amp
id|OFFSET_MASK
)paren
op_or
(paren
id|dma-&gt;dma_ctrl
op_amp
op_complement
id|OFFSET_MASK
)paren
)paren
suffix:semicolon
multiline_comment|/* PCMOUT interrupt */
id|dma-&gt;dma_ctrl
op_assign
(paren
id|dma-&gt;dma_ctrl
op_amp
op_complement
id|IE_MASK
)paren
op_or
(paren
(paren
id|ie
op_lshift
id|IE_SHIFT
)paren
op_amp
id|IE_MASK
)paren
suffix:semicolon
multiline_comment|/* Always playback. */
id|dma-&gt;dma_ctrl
op_or_assign
(paren
l_int|1
op_lshift
id|DIR_SHIFT
)paren
suffix:semicolon
multiline_comment|/* Audio Format */
id|dma-&gt;dma_ctrl
op_assign
(paren
id|dma-&gt;dma_ctrl
op_amp
id|FMT_MASK
)paren
op_or
(paren
(paren
id|fmt
op_lshift
id|FMT_SHIFT
)paren
op_amp
id|FMT_MASK
)paren
suffix:semicolon
multiline_comment|/* Write into hardware */
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_WTDMA_CTRL
op_plus
(paren
id|wtdma
op_lshift
l_int|2
)paren
comma
id|dma-&gt;dma_ctrl
)paren
suffix:semicolon
)brace
DECL|function|vortex_wtdma_bufshift
r_static
r_int
id|vortex_wtdma_bufshift
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|wtdma
)paren
(brace
id|stream_t
op_star
id|dma
op_assign
op_amp
id|vortex-&gt;dma_wt
(braket
id|wtdma
)braket
suffix:semicolon
r_int
id|page
comma
id|p
comma
id|pp
comma
id|delta
comma
id|i
suffix:semicolon
id|page
op_assign
(paren
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_WTDMA_STAT
op_plus
(paren
id|wtdma
op_lshift
l_int|2
)paren
)paren
op_amp
id|WT_SUBBUF_MASK
)paren
op_rshift
id|WT_SUBBUF_SHIFT
suffix:semicolon
r_if
c_cond
(paren
id|dma-&gt;nr_periods
op_ge
l_int|4
)paren
id|delta
op_assign
(paren
id|page
op_minus
id|dma-&gt;period_real
)paren
op_amp
l_int|3
suffix:semicolon
r_else
(brace
id|delta
op_assign
(paren
id|page
op_minus
id|dma-&gt;period_real
)paren
suffix:semicolon
r_if
c_cond
(paren
id|delta
OL
l_int|0
)paren
id|delta
op_add_assign
id|dma-&gt;nr_periods
suffix:semicolon
)brace
r_if
c_cond
(paren
id|delta
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* refresh hw page table */
r_if
c_cond
(paren
id|dma-&gt;nr_periods
OG
l_int|4
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|delta
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* p: audio buffer page index */
id|p
op_assign
id|dma-&gt;period_virt
op_plus
id|i
op_plus
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|p
op_ge
id|dma-&gt;nr_periods
)paren
id|p
op_sub_assign
id|dma-&gt;nr_periods
suffix:semicolon
multiline_comment|/* pp: hardware DMA page index. */
id|pp
op_assign
id|dma-&gt;period_real
op_plus
id|i
suffix:semicolon
r_if
c_cond
(paren
id|pp
op_ge
l_int|4
)paren
id|pp
op_sub_assign
l_int|4
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_WTDMA_BUFBASE
op_plus
(paren
(paren
(paren
id|wtdma
op_lshift
l_int|2
)paren
op_plus
id|pp
)paren
op_lshift
l_int|2
)paren
comma
id|snd_sgbuf_get_addr
c_func
(paren
id|dma-&gt;sgbuf
comma
id|dma-&gt;period_bytes
op_star
id|p
)paren
)paren
suffix:semicolon
multiline_comment|/* Force write thru cache. */
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_WTDMA_BUFBASE
op_plus
(paren
(paren
(paren
id|wtdma
op_lshift
l_int|2
)paren
op_plus
id|pp
)paren
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
)brace
)brace
id|dma-&gt;period_virt
op_add_assign
id|delta
suffix:semicolon
r_if
c_cond
(paren
id|dma-&gt;period_virt
op_ge
id|dma-&gt;nr_periods
)paren
id|dma-&gt;period_virt
op_sub_assign
id|dma-&gt;nr_periods
suffix:semicolon
id|dma-&gt;period_real
op_assign
id|page
suffix:semicolon
r_if
c_cond
(paren
id|delta
op_ne
l_int|1
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;vortex: wt virt = %d, delta = %d&bslash;n&quot;
comma
id|dma-&gt;period_virt
comma
id|delta
)paren
suffix:semicolon
r_return
id|delta
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_void
id|vortex_wtdma_getposition
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|wtdma
comma
r_int
op_star
id|subbuf
comma
r_int
op_star
id|pos
)paren
(brace
r_int
id|temp
suffix:semicolon
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_WTDMA_STAT
op_plus
(paren
id|wtdma
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
op_star
id|subbuf
op_assign
(paren
id|temp
op_rshift
id|WT_SUBBUF_SHIFT
)paren
op_amp
id|WT_SUBBUF_MASK
suffix:semicolon
op_star
id|pos
op_assign
id|temp
op_amp
id|POS_MASK
suffix:semicolon
)brace
r_static
r_int
id|vortex_wtdma_getcursubuffer
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|wtdma
)paren
(brace
r_return
(paren
(paren
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_WTDMA_STAT
op_plus
(paren
id|wtdma
op_lshift
l_int|2
)paren
)paren
op_rshift
id|POS_SHIFT
)paren
op_amp
id|POS_MASK
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|vortex_wtdma_getlinearpos
r_static
r_int
r_inline
id|vortex_wtdma_getlinearpos
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|wtdma
)paren
(brace
id|stream_t
op_star
id|dma
op_assign
op_amp
id|vortex-&gt;dma_wt
(braket
id|wtdma
)braket
suffix:semicolon
r_int
id|temp
suffix:semicolon
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_WTDMA_STAT
op_plus
(paren
id|wtdma
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
singleline_comment|//temp = (temp &amp; POS_MASK) + (((temp&gt;&gt;WT_SUBBUF_SHIFT) &amp; WT_SUBBUF_MASK)*(dma-&gt;cfg0&amp;POS_MASK));
id|temp
op_assign
(paren
id|temp
op_amp
id|POS_MASK
)paren
op_plus
(paren
(paren
id|dma-&gt;period_virt
)paren
op_star
(paren
id|dma-&gt;period_bytes
)paren
)paren
suffix:semicolon
r_return
id|temp
suffix:semicolon
)brace
DECL|function|vortex_wtdma_startfifo
r_static
r_void
id|vortex_wtdma_startfifo
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|wtdma
)paren
(brace
id|stream_t
op_star
id|dma
op_assign
op_amp
id|vortex-&gt;dma_wt
(braket
id|wtdma
)braket
suffix:semicolon
r_int
id|this_8
op_assign
l_int|0
comma
id|this_4
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|dma-&gt;fifo_status
)paren
(brace
r_case
id|FIFO_START
suffix:colon
id|vortex_fifo_setwtvalid
c_func
(paren
id|vortex
comma
id|wtdma
comma
id|dma-&gt;fifo_enabled
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FIFO_STOP
suffix:colon
id|this_8
op_assign
l_int|1
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_WTDMA_CTRL
op_plus
(paren
id|wtdma
op_lshift
l_int|2
)paren
comma
id|dma-&gt;dma_ctrl
)paren
suffix:semicolon
id|vortex_fifo_setwtctrl
c_func
(paren
id|vortex
comma
id|wtdma
comma
id|dma-&gt;dma_unknown
comma
id|this_4
comma
id|this_8
comma
id|dma-&gt;fifo_enabled
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FIFO_PAUSE
suffix:colon
id|vortex_fifo_setwtctrl
c_func
(paren
id|vortex
comma
id|wtdma
comma
id|dma-&gt;dma_unknown
comma
id|this_4
comma
id|this_8
comma
id|dma-&gt;fifo_enabled
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|dma-&gt;fifo_status
op_assign
id|FIFO_START
suffix:semicolon
)brace
DECL|function|vortex_wtdma_resumefifo
r_static
r_void
id|vortex_wtdma_resumefifo
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|wtdma
)paren
(brace
id|stream_t
op_star
id|dma
op_assign
op_amp
id|vortex-&gt;dma_wt
(braket
id|wtdma
)braket
suffix:semicolon
r_int
id|this_8
op_assign
l_int|0
comma
id|this_4
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|dma-&gt;fifo_status
)paren
(brace
r_case
id|FIFO_STOP
suffix:colon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_WTDMA_CTRL
op_plus
(paren
id|wtdma
op_lshift
l_int|2
)paren
comma
id|dma-&gt;dma_ctrl
)paren
suffix:semicolon
id|vortex_fifo_setwtctrl
c_func
(paren
id|vortex
comma
id|wtdma
comma
id|dma-&gt;dma_unknown
comma
id|this_4
comma
id|this_8
comma
id|dma-&gt;fifo_enabled
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FIFO_PAUSE
suffix:colon
id|vortex_fifo_setwtctrl
c_func
(paren
id|vortex
comma
id|wtdma
comma
id|dma-&gt;dma_unknown
comma
id|this_4
comma
id|this_8
comma
id|dma-&gt;fifo_enabled
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|dma-&gt;fifo_status
op_assign
id|FIFO_START
suffix:semicolon
)brace
DECL|function|vortex_wtdma_pausefifo
r_static
r_void
id|vortex_wtdma_pausefifo
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|wtdma
)paren
(brace
id|stream_t
op_star
id|dma
op_assign
op_amp
id|vortex-&gt;dma_wt
(braket
id|wtdma
)braket
suffix:semicolon
r_int
id|this_8
op_assign
l_int|0
comma
id|this_4
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|dma-&gt;fifo_status
)paren
(brace
r_case
id|FIFO_START
suffix:colon
id|vortex_fifo_setwtctrl
c_func
(paren
id|vortex
comma
id|wtdma
comma
id|dma-&gt;dma_unknown
comma
id|this_4
comma
id|this_8
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|FIFO_STOP
suffix:colon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_WTDMA_CTRL
op_plus
(paren
id|wtdma
op_lshift
l_int|2
)paren
comma
id|dma-&gt;dma_ctrl
)paren
suffix:semicolon
id|vortex_fifo_setwtctrl
c_func
(paren
id|vortex
comma
id|wtdma
comma
id|dma-&gt;dma_unknown
comma
id|this_4
comma
id|this_8
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|dma-&gt;fifo_status
op_assign
id|FIFO_PAUSE
suffix:semicolon
)brace
DECL|function|vortex_wtdma_stopfifo
r_static
r_void
id|vortex_wtdma_stopfifo
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|wtdma
)paren
(brace
id|stream_t
op_star
id|dma
op_assign
op_amp
id|vortex-&gt;dma_wt
(braket
id|wtdma
)braket
suffix:semicolon
r_int
id|this_4
op_assign
l_int|0
comma
id|this_8
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dma-&gt;fifo_status
op_eq
id|FIFO_START
)paren
id|vortex_fifo_setwtctrl
c_func
(paren
id|vortex
comma
id|wtdma
comma
id|dma-&gt;dma_unknown
comma
id|this_4
comma
id|this_8
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|dma-&gt;fifo_status
op_eq
id|FIFO_STOP
)paren
r_return
suffix:semicolon
id|dma-&gt;fifo_status
op_assign
id|FIFO_STOP
suffix:semicolon
id|dma-&gt;fifo_enabled
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* ADB Routes */
DECL|typedef|ADBRamLink
r_typedef
r_int
id|ADBRamLink
suffix:semicolon
DECL|function|vortex_adb_init
r_static
r_void
id|vortex_adb_init
c_func
(paren
id|vortex_t
op_star
id|vortex
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* it looks like we are writing more than we need to...&n;&t; * if we write what we are supposed to it breaks things... */
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_SR
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|VORTEX_ADB_RTBASE_SIZE
suffix:semicolon
id|i
op_increment
)paren
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_RTBASE
op_plus
(paren
id|i
op_lshift
l_int|2
)paren
comma
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_RTBASE
op_plus
(paren
id|i
op_lshift
l_int|2
)paren
)paren
op_or
id|ROUTE_MASK
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|VORTEX_ADB_CHNBASE_SIZE
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_CHNBASE
op_plus
(paren
id|i
op_lshift
l_int|2
)paren
comma
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_CHNBASE
op_plus
(paren
id|i
op_lshift
l_int|2
)paren
)paren
op_or
id|ROUTE_MASK
)paren
suffix:semicolon
)brace
)brace
DECL|function|vortex_adb_en_sr
r_static
r_void
id|vortex_adb_en_sr
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|channel
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_SR
comma
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_SR
)paren
op_or
(paren
l_int|0x1
op_lshift
id|channel
)paren
)paren
suffix:semicolon
)brace
DECL|function|vortex_adb_dis_sr
r_static
r_void
id|vortex_adb_dis_sr
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|channel
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_SR
comma
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_SR
)paren
op_amp
op_complement
(paren
l_int|0x1
op_lshift
id|channel
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|vortex_adb_addroutes
id|vortex_adb_addroutes
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|channel
comma
id|ADBRamLink
op_star
id|route
comma
r_int
id|rnum
)paren
(brace
r_int
id|temp
comma
id|prev
comma
id|lifeboat
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rnum
op_le
l_int|0
)paren
op_logical_or
(paren
id|route
op_eq
l_int|NULL
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* Write last routes. */
id|rnum
op_decrement
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_RTBASE
op_plus
(paren
(paren
id|route
(braket
id|rnum
)braket
op_amp
id|ADB_MASK
)paren
op_lshift
l_int|2
)paren
comma
id|ROUTE_MASK
)paren
suffix:semicolon
r_while
c_loop
(paren
id|rnum
OG
l_int|0
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_RTBASE
op_plus
(paren
(paren
id|route
(braket
id|rnum
op_minus
l_int|1
)braket
op_amp
id|ADB_MASK
)paren
op_lshift
l_int|2
)paren
comma
id|route
(braket
id|rnum
)braket
)paren
suffix:semicolon
id|rnum
op_decrement
suffix:semicolon
)brace
multiline_comment|/* Write first route. */
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_CHNBASE
op_plus
(paren
id|channel
op_lshift
l_int|2
)paren
)paren
op_amp
id|ADB_MASK
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_eq
id|ADB_MASK
)paren
(brace
multiline_comment|/* First entry on this channel. */
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_CHNBASE
op_plus
(paren
id|channel
op_lshift
l_int|2
)paren
comma
id|route
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|vortex_adb_en_sr
c_func
(paren
id|vortex
comma
id|channel
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Not first entry on this channel. Need to link. */
r_do
(brace
id|prev
op_assign
id|temp
suffix:semicolon
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_RTBASE
op_plus
(paren
id|temp
op_lshift
l_int|2
)paren
)paren
op_amp
id|ADB_MASK
suffix:semicolon
r_if
c_cond
(paren
(paren
id|lifeboat
op_increment
)paren
OG
id|ADB_MASK
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;vortex_adb_addroutes: unending route! 0x%x&bslash;n&quot;
comma
op_star
id|route
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|temp
op_ne
id|ADB_MASK
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_RTBASE
op_plus
(paren
id|prev
op_lshift
l_int|2
)paren
comma
id|route
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|vortex_adb_delroutes
id|vortex_adb_delroutes
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
r_char
id|channel
comma
id|ADBRamLink
id|route0
comma
id|ADBRamLink
id|route1
)paren
(brace
r_int
id|temp
comma
id|lifeboat
op_assign
l_int|0
comma
id|prev
suffix:semicolon
multiline_comment|/* Find route. */
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_CHNBASE
op_plus
(paren
id|channel
op_lshift
l_int|2
)paren
)paren
op_amp
id|ADB_MASK
suffix:semicolon
r_if
c_cond
(paren
id|temp
op_eq
(paren
id|route0
op_amp
id|ADB_MASK
)paren
)paren
(brace
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_RTBASE
op_plus
(paren
(paren
id|route1
op_amp
id|ADB_MASK
)paren
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp
op_amp
id|ADB_MASK
)paren
op_eq
id|ADB_MASK
)paren
id|vortex_adb_dis_sr
c_func
(paren
id|vortex
comma
id|channel
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_CHNBASE
op_plus
(paren
id|channel
op_lshift
l_int|2
)paren
comma
id|temp
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_do
(brace
id|prev
op_assign
id|temp
suffix:semicolon
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_RTBASE
op_plus
(paren
id|prev
op_lshift
l_int|2
)paren
)paren
op_amp
id|ADB_MASK
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|lifeboat
op_increment
)paren
OG
id|ADB_MASK
)paren
op_logical_or
(paren
id|temp
op_eq
id|ADB_MASK
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;vortex_adb_delroutes: route not found! 0x%x&bslash;n&quot;
comma
id|route0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|temp
op_ne
(paren
id|route0
op_amp
id|ADB_MASK
)paren
)paren
suffix:semicolon
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_RTBASE
op_plus
(paren
id|temp
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp
op_amp
id|ADB_MASK
)paren
op_eq
id|route1
)paren
id|temp
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_RTBASE
op_plus
(paren
id|temp
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
multiline_comment|/* Make bridge over deleted route. */
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ADB_RTBASE
op_plus
(paren
id|prev
op_lshift
l_int|2
)paren
comma
id|temp
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|vortex_route
id|vortex_route
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|en
comma
r_int
r_char
id|channel
comma
r_int
r_char
id|source
comma
r_int
r_char
id|dest
)paren
(brace
id|ADBRamLink
id|route
suffix:semicolon
id|route
op_assign
(paren
(paren
id|source
op_amp
id|ADB_MASK
)paren
op_lshift
id|ADB_SHIFT
)paren
op_or
(paren
id|dest
op_amp
id|ADB_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|en
)paren
(brace
id|vortex_adb_addroutes
c_func
(paren
id|vortex
comma
id|channel
comma
op_amp
id|route
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|source
OL
(paren
id|OFFSET_SRCOUT
op_plus
id|NR_SRC
)paren
)paren
op_logical_and
(paren
id|source
op_ge
id|OFFSET_SRCOUT
)paren
)paren
id|vortex_src_addWTD
c_func
(paren
id|vortex
comma
(paren
id|source
op_minus
id|OFFSET_SRCOUT
)paren
comma
id|channel
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|source
OL
(paren
id|OFFSET_MIXOUT
op_plus
id|NR_MIXOUT
)paren
)paren
op_logical_and
(paren
id|source
op_ge
id|OFFSET_MIXOUT
)paren
)paren
id|vortex_mixer_addWTD
c_func
(paren
id|vortex
comma
(paren
id|source
op_minus
id|OFFSET_MIXOUT
)paren
comma
id|channel
)paren
suffix:semicolon
)brace
r_else
(brace
id|vortex_adb_delroutes
c_func
(paren
id|vortex
comma
id|channel
comma
id|route
comma
id|route
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|source
OL
(paren
id|OFFSET_SRCOUT
op_plus
id|NR_SRC
)paren
)paren
op_logical_and
(paren
id|source
op_ge
id|OFFSET_SRCOUT
)paren
)paren
id|vortex_src_delWTD
c_func
(paren
id|vortex
comma
(paren
id|source
op_minus
id|OFFSET_SRCOUT
)paren
comma
id|channel
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|source
OL
(paren
id|OFFSET_MIXOUT
op_plus
id|NR_MIXOUT
)paren
)paren
op_logical_and
(paren
id|source
op_ge
id|OFFSET_MIXOUT
)paren
)paren
id|vortex_mixer_delWTD
c_func
(paren
id|vortex
comma
(paren
id|source
op_minus
id|OFFSET_MIXOUT
)paren
comma
id|channel
)paren
suffix:semicolon
)brace
)brace
macro_line|#if 0
r_static
r_void
id|vortex_routes
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|en
comma
r_int
r_char
id|channel
comma
r_int
r_char
id|source
comma
r_int
r_char
id|dest0
comma
r_int
r_char
id|dest1
)paren
(brace
id|ADBRamLink
id|route
(braket
l_int|2
)braket
suffix:semicolon
id|route
(braket
l_int|0
)braket
op_assign
(paren
(paren
id|source
op_amp
id|ADB_MASK
)paren
op_lshift
id|ADB_SHIFT
)paren
op_or
(paren
id|dest0
op_amp
id|ADB_MASK
)paren
suffix:semicolon
id|route
(braket
l_int|1
)braket
op_assign
(paren
(paren
id|source
op_amp
id|ADB_MASK
)paren
op_lshift
id|ADB_SHIFT
)paren
op_or
(paren
id|dest1
op_amp
id|ADB_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|en
)paren
(brace
id|vortex_adb_addroutes
c_func
(paren
id|vortex
comma
id|channel
comma
id|route
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|source
OL
(paren
id|OFFSET_SRCOUT
op_plus
id|NR_SRC
)paren
)paren
op_logical_and
(paren
id|source
op_ge
(paren
id|OFFSET_SRCOUT
)paren
)paren
)paren
id|vortex_src_addWTD
c_func
(paren
id|vortex
comma
(paren
id|source
op_minus
id|OFFSET_SRCOUT
)paren
comma
id|channel
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|source
OL
(paren
id|OFFSET_MIXOUT
op_plus
id|NR_MIXOUT
)paren
)paren
op_logical_and
(paren
id|source
op_ge
(paren
id|OFFSET_MIXOUT
)paren
)paren
)paren
id|vortex_mixer_addWTD
c_func
(paren
id|vortex
comma
(paren
id|source
op_minus
id|OFFSET_MIXOUT
)paren
comma
id|channel
)paren
suffix:semicolon
)brace
r_else
(brace
id|vortex_adb_delroutes
c_func
(paren
id|vortex
comma
id|channel
comma
id|route
(braket
l_int|0
)braket
comma
id|route
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|source
OL
(paren
id|OFFSET_SRCOUT
op_plus
id|NR_SRC
)paren
)paren
op_logical_and
(paren
id|source
op_ge
(paren
id|OFFSET_SRCOUT
)paren
)paren
)paren
id|vortex_src_delWTD
c_func
(paren
id|vortex
comma
(paren
id|source
op_minus
id|OFFSET_SRCOUT
)paren
comma
id|channel
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|source
OL
(paren
id|OFFSET_MIXOUT
op_plus
id|NR_MIXOUT
)paren
)paren
op_logical_and
(paren
id|source
op_ge
(paren
id|OFFSET_MIXOUT
)paren
)paren
)paren
id|vortex_mixer_delWTD
c_func
(paren
id|vortex
comma
(paren
id|source
op_minus
id|OFFSET_MIXOUT
)paren
comma
id|channel
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/* Route two sources to same target. Sources must be of same class !!! */
r_static
r_void
DECL|function|vortex_routeLRT
id|vortex_routeLRT
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|en
comma
r_int
r_char
id|ch
comma
r_int
r_char
id|source0
comma
r_int
r_char
id|source1
comma
r_int
r_char
id|dest
)paren
(brace
id|ADBRamLink
id|route
(braket
l_int|2
)braket
suffix:semicolon
id|route
(braket
l_int|0
)braket
op_assign
(paren
(paren
id|source0
op_amp
id|ADB_MASK
)paren
op_lshift
id|ADB_SHIFT
)paren
op_or
(paren
id|dest
op_amp
id|ADB_MASK
)paren
suffix:semicolon
id|route
(braket
l_int|1
)braket
op_assign
(paren
(paren
id|source1
op_amp
id|ADB_MASK
)paren
op_lshift
id|ADB_SHIFT
)paren
op_or
(paren
id|dest
op_amp
id|ADB_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dest
OL
l_int|0x10
)paren
id|route
(braket
l_int|1
)braket
op_assign
(paren
id|route
(braket
l_int|1
)braket
op_amp
op_complement
id|ADB_MASK
)paren
op_or
(paren
id|dest
op_plus
l_int|0x20
)paren
suffix:semicolon
multiline_comment|/* fifo A */
r_if
c_cond
(paren
id|en
)paren
(brace
id|vortex_adb_addroutes
c_func
(paren
id|vortex
comma
id|ch
comma
id|route
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|source0
OL
(paren
id|OFFSET_SRCOUT
op_plus
id|NR_SRC
)paren
)paren
op_logical_and
(paren
id|source0
op_ge
id|OFFSET_SRCOUT
)paren
)paren
(brace
id|vortex_src_addWTD
c_func
(paren
id|vortex
comma
(paren
id|source0
op_minus
id|OFFSET_SRCOUT
)paren
comma
id|ch
)paren
suffix:semicolon
id|vortex_src_addWTD
c_func
(paren
id|vortex
comma
(paren
id|source1
op_minus
id|OFFSET_SRCOUT
)paren
comma
id|ch
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|source0
OL
(paren
id|OFFSET_MIXOUT
op_plus
id|NR_MIXOUT
)paren
)paren
op_logical_and
(paren
id|source0
op_ge
id|OFFSET_MIXOUT
)paren
)paren
(brace
id|vortex_mixer_addWTD
c_func
(paren
id|vortex
comma
(paren
id|source0
op_minus
id|OFFSET_MIXOUT
)paren
comma
id|ch
)paren
suffix:semicolon
id|vortex_mixer_addWTD
c_func
(paren
id|vortex
comma
(paren
id|source1
op_minus
id|OFFSET_MIXOUT
)paren
comma
id|ch
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|vortex_adb_delroutes
c_func
(paren
id|vortex
comma
id|ch
comma
id|route
(braket
l_int|0
)braket
comma
id|route
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|source0
OL
(paren
id|OFFSET_SRCOUT
op_plus
id|NR_SRC
)paren
)paren
op_logical_and
(paren
id|source0
op_ge
id|OFFSET_SRCOUT
)paren
)paren
(brace
id|vortex_src_delWTD
c_func
(paren
id|vortex
comma
(paren
id|source0
op_minus
id|OFFSET_SRCOUT
)paren
comma
id|ch
)paren
suffix:semicolon
id|vortex_src_delWTD
c_func
(paren
id|vortex
comma
(paren
id|source1
op_minus
id|OFFSET_SRCOUT
)paren
comma
id|ch
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|source0
OL
(paren
id|OFFSET_MIXOUT
op_plus
id|NR_MIXOUT
)paren
)paren
op_logical_and
(paren
id|source0
op_ge
id|OFFSET_MIXOUT
)paren
)paren
(brace
id|vortex_mixer_delWTD
c_func
(paren
id|vortex
comma
(paren
id|source0
op_minus
id|OFFSET_MIXOUT
)paren
comma
id|ch
)paren
suffix:semicolon
id|vortex_mixer_delWTD
c_func
(paren
id|vortex
comma
(paren
id|source1
op_minus
id|OFFSET_MIXOUT
)paren
comma
id|ch
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Connection stuff */
singleline_comment|// Connect adbdma to src(&squot;s).
r_static
r_void
DECL|function|vortex_connection_adbdma_src
id|vortex_connection_adbdma_src
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|en
comma
r_int
r_char
id|ch
comma
r_int
r_char
id|adbdma
comma
r_int
r_char
id|src
)paren
(brace
id|vortex_route
c_func
(paren
id|vortex
comma
id|en
comma
id|ch
comma
id|ADB_DMA
c_func
(paren
id|adbdma
)paren
comma
id|ADB_SRCIN
c_func
(paren
id|src
)paren
)paren
suffix:semicolon
)brace
singleline_comment|// Connect SRC to mixin.
r_static
r_void
DECL|function|vortex_connection_src_mixin
id|vortex_connection_src_mixin
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|en
comma
r_int
r_char
id|channel
comma
r_int
r_char
id|src
comma
r_int
r_char
id|mixin
)paren
(brace
id|vortex_route
c_func
(paren
id|vortex
comma
id|en
comma
id|channel
comma
id|ADB_SRCOUT
c_func
(paren
id|src
)paren
comma
id|ADB_MIXIN
c_func
(paren
id|mixin
)paren
)paren
suffix:semicolon
)brace
singleline_comment|// Connect mixin with mix output.
r_static
r_void
DECL|function|vortex_connection_mixin_mix
id|vortex_connection_mixin_mix
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|en
comma
r_int
r_char
id|mixin
comma
r_int
r_char
id|mix
comma
r_int
id|a
)paren
(brace
r_if
c_cond
(paren
id|en
)paren
(brace
id|vortex_mix_enableinput
c_func
(paren
id|vortex
comma
id|mix
comma
id|mixin
)paren
suffix:semicolon
id|vortex_mix_setinputvolumebyte
c_func
(paren
id|vortex
comma
id|mix
comma
id|mixin
comma
id|MIX_DEFIGAIN
)paren
suffix:semicolon
singleline_comment|// added to original code.
)brace
r_else
id|vortex_mix_disableinput
c_func
(paren
id|vortex
comma
id|mix
comma
id|mixin
comma
id|a
)paren
suffix:semicolon
)brace
singleline_comment|// Connect absolut address to mixin.
r_static
r_void
DECL|function|vortex_connection_adb_mixin
id|vortex_connection_adb_mixin
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|en
comma
r_int
r_char
id|channel
comma
r_int
r_char
id|source
comma
r_int
r_char
id|mixin
)paren
(brace
id|vortex_route
c_func
(paren
id|vortex
comma
id|en
comma
id|channel
comma
id|source
comma
id|ADB_MIXIN
c_func
(paren
id|mixin
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|vortex_connection_src_adbdma
id|vortex_connection_src_adbdma
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|en
comma
r_int
r_char
id|ch
comma
r_int
r_char
id|src
comma
r_int
r_char
id|adbdma
)paren
(brace
id|vortex_route
c_func
(paren
id|vortex
comma
id|en
comma
id|ch
comma
id|ADB_SRCOUT
c_func
(paren
id|src
)paren
comma
id|ADB_DMA
c_func
(paren
id|adbdma
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|vortex_connection_src_src_adbdma
id|vortex_connection_src_src_adbdma
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|en
comma
r_int
r_char
id|ch
comma
r_int
r_char
id|src0
comma
r_int
r_char
id|src1
comma
r_int
r_char
id|adbdma
)paren
(brace
id|vortex_routeLRT
c_func
(paren
id|vortex
comma
id|en
comma
id|ch
comma
id|ADB_SRCOUT
c_func
(paren
id|src0
)paren
comma
id|ADB_SRCOUT
c_func
(paren
id|src1
)paren
comma
id|ADB_DMA
c_func
(paren
id|adbdma
)paren
)paren
suffix:semicolon
)brace
singleline_comment|// mix to absolut address.
r_static
r_void
DECL|function|vortex_connection_mix_adb
id|vortex_connection_mix_adb
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|en
comma
r_int
r_char
id|ch
comma
r_int
r_char
id|mix
comma
r_int
r_char
id|dest
)paren
(brace
id|vortex_route
c_func
(paren
id|vortex
comma
id|en
comma
id|ch
comma
id|ADB_MIXOUT
c_func
(paren
id|mix
)paren
comma
id|dest
)paren
suffix:semicolon
id|vortex_mix_setvolumebyte
c_func
(paren
id|vortex
comma
id|mix
comma
id|MIX_DEFOGAIN
)paren
suffix:semicolon
singleline_comment|// added to original code.
)brace
singleline_comment|// mixer to src.
r_static
r_void
DECL|function|vortex_connection_mix_src
id|vortex_connection_mix_src
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|en
comma
r_int
r_char
id|ch
comma
r_int
r_char
id|mix
comma
r_int
r_char
id|src
)paren
(brace
id|vortex_route
c_func
(paren
id|vortex
comma
id|en
comma
id|ch
comma
id|ADB_MIXOUT
c_func
(paren
id|mix
)paren
comma
id|ADB_SRCIN
c_func
(paren
id|src
)paren
)paren
suffix:semicolon
id|vortex_mix_setvolumebyte
c_func
(paren
id|vortex
comma
id|mix
comma
id|MIX_DEFOGAIN
)paren
suffix:semicolon
singleline_comment|// added to original code.
)brace
macro_line|#if 0
r_static
r_void
id|vortex_connection_adbdma_src_src
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|en
comma
r_int
r_char
id|channel
comma
r_int
r_char
id|adbdma
comma
r_int
r_char
id|src0
comma
r_int
r_char
id|src1
)paren
(brace
id|vortex_routes
c_func
(paren
id|vortex
comma
id|en
comma
id|channel
comma
id|ADB_DMA
c_func
(paren
id|adbdma
)paren
comma
id|ADB_SRCIN
c_func
(paren
id|src0
)paren
comma
id|ADB_SRCIN
c_func
(paren
id|src1
)paren
)paren
suffix:semicolon
)brace
singleline_comment|// Connect two mix to AdbDma.
r_static
r_void
id|vortex_connection_mix_mix_adbdma
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|en
comma
r_int
r_char
id|ch
comma
r_int
r_char
id|mix0
comma
r_int
r_char
id|mix1
comma
r_int
r_char
id|adbdma
)paren
(brace
id|ADBRamLink
id|routes
(braket
l_int|2
)braket
suffix:semicolon
id|routes
(braket
l_int|0
)braket
op_assign
(paren
(paren
(paren
id|mix0
op_plus
id|OFFSET_MIXOUT
)paren
op_amp
id|ADB_MASK
)paren
op_lshift
id|ADB_SHIFT
)paren
op_or
(paren
id|adbdma
op_amp
id|ADB_MASK
)paren
suffix:semicolon
id|routes
(braket
l_int|1
)braket
op_assign
(paren
(paren
(paren
id|mix1
op_plus
id|OFFSET_MIXOUT
)paren
op_amp
id|ADB_MASK
)paren
op_lshift
id|ADB_SHIFT
)paren
op_or
(paren
(paren
id|adbdma
op_plus
l_int|0x20
)paren
op_amp
id|ADB_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|en
)paren
(brace
id|vortex_adb_addroutes
c_func
(paren
id|vortex
comma
id|ch
comma
id|routes
comma
l_int|0x2
)paren
suffix:semicolon
id|vortex_mixer_addWTD
c_func
(paren
id|vortex
comma
id|mix0
comma
id|ch
)paren
suffix:semicolon
id|vortex_mixer_addWTD
c_func
(paren
id|vortex
comma
id|mix1
comma
id|ch
)paren
suffix:semicolon
)brace
r_else
(brace
id|vortex_adb_delroutes
c_func
(paren
id|vortex
comma
id|ch
comma
id|routes
(braket
l_int|0
)braket
comma
id|routes
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|vortex_mixer_delWTD
c_func
(paren
id|vortex
comma
id|mix0
comma
id|ch
)paren
suffix:semicolon
id|vortex_mixer_delWTD
c_func
(paren
id|vortex
comma
id|mix1
comma
id|ch
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/* CODEC connect. */
r_static
r_void
DECL|function|vortex_connect_codecplay
id|vortex_connect_codecplay
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|en
comma
r_int
r_char
id|mixers
(braket
)braket
)paren
(brace
macro_line|#ifdef CHIP_AU8820
id|vortex_connection_mix_adb
c_func
(paren
id|vortex
comma
id|en
comma
l_int|0x11
comma
id|mixers
(braket
l_int|0
)braket
comma
id|ADB_CODECOUT
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|vortex_connection_mix_adb
c_func
(paren
id|vortex
comma
id|en
comma
l_int|0x11
comma
id|mixers
(braket
l_int|1
)braket
comma
id|ADB_CODECOUT
c_func
(paren
l_int|1
)paren
)paren
suffix:semicolon
macro_line|#else
macro_line|#if 1
singleline_comment|// Connect front channels through EQ.
id|vortex_connection_mix_adb
c_func
(paren
id|vortex
comma
id|en
comma
l_int|0x11
comma
id|mixers
(braket
l_int|0
)braket
comma
id|ADB_EQIN
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|vortex_connection_mix_adb
c_func
(paren
id|vortex
comma
id|en
comma
l_int|0x11
comma
id|mixers
(braket
l_int|1
)braket
comma
id|ADB_EQIN
c_func
(paren
l_int|1
)paren
)paren
suffix:semicolon
id|vortex_route
c_func
(paren
id|vortex
comma
id|en
comma
l_int|0x11
comma
id|ADB_EQOUT
c_func
(paren
l_int|0
)paren
comma
id|ADB_CODECOUT
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|vortex_route
c_func
(paren
id|vortex
comma
id|en
comma
l_int|0x11
comma
id|ADB_EQOUT
c_func
(paren
l_int|1
)paren
comma
id|ADB_CODECOUT
c_func
(paren
l_int|1
)paren
)paren
suffix:semicolon
multiline_comment|/* Check if reg 0x28 has SDAC bit set. */
r_if
c_cond
(paren
id|VORTEX_IS_QUAD
c_func
(paren
id|vortex
)paren
)paren
(brace
multiline_comment|/* Rear channel. Note: ADB_CODECOUT(0+2) and (1+2) is for AC97 modem */
id|vortex_connection_mix_adb
c_func
(paren
id|vortex
comma
id|en
comma
l_int|0x11
comma
id|mixers
(braket
l_int|2
)braket
comma
id|ADB_CODECOUT
c_func
(paren
l_int|0
op_plus
l_int|4
)paren
)paren
suffix:semicolon
id|vortex_connection_mix_adb
c_func
(paren
id|vortex
comma
id|en
comma
l_int|0x11
comma
id|mixers
(braket
l_int|3
)braket
comma
id|ADB_CODECOUT
c_func
(paren
l_int|1
op_plus
l_int|4
)paren
)paren
suffix:semicolon
singleline_comment|//printk(&quot;SDAC detected &quot;);
)brace
macro_line|#else
singleline_comment|// Use plain direct output to codec.
id|vortex_connection_mix_adb
c_func
(paren
id|vortex
comma
id|en
comma
l_int|0x11
comma
id|mixers
(braket
l_int|0
)braket
comma
id|ADB_CODECOUT
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|vortex_connection_mix_adb
c_func
(paren
id|vortex
comma
id|en
comma
l_int|0x11
comma
id|mixers
(braket
l_int|1
)braket
comma
id|ADB_CODECOUT
c_func
(paren
l_int|1
)paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif
)brace
r_static
r_void
DECL|function|vortex_connect_codecrec
id|vortex_connect_codecrec
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|en
comma
r_int
r_char
id|mixin0
comma
r_int
r_char
id|mixin1
)paren
(brace
multiline_comment|/*&n;&t;   Enable: 0x1, 0x1&n;&t;   Channel: 0x11, 0x11&n;&t;   ADB Source address: 0x48, 0x49&n;&t;   Destination Asp4Topology_0x9c,0x98&n;&t; */
id|vortex_connection_adb_mixin
c_func
(paren
id|vortex
comma
id|en
comma
l_int|0x11
comma
id|ADB_CODECIN
c_func
(paren
l_int|0
)paren
comma
id|mixin0
)paren
suffix:semicolon
id|vortex_connection_adb_mixin
c_func
(paren
id|vortex
comma
id|en
comma
l_int|0x11
comma
id|ADB_CODECIN
c_func
(paren
l_int|1
)paren
comma
id|mixin1
)paren
suffix:semicolon
)brace
singleline_comment|// Higher level ADB audio path (de)allocator.
multiline_comment|/* Resource manager */
DECL|variable|resnum
r_static
r_int
id|resnum
(braket
id|VORTEX_RESOURCE_LAST
)braket
op_assign
(brace
id|NR_ADB
comma
id|NR_SRC
comma
id|NR_MIXIN
comma
id|NR_MIXOUT
comma
id|NR_A3D
)brace
suffix:semicolon
multiline_comment|/*&n; Checkout/Checkin resource of given type. &n; resmap: resource map to be used. If NULL means that we want to allocate&n; a DMA resource (root of all other resources of a dma channel).&n; out: Mean checkout if != 0. Else mean Checkin resource.&n; restype: Indicates type of resource to be checked in or out.&n;*/
r_static
r_char
DECL|function|vortex_adb_checkinout
id|vortex_adb_checkinout
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|resmap
(braket
)braket
comma
r_int
id|out
comma
r_int
id|restype
)paren
(brace
r_int
id|i
comma
id|qty
op_assign
id|resnum
(braket
id|restype
)braket
comma
id|resinuse
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|out
)paren
(brace
multiline_comment|/* Gather used resources by all streams. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_ADB
suffix:semicolon
id|i
op_increment
)paren
(brace
id|resinuse
op_or_assign
id|vortex-&gt;dma_adb
(braket
id|i
)braket
dot
id|resources
(braket
id|restype
)braket
suffix:semicolon
)brace
id|resinuse
op_or_assign
id|vortex-&gt;fixed_res
(braket
id|restype
)braket
suffix:semicolon
multiline_comment|/* Find and take free resource. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|qty
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|resinuse
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|resmap
op_ne
l_int|NULL
)paren
id|resmap
(braket
id|restype
)braket
op_or_assign
(paren
l_int|1
op_lshift
id|i
)paren
suffix:semicolon
r_else
id|vortex-&gt;dma_adb
(braket
id|i
)braket
dot
id|resources
(braket
id|restype
)braket
op_or_assign
(paren
l_int|1
op_lshift
id|i
)paren
suffix:semicolon
singleline_comment|//printk(&quot;vortex: ResManager: type %d out %d&bslash;n&quot;, restype, i);
r_return
id|i
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|resmap
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Checkin first resource of type restype. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|qty
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|resmap
(braket
id|restype
)braket
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
(brace
id|resmap
(braket
id|restype
)braket
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|i
)paren
suffix:semicolon
singleline_comment|//printk(&quot;vortex: ResManager: type %d in %d&bslash;n&quot;,restype, i);
r_return
id|i
suffix:semicolon
)brace
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;vortex: FATAL: ResManager: resource type %d exhausted.&bslash;n&quot;
comma
id|restype
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* Default Connections  */
DECL|function|vortex_connect_default
r_static
r_void
id|vortex_connect_default
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|en
)paren
(brace
singleline_comment|// FIXME: check if checkout was succesful.
singleline_comment|// Connect AC97 codec.
id|vortex-&gt;mixplayb
(braket
l_int|0
)braket
op_assign
id|vortex_adb_checkinout
c_func
(paren
id|vortex
comma
id|vortex-&gt;fixed_res
comma
id|en
comma
id|VORTEX_RESOURCE_MIXOUT
)paren
suffix:semicolon
id|vortex-&gt;mixplayb
(braket
l_int|1
)braket
op_assign
id|vortex_adb_checkinout
c_func
(paren
id|vortex
comma
id|vortex-&gt;fixed_res
comma
id|en
comma
id|VORTEX_RESOURCE_MIXOUT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|VORTEX_IS_QUAD
c_func
(paren
id|vortex
)paren
)paren
(brace
id|vortex-&gt;mixplayb
(braket
l_int|2
)braket
op_assign
id|vortex_adb_checkinout
c_func
(paren
id|vortex
comma
id|vortex-&gt;fixed_res
comma
id|en
comma
id|VORTEX_RESOURCE_MIXOUT
)paren
suffix:semicolon
id|vortex-&gt;mixplayb
(braket
l_int|3
)braket
op_assign
id|vortex_adb_checkinout
c_func
(paren
id|vortex
comma
id|vortex-&gt;fixed_res
comma
id|en
comma
id|VORTEX_RESOURCE_MIXOUT
)paren
suffix:semicolon
)brace
id|vortex_connect_codecplay
c_func
(paren
id|vortex
comma
id|en
comma
id|vortex-&gt;mixplayb
)paren
suffix:semicolon
id|vortex-&gt;mixcapt
(braket
l_int|0
)braket
op_assign
id|vortex_adb_checkinout
c_func
(paren
id|vortex
comma
id|vortex-&gt;fixed_res
comma
id|en
comma
id|VORTEX_RESOURCE_MIXIN
)paren
suffix:semicolon
id|vortex-&gt;mixcapt
(braket
l_int|1
)braket
op_assign
id|vortex_adb_checkinout
c_func
(paren
id|vortex
comma
id|vortex-&gt;fixed_res
comma
id|en
comma
id|VORTEX_RESOURCE_MIXIN
)paren
suffix:semicolon
id|vortex_connect_codecrec
c_func
(paren
id|vortex
comma
id|en
comma
id|MIX_CAPT
c_func
(paren
l_int|0
)paren
comma
id|MIX_CAPT
c_func
(paren
l_int|1
)paren
)paren
suffix:semicolon
singleline_comment|// Connect SPDIF
macro_line|#ifndef CHIP_AU8820
id|vortex-&gt;mixspdif
(braket
l_int|0
)braket
op_assign
id|vortex_adb_checkinout
c_func
(paren
id|vortex
comma
id|vortex-&gt;fixed_res
comma
id|en
comma
id|VORTEX_RESOURCE_MIXOUT
)paren
suffix:semicolon
id|vortex-&gt;mixspdif
(braket
l_int|1
)braket
op_assign
id|vortex_adb_checkinout
c_func
(paren
id|vortex
comma
id|vortex-&gt;fixed_res
comma
id|en
comma
id|VORTEX_RESOURCE_MIXOUT
)paren
suffix:semicolon
id|vortex_connection_mix_adb
c_func
(paren
id|vortex
comma
id|en
comma
l_int|0x14
comma
id|vortex-&gt;mixspdif
(braket
l_int|0
)braket
comma
id|ADB_SPDIFOUT
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|vortex_connection_mix_adb
c_func
(paren
id|vortex
comma
id|en
comma
l_int|0x14
comma
id|vortex-&gt;mixspdif
(braket
l_int|1
)braket
comma
id|ADB_SPDIFOUT
c_func
(paren
l_int|1
)paren
)paren
suffix:semicolon
macro_line|#endif
singleline_comment|// Connect WT
macro_line|#ifndef CHIP_AU8810
id|vortex_wt_connect
c_func
(paren
id|vortex
comma
id|en
)paren
suffix:semicolon
macro_line|#endif
singleline_comment|// A3D (crosstalk canceler and A3D slices).
macro_line|#ifndef CHIP_AU8820
id|vortex_Vort3D_connect
c_func
(paren
id|vortex
comma
id|en
)paren
suffix:semicolon
macro_line|#endif
singleline_comment|// Connect I2S
singleline_comment|// Connect DSP interface for SQ3500 turbo (not here i think...)
singleline_comment|// Connect AC98 modem codec
multiline_comment|/* Fast Play Workaround */
macro_line|#ifndef CHIP_AU8820
id|vortex-&gt;fixed_res
(braket
id|VORTEX_RESOURCE_DMA
)braket
op_assign
l_int|0x00000001
suffix:semicolon
macro_line|#endif
singleline_comment|// Channel swapping workaround. We are nuking registers somewhere, or
singleline_comment|// its a hardware bug.
id|vortex-&gt;fixed_res
(braket
id|VORTEX_RESOURCE_SRC
)braket
op_assign
l_int|0x00000001
suffix:semicolon
)brace
multiline_comment|/*&n;  Allocate nr_ch pcm audio routes if dma &lt; 0. If dma &gt;= 0, existing routes&n;  are deallocated.&n;  dma: DMA engine routes to be deallocated when dma &gt;= 0.&n;  nr_ch: Number of channels to be de/allocated.&n;  dir: direction of stream. Uses same values as substream-&gt;stream.&n;  type: Type of audio output/source (codec, spdif, i2s, dsp, etc)&n;  Return: Return allocated DMA or same DMA passed as &quot;dma&quot; when dma &gt;= 0.&n;*/
r_static
r_int
DECL|function|vortex_adb_allocroute
id|vortex_adb_allocroute
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|dma
comma
r_int
id|nr_ch
comma
r_int
id|dir
comma
r_int
id|type
)paren
(brace
id|stream_t
op_star
id|stream
suffix:semicolon
r_int
id|i
comma
id|en
suffix:semicolon
r_if
c_cond
(paren
(paren
id|nr_ch
op_eq
l_int|3
)paren
op_logical_or
(paren
(paren
id|dir
op_eq
id|SNDRV_PCM_STREAM_CAPTURE
)paren
op_logical_and
(paren
id|nr_ch
OG
l_int|2
)paren
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|vortex-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dma
op_ge
l_int|0
)paren
(brace
id|en
op_assign
l_int|0
suffix:semicolon
id|vortex_adb_checkinout
c_func
(paren
id|vortex
comma
id|vortex-&gt;dma_adb
(braket
id|dma
)braket
dot
id|resources
comma
id|en
comma
id|VORTEX_RESOURCE_DMA
)paren
suffix:semicolon
)brace
r_else
(brace
id|en
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|dma
op_assign
id|vortex_adb_checkinout
c_func
(paren
id|vortex
comma
l_int|NULL
comma
id|en
comma
id|VORTEX_RESOURCE_DMA
)paren
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|stream
op_assign
op_amp
id|vortex-&gt;dma_adb
(braket
id|dma
)braket
suffix:semicolon
id|stream-&gt;dma
op_assign
id|dma
suffix:semicolon
id|stream-&gt;dir
op_assign
id|dir
suffix:semicolon
id|stream-&gt;type
op_assign
id|type
suffix:semicolon
singleline_comment|// FIXME: check for success of checkout or checkin.
multiline_comment|/* PLAYBACK ROUTES. */
r_if
c_cond
(paren
id|dir
op_eq
id|SNDRV_PCM_STREAM_PLAYBACK
)paren
(brace
r_int
id|src
(braket
l_int|4
)braket
comma
id|mix
(braket
l_int|4
)braket
comma
id|ch_top
suffix:semicolon
macro_line|#ifndef CHIP_AU8820
r_int
id|a3d
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
multiline_comment|/* Get SRC and MIXER hardware resources. */
r_if
c_cond
(paren
id|stream-&gt;type
op_ne
id|VORTEX_PCM_SPDIF
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nr_ch
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|src
(braket
id|i
)braket
op_assign
id|vortex_adb_checkinout
c_func
(paren
id|vortex
comma
id|stream-&gt;resources
comma
id|en
comma
id|VORTEX_RESOURCE_SRC
)paren
)paren
OL
l_int|0
)paren
(brace
id|memset
c_func
(paren
id|stream-&gt;resources
comma
l_int|0
comma
r_sizeof
(paren
r_int
r_char
)paren
op_star
id|VORTEX_RESOURCE_LAST
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stream-&gt;type
op_ne
id|VORTEX_PCM_A3D
)paren
(brace
r_if
c_cond
(paren
(paren
id|mix
(braket
id|i
)braket
op_assign
id|vortex_adb_checkinout
c_func
(paren
id|vortex
comma
id|stream-&gt;resources
comma
id|en
comma
id|VORTEX_RESOURCE_MIXIN
)paren
)paren
OL
l_int|0
)paren
(brace
id|memset
c_func
(paren
id|stream-&gt;resources
comma
l_int|0
comma
r_sizeof
(paren
r_int
r_char
)paren
op_star
id|VORTEX_RESOURCE_LAST
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
)brace
)brace
)brace
macro_line|#ifndef CHIP_AU8820
r_if
c_cond
(paren
id|stream-&gt;type
op_eq
id|VORTEX_PCM_A3D
)paren
(brace
r_if
c_cond
(paren
(paren
id|a3d
op_assign
id|vortex_adb_checkinout
c_func
(paren
id|vortex
comma
id|stream-&gt;resources
comma
id|en
comma
id|VORTEX_RESOURCE_A3D
)paren
)paren
OL
l_int|0
)paren
(brace
id|memset
c_func
(paren
id|stream-&gt;resources
comma
l_int|0
comma
r_sizeof
(paren
r_int
r_char
)paren
op_star
id|VORTEX_RESOURCE_LAST
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;vortex: out of A3D sources. Sorry&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
multiline_comment|/* (De)Initialize A3D hardware source. */
id|vortex_Vort3D_InitializeSource
c_func
(paren
op_amp
(paren
id|vortex-&gt;a3d
(braket
id|a3d
)braket
)paren
comma
id|en
)paren
suffix:semicolon
)brace
multiline_comment|/* Make SPDIF out exclusive to &quot;spdif&quot; device when in use. */
r_if
c_cond
(paren
(paren
id|stream-&gt;type
op_eq
id|VORTEX_PCM_SPDIF
)paren
op_logical_and
(paren
id|en
)paren
)paren
(brace
id|vortex_route
c_func
(paren
id|vortex
comma
l_int|0
comma
l_int|0x14
comma
id|ADB_MIXOUT
c_func
(paren
id|vortex-&gt;mixspdif
(braket
l_int|0
)braket
)paren
comma
id|ADB_SPDIFOUT
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|vortex_route
c_func
(paren
id|vortex
comma
l_int|0
comma
l_int|0x14
comma
id|ADB_MIXOUT
c_func
(paren
id|vortex-&gt;mixspdif
(braket
l_int|1
)braket
)paren
comma
id|ADB_SPDIFOUT
c_func
(paren
l_int|1
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Make playback routes. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nr_ch
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|stream-&gt;type
op_eq
id|VORTEX_PCM_ADB
)paren
(brace
id|vortex_connection_adbdma_src
c_func
(paren
id|vortex
comma
id|en
comma
singleline_comment|//src[nr_ch - 1], 
id|src
(braket
l_int|0
)braket
comma
id|dma
comma
id|src
(braket
id|i
)braket
)paren
suffix:semicolon
id|vortex_connection_src_mixin
c_func
(paren
id|vortex
comma
id|en
comma
l_int|0x11
comma
id|src
(braket
id|i
)braket
comma
id|mix
(braket
id|i
)braket
)paren
suffix:semicolon
id|vortex_connection_mixin_mix
c_func
(paren
id|vortex
comma
id|en
comma
id|mix
(braket
id|i
)braket
comma
id|MIX_PLAYB
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifndef CHIP_AU8820
id|vortex_connection_mixin_mix
c_func
(paren
id|vortex
comma
id|en
comma
id|mix
(braket
id|i
)braket
comma
id|MIX_SPDIF
c_func
(paren
id|i
op_mod
l_int|2
)paren
comma
l_int|0
)paren
suffix:semicolon
id|vortex_mix_setinputvolumebyte
c_func
(paren
id|vortex
comma
id|MIX_SPDIF
c_func
(paren
id|i
op_mod
l_int|2
)paren
comma
id|mix
(braket
id|i
)braket
comma
id|MIX_DEFIGAIN
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#ifndef CHIP_AU8820
r_if
c_cond
(paren
id|stream-&gt;type
op_eq
id|VORTEX_PCM_A3D
)paren
(brace
id|vortex_connection_adbdma_src
c_func
(paren
id|vortex
comma
id|en
comma
id|src
(braket
l_int|0
)braket
comma
id|dma
comma
id|src
(braket
id|i
)braket
)paren
suffix:semicolon
id|vortex_route
c_func
(paren
id|vortex
comma
id|en
comma
l_int|0x11
comma
id|ADB_SRCOUT
c_func
(paren
id|src
(braket
id|i
)braket
)paren
comma
id|ADB_A3DIN
c_func
(paren
id|a3d
)paren
)paren
suffix:semicolon
multiline_comment|/* XTalk test. */
singleline_comment|//vortex_route(vortex, en, 0x11, dma, ADB_XTALKIN(i?9:4));
singleline_comment|//vortex_route(vortex, en, 0x11, ADB_SRCOUT(src[i]), ADB_XTALKIN(i?4:9));
)brace
r_if
c_cond
(paren
id|stream-&gt;type
op_eq
id|VORTEX_PCM_SPDIF
)paren
id|vortex_route
c_func
(paren
id|vortex
comma
id|en
comma
l_int|0x14
comma
id|ADB_DMA
c_func
(paren
id|stream-&gt;dma
)paren
comma
id|ADB_SPDIFOUT
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|stream-&gt;type
op_ne
id|VORTEX_PCM_SPDIF
op_logical_and
id|stream-&gt;type
op_ne
id|VORTEX_PCM_A3D
)paren
(brace
id|ch_top
op_assign
(paren
id|VORTEX_IS_QUAD
c_func
(paren
id|vortex
)paren
ques
c_cond
l_int|4
suffix:colon
l_int|2
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|nr_ch
suffix:semicolon
id|i
OL
id|ch_top
suffix:semicolon
id|i
op_increment
)paren
(brace
id|vortex_connection_mixin_mix
c_func
(paren
id|vortex
comma
id|en
comma
id|mix
(braket
id|i
op_mod
id|nr_ch
)braket
comma
id|MIX_PLAYB
c_func
(paren
id|i
)paren
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifndef CHIP_AU8820
id|vortex_connection_mixin_mix
c_func
(paren
id|vortex
comma
id|en
comma
id|mix
(braket
id|i
op_mod
id|nr_ch
)braket
comma
id|MIX_SPDIF
c_func
(paren
id|i
op_mod
l_int|2
)paren
comma
l_int|0
)paren
suffix:semicolon
id|vortex_mix_setinputvolumebyte
c_func
(paren
id|vortex
comma
id|MIX_SPDIF
c_func
(paren
id|i
op_mod
l_int|2
)paren
comma
id|mix
(braket
id|i
op_mod
id|nr_ch
)braket
comma
id|MIX_DEFIGAIN
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
macro_line|#ifndef CHIP_AU8820
r_else
(brace
r_if
c_cond
(paren
id|nr_ch
op_eq
l_int|1
op_logical_and
id|stream-&gt;type
op_eq
id|VORTEX_PCM_SPDIF
)paren
id|vortex_route
c_func
(paren
id|vortex
comma
id|en
comma
l_int|0x14
comma
id|ADB_DMA
c_func
(paren
id|stream-&gt;dma
)paren
comma
id|ADB_SPDIFOUT
c_func
(paren
l_int|1
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Reconnect SPDIF out when &quot;spdif&quot; device is down. */
r_if
c_cond
(paren
(paren
id|stream-&gt;type
op_eq
id|VORTEX_PCM_SPDIF
)paren
op_logical_and
(paren
op_logical_neg
id|en
)paren
)paren
(brace
id|vortex_route
c_func
(paren
id|vortex
comma
l_int|1
comma
l_int|0x14
comma
id|ADB_MIXOUT
c_func
(paren
id|vortex-&gt;mixspdif
(braket
l_int|0
)braket
)paren
comma
id|ADB_SPDIFOUT
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
id|vortex_route
c_func
(paren
id|vortex
comma
l_int|1
comma
l_int|0x14
comma
id|ADB_MIXOUT
c_func
(paren
id|vortex-&gt;mixspdif
(braket
l_int|1
)braket
)paren
comma
id|ADB_SPDIFOUT
c_func
(paren
l_int|1
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* CAPTURE ROUTES. */
)brace
r_else
(brace
r_int
id|src
(braket
l_int|2
)braket
comma
id|mix
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* Get SRC and MIXER hardware resources. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nr_ch
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|mix
(braket
id|i
)braket
op_assign
id|vortex_adb_checkinout
c_func
(paren
id|vortex
comma
id|stream-&gt;resources
comma
id|en
comma
id|VORTEX_RESOURCE_MIXOUT
)paren
)paren
OL
l_int|0
)paren
(brace
id|memset
c_func
(paren
id|stream-&gt;resources
comma
l_int|0
comma
r_sizeof
(paren
r_int
r_char
)paren
op_star
id|VORTEX_RESOURCE_LAST
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|src
(braket
id|i
)braket
op_assign
id|vortex_adb_checkinout
c_func
(paren
id|vortex
comma
id|stream-&gt;resources
comma
id|en
comma
id|VORTEX_RESOURCE_SRC
)paren
)paren
OL
l_int|0
)paren
(brace
id|memset
c_func
(paren
id|stream-&gt;resources
comma
l_int|0
comma
r_sizeof
(paren
r_int
r_char
)paren
op_star
id|VORTEX_RESOURCE_LAST
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
)brace
multiline_comment|/* Make capture routes. */
id|vortex_connection_mixin_mix
c_func
(paren
id|vortex
comma
id|en
comma
id|MIX_CAPT
c_func
(paren
l_int|0
)paren
comma
id|mix
(braket
l_int|0
)braket
comma
l_int|0
)paren
suffix:semicolon
id|vortex_connection_mix_src
c_func
(paren
id|vortex
comma
id|en
comma
l_int|0x11
comma
id|mix
(braket
l_int|0
)braket
comma
id|src
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nr_ch
op_eq
l_int|1
)paren
(brace
id|vortex_connection_mixin_mix
c_func
(paren
id|vortex
comma
id|en
comma
id|MIX_CAPT
c_func
(paren
l_int|1
)paren
comma
id|mix
(braket
l_int|0
)braket
comma
l_int|0
)paren
suffix:semicolon
id|vortex_connection_src_adbdma
c_func
(paren
id|vortex
comma
id|en
comma
id|src
(braket
id|nr_ch
op_minus
l_int|1
)braket
comma
id|src
(braket
l_int|0
)braket
comma
id|dma
)paren
suffix:semicolon
)brace
r_else
(brace
id|vortex_connection_mixin_mix
c_func
(paren
id|vortex
comma
id|en
comma
id|MIX_CAPT
c_func
(paren
l_int|1
)paren
comma
id|mix
(braket
l_int|1
)braket
comma
l_int|0
)paren
suffix:semicolon
id|vortex_connection_mix_src
c_func
(paren
id|vortex
comma
id|en
comma
l_int|0x11
comma
id|mix
(braket
l_int|1
)braket
comma
id|src
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|vortex_connection_src_src_adbdma
c_func
(paren
id|vortex
comma
id|en
comma
id|src
(braket
l_int|0
)braket
comma
id|src
(braket
l_int|0
)braket
comma
id|src
(braket
l_int|1
)braket
comma
id|dma
)paren
suffix:semicolon
)brace
)brace
id|vortex-&gt;dma_adb
(braket
id|dma
)braket
dot
id|nr_ch
op_assign
id|nr_ch
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|vortex-&gt;lock
)paren
suffix:semicolon
macro_line|#if 0
multiline_comment|/* AC97 Codec channel setup. FIXME: this has no effect on some cards !! */
r_if
c_cond
(paren
id|nr_ch
OL
l_int|4
)paren
(brace
multiline_comment|/* Copy stereo to rear channel (surround) */
id|snd_ac97_write_cache
c_func
(paren
id|vortex-&gt;codec
comma
id|AC97_SIGMATEL_DAC2INVERT
comma
id|snd_ac97_read
c_func
(paren
id|vortex-&gt;codec
comma
id|AC97_SIGMATEL_DAC2INVERT
)paren
op_or
l_int|4
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Allow separate front and rear channels. */
id|snd_ac97_write_cache
c_func
(paren
id|vortex-&gt;codec
comma
id|AC97_SIGMATEL_DAC2INVERT
comma
id|snd_ac97_read
c_func
(paren
id|vortex-&gt;codec
comma
id|AC97_SIGMATEL_DAC2INVERT
)paren
op_amp
op_complement
(paren
(paren
id|u32
)paren
l_int|4
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
id|dma
suffix:semicolon
)brace
multiline_comment|/*&n; Set the SampleRate of the SRC&squot;s attached to the given DMA engine.&n; */
r_static
r_void
DECL|function|vortex_adb_setsrc
id|vortex_adb_setsrc
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|adbdma
comma
r_int
r_int
id|rate
comma
r_int
id|dir
)paren
(brace
id|stream_t
op_star
id|stream
op_assign
op_amp
(paren
id|vortex-&gt;dma_adb
(braket
id|adbdma
)braket
)paren
suffix:semicolon
r_int
id|i
comma
id|cvrt
suffix:semicolon
multiline_comment|/* dir=1:play ; dir=0:rec */
r_if
c_cond
(paren
id|dir
)paren
id|cvrt
op_assign
id|SRC_RATIO
c_func
(paren
id|rate
comma
l_int|48000
)paren
suffix:semicolon
r_else
id|cvrt
op_assign
id|SRC_RATIO
c_func
(paren
l_int|48000
comma
id|rate
)paren
suffix:semicolon
multiline_comment|/* Setup SRC&squot;s */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_SRC
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|stream-&gt;resources
(braket
id|VORTEX_RESOURCE_SRC
)braket
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
id|vortex_src_setupchannel
c_func
(paren
id|vortex
comma
id|i
comma
id|cvrt
comma
l_int|0
comma
l_int|0
comma
id|i
comma
id|dir
comma
l_int|1
comma
id|cvrt
comma
id|dir
)paren
suffix:semicolon
)brace
)brace
singleline_comment|// Timer and ISR functions.
DECL|function|vortex_settimer
r_static
r_void
id|vortex_settimer
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|period
)paren
(brace
singleline_comment|//set the timer period to &lt;period&gt; 48000ths of a second.
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_IRQ_STAT
comma
id|period
)paren
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_void
id|vortex_enable_timer_int
c_func
(paren
id|vortex_t
op_star
id|card
)paren
(brace
id|hwwrite
c_func
(paren
id|card-&gt;mmio
comma
id|VORTEX_IRQ_CTRL
comma
id|hwread
c_func
(paren
id|card-&gt;mmio
comma
id|VORTEX_IRQ_CTRL
)paren
op_or
id|IRQ_TIMER
op_or
l_int|0x60
)paren
suffix:semicolon
)brace
r_static
r_void
id|vortex_disable_timer_int
c_func
(paren
id|vortex_t
op_star
id|card
)paren
(brace
id|hwwrite
c_func
(paren
id|card-&gt;mmio
comma
id|VORTEX_IRQ_CTRL
comma
id|hwread
c_func
(paren
id|card-&gt;mmio
comma
id|VORTEX_IRQ_CTRL
)paren
op_amp
op_complement
id|IRQ_TIMER
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|vortex_enable_int
r_static
r_void
id|vortex_enable_int
c_func
(paren
id|vortex_t
op_star
id|card
)paren
(brace
singleline_comment|// CAsp4ISR__EnableVortexInt_void_
id|hwwrite
c_func
(paren
id|card-&gt;mmio
comma
id|VORTEX_CTRL
comma
id|hwread
c_func
(paren
id|card-&gt;mmio
comma
id|VORTEX_CTRL
)paren
op_or
id|CTRL_IRQ_ENABLE
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|card-&gt;mmio
comma
id|VORTEX_IRQ_CTRL
comma
(paren
id|hwread
c_func
(paren
id|card-&gt;mmio
comma
id|VORTEX_IRQ_CTRL
)paren
op_amp
l_int|0xffffefc0
)paren
op_or
l_int|0x24
)paren
suffix:semicolon
)brace
DECL|function|vortex_disable_int
r_static
r_void
id|vortex_disable_int
c_func
(paren
id|vortex_t
op_star
id|card
)paren
(brace
id|hwwrite
c_func
(paren
id|card-&gt;mmio
comma
id|VORTEX_CTRL
comma
id|hwread
c_func
(paren
id|card-&gt;mmio
comma
id|VORTEX_CTRL
)paren
op_amp
op_complement
id|CTRL_IRQ_ENABLE
)paren
suffix:semicolon
)brace
DECL|function|vortex_interrupt
r_static
id|irqreturn_t
id|vortex_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|vortex_t
op_star
id|vortex
op_assign
id|snd_magic_cast
c_func
(paren
id|vortex_t
comma
id|dev_id
comma
r_return
id|IRQ_NONE
)paren
suffix:semicolon
r_int
id|i
comma
id|handled
suffix:semicolon
id|u32
id|source
suffix:semicolon
singleline_comment|//check if the interrupt is ours.
r_if
c_cond
(paren
op_logical_neg
(paren
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_STAT
)paren
op_amp
l_int|0x1
)paren
)paren
r_return
id|IRQ_NONE
suffix:semicolon
singleline_comment|// This is the Interrrupt Enable flag we set before (consistency check).
r_if
c_cond
(paren
op_logical_neg
(paren
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_CTRL
)paren
op_amp
id|CTRL_IRQ_ENABLE
)paren
)paren
r_return
id|IRQ_NONE
suffix:semicolon
id|source
op_assign
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_IRQ_SOURCE
)paren
suffix:semicolon
singleline_comment|// Reset IRQ flags.
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_IRQ_SOURCE
comma
id|source
)paren
suffix:semicolon
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_IRQ_SOURCE
)paren
suffix:semicolon
singleline_comment|// Is at least one IRQ flag set?
r_if
c_cond
(paren
id|source
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;vortex: missing irq source&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|IRQ_NONE
suffix:semicolon
)brace
id|handled
op_assign
l_int|0
suffix:semicolon
singleline_comment|// Attend every interrupt source.
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|source
op_amp
id|IRQ_ERR_MASK
)paren
)paren
(brace
r_if
c_cond
(paren
id|source
op_amp
id|IRQ_FATAL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;vortex: IRQ fatal error&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|source
op_amp
id|IRQ_PARITY
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;vortex: IRQ parity error&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|source
op_amp
id|IRQ_REG
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;vortex: IRQ reg error&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|source
op_amp
id|IRQ_FIFO
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;vortex: IRQ fifo error&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|source
op_amp
id|IRQ_DMA
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;vortex: IRQ dma error&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|handled
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|source
op_amp
id|IRQ_PCMOUT
)paren
(brace
multiline_comment|/* ALSA period acknowledge. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_ADB
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|vortex-&gt;dma_adb
(braket
id|i
)braket
dot
id|fifo_status
op_eq
id|FIFO_START
)paren
(brace
r_if
c_cond
(paren
id|vortex_adbdma_bufshift
c_func
(paren
id|vortex
comma
id|i
)paren
)paren
suffix:semicolon
id|snd_pcm_period_elapsed
c_func
(paren
id|vortex-&gt;dma_adb
(braket
id|i
)braket
dot
id|substream
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifndef CHIP_AU8810
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_WT
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|vortex-&gt;dma_wt
(braket
id|i
)braket
dot
id|fifo_status
op_eq
id|FIFO_START
)paren
(brace
r_if
c_cond
(paren
id|vortex_wtdma_bufshift
c_func
(paren
id|vortex
comma
id|i
)paren
)paren
suffix:semicolon
id|snd_pcm_period_elapsed
c_func
(paren
id|vortex-&gt;dma_wt
(braket
id|i
)braket
dot
id|substream
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
id|handled
op_assign
l_int|1
suffix:semicolon
)brace
singleline_comment|//Acknowledge the Timer interrupt
r_if
c_cond
(paren
id|source
op_amp
id|IRQ_TIMER
)paren
(brace
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_IRQ_STAT
)paren
suffix:semicolon
id|handled
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|source
op_amp
id|IRQ_MIDI
)paren
(brace
id|snd_mpu401_uart_interrupt
c_func
(paren
id|vortex-&gt;irq
comma
id|vortex-&gt;rmidi-&gt;private_data
comma
id|regs
)paren
suffix:semicolon
id|handled
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|handled
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;vortex: unknown irq source %x&bslash;n&quot;
comma
id|source
)paren
suffix:semicolon
)brace
r_return
id|IRQ_RETVAL
c_func
(paren
id|handled
)paren
suffix:semicolon
)brace
multiline_comment|/* Codec */
DECL|macro|POLL_COUNT
mdefine_line|#define POLL_COUNT 1000
DECL|function|vortex_codec_init
r_static
r_void
id|vortex_codec_init
c_func
(paren
id|vortex_t
op_star
id|vortex
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
(paren
id|VORTEX_CODEC_CHN
op_plus
(paren
id|i
op_lshift
l_int|2
)paren
)paren
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|2000
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|0
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_CODEC_CTRL
comma
l_int|0x8068
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_CODEC_CTRL
comma
l_int|0x00e8
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
)brace
r_else
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_CODEC_CTRL
comma
l_int|0x00a8
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|2000
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_CODEC_CTRL
comma
l_int|0x80a8
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|2000
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_CODEC_CTRL
comma
l_int|0x80e8
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|2000
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_CODEC_CTRL
comma
l_int|0x80a8
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|2000
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_CODEC_CTRL
comma
l_int|0x00a8
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|2000
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_CODEC_CTRL
comma
l_int|0x00e8
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
(paren
id|VORTEX_CODEC_CHN
op_plus
(paren
id|i
op_lshift
l_int|2
)paren
)paren
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5000
)paren
suffix:semicolon
)brace
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_CODEC_CTRL
comma
l_int|0xe8
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* Enable codec channels 0 and 1. */
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_CODEC_EN
comma
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_CODEC_EN
)paren
op_or
id|EN_CODEC
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|vortex_codec_write
id|vortex_codec_write
c_func
(paren
id|ac97_t
op_star
id|codec
comma
r_int
r_int
id|addr
comma
r_int
r_int
id|data
)paren
(brace
id|vortex_t
op_star
id|card
op_assign
(paren
id|vortex_t
op_star
)paren
id|codec-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|lifeboat
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* wait for transactions to clear */
r_while
c_loop
(paren
op_logical_neg
(paren
id|hwread
c_func
(paren
id|card-&gt;mmio
comma
id|VORTEX_CODEC_CTRL
)paren
op_amp
l_int|0x100
)paren
)paren
(brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lifeboat
op_increment
OG
id|POLL_COUNT
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;vortex: ac97 codec stuck busy&bslash;n&quot;
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
multiline_comment|/* write register */
id|hwwrite
c_func
(paren
id|card-&gt;mmio
comma
id|VORTEX_CODEC_IO
comma
(paren
(paren
id|addr
op_lshift
id|VORTEX_CODEC_ADDSHIFT
)paren
op_amp
id|VORTEX_CODEC_ADDMASK
)paren
op_or
(paren
(paren
id|data
op_lshift
id|VORTEX_CODEC_DATSHIFT
)paren
op_amp
id|VORTEX_CODEC_DATMASK
)paren
op_or
id|VORTEX_CODEC_WRITE
)paren
suffix:semicolon
multiline_comment|/* Flush Caches. */
id|hwread
c_func
(paren
id|card-&gt;mmio
comma
id|VORTEX_CODEC_IO
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|vortex_codec_read
r_static
r_int
r_int
id|vortex_codec_read
c_func
(paren
id|ac97_t
op_star
id|codec
comma
r_int
r_int
id|addr
)paren
(brace
id|vortex_t
op_star
id|card
op_assign
(paren
id|vortex_t
op_star
)paren
id|codec-&gt;private_data
suffix:semicolon
id|u32
id|read_addr
comma
id|data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|lifeboat
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* wait for transactions to clear */
r_while
c_loop
(paren
op_logical_neg
(paren
id|hwread
c_func
(paren
id|card-&gt;mmio
comma
id|VORTEX_CODEC_CTRL
)paren
op_amp
l_int|0x100
)paren
)paren
(brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lifeboat
op_increment
OG
id|POLL_COUNT
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;vortex: ac97 codec stuck busy&bslash;n&quot;
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0xffff
suffix:semicolon
)brace
)brace
multiline_comment|/* set up read address */
id|read_addr
op_assign
(paren
(paren
id|addr
op_lshift
id|VORTEX_CODEC_ADDSHIFT
)paren
op_amp
id|VORTEX_CODEC_ADDMASK
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|card-&gt;mmio
comma
id|VORTEX_CODEC_IO
comma
id|read_addr
)paren
suffix:semicolon
multiline_comment|/* wait for address */
(brace
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|data
op_assign
id|hwread
c_func
(paren
id|card-&gt;mmio
comma
id|VORTEX_CODEC_IO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lifeboat
op_increment
OG
id|POLL_COUNT
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;vortex: ac97 address never arrived&bslash;n&quot;
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0xffff
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
(paren
id|data
op_amp
id|VORTEX_CODEC_ADDMASK
)paren
op_ne
(paren
id|addr
op_lshift
id|VORTEX_CODEC_ADDSHIFT
)paren
)paren
suffix:semicolon
multiline_comment|/* Unlock. */
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* return data. */
r_return
(paren
id|u16
)paren
(paren
id|data
op_amp
id|VORTEX_CODEC_DATMASK
)paren
suffix:semicolon
)brace
multiline_comment|/* SPDIF support  */
DECL|function|vortex_spdif_init
r_static
r_void
id|vortex_spdif_init
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|spdif_sr
comma
r_int
id|spdif_mode
)paren
(brace
r_int
id|i
comma
id|this_38
op_assign
l_int|0
comma
id|this_04
op_assign
l_int|0
comma
id|this_08
op_assign
l_int|0
comma
id|this_0c
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* CAsp4Spdif::InitializeSpdifHardware(void) */
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SPDIF_FLAGS
comma
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SPDIF_FLAGS
)paren
op_amp
l_int|0xfff3fffd
)paren
suffix:semicolon
singleline_comment|//for (i=0x291D4; i&lt;0x29200; i+=4)
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|11
suffix:semicolon
id|i
op_increment
)paren
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SPDIF_CFG1
op_plus
(paren
id|i
op_lshift
l_int|2
)paren
comma
l_int|0
)paren
suffix:semicolon
singleline_comment|//hwwrite(vortex-&gt;mmio, 0x29190, hwread(vortex-&gt;mmio, 0x29190) | 0xc0000);
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_CODEC_EN
comma
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_CODEC_EN
)paren
op_or
id|EN_SPDIF
)paren
suffix:semicolon
multiline_comment|/* CAsp4Spdif::ProgramSRCInHardware(enum  SPDIF_SR,enum  SPDIFMODE) */
r_if
c_cond
(paren
id|this_04
op_logical_and
id|this_08
)paren
(brace
r_int
id|edi
suffix:semicolon
id|i
op_assign
(paren
(paren
(paren
l_int|0x5DC00000
op_div
id|spdif_sr
)paren
op_plus
l_int|1
)paren
op_rshift
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OG
l_int|0x800
)paren
(brace
r_if
c_cond
(paren
id|i
OL
l_int|0x1ffff
)paren
id|edi
op_assign
(paren
id|i
op_rshift
l_int|1
)paren
suffix:semicolon
r_else
id|edi
op_assign
l_int|0x1ffff
suffix:semicolon
)brace
r_else
(brace
id|i
op_assign
id|edi
op_assign
l_int|0x800
suffix:semicolon
)brace
multiline_comment|/* this_04 and this_08 are the CASp4Src&squot;s (samplerate converters) */
id|vortex_src_setupchannel
c_func
(paren
id|vortex
comma
id|this_04
comma
id|edi
comma
l_int|0
comma
l_int|1
comma
id|this_0c
comma
l_int|1
comma
l_int|0
comma
id|edi
comma
l_int|1
)paren
suffix:semicolon
id|vortex_src_setupchannel
c_func
(paren
id|vortex
comma
id|this_08
comma
id|edi
comma
l_int|0
comma
l_int|1
comma
id|this_0c
comma
l_int|1
comma
l_int|0
comma
id|edi
comma
l_int|1
)paren
suffix:semicolon
)brace
id|i
op_assign
id|spdif_sr
suffix:semicolon
id|spdif_sr
op_or_assign
l_int|0x8c
suffix:semicolon
r_switch
c_cond
(paren
id|i
)paren
(brace
r_case
l_int|32000
suffix:colon
id|this_38
op_and_assign
l_int|0xFFFFFFFE
suffix:semicolon
id|this_38
op_and_assign
l_int|0xFFFFFFFD
suffix:semicolon
id|this_38
op_and_assign
l_int|0xF3FFFFFF
suffix:semicolon
id|this_38
op_or_assign
l_int|0x03000000
suffix:semicolon
multiline_comment|/* set 32khz samplerate */
id|this_38
op_and_assign
l_int|0xFFFFFF3F
suffix:semicolon
id|spdif_sr
op_and_assign
l_int|0xFFFFFFFD
suffix:semicolon
id|spdif_sr
op_or_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|44100
suffix:colon
id|this_38
op_and_assign
l_int|0xFFFFFFFE
suffix:semicolon
id|this_38
op_and_assign
l_int|0xFFFFFFFD
suffix:semicolon
id|this_38
op_and_assign
l_int|0xF0FFFFFF
suffix:semicolon
id|this_38
op_or_assign
l_int|0x03000000
suffix:semicolon
id|this_38
op_and_assign
l_int|0xFFFFFF3F
suffix:semicolon
id|spdif_sr
op_and_assign
l_int|0xFFFFFFFC
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|48000
suffix:colon
r_if
c_cond
(paren
id|spdif_mode
op_eq
l_int|1
)paren
(brace
id|this_38
op_and_assign
l_int|0xFFFFFFFE
suffix:semicolon
id|this_38
op_and_assign
l_int|0xFFFFFFFD
suffix:semicolon
id|this_38
op_and_assign
l_int|0xF2FFFFFF
suffix:semicolon
id|this_38
op_or_assign
l_int|0x02000000
suffix:semicolon
multiline_comment|/* set 48khz samplerate */
id|this_38
op_and_assign
l_int|0xFFFFFF3F
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* J. Gordon Wolfe: I think this stuff is for AC3 */
id|this_38
op_or_assign
l_int|0x00000003
suffix:semicolon
id|this_38
op_and_assign
l_int|0xFFFFFFBF
suffix:semicolon
id|this_38
op_or_assign
l_int|0x80
suffix:semicolon
)brace
id|spdif_sr
op_or_assign
l_int|2
suffix:semicolon
id|spdif_sr
op_and_assign
l_int|0xFFFFFFFE
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* looks like the next 2 lines transfer a 16-bit value into 2 8-bit &n;&t;   registers. seems to be for the standard IEC/SPDIF initialization &n;&t;   stuff */
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SPDIF_CFG0
comma
id|this_38
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SPDIF_CFG1
comma
id|this_38
op_rshift
l_int|0x10
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_SPDIF_SMPRATE
comma
id|spdif_sr
)paren
suffix:semicolon
)brace
multiline_comment|/* Initialization */
DECL|function|vortex_core_init
r_static
r_int
id|vortex_core_init
c_func
(paren
id|vortex_t
op_star
id|vortex
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Vortex: hardware init.... &quot;
)paren
suffix:semicolon
multiline_comment|/* Hardware Init. */
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_CTRL
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5000
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_CTRL
comma
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_CTRL
)paren
op_amp
l_int|0xffdfffff
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5000
)paren
suffix:semicolon
multiline_comment|/* Reset IRQ flags */
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_IRQ_SOURCE
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_IRQ_STAT
)paren
suffix:semicolon
id|vortex_codec_init
c_func
(paren
id|vortex
)paren
suffix:semicolon
macro_line|#ifdef CHIP_AU8830
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_CTRL
comma
id|hwread
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_CTRL
)paren
op_or
l_int|0x1000000
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Init audio engine. */
id|vortex_adbdma_init
c_func
(paren
id|vortex
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_ENGINE_CTRL
comma
l_int|0x0
)paren
suffix:semicolon
singleline_comment|//, 0xc83c7e58, 0xc5f93e58
id|vortex_adb_init
c_func
(paren
id|vortex
)paren
suffix:semicolon
multiline_comment|/* Init processing blocks. */
id|vortex_fifo_init
c_func
(paren
id|vortex
)paren
suffix:semicolon
id|vortex_mixer_init
c_func
(paren
id|vortex
)paren
suffix:semicolon
id|vortex_srcblock_init
c_func
(paren
id|vortex
)paren
suffix:semicolon
macro_line|#ifndef CHIP_AU8820
id|vortex_eq_init
c_func
(paren
id|vortex
)paren
suffix:semicolon
id|vortex_spdif_init
c_func
(paren
id|vortex
comma
l_int|48000
comma
l_int|1
)paren
suffix:semicolon
id|vortex_Vort3D
c_func
(paren
id|vortex
comma
l_int|1
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifndef CHIP_AU8810
id|vortex_wt_init
c_func
(paren
id|vortex
)paren
suffix:semicolon
macro_line|#endif
singleline_comment|// Moved to au88x0.c
singleline_comment|//vortex_connect_default(vortex, 1);
id|vortex_settimer
c_func
(paren
id|vortex
comma
l_int|0x90
)paren
suffix:semicolon
singleline_comment|// Enable Interrupts.
singleline_comment|// vortex_enable_int() must be first !!
singleline_comment|//  hwwrite(vortex-&gt;mmio, VORTEX_IRQ_CTRL, 0);
singleline_comment|// vortex_enable_int(vortex);
singleline_comment|//vortex_enable_timer_int(vortex);
singleline_comment|//vortex_disable_timer_int(vortex);
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;done.&bslash;n&quot;
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|vortex-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|vortex_core_shutdown
r_static
r_int
id|vortex_core_shutdown
c_func
(paren
id|vortex_t
op_star
id|vortex
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Vortex: hardware shutdown...&quot;
)paren
suffix:semicolon
macro_line|#ifndef CHIP_AU8820
id|vortex_eq_free
c_func
(paren
id|vortex
)paren
suffix:semicolon
id|vortex_Vort3D
c_func
(paren
id|vortex
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
singleline_comment|//vortex_disable_timer_int(vortex);
id|vortex_disable_int
c_func
(paren
id|vortex
)paren
suffix:semicolon
id|vortex_connect_default
c_func
(paren
id|vortex
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Reset all DMA fifos. */
id|vortex_fifo_init
c_func
(paren
id|vortex
)paren
suffix:semicolon
multiline_comment|/* Erase all audio routes. */
id|vortex_adb_init
c_func
(paren
id|vortex
)paren
suffix:semicolon
multiline_comment|/* Disable MPU401 */
singleline_comment|//hwwrite(vortex-&gt;mmio, VORTEX_IRQ_CTRL, hwread(vortex-&gt;mmio, VORTEX_IRQ_CTRL) &amp; ~IRQ_MIDI);
singleline_comment|//hwwrite(vortex-&gt;mmio, VORTEX_CTRL, hwread(vortex-&gt;mmio, VORTEX_CTRL) &amp; ~CTRL_MIDI_EN);
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_IRQ_CTRL
comma
l_int|0
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_CTRL
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5000
)paren
suffix:semicolon
id|hwwrite
c_func
(paren
id|vortex-&gt;mmio
comma
id|VORTEX_IRQ_SOURCE
comma
l_int|0xffff
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;done.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Alsa support. */
DECL|function|vortex_alsafmt_aspfmt
r_static
r_int
id|vortex_alsafmt_aspfmt
c_func
(paren
r_int
id|alsafmt
)paren
(brace
r_int
id|fmt
suffix:semicolon
r_switch
c_cond
(paren
id|alsafmt
)paren
(brace
r_case
id|SNDRV_PCM_FORMAT_U8
suffix:colon
id|fmt
op_assign
l_int|0x1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_FORMAT_MU_LAW
suffix:colon
id|fmt
op_assign
l_int|0x2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_FORMAT_A_LAW
suffix:colon
id|fmt
op_assign
l_int|0x3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_FORMAT_SPECIAL
suffix:colon
id|fmt
op_assign
l_int|0x4
suffix:semicolon
multiline_comment|/* guess. */
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_FORMAT_IEC958_SUBFRAME_LE
suffix:colon
id|fmt
op_assign
l_int|0x5
suffix:semicolon
multiline_comment|/* guess. */
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_FORMAT_S16_LE
suffix:colon
id|fmt
op_assign
l_int|0x8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_FORMAT_S16_BE
suffix:colon
id|fmt
op_assign
l_int|0x9
suffix:semicolon
multiline_comment|/* check this... */
r_break
suffix:semicolon
r_default
suffix:colon
id|fmt
op_assign
l_int|0x8
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;vortex: format unsupported %d&bslash;n&quot;
comma
id|alsafmt
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|fmt
suffix:semicolon
)brace
multiline_comment|/* Some not yet useful translations. */
macro_line|#if 0
r_typedef
r_enum
(brace
id|ASPFMTLINEAR16
op_assign
l_int|0
comma
multiline_comment|/* 0x8 */
id|ASPFMTLINEAR8
comma
multiline_comment|/* 0x1 */
id|ASPFMTULAW
comma
multiline_comment|/* 0x2 */
id|ASPFMTALAW
comma
multiline_comment|/* 0x3 */
id|ASPFMTSPORT
comma
multiline_comment|/* ? */
id|ASPFMTSPDIF
comma
multiline_comment|/* ? */
)brace
id|ASPENCODING
suffix:semicolon
r_static
r_int
id|vortex_translateformat
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_char
id|bits
comma
r_char
id|nch
comma
r_int
id|encod
)paren
(brace
r_int
id|a
comma
id|this_194
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bits
op_ne
l_int|8
)paren
op_logical_or
(paren
id|bits
op_ne
l_int|16
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|encod
)paren
(brace
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
id|bits
op_eq
l_int|0x10
)paren
id|a
op_assign
l_int|8
suffix:semicolon
singleline_comment|// 16 bit
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
r_if
c_cond
(paren
id|bits
op_eq
l_int|8
)paren
id|a
op_assign
l_int|1
suffix:semicolon
singleline_comment|// 8 bit
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|a
op_assign
l_int|2
suffix:semicolon
singleline_comment|// U_LAW
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|a
op_assign
l_int|3
suffix:semicolon
singleline_comment|// A_LAW
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|nch
)paren
(brace
r_case
l_int|1
suffix:colon
id|this_194
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|this_194
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|this_194
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|6
suffix:colon
id|this_194
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
(paren
id|a
)paren
suffix:semicolon
)brace
r_static
r_void
id|vortex_cdmacore_setformat
c_func
(paren
id|vortex_t
op_star
id|vortex
comma
r_int
id|bits
comma
r_int
id|nch
)paren
(brace
r_int
r_int
id|d
comma
id|this_148
suffix:semicolon
id|d
op_assign
(paren
(paren
id|bits
op_rshift
l_int|3
)paren
op_star
id|nch
)paren
suffix:semicolon
id|this_148
op_assign
l_int|0xbb80
op_div
id|d
suffix:semicolon
)brace
macro_line|#endif
eof
