multiline_comment|/*&n; *  Driver for S3 SonicVibes soundcard&n; *  Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *&n; *  BUGS:&n; *    It looks like 86c617 rev 3 doesn&squot;t supports DDMA buffers above 16MB?&n; *    Driver sometimes hangs... Nobody knows why at this moment...&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/gameport.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#include &lt;sound/control.h&gt;
macro_line|#include &lt;sound/mpu401.h&gt;
macro_line|#include &lt;sound/opl3.h&gt;
macro_line|#include &lt;sound/initval.h&gt;
macro_line|#include &lt;asm/io.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jaroslav Kysela &lt;perex@suse.cz&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;S3 SonicVibes PCI&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_CLASSES
c_func
(paren
l_string|&quot;{sound}&quot;
)paren
suffix:semicolon
id|MODULE_DEVICES
c_func
(paren
l_string|&quot;{{S3,SonicVibes PCI}}&quot;
)paren
suffix:semicolon
macro_line|#ifndef PCI_VENDOR_ID_S3
DECL|macro|PCI_VENDOR_ID_S3
mdefine_line|#define PCI_VENDOR_ID_S3             0x5333
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_S3_SONICVIBES
DECL|macro|PCI_DEVICE_ID_S3_SONICVIBES
mdefine_line|#define PCI_DEVICE_ID_S3_SONICVIBES  0xca00
macro_line|#endif
DECL|variable|index
r_static
r_int
id|index
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_IDX
suffix:semicolon
multiline_comment|/* Index 0-MAX */
DECL|variable|id
r_static
r_char
op_star
id|id
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_STR
suffix:semicolon
multiline_comment|/* ID for this card */
DECL|variable|enable
r_static
r_int
id|enable
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_ENABLE_PNP
suffix:semicolon
multiline_comment|/* Enable this card */
DECL|variable|reverb
r_static
r_int
id|reverb
(braket
id|SNDRV_CARDS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
(paren
id|SNDRV_CARDS
op_minus
l_int|1
)paren
)braket
op_assign
l_int|0
)brace
suffix:semicolon
DECL|variable|mge
r_static
r_int
id|mge
(braket
id|SNDRV_CARDS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
(paren
id|SNDRV_CARDS
op_minus
l_int|1
)paren
)braket
op_assign
l_int|0
)brace
suffix:semicolon
DECL|variable|dmaio
r_static
r_int
r_int
id|dmaio
op_assign
l_int|0x7a00
suffix:semicolon
multiline_comment|/* DDMA i/o address */
DECL|variable|boot_devs
r_static
r_int
id|boot_devs
suffix:semicolon
id|module_param_array
c_func
(paren
id|index
comma
r_int
comma
id|boot_devs
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|index
comma
l_string|&quot;Index value for S3 SonicVibes soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|index
comma
id|SNDRV_INDEX_DESC
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|id
comma
id|charp
comma
id|boot_devs
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|id
comma
l_string|&quot;ID string for S3 SonicVibes soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|id
comma
id|SNDRV_ID_DESC
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|enable
comma
r_bool
comma
id|boot_devs
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|enable
comma
l_string|&quot;Enable S3 SonicVibes soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|enable
comma
id|SNDRV_ENABLE_DESC
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|reverb
comma
r_bool
comma
id|boot_devs
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|reverb
comma
l_string|&quot;Enable reverb (SRAM is present) for S3 SonicVibes soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|reverb
comma
id|SNDRV_ENABLED
l_string|&quot;,&quot;
id|SNDRV_ENABLE_DESC
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|mge
comma
r_bool
comma
id|boot_devs
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|mge
comma
l_string|&quot;MIC Gain Enable for S3 SonicVibes soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|mge
comma
id|SNDRV_ENABLED
l_string|&quot;,&quot;
id|SNDRV_ENABLE_DESC
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|dmaio
comma
id|uint
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|dmaio
comma
l_string|&quot;DDMA i/o base address for S3 SonicVibes soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|dmaio
comma
l_string|&quot;global,&quot;
id|SNDRV_PORT_DESC
)paren
suffix:semicolon
multiline_comment|/*&n; * Enhanced port direct registers&n; */
DECL|macro|SV_REG
mdefine_line|#define SV_REG(sonic, x) ((sonic)-&gt;enh_port + SV_REG_##x)
DECL|macro|SV_REG_CONTROL
mdefine_line|#define SV_REG_CONTROL&t;0x00&t;/* R/W: CODEC/Mixer control register */
DECL|macro|SV_ENHANCED
mdefine_line|#define   SV_ENHANCED&t;  0x01&t;/* audio mode select - enhanced mode */
DECL|macro|SV_TEST
mdefine_line|#define   SV_TEST&t;  0x02&t;/* test bit */
DECL|macro|SV_REVERB
mdefine_line|#define   SV_REVERB&t;  0x04&t;/* reverb enable */
DECL|macro|SV_WAVETABLE
mdefine_line|#define   SV_WAVETABLE&t;  0x08&t;/* wavetable active / FM active if not set */
DECL|macro|SV_INTA
mdefine_line|#define   SV_INTA&t;  0x20&t;/* INTA driving - should be always 1 */
DECL|macro|SV_RESET
mdefine_line|#define   SV_RESET&t;  0x80&t;/* reset chip */
DECL|macro|SV_REG_IRQMASK
mdefine_line|#define SV_REG_IRQMASK&t;0x01&t;/* R/W: CODEC/Mixer interrupt mask register */
DECL|macro|SV_DMAA_MASK
mdefine_line|#define   SV_DMAA_MASK&t;  0x01&t;/* mask DMA-A interrupt */
DECL|macro|SV_DMAC_MASK
mdefine_line|#define   SV_DMAC_MASK&t;  0x04&t;/* mask DMA-C interrupt */
DECL|macro|SV_SPEC_MASK
mdefine_line|#define   SV_SPEC_MASK&t;  0x08&t;/* special interrupt mask - should be always masked */
DECL|macro|SV_UD_MASK
mdefine_line|#define   SV_UD_MASK&t;  0x40&t;/* Up/Down button interrupt mask */
DECL|macro|SV_MIDI_MASK
mdefine_line|#define   SV_MIDI_MASK&t;  0x80&t;/* mask MIDI interrupt */
DECL|macro|SV_REG_STATUS
mdefine_line|#define SV_REG_STATUS&t;0x02&t;/* R/O: CODEC/Mixer status register */
DECL|macro|SV_DMAA_IRQ
mdefine_line|#define   SV_DMAA_IRQ&t;  0x01&t;/* DMA-A interrupt */
DECL|macro|SV_DMAC_IRQ
mdefine_line|#define   SV_DMAC_IRQ&t;  0x04&t;/* DMA-C interrupt */
DECL|macro|SV_SPEC_IRQ
mdefine_line|#define   SV_SPEC_IRQ&t;  0x08&t;/* special interrupt */
DECL|macro|SV_UD_IRQ
mdefine_line|#define   SV_UD_IRQ&t;  0x40&t;/* Up/Down interrupt */
DECL|macro|SV_MIDI_IRQ
mdefine_line|#define   SV_MIDI_IRQ&t;  0x80&t;/* MIDI interrupt */
DECL|macro|SV_REG_INDEX
mdefine_line|#define SV_REG_INDEX&t;0x04&t;/* R/W: CODEC/Mixer index address register */
DECL|macro|SV_MCE
mdefine_line|#define   SV_MCE          0x40&t;/* mode change enable */
DECL|macro|SV_TRD
mdefine_line|#define   SV_TRD&t;  0x80&t;/* DMA transfer request disabled */
DECL|macro|SV_REG_DATA
mdefine_line|#define SV_REG_DATA&t;0x05&t;/* R/W: CODEC/Mixer index data register */
multiline_comment|/*&n; * Enhanced port indirect registers&n; */
DECL|macro|SV_IREG_LEFT_ADC
mdefine_line|#define SV_IREG_LEFT_ADC&t;0x00&t;/* Left ADC Input Control */
DECL|macro|SV_IREG_RIGHT_ADC
mdefine_line|#define SV_IREG_RIGHT_ADC&t;0x01&t;/* Right ADC Input Control */
DECL|macro|SV_IREG_LEFT_AUX1
mdefine_line|#define SV_IREG_LEFT_AUX1&t;0x02&t;/* Left AUX1 Input Control */
DECL|macro|SV_IREG_RIGHT_AUX1
mdefine_line|#define SV_IREG_RIGHT_AUX1&t;0x03&t;/* Right AUX1 Input Control */
DECL|macro|SV_IREG_LEFT_CD
mdefine_line|#define SV_IREG_LEFT_CD&t;&t;0x04&t;/* Left CD Input Control */
DECL|macro|SV_IREG_RIGHT_CD
mdefine_line|#define SV_IREG_RIGHT_CD&t;0x05&t;/* Right CD Input Control */
DECL|macro|SV_IREG_LEFT_LINE
mdefine_line|#define SV_IREG_LEFT_LINE&t;0x06&t;/* Left Line Input Control */
DECL|macro|SV_IREG_RIGHT_LINE
mdefine_line|#define SV_IREG_RIGHT_LINE&t;0x07&t;/* Right Line Input Control */
DECL|macro|SV_IREG_MIC
mdefine_line|#define SV_IREG_MIC&t;&t;0x08&t;/* MIC Input Control */
DECL|macro|SV_IREG_GAME_PORT
mdefine_line|#define SV_IREG_GAME_PORT&t;0x09&t;/* Game Port Control */
DECL|macro|SV_IREG_LEFT_SYNTH
mdefine_line|#define SV_IREG_LEFT_SYNTH&t;0x0a&t;/* Left Synth Input Control */
DECL|macro|SV_IREG_RIGHT_SYNTH
mdefine_line|#define SV_IREG_RIGHT_SYNTH&t;0x0b&t;/* Right Synth Input Control */
DECL|macro|SV_IREG_LEFT_AUX2
mdefine_line|#define SV_IREG_LEFT_AUX2&t;0x0c&t;/* Left AUX2 Input Control */
DECL|macro|SV_IREG_RIGHT_AUX2
mdefine_line|#define SV_IREG_RIGHT_AUX2&t;0x0d&t;/* Right AUX2 Input Control */
DECL|macro|SV_IREG_LEFT_ANALOG
mdefine_line|#define SV_IREG_LEFT_ANALOG&t;0x0e&t;/* Left Analog Mixer Output Control */
DECL|macro|SV_IREG_RIGHT_ANALOG
mdefine_line|#define SV_IREG_RIGHT_ANALOG&t;0x0f&t;/* Right Analog Mixer Output Control */
DECL|macro|SV_IREG_LEFT_PCM
mdefine_line|#define SV_IREG_LEFT_PCM&t;0x10&t;/* Left PCM Input Control */
DECL|macro|SV_IREG_RIGHT_PCM
mdefine_line|#define SV_IREG_RIGHT_PCM&t;0x11&t;/* Right PCM Input Control */
DECL|macro|SV_IREG_DMA_DATA_FMT
mdefine_line|#define SV_IREG_DMA_DATA_FMT&t;0x12&t;/* DMA Data Format */
DECL|macro|SV_IREG_PC_ENABLE
mdefine_line|#define SV_IREG_PC_ENABLE&t;0x13&t;/* Playback/Capture Enable Register */
DECL|macro|SV_IREG_UD_BUTTON
mdefine_line|#define SV_IREG_UD_BUTTON&t;0x14&t;/* Up/Down Button Register */
DECL|macro|SV_IREG_REVISION
mdefine_line|#define SV_IREG_REVISION&t;0x15&t;/* Revision */
DECL|macro|SV_IREG_ADC_OUTPUT_CTRL
mdefine_line|#define SV_IREG_ADC_OUTPUT_CTRL&t;0x16&t;/* ADC Output Control */
DECL|macro|SV_IREG_DMA_A_UPPER
mdefine_line|#define SV_IREG_DMA_A_UPPER&t;0x18&t;/* DMA A Upper Base Count */
DECL|macro|SV_IREG_DMA_A_LOWER
mdefine_line|#define SV_IREG_DMA_A_LOWER&t;0x19&t;/* DMA A Lower Base Count */
DECL|macro|SV_IREG_DMA_C_UPPER
mdefine_line|#define SV_IREG_DMA_C_UPPER&t;0x1c&t;/* DMA C Upper Base Count */
DECL|macro|SV_IREG_DMA_C_LOWER
mdefine_line|#define SV_IREG_DMA_C_LOWER&t;0x1d&t;/* DMA C Lower Base Count */
DECL|macro|SV_IREG_PCM_RATE_LOW
mdefine_line|#define SV_IREG_PCM_RATE_LOW&t;0x1e&t;/* PCM Sampling Rate Low Byte */
DECL|macro|SV_IREG_PCM_RATE_HIGH
mdefine_line|#define SV_IREG_PCM_RATE_HIGH&t;0x1f&t;/* PCM Sampling Rate High Byte */
DECL|macro|SV_IREG_SYNTH_RATE_LOW
mdefine_line|#define SV_IREG_SYNTH_RATE_LOW&t;0x20&t;/* Synthesizer Sampling Rate Low Byte */
DECL|macro|SV_IREG_SYNTH_RATE_HIGH
mdefine_line|#define SV_IREG_SYNTH_RATE_HIGH 0x21&t;/* Synthesizer Sampling Rate High Byte */
DECL|macro|SV_IREG_ADC_CLOCK
mdefine_line|#define SV_IREG_ADC_CLOCK&t;0x22&t;/* ADC Clock Source Selection */
DECL|macro|SV_IREG_ADC_ALT_RATE
mdefine_line|#define SV_IREG_ADC_ALT_RATE&t;0x23&t;/* ADC Alternative Sampling Rate Selection */
DECL|macro|SV_IREG_ADC_PLL_M
mdefine_line|#define SV_IREG_ADC_PLL_M&t;0x24&t;/* ADC PLL M Register */
DECL|macro|SV_IREG_ADC_PLL_N
mdefine_line|#define SV_IREG_ADC_PLL_N&t;0x25&t;/* ADC PLL N Register */
DECL|macro|SV_IREG_SYNTH_PLL_M
mdefine_line|#define SV_IREG_SYNTH_PLL_M&t;0x26&t;/* Synthesizer PLL M Register */
DECL|macro|SV_IREG_SYNTH_PLL_N
mdefine_line|#define SV_IREG_SYNTH_PLL_N&t;0x27&t;/* Synthesizer PLL N Register */
DECL|macro|SV_IREG_MPU401
mdefine_line|#define SV_IREG_MPU401&t;&t;0x2a&t;/* MPU-401 UART Operation */
DECL|macro|SV_IREG_DRIVE_CTRL
mdefine_line|#define SV_IREG_DRIVE_CTRL&t;0x2b&t;/* Drive Control */
DECL|macro|SV_IREG_SRS_SPACE
mdefine_line|#define SV_IREG_SRS_SPACE&t;0x2c&t;/* SRS Space Control */
DECL|macro|SV_IREG_SRS_CENTER
mdefine_line|#define SV_IREG_SRS_CENTER&t;0x2d&t;/* SRS Center Control */
DECL|macro|SV_IREG_WAVE_SOURCE
mdefine_line|#define SV_IREG_WAVE_SOURCE&t;0x2e&t;/* Wavetable Sample Source Select */
DECL|macro|SV_IREG_ANALOG_POWER
mdefine_line|#define SV_IREG_ANALOG_POWER&t;0x30&t;/* Analog Power Down Control */
DECL|macro|SV_IREG_DIGITAL_POWER
mdefine_line|#define SV_IREG_DIGITAL_POWER&t;0x31&t;/* Digital Power Down Control */
DECL|macro|SV_IREG_ADC_PLL
mdefine_line|#define SV_IREG_ADC_PLL&t;&t;SV_IREG_ADC_PLL_M
DECL|macro|SV_IREG_SYNTH_PLL
mdefine_line|#define SV_IREG_SYNTH_PLL&t;SV_IREG_SYNTH_PLL_M
multiline_comment|/*&n; *  DMA registers&n; */
DECL|macro|SV_DMA_ADDR0
mdefine_line|#define SV_DMA_ADDR0&t;&t;0x00
DECL|macro|SV_DMA_ADDR1
mdefine_line|#define SV_DMA_ADDR1&t;&t;0x01
DECL|macro|SV_DMA_ADDR2
mdefine_line|#define SV_DMA_ADDR2&t;&t;0x02
DECL|macro|SV_DMA_ADDR3
mdefine_line|#define SV_DMA_ADDR3&t;&t;0x03
DECL|macro|SV_DMA_COUNT0
mdefine_line|#define SV_DMA_COUNT0&t;&t;0x04
DECL|macro|SV_DMA_COUNT1
mdefine_line|#define SV_DMA_COUNT1&t;&t;0x05
DECL|macro|SV_DMA_COUNT2
mdefine_line|#define SV_DMA_COUNT2&t;&t;0x06
DECL|macro|SV_DMA_MODE
mdefine_line|#define SV_DMA_MODE&t;&t;0x0b
DECL|macro|SV_DMA_RESET
mdefine_line|#define SV_DMA_RESET&t;&t;0x0d
DECL|macro|SV_DMA_MASK
mdefine_line|#define SV_DMA_MASK&t;&t;0x0f
multiline_comment|/*&n; *  Record sources&n; */
DECL|macro|SV_RECSRC_RESERVED
mdefine_line|#define SV_RECSRC_RESERVED&t;(0x00&lt;&lt;5)
DECL|macro|SV_RECSRC_CD
mdefine_line|#define SV_RECSRC_CD&t;&t;(0x01&lt;&lt;5)
DECL|macro|SV_RECSRC_DAC
mdefine_line|#define SV_RECSRC_DAC&t;&t;(0x02&lt;&lt;5)
DECL|macro|SV_RECSRC_AUX2
mdefine_line|#define SV_RECSRC_AUX2&t;&t;(0x03&lt;&lt;5)
DECL|macro|SV_RECSRC_LINE
mdefine_line|#define SV_RECSRC_LINE&t;&t;(0x04&lt;&lt;5)
DECL|macro|SV_RECSRC_AUX1
mdefine_line|#define SV_RECSRC_AUX1&t;&t;(0x05&lt;&lt;5)
DECL|macro|SV_RECSRC_MIC
mdefine_line|#define SV_RECSRC_MIC&t;&t;(0x06&lt;&lt;5)
DECL|macro|SV_RECSRC_OUT
mdefine_line|#define SV_RECSRC_OUT&t;&t;(0x07&lt;&lt;5)
multiline_comment|/*&n; *  constants&n; */
DECL|macro|SV_FULLRATE
mdefine_line|#define SV_FULLRATE&t;&t;48000
DECL|macro|SV_REFFREQUENCY
mdefine_line|#define SV_REFFREQUENCY&t;&t;24576000
DECL|macro|SV_ADCMULT
mdefine_line|#define SV_ADCMULT&t;&t;512
DECL|macro|SV_MODE_PLAY
mdefine_line|#define SV_MODE_PLAY&t;&t;1
DECL|macro|SV_MODE_CAPTURE
mdefine_line|#define SV_MODE_CAPTURE&t;&t;2
multiline_comment|/*&n;&n; */
DECL|typedef|sonicvibes_t
r_typedef
r_struct
id|_snd_sonicvibes
id|sonicvibes_t
suffix:semicolon
DECL|macro|chip_t
mdefine_line|#define chip_t sonicvibes_t
DECL|struct|_snd_sonicvibes
r_struct
id|_snd_sonicvibes
(brace
DECL|member|dma1size
r_int
r_int
id|dma1size
suffix:semicolon
DECL|member|dma2size
r_int
r_int
id|dma2size
suffix:semicolon
DECL|member|irq
r_int
id|irq
suffix:semicolon
DECL|member|sb_port
r_int
r_int
id|sb_port
suffix:semicolon
DECL|member|res_sb_port
r_struct
id|resource
op_star
id|res_sb_port
suffix:semicolon
DECL|member|enh_port
r_int
r_int
id|enh_port
suffix:semicolon
DECL|member|res_enh_port
r_struct
id|resource
op_star
id|res_enh_port
suffix:semicolon
DECL|member|synth_port
r_int
r_int
id|synth_port
suffix:semicolon
DECL|member|res_synth_port
r_struct
id|resource
op_star
id|res_synth_port
suffix:semicolon
DECL|member|midi_port
r_int
r_int
id|midi_port
suffix:semicolon
DECL|member|res_midi_port
r_struct
id|resource
op_star
id|res_midi_port
suffix:semicolon
DECL|member|game_port
r_int
r_int
id|game_port
suffix:semicolon
DECL|member|dmaa_port
r_int
r_int
id|dmaa_port
suffix:semicolon
DECL|member|res_dmaa
r_struct
id|resource
op_star
id|res_dmaa
suffix:semicolon
DECL|member|dmac_port
r_int
r_int
id|dmac_port
suffix:semicolon
DECL|member|res_dmac
r_struct
id|resource
op_star
id|res_dmac
suffix:semicolon
DECL|member|enable
r_int
r_char
id|enable
suffix:semicolon
DECL|member|irqmask
r_int
r_char
id|irqmask
suffix:semicolon
DECL|member|revision
r_int
r_char
id|revision
suffix:semicolon
DECL|member|format
r_int
r_char
id|format
suffix:semicolon
DECL|member|srs_space
r_int
r_char
id|srs_space
suffix:semicolon
DECL|member|srs_center
r_int
r_char
id|srs_center
suffix:semicolon
DECL|member|mpu_switch
r_int
r_char
id|mpu_switch
suffix:semicolon
DECL|member|wave_source
r_int
r_char
id|wave_source
suffix:semicolon
DECL|member|mode
r_int
r_int
id|mode
suffix:semicolon
DECL|member|pci
r_struct
id|pci_dev
op_star
id|pci
suffix:semicolon
DECL|member|card
id|snd_card_t
op_star
id|card
suffix:semicolon
DECL|member|pcm
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
DECL|member|playback_substream
id|snd_pcm_substream_t
op_star
id|playback_substream
suffix:semicolon
DECL|member|capture_substream
id|snd_pcm_substream_t
op_star
id|capture_substream
suffix:semicolon
DECL|member|rmidi
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
DECL|member|fmsynth
id|snd_hwdep_t
op_star
id|fmsynth
suffix:semicolon
multiline_comment|/* S3FM */
DECL|member|reg_lock
id|spinlock_t
id|reg_lock
suffix:semicolon
DECL|member|p_dma_size
r_int
r_int
id|p_dma_size
suffix:semicolon
DECL|member|c_dma_size
r_int
r_int
id|c_dma_size
suffix:semicolon
DECL|member|master_mute
id|snd_kcontrol_t
op_star
id|master_mute
suffix:semicolon
DECL|member|master_volume
id|snd_kcontrol_t
op_star
id|master_volume
suffix:semicolon
macro_line|#if defined(CONFIG_GAMEPORT) || (defined(MODULE) &amp;&amp; defined(CONFIG_GAMEPORT_MODULE))
DECL|member|gameport
r_struct
id|gameport
id|gameport
suffix:semicolon
macro_line|#endif
)brace
suffix:semicolon
DECL|variable|snd_sonic_ids
r_static
r_struct
id|pci_device_id
id|snd_sonic_ids
(braket
)braket
op_assign
(brace
(brace
l_int|0x5333
comma
l_int|0xca00
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|snd_sonic_ids
)paren
suffix:semicolon
DECL|variable|sonicvibes_adc_clock
r_static
id|ratden_t
id|sonicvibes_adc_clock
op_assign
(brace
dot
id|num_min
op_assign
l_int|4000
op_star
l_int|65536
comma
dot
id|num_max
op_assign
l_int|48000UL
op_star
l_int|65536
comma
dot
id|num_step
op_assign
l_int|1
comma
dot
id|den
op_assign
l_int|65536
comma
)brace
suffix:semicolon
DECL|variable|snd_sonicvibes_hw_constraints_adc_clock
r_static
id|snd_pcm_hw_constraint_ratdens_t
id|snd_sonicvibes_hw_constraints_adc_clock
op_assign
(brace
dot
id|nrats
op_assign
l_int|1
comma
dot
id|rats
op_assign
op_amp
id|sonicvibes_adc_clock
comma
)brace
suffix:semicolon
multiline_comment|/*&n; *  common I/O routines&n; */
DECL|function|snd_sonicvibes_setdmaa
r_static
r_inline
r_void
id|snd_sonicvibes_setdmaa
c_func
(paren
id|sonicvibes_t
op_star
id|sonic
comma
r_int
r_int
id|addr
comma
r_int
r_int
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
id|outl
c_func
(paren
id|addr
comma
id|sonic-&gt;dmaa_port
op_plus
id|SV_DMA_ADDR0
)paren
suffix:semicolon
id|outl
c_func
(paren
id|count
comma
id|sonic-&gt;dmaa_port
op_plus
id|SV_DMA_COUNT0
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x18
comma
id|sonic-&gt;dmaa_port
op_plus
id|SV_DMA_MODE
)paren
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;program dmaa: addr = 0x%x, paddr = 0x%x&bslash;n&quot;
comma
id|addr
comma
id|inl
c_func
(paren
id|sonic-&gt;dmaa_port
op_plus
id|SV_DMA_ADDR0
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|snd_sonicvibes_setdmac
r_static
r_inline
r_void
id|snd_sonicvibes_setdmac
c_func
(paren
id|sonicvibes_t
op_star
id|sonic
comma
r_int
r_int
id|addr
comma
r_int
r_int
id|count
)paren
(brace
multiline_comment|/* note: dmac is working in word mode!!! */
id|count
op_rshift_assign
l_int|1
suffix:semicolon
id|count
op_decrement
suffix:semicolon
id|outl
c_func
(paren
id|addr
comma
id|sonic-&gt;dmac_port
op_plus
id|SV_DMA_ADDR0
)paren
suffix:semicolon
id|outl
c_func
(paren
id|count
comma
id|sonic-&gt;dmac_port
op_plus
id|SV_DMA_COUNT0
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x14
comma
id|sonic-&gt;dmac_port
op_plus
id|SV_DMA_MODE
)paren
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;program dmac: addr = 0x%x, paddr = 0x%x&bslash;n&quot;
comma
id|addr
comma
id|inl
c_func
(paren
id|sonic-&gt;dmac_port
op_plus
id|SV_DMA_ADDR0
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|snd_sonicvibes_getdmaa
r_static
r_inline
r_int
r_int
id|snd_sonicvibes_getdmaa
c_func
(paren
id|sonicvibes_t
op_star
id|sonic
)paren
(brace
r_return
(paren
id|inl
c_func
(paren
id|sonic-&gt;dmaa_port
op_plus
id|SV_DMA_COUNT0
)paren
op_amp
l_int|0xffffff
)paren
op_plus
l_int|1
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_getdmac
r_static
r_inline
r_int
r_int
id|snd_sonicvibes_getdmac
c_func
(paren
id|sonicvibes_t
op_star
id|sonic
)paren
(brace
multiline_comment|/* note: dmac is working in word mode!!! */
r_return
(paren
(paren
id|inl
c_func
(paren
id|sonic-&gt;dmac_port
op_plus
id|SV_DMA_COUNT0
)paren
op_amp
l_int|0xffffff
)paren
op_plus
l_int|1
)paren
op_lshift
l_int|1
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_out1
r_static
r_void
id|snd_sonicvibes_out1
c_func
(paren
id|sonicvibes_t
op_star
id|sonic
comma
r_int
r_char
id|reg
comma
r_int
r_char
id|value
)paren
(brace
id|outb
c_func
(paren
id|reg
comma
id|SV_REG
c_func
(paren
id|sonic
comma
id|INDEX
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|outb
c_func
(paren
id|value
comma
id|SV_REG
c_func
(paren
id|sonic
comma
id|DATA
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_out
r_static
r_void
id|snd_sonicvibes_out
c_func
(paren
id|sonicvibes_t
op_star
id|sonic
comma
r_int
r_char
id|reg
comma
r_int
r_char
id|value
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
id|reg
comma
id|SV_REG
c_func
(paren
id|sonic
comma
id|INDEX
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|outb
c_func
(paren
id|value
comma
id|SV_REG
c_func
(paren
id|sonic
comma
id|DATA
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_in1
r_static
r_int
r_char
id|snd_sonicvibes_in1
c_func
(paren
id|sonicvibes_t
op_star
id|sonic
comma
r_int
r_char
id|reg
)paren
(brace
r_int
r_char
id|value
suffix:semicolon
id|outb
c_func
(paren
id|reg
comma
id|SV_REG
c_func
(paren
id|sonic
comma
id|INDEX
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|value
op_assign
id|inb
c_func
(paren
id|SV_REG
c_func
(paren
id|sonic
comma
id|DATA
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_in
r_static
r_int
r_char
id|snd_sonicvibes_in
c_func
(paren
id|sonicvibes_t
op_star
id|sonic
comma
r_int
r_char
id|reg
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|value
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
id|reg
comma
id|SV_REG
c_func
(paren
id|sonic
comma
id|INDEX
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|value
op_assign
id|inb
c_func
(paren
id|SV_REG
c_func
(paren
id|sonic
comma
id|DATA
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SND_DEBUG
DECL|function|snd_sonicvibes_debug
r_void
id|snd_sonicvibes_debug
c_func
(paren
id|sonicvibes_t
op_star
id|sonic
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;SV REGS:          INDEX = 0x%02x  &quot;
comma
id|inb
c_func
(paren
id|SV_REG
c_func
(paren
id|sonic
comma
id|INDEX
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;                 STATUS = 0x%02x&bslash;n&quot;
comma
id|inb
c_func
(paren
id|SV_REG
c_func
(paren
id|sonic
comma
id|STATUS
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x00: left input      = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x00
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x20: synth rate low  = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x20
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x01: right input     = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x01
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x21: synth rate high = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x21
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x02: left AUX1       = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x02
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x22: ADC clock       = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x22
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x03: right AUX1      = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x03
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x23: ADC alt rate    = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x23
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x04: left CD         = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x04
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x24: ADC pll M       = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x24
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x05: right CD        = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x05
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x25: ADC pll N       = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x25
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x06: left line       = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x06
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x26: Synth pll M     = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x26
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x07: right line      = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x07
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x27: Synth pll N     = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x27
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x08: MIC             = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x08
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x28: ---             = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x28
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x09: Game port       = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x09
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x29: ---             = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x29
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x0a: left synth      = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x0a
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x2a: MPU401          = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x2a
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x0b: right synth     = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x0b
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x2b: drive ctrl      = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x2b
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x0c: left AUX2       = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x0c
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x2c: SRS space       = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x2c
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x0d: right AUX2      = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x0d
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x2d: SRS center      = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x2d
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x0e: left analog     = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x0e
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x2e: wave source     = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x2e
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x0f: right analog    = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x0f
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x2f: ---             = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x2f
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x10: left PCM        = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x10
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x30: analog power    = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x30
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x11: right PCM       = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x11
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x31: analog power    = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x31
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x12: DMA data format = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x12
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x32: ---             = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x32
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x13: P/C enable      = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x13
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x33: ---             = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x33
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x14: U/D button      = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x14
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x34: ---             = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x34
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x15: revision        = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x15
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x35: ---             = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x35
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x16: ADC output ctrl = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x16
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x36: ---             = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x36
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x17: ---             = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x17
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x37: ---             = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x37
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x18: DMA A upper cnt = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x18
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x38: ---             = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x38
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x19: DMA A lower cnt = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x19
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x39: ---             = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x39
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x1a: ---             = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x1a
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x3a: ---             = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x3a
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x1b: ---             = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x1b
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x3b: ---             = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x3b
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x1c: DMA C upper cnt = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x1c
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x3c: ---             = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x3c
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x1d: DMA C upper cnt = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x1d
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x3d: ---             = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x3d
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x1e: PCM rate low    = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x1e
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x3e: ---             = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x3e
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x1f: PCM rate high   = 0x%02x  &quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x1f
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x3f: ---             = 0x%02x&bslash;n&quot;
comma
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
l_int|0x3f
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|snd_sonicvibes_setfmt
r_static
r_void
id|snd_sonicvibes_setfmt
c_func
(paren
id|sonicvibes_t
op_star
id|sonic
comma
r_int
r_char
id|mask
comma
r_int
r_char
id|value
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
id|SV_MCE
op_or
id|SV_IREG_DMA_DATA_FMT
comma
id|SV_REG
c_func
(paren
id|sonic
comma
id|INDEX
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mask
)paren
(brace
id|sonic-&gt;format
op_assign
id|inb
c_func
(paren
id|SV_REG
c_func
(paren
id|sonic
comma
id|DATA
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|sonic-&gt;format
op_assign
(paren
id|sonic-&gt;format
op_amp
id|mask
)paren
op_or
id|value
suffix:semicolon
id|outb
c_func
(paren
id|sonic-&gt;format
comma
id|SV_REG
c_func
(paren
id|sonic
comma
id|DATA
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|SV_REG
c_func
(paren
id|sonic
comma
id|INDEX
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_pll
r_static
r_void
id|snd_sonicvibes_pll
c_func
(paren
r_int
r_int
id|rate
comma
r_int
r_int
op_star
id|res_r
comma
r_int
r_int
op_star
id|res_m
comma
r_int
r_int
op_star
id|res_n
)paren
(brace
r_int
r_int
id|r
comma
id|m
op_assign
l_int|0
comma
id|n
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|xm
comma
id|xn
comma
id|xr
comma
id|xd
comma
id|metric
op_assign
op_complement
l_int|0U
suffix:semicolon
r_if
c_cond
(paren
id|rate
OL
l_int|625000
op_div
id|SV_ADCMULT
)paren
id|rate
op_assign
l_int|625000
op_div
id|SV_ADCMULT
suffix:semicolon
r_if
c_cond
(paren
id|rate
OG
l_int|150000000
op_div
id|SV_ADCMULT
)paren
id|rate
op_assign
l_int|150000000
op_div
id|SV_ADCMULT
suffix:semicolon
multiline_comment|/* slight violation of specs, needed for continuous sampling rates */
r_for
c_loop
(paren
id|r
op_assign
l_int|0
suffix:semicolon
id|rate
OL
l_int|75000000
op_div
id|SV_ADCMULT
suffix:semicolon
id|r
op_add_assign
l_int|0x20
comma
id|rate
op_lshift_assign
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|xn
op_assign
l_int|3
suffix:semicolon
id|xn
OL
l_int|33
suffix:semicolon
id|xn
op_increment
)paren
multiline_comment|/* 35 */
r_for
c_loop
(paren
id|xm
op_assign
l_int|3
suffix:semicolon
id|xm
OL
l_int|257
suffix:semicolon
id|xm
op_increment
)paren
(brace
id|xr
op_assign
(paren
(paren
id|SV_REFFREQUENCY
op_div
id|SV_ADCMULT
)paren
op_star
id|xm
)paren
op_div
id|xn
suffix:semicolon
r_if
c_cond
(paren
id|xr
op_ge
id|rate
)paren
id|xd
op_assign
id|xr
op_minus
id|rate
suffix:semicolon
r_else
id|xd
op_assign
id|rate
op_minus
id|xr
suffix:semicolon
r_if
c_cond
(paren
id|xd
OL
id|metric
)paren
(brace
id|metric
op_assign
id|xd
suffix:semicolon
id|m
op_assign
id|xm
op_minus
l_int|2
suffix:semicolon
id|n
op_assign
id|xn
op_minus
l_int|2
suffix:semicolon
)brace
)brace
op_star
id|res_r
op_assign
id|r
suffix:semicolon
op_star
id|res_m
op_assign
id|m
suffix:semicolon
op_star
id|res_n
op_assign
id|n
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;metric = %i, xm = %i, xn = %i&bslash;n&quot;
comma
id|metric
comma
id|xm
comma
id|xn
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;pll: m = 0x%x, r = 0x%x, n = 0x%x&bslash;n&quot;
comma
id|reg
comma
id|m
comma
id|r
comma
id|n
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|snd_sonicvibes_setpll
r_static
r_void
id|snd_sonicvibes_setpll
c_func
(paren
id|sonicvibes_t
op_star
id|sonic
comma
r_int
r_char
id|reg
comma
r_int
r_int
id|rate
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|r
comma
id|m
comma
id|n
suffix:semicolon
id|snd_sonicvibes_pll
c_func
(paren
id|rate
comma
op_amp
id|r
comma
op_amp
id|m
comma
op_amp
id|n
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sonic
op_ne
l_int|NULL
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_sonicvibes_out1
c_func
(paren
id|sonic
comma
id|reg
comma
id|m
)paren
suffix:semicolon
id|snd_sonicvibes_out1
c_func
(paren
id|sonic
comma
id|reg
op_plus
l_int|1
comma
id|r
op_or
id|n
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_sonicvibes_set_adc_rate
r_static
r_void
id|snd_sonicvibes_set_adc_rate
c_func
(paren
id|sonicvibes_t
op_star
id|sonic
comma
r_int
r_int
id|rate
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|div
suffix:semicolon
r_int
r_char
id|clock
suffix:semicolon
id|div
op_assign
l_int|48000
op_div
id|rate
suffix:semicolon
r_if
c_cond
(paren
id|div
OG
l_int|8
)paren
id|div
op_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
(paren
l_int|48000
op_div
id|div
)paren
op_eq
id|rate
)paren
(brace
multiline_comment|/* use the alternate clock */
id|clock
op_assign
l_int|0x10
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* use the PLL source */
id|clock
op_assign
l_int|0x00
suffix:semicolon
id|snd_sonicvibes_setpll
c_func
(paren
id|sonic
comma
id|SV_IREG_ADC_PLL
comma
id|rate
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_sonicvibes_out1
c_func
(paren
id|sonic
comma
id|SV_IREG_ADC_ALT_RATE
comma
(paren
id|div
op_minus
l_int|1
)paren
op_lshift
l_int|4
)paren
suffix:semicolon
id|snd_sonicvibes_out1
c_func
(paren
id|sonic
comma
id|SV_IREG_ADC_CLOCK
comma
id|clock
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_hw_constraint_dac_rate
r_static
r_int
id|snd_sonicvibes_hw_constraint_dac_rate
c_func
(paren
id|snd_pcm_hw_params_t
op_star
id|params
comma
id|snd_pcm_hw_rule_t
op_star
id|rule
)paren
(brace
r_int
r_int
id|rate
comma
id|div
comma
id|r
comma
id|m
comma
id|n
suffix:semicolon
r_if
c_cond
(paren
id|hw_param_interval
c_func
(paren
id|params
comma
id|SNDRV_PCM_HW_PARAM_RATE
)paren
op_member_access_from_pointer
id|min
op_eq
id|hw_param_interval
c_func
(paren
id|params
comma
id|SNDRV_PCM_HW_PARAM_RATE
)paren
op_member_access_from_pointer
id|max
)paren
(brace
id|rate
op_assign
id|hw_param_interval
c_func
(paren
id|params
comma
id|SNDRV_PCM_HW_PARAM_RATE
)paren
op_member_access_from_pointer
id|min
suffix:semicolon
id|div
op_assign
l_int|48000
op_div
id|rate
suffix:semicolon
r_if
c_cond
(paren
id|div
OG
l_int|8
)paren
id|div
op_assign
l_int|8
suffix:semicolon
r_if
c_cond
(paren
(paren
l_int|48000
op_div
id|div
)paren
op_eq
id|rate
)paren
(brace
id|params-&gt;rate_num
op_assign
id|rate
suffix:semicolon
id|params-&gt;rate_den
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|snd_sonicvibes_pll
c_func
(paren
id|rate
comma
op_amp
id|r
comma
op_amp
id|m
comma
op_amp
id|n
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
(paren
id|SV_REFFREQUENCY
op_mod
l_int|16
)paren
op_eq
l_int|0
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
(paren
id|SV_ADCMULT
op_mod
l_int|512
)paren
op_eq
l_int|0
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|params-&gt;rate_num
op_assign
(paren
id|SV_REFFREQUENCY
op_div
l_int|16
)paren
op_star
(paren
id|n
op_plus
l_int|2
)paren
op_star
id|r
suffix:semicolon
id|params-&gt;rate_den
op_assign
(paren
id|SV_ADCMULT
op_div
l_int|512
)paren
op_star
(paren
id|m
op_plus
l_int|2
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_set_dac_rate
r_static
r_void
id|snd_sonicvibes_set_dac_rate
c_func
(paren
id|sonicvibes_t
op_star
id|sonic
comma
r_int
r_int
id|rate
)paren
(brace
r_int
r_int
id|div
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|div
op_assign
(paren
id|rate
op_star
l_int|65536
op_plus
id|SV_FULLRATE
op_div
l_int|2
)paren
op_div
id|SV_FULLRATE
suffix:semicolon
r_if
c_cond
(paren
id|div
OG
l_int|65535
)paren
id|div
op_assign
l_int|65535
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_sonicvibes_out1
c_func
(paren
id|sonic
comma
id|SV_IREG_PCM_RATE_HIGH
comma
id|div
op_rshift
l_int|8
)paren
suffix:semicolon
id|snd_sonicvibes_out1
c_func
(paren
id|sonic
comma
id|SV_IREG_PCM_RATE_LOW
comma
id|div
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_trigger
r_static
r_int
id|snd_sonicvibes_trigger
c_func
(paren
id|sonicvibes_t
op_star
id|sonic
comma
r_int
id|what
comma
r_int
id|cmd
)paren
(brace
r_int
id|result
op_assign
l_int|0
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_START
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|sonic-&gt;enable
op_amp
id|what
)paren
)paren
(brace
id|sonic-&gt;enable
op_or_assign
id|what
suffix:semicolon
id|snd_sonicvibes_out1
c_func
(paren
id|sonic
comma
id|SV_IREG_PC_ENABLE
comma
id|sonic-&gt;enable
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_STOP
)paren
(brace
r_if
c_cond
(paren
id|sonic-&gt;enable
op_amp
id|what
)paren
(brace
id|sonic-&gt;enable
op_and_assign
op_complement
id|what
suffix:semicolon
id|snd_sonicvibes_out1
c_func
(paren
id|sonic
comma
id|SV_IREG_PC_ENABLE
comma
id|sonic-&gt;enable
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_interrupt
r_static
id|irqreturn_t
id|snd_sonicvibes_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_magic_cast
c_func
(paren
id|sonicvibes_t
comma
id|dev_id
comma
r_return
id|IRQ_NONE
)paren
suffix:semicolon
r_int
r_char
id|status
suffix:semicolon
id|status
op_assign
id|inb
c_func
(paren
id|SV_REG
c_func
(paren
id|sonic
comma
id|STATUS
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
(paren
id|SV_DMAA_IRQ
op_or
id|SV_DMAC_IRQ
op_or
id|SV_MIDI_IRQ
)paren
)paren
)paren
r_return
id|IRQ_NONE
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
l_int|0xff
)paren
(brace
multiline_comment|/* failure */
id|outb
c_func
(paren
id|sonic-&gt;irqmask
op_assign
op_complement
l_int|0
comma
id|SV_REG
c_func
(paren
id|sonic
comma
id|IRQMASK
)paren
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;IRQ failure - interrupts disabled!!&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sonic-&gt;pcm
)paren
(brace
r_if
c_cond
(paren
id|status
op_amp
id|SV_DMAA_IRQ
)paren
id|snd_pcm_period_elapsed
c_func
(paren
id|sonic-&gt;playback_substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|SV_DMAC_IRQ
)paren
id|snd_pcm_period_elapsed
c_func
(paren
id|sonic-&gt;capture_substream
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sonic-&gt;rmidi
)paren
(brace
r_if
c_cond
(paren
id|status
op_amp
id|SV_MIDI_IRQ
)paren
id|snd_mpu401_uart_interrupt
c_func
(paren
id|irq
comma
id|sonic-&gt;rmidi-&gt;private_data
comma
id|regs
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|SV_UD_IRQ
)paren
(brace
r_int
r_char
id|udreg
suffix:semicolon
r_int
id|vol
comma
id|oleft
comma
id|oright
comma
id|mleft
comma
id|mright
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
)paren
suffix:semicolon
id|udreg
op_assign
id|snd_sonicvibes_in1
c_func
(paren
id|sonic
comma
id|SV_IREG_UD_BUTTON
)paren
suffix:semicolon
id|vol
op_assign
id|udreg
op_amp
l_int|0x3f
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|udreg
op_amp
l_int|0x40
)paren
)paren
id|vol
op_assign
op_minus
id|vol
suffix:semicolon
id|oleft
op_assign
id|mleft
op_assign
id|snd_sonicvibes_in1
c_func
(paren
id|sonic
comma
id|SV_IREG_LEFT_ANALOG
)paren
suffix:semicolon
id|oright
op_assign
id|mright
op_assign
id|snd_sonicvibes_in1
c_func
(paren
id|sonic
comma
id|SV_IREG_RIGHT_ANALOG
)paren
suffix:semicolon
id|oleft
op_and_assign
l_int|0x1f
suffix:semicolon
id|oright
op_and_assign
l_int|0x1f
suffix:semicolon
id|oleft
op_add_assign
id|vol
suffix:semicolon
r_if
c_cond
(paren
id|oleft
OL
l_int|0
)paren
id|oleft
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|oleft
OG
l_int|0x1f
)paren
id|oleft
op_assign
l_int|0x1f
suffix:semicolon
id|oright
op_add_assign
id|vol
suffix:semicolon
r_if
c_cond
(paren
id|oright
OL
l_int|0
)paren
id|oright
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|oright
OG
l_int|0x1f
)paren
id|oright
op_assign
l_int|0x1f
suffix:semicolon
r_if
c_cond
(paren
id|udreg
op_amp
l_int|0x80
)paren
(brace
id|mleft
op_xor_assign
l_int|0x80
suffix:semicolon
id|mright
op_xor_assign
l_int|0x80
suffix:semicolon
)brace
id|oleft
op_or_assign
id|mleft
op_amp
l_int|0x80
suffix:semicolon
id|oright
op_or_assign
id|mright
op_amp
l_int|0x80
suffix:semicolon
id|snd_sonicvibes_out1
c_func
(paren
id|sonic
comma
id|SV_IREG_LEFT_ANALOG
comma
id|oleft
)paren
suffix:semicolon
id|snd_sonicvibes_out1
c_func
(paren
id|sonic
comma
id|SV_IREG_RIGHT_ANALOG
comma
id|oright
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
)paren
suffix:semicolon
id|snd_ctl_notify
c_func
(paren
id|sonic-&gt;card
comma
id|SNDRV_CTL_EVENT_MASK_VALUE
comma
op_amp
id|sonic-&gt;master_mute-&gt;id
)paren
suffix:semicolon
id|snd_ctl_notify
c_func
(paren
id|sonic-&gt;card
comma
id|SNDRV_CTL_EVENT_MASK_VALUE
comma
op_amp
id|sonic-&gt;master_volume-&gt;id
)paren
suffix:semicolon
)brace
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
multiline_comment|/*&n; *  PCM part&n; */
DECL|function|snd_sonicvibes_playback_trigger
r_static
r_int
id|snd_sonicvibes_playback_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|snd_sonicvibes_trigger
c_func
(paren
id|sonic
comma
l_int|1
comma
id|cmd
)paren
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_capture_trigger
r_static
r_int
id|snd_sonicvibes_capture_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|snd_sonicvibes_trigger
c_func
(paren
id|sonic
comma
l_int|2
comma
id|cmd
)paren
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_hw_params
r_static
r_int
id|snd_sonicvibes_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
r_return
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_hw_free
r_static
r_int
id|snd_sonicvibes_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_playback_prepare
r_static
r_int
id|snd_sonicvibes_playback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
r_char
id|fmt
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|count
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|sonic-&gt;p_dma_size
op_assign
id|size
suffix:semicolon
id|count
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;channels
OG
l_int|1
)paren
id|fmt
op_or_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|16
)paren
id|fmt
op_or_assign
l_int|2
suffix:semicolon
id|snd_sonicvibes_setfmt
c_func
(paren
id|sonic
comma
op_complement
l_int|3
comma
id|fmt
)paren
suffix:semicolon
id|snd_sonicvibes_set_dac_rate
c_func
(paren
id|sonic
comma
id|runtime-&gt;rate
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_sonicvibes_setdmaa
c_func
(paren
id|sonic
comma
id|runtime-&gt;dma_addr
comma
id|size
)paren
suffix:semicolon
id|snd_sonicvibes_out1
c_func
(paren
id|sonic
comma
id|SV_IREG_DMA_A_UPPER
comma
id|count
op_rshift
l_int|8
)paren
suffix:semicolon
id|snd_sonicvibes_out1
c_func
(paren
id|sonic
comma
id|SV_IREG_DMA_A_LOWER
comma
id|count
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_capture_prepare
r_static
r_int
id|snd_sonicvibes_capture_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
r_char
id|fmt
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|count
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|sonic-&gt;c_dma_size
op_assign
id|size
suffix:semicolon
id|count
op_rshift_assign
l_int|1
suffix:semicolon
id|count
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;channels
OG
l_int|1
)paren
id|fmt
op_or_assign
l_int|0x10
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|16
)paren
id|fmt
op_or_assign
l_int|0x20
suffix:semicolon
id|snd_sonicvibes_setfmt
c_func
(paren
id|sonic
comma
op_complement
l_int|0x30
comma
id|fmt
)paren
suffix:semicolon
id|snd_sonicvibes_set_adc_rate
c_func
(paren
id|sonic
comma
id|runtime-&gt;rate
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_sonicvibes_setdmac
c_func
(paren
id|sonic
comma
id|runtime-&gt;dma_addr
comma
id|size
)paren
suffix:semicolon
id|snd_sonicvibes_out1
c_func
(paren
id|sonic
comma
id|SV_IREG_DMA_C_UPPER
comma
id|count
op_rshift
l_int|8
)paren
suffix:semicolon
id|snd_sonicvibes_out1
c_func
(paren
id|sonic
comma
id|SV_IREG_DMA_C_LOWER
comma
id|count
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_playback_pointer
r_static
id|snd_pcm_uframes_t
id|snd_sonicvibes_playback_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sonic-&gt;enable
op_amp
l_int|1
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|ptr
op_assign
id|sonic-&gt;p_dma_size
op_minus
id|snd_sonicvibes_getdmaa
c_func
(paren
id|sonic
)paren
suffix:semicolon
r_return
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|ptr
)paren
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_capture_pointer
r_static
id|snd_pcm_uframes_t
id|snd_sonicvibes_capture_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|sonic-&gt;enable
op_amp
l_int|2
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|ptr
op_assign
id|sonic-&gt;c_dma_size
op_minus
id|snd_sonicvibes_getdmac
c_func
(paren
id|sonic
)paren
suffix:semicolon
r_return
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|ptr
)paren
suffix:semicolon
)brace
DECL|variable|snd_sonicvibes_playback
r_static
id|snd_pcm_hardware_t
id|snd_sonicvibes_playback
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
dot
id|rate_min
op_assign
l_int|4000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|32
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|1024
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|snd_sonicvibes_capture
r_static
id|snd_pcm_hardware_t
id|snd_sonicvibes_capture
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
dot
id|rate_min
op_assign
l_int|4000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|32
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|1024
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|function|snd_sonicvibes_playback_open
r_static
r_int
id|snd_sonicvibes_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|sonic-&gt;mode
op_or_assign
id|SV_MODE_PLAY
suffix:semicolon
id|sonic-&gt;playback_substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_sonicvibes_playback
suffix:semicolon
id|snd_pcm_hw_rule_add
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
id|snd_sonicvibes_hw_constraint_dac_rate
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_capture_open
r_static
r_int
id|snd_sonicvibes_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|sonic-&gt;mode
op_or_assign
id|SV_MODE_CAPTURE
suffix:semicolon
id|sonic-&gt;capture_substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_sonicvibes_capture
suffix:semicolon
id|snd_pcm_hw_constraint_ratdens
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
op_amp
id|snd_sonicvibes_hw_constraints_adc_clock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_playback_close
r_static
r_int
id|snd_sonicvibes_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|sonic-&gt;playback_substream
op_assign
l_int|NULL
suffix:semicolon
id|sonic-&gt;mode
op_and_assign
op_complement
id|SV_MODE_PLAY
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_capture_close
r_static
r_int
id|snd_sonicvibes_capture_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|sonic-&gt;capture_substream
op_assign
l_int|NULL
suffix:semicolon
id|sonic-&gt;mode
op_and_assign
op_complement
id|SV_MODE_CAPTURE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_sonicvibes_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_sonicvibes_playback_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_sonicvibes_playback_open
comma
dot
id|close
op_assign
id|snd_sonicvibes_playback_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_sonicvibes_hw_params
comma
dot
id|hw_free
op_assign
id|snd_sonicvibes_hw_free
comma
dot
id|prepare
op_assign
id|snd_sonicvibes_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_sonicvibes_playback_trigger
comma
dot
id|pointer
op_assign
id|snd_sonicvibes_playback_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_sonicvibes_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_sonicvibes_capture_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_sonicvibes_capture_open
comma
dot
id|close
op_assign
id|snd_sonicvibes_capture_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_sonicvibes_hw_params
comma
dot
id|hw_free
op_assign
id|snd_sonicvibes_hw_free
comma
dot
id|prepare
op_assign
id|snd_sonicvibes_capture_prepare
comma
dot
id|trigger
op_assign
id|snd_sonicvibes_capture_trigger
comma
dot
id|pointer
op_assign
id|snd_sonicvibes_capture_pointer
comma
)brace
suffix:semicolon
DECL|function|snd_sonicvibes_pcm_free
r_static
r_void
id|snd_sonicvibes_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_magic_cast
c_func
(paren
id|sonicvibes_t
comma
id|pcm-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|sonic-&gt;pcm
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_pcm
r_static
r_int
id|__devinit
id|snd_sonicvibes_pcm
c_func
(paren
id|sonicvibes_t
op_star
id|sonic
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|sonic-&gt;card
comma
l_string|&quot;s3_86c617&quot;
comma
id|device
comma
l_int|1
comma
l_int|1
comma
op_amp
id|pcm
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_assert
c_func
(paren
id|pcm
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_sonicvibes_playback_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_sonicvibes_capture_ops
)paren
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|sonic
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_sonicvibes_pcm_free
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;S3 SonicVibes&quot;
)paren
suffix:semicolon
id|sonic-&gt;pcm
op_assign
id|pcm
suffix:semicolon
id|snd_pcm_lib_preallocate_pages_for_all
c_func
(paren
id|pcm
comma
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|sonic-&gt;pci
)paren
comma
l_int|64
op_star
l_int|1024
comma
l_int|128
op_star
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Mixer part&n; */
DECL|macro|SONICVIBES_MUX
mdefine_line|#define SONICVIBES_MUX(xname, xindex) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, .index = xindex, &bslash;&n;  .info = snd_sonicvibes_info_mux, &bslash;&n;  .get = snd_sonicvibes_get_mux, .put = snd_sonicvibes_put_mux }
DECL|function|snd_sonicvibes_info_mux
r_static
r_int
id|snd_sonicvibes_info_mux
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_static
r_char
op_star
id|texts
(braket
l_int|7
)braket
op_assign
(brace
l_string|&quot;CD&quot;
comma
l_string|&quot;PCM&quot;
comma
l_string|&quot;Aux1&quot;
comma
l_string|&quot;Line&quot;
comma
l_string|&quot;Aux0&quot;
comma
l_string|&quot;Mic&quot;
comma
l_string|&quot;Mix&quot;
)brace
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_ENUMERATED
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.enumerated.items
op_assign
l_int|7
suffix:semicolon
r_if
c_cond
(paren
id|uinfo-&gt;value.enumerated.item
op_ge
l_int|7
)paren
id|uinfo-&gt;value.enumerated.item
op_assign
l_int|6
suffix:semicolon
id|strcpy
c_func
(paren
id|uinfo-&gt;value.enumerated.name
comma
id|texts
(braket
id|uinfo-&gt;value.enumerated.item
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_get_mux
r_static
r_int
id|snd_sonicvibes_get_mux
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
op_assign
(paren
(paren
id|snd_sonicvibes_in1
c_func
(paren
id|sonic
comma
id|SV_IREG_LEFT_ADC
)paren
op_amp
id|SV_RECSRC_OUT
)paren
op_rshift
l_int|5
)paren
op_minus
l_int|1
suffix:semicolon
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|1
)braket
op_assign
(paren
(paren
id|snd_sonicvibes_in1
c_func
(paren
id|sonic
comma
id|SV_IREG_RIGHT_ADC
)paren
op_amp
id|SV_RECSRC_OUT
)paren
op_rshift
l_int|5
)paren
op_minus
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_put_mux
r_static
r_int
id|snd_sonicvibes_put_mux
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|left
comma
id|right
comma
id|oval1
comma
id|oval2
suffix:semicolon
r_int
id|change
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
op_ge
l_int|7
op_logical_or
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|1
)braket
op_ge
l_int|7
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|left
op_assign
(paren
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
op_plus
l_int|1
)paren
op_lshift
l_int|5
suffix:semicolon
id|right
op_assign
(paren
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|1
)braket
op_plus
l_int|1
)paren
op_lshift
l_int|5
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|oval1
op_assign
id|snd_sonicvibes_in1
c_func
(paren
id|sonic
comma
id|SV_IREG_LEFT_ADC
)paren
suffix:semicolon
id|oval2
op_assign
id|snd_sonicvibes_in1
c_func
(paren
id|sonic
comma
id|SV_IREG_RIGHT_ADC
)paren
suffix:semicolon
id|left
op_assign
(paren
id|oval1
op_amp
op_complement
id|SV_RECSRC_OUT
)paren
op_or
id|left
suffix:semicolon
id|right
op_assign
(paren
id|oval2
op_amp
op_complement
id|SV_RECSRC_OUT
)paren
op_or
id|right
suffix:semicolon
id|change
op_assign
id|left
op_ne
id|oval1
op_logical_or
id|right
op_ne
id|oval2
suffix:semicolon
id|snd_sonicvibes_out1
c_func
(paren
id|sonic
comma
id|SV_IREG_LEFT_ADC
comma
id|left
)paren
suffix:semicolon
id|snd_sonicvibes_out1
c_func
(paren
id|sonic
comma
id|SV_IREG_RIGHT_ADC
comma
id|right
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|macro|SONICVIBES_SINGLE
mdefine_line|#define SONICVIBES_SINGLE(xname, xindex, reg, shift, mask, invert) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, .index = xindex, &bslash;&n;  .info = snd_sonicvibes_info_single, &bslash;&n;  .get = snd_sonicvibes_get_single, .put = snd_sonicvibes_put_single, &bslash;&n;  .private_value = reg | (shift &lt;&lt; 8) | (mask &lt;&lt; 16) | (invert &lt;&lt; 24) }
DECL|function|snd_sonicvibes_info_single
r_static
r_int
id|snd_sonicvibes_info_single
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|mask
op_eq
l_int|1
ques
c_cond
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:colon
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
id|mask
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_get_single
r_static
r_int
id|snd_sonicvibes_get_single
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|snd_sonicvibes_in1
c_func
(paren
id|sonic
comma
id|reg
)paren
op_rshift
id|shift
)paren
op_amp
id|mask
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|mask
op_minus
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_put_single
r_static
r_int
id|snd_sonicvibes_put_single
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|change
suffix:semicolon
r_int
r_int
id|val
comma
id|oval
suffix:semicolon
id|val
op_assign
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
id|mask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
id|val
op_assign
id|mask
op_minus
id|val
suffix:semicolon
id|val
op_lshift_assign
id|shift
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|oval
op_assign
id|snd_sonicvibes_in1
c_func
(paren
id|sonic
comma
id|reg
)paren
suffix:semicolon
id|val
op_assign
(paren
id|oval
op_amp
op_complement
(paren
id|mask
op_lshift
id|shift
)paren
)paren
op_or
id|val
suffix:semicolon
id|change
op_assign
id|val
op_ne
id|oval
suffix:semicolon
id|snd_sonicvibes_out1
c_func
(paren
id|sonic
comma
id|reg
comma
id|val
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|macro|SONICVIBES_DOUBLE
mdefine_line|#define SONICVIBES_DOUBLE(xname, xindex, left_reg, right_reg, shift_left, shift_right, mask, invert) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, .index = xindex, &bslash;&n;  .info = snd_sonicvibes_info_double, &bslash;&n;  .get = snd_sonicvibes_get_double, .put = snd_sonicvibes_put_double, &bslash;&n;  .private_value = left_reg | (right_reg &lt;&lt; 8) | (shift_left &lt;&lt; 16) | (shift_right &lt;&lt; 19) | (mask &lt;&lt; 24) | (invert &lt;&lt; 22) }
DECL|function|snd_sonicvibes_info_double
r_static
r_int
id|snd_sonicvibes_info_double
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|mask
op_eq
l_int|1
ques
c_cond
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:colon
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
id|mask
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_get_double
r_static
r_int
id|snd_sonicvibes_get_double
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|left_reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|right_reg
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift_left
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0x07
suffix:semicolon
r_int
id|shift_right
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|19
)paren
op_amp
l_int|0x07
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|22
)paren
op_amp
l_int|1
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|snd_sonicvibes_in1
c_func
(paren
id|sonic
comma
id|left_reg
)paren
op_rshift
id|shift_left
)paren
op_amp
id|mask
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
(paren
id|snd_sonicvibes_in1
c_func
(paren
id|sonic
comma
id|right_reg
)paren
op_rshift
id|shift_right
)paren
op_amp
id|mask
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
(brace
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|mask
op_minus
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
id|mask
op_minus
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_put_double
r_static
r_int
id|snd_sonicvibes_put_double
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|left_reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|right_reg
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift_left
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0x07
suffix:semicolon
r_int
id|shift_right
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|19
)paren
op_amp
l_int|0x07
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|22
)paren
op_amp
l_int|1
suffix:semicolon
r_int
id|change
suffix:semicolon
r_int
r_int
id|val1
comma
id|val2
comma
id|oval1
comma
id|oval2
suffix:semicolon
id|val1
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
id|mask
suffix:semicolon
id|val2
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_amp
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
(brace
id|val1
op_assign
id|mask
op_minus
id|val1
suffix:semicolon
id|val2
op_assign
id|mask
op_minus
id|val2
suffix:semicolon
)brace
id|val1
op_lshift_assign
id|shift_left
suffix:semicolon
id|val2
op_lshift_assign
id|shift_right
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|oval1
op_assign
id|snd_sonicvibes_in1
c_func
(paren
id|sonic
comma
id|left_reg
)paren
suffix:semicolon
id|oval2
op_assign
id|snd_sonicvibes_in1
c_func
(paren
id|sonic
comma
id|right_reg
)paren
suffix:semicolon
id|val1
op_assign
(paren
id|oval1
op_amp
op_complement
(paren
id|mask
op_lshift
id|shift_left
)paren
)paren
op_or
id|val1
suffix:semicolon
id|val2
op_assign
(paren
id|oval2
op_amp
op_complement
(paren
id|mask
op_lshift
id|shift_right
)paren
)paren
op_or
id|val2
suffix:semicolon
id|change
op_assign
id|val1
op_ne
id|oval1
op_logical_or
id|val2
op_ne
id|oval2
suffix:semicolon
id|snd_sonicvibes_out1
c_func
(paren
id|sonic
comma
id|left_reg
comma
id|val1
)paren
suffix:semicolon
id|snd_sonicvibes_out1
c_func
(paren
id|sonic
comma
id|right_reg
comma
id|val2
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|macro|SONICVIBES_CONTROLS
mdefine_line|#define SONICVIBES_CONTROLS (sizeof(snd_sonicvibes_controls)/sizeof(snd_kcontrol_new_t))
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_sonicvibes_controls
(braket
)braket
id|__devinitdata
op_assign
(brace
id|SONICVIBES_DOUBLE
c_func
(paren
l_string|&quot;Capture Volume&quot;
comma
l_int|0
comma
id|SV_IREG_LEFT_ADC
comma
id|SV_IREG_RIGHT_ADC
comma
l_int|0
comma
l_int|0
comma
l_int|15
comma
l_int|0
)paren
comma
id|SONICVIBES_DOUBLE
c_func
(paren
l_string|&quot;Aux Playback Switch&quot;
comma
l_int|0
comma
id|SV_IREG_LEFT_AUX1
comma
id|SV_IREG_RIGHT_AUX1
comma
l_int|7
comma
l_int|7
comma
l_int|1
comma
l_int|1
)paren
comma
id|SONICVIBES_DOUBLE
c_func
(paren
l_string|&quot;Aux Playback Volume&quot;
comma
l_int|0
comma
id|SV_IREG_LEFT_AUX1
comma
id|SV_IREG_RIGHT_AUX1
comma
l_int|0
comma
l_int|0
comma
l_int|31
comma
l_int|1
)paren
comma
id|SONICVIBES_DOUBLE
c_func
(paren
l_string|&quot;CD Playback Switch&quot;
comma
l_int|0
comma
id|SV_IREG_LEFT_CD
comma
id|SV_IREG_RIGHT_CD
comma
l_int|7
comma
l_int|7
comma
l_int|1
comma
l_int|1
)paren
comma
id|SONICVIBES_DOUBLE
c_func
(paren
l_string|&quot;CD Playback Volume&quot;
comma
l_int|0
comma
id|SV_IREG_LEFT_CD
comma
id|SV_IREG_RIGHT_CD
comma
l_int|0
comma
l_int|0
comma
l_int|31
comma
l_int|1
)paren
comma
id|SONICVIBES_DOUBLE
c_func
(paren
l_string|&quot;Line Playback Switch&quot;
comma
l_int|0
comma
id|SV_IREG_LEFT_LINE
comma
id|SV_IREG_RIGHT_LINE
comma
l_int|7
comma
l_int|7
comma
l_int|1
comma
l_int|1
)paren
comma
id|SONICVIBES_DOUBLE
c_func
(paren
l_string|&quot;Line Playback Volume&quot;
comma
l_int|0
comma
id|SV_IREG_LEFT_LINE
comma
id|SV_IREG_RIGHT_LINE
comma
l_int|0
comma
l_int|0
comma
l_int|31
comma
l_int|1
)paren
comma
id|SONICVIBES_SINGLE
c_func
(paren
l_string|&quot;Mic Playback Switch&quot;
comma
l_int|0
comma
id|SV_IREG_MIC
comma
l_int|7
comma
l_int|1
comma
l_int|1
)paren
comma
id|SONICVIBES_SINGLE
c_func
(paren
l_string|&quot;Mic Playback Volume&quot;
comma
l_int|0
comma
id|SV_IREG_MIC
comma
l_int|0
comma
l_int|15
comma
l_int|1
)paren
comma
id|SONICVIBES_SINGLE
c_func
(paren
l_string|&quot;Mic Boost&quot;
comma
l_int|0
comma
id|SV_IREG_LEFT_ADC
comma
l_int|4
comma
l_int|1
comma
l_int|0
)paren
comma
id|SONICVIBES_DOUBLE
c_func
(paren
l_string|&quot;Synth Playback Switch&quot;
comma
l_int|0
comma
id|SV_IREG_LEFT_SYNTH
comma
id|SV_IREG_RIGHT_SYNTH
comma
l_int|7
comma
l_int|7
comma
l_int|1
comma
l_int|1
)paren
comma
id|SONICVIBES_DOUBLE
c_func
(paren
l_string|&quot;Synth Playback Volume&quot;
comma
l_int|0
comma
id|SV_IREG_LEFT_SYNTH
comma
id|SV_IREG_RIGHT_SYNTH
comma
l_int|0
comma
l_int|0
comma
l_int|31
comma
l_int|1
)paren
comma
id|SONICVIBES_DOUBLE
c_func
(paren
l_string|&quot;Aux Playback Switch&quot;
comma
l_int|1
comma
id|SV_IREG_LEFT_AUX2
comma
id|SV_IREG_RIGHT_AUX2
comma
l_int|7
comma
l_int|7
comma
l_int|1
comma
l_int|1
)paren
comma
id|SONICVIBES_DOUBLE
c_func
(paren
l_string|&quot;Aux Playback Volume&quot;
comma
l_int|1
comma
id|SV_IREG_LEFT_AUX2
comma
id|SV_IREG_RIGHT_AUX2
comma
l_int|0
comma
l_int|0
comma
l_int|31
comma
l_int|1
)paren
comma
id|SONICVIBES_DOUBLE
c_func
(paren
l_string|&quot;Master Playback Switch&quot;
comma
l_int|0
comma
id|SV_IREG_LEFT_ANALOG
comma
id|SV_IREG_RIGHT_ANALOG
comma
l_int|7
comma
l_int|7
comma
l_int|1
comma
l_int|1
)paren
comma
id|SONICVIBES_DOUBLE
c_func
(paren
l_string|&quot;Master Playback Volume&quot;
comma
l_int|0
comma
id|SV_IREG_LEFT_ANALOG
comma
id|SV_IREG_RIGHT_ANALOG
comma
l_int|0
comma
l_int|0
comma
l_int|31
comma
l_int|1
)paren
comma
id|SONICVIBES_DOUBLE
c_func
(paren
l_string|&quot;PCM Playback Switch&quot;
comma
l_int|0
comma
id|SV_IREG_LEFT_PCM
comma
id|SV_IREG_RIGHT_PCM
comma
l_int|7
comma
l_int|7
comma
l_int|1
comma
l_int|1
)paren
comma
id|SONICVIBES_DOUBLE
c_func
(paren
l_string|&quot;PCM Playback Volume&quot;
comma
l_int|0
comma
id|SV_IREG_LEFT_PCM
comma
id|SV_IREG_RIGHT_PCM
comma
l_int|0
comma
l_int|0
comma
l_int|63
comma
l_int|1
)paren
comma
id|SONICVIBES_SINGLE
c_func
(paren
l_string|&quot;Loopback Capture Switch&quot;
comma
l_int|0
comma
id|SV_IREG_ADC_OUTPUT_CTRL
comma
l_int|0
comma
l_int|1
comma
l_int|0
)paren
comma
id|SONICVIBES_SINGLE
c_func
(paren
l_string|&quot;Loopback Capture Volume&quot;
comma
l_int|0
comma
id|SV_IREG_ADC_OUTPUT_CTRL
comma
l_int|2
comma
l_int|63
comma
l_int|1
)paren
comma
id|SONICVIBES_MUX
c_func
(paren
l_string|&quot;Capture Source&quot;
comma
l_int|0
)paren
)brace
suffix:semicolon
DECL|function|snd_sonicvibes_master_free
r_static
r_void
id|snd_sonicvibes_master_free
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_magic_cast
c_func
(paren
id|sonicvibes_t
comma
id|_snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
comma
r_return
)paren
suffix:semicolon
id|sonic-&gt;master_mute
op_assign
l_int|NULL
suffix:semicolon
id|sonic-&gt;master_volume
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_mixer
r_static
r_int
id|__devinit
id|snd_sonicvibes_mixer
c_func
(paren
id|sonicvibes_t
op_star
id|sonic
)paren
(brace
id|snd_card_t
op_star
id|card
suffix:semicolon
id|snd_kcontrol_t
op_star
id|kctl
suffix:semicolon
r_int
r_int
id|idx
suffix:semicolon
r_int
id|err
suffix:semicolon
id|snd_assert
c_func
(paren
id|sonic
op_ne
l_int|NULL
op_logical_and
id|sonic-&gt;card
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|card
op_assign
id|sonic-&gt;card
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;mixername
comma
l_string|&quot;S3 SonicVibes&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|SONICVIBES_CONTROLS
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_sonicvibes_controls
(braket
id|idx
)braket
comma
id|sonic
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_switch
c_cond
(paren
id|idx
)paren
(brace
r_case
l_int|0
suffix:colon
r_case
l_int|1
suffix:colon
id|kctl-&gt;private_free
op_assign
id|snd_sonicvibes_master_free
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&n; */
DECL|function|snd_sonicvibes_proc_read
r_static
r_void
id|snd_sonicvibes_proc_read
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_magic_cast
c_func
(paren
id|sonicvibes_t
comma
id|entry-&gt;private_data
comma
r_return
)paren
suffix:semicolon
r_int
r_char
id|tmp
suffix:semicolon
id|tmp
op_assign
id|sonic-&gt;srs_space
op_amp
l_int|0x0f
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;SRS 3D           : %s&bslash;n&quot;
comma
id|sonic-&gt;srs_space
op_amp
l_int|0x80
ques
c_cond
l_string|&quot;off&quot;
suffix:colon
l_string|&quot;on&quot;
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;SRS Space        : %s&bslash;n&quot;
comma
id|tmp
op_eq
l_int|0x00
ques
c_cond
l_string|&quot;100%&quot;
suffix:colon
id|tmp
op_eq
l_int|0x01
ques
c_cond
l_string|&quot;75%&quot;
suffix:colon
id|tmp
op_eq
l_int|0x02
ques
c_cond
l_string|&quot;50%&quot;
suffix:colon
id|tmp
op_eq
l_int|0x03
ques
c_cond
l_string|&quot;25%&quot;
suffix:colon
l_string|&quot;0%&quot;
)paren
suffix:semicolon
id|tmp
op_assign
id|sonic-&gt;srs_center
op_amp
l_int|0x0f
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;SRS Center       : %s&bslash;n&quot;
comma
id|tmp
op_eq
l_int|0x00
ques
c_cond
l_string|&quot;100%&quot;
suffix:colon
id|tmp
op_eq
l_int|0x01
ques
c_cond
l_string|&quot;75%&quot;
suffix:colon
id|tmp
op_eq
l_int|0x02
ques
c_cond
l_string|&quot;50%&quot;
suffix:colon
id|tmp
op_eq
l_int|0x03
ques
c_cond
l_string|&quot;25%&quot;
suffix:colon
l_string|&quot;0%&quot;
)paren
suffix:semicolon
id|tmp
op_assign
id|sonic-&gt;wave_source
op_amp
l_int|0x03
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;WaveTable Source : %s&bslash;n&quot;
comma
id|tmp
op_eq
l_int|0x00
ques
c_cond
l_string|&quot;on-board ROM&quot;
suffix:colon
id|tmp
op_eq
l_int|0x01
ques
c_cond
l_string|&quot;PCI bus&quot;
suffix:colon
l_string|&quot;on-board ROM + PCI bus&quot;
)paren
suffix:semicolon
id|tmp
op_assign
id|sonic-&gt;mpu_switch
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Onboard synth    : %s&bslash;n&quot;
comma
id|tmp
op_amp
l_int|0x01
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Ext. Rx to synth : %s&bslash;n&quot;
comma
id|tmp
op_amp
l_int|0x02
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;MIDI to ext. Tx  : %s&bslash;n&quot;
comma
id|tmp
op_amp
l_int|0x04
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
)paren
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_proc_init
r_static
r_void
id|__devinit
id|snd_sonicvibes_proc_init
c_func
(paren
id|sonicvibes_t
op_star
id|sonic
)paren
(brace
id|snd_info_entry_t
op_star
id|entry
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_card_proc_new
c_func
(paren
id|sonic-&gt;card
comma
l_string|&quot;sonicvibes&quot;
comma
op_amp
id|entry
)paren
)paren
id|snd_info_set_text_ops
c_func
(paren
id|entry
comma
id|sonic
comma
l_int|1024
comma
id|snd_sonicvibes_proc_read
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&n; */
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_sonicvibes_game_control
id|__devinitdata
op_assign
id|SONICVIBES_SINGLE
c_func
(paren
l_string|&quot;Joystick Speed&quot;
comma
l_int|0
comma
id|SV_IREG_GAME_PORT
comma
l_int|1
comma
l_int|15
comma
l_int|0
)paren
suffix:semicolon
DECL|function|snd_sonicvibes_free
r_static
r_int
id|snd_sonicvibes_free
c_func
(paren
id|sonicvibes_t
op_star
id|sonic
)paren
(brace
macro_line|#if defined(CONFIG_GAMEPORT) || (defined(MODULE) &amp;&amp; defined(CONFIG_GAMEPORT_MODULE))
r_if
c_cond
(paren
id|sonic-&gt;gameport.io
)paren
id|gameport_unregister_port
c_func
(paren
op_amp
id|sonic-&gt;gameport
)paren
suffix:semicolon
macro_line|#endif
id|pci_write_config_dword
c_func
(paren
id|sonic-&gt;pci
comma
l_int|0x40
comma
id|sonic-&gt;dmaa_port
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|sonic-&gt;pci
comma
l_int|0x48
comma
id|sonic-&gt;dmac_port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sonic-&gt;res_sb_port
)paren
(brace
id|release_resource
c_func
(paren
id|sonic-&gt;res_sb_port
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|sonic-&gt;res_sb_port
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sonic-&gt;res_enh_port
)paren
(brace
id|release_resource
c_func
(paren
id|sonic-&gt;res_enh_port
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|sonic-&gt;res_enh_port
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sonic-&gt;res_synth_port
)paren
(brace
id|release_resource
c_func
(paren
id|sonic-&gt;res_synth_port
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|sonic-&gt;res_synth_port
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sonic-&gt;res_midi_port
)paren
(brace
id|release_resource
c_func
(paren
id|sonic-&gt;res_midi_port
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|sonic-&gt;res_midi_port
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sonic-&gt;res_dmaa
)paren
(brace
id|release_resource
c_func
(paren
id|sonic-&gt;res_dmaa
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|sonic-&gt;res_dmaa
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sonic-&gt;res_dmac
)paren
(brace
id|release_resource
c_func
(paren
id|sonic-&gt;res_dmac
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|sonic-&gt;res_dmac
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sonic-&gt;irq
op_ge
l_int|0
)paren
id|free_irq
c_func
(paren
id|sonic-&gt;irq
comma
(paren
r_void
op_star
)paren
id|sonic
)paren
suffix:semicolon
id|snd_magic_kfree
c_func
(paren
id|sonic
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_dev_free
r_static
r_int
id|snd_sonicvibes_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_magic_cast
c_func
(paren
id|sonicvibes_t
comma
id|device-&gt;device_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_return
id|snd_sonicvibes_free
c_func
(paren
id|sonic
)paren
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_create
r_static
r_int
id|__devinit
id|snd_sonicvibes_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_struct
id|pci_dev
op_star
id|pci
comma
r_int
id|reverb
comma
r_int
id|mge
comma
id|sonicvibes_t
op_star
op_star
id|rsonic
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
suffix:semicolon
r_int
r_int
id|dmaa
comma
id|dmac
suffix:semicolon
r_int
id|err
suffix:semicolon
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
dot
id|dev_free
op_assign
id|snd_sonicvibes_dev_free
comma
)brace
suffix:semicolon
op_star
id|rsonic
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* enable PCI device */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pci
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* check, if we can restrict PCI DMA transfers to 24 bits */
r_if
c_cond
(paren
id|pci_set_dma_mask
c_func
(paren
id|pci
comma
l_int|0x00ffffff
)paren
OL
l_int|0
op_logical_or
id|pci_set_consistent_dma_mask
c_func
(paren
id|pci
comma
l_int|0x00ffffff
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;architecture does not support 24bit PCI busmaster DMA&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
id|sonic
op_assign
id|snd_magic_kcalloc
c_func
(paren
id|sonicvibes_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sonic
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|sonic-&gt;reg_lock
)paren
suffix:semicolon
id|sonic-&gt;card
op_assign
id|card
suffix:semicolon
id|sonic-&gt;pci
op_assign
id|pci
suffix:semicolon
id|sonic-&gt;irq
op_assign
op_minus
l_int|1
suffix:semicolon
id|sonic-&gt;sb_port
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sonic-&gt;res_sb_port
op_assign
id|request_region
c_func
(paren
id|sonic-&gt;sb_port
comma
l_int|0x10
comma
l_string|&quot;S3 SonicVibes SB&quot;
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab SB port at 0x%lx-0x%lx&bslash;n&quot;
comma
id|sonic-&gt;sb_port
comma
id|sonic-&gt;sb_port
op_plus
l_int|0x10
op_minus
l_int|1
)paren
suffix:semicolon
id|snd_sonicvibes_free
c_func
(paren
id|sonic
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|sonic-&gt;enh_port
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sonic-&gt;res_enh_port
op_assign
id|request_region
c_func
(paren
id|sonic-&gt;enh_port
comma
l_int|0x10
comma
l_string|&quot;S3 SonicVibes Enhanced&quot;
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab PCM port at 0x%lx-0x%lx&bslash;n&quot;
comma
id|sonic-&gt;enh_port
comma
id|sonic-&gt;enh_port
op_plus
l_int|0x10
op_minus
l_int|1
)paren
suffix:semicolon
id|snd_sonicvibes_free
c_func
(paren
id|sonic
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|sonic-&gt;synth_port
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sonic-&gt;res_synth_port
op_assign
id|request_region
c_func
(paren
id|sonic-&gt;synth_port
comma
l_int|4
comma
l_string|&quot;S3 SonicVibes Synth&quot;
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab synth port at 0x%lx-0x%lx&bslash;n&quot;
comma
id|sonic-&gt;synth_port
comma
id|sonic-&gt;synth_port
op_plus
l_int|4
op_minus
l_int|1
)paren
suffix:semicolon
id|snd_sonicvibes_free
c_func
(paren
id|sonic
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|sonic-&gt;midi_port
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sonic-&gt;res_midi_port
op_assign
id|request_region
c_func
(paren
id|sonic-&gt;midi_port
comma
l_int|4
comma
l_string|&quot;S3 SonicVibes Midi&quot;
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab MIDI port at 0x%lx-0x%lx&bslash;n&quot;
comma
id|sonic-&gt;midi_port
comma
id|sonic-&gt;midi_port
op_plus
l_int|4
op_minus
l_int|1
)paren
suffix:semicolon
id|snd_sonicvibes_free
c_func
(paren
id|sonic
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|sonic-&gt;game_port
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|pci-&gt;irq
comma
id|snd_sonicvibes_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
l_string|&quot;S3 SonicVibes&quot;
comma
(paren
r_void
op_star
)paren
id|sonic
)paren
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab IRQ %d&bslash;n&quot;
comma
id|pci-&gt;irq
)paren
suffix:semicolon
id|snd_sonicvibes_free
c_func
(paren
id|sonic
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|sonic-&gt;irq
op_assign
id|pci-&gt;irq
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|pci
comma
l_int|0x40
comma
op_amp
id|dmaa
)paren
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|pci
comma
l_int|0x48
comma
op_amp
id|dmac
)paren
suffix:semicolon
id|dmaio
op_and_assign
op_complement
l_int|0x0f
suffix:semicolon
id|dmaa
op_and_assign
op_complement
l_int|0x0f
suffix:semicolon
id|dmac
op_and_assign
op_complement
l_int|0x0f
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dmaa
)paren
(brace
id|dmaa
op_assign
id|dmaio
suffix:semicolon
id|dmaio
op_add_assign
l_int|0x10
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;BIOS did not allocate DDMA channel A i/o, allocated at 0x%x&bslash;n&quot;
comma
id|dmaa
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|dmac
)paren
(brace
id|dmac
op_assign
id|dmaio
suffix:semicolon
id|dmaio
op_add_assign
l_int|0x10
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;BIOS did not allocate DDMA channel C i/o, allocated at 0x%x&bslash;n&quot;
comma
id|dmac
)paren
suffix:semicolon
)brace
id|pci_write_config_dword
c_func
(paren
id|pci
comma
l_int|0x40
comma
id|dmaa
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pci
comma
l_int|0x48
comma
id|dmac
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sonic-&gt;res_dmaa
op_assign
id|request_region
c_func
(paren
id|dmaa
comma
l_int|0x10
comma
l_string|&quot;S3 SonicVibes DDMA-A&quot;
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_sonicvibes_free
c_func
(paren
id|sonic
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab DDMA-A port at 0x%x-0x%x&bslash;n&quot;
comma
id|dmaa
comma
id|dmaa
op_plus
l_int|0x10
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sonic-&gt;res_dmac
op_assign
id|request_region
c_func
(paren
id|dmac
comma
l_int|0x10
comma
l_string|&quot;S3 SonicVibes DDMA-C&quot;
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_sonicvibes_free
c_func
(paren
id|sonic
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab DDMA-C port at 0x%x-0x%x&bslash;n&quot;
comma
id|dmac
comma
id|dmac
op_plus
l_int|0x10
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|pci_read_config_dword
c_func
(paren
id|pci
comma
l_int|0x40
comma
op_amp
id|sonic-&gt;dmaa_port
)paren
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|pci
comma
l_int|0x48
comma
op_amp
id|sonic-&gt;dmac_port
)paren
suffix:semicolon
id|sonic-&gt;dmaa_port
op_and_assign
op_complement
l_int|0x0f
suffix:semicolon
id|sonic-&gt;dmac_port
op_and_assign
op_complement
l_int|0x0f
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pci
comma
l_int|0x40
comma
id|sonic-&gt;dmaa_port
op_or
l_int|9
)paren
suffix:semicolon
multiline_comment|/* enable + enhanced */
id|pci_write_config_dword
c_func
(paren
id|pci
comma
l_int|0x48
comma
id|sonic-&gt;dmac_port
op_or
l_int|9
)paren
suffix:semicolon
multiline_comment|/* enable */
multiline_comment|/* ok.. initialize S3 SonicVibes chip */
id|outb
c_func
(paren
id|SV_RESET
comma
id|SV_REG
c_func
(paren
id|sonic
comma
id|CONTROL
)paren
)paren
suffix:semicolon
multiline_comment|/* reset chip */
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|SV_REG
c_func
(paren
id|sonic
comma
id|CONTROL
)paren
)paren
suffix:semicolon
multiline_comment|/* release reset */
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|outb
c_func
(paren
id|SV_ENHANCED
op_or
id|SV_INTA
op_or
(paren
id|reverb
ques
c_cond
id|SV_REVERB
suffix:colon
l_int|0
)paren
comma
id|SV_REG
c_func
(paren
id|sonic
comma
id|CONTROL
)paren
)paren
suffix:semicolon
id|inb
c_func
(paren
id|SV_REG
c_func
(paren
id|sonic
comma
id|STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* clear IRQs */
macro_line|#if 1
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_DRIVE_CTRL
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* drive current 16mA */
macro_line|#else
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_DRIVE_CTRL
comma
l_int|0x40
)paren
suffix:semicolon
multiline_comment|/* drive current 8mA */
macro_line|#endif
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_PC_ENABLE
comma
id|sonic-&gt;enable
op_assign
l_int|0
)paren
suffix:semicolon
multiline_comment|/* disable playback &amp; capture */
id|outb
c_func
(paren
id|sonic-&gt;irqmask
op_assign
op_complement
(paren
id|SV_DMAA_MASK
op_or
id|SV_DMAC_MASK
op_or
id|SV_UD_MASK
)paren
comma
id|SV_REG
c_func
(paren
id|sonic
comma
id|IRQMASK
)paren
)paren
suffix:semicolon
id|inb
c_func
(paren
id|SV_REG
c_func
(paren
id|sonic
comma
id|STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* clear IRQs */
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_ADC_CLOCK
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* use PLL as clock source */
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_ANALOG_POWER
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* power up analog parts */
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_DIGITAL_POWER
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* power up digital parts */
id|snd_sonicvibes_setpll
c_func
(paren
id|sonic
comma
id|SV_IREG_ADC_PLL
comma
l_int|8000
)paren
suffix:semicolon
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_SRS_SPACE
comma
id|sonic-&gt;srs_space
op_assign
l_int|0x80
)paren
suffix:semicolon
multiline_comment|/* SRS space off */
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_SRS_CENTER
comma
id|sonic-&gt;srs_center
op_assign
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* SRS center off */
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_MPU401
comma
id|sonic-&gt;mpu_switch
op_assign
l_int|0x05
)paren
suffix:semicolon
multiline_comment|/* MPU-401 switch */
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_WAVE_SOURCE
comma
id|sonic-&gt;wave_source
op_assign
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* onboard ROM */
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_PCM_RATE_LOW
comma
(paren
l_int|8000
op_star
l_int|65536
op_div
id|SV_FULLRATE
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_PCM_RATE_HIGH
comma
(paren
(paren
l_int|8000
op_star
l_int|65536
op_div
id|SV_FULLRATE
)paren
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_LEFT_ADC
comma
id|mge
ques
c_cond
l_int|0xd0
suffix:colon
l_int|0xc0
)paren
suffix:semicolon
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_RIGHT_ADC
comma
l_int|0xc0
)paren
suffix:semicolon
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_LEFT_AUX1
comma
l_int|0x9f
)paren
suffix:semicolon
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_RIGHT_AUX1
comma
l_int|0x9f
)paren
suffix:semicolon
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_LEFT_CD
comma
l_int|0x9f
)paren
suffix:semicolon
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_RIGHT_CD
comma
l_int|0x9f
)paren
suffix:semicolon
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_LEFT_LINE
comma
l_int|0x9f
)paren
suffix:semicolon
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_RIGHT_LINE
comma
l_int|0x9f
)paren
suffix:semicolon
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_MIC
comma
l_int|0x8f
)paren
suffix:semicolon
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_LEFT_SYNTH
comma
l_int|0x9f
)paren
suffix:semicolon
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_RIGHT_SYNTH
comma
l_int|0x9f
)paren
suffix:semicolon
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_LEFT_AUX2
comma
l_int|0x9f
)paren
suffix:semicolon
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_RIGHT_AUX2
comma
l_int|0x9f
)paren
suffix:semicolon
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_LEFT_ANALOG
comma
l_int|0x9f
)paren
suffix:semicolon
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_RIGHT_ANALOG
comma
l_int|0x9f
)paren
suffix:semicolon
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_LEFT_PCM
comma
l_int|0xbf
)paren
suffix:semicolon
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_RIGHT_PCM
comma
l_int|0xbf
)paren
suffix:semicolon
id|snd_sonicvibes_out
c_func
(paren
id|sonic
comma
id|SV_IREG_ADC_OUTPUT_CTRL
comma
l_int|0xfc
)paren
suffix:semicolon
macro_line|#if 0
id|snd_sonicvibes_debug
c_func
(paren
id|sonic
)paren
suffix:semicolon
macro_line|#endif
id|sonic-&gt;revision
op_assign
id|snd_sonicvibes_in
c_func
(paren
id|sonic
comma
id|SV_IREG_REVISION
)paren
suffix:semicolon
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_sonicvibes_game_control
comma
id|sonic
)paren
)paren
suffix:semicolon
id|snd_sonicvibes_proc_init
c_func
(paren
id|sonic
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|sonic
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_sonicvibes_free
c_func
(paren
id|sonic
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|snd_card_set_dev
c_func
(paren
id|card
comma
op_amp
id|pci-&gt;dev
)paren
suffix:semicolon
op_star
id|rsonic
op_assign
id|sonic
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  MIDI section&n; */
DECL|macro|SONICVIBES_MIDI_CONTROLS
mdefine_line|#define SONICVIBES_MIDI_CONTROLS (sizeof(snd_sonicvibes_midi_controls)/sizeof(snd_kcontrol_new_t))
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_sonicvibes_midi_controls
(braket
)braket
id|__devinitdata
op_assign
(brace
id|SONICVIBES_SINGLE
c_func
(paren
l_string|&quot;SonicVibes Wave Source RAM&quot;
comma
l_int|0
comma
id|SV_IREG_WAVE_SOURCE
comma
l_int|0
comma
l_int|1
comma
l_int|0
)paren
comma
id|SONICVIBES_SINGLE
c_func
(paren
l_string|&quot;SonicVibes Wave Source RAM+ROM&quot;
comma
l_int|0
comma
id|SV_IREG_WAVE_SOURCE
comma
l_int|1
comma
l_int|1
comma
l_int|0
)paren
comma
id|SONICVIBES_SINGLE
c_func
(paren
l_string|&quot;SonicVibes Onboard Synth&quot;
comma
l_int|0
comma
id|SV_IREG_MPU401
comma
l_int|0
comma
l_int|1
comma
l_int|0
)paren
comma
id|SONICVIBES_SINGLE
c_func
(paren
l_string|&quot;SonicVibes External Rx to Synth&quot;
comma
l_int|0
comma
id|SV_IREG_MPU401
comma
l_int|1
comma
l_int|1
comma
l_int|0
)paren
comma
id|SONICVIBES_SINGLE
c_func
(paren
l_string|&quot;SonicVibes External Tx&quot;
comma
l_int|0
comma
id|SV_IREG_MPU401
comma
l_int|2
comma
l_int|1
comma
l_int|0
)paren
)brace
suffix:semicolon
DECL|function|snd_sonicvibes_midi_input_open
r_static
r_int
id|snd_sonicvibes_midi_input_open
c_func
(paren
id|mpu401_t
op_star
id|mpu
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_magic_cast
c_func
(paren
id|sonicvibes_t
comma
id|mpu-&gt;private_data
comma
r_return
op_minus
id|EIO
)paren
suffix:semicolon
id|outb
c_func
(paren
id|sonic-&gt;irqmask
op_and_assign
op_complement
id|SV_MIDI_MASK
comma
id|SV_REG
c_func
(paren
id|sonic
comma
id|IRQMASK
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_midi_input_close
r_static
r_void
id|snd_sonicvibes_midi_input_close
c_func
(paren
id|mpu401_t
op_star
id|mpu
)paren
(brace
id|sonicvibes_t
op_star
id|sonic
op_assign
id|snd_magic_cast
c_func
(paren
id|sonicvibes_t
comma
id|mpu-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|outb
c_func
(paren
id|sonic-&gt;irqmask
op_or_assign
id|SV_MIDI_MASK
comma
id|SV_REG
c_func
(paren
id|sonic
comma
id|IRQMASK
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_sonicvibes_midi
r_static
r_int
id|__devinit
id|snd_sonicvibes_midi
c_func
(paren
id|sonicvibes_t
op_star
id|sonic
comma
id|snd_rawmidi_t
op_star
id|rmidi
)paren
(brace
id|mpu401_t
op_star
id|mpu
op_assign
id|snd_magic_cast
c_func
(paren
id|mpu401_t
comma
id|rmidi-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|snd_card_t
op_star
id|card
op_assign
id|sonic-&gt;card
suffix:semicolon
id|snd_rawmidi_str_t
op_star
id|dir
suffix:semicolon
r_int
r_int
id|idx
suffix:semicolon
r_int
id|err
suffix:semicolon
id|mpu-&gt;private_data
op_assign
id|sonic
suffix:semicolon
id|mpu-&gt;open_input
op_assign
id|snd_sonicvibes_midi_input_open
suffix:semicolon
id|mpu-&gt;close_input
op_assign
id|snd_sonicvibes_midi_input_close
suffix:semicolon
id|dir
op_assign
op_amp
id|rmidi-&gt;streams
(braket
id|SNDRV_RAWMIDI_STREAM_OUTPUT
)braket
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|SONICVIBES_MIDI_CONTROLS
suffix:semicolon
id|idx
op_increment
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_sonicvibes_midi_controls
(braket
id|idx
)braket
comma
id|sonic
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_sonic_probe
r_static
r_int
id|__devinit
id|snd_sonic_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_const
r_struct
id|pci_device_id
op_star
id|pci_id
)paren
(brace
r_static
r_int
id|dev
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
id|sonicvibes_t
op_star
id|sonic
suffix:semicolon
id|snd_rawmidi_t
op_star
id|midi_uart
suffix:semicolon
id|opl3_t
op_star
id|opl3
suffix:semicolon
r_int
id|idx
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_ge
id|SNDRV_CARDS
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|enable
(braket
id|dev
)braket
)paren
(brace
id|dev
op_increment
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|card
op_assign
id|snd_card_new
c_func
(paren
id|index
(braket
id|dev
)braket
comma
id|id
(braket
id|dev
)braket
comma
id|THIS_MODULE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|5
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pci_resource_start
c_func
(paren
id|pci
comma
id|idx
)paren
op_eq
l_int|0
op_logical_or
op_logical_neg
(paren
id|pci_resource_flags
c_func
(paren
id|pci
comma
id|idx
)paren
op_amp
id|IORESOURCE_IO
)paren
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_sonicvibes_create
c_func
(paren
id|card
comma
id|pci
comma
id|reverb
(braket
id|dev
)braket
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
id|mge
(braket
id|dev
)braket
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
op_amp
id|sonic
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;SonicVibes&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;shortname
comma
l_string|&quot;S3 SonicVibes&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;%s rev %i at 0x%lx, irq %i&quot;
comma
id|card-&gt;shortname
comma
id|sonic-&gt;revision
comma
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|1
)paren
comma
id|sonic-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_sonicvibes_pcm
c_func
(paren
id|sonic
comma
l_int|0
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_sonicvibes_mixer
c_func
(paren
id|sonic
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_mpu401_uart_new
c_func
(paren
id|card
comma
l_int|0
comma
id|MPU401_HW_SONICVIBES
comma
id|sonic-&gt;midi_port
comma
l_int|1
comma
id|sonic-&gt;irq
comma
l_int|0
comma
op_amp
id|midi_uart
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|snd_sonicvibes_midi
c_func
(paren
id|sonic
comma
id|midi_uart
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_opl3_create
c_func
(paren
id|card
comma
id|sonic-&gt;synth_port
comma
id|sonic-&gt;synth_port
op_plus
l_int|2
comma
id|OPL3_HW_OPL3_SV
comma
l_int|1
comma
op_amp
id|opl3
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_opl3_hwdep_new
c_func
(paren
id|opl3
comma
l_int|0
comma
l_int|1
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_GAMEPORT) || (defined(MODULE) &amp;&amp; defined(CONFIG_GAMEPORT_MODULE))
id|sonic-&gt;gameport.io
op_assign
id|sonic-&gt;game_port
suffix:semicolon
id|gameport_register_port
c_func
(paren
op_amp
id|sonic-&gt;gameport
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_card_register
c_func
(paren
id|card
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pci
comma
id|card
)paren
suffix:semicolon
id|dev
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_sonic_remove
r_static
r_void
id|__devexit
id|snd_sonic_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
id|snd_card_free
c_func
(paren
id|pci_get_drvdata
c_func
(paren
id|pci
)paren
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|driver
r_static
r_struct
id|pci_driver
id|driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;S3 SonicVibes&quot;
comma
dot
id|id_table
op_assign
id|snd_sonic_ids
comma
dot
id|probe
op_assign
id|snd_sonic_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|snd_sonic_remove
)paren
comma
)brace
suffix:semicolon
DECL|function|alsa_card_sonicvibes_init
r_static
r_int
id|__init
id|alsa_card_sonicvibes_init
c_func
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
DECL|function|alsa_card_sonicvibes_exit
r_static
r_void
id|__exit
id|alsa_card_sonicvibes_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|alsa_card_sonicvibes_init
)paren
id|module_exit
c_func
(paren
id|alsa_card_sonicvibes_exit
)paren
eof
