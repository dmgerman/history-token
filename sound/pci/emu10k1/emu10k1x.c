multiline_comment|/*&n; *  Copyright (c) by Francisco Moraes &lt;fmoraes@nc.rr.com&gt;&n; *  Driver EMU10K1X chips&n; *&n; *  Parts of this code were adapted from audigyls.c driver which is&n; *  Copyright (c) by James Courtier-Dutton &lt;James@superbug.demon.co.uk&gt;&n; *&n; *  BUGS:&n; *    --&n; *&n; *  TODO:&n; *&n; *  Chips (SB0200 model):&n; *    - EMU10K1X-DBQ&n; *    - STAC 9708T&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/initval.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
macro_line|#include &lt;sound/ac97_codec.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#include &lt;sound/rawmidi.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Francisco Moraes &lt;fmoraes@nc.rr.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;EMU10K1X&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_SUPPORTED_DEVICE
c_func
(paren
l_string|&quot;{{Dell Creative Labs,SB Live!}&quot;
)paren
suffix:semicolon
singleline_comment|// module parameters (see &quot;Module Parameters&quot;)
DECL|variable|index
r_static
r_int
id|index
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_IDX
suffix:semicolon
DECL|variable|id
r_static
r_char
op_star
id|id
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_STR
suffix:semicolon
DECL|variable|enable
r_static
r_int
id|enable
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_ENABLE_PNP
suffix:semicolon
id|module_param_array
c_func
(paren
id|index
comma
r_int
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|index
comma
l_string|&quot;Index value for the EMU10K1X soundcard.&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|id
comma
id|charp
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|id
comma
l_string|&quot;ID string for the EMU10K1X soundcard.&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|enable
comma
r_bool
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|enable
comma
l_string|&quot;Enable the EMU10K1X soundcard.&quot;
)paren
suffix:semicolon
singleline_comment|// some definitions were borrowed from emu10k1 driver as they seem to be the same
multiline_comment|/************************************************************************************************/
multiline_comment|/* PCI function 0 registers, address = &lt;val&gt; + PCIBASE0&t;&t;&t;&t;&t;&t;*/
multiline_comment|/************************************************************************************************/
DECL|macro|PTR
mdefine_line|#define PTR&t;&t;&t;0x00&t;&t;/* Indexed register set pointer register&t;*/
multiline_comment|/* NOTE: The CHANNELNUM and ADDRESS words can&t;*/
multiline_comment|/* be modified independently of each other.&t;*/
DECL|macro|DATA
mdefine_line|#define DATA&t;&t;&t;0x04&t;&t;/* Indexed register set data register&t;&t;*/
DECL|macro|IPR
mdefine_line|#define IPR&t;&t;&t;0x08&t;&t;/* Global interrupt pending register&t;&t;*/
multiline_comment|/* Clear pending interrupts by writing a 1 to&t;*/
multiline_comment|/* the relevant bits and zero to the other bits&t;*/
DECL|macro|IPR_MIDITRANSBUFEMPTY
mdefine_line|#define IPR_MIDITRANSBUFEMPTY   0x00000001&t;/* MIDI UART transmit buffer empty&t;&t;*/
DECL|macro|IPR_MIDIRECVBUFEMPTY
mdefine_line|#define IPR_MIDIRECVBUFEMPTY    0x00000002&t;/* MIDI UART receive buffer empty&t;&t;*/
DECL|macro|IPR_CH_0_LOOP
mdefine_line|#define IPR_CH_0_LOOP           0x00000800      /* Channel 0 loop                               */
DECL|macro|IPR_CH_0_HALF_LOOP
mdefine_line|#define IPR_CH_0_HALF_LOOP      0x00000100      /* Channel 0 half loop                          */
DECL|macro|IPR_CAP_0_LOOP
mdefine_line|#define IPR_CAP_0_LOOP          0x00080000      /* Channel capture loop                         */
DECL|macro|IPR_CAP_0_HALF_LOOP
mdefine_line|#define IPR_CAP_0_HALF_LOOP     0x00010000      /* Channel capture half loop                    */
DECL|macro|INTE
mdefine_line|#define INTE&t;&t;&t;0x0c&t;&t;/* Interrupt enable register&t;&t;&t;*/
DECL|macro|INTE_MIDITXENABLE
mdefine_line|#define INTE_MIDITXENABLE       0x00000001&t;/* Enable MIDI transmit-buffer-empty interrupts&t;*/
DECL|macro|INTE_MIDIRXENABLE
mdefine_line|#define INTE_MIDIRXENABLE       0x00000002&t;/* Enable MIDI receive-buffer-empty interrupts&t;*/
DECL|macro|INTE_CH_0_LOOP
mdefine_line|#define INTE_CH_0_LOOP          0x00000800      /* Channel 0 loop                               */
DECL|macro|INTE_CH_0_HALF_LOOP
mdefine_line|#define INTE_CH_0_HALF_LOOP     0x00000100      /* Channel 0 half loop                          */
DECL|macro|INTE_CAP_0_LOOP
mdefine_line|#define INTE_CAP_0_LOOP         0x00080000      /* Channel capture loop                         */
DECL|macro|INTE_CAP_0_HALF_LOOP
mdefine_line|#define INTE_CAP_0_HALF_LOOP    0x00010000      /* Channel capture half loop                    */
DECL|macro|HCFG
mdefine_line|#define HCFG&t;&t;&t;0x14&t;&t;/* Hardware config register&t;&t;&t;*/
DECL|macro|HCFG_LOCKSOUNDCACHE
mdefine_line|#define HCFG_LOCKSOUNDCACHE&t;0x00000008&t;/* 1 = Cancel bustmaster accesses to soundcache */
multiline_comment|/* NOTE: This should generally never be used.  &t;*/
DECL|macro|HCFG_AUDIOENABLE
mdefine_line|#define HCFG_AUDIOENABLE&t;0x00000001&t;/* 0 = CODECs transmit zero-valued samples&t;*/
multiline_comment|/* Should be set to 1 when the EMU10K1 is&t;*/
multiline_comment|/* completely initialized.&t;&t;&t;*/
DECL|macro|GPIO
mdefine_line|#define GPIO&t;&t;&t;0x18&t;&t;/* Defaults: 00001080-Analog, 00001000-SPDIF.   */
DECL|macro|AC97DATA
mdefine_line|#define AC97DATA&t;&t;0x1c&t;&t;/* AC97 register set data register (16 bit)&t;*/
DECL|macro|AC97ADDRESS
mdefine_line|#define AC97ADDRESS&t;&t;0x1e&t;&t;/* AC97 register set address register (8 bit)&t;*/
multiline_comment|/********************************************************************************************************/
multiline_comment|/* Emu10k1x pointer-offset register set, accessed through the PTR and DATA registers&t;&t;&t;*/
multiline_comment|/********************************************************************************************************/
DECL|macro|PLAYBACK_LIST_ADDR
mdefine_line|#define PLAYBACK_LIST_ADDR&t;0x00&t;&t;/* Base DMA address of a list of pointers to each period/size */
multiline_comment|/* One list entry: 4 bytes for DMA address, &n;&t;&t;&t;&t;&t;&t; * 4 bytes for period_size &lt;&lt; 16.&n;&t;&t;&t;&t;&t;&t; * One list entry is 8 bytes long.&n;&t;&t;&t;&t;&t;&t; * One list entry for each period in the buffer.&n;&t;&t;&t;&t;&t;&t; */
DECL|macro|PLAYBACK_LIST_SIZE
mdefine_line|#define PLAYBACK_LIST_SIZE&t;0x01&t;&t;/* Size of list in bytes &lt;&lt; 16. E.g. 8 periods -&gt; 0x00380000  */
DECL|macro|PLAYBACK_LIST_PTR
mdefine_line|#define PLAYBACK_LIST_PTR&t;0x02&t;&t;/* Pointer to the current period being played */
DECL|macro|PLAYBACK_DMA_ADDR
mdefine_line|#define PLAYBACK_DMA_ADDR&t;0x04&t;&t;/* Playback DMA addresss */
DECL|macro|PLAYBACK_PERIOD_SIZE
mdefine_line|#define PLAYBACK_PERIOD_SIZE&t;0x05&t;&t;/* Playback period size */
DECL|macro|PLAYBACK_POINTER
mdefine_line|#define PLAYBACK_POINTER&t;0x06&t;&t;/* Playback period pointer. Sample currently in DAC */
DECL|macro|PLAYBACK_UNKNOWN1
mdefine_line|#define PLAYBACK_UNKNOWN1       0x07
DECL|macro|PLAYBACK_UNKNOWN2
mdefine_line|#define PLAYBACK_UNKNOWN2       0x08
multiline_comment|/* Only one capture channel supported */
DECL|macro|CAPTURE_DMA_ADDR
mdefine_line|#define CAPTURE_DMA_ADDR&t;0x10&t;&t;/* Capture DMA address */
DECL|macro|CAPTURE_BUFFER_SIZE
mdefine_line|#define CAPTURE_BUFFER_SIZE&t;0x11&t;&t;/* Capture buffer size */
DECL|macro|CAPTURE_POINTER
mdefine_line|#define CAPTURE_POINTER&t;&t;0x12&t;&t;/* Capture buffer pointer. Sample currently in ADC */
DECL|macro|CAPTURE_UNKNOWN
mdefine_line|#define CAPTURE_UNKNOWN         0x13
multiline_comment|/* From 0x20 - 0x3f, last samples played on each channel */
DECL|macro|TRIGGER_CHANNEL
mdefine_line|#define TRIGGER_CHANNEL         0x40            /* Trigger channel playback                     */
DECL|macro|TRIGGER_CHANNEL_0
mdefine_line|#define TRIGGER_CHANNEL_0       0x00000001      /* Trigger channel 0                            */
DECL|macro|TRIGGER_CHANNEL_1
mdefine_line|#define TRIGGER_CHANNEL_1       0x00000002      /* Trigger channel 1                            */
DECL|macro|TRIGGER_CHANNEL_2
mdefine_line|#define TRIGGER_CHANNEL_2       0x00000004      /* Trigger channel 2                            */
DECL|macro|TRIGGER_CAPTURE
mdefine_line|#define TRIGGER_CAPTURE         0x00000100      /* Trigger capture channel                      */
DECL|macro|ROUTING
mdefine_line|#define ROUTING                 0x41            /* Setup sound routing ?                        */
DECL|macro|ROUTING_FRONT_LEFT
mdefine_line|#define ROUTING_FRONT_LEFT      0x00000001
DECL|macro|ROUTING_FRONT_RIGHT
mdefine_line|#define ROUTING_FRONT_RIGHT     0x00000002
DECL|macro|ROUTING_REAR_LEFT
mdefine_line|#define ROUTING_REAR_LEFT       0x00000004
DECL|macro|ROUTING_REAR_RIGHT
mdefine_line|#define ROUTING_REAR_RIGHT      0x00000008
DECL|macro|ROUTING_CENTER_LFE
mdefine_line|#define ROUTING_CENTER_LFE      0x00010000
DECL|macro|SPCS0
mdefine_line|#define SPCS0&t;&t;&t;0x42&t;&t;/* SPDIF output Channel Status 0 register&t;*/
DECL|macro|SPCS1
mdefine_line|#define SPCS1&t;&t;&t;0x43&t;&t;/* SPDIF output Channel Status 1 register&t;*/
DECL|macro|SPCS2
mdefine_line|#define SPCS2&t;&t;&t;0x44&t;&t;/* SPDIF output Channel Status 2 register&t;*/
DECL|macro|SPCS_CLKACCYMASK
mdefine_line|#define SPCS_CLKACCYMASK&t;0x30000000&t;/* Clock accuracy&t;&t;&t;&t;*/
DECL|macro|SPCS_CLKACCY_1000PPM
mdefine_line|#define SPCS_CLKACCY_1000PPM&t;0x00000000&t;/* 1000 parts per million&t;&t;&t;*/
DECL|macro|SPCS_CLKACCY_50PPM
mdefine_line|#define SPCS_CLKACCY_50PPM&t;0x10000000&t;/* 50 parts per million&t;&t;&t;&t;*/
DECL|macro|SPCS_CLKACCY_VARIABLE
mdefine_line|#define SPCS_CLKACCY_VARIABLE&t;0x20000000&t;/* Variable accuracy&t;&t;&t;&t;*/
DECL|macro|SPCS_SAMPLERATEMASK
mdefine_line|#define SPCS_SAMPLERATEMASK&t;0x0f000000&t;/* Sample rate&t;&t;&t;&t;&t;*/
DECL|macro|SPCS_SAMPLERATE_44
mdefine_line|#define SPCS_SAMPLERATE_44&t;0x00000000&t;/* 44.1kHz sample rate&t;&t;&t;&t;*/
DECL|macro|SPCS_SAMPLERATE_48
mdefine_line|#define SPCS_SAMPLERATE_48&t;0x02000000&t;/* 48kHz sample rate&t;&t;&t;&t;*/
DECL|macro|SPCS_SAMPLERATE_32
mdefine_line|#define SPCS_SAMPLERATE_32&t;0x03000000&t;/* 32kHz sample rate&t;&t;&t;&t;*/
DECL|macro|SPCS_CHANNELNUMMASK
mdefine_line|#define SPCS_CHANNELNUMMASK&t;0x00f00000&t;/* Channel number&t;&t;&t;&t;*/
DECL|macro|SPCS_CHANNELNUM_UNSPEC
mdefine_line|#define SPCS_CHANNELNUM_UNSPEC&t;0x00000000&t;/* Unspecified channel number&t;&t;&t;*/
DECL|macro|SPCS_CHANNELNUM_LEFT
mdefine_line|#define SPCS_CHANNELNUM_LEFT&t;0x00100000&t;/* Left channel&t;&t;&t;&t;&t;*/
DECL|macro|SPCS_CHANNELNUM_RIGHT
mdefine_line|#define SPCS_CHANNELNUM_RIGHT&t;0x00200000&t;/* Right channel&t;&t;&t;&t;*/
DECL|macro|SPCS_SOURCENUMMASK
mdefine_line|#define SPCS_SOURCENUMMASK&t;0x000f0000&t;/* Source number&t;&t;&t;&t;*/
DECL|macro|SPCS_SOURCENUM_UNSPEC
mdefine_line|#define SPCS_SOURCENUM_UNSPEC&t;0x00000000&t;/* Unspecified source number&t;&t;&t;*/
DECL|macro|SPCS_GENERATIONSTATUS
mdefine_line|#define SPCS_GENERATIONSTATUS&t;0x00008000&t;/* Originality flag (see IEC-958 spec)&t;&t;*/
DECL|macro|SPCS_CATEGORYCODEMASK
mdefine_line|#define SPCS_CATEGORYCODEMASK&t;0x00007f00&t;/* Category code (see IEC-958 spec)&t;&t;*/
DECL|macro|SPCS_MODEMASK
mdefine_line|#define SPCS_MODEMASK&t;&t;0x000000c0&t;/* Mode (see IEC-958 spec)&t;&t;&t;*/
DECL|macro|SPCS_EMPHASISMASK
mdefine_line|#define SPCS_EMPHASISMASK&t;0x00000038&t;/* Emphasis&t;&t;&t;&t;&t;*/
DECL|macro|SPCS_EMPHASIS_NONE
mdefine_line|#define SPCS_EMPHASIS_NONE&t;0x00000000&t;/* No emphasis&t;&t;&t;&t;&t;*/
DECL|macro|SPCS_EMPHASIS_50_15
mdefine_line|#define SPCS_EMPHASIS_50_15&t;0x00000008&t;/* 50/15 usec 2 channel&t;&t;&t;&t;*/
DECL|macro|SPCS_COPYRIGHT
mdefine_line|#define SPCS_COPYRIGHT&t;&t;0x00000004&t;/* Copyright asserted flag -- do not modify&t;*/
DECL|macro|SPCS_NOTAUDIODATA
mdefine_line|#define SPCS_NOTAUDIODATA&t;0x00000002&t;/* 0 = Digital audio, 1 = not audio&t;&t;*/
DECL|macro|SPCS_PROFESSIONAL
mdefine_line|#define SPCS_PROFESSIONAL&t;0x00000001&t;/* 0 = Consumer (IEC-958), 1 = pro (AES3-1992)&t;*/
DECL|macro|SPDIF_SELECT
mdefine_line|#define SPDIF_SELECT&t;&t;0x45&t;&t;/* Enables SPDIF or Analogue outputs 0-Analogue, 0x700-SPDIF */
multiline_comment|/* This is the MPU port on the card                      &t;&t;&t;&t;&t;*/
DECL|macro|MUDATA
mdefine_line|#define MUDATA&t;&t;0x47
DECL|macro|MUCMD
mdefine_line|#define MUCMD&t;&t;0x48
DECL|macro|MUSTAT
mdefine_line|#define MUSTAT&t;&t;MUCMD
multiline_comment|/* From 0x50 - 0x5f, last samples captured */
multiline_comment|/**&n; * The hardware has 3 channels for playback and 1 for capture.&n; *  - channel 0 is the front channel&n; *  - channel 1 is the rear channel&n; *  - channel 2 is the center/lfe chanel&n; * Volume is controlled by the AC97 for the front and rear channels by&n; * the PCM Playback Volume, Sigmatel Surround Playback Volume and &n; * Surround Playback Volume. The Sigmatel 4-Speaker Stereo switch affects&n; * the front/rear channel mixing in the REAR OUT jack. When using the&n; * 4-Speaker Stereo, both front and rear channels will be mixed in the&n; * REAR OUT.&n; * The center/lfe channel has no volume control and cannot be muted during&n; * playback.&n; */
DECL|typedef|emu10k1x_voice_t
r_typedef
r_struct
id|snd_emu10k1x_voice
id|emu10k1x_voice_t
suffix:semicolon
DECL|typedef|emu10k1x_t
r_typedef
r_struct
id|snd_emu10k1x
id|emu10k1x_t
suffix:semicolon
DECL|typedef|emu10k1x_pcm_t
r_typedef
r_struct
id|snd_emu10k1x_pcm
id|emu10k1x_pcm_t
suffix:semicolon
DECL|struct|snd_emu10k1x_voice
r_struct
id|snd_emu10k1x_voice
(brace
DECL|member|emu
id|emu10k1x_t
op_star
id|emu
suffix:semicolon
DECL|member|number
r_int
id|number
suffix:semicolon
DECL|member|use
r_int
id|use
suffix:semicolon
DECL|member|epcm
id|emu10k1x_pcm_t
op_star
id|epcm
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|snd_emu10k1x_pcm
r_struct
id|snd_emu10k1x_pcm
(brace
DECL|member|emu
id|emu10k1x_t
op_star
id|emu
suffix:semicolon
DECL|member|substream
id|snd_pcm_substream_t
op_star
id|substream
suffix:semicolon
DECL|member|voice
id|emu10k1x_voice_t
op_star
id|voice
suffix:semicolon
DECL|member|running
r_int
r_int
id|running
suffix:semicolon
)brace
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|emu
r_struct
id|snd_emu10k1x
op_star
id|emu
suffix:semicolon
DECL|member|rmidi
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
DECL|member|substream_input
id|snd_rawmidi_substream_t
op_star
id|substream_input
suffix:semicolon
DECL|member|substream_output
id|snd_rawmidi_substream_t
op_star
id|substream_output
suffix:semicolon
DECL|member|midi_mode
r_int
r_int
id|midi_mode
suffix:semicolon
DECL|member|input_lock
id|spinlock_t
id|input_lock
suffix:semicolon
DECL|member|output_lock
id|spinlock_t
id|output_lock
suffix:semicolon
DECL|member|open_lock
id|spinlock_t
id|open_lock
suffix:semicolon
DECL|member|tx_enable
DECL|member|rx_enable
r_int
id|tx_enable
comma
id|rx_enable
suffix:semicolon
DECL|member|port
r_int
id|port
suffix:semicolon
DECL|member|ipr_tx
DECL|member|ipr_rx
r_int
id|ipr_tx
comma
id|ipr_rx
suffix:semicolon
DECL|member|interrupt
r_void
(paren
op_star
id|interrupt
)paren
(paren
id|emu10k1x_t
op_star
id|emu
comma
r_int
r_int
id|status
)paren
suffix:semicolon
DECL|typedef|emu10k1x_midi_t
)brace
id|emu10k1x_midi_t
suffix:semicolon
singleline_comment|// definition of the chip-specific record
DECL|struct|snd_emu10k1x
r_struct
id|snd_emu10k1x
(brace
DECL|member|card
id|snd_card_t
op_star
id|card
suffix:semicolon
DECL|member|pci
r_struct
id|pci_dev
op_star
id|pci
suffix:semicolon
DECL|member|port
r_int
r_int
id|port
suffix:semicolon
DECL|member|res_port
r_struct
id|resource
op_star
id|res_port
suffix:semicolon
DECL|member|irq
r_int
id|irq
suffix:semicolon
DECL|member|revision
r_int
r_int
id|revision
suffix:semicolon
multiline_comment|/* chip revision */
DECL|member|serial
r_int
r_int
id|serial
suffix:semicolon
multiline_comment|/* serial number */
DECL|member|model
r_int
r_int
id|model
suffix:semicolon
multiline_comment|/* subsystem id */
DECL|member|emu_lock
id|spinlock_t
id|emu_lock
suffix:semicolon
DECL|member|voice_lock
id|spinlock_t
id|voice_lock
suffix:semicolon
DECL|member|ac97
id|ac97_t
op_star
id|ac97
suffix:semicolon
DECL|member|pcm
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
DECL|member|voices
id|emu10k1x_voice_t
id|voices
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|capture_voice
id|emu10k1x_voice_t
id|capture_voice
suffix:semicolon
DECL|member|spdif_bits
id|u32
id|spdif_bits
(braket
l_int|3
)braket
suffix:semicolon
singleline_comment|// SPDIF out setup
DECL|member|dma_buffer
r_struct
id|snd_dma_buffer
id|dma_buffer
suffix:semicolon
DECL|member|midi
id|emu10k1x_midi_t
id|midi
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* hardware definition */
DECL|variable|snd_emu10k1x_playback_hw
r_static
id|snd_pcm_hardware_t
id|snd_emu10k1x_playback_hw
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_48000
comma
dot
id|rate_min
op_assign
l_int|48000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|2
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|32
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|16
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|2
comma
dot
id|periods_max
op_assign
l_int|8
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|snd_emu10k1x_capture_hw
r_static
id|snd_pcm_hardware_t
id|snd_emu10k1x_capture_hw
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_48000
comma
dot
id|rate_min
op_assign
l_int|48000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|2
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|32
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|16
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|2
comma
dot
id|periods_max
op_assign
l_int|2
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|function|snd_emu10k1x_ptr_read
r_static
r_int
r_int
id|snd_emu10k1x_ptr_read
c_func
(paren
id|emu10k1x_t
op_star
id|emu
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|chn
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|regptr
comma
id|val
suffix:semicolon
id|regptr
op_assign
(paren
id|reg
op_lshift
l_int|16
)paren
op_or
id|chn
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
id|outl
c_func
(paren
id|regptr
comma
id|emu-&gt;port
op_plus
id|PTR
)paren
suffix:semicolon
id|val
op_assign
id|inl
c_func
(paren
id|emu-&gt;port
op_plus
id|DATA
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_ptr_write
r_static
r_void
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu10k1x_t
op_star
id|emu
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|chn
comma
r_int
r_int
id|data
)paren
(brace
r_int
r_int
id|regptr
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|regptr
op_assign
(paren
id|reg
op_lshift
l_int|16
)paren
op_or
id|chn
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
id|outl
c_func
(paren
id|regptr
comma
id|emu-&gt;port
op_plus
id|PTR
)paren
suffix:semicolon
id|outl
c_func
(paren
id|data
comma
id|emu-&gt;port
op_plus
id|DATA
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_intr_enable
r_static
r_void
id|snd_emu10k1x_intr_enable
c_func
(paren
id|emu10k1x_t
op_star
id|emu
comma
r_int
r_int
id|intrenb
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|enable
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
id|enable
op_assign
id|inl
c_func
(paren
id|emu-&gt;port
op_plus
id|INTE
)paren
op_or
id|intrenb
suffix:semicolon
id|outl
c_func
(paren
id|enable
comma
id|emu-&gt;port
op_plus
id|INTE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_intr_disable
r_static
r_void
id|snd_emu10k1x_intr_disable
c_func
(paren
id|emu10k1x_t
op_star
id|emu
comma
r_int
r_int
id|intrenb
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|enable
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
id|enable
op_assign
id|inl
c_func
(paren
id|emu-&gt;port
op_plus
id|INTE
)paren
op_amp
op_complement
id|intrenb
suffix:semicolon
id|outl
c_func
(paren
id|enable
comma
id|emu-&gt;port
op_plus
id|INTE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_gpio_write
r_static
r_void
id|snd_emu10k1x_gpio_write
c_func
(paren
id|emu10k1x_t
op_star
id|emu
comma
r_int
r_int
id|value
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
id|outl
c_func
(paren
id|value
comma
id|emu-&gt;port
op_plus
id|GPIO
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_pcm_free_substream
r_static
r_void
id|snd_emu10k1x_pcm_free_substream
c_func
(paren
id|snd_pcm_runtime_t
op_star
id|runtime
)paren
(brace
id|emu10k1x_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
id|epcm
)paren
id|kfree
c_func
(paren
id|epcm
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_pcm_interrupt
r_static
r_void
id|snd_emu10k1x_pcm_interrupt
c_func
(paren
id|emu10k1x_t
op_star
id|emu
comma
id|emu10k1x_voice_t
op_star
id|voice
)paren
(brace
id|emu10k1x_pcm_t
op_star
id|epcm
suffix:semicolon
r_if
c_cond
(paren
(paren
id|epcm
op_assign
id|voice-&gt;epcm
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|epcm-&gt;substream
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
macro_line|#if 0
id|snd_printk
c_func
(paren
id|KERN_INFO
l_string|&quot;IRQ: position = 0x%x, period = 0x%x, size = 0x%x&bslash;n&quot;
comma
id|epcm-&gt;substream-&gt;ops
op_member_access_from_pointer
id|pointer
c_func
(paren
id|epcm-&gt;substream
)paren
comma
id|snd_pcm_lib_period_bytes
c_func
(paren
id|epcm-&gt;substream
)paren
comma
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|epcm-&gt;substream
)paren
)paren
suffix:semicolon
macro_line|#endif
id|snd_pcm_period_elapsed
c_func
(paren
id|epcm-&gt;substream
)paren
suffix:semicolon
)brace
multiline_comment|/* open callback */
DECL|function|snd_emu10k1x_playback_open
r_static
r_int
id|snd_emu10k1x_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1x_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|emu10k1x_pcm_t
op_star
id|epcm
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_integer
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_PERIODS
)paren
)paren
OL
l_int|0
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_step
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_PERIOD_BYTES
comma
l_int|64
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|epcm
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|epcm
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|epcm
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|epcm-&gt;emu
op_assign
id|chip
suffix:semicolon
id|epcm-&gt;substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;private_data
op_assign
id|epcm
suffix:semicolon
id|runtime-&gt;private_free
op_assign
id|snd_emu10k1x_pcm_free_substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_emu10k1x_playback_hw
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* close callback */
DECL|function|snd_emu10k1x_playback_close
r_static
r_int
id|snd_emu10k1x_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* hw_params callback */
DECL|function|snd_emu10k1x_pcm_hw_params
r_static
r_int
id|snd_emu10k1x_pcm_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1x_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|epcm-&gt;voice
)paren
(brace
id|epcm-&gt;voice
op_assign
op_amp
id|epcm-&gt;emu-&gt;voices
(braket
id|substream-&gt;pcm-&gt;device
)braket
suffix:semicolon
id|epcm-&gt;voice-&gt;use
op_assign
l_int|1
suffix:semicolon
id|epcm-&gt;voice-&gt;epcm
op_assign
id|epcm
suffix:semicolon
)brace
r_return
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* hw_free callback */
DECL|function|snd_emu10k1x_pcm_hw_free
r_static
r_int
id|snd_emu10k1x_pcm_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1x_pcm_t
op_star
id|epcm
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;private_data
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
id|epcm-&gt;voice
)paren
(brace
id|epcm-&gt;voice-&gt;use
op_assign
l_int|0
suffix:semicolon
id|epcm-&gt;voice-&gt;epcm
op_assign
l_int|NULL
suffix:semicolon
id|epcm-&gt;voice
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
multiline_comment|/* prepare callback */
DECL|function|snd_emu10k1x_pcm_prepare
r_static
r_int
id|snd_emu10k1x_pcm_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1x_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1x_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_int
id|voice
op_assign
id|epcm-&gt;voice-&gt;number
suffix:semicolon
id|u32
op_star
id|table_base
op_assign
(paren
id|u32
op_star
)paren
(paren
id|emu-&gt;dma_buffer.area
op_plus
l_int|1024
op_star
id|voice
)paren
suffix:semicolon
id|u32
id|period_size_bytes
op_assign
id|frames_to_bytes
c_func
(paren
id|runtime
comma
id|runtime-&gt;period_size
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|runtime-&gt;periods
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|table_base
op_increment
op_assign
id|runtime-&gt;dma_addr
op_plus
(paren
id|i
op_star
id|period_size_bytes
)paren
suffix:semicolon
op_star
id|table_base
op_increment
op_assign
id|period_size_bytes
op_lshift
l_int|16
suffix:semicolon
)brace
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|PLAYBACK_LIST_ADDR
comma
id|voice
comma
id|emu-&gt;dma_buffer.addr
op_plus
l_int|1024
op_star
id|voice
)paren
suffix:semicolon
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|PLAYBACK_LIST_SIZE
comma
id|voice
comma
(paren
id|runtime-&gt;periods
op_minus
l_int|1
)paren
op_lshift
l_int|19
)paren
suffix:semicolon
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|PLAYBACK_LIST_PTR
comma
id|voice
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|PLAYBACK_POINTER
comma
id|voice
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|PLAYBACK_UNKNOWN1
comma
id|voice
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|PLAYBACK_UNKNOWN2
comma
id|voice
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|PLAYBACK_DMA_ADDR
comma
id|voice
comma
id|runtime-&gt;dma_addr
)paren
suffix:semicolon
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|PLAYBACK_PERIOD_SIZE
comma
id|voice
comma
id|frames_to_bytes
c_func
(paren
id|runtime
comma
id|runtime-&gt;period_size
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* trigger callback */
DECL|function|snd_emu10k1x_pcm_trigger
r_static
r_int
id|snd_emu10k1x_pcm_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|emu10k1x_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1x_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_int
id|channel
op_assign
id|epcm-&gt;voice-&gt;number
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
singleline_comment|//&t;snd_printk(KERN_INFO &quot;trigger - emu10k1x = 0x%x, cmd = %i, pointer = %d&bslash;n&quot;, (int)emu, cmd, (int)substream-&gt;ops-&gt;pointer(substream));
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
r_if
c_cond
(paren
id|runtime-&gt;periods
op_eq
l_int|2
)paren
(brace
id|snd_emu10k1x_intr_enable
c_func
(paren
id|emu
comma
(paren
id|INTE_CH_0_LOOP
op_or
id|INTE_CH_0_HALF_LOOP
)paren
op_lshift
id|channel
)paren
suffix:semicolon
)brace
r_else
id|snd_emu10k1x_intr_enable
c_func
(paren
id|emu
comma
id|INTE_CH_0_LOOP
op_lshift
id|channel
)paren
suffix:semicolon
id|epcm-&gt;running
op_assign
l_int|1
suffix:semicolon
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|TRIGGER_CHANNEL
comma
l_int|0
comma
id|snd_emu10k1x_ptr_read
c_func
(paren
id|emu
comma
id|TRIGGER_CHANNEL
comma
l_int|0
)paren
op_or
(paren
id|TRIGGER_CHANNEL_0
op_lshift
id|channel
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
id|epcm-&gt;running
op_assign
l_int|0
suffix:semicolon
id|snd_emu10k1x_intr_disable
c_func
(paren
id|emu
comma
(paren
id|INTE_CH_0_LOOP
op_or
id|INTE_CH_0_HALF_LOOP
)paren
op_lshift
id|channel
)paren
suffix:semicolon
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|TRIGGER_CHANNEL
comma
l_int|0
comma
id|snd_emu10k1x_ptr_read
c_func
(paren
id|emu
comma
id|TRIGGER_CHANNEL
comma
l_int|0
)paren
op_amp
op_complement
(paren
id|TRIGGER_CHANNEL_0
op_lshift
id|channel
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/* pointer callback */
r_static
id|snd_pcm_uframes_t
DECL|function|snd_emu10k1x_pcm_pointer
id|snd_emu10k1x_pcm_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1x_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1x_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_int
id|channel
op_assign
id|epcm-&gt;voice-&gt;number
suffix:semicolon
id|snd_pcm_uframes_t
id|ptr
op_assign
l_int|0
comma
id|ptr1
op_assign
l_int|0
comma
id|ptr2
op_assign
l_int|0
comma
id|ptr3
op_assign
l_int|0
comma
id|ptr4
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|epcm-&gt;running
)paren
r_return
l_int|0
suffix:semicolon
id|ptr3
op_assign
id|snd_emu10k1x_ptr_read
c_func
(paren
id|emu
comma
id|PLAYBACK_LIST_PTR
comma
id|channel
)paren
suffix:semicolon
id|ptr1
op_assign
id|snd_emu10k1x_ptr_read
c_func
(paren
id|emu
comma
id|PLAYBACK_POINTER
comma
id|channel
)paren
suffix:semicolon
id|ptr4
op_assign
id|snd_emu10k1x_ptr_read
c_func
(paren
id|emu
comma
id|PLAYBACK_LIST_PTR
comma
id|channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr4
op_eq
l_int|0
op_logical_and
id|ptr1
op_eq
id|frames_to_bytes
c_func
(paren
id|runtime
comma
id|runtime-&gt;buffer_size
)paren
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ptr3
op_ne
id|ptr4
)paren
id|ptr1
op_assign
id|snd_emu10k1x_ptr_read
c_func
(paren
id|emu
comma
id|PLAYBACK_POINTER
comma
id|channel
)paren
suffix:semicolon
id|ptr2
op_assign
id|bytes_to_frames
c_func
(paren
id|runtime
comma
id|ptr1
)paren
suffix:semicolon
id|ptr2
op_add_assign
(paren
id|ptr4
op_rshift
l_int|3
)paren
op_star
id|runtime-&gt;period_size
suffix:semicolon
id|ptr
op_assign
id|ptr2
suffix:semicolon
r_if
c_cond
(paren
id|ptr
op_ge
id|runtime-&gt;buffer_size
)paren
id|ptr
op_sub_assign
id|runtime-&gt;buffer_size
suffix:semicolon
r_return
id|ptr
suffix:semicolon
)brace
multiline_comment|/* operators */
DECL|variable|snd_emu10k1x_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_emu10k1x_playback_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_emu10k1x_playback_open
comma
dot
id|close
op_assign
id|snd_emu10k1x_playback_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_emu10k1x_pcm_hw_params
comma
dot
id|hw_free
op_assign
id|snd_emu10k1x_pcm_hw_free
comma
dot
id|prepare
op_assign
id|snd_emu10k1x_pcm_prepare
comma
dot
id|trigger
op_assign
id|snd_emu10k1x_pcm_trigger
comma
dot
id|pointer
op_assign
id|snd_emu10k1x_pcm_pointer
comma
)brace
suffix:semicolon
multiline_comment|/* open_capture callback */
DECL|function|snd_emu10k1x_pcm_open_capture
r_static
r_int
id|snd_emu10k1x_pcm_open_capture
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1x_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|emu10k1x_pcm_t
op_star
id|epcm
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_integer
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_PERIODS
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_step
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_PERIOD_BYTES
comma
l_int|64
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|epcm
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|epcm
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|epcm
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|epcm-&gt;emu
op_assign
id|chip
suffix:semicolon
id|epcm-&gt;substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;private_data
op_assign
id|epcm
suffix:semicolon
id|runtime-&gt;private_free
op_assign
id|snd_emu10k1x_pcm_free_substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_emu10k1x_capture_hw
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* close callback */
DECL|function|snd_emu10k1x_pcm_close_capture
r_static
r_int
id|snd_emu10k1x_pcm_close_capture
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* hw_params callback */
DECL|function|snd_emu10k1x_pcm_hw_params_capture
r_static
r_int
id|snd_emu10k1x_pcm_hw_params_capture
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1x_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|epcm-&gt;voice
)paren
(brace
r_if
c_cond
(paren
id|epcm-&gt;emu-&gt;capture_voice.use
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|epcm-&gt;voice
op_assign
op_amp
id|epcm-&gt;emu-&gt;capture_voice
suffix:semicolon
id|epcm-&gt;voice-&gt;epcm
op_assign
id|epcm
suffix:semicolon
id|epcm-&gt;voice-&gt;use
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* hw_free callback */
DECL|function|snd_emu10k1x_pcm_hw_free_capture
r_static
r_int
id|snd_emu10k1x_pcm_hw_free_capture
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1x_pcm_t
op_star
id|epcm
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;private_data
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
id|epcm-&gt;voice
)paren
(brace
id|epcm-&gt;voice-&gt;use
op_assign
l_int|0
suffix:semicolon
id|epcm-&gt;voice-&gt;epcm
op_assign
l_int|NULL
suffix:semicolon
id|epcm-&gt;voice
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
multiline_comment|/* prepare capture callback */
DECL|function|snd_emu10k1x_pcm_prepare_capture
r_static
r_int
id|snd_emu10k1x_pcm_prepare_capture
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1x_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|CAPTURE_DMA_ADDR
comma
l_int|0
comma
id|runtime-&gt;dma_addr
)paren
suffix:semicolon
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|CAPTURE_BUFFER_SIZE
comma
l_int|0
comma
id|frames_to_bytes
c_func
(paren
id|runtime
comma
id|runtime-&gt;buffer_size
)paren
op_lshift
l_int|16
)paren
suffix:semicolon
singleline_comment|// buffer size in bytes
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|CAPTURE_POINTER
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|CAPTURE_UNKNOWN
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* trigger_capture callback */
DECL|function|snd_emu10k1x_pcm_trigger_capture
r_static
r_int
id|snd_emu10k1x_pcm_trigger_capture
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|emu10k1x_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1x_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
id|snd_emu10k1x_intr_enable
c_func
(paren
id|emu
comma
id|INTE_CAP_0_LOOP
op_or
id|INTE_CAP_0_HALF_LOOP
)paren
suffix:semicolon
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|TRIGGER_CHANNEL
comma
l_int|0
comma
id|snd_emu10k1x_ptr_read
c_func
(paren
id|emu
comma
id|TRIGGER_CHANNEL
comma
l_int|0
)paren
op_or
id|TRIGGER_CAPTURE
)paren
suffix:semicolon
id|epcm-&gt;running
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
id|epcm-&gt;running
op_assign
l_int|0
suffix:semicolon
id|snd_emu10k1x_intr_disable
c_func
(paren
id|emu
comma
id|INTE_CAP_0_LOOP
op_or
id|INTE_CAP_0_HALF_LOOP
)paren
suffix:semicolon
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|TRIGGER_CHANNEL
comma
l_int|0
comma
id|snd_emu10k1x_ptr_read
c_func
(paren
id|emu
comma
id|TRIGGER_CHANNEL
comma
l_int|0
)paren
op_amp
op_complement
(paren
id|TRIGGER_CAPTURE
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/* pointer_capture callback */
r_static
id|snd_pcm_uframes_t
DECL|function|snd_emu10k1x_pcm_pointer_capture
id|snd_emu10k1x_pcm_pointer_capture
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1x_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1x_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
id|snd_pcm_uframes_t
id|ptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|epcm-&gt;running
)paren
r_return
l_int|0
suffix:semicolon
id|ptr
op_assign
id|bytes_to_frames
c_func
(paren
id|runtime
comma
id|snd_emu10k1x_ptr_read
c_func
(paren
id|emu
comma
id|CAPTURE_POINTER
comma
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr
op_ge
id|runtime-&gt;buffer_size
)paren
id|ptr
op_sub_assign
id|runtime-&gt;buffer_size
suffix:semicolon
r_return
id|ptr
suffix:semicolon
)brace
DECL|variable|snd_emu10k1x_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_emu10k1x_capture_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_emu10k1x_pcm_open_capture
comma
dot
id|close
op_assign
id|snd_emu10k1x_pcm_close_capture
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_emu10k1x_pcm_hw_params_capture
comma
dot
id|hw_free
op_assign
id|snd_emu10k1x_pcm_hw_free_capture
comma
dot
id|prepare
op_assign
id|snd_emu10k1x_pcm_prepare_capture
comma
dot
id|trigger
op_assign
id|snd_emu10k1x_pcm_trigger_capture
comma
dot
id|pointer
op_assign
id|snd_emu10k1x_pcm_pointer_capture
comma
)brace
suffix:semicolon
DECL|function|snd_emu10k1x_ac97_read
r_static
r_int
r_int
id|snd_emu10k1x_ac97_read
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
)paren
(brace
id|emu10k1x_t
op_star
id|emu
op_assign
id|ac97-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
id|reg
comma
id|emu-&gt;port
op_plus
id|AC97ADDRESS
)paren
suffix:semicolon
id|val
op_assign
id|inw
c_func
(paren
id|emu-&gt;port
op_plus
id|AC97DATA
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_ac97_write
r_static
r_void
id|snd_emu10k1x_ac97_write
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
id|emu10k1x_t
op_star
id|emu
op_assign
id|ac97-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
id|reg
comma
id|emu-&gt;port
op_plus
id|AC97ADDRESS
)paren
suffix:semicolon
id|outw
c_func
(paren
id|val
comma
id|emu-&gt;port
op_plus
id|AC97DATA
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_ac97
r_static
r_int
id|snd_emu10k1x_ac97
c_func
(paren
id|emu10k1x_t
op_star
id|chip
)paren
(brace
id|ac97_bus_t
op_star
id|pbus
suffix:semicolon
id|ac97_template_t
id|ac97
suffix:semicolon
r_int
id|err
suffix:semicolon
r_static
id|ac97_bus_ops_t
id|ops
op_assign
(brace
dot
id|write
op_assign
id|snd_emu10k1x_ac97_write
comma
dot
id|read
op_assign
id|snd_emu10k1x_ac97_read
comma
)brace
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_bus
c_func
(paren
id|chip-&gt;card
comma
l_int|0
comma
op_amp
id|ops
comma
l_int|NULL
comma
op_amp
id|pbus
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|pbus-&gt;no_vra
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* we don&squot;t need VRA */
id|memset
c_func
(paren
op_amp
id|ac97
comma
l_int|0
comma
r_sizeof
(paren
id|ac97
)paren
)paren
suffix:semicolon
id|ac97.private_data
op_assign
id|chip
suffix:semicolon
id|ac97.scaps
op_assign
id|AC97_SCAP_NO_SPDIF
suffix:semicolon
r_return
id|snd_ac97_mixer
c_func
(paren
id|pbus
comma
op_amp
id|ac97
comma
op_amp
id|chip-&gt;ac97
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_free
r_static
r_int
id|snd_emu10k1x_free
c_func
(paren
id|emu10k1x_t
op_star
id|chip
)paren
(brace
id|snd_emu10k1x_ptr_write
c_func
(paren
id|chip
comma
id|TRIGGER_CHANNEL
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
singleline_comment|// disable interrupts
id|outl
c_func
(paren
l_int|0
comma
id|chip-&gt;port
op_plus
id|INTE
)paren
suffix:semicolon
singleline_comment|// disable audio
id|outl
c_func
(paren
id|HCFG_LOCKSOUNDCACHE
comma
id|chip-&gt;port
op_plus
id|HCFG
)paren
suffix:semicolon
singleline_comment|// release the i/o port
r_if
c_cond
(paren
id|chip-&gt;res_port
)paren
(brace
id|release_resource
c_func
(paren
id|chip-&gt;res_port
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|chip-&gt;res_port
)paren
suffix:semicolon
)brace
singleline_comment|// release the irq
r_if
c_cond
(paren
id|chip-&gt;irq
op_ge
l_int|0
)paren
id|free_irq
c_func
(paren
id|chip-&gt;irq
comma
(paren
r_void
op_star
)paren
id|chip
)paren
suffix:semicolon
singleline_comment|// release the DMA
r_if
c_cond
(paren
id|chip-&gt;dma_buffer.area
)paren
(brace
id|snd_dma_free_pages
c_func
(paren
op_amp
id|chip-&gt;dma_buffer
)paren
suffix:semicolon
)brace
id|pci_disable_device
c_func
(paren
id|chip-&gt;pci
)paren
suffix:semicolon
singleline_comment|// release the data
id|kfree
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_dev_free
r_static
r_int
id|snd_emu10k1x_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|emu10k1x_t
op_star
id|chip
op_assign
id|device-&gt;device_data
suffix:semicolon
r_return
id|snd_emu10k1x_free
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_interrupt
r_static
id|irqreturn_t
id|snd_emu10k1x_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|status
suffix:semicolon
id|emu10k1x_t
op_star
id|chip
op_assign
id|dev_id
suffix:semicolon
id|emu10k1x_voice_t
op_star
id|pvoice
op_assign
id|chip-&gt;voices
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|mask
suffix:semicolon
id|status
op_assign
id|inl
c_func
(paren
id|chip-&gt;port
op_plus
id|IPR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
(brace
singleline_comment|// capture interrupt
r_if
c_cond
(paren
id|status
op_amp
(paren
id|IPR_CAP_0_LOOP
op_or
id|IPR_CAP_0_HALF_LOOP
)paren
)paren
(brace
id|emu10k1x_voice_t
op_star
id|pvoice
op_assign
op_amp
id|chip-&gt;capture_voice
suffix:semicolon
r_if
c_cond
(paren
id|pvoice-&gt;use
)paren
(brace
id|snd_emu10k1x_pcm_interrupt
c_func
(paren
id|chip
comma
id|pvoice
)paren
suffix:semicolon
)brace
r_else
id|snd_emu10k1x_intr_disable
c_func
(paren
id|chip
comma
id|INTE_CAP_0_LOOP
op_or
id|INTE_CAP_0_HALF_LOOP
)paren
suffix:semicolon
)brace
id|mask
op_assign
id|IPR_CH_0_LOOP
op_or
id|IPR_CH_0_HALF_LOOP
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|status
op_amp
id|mask
)paren
(brace
r_if
c_cond
(paren
id|pvoice-&gt;use
)paren
(brace
id|snd_emu10k1x_pcm_interrupt
c_func
(paren
id|chip
comma
id|pvoice
)paren
suffix:semicolon
)brace
r_else
id|snd_emu10k1x_intr_disable
c_func
(paren
id|chip
comma
id|mask
)paren
suffix:semicolon
)brace
id|pvoice
op_increment
suffix:semicolon
id|mask
op_lshift_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
(paren
id|IPR_MIDITRANSBUFEMPTY
op_or
id|IPR_MIDIRECVBUFEMPTY
)paren
)paren
(brace
r_if
c_cond
(paren
id|chip-&gt;midi.interrupt
)paren
id|chip-&gt;midi
dot
id|interrupt
c_func
(paren
id|chip
comma
id|status
)paren
suffix:semicolon
r_else
id|snd_emu10k1x_intr_disable
c_func
(paren
id|chip
comma
id|INTE_MIDITXENABLE
op_or
id|INTE_MIDIRXENABLE
)paren
suffix:semicolon
)brace
singleline_comment|// acknowledge the interrupt if necessary
r_if
c_cond
(paren
id|status
)paren
(brace
id|outl
c_func
(paren
id|status
comma
id|chip-&gt;port
op_plus
id|IPR
)paren
suffix:semicolon
)brace
singleline_comment|//&t;&t;snd_printk(KERN_INFO &quot;interrupt %08x&bslash;n&quot;, status);
)brace
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_pcm_free
r_static
r_void
id|snd_emu10k1x_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|emu10k1x_t
op_star
id|emu
op_assign
id|pcm-&gt;private_data
suffix:semicolon
id|emu-&gt;pcm
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_pcm
r_static
r_int
id|__devinit
id|snd_emu10k1x_pcm
c_func
(paren
id|emu10k1x_t
op_star
id|emu
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|capture
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|device
op_eq
l_int|0
)paren
id|capture
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|emu-&gt;card
comma
l_string|&quot;emu10k1x&quot;
comma
id|device
comma
l_int|1
comma
id|capture
comma
op_amp
id|pcm
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|emu
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_emu10k1x_pcm_free
suffix:semicolon
r_switch
c_cond
(paren
id|device
)paren
(brace
r_case
l_int|0
suffix:colon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_emu10k1x_playback_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_emu10k1x_capture_ops
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
r_case
l_int|2
suffix:colon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_emu10k1x_playback_ops
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|pcm-&gt;dev_subclass
op_assign
id|SNDRV_PCM_SUBCLASS_GENERIC_MIX
suffix:semicolon
r_switch
c_cond
(paren
id|device
)paren
(brace
r_case
l_int|0
suffix:colon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;EMU10K1X Front&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;EMU10K1X Rear&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;EMU10K1X Center/LFE&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|emu-&gt;pcm
op_assign
id|pcm
suffix:semicolon
id|snd_pcm_lib_preallocate_pages_for_all
c_func
(paren
id|pcm
comma
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|emu-&gt;pci
)paren
comma
l_int|32
op_star
l_int|1024
comma
l_int|32
op_star
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_create
r_static
r_int
id|__devinit
id|snd_emu10k1x_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_struct
id|pci_dev
op_star
id|pci
comma
id|emu10k1x_t
op_star
op_star
id|rchip
)paren
(brace
id|emu10k1x_t
op_star
id|chip
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|ch
suffix:semicolon
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
dot
id|dev_free
op_assign
id|snd_emu10k1x_dev_free
comma
)brace
suffix:semicolon
op_star
id|rchip
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pci
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|pci_set_dma_mask
c_func
(paren
id|pci
comma
l_int|0x0fffffff
)paren
OL
l_int|0
op_logical_or
id|pci_set_consistent_dma_mask
c_func
(paren
id|pci
comma
l_int|0x0fffffff
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;error to set 28bit mask DMA&bslash;n&quot;
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pci
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
id|chip
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|chip
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip
op_eq
l_int|NULL
)paren
(brace
id|pci_disable_device
c_func
(paren
id|pci
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|chip-&gt;card
op_assign
id|card
suffix:semicolon
id|chip-&gt;pci
op_assign
id|pci
suffix:semicolon
id|chip-&gt;irq
op_assign
op_minus
l_int|1
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|chip-&gt;emu_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|chip-&gt;voice_lock
)paren
suffix:semicolon
id|chip-&gt;port
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chip-&gt;res_port
op_assign
id|request_region
c_func
(paren
id|chip-&gt;port
comma
l_int|8
comma
l_string|&quot;EMU10K1X&quot;
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;emu10k1x: cannot allocate the port 0x%lx&bslash;n&quot;
comma
id|chip-&gt;port
)paren
suffix:semicolon
id|snd_emu10k1x_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|pci-&gt;irq
comma
id|snd_emu10k1x_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
l_string|&quot;EMU10K1X&quot;
comma
(paren
r_void
op_star
)paren
id|chip
)paren
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;emu10k1x: cannot grab irq %d&bslash;n&quot;
comma
id|pci-&gt;irq
)paren
suffix:semicolon
id|snd_emu10k1x_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|chip-&gt;irq
op_assign
id|pci-&gt;irq
suffix:semicolon
r_if
c_cond
(paren
id|snd_dma_alloc_pages
c_func
(paren
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|pci
)paren
comma
l_int|4
op_star
l_int|1024
comma
op_amp
id|chip-&gt;dma_buffer
)paren
OL
l_int|0
)paren
(brace
id|snd_emu10k1x_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|pci_set_master
c_func
(paren
id|pci
)paren
suffix:semicolon
multiline_comment|/* read revision &amp; serial */
id|pci_read_config_byte
c_func
(paren
id|pci
comma
id|PCI_REVISION_ID
comma
(paren
r_char
op_star
)paren
op_amp
id|chip-&gt;revision
)paren
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|pci
comma
id|PCI_SUBSYSTEM_VENDOR_ID
comma
op_amp
id|chip-&gt;serial
)paren
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pci
comma
id|PCI_SUBSYSTEM_ID
comma
op_amp
id|chip-&gt;model
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Model %04x Rev %08x Serial %08x&bslash;n&quot;
comma
id|chip-&gt;model
comma
id|chip-&gt;revision
comma
id|chip-&gt;serial
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|chip-&gt;port
op_plus
id|INTE
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
l_int|3
suffix:semicolon
id|ch
op_increment
)paren
(brace
id|chip-&gt;voices
(braket
id|ch
)braket
dot
id|emu
op_assign
id|chip
suffix:semicolon
id|chip-&gt;voices
(braket
id|ch
)braket
dot
id|number
op_assign
id|ch
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *  Init to 0x02109204 :&n;&t; *  Clock accuracy    = 0     (1000ppm)&n;&t; *  Sample Rate       = 2     (48kHz)&n;&t; *  Audio Channel     = 1     (Left of 2)&n;&t; *  Source Number     = 0     (Unspecified)&n;&t; *  Generation Status = 1     (Original for Cat Code 12)&n;&t; *  Cat Code          = 12    (Digital Signal Mixer)&n;&t; *  Mode              = 0     (Mode 0)&n;&t; *  Emphasis          = 0     (None)&n;&t; *  CP                = 1     (Copyright unasserted)&n;&t; *  AN                = 0     (Audio data)&n;&t; *  P                 = 0     (Consumer)&n;&t; */
id|snd_emu10k1x_ptr_write
c_func
(paren
id|chip
comma
id|SPCS0
comma
l_int|0
comma
id|chip-&gt;spdif_bits
(braket
l_int|0
)braket
op_assign
id|SPCS_CLKACCY_1000PPM
op_or
id|SPCS_SAMPLERATE_48
op_or
id|SPCS_CHANNELNUM_LEFT
op_or
id|SPCS_SOURCENUM_UNSPEC
op_or
id|SPCS_GENERATIONSTATUS
op_or
l_int|0x00001200
op_or
l_int|0x00000000
op_or
id|SPCS_EMPHASIS_NONE
op_or
id|SPCS_COPYRIGHT
)paren
suffix:semicolon
id|snd_emu10k1x_ptr_write
c_func
(paren
id|chip
comma
id|SPCS1
comma
l_int|0
comma
id|chip-&gt;spdif_bits
(braket
l_int|1
)braket
op_assign
id|SPCS_CLKACCY_1000PPM
op_or
id|SPCS_SAMPLERATE_48
op_or
id|SPCS_CHANNELNUM_LEFT
op_or
id|SPCS_SOURCENUM_UNSPEC
op_or
id|SPCS_GENERATIONSTATUS
op_or
l_int|0x00001200
op_or
l_int|0x00000000
op_or
id|SPCS_EMPHASIS_NONE
op_or
id|SPCS_COPYRIGHT
)paren
suffix:semicolon
id|snd_emu10k1x_ptr_write
c_func
(paren
id|chip
comma
id|SPCS2
comma
l_int|0
comma
id|chip-&gt;spdif_bits
(braket
l_int|2
)braket
op_assign
id|SPCS_CLKACCY_1000PPM
op_or
id|SPCS_SAMPLERATE_48
op_or
id|SPCS_CHANNELNUM_LEFT
op_or
id|SPCS_SOURCENUM_UNSPEC
op_or
id|SPCS_GENERATIONSTATUS
op_or
l_int|0x00001200
op_or
l_int|0x00000000
op_or
id|SPCS_EMPHASIS_NONE
op_or
id|SPCS_COPYRIGHT
)paren
suffix:semicolon
id|snd_emu10k1x_ptr_write
c_func
(paren
id|chip
comma
id|SPDIF_SELECT
comma
l_int|0
comma
l_int|0x700
)paren
suffix:semicolon
singleline_comment|// disable SPDIF
id|snd_emu10k1x_ptr_write
c_func
(paren
id|chip
comma
id|ROUTING
comma
l_int|0
comma
l_int|0x1003F
)paren
suffix:semicolon
singleline_comment|// routing
id|snd_emu10k1x_gpio_write
c_func
(paren
id|chip
comma
l_int|0x1080
)paren
suffix:semicolon
singleline_comment|// analog mode
id|outl
c_func
(paren
id|HCFG_LOCKSOUNDCACHE
op_or
id|HCFG_AUDIOENABLE
comma
id|chip-&gt;port
op_plus
id|HCFG
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|chip
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_emu10k1x_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
op_star
id|rchip
op_assign
id|chip
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_proc_reg_read
r_static
r_void
id|snd_emu10k1x_proc_reg_read
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|emu10k1x_t
op_star
id|emu
op_assign
id|entry-&gt;private_data
suffix:semicolon
r_int
r_int
id|value
comma
id|value1
comma
id|value2
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Registers:&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x20
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
id|value
op_assign
id|inl
c_func
(paren
id|emu-&gt;port
op_plus
id|i
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;emu_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Register %02X: %08lX&bslash;n&quot;
comma
id|i
comma
id|value
)paren
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;nRegisters&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|0x48
suffix:semicolon
id|i
op_increment
)paren
(brace
id|value
op_assign
id|snd_emu10k1x_ptr_read
c_func
(paren
id|emu
comma
id|i
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
l_int|0x10
op_logical_or
(paren
id|i
op_ge
l_int|0x20
op_logical_and
id|i
OL
l_int|0x40
)paren
)paren
(brace
id|value1
op_assign
id|snd_emu10k1x_ptr_read
c_func
(paren
id|emu
comma
id|i
comma
l_int|1
)paren
suffix:semicolon
id|value2
op_assign
id|snd_emu10k1x_ptr_read
c_func
(paren
id|emu
comma
id|i
comma
l_int|2
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%02X: %08lX %08lX %08lX&bslash;n&quot;
comma
id|i
comma
id|value
comma
id|value1
comma
id|value2
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%02X: %08lX&bslash;n&quot;
comma
id|i
comma
id|value
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|snd_emu10k1x_proc_reg_write
r_static
r_void
id|snd_emu10k1x_proc_reg_write
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|emu10k1x_t
op_star
id|emu
op_assign
id|entry-&gt;private_data
suffix:semicolon
r_char
id|line
(braket
l_int|64
)braket
suffix:semicolon
r_int
r_int
id|reg
comma
id|channel_id
comma
id|val
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|snd_info_get_line
c_func
(paren
id|buffer
comma
id|line
comma
r_sizeof
(paren
id|line
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|sscanf
c_func
(paren
id|line
comma
l_string|&quot;%x %x %x&quot;
comma
op_amp
id|reg
comma
op_amp
id|channel_id
comma
op_amp
id|val
)paren
op_ne
l_int|3
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|reg
OL
l_int|0x49
)paren
op_logical_and
(paren
id|reg
op_ge
l_int|0
)paren
op_logical_and
(paren
id|val
op_le
l_int|0xffffffff
)paren
op_logical_and
(paren
id|channel_id
op_ge
l_int|0
)paren
op_logical_and
(paren
id|channel_id
op_le
l_int|2
)paren
)paren
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|reg
comma
id|channel_id
comma
id|val
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_emu10k1x_proc_init
r_static
r_int
id|__devinit
id|snd_emu10k1x_proc_init
c_func
(paren
id|emu10k1x_t
op_star
id|emu
)paren
(brace
id|snd_info_entry_t
op_star
id|entry
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_card_proc_new
c_func
(paren
id|emu-&gt;card
comma
l_string|&quot;emu10k1x_regs&quot;
comma
op_amp
id|entry
)paren
)paren
(brace
id|snd_info_set_text_ops
c_func
(paren
id|entry
comma
id|emu
comma
l_int|1024
comma
id|snd_emu10k1x_proc_reg_read
)paren
suffix:semicolon
id|entry-&gt;c.text.write_size
op_assign
l_int|64
suffix:semicolon
id|entry-&gt;c.text.write
op_assign
id|snd_emu10k1x_proc_reg_write
suffix:semicolon
id|entry-&gt;private_data
op_assign
id|emu
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_shared_spdif_info
r_static
r_int
id|snd_emu10k1x_shared_spdif_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_shared_spdif_get
r_static
r_int
id|snd_emu10k1x_shared_spdif_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|emu10k1x_t
op_star
id|emu
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|snd_emu10k1x_ptr_read
c_func
(paren
id|emu
comma
id|SPDIF_SELECT
comma
l_int|0
)paren
op_eq
l_int|0x700
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_shared_spdif_put
r_static
r_int
id|snd_emu10k1x_shared_spdif_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|emu10k1x_t
op_star
id|emu
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|change
op_assign
l_int|0
suffix:semicolon
id|val
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
(brace
singleline_comment|// enable spdif output
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|SPDIF_SELECT
comma
l_int|0
comma
l_int|0x000
)paren
suffix:semicolon
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|ROUTING
comma
l_int|0
comma
l_int|0x700
)paren
suffix:semicolon
id|snd_emu10k1x_gpio_write
c_func
(paren
id|emu
comma
l_int|0x1000
)paren
suffix:semicolon
)brace
r_else
(brace
singleline_comment|// disable spdif output
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|SPDIF_SELECT
comma
l_int|0
comma
l_int|0x700
)paren
suffix:semicolon
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|ROUTING
comma
l_int|0
comma
l_int|0x1003F
)paren
suffix:semicolon
id|snd_emu10k1x_gpio_write
c_func
(paren
id|emu
comma
l_int|0x1080
)paren
suffix:semicolon
)brace
r_return
id|change
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_emu10k1x_shared_spdif
id|__devinitdata
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Analog/Digital Output Jack&quot;
comma
dot
id|info
op_assign
id|snd_emu10k1x_shared_spdif_info
comma
dot
id|get
op_assign
id|snd_emu10k1x_shared_spdif_get
comma
dot
id|put
op_assign
id|snd_emu10k1x_shared_spdif_put
)brace
suffix:semicolon
DECL|function|snd_emu10k1x_spdif_info
r_static
r_int
id|snd_emu10k1x_spdif_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_IEC958
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_spdif_get
r_static
r_int
id|snd_emu10k1x_spdif_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|emu10k1x_t
op_star
id|emu
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|idx
op_assign
id|snd_ctl_get_ioffidx
c_func
(paren
id|kcontrol
comma
op_amp
id|ucontrol-&gt;id
)paren
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_assign
(paren
id|emu-&gt;spdif_bits
(braket
id|idx
)braket
op_rshift
l_int|0
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|1
)braket
op_assign
(paren
id|emu-&gt;spdif_bits
(braket
id|idx
)braket
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|2
)braket
op_assign
(paren
id|emu-&gt;spdif_bits
(braket
id|idx
)braket
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
op_assign
(paren
id|emu-&gt;spdif_bits
(braket
id|idx
)braket
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_spdif_get_mask
r_static
r_int
id|snd_emu10k1x_spdif_get_mask
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_assign
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|1
)braket
op_assign
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|2
)braket
op_assign
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
op_assign
l_int|0xff
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_spdif_put
r_static
r_int
id|snd_emu10k1x_spdif_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|emu10k1x_t
op_star
id|emu
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|idx
op_assign
id|snd_ctl_get_ioffidx
c_func
(paren
id|kcontrol
comma
op_amp
id|ucontrol-&gt;id
)paren
suffix:semicolon
r_int
id|change
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
(paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_lshift
l_int|0
)paren
op_or
(paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|2
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
op_lshift
l_int|24
)paren
suffix:semicolon
id|change
op_assign
id|val
op_ne
id|emu-&gt;spdif_bits
(braket
id|idx
)braket
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
(brace
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|SPCS0
op_plus
id|idx
comma
l_int|0
comma
id|val
)paren
suffix:semicolon
id|emu-&gt;spdif_bits
(braket
id|idx
)braket
op_assign
id|val
suffix:semicolon
)brace
r_return
id|change
suffix:semicolon
)brace
DECL|variable|snd_emu10k1x_spdif_mask_control
r_static
id|snd_kcontrol_new_t
id|snd_emu10k1x_spdif_mask_control
op_assign
(brace
dot
id|access
op_assign
id|SNDRV_CTL_ELEM_ACCESS_READ
comma
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|PLAYBACK
comma
id|MASK
)paren
comma
dot
id|count
op_assign
l_int|3
comma
dot
id|info
op_assign
id|snd_emu10k1x_spdif_info
comma
dot
id|get
op_assign
id|snd_emu10k1x_spdif_get_mask
)brace
suffix:semicolon
DECL|variable|snd_emu10k1x_spdif_control
r_static
id|snd_kcontrol_new_t
id|snd_emu10k1x_spdif_control
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|PLAYBACK
comma
id|DEFAULT
)paren
comma
dot
id|count
op_assign
l_int|3
comma
dot
id|info
op_assign
id|snd_emu10k1x_spdif_info
comma
dot
id|get
op_assign
id|snd_emu10k1x_spdif_get
comma
dot
id|put
op_assign
id|snd_emu10k1x_spdif_put
)brace
suffix:semicolon
DECL|function|snd_emu10k1x_mixer
r_static
r_int
id|__devinit
id|snd_emu10k1x_mixer
c_func
(paren
id|emu10k1x_t
op_star
id|emu
)paren
(brace
r_int
id|err
suffix:semicolon
id|snd_kcontrol_t
op_star
id|kctl
suffix:semicolon
id|snd_card_t
op_star
id|card
op_assign
id|emu-&gt;card
suffix:semicolon
r_if
c_cond
(paren
(paren
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_emu10k1x_spdif_mask_control
comma
id|emu
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_emu10k1x_shared_spdif
comma
id|emu
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_emu10k1x_spdif_control
comma
id|emu
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
)paren
)paren
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|EMU10K1X_MIDI_MODE_INPUT
mdefine_line|#define EMU10K1X_MIDI_MODE_INPUT&t;(1&lt;&lt;0)
DECL|macro|EMU10K1X_MIDI_MODE_OUTPUT
mdefine_line|#define EMU10K1X_MIDI_MODE_OUTPUT&t;(1&lt;&lt;1)
DECL|function|mpu401_read
r_static
r_inline
r_int
r_char
id|mpu401_read
c_func
(paren
id|emu10k1x_t
op_star
id|emu
comma
id|emu10k1x_midi_t
op_star
id|mpu
comma
r_int
id|idx
)paren
(brace
r_return
(paren
r_int
r_char
)paren
id|snd_emu10k1x_ptr_read
c_func
(paren
id|emu
comma
id|mpu-&gt;port
op_plus
id|idx
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|mpu401_write
r_static
r_inline
r_void
id|mpu401_write
c_func
(paren
id|emu10k1x_t
op_star
id|emu
comma
id|emu10k1x_midi_t
op_star
id|mpu
comma
r_int
id|data
comma
r_int
id|idx
)paren
(brace
id|snd_emu10k1x_ptr_write
c_func
(paren
id|emu
comma
id|mpu-&gt;port
op_plus
id|idx
comma
l_int|0
comma
id|data
)paren
suffix:semicolon
)brace
DECL|macro|mpu401_write_data
mdefine_line|#define mpu401_write_data(emu, mpu, data)&t;mpu401_write(emu, mpu, data, 0)
DECL|macro|mpu401_write_cmd
mdefine_line|#define mpu401_write_cmd(emu, mpu, data)&t;mpu401_write(emu, mpu, data, 1)
DECL|macro|mpu401_read_data
mdefine_line|#define mpu401_read_data(emu, mpu)&t;&t;mpu401_read(emu, mpu, 0)
DECL|macro|mpu401_read_stat
mdefine_line|#define mpu401_read_stat(emu, mpu)&t;&t;mpu401_read(emu, mpu, 1)
DECL|macro|mpu401_input_avail
mdefine_line|#define mpu401_input_avail(emu,mpu)&t;(!(mpu401_read_stat(emu,mpu) &amp; 0x80))
DECL|macro|mpu401_output_ready
mdefine_line|#define mpu401_output_ready(emu,mpu)&t;(!(mpu401_read_stat(emu,mpu) &amp; 0x40))
DECL|macro|MPU401_RESET
mdefine_line|#define MPU401_RESET&t;&t;0xff
DECL|macro|MPU401_ENTER_UART
mdefine_line|#define MPU401_ENTER_UART&t;0x3f
DECL|macro|MPU401_ACK
mdefine_line|#define MPU401_ACK&t;&t;0xfe
DECL|function|mpu401_clear_rx
r_static
r_void
id|mpu401_clear_rx
c_func
(paren
id|emu10k1x_t
op_star
id|emu
comma
id|emu10k1x_midi_t
op_star
id|mpu
)paren
(brace
r_int
id|timeout
op_assign
l_int|100000
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|timeout
OG
l_int|0
op_logical_and
id|mpu401_input_avail
c_func
(paren
id|emu
comma
id|mpu
)paren
suffix:semicolon
id|timeout
op_decrement
)paren
id|mpu401_read_data
c_func
(paren
id|emu
comma
id|mpu
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SND_DEBUG
r_if
c_cond
(paren
id|timeout
op_le
l_int|0
)paren
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cmd: clear rx timeout (status = 0x%x)&bslash;n&quot;
comma
id|mpu401_read_stat
c_func
(paren
id|emu
comma
id|mpu
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n;&n; */
DECL|function|do_emu10k1x_midi_interrupt
r_static
r_void
id|do_emu10k1x_midi_interrupt
c_func
(paren
id|emu10k1x_t
op_star
id|emu
comma
id|emu10k1x_midi_t
op_star
id|midi
comma
r_int
r_int
id|status
)paren
(brace
r_int
r_char
id|byte
suffix:semicolon
r_if
c_cond
(paren
id|midi-&gt;rmidi
op_eq
l_int|NULL
)paren
(brace
id|snd_emu10k1x_intr_disable
c_func
(paren
id|emu
comma
id|midi-&gt;tx_enable
op_or
id|midi-&gt;rx_enable
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|spin_lock
c_func
(paren
op_amp
id|midi-&gt;input_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|midi-&gt;ipr_rx
)paren
op_logical_and
id|mpu401_input_avail
c_func
(paren
id|emu
comma
id|midi
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|midi-&gt;midi_mode
op_amp
id|EMU10K1X_MIDI_MODE_INPUT
)paren
)paren
(brace
id|mpu401_clear_rx
c_func
(paren
id|emu
comma
id|midi
)paren
suffix:semicolon
)brace
r_else
(brace
id|byte
op_assign
id|mpu401_read_data
c_func
(paren
id|emu
comma
id|midi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|midi-&gt;substream_input
)paren
id|snd_rawmidi_receive
c_func
(paren
id|midi-&gt;substream_input
comma
op_amp
id|byte
comma
l_int|1
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock
c_func
(paren
op_amp
id|midi-&gt;input_lock
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|midi-&gt;output_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|midi-&gt;ipr_tx
)paren
op_logical_and
id|mpu401_output_ready
c_func
(paren
id|emu
comma
id|midi
)paren
)paren
(brace
r_if
c_cond
(paren
id|midi-&gt;substream_output
op_logical_and
id|snd_rawmidi_transmit
c_func
(paren
id|midi-&gt;substream_output
comma
op_amp
id|byte
comma
l_int|1
)paren
op_eq
l_int|1
)paren
(brace
id|mpu401_write_data
c_func
(paren
id|emu
comma
id|midi
comma
id|byte
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_emu10k1x_intr_disable
c_func
(paren
id|emu
comma
id|midi-&gt;tx_enable
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock
c_func
(paren
op_amp
id|midi-&gt;output_lock
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_midi_interrupt
r_static
r_void
id|snd_emu10k1x_midi_interrupt
c_func
(paren
id|emu10k1x_t
op_star
id|emu
comma
r_int
r_int
id|status
)paren
(brace
id|do_emu10k1x_midi_interrupt
c_func
(paren
id|emu
comma
op_amp
id|emu-&gt;midi
comma
id|status
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_midi_cmd
r_static
r_void
id|snd_emu10k1x_midi_cmd
c_func
(paren
id|emu10k1x_t
op_star
id|emu
comma
id|emu10k1x_midi_t
op_star
id|midi
comma
r_int
r_char
id|cmd
comma
r_int
id|ack
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|timeout
comma
id|ok
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|midi-&gt;input_lock
comma
id|flags
)paren
suffix:semicolon
id|mpu401_write_data
c_func
(paren
id|emu
comma
id|midi
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* mpu401_clear_rx(emu, midi); */
id|mpu401_write_cmd
c_func
(paren
id|emu
comma
id|midi
comma
id|cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ack
)paren
(brace
id|ok
op_assign
l_int|0
suffix:semicolon
id|timeout
op_assign
l_int|10000
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|ok
op_logical_and
id|timeout
op_decrement
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|mpu401_input_avail
c_func
(paren
id|emu
comma
id|midi
)paren
)paren
(brace
r_if
c_cond
(paren
id|mpu401_read_data
c_func
(paren
id|emu
comma
id|midi
)paren
op_eq
id|MPU401_ACK
)paren
id|ok
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|ok
op_logical_and
id|mpu401_read_data
c_func
(paren
id|emu
comma
id|midi
)paren
op_eq
id|MPU401_ACK
)paren
id|ok
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|ok
op_assign
l_int|1
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|midi-&gt;input_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ok
)paren
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;midi_cmd: 0x%x failed at 0x%lx (status = 0x%x, data = 0x%x)!!!&bslash;n&quot;
comma
id|cmd
comma
id|emu-&gt;port
comma
id|mpu401_read_stat
c_func
(paren
id|emu
comma
id|midi
)paren
comma
id|mpu401_read_data
c_func
(paren
id|emu
comma
id|midi
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_midi_input_open
r_static
r_int
id|snd_emu10k1x_midi_input_open
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1x_t
op_star
id|emu
suffix:semicolon
id|emu10k1x_midi_t
op_star
id|midi
op_assign
(paren
id|emu10k1x_midi_t
op_star
)paren
id|substream-&gt;rmidi-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|emu
op_assign
id|midi-&gt;emu
suffix:semicolon
id|snd_assert
c_func
(paren
id|emu
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|midi-&gt;open_lock
comma
id|flags
)paren
suffix:semicolon
id|midi-&gt;midi_mode
op_or_assign
id|EMU10K1X_MIDI_MODE_INPUT
suffix:semicolon
id|midi-&gt;substream_input
op_assign
id|substream
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|midi-&gt;midi_mode
op_amp
id|EMU10K1X_MIDI_MODE_OUTPUT
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|midi-&gt;open_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_emu10k1x_midi_cmd
c_func
(paren
id|emu
comma
id|midi
comma
id|MPU401_RESET
comma
l_int|1
)paren
suffix:semicolon
id|snd_emu10k1x_midi_cmd
c_func
(paren
id|emu
comma
id|midi
comma
id|MPU401_ENTER_UART
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|midi-&gt;open_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_midi_output_open
r_static
r_int
id|snd_emu10k1x_midi_output_open
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1x_t
op_star
id|emu
suffix:semicolon
id|emu10k1x_midi_t
op_star
id|midi
op_assign
(paren
id|emu10k1x_midi_t
op_star
)paren
id|substream-&gt;rmidi-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|emu
op_assign
id|midi-&gt;emu
suffix:semicolon
id|snd_assert
c_func
(paren
id|emu
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|midi-&gt;open_lock
comma
id|flags
)paren
suffix:semicolon
id|midi-&gt;midi_mode
op_or_assign
id|EMU10K1X_MIDI_MODE_OUTPUT
suffix:semicolon
id|midi-&gt;substream_output
op_assign
id|substream
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|midi-&gt;midi_mode
op_amp
id|EMU10K1X_MIDI_MODE_INPUT
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|midi-&gt;open_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_emu10k1x_midi_cmd
c_func
(paren
id|emu
comma
id|midi
comma
id|MPU401_RESET
comma
l_int|1
)paren
suffix:semicolon
id|snd_emu10k1x_midi_cmd
c_func
(paren
id|emu
comma
id|midi
comma
id|MPU401_ENTER_UART
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|midi-&gt;open_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_midi_input_close
r_static
r_int
id|snd_emu10k1x_midi_input_close
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1x_t
op_star
id|emu
suffix:semicolon
id|emu10k1x_midi_t
op_star
id|midi
op_assign
(paren
id|emu10k1x_midi_t
op_star
)paren
id|substream-&gt;rmidi-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|emu
op_assign
id|midi-&gt;emu
suffix:semicolon
id|snd_assert
c_func
(paren
id|emu
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|midi-&gt;open_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_emu10k1x_intr_disable
c_func
(paren
id|emu
comma
id|midi-&gt;rx_enable
)paren
suffix:semicolon
id|midi-&gt;midi_mode
op_and_assign
op_complement
id|EMU10K1X_MIDI_MODE_INPUT
suffix:semicolon
id|midi-&gt;substream_input
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|midi-&gt;midi_mode
op_amp
id|EMU10K1X_MIDI_MODE_OUTPUT
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|midi-&gt;open_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_emu10k1x_midi_cmd
c_func
(paren
id|emu
comma
id|midi
comma
id|MPU401_RESET
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|midi-&gt;open_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_midi_output_close
r_static
r_int
id|snd_emu10k1x_midi_output_close
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1x_t
op_star
id|emu
suffix:semicolon
id|emu10k1x_midi_t
op_star
id|midi
op_assign
(paren
id|emu10k1x_midi_t
op_star
)paren
id|substream-&gt;rmidi-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|emu
op_assign
id|midi-&gt;emu
suffix:semicolon
id|snd_assert
c_func
(paren
id|emu
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|midi-&gt;open_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_emu10k1x_intr_disable
c_func
(paren
id|emu
comma
id|midi-&gt;tx_enable
)paren
suffix:semicolon
id|midi-&gt;midi_mode
op_and_assign
op_complement
id|EMU10K1X_MIDI_MODE_OUTPUT
suffix:semicolon
id|midi-&gt;substream_output
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|midi-&gt;midi_mode
op_amp
id|EMU10K1X_MIDI_MODE_INPUT
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|midi-&gt;open_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_emu10k1x_midi_cmd
c_func
(paren
id|emu
comma
id|midi
comma
id|MPU401_RESET
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|midi-&gt;open_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_midi_input_trigger
r_static
r_void
id|snd_emu10k1x_midi_input_trigger
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
r_int
id|up
)paren
(brace
id|emu10k1x_t
op_star
id|emu
suffix:semicolon
id|emu10k1x_midi_t
op_star
id|midi
op_assign
(paren
id|emu10k1x_midi_t
op_star
)paren
id|substream-&gt;rmidi-&gt;private_data
suffix:semicolon
id|emu
op_assign
id|midi-&gt;emu
suffix:semicolon
id|snd_assert
c_func
(paren
id|emu
comma
r_return
)paren
suffix:semicolon
r_if
c_cond
(paren
id|up
)paren
id|snd_emu10k1x_intr_enable
c_func
(paren
id|emu
comma
id|midi-&gt;rx_enable
)paren
suffix:semicolon
r_else
id|snd_emu10k1x_intr_disable
c_func
(paren
id|emu
comma
id|midi-&gt;rx_enable
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_midi_output_trigger
r_static
r_void
id|snd_emu10k1x_midi_output_trigger
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
r_int
id|up
)paren
(brace
id|emu10k1x_t
op_star
id|emu
suffix:semicolon
id|emu10k1x_midi_t
op_star
id|midi
op_assign
(paren
id|emu10k1x_midi_t
op_star
)paren
id|substream-&gt;rmidi-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|emu
op_assign
id|midi-&gt;emu
suffix:semicolon
id|snd_assert
c_func
(paren
id|emu
comma
r_return
)paren
suffix:semicolon
r_if
c_cond
(paren
id|up
)paren
(brace
r_int
id|max
op_assign
l_int|4
suffix:semicolon
r_int
r_char
id|byte
suffix:semicolon
multiline_comment|/* try to send some amount of bytes here before interrupts */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|midi-&gt;output_lock
comma
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
id|max
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|mpu401_output_ready
c_func
(paren
id|emu
comma
id|midi
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|midi-&gt;midi_mode
op_amp
id|EMU10K1X_MIDI_MODE_OUTPUT
)paren
op_logical_or
id|snd_rawmidi_transmit
c_func
(paren
id|substream
comma
op_amp
id|byte
comma
l_int|1
)paren
op_ne
l_int|1
)paren
(brace
multiline_comment|/* no more data */
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|midi-&gt;output_lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|mpu401_write_data
c_func
(paren
id|emu
comma
id|midi
comma
id|byte
)paren
suffix:semicolon
id|max
op_decrement
suffix:semicolon
)brace
r_else
(brace
r_break
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|midi-&gt;output_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_emu10k1x_intr_enable
c_func
(paren
id|emu
comma
id|midi-&gt;tx_enable
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_emu10k1x_intr_disable
c_func
(paren
id|emu
comma
id|midi-&gt;tx_enable
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&n; */
DECL|variable|snd_emu10k1x_midi_output
r_static
id|snd_rawmidi_ops_t
id|snd_emu10k1x_midi_output
op_assign
(brace
dot
id|open
op_assign
id|snd_emu10k1x_midi_output_open
comma
dot
id|close
op_assign
id|snd_emu10k1x_midi_output_close
comma
dot
id|trigger
op_assign
id|snd_emu10k1x_midi_output_trigger
comma
)brace
suffix:semicolon
DECL|variable|snd_emu10k1x_midi_input
r_static
id|snd_rawmidi_ops_t
id|snd_emu10k1x_midi_input
op_assign
(brace
dot
id|open
op_assign
id|snd_emu10k1x_midi_input_open
comma
dot
id|close
op_assign
id|snd_emu10k1x_midi_input_close
comma
dot
id|trigger
op_assign
id|snd_emu10k1x_midi_input_trigger
comma
)brace
suffix:semicolon
DECL|function|snd_emu10k1x_midi_free
r_static
r_void
id|snd_emu10k1x_midi_free
c_func
(paren
id|snd_rawmidi_t
op_star
id|rmidi
)paren
(brace
id|emu10k1x_midi_t
op_star
id|midi
op_assign
(paren
id|emu10k1x_midi_t
op_star
)paren
id|rmidi-&gt;private_data
suffix:semicolon
id|midi-&gt;interrupt
op_assign
l_int|NULL
suffix:semicolon
id|midi-&gt;rmidi
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|emu10k1x_midi_init
r_static
r_int
id|__devinit
id|emu10k1x_midi_init
c_func
(paren
id|emu10k1x_t
op_star
id|emu
comma
id|emu10k1x_midi_t
op_star
id|midi
comma
r_int
id|device
comma
r_char
op_star
id|name
)paren
(brace
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_rawmidi_new
c_func
(paren
id|emu-&gt;card
comma
id|name
comma
id|device
comma
l_int|1
comma
l_int|1
comma
op_amp
id|rmidi
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|midi-&gt;emu
op_assign
id|emu
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|midi-&gt;open_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|midi-&gt;input_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|midi-&gt;output_lock
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|rmidi-&gt;name
comma
id|name
)paren
suffix:semicolon
id|snd_rawmidi_set_ops
c_func
(paren
id|rmidi
comma
id|SNDRV_RAWMIDI_STREAM_OUTPUT
comma
op_amp
id|snd_emu10k1x_midi_output
)paren
suffix:semicolon
id|snd_rawmidi_set_ops
c_func
(paren
id|rmidi
comma
id|SNDRV_RAWMIDI_STREAM_INPUT
comma
op_amp
id|snd_emu10k1x_midi_input
)paren
suffix:semicolon
id|rmidi-&gt;info_flags
op_or_assign
id|SNDRV_RAWMIDI_INFO_OUTPUT
op_or
id|SNDRV_RAWMIDI_INFO_INPUT
op_or
id|SNDRV_RAWMIDI_INFO_DUPLEX
suffix:semicolon
id|rmidi-&gt;private_data
op_assign
id|midi
suffix:semicolon
id|rmidi-&gt;private_free
op_assign
id|snd_emu10k1x_midi_free
suffix:semicolon
id|midi-&gt;rmidi
op_assign
id|rmidi
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_midi
r_static
r_int
id|__devinit
id|snd_emu10k1x_midi
c_func
(paren
id|emu10k1x_t
op_star
id|emu
)paren
(brace
id|emu10k1x_midi_t
op_star
id|midi
op_assign
op_amp
id|emu-&gt;midi
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|emu10k1x_midi_init
c_func
(paren
id|emu
comma
id|midi
comma
l_int|0
comma
l_string|&quot;EMU10K1X MPU-401 (UART)&quot;
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|midi-&gt;tx_enable
op_assign
id|INTE_MIDITXENABLE
suffix:semicolon
id|midi-&gt;rx_enable
op_assign
id|INTE_MIDIRXENABLE
suffix:semicolon
id|midi-&gt;port
op_assign
id|MUDATA
suffix:semicolon
id|midi-&gt;ipr_tx
op_assign
id|IPR_MIDITRANSBUFEMPTY
suffix:semicolon
id|midi-&gt;ipr_rx
op_assign
id|IPR_MIDIRECVBUFEMPTY
suffix:semicolon
id|midi-&gt;interrupt
op_assign
id|snd_emu10k1x_midi_interrupt
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_probe
r_static
r_int
id|__devinit
id|snd_emu10k1x_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_const
r_struct
id|pci_device_id
op_star
id|pci_id
)paren
(brace
r_static
r_int
id|dev
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
id|emu10k1x_t
op_star
id|chip
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_ge
id|SNDRV_CARDS
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|enable
(braket
id|dev
)braket
)paren
(brace
id|dev
op_increment
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|card
op_assign
id|snd_card_new
c_func
(paren
id|index
(braket
id|dev
)braket
comma
id|id
(braket
id|dev
)braket
comma
id|THIS_MODULE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_emu10k1x_create
c_func
(paren
id|card
comma
id|pci
comma
op_amp
id|chip
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_emu10k1x_pcm
c_func
(paren
id|chip
comma
l_int|0
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_emu10k1x_pcm
c_func
(paren
id|chip
comma
l_int|1
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_emu10k1x_pcm
c_func
(paren
id|chip
comma
l_int|2
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_emu10k1x_ac97
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_emu10k1x_mixer
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_emu10k1x_midi
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|snd_emu10k1x_proc_init
c_func
(paren
id|chip
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;EMU10K1X&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;shortname
comma
l_string|&quot;Dell Sound Blaster Live!&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;%s at 0x%lx irq %i&quot;
comma
id|card-&gt;shortname
comma
id|chip-&gt;port
comma
id|chip-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_card_register
c_func
(paren
id|card
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pci
comma
id|card
)paren
suffix:semicolon
id|dev
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1x_remove
r_static
r_void
id|__devexit
id|snd_emu10k1x_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
id|snd_card_free
c_func
(paren
id|pci_get_drvdata
c_func
(paren
id|pci
)paren
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci
comma
l_int|NULL
)paren
suffix:semicolon
)brace
singleline_comment|// PCI IDs
DECL|variable|snd_emu10k1x_ids
r_static
r_struct
id|pci_device_id
id|snd_emu10k1x_ids
(braket
)braket
op_assign
(brace
(brace
l_int|0x1102
comma
l_int|0x0006
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* Dell OEM version (EMU10K1) */
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|snd_emu10k1x_ids
)paren
suffix:semicolon
singleline_comment|// pci_driver definition
DECL|variable|driver
r_static
r_struct
id|pci_driver
id|driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;EMU10K1X&quot;
comma
dot
id|id_table
op_assign
id|snd_emu10k1x_ids
comma
dot
id|probe
op_assign
id|snd_emu10k1x_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|snd_emu10k1x_remove
)paren
comma
)brace
suffix:semicolon
singleline_comment|// initialization of the module
DECL|function|alsa_card_emu10k1x_init
r_static
r_int
id|__init
id|alsa_card_emu10k1x_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_module_init
c_func
(paren
op_amp
id|driver
)paren
)paren
OG
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
singleline_comment|// clean up the module
DECL|function|alsa_card_emu10k1x_exit
r_static
r_void
id|__exit
id|alsa_card_emu10k1x_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|alsa_card_emu10k1x_init
)paren
id|module_exit
c_func
(paren
id|alsa_card_emu10k1x_exit
)paren
eof
