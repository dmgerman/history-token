multiline_comment|/*&n; *  Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *                   Creative Labs, Inc.&n; *  Routines for control of EMU10K1 chips / PCM routines&n; *&n; *  BUGS:&n; *    --&n; *&n; *  TODO:&n; *    --&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/time.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/emu10k1.h&gt;
DECL|function|snd_emu10k1_pcm_interrupt
r_static
r_void
id|snd_emu10k1_pcm_interrupt
c_func
(paren
id|emu10k1_t
op_star
id|emu
comma
id|emu10k1_voice_t
op_star
id|voice
)paren
(brace
id|emu10k1_pcm_t
op_star
id|epcm
suffix:semicolon
r_if
c_cond
(paren
(paren
id|epcm
op_assign
id|voice-&gt;epcm
)paren
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|epcm-&gt;substream
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;IRQ: position = 0x%x, period = 0x%x, size = 0x%x&bslash;n&quot;
comma
id|epcm-&gt;substream-&gt;runtime-&gt;hw
op_member_access_from_pointer
id|pointer
c_func
(paren
id|emu
comma
id|epcm-&gt;substream
)paren
comma
id|snd_pcm_lib_period_bytes
c_func
(paren
id|epcm-&gt;substream
)paren
comma
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|epcm-&gt;substream
)paren
)paren
suffix:semicolon
macro_line|#endif
id|snd_pcm_period_elapsed
c_func
(paren
id|epcm-&gt;substream
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1_pcm_ac97adc_interrupt
r_static
r_void
id|snd_emu10k1_pcm_ac97adc_interrupt
c_func
(paren
id|emu10k1_t
op_star
id|emu
comma
r_int
r_int
id|status
)paren
(brace
macro_line|#if 0
r_if
c_cond
(paren
id|status
op_amp
id|IPR_ADCBUFHALFFULL
)paren
(brace
r_if
c_cond
(paren
id|emu-&gt;pcm_capture_substream-&gt;runtime-&gt;mode
op_eq
id|SNDRV_PCM_MODE_FRAME
)paren
r_return
suffix:semicolon
)brace
macro_line|#endif
id|snd_pcm_period_elapsed
c_func
(paren
id|emu-&gt;pcm_capture_substream
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1_pcm_ac97mic_interrupt
r_static
r_void
id|snd_emu10k1_pcm_ac97mic_interrupt
c_func
(paren
id|emu10k1_t
op_star
id|emu
comma
r_int
r_int
id|status
)paren
(brace
macro_line|#if 0
r_if
c_cond
(paren
id|status
op_amp
id|IPR_MICBUFHALFFULL
)paren
(brace
r_if
c_cond
(paren
id|emu-&gt;pcm_capture_mic_substream-&gt;runtime-&gt;mode
op_eq
id|SNDRV_PCM_MODE_FRAME
)paren
r_return
suffix:semicolon
)brace
macro_line|#endif
id|snd_pcm_period_elapsed
c_func
(paren
id|emu-&gt;pcm_capture_mic_substream
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1_pcm_efx_interrupt
r_static
r_void
id|snd_emu10k1_pcm_efx_interrupt
c_func
(paren
id|emu10k1_t
op_star
id|emu
comma
r_int
r_int
id|status
)paren
(brace
macro_line|#if 0
r_if
c_cond
(paren
id|status
op_amp
id|IPR_EFXBUFHALFFULL
)paren
(brace
r_if
c_cond
(paren
id|emu-&gt;pcm_capture_efx_substream-&gt;runtime-&gt;mode
op_eq
id|SNDRV_PCM_MODE_FRAME
)paren
r_return
suffix:semicolon
)brace
macro_line|#endif
id|snd_pcm_period_elapsed
c_func
(paren
id|emu-&gt;pcm_capture_efx_substream
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1_efx_playback_pointer
r_static
id|snd_pcm_uframes_t
id|snd_emu10k1_efx_playback_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_int
r_int
id|ptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|epcm-&gt;running
)paren
r_return
l_int|0
suffix:semicolon
id|ptr
op_assign
id|snd_emu10k1_ptr_read
c_func
(paren
id|emu
comma
id|CCCA
comma
id|epcm-&gt;voices
(braket
l_int|0
)braket
op_member_access_from_pointer
id|number
)paren
op_amp
l_int|0x00ffffff
suffix:semicolon
id|ptr
op_add_assign
id|runtime-&gt;buffer_size
suffix:semicolon
id|ptr
op_sub_assign
id|epcm-&gt;ccca_start_addr
suffix:semicolon
id|ptr
op_mod_assign
id|runtime-&gt;buffer_size
suffix:semicolon
r_return
id|ptr
suffix:semicolon
)brace
DECL|function|snd_emu10k1_pcm_channel_alloc
r_static
r_int
id|snd_emu10k1_pcm_channel_alloc
c_func
(paren
id|emu10k1_pcm_t
op_star
id|epcm
comma
r_int
id|voices
)paren
(brace
r_int
id|err
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
id|epcm-&gt;voices
(braket
l_int|1
)braket
op_ne
l_int|NULL
op_logical_and
id|voices
OL
l_int|2
)paren
(brace
id|snd_emu10k1_voice_free
c_func
(paren
id|epcm-&gt;emu
comma
id|epcm-&gt;voices
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|epcm-&gt;voices
(braket
l_int|1
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|voices
op_eq
l_int|1
op_logical_and
id|epcm-&gt;voices
(braket
l_int|0
)braket
op_ne
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* already allocated */
r_if
c_cond
(paren
id|voices
op_eq
l_int|2
op_logical_and
id|epcm-&gt;voices
(braket
l_int|0
)braket
op_ne
l_int|NULL
op_logical_and
id|epcm-&gt;voices
(braket
l_int|1
)braket
op_ne
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|voices
OG
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|epcm-&gt;voices
(braket
l_int|0
)braket
op_ne
l_int|NULL
op_logical_and
id|epcm-&gt;voices
(braket
l_int|1
)braket
op_eq
l_int|NULL
)paren
(brace
id|snd_emu10k1_voice_free
c_func
(paren
id|epcm-&gt;emu
comma
id|epcm-&gt;voices
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|epcm-&gt;voices
(braket
l_int|0
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|err
op_assign
id|snd_emu10k1_voice_alloc
c_func
(paren
id|epcm-&gt;emu
comma
id|epcm-&gt;type
op_eq
id|PLAYBACK_EMUVOICE
ques
c_cond
id|EMU10K1_PCM
suffix:colon
id|EMU10K1_EFX
comma
id|voices
comma
op_amp
id|epcm-&gt;voices
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|epcm-&gt;voices
(braket
l_int|0
)braket
op_member_access_from_pointer
id|epcm
op_assign
id|epcm
suffix:semicolon
r_if
c_cond
(paren
id|voices
OG
l_int|1
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|voices
suffix:semicolon
id|i
op_increment
)paren
(brace
id|epcm-&gt;voices
(braket
id|i
)braket
op_assign
op_amp
id|epcm-&gt;emu-&gt;voices
(braket
id|epcm-&gt;voices
(braket
l_int|0
)braket
op_member_access_from_pointer
id|number
op_plus
id|i
)braket
suffix:semicolon
id|epcm-&gt;voices
(braket
id|i
)braket
op_member_access_from_pointer
id|epcm
op_assign
id|epcm
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|epcm-&gt;extra
op_eq
l_int|NULL
)paren
(brace
id|err
op_assign
id|snd_emu10k1_voice_alloc
c_func
(paren
id|epcm-&gt;emu
comma
id|epcm-&gt;type
op_eq
id|PLAYBACK_EMUVOICE
ques
c_cond
id|EMU10K1_PCM
suffix:colon
id|EMU10K1_EFX
comma
l_int|1
comma
op_amp
id|epcm-&gt;extra
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
singleline_comment|// printk(&quot;pcm_channel_alloc: failed extra: voices=%d, frame=%d&bslash;n&quot;, voices, frame);
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|voices
suffix:semicolon
id|i
op_increment
)paren
(brace
id|snd_emu10k1_voice_free
c_func
(paren
id|epcm-&gt;emu
comma
id|epcm-&gt;voices
(braket
id|i
)braket
)paren
suffix:semicolon
id|epcm-&gt;voices
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
id|epcm-&gt;extra-&gt;epcm
op_assign
id|epcm
suffix:semicolon
id|epcm-&gt;extra-&gt;interrupt
op_assign
id|snd_emu10k1_pcm_interrupt
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|capture_period_sizes
r_static
r_int
r_int
id|capture_period_sizes
(braket
l_int|31
)braket
op_assign
(brace
l_int|384
comma
l_int|448
comma
l_int|512
comma
l_int|640
comma
l_int|384
op_star
l_int|2
comma
l_int|448
op_star
l_int|2
comma
l_int|512
op_star
l_int|2
comma
l_int|640
op_star
l_int|2
comma
l_int|384
op_star
l_int|4
comma
l_int|448
op_star
l_int|4
comma
l_int|512
op_star
l_int|4
comma
l_int|640
op_star
l_int|4
comma
l_int|384
op_star
l_int|8
comma
l_int|448
op_star
l_int|8
comma
l_int|512
op_star
l_int|8
comma
l_int|640
op_star
l_int|8
comma
l_int|384
op_star
l_int|16
comma
l_int|448
op_star
l_int|16
comma
l_int|512
op_star
l_int|16
comma
l_int|640
op_star
l_int|16
comma
l_int|384
op_star
l_int|32
comma
l_int|448
op_star
l_int|32
comma
l_int|512
op_star
l_int|32
comma
l_int|640
op_star
l_int|32
comma
l_int|384
op_star
l_int|64
comma
l_int|448
op_star
l_int|64
comma
l_int|512
op_star
l_int|64
comma
l_int|640
op_star
l_int|64
comma
l_int|384
op_star
l_int|128
comma
l_int|448
op_star
l_int|128
comma
l_int|512
op_star
l_int|128
)brace
suffix:semicolon
DECL|variable|hw_constraints_capture_period_sizes
r_static
id|snd_pcm_hw_constraint_list_t
id|hw_constraints_capture_period_sizes
op_assign
(brace
dot
id|count
op_assign
l_int|31
comma
dot
id|list
op_assign
id|capture_period_sizes
comma
dot
id|mask
op_assign
l_int|0
)brace
suffix:semicolon
DECL|variable|capture_rates
r_static
r_int
r_int
id|capture_rates
(braket
l_int|8
)braket
op_assign
(brace
l_int|8000
comma
l_int|11025
comma
l_int|16000
comma
l_int|22050
comma
l_int|24000
comma
l_int|32000
comma
l_int|44100
comma
l_int|48000
)brace
suffix:semicolon
DECL|variable|hw_constraints_capture_rates
r_static
id|snd_pcm_hw_constraint_list_t
id|hw_constraints_capture_rates
op_assign
(brace
dot
id|count
op_assign
l_int|8
comma
dot
id|list
op_assign
id|capture_rates
comma
dot
id|mask
op_assign
l_int|0
)brace
suffix:semicolon
DECL|function|snd_emu10k1_capture_rate_reg
r_static
r_int
r_int
id|snd_emu10k1_capture_rate_reg
c_func
(paren
r_int
r_int
id|rate
)paren
(brace
r_switch
c_cond
(paren
id|rate
)paren
(brace
r_case
l_int|8000
suffix:colon
r_return
id|ADCCR_SAMPLERATE_8
suffix:semicolon
r_case
l_int|11025
suffix:colon
r_return
id|ADCCR_SAMPLERATE_11
suffix:semicolon
r_case
l_int|16000
suffix:colon
r_return
id|ADCCR_SAMPLERATE_16
suffix:semicolon
r_case
l_int|22050
suffix:colon
r_return
id|ADCCR_SAMPLERATE_22
suffix:semicolon
r_case
l_int|24000
suffix:colon
r_return
id|ADCCR_SAMPLERATE_24
suffix:semicolon
r_case
l_int|32000
suffix:colon
r_return
id|ADCCR_SAMPLERATE_32
suffix:semicolon
r_case
l_int|44100
suffix:colon
r_return
id|ADCCR_SAMPLERATE_44
suffix:semicolon
r_case
l_int|48000
suffix:colon
r_return
id|ADCCR_SAMPLERATE_48
suffix:semicolon
r_default
suffix:colon
id|snd_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
id|ADCCR_SAMPLERATE_8
suffix:semicolon
)brace
)brace
DECL|function|snd_emu10k1_audigy_capture_rate_reg
r_static
r_int
r_int
id|snd_emu10k1_audigy_capture_rate_reg
c_func
(paren
r_int
r_int
id|rate
)paren
(brace
r_switch
c_cond
(paren
id|rate
)paren
(brace
r_case
l_int|8000
suffix:colon
r_return
id|A_ADCCR_SAMPLERATE_8
suffix:semicolon
r_case
l_int|11025
suffix:colon
r_return
id|A_ADCCR_SAMPLERATE_11
suffix:semicolon
r_case
l_int|12000
suffix:colon
r_return
id|A_ADCCR_SAMPLERATE_12
suffix:semicolon
multiline_comment|/* really supported? */
r_case
l_int|16000
suffix:colon
r_return
id|ADCCR_SAMPLERATE_16
suffix:semicolon
r_case
l_int|22050
suffix:colon
r_return
id|ADCCR_SAMPLERATE_22
suffix:semicolon
r_case
l_int|24000
suffix:colon
r_return
id|ADCCR_SAMPLERATE_24
suffix:semicolon
r_case
l_int|32000
suffix:colon
r_return
id|ADCCR_SAMPLERATE_32
suffix:semicolon
r_case
l_int|44100
suffix:colon
r_return
id|ADCCR_SAMPLERATE_44
suffix:semicolon
r_case
l_int|48000
suffix:colon
r_return
id|ADCCR_SAMPLERATE_48
suffix:semicolon
r_default
suffix:colon
id|snd_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
id|A_ADCCR_SAMPLERATE_8
suffix:semicolon
)brace
)brace
DECL|function|emu10k1_calc_pitch_target
r_static
r_int
r_int
id|emu10k1_calc_pitch_target
c_func
(paren
r_int
r_int
id|rate
)paren
(brace
r_int
r_int
id|pitch_target
suffix:semicolon
id|pitch_target
op_assign
(paren
id|rate
op_lshift
l_int|8
)paren
op_div
l_int|375
suffix:semicolon
id|pitch_target
op_assign
(paren
id|pitch_target
op_rshift
l_int|1
)paren
op_plus
(paren
id|pitch_target
op_amp
l_int|1
)paren
suffix:semicolon
r_return
id|pitch_target
suffix:semicolon
)brace
DECL|macro|PITCH_48000
mdefine_line|#define PITCH_48000 0x00004000
DECL|macro|PITCH_96000
mdefine_line|#define PITCH_96000 0x00008000
DECL|macro|PITCH_85000
mdefine_line|#define PITCH_85000 0x00007155
DECL|macro|PITCH_80726
mdefine_line|#define PITCH_80726 0x00006ba2
DECL|macro|PITCH_67882
mdefine_line|#define PITCH_67882 0x00005a82
DECL|macro|PITCH_57081
mdefine_line|#define PITCH_57081 0x00004c1c
DECL|function|emu10k1_select_interprom
r_static
r_int
r_int
id|emu10k1_select_interprom
c_func
(paren
r_int
r_int
id|pitch_target
)paren
(brace
r_if
c_cond
(paren
id|pitch_target
op_eq
id|PITCH_48000
)paren
r_return
id|CCCA_INTERPROM_0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pitch_target
OL
id|PITCH_48000
)paren
r_return
id|CCCA_INTERPROM_1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pitch_target
op_ge
id|PITCH_96000
)paren
r_return
id|CCCA_INTERPROM_0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pitch_target
op_ge
id|PITCH_85000
)paren
r_return
id|CCCA_INTERPROM_6
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pitch_target
op_ge
id|PITCH_80726
)paren
r_return
id|CCCA_INTERPROM_5
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pitch_target
op_ge
id|PITCH_67882
)paren
r_return
id|CCCA_INTERPROM_4
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pitch_target
op_ge
id|PITCH_57081
)paren
r_return
id|CCCA_INTERPROM_3
suffix:semicolon
r_else
r_return
id|CCCA_INTERPROM_2
suffix:semicolon
)brace
DECL|function|snd_emu10k1_pcm_init_voice
r_static
r_void
id|snd_emu10k1_pcm_init_voice
c_func
(paren
id|emu10k1_t
op_star
id|emu
comma
r_int
id|master
comma
r_int
id|extra
comma
id|emu10k1_voice_t
op_star
id|evoice
comma
r_int
r_int
id|start_addr
comma
r_int
r_int
id|end_addr
)paren
(brace
id|snd_pcm_substream_t
op_star
id|substream
op_assign
id|evoice-&gt;epcm-&gt;substream
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1_pcm_mixer_t
op_star
id|mix
suffix:semicolon
r_int
r_int
id|silent_page
comma
id|tmp
suffix:semicolon
r_int
id|voice
comma
id|stereo
comma
id|w_16
suffix:semicolon
r_int
r_char
id|attn
comma
id|send_amount
(braket
l_int|8
)braket
suffix:semicolon
r_int
r_char
id|send_routing
(braket
l_int|8
)braket
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|pitch_target
suffix:semicolon
id|voice
op_assign
id|evoice-&gt;number
suffix:semicolon
r_if
c_cond
(paren
id|evoice-&gt;epcm-&gt;type
op_eq
id|PLAYBACK_EFX
)paren
id|mix
op_assign
op_amp
id|emu-&gt;efx_pcm_mixer
(braket
id|voice
op_minus
id|evoice-&gt;epcm-&gt;voices
(braket
l_int|0
)braket
op_member_access_from_pointer
id|number
)braket
suffix:semicolon
r_else
id|mix
op_assign
op_amp
id|emu-&gt;pcm_mixer
(braket
id|substream-&gt;number
)braket
suffix:semicolon
id|stereo
op_assign
id|runtime-&gt;channels
op_eq
l_int|2
suffix:semicolon
id|w_16
op_assign
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|16
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|extra
op_logical_and
id|stereo
)paren
(brace
id|start_addr
op_rshift_assign
l_int|1
suffix:semicolon
id|end_addr
op_rshift_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|w_16
)paren
(brace
id|start_addr
op_rshift_assign
l_int|1
suffix:semicolon
id|end_addr
op_rshift_assign
l_int|1
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|emu-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* volume parameters */
r_if
c_cond
(paren
id|extra
)paren
(brace
id|attn
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|send_routing
comma
l_int|0
comma
r_sizeof
(paren
id|send_routing
)paren
)paren
suffix:semicolon
id|send_routing
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|send_routing
(braket
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
id|send_routing
(braket
l_int|2
)braket
op_assign
l_int|2
suffix:semicolon
id|send_routing
(braket
l_int|3
)braket
op_assign
l_int|3
suffix:semicolon
id|memset
c_func
(paren
id|send_amount
comma
l_int|0
comma
r_sizeof
(paren
id|send_amount
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* mono, left, right (master voice = left) */
id|tmp
op_assign
id|stereo
ques
c_cond
(paren
id|master
ques
c_cond
l_int|1
suffix:colon
l_int|2
)paren
suffix:colon
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|send_routing
comma
op_amp
id|mix-&gt;send_routing
(braket
id|tmp
)braket
(braket
l_int|0
)braket
comma
l_int|8
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|send_amount
comma
op_amp
id|mix-&gt;send_volume
(braket
id|tmp
)braket
(braket
l_int|0
)braket
comma
l_int|8
)paren
suffix:semicolon
)brace
r_int
r_int
id|ccis
op_assign
id|stereo
ques
c_cond
l_int|28
suffix:colon
l_int|30
suffix:semicolon
r_if
c_cond
(paren
id|w_16
)paren
id|ccis
op_mul_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|master
)paren
(brace
id|evoice-&gt;epcm-&gt;ccca_start_addr
op_assign
id|start_addr
op_plus
id|ccis
suffix:semicolon
r_if
c_cond
(paren
id|extra
)paren
(brace
id|start_addr
op_add_assign
id|ccis
suffix:semicolon
id|end_addr
op_add_assign
id|ccis
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stereo
op_logical_and
op_logical_neg
id|extra
)paren
(brace
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|CPF
comma
id|voice
comma
id|CPF_STEREO_MASK
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|CPF
comma
(paren
id|voice
op_plus
l_int|1
)paren
comma
id|CPF_STEREO_MASK
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|CPF
comma
id|voice
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
singleline_comment|// setup routing
r_if
c_cond
(paren
id|emu-&gt;audigy
)paren
(brace
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|A_FXRT1
comma
id|voice
comma
id|snd_emu10k1_compose_audigy_fxrt1
c_func
(paren
id|send_routing
)paren
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|A_FXRT2
comma
id|voice
comma
id|snd_emu10k1_compose_audigy_fxrt2
c_func
(paren
id|send_routing
)paren
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|A_SENDAMOUNTS
comma
id|voice
comma
(paren
(paren
r_int
r_int
)paren
id|send_amount
(braket
l_int|4
)braket
op_lshift
l_int|24
)paren
op_or
(paren
(paren
r_int
r_int
)paren
id|send_amount
(braket
l_int|5
)braket
op_lshift
l_int|16
)paren
op_or
(paren
(paren
r_int
r_int
)paren
id|send_amount
(braket
l_int|6
)braket
op_lshift
l_int|8
)paren
op_or
(paren
r_int
r_int
)paren
id|send_amount
(braket
l_int|7
)braket
)paren
suffix:semicolon
)brace
r_else
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|FXRT
comma
id|voice
comma
id|snd_emu10k1_compose_send_routing
c_func
(paren
id|send_routing
)paren
)paren
suffix:semicolon
singleline_comment|// Stop CA
singleline_comment|// Assumption that PT is already 0 so no harm overwriting
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|PTRX
comma
id|voice
comma
(paren
id|send_amount
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
op_or
id|send_amount
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|DSL
comma
id|voice
comma
id|end_addr
op_or
(paren
id|send_amount
(braket
l_int|3
)braket
op_lshift
l_int|24
)paren
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|PSST
comma
id|voice
comma
id|start_addr
op_or
(paren
id|send_amount
(braket
l_int|2
)braket
op_lshift
l_int|24
)paren
)paren
suffix:semicolon
id|pitch_target
op_assign
id|emu10k1_calc_pitch_target
c_func
(paren
id|runtime-&gt;rate
)paren
suffix:semicolon
r_if
c_cond
(paren
id|extra
)paren
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|CCCA
comma
id|voice
comma
id|start_addr
op_or
id|emu10k1_select_interprom
c_func
(paren
id|pitch_target
)paren
op_or
(paren
id|w_16
ques
c_cond
l_int|0
suffix:colon
id|CCCA_8BITSELECT
)paren
)paren
suffix:semicolon
r_else
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|CCCA
comma
id|voice
comma
(paren
id|start_addr
op_plus
id|ccis
)paren
op_or
id|emu10k1_select_interprom
c_func
(paren
id|pitch_target
)paren
op_or
(paren
id|w_16
ques
c_cond
l_int|0
suffix:colon
id|CCCA_8BITSELECT
)paren
)paren
suffix:semicolon
singleline_comment|// Clear filter delay memory
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|Z1
comma
id|voice
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|Z2
comma
id|voice
comma
l_int|0
)paren
suffix:semicolon
singleline_comment|// invalidate maps
id|silent_page
op_assign
(paren
(paren
r_int
r_int
)paren
id|emu-&gt;silent_page.addr
op_lshift
l_int|1
)paren
op_or
id|MAP_PTI_MASK
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|MAPA
comma
id|voice
comma
id|silent_page
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|MAPB
comma
id|voice
comma
id|silent_page
)paren
suffix:semicolon
singleline_comment|// modulation envelope
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|CVCF
comma
id|voice
comma
l_int|0xffff
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|VTFT
comma
id|voice
comma
l_int|0xffff
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|ATKHLDM
comma
id|voice
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|DCYSUSM
comma
id|voice
comma
l_int|0x007f
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|LFOVAL1
comma
id|voice
comma
l_int|0x8000
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|LFOVAL2
comma
id|voice
comma
l_int|0x8000
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|FMMOD
comma
id|voice
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|TREMFRQ
comma
id|voice
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|FM2FRQ2
comma
id|voice
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|ENVVAL
comma
id|voice
comma
l_int|0x8000
)paren
suffix:semicolon
singleline_comment|// volume envelope
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|ATKHLDV
comma
id|voice
comma
l_int|0x7f7f
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|ENVVOL
comma
id|voice
comma
l_int|0x0000
)paren
suffix:semicolon
singleline_comment|// filter envelope
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|PEFE_FILTERAMOUNT
comma
id|voice
comma
l_int|0x7f
)paren
suffix:semicolon
singleline_comment|// pitch envelope
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|PEFE_PITCHAMOUNT
comma
id|voice
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|emu-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1_playback_hw_params
r_static
r_int
id|snd_emu10k1_playback_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_emu10k1_pcm_channel_alloc
c_func
(paren
id|epcm
comma
id|params_channels
c_func
(paren
id|hw_params
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|err
OG
l_int|0
)paren
(brace
multiline_comment|/* change */
id|snd_util_memblk_t
op_star
id|memblk
suffix:semicolon
r_if
c_cond
(paren
id|epcm-&gt;memblk
op_ne
l_int|NULL
)paren
id|snd_emu10k1_free_pages
c_func
(paren
id|emu
comma
id|epcm-&gt;memblk
)paren
suffix:semicolon
id|memblk
op_assign
id|snd_emu10k1_alloc_pages
c_func
(paren
id|emu
comma
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|epcm-&gt;memblk
op_assign
id|memblk
)paren
op_eq
l_int|NULL
op_logical_or
(paren
(paren
id|emu10k1_memblk_t
op_star
)paren
id|memblk
)paren
op_member_access_from_pointer
id|mapped_page
OL
l_int|0
)paren
(brace
id|epcm-&gt;start_addr
op_assign
l_int|0
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|epcm-&gt;start_addr
op_assign
(paren
(paren
id|emu10k1_memblk_t
op_star
)paren
id|memblk
)paren
op_member_access_from_pointer
id|mapped_page
op_lshift
id|PAGE_SHIFT
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_playback_hw_free
r_static
r_int
id|snd_emu10k1_playback_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1_pcm_t
op_star
id|epcm
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;private_data
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
id|epcm-&gt;extra
)paren
(brace
id|snd_emu10k1_voice_free
c_func
(paren
id|epcm-&gt;emu
comma
id|epcm-&gt;extra
)paren
suffix:semicolon
id|epcm-&gt;extra
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|epcm-&gt;voices
(braket
l_int|1
)braket
)paren
(brace
id|snd_emu10k1_voice_free
c_func
(paren
id|epcm-&gt;emu
comma
id|epcm-&gt;voices
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|epcm-&gt;voices
(braket
l_int|1
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|epcm-&gt;voices
(braket
l_int|0
)braket
)paren
(brace
id|snd_emu10k1_voice_free
c_func
(paren
id|epcm-&gt;emu
comma
id|epcm-&gt;voices
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|epcm-&gt;voices
(braket
l_int|0
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|epcm-&gt;memblk
)paren
(brace
id|snd_emu10k1_free_pages
c_func
(paren
id|emu
comma
id|epcm-&gt;memblk
)paren
suffix:semicolon
id|epcm-&gt;memblk
op_assign
l_int|NULL
suffix:semicolon
id|epcm-&gt;start_addr
op_assign
l_int|0
suffix:semicolon
)brace
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_efx_playback_hw_free
r_static
r_int
id|snd_emu10k1_efx_playback_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1_pcm_t
op_star
id|epcm
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;private_data
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_if
c_cond
(paren
id|epcm-&gt;extra
)paren
(brace
id|snd_emu10k1_voice_free
c_func
(paren
id|epcm-&gt;emu
comma
id|epcm-&gt;extra
)paren
suffix:semicolon
id|epcm-&gt;extra
op_assign
l_int|NULL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_EFX_PLAYBACK
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|epcm-&gt;voices
(braket
id|i
)braket
)paren
(brace
id|snd_emu10k1_voice_free
c_func
(paren
id|epcm-&gt;emu
comma
id|epcm-&gt;voices
(braket
id|i
)braket
)paren
suffix:semicolon
id|epcm-&gt;voices
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|epcm-&gt;memblk
)paren
(brace
id|snd_emu10k1_free_pages
c_func
(paren
id|emu
comma
id|epcm-&gt;memblk
)paren
suffix:semicolon
id|epcm-&gt;memblk
op_assign
l_int|NULL
suffix:semicolon
id|epcm-&gt;start_addr
op_assign
l_int|0
suffix:semicolon
)brace
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_playback_prepare
r_static
r_int
id|snd_emu10k1_playback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_int
r_int
id|start_addr
comma
id|end_addr
suffix:semicolon
id|start_addr
op_assign
id|epcm-&gt;start_addr
suffix:semicolon
id|end_addr
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;channels
op_eq
l_int|2
)paren
id|end_addr
op_rshift_assign
l_int|1
suffix:semicolon
id|end_addr
op_add_assign
id|start_addr
suffix:semicolon
id|snd_emu10k1_pcm_init_voice
c_func
(paren
id|emu
comma
l_int|1
comma
l_int|1
comma
id|epcm-&gt;extra
comma
id|start_addr
comma
id|end_addr
)paren
suffix:semicolon
id|end_addr
op_assign
id|epcm-&gt;start_addr
op_plus
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_emu10k1_pcm_init_voice
c_func
(paren
id|emu
comma
l_int|1
comma
l_int|0
comma
id|epcm-&gt;voices
(braket
l_int|0
)braket
comma
id|start_addr
comma
id|end_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|epcm-&gt;voices
(braket
l_int|1
)braket
)paren
id|snd_emu10k1_pcm_init_voice
c_func
(paren
id|emu
comma
l_int|0
comma
l_int|0
comma
id|epcm-&gt;voices
(braket
l_int|1
)braket
comma
id|start_addr
comma
id|end_addr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_efx_playback_prepare
r_static
r_int
id|snd_emu10k1_efx_playback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_int
r_int
id|start_addr
comma
id|end_addr
suffix:semicolon
id|start_addr
op_assign
id|epcm-&gt;start_addr
suffix:semicolon
id|end_addr
op_assign
id|epcm-&gt;start_addr
op_plus
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * the kX driver leaves some space between voices&n;&t; */
r_int
r_int
id|channel_size
suffix:semicolon
r_int
id|i
suffix:semicolon
id|channel_size
op_assign
(paren
id|end_addr
op_minus
id|start_addr
)paren
op_div
id|NUM_EFX_PLAYBACK
suffix:semicolon
id|snd_emu10k1_pcm_init_voice
c_func
(paren
id|emu
comma
l_int|1
comma
l_int|1
comma
id|epcm-&gt;extra
comma
id|start_addr
comma
id|start_addr
op_plus
(paren
id|channel_size
op_div
l_int|2
)paren
)paren
suffix:semicolon
multiline_comment|/* only difference with the master voice is we use it for the pointer */
id|snd_emu10k1_pcm_init_voice
c_func
(paren
id|emu
comma
l_int|1
comma
l_int|0
comma
id|epcm-&gt;voices
(braket
l_int|0
)braket
comma
id|start_addr
comma
id|start_addr
op_plus
id|channel_size
)paren
suffix:semicolon
id|start_addr
op_add_assign
id|channel_size
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|NUM_EFX_PLAYBACK
suffix:semicolon
id|i
op_increment
)paren
(brace
id|snd_emu10k1_pcm_init_voice
c_func
(paren
id|emu
comma
l_int|0
comma
l_int|0
comma
id|epcm-&gt;voices
(braket
id|i
)braket
comma
id|start_addr
comma
id|start_addr
op_plus
id|channel_size
)paren
suffix:semicolon
id|start_addr
op_add_assign
id|channel_size
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_emu10k1_efx_playback
r_static
id|snd_pcm_hardware_t
id|snd_emu10k1_efx_playback
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_NONINTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_PAUSE
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_48000
comma
dot
id|rate_min
op_assign
l_int|48000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
id|NUM_EFX_PLAYBACK
comma
dot
id|channels_max
op_assign
id|NUM_EFX_PLAYBACK
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|64
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|64
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|2
comma
dot
id|periods_max
op_assign
l_int|2
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|function|snd_emu10k1_capture_hw_params
r_static
r_int
id|snd_emu10k1_capture_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
r_return
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1_capture_hw_free
r_static
r_int
id|snd_emu10k1_capture_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1_capture_prepare
r_static
r_int
id|snd_emu10k1_capture_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_int
id|idx
suffix:semicolon
multiline_comment|/* zeroing the buffer size will stop capture */
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|epcm-&gt;capture_bs_reg
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|epcm-&gt;type
)paren
(brace
r_case
id|CAPTURE_AC97ADC
suffix:colon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|ADCCR
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CAPTURE_EFX
suffix:colon
r_if
c_cond
(paren
id|emu-&gt;audigy
)paren
(brace
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|A_FXWC1
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|A_FXWC2
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|FXWC
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|epcm-&gt;capture_ba_reg
comma
l_int|0
comma
id|runtime-&gt;dma_addr
)paren
suffix:semicolon
id|epcm-&gt;capture_bufsize
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|epcm-&gt;capture_bs_val
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|31
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
id|capture_period_sizes
(braket
id|idx
)braket
op_eq
id|epcm-&gt;capture_bufsize
)paren
(brace
id|epcm-&gt;capture_bs_val
op_assign
id|idx
op_plus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|epcm-&gt;capture_bs_val
op_eq
l_int|0
)paren
(brace
id|snd_BUG
c_func
(paren
)paren
suffix:semicolon
id|epcm-&gt;capture_bs_val
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|epcm-&gt;type
op_eq
id|CAPTURE_AC97ADC
)paren
(brace
id|epcm-&gt;capture_cr_val
op_assign
id|emu-&gt;audigy
ques
c_cond
id|A_ADCCR_LCHANENABLE
suffix:colon
id|ADCCR_LCHANENABLE
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;channels
OG
l_int|1
)paren
id|epcm-&gt;capture_cr_val
op_or_assign
id|emu-&gt;audigy
ques
c_cond
id|A_ADCCR_RCHANENABLE
suffix:colon
id|ADCCR_RCHANENABLE
suffix:semicolon
id|epcm-&gt;capture_cr_val
op_or_assign
id|emu-&gt;audigy
ques
c_cond
id|snd_emu10k1_audigy_capture_rate_reg
c_func
(paren
id|runtime-&gt;rate
)paren
suffix:colon
id|snd_emu10k1_capture_rate_reg
c_func
(paren
id|runtime-&gt;rate
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_playback_invalidate_cache
r_static
r_void
id|snd_emu10k1_playback_invalidate_cache
c_func
(paren
id|emu10k1_t
op_star
id|emu
comma
id|emu10k1_voice_t
op_star
id|evoice
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
suffix:semicolon
r_int
r_int
id|voice
comma
id|i
comma
id|ccis
comma
id|cra
op_assign
l_int|64
comma
id|cs
comma
id|sample
suffix:semicolon
r_if
c_cond
(paren
id|evoice
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|runtime
op_assign
id|evoice-&gt;epcm-&gt;substream-&gt;runtime
suffix:semicolon
id|voice
op_assign
id|evoice-&gt;number
suffix:semicolon
id|sample
op_assign
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|16
ques
c_cond
l_int|0
suffix:colon
l_int|0x80808080
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;channels
op_eq
l_int|2
)paren
(brace
id|ccis
op_assign
l_int|28
suffix:semicolon
id|cs
op_assign
l_int|4
suffix:semicolon
)brace
r_else
(brace
id|ccis
op_assign
l_int|30
suffix:semicolon
id|cs
op_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sample
op_eq
l_int|0
)paren
multiline_comment|/* 16-bit */
id|ccis
op_mul_assign
l_int|2
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cs
suffix:semicolon
id|i
op_increment
)paren
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|CD0
op_plus
id|i
comma
id|voice
comma
id|sample
)paren
suffix:semicolon
singleline_comment|// reset cache
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|CCR_CACHEINVALIDSIZE
comma
id|voice
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|CCR_READADDRESS
comma
id|voice
comma
id|cra
)paren
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;channels
op_eq
l_int|2
)paren
(brace
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|CCR_CACHEINVALIDSIZE
comma
id|voice
op_plus
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|CCR_READADDRESS
comma
id|voice
op_plus
l_int|1
comma
id|cra
)paren
suffix:semicolon
)brace
singleline_comment|// fill cache
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|CCR_CACHEINVALIDSIZE
comma
id|voice
comma
id|ccis
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1_playback_prepare_voice
r_static
r_void
id|snd_emu10k1_playback_prepare_voice
c_func
(paren
id|emu10k1_t
op_star
id|emu
comma
id|emu10k1_voice_t
op_star
id|evoice
comma
r_int
id|master
comma
r_int
id|extra
)paren
(brace
id|snd_pcm_substream_t
op_star
id|substream
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
suffix:semicolon
id|emu10k1_pcm_mixer_t
op_star
id|mix
suffix:semicolon
r_int
r_int
id|attn
suffix:semicolon
r_int
r_int
id|voice
comma
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|evoice
op_eq
l_int|NULL
)paren
multiline_comment|/* skip second voice for mono */
r_return
suffix:semicolon
id|substream
op_assign
id|evoice-&gt;epcm-&gt;substream
suffix:semicolon
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|voice
op_assign
id|evoice-&gt;number
suffix:semicolon
id|mix
op_assign
id|evoice-&gt;epcm-&gt;type
op_eq
id|PLAYBACK_EFX
ques
c_cond
op_amp
id|emu-&gt;efx_pcm_mixer
(braket
id|voice
op_minus
id|evoice-&gt;epcm-&gt;voices
(braket
l_int|0
)braket
op_member_access_from_pointer
id|number
)braket
suffix:colon
op_amp
id|emu-&gt;pcm_mixer
(braket
id|substream-&gt;number
)braket
suffix:semicolon
id|attn
op_assign
id|extra
ques
c_cond
l_int|0
suffix:colon
l_int|0x00ff
suffix:semicolon
id|tmp
op_assign
id|runtime-&gt;channels
op_eq
l_int|2
ques
c_cond
(paren
id|master
ques
c_cond
l_int|1
suffix:colon
l_int|2
)paren
suffix:colon
l_int|0
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|IFATN
comma
id|voice
comma
id|attn
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|VTFT
comma
id|voice
comma
(paren
id|mix-&gt;attn
(braket
id|tmp
)braket
op_lshift
l_int|16
)paren
op_or
l_int|0xffff
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|CVCF
comma
id|voice
comma
(paren
id|mix-&gt;attn
(braket
id|tmp
)braket
op_lshift
l_int|16
)paren
op_or
l_int|0xffff
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|DCYSUSV
comma
id|voice
comma
l_int|0x7f7f
)paren
suffix:semicolon
id|snd_emu10k1_voice_clear_loop_stop
c_func
(paren
id|emu
comma
id|voice
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1_playback_trigger_voice
r_static
r_void
id|snd_emu10k1_playback_trigger_voice
c_func
(paren
id|emu10k1_t
op_star
id|emu
comma
id|emu10k1_voice_t
op_star
id|evoice
comma
r_int
id|master
comma
r_int
id|extra
)paren
(brace
id|snd_pcm_substream_t
op_star
id|substream
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
suffix:semicolon
r_int
r_int
id|voice
comma
id|pitch
comma
id|pitch_target
suffix:semicolon
r_if
c_cond
(paren
id|evoice
op_eq
l_int|NULL
)paren
multiline_comment|/* skip second voice for mono */
r_return
suffix:semicolon
id|substream
op_assign
id|evoice-&gt;epcm-&gt;substream
suffix:semicolon
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|voice
op_assign
id|evoice-&gt;number
suffix:semicolon
id|pitch
op_assign
id|snd_emu10k1_rate_to_pitch
c_func
(paren
id|runtime-&gt;rate
)paren
op_rshift
l_int|8
suffix:semicolon
id|pitch_target
op_assign
id|emu10k1_calc_pitch_target
c_func
(paren
id|runtime-&gt;rate
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|PTRX_PITCHTARGET
comma
id|voice
comma
id|pitch_target
)paren
suffix:semicolon
r_if
c_cond
(paren
id|master
op_logical_or
id|evoice-&gt;epcm-&gt;type
op_eq
id|PLAYBACK_EFX
)paren
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|CPF_CURRENTPITCH
comma
id|voice
comma
id|pitch_target
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|IP
comma
id|voice
comma
id|pitch
)paren
suffix:semicolon
r_if
c_cond
(paren
id|extra
)paren
id|snd_emu10k1_voice_intr_enable
c_func
(paren
id|emu
comma
id|voice
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1_playback_stop_voice
r_static
r_void
id|snd_emu10k1_playback_stop_voice
c_func
(paren
id|emu10k1_t
op_star
id|emu
comma
id|emu10k1_voice_t
op_star
id|evoice
)paren
(brace
r_int
r_int
id|voice
suffix:semicolon
r_if
c_cond
(paren
id|evoice
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|voice
op_assign
id|evoice-&gt;number
suffix:semicolon
id|snd_emu10k1_voice_intr_disable
c_func
(paren
id|emu
comma
id|voice
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|PTRX_PITCHTARGET
comma
id|voice
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|CPF_CURRENTPITCH
comma
id|voice
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|IFATN
comma
id|voice
comma
l_int|0xffff
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|VTFT
comma
id|voice
comma
l_int|0xffff
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|CVCF
comma
id|voice
comma
l_int|0xffff
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|IP
comma
id|voice
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1_playback_trigger
r_static
r_int
id|snd_emu10k1_playback_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
singleline_comment|// printk(&quot;trigger - emu10k1 = 0x%x, cmd = %i, pointer = %i&bslash;n&quot;, (int)emu, cmd, substream-&gt;ops-&gt;pointer(substream));
id|spin_lock
c_func
(paren
op_amp
id|emu-&gt;reg_lock
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
id|snd_emu10k1_playback_invalidate_cache
c_func
(paren
id|emu
comma
id|epcm-&gt;extra
)paren
suffix:semicolon
multiline_comment|/* do we need this? */
id|snd_emu10k1_playback_invalidate_cache
c_func
(paren
id|emu
comma
id|epcm-&gt;voices
(braket
l_int|0
)braket
)paren
suffix:semicolon
multiline_comment|/* follow thru */
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_RELEASE
suffix:colon
id|snd_emu10k1_playback_prepare_voice
c_func
(paren
id|emu
comma
id|epcm-&gt;voices
(braket
l_int|0
)braket
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1_playback_prepare_voice
c_func
(paren
id|emu
comma
id|epcm-&gt;voices
(braket
l_int|1
)braket
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1_playback_prepare_voice
c_func
(paren
id|emu
comma
id|epcm-&gt;extra
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
id|snd_emu10k1_playback_trigger_voice
c_func
(paren
id|emu
comma
id|epcm-&gt;voices
(braket
l_int|0
)braket
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1_playback_trigger_voice
c_func
(paren
id|emu
comma
id|epcm-&gt;voices
(braket
l_int|1
)braket
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1_playback_trigger_voice
c_func
(paren
id|emu
comma
id|epcm-&gt;extra
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
id|epcm-&gt;running
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_PUSH
suffix:colon
id|epcm-&gt;running
op_assign
l_int|0
suffix:semicolon
id|snd_emu10k1_playback_stop_voice
c_func
(paren
id|emu
comma
id|epcm-&gt;voices
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|snd_emu10k1_playback_stop_voice
c_func
(paren
id|emu
comma
id|epcm-&gt;voices
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|snd_emu10k1_playback_stop_voice
c_func
(paren
id|emu
comma
id|epcm-&gt;extra
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|emu-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_emu10k1_capture_trigger
r_static
r_int
id|snd_emu10k1_capture_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|emu-&gt;reg_lock
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
singleline_comment|// hmm this should cause full and half full interrupt to be raised?  
id|outl
c_func
(paren
id|epcm-&gt;capture_ipr
comma
id|emu-&gt;port
op_plus
id|IPR
)paren
suffix:semicolon
id|snd_emu10k1_intr_enable
c_func
(paren
id|emu
comma
id|epcm-&gt;capture_inte
)paren
suffix:semicolon
singleline_comment|// printk(&quot;adccr = 0x%x, adcbs = 0x%x&bslash;n&quot;, epcm-&gt;adccr, epcm-&gt;adcbs);
r_switch
c_cond
(paren
id|epcm-&gt;type
)paren
(brace
r_case
id|CAPTURE_AC97ADC
suffix:colon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|ADCCR
comma
l_int|0
comma
id|epcm-&gt;capture_cr_val
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CAPTURE_EFX
suffix:colon
r_if
c_cond
(paren
id|emu-&gt;audigy
)paren
(brace
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|A_FXWC1
comma
l_int|0
comma
id|epcm-&gt;capture_cr_val
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|A_FXWC2
comma
l_int|0
comma
id|epcm-&gt;capture_cr_val2
)paren
suffix:semicolon
)brace
r_else
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|FXWC
comma
l_int|0
comma
id|epcm-&gt;capture_cr_val
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|epcm-&gt;capture_bs_reg
comma
l_int|0
comma
id|epcm-&gt;capture_bs_val
)paren
suffix:semicolon
id|epcm-&gt;running
op_assign
l_int|1
suffix:semicolon
id|epcm-&gt;first_ptr
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
id|epcm-&gt;running
op_assign
l_int|0
suffix:semicolon
id|snd_emu10k1_intr_disable
c_func
(paren
id|emu
comma
id|epcm-&gt;capture_inte
)paren
suffix:semicolon
id|outl
c_func
(paren
id|epcm-&gt;capture_ipr
comma
id|emu-&gt;port
op_plus
id|IPR
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|epcm-&gt;capture_bs_reg
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|epcm-&gt;type
)paren
(brace
r_case
id|CAPTURE_AC97ADC
suffix:colon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|ADCCR
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CAPTURE_EFX
suffix:colon
r_if
c_cond
(paren
id|emu-&gt;audigy
)paren
(brace
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|A_FXWC1
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|A_FXWC2
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|FXWC
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|emu-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_emu10k1_playback_pointer
r_static
id|snd_pcm_uframes_t
id|snd_emu10k1_playback_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_int
r_int
id|ptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|epcm-&gt;running
)paren
r_return
l_int|0
suffix:semicolon
id|ptr
op_assign
id|snd_emu10k1_ptr_read
c_func
(paren
id|emu
comma
id|CCCA
comma
id|epcm-&gt;voices
(braket
l_int|0
)braket
op_member_access_from_pointer
id|number
)paren
op_amp
l_int|0x00ffffff
suffix:semicolon
macro_line|#if 0&t;/* Perex&squot;s code */
id|ptr
op_add_assign
id|runtime-&gt;buffer_size
suffix:semicolon
id|ptr
op_sub_assign
id|epcm-&gt;ccca_start_addr
suffix:semicolon
id|ptr
op_mod_assign
id|runtime-&gt;buffer_size
suffix:semicolon
macro_line|#else&t;/* EMU10K1 Open Source code from Creative */
r_if
c_cond
(paren
id|ptr
OL
id|epcm-&gt;ccca_start_addr
)paren
id|ptr
op_add_assign
id|runtime-&gt;buffer_size
op_minus
id|epcm-&gt;ccca_start_addr
suffix:semicolon
r_else
(brace
id|ptr
op_sub_assign
id|epcm-&gt;ccca_start_addr
suffix:semicolon
r_if
c_cond
(paren
id|ptr
op_ge
id|runtime-&gt;buffer_size
)paren
id|ptr
op_sub_assign
id|runtime-&gt;buffer_size
suffix:semicolon
)brace
macro_line|#endif
singleline_comment|// printk(&quot;ptr = 0x%x, buffer_size = 0x%x, period_size = 0x%x&bslash;n&quot;, ptr, runtime-&gt;buffer_size, runtime-&gt;period_size);
r_return
id|ptr
suffix:semicolon
)brace
DECL|function|snd_emu10k1_efx_playback_trigger
r_static
r_int
id|snd_emu10k1_efx_playback_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|emu-&gt;reg_lock
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
singleline_comment|// prepare voices
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_EFX_PLAYBACK
suffix:semicolon
id|i
op_increment
)paren
(brace
id|snd_emu10k1_playback_invalidate_cache
c_func
(paren
id|emu
comma
id|epcm-&gt;voices
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|snd_emu10k1_playback_invalidate_cache
c_func
(paren
id|emu
comma
id|epcm-&gt;extra
)paren
suffix:semicolon
multiline_comment|/* follow thru */
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_RELEASE
suffix:colon
id|snd_emu10k1_playback_prepare_voice
c_func
(paren
id|emu
comma
id|epcm-&gt;voices
(braket
l_int|0
)braket
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1_playback_prepare_voice
c_func
(paren
id|emu
comma
id|epcm-&gt;extra
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|NUM_EFX_PLAYBACK
suffix:semicolon
id|i
op_increment
)paren
(brace
id|snd_emu10k1_playback_prepare_voice
c_func
(paren
id|emu
comma
id|epcm-&gt;voices
(braket
id|i
)braket
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
id|snd_emu10k1_playback_trigger_voice
c_func
(paren
id|emu
comma
id|epcm-&gt;voices
(braket
l_int|0
)braket
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|snd_emu10k1_playback_trigger_voice
c_func
(paren
id|emu
comma
id|epcm-&gt;extra
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|NUM_EFX_PLAYBACK
suffix:semicolon
id|i
op_increment
)paren
(brace
id|snd_emu10k1_playback_trigger_voice
c_func
(paren
id|emu
comma
id|epcm-&gt;voices
(braket
id|i
)braket
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
id|epcm-&gt;running
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_PUSH
suffix:colon
id|epcm-&gt;running
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_EFX_PLAYBACK
suffix:semicolon
id|i
op_increment
)paren
(brace
id|snd_emu10k1_playback_stop_voice
c_func
(paren
id|emu
comma
id|epcm-&gt;voices
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|snd_emu10k1_playback_stop_voice
c_func
(paren
id|emu
comma
id|epcm-&gt;extra
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|emu-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_emu10k1_capture_pointer
r_static
id|snd_pcm_uframes_t
id|snd_emu10k1_capture_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
r_int
r_int
id|ptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|epcm-&gt;running
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|epcm-&gt;first_ptr
)paren
(brace
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
singleline_comment|// hack, it takes awhile until capture is started
id|epcm-&gt;first_ptr
op_assign
l_int|0
suffix:semicolon
)brace
id|ptr
op_assign
id|snd_emu10k1_ptr_read
c_func
(paren
id|emu
comma
id|epcm-&gt;capture_idx_reg
comma
l_int|0
)paren
op_amp
l_int|0x0000ffff
suffix:semicolon
r_return
id|bytes_to_frames
c_func
(paren
id|runtime
comma
id|ptr
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Playback support device description&n; */
DECL|variable|snd_emu10k1_playback
r_static
id|snd_pcm_hardware_t
id|snd_emu10k1_playback
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_PAUSE
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_96000
comma
dot
id|rate_min
op_assign
l_int|4000
comma
dot
id|rate_max
op_assign
l_int|96000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|1024
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/*&n; *  Capture support device description&n; */
DECL|variable|snd_emu10k1_capture
r_static
id|snd_pcm_hardware_t
id|snd_emu10k1_capture
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_8000_48000
comma
dot
id|rate_min
op_assign
l_int|8000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|64
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|384
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|64
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|2
comma
dot
id|periods_max
op_assign
l_int|2
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/*&n; *&n; */
DECL|function|snd_emu10k1_pcm_mixer_notify1
r_static
r_void
id|snd_emu10k1_pcm_mixer_notify1
c_func
(paren
id|emu10k1_t
op_star
id|emu
comma
id|snd_kcontrol_t
op_star
id|kctl
comma
r_int
id|idx
comma
r_int
id|activate
)paren
(brace
id|snd_ctl_elem_id_t
id|id
suffix:semicolon
id|snd_runtime_check
c_func
(paren
id|kctl
op_ne
l_int|NULL
comma
r_return
)paren
suffix:semicolon
r_if
c_cond
(paren
id|activate
)paren
id|kctl-&gt;vd
(braket
id|idx
)braket
dot
id|access
op_and_assign
op_complement
id|SNDRV_CTL_ELEM_ACCESS_INACTIVE
suffix:semicolon
r_else
id|kctl-&gt;vd
(braket
id|idx
)braket
dot
id|access
op_or_assign
id|SNDRV_CTL_ELEM_ACCESS_INACTIVE
suffix:semicolon
id|snd_ctl_notify
c_func
(paren
id|emu-&gt;card
comma
id|SNDRV_CTL_EVENT_MASK_VALUE
op_or
id|SNDRV_CTL_EVENT_MASK_INFO
comma
id|snd_ctl_build_ioff
c_func
(paren
op_amp
id|id
comma
id|kctl
comma
id|idx
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1_pcm_mixer_notify
r_static
r_void
id|snd_emu10k1_pcm_mixer_notify
c_func
(paren
id|emu10k1_t
op_star
id|emu
comma
r_int
id|idx
comma
r_int
id|activate
)paren
(brace
id|snd_emu10k1_pcm_mixer_notify1
c_func
(paren
id|emu
comma
id|emu-&gt;ctl_send_routing
comma
id|idx
comma
id|activate
)paren
suffix:semicolon
id|snd_emu10k1_pcm_mixer_notify1
c_func
(paren
id|emu
comma
id|emu-&gt;ctl_send_volume
comma
id|idx
comma
id|activate
)paren
suffix:semicolon
id|snd_emu10k1_pcm_mixer_notify1
c_func
(paren
id|emu
comma
id|emu-&gt;ctl_attn
comma
id|idx
comma
id|activate
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1_pcm_efx_mixer_notify
r_static
r_void
id|snd_emu10k1_pcm_efx_mixer_notify
c_func
(paren
id|emu10k1_t
op_star
id|emu
comma
r_int
id|idx
comma
r_int
id|activate
)paren
(brace
id|snd_emu10k1_pcm_mixer_notify1
c_func
(paren
id|emu
comma
id|emu-&gt;ctl_efx_send_routing
comma
id|idx
comma
id|activate
)paren
suffix:semicolon
id|snd_emu10k1_pcm_mixer_notify1
c_func
(paren
id|emu
comma
id|emu-&gt;ctl_efx_send_volume
comma
id|idx
comma
id|activate
)paren
suffix:semicolon
id|snd_emu10k1_pcm_mixer_notify1
c_func
(paren
id|emu
comma
id|emu-&gt;ctl_efx_attn
comma
id|idx
comma
id|activate
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1_pcm_free_substream
r_static
r_void
id|snd_emu10k1_pcm_free_substream
c_func
(paren
id|snd_pcm_runtime_t
op_star
id|runtime
)paren
(brace
id|emu10k1_pcm_t
op_star
id|epcm
op_assign
id|runtime-&gt;private_data
suffix:semicolon
id|kfree
c_func
(paren
id|epcm
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1_efx_playback_close
r_static
r_int
id|snd_emu10k1_efx_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|emu10k1_pcm_mixer_t
op_star
id|mix
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_EFX_PLAYBACK
suffix:semicolon
id|i
op_increment
)paren
(brace
id|mix
op_assign
op_amp
id|emu-&gt;efx_pcm_mixer
(braket
id|i
)braket
suffix:semicolon
id|mix-&gt;epcm
op_assign
l_int|NULL
suffix:semicolon
id|snd_emu10k1_pcm_efx_mixer_notify
c_func
(paren
id|emu
comma
id|i
comma
l_int|0
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_efx_playback_open
r_static
r_int
id|snd_emu10k1_efx_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|emu10k1_pcm_t
op_star
id|epcm
suffix:semicolon
id|emu10k1_pcm_mixer_t
op_star
id|mix
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|i
suffix:semicolon
id|epcm
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|epcm
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|epcm
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|epcm-&gt;emu
op_assign
id|emu
suffix:semicolon
id|epcm-&gt;type
op_assign
id|PLAYBACK_EFX
suffix:semicolon
id|epcm-&gt;substream
op_assign
id|substream
suffix:semicolon
id|emu-&gt;pcm_playback_efx_substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;private_data
op_assign
id|epcm
suffix:semicolon
id|runtime-&gt;private_free
op_assign
id|snd_emu10k1_pcm_free_substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_emu10k1_efx_playback
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_EFX_PLAYBACK
suffix:semicolon
id|i
op_increment
)paren
(brace
id|mix
op_assign
op_amp
id|emu-&gt;efx_pcm_mixer
(braket
id|i
)braket
suffix:semicolon
id|mix-&gt;send_routing
(braket
l_int|0
)braket
(braket
l_int|0
)braket
op_assign
id|i
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|mix-&gt;send_volume
comma
l_int|0
comma
r_sizeof
(paren
id|mix-&gt;send_volume
)paren
)paren
suffix:semicolon
id|mix-&gt;send_volume
(braket
l_int|0
)braket
(braket
l_int|0
)braket
op_assign
l_int|255
suffix:semicolon
id|mix-&gt;attn
(braket
l_int|0
)braket
op_assign
l_int|0xffff
suffix:semicolon
id|mix-&gt;epcm
op_assign
id|epcm
suffix:semicolon
id|snd_emu10k1_pcm_efx_mixer_notify
c_func
(paren
id|emu
comma
id|i
comma
l_int|1
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_playback_open
r_static
r_int
id|snd_emu10k1_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|emu10k1_pcm_t
op_star
id|epcm
suffix:semicolon
id|emu10k1_pcm_mixer_t
op_star
id|mix
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|i
comma
id|err
suffix:semicolon
id|epcm
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|epcm
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|epcm
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|epcm-&gt;emu
op_assign
id|emu
suffix:semicolon
id|epcm-&gt;type
op_assign
id|PLAYBACK_EMUVOICE
suffix:semicolon
id|epcm-&gt;substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;private_data
op_assign
id|epcm
suffix:semicolon
id|runtime-&gt;private_free
op_assign
id|snd_emu10k1_pcm_free_substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_emu10k1_playback
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_integer
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_PERIODS
)paren
)paren
OL
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|epcm
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_minmax
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_BUFFER_BYTES
comma
l_int|256
comma
id|UINT_MAX
)paren
)paren
OL
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|epcm
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|mix
op_assign
op_amp
id|emu-&gt;pcm_mixer
(braket
id|substream-&gt;number
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|mix-&gt;send_routing
(braket
l_int|0
)braket
(braket
id|i
)braket
op_assign
id|mix-&gt;send_routing
(braket
l_int|1
)braket
(braket
id|i
)braket
op_assign
id|mix-&gt;send_routing
(braket
l_int|2
)braket
(braket
id|i
)braket
op_assign
id|i
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|mix-&gt;send_volume
comma
l_int|0
comma
r_sizeof
(paren
id|mix-&gt;send_volume
)paren
)paren
suffix:semicolon
id|mix-&gt;send_volume
(braket
l_int|0
)braket
(braket
l_int|0
)braket
op_assign
id|mix-&gt;send_volume
(braket
l_int|0
)braket
(braket
l_int|1
)braket
op_assign
id|mix-&gt;send_volume
(braket
l_int|1
)braket
(braket
l_int|0
)braket
op_assign
id|mix-&gt;send_volume
(braket
l_int|2
)braket
(braket
l_int|1
)braket
op_assign
l_int|255
suffix:semicolon
id|mix-&gt;attn
(braket
l_int|0
)braket
op_assign
id|mix-&gt;attn
(braket
l_int|1
)braket
op_assign
id|mix-&gt;attn
(braket
l_int|2
)braket
op_assign
l_int|0xffff
suffix:semicolon
id|mix-&gt;epcm
op_assign
id|epcm
suffix:semicolon
id|snd_emu10k1_pcm_mixer_notify
c_func
(paren
id|emu
comma
id|substream-&gt;number
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_playback_close
r_static
r_int
id|snd_emu10k1_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|emu10k1_pcm_mixer_t
op_star
id|mix
op_assign
op_amp
id|emu-&gt;pcm_mixer
(braket
id|substream-&gt;number
)braket
suffix:semicolon
id|mix-&gt;epcm
op_assign
l_int|NULL
suffix:semicolon
id|snd_emu10k1_pcm_mixer_notify
c_func
(paren
id|emu
comma
id|substream-&gt;number
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_capture_open
r_static
r_int
id|snd_emu10k1_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|emu10k1_pcm_t
op_star
id|epcm
suffix:semicolon
id|epcm
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|epcm
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|epcm
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|epcm-&gt;emu
op_assign
id|emu
suffix:semicolon
id|epcm-&gt;type
op_assign
id|CAPTURE_AC97ADC
suffix:semicolon
id|epcm-&gt;substream
op_assign
id|substream
suffix:semicolon
id|epcm-&gt;capture_ipr
op_assign
id|IPR_ADCBUFFULL
op_or
id|IPR_ADCBUFHALFFULL
suffix:semicolon
id|epcm-&gt;capture_inte
op_assign
id|INTE_ADCBUFENABLE
suffix:semicolon
id|epcm-&gt;capture_ba_reg
op_assign
id|ADCBA
suffix:semicolon
id|epcm-&gt;capture_bs_reg
op_assign
id|ADCBS
suffix:semicolon
id|epcm-&gt;capture_idx_reg
op_assign
id|emu-&gt;audigy
ques
c_cond
id|A_ADCIDX
suffix:colon
id|ADCIDX
suffix:semicolon
id|runtime-&gt;private_data
op_assign
id|epcm
suffix:semicolon
id|runtime-&gt;private_free
op_assign
id|snd_emu10k1_pcm_free_substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_emu10k1_capture
suffix:semicolon
id|emu-&gt;capture_interrupt
op_assign
id|snd_emu10k1_pcm_ac97adc_interrupt
suffix:semicolon
id|emu-&gt;pcm_capture_substream
op_assign
id|substream
suffix:semicolon
id|snd_pcm_hw_constraint_list
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_PERIOD_BYTES
comma
op_amp
id|hw_constraints_capture_period_sizes
)paren
suffix:semicolon
id|snd_pcm_hw_constraint_list
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
op_amp
id|hw_constraints_capture_rates
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_capture_close
r_static
r_int
id|snd_emu10k1_capture_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|emu-&gt;capture_interrupt
op_assign
l_int|NULL
suffix:semicolon
id|emu-&gt;pcm_capture_substream
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_capture_mic_open
r_static
r_int
id|snd_emu10k1_capture_mic_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|emu10k1_pcm_t
op_star
id|epcm
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|epcm
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|epcm
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|epcm
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|epcm-&gt;emu
op_assign
id|emu
suffix:semicolon
id|epcm-&gt;type
op_assign
id|CAPTURE_AC97MIC
suffix:semicolon
id|epcm-&gt;substream
op_assign
id|substream
suffix:semicolon
id|epcm-&gt;capture_ipr
op_assign
id|IPR_MICBUFFULL
op_or
id|IPR_MICBUFHALFFULL
suffix:semicolon
id|epcm-&gt;capture_inte
op_assign
id|INTE_MICBUFENABLE
suffix:semicolon
id|epcm-&gt;capture_ba_reg
op_assign
id|MICBA
suffix:semicolon
id|epcm-&gt;capture_bs_reg
op_assign
id|MICBS
suffix:semicolon
id|epcm-&gt;capture_idx_reg
op_assign
id|emu-&gt;audigy
ques
c_cond
id|A_MICIDX
suffix:colon
id|MICIDX
suffix:semicolon
id|substream-&gt;runtime-&gt;private_data
op_assign
id|epcm
suffix:semicolon
id|substream-&gt;runtime-&gt;private_free
op_assign
id|snd_emu10k1_pcm_free_substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_emu10k1_capture
suffix:semicolon
id|runtime-&gt;hw.rates
op_assign
id|SNDRV_PCM_RATE_8000
suffix:semicolon
id|runtime-&gt;hw.rate_min
op_assign
id|runtime-&gt;hw.rate_max
op_assign
l_int|8000
suffix:semicolon
id|runtime-&gt;hw.channels_min
op_assign
l_int|1
suffix:semicolon
id|emu-&gt;capture_mic_interrupt
op_assign
id|snd_emu10k1_pcm_ac97mic_interrupt
suffix:semicolon
id|emu-&gt;pcm_capture_mic_substream
op_assign
id|substream
suffix:semicolon
id|snd_pcm_hw_constraint_list
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_PERIOD_BYTES
comma
op_amp
id|hw_constraints_capture_period_sizes
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_capture_mic_close
r_static
r_int
id|snd_emu10k1_capture_mic_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|emu-&gt;capture_interrupt
op_assign
l_int|NULL
suffix:semicolon
id|emu-&gt;pcm_capture_mic_substream
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_capture_efx_open
r_static
r_int
id|snd_emu10k1_capture_efx_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|emu10k1_pcm_t
op_star
id|epcm
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|nefx
op_assign
id|emu-&gt;audigy
ques
c_cond
l_int|64
suffix:colon
l_int|32
suffix:semicolon
r_int
id|idx
suffix:semicolon
id|epcm
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|epcm
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|epcm
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|epcm-&gt;emu
op_assign
id|emu
suffix:semicolon
id|epcm-&gt;type
op_assign
id|CAPTURE_EFX
suffix:semicolon
id|epcm-&gt;substream
op_assign
id|substream
suffix:semicolon
id|epcm-&gt;capture_ipr
op_assign
id|IPR_EFXBUFFULL
op_or
id|IPR_EFXBUFHALFFULL
suffix:semicolon
id|epcm-&gt;capture_inte
op_assign
id|INTE_EFXBUFENABLE
suffix:semicolon
id|epcm-&gt;capture_ba_reg
op_assign
id|FXBA
suffix:semicolon
id|epcm-&gt;capture_bs_reg
op_assign
id|FXBS
suffix:semicolon
id|epcm-&gt;capture_idx_reg
op_assign
id|FXIDX
suffix:semicolon
id|substream-&gt;runtime-&gt;private_data
op_assign
id|epcm
suffix:semicolon
id|substream-&gt;runtime-&gt;private_free
op_assign
id|snd_emu10k1_pcm_free_substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_emu10k1_capture
suffix:semicolon
id|runtime-&gt;hw.rates
op_assign
id|SNDRV_PCM_RATE_48000
suffix:semicolon
id|runtime-&gt;hw.rate_min
op_assign
id|runtime-&gt;hw.rate_max
op_assign
l_int|48000
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|emu-&gt;reg_lock
)paren
suffix:semicolon
id|runtime-&gt;hw.channels_min
op_assign
id|runtime-&gt;hw.channels_max
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|nefx
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
id|emu-&gt;efx_voices_mask
(braket
id|idx
op_div
l_int|32
)braket
op_amp
(paren
l_int|1
op_lshift
(paren
id|idx
op_mod
l_int|32
)paren
)paren
)paren
(brace
id|runtime-&gt;hw.channels_min
op_increment
suffix:semicolon
id|runtime-&gt;hw.channels_max
op_increment
suffix:semicolon
)brace
)brace
id|epcm-&gt;capture_cr_val
op_assign
id|emu-&gt;efx_voices_mask
(braket
l_int|0
)braket
suffix:semicolon
id|epcm-&gt;capture_cr_val2
op_assign
id|emu-&gt;efx_voices_mask
(braket
l_int|1
)braket
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|emu-&gt;reg_lock
)paren
suffix:semicolon
id|emu-&gt;capture_efx_interrupt
op_assign
id|snd_emu10k1_pcm_efx_interrupt
suffix:semicolon
id|emu-&gt;pcm_capture_efx_substream
op_assign
id|substream
suffix:semicolon
id|snd_pcm_hw_constraint_list
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_PERIOD_BYTES
comma
op_amp
id|hw_constraints_capture_period_sizes
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_capture_efx_close
r_static
r_int
id|snd_emu10k1_capture_efx_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|emu-&gt;capture_interrupt
op_assign
l_int|NULL
suffix:semicolon
id|emu-&gt;pcm_capture_efx_substream
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_emu10k1_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_emu10k1_playback_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_emu10k1_playback_open
comma
dot
id|close
op_assign
id|snd_emu10k1_playback_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_emu10k1_playback_hw_params
comma
dot
id|hw_free
op_assign
id|snd_emu10k1_playback_hw_free
comma
dot
id|prepare
op_assign
id|snd_emu10k1_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_emu10k1_playback_trigger
comma
dot
id|pointer
op_assign
id|snd_emu10k1_playback_pointer
comma
dot
id|page
op_assign
id|snd_pcm_sgbuf_ops_page
comma
)brace
suffix:semicolon
DECL|variable|snd_emu10k1_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_emu10k1_capture_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_emu10k1_capture_open
comma
dot
id|close
op_assign
id|snd_emu10k1_capture_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_emu10k1_capture_hw_params
comma
dot
id|hw_free
op_assign
id|snd_emu10k1_capture_hw_free
comma
dot
id|prepare
op_assign
id|snd_emu10k1_capture_prepare
comma
dot
id|trigger
op_assign
id|snd_emu10k1_capture_trigger
comma
dot
id|pointer
op_assign
id|snd_emu10k1_capture_pointer
comma
)brace
suffix:semicolon
multiline_comment|/* EFX playback */
DECL|variable|snd_emu10k1_efx_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_emu10k1_efx_playback_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_emu10k1_efx_playback_open
comma
dot
id|close
op_assign
id|snd_emu10k1_efx_playback_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_emu10k1_playback_hw_params
comma
dot
id|hw_free
op_assign
id|snd_emu10k1_efx_playback_hw_free
comma
dot
id|prepare
op_assign
id|snd_emu10k1_efx_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_emu10k1_efx_playback_trigger
comma
dot
id|pointer
op_assign
id|snd_emu10k1_efx_playback_pointer
comma
dot
id|page
op_assign
id|snd_pcm_sgbuf_ops_page
comma
)brace
suffix:semicolon
DECL|function|snd_emu10k1_pcm_free
r_static
r_void
id|snd_emu10k1_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|pcm-&gt;private_data
suffix:semicolon
id|emu-&gt;pcm
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1_pcm
r_int
id|__devinit
id|snd_emu10k1_pcm
c_func
(paren
id|emu10k1_t
op_star
id|emu
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
id|snd_pcm_substream_t
op_star
id|substream
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|emu-&gt;card
comma
l_string|&quot;emu10k1&quot;
comma
id|device
comma
l_int|32
comma
l_int|1
comma
op_amp
id|pcm
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|emu
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_emu10k1_pcm_free
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_emu10k1_playback_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_emu10k1_capture_ops
)paren
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|pcm-&gt;dev_subclass
op_assign
id|SNDRV_PCM_SUBCLASS_GENERIC_MIX
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;EMU10K1&quot;
)paren
suffix:semicolon
id|emu-&gt;pcm
op_assign
id|pcm
suffix:semicolon
r_for
c_loop
(paren
id|substream
op_assign
id|pcm-&gt;streams
(braket
id|SNDRV_PCM_STREAM_PLAYBACK
)braket
dot
id|substream
suffix:semicolon
id|substream
suffix:semicolon
id|substream
op_assign
id|substream-&gt;next
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_lib_preallocate_pages
c_func
(paren
id|substream
comma
id|SNDRV_DMA_TYPE_DEV_SG
comma
id|snd_dma_pci_data
c_func
(paren
id|emu-&gt;pci
)paren
comma
l_int|64
op_star
l_int|1024
comma
l_int|64
op_star
l_int|1024
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_for
c_loop
(paren
id|substream
op_assign
id|pcm-&gt;streams
(braket
id|SNDRV_PCM_STREAM_CAPTURE
)braket
dot
id|substream
suffix:semicolon
id|substream
suffix:semicolon
id|substream
op_assign
id|substream-&gt;next
)paren
id|snd_pcm_lib_preallocate_pages
c_func
(paren
id|substream
comma
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|emu-&gt;pci
)paren
comma
l_int|64
op_star
l_int|1024
comma
l_int|64
op_star
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_pcm_multi
r_int
id|__devinit
id|snd_emu10k1_pcm_multi
c_func
(paren
id|emu10k1_t
op_star
id|emu
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
id|snd_pcm_substream_t
op_star
id|substream
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|emu-&gt;card
comma
l_string|&quot;emu10k1&quot;
comma
id|device
comma
l_int|1
comma
l_int|0
comma
op_amp
id|pcm
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|emu
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_emu10k1_pcm_free
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_emu10k1_efx_playback_ops
)paren
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|pcm-&gt;dev_subclass
op_assign
id|SNDRV_PCM_SUBCLASS_GENERIC_MIX
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;EMU10K1 multichannel EFX&quot;
)paren
suffix:semicolon
id|emu-&gt;pcm
op_assign
id|pcm
suffix:semicolon
r_for
c_loop
(paren
id|substream
op_assign
id|pcm-&gt;streams
(braket
id|SNDRV_PCM_STREAM_PLAYBACK
)braket
dot
id|substream
suffix:semicolon
id|substream
suffix:semicolon
id|substream
op_assign
id|substream-&gt;next
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_lib_preallocate_pages
c_func
(paren
id|substream
comma
id|SNDRV_DMA_TYPE_DEV_SG
comma
id|snd_dma_pci_data
c_func
(paren
id|emu-&gt;pci
)paren
comma
l_int|64
op_star
l_int|1024
comma
l_int|64
op_star
l_int|1024
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_emu10k1_capture_mic_ops
r_static
id|snd_pcm_ops_t
id|snd_emu10k1_capture_mic_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_emu10k1_capture_mic_open
comma
dot
id|close
op_assign
id|snd_emu10k1_capture_mic_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_emu10k1_capture_hw_params
comma
dot
id|hw_free
op_assign
id|snd_emu10k1_capture_hw_free
comma
dot
id|prepare
op_assign
id|snd_emu10k1_capture_prepare
comma
dot
id|trigger
op_assign
id|snd_emu10k1_capture_trigger
comma
dot
id|pointer
op_assign
id|snd_emu10k1_capture_pointer
comma
)brace
suffix:semicolon
DECL|function|snd_emu10k1_pcm_mic_free
r_static
r_void
id|snd_emu10k1_pcm_mic_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|pcm-&gt;private_data
suffix:semicolon
id|emu-&gt;pcm_mic
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1_pcm_mic
r_int
id|__devinit
id|snd_emu10k1_pcm_mic
c_func
(paren
id|emu10k1_t
op_star
id|emu
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|emu-&gt;card
comma
l_string|&quot;emu10k1 mic&quot;
comma
id|device
comma
l_int|0
comma
l_int|1
comma
op_amp
id|pcm
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|emu
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_emu10k1_pcm_mic_free
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_emu10k1_capture_mic_ops
)paren
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;EMU10K1 MIC&quot;
)paren
suffix:semicolon
id|emu-&gt;pcm_mic
op_assign
id|pcm
suffix:semicolon
id|snd_pcm_lib_preallocate_pages_for_all
c_func
(paren
id|pcm
comma
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|emu-&gt;pci
)paren
comma
l_int|64
op_star
l_int|1024
comma
l_int|64
op_star
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_pcm_efx_voices_mask_info
r_static
r_int
id|snd_emu10k1_pcm_efx_voices_mask_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|nefx
op_assign
id|emu-&gt;audigy
ques
c_cond
l_int|64
suffix:colon
l_int|32
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:semicolon
id|uinfo-&gt;count
op_assign
id|nefx
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_pcm_efx_voices_mask_get
r_static
r_int
id|snd_emu10k1_pcm_efx_voices_mask_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|nefx
op_assign
id|emu-&gt;audigy
ques
c_cond
l_int|64
suffix:colon
l_int|32
suffix:semicolon
r_int
id|idx
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|emu-&gt;reg_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|nefx
suffix:semicolon
id|idx
op_increment
)paren
id|ucontrol-&gt;value.integer.value
(braket
id|idx
)braket
op_assign
(paren
id|emu-&gt;efx_voices_mask
(braket
id|idx
op_div
l_int|32
)braket
op_amp
(paren
l_int|1
op_lshift
(paren
id|idx
op_mod
l_int|32
)paren
)paren
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|emu-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_pcm_efx_voices_mask_put
r_static
r_int
id|snd_emu10k1_pcm_efx_voices_mask_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|nval
(braket
l_int|2
)braket
comma
id|bits
suffix:semicolon
r_int
id|nefx
op_assign
id|emu-&gt;audigy
ques
c_cond
l_int|64
suffix:colon
l_int|32
suffix:semicolon
r_int
id|nefxb
op_assign
id|emu-&gt;audigy
ques
c_cond
l_int|7
suffix:colon
l_int|6
suffix:semicolon
r_int
id|change
comma
id|idx
suffix:semicolon
id|nval
(braket
l_int|0
)braket
op_assign
id|nval
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
comma
id|bits
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|nefx
suffix:semicolon
id|idx
op_increment
)paren
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
id|idx
)braket
)paren
(brace
id|nval
(braket
id|idx
op_div
l_int|32
)braket
op_or_assign
l_int|1
op_lshift
(paren
id|idx
op_mod
l_int|32
)paren
suffix:semicolon
id|bits
op_increment
suffix:semicolon
)brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|nefxb
suffix:semicolon
id|idx
op_increment
)paren
r_if
c_cond
(paren
l_int|1
op_lshift
id|idx
op_eq
id|bits
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|idx
op_ge
id|nefxb
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|emu-&gt;reg_lock
)paren
suffix:semicolon
id|change
op_assign
(paren
id|nval
(braket
l_int|0
)braket
op_ne
id|emu-&gt;efx_voices_mask
(braket
l_int|0
)braket
)paren
op_logical_or
(paren
id|nval
(braket
l_int|1
)braket
op_ne
id|emu-&gt;efx_voices_mask
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|emu-&gt;efx_voices_mask
(braket
l_int|0
)braket
op_assign
id|nval
(braket
l_int|0
)braket
suffix:semicolon
id|emu-&gt;efx_voices_mask
(braket
l_int|1
)braket
op_assign
id|nval
(braket
l_int|1
)braket
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|emu-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|snd_emu10k1_pcm_efx_voices_mask
r_static
id|snd_kcontrol_new_t
id|snd_emu10k1_pcm_efx_voices_mask
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_PCM
comma
dot
id|name
op_assign
l_string|&quot;EFX voices mask&quot;
comma
dot
id|info
op_assign
id|snd_emu10k1_pcm_efx_voices_mask_info
comma
dot
id|get
op_assign
id|snd_emu10k1_pcm_efx_voices_mask_get
comma
dot
id|put
op_assign
id|snd_emu10k1_pcm_efx_voices_mask_put
)brace
suffix:semicolon
DECL|variable|snd_emu10k1_capture_efx_ops
r_static
id|snd_pcm_ops_t
id|snd_emu10k1_capture_efx_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_emu10k1_capture_efx_open
comma
dot
id|close
op_assign
id|snd_emu10k1_capture_efx_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_emu10k1_capture_hw_params
comma
dot
id|hw_free
op_assign
id|snd_emu10k1_capture_hw_free
comma
dot
id|prepare
op_assign
id|snd_emu10k1_capture_prepare
comma
dot
id|trigger
op_assign
id|snd_emu10k1_capture_trigger
comma
dot
id|pointer
op_assign
id|snd_emu10k1_capture_pointer
comma
)brace
suffix:semicolon
multiline_comment|/* EFX playback */
DECL|macro|INITIAL_TRAM_SHIFT
mdefine_line|#define INITIAL_TRAM_SHIFT     14
DECL|macro|INITIAL_TRAM_POS
mdefine_line|#define INITIAL_TRAM_POS(size) ((((size) / 2) - INITIAL_TRAM_SHIFT) - 1)
DECL|function|snd_emu10k1_fx8010_playback_irq
r_static
r_void
id|snd_emu10k1_fx8010_playback_irq
c_func
(paren
id|emu10k1_t
op_star
id|emu
comma
r_void
op_star
id|private_data
)paren
(brace
id|snd_pcm_substream_t
op_star
id|substream
op_assign
id|private_data
suffix:semicolon
id|snd_pcm_period_elapsed
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1_fx8010_playback_tram_poke1
r_static
r_void
id|snd_emu10k1_fx8010_playback_tram_poke1
c_func
(paren
r_int
r_int
op_star
id|dst_left
comma
r_int
r_int
op_star
id|dst_right
comma
r_int
r_int
op_star
id|src
comma
r_int
r_int
id|count
comma
r_int
r_int
id|tram_shift
)paren
(brace
singleline_comment|// printk(&quot;tram_poke1: dst_left = 0x%p, dst_right = 0x%p, src = 0x%p, count = 0x%x&bslash;n&quot;, dst_left, dst_right, src, count);
r_if
c_cond
(paren
(paren
id|tram_shift
op_amp
l_int|1
)paren
op_eq
l_int|0
)paren
(brace
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
op_star
id|dst_left
op_decrement
op_assign
op_star
id|src
op_increment
suffix:semicolon
op_star
id|dst_right
op_decrement
op_assign
op_star
id|src
op_increment
suffix:semicolon
)brace
)brace
r_else
(brace
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
op_star
id|dst_right
op_decrement
op_assign
op_star
id|src
op_increment
suffix:semicolon
op_star
id|dst_left
op_decrement
op_assign
op_star
id|src
op_increment
suffix:semicolon
)brace
)brace
)brace
DECL|function|fx8010_pb_trans_copy
r_static
r_void
id|fx8010_pb_trans_copy
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_indirect_t
op_star
id|rec
comma
r_int
id|bytes
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_emu10k1_fx8010_pcm_t
op_star
id|pcm
op_assign
op_amp
id|emu-&gt;fx8010.pcm
(braket
id|substream-&gt;number
)braket
suffix:semicolon
r_int
r_int
id|tram_size
op_assign
id|pcm-&gt;buffer_size
suffix:semicolon
r_int
r_int
op_star
id|src
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
id|substream-&gt;runtime-&gt;dma_area
op_plus
id|rec-&gt;sw_data
)paren
suffix:semicolon
r_int
r_int
id|frames
op_assign
id|bytes
op_rshift
l_int|2
comma
id|count
suffix:semicolon
r_int
r_int
id|tram_pos
op_assign
id|pcm-&gt;tram_pos
suffix:semicolon
r_int
r_int
id|tram_shift
op_assign
id|pcm-&gt;tram_shift
suffix:semicolon
r_while
c_loop
(paren
id|frames
OG
id|tram_pos
)paren
(brace
id|count
op_assign
id|tram_pos
op_plus
l_int|1
suffix:semicolon
id|snd_emu10k1_fx8010_playback_tram_poke1
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|emu-&gt;fx8010.etram_pages.area
op_plus
id|tram_pos
comma
(paren
r_int
r_int
op_star
)paren
id|emu-&gt;fx8010.etram_pages.area
op_plus
id|tram_pos
op_plus
id|tram_size
op_div
l_int|2
comma
id|src
comma
id|count
comma
id|tram_shift
)paren
suffix:semicolon
id|src
op_add_assign
id|count
op_star
l_int|2
suffix:semicolon
id|frames
op_sub_assign
id|count
suffix:semicolon
id|tram_pos
op_assign
(paren
id|tram_size
op_div
l_int|2
)paren
op_minus
l_int|1
suffix:semicolon
id|tram_shift
op_increment
suffix:semicolon
)brace
id|snd_emu10k1_fx8010_playback_tram_poke1
c_func
(paren
(paren
r_int
r_int
op_star
)paren
id|emu-&gt;fx8010.etram_pages.area
op_plus
id|tram_pos
comma
(paren
r_int
r_int
op_star
)paren
id|emu-&gt;fx8010.etram_pages.area
op_plus
id|tram_pos
op_plus
id|tram_size
op_div
l_int|2
comma
id|src
comma
id|frames
comma
id|tram_shift
)paren
suffix:semicolon
id|tram_pos
op_sub_assign
id|frames
suffix:semicolon
id|pcm-&gt;tram_pos
op_assign
id|tram_pos
suffix:semicolon
id|pcm-&gt;tram_shift
op_assign
id|tram_shift
suffix:semicolon
)brace
DECL|function|snd_emu10k1_fx8010_playback_transfer
r_static
r_int
id|snd_emu10k1_fx8010_playback_transfer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_emu10k1_fx8010_pcm_t
op_star
id|pcm
op_assign
op_amp
id|emu-&gt;fx8010.pcm
(braket
id|substream-&gt;number
)braket
suffix:semicolon
id|snd_pcm_indirect_playback_transfer
c_func
(paren
id|substream
comma
op_amp
id|pcm-&gt;pcm_rec
comma
id|fx8010_pb_trans_copy
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_fx8010_playback_hw_params
r_static
r_int
id|snd_emu10k1_fx8010_playback_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
r_return
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1_fx8010_playback_hw_free
r_static
r_int
id|snd_emu10k1_fx8010_playback_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_emu10k1_fx8010_pcm_t
op_star
id|pcm
op_assign
op_amp
id|emu-&gt;fx8010.pcm
(braket
id|substream-&gt;number
)braket
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pcm-&gt;channels
suffix:semicolon
id|i
op_increment
)paren
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|TANKMEMADDRREGBASE
op_plus
l_int|0x80
op_plus
id|pcm-&gt;etram
(braket
id|i
)braket
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_fx8010_playback_prepare
r_static
r_int
id|snd_emu10k1_fx8010_playback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_emu10k1_fx8010_pcm_t
op_star
id|pcm
op_assign
op_amp
id|emu-&gt;fx8010.pcm
(braket
id|substream-&gt;number
)braket
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
singleline_comment|// printk(&quot;prepare: etram_pages = 0x%p, dma_area = 0x%x, buffer_size = 0x%x (0x%x)&bslash;n&quot;, emu-&gt;fx8010.etram_pages, runtime-&gt;dma_area, runtime-&gt;buffer_size, runtime-&gt;buffer_size &lt;&lt; 2);
id|memset
c_func
(paren
op_amp
id|pcm-&gt;pcm_rec
comma
l_int|0
comma
r_sizeof
(paren
id|pcm-&gt;pcm_rec
)paren
)paren
suffix:semicolon
id|pcm-&gt;pcm_rec.hw_buffer_size
op_assign
id|pcm-&gt;buffer_size
op_star
l_int|2
suffix:semicolon
multiline_comment|/* byte size */
id|pcm-&gt;pcm_rec.sw_buffer_size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|pcm-&gt;tram_pos
op_assign
id|INITIAL_TRAM_POS
c_func
(paren
id|pcm-&gt;buffer_size
)paren
suffix:semicolon
id|pcm-&gt;tram_shift
op_assign
l_int|0
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|emu-&gt;gpr_base
op_plus
id|pcm-&gt;gpr_running
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* reset */
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|emu-&gt;gpr_base
op_plus
id|pcm-&gt;gpr_trigger
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* reset */
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|emu-&gt;gpr_base
op_plus
id|pcm-&gt;gpr_size
comma
l_int|0
comma
id|runtime-&gt;buffer_size
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|emu-&gt;gpr_base
op_plus
id|pcm-&gt;gpr_ptr
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* reset ptr number */
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|emu-&gt;gpr_base
op_plus
id|pcm-&gt;gpr_count
comma
l_int|0
comma
id|runtime-&gt;period_size
)paren
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|emu-&gt;gpr_base
op_plus
id|pcm-&gt;gpr_tmpcount
comma
l_int|0
comma
id|runtime-&gt;period_size
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pcm-&gt;channels
suffix:semicolon
id|i
op_increment
)paren
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|TANKMEMADDRREGBASE
op_plus
l_int|0x80
op_plus
id|pcm-&gt;etram
(braket
id|i
)braket
comma
l_int|0
comma
(paren
id|TANKMEMADDRREG_READ
op_or
id|TANKMEMADDRREG_ALIGN
)paren
op_plus
id|i
op_star
(paren
id|runtime-&gt;buffer_size
op_div
id|pcm-&gt;channels
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_fx8010_playback_trigger
r_static
r_int
id|snd_emu10k1_fx8010_playback_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_emu10k1_fx8010_pcm_t
op_star
id|pcm
op_assign
op_amp
id|emu-&gt;fx8010.pcm
(braket
id|substream-&gt;number
)braket
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|emu-&gt;reg_lock
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
multiline_comment|/* follow thru */
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_RELEASE
suffix:colon
macro_line|#ifdef EMU10K1_SET_AC3_IEC958
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|bits
suffix:semicolon
id|bits
op_assign
id|SPCS_CLKACCY_1000PPM
op_or
id|SPCS_SAMPLERATE_48
op_or
id|SPCS_CHANNELNUM_LEFT
op_or
id|SPCS_SOURCENUM_UNSPEC
op_or
id|SPCS_GENERATIONSTATUS
op_or
l_int|0x00001200
op_or
id|SPCS_EMPHASIS_NONE
op_or
id|SPCS_COPYRIGHT
op_or
id|SPCS_NOTAUDIODATA
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|SPCS0
op_plus
id|i
comma
l_int|0
comma
id|bits
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
id|result
op_assign
id|snd_emu10k1_fx8010_register_irq_handler
c_func
(paren
id|emu
comma
id|snd_emu10k1_fx8010_playback_irq
comma
id|pcm-&gt;gpr_running
comma
id|substream
comma
op_amp
id|pcm-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
r_goto
id|__err
suffix:semicolon
id|snd_emu10k1_fx8010_playback_transfer
c_func
(paren
id|substream
)paren
suffix:semicolon
multiline_comment|/* roll the ball */
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|emu-&gt;gpr_base
op_plus
id|pcm-&gt;gpr_trigger
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_PUSH
suffix:colon
id|snd_emu10k1_fx8010_unregister_irq_handler
c_func
(paren
id|emu
comma
id|pcm-&gt;irq
)paren
suffix:semicolon
id|pcm-&gt;irq
op_assign
l_int|NULL
suffix:semicolon
id|snd_emu10k1_ptr_write
c_func
(paren
id|emu
comma
id|emu-&gt;gpr_base
op_plus
id|pcm-&gt;gpr_trigger
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|pcm-&gt;tram_pos
op_assign
id|INITIAL_TRAM_POS
c_func
(paren
id|pcm-&gt;buffer_size
)paren
suffix:semicolon
id|pcm-&gt;tram_shift
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|__err
suffix:colon
id|spin_unlock
c_func
(paren
op_amp
id|emu-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_emu10k1_fx8010_playback_pointer
r_static
id|snd_pcm_uframes_t
id|snd_emu10k1_fx8010_playback_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_emu10k1_fx8010_pcm_t
op_star
id|pcm
op_assign
op_amp
id|emu-&gt;fx8010.pcm
(braket
id|substream-&gt;number
)braket
suffix:semicolon
r_int
id|ptr
suffix:semicolon
multiline_comment|/* byte pointer */
r_if
c_cond
(paren
op_logical_neg
id|snd_emu10k1_ptr_read
c_func
(paren
id|emu
comma
id|emu-&gt;gpr_base
op_plus
id|pcm-&gt;gpr_trigger
comma
l_int|0
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|ptr
op_assign
id|snd_emu10k1_ptr_read
c_func
(paren
id|emu
comma
id|emu-&gt;gpr_base
op_plus
id|pcm-&gt;gpr_ptr
comma
l_int|0
)paren
op_lshift
l_int|2
suffix:semicolon
r_return
id|snd_pcm_indirect_playback_pointer
c_func
(paren
id|substream
comma
op_amp
id|pcm-&gt;pcm_rec
comma
id|ptr
)paren
suffix:semicolon
)brace
DECL|variable|snd_emu10k1_fx8010_playback
r_static
id|snd_pcm_hardware_t
id|snd_emu10k1_fx8010_playback
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
multiline_comment|/* SNDRV_PCM_INFO_MMAP_VALID | */
id|SNDRV_PCM_INFO_PAUSE
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_48000
comma
dot
id|rate_min
op_assign
l_int|48000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|1
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|1024
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|1024
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|function|snd_emu10k1_fx8010_playback_open
r_static
r_int
id|snd_emu10k1_fx8010_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_emu10k1_fx8010_pcm_t
op_star
id|pcm
op_assign
op_amp
id|emu-&gt;fx8010.pcm
(braket
id|substream-&gt;number
)braket
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_emu10k1_fx8010_playback
suffix:semicolon
id|runtime-&gt;hw.channels_min
op_assign
id|runtime-&gt;hw.channels_max
op_assign
id|pcm-&gt;channels
suffix:semicolon
id|runtime-&gt;hw.period_bytes_max
op_assign
(paren
id|pcm-&gt;buffer_size
op_star
l_int|2
)paren
op_div
l_int|2
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|emu-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcm-&gt;valid
op_eq
l_int|0
)paren
(brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|emu-&gt;reg_lock
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|pcm-&gt;opened
op_assign
l_int|1
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|emu-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_emu10k1_fx8010_playback_close
r_static
r_int
id|snd_emu10k1_fx8010_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_emu10k1_fx8010_pcm_t
op_star
id|pcm
op_assign
op_amp
id|emu-&gt;fx8010.pcm
(braket
id|substream-&gt;number
)braket
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|emu-&gt;reg_lock
)paren
suffix:semicolon
id|pcm-&gt;opened
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|emu-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_emu10k1_fx8010_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_emu10k1_fx8010_playback_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_emu10k1_fx8010_playback_open
comma
dot
id|close
op_assign
id|snd_emu10k1_fx8010_playback_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_emu10k1_fx8010_playback_hw_params
comma
dot
id|hw_free
op_assign
id|snd_emu10k1_fx8010_playback_hw_free
comma
dot
id|prepare
op_assign
id|snd_emu10k1_fx8010_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_emu10k1_fx8010_playback_trigger
comma
dot
id|pointer
op_assign
id|snd_emu10k1_fx8010_playback_pointer
comma
dot
id|ack
op_assign
id|snd_emu10k1_fx8010_playback_transfer
comma
)brace
suffix:semicolon
DECL|function|snd_emu10k1_pcm_efx_free
r_static
r_void
id|snd_emu10k1_pcm_efx_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|emu10k1_t
op_star
id|emu
op_assign
id|pcm-&gt;private_data
suffix:semicolon
id|emu-&gt;pcm_efx
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_emu10k1_pcm_efx
r_int
id|__devinit
id|snd_emu10k1_pcm_efx
c_func
(paren
id|emu10k1_t
op_star
id|emu
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|emu-&gt;card
comma
l_string|&quot;emu10k1 efx&quot;
comma
id|device
comma
l_int|8
comma
l_int|1
comma
op_amp
id|pcm
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|emu
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_emu10k1_pcm_efx_free
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_emu10k1_fx8010_playback_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_emu10k1_capture_efx_ops
)paren
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;EMU10K1 EFX&quot;
)paren
suffix:semicolon
id|emu-&gt;pcm_efx
op_assign
id|pcm
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
multiline_comment|/* EFX capture - record the &quot;FXBUS2&quot; channels, by default we connect the EXTINs &n;&t; * to these&n;&t; */
multiline_comment|/* emu-&gt;efx_voices_mask[0] = FXWC_DEFAULTROUTE_C | FXWC_DEFAULTROUTE_A; */
r_if
c_cond
(paren
id|emu-&gt;audigy
)paren
(brace
id|emu-&gt;efx_voices_mask
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|emu-&gt;efx_voices_mask
(braket
l_int|1
)braket
op_assign
l_int|0xffff
suffix:semicolon
)brace
r_else
(brace
id|emu-&gt;efx_voices_mask
(braket
l_int|0
)braket
op_assign
l_int|0xffff
suffix:semicolon
id|emu-&gt;efx_voices_mask
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|snd_ctl_add
c_func
(paren
id|emu-&gt;card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_emu10k1_pcm_efx_voices_mask
comma
id|emu
)paren
)paren
suffix:semicolon
id|snd_pcm_lib_preallocate_pages_for_all
c_func
(paren
id|pcm
comma
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|emu-&gt;pci
)paren
comma
l_int|64
op_star
l_int|1024
comma
l_int|64
op_star
l_int|1024
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
