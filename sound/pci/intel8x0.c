multiline_comment|/*&n; *   ALSA driver for Intel ICH (i8x0) chipsets&n; *&n; *&t;Copyright (c) 2000 Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *&n; *&n; *   This code also contains alpha support for SiS 735 chipsets provided&n; *   by Mike Pieper &lt;mptei@users.sourceforge.net&gt;. We have no datasheet&n; *   for SiS735, so the code is not fully functional.&n; *&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
macro_line|#include &lt;sound/ac97_codec.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#include &lt;sound/mpu401.h&gt;
DECL|macro|SNDRV_GET_ID
mdefine_line|#define SNDRV_GET_ID
macro_line|#include &lt;sound/initval.h&gt;
id|EXPORT_NO_SYMBOLS
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jaroslav Kysela &lt;perex@suse.cz&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Intel 82801AA,82901AB,i810,i820,i830,i840,MX440; SiS 7012&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_CLASSES
c_func
(paren
l_string|&quot;{sound}&quot;
)paren
suffix:semicolon
id|MODULE_DEVICES
c_func
(paren
l_string|&quot;{{Intel,82801AA},&quot;
l_string|&quot;{Intel,82901AB},&quot;
l_string|&quot;{Intel,82801BA},&quot;
l_string|&quot;{Intel,ICH3},&quot;
l_string|&quot;{Intel,ICH4},&quot;
l_string|&quot;{Intel,MX440},&quot;
l_string|&quot;{SiS,SI7012},&quot;
l_string|&quot;{NVidia,NForce Audio},&quot;
l_string|&quot;{AMD,AMD768},&quot;
l_string|&quot;{AMD,AMD8111}}&quot;
)paren
suffix:semicolon
DECL|macro|SUPPORT_JOYSTICK
mdefine_line|#define SUPPORT_JOYSTICK 1
DECL|macro|SUPPORT_MIDI
mdefine_line|#define SUPPORT_MIDI 1
DECL|variable|snd_index
r_static
r_int
id|snd_index
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_IDX
suffix:semicolon
multiline_comment|/* Index 0-MAX */
DECL|variable|snd_id
r_static
r_char
op_star
id|snd_id
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_STR
suffix:semicolon
multiline_comment|/* ID for this card */
DECL|variable|snd_enable
r_static
r_int
id|snd_enable
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_ENABLE_PNP
suffix:semicolon
multiline_comment|/* Enable this card */
DECL|variable|snd_ac97_clock
r_static
r_int
id|snd_ac97_clock
(braket
id|SNDRV_CARDS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
(paren
id|SNDRV_CARDS
op_minus
l_int|1
)paren
)braket
op_assign
l_int|0
)brace
suffix:semicolon
macro_line|#ifdef SUPPORT_JOYSTICK
DECL|variable|snd_joystick_port
r_static
r_int
id|snd_joystick_port
(braket
id|SNDRV_CARDS
)braket
op_assign
macro_line|#ifdef CONFIG_ISA
(brace
l_int|0x200
)brace
suffix:semicolon
multiline_comment|/* enable as default */
macro_line|#else
(brace
l_int|0
)brace
suffix:semicolon
multiline_comment|/* disabled */
macro_line|#endif
macro_line|#endif
macro_line|#ifdef SUPPORT_MIDI
DECL|variable|snd_mpu_port
r_static
r_int
id|snd_mpu_port
(braket
id|SNDRV_CARDS
)braket
suffix:semicolon
multiline_comment|/* disabled */
macro_line|#endif
id|MODULE_PARM
c_func
(paren
id|snd_index
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_index
comma
l_string|&quot;Index value for Intel i8x0 soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_index
comma
id|SNDRV_INDEX_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_id
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_id
comma
l_string|&quot;ID string for Intel i8x0 soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_id
comma
id|SNDRV_ID_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_enable
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_enable
comma
l_string|&quot;Enable Intel i8x0 soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_enable
comma
id|SNDRV_ENABLE_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_ac97_clock
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_ac97_clock
comma
l_string|&quot;AC&squot;97 codec clock (0 = auto-detect).&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_ac97_clock
comma
id|SNDRV_ENABLED
l_string|&quot;,default:0&quot;
)paren
suffix:semicolon
macro_line|#ifdef SUPPORT_JOYSTICK
id|MODULE_PARM
c_func
(paren
id|snd_joystick_port
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_joystick_port
comma
l_string|&quot;Joystick port address for Intel i8x0 soundcard. (0 = disabled)&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_joystick_port
comma
id|SNDRV_ENABLED
l_string|&quot;,allows:{{0},{0x200}},dialog:list&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef SUPPORT_MIDI
id|MODULE_PARM
c_func
(paren
id|snd_mpu_port
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_mpu_port
comma
l_string|&quot;MPU401 port # for Intel i8x0 driver.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_mpu_port
comma
id|SNDRV_ENABLED
l_string|&quot;,allows:{{0},{0x330},{0x300}},dialog:list&quot;
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; *  Direct registers&n; */
macro_line|#ifndef PCI_DEVICE_ID_INTEL_82801
DECL|macro|PCI_DEVICE_ID_INTEL_82801
mdefine_line|#define PCI_DEVICE_ID_INTEL_82801       0x2415
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_INTEL_82901
DECL|macro|PCI_DEVICE_ID_INTEL_82901
mdefine_line|#define PCI_DEVICE_ID_INTEL_82901       0x2425
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_INTEL_82801BA
DECL|macro|PCI_DEVICE_ID_INTEL_82801BA
mdefine_line|#define PCI_DEVICE_ID_INTEL_82801BA     0x2445
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_INTEL_440MX
DECL|macro|PCI_DEVICE_ID_INTEL_440MX
mdefine_line|#define PCI_DEVICE_ID_INTEL_440MX       0x7195
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_INTEL_ICH3
DECL|macro|PCI_DEVICE_ID_INTEL_ICH3
mdefine_line|#define PCI_DEVICE_ID_INTEL_ICH3&t;0x2485
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_INTEL_ICH4
DECL|macro|PCI_DEVICE_ID_INTEL_ICH4
mdefine_line|#define PCI_DEVICE_ID_INTEL_ICH4&t;0x24c5
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_SI_7012
DECL|macro|PCI_DEVICE_ID_SI_7012
mdefine_line|#define PCI_DEVICE_ID_SI_7012&t;&t;0x7012
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_NVIDIA_MCP_AUDIO
DECL|macro|PCI_DEVICE_ID_NVIDIA_MCP_AUDIO
mdefine_line|#define PCI_DEVICE_ID_NVIDIA_MCP_AUDIO&t;0x01b1
macro_line|#endif
DECL|macro|DEVICE_INTEL
mdefine_line|#define DEVICE_INTEL&t;0
DECL|macro|DEVICE_SIS
mdefine_line|#define DEVICE_SIS&t;1
DECL|macro|ICHREG
mdefine_line|#define ICHREG(ice, x) ((ice)-&gt;bmport + ICH_REG_##x)
DECL|macro|ICHREG2
mdefine_line|#define ICHREG2(ice, x) ((ice)-&gt;bmport + x)
multiline_comment|/* capture block */
DECL|macro|ICH_REG_PI_BDBAR
mdefine_line|#define ICH_REG_PI_BDBAR&t;&t;0x00&t;/* dword - buffer descriptor list base address */
DECL|macro|ICH_REG_PI_CIV
mdefine_line|#define ICH_REG_PI_CIV&t;&t;&t;0x04&t;/* byte - current index value */
DECL|macro|ICH_REG_PI_LVI
mdefine_line|#define ICH_REG_PI_LVI&t;&t;&t;0x05&t;/* byte - last valid index */
DECL|macro|ICH_REG_LVI_MASK
mdefine_line|#define   ICH_REG_LVI_MASK&t;&t;0x1f
DECL|macro|ICH_REG_PI_SR
mdefine_line|#define ICH_REG_PI_SR&t;&t;&t;0x06&t;/* byte - status register */
DECL|macro|ICH_FIFOE
mdefine_line|#define   ICH_FIFOE&t;&t;&t;0x10&t;/* FIFO error */
DECL|macro|ICH_BCIS
mdefine_line|#define   ICH_BCIS&t;&t;&t;0x08&t;/* buffer completion interrupt status */
DECL|macro|ICH_LVBCI
mdefine_line|#define   ICH_LVBCI&t;&t;&t;0x04&t;/* last valid buffer completion interrupt */
DECL|macro|ICH_CELV
mdefine_line|#define   ICH_CELV&t;&t;&t;0x02&t;/* current equals last valid */
DECL|macro|ICH_DCH
mdefine_line|#define   ICH_DCH&t;&t;&t;0x01&t;/* DMA controller halted */
DECL|macro|ICH_REG_PI_PICB
mdefine_line|#define ICH_REG_PI_PICB&t;&t;&t;0x08&t;/* word - position in current buffer */
DECL|macro|ICH_REG_PI_PIV
mdefine_line|#define ICH_REG_PI_PIV&t;&t;&t;0x0a&t;/* byte - prefetched index value */
DECL|macro|ICH_REG_PIV_MASK
mdefine_line|#define   ICH_REG_PIV_MASK&t;&t;0x1f&t;/* mask */
DECL|macro|ICH_REG_PI_CR
mdefine_line|#define ICH_REG_PI_CR&t;&t;&t;0x0b&t;/* byte - control register */
DECL|macro|ICH_IOCE
mdefine_line|#define   ICH_IOCE&t;&t;&t;0x10&t;/* interrupt on completion enable */
DECL|macro|ICH_FEIE
mdefine_line|#define   ICH_FEIE&t;&t;&t;0x08&t;/* fifo error interrupt enable */
DECL|macro|ICH_LVBIE
mdefine_line|#define   ICH_LVBIE&t;&t;&t;0x04&t;/* last valid buffer interrupt enable */
DECL|macro|ICH_RESETREGS
mdefine_line|#define   ICH_RESETREGS&t;&t;&t;0x02&t;/* reset busmaster registers */
DECL|macro|ICH_STARTBM
mdefine_line|#define   ICH_STARTBM&t;&t;&t;0x01&t;/* start busmaster operation */
multiline_comment|/* playback block */
DECL|macro|ICH_REG_PO_BDBAR
mdefine_line|#define ICH_REG_PO_BDBAR&t;&t;0x10&t;/* dword - buffer descriptor list base address */
DECL|macro|ICH_REG_PO_CIV
mdefine_line|#define ICH_REG_PO_CIV&t;&t;&t;0x14&t;/* byte - current index value */
DECL|macro|ICH_REG_PO_LVI
mdefine_line|#define ICH_REG_PO_LVI&t;&t;&t;0x15&t;/* byte - last valid command */
DECL|macro|ICH_REG_PO_SR
mdefine_line|#define ICH_REG_PO_SR&t;&t;&t;0x16&t;/* byte - status register */
DECL|macro|ICH_REG_PO_PICB
mdefine_line|#define ICH_REG_PO_PICB&t;&t;&t;0x18&t;/* word - position in current buffer */
DECL|macro|ICH_REG_PO_PIV
mdefine_line|#define ICH_REG_PO_PIV&t;&t;&t;0x1a&t;/* byte - prefetched index value */
DECL|macro|ICH_REG_PO_CR
mdefine_line|#define ICH_REG_PO_CR&t;&t;&t;0x1b&t;/* byte - control register */
multiline_comment|/* mic capture block */
DECL|macro|ICH_REG_MC_BDBAR
mdefine_line|#define ICH_REG_MC_BDBAR&t;&t;0x20&t;/* dword - buffer descriptor list base address */
DECL|macro|ICH_REG_MC_CIV
mdefine_line|#define ICH_REG_MC_CIV&t;&t;&t;0x24&t;/* byte - current index value */
DECL|macro|ICH_REG_MC_LVI
mdefine_line|#define ICH_REG_MC_LVI&t;&t;&t;0x25&t;/* byte - last valid command */
DECL|macro|ICH_REG_MC_SR
mdefine_line|#define ICH_REG_MC_SR&t;&t;&t;0x26&t;/* byte - status register */
DECL|macro|ICH_REG_MC_PICB
mdefine_line|#define ICH_REG_MC_PICB&t;&t;&t;0x28&t;/* word - position in current buffer */
DECL|macro|ICH_REG_MC_PIV
mdefine_line|#define ICH_REG_MC_PIV&t;&t;&t;0x2a&t;/* byte - prefetched index value */
DECL|macro|ICH_REG_MC_CR
mdefine_line|#define ICH_REG_MC_CR&t;&t;&t;0x2b&t;/* byte - control register */
multiline_comment|/* global block */
DECL|macro|ICH_REG_GLOB_CNT
mdefine_line|#define ICH_REG_GLOB_CNT&t;&t;0x2c&t;/* dword - global control */
DECL|macro|ICH_PCM_246_MASK
mdefine_line|#define   ICH_PCM_246_MASK&t;0x00300000&t;/* 6 channels (not all chips) */
DECL|macro|ICH_PCM_6
mdefine_line|#define   ICH_PCM_6&t;&t;0x00200000&t;/* 6 channels (not all chips) */
DECL|macro|ICH_PCM_4
mdefine_line|#define   ICH_PCM_4&t;&t;0x00100000&t;/* 4 channels (not all chips) */
DECL|macro|ICH_PCM_2
mdefine_line|#define   ICH_PCM_2&t;&t;0x00000000&t;/* 2 channels (stereo) */
DECL|macro|ICH_SRIE
mdefine_line|#define   ICH_SRIE&t;&t;0x00000020&t;/* secondary resume interrupt enable */
DECL|macro|ICH_PRIE
mdefine_line|#define   ICH_PRIE&t;&t;0x00000010&t;/* primary resume interrupt enable */
DECL|macro|ICH_ACLINK
mdefine_line|#define   ICH_ACLINK&t;&t;0x00000008&t;/* AClink shut off */
DECL|macro|ICH_AC97WARM
mdefine_line|#define   ICH_AC97WARM&t;&t;0x00000004&t;/* AC&squot;97 warm reset */
DECL|macro|ICH_AC97COLD
mdefine_line|#define   ICH_AC97COLD&t;&t;0x00000002&t;/* AC&squot;97 cold reset */
DECL|macro|ICH_GIE
mdefine_line|#define   ICH_GIE&t;&t;0x00000001&t;/* GPI interrupt enable */
DECL|macro|ICH_REG_GLOB_STA
mdefine_line|#define ICH_REG_GLOB_STA&t;&t;0x30&t;/* dword - global status */
DECL|macro|ICH_MD3
mdefine_line|#define   ICH_MD3&t;&t;0x00020000&t;/* modem power down semaphore */
DECL|macro|ICH_AD3
mdefine_line|#define   ICH_AD3&t;&t;0x00010000&t;/* audio power down semaphore */
DECL|macro|ICH_RCS
mdefine_line|#define   ICH_RCS&t;&t;0x00008000&t;/* read completion status */
DECL|macro|ICH_BIT3
mdefine_line|#define   ICH_BIT3&t;&t;0x00004000&t;/* bit 3 slot 12 */
DECL|macro|ICH_BIT2
mdefine_line|#define   ICH_BIT2&t;&t;0x00002000&t;/* bit 2 slot 12 */
DECL|macro|ICH_BIT1
mdefine_line|#define   ICH_BIT1&t;&t;0x00001000&t;/* bit 1 slot 12 */
DECL|macro|ICH_SRI
mdefine_line|#define   ICH_SRI&t;&t;0x00000800&t;/* secondary resume interrupt */
DECL|macro|ICH_PRI
mdefine_line|#define   ICH_PRI&t;&t;0x00000400&t;/* primary resume interrupt */
DECL|macro|ICH_SCR
mdefine_line|#define   ICH_SCR&t;&t;0x00000200&t;/* secondary codec ready */
DECL|macro|ICH_PCR
mdefine_line|#define   ICH_PCR&t;&t;0x00000100&t;/* primary codec ready */
DECL|macro|ICH_MCINT
mdefine_line|#define   ICH_MCINT&t;&t;0x00000080&t;/* MIC capture interrupt */
DECL|macro|ICH_POINT
mdefine_line|#define   ICH_POINT&t;&t;0x00000040&t;/* playback interrupt */
DECL|macro|ICH_PIINT
mdefine_line|#define   ICH_PIINT&t;&t;0x00000020&t;/* capture interrupt */
DECL|macro|ICH_MOINT
mdefine_line|#define   ICH_MOINT&t;&t;0x00000004&t;/* modem playback interrupt */
DECL|macro|ICH_MIINT
mdefine_line|#define   ICH_MIINT&t;&t;0x00000002&t;/* modem capture interrupt */
DECL|macro|ICH_GSCI
mdefine_line|#define   ICH_GSCI&t;&t;0x00000001&t;/* GPI status change interrupt */
DECL|macro|ICH_REG_ACC_SEMA
mdefine_line|#define ICH_REG_ACC_SEMA&t;&t;0x34&t;/* byte - codec write semaphore */
DECL|macro|ICH_CAS
mdefine_line|#define   ICH_CAS&t;&t;&t;0x01&t;/* codec access semaphore */
DECL|macro|ICH_MAX_FRAGS
mdefine_line|#define ICH_MAX_FRAGS&t;&t;32&t;&t;/* max hw frags */
multiline_comment|/*&n; *  &n; */
r_typedef
r_struct
(brace
DECL|member|reg_offset
r_int
r_int
id|reg_offset
suffix:semicolon
DECL|member|bdbar
id|u32
op_star
id|bdbar
suffix:semicolon
multiline_comment|/* CPU address (32bit) */
DECL|member|bdbar_addr
r_int
r_int
id|bdbar_addr
suffix:semicolon
multiline_comment|/* PCI bus address (32bit) */
DECL|member|substream
id|snd_pcm_substream_t
op_star
id|substream
suffix:semicolon
DECL|member|physbuf
r_int
r_int
id|physbuf
suffix:semicolon
multiline_comment|/* physical address (32bit) */
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
DECL|member|fragsize
r_int
r_int
id|fragsize
suffix:semicolon
DECL|member|fragsize1
r_int
r_int
id|fragsize1
suffix:semicolon
DECL|member|position
r_int
r_int
id|position
suffix:semicolon
DECL|member|frags
r_int
id|frags
suffix:semicolon
DECL|member|lvi
r_int
id|lvi
suffix:semicolon
DECL|member|lvi_frag
r_int
id|lvi_frag
suffix:semicolon
DECL|member|ack
r_int
id|ack
suffix:semicolon
DECL|member|ack_reload
r_int
id|ack_reload
suffix:semicolon
macro_line|#ifdef CONFIG_PM
DECL|member|civ_saved
r_int
r_char
id|civ_saved
suffix:semicolon
DECL|member|piv_saved
r_int
r_char
id|piv_saved
suffix:semicolon
DECL|member|picb_saved
r_int
r_int
id|picb_saved
suffix:semicolon
macro_line|#endif
DECL|typedef|ichdev_t
)brace
id|ichdev_t
suffix:semicolon
DECL|typedef|intel8x0_t
r_typedef
r_struct
id|_snd_intel8x0
id|intel8x0_t
suffix:semicolon
DECL|macro|chip_t
mdefine_line|#define chip_t intel8x0_t
DECL|struct|_snd_intel8x0
r_struct
id|_snd_intel8x0
(brace
DECL|member|device_type
r_int
r_int
id|device_type
suffix:semicolon
DECL|member|ac97_name
r_char
id|ac97_name
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|ctrl_name
r_char
id|ctrl_name
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|dma_playback_size
r_int
r_int
id|dma_playback_size
suffix:semicolon
DECL|member|dma_capture_size
r_int
r_int
id|dma_capture_size
suffix:semicolon
DECL|member|dma_mic_size
r_int
r_int
id|dma_mic_size
suffix:semicolon
DECL|member|irq
r_int
id|irq
suffix:semicolon
DECL|member|port
r_int
r_int
id|port
suffix:semicolon
DECL|member|res_port
r_struct
id|resource
op_star
id|res_port
suffix:semicolon
DECL|member|bmport
r_int
r_int
id|bmport
suffix:semicolon
DECL|member|res_bmport
r_struct
id|resource
op_star
id|res_bmport
suffix:semicolon
DECL|member|pci
r_struct
id|pci_dev
op_star
id|pci
suffix:semicolon
DECL|member|card
id|snd_card_t
op_star
id|card
suffix:semicolon
DECL|member|pcm
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
DECL|member|pcm_mic
id|snd_pcm_t
op_star
id|pcm_mic
suffix:semicolon
DECL|member|playback
id|ichdev_t
id|playback
suffix:semicolon
DECL|member|capture
id|ichdev_t
id|capture
suffix:semicolon
DECL|member|capture_mic
id|ichdev_t
id|capture_mic
suffix:semicolon
DECL|member|multi4
r_int
id|multi4
suffix:colon
l_int|1
comma
DECL|member|multi6
id|multi6
suffix:colon
l_int|1
suffix:semicolon
DECL|member|in_ac97_init
r_int
id|in_ac97_init
suffix:colon
l_int|1
suffix:semicolon
DECL|member|ac97
id|ac97_t
op_star
id|ac97
suffix:semicolon
DECL|member|ac97sec
id|ac97_t
op_star
id|ac97sec
suffix:semicolon
DECL|member|rmidi
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
DECL|member|reg_lock
id|spinlock_t
id|reg_lock
suffix:semicolon
DECL|member|ac97_lock
id|spinlock_t
id|ac97_lock
suffix:semicolon
DECL|member|proc_entry
id|snd_info_entry_t
op_star
id|proc_entry
suffix:semicolon
DECL|member|bdbars
id|u32
op_star
id|bdbars
suffix:semicolon
DECL|member|bdbars_addr
id|dma_addr_t
id|bdbars_addr
suffix:semicolon
DECL|member|reg_pi_sr
r_int
r_int
id|reg_pi_sr
suffix:semicolon
DECL|member|reg_pi_picb
r_int
r_int
id|reg_pi_picb
suffix:semicolon
DECL|member|reg_po_sr
r_int
r_int
id|reg_po_sr
suffix:semicolon
DECL|member|reg_po_picb
r_int
r_int
id|reg_po_picb
suffix:semicolon
DECL|member|reg_mc_sr
r_int
r_int
id|reg_mc_sr
suffix:semicolon
DECL|member|reg_mc_picb
r_int
r_int
id|reg_mc_picb
suffix:semicolon
macro_line|#ifdef CONFIG_PM
DECL|member|in_suspend
r_int
id|in_suspend
suffix:semicolon
macro_line|#endif
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|snd_intel8x0_ids
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
l_int|0x8086
comma
l_int|0x2415
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|DEVICE_INTEL
)brace
comma
multiline_comment|/* 82801AA */
(brace
l_int|0x8086
comma
l_int|0x2425
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|DEVICE_INTEL
)brace
comma
multiline_comment|/* 82901AB */
(brace
l_int|0x8086
comma
l_int|0x2445
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|DEVICE_INTEL
)brace
comma
multiline_comment|/* 82801BA */
(brace
l_int|0x8086
comma
l_int|0x2485
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|DEVICE_INTEL
)brace
comma
multiline_comment|/* ICH3 */
(brace
l_int|0x8086
comma
l_int|0x24c5
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|DEVICE_INTEL
)brace
comma
multiline_comment|/* ICH4 */
(brace
l_int|0x8086
comma
l_int|0x7195
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|DEVICE_INTEL
)brace
comma
multiline_comment|/* 440MX */
(brace
l_int|0x1039
comma
l_int|0x7012
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|DEVICE_SIS
)brace
comma
multiline_comment|/* SI7012 */
(brace
l_int|0x10de
comma
l_int|0x01b1
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|DEVICE_INTEL
)brace
comma
multiline_comment|/* NFORCE */
(brace
l_int|0x1022
comma
l_int|0x764d
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|DEVICE_INTEL
)brace
comma
multiline_comment|/* AMD8111 */
(brace
l_int|0x1022
comma
l_int|0x7445
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|DEVICE_INTEL
)brace
comma
multiline_comment|/* AMD768 */
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|snd_intel8x0_ids
)paren
suffix:semicolon
multiline_comment|/*&n; *  Basic I/O&n; */
DECL|function|snd_intel8x0_codec_semaphore
r_static
r_int
id|snd_intel8x0_codec_semaphore
c_func
(paren
id|intel8x0_t
op_star
id|chip
comma
r_int
r_int
id|codec
)paren
(brace
r_int
id|time
suffix:semicolon
multiline_comment|/* codec ready ? */
r_if
c_cond
(paren
(paren
id|inl
c_func
(paren
id|ICHREG
c_func
(paren
id|chip
comma
id|GLOB_STA
)paren
)paren
op_amp
(paren
id|codec
ques
c_cond
id|ICH_SCR
suffix:colon
id|ICH_PCR
)paren
)paren
op_eq
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
multiline_comment|/* Anyone holding a semaphore for 1 msec should be shot... */
id|time
op_assign
l_int|100
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|inb
c_func
(paren
id|ICHREG
c_func
(paren
id|chip
comma
id|ACC_SEMA
)paren
)paren
op_amp
id|ICH_CAS
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|time
op_decrement
)paren
suffix:semicolon
multiline_comment|/* access to some forbidden (non existant) ac97 registers will not&n;&t; * reset the semaphore. So even if you don&squot;t get the semaphore, still&n;&t; * continue the access. We don&squot;t need the semaphore anyway. */
id|snd_printk
c_func
(paren
l_string|&quot;codec_semaphore: semaphore is not ready [0x%x][0x%x]&bslash;n&quot;
comma
id|inb
c_func
(paren
id|ICHREG
c_func
(paren
id|chip
comma
id|ACC_SEMA
)paren
)paren
comma
id|inl
c_func
(paren
id|ICHREG
c_func
(paren
id|chip
comma
id|GLOB_STA
)paren
)paren
)paren
suffix:semicolon
id|inw
c_func
(paren
id|chip-&gt;port
)paren
suffix:semicolon
multiline_comment|/* clear semaphore flag */
multiline_comment|/* I don&squot;t care about the semaphore */
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
DECL|function|snd_intel8x0_codec_write
r_static
r_void
id|snd_intel8x0_codec_write
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|intel8x0_t
comma
id|ac97-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;ac97_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_intel8x0_codec_semaphore
c_func
(paren
id|chip
comma
id|ac97-&gt;num
)paren
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|chip-&gt;in_ac97_init
)paren
id|snd_printk
c_func
(paren
l_string|&quot;codec_write %d: semaphore is not ready for register 0x%x&bslash;n&quot;
comma
id|ac97-&gt;num
comma
id|reg
)paren
suffix:semicolon
)brace
id|outw
c_func
(paren
id|val
comma
id|chip-&gt;port
op_plus
id|reg
op_plus
id|ac97-&gt;num
op_star
l_int|0x80
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;ac97_lock
)paren
suffix:semicolon
)brace
DECL|function|snd_intel8x0_codec_read
r_static
r_int
r_int
id|snd_intel8x0_codec_read
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|intel8x0_t
comma
id|ac97-&gt;private_data
comma
r_return
op_complement
l_int|0
)paren
suffix:semicolon
r_int
r_int
id|res
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;ac97_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_intel8x0_codec_semaphore
c_func
(paren
id|chip
comma
id|ac97-&gt;num
)paren
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|chip-&gt;in_ac97_init
)paren
id|snd_printk
c_func
(paren
l_string|&quot;codec_read %d: semaphore is not ready for register 0x%x&bslash;n&quot;
comma
id|ac97-&gt;num
comma
id|reg
)paren
suffix:semicolon
id|res
op_assign
l_int|0xffff
suffix:semicolon
)brace
r_else
(brace
id|res
op_assign
id|inw
c_func
(paren
id|chip-&gt;port
op_plus
id|reg
op_plus
id|ac97-&gt;num
op_star
l_int|0x80
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_assign
id|inl
c_func
(paren
id|ICHREG
c_func
(paren
id|chip
comma
id|GLOB_STA
)paren
)paren
)paren
op_amp
id|ICH_RCS
)paren
(brace
multiline_comment|/* reset RCS and preserve other R/WC bits */
id|outl
c_func
(paren
id|tmp
op_amp
op_complement
(paren
id|ICH_SRI
op_or
id|ICH_PRI
op_or
id|ICH_GSCI
)paren
comma
id|ICHREG
c_func
(paren
id|chip
comma
id|GLOB_STA
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chip-&gt;in_ac97_init
)paren
id|snd_printk
c_func
(paren
l_string|&quot;codec_read %d: read timeout for register 0x%x&bslash;n&quot;
comma
id|ac97-&gt;num
comma
id|reg
)paren
suffix:semicolon
id|res
op_assign
l_int|0xffff
suffix:semicolon
)brace
)brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;ac97_lock
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|snd_intel8x0_trigger
r_static
r_int
id|snd_intel8x0_trigger
c_func
(paren
id|intel8x0_t
op_star
id|chip
comma
id|ichdev_t
op_star
id|ichdev
comma
r_int
id|cmd
)paren
(brace
r_int
r_char
id|val
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|port
op_assign
id|chip-&gt;bmport
op_plus
id|ichdev-&gt;reg_offset
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_RESUME
suffix:colon
id|val
op_assign
id|ICH_IOCE
op_or
id|ICH_STARTBM
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_SUSPEND
suffix:colon
id|val
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_PUSH
suffix:colon
id|val
op_assign
id|ICH_IOCE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_RELEASE
suffix:colon
id|val
op_assign
id|ICH_IOCE
op_or
id|ICH_STARTBM
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|outb
c_func
(paren
id|val
comma
id|port
op_plus
id|ICH_REG_PI_CR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_STOP
)paren
(brace
multiline_comment|/* reset whole DMA things */
r_while
c_loop
(paren
op_logical_neg
(paren
id|inb
c_func
(paren
id|port
op_plus
id|chip-&gt;reg_pi_sr
)paren
op_amp
id|ICH_DCH
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|ICH_RESETREGS
comma
id|port
op_plus
id|ICH_REG_PI_CR
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_intel8x0_setup_periods
r_static
r_void
id|snd_intel8x0_setup_periods
c_func
(paren
id|intel8x0_t
op_star
id|chip
comma
id|ichdev_t
op_star
id|ichdev
)paren
(brace
r_int
id|idx
suffix:semicolon
id|u32
op_star
id|bdbar
op_assign
id|ichdev-&gt;bdbar
suffix:semicolon
r_int
r_int
id|port
op_assign
id|chip-&gt;bmport
op_plus
id|ichdev-&gt;reg_offset
suffix:semicolon
r_int
id|shiftlen
op_assign
(paren
id|chip-&gt;device_type
op_eq
id|DEVICE_SIS
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|outl
c_func
(paren
id|ichdev-&gt;bdbar_addr
comma
id|port
op_plus
id|ICH_REG_PI_BDBAR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ichdev-&gt;size
op_eq
id|ichdev-&gt;fragsize
)paren
(brace
id|ichdev-&gt;ack_reload
op_assign
id|ichdev-&gt;ack
op_assign
l_int|2
suffix:semicolon
id|ichdev-&gt;fragsize1
op_assign
id|ichdev-&gt;fragsize
op_rshift
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
(paren
id|ICH_REG_LVI_MASK
op_plus
l_int|1
)paren
op_star
l_int|2
suffix:semicolon
id|idx
op_add_assign
l_int|4
)paren
(brace
id|bdbar
(braket
id|idx
op_plus
l_int|0
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|ichdev-&gt;physbuf
)paren
suffix:semicolon
id|bdbar
(braket
id|idx
op_plus
l_int|1
)braket
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0x80000000
op_or
multiline_comment|/* interrupt on completion */
id|ichdev-&gt;fragsize1
op_rshift
id|shiftlen
)paren
suffix:semicolon
id|bdbar
(braket
id|idx
op_plus
l_int|2
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|ichdev-&gt;physbuf
op_plus
(paren
id|ichdev-&gt;size
op_rshift
l_int|1
)paren
)paren
suffix:semicolon
id|bdbar
(braket
id|idx
op_plus
l_int|3
)braket
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0x80000000
op_or
multiline_comment|/* interrupt on completion */
id|ichdev-&gt;fragsize1
op_rshift
id|shiftlen
)paren
suffix:semicolon
)brace
id|ichdev-&gt;frags
op_assign
l_int|2
suffix:semicolon
)brace
r_else
(brace
id|ichdev-&gt;ack_reload
op_assign
id|ichdev-&gt;ack
op_assign
l_int|1
suffix:semicolon
id|ichdev-&gt;fragsize1
op_assign
id|ichdev-&gt;fragsize
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
(paren
id|ICH_REG_LVI_MASK
op_plus
l_int|1
)paren
op_star
l_int|2
suffix:semicolon
id|idx
op_add_assign
l_int|2
)paren
(brace
id|bdbar
(braket
id|idx
op_plus
l_int|0
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|ichdev-&gt;physbuf
op_plus
(paren
(paren
(paren
id|idx
op_rshift
l_int|1
)paren
op_star
id|ichdev-&gt;fragsize
)paren
op_mod
id|ichdev-&gt;size
)paren
)paren
suffix:semicolon
id|bdbar
(braket
id|idx
op_plus
l_int|1
)braket
op_assign
id|cpu_to_le32
c_func
(paren
l_int|0x80000000
op_or
multiline_comment|/* interrupt on completion */
id|ichdev-&gt;fragsize
op_rshift
id|shiftlen
)paren
suffix:semicolon
singleline_comment|// printk(&quot;bdbar[%i] = 0x%x [0x%x]&bslash;n&quot;, idx + 0, bdbar[idx + 0], bdbar[idx + 1]);
)brace
id|ichdev-&gt;frags
op_assign
id|ichdev-&gt;size
op_div
id|ichdev-&gt;fragsize
suffix:semicolon
)brace
id|outb
c_func
(paren
id|ichdev-&gt;lvi
op_assign
id|ICH_REG_LVI_MASK
comma
id|port
op_plus
id|ICH_REG_PI_LVI
)paren
suffix:semicolon
id|ichdev-&gt;lvi_frag
op_assign
id|ICH_REG_LVI_MASK
op_mod
id|ichdev-&gt;frags
suffix:semicolon
id|ichdev-&gt;position
op_assign
l_int|0
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;lvi_frag = %i, frags = %i, period_size = 0x%x, period_size1 = 0x%x&bslash;n&quot;
comma
id|ichdev-&gt;lvi_frag
comma
id|ichdev-&gt;frags
comma
id|ichdev-&gt;fragsize
comma
id|ichdev-&gt;fragsize1
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* clear interrupts */
id|outb
c_func
(paren
id|ICH_FIFOE
op_or
id|ICH_BCIS
op_or
id|ICH_LVBCI
comma
id|port
op_plus
id|chip-&gt;reg_pi_sr
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Interrupt handler&n; */
DECL|function|snd_intel8x0_update
r_static
r_inline
r_void
id|snd_intel8x0_update
c_func
(paren
id|intel8x0_t
op_star
id|chip
comma
id|ichdev_t
op_star
id|ichdev
)paren
(brace
r_int
r_int
id|port
op_assign
id|chip-&gt;bmport
op_plus
id|ichdev-&gt;reg_offset
suffix:semicolon
r_int
id|ack
op_assign
l_int|0
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|ichdev-&gt;position
op_add_assign
id|ichdev-&gt;fragsize1
suffix:semicolon
id|ichdev-&gt;position
op_mod_assign
id|ichdev-&gt;size
suffix:semicolon
id|ichdev-&gt;lvi
op_increment
suffix:semicolon
id|ichdev-&gt;lvi
op_and_assign
id|ICH_REG_LVI_MASK
suffix:semicolon
id|outb
c_func
(paren
id|ichdev-&gt;lvi
comma
id|port
op_plus
id|ICH_REG_PI_LVI
)paren
suffix:semicolon
id|ichdev-&gt;lvi_frag
op_increment
suffix:semicolon
id|ichdev-&gt;lvi_frag
op_mod_assign
id|ichdev-&gt;frags
suffix:semicolon
id|ichdev-&gt;bdbar
(braket
id|ichdev-&gt;lvi
op_star
l_int|2
)braket
op_assign
id|ichdev-&gt;physbuf
op_plus
id|ichdev-&gt;lvi_frag
op_star
id|ichdev-&gt;fragsize1
suffix:semicolon
singleline_comment|// printk(&quot;new: bdbar[%i] = 0x%x [0x%x], prefetch = %i, all = 0x%x, 0x%x&bslash;n&quot;, ichdev-&gt;lvi * 2, ichdev-&gt;bdbar[ichdev-&gt;lvi * 2], ichdev-&gt;bdbar[ichdev-&gt;lvi * 2 + 1], inb(ICH_REG_PI_PIV + port), inl(port + 4), inb(port + ICH_REG_PI_CR));
r_if
c_cond
(paren
(paren
id|ack
op_assign
(paren
op_decrement
id|ichdev-&gt;ack
op_eq
l_int|0
)paren
)paren
op_ne
l_int|0
)paren
id|ichdev-&gt;ack
op_assign
id|ichdev-&gt;ack_reload
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ack
op_logical_and
id|ichdev-&gt;substream
)paren
id|snd_pcm_period_elapsed
c_func
(paren
id|ichdev-&gt;substream
)paren
suffix:semicolon
id|outb
c_func
(paren
id|ICH_FIFOE
op_or
id|ICH_BCIS
op_or
id|ICH_LVBCI
comma
id|port
op_plus
id|chip-&gt;reg_pi_sr
)paren
suffix:semicolon
)brace
DECL|function|snd_intel8x0_interrupt
r_static
r_void
id|snd_intel8x0_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|intel8x0_t
comma
id|dev_id
comma
r_return
)paren
suffix:semicolon
r_int
r_int
id|status
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|status
op_assign
id|inl
c_func
(paren
id|ICHREG
c_func
(paren
id|chip
comma
id|GLOB_STA
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
(paren
id|ICH_MCINT
op_or
id|ICH_POINT
op_or
id|ICH_PIINT
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* ack first */
id|outl
c_func
(paren
id|status
op_amp
(paren
id|ICH_MCINT
op_or
id|ICH_POINT
op_or
id|ICH_PIINT
)paren
comma
id|ICHREG
c_func
(paren
id|chip
comma
id|GLOB_STA
)paren
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|ICH_POINT
)paren
id|snd_intel8x0_update
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;playback
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|ICH_PIINT
)paren
id|snd_intel8x0_update
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;capture
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|ICH_MCINT
)paren
id|snd_intel8x0_update
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;capture_mic
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  PCM part&n; */
DECL|function|snd_intel8x0_playback_ioctl
r_static
r_int
id|snd_intel8x0_playback_ioctl
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_int
id|result
suffix:semicolon
id|result
op_assign
id|snd_pcm_lib_ioctl
c_func
(paren
id|substream
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
r_return
id|result
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_intel8x0_capture_ioctl
r_static
r_int
id|snd_intel8x0_capture_ioctl
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_int
id|result
suffix:semicolon
id|result
op_assign
id|snd_pcm_lib_ioctl
c_func
(paren
id|substream
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
r_return
id|result
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_intel8x0_playback_trigger
r_static
r_int
id|snd_intel8x0_playback_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|snd_intel8x0_trigger
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;playback
comma
id|cmd
)paren
suffix:semicolon
)brace
DECL|function|snd_intel8x0_capture_trigger
r_static
r_int
id|snd_intel8x0_capture_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|snd_intel8x0_trigger
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;capture
comma
id|cmd
)paren
suffix:semicolon
)brace
DECL|function|snd_intel8x0_hw_params
r_static
r_int
id|snd_intel8x0_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
r_return
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_intel8x0_hw_free
r_static
r_int
id|snd_intel8x0_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
DECL|function|snd_intel8x0_setup_multi_channels
r_static
r_void
id|snd_intel8x0_setup_multi_channels
c_func
(paren
id|intel8x0_t
op_star
id|chip
comma
r_int
id|channels
)paren
(brace
r_int
r_int
id|cnt
op_assign
id|inl
c_func
(paren
id|ICHREG
c_func
(paren
id|chip
comma
id|GLOB_CNT
)paren
)paren
op_amp
op_complement
id|ICH_PCM_246_MASK
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;multi4
op_logical_and
id|channels
op_eq
l_int|4
)paren
id|cnt
op_or_assign
id|ICH_PCM_4
suffix:semicolon
r_else
r_if
c_cond
(paren
id|chip-&gt;multi6
op_logical_and
id|channels
op_eq
l_int|6
)paren
id|cnt
op_or_assign
id|ICH_PCM_6
suffix:semicolon
id|outl
c_func
(paren
id|cnt
comma
id|ICHREG
c_func
(paren
id|chip
comma
id|GLOB_CNT
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_intel8x0_playback_prepare
r_static
r_int
id|snd_intel8x0_playback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|chip-&gt;playback.physbuf
op_assign
id|runtime-&gt;dma_addr
suffix:semicolon
id|chip-&gt;playback.size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;playback.fragsize
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|snd_intel8x0_setup_multi_channels
c_func
(paren
id|chip
comma
id|runtime-&gt;channels
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|snd_ac97_set_rate
c_func
(paren
id|chip-&gt;ac97
comma
id|AC97_PCM_FRONT_DAC_RATE
comma
id|runtime-&gt;rate
)paren
suffix:semicolon
id|snd_intel8x0_setup_periods
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;playback
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_intel8x0_capture_prepare
r_static
r_int
id|snd_intel8x0_capture_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|chip-&gt;capture.physbuf
op_assign
id|runtime-&gt;dma_addr
suffix:semicolon
id|chip-&gt;capture.size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;capture.fragsize
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_ac97_set_rate
c_func
(paren
id|chip-&gt;ac97
comma
id|AC97_PCM_LR_ADC_RATE
comma
id|runtime-&gt;rate
)paren
suffix:semicolon
id|snd_intel8x0_setup_periods
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;capture
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_intel8x0_playback_pointer
r_static
id|snd_pcm_uframes_t
id|snd_intel8x0_playback_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
suffix:semicolon
id|ptr
op_assign
id|chip-&gt;playback.fragsize1
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;device_type
op_eq
id|DEVICE_SIS
)paren
id|ptr
op_sub_assign
id|inw
c_func
(paren
id|ICHREG2
c_func
(paren
id|chip
comma
id|chip-&gt;reg_po_picb
)paren
)paren
suffix:semicolon
r_else
id|ptr
op_sub_assign
id|inw
c_func
(paren
id|ICHREG2
c_func
(paren
id|chip
comma
id|chip-&gt;reg_po_picb
)paren
)paren
op_lshift
l_int|1
suffix:semicolon
id|ptr
op_add_assign
id|chip-&gt;playback.position
suffix:semicolon
r_return
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|ptr
)paren
suffix:semicolon
)brace
DECL|function|snd_intel8x0_capture_pointer
r_static
id|snd_pcm_uframes_t
id|snd_intel8x0_capture_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
suffix:semicolon
id|ptr
op_assign
id|chip-&gt;capture.fragsize1
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;device_type
op_eq
id|DEVICE_SIS
)paren
id|ptr
op_sub_assign
id|inw
c_func
(paren
id|ICHREG2
c_func
(paren
id|chip
comma
id|chip-&gt;reg_pi_picb
)paren
)paren
suffix:semicolon
r_else
id|ptr
op_sub_assign
id|inw
c_func
(paren
id|ICHREG2
c_func
(paren
id|chip
comma
id|chip-&gt;reg_pi_picb
)paren
)paren
op_lshift
l_int|1
suffix:semicolon
id|ptr
op_add_assign
id|chip-&gt;capture.position
suffix:semicolon
r_return
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|ptr
)paren
suffix:semicolon
)brace
DECL|variable|snd_intel8x0_playback
r_static
id|snd_pcm_hardware_t
id|snd_intel8x0_playback
op_assign
(brace
id|info
suffix:colon
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_PAUSE
op_or
id|SNDRV_PCM_INFO_RESUME
)paren
comma
id|formats
suffix:colon
id|SNDRV_PCM_FMTBIT_S16_LE
comma
id|rates
suffix:colon
l_int|0
comma
id|rate_min
suffix:colon
l_int|8000
comma
id|rate_max
suffix:colon
l_int|48000
comma
id|channels_min
suffix:colon
l_int|2
comma
id|channels_max
suffix:colon
l_int|2
comma
id|buffer_bytes_max
suffix:colon
l_int|128
op_star
l_int|1024
comma
id|period_bytes_min
suffix:colon
l_int|32
comma
id|period_bytes_max
suffix:colon
l_int|128
op_star
l_int|1024
comma
id|periods_min
suffix:colon
l_int|1
comma
id|periods_max
suffix:colon
l_int|1024
comma
id|fifo_size
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|snd_intel8x0_capture
r_static
id|snd_pcm_hardware_t
id|snd_intel8x0_capture
op_assign
(brace
id|info
suffix:colon
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_RESUME
)paren
comma
id|formats
suffix:colon
id|SNDRV_PCM_FMTBIT_S16_LE
comma
id|rates
suffix:colon
l_int|0
comma
id|rate_min
suffix:colon
l_int|8000
comma
id|rate_max
suffix:colon
l_int|48000
comma
id|channels_min
suffix:colon
l_int|2
comma
id|channels_max
suffix:colon
l_int|2
comma
id|buffer_bytes_max
suffix:colon
l_int|128
op_star
l_int|1024
comma
id|period_bytes_min
suffix:colon
l_int|32
comma
id|period_bytes_max
suffix:colon
l_int|128
op_star
l_int|1024
comma
id|periods_min
suffix:colon
l_int|1
comma
id|periods_max
suffix:colon
l_int|1024
comma
id|fifo_size
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|channels4
r_static
r_int
r_int
id|channels4
(braket
)braket
op_assign
(brace
l_int|2
comma
l_int|4
comma
)brace
suffix:semicolon
DECL|macro|CHANNELS4
mdefine_line|#define CHANNELS4 sizeof(channels4) / sizeof(channels4[0])
DECL|variable|hw_constraints_channels4
r_static
id|snd_pcm_hw_constraint_list_t
id|hw_constraints_channels4
op_assign
(brace
id|count
suffix:colon
id|CHANNELS4
comma
id|list
suffix:colon
id|channels4
comma
id|mask
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|channels6
r_static
r_int
r_int
id|channels6
(braket
)braket
op_assign
(brace
l_int|2
comma
l_int|4
comma
l_int|6
comma
)brace
suffix:semicolon
DECL|macro|CHANNELS6
mdefine_line|#define CHANNELS6 sizeof(channels6) / sizeof(channels6[0])
DECL|variable|hw_constraints_channels6
r_static
id|snd_pcm_hw_constraint_list_t
id|hw_constraints_channels6
op_assign
(brace
id|count
suffix:colon
id|CHANNELS6
comma
id|list
suffix:colon
id|channels6
comma
id|mask
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
DECL|function|snd_intel8x0_playback_open
r_static
r_int
id|snd_intel8x0_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
id|chip-&gt;playback.substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_intel8x0_playback
suffix:semicolon
id|runtime-&gt;hw.rates
op_assign
id|chip-&gt;ac97-&gt;rates_front_dac
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|runtime-&gt;hw.rates
op_amp
id|SNDRV_PCM_RATE_8000
)paren
)paren
id|runtime-&gt;hw.rate_min
op_assign
l_int|48000
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;device_type
op_eq
id|DEVICE_SIS
)paren
(brace
id|runtime-&gt;hw.buffer_bytes_max
op_assign
l_int|64
op_star
l_int|1024
suffix:semicolon
id|runtime-&gt;hw.period_bytes_max
op_assign
l_int|64
op_star
l_int|1024
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_integer
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_PERIODS
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;multi6
)paren
(brace
id|runtime-&gt;hw.channels_max
op_assign
l_int|6
suffix:semicolon
id|snd_pcm_hw_constraint_list
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_CHANNELS
comma
op_amp
id|hw_constraints_channels6
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|chip-&gt;multi4
)paren
(brace
id|runtime-&gt;hw.channels_max
op_assign
l_int|4
suffix:semicolon
id|snd_pcm_hw_constraint_list
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_CHANNELS
comma
op_amp
id|hw_constraints_channels4
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_intel8x0_capture_open
r_static
r_int
id|snd_intel8x0_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
id|chip-&gt;capture.substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_intel8x0_capture
suffix:semicolon
id|runtime-&gt;hw.rates
op_assign
id|chip-&gt;ac97-&gt;rates_adc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|runtime-&gt;hw.rates
op_amp
id|SNDRV_PCM_RATE_8000
)paren
)paren
id|runtime-&gt;hw.rate_min
op_assign
l_int|48000
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;device_type
op_eq
id|DEVICE_SIS
)paren
(brace
id|runtime-&gt;hw.buffer_bytes_max
op_assign
l_int|64
op_star
l_int|1024
suffix:semicolon
id|runtime-&gt;hw.period_bytes_max
op_assign
l_int|64
op_star
l_int|1024
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_integer
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_PERIODS
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_intel8x0_playback_close
r_static
r_int
id|snd_intel8x0_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;playback.substream
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* disable DAC power */
id|snd_ac97_update_bits
c_func
(paren
id|chip-&gt;ac97
comma
id|AC97_POWERDOWN
comma
l_int|0x0200
comma
l_int|0x0200
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_intel8x0_capture_close
r_static
r_int
id|snd_intel8x0_capture_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;capture.substream
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* disable ADC power */
id|snd_ac97_update_bits
c_func
(paren
id|chip-&gt;ac97
comma
id|AC97_POWERDOWN
comma
l_int|0x0100
comma
l_int|0x0100
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_intel8x0_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_intel8x0_playback_ops
op_assign
(brace
id|open
suffix:colon
id|snd_intel8x0_playback_open
comma
id|close
suffix:colon
id|snd_intel8x0_playback_close
comma
id|ioctl
suffix:colon
id|snd_intel8x0_playback_ioctl
comma
id|hw_params
suffix:colon
id|snd_intel8x0_hw_params
comma
id|hw_free
suffix:colon
id|snd_intel8x0_hw_free
comma
id|prepare
suffix:colon
id|snd_intel8x0_playback_prepare
comma
id|trigger
suffix:colon
id|snd_intel8x0_playback_trigger
comma
id|pointer
suffix:colon
id|snd_intel8x0_playback_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_intel8x0_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_intel8x0_capture_ops
op_assign
(brace
id|open
suffix:colon
id|snd_intel8x0_capture_open
comma
id|close
suffix:colon
id|snd_intel8x0_capture_close
comma
id|ioctl
suffix:colon
id|snd_intel8x0_capture_ioctl
comma
id|hw_params
suffix:colon
id|snd_intel8x0_hw_params
comma
id|hw_free
suffix:colon
id|snd_intel8x0_hw_free
comma
id|prepare
suffix:colon
id|snd_intel8x0_capture_prepare
comma
id|trigger
suffix:colon
id|snd_intel8x0_capture_trigger
comma
id|pointer
suffix:colon
id|snd_intel8x0_capture_pointer
comma
)brace
suffix:semicolon
DECL|function|snd_intel8x0_pcm_free
r_static
r_void
id|snd_intel8x0_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|intel8x0_t
comma
id|pcm-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|chip-&gt;pcm
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_intel8x0_pcm
r_static
r_int
id|__devinit
id|snd_intel8x0_pcm
c_func
(paren
id|intel8x0_t
op_star
id|chip
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;Intel ICH&quot;
comma
id|device
comma
l_int|1
comma
l_int|1
comma
op_amp
id|pcm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_intel8x0_playback_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_intel8x0_capture_ops
)paren
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_intel8x0_pcm_free
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
id|chip-&gt;card-&gt;shortname
)paren
suffix:semicolon
id|chip-&gt;pcm
op_assign
id|pcm
suffix:semicolon
id|snd_pcm_lib_preallocate_pci_pages_for_all
c_func
(paren
id|chip-&gt;pci
comma
id|pcm
comma
l_int|64
op_star
l_int|1024
comma
l_int|128
op_star
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  PCM code - MIC&n; */
DECL|function|snd_intel8x0_capture_mic_ioctl
r_static
r_int
id|snd_intel8x0_capture_mic_ioctl
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_int
id|result
suffix:semicolon
id|result
op_assign
id|snd_pcm_lib_ioctl
c_func
(paren
id|substream
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
r_return
id|result
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_intel8x0_capture_mic_trigger
r_static
r_int
id|snd_intel8x0_capture_mic_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|snd_intel8x0_trigger
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;capture_mic
comma
id|cmd
)paren
suffix:semicolon
)brace
DECL|function|snd_intel8x0_capture_mic_prepare
r_static
r_int
id|snd_intel8x0_capture_mic_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|chip-&gt;capture_mic.physbuf
op_assign
id|runtime-&gt;dma_addr
suffix:semicolon
id|chip-&gt;capture_mic.size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;capture_mic.fragsize
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_ac97_set_rate
c_func
(paren
id|chip-&gt;ac97
comma
id|AC97_PCM_MIC_ADC_RATE
comma
id|runtime-&gt;rate
)paren
suffix:semicolon
id|snd_intel8x0_setup_periods
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;capture_mic
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_intel8x0_capture_mic_pointer
r_static
id|snd_pcm_uframes_t
id|snd_intel8x0_capture_mic_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
suffix:semicolon
id|ptr
op_assign
id|chip-&gt;capture_mic.fragsize1
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;device_type
op_eq
id|DEVICE_SIS
)paren
id|ptr
op_sub_assign
id|inw
c_func
(paren
id|ICHREG2
c_func
(paren
id|chip
comma
id|chip-&gt;reg_mc_picb
)paren
)paren
suffix:semicolon
r_else
id|ptr
op_sub_assign
id|inw
c_func
(paren
id|ICHREG2
c_func
(paren
id|chip
comma
id|chip-&gt;reg_mc_picb
)paren
)paren
op_lshift
l_int|1
suffix:semicolon
id|ptr
op_add_assign
id|chip-&gt;capture_mic.position
suffix:semicolon
r_return
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|ptr
)paren
suffix:semicolon
)brace
DECL|variable|snd_intel8x0_capture_mic
r_static
id|snd_pcm_hardware_t
id|snd_intel8x0_capture_mic
op_assign
(brace
id|info
suffix:colon
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_PAUSE
)paren
comma
id|formats
suffix:colon
id|SNDRV_PCM_FMTBIT_S16_LE
comma
id|rates
suffix:colon
l_int|0
comma
id|rate_min
suffix:colon
l_int|8000
comma
id|rate_max
suffix:colon
l_int|48000
comma
id|channels_min
suffix:colon
l_int|1
comma
id|channels_max
suffix:colon
l_int|1
comma
id|buffer_bytes_max
suffix:colon
l_int|128
op_star
l_int|1024
comma
id|period_bytes_min
suffix:colon
l_int|32
comma
id|period_bytes_max
suffix:colon
l_int|128
op_star
l_int|1024
comma
id|periods_min
suffix:colon
l_int|1
comma
id|periods_max
suffix:colon
l_int|1024
comma
id|fifo_size
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
DECL|function|snd_intel8x0_capture_mic_open
r_static
r_int
id|snd_intel8x0_capture_mic_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|chip-&gt;capture_mic.substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_intel8x0_capture_mic
suffix:semicolon
id|runtime-&gt;hw.rates
op_assign
id|chip-&gt;ac97-&gt;rates_mic_adc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|runtime-&gt;hw.rates
op_amp
id|SNDRV_PCM_RATE_8000
)paren
)paren
id|runtime-&gt;hw.rate_min
op_assign
l_int|48000
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;device_type
op_eq
id|DEVICE_SIS
)paren
(brace
id|runtime-&gt;hw.buffer_bytes_max
op_assign
l_int|64
op_star
l_int|1024
suffix:semicolon
id|runtime-&gt;hw.period_bytes_max
op_assign
l_int|64
op_star
l_int|1024
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_intel8x0_capture_mic_close
r_static
r_int
id|snd_intel8x0_capture_mic_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;capture_mic.substream
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* disable ADC power */
id|snd_ac97_update_bits
c_func
(paren
id|chip-&gt;ac97
comma
id|AC97_EXTENDED_STATUS
comma
l_int|0x4000
comma
l_int|0x4000
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_intel8x0_capture_mic_ops
r_static
id|snd_pcm_ops_t
id|snd_intel8x0_capture_mic_ops
op_assign
(brace
id|open
suffix:colon
id|snd_intel8x0_capture_mic_open
comma
id|close
suffix:colon
id|snd_intel8x0_capture_mic_close
comma
id|ioctl
suffix:colon
id|snd_intel8x0_capture_mic_ioctl
comma
id|hw_params
suffix:colon
id|snd_intel8x0_hw_params
comma
id|hw_free
suffix:colon
id|snd_intel8x0_hw_free
comma
id|prepare
suffix:colon
id|snd_intel8x0_capture_mic_prepare
comma
id|trigger
suffix:colon
id|snd_intel8x0_capture_mic_trigger
comma
id|pointer
suffix:colon
id|snd_intel8x0_capture_mic_pointer
comma
)brace
suffix:semicolon
DECL|function|snd_intel8x0_pcm_mic_free
r_static
r_void
id|snd_intel8x0_pcm_mic_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|intel8x0_t
comma
id|pcm-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|chip-&gt;pcm_mic
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|snd_intel8x0_pcm_mic
r_static
r_int
id|__devinit
id|snd_intel8x0_pcm_mic
c_func
(paren
id|intel8x0_t
op_star
id|chip
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;Intel ICH - MIC ADC&quot;
comma
id|device
comma
l_int|1
comma
l_int|1
comma
op_amp
id|pcm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_intel8x0_capture_mic_ops
)paren
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_intel8x0_pcm_mic_free
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|sprintf
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;%s - MIC ADC&quot;
comma
id|chip-&gt;card-&gt;shortname
)paren
suffix:semicolon
id|chip-&gt;pcm_mic
op_assign
id|pcm
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Mixer part&n; */
DECL|function|snd_intel8x0_codec_init
r_static
r_void
id|snd_intel8x0_codec_init
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
singleline_comment|// intel8x0_t *chip = snd_magic_cast(intel8x0_t, ac97-&gt;private_data, return);
multiline_comment|/* disable DAC &amp; ADC power */
id|snd_ac97_update_bits
c_func
(paren
id|ac97
comma
id|AC97_POWERDOWN
comma
l_int|0x0300
comma
l_int|0x0300
)paren
suffix:semicolon
multiline_comment|/* disable center DAC/surround DAC/LFE DAC/MIC ADC */
id|snd_ac97_update_bits
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_STATUS
comma
l_int|0xe800
comma
l_int|0xe800
)paren
suffix:semicolon
)brace
DECL|function|snd_intel8x0_mixer_free_ac97
r_static
r_void
id|snd_intel8x0_mixer_free_ac97
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|intel8x0_t
comma
id|ac97-&gt;private_data
comma
r_return
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;num
op_eq
l_int|0
)paren
(brace
id|chip-&gt;ac97
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|chip-&gt;ac97sec
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
DECL|function|snd_intel8x0_mixer
r_static
r_int
id|__devinit
id|snd_intel8x0_mixer
c_func
(paren
id|intel8x0_t
op_star
id|chip
comma
r_int
id|ac97_clock
)paren
(brace
id|ac97_t
id|ac97
suffix:semicolon
r_int
id|err
suffix:semicolon
id|chip-&gt;in_ac97_init
op_assign
l_int|1
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ac97
comma
l_int|0
comma
r_sizeof
(paren
id|ac97
)paren
)paren
suffix:semicolon
id|ac97.write
op_assign
id|snd_intel8x0_codec_write
suffix:semicolon
id|ac97.read
op_assign
id|snd_intel8x0_codec_read
suffix:semicolon
id|ac97.init
op_assign
id|snd_intel8x0_codec_init
suffix:semicolon
id|ac97.private_data
op_assign
id|chip
suffix:semicolon
id|ac97.private_free
op_assign
id|snd_intel8x0_mixer_free_ac97
suffix:semicolon
r_if
c_cond
(paren
id|ac97_clock
op_ge
l_int|8000
op_logical_and
id|ac97_clock
op_le
l_int|48000
)paren
id|ac97.clock
op_assign
id|ac97_clock
suffix:semicolon
r_else
id|ac97.clock
op_assign
l_int|48000
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_mixer
c_func
(paren
id|chip-&gt;card
comma
op_amp
id|ac97
comma
op_amp
id|chip-&gt;ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
macro_line|#if 0 /* it seems that SDIN signals are mixed together (at least for AD CNR boards) */
r_if
c_cond
(paren
id|inl
c_func
(paren
id|ICHREG
c_func
(paren
id|chip
comma
id|GLOB_STA
)paren
)paren
op_amp
id|ICH_SCR
)paren
(brace
id|ac97.num
op_assign
l_int|1
suffix:semicolon
id|ac97.addr
op_assign
l_int|1
suffix:semicolon
id|snd_ac97_mixer
c_func
(paren
id|chip-&gt;card
comma
op_amp
id|ac97
comma
op_amp
id|chip-&gt;ac97sec
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
(paren
id|inl
c_func
(paren
id|ICHREG
c_func
(paren
id|chip
comma
id|GLOB_STA
)paren
)paren
op_amp
(paren
id|ICH_PCM_4
op_or
id|ICH_PCM_6
)paren
)paren
op_ne
(paren
id|ICH_PCM_4
op_or
id|ICH_PCM_6
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chip-&gt;ac97-&gt;scaps
op_amp
id|AC97_SCAP_SURROUND_DAC
)paren
op_logical_or
(paren
id|chip-&gt;ac97sec
op_logical_and
(paren
id|chip-&gt;ac97sec-&gt;scaps
op_amp
id|AC97_SCAP_SURROUND_DAC
)paren
)paren
)paren
(brace
id|chip-&gt;multi4
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chip-&gt;ac97-&gt;scaps
op_amp
id|AC97_SCAP_CENTER_LFE_DAC
)paren
op_logical_or
(paren
id|chip-&gt;ac97sec
op_logical_and
(paren
id|chip-&gt;ac97sec-&gt;scaps
op_amp
id|AC97_SCAP_CENTER_LFE_DAC
)paren
)paren
)paren
id|chip-&gt;multi6
op_assign
l_int|1
suffix:semicolon
)brace
id|chip-&gt;in_ac97_init
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *&n; */
DECL|function|snd_intel8x0_chip_init
r_static
r_int
id|snd_intel8x0_chip_init
c_func
(paren
id|intel8x0_t
op_star
id|chip
)paren
(brace
r_int
r_int
id|end_time
suffix:semicolon
r_int
r_int
id|cnt
suffix:semicolon
multiline_comment|/* put logic to right state */
multiline_comment|/* first clear status bits */
id|cnt
op_assign
id|inl
c_func
(paren
id|ICHREG
c_func
(paren
id|chip
comma
id|GLOB_STA
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|cnt
op_amp
(paren
id|ICH_RCS
op_or
id|ICH_MCINT
op_or
id|ICH_POINT
op_or
id|ICH_PIINT
)paren
comma
id|ICHREG
c_func
(paren
id|chip
comma
id|GLOB_STA
)paren
)paren
suffix:semicolon
multiline_comment|/* ACLink on, 2 channels */
id|cnt
op_assign
id|inl
c_func
(paren
id|ICHREG
c_func
(paren
id|chip
comma
id|GLOB_CNT
)paren
)paren
suffix:semicolon
id|cnt
op_and_assign
op_complement
(paren
id|ICH_ACLINK
op_or
id|ICH_PCM_246_MASK
)paren
suffix:semicolon
multiline_comment|/* finish cold or do warm reset */
id|cnt
op_or_assign
(paren
id|cnt
op_amp
id|ICH_AC97COLD
)paren
op_eq
l_int|0
ques
c_cond
id|ICH_AC97COLD
suffix:colon
id|ICH_AC97WARM
suffix:semicolon
id|outl
c_func
(paren
id|cnt
comma
id|ICHREG
c_func
(paren
id|chip
comma
id|GLOB_CNT
)paren
)paren
suffix:semicolon
id|end_time
op_assign
(paren
id|jiffies
op_plus
(paren
id|HZ
op_div
l_int|4
)paren
)paren
op_plus
l_int|1
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|inl
c_func
(paren
id|ICHREG
c_func
(paren
id|chip
comma
id|GLOB_CNT
)paren
)paren
op_amp
id|ICH_AC97WARM
)paren
op_eq
l_int|0
)paren
r_goto
id|__ok
suffix:semicolon
macro_line|#ifdef CONFIG_PM
r_if
c_cond
(paren
id|chip-&gt;in_suspend
)paren
(brace
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
macro_line|#endif
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|end_time
op_minus
(paren
r_int
r_int
)paren
id|jiffies
op_ge
l_int|0
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;AC&squot;97 warm reset still in progress? [0x%x]&bslash;n&quot;
comma
id|inl
c_func
(paren
id|ICHREG
c_func
(paren
id|chip
comma
id|GLOB_CNT
)paren
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
id|__ok
suffix:colon
multiline_comment|/* wait for primary codec ready status.&n;&t; * Once it becomes ready it should remain ready&n;&t; * as long as we do not disable the ac97 link.&n; &t; */
id|end_time
op_assign
id|jiffies
op_plus
id|HZ
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|inl
c_func
(paren
id|ICHREG
c_func
(paren
id|chip
comma
id|GLOB_STA
)paren
)paren
op_amp
id|ICH_PCR
)paren
r_goto
id|__ok1
suffix:semicolon
macro_line|#ifdef CONFIG_PM
r_if
c_cond
(paren
id|chip-&gt;in_suspend
)paren
(brace
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
macro_line|#endif
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|end_time
op_minus
(paren
r_int
r_int
)paren
id|jiffies
op_ge
l_int|0
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;codec_ready: primary codec is not ready [0x%x]&bslash;n&quot;
comma
id|inl
c_func
(paren
id|ICHREG
c_func
(paren
id|chip
comma
id|GLOB_STA
)paren
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
id|__ok1
suffix:colon
multiline_comment|/* wait for secondary codec ready status. No secondary codec? , ok */
multiline_comment|/* the end_time variable is not initialized again */
r_do
(brace
r_if
c_cond
(paren
id|inl
c_func
(paren
id|ICHREG
c_func
(paren
id|chip
comma
id|GLOB_STA
)paren
)paren
op_amp
id|ICH_SCR
)paren
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_PM
r_if
c_cond
(paren
id|chip-&gt;in_suspend
)paren
(brace
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
macro_line|#endif
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|end_time
op_minus
(paren
r_int
r_int
)paren
id|jiffies
op_ge
l_int|0
)paren
suffix:semicolon
id|inw
c_func
(paren
id|chip-&gt;port
)paren
suffix:semicolon
multiline_comment|/* clear semaphore flag */
multiline_comment|/* disable interrupts */
id|outb
c_func
(paren
l_int|0x00
comma
id|ICHREG
c_func
(paren
id|chip
comma
id|PI_CR
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|ICHREG
c_func
(paren
id|chip
comma
id|PO_CR
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|ICHREG
c_func
(paren
id|chip
comma
id|MC_CR
)paren
)paren
suffix:semicolon
multiline_comment|/* reset channels */
id|outb
c_func
(paren
id|ICH_RESETREGS
comma
id|ICHREG
c_func
(paren
id|chip
comma
id|PI_CR
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|ICH_RESETREGS
comma
id|ICHREG
c_func
(paren
id|chip
comma
id|PO_CR
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|ICH_RESETREGS
comma
id|ICHREG
c_func
(paren
id|chip
comma
id|MC_CR
)paren
)paren
suffix:semicolon
multiline_comment|/* initialize Buffer Descriptor Lists */
id|outl
c_func
(paren
id|chip-&gt;playback.bdbar_addr
comma
id|ICHREG
c_func
(paren
id|chip
comma
id|PO_BDBAR
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|chip-&gt;capture.bdbar_addr
comma
id|ICHREG
c_func
(paren
id|chip
comma
id|PI_BDBAR
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|chip-&gt;capture_mic.bdbar_addr
comma
id|ICHREG
c_func
(paren
id|chip
comma
id|MC_BDBAR
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_intel8x0_free
r_static
r_int
id|snd_intel8x0_free
c_func
(paren
id|intel8x0_t
op_star
id|chip
)paren
(brace
r_if
c_cond
(paren
id|chip-&gt;irq
OL
l_int|0
)paren
r_goto
id|__hw_end
suffix:semicolon
multiline_comment|/* disable interrupts */
id|outb
c_func
(paren
l_int|0x00
comma
id|ICHREG
c_func
(paren
id|chip
comma
id|PI_CR
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|ICHREG
c_func
(paren
id|chip
comma
id|PO_CR
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|ICHREG
c_func
(paren
id|chip
comma
id|MC_CR
)paren
)paren
suffix:semicolon
multiline_comment|/* reset channels */
id|outb
c_func
(paren
id|ICH_RESETREGS
comma
id|ICHREG
c_func
(paren
id|chip
comma
id|PI_CR
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|ICH_RESETREGS
comma
id|ICHREG
c_func
(paren
id|chip
comma
id|PO_CR
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|ICH_RESETREGS
comma
id|ICHREG
c_func
(paren
id|chip
comma
id|MC_CR
)paren
)paren
suffix:semicolon
multiline_comment|/* --- */
id|synchronize_irq
c_func
(paren
)paren
suffix:semicolon
id|__hw_end
suffix:colon
r_if
c_cond
(paren
id|chip-&gt;bdbars
)paren
id|snd_free_pci_pages
c_func
(paren
id|chip-&gt;pci
comma
l_int|3
op_star
r_sizeof
(paren
id|u32
)paren
op_star
id|ICH_MAX_FRAGS
op_star
l_int|2
comma
id|chip-&gt;bdbars
comma
id|chip-&gt;bdbars_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;res_port
)paren
(brace
id|release_resource
c_func
(paren
id|chip-&gt;res_port
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|chip-&gt;res_port
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chip-&gt;res_bmport
)paren
(brace
id|release_resource
c_func
(paren
id|chip-&gt;res_bmport
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|chip-&gt;res_bmport
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chip-&gt;irq
op_ge
l_int|0
)paren
id|free_irq
c_func
(paren
id|chip-&gt;irq
comma
(paren
r_void
op_star
)paren
id|chip
)paren
suffix:semicolon
id|snd_magic_kfree
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PM
multiline_comment|/*&n; * power management&n; */
DECL|function|intel8x0_suspend
r_static
r_void
id|intel8x0_suspend
c_func
(paren
id|intel8x0_t
op_star
id|chip
)paren
(brace
id|snd_card_t
op_star
id|card
op_assign
id|chip-&gt;card
suffix:semicolon
id|chip-&gt;in_suspend
op_assign
l_int|1
suffix:semicolon
id|snd_power_lock
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;power_state
op_eq
id|SNDRV_CTL_POWER_D3hot
)paren
r_goto
id|__skip
suffix:semicolon
id|snd_pcm_suspend_all
c_func
(paren
id|chip-&gt;pcm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;pcm_mic
)paren
id|snd_pcm_suspend_all
c_func
(paren
id|chip-&gt;pcm_mic
)paren
suffix:semicolon
id|snd_power_change_state
c_func
(paren
id|card
comma
id|SNDRV_CTL_POWER_D3hot
)paren
suffix:semicolon
id|__skip
suffix:colon
id|snd_power_unlock
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
DECL|function|intel8x0_resume
r_static
r_void
id|intel8x0_resume
c_func
(paren
id|intel8x0_t
op_star
id|chip
)paren
(brace
id|snd_card_t
op_star
id|card
op_assign
id|chip-&gt;card
suffix:semicolon
id|snd_power_lock
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;power_state
op_eq
id|SNDRV_CTL_POWER_D0
)paren
r_goto
id|__skip
suffix:semicolon
id|pci_enable_device
c_func
(paren
id|chip-&gt;pci
)paren
suffix:semicolon
id|snd_intel8x0_chip_init
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_ac97_resume
c_func
(paren
id|chip-&gt;ac97
)paren
suffix:semicolon
id|chip-&gt;in_suspend
op_assign
l_int|0
suffix:semicolon
id|snd_power_change_state
c_func
(paren
id|card
comma
id|SNDRV_CTL_POWER_D0
)paren
suffix:semicolon
id|__skip
suffix:colon
id|snd_power_unlock
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
macro_line|#ifndef PCI_OLD_SUSPEND
DECL|function|snd_intel8x0_suspend
r_static
r_int
id|snd_intel8x0_suspend
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
id|u32
id|state
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|intel8x0_t
comma
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|intel8x0_suspend
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_intel8x0_resume
r_static
r_int
id|snd_intel8x0_resume
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|intel8x0_t
comma
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|intel8x0_resume
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#else
DECL|function|snd_intel8x0_suspend
r_static
r_void
id|snd_intel8x0_suspend
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|intel8x0_t
comma
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
comma
r_return
)paren
suffix:semicolon
id|intel8x0_suspend
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
DECL|function|snd_intel8x0_resume
r_static
r_void
id|snd_intel8x0_resume
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|intel8x0_t
comma
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
comma
r_return
)paren
suffix:semicolon
id|intel8x0_resume
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* callback */
DECL|function|snd_intel8x0_set_power_state
r_static
r_int
id|snd_intel8x0_set_power_state
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_int
r_int
id|power_state
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|intel8x0_t
comma
id|card-&gt;power_state_private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|power_state
)paren
(brace
r_case
id|SNDRV_CTL_POWER_D0
suffix:colon
r_case
id|SNDRV_CTL_POWER_D1
suffix:colon
r_case
id|SNDRV_CTL_POWER_D2
suffix:colon
id|intel8x0_resume
c_func
(paren
id|chip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_CTL_POWER_D3hot
suffix:colon
r_case
id|SNDRV_CTL_POWER_D3cold
suffix:colon
id|intel8x0_suspend
c_func
(paren
id|chip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PM */
DECL|macro|INTEL8X0_TESTBUF_SIZE
mdefine_line|#define INTEL8X0_TESTBUF_SIZE&t;32768&t;/* enough large for one shot */
DECL|function|intel8x0_measure_ac97_clock
r_static
r_void
id|__devinit
id|intel8x0_measure_ac97_clock
c_func
(paren
id|intel8x0_t
op_star
id|chip
)paren
(brace
id|snd_pcm_substream_t
op_star
id|subs
suffix:semicolon
r_int
r_int
id|port
suffix:semicolon
r_int
r_int
id|pos
comma
id|t
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|timeval
id|start_time
comma
id|stop_time
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;ac97-&gt;clock
op_ne
l_int|48000
)paren
r_return
suffix:semicolon
multiline_comment|/* specified in module option */
id|subs
op_assign
id|chip-&gt;pcm-&gt;streams
(braket
l_int|0
)braket
dot
id|substream
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|subs
op_logical_or
id|subs-&gt;dma_bytes
OL
id|INTEL8X0_TESTBUF_SIZE
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;no playback buffer allocated - aborting measure ac97 clock&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|chip-&gt;playback.physbuf
op_assign
id|subs-&gt;dma_addr
suffix:semicolon
id|chip-&gt;playback.size
op_assign
id|chip-&gt;playback.fragsize
op_assign
id|INTEL8X0_TESTBUF_SIZE
suffix:semicolon
id|chip-&gt;playback.substream
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* don&squot;t process interrupts */
multiline_comment|/* set rate */
id|snd_ac97_set_rate
c_func
(paren
id|chip-&gt;ac97
comma
id|AC97_PCM_FRONT_DAC_RATE
comma
l_int|48000
)paren
suffix:semicolon
id|snd_intel8x0_setup_periods
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;playback
)paren
suffix:semicolon
id|port
op_assign
id|chip-&gt;bmport
op_plus
id|chip-&gt;playback.reg_offset
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|outb
c_func
(paren
id|ICH_IOCE
op_or
id|ICH_STARTBM
comma
id|port
op_plus
id|ICH_REG_PI_CR
)paren
suffix:semicolon
multiline_comment|/* trigger */
id|do_gettimeofday
c_func
(paren
op_amp
id|start_time
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
macro_line|#if 0
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
op_div
l_int|20
)paren
suffix:semicolon
macro_line|#else
multiline_comment|/* FIXME: schedule() can take too long time and overlap the boundary.. */
id|mdelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
macro_line|#endif
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* check the position */
id|pos
op_assign
id|chip-&gt;playback.fragsize1
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;device_type
op_eq
id|DEVICE_SIS
)paren
id|pos
op_sub_assign
id|inw
c_func
(paren
id|ICHREG2
c_func
(paren
id|chip
comma
id|chip-&gt;reg_po_picb
)paren
)paren
suffix:semicolon
r_else
id|pos
op_sub_assign
id|inw
c_func
(paren
id|ICHREG2
c_func
(paren
id|chip
comma
id|chip-&gt;reg_po_picb
)paren
)paren
op_lshift
l_int|1
suffix:semicolon
id|pos
op_add_assign
id|chip-&gt;playback.position
suffix:semicolon
id|do_gettimeofday
c_func
(paren
op_amp
id|stop_time
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0
comma
id|port
op_plus
id|ICH_REG_PI_CR
)paren
suffix:semicolon
multiline_comment|/* stop */
multiline_comment|/* reset whole DMA things */
r_while
c_loop
(paren
op_logical_neg
(paren
id|inb
c_func
(paren
id|port
op_plus
id|chip-&gt;reg_pi_sr
)paren
op_amp
id|ICH_DCH
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|ICH_RESETREGS
comma
id|port
op_plus
id|ICH_REG_PI_CR
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|t
op_assign
id|stop_time.tv_sec
op_minus
id|start_time.tv_sec
suffix:semicolon
id|t
op_mul_assign
l_int|1000000
suffix:semicolon
r_if
c_cond
(paren
id|stop_time.tv_usec
OL
id|start_time.tv_usec
)paren
id|t
op_sub_assign
id|start_time.tv_usec
op_minus
id|stop_time.tv_usec
suffix:semicolon
r_else
id|t
op_add_assign
id|stop_time.tv_usec
op_minus
id|start_time.tv_usec
suffix:semicolon
r_if
c_cond
(paren
id|t
op_eq
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;?? calculation error..&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|pos
op_assign
(paren
id|pos
op_div
l_int|4
)paren
op_star
l_int|1000
suffix:semicolon
id|pos
op_assign
(paren
id|pos
op_div
id|t
)paren
op_star
l_int|1000
op_plus
(paren
(paren
id|pos
op_mod
id|t
)paren
op_star
l_int|1000
)paren
op_div
id|t
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
l_int|40000
op_logical_or
id|pos
op_ge
l_int|60000
)paren
multiline_comment|/* abnormal value. hw problem? */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;intel8x0: measured clock %ld rejected&bslash;n&quot;
comma
id|pos
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|pos
template_param
l_int|48500
)paren
multiline_comment|/* not 48000Hz, tuning the clock.. */
id|chip-&gt;ac97-&gt;clock
op_assign
(paren
id|chip-&gt;ac97-&gt;clock
op_star
l_int|48000
)paren
op_div
id|pos
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;intel8x0: clocking to %d&bslash;n&quot;
comma
id|chip-&gt;ac97-&gt;clock
)paren
suffix:semicolon
)brace
DECL|function|snd_intel8x0_dev_free
r_static
r_int
id|snd_intel8x0_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|intel8x0_t
comma
id|device-&gt;device_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_return
id|snd_intel8x0_free
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
DECL|function|snd_intel8x0_create
r_static
r_int
id|__devinit
id|snd_intel8x0_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_struct
id|pci_dev
op_star
id|pci
comma
r_int
r_int
id|device_type
comma
id|intel8x0_t
op_star
op_star
id|r_intel8x0
)paren
(brace
id|intel8x0_t
op_star
id|chip
suffix:semicolon
r_int
id|err
suffix:semicolon
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
id|dev_free
suffix:colon
id|snd_intel8x0_dev_free
comma
)brace
suffix:semicolon
op_star
id|r_intel8x0
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pci
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|chip
op_assign
id|snd_magic_kcalloc
c_func
(paren
id|intel8x0_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|chip-&gt;ac97_lock
)paren
suffix:semicolon
id|chip-&gt;device_type
op_assign
id|device_type
suffix:semicolon
id|chip-&gt;card
op_assign
id|card
suffix:semicolon
id|chip-&gt;pci
op_assign
id|pci
suffix:semicolon
id|chip-&gt;irq
op_assign
op_minus
l_int|1
suffix:semicolon
id|chip-&gt;port
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|chip-&gt;ac97_name
comma
l_string|&quot;%s - AC&squot;97&quot;
comma
id|card-&gt;shortname
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chip-&gt;res_port
op_assign
id|request_region
c_func
(paren
id|chip-&gt;port
comma
l_int|256
comma
id|chip-&gt;ac97_name
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_intel8x0_free
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab ports 0x%lx-0x%lx&bslash;n&quot;
comma
id|chip-&gt;port
comma
id|chip-&gt;port
op_plus
l_int|256
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|chip-&gt;ctrl_name
comma
l_string|&quot;%s - Controller&quot;
comma
id|card-&gt;shortname
)paren
suffix:semicolon
id|chip-&gt;bmport
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chip-&gt;res_bmport
op_assign
id|request_region
c_func
(paren
id|chip-&gt;bmport
comma
l_int|64
comma
id|chip-&gt;ctrl_name
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_intel8x0_free
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab ports 0x%lx-0x%lx&bslash;n&quot;
comma
id|chip-&gt;bmport
comma
id|chip-&gt;bmport
op_plus
l_int|64
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|pci-&gt;irq
comma
id|snd_intel8x0_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
id|card-&gt;shortname
comma
(paren
r_void
op_star
)paren
id|chip
)paren
)paren
(brace
id|snd_intel8x0_free
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab IRQ %d&bslash;n&quot;
comma
id|pci-&gt;irq
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|chip-&gt;irq
op_assign
id|pci-&gt;irq
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pci
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* initialize offsets */
id|chip-&gt;reg_pi_sr
op_assign
id|ICH_REG_PI_SR
suffix:semicolon
id|chip-&gt;reg_pi_picb
op_assign
id|ICH_REG_PI_PICB
suffix:semicolon
id|chip-&gt;reg_po_sr
op_assign
id|ICH_REG_PO_SR
suffix:semicolon
id|chip-&gt;reg_po_picb
op_assign
id|ICH_REG_PO_PICB
suffix:semicolon
id|chip-&gt;reg_mc_sr
op_assign
id|ICH_REG_MC_SR
suffix:semicolon
id|chip-&gt;reg_mc_picb
op_assign
id|ICH_REG_MC_PICB
suffix:semicolon
r_if
c_cond
(paren
id|device_type
op_eq
id|DEVICE_SIS
)paren
(brace
id|chip-&gt;reg_pi_sr
op_assign
id|ICH_REG_PI_PICB
suffix:semicolon
id|chip-&gt;reg_pi_picb
op_assign
id|ICH_REG_PI_SR
suffix:semicolon
id|chip-&gt;reg_po_sr
op_assign
id|ICH_REG_PO_PICB
suffix:semicolon
id|chip-&gt;reg_po_picb
op_assign
id|ICH_REG_PO_SR
suffix:semicolon
id|chip-&gt;reg_mc_sr
op_assign
id|ICH_REG_MC_PICB
suffix:semicolon
id|chip-&gt;reg_mc_picb
op_assign
id|ICH_REG_MC_SR
suffix:semicolon
)brace
id|chip-&gt;playback.reg_offset
op_assign
l_int|0x10
suffix:semicolon
id|chip-&gt;capture.reg_offset
op_assign
l_int|0
suffix:semicolon
id|chip-&gt;capture_mic.reg_offset
op_assign
l_int|0x20
suffix:semicolon
multiline_comment|/* allocate buffer descriptor lists */
multiline_comment|/* the start of each lists must be aligned to 8 bytes */
id|chip-&gt;bdbars
op_assign
(paren
id|u32
op_star
)paren
id|snd_malloc_pci_pages
c_func
(paren
id|pci
comma
l_int|3
op_star
r_sizeof
(paren
r_int
r_int
)paren
op_star
id|ICH_MAX_FRAGS
op_star
l_int|2
comma
op_amp
id|chip-&gt;bdbars_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;bdbars
op_eq
l_int|NULL
)paren
(brace
id|snd_intel8x0_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* tables must be aligned to 8 bytes here, but the kernel pages&n;&t;   are much bigger, so we don&squot;t care (on i386) */
macro_line|#ifndef __i386__
multiline_comment|/* .. not sure on other architectures, so we check now. */
r_if
c_cond
(paren
id|chip-&gt;bdbars_addr
op_amp
op_complement
(paren
(paren
id|dma_addr_t
)paren
l_int|0xffffffff
op_or
l_int|0x07
)paren
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;invalid i/o port address %lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|chip-&gt;bdbars_addr
)paren
suffix:semicolon
id|snd_intel8x0_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
macro_line|#endif
id|chip-&gt;playback.bdbar
op_assign
id|chip-&gt;bdbars
suffix:semicolon
multiline_comment|/* crop to 32bit */
id|chip-&gt;playback.bdbar_addr
op_assign
(paren
r_int
r_int
)paren
id|chip-&gt;bdbars_addr
suffix:semicolon
id|chip-&gt;capture.bdbar
op_assign
id|chip-&gt;playback.bdbar
op_plus
id|ICH_MAX_FRAGS
op_star
l_int|2
suffix:semicolon
id|chip-&gt;capture.bdbar_addr
op_assign
id|chip-&gt;playback.bdbar_addr
op_plus
r_sizeof
(paren
id|u32
)paren
op_star
id|ICH_MAX_FRAGS
op_star
l_int|2
suffix:semicolon
id|chip-&gt;capture_mic.bdbar
op_assign
id|chip-&gt;capture.bdbar
op_plus
id|ICH_MAX_FRAGS
op_star
l_int|2
suffix:semicolon
id|chip-&gt;capture_mic.bdbar_addr
op_assign
id|chip-&gt;capture.bdbar_addr
op_plus
r_sizeof
(paren
id|u32
)paren
op_star
id|ICH_MAX_FRAGS
op_star
l_int|2
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_intel8x0_chip_init
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_intel8x0_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PM
id|card-&gt;set_power_state
op_assign
id|snd_intel8x0_set_power_state
suffix:semicolon
id|card-&gt;power_state_private_data
op_assign
id|chip
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|chip
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_intel8x0_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
op_star
id|r_intel8x0
op_assign
id|chip
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|struct|shortname_table
r_static
r_struct
id|shortname_table
(brace
DECL|member|id
r_int
r_int
id|id
suffix:semicolon
DECL|member|s
r_const
r_char
op_star
id|s
suffix:semicolon
DECL|variable|__devinitdata
)brace
id|shortnames
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
id|PCI_DEVICE_ID_INTEL_82801
comma
l_string|&quot;Intel ICH 82801AA&quot;
)brace
comma
(brace
id|PCI_DEVICE_ID_INTEL_82901
comma
l_string|&quot;Intel ICH 82901AB&quot;
)brace
comma
(brace
id|PCI_DEVICE_ID_INTEL_440MX
comma
l_string|&quot;Intel 440MX&quot;
)brace
comma
(brace
id|PCI_DEVICE_ID_INTEL_ICH3
comma
l_string|&quot;Intel ICH3&quot;
)brace
comma
(brace
id|PCI_DEVICE_ID_INTEL_ICH4
comma
l_string|&quot;Intel ICH4&quot;
)brace
comma
(brace
id|PCI_DEVICE_ID_SI_7012
comma
l_string|&quot;SiS SI7012&quot;
)brace
comma
(brace
id|PCI_DEVICE_ID_NVIDIA_MCP_AUDIO
comma
l_string|&quot;NVidia NForce&quot;
)brace
comma
(brace
l_int|0x764d
comma
l_string|&quot;AMD AMD8111&quot;
)brace
comma
(brace
l_int|0x7445
comma
l_string|&quot;AMD AMD768&quot;
)brace
comma
(brace
l_int|0
comma
l_int|0
)brace
comma
)brace
suffix:semicolon
DECL|function|snd_intel8x0_probe
r_static
r_int
id|__devinit
id|snd_intel8x0_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
r_static
r_int
id|dev
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
id|intel8x0_t
op_star
id|chip
suffix:semicolon
r_int
id|pcm_dev
op_assign
l_int|0
comma
id|err
suffix:semicolon
r_struct
id|shortname_table
op_star
id|name
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_ge
id|SNDRV_CARDS
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_enable
(braket
id|dev
)braket
)paren
(brace
id|dev
op_increment
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|card
op_assign
id|snd_card_new
c_func
(paren
id|snd_index
(braket
id|dev
)braket
comma
id|snd_id
(braket
id|dev
)braket
comma
id|THIS_MODULE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;ICH&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;shortname
comma
l_string|&quot;Intel ICH&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|name
op_assign
id|shortnames
suffix:semicolon
id|name-&gt;id
suffix:semicolon
id|name
op_increment
)paren
(brace
r_if
c_cond
(paren
id|pci-&gt;device
op_eq
id|name-&gt;id
)paren
(brace
id|strcpy
c_func
(paren
id|card-&gt;shortname
comma
id|name-&gt;s
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_intel8x0_create
c_func
(paren
id|card
comma
id|pci
comma
id|id-&gt;driver_data
comma
op_amp
id|chip
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_intel8x0_mixer
c_func
(paren
id|chip
comma
id|snd_ac97_clock
(braket
id|dev
)braket
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_intel8x0_pcm
c_func
(paren
id|chip
comma
id|pcm_dev
op_increment
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chip-&gt;ac97-&gt;ext_id
op_amp
l_int|0x0008
)paren
(brace
multiline_comment|/* MIC VRM */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_intel8x0_pcm_mic
c_func
(paren
id|chip
comma
id|pcm_dev
op_increment
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|snd_mpu_port
(braket
id|dev
)braket
op_eq
l_int|0x300
op_logical_or
id|snd_mpu_port
(braket
id|dev
)braket
op_eq
l_int|0x330
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_mpu401_uart_new
c_func
(paren
id|card
comma
l_int|0
comma
id|MPU401_HW_CMIPCI
comma
id|snd_mpu_port
(braket
id|dev
)braket
comma
l_int|0
comma
op_minus
l_int|1
comma
l_int|0
comma
op_amp
id|chip-&gt;rmidi
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;intel8x0: no UART401 device at 0x%x, skipping.&bslash;n&quot;
comma
id|snd_mpu_port
(braket
id|dev
)braket
)paren
suffix:semicolon
id|snd_mpu_port
(braket
id|dev
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_else
id|snd_mpu_port
(braket
id|dev
)braket
op_assign
l_int|0
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;%s at 0x%lx, irq %i&quot;
comma
id|card-&gt;shortname
comma
id|chip-&gt;port
comma
id|chip-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_ac97_clock
(braket
id|dev
)braket
)paren
id|intel8x0_measure_ac97_clock
c_func
(paren
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_card_register
c_func
(paren
id|card
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pci
comma
id|chip
)paren
suffix:semicolon
id|dev
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_intel8x0_remove
r_static
r_void
id|__devexit
id|snd_intel8x0_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
id|intel8x0_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|intel8x0_t
comma
id|pci_get_drvdata
c_func
(paren
id|pci
)paren
comma
r_return
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip
)paren
id|snd_card_free
c_func
(paren
id|chip-&gt;card
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|driver
r_static
r_struct
id|pci_driver
id|driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;Intel ICH&quot;
comma
id|id_table
suffix:colon
id|snd_intel8x0_ids
comma
id|probe
suffix:colon
id|snd_intel8x0_probe
comma
id|remove
suffix:colon
id|__devexit_p
c_func
(paren
id|snd_intel8x0_remove
)paren
comma
macro_line|#ifdef CONFIG_PM
id|suspend
suffix:colon
id|snd_intel8x0_suspend
comma
id|resume
suffix:colon
id|snd_intel8x0_resume
comma
macro_line|#endif
)brace
suffix:semicolon
macro_line|#if defined(SUPPORT_JOYSTICK) || defined(SUPPORT_MIDI)
multiline_comment|/*&n; * initialize joystick/midi addresses&n; */
DECL|function|snd_intel8x0_joystick_probe
r_static
r_int
id|__devinit
id|snd_intel8x0_joystick_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
r_static
r_int
id|dev
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_ge
id|SNDRV_CARDS
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_enable
(braket
id|dev
)braket
)paren
(brace
id|dev
op_increment
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|snd_joystick_port
(braket
id|dev
)braket
OG
l_int|0
op_logical_or
id|snd_mpu_port
(braket
id|dev
)braket
OG
l_int|0
)paren
(brace
id|u16
id|val
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pci
comma
l_int|0xe6
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_joystick_port
(braket
id|dev
)braket
OG
l_int|0
)paren
id|val
op_or_assign
l_int|0x100
suffix:semicolon
r_if
c_cond
(paren
id|snd_mpu_port
(braket
id|dev
)braket
op_eq
l_int|0x300
op_logical_or
id|snd_mpu_port
(braket
id|dev
)braket
op_eq
l_int|0x330
)paren
id|val
op_or_assign
l_int|0x20
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|pci
comma
l_int|0xe6
comma
id|val
op_or
l_int|0x100
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_mpu_port
(braket
id|dev
)braket
op_eq
l_int|0x300
op_logical_or
id|snd_mpu_port
(braket
id|dev
)braket
op_eq
l_int|0x330
)paren
(brace
id|u8
id|b
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pci
comma
l_int|0xe2
comma
op_amp
id|b
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_mpu_port
(braket
id|dev
)braket
op_eq
l_int|0x300
)paren
id|b
op_or_assign
l_int|0x08
suffix:semicolon
r_else
id|b
op_and_assign
op_complement
l_int|0x08
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pci
comma
l_int|0xe2
comma
id|b
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|snd_intel8x0_joystick_ids
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
l_int|0x8086
comma
l_int|0x2410
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* 82801AA */
(brace
l_int|0x8086
comma
l_int|0x2420
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* 82901AB */
(brace
l_int|0x8086
comma
l_int|0x2440
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* ICH2 */
(brace
l_int|0x8086
comma
l_int|0x244c
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* ICH2M */
(brace
l_int|0x8086
comma
l_int|0x248c
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* ICH3 */
singleline_comment|// { 0x8086, 0x7195, PCI_ANY_ID, PCI_ANY_ID, 0, 0, 0 },&t;/* 440MX */
singleline_comment|// { 0x1039, 0x7012, PCI_ANY_ID, PCI_ANY_ID, 0, 0, 0 },&t;/* SI7012 */
(brace
l_int|0x10de
comma
l_int|0x01b2
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* NFORCE */
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
DECL|variable|joystick_driver
r_static
r_struct
id|pci_driver
id|joystick_driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;Intel ICH Joystick&quot;
comma
id|id_table
suffix:colon
id|snd_intel8x0_joystick_ids
comma
id|probe
suffix:colon
id|snd_intel8x0_joystick_probe
comma
)brace
suffix:semicolon
macro_line|#endif
DECL|function|alsa_card_intel8x0_init
r_static
r_int
id|__init
id|alsa_card_intel8x0_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_module_init
c_func
(paren
op_amp
id|driver
)paren
)paren
OL
l_int|0
)paren
(brace
macro_line|#ifdef MODULE
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Intel ICH soundcard not found or device busy&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
id|err
suffix:semicolon
)brace
macro_line|#if defined(SUPPORT_JOYSTICK) || defined(SUPPORT_MIDI)
id|pci_module_init
c_func
(paren
op_amp
id|joystick_driver
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|alsa_card_intel8x0_exit
r_static
r_void
id|__exit
id|alsa_card_intel8x0_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
macro_line|#if defined(SUPPORT_JOYSTICK) || defined(SUPPORT_MIDI)
id|pci_unregister_driver
c_func
(paren
op_amp
id|joystick_driver
)paren
suffix:semicolon
macro_line|#endif
)brace
id|module_init
c_func
(paren
id|alsa_card_intel8x0_init
)paren
id|module_exit
c_func
(paren
id|alsa_card_intel8x0_exit
)paren
macro_line|#ifndef MODULE
multiline_comment|/* format is: snd-intel8x0=snd_enable,snd_index,snd_id,snd_ac97_clock */
DECL|function|alsa_card_intel8x0_setup
r_static
r_int
id|__init
id|alsa_card_intel8x0_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_static
r_int
id|__initdata
id|nr_dev
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|nr_dev
op_ge
id|SNDRV_CARDS
)paren
r_return
l_int|0
suffix:semicolon
(paren
r_void
)paren
(paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_enable
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_index
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_id
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_id
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_ac97_clock
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
)paren
suffix:semicolon
id|nr_dev
op_increment
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;snd-intel8x0=&quot;
comma
id|alsa_card_intel8x0_setup
)paren
suffix:semicolon
macro_line|#endif /* ifndef MODULE */
eof
