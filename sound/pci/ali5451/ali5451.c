multiline_comment|/*&n; *  Matt Wu &lt;Matt_Wu@acersoftech.com.cn&gt;&n; *  Apr 26, 2001&n; *  Routines for control of ALi pci audio M5451&n; *&n; *  BUGS:&n; *    --&n; *&n; *  TODO:&n; *    --&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public Lcodecnse as published by&n; *   the Free Software Foundation; either version 2 of the Lcodecnse, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public Lcodecnse for more details.&n; *&n; *   You should have received a copy of the GNU General Public Lcodecnse&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
DECL|macro|__SNDRV_OSS_COMPAT__
mdefine_line|#define __SNDRV_OSS_COMPAT__
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#include &lt;sound/ac97_codec.h&gt;
macro_line|#include &lt;sound/mpu401.h&gt;
DECL|macro|SNDRV_GET_ID
mdefine_line|#define SNDRV_GET_ID
macro_line|#include &lt;sound/initval.h&gt;
id|EXPORT_NO_SYMBOLS
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Matt Wu &lt;Matt_Wu@acersoftech.com.cn&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;ALI M5451&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_CLASSES
c_func
(paren
l_string|&quot;{sound}&quot;
)paren
suffix:semicolon
id|MODULE_DEVICES
c_func
(paren
l_string|&quot;{{ALI,M5451,pci},{ALI,M5451}}&quot;
)paren
suffix:semicolon
DECL|variable|snd_index
r_static
r_int
id|snd_index
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_IDX
suffix:semicolon
multiline_comment|/* Index 0-MAX */
DECL|variable|snd_id
r_static
r_char
op_star
id|snd_id
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_STR
suffix:semicolon
multiline_comment|/* ID for this card */
DECL|variable|snd_enable
r_static
r_int
id|snd_enable
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_ENABLE_PNP
suffix:semicolon
DECL|variable|snd_pcm_channels
r_static
r_int
id|snd_pcm_channels
(braket
id|SNDRV_CARDS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
(paren
id|SNDRV_CARDS
op_minus
l_int|1
)paren
)braket
op_assign
l_int|32
)brace
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_index
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_index
comma
l_string|&quot;Index value for ALI M5451 PCI Audio.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_index
comma
id|SNDRV_INDEX_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_id
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_id
comma
l_string|&quot;ID string for ALI M5451 PCI Audio.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_id
comma
id|SNDRV_ID_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_enable
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_enable
comma
l_string|&quot;Enable ALI 5451 PCI Audio.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_enable
comma
id|SNDRV_ENABLE_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_pcm_channels
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;l&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_pcm_channels
comma
l_string|&quot;PCM Channels&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_pcm_channels
comma
id|SNDRV_ENABLED
l_string|&quot;,default:32,allows:{{1,32}}&quot;
)paren
suffix:semicolon
multiline_comment|/*&n; *  Debug part definations&n; */
singleline_comment|//#define ALI_DEBUG
macro_line|#ifdef ALI_DEBUG
DECL|macro|snd_ali_printk
mdefine_line|#define snd_ali_printk(format, args...) printk(format, ##args);
macro_line|#else
DECL|macro|snd_ali_printk
mdefine_line|#define snd_ali_printk(format, args...)
macro_line|#endif
multiline_comment|/*&n; *  Constants defination&n; */
macro_line|#ifndef PCI_VENDOR_ID_ALI
DECL|macro|PCI_VENDOR_ID_ALI
mdefine_line|#define PCI_VENDOR_ID_ALI&t;0x10b9
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_ALI_5451
DECL|macro|PCI_DEVICE_ID_ALI_5451
mdefine_line|#define PCI_DEVICE_ID_ALI_5451&t;0x5451
macro_line|#endif
DECL|macro|DEVICE_ID_ALI5451
mdefine_line|#define DEVICE_ID_ALI5451&t;((PCI_VENDOR_ID_ALI&lt;&lt;16)|PCI_DEVICE_ID_ALI_5451)
DECL|macro|ALI_CHANNELS
mdefine_line|#define ALI_CHANNELS&t;&t;32
DECL|macro|ALI_PCM_IN_CHANNEL
mdefine_line|#define ALI_PCM_IN_CHANNEL&t;31
DECL|macro|ALI_SPDIF_IN_CHANNEL
mdefine_line|#define ALI_SPDIF_IN_CHANNEL&t;19
DECL|macro|ALI_SPDIF_OUT_CHANNEL
mdefine_line|#define ALI_SPDIF_OUT_CHANNEL&t;15
DECL|macro|ALI_CENTER_CHANNEL
mdefine_line|#define ALI_CENTER_CHANNEL&t;24
DECL|macro|ALI_LEF_CHANNEL
mdefine_line|#define ALI_LEF_CHANNEL&t;&t;23
DECL|macro|ALI_SURR_LEFT_CHANNEL
mdefine_line|#define ALI_SURR_LEFT_CHANNEL&t;26
DECL|macro|ALI_SURR_RIGHT_CHANNEL
mdefine_line|#define ALI_SURR_RIGHT_CHANNEL&t;25
DECL|macro|SNDRV_ALI_VOICE_TYPE_PCM
mdefine_line|#define&t;SNDRV_ALI_VOICE_TYPE_PCM&t;01
DECL|macro|SNDRV_ALI_VOICE_TYPE_OTH
mdefine_line|#define SNDRV_ALI_VOICE_TYPE_OTH&t;02
DECL|macro|ALI_5451_V02
mdefine_line|#define&t;ALI_5451_V02&t;&t;0x02
multiline_comment|/*&n; *  Direct Registers&n; */
DECL|macro|ALI_LEGACY_DMAR0
mdefine_line|#define ALI_LEGACY_DMAR0        0x00  
singleline_comment|// ADR0
DECL|macro|ALI_LEGACY_DMAR4
mdefine_line|#define ALI_LEGACY_DMAR4        0x04  
singleline_comment|// CNT0
DECL|macro|ALI_LEGACY_DMAR11
mdefine_line|#define ALI_LEGACY_DMAR11       0x0b  
singleline_comment|// MOD 
DECL|macro|ALI_LEGACY_DMAR15
mdefine_line|#define ALI_LEGACY_DMAR15       0x0f  
singleline_comment|// MMR 
DECL|macro|ALI_MPUR0
mdefine_line|#define ALI_MPUR0&t;&t;0x20
DECL|macro|ALI_MPUR1
mdefine_line|#define ALI_MPUR1&t;&t;0x21
DECL|macro|ALI_MPUR2
mdefine_line|#define ALI_MPUR2&t;&t;0x22
DECL|macro|ALI_MPUR3
mdefine_line|#define ALI_MPUR3&t;&t;0x23
DECL|macro|ALI_AC97_WRITE
mdefine_line|#define&t;ALI_AC97_WRITE&t;&t;0x40
DECL|macro|ALI_AC97_READ
mdefine_line|#define ALI_AC97_READ&t;&t;0x44
DECL|macro|ALI_SCTRL
mdefine_line|#define ALI_SCTRL&t;&t;0x48
DECL|macro|ALI_AC97_GPIO
mdefine_line|#define ALI_AC97_GPIO&t;&t;0x4c
DECL|macro|ALI_SPDIF_CS
mdefine_line|#define ALI_SPDIF_CS&t;&t;0x70
DECL|macro|ALI_SPDIF_CTRL
mdefine_line|#define ALI_SPDIF_CTRL&t;&t;0x74
DECL|macro|ALI_START
mdefine_line|#define ALI_START&t;&t;0x80
DECL|macro|ALI_STOP
mdefine_line|#define ALI_STOP&t;&t;0x84
DECL|macro|ALI_CSPF
mdefine_line|#define ALI_CSPF&t;&t;0x90
DECL|macro|ALI_AINT
mdefine_line|#define ALI_AINT&t;&t;0x98
DECL|macro|ALI_GC_CIR
mdefine_line|#define ALI_GC_CIR&t;&t;0xa0
DECL|macro|ENDLP_IE
mdefine_line|#define ENDLP_IE&t;&t;0x00001000
DECL|macro|MIDLP_IE
mdefine_line|#define MIDLP_IE&t;&t;0x00002000
DECL|macro|ALI_AINTEN
mdefine_line|#define ALI_AINTEN&t;&t;0xa4
DECL|macro|ALI_VOLUME
mdefine_line|#define ALI_VOLUME&t;&t;0xa8
DECL|macro|ALI_SBDELTA_DELTA_R
mdefine_line|#define ALI_SBDELTA_DELTA_R     0xac
DECL|macro|ALI_MISCINT
mdefine_line|#define ALI_MISCINT&t;&t;0xb0
DECL|macro|ADDRESS_IRQ
mdefine_line|#define ADDRESS_IRQ&t;&t;0x00000020
DECL|macro|TARGET_REACHED
mdefine_line|#define TARGET_REACHED&t;&t;0x00008000
DECL|macro|MIXER_OVERFLOW
mdefine_line|#define MIXER_OVERFLOW&t;&t;0x00000800
DECL|macro|MIXER_UNDERFLOW
mdefine_line|#define MIXER_UNDERFLOW&t;&t;0x00000400
DECL|macro|ALI_SBBL_SBCL
mdefine_line|#define ALI_SBBL_SBCL           0xc0
DECL|macro|ALI_SBCTRL_SBE2R_SBDD
mdefine_line|#define ALI_SBCTRL_SBE2R_SBDD   0xc4
DECL|macro|ALI_STIMER
mdefine_line|#define ALI_STIMER&t;&t;0xc8
DECL|macro|ALI_GLOBAL_CONTROL
mdefine_line|#define ALI_GLOBAL_CONTROL&t;0xd4
DECL|macro|ALI_CSO_ALPHA_FMS
mdefine_line|#define ALI_CSO_ALPHA_FMS&t;0xe0
DECL|macro|ALI_LBA
mdefine_line|#define ALI_LBA&t;&t;&t;0xe4
DECL|macro|ALI_ESO_DELTA
mdefine_line|#define ALI_ESO_DELTA&t;&t;0xe8
DECL|macro|ALI_GVSEL_PAN_VOC_CTRL_EC
mdefine_line|#define ALI_GVSEL_PAN_VOC_CTRL_EC&t;0xf0
DECL|macro|ALI_EBUF1
mdefine_line|#define ALI_EBUF1&t;&t;0xf4
DECL|macro|ALI_EBUF2
mdefine_line|#define ALI_EBUF2&t;&t;0xf8
DECL|macro|ALI_REG
mdefine_line|#define ALI_REG(codec, x) ((codec)-&gt;port + x)
DECL|typedef|ali_t
r_typedef
r_struct
id|snd_stru_ali
id|ali_t
suffix:semicolon
DECL|typedef|snd_ali_voice_t
r_typedef
r_struct
id|snd_ali_stru_voice
id|snd_ali_voice_t
suffix:semicolon
DECL|macro|chip_t
mdefine_line|#define chip_t ali_t
DECL|struct|snd_ali_channel_control
r_typedef
r_struct
id|snd_ali_channel_control
(brace
singleline_comment|// register data
DECL|struct|REGDATA
r_struct
id|REGDATA
(brace
DECL|member|start
r_int
r_int
id|start
suffix:semicolon
DECL|member|stop
r_int
r_int
id|stop
suffix:semicolon
DECL|member|aint
r_int
r_int
id|aint
suffix:semicolon
DECL|member|ainten
r_int
r_int
id|ainten
suffix:semicolon
DECL|member|data
)brace
id|data
suffix:semicolon
singleline_comment|// register addresses
DECL|struct|REGS
r_struct
id|REGS
(brace
DECL|member|start
r_int
r_int
id|start
suffix:semicolon
DECL|member|stop
r_int
r_int
id|stop
suffix:semicolon
DECL|member|aint
r_int
r_int
id|aint
suffix:semicolon
DECL|member|ainten
r_int
r_int
id|ainten
suffix:semicolon
DECL|member|ac97read
r_int
r_int
id|ac97read
suffix:semicolon
DECL|member|ac97write
r_int
r_int
id|ac97write
suffix:semicolon
DECL|member|regs
)brace
id|regs
suffix:semicolon
DECL|typedef|snd_ali_channel_control_t
)brace
id|snd_ali_channel_control_t
suffix:semicolon
DECL|struct|snd_ali_stru_voice
r_struct
id|snd_ali_stru_voice
(brace
DECL|member|number
r_int
r_int
id|number
suffix:semicolon
DECL|member|use
r_int
id|use
suffix:colon
l_int|1
comma
DECL|member|pcm
id|pcm
suffix:colon
l_int|1
comma
DECL|member|midi
id|midi
suffix:colon
l_int|1
comma
DECL|member|mode
id|mode
suffix:colon
l_int|1
comma
DECL|member|synth
id|synth
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* PCM data */
DECL|member|codec
id|ali_t
op_star
id|codec
suffix:semicolon
DECL|member|substream
id|snd_pcm_substream_t
op_star
id|substream
suffix:semicolon
DECL|member|extra
id|snd_ali_voice_t
op_star
id|extra
suffix:semicolon
DECL|member|running
r_int
id|running
suffix:colon
l_int|1
suffix:semicolon
DECL|member|eso
r_int
id|eso
suffix:semicolon
multiline_comment|/* final ESO value for channel */
DECL|member|count
r_int
id|count
suffix:semicolon
multiline_comment|/* runtime-&gt;period_size */
multiline_comment|/* --- */
DECL|member|private_data
r_void
op_star
id|private_data
suffix:semicolon
DECL|member|private_free
r_void
(paren
op_star
id|private_free
)paren
(paren
r_void
op_star
id|private_data
)paren
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|snd_stru_alidev
r_typedef
r_struct
id|snd_stru_alidev
(brace
DECL|member|voices
id|snd_ali_voice_t
id|voices
(braket
id|ALI_CHANNELS
)braket
suffix:semicolon
DECL|member|chcnt
r_int
r_int
id|chcnt
suffix:semicolon
multiline_comment|/* num of opened channels */
DECL|member|chmap
r_int
r_int
id|chmap
suffix:semicolon
multiline_comment|/* bitmap for opened channels */
DECL|member|synthcount
r_int
r_int
id|synthcount
suffix:semicolon
DECL|typedef|alidev_t
)brace
id|alidev_t
suffix:semicolon
macro_line|#ifdef CONFIG_PM
DECL|macro|ALI_GLOBAL_REGS
mdefine_line|#define ALI_GLOBAL_REGS&t;&t;56
DECL|macro|ALI_CHANNEL_REGS
mdefine_line|#define ALI_CHANNEL_REGS&t;8
DECL|struct|snd_ali_image
r_typedef
r_struct
id|snd_ali_image
(brace
DECL|member|regs
r_int
r_int
id|regs
(braket
id|ALI_GLOBAL_REGS
)braket
suffix:semicolon
DECL|member|channel_regs
r_int
r_int
id|channel_regs
(braket
id|ALI_CHANNELS
)braket
(braket
id|ALI_CHANNEL_REGS
)braket
suffix:semicolon
DECL|typedef|ali_image_t
)brace
id|ali_image_t
suffix:semicolon
macro_line|#endif
DECL|struct|snd_stru_ali
r_struct
id|snd_stru_ali
(brace
DECL|member|irq
r_int
r_int
id|irq
suffix:semicolon
DECL|member|port
r_int
r_int
id|port
suffix:semicolon
DECL|member|revision
r_int
r_char
id|revision
suffix:semicolon
DECL|member|res_port
r_struct
id|resource
op_star
id|res_port
suffix:semicolon
DECL|member|pci
r_struct
id|pci_dev
op_star
id|pci
suffix:semicolon
DECL|member|pci_m1533
r_struct
id|pci_dev
op_star
id|pci_m1533
suffix:semicolon
DECL|member|pci_m7101
r_struct
id|pci_dev
op_star
id|pci_m7101
suffix:semicolon
DECL|member|card
id|snd_card_t
op_star
id|card
suffix:semicolon
DECL|member|pcm
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
DECL|member|synth
id|alidev_t
id|synth
suffix:semicolon
DECL|member|chregs
id|snd_ali_channel_control_t
id|chregs
suffix:semicolon
multiline_comment|/* S/PDIF Mask */
DECL|member|spdif_mask
r_int
r_int
id|spdif_mask
suffix:semicolon
DECL|member|spurious_irq_count
r_int
r_int
id|spurious_irq_count
suffix:semicolon
DECL|member|spurious_irq_max_delta
r_int
r_int
id|spurious_irq_max_delta
suffix:semicolon
DECL|member|ac97
id|ac97_t
op_star
id|ac97
suffix:semicolon
DECL|member|ac97_ext_id
r_int
r_int
id|ac97_ext_id
suffix:semicolon
DECL|member|ac97_ext_status
r_int
r_int
id|ac97_ext_status
suffix:semicolon
DECL|member|reg_lock
id|spinlock_t
id|reg_lock
suffix:semicolon
DECL|member|voice_alloc
id|spinlock_t
id|voice_alloc
suffix:semicolon
macro_line|#ifdef CONFIG_PM
DECL|member|image
id|ali_image_t
op_star
id|image
suffix:semicolon
macro_line|#endif
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|snd_ali_ids
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
l_int|0x10b9
comma
l_int|0x5451
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|snd_ali_ids
)paren
suffix:semicolon
r_static
r_void
id|snd_ali_clear_voices
c_func
(paren
id|ali_t
op_star
comma
r_int
r_int
comma
r_int
r_int
)paren
suffix:semicolon
r_static
r_int
r_int
id|snd_ali_codec_peek
c_func
(paren
id|ali_t
op_star
comma
r_int
comma
r_int
r_int
)paren
suffix:semicolon
r_static
r_void
id|snd_ali_codec_poke
c_func
(paren
id|ali_t
op_star
comma
r_int
comma
r_int
r_int
comma
r_int
r_int
)paren
suffix:semicolon
multiline_comment|/*&n; *  Debug Part&n; */
macro_line|#ifdef ALI_DEBUG
DECL|function|ali_read_regs
r_static
r_void
id|ali_read_regs
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
id|channel
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_int
r_int
id|dwVal
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;channel %d registers map:&bslash;n&quot;
comma
id|channel
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
r_int
r_char
)paren
(paren
id|channel
op_amp
l_int|0x001f
)paren
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GC_CIR
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;    &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
suffix:semicolon
id|j
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%2.2x       &quot;
comma
id|j
op_star
l_int|4
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|0xf8
op_div
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%2.2x  &quot;
comma
(paren
id|i
op_star
l_int|4
op_div
l_int|0x10
)paren
op_star
l_int|0x10
)paren
suffix:semicolon
)brace
id|dwVal
op_assign
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|i
op_star
l_int|4
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%8.8x &quot;
comma
id|dwVal
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_mod
l_int|8
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|ali_read_cfg
r_static
r_void
id|ali_read_cfg
c_func
(paren
r_int
r_int
id|vendor
comma
r_int
id|deviceid
)paren
(brace
r_int
r_int
id|dwVal
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pci_dev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|pci_dev
op_assign
id|pci_find_device
c_func
(paren
id|vendor
comma
id|deviceid
comma
id|pci_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_dev
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;nM%x PCI CFG&bslash;n&quot;
comma
id|deviceid
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;    &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
suffix:semicolon
id|j
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%d        &quot;
comma
id|j
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%d   &quot;
comma
id|i
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
suffix:semicolon
id|j
op_increment
)paren
(brace
id|pci_read_config_dword
c_func
(paren
id|pci_dev
comma
id|i
op_star
l_int|0x20
op_plus
id|j
op_star
l_int|4
comma
op_amp
id|dwVal
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%8.8x &quot;
comma
id|dwVal
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|ali_read_ac97regs
r_static
r_void
id|ali_read_ac97regs
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
id|secondary
)paren
(brace
r_int
r_int
id|i
comma
id|j
suffix:semicolon
r_int
r_int
id|wVal
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;ncodec %d registers map:&bslash;n&quot;
comma
id|secondary
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;    &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|8
suffix:semicolon
id|j
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%2.2x   &quot;
comma
id|j
op_star
l_int|2
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|64
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
op_mod
l_int|8
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%2.2x  &quot;
comma
(paren
id|i
op_div
l_int|8
)paren
op_star
l_int|0x10
)paren
suffix:semicolon
)brace
id|wVal
op_assign
id|snd_ali_codec_peek
c_func
(paren
id|codec
comma
id|secondary
comma
id|i
op_star
l_int|2
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%4.4x &quot;
comma
id|wVal
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_mod
l_int|8
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; *  AC97 ACCESS&n; */
DECL|function|snd_ali_5451_peek
r_static
r_inline
r_int
r_int
id|snd_ali_5451_peek
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
r_int
id|port
)paren
(brace
r_return
(paren
r_int
r_int
)paren
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|port
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_ali_5451_poke
r_static
r_inline
r_void
id|snd_ali_5451_poke
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
r_int
id|port
comma
r_int
r_int
id|val
)paren
(brace
id|outl
c_func
(paren
(paren
r_int
r_int
)paren
id|val
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|port
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_ali_codec_ready
r_static
r_int
id|snd_ali_codec_ready
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
r_int
id|port
comma
r_int
id|sched
)paren
(brace
r_int
r_int
id|end_time
suffix:semicolon
id|end_time
op_assign
id|jiffies
op_plus
l_int|10
op_star
(paren
id|HZ
op_rshift
l_int|2
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|snd_ali_5451_peek
c_func
(paren
id|codec
comma
id|port
)paren
op_amp
l_int|0x8000
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sched
)paren
(brace
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|end_time
op_minus
(paren
r_int
r_int
)paren
id|jiffies
op_ge
l_int|0
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;ali_codec_ready: codec is not ready.&bslash;n &quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|snd_ali_stimer_ready
r_static
r_int
id|snd_ali_stimer_ready
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
id|sched
)paren
(brace
r_int
r_int
id|end_time
suffix:semicolon
r_int
r_int
id|dwChk1
comma
id|dwChk2
suffix:semicolon
id|dwChk1
op_assign
id|snd_ali_5451_peek
c_func
(paren
id|codec
comma
id|ALI_STIMER
)paren
suffix:semicolon
id|dwChk2
op_assign
id|snd_ali_5451_peek
c_func
(paren
id|codec
comma
id|ALI_STIMER
)paren
suffix:semicolon
id|end_time
op_assign
id|jiffies
op_plus
l_int|10
op_star
(paren
id|HZ
op_rshift
l_int|2
)paren
suffix:semicolon
r_do
(brace
id|dwChk2
op_assign
id|snd_ali_5451_peek
c_func
(paren
id|codec
comma
id|ALI_STIMER
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dwChk2
op_ne
id|dwChk1
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sched
)paren
(brace
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|end_time
op_minus
(paren
r_int
r_int
)paren
id|jiffies
op_ge
l_int|0
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;ali_stimer_read: stimer is not ready.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|snd_ali_codec_poke
r_static
r_void
id|snd_ali_codec_poke
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
id|secondary
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
r_int
r_int
id|dwVal
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|port
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_ge
l_int|0x80
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;ali_codec_poke: reg(%xh) invalid.&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|port
op_assign
id|codec-&gt;chregs.regs.ac97write
suffix:semicolon
r_if
c_cond
(paren
id|snd_ali_codec_ready
c_func
(paren
id|codec
comma
id|port
comma
l_int|0
)paren
OL
l_int|0
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|snd_ali_stimer_ready
c_func
(paren
id|codec
comma
l_int|0
)paren
OL
l_int|0
)paren
r_return
suffix:semicolon
id|dwVal
op_assign
(paren
r_int
r_int
)paren
(paren
id|reg
op_amp
l_int|0xff
)paren
suffix:semicolon
id|dwVal
op_or_assign
l_int|0x8000
op_or
(paren
id|val
op_lshift
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|secondary
)paren
id|dwVal
op_or_assign
l_int|0x0080
suffix:semicolon
r_if
c_cond
(paren
id|codec-&gt;revision
op_eq
id|ALI_5451_V02
)paren
id|dwVal
op_or_assign
l_int|0x0100
suffix:semicolon
id|snd_ali_5451_poke
c_func
(paren
id|codec
comma
id|port
comma
id|dwVal
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|snd_ali_codec_peek
r_static
r_int
r_int
id|snd_ali_codec_peek
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
id|secondary
comma
r_int
r_int
id|reg
)paren
(brace
r_int
r_int
id|dwVal
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|port
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_ge
l_int|0x80
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;ali_codec_peek: reg(%xh) invalid.&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
r_return
op_complement
l_int|0
suffix:semicolon
)brace
id|port
op_assign
id|codec-&gt;chregs.regs.ac97read
suffix:semicolon
r_if
c_cond
(paren
id|snd_ali_codec_ready
c_func
(paren
id|codec
comma
id|port
comma
l_int|0
)paren
OL
l_int|0
)paren
r_return
op_complement
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|snd_ali_stimer_ready
c_func
(paren
id|codec
comma
l_int|0
)paren
OL
l_int|0
)paren
r_return
op_complement
l_int|0
suffix:semicolon
id|dwVal
op_assign
(paren
r_int
r_int
)paren
(paren
id|reg
op_amp
l_int|0xff
)paren
suffix:semicolon
id|dwVal
op_or_assign
l_int|0x8000
suffix:semicolon
multiline_comment|/* bit 15*/
r_if
c_cond
(paren
id|secondary
)paren
id|dwVal
op_or_assign
l_int|0x0080
suffix:semicolon
id|snd_ali_5451_poke
c_func
(paren
id|codec
comma
id|port
comma
id|dwVal
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_ali_stimer_ready
c_func
(paren
id|codec
comma
l_int|0
)paren
OL
l_int|0
)paren
r_return
op_complement
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|snd_ali_codec_ready
c_func
(paren
id|codec
comma
id|port
comma
l_int|0
)paren
OL
l_int|0
)paren
r_return
op_complement
l_int|0
suffix:semicolon
r_return
(paren
id|snd_ali_5451_peek
c_func
(paren
id|codec
comma
id|port
)paren
op_amp
l_int|0xffff0000
)paren
op_rshift
l_int|16
suffix:semicolon
)brace
DECL|function|snd_ali_codec_write
r_static
r_void
id|snd_ali_codec_write
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
id|ali_t
op_star
id|codec
op_assign
id|snd_magic_cast
c_func
(paren
id|ali_t
comma
id|ac97-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;codec_write: reg=%xh data=%xh.&bslash;n&quot;
comma
id|reg
comma
id|val
)paren
suffix:semicolon
id|snd_ali_codec_poke
c_func
(paren
id|codec
comma
l_int|0
comma
id|reg
comma
id|val
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|snd_ali_codec_read
r_static
r_int
r_int
id|snd_ali_codec_read
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
)paren
(brace
id|ali_t
op_star
id|codec
op_assign
id|snd_magic_cast
c_func
(paren
id|ali_t
comma
id|ac97-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;codec_read reg=%xh.&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
r_return
(paren
id|snd_ali_codec_peek
c_func
(paren
id|codec
comma
l_int|0
comma
id|reg
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;AC97 Reset&n; */
DECL|function|snd_ali_reset_5451
r_static
r_int
id|snd_ali_reset_5451
c_func
(paren
id|ali_t
op_star
id|codec
)paren
(brace
r_struct
id|pci_dev
op_star
id|pci_dev
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|wCount
comma
id|wReg
suffix:semicolon
r_int
r_int
id|dwVal
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pci_dev
op_assign
id|codec-&gt;pci_m1533
)paren
op_ne
l_int|NULL
)paren
(brace
id|pci_read_config_dword
c_func
(paren
id|pci_dev
comma
l_int|0x7c
comma
op_amp
id|dwVal
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pci_dev
comma
l_int|0x7c
comma
id|dwVal
op_or
l_int|0x08000000
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5000
)paren
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|pci_dev
comma
l_int|0x7c
comma
op_amp
id|dwVal
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pci_dev
comma
l_int|0x7c
comma
id|dwVal
op_amp
l_int|0xf7ffffff
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5000
)paren
suffix:semicolon
)brace
id|pci_dev
op_assign
id|codec-&gt;pci
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|pci_dev
comma
l_int|0x44
comma
op_amp
id|dwVal
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pci_dev
comma
l_int|0x44
comma
id|dwVal
op_or
l_int|0x000c0000
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|500
)paren
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|pci_dev
comma
l_int|0x44
comma
op_amp
id|dwVal
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pci_dev
comma
l_int|0x44
comma
id|dwVal
op_amp
l_int|0xfffbffff
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5000
)paren
suffix:semicolon
id|wCount
op_assign
l_int|200
suffix:semicolon
r_while
c_loop
(paren
id|wCount
op_decrement
)paren
(brace
id|wReg
op_assign
id|snd_ali_codec_peek
c_func
(paren
id|codec
comma
l_int|0
comma
id|AC97_POWERDOWN
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wReg
op_amp
l_int|0x000f
)paren
op_eq
l_int|0x000f
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|5000
)paren
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef CODEC_RESET
DECL|function|snd_ali_reset_codec
r_static
r_int
id|snd_ali_reset_codec
c_func
(paren
id|ali_t
op_star
id|codec
)paren
(brace
r_struct
id|pci_dev
op_star
id|pci_dev
op_assign
l_int|NULL
suffix:semicolon
r_int
r_char
id|bVal
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|dwVal
suffix:semicolon
r_int
r_int
id|wCount
comma
id|wReg
suffix:semicolon
id|pci_dev
op_assign
id|codec-&gt;pci_m1533
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|pci_dev
comma
l_int|0x7c
comma
op_amp
id|dwVal
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pci_dev
comma
l_int|0x7c
comma
id|dwVal
op_or
l_int|0x08000000
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5000
)paren
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|pci_dev
comma
l_int|0x7c
comma
op_amp
id|dwVal
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pci_dev
comma
l_int|0x7c
comma
id|dwVal
op_amp
l_int|0xf7ffffff
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5000
)paren
suffix:semicolon
id|bVal
op_assign
id|inb
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SCTRL
)paren
)paren
suffix:semicolon
id|bVal
op_or_assign
l_int|0x02
suffix:semicolon
id|outb
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SCTRL
)paren
comma
id|bVal
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5000
)paren
suffix:semicolon
id|bVal
op_assign
id|inb
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SCTRL
)paren
)paren
suffix:semicolon
id|bVal
op_and_assign
l_int|0xfd
suffix:semicolon
id|outb
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SCTRL
)paren
comma
id|bVal
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|15000
)paren
suffix:semicolon
id|wCount
op_assign
l_int|200
suffix:semicolon
r_while
c_loop
(paren
id|wCount
op_decrement
)paren
(brace
id|wReg
op_assign
id|snd_ali_codec_read
c_func
(paren
id|codec-&gt;ac97
comma
id|AC97_POWERDOWN
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|wReg
op_amp
l_int|0x000f
)paren
op_eq
l_int|0x000f
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|5000
)paren
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; *  ALI 5451 Controller&n; */
DECL|function|snd_ali_enable_special_channel
r_static
r_void
id|snd_ali_enable_special_channel
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
r_int
id|channel
)paren
(brace
r_int
r_int
id|dwVal
op_assign
l_int|0
suffix:semicolon
id|dwVal
op_assign
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GLOBAL_CONTROL
)paren
)paren
suffix:semicolon
id|dwVal
op_or_assign
l_int|1
op_lshift
(paren
id|channel
op_amp
l_int|0x0000001f
)paren
suffix:semicolon
id|outl
c_func
(paren
id|dwVal
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GLOBAL_CONTROL
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_ali_disable_special_channel
r_static
r_void
id|snd_ali_disable_special_channel
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
r_int
id|channel
)paren
(brace
r_int
r_int
id|dwVal
op_assign
l_int|0
suffix:semicolon
id|dwVal
op_assign
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GLOBAL_CONTROL
)paren
)paren
suffix:semicolon
id|dwVal
op_and_assign
op_complement
(paren
l_int|1
op_lshift
(paren
id|channel
op_amp
l_int|0x0000001f
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|dwVal
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GLOBAL_CONTROL
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_ali_enable_address_interrupt
r_static
r_void
id|snd_ali_enable_address_interrupt
c_func
(paren
id|ali_t
op_star
id|codec
)paren
(brace
r_int
r_int
id|gc
suffix:semicolon
id|gc
op_assign
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GC_CIR
)paren
)paren
suffix:semicolon
id|gc
op_or_assign
id|ENDLP_IE
suffix:semicolon
id|gc
op_or_assign
id|MIDLP_IE
suffix:semicolon
id|outl
c_func
(paren
id|gc
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GC_CIR
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_ali_disable_address_interrupt
r_static
r_void
id|snd_ali_disable_address_interrupt
c_func
(paren
id|ali_t
op_star
id|codec
)paren
(brace
r_int
r_int
id|gc
suffix:semicolon
id|gc
op_assign
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GC_CIR
)paren
)paren
suffix:semicolon
id|gc
op_and_assign
op_complement
id|ENDLP_IE
suffix:semicolon
id|gc
op_and_assign
op_complement
id|MIDLP_IE
suffix:semicolon
id|outl
c_func
(paren
id|gc
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GC_CIR
)paren
)paren
suffix:semicolon
)brace
macro_line|#if 0 
singleline_comment|// not used
r_static
r_void
id|snd_ali_enable_voice_irq
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
r_int
id|channel
)paren
(brace
r_int
r_int
id|mask
suffix:semicolon
id|snd_ali_channel_control_t
op_star
id|pchregs
op_assign
op_amp
(paren
id|codec-&gt;chregs
)paren
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;enable_voice_irq channel=%d&bslash;n&quot;
comma
id|channel
)paren
suffix:semicolon
id|mask
op_assign
l_int|1
op_lshift
(paren
id|channel
op_amp
l_int|0x1f
)paren
suffix:semicolon
id|pchregs-&gt;data.ainten
op_assign
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|pchregs-&gt;regs.ainten
)paren
)paren
suffix:semicolon
id|pchregs-&gt;data.ainten
op_or_assign
id|mask
suffix:semicolon
id|outl
c_func
(paren
id|pchregs-&gt;data.ainten
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|pchregs-&gt;regs.ainten
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|snd_ali_disable_voice_irq
r_static
r_void
id|snd_ali_disable_voice_irq
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
r_int
id|channel
)paren
(brace
r_int
r_int
id|mask
suffix:semicolon
id|snd_ali_channel_control_t
op_star
id|pchregs
op_assign
op_amp
(paren
id|codec-&gt;chregs
)paren
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;disable_voice_irq channel=%d&bslash;n&quot;
comma
id|channel
)paren
suffix:semicolon
id|mask
op_assign
l_int|1
op_lshift
(paren
id|channel
op_amp
l_int|0x1f
)paren
suffix:semicolon
id|pchregs-&gt;data.ainten
op_assign
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|pchregs-&gt;regs.ainten
)paren
)paren
suffix:semicolon
id|pchregs-&gt;data.ainten
op_and_assign
op_complement
id|mask
suffix:semicolon
id|outl
c_func
(paren
id|pchregs-&gt;data.ainten
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|pchregs-&gt;regs.ainten
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_ali_alloc_pcm_channel
r_static
r_int
id|snd_ali_alloc_pcm_channel
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
id|channel
)paren
(brace
r_int
r_int
id|idx
op_assign
id|channel
op_amp
l_int|0x1f
suffix:semicolon
r_if
c_cond
(paren
id|codec-&gt;synth.chcnt
op_ge
id|ALI_CHANNELS
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;ali_alloc_pcm_channel: no free channels.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|codec-&gt;synth.chmap
op_amp
(paren
l_int|1
op_lshift
id|idx
)paren
)paren
)paren
(brace
id|codec-&gt;synth.chmap
op_or_assign
l_int|1
op_lshift
id|idx
suffix:semicolon
id|codec-&gt;synth.chcnt
op_increment
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;alloc_pcm_channel no. %d.&bslash;n&quot;
comma
id|idx
)paren
suffix:semicolon
r_return
id|idx
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|snd_ali_find_free_channel
r_static
r_int
id|snd_ali_find_free_channel
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
id|rec
)paren
(brace
r_int
id|idx
suffix:semicolon
r_int
id|result
op_assign
op_minus
l_int|1
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;find_free_channel: for %s&bslash;n&quot;
comma
id|rec
ques
c_cond
l_string|&quot;rec&quot;
suffix:colon
l_string|&quot;pcm&quot;
)paren
suffix:semicolon
singleline_comment|// recording
r_if
c_cond
(paren
id|rec
)paren
(brace
r_if
c_cond
(paren
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GLOBAL_CONTROL
)paren
)paren
op_amp
(paren
l_int|1
op_lshift
l_int|11
)paren
op_logical_and
(paren
id|codec-&gt;revision
op_eq
id|ALI_5451_V02
)paren
)paren
id|idx
op_assign
id|ALI_SPDIF_IN_CHANNEL
suffix:semicolon
r_else
id|idx
op_assign
id|ALI_PCM_IN_CHANNEL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|result
op_assign
id|snd_ali_alloc_pcm_channel
c_func
(paren
id|codec
comma
id|idx
)paren
)paren
op_ge
l_int|0
)paren
(brace
r_return
id|result
suffix:semicolon
)brace
r_else
(brace
id|snd_printk
c_func
(paren
l_string|&quot;ali_find_free_channel: record channel is busy now.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
singleline_comment|//playback...
r_if
c_cond
(paren
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GLOBAL_CONTROL
)paren
)paren
op_amp
(paren
l_int|1
op_lshift
l_int|15
)paren
)paren
(brace
id|idx
op_assign
id|ALI_SPDIF_OUT_CHANNEL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|result
op_assign
id|snd_ali_alloc_pcm_channel
c_func
(paren
id|codec
comma
id|idx
)paren
)paren
op_ge
l_int|0
)paren
(brace
r_return
id|result
suffix:semicolon
)brace
r_else
(brace
id|snd_printk
c_func
(paren
l_string|&quot;ali_find_free_channel: S/PDIF out channel is in busy now.&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|ALI_CHANNELS
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|result
op_assign
id|snd_ali_alloc_pcm_channel
c_func
(paren
id|codec
comma
id|idx
)paren
)paren
op_ge
l_int|0
)paren
r_return
id|result
suffix:semicolon
)brace
id|snd_printk
c_func
(paren
l_string|&quot;ali_find_free_channel: no free channels.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|snd_ali_free_channel_pcm
r_static
r_void
id|snd_ali_free_channel_pcm
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
id|channel
)paren
(brace
r_int
r_int
id|idx
op_assign
id|channel
op_amp
l_int|0x0000001f
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;free_channel_pcm channel=%d&bslash;n&quot;
comma
id|channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|channel
OL
l_int|0
op_logical_or
id|channel
op_ge
id|ALI_CHANNELS
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|codec-&gt;synth.chmap
op_amp
(paren
l_int|1
op_lshift
id|idx
)paren
)paren
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;ali_free_channel_pcm: channel %d is not in use.&bslash;n&quot;
comma
id|channel
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
id|codec-&gt;synth.chmap
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|idx
)paren
suffix:semicolon
id|codec-&gt;synth.chcnt
op_decrement
suffix:semicolon
)brace
)brace
macro_line|#if 0 
singleline_comment|// not used
r_static
r_void
id|snd_ali_start_voice
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
r_int
id|channel
)paren
(brace
r_int
r_int
id|mask
op_assign
l_int|1
op_lshift
(paren
id|channel
op_amp
l_int|0x1f
)paren
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;start_voice: channel=%d&bslash;n&quot;
comma
id|channel
)paren
suffix:semicolon
id|outl
c_func
(paren
id|mask
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|codec-&gt;chregs.regs.start
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|snd_ali_stop_voice
r_static
r_void
id|snd_ali_stop_voice
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
r_int
id|channel
)paren
(brace
r_int
r_int
id|mask
op_assign
l_int|1
op_lshift
(paren
id|channel
op_amp
l_int|0x1f
)paren
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;stop_voice: channel=%d&bslash;n&quot;
comma
id|channel
)paren
suffix:semicolon
id|outl
c_func
(paren
id|mask
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|codec-&gt;chregs.regs.stop
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *    S/PDIF Part&n; */
DECL|function|snd_ali_delay
r_static
r_void
id|snd_ali_delay
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
id|interval
)paren
(brace
r_int
r_int
id|begintimer
comma
id|currenttimer
suffix:semicolon
id|begintimer
op_assign
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_STIMER
)paren
)paren
suffix:semicolon
id|currenttimer
op_assign
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_STIMER
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|currenttimer
OL
id|begintimer
op_plus
id|interval
)paren
(brace
r_if
c_cond
(paren
id|snd_ali_stimer_ready
c_func
(paren
id|codec
comma
l_int|1
)paren
OL
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
id|currenttimer
op_assign
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_STIMER
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_ali_detect_spdif_rate
r_static
r_void
id|snd_ali_detect_spdif_rate
c_func
(paren
id|ali_t
op_star
id|codec
)paren
(brace
id|u16
id|wval
op_assign
l_int|0
suffix:semicolon
id|u16
id|count
op_assign
l_int|0
suffix:semicolon
id|u8
id|bval
op_assign
l_int|0
comma
id|R1
op_assign
l_int|0
comma
id|R2
op_assign
l_int|0
suffix:semicolon
id|bval
op_assign
id|inb
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CTRL
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|bval
op_or_assign
l_int|0x1F
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CTRL
op_plus
l_int|1
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
(paren
id|R1
OL
l_int|0x0B
)paren
op_logical_or
(paren
id|R1
OG
l_int|0x0E
)paren
)paren
op_logical_and
(paren
id|R1
op_ne
l_int|0x12
)paren
op_logical_and
id|count
op_le
l_int|50000
)paren
(brace
id|count
op_increment
suffix:semicolon
id|snd_ali_delay
c_func
(paren
id|codec
comma
l_int|6
)paren
suffix:semicolon
id|bval
op_assign
id|inb
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CTRL
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|R1
op_assign
id|bval
op_amp
l_int|0x1F
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count
OG
l_int|50000
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;ali_detect_spdif_rate: timeout!&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|count
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|count
op_increment
op_le
l_int|50000
)paren
(brace
id|snd_ali_delay
c_func
(paren
id|codec
comma
l_int|6
)paren
suffix:semicolon
id|bval
op_assign
id|inb
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CTRL
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|R2
op_assign
id|bval
op_amp
l_int|0x1F
suffix:semicolon
r_if
c_cond
(paren
id|R2
op_ne
id|R1
)paren
id|R1
op_assign
id|R2
suffix:semicolon
r_else
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count
OG
l_int|50000
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;ali_detect_spdif_rate: timeout!&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|R2
op_ge
l_int|0x0b
op_logical_and
id|R2
op_le
l_int|0x0e
)paren
(brace
id|wval
op_assign
id|inw
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CTRL
op_plus
l_int|2
)paren
)paren
suffix:semicolon
id|wval
op_and_assign
l_int|0xE0F0
suffix:semicolon
id|wval
op_or_assign
(paren
id|u16
)paren
l_int|0x09
op_lshift
l_int|8
op_or
(paren
id|u16
)paren
l_int|0x05
suffix:semicolon
id|outw
c_func
(paren
id|wval
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CTRL
op_plus
l_int|2
)paren
)paren
suffix:semicolon
id|bval
op_assign
id|inb
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CS
op_plus
l_int|3
)paren
)paren
op_amp
l_int|0xF0
suffix:semicolon
id|outb
c_func
(paren
id|bval
op_or
l_int|0x02
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CS
op_plus
l_int|3
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|R2
op_eq
l_int|0x12
)paren
(brace
id|wval
op_assign
id|inw
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CTRL
op_plus
l_int|2
)paren
)paren
suffix:semicolon
id|wval
op_and_assign
l_int|0xE0F0
suffix:semicolon
id|wval
op_or_assign
(paren
id|u16
)paren
l_int|0x0E
op_lshift
l_int|8
op_or
(paren
id|u16
)paren
l_int|0x08
suffix:semicolon
id|outw
c_func
(paren
id|wval
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CTRL
op_plus
l_int|2
)paren
)paren
suffix:semicolon
id|bval
op_assign
id|inb
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CS
op_plus
l_int|3
)paren
)paren
op_amp
l_int|0xF0
suffix:semicolon
id|outb
c_func
(paren
id|bval
op_or
l_int|0x03
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CS
op_plus
l_int|3
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_ali_get_spdif_in_rate
r_static
r_int
r_int
id|snd_ali_get_spdif_in_rate
c_func
(paren
id|ali_t
op_star
id|codec
)paren
(brace
id|u32
id|dwRate
op_assign
l_int|0
suffix:semicolon
id|u8
id|bval
op_assign
l_int|0
suffix:semicolon
id|bval
op_assign
id|inb
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CTRL
)paren
)paren
suffix:semicolon
id|bval
op_and_assign
l_int|0x7F
suffix:semicolon
id|bval
op_or_assign
l_int|0x40
suffix:semicolon
id|outb
c_func
(paren
id|bval
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CTRL
)paren
)paren
suffix:semicolon
id|snd_ali_detect_spdif_rate
c_func
(paren
id|codec
)paren
suffix:semicolon
id|bval
op_assign
id|inb
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CS
op_plus
l_int|3
)paren
)paren
suffix:semicolon
id|bval
op_and_assign
l_int|0x0F
suffix:semicolon
r_if
c_cond
(paren
id|bval
op_eq
l_int|0
)paren
id|dwRate
op_assign
l_int|44100
suffix:semicolon
r_if
c_cond
(paren
id|bval
op_eq
l_int|1
)paren
id|dwRate
op_assign
l_int|48000
suffix:semicolon
r_if
c_cond
(paren
id|bval
op_eq
l_int|2
)paren
id|dwRate
op_assign
l_int|32000
suffix:semicolon
r_return
id|dwRate
suffix:semicolon
)brace
DECL|function|snd_ali_enable_spdif_in
r_static
r_void
id|snd_ali_enable_spdif_in
c_func
(paren
id|ali_t
op_star
id|codec
)paren
(brace
r_int
r_int
id|dwVal
suffix:semicolon
id|dwVal
op_assign
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GLOBAL_CONTROL
)paren
)paren
suffix:semicolon
id|dwVal
op_or_assign
l_int|1
op_lshift
l_int|11
suffix:semicolon
id|outl
c_func
(paren
id|dwVal
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GLOBAL_CONTROL
)paren
)paren
suffix:semicolon
id|dwVal
op_assign
id|inb
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CTRL
)paren
)paren
suffix:semicolon
id|dwVal
op_or_assign
l_int|0x02
suffix:semicolon
id|outb
c_func
(paren
id|dwVal
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CTRL
)paren
)paren
suffix:semicolon
id|snd_ali_enable_special_channel
c_func
(paren
id|codec
comma
id|ALI_SPDIF_IN_CHANNEL
)paren
suffix:semicolon
)brace
DECL|function|snd_ali_disable_spdif_in
r_static
r_void
id|snd_ali_disable_spdif_in
c_func
(paren
id|ali_t
op_star
id|codec
)paren
(brace
r_int
r_int
id|dwVal
suffix:semicolon
id|dwVal
op_assign
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GLOBAL_CONTROL
)paren
)paren
suffix:semicolon
id|dwVal
op_and_assign
op_complement
(paren
l_int|1
op_lshift
l_int|11
)paren
suffix:semicolon
id|outl
c_func
(paren
id|dwVal
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GLOBAL_CONTROL
)paren
)paren
suffix:semicolon
id|snd_ali_disable_special_channel
c_func
(paren
id|codec
comma
id|ALI_SPDIF_IN_CHANNEL
)paren
suffix:semicolon
)brace
DECL|function|snd_ali_set_spdif_out_rate
r_static
r_void
id|snd_ali_set_spdif_out_rate
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
r_int
id|rate
)paren
(brace
r_int
r_char
id|bVal
suffix:semicolon
r_int
r_int
id|dwRate
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rate
op_eq
l_int|32000
)paren
id|dwRate
op_assign
l_int|0x300
suffix:semicolon
r_if
c_cond
(paren
id|rate
op_eq
l_int|44100
)paren
id|dwRate
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rate
op_eq
l_int|48000
)paren
id|dwRate
op_assign
l_int|0x200
suffix:semicolon
id|bVal
op_assign
id|inb
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CTRL
)paren
)paren
suffix:semicolon
id|bVal
op_and_assign
(paren
r_int
r_char
)paren
(paren
op_complement
(paren
l_int|1
op_lshift
l_int|6
)paren
)paren
suffix:semicolon
id|bVal
op_or_assign
l_int|0x80
suffix:semicolon
singleline_comment|//select right
id|outb
c_func
(paren
id|bVal
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CTRL
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|dwRate
op_or
l_int|0x20
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CS
op_plus
l_int|2
)paren
)paren
suffix:semicolon
id|bVal
op_and_assign
(paren
op_complement
l_int|0x80
)paren
suffix:semicolon
singleline_comment|//select left
id|outb
c_func
(paren
id|bVal
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CTRL
)paren
)paren
suffix:semicolon
id|outw
c_func
(paren
id|rate
op_or
l_int|0x10
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CS
op_plus
l_int|2
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_ali_enable_spdif_out
r_static
r_void
id|snd_ali_enable_spdif_out
c_func
(paren
id|ali_t
op_star
id|codec
)paren
(brace
r_int
r_int
id|wVal
suffix:semicolon
r_int
r_char
id|bVal
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pci_dev
op_assign
l_int|NULL
suffix:semicolon
id|pci_dev
op_assign
id|codec-&gt;pci_m1533
suffix:semicolon
r_if
c_cond
(paren
id|pci_dev
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pci_dev
comma
l_int|0x61
comma
op_amp
id|bVal
)paren
suffix:semicolon
id|bVal
op_or_assign
l_int|0x40
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pci_dev
comma
l_int|0x61
comma
id|bVal
)paren
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pci_dev
comma
l_int|0x7d
comma
op_amp
id|bVal
)paren
suffix:semicolon
id|bVal
op_or_assign
l_int|0x01
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pci_dev
comma
l_int|0x7d
comma
id|bVal
)paren
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pci_dev
comma
l_int|0x7e
comma
op_amp
id|bVal
)paren
suffix:semicolon
id|bVal
op_and_assign
(paren
op_complement
l_int|0x20
)paren
suffix:semicolon
id|bVal
op_or_assign
l_int|0x10
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pci_dev
comma
l_int|0x7e
comma
id|bVal
)paren
suffix:semicolon
id|bVal
op_assign
id|inb
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SCTRL
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|bVal
op_or
l_int|0x20
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SCTRL
)paren
)paren
suffix:semicolon
id|bVal
op_assign
id|inb
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CTRL
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|bVal
op_amp
op_complement
(paren
l_int|1
op_lshift
l_int|6
)paren
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CTRL
)paren
)paren
suffix:semicolon
(brace
id|wVal
op_assign
id|inw
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GLOBAL_CONTROL
)paren
)paren
suffix:semicolon
id|wVal
op_or_assign
(paren
l_int|1
op_lshift
l_int|10
)paren
suffix:semicolon
id|outw
c_func
(paren
id|wVal
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GLOBAL_CONTROL
)paren
)paren
suffix:semicolon
id|snd_ali_disable_special_channel
c_func
(paren
id|codec
comma
id|ALI_SPDIF_OUT_CHANNEL
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_ali_enable_spdif_chnout
r_static
r_void
id|snd_ali_enable_spdif_chnout
c_func
(paren
id|ali_t
op_star
id|codec
)paren
(brace
r_int
r_int
id|wVal
op_assign
l_int|0
suffix:semicolon
id|wVal
op_assign
id|inw
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GLOBAL_CONTROL
)paren
)paren
suffix:semicolon
id|wVal
op_and_assign
op_complement
(paren
l_int|1
op_lshift
l_int|10
)paren
suffix:semicolon
id|outw
c_func
(paren
id|wVal
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GLOBAL_CONTROL
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;wVal = inw(ALI_REG(codec, ALI_SPDIF_CS));&n;&t;if (flag &amp; ALI_SPDIF_OUT_NON_PCM)&n;   &t;&t;wVal |= 0x0002;&n;&t;else&t;&n;&t;&t;wVal &amp;= (~0x0002);&n;   &t;outw(wVal, ALI_REG(codec, ALI_SPDIF_CS));&n;*/
id|snd_ali_enable_special_channel
c_func
(paren
id|codec
comma
id|ALI_SPDIF_OUT_CHANNEL
)paren
suffix:semicolon
)brace
DECL|function|snd_ali_disable_spdif_chnout
r_static
r_void
id|snd_ali_disable_spdif_chnout
c_func
(paren
id|ali_t
op_star
id|codec
)paren
(brace
r_int
r_int
id|wVal
op_assign
l_int|0
suffix:semicolon
id|wVal
op_assign
id|inw
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GLOBAL_CONTROL
)paren
)paren
suffix:semicolon
id|wVal
op_or_assign
(paren
l_int|1
op_lshift
l_int|10
)paren
suffix:semicolon
id|outw
c_func
(paren
id|wVal
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GLOBAL_CONTROL
)paren
)paren
suffix:semicolon
id|snd_ali_enable_special_channel
c_func
(paren
id|codec
comma
id|ALI_SPDIF_OUT_CHANNEL
)paren
suffix:semicolon
)brace
DECL|function|snd_ali_disable_spdif_out
r_static
r_void
id|snd_ali_disable_spdif_out
c_func
(paren
id|ali_t
op_star
id|codec
)paren
(brace
r_int
r_char
id|bVal
suffix:semicolon
id|bVal
op_assign
id|inb
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SCTRL
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|bVal
op_amp
(paren
op_complement
l_int|0x20
)paren
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SCTRL
)paren
)paren
suffix:semicolon
id|snd_ali_disable_spdif_chnout
c_func
(paren
id|codec
)paren
suffix:semicolon
)brace
DECL|function|snd_ali_update_ptr
r_static
r_void
id|snd_ali_update_ptr
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
id|channel
)paren
(brace
id|snd_ali_voice_t
op_star
id|pvoice
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
suffix:semicolon
id|snd_ali_channel_control_t
op_star
id|pchregs
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|old
comma
id|mask
suffix:semicolon
macro_line|#ifdef ALI_DEBUG
r_int
r_int
id|temp
comma
id|cspf
suffix:semicolon
macro_line|#endif
id|pchregs
op_assign
op_amp
(paren
id|codec-&gt;chregs
)paren
suffix:semicolon
singleline_comment|// check if interrupt occured for channel
id|old
op_assign
id|pchregs-&gt;data.aint
suffix:semicolon
id|mask
op_assign
(paren
(paren
r_int
r_int
)paren
l_int|1L
)paren
op_lshift
(paren
id|channel
op_amp
l_int|0x1f
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|old
op_amp
id|mask
)paren
)paren
r_return
suffix:semicolon
id|pvoice
op_assign
op_amp
id|codec-&gt;synth.voices
(braket
id|channel
)braket
suffix:semicolon
id|runtime
op_assign
id|pvoice-&gt;substream-&gt;runtime
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|codec-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pvoice-&gt;pcm
op_logical_and
id|pvoice-&gt;substream
)paren
(brace
multiline_comment|/* pcm interrupt */
macro_line|#ifdef ALI_DEBUG
id|outb
c_func
(paren
(paren
id|u8
)paren
(paren
id|pvoice-&gt;number
)paren
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GC_CIR
)paren
)paren
suffix:semicolon
id|temp
op_assign
id|inw
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_CSO_ALPHA_FMS
op_plus
l_int|2
)paren
)paren
suffix:semicolon
id|cspf
op_assign
(paren
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_CSPF
)paren
)paren
op_amp
id|mask
)paren
op_eq
id|mask
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|pvoice-&gt;running
)paren
(brace
id|snd_ali_printk
c_func
(paren
l_string|&quot;update_ptr: cso=%4.4x cspf=%d.&bslash;n&quot;
comma
(paren
id|u16
)paren
id|temp
comma
id|cspf
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|codec-&gt;reg_lock
)paren
suffix:semicolon
id|snd_pcm_period_elapsed
c_func
(paren
id|pvoice-&gt;substream
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|codec-&gt;reg_lock
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_ali_stop_voice
c_func
(paren
id|codec
comma
id|channel
)paren
suffix:semicolon
id|snd_ali_disable_voice_irq
c_func
(paren
id|codec
comma
id|channel
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|codec-&gt;synth.voices
(braket
id|channel
)braket
dot
id|synth
)paren
(brace
multiline_comment|/* synth interrupt */
)brace
r_else
r_if
c_cond
(paren
id|codec-&gt;synth.voices
(braket
id|channel
)braket
dot
id|midi
)paren
(brace
multiline_comment|/* midi interrupt */
)brace
r_else
(brace
multiline_comment|/* unknown interrupt */
id|snd_ali_stop_voice
c_func
(paren
id|codec
comma
id|channel
)paren
suffix:semicolon
id|snd_ali_disable_voice_irq
c_func
(paren
id|codec
comma
id|channel
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|codec-&gt;reg_lock
)paren
suffix:semicolon
id|outl
c_func
(paren
id|mask
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|pchregs-&gt;regs.aint
)paren
)paren
suffix:semicolon
id|pchregs-&gt;data.aint
op_assign
id|old
op_amp
(paren
op_complement
id|mask
)paren
suffix:semicolon
)brace
DECL|function|snd_ali_interrupt
r_static
r_void
id|snd_ali_interrupt
c_func
(paren
id|ali_t
op_star
id|codec
)paren
(brace
r_int
id|channel
suffix:semicolon
r_int
r_int
id|audio_int
suffix:semicolon
id|snd_ali_channel_control_t
op_star
id|pchregs
op_assign
l_int|NULL
suffix:semicolon
id|pchregs
op_assign
op_amp
(paren
id|codec-&gt;chregs
)paren
suffix:semicolon
id|audio_int
op_assign
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_MISCINT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|audio_int
op_amp
id|ADDRESS_IRQ
)paren
(brace
singleline_comment|// get interrupt status for all channels
id|pchregs-&gt;data.aint
op_assign
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|pchregs-&gt;regs.aint
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|channel
op_assign
l_int|0
suffix:semicolon
id|channel
OL
id|ALI_CHANNELS
suffix:semicolon
id|channel
op_increment
)paren
(brace
id|snd_ali_update_ptr
c_func
(paren
id|codec
comma
id|channel
)paren
suffix:semicolon
)brace
)brace
id|outl
c_func
(paren
(paren
id|TARGET_REACHED
op_or
id|MIXER_OVERFLOW
op_or
id|MIXER_UNDERFLOW
)paren
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_MISCINT
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_ali_card_interrupt
r_static
r_void
id|snd_ali_card_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|ali_t
op_star
id|codec
op_assign
id|snd_magic_cast
c_func
(paren
id|ali_t
comma
id|dev_id
comma
r_return
)paren
suffix:semicolon
r_if
c_cond
(paren
id|codec
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
id|snd_ali_interrupt
c_func
(paren
id|codec
)paren
suffix:semicolon
)brace
DECL|function|snd_ali_alloc_voice
r_static
id|snd_ali_voice_t
op_star
id|snd_ali_alloc_voice
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
id|type
comma
r_int
id|rec
)paren
(brace
id|snd_ali_voice_t
op_star
id|pvoice
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|idx
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;alloc_voice: type=%d rec=%d&bslash;n&quot;
comma
id|type
comma
id|rec
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|codec-&gt;voice_alloc
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|type
op_eq
id|SNDRV_ALI_VOICE_TYPE_PCM
)paren
(brace
id|idx
op_assign
id|snd_ali_find_free_channel
c_func
(paren
id|codec
comma
id|rec
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idx
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;ali_alloc_voice: err.&bslash;n&quot;
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|codec-&gt;voice_alloc
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|pvoice
op_assign
op_amp
(paren
id|codec-&gt;synth.voices
(braket
id|idx
)braket
)paren
suffix:semicolon
id|pvoice-&gt;use
op_assign
l_int|1
suffix:semicolon
id|pvoice-&gt;pcm
op_assign
l_int|1
suffix:semicolon
id|pvoice-&gt;mode
op_assign
id|rec
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|codec-&gt;voice_alloc
comma
id|flags
)paren
suffix:semicolon
r_return
id|pvoice
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|codec-&gt;voice_alloc
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|snd_ali_free_voice
r_static
r_void
id|snd_ali_free_voice
c_func
(paren
id|ali_t
op_star
id|codec
comma
id|snd_ali_voice_t
op_star
id|pvoice
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_void
(paren
op_star
id|private_free
)paren
(paren
r_void
op_star
)paren
suffix:semicolon
r_void
op_star
id|private_data
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;free_voice: channel=%d&bslash;n&quot;
comma
id|pvoice-&gt;number
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pvoice
op_eq
l_int|NULL
op_logical_or
op_logical_neg
id|pvoice-&gt;use
)paren
r_return
suffix:semicolon
id|snd_ali_clear_voices
c_func
(paren
id|codec
comma
id|pvoice-&gt;number
comma
id|pvoice-&gt;number
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|codec-&gt;voice_alloc
comma
id|flags
)paren
suffix:semicolon
id|private_free
op_assign
id|pvoice-&gt;private_free
suffix:semicolon
id|private_data
op_assign
id|pvoice-&gt;private_data
suffix:semicolon
id|pvoice-&gt;private_free
op_assign
l_int|NULL
suffix:semicolon
id|pvoice-&gt;private_data
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|pvoice-&gt;pcm
)paren
(brace
id|snd_ali_free_channel_pcm
c_func
(paren
id|codec
comma
id|pvoice-&gt;number
)paren
suffix:semicolon
)brace
id|pvoice-&gt;use
op_assign
id|pvoice-&gt;pcm
op_assign
id|pvoice-&gt;synth
op_assign
l_int|0
suffix:semicolon
id|pvoice-&gt;substream
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|codec-&gt;voice_alloc
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|private_free
)paren
id|private_free
c_func
(paren
id|private_data
)paren
suffix:semicolon
)brace
DECL|function|snd_ali_clear_voices
r_static
r_void
id|snd_ali_clear_voices
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
r_int
id|v_min
comma
r_int
r_int
id|v_max
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|v_min
suffix:semicolon
id|i
op_le
id|v_max
suffix:semicolon
id|i
op_increment
)paren
(brace
id|snd_ali_stop_voice
c_func
(paren
id|codec
comma
id|i
)paren
suffix:semicolon
id|snd_ali_disable_voice_irq
c_func
(paren
id|codec
comma
id|i
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_ali_write_voice_regs
r_static
r_void
id|snd_ali_write_voice_regs
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
r_int
id|Channel
comma
r_int
r_int
id|LBA
comma
r_int
r_int
id|CSO
comma
r_int
r_int
id|ESO
comma
r_int
r_int
id|DELTA
comma
r_int
r_int
id|ALPHA_FMS
comma
r_int
r_int
id|GVSEL
comma
r_int
r_int
id|PAN
comma
r_int
r_int
id|VOL
comma
r_int
r_int
id|CTRL
comma
r_int
r_int
id|EC
)paren
(brace
r_int
r_int
id|ctlcmds
(braket
l_int|4
)braket
suffix:semicolon
id|outb
c_func
(paren
(paren
r_int
r_char
)paren
(paren
id|Channel
op_amp
l_int|0x001f
)paren
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GC_CIR
)paren
)paren
suffix:semicolon
id|ctlcmds
(braket
l_int|0
)braket
op_assign
(paren
id|CSO
op_lshift
l_int|16
)paren
op_or
(paren
id|ALPHA_FMS
op_amp
l_int|0x0000ffff
)paren
suffix:semicolon
id|ctlcmds
(braket
l_int|1
)braket
op_assign
id|LBA
suffix:semicolon
id|ctlcmds
(braket
l_int|2
)braket
op_assign
(paren
id|ESO
op_lshift
l_int|16
)paren
op_or
(paren
id|DELTA
op_amp
l_int|0x0ffff
)paren
suffix:semicolon
id|ctlcmds
(braket
l_int|3
)braket
op_assign
(paren
id|GVSEL
op_lshift
l_int|31
)paren
op_or
(paren
(paren
id|PAN
op_amp
l_int|0x0000007f
)paren
op_lshift
l_int|24
)paren
op_or
(paren
(paren
id|VOL
op_amp
l_int|0x000000ff
)paren
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|CTRL
op_amp
l_int|0x0000000f
)paren
op_lshift
l_int|12
)paren
op_or
(paren
id|EC
op_amp
l_int|0x00000fff
)paren
suffix:semicolon
id|outb
c_func
(paren
id|Channel
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GC_CIR
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ctlcmds
(braket
l_int|0
)braket
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_CSO_ALPHA_FMS
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ctlcmds
(braket
l_int|1
)braket
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_LBA
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ctlcmds
(braket
l_int|2
)braket
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_ESO_DELTA
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ctlcmds
(braket
l_int|3
)braket
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GVSEL_PAN_VOC_CTRL_EC
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x30000000
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_EBUF1
)paren
)paren
suffix:semicolon
multiline_comment|/* Still Mode */
id|outl
c_func
(paren
l_int|0x30000000
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_EBUF2
)paren
)paren
suffix:semicolon
multiline_comment|/* Still Mode */
)brace
DECL|function|snd_ali_convert_rate
r_static
r_int
r_int
id|snd_ali_convert_rate
c_func
(paren
r_int
r_int
id|rate
comma
r_int
id|rec
)paren
(brace
r_int
r_int
id|delta
suffix:semicolon
r_if
c_cond
(paren
id|rate
OL
l_int|4000
)paren
id|rate
op_assign
l_int|4000
suffix:semicolon
r_if
c_cond
(paren
id|rate
OG
l_int|48000
)paren
id|rate
op_assign
l_int|48000
suffix:semicolon
r_if
c_cond
(paren
id|rec
)paren
(brace
r_if
c_cond
(paren
id|rate
op_eq
l_int|44100
)paren
id|delta
op_assign
l_int|0x116a
suffix:semicolon
r_else
r_if
c_cond
(paren
id|rate
op_eq
l_int|8000
)paren
id|delta
op_assign
l_int|0x6000
suffix:semicolon
r_else
r_if
c_cond
(paren
id|rate
op_eq
l_int|48000
)paren
id|delta
op_assign
l_int|0x1000
suffix:semicolon
r_else
id|delta
op_assign
(paren
(paren
l_int|48000
op_lshift
l_int|12
)paren
op_div
id|rate
)paren
op_amp
l_int|0x0000ffff
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|rate
op_eq
l_int|44100
)paren
id|delta
op_assign
l_int|0xeb3
suffix:semicolon
r_else
r_if
c_cond
(paren
id|rate
op_eq
l_int|8000
)paren
id|delta
op_assign
l_int|0x2ab
suffix:semicolon
r_else
r_if
c_cond
(paren
id|rate
op_eq
l_int|48000
)paren
id|delta
op_assign
l_int|0x1000
suffix:semicolon
r_else
id|delta
op_assign
(paren
(paren
(paren
id|rate
op_lshift
l_int|12
)paren
op_plus
id|rate
)paren
op_div
l_int|48000
)paren
op_amp
l_int|0x0000ffff
suffix:semicolon
)brace
r_return
id|delta
suffix:semicolon
)brace
DECL|function|snd_ali_control_mode
r_static
r_int
r_int
id|snd_ali_control_mode
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|CTRL
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
multiline_comment|/* set ctrl mode&n;&t;   CTRL default: 8-bit (unsigned) mono, loop mode enabled&n;&t; */
id|CTRL
op_assign
l_int|0x00000001
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|16
)paren
id|CTRL
op_or_assign
l_int|0x00000008
suffix:semicolon
singleline_comment|// 16-bit data
r_if
c_cond
(paren
op_logical_neg
id|snd_pcm_format_unsigned
c_func
(paren
id|runtime-&gt;format
)paren
)paren
id|CTRL
op_or_assign
l_int|0x00000002
suffix:semicolon
singleline_comment|// signed data
r_if
c_cond
(paren
id|runtime-&gt;channels
OG
l_int|1
)paren
id|CTRL
op_or_assign
l_int|0x00000004
suffix:semicolon
singleline_comment|// stereo data
r_return
id|CTRL
suffix:semicolon
)brace
multiline_comment|/*&n; *  PCM part&n; */
DECL|function|snd_ali_ioctl
r_static
r_int
id|snd_ali_ioctl
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
r_return
id|snd_pcm_lib_ioctl
c_func
(paren
id|substream
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|function|snd_ali_trigger
r_static
r_int
id|snd_ali_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|ali_t
op_star
id|codec
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_substream_t
op_star
id|s
suffix:semicolon
r_int
r_int
id|what
comma
id|whati
comma
id|capture_flag
suffix:semicolon
id|snd_ali_voice_t
op_star
id|pvoice
op_assign
l_int|NULL
comma
op_star
id|evoice
op_assign
l_int|NULL
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
(brace
id|what
op_assign
id|whati
op_assign
id|capture_flag
op_assign
l_int|0
suffix:semicolon
id|s
op_assign
id|substream
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|ali_t
op_star
)paren
id|_snd_pcm_chip
c_func
(paren
id|s-&gt;pcm
)paren
op_eq
id|codec
)paren
(brace
id|pvoice
op_assign
(paren
id|snd_ali_voice_t
op_star
)paren
id|s-&gt;runtime-&gt;private_data
suffix:semicolon
id|evoice
op_assign
id|pvoice-&gt;extra
suffix:semicolon
id|what
op_or_assign
l_int|1
op_lshift
(paren
id|pvoice-&gt;number
op_amp
l_int|0x1f
)paren
suffix:semicolon
r_if
c_cond
(paren
id|evoice
op_eq
l_int|NULL
)paren
(brace
id|whati
op_or_assign
l_int|1
op_lshift
(paren
id|pvoice-&gt;number
op_amp
l_int|0x1f
)paren
suffix:semicolon
)brace
r_else
(brace
id|whati
op_or_assign
l_int|1
op_lshift
(paren
id|evoice-&gt;number
op_amp
l_int|0x1f
)paren
suffix:semicolon
id|what
op_or_assign
l_int|1
op_lshift
(paren
id|evoice-&gt;number
op_amp
l_int|0x1f
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_START
)paren
(brace
id|pvoice-&gt;running
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|evoice
op_ne
l_int|NULL
)paren
id|evoice-&gt;running
op_assign
l_int|1
suffix:semicolon
)brace
id|snd_pcm_trigger_done
c_func
(paren
id|s
comma
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pvoice-&gt;mode
)paren
id|capture_flag
op_assign
l_int|1
suffix:semicolon
)brace
id|s
op_assign
id|s-&gt;link_next
suffix:semicolon
)brace
r_while
c_loop
(paren
id|s
op_ne
id|substream
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|codec-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_STOP
)paren
(brace
id|outl
c_func
(paren
id|what
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_STOP
)paren
)paren
suffix:semicolon
id|pvoice-&gt;running
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|evoice
op_ne
l_int|NULL
)paren
id|evoice-&gt;running
op_assign
l_int|0
suffix:semicolon
)brace
id|val
op_assign
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_AINTEN
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_START
)paren
(brace
id|val
op_or_assign
id|whati
suffix:semicolon
)brace
r_else
(brace
id|val
op_and_assign
op_complement
id|whati
suffix:semicolon
)brace
id|outl
c_func
(paren
id|val
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_AINTEN
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_START
)paren
(brace
id|outl
c_func
(paren
id|what
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_START
)paren
)paren
suffix:semicolon
)brace
id|snd_ali_printk
c_func
(paren
l_string|&quot;trigger: what=%xh whati=%xh&bslash;n&quot;
comma
id|what
comma
id|whati
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|codec-&gt;reg_lock
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ali_playback_hw_params
r_static
r_int
id|snd_ali_playback_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
id|ali_t
op_star
id|codec
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_ali_voice_t
op_star
id|pvoice
op_assign
(paren
id|snd_ali_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
id|snd_ali_voice_t
op_star
id|evoice
op_assign
id|pvoice-&gt;extra
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* voice management */
r_if
c_cond
(paren
id|params_buffer_size
c_func
(paren
id|hw_params
)paren
op_div
l_int|2
op_ne
id|params_period_size
c_func
(paren
id|hw_params
)paren
)paren
(brace
r_if
c_cond
(paren
id|evoice
op_eq
l_int|NULL
)paren
(brace
id|evoice
op_assign
id|snd_ali_alloc_voice
c_func
(paren
id|codec
comma
id|SNDRV_ALI_VOICE_TYPE_PCM
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|evoice
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|pvoice-&gt;extra
op_assign
id|evoice
suffix:semicolon
id|evoice-&gt;substream
op_assign
id|substream
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|evoice
op_ne
l_int|NULL
)paren
(brace
id|snd_ali_free_voice
c_func
(paren
id|codec
comma
id|evoice
)paren
suffix:semicolon
id|pvoice-&gt;extra
op_assign
id|evoice
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ali_playback_hw_free
r_static
r_int
id|snd_ali_playback_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ali_t
op_star
id|codec
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_ali_voice_t
op_star
id|pvoice
op_assign
(paren
id|snd_ali_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
id|snd_ali_voice_t
op_star
id|evoice
op_assign
id|pvoice
ques
c_cond
id|pvoice-&gt;extra
suffix:colon
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|evoice
op_ne
l_int|NULL
)paren
(brace
id|snd_ali_free_voice
c_func
(paren
id|codec
comma
id|evoice
)paren
suffix:semicolon
id|pvoice-&gt;extra
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ali_capture_hw_params
r_static
r_int
id|snd_ali_capture_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
r_return
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_ali_capture_hw_free
r_static
r_int
id|snd_ali_capture_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
DECL|function|snd_ali_playback_prepare
r_static
r_int
id|snd_ali_playback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ali_t
op_star
id|codec
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_ali_voice_t
op_star
id|pvoice
op_assign
(paren
id|snd_ali_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
id|snd_ali_voice_t
op_star
id|evoice
op_assign
id|pvoice-&gt;extra
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|LBA
suffix:semicolon
r_int
r_int
id|Delta
suffix:semicolon
r_int
r_int
id|ESO
suffix:semicolon
r_int
r_int
id|CTRL
suffix:semicolon
r_int
r_int
id|GVSEL
suffix:semicolon
r_int
r_int
id|PAN
suffix:semicolon
r_int
r_int
id|VOL
suffix:semicolon
r_int
r_int
id|EC
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;playback_prepare ...&bslash;n&quot;
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* set Delta (rate) value */
id|Delta
op_assign
id|snd_ali_convert_rate
c_func
(paren
id|runtime-&gt;rate
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pvoice-&gt;number
op_eq
id|ALI_SPDIF_IN_CHANNEL
)paren
op_logical_or
(paren
id|pvoice-&gt;number
op_eq
id|ALI_PCM_IN_CHANNEL
)paren
)paren
id|snd_ali_disable_special_channel
c_func
(paren
id|codec
comma
id|pvoice-&gt;number
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GLOBAL_CONTROL
)paren
)paren
op_amp
(paren
l_int|1
op_lshift
l_int|15
)paren
)paren
op_logical_and
(paren
id|pvoice-&gt;number
op_eq
id|ALI_SPDIF_OUT_CHANNEL
)paren
)paren
(brace
r_if
c_cond
(paren
id|codec-&gt;revision
op_eq
id|ALI_5451_V02
)paren
(brace
id|snd_ali_set_spdif_out_rate
c_func
(paren
id|codec
comma
id|runtime-&gt;rate
)paren
suffix:semicolon
id|Delta
op_assign
l_int|0x1000
suffix:semicolon
)brace
)brace
multiline_comment|/* set Loop Back Address */
id|LBA
op_assign
id|runtime-&gt;dma_addr
suffix:semicolon
multiline_comment|/* set interrupt count size */
id|pvoice-&gt;count
op_assign
id|runtime-&gt;period_size
suffix:semicolon
multiline_comment|/* set target ESO for channel */
id|pvoice-&gt;eso
op_assign
id|runtime-&gt;buffer_size
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;playback_prepare: eso=%xh count=%xh&bslash;n&quot;
comma
id|pvoice-&gt;eso
comma
id|pvoice-&gt;count
)paren
suffix:semicolon
multiline_comment|/* set ESO to capture first MIDLP interrupt */
id|ESO
op_assign
id|pvoice-&gt;eso
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* set ctrl mode */
id|CTRL
op_assign
id|snd_ali_control_mode
c_func
(paren
id|substream
)paren
suffix:semicolon
id|GVSEL
op_assign
l_int|1
suffix:semicolon
id|PAN
op_assign
l_int|0
suffix:semicolon
id|VOL
op_assign
l_int|0
suffix:semicolon
id|EC
op_assign
l_int|0
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;playback_prepare:&bslash;n    ch=%d, Rate=%d Delta=%xh,GVSEL=%xh,PAN=%xh,CTRL=%xh&bslash;n&quot;
comma
id|pvoice-&gt;number
comma
id|runtime-&gt;rate
comma
id|Delta
comma
id|GVSEL
comma
id|PAN
comma
id|CTRL
)paren
suffix:semicolon
id|snd_ali_write_voice_regs
c_func
(paren
id|codec
comma
id|pvoice-&gt;number
comma
id|LBA
comma
l_int|0
comma
multiline_comment|/* cso */
id|ESO
comma
id|Delta
comma
l_int|0
comma
multiline_comment|/* alpha */
id|GVSEL
comma
id|PAN
comma
id|VOL
comma
id|CTRL
comma
id|EC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|evoice
op_ne
l_int|NULL
)paren
(brace
id|evoice-&gt;count
op_assign
id|pvoice-&gt;count
suffix:semicolon
id|evoice-&gt;eso
op_assign
id|pvoice-&gt;count
op_lshift
l_int|1
suffix:semicolon
id|ESO
op_assign
id|evoice-&gt;eso
op_minus
l_int|1
suffix:semicolon
id|snd_ali_write_voice_regs
c_func
(paren
id|codec
comma
id|evoice-&gt;number
comma
id|LBA
comma
l_int|0
comma
multiline_comment|/* cso */
id|ESO
comma
id|Delta
comma
l_int|0
comma
multiline_comment|/* alpha */
id|GVSEL
comma
(paren
r_int
r_int
)paren
l_int|0x7f
comma
(paren
r_int
r_int
)paren
l_int|0x3ff
comma
id|CTRL
comma
id|EC
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ali_capture_prepare
r_static
r_int
id|snd_ali_capture_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ali_t
op_star
id|codec
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_ali_voice_t
op_star
id|pvoice
op_assign
(paren
id|snd_ali_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|LBA
suffix:semicolon
r_int
r_int
id|Delta
suffix:semicolon
r_int
r_int
id|ESO
suffix:semicolon
r_int
r_int
id|CTRL
suffix:semicolon
r_int
r_int
id|GVSEL
suffix:semicolon
r_int
r_int
id|PAN
suffix:semicolon
r_int
r_int
id|VOL
suffix:semicolon
r_int
r_int
id|EC
suffix:semicolon
id|u8
id|bValue
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;capture_prepare...&bslash;n&quot;
)paren
suffix:semicolon
id|snd_ali_enable_special_channel
c_func
(paren
id|codec
comma
id|pvoice-&gt;number
)paren
suffix:semicolon
id|Delta
op_assign
id|snd_ali_convert_rate
c_func
(paren
id|runtime-&gt;rate
comma
l_int|1
)paren
suffix:semicolon
singleline_comment|// Prepare capture intr channel
r_if
c_cond
(paren
id|pvoice-&gt;number
op_eq
id|ALI_SPDIF_IN_CHANNEL
)paren
(brace
r_int
r_int
id|rate
suffix:semicolon
r_if
c_cond
(paren
id|codec-&gt;revision
op_ne
id|ALI_5451_V02
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|rate
op_assign
id|snd_ali_get_spdif_in_rate
c_func
(paren
id|codec
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rate
op_eq
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;ali_capture_preapre: spdif rate detect err!&bslash;n&quot;
)paren
suffix:semicolon
id|rate
op_assign
l_int|48000
suffix:semicolon
)brace
id|bValue
op_assign
id|inb
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CTRL
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bValue
op_amp
l_int|0x10
)paren
(brace
id|outb
c_func
(paren
id|bValue
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_SPDIF_CTRL
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;clear SPDIF parity error flag.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rate
op_ne
l_int|48000
)paren
id|Delta
op_assign
(paren
(paren
id|rate
op_lshift
l_int|12
)paren
op_div
id|runtime-&gt;rate
)paren
op_amp
l_int|0x00ffff
suffix:semicolon
)brace
singleline_comment|// set target ESO for channel 
id|pvoice-&gt;eso
op_assign
id|runtime-&gt;buffer_size
suffix:semicolon
singleline_comment|// set interrupt count size 
id|pvoice-&gt;count
op_assign
id|runtime-&gt;period_size
suffix:semicolon
singleline_comment|// set Loop Back Address 
id|LBA
op_assign
id|runtime-&gt;dma_addr
suffix:semicolon
singleline_comment|// set ESO to capture first MIDLP interrupt 
id|ESO
op_assign
id|pvoice-&gt;eso
op_minus
l_int|1
suffix:semicolon
id|CTRL
op_assign
id|snd_ali_control_mode
c_func
(paren
id|substream
)paren
suffix:semicolon
id|GVSEL
op_assign
l_int|0
suffix:semicolon
id|PAN
op_assign
l_int|0x00
suffix:semicolon
id|VOL
op_assign
l_int|0x00
suffix:semicolon
id|EC
op_assign
l_int|0
suffix:semicolon
id|snd_ali_write_voice_regs
c_func
(paren
id|codec
comma
id|pvoice-&gt;number
comma
id|LBA
comma
l_int|0
comma
multiline_comment|/* cso */
id|ESO
comma
id|Delta
comma
l_int|0
comma
multiline_comment|/* alpha */
id|GVSEL
comma
id|PAN
comma
id|VOL
comma
id|CTRL
comma
id|EC
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ali_playback_pointer
r_static
id|snd_pcm_uframes_t
id|snd_ali_playback_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ali_t
op_star
id|codec
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_ali_voice_t
op_star
id|pvoice
op_assign
(paren
id|snd_ali_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
r_int
r_int
id|cso
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pvoice-&gt;running
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|outb
c_func
(paren
id|pvoice-&gt;number
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GC_CIR
)paren
)paren
suffix:semicolon
id|cso
op_assign
id|inw
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_CSO_ALPHA_FMS
op_plus
l_int|2
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;playback pointer returned cso=%xh.&bslash;n&quot;
comma
id|cso
)paren
suffix:semicolon
r_return
id|cso
suffix:semicolon
)brace
DECL|function|snd_ali_capture_pointer
r_static
id|snd_pcm_uframes_t
id|snd_ali_capture_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ali_t
op_star
id|codec
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_ali_voice_t
op_star
id|pvoice
op_assign
(paren
id|snd_ali_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
r_int
r_int
id|cso
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pvoice-&gt;running
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|outb
c_func
(paren
id|pvoice-&gt;number
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GC_CIR
)paren
)paren
suffix:semicolon
id|cso
op_assign
id|inw
c_func
(paren
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_CSO_ALPHA_FMS
op_plus
l_int|2
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|cso
suffix:semicolon
)brace
DECL|variable|snd_ali_playback
r_static
id|snd_pcm_hardware_t
id|snd_ali_playback
op_assign
(brace
id|info
suffix:colon
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_SYNC_START
)paren
comma
id|formats
suffix:colon
(paren
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
op_or
id|SNDRV_PCM_FMTBIT_S8
op_or
id|SNDRV_PCM_FMTBIT_U16_LE
)paren
comma
id|rates
suffix:colon
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
id|rate_min
suffix:colon
l_int|4000
comma
id|rate_max
suffix:colon
l_int|48000
comma
id|channels_min
suffix:colon
l_int|1
comma
id|channels_max
suffix:colon
l_int|2
comma
id|buffer_bytes_max
suffix:colon
(paren
l_int|256
op_star
l_int|1024
)paren
comma
id|period_bytes_min
suffix:colon
l_int|64
comma
id|period_bytes_max
suffix:colon
(paren
l_int|256
op_star
l_int|1024
)paren
comma
id|periods_min
suffix:colon
l_int|1
comma
id|periods_max
suffix:colon
l_int|1024
comma
id|fifo_size
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/*&n; *  Capture support device description&n; */
DECL|variable|snd_ali_capture
r_static
id|snd_pcm_hardware_t
id|snd_ali_capture
op_assign
(brace
id|info
suffix:colon
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_SYNC_START
)paren
comma
id|formats
suffix:colon
(paren
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
op_or
id|SNDRV_PCM_FMTBIT_S8
op_or
id|SNDRV_PCM_FMTBIT_U16_LE
)paren
comma
id|rates
suffix:colon
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
id|rate_min
suffix:colon
l_int|4000
comma
id|rate_max
suffix:colon
l_int|48000
comma
id|channels_min
suffix:colon
l_int|1
comma
id|channels_max
suffix:colon
l_int|2
comma
id|buffer_bytes_max
suffix:colon
(paren
l_int|128
op_star
l_int|1024
)paren
comma
id|period_bytes_min
suffix:colon
l_int|64
comma
id|period_bytes_max
suffix:colon
(paren
l_int|128
op_star
l_int|1024
)paren
comma
id|periods_min
suffix:colon
l_int|1
comma
id|periods_max
suffix:colon
l_int|1024
comma
id|fifo_size
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
DECL|function|snd_ali_pcm_free_substream
r_static
r_void
id|snd_ali_pcm_free_substream
c_func
(paren
id|snd_pcm_runtime_t
op_star
id|runtime
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|snd_ali_voice_t
op_star
id|pvoice
op_assign
(paren
id|snd_ali_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
id|ali_t
op_star
id|codec
suffix:semicolon
r_if
c_cond
(paren
id|pvoice
)paren
(brace
id|codec
op_assign
id|pvoice-&gt;codec
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_ali_free_voice
c_func
(paren
id|pvoice-&gt;codec
comma
id|pvoice
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_ali_playback_open
r_static
r_int
id|snd_ali_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ali_t
op_star
id|codec
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_ali_voice_t
op_star
id|pvoice
suffix:semicolon
r_int
r_int
id|flags
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|pvoice
op_assign
id|snd_ali_alloc_voice
c_func
(paren
id|codec
comma
id|SNDRV_ALI_VOICE_TYPE_PCM
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pvoice
op_eq
l_int|NULL
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|pvoice-&gt;codec
op_assign
id|codec
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|pvoice-&gt;substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;private_data
op_assign
id|pvoice
suffix:semicolon
id|runtime-&gt;private_free
op_assign
id|snd_ali_pcm_free_substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_ali_playback
suffix:semicolon
id|snd_pcm_set_sync
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_hw_constraint_minmax
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_BUFFER_SIZE
comma
l_int|0
comma
l_int|64
op_star
l_int|1024
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ali_capture_open
r_static
r_int
id|snd_ali_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ali_t
op_star
id|codec
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_ali_voice_t
op_star
id|pvoice
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|pvoice
op_assign
id|snd_ali_alloc_voice
c_func
(paren
id|codec
comma
id|SNDRV_ALI_VOICE_TYPE_PCM
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pvoice
op_eq
l_int|NULL
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
id|pvoice-&gt;codec
op_assign
id|codec
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|pvoice-&gt;substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;private_data
op_assign
id|pvoice
suffix:semicolon
id|runtime-&gt;private_free
op_assign
id|snd_ali_pcm_free_substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_ali_capture
suffix:semicolon
id|snd_pcm_set_sync
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_hw_constraint_minmax
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_BUFFER_SIZE
comma
l_int|0
comma
l_int|64
op_star
l_int|1024
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ali_playback_close
r_static
r_int
id|snd_ali_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ali_capture_close
r_static
r_int
id|snd_ali_capture_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ali_t
op_star
id|codec
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_ali_voice_t
op_star
id|pvoice
op_assign
(paren
id|snd_ali_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
id|snd_ali_disable_special_channel
c_func
(paren
id|codec
comma
id|pvoice-&gt;number
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_ali_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_ali_playback_ops
op_assign
(brace
id|open
suffix:colon
id|snd_ali_playback_open
comma
id|close
suffix:colon
id|snd_ali_playback_close
comma
id|ioctl
suffix:colon
id|snd_ali_ioctl
comma
id|hw_params
suffix:colon
id|snd_ali_playback_hw_params
comma
id|hw_free
suffix:colon
id|snd_ali_playback_hw_free
comma
id|prepare
suffix:colon
id|snd_ali_playback_prepare
comma
id|trigger
suffix:colon
id|snd_ali_trigger
comma
id|pointer
suffix:colon
id|snd_ali_playback_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_ali_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_ali_capture_ops
op_assign
(brace
id|open
suffix:colon
id|snd_ali_capture_open
comma
id|close
suffix:colon
id|snd_ali_capture_close
comma
id|ioctl
suffix:colon
id|snd_ali_ioctl
comma
id|hw_params
suffix:colon
id|snd_ali_capture_hw_params
comma
id|hw_free
suffix:colon
id|snd_ali_capture_hw_free
comma
id|prepare
suffix:colon
id|snd_ali_capture_prepare
comma
id|trigger
suffix:colon
id|snd_ali_trigger
comma
id|pointer
suffix:colon
id|snd_ali_capture_pointer
comma
)brace
suffix:semicolon
DECL|function|snd_ali_pcm_free
r_static
r_void
id|snd_ali_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|ali_t
op_star
id|codec
op_assign
id|snd_magic_cast
c_func
(paren
id|ali_t
comma
id|pcm-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|codec-&gt;pcm
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|snd_ali_pcm
r_static
r_int
id|__devinit
id|snd_ali_pcm
c_func
(paren
id|ali_t
op_star
id|codec
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|codec-&gt;card
comma
l_string|&quot;ALI 5451&quot;
comma
id|device
comma
id|ALI_CHANNELS
comma
l_int|1
comma
op_amp
id|pcm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;snd_ali_pcm: err called snd_pcm_new.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|pcm-&gt;private_data
op_assign
id|codec
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_ali_pcm_free
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_ali_playback_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_ali_capture_ops
)paren
suffix:semicolon
id|snd_pcm_lib_preallocate_pci_pages_for_all
c_func
(paren
id|codec-&gt;pci
comma
id|pcm
comma
l_int|64
op_star
l_int|1024
comma
l_int|128
op_star
l_int|1024
)paren
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|pcm-&gt;dev_subclass
op_assign
id|SNDRV_PCM_SUBCLASS_GENERIC_MIX
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;ALI 5451&quot;
)paren
suffix:semicolon
id|codec-&gt;pcm
op_assign
id|pcm
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|ALI5451_SPDIF
mdefine_line|#define ALI5451_SPDIF(xname, xindex, value) &bslash;&n;{ iface: SNDRV_CTL_ELEM_IFACE_MIXER, name: xname, index: xindex,&bslash;&n;info: snd_ali5451_spdif_info, get: snd_ali5451_spdif_get, &bslash;&n;put: snd_ali5451_spdif_put, private_value: value}
DECL|function|snd_ali5451_spdif_info
r_static
r_int
id|snd_ali5451_spdif_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ali5451_spdif_get
r_static
r_int
id|snd_ali5451_spdif_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|ali_t
op_star
id|codec
op_assign
id|snd_magic_cast
c_func
(paren
id|ali_t
comma
id|kcontrol-&gt;private_data
comma
op_minus
id|ENXIO
)paren
suffix:semicolon
r_int
r_int
id|enable
suffix:semicolon
id|enable
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|kcontrol-&gt;private_value
)paren
(brace
r_case
l_int|0
suffix:colon
id|enable
op_assign
(paren
id|codec-&gt;spdif_mask
op_amp
l_int|0x02
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|enable
op_assign
(paren
(paren
id|codec-&gt;spdif_mask
op_amp
l_int|0x02
)paren
op_logical_and
(paren
id|codec-&gt;spdif_mask
op_amp
l_int|0x04
)paren
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|enable
op_assign
(paren
id|codec-&gt;spdif_mask
op_amp
l_int|0x01
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|enable
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ali5451_spdif_put
r_static
r_int
id|snd_ali5451_spdif_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|ali_t
op_star
id|codec
op_assign
id|snd_magic_cast
c_func
(paren
id|ali_t
comma
id|kcontrol-&gt;private_data
comma
op_minus
id|ENXIO
)paren
suffix:semicolon
r_int
r_int
id|change
op_assign
l_int|0
comma
id|enable
op_assign
l_int|0
suffix:semicolon
id|enable
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|kcontrol-&gt;private_value
)paren
(brace
r_case
l_int|0
suffix:colon
id|change
op_assign
(paren
id|codec-&gt;spdif_mask
op_amp
l_int|0x02
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|change
op_assign
id|change
op_xor
id|enable
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
(brace
r_if
c_cond
(paren
id|enable
)paren
(brace
id|codec-&gt;spdif_mask
op_or_assign
l_int|0x02
suffix:semicolon
id|snd_ali_enable_spdif_out
c_func
(paren
id|codec
)paren
suffix:semicolon
)brace
r_else
(brace
id|codec-&gt;spdif_mask
op_and_assign
op_complement
(paren
l_int|0x02
)paren
suffix:semicolon
id|codec-&gt;spdif_mask
op_and_assign
op_complement
(paren
l_int|0x04
)paren
suffix:semicolon
id|snd_ali_disable_spdif_out
c_func
(paren
id|codec
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|change
op_assign
(paren
id|codec-&gt;spdif_mask
op_amp
l_int|0x04
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|change
op_assign
id|change
op_xor
id|enable
suffix:semicolon
r_if
c_cond
(paren
id|change
op_logical_and
(paren
id|codec-&gt;spdif_mask
op_amp
l_int|0x02
)paren
)paren
(brace
r_if
c_cond
(paren
id|enable
)paren
(brace
id|codec-&gt;spdif_mask
op_or_assign
l_int|0x04
suffix:semicolon
id|snd_ali_enable_spdif_chnout
c_func
(paren
id|codec
)paren
suffix:semicolon
)brace
r_else
(brace
id|codec-&gt;spdif_mask
op_and_assign
op_complement
(paren
l_int|0x04
)paren
suffix:semicolon
id|snd_ali_disable_spdif_chnout
c_func
(paren
id|codec
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|change
op_assign
(paren
id|codec-&gt;spdif_mask
op_amp
l_int|0x01
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|change
op_assign
id|change
op_xor
id|enable
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
(brace
r_if
c_cond
(paren
id|enable
)paren
(brace
id|codec-&gt;spdif_mask
op_or_assign
l_int|0x01
suffix:semicolon
id|snd_ali_enable_spdif_in
c_func
(paren
id|codec
)paren
suffix:semicolon
)brace
r_else
(brace
id|codec-&gt;spdif_mask
op_and_assign
op_complement
(paren
l_int|0x01
)paren
suffix:semicolon
id|snd_ali_disable_spdif_in
c_func
(paren
id|codec
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|codec-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|__devinit
r_static
id|snd_kcontrol_new_t
id|snd_ali5451_mixer_spdif
(braket
)braket
id|__devinit
op_assign
(brace
multiline_comment|/* spdif aplayback switch */
id|ALI5451_SPDIF
c_func
(paren
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|PLAYBACK
comma
id|SWITCH
)paren
comma
l_int|0
comma
l_int|0
)paren
comma
multiline_comment|/* spdif out to spdif channel */
id|ALI5451_SPDIF
c_func
(paren
l_string|&quot;IEC958 Channel Output Switch&quot;
comma
l_int|0
comma
l_int|1
)paren
comma
multiline_comment|/* spdif in from spdif channel */
id|ALI5451_SPDIF
c_func
(paren
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|CAPTURE
comma
id|SWITCH
)paren
comma
l_int|0
comma
l_int|2
)paren
)brace
suffix:semicolon
DECL|function|snd_ali_mixer_free_ac97
r_static
r_void
id|snd_ali_mixer_free_ac97
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
id|ali_t
op_star
id|codec
op_assign
id|snd_magic_cast
c_func
(paren
id|ali_t
comma
id|ac97-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|codec-&gt;ac97
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|snd_ali_mixer
r_static
r_int
id|__devinit
id|snd_ali_mixer
c_func
(paren
id|ali_t
op_star
id|codec
)paren
(brace
id|ac97_t
id|ac97
suffix:semicolon
r_int
id|err
comma
id|idx
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ac97
comma
l_int|0
comma
r_sizeof
(paren
id|ac97
)paren
)paren
suffix:semicolon
id|ac97.write
op_assign
id|snd_ali_codec_write
suffix:semicolon
id|ac97.read
op_assign
id|snd_ali_codec_read
suffix:semicolon
id|ac97.private_data
op_assign
id|codec
suffix:semicolon
id|ac97.private_free
op_assign
id|snd_ali_mixer_free_ac97
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_mixer
c_func
(paren
id|codec-&gt;card
comma
op_amp
id|ac97
comma
op_amp
id|codec-&gt;ac97
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;ali mixer creating error.&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|codec-&gt;revision
op_eq
id|ALI_5451_V02
)paren
(brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|3
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|codec-&gt;card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_ali5451_mixer_spdif
(braket
id|idx
)braket
comma
id|codec
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PM
macro_line|#ifndef PCI_OLD_SUSPEND
DECL|function|snd_ali_suspend
r_static
r_int
id|snd_ali_suspend
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
id|u32
id|state
)paren
macro_line|#else
r_static
r_void
id|snd_ali_suspend
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
macro_line|#endif
(brace
macro_line|#ifndef PCI_OLD_SUSPEND
id|ali_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|ali_t
comma
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
macro_line|#else
id|ali_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|ali_t
comma
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
comma
r_return
)paren
suffix:semicolon
macro_line|#endif
id|ali_image_t
op_star
id|im
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|im
op_assign
id|chip-&gt;image
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|im
)paren
macro_line|#ifndef PCI_OLD_SUSPEND
r_return
op_minus
id|ENXIO
suffix:semicolon
macro_line|#else
r_return
suffix:semicolon
macro_line|#endif
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|im-&gt;regs
(braket
id|ALI_MISCINT
op_rshift
l_int|2
)braket
op_assign
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|chip
comma
id|ALI_MISCINT
)paren
)paren
suffix:semicolon
singleline_comment|// im-&gt;regs[ALI_START &gt;&gt; 2] = inl(ALI_REG(chip, ALI_START));
id|im-&gt;regs
(braket
id|ALI_STOP
op_rshift
l_int|2
)braket
op_assign
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|chip
comma
id|ALI_STOP
)paren
)paren
suffix:semicolon
singleline_comment|// disable all IRQ bits
id|outl
c_func
(paren
l_int|0
comma
id|ALI_REG
c_func
(paren
id|chip
comma
id|ALI_MISCINT
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ALI_GLOBAL_REGS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|i
op_star
l_int|4
op_eq
id|ALI_MISCINT
)paren
op_logical_or
(paren
id|i
op_star
l_int|4
op_eq
id|ALI_STOP
)paren
)paren
r_continue
suffix:semicolon
id|im-&gt;regs
(braket
id|i
)braket
op_assign
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|chip
comma
id|i
op_star
l_int|4
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ALI_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outb
c_func
(paren
id|i
comma
id|ALI_REG
c_func
(paren
id|chip
comma
id|ALI_GC_CIR
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|ALI_CHANNEL_REGS
suffix:semicolon
id|j
op_increment
)paren
id|im-&gt;channel_regs
(braket
id|i
)braket
(braket
id|j
)braket
op_assign
id|inl
c_func
(paren
id|ALI_REG
c_func
(paren
id|chip
comma
id|j
op_star
l_int|4
op_plus
l_int|0xe0
)paren
)paren
suffix:semicolon
)brace
singleline_comment|// stop all HW channel
id|outl
c_func
(paren
l_int|0xffffffff
comma
id|ALI_REG
c_func
(paren
id|chip
comma
id|ALI_STOP
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#ifndef PCI_OLD_SUSPEND
r_return
l_int|0
suffix:semicolon
macro_line|#endif
)brace
macro_line|#ifndef PCI_OLD_SUSPEND
DECL|function|snd_ali_resume
r_static
r_int
id|snd_ali_resume
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
macro_line|#else
r_static
r_void
id|snd_ali_resume
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
macro_line|#endif
(brace
macro_line|#ifndef PCI_OLD_SUSPEND
id|ali_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|ali_t
comma
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
macro_line|#else
id|ali_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|ali_t
comma
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
comma
r_return
)paren
suffix:semicolon
macro_line|#endif
id|ali_image_t
op_star
id|im
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|im
op_assign
id|chip-&gt;image
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|im
)paren
macro_line|#ifndef PCI_OLD_SUSPEND
r_return
op_minus
id|ENXIO
suffix:semicolon
macro_line|#else
r_return
suffix:semicolon
macro_line|#endif
id|pci_enable_device
c_func
(paren
id|chip-&gt;pci
)paren
suffix:semicolon
id|save_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ALI_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|outb
c_func
(paren
id|i
comma
id|ALI_REG
c_func
(paren
id|chip
comma
id|ALI_GC_CIR
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|ALI_CHANNEL_REGS
suffix:semicolon
id|j
op_increment
)paren
id|outl
c_func
(paren
id|im-&gt;channel_regs
(braket
id|i
)braket
(braket
id|j
)braket
comma
id|ALI_REG
c_func
(paren
id|chip
comma
id|j
op_star
l_int|4
op_plus
l_int|0xe0
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ALI_GLOBAL_REGS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|i
op_star
l_int|4
op_eq
id|ALI_MISCINT
)paren
op_logical_or
(paren
id|i
op_star
l_int|4
op_eq
id|ALI_STOP
)paren
op_logical_or
(paren
id|i
op_star
l_int|4
op_eq
id|ALI_START
)paren
)paren
r_continue
suffix:semicolon
id|outl
c_func
(paren
id|im-&gt;regs
(braket
id|i
)braket
comma
id|ALI_REG
c_func
(paren
id|chip
comma
id|i
op_star
l_int|4
)paren
)paren
suffix:semicolon
)brace
id|snd_ac97_resume
c_func
(paren
id|chip-&gt;ac97
)paren
suffix:semicolon
singleline_comment|// start HW channel
id|outl
c_func
(paren
id|im-&gt;regs
(braket
id|ALI_START
op_rshift
l_int|2
)braket
comma
id|ALI_REG
c_func
(paren
id|chip
comma
id|ALI_START
)paren
)paren
suffix:semicolon
singleline_comment|// restore IRQ enable bits
id|outl
c_func
(paren
id|im-&gt;regs
(braket
id|ALI_MISCINT
op_rshift
l_int|2
)braket
comma
id|ALI_REG
c_func
(paren
id|chip
comma
id|ALI_MISCINT
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#ifndef PCI_OLD_SUSPEND
r_return
l_int|0
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif
DECL|function|snd_ali_free
r_static
r_int
id|snd_ali_free
c_func
(paren
id|ali_t
op_star
id|codec
)paren
(brace
id|snd_ali_disable_address_interrupt
c_func
(paren
id|codec
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|codec-&gt;irq
op_ge
l_int|0
)paren
id|free_irq
c_func
(paren
id|codec-&gt;irq
comma
(paren
r_void
op_star
)paren
id|codec
)paren
suffix:semicolon
r_if
c_cond
(paren
id|codec-&gt;res_port
)paren
(brace
id|release_resource
c_func
(paren
id|codec-&gt;res_port
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|codec-&gt;res_port
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PM
r_if
c_cond
(paren
id|codec-&gt;image
)paren
id|kfree
c_func
(paren
id|codec-&gt;image
)paren
suffix:semicolon
macro_line|#endif
id|snd_magic_kfree
c_func
(paren
id|codec
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ali_chip_init
r_static
r_int
id|snd_ali_chip_init
c_func
(paren
id|ali_t
op_star
id|codec
)paren
(brace
r_int
r_int
id|legacy
suffix:semicolon
r_int
r_char
id|temp
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pci_dev
op_assign
l_int|NULL
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;chip initializing ... &bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_ali_reset_5451
c_func
(paren
id|codec
)paren
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;ali_chip_init: reset 5451 error.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|codec-&gt;revision
op_eq
id|ALI_5451_V02
)paren
(brace
id|pci_dev
op_assign
id|codec-&gt;pci_m1533
suffix:semicolon
r_if
c_cond
(paren
id|pci_dev
op_eq
l_int|NULL
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pci_dev
comma
l_int|0x59
comma
op_amp
id|temp
)paren
suffix:semicolon
id|pci_dev
op_assign
id|pci_find_device
c_func
(paren
l_int|0x10b9
comma
l_int|0x7101
comma
id|pci_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_dev
op_eq
l_int|NULL
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pci_dev
comma
l_int|0xb8
comma
op_amp
id|temp
)paren
suffix:semicolon
id|temp
op_or_assign
l_int|1
op_lshift
l_int|6
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pci_dev
comma
l_int|0xB8
comma
id|temp
)paren
suffix:semicolon
)brace
id|pci_read_config_dword
c_func
(paren
id|codec-&gt;pci
comma
l_int|0x44
comma
op_amp
id|legacy
)paren
suffix:semicolon
id|legacy
op_and_assign
l_int|0xff00ff00
suffix:semicolon
id|legacy
op_or_assign
l_int|0x000800aa
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|codec-&gt;pci
comma
l_int|0x44
comma
id|legacy
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x80000001
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_GLOBAL_CONTROL
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x00000000
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_AINTEN
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0xffffffff
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_AINT
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x00000000
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_VOLUME
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x10
comma
id|ALI_REG
c_func
(paren
id|codec
comma
id|ALI_MPUR2
)paren
)paren
suffix:semicolon
id|codec-&gt;ac97_ext_id
op_assign
id|snd_ali_codec_peek
c_func
(paren
id|codec
comma
l_int|0
comma
id|AC97_EXTENDED_ID
)paren
suffix:semicolon
id|codec-&gt;ac97_ext_status
op_assign
id|snd_ali_codec_peek
c_func
(paren
id|codec
comma
l_int|0
comma
id|AC97_EXTENDED_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|codec-&gt;revision
op_eq
id|ALI_5451_V02
)paren
(brace
id|snd_ali_enable_spdif_out
c_func
(paren
id|codec
)paren
suffix:semicolon
id|codec-&gt;spdif_mask
op_assign
l_int|0x00000002
suffix:semicolon
)brace
id|snd_ali_printk
c_func
(paren
l_string|&quot;chip initialize succeed.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ali_resources
r_static
r_int
id|__devinit
id|snd_ali_resources
c_func
(paren
id|ali_t
op_star
id|codec
)paren
(brace
id|snd_ali_printk
c_func
(paren
l_string|&quot;resouces allocation ...&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|codec-&gt;res_port
op_assign
id|request_region
c_func
(paren
id|codec-&gt;port
comma
l_int|0x100
comma
l_string|&quot;ALI 5451&quot;
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_ali_free
c_func
(paren
id|codec
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;Unalbe to request io ports.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|codec-&gt;pci-&gt;irq
comma
id|snd_ali_card_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
l_string|&quot;ALI 5451&quot;
comma
(paren
r_void
op_star
)paren
id|codec
)paren
)paren
(brace
id|snd_ali_free
c_func
(paren
id|codec
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;Unable to request irq.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|codec-&gt;irq
op_assign
id|codec-&gt;pci-&gt;irq
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;resouces allocated.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ali_dev_free
r_static
r_int
id|snd_ali_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|ali_t
op_star
id|codec
op_assign
id|snd_magic_cast
c_func
(paren
id|ali_t
comma
id|device-&gt;device_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|snd_ali_free
c_func
(paren
id|codec
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ali_create
r_static
r_int
id|__devinit
id|snd_ali_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_struct
id|pci_dev
op_star
id|pci
comma
r_int
id|pcm_streams
comma
id|ali_t
op_star
op_star
id|r_ali
)paren
(brace
id|ali_t
op_star
id|codec
suffix:semicolon
r_int
id|i
comma
id|err
suffix:semicolon
r_int
r_int
id|cmdw
op_assign
l_int|0
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pci_dev
op_assign
l_int|NULL
suffix:semicolon
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
(paren
id|snd_dev_free_t
op_star
)paren
id|snd_ali_dev_free
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
op_star
id|r_ali
op_assign
l_int|NULL
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;creating ...&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* enable PCI device */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pci
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* check, if we can restrict PCI DMA transfers to 30 bits */
r_if
c_cond
(paren
op_logical_neg
id|pci_dma_supported
c_func
(paren
id|pci
comma
l_int|0x3fffffff
)paren
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;architecture does not support 30bit PCI busmaster DMA&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
id|pci_set_dma_mask
c_func
(paren
id|pci
comma
l_int|0x3fffffff
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|codec
op_assign
id|snd_magic_kcalloc
c_func
(paren
id|ali_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|codec-&gt;reg_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|codec-&gt;voice_alloc
)paren
suffix:semicolon
id|codec-&gt;card
op_assign
id|card
suffix:semicolon
id|codec-&gt;pci
op_assign
id|pci
suffix:semicolon
id|codec-&gt;irq
op_assign
op_minus
l_int|1
suffix:semicolon
id|codec-&gt;port
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pci
comma
id|PCI_REVISION_ID
comma
op_amp
id|codec-&gt;revision
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcm_streams
OL
l_int|1
)paren
id|pcm_streams
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|pcm_streams
OG
l_int|32
)paren
id|pcm_streams
op_assign
l_int|32
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pci
)paren
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pci
comma
id|PCI_COMMAND
comma
op_amp
id|cmdw
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|cmdw
op_amp
id|PCI_COMMAND_IO
)paren
op_ne
id|PCI_COMMAND_IO
)paren
(brace
id|cmdw
op_or_assign
id|PCI_COMMAND_IO
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|pci
comma
id|PCI_COMMAND
comma
id|cmdw
)paren
suffix:semicolon
)brace
id|pci_set_master
c_func
(paren
id|pci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_ali_resources
c_func
(paren
id|codec
)paren
)paren
(brace
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|synchronize_irq
c_func
(paren
)paren
suffix:semicolon
id|codec-&gt;synth.chmap
op_assign
l_int|0
suffix:semicolon
id|codec-&gt;synth.chcnt
op_assign
l_int|0
suffix:semicolon
id|codec-&gt;spdif_mask
op_assign
l_int|0
suffix:semicolon
id|codec-&gt;synth.synthcount
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|codec-&gt;revision
op_eq
id|ALI_5451_V02
)paren
id|codec-&gt;chregs.regs.ac97read
op_assign
id|ALI_AC97_WRITE
suffix:semicolon
r_else
id|codec-&gt;chregs.regs.ac97read
op_assign
id|ALI_AC97_READ
suffix:semicolon
id|codec-&gt;chregs.regs.ac97write
op_assign
id|ALI_AC97_WRITE
suffix:semicolon
id|codec-&gt;chregs.regs.start
op_assign
id|ALI_START
suffix:semicolon
id|codec-&gt;chregs.regs.stop
op_assign
id|ALI_STOP
suffix:semicolon
id|codec-&gt;chregs.regs.aint
op_assign
id|ALI_AINT
suffix:semicolon
id|codec-&gt;chregs.regs.ainten
op_assign
id|ALI_AINTEN
suffix:semicolon
id|codec-&gt;chregs.data.start
op_assign
l_int|0x00
suffix:semicolon
id|codec-&gt;chregs.data.stop
op_assign
l_int|0x00
suffix:semicolon
id|codec-&gt;chregs.data.aint
op_assign
l_int|0x00
suffix:semicolon
id|codec-&gt;chregs.data.ainten
op_assign
l_int|0x00
suffix:semicolon
id|pci_dev
op_assign
id|pci_find_device
c_func
(paren
l_int|0x10b9
comma
l_int|0x1533
comma
id|pci_dev
)paren
suffix:semicolon
id|codec-&gt;pci_m1533
op_assign
id|pci_dev
suffix:semicolon
id|pci_dev
op_assign
id|pci_find_device
c_func
(paren
l_int|0x10b9
comma
l_int|0x7101
comma
id|pci_dev
)paren
suffix:semicolon
id|codec-&gt;pci_m7101
op_assign
id|pci_dev
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;snd_device_new is called.&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|codec
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_ali_free
c_func
(paren
id|codec
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* initialise synth voices*/
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ALI_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|codec-&gt;synth.voices
(braket
id|i
)braket
dot
id|number
op_assign
id|i
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ali_chip_init
c_func
(paren
id|codec
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;ali create: chip init error.&bslash;n&quot;
)paren
suffix:semicolon
id|snd_ali_free
c_func
(paren
id|codec
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PM
id|codec-&gt;image
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|codec-&gt;image
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|codec-&gt;image
)paren
id|snd_printk
c_func
(paren
l_string|&quot;can&squot;t allocate apm buffer&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|snd_ali_enable_address_interrupt
c_func
(paren
id|codec
)paren
suffix:semicolon
op_star
id|r_ali
op_assign
id|codec
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;created.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ali_probe
r_static
r_int
id|__devinit
id|snd_ali_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
r_static
r_int
id|dev
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
id|ali_t
op_star
id|codec
suffix:semicolon
r_int
id|err
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;probe ...&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_ge
id|SNDRV_CARDS
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_enable
(braket
id|dev
)braket
)paren
(brace
id|dev
op_increment
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|card
op_assign
id|snd_card_new
c_func
(paren
id|snd_index
(braket
id|dev
)braket
comma
id|snd_id
(braket
id|dev
)braket
comma
id|THIS_MODULE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ali_create
c_func
(paren
id|card
comma
id|pci
comma
id|snd_pcm_channels
(braket
id|dev
)braket
comma
op_amp
id|codec
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|snd_ali_printk
c_func
(paren
l_string|&quot;mixer building ...&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ali_mixer
c_func
(paren
id|codec
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|snd_ali_printk
c_func
(paren
l_string|&quot;pcm building ...&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ali_pcm
c_func
(paren
id|codec
comma
l_int|0
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;ALI5451&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;shortname
comma
l_string|&quot;ALI 5451&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;%s at 0x%lx, irq %li&quot;
comma
id|card-&gt;shortname
comma
id|codec-&gt;port
comma
id|codec-&gt;irq
)paren
suffix:semicolon
id|snd_ali_printk
c_func
(paren
l_string|&quot;register card.&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_card_register
c_func
(paren
id|card
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pci
comma
id|codec
)paren
suffix:semicolon
id|dev
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ali_remove
r_static
r_void
id|__devexit
id|snd_ali_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
id|ali_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|ali_t
comma
id|pci_get_drvdata
c_func
(paren
id|pci
)paren
comma
r_return
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip
)paren
id|snd_card_free
c_func
(paren
id|chip-&gt;card
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|driver
r_static
r_struct
id|pci_driver
id|driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;ALI 5451&quot;
comma
id|id_table
suffix:colon
id|snd_ali_ids
comma
id|probe
suffix:colon
id|snd_ali_probe
comma
id|remove
suffix:colon
id|__devexit_p
c_func
(paren
id|snd_ali_remove
)paren
comma
macro_line|#ifdef CONFIG_PM
id|suspend
suffix:colon
id|snd_ali_suspend
comma
id|resume
suffix:colon
id|snd_ali_resume
comma
macro_line|#endif
)brace
suffix:semicolon
DECL|function|alsa_card_ali_init
r_static
r_int
id|__init
id|alsa_card_ali_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_module_init
c_func
(paren
op_amp
id|driver
)paren
)paren
OL
l_int|0
)paren
(brace
macro_line|#ifdef MODULE
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ALi pci audio not found or device busy.&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|alsa_card_ali_exit
r_static
r_void
id|__exit
id|alsa_card_ali_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|alsa_card_ali_init
)paren
id|module_exit
c_func
(paren
id|alsa_card_ali_exit
)paren
macro_line|#ifndef MODULE
multiline_comment|/* format is: snd-ali5451=snd_enable,snd_index,snd_id,snd_pcm_channels */
DECL|function|alsa_card_ali_setup
r_static
r_int
id|__init
id|alsa_card_ali_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_static
r_int
id|__initdata
id|nr_dev
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|nr_dev
op_ge
id|SNDRV_CARDS
)paren
r_return
l_int|0
suffix:semicolon
(paren
r_void
)paren
(paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_enable
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_index
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_id
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_id
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_pcm_channels
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
)paren
suffix:semicolon
id|nr_dev
op_increment
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;snd-ali5451=&quot;
comma
id|alsa_card_ali_setup
)paren
suffix:semicolon
macro_line|#endif /* ifndef */
eof
