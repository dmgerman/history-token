multiline_comment|/*&n; *  azt3328.c - driver for Aztech AZF3328 based soundcards (e.g. PCI168).&n; *  Copyright (C) 2002 by Andreas Mohr &lt;hw7oshyuv3001@sneakemail.com&gt;&n; *&n; *  Framework borrowed from Bart Hartgers&squot;s als4000.c.&n; *  Driver developed on PCI168 AP(W) version (PCI rev. 10, subsystem ID 1801),&n; *  found in a Fujitsu-Siemens PC (&quot;Cordant&quot;, aluminum case).&n; *  Other versions are:&n; *  PCI168 A(W), sub ID 1800&n; *  PCI168 A/AP, sub ID 8000&n; *  Please give me feedback in case you try my driver with one of these!!&n; *&n; * GPL LICENSE&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or&n; *  (at your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n;&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; * NOTES&n; *  Since Aztech does not provide any chipset documentation,&n; *  even on repeated request to various addresses,&n; *  and the answer that was finally given was negative&n; *  (and I was stupid enough to manage to get hold of a PCI168 soundcard&n; *  in the first place &gt;:-P}),&n; *  I was forced to base this driver on reverse engineering&n; *  (3 weeks&squot; worth of evenings filled with driver work).&n; *  (and no, I did NOT go the easy way: to pick up a PCI128 for 9 Euros)&n; *&n; *  The AZF3328 chip (note: AZF3328, *not* AZT3328, that&squot;s just the driver name&n; *  for compatibility reasons) has the following features:&n; *&n; *  - builtin AC97 conformant codec (SNR over 80dB)&n; *    (really AC97 compliant?? I really doubt it when looking&n; *    at the mixer register layout)&n; *  - builtin genuine OPL3&n; *  - full duplex 16bit playback/record at independent sampling rate&n; *  - MPU401 (+ legacy address support) FIXME: how to enable legacy addr??&n; *  - game port (legacy address support)&n; *  - built-in General DirectX timer having a 20 bits counter&n; *    with 1us resolution (FIXME: where is it?)&n; *  - I2S serial port for external DAC&n; *  - supports 33MHz PCI spec 2.1, PCI power management 1.0, compliant with ACPI&n; *  - supports hardware volume control&n; *  - single chip low cost solution (128 pin QFP)&n; *  - supports programmable Sub-vendor and Sub-system ID&n; *    required for Microsoft&squot;s logo compliance (FIXME: where?)&n; *  - PCI168 AP(W) card: power amplifier with 4 Watts/channel at 4 Ohms&n; *&n; *  Certain PCI versions of this card are susceptible to DMA traffic underruns&n; *  in some systems (resulting in sound crackling/clicking/popping),&n; *  probably because they don&squot;t have a DMA FIFO buffer or so.&n; *  Overview (PCI ID/PCI subID/PCI rev.):&n; *  - no DMA crackling on SiS735: 0x50DC/0x1801/16&n; *  - unknown performance: 0x50DC/0x1801/10&n; *  &n; *  Crackling happens with VIA chipsets or, in my case, an SiS735, which is&n; *  supposed to be very fast and supposed to get rid of crackling much&n; *  better than a VIA, yet ironically I still get crackling, like many other&n; *  people with the same chipset.&n; *  Possible remedies:&n; *  - plug card into a different PCI slot, preferrably one that isn&squot;t shared&n; *    too much (this helps a lot, but not completely!)&n; *  - get rid of PCI VGA card, use AGP instead&n; *  - upgrade or downgrade BIOS&n; *  - fiddle with PCI latency settings (setpci -v -s BUSID latency_timer=XX)&n; *    Not too helpful.&n; *  - Disable ACPI/power management/&quot;Auto Detect RAM/PCI Clk&quot; in BIOS&n; * &n; * BUGS&n; *  - when Ctrl-C&squot;ing mpg321, the playback loops a bit&n; *    (premature DMA playback reset?)&n; *  - full-duplex sometimes breaks (IRQ management issues?).&n; *    Once even a spontaneous REBOOT happened!!!&n; * &n; * TODO&n; *  - test MPU401 MIDI playback etc.&n; *  - power management (CONFIG_PM). See e.g. intel8x0 or cs4281.&n; *    This would be nice since the chip runs a bit hot, and it&squot;s *required*&n; *    anyway for proper ACPI power management. In other words: rest&n; *    assured that I *will* implement this very soon; as soon as Linux 2.5.x&n; *    has power management that&squot;s bugfree enough to work properly on my desktop.&n; *  - figure out what all unknown port bits are responsible for&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/gameport.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/control.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
macro_line|#include &lt;sound/rawmidi.h&gt;
macro_line|#include &lt;sound/mpu401.h&gt;
macro_line|#include &lt;sound/opl3.h&gt;
macro_line|#include &lt;sound/initval.h&gt;
macro_line|#include &quot;azt3328.h&quot;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Andreas Mohr &lt;hw7oshyuv3001@sneakemail.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Aztech AZF3328 (PCI168)&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_SUPPORTED_DEVICE
c_func
(paren
l_string|&quot;{{Aztech,AZF3328}}&quot;
)paren
suffix:semicolon
macro_line|#if defined(CONFIG_GAMEPORT) || (defined(MODULE) &amp;&amp; defined(CONFIG_GAMEPORT_MODULE))
DECL|macro|SUPPORT_JOYSTICK
mdefine_line|#define SUPPORT_JOYSTICK 1
macro_line|#endif
DECL|macro|DEBUG_MISC
mdefine_line|#define DEBUG_MISC&t;0
DECL|macro|DEBUG_CALLS
mdefine_line|#define DEBUG_CALLS&t;0
DECL|macro|DEBUG_MIXER
mdefine_line|#define DEBUG_MIXER&t;0
DECL|macro|DEBUG_PLAY_REC
mdefine_line|#define DEBUG_PLAY_REC&t;0
DECL|macro|DEBUG_IO
mdefine_line|#define DEBUG_IO&t;0
DECL|macro|MIXER_TESTING
mdefine_line|#define MIXER_TESTING&t;0
macro_line|#if DEBUG_MISC
DECL|macro|snd_azf3328_dbgmisc
mdefine_line|#define snd_azf3328_dbgmisc(format, args...) printk(KERN_ERR format, ##args)
macro_line|#else
DECL|macro|snd_azf3328_dbgmisc
mdefine_line|#define snd_azf3328_dbgmisc(format, args...)
macro_line|#endif&t;&t;
macro_line|#if DEBUG_CALLS
DECL|macro|snd_azf3328_dbgcalls
mdefine_line|#define snd_azf3328_dbgcalls(format, args...) printk(format, ##args)
DECL|macro|snd_azf3328_dbgcallenter
mdefine_line|#define snd_azf3328_dbgcallenter() printk(KERN_ERR &quot;entering %s&bslash;n&quot;, __FUNCTION__)
DECL|macro|snd_azf3328_dbgcallleave
mdefine_line|#define snd_azf3328_dbgcallleave() printk(KERN_ERR &quot;leaving %s&bslash;n&quot;, __FUNCTION__)
macro_line|#else
DECL|macro|snd_azf3328_dbgcalls
mdefine_line|#define snd_azf3328_dbgcalls(format, args...)
DECL|macro|snd_azf3328_dbgcallenter
mdefine_line|#define snd_azf3328_dbgcallenter()
DECL|macro|snd_azf3328_dbgcallleave
mdefine_line|#define snd_azf3328_dbgcallleave()
macro_line|#endif&t;&t;
macro_line|#if DEBUG_MIXER
DECL|macro|snd_azf3328_dbgmixer
mdefine_line|#define snd_azf3328_dbgmixer(format, args...) printk(format, ##args)
macro_line|#else
DECL|macro|snd_azf3328_dbgmixer
mdefine_line|#define snd_azf3328_dbgmixer(format, args...)
macro_line|#endif&t;&t;
macro_line|#if DEBUG_PLAY_REC
DECL|macro|snd_azf3328_dbgplay
mdefine_line|#define snd_azf3328_dbgplay(format, args...) printk(KERN_ERR format, ##args)
macro_line|#else
DECL|macro|snd_azf3328_dbgplay
mdefine_line|#define snd_azf3328_dbgplay(format, args...)
macro_line|#endif&t;&t;
macro_line|#if DEBUG_IO
DECL|macro|snd_azf3328_dbgio
mdefine_line|#define snd_azf3328_dbgio(chip, where) &bslash;&n;&t;    printk(KERN_ERR &quot;%s: IDX_IO_PLAY_FLAGS %04x, IDX_IO_PLAY_IRQMASK %04x, IDX_IO_IRQSTATUS %04x&bslash;n&quot;, where, inw(chip-&gt;codec_port+IDX_IO_PLAY_FLAGS), inw(chip-&gt;codec_port+IDX_IO_PLAY_IRQMASK), inw(chip-&gt;codec_port+IDX_IO_IRQSTATUS))
macro_line|#else
DECL|macro|snd_azf3328_dbgio
mdefine_line|#define snd_azf3328_dbgio(chip, where)
macro_line|#endif
DECL|variable|index
r_static
r_int
id|index
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_IDX
suffix:semicolon
multiline_comment|/* Index 0-MAX */
DECL|variable|id
r_static
r_char
op_star
id|id
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_STR
suffix:semicolon
multiline_comment|/* ID for this card */
DECL|variable|enable
r_static
r_int
id|enable
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_ENABLE_PNP
suffix:semicolon
multiline_comment|/* Enable this card */
macro_line|#ifdef SUPPORT_JOYSTICK
DECL|variable|joystick
r_static
r_int
id|joystick
(braket
id|SNDRV_CARDS
)braket
suffix:semicolon
macro_line|#endif
id|module_param_array
c_func
(paren
id|index
comma
r_int
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|index
comma
l_string|&quot;Index value for AZF3328 soundcard.&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|id
comma
id|charp
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|id
comma
l_string|&quot;ID string for AZF3328 soundcard.&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|enable
comma
r_bool
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|enable
comma
l_string|&quot;Enable AZF3328 soundcard.&quot;
)paren
suffix:semicolon
macro_line|#ifdef SUPPORT_JOYSTICK
id|module_param_array
c_func
(paren
id|joystick
comma
r_bool
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|joystick
comma
l_string|&quot;Enable joystick for AZF3328 soundcard.&quot;
)paren
suffix:semicolon
macro_line|#endif
DECL|typedef|azf3328_t
r_typedef
r_struct
id|_snd_azf3328
id|azf3328_t
suffix:semicolon
DECL|struct|_snd_azf3328
r_struct
id|_snd_azf3328
(brace
DECL|member|irq
r_int
id|irq
suffix:semicolon
DECL|member|codec_port
r_int
r_int
id|codec_port
suffix:semicolon
DECL|member|io2_port
r_int
r_int
id|io2_port
suffix:semicolon
DECL|member|mpu_port
r_int
r_int
id|mpu_port
suffix:semicolon
DECL|member|synth_port
r_int
r_int
id|synth_port
suffix:semicolon
DECL|member|mixer_port
r_int
r_int
id|mixer_port
suffix:semicolon
macro_line|#ifdef SUPPORT_JOYSTICK
DECL|member|gameport
r_struct
id|gameport
id|gameport
suffix:semicolon
DECL|member|res_joystick
r_struct
id|resource
op_star
id|res_joystick
suffix:semicolon
macro_line|#endif
DECL|member|pci
r_struct
id|pci_dev
op_star
id|pci
suffix:semicolon
DECL|member|card
id|snd_card_t
op_star
id|card
suffix:semicolon
DECL|member|pcm
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
DECL|member|rmidi
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
DECL|member|playback_substream
id|snd_pcm_substream_t
op_star
id|playback_substream
suffix:semicolon
DECL|member|capture_substream
id|snd_pcm_substream_t
op_star
id|capture_substream
suffix:semicolon
DECL|member|is_playing
r_int
r_int
id|is_playing
suffix:semicolon
DECL|member|is_recording
r_int
r_int
id|is_recording
suffix:semicolon
DECL|member|reg_lock
id|spinlock_t
id|reg_lock
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|snd_azf3328_ids
r_static
r_struct
id|pci_device_id
id|snd_azf3328_ids
(braket
)braket
op_assign
(brace
(brace
l_int|0x122D
comma
l_int|0x50DC
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* PCI168/3328 */
(brace
l_int|0x122D
comma
l_int|0x80DA
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* 3328 */
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|snd_azf3328_ids
)paren
suffix:semicolon
DECL|function|snd_azf3328_io2_write
r_static
r_inline
r_void
id|snd_azf3328_io2_write
c_func
(paren
id|azf3328_t
op_star
id|chip
comma
r_int
id|reg
comma
r_int
r_char
id|value
)paren
(brace
id|outb
c_func
(paren
id|value
comma
id|chip-&gt;io2_port
op_plus
id|reg
)paren
suffix:semicolon
)brace
DECL|function|snd_azf3328_io2_read
r_static
r_inline
r_int
r_char
id|snd_azf3328_io2_read
c_func
(paren
id|azf3328_t
op_star
id|chip
comma
r_int
id|reg
)paren
(brace
r_return
id|inb
c_func
(paren
id|chip-&gt;io2_port
op_plus
id|reg
)paren
suffix:semicolon
)brace
DECL|function|snd_azf3328_mixer_write
r_static
r_void
id|snd_azf3328_mixer_write
c_func
(paren
id|azf3328_t
op_star
id|chip
comma
r_int
id|reg
comma
r_int
r_int
id|value
comma
r_int
id|type
)paren
(brace
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|WORD_VALUE
suffix:colon
id|outw
c_func
(paren
id|value
comma
id|chip-&gt;mixer_port
op_plus
id|reg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DWORD_VALUE
suffix:colon
id|outl
c_func
(paren
id|value
comma
id|chip-&gt;mixer_port
op_plus
id|reg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BYTE_VALUE
suffix:colon
id|outb
c_func
(paren
id|value
comma
id|chip-&gt;mixer_port
op_plus
id|reg
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|snd_azf3328_mixer_set_mute
r_static
r_void
id|snd_azf3328_mixer_set_mute
c_func
(paren
id|azf3328_t
op_star
id|chip
comma
r_int
id|reg
comma
r_int
id|do_mute
)paren
(brace
r_int
r_char
id|oldval
suffix:semicolon
multiline_comment|/* the mute bit is on the *second* (i.e. right) register of a&n;&t; * left/right channel setting */
id|oldval
op_assign
id|inb
c_func
(paren
id|chip-&gt;mixer_port
op_plus
id|reg
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|do_mute
)paren
id|oldval
op_or_assign
l_int|0x80
suffix:semicolon
r_else
id|oldval
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
id|outb
c_func
(paren
id|oldval
comma
id|chip-&gt;mixer_port
op_plus
id|reg
op_plus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|snd_azf3328_mixer_write_volume_gradually
r_static
r_void
id|snd_azf3328_mixer_write_volume_gradually
c_func
(paren
id|azf3328_t
op_star
id|chip
comma
r_int
id|reg
comma
r_int
r_char
id|dst_vol_left
comma
r_int
r_char
id|dst_vol_right
comma
r_int
id|chan_sel
comma
r_int
id|delay
)paren
(brace
r_int
r_char
id|curr_vol_left
op_assign
l_int|0
comma
id|curr_vol_right
op_assign
l_int|0
suffix:semicolon
r_int
id|left_done
op_assign
l_int|0
comma
id|right_done
op_assign
l_int|0
suffix:semicolon
id|snd_azf3328_dbgcallenter
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chan_sel
op_amp
id|SET_CHAN_LEFT
)paren
id|curr_vol_left
op_assign
id|inb
c_func
(paren
id|chip-&gt;mixer_port
op_plus
id|reg
op_plus
l_int|1
)paren
suffix:semicolon
r_else
id|left_done
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|chan_sel
op_amp
id|SET_CHAN_RIGHT
)paren
id|curr_vol_right
op_assign
id|inb
c_func
(paren
id|chip-&gt;mixer_port
op_plus
id|reg
op_plus
l_int|0
)paren
suffix:semicolon
r_else
id|right_done
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* take care of muting flag (0x80) contained in left channel */
r_if
c_cond
(paren
id|curr_vol_left
op_amp
l_int|0x80
)paren
id|dst_vol_left
op_or_assign
l_int|0x80
suffix:semicolon
r_else
id|dst_vol_left
op_and_assign
op_complement
l_int|0x80
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
op_logical_neg
id|left_done
)paren
(brace
r_if
c_cond
(paren
id|curr_vol_left
OG
id|dst_vol_left
)paren
id|curr_vol_left
op_decrement
suffix:semicolon
r_else
r_if
c_cond
(paren
id|curr_vol_left
OL
id|dst_vol_left
)paren
id|curr_vol_left
op_increment
suffix:semicolon
r_else
id|left_done
op_assign
l_int|1
suffix:semicolon
id|outb
c_func
(paren
id|curr_vol_left
comma
id|chip-&gt;mixer_port
op_plus
id|reg
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|right_done
)paren
(brace
r_if
c_cond
(paren
id|curr_vol_right
OG
id|dst_vol_right
)paren
id|curr_vol_right
op_decrement
suffix:semicolon
r_else
r_if
c_cond
(paren
id|curr_vol_right
OL
id|dst_vol_right
)paren
id|curr_vol_right
op_increment
suffix:semicolon
r_else
id|right_done
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* during volume change, the right channel is crackling&n;&t;&t;&t; * somewhat more than the left channel, unfortunately.&n;&t;&t;&t; * This seems to be a hardware issue. */
id|outb
c_func
(paren
id|curr_vol_right
comma
id|chip-&gt;mixer_port
op_plus
id|reg
op_plus
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|delay
)paren
id|mdelay
c_func
(paren
id|delay
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
op_logical_neg
id|left_done
)paren
op_logical_or
(paren
op_logical_neg
id|right_done
)paren
)paren
suffix:semicolon
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * general mixer element&n; */
DECL|struct|azf3328_mixer_reg
r_typedef
r_struct
id|azf3328_mixer_reg
(brace
DECL|member|reg
r_int
r_int
id|reg
suffix:semicolon
DECL|member|lchan_shift
DECL|member|rchan_shift
r_int
r_int
id|lchan_shift
comma
id|rchan_shift
suffix:semicolon
DECL|member|mask
r_int
r_int
id|mask
suffix:semicolon
DECL|member|invert
r_int
r_int
id|invert
suffix:colon
l_int|1
suffix:semicolon
DECL|member|stereo
r_int
r_int
id|stereo
suffix:colon
l_int|1
suffix:semicolon
DECL|member|enum_c
r_int
r_int
id|enum_c
suffix:colon
l_int|4
suffix:semicolon
DECL|typedef|azf3328_mixer_reg_t
)brace
id|azf3328_mixer_reg_t
suffix:semicolon
DECL|macro|COMPOSE_MIXER_REG
mdefine_line|#define COMPOSE_MIXER_REG(reg,lchan_shift,rchan_shift,mask,invert,stereo,enum_c) &bslash;&n; ((reg) | (lchan_shift &lt;&lt; 8) | (rchan_shift &lt;&lt; 12) | (mask &lt;&lt; 16) | (invert &lt;&lt; 24) | (stereo &lt;&lt; 25) | (enum_c &lt;&lt; 26))
DECL|function|snd_azf3328_mixer_reg_decode
r_static
r_void
id|snd_azf3328_mixer_reg_decode
c_func
(paren
id|azf3328_mixer_reg_t
op_star
id|r
comma
r_int
r_int
id|val
)paren
(brace
id|r-&gt;reg
op_assign
id|val
op_amp
l_int|0xff
suffix:semicolon
id|r-&gt;lchan_shift
op_assign
(paren
id|val
op_rshift
l_int|8
)paren
op_amp
l_int|0x0f
suffix:semicolon
id|r-&gt;rchan_shift
op_assign
(paren
id|val
op_rshift
l_int|12
)paren
op_amp
l_int|0x0f
suffix:semicolon
id|r-&gt;mask
op_assign
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|r-&gt;invert
op_assign
(paren
id|val
op_rshift
l_int|24
)paren
op_amp
l_int|1
suffix:semicolon
id|r-&gt;stereo
op_assign
(paren
id|val
op_rshift
l_int|25
)paren
op_amp
l_int|1
suffix:semicolon
id|r-&gt;enum_c
op_assign
(paren
id|val
op_rshift
l_int|26
)paren
op_amp
l_int|0x0f
suffix:semicolon
)brace
multiline_comment|/*&n; * mixer switches/volumes&n; */
DECL|macro|AZF3328_MIXER_SWITCH
mdefine_line|#define AZF3328_MIXER_SWITCH(xname, reg, shift, invert) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, &bslash;&n;  .info = snd_azf3328_info_mixer, &bslash;&n;  .get = snd_azf3328_get_mixer, .put = snd_azf3328_put_mixer, &bslash;&n;  .private_value = COMPOSE_MIXER_REG(reg, shift, 0, 0x1, invert, 0, 0), &bslash;&n;}
DECL|macro|AZF3328_MIXER_VOL_STEREO
mdefine_line|#define AZF3328_MIXER_VOL_STEREO(xname, reg, mask, invert) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, &bslash;&n;  .info = snd_azf3328_info_mixer, &bslash;&n;  .get = snd_azf3328_get_mixer, .put = snd_azf3328_put_mixer, &bslash;&n;  .private_value = COMPOSE_MIXER_REG(reg, 8, 0, mask, invert, 1, 0), &bslash;&n;}
DECL|macro|AZF3328_MIXER_VOL_MONO
mdefine_line|#define AZF3328_MIXER_VOL_MONO(xname, reg, mask, is_right_chan) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, &bslash;&n;  .info = snd_azf3328_info_mixer, &bslash;&n;  .get = snd_azf3328_get_mixer, .put = snd_azf3328_put_mixer, &bslash;&n;  .private_value = COMPOSE_MIXER_REG(reg, is_right_chan ? 0 : 8, 0, mask, 1, 0, 0), &bslash;&n;}
DECL|macro|AZF3328_MIXER_VOL_SPECIAL
mdefine_line|#define AZF3328_MIXER_VOL_SPECIAL(xname, reg, mask, shift, invert) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, &bslash;&n;  .info = snd_azf3328_info_mixer, &bslash;&n;  .get = snd_azf3328_get_mixer, .put = snd_azf3328_put_mixer, &bslash;&n;  .private_value = COMPOSE_MIXER_REG(reg, shift, 0, mask, invert, 0, 0), &bslash;&n;}
DECL|macro|AZF3328_MIXER_ENUM
mdefine_line|#define AZF3328_MIXER_ENUM(xname, reg, enum_c, shift) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, &bslash;&n;  .info = snd_azf3328_info_mixer_enum, &bslash;&n;  .get = snd_azf3328_get_mixer_enum, .put = snd_azf3328_put_mixer_enum, &bslash;&n;  .private_value = COMPOSE_MIXER_REG(reg, shift, 0, 0, 0, 0, enum_c), &bslash;&n;}
DECL|function|snd_azf3328_info_mixer
r_static
r_int
id|snd_azf3328_info_mixer
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|azf3328_mixer_reg_t
id|reg
suffix:semicolon
id|snd_azf3328_dbgcallenter
c_func
(paren
)paren
suffix:semicolon
id|snd_azf3328_mixer_reg_decode
c_func
(paren
op_amp
id|reg
comma
id|kcontrol-&gt;private_value
)paren
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|reg.mask
op_eq
l_int|1
ques
c_cond
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:colon
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
id|reg.stereo
op_plus
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
id|reg.mask
suffix:semicolon
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_azf3328_get_mixer
r_static
r_int
id|snd_azf3328_get_mixer
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|azf3328_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|azf3328_mixer_reg_t
id|reg
suffix:semicolon
r_int
r_int
id|oreg
comma
id|val
suffix:semicolon
id|snd_azf3328_dbgcallenter
c_func
(paren
)paren
suffix:semicolon
id|snd_azf3328_mixer_reg_decode
c_func
(paren
op_amp
id|reg
comma
id|kcontrol-&gt;private_value
)paren
suffix:semicolon
id|oreg
op_assign
id|inw
c_func
(paren
id|chip-&gt;mixer_port
op_plus
id|reg.reg
)paren
suffix:semicolon
id|val
op_assign
(paren
id|oreg
op_rshift
id|reg.lchan_shift
)paren
op_amp
id|reg.mask
suffix:semicolon
r_if
c_cond
(paren
id|reg.invert
)paren
id|val
op_assign
id|reg.mask
op_minus
id|val
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|reg.stereo
)paren
(brace
id|val
op_assign
(paren
id|oreg
op_rshift
id|reg.rchan_shift
)paren
op_amp
id|reg.mask
suffix:semicolon
r_if
c_cond
(paren
id|reg.invert
)paren
id|val
op_assign
id|reg.mask
op_minus
id|val
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
id|val
suffix:semicolon
)brace
id|snd_azf3328_dbgmixer
c_func
(paren
l_string|&quot;get: %02x is %04x -&gt; vol %02lx|%02lx (shift %02d|%02d, mask %02x, inv. %d, stereo %d)&bslash;n&quot;
comma
id|reg.reg
comma
id|oreg
comma
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
comma
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
comma
id|reg.lchan_shift
comma
id|reg.rchan_shift
comma
id|reg.mask
comma
id|reg.invert
comma
id|reg.stereo
)paren
suffix:semicolon
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_azf3328_put_mixer
r_static
r_int
id|snd_azf3328_put_mixer
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|azf3328_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|azf3328_mixer_reg_t
id|reg
suffix:semicolon
r_int
r_int
id|oreg
comma
id|nreg
comma
id|val
suffix:semicolon
id|snd_azf3328_dbgcallenter
c_func
(paren
)paren
suffix:semicolon
id|snd_azf3328_mixer_reg_decode
c_func
(paren
op_amp
id|reg
comma
id|kcontrol-&gt;private_value
)paren
suffix:semicolon
id|oreg
op_assign
id|inw
c_func
(paren
id|chip-&gt;mixer_port
op_plus
id|reg.reg
)paren
suffix:semicolon
id|val
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
id|reg.mask
suffix:semicolon
r_if
c_cond
(paren
id|reg.invert
)paren
id|val
op_assign
id|reg.mask
op_minus
id|val
suffix:semicolon
id|nreg
op_assign
id|oreg
op_amp
op_complement
(paren
id|reg.mask
op_lshift
id|reg.lchan_shift
)paren
suffix:semicolon
id|nreg
op_or_assign
(paren
id|val
op_lshift
id|reg.lchan_shift
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg.stereo
)paren
(brace
id|val
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_amp
id|reg.mask
suffix:semicolon
r_if
c_cond
(paren
id|reg.invert
)paren
id|val
op_assign
id|reg.mask
op_minus
id|val
suffix:semicolon
id|nreg
op_and_assign
op_complement
(paren
id|reg.mask
op_lshift
id|reg.rchan_shift
)paren
suffix:semicolon
id|nreg
op_or_assign
(paren
id|val
op_lshift
id|reg.rchan_shift
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|reg.mask
op_ge
l_int|0x07
)paren
multiline_comment|/* it&squot;s a volume control, so better take care */
id|snd_azf3328_mixer_write_volume_gradually
c_func
(paren
id|chip
comma
id|reg.reg
comma
id|nreg
op_rshift
l_int|8
comma
id|nreg
op_amp
l_int|0xff
comma
id|SET_CHAN_LEFT
op_or
id|SET_CHAN_RIGHT
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* just set both channels, doesn&squot;t matter */
r_else
id|outw
c_func
(paren
id|nreg
comma
id|chip-&gt;mixer_port
op_plus
id|reg.reg
)paren
suffix:semicolon
id|snd_azf3328_dbgmixer
c_func
(paren
l_string|&quot;put: %02x to %02lx|%02lx, oreg %04x; shift %02d|%02d -&gt; nreg %04x; after: %04x&bslash;n&quot;
comma
id|reg.reg
comma
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
comma
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
comma
id|oreg
comma
id|reg.lchan_shift
comma
id|reg.rchan_shift
comma
id|nreg
comma
id|inw
c_func
(paren
id|chip-&gt;mixer_port
op_plus
id|reg.reg
)paren
)paren
suffix:semicolon
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
r_return
(paren
id|nreg
op_ne
id|oreg
)paren
suffix:semicolon
)brace
DECL|function|snd_azf3328_info_mixer_enum
r_static
r_int
id|snd_azf3328_info_mixer_enum
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|azf3328_mixer_reg_t
id|reg
suffix:semicolon
r_static
r_char
op_star
id|texts1
(braket
l_int|2
)braket
op_assign
(brace
l_string|&quot;ModemOut1&quot;
comma
l_string|&quot;ModemOut2&quot;
)brace
suffix:semicolon
r_static
r_char
op_star
id|texts2
(braket
l_int|2
)braket
op_assign
(brace
l_string|&quot;MonoSelectSource1&quot;
comma
l_string|&quot;MonoSelectSource2&quot;
)brace
suffix:semicolon
r_static
r_char
op_star
id|texts3
(braket
l_int|8
)braket
op_assign
(brace
l_string|&quot;Mic&quot;
comma
l_string|&quot;CD&quot;
comma
l_string|&quot;Video&quot;
comma
l_string|&quot;Aux&quot;
comma
l_string|&quot;Line&quot;
comma
l_string|&quot;Mix&quot;
comma
l_string|&quot;Mix Mono&quot;
comma
l_string|&quot;Phone&quot;
)brace
suffix:semicolon
id|snd_azf3328_mixer_reg_decode
c_func
(paren
op_amp
id|reg
comma
id|kcontrol-&gt;private_value
)paren
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_ENUMERATED
suffix:semicolon
id|uinfo-&gt;count
op_assign
(paren
id|reg.reg
op_eq
id|IDX_MIXER_REC_SELECT
)paren
ques
c_cond
l_int|2
suffix:colon
l_int|1
suffix:semicolon
id|uinfo-&gt;value.enumerated.items
op_assign
id|reg.enum_c
suffix:semicolon
r_if
c_cond
(paren
id|uinfo-&gt;value.enumerated.item
OG
id|reg.enum_c
op_minus
l_int|1U
)paren
id|uinfo-&gt;value.enumerated.item
op_assign
id|reg.enum_c
op_minus
l_int|1U
suffix:semicolon
r_if
c_cond
(paren
id|reg.reg
op_eq
id|IDX_MIXER_ADVCTL2
)paren
(brace
r_if
c_cond
(paren
id|reg.lchan_shift
op_eq
l_int|8
)paren
multiline_comment|/* modem out sel */
id|strcpy
c_func
(paren
id|uinfo-&gt;value.enumerated.name
comma
id|texts1
(braket
id|uinfo-&gt;value.enumerated.item
)braket
)paren
suffix:semicolon
r_else
multiline_comment|/* mono sel source */
id|strcpy
c_func
(paren
id|uinfo-&gt;value.enumerated.name
comma
id|texts2
(braket
id|uinfo-&gt;value.enumerated.item
)braket
)paren
suffix:semicolon
)brace
r_else
id|strcpy
c_func
(paren
id|uinfo-&gt;value.enumerated.name
comma
id|texts3
(braket
id|uinfo-&gt;value.enumerated.item
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_azf3328_get_mixer_enum
r_static
r_int
id|snd_azf3328_get_mixer_enum
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|azf3328_mixer_reg_t
id|reg
suffix:semicolon
id|azf3328_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
id|snd_azf3328_mixer_reg_decode
c_func
(paren
op_amp
id|reg
comma
id|kcontrol-&gt;private_value
)paren
suffix:semicolon
id|val
op_assign
id|inw
c_func
(paren
id|chip-&gt;mixer_port
op_plus
id|reg.reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg.reg
op_eq
id|IDX_MIXER_REC_SELECT
)paren
(brace
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
op_assign
(paren
id|val
op_rshift
l_int|8
)paren
op_amp
(paren
id|reg.enum_c
op_minus
l_int|1
)paren
suffix:semicolon
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|1
)braket
op_assign
(paren
id|val
op_rshift
l_int|0
)paren
op_amp
(paren
id|reg.enum_c
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_else
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
op_assign
(paren
id|val
op_rshift
id|reg.lchan_shift
)paren
op_amp
(paren
id|reg.enum_c
op_minus
l_int|1
)paren
suffix:semicolon
id|snd_azf3328_dbgmixer
c_func
(paren
l_string|&quot;get_enum: %02x is %04x -&gt; %d|%d (shift %02d, enum_c %d)&bslash;n&quot;
comma
id|reg.reg
comma
id|val
comma
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
comma
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|1
)braket
comma
id|reg.lchan_shift
comma
id|reg.enum_c
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_azf3328_put_mixer_enum
r_static
r_int
id|snd_azf3328_put_mixer_enum
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|azf3328_mixer_reg_t
id|reg
suffix:semicolon
id|azf3328_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|oreg
comma
id|nreg
comma
id|val
suffix:semicolon
id|snd_azf3328_mixer_reg_decode
c_func
(paren
op_amp
id|reg
comma
id|kcontrol-&gt;private_value
)paren
suffix:semicolon
id|oreg
op_assign
id|inw
c_func
(paren
id|chip-&gt;mixer_port
op_plus
id|reg.reg
)paren
suffix:semicolon
id|val
op_assign
id|oreg
suffix:semicolon
r_if
c_cond
(paren
id|reg.reg
op_eq
id|IDX_MIXER_REC_SELECT
)paren
(brace
r_if
c_cond
(paren
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
OG
id|reg.enum_c
op_minus
l_int|1U
op_logical_or
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|1
)braket
OG
id|reg.enum_c
op_minus
l_int|1U
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|val
op_assign
(paren
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|1
)braket
op_lshift
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
OG
id|reg.enum_c
op_minus
l_int|1U
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|val
op_and_assign
op_complement
(paren
(paren
id|reg.enum_c
op_minus
l_int|1
)paren
op_lshift
id|reg.lchan_shift
)paren
suffix:semicolon
id|val
op_or_assign
(paren
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
op_lshift
id|reg.lchan_shift
)paren
suffix:semicolon
)brace
id|outw
c_func
(paren
id|val
comma
id|chip-&gt;mixer_port
op_plus
id|reg.reg
)paren
suffix:semicolon
id|nreg
op_assign
id|val
suffix:semicolon
id|snd_azf3328_dbgmixer
c_func
(paren
l_string|&quot;put_enum: %02x to %04x, oreg %04x&bslash;n&quot;
comma
id|reg.reg
comma
id|val
comma
id|oreg
)paren
suffix:semicolon
r_return
(paren
id|nreg
op_ne
id|oreg
)paren
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_azf3328_mixer_controls
(braket
)braket
id|__devinitdata
op_assign
(brace
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;Master Playback Switch&quot;
comma
id|IDX_MIXER_PLAY_MASTER
comma
l_int|15
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_VOL_STEREO
c_func
(paren
l_string|&quot;Master Playback Volume&quot;
comma
id|IDX_MIXER_PLAY_MASTER
comma
l_int|0x1f
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;Wave Playback Switch&quot;
comma
id|IDX_MIXER_WAVEOUT
comma
l_int|15
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_VOL_STEREO
c_func
(paren
l_string|&quot;Wave Playback Volume&quot;
comma
id|IDX_MIXER_WAVEOUT
comma
l_int|0x1f
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;Wave Playback 3D Bypass&quot;
comma
id|IDX_MIXER_ADVCTL2
comma
l_int|7
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;FM Playback Switch&quot;
comma
id|IDX_MIXER_FMSYNTH
comma
l_int|15
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_VOL_STEREO
c_func
(paren
l_string|&quot;FM Playback Volume&quot;
comma
id|IDX_MIXER_FMSYNTH
comma
l_int|0x1f
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;CD Playback Switch&quot;
comma
id|IDX_MIXER_CDAUDIO
comma
l_int|15
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_VOL_STEREO
c_func
(paren
l_string|&quot;CD Playback Volume&quot;
comma
id|IDX_MIXER_CDAUDIO
comma
l_int|0x1f
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;Capture Switch&quot;
comma
id|IDX_MIXER_REC_VOLUME
comma
l_int|15
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_VOL_STEREO
c_func
(paren
l_string|&quot;Capture Volume&quot;
comma
id|IDX_MIXER_REC_VOLUME
comma
l_int|0x0f
comma
l_int|0
)paren
comma
id|AZF3328_MIXER_ENUM
c_func
(paren
l_string|&quot;Capture Source&quot;
comma
id|IDX_MIXER_REC_SELECT
comma
l_int|8
comma
l_int|0
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;Mic Playback Switch&quot;
comma
id|IDX_MIXER_MIC
comma
l_int|15
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_VOL_MONO
c_func
(paren
l_string|&quot;Mic Playback Volume&quot;
comma
id|IDX_MIXER_MIC
comma
l_int|0x1f
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;Mic Boost (+20dB)&quot;
comma
id|IDX_MIXER_MIC
comma
l_int|6
comma
l_int|0
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;Line Playback Switch&quot;
comma
id|IDX_MIXER_LINEIN
comma
l_int|15
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_VOL_STEREO
c_func
(paren
l_string|&quot;Line Playback Volume&quot;
comma
id|IDX_MIXER_LINEIN
comma
l_int|0x1f
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;PCBeep Playback Switch&quot;
comma
id|IDX_MIXER_PCBEEP
comma
l_int|15
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_VOL_SPECIAL
c_func
(paren
l_string|&quot;PCBeep Playback Volume&quot;
comma
id|IDX_MIXER_PCBEEP
comma
l_int|0x0f
comma
l_int|1
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;Video Playback Switch&quot;
comma
id|IDX_MIXER_VIDEO
comma
l_int|15
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_VOL_STEREO
c_func
(paren
l_string|&quot;Video Playback Volume&quot;
comma
id|IDX_MIXER_VIDEO
comma
l_int|0x1f
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;Aux Playback Switch&quot;
comma
id|IDX_MIXER_AUX
comma
l_int|15
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_VOL_STEREO
c_func
(paren
l_string|&quot;Aux Playback Volume&quot;
comma
id|IDX_MIXER_AUX
comma
l_int|0x1f
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;Modem Playback Switch&quot;
comma
id|IDX_MIXER_MODEMOUT
comma
l_int|15
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_VOL_MONO
c_func
(paren
l_string|&quot;Modem Playback Volume&quot;
comma
id|IDX_MIXER_MODEMOUT
comma
l_int|0x1f
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;Modem Capture Switch&quot;
comma
id|IDX_MIXER_MODEMIN
comma
l_int|15
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_VOL_MONO
c_func
(paren
l_string|&quot;Modem Capture Volume&quot;
comma
id|IDX_MIXER_MODEMIN
comma
l_int|0x1f
comma
l_int|1
)paren
comma
id|AZF3328_MIXER_ENUM
c_func
(paren
l_string|&quot;Modem Out Select&quot;
comma
id|IDX_MIXER_ADVCTL2
comma
l_int|2
comma
l_int|8
)paren
comma
id|AZF3328_MIXER_ENUM
c_func
(paren
l_string|&quot;Mono Select Source&quot;
comma
id|IDX_MIXER_ADVCTL2
comma
l_int|2
comma
l_int|9
)paren
comma
id|AZF3328_MIXER_VOL_SPECIAL
c_func
(paren
l_string|&quot;Tone Control - Treble&quot;
comma
id|IDX_MIXER_BASSTREBLE
comma
l_int|0x07
comma
l_int|1
comma
l_int|0
)paren
comma
id|AZF3328_MIXER_VOL_SPECIAL
c_func
(paren
l_string|&quot;Tone Control - Bass&quot;
comma
id|IDX_MIXER_BASSTREBLE
comma
l_int|0x07
comma
l_int|9
comma
l_int|0
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;3D Control - Toggle&quot;
comma
id|IDX_MIXER_ADVCTL2
comma
l_int|13
comma
l_int|0
)paren
comma
id|AZF3328_MIXER_VOL_SPECIAL
c_func
(paren
l_string|&quot;3D Control - Volume&quot;
comma
id|IDX_MIXER_ADVCTL1
comma
l_int|0x07
comma
l_int|1
comma
l_int|0
)paren
comma
multiline_comment|/* &quot;3D Width&quot; */
id|AZF3328_MIXER_VOL_SPECIAL
c_func
(paren
l_string|&quot;3D Control - Space&quot;
comma
id|IDX_MIXER_ADVCTL1
comma
l_int|0x03
comma
l_int|8
comma
l_int|0
)paren
comma
multiline_comment|/* &quot;Hifi 3D&quot; */
macro_line|#if MIXER_TESTING
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;0&quot;
comma
id|IDX_MIXER_ADVCTL2
comma
l_int|0
comma
l_int|0
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;1&quot;
comma
id|IDX_MIXER_ADVCTL2
comma
l_int|1
comma
l_int|0
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;2&quot;
comma
id|IDX_MIXER_ADVCTL2
comma
l_int|2
comma
l_int|0
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;3&quot;
comma
id|IDX_MIXER_ADVCTL2
comma
l_int|3
comma
l_int|0
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;4&quot;
comma
id|IDX_MIXER_ADVCTL2
comma
l_int|4
comma
l_int|0
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;5&quot;
comma
id|IDX_MIXER_ADVCTL2
comma
l_int|5
comma
l_int|0
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;6&quot;
comma
id|IDX_MIXER_ADVCTL2
comma
l_int|6
comma
l_int|0
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;7&quot;
comma
id|IDX_MIXER_ADVCTL2
comma
l_int|7
comma
l_int|0
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;8&quot;
comma
id|IDX_MIXER_ADVCTL2
comma
l_int|8
comma
l_int|0
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;9&quot;
comma
id|IDX_MIXER_ADVCTL2
comma
l_int|9
comma
l_int|0
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;10&quot;
comma
id|IDX_MIXER_ADVCTL2
comma
l_int|10
comma
l_int|0
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;11&quot;
comma
id|IDX_MIXER_ADVCTL2
comma
l_int|11
comma
l_int|0
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;12&quot;
comma
id|IDX_MIXER_ADVCTL2
comma
l_int|12
comma
l_int|0
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;13&quot;
comma
id|IDX_MIXER_ADVCTL2
comma
l_int|13
comma
l_int|0
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;14&quot;
comma
id|IDX_MIXER_ADVCTL2
comma
l_int|14
comma
l_int|0
)paren
comma
id|AZF3328_MIXER_SWITCH
c_func
(paren
l_string|&quot;15&quot;
comma
id|IDX_MIXER_ADVCTL2
comma
l_int|15
comma
l_int|0
)paren
comma
macro_line|#endif
)brace
suffix:semicolon
DECL|macro|AZF3328_INIT_VALUES
mdefine_line|#define AZF3328_INIT_VALUES (sizeof(snd_azf3328_init_values)/sizeof(unsigned int)/2)
DECL|variable|snd_azf3328_init_values
r_static
r_int
r_int
id|snd_azf3328_init_values
(braket
)braket
(braket
l_int|2
)braket
op_assign
(brace
(brace
id|IDX_MIXER_PLAY_MASTER
comma
id|MIXER_MUTE_MASK
op_or
l_int|0x1f1f
)brace
comma
(brace
id|IDX_MIXER_MODEMOUT
comma
id|MIXER_MUTE_MASK
op_or
l_int|0x1f1f
)brace
comma
(brace
id|IDX_MIXER_BASSTREBLE
comma
l_int|0x0000
)brace
comma
(brace
id|IDX_MIXER_PCBEEP
comma
id|MIXER_MUTE_MASK
op_or
l_int|0x1f1f
)brace
comma
(brace
id|IDX_MIXER_MODEMIN
comma
id|MIXER_MUTE_MASK
op_or
l_int|0x1f1f
)brace
comma
(brace
id|IDX_MIXER_MIC
comma
id|MIXER_MUTE_MASK
op_or
l_int|0x001f
)brace
comma
(brace
id|IDX_MIXER_LINEIN
comma
id|MIXER_MUTE_MASK
op_or
l_int|0x1f1f
)brace
comma
(brace
id|IDX_MIXER_CDAUDIO
comma
id|MIXER_MUTE_MASK
op_or
l_int|0x1f1f
)brace
comma
(brace
id|IDX_MIXER_VIDEO
comma
id|MIXER_MUTE_MASK
op_or
l_int|0x1f1f
)brace
comma
(brace
id|IDX_MIXER_AUX
comma
id|MIXER_MUTE_MASK
op_or
l_int|0x1f1f
)brace
comma
(brace
id|IDX_MIXER_WAVEOUT
comma
id|MIXER_MUTE_MASK
op_or
l_int|0x1f1f
)brace
comma
(brace
id|IDX_MIXER_FMSYNTH
comma
id|MIXER_MUTE_MASK
op_or
l_int|0x1f1f
)brace
comma
(brace
id|IDX_MIXER_REC_VOLUME
comma
id|MIXER_MUTE_MASK
op_or
l_int|0x0707
)brace
comma
)brace
suffix:semicolon
DECL|function|snd_azf3328_mixer_new
r_static
r_int
id|__devinit
id|snd_azf3328_mixer_new
c_func
(paren
id|azf3328_t
op_star
id|chip
)paren
(brace
id|snd_card_t
op_star
id|card
suffix:semicolon
id|snd_kcontrol_new_t
op_star
id|sw
suffix:semicolon
r_int
r_int
id|idx
suffix:semicolon
r_int
id|err
suffix:semicolon
id|snd_azf3328_dbgcallenter
c_func
(paren
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|chip
op_ne
l_int|NULL
op_logical_and
id|chip-&gt;card
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|card
op_assign
id|chip-&gt;card
suffix:semicolon
multiline_comment|/* mixer reset */
id|snd_azf3328_mixer_write
c_func
(paren
id|chip
comma
id|IDX_MIXER_RESET
comma
l_int|0x0
comma
id|WORD_VALUE
)paren
suffix:semicolon
multiline_comment|/* mute and zero volume channels */
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|AZF3328_INIT_VALUES
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|snd_azf3328_mixer_write
c_func
(paren
id|chip
comma
id|snd_azf3328_init_values
(braket
id|idx
)braket
(braket
l_int|0
)braket
comma
id|snd_azf3328_init_values
(braket
id|idx
)braket
(braket
l_int|1
)braket
comma
id|WORD_VALUE
)paren
suffix:semicolon
)brace
multiline_comment|/* add mixer controls */
id|sw
op_assign
id|snd_azf3328_mixer_controls
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|ARRAY_SIZE
c_func
(paren
id|snd_azf3328_mixer_controls
)paren
suffix:semicolon
id|idx
op_increment
comma
id|sw
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|chip-&gt;card
comma
id|snd_ctl_new1
c_func
(paren
id|sw
comma
id|chip
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
id|snd_component_add
c_func
(paren
id|card
comma
l_string|&quot;AZF3328 mixer&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;mixername
comma
l_string|&quot;AZF3328 mixer&quot;
)paren
suffix:semicolon
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_azf3328_hw_params
r_static
r_int
id|snd_azf3328_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
r_int
id|res
suffix:semicolon
id|snd_azf3328_dbgcallenter
c_func
(paren
)paren
suffix:semicolon
id|res
op_assign
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|snd_azf3328_hw_free
r_static
r_int
id|snd_azf3328_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_azf3328_dbgcallenter
c_func
(paren
)paren
suffix:semicolon
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_azf3328_setfmt
r_static
r_void
id|snd_azf3328_setfmt
c_func
(paren
id|azf3328_t
op_star
id|chip
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|bitrate
comma
r_int
r_int
id|format_width
comma
r_int
r_int
id|channels
)paren
(brace
r_int
r_int
id|val
op_assign
l_int|0xff00
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|snd_azf3328_dbgcallenter
c_func
(paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|bitrate
)paren
(brace
r_case
l_int|5512
suffix:colon
id|val
op_or_assign
l_int|0x0d
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* the AZF3328 names it &quot;5510&quot; for some strange reason */
r_case
l_int|6620
suffix:colon
id|val
op_or_assign
l_int|0x0b
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8000
suffix:colon
id|val
op_or_assign
l_int|0x00
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|9600
suffix:colon
id|val
op_or_assign
l_int|0x08
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|11025
suffix:colon
id|val
op_or_assign
l_int|0x01
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|16000
suffix:colon
id|val
op_or_assign
l_int|0x02
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|22050
suffix:colon
id|val
op_or_assign
l_int|0x03
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32000
suffix:colon
id|val
op_or_assign
l_int|0x04
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|44100
suffix:colon
id|val
op_or_assign
l_int|0x05
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|48000
suffix:colon
id|val
op_or_assign
l_int|0x06
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|64000
suffix:colon
id|val
op_or_assign
l_int|0x07
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|snd_printk
c_func
(paren
l_string|&quot;unknown bitrate %d, assuming 44.1kHz!&bslash;n&quot;
comma
id|bitrate
)paren
suffix:semicolon
id|val
op_or_assign
l_int|0x05
suffix:semicolon
multiline_comment|/* 44100 */
r_break
suffix:semicolon
)brace
multiline_comment|/* val = 0xff07; 3m27.993s (65301Hz; -&gt; 64000Hz???) */
multiline_comment|/* val = 0xff09; 17m15.098s (13123,478Hz; -&gt; 12000Hz???) */
multiline_comment|/* val = 0xff0a; 47m30.599s (4764,891Hz; -&gt; 4800Hz???) */
multiline_comment|/* val = 0xff0c; 57m0.510s (4010,263Hz; -&gt; 4000Hz???) */
multiline_comment|/* val = 0xff05; 5m11.556s (... -&gt; 44100Hz) */
multiline_comment|/* val = 0xff03; 10m21.529s (21872,463Hz; -&gt; 22050Hz???) */
multiline_comment|/* val = 0xff0f; 20m41.883s (10937,993Hz; -&gt; 11025Hz???) */
multiline_comment|/* val = 0xff0d; 41m23.135s (5523,600Hz; -&gt; 5512Hz???) */
multiline_comment|/* val = 0xff0e; 28m30.777s (8017Hz; -&gt; 8000Hz???) */
r_if
c_cond
(paren
id|channels
op_eq
l_int|2
)paren
id|val
op_or_assign
id|SOUNDFORMAT_FLAG_2CHANNELS
suffix:semicolon
r_if
c_cond
(paren
id|format_width
op_eq
l_int|16
)paren
id|val
op_or_assign
id|SOUNDFORMAT_FLAG_16BIT
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* set bitrate/format */
id|outw
c_func
(paren
id|val
comma
id|chip-&gt;codec_port
op_plus
id|reg
)paren
suffix:semicolon
multiline_comment|/* changing the bitrate/format settings switches off the&n;&t; * audio output with an annoying click in case of 8/16bit format change&n;&t; * (maybe shutting down DAC/ADC?), thus immediately&n;&t; * do some tweaking to reenable it and get rid of the clicking&n;&t; * (FIXME: yes, it works, but what exactly am I doing here?? :)&n;&t; * FIXME: does this have some side effects for full-duplex&n;&t; * or other dramatic side effects? */
r_if
c_cond
(paren
id|reg
op_eq
id|IDX_IO_PLAY_SOUNDFORMAT
)paren
multiline_comment|/* only do it for playback */
id|outw
c_func
(paren
id|inw
c_func
(paren
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_FLAGS
)paren
op_or
id|DMA_PLAY_SOMETHING1
op_or
id|DMA_PLAY_SOMETHING2
op_or
id|SOMETHING_ALMOST_ALWAYS_SET
op_or
id|DMA_EPILOGUE_SOMETHING
op_or
id|DMA_SOMETHING_ELSE
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_FLAGS
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|snd_azf3328_setdmaa
r_static
r_void
id|snd_azf3328_setdmaa
c_func
(paren
id|azf3328_t
op_star
id|chip
comma
r_int
r_int
r_int
id|addr
comma
r_int
r_int
id|count
comma
r_int
r_int
id|size
comma
r_int
id|do_recording
)paren
(brace
r_int
r_int
r_int
id|addr1
suffix:semicolon
r_int
r_int
r_int
id|addr2
suffix:semicolon
r_int
r_int
id|count1
suffix:semicolon
r_int
r_int
id|count2
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|reg_offs
op_assign
id|do_recording
ques
c_cond
l_int|0x20
suffix:colon
l_int|0x00
suffix:semicolon
id|snd_azf3328_dbgcallenter
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* AZF3328 uses a two buffer pointer DMA playback approach */
r_if
c_cond
(paren
op_logical_neg
id|chip-&gt;is_playing
)paren
(brace
id|addr1
op_assign
id|addr
suffix:semicolon
id|addr2
op_assign
id|addr
op_plus
(paren
id|size
op_div
l_int|2
)paren
suffix:semicolon
id|count1
op_assign
(paren
id|size
op_div
l_int|2
)paren
op_minus
l_int|1
suffix:semicolon
id|count2
op_assign
(paren
id|size
op_div
l_int|2
)paren
op_minus
l_int|1
suffix:semicolon
macro_line|#if DEBUG_PLAY_REC
id|snd_azf3328_dbgplay
c_func
(paren
l_string|&quot;setting dma: buf1 %08lx[%d], buf2 %08lx[%d]&bslash;n&quot;
comma
id|addr1
comma
id|count1
comma
id|addr2
comma
id|count2
)paren
suffix:semicolon
macro_line|#endif
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|outl
c_func
(paren
id|addr1
comma
id|chip-&gt;codec_port
op_plus
id|reg_offs
op_plus
id|IDX_IO_PLAY_DMA_START_1
)paren
suffix:semicolon
id|outl
c_func
(paren
id|addr2
comma
id|chip-&gt;codec_port
op_plus
id|reg_offs
op_plus
id|IDX_IO_PLAY_DMA_START_2
)paren
suffix:semicolon
id|outw
c_func
(paren
id|count1
comma
id|chip-&gt;codec_port
op_plus
id|reg_offs
op_plus
id|IDX_IO_PLAY_DMA_LEN_1
)paren
suffix:semicolon
id|outw
c_func
(paren
id|count2
comma
id|chip-&gt;codec_port
op_plus
id|reg_offs
op_plus
id|IDX_IO_PLAY_DMA_LEN_2
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|snd_azf3328_playback_prepare
r_static
r_int
id|snd_azf3328_playback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
macro_line|#if 0
id|azf3328_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
r_int
id|size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|count
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
macro_line|#endif
id|snd_azf3328_dbgcallenter
c_func
(paren
)paren
suffix:semicolon
macro_line|#if 0
id|snd_azf3328_setfmt
c_func
(paren
id|chip
comma
id|IDX_IO_PLAY_SOUNDFORMAT
comma
id|runtime-&gt;rate
comma
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
comma
id|runtime-&gt;channels
)paren
suffix:semicolon
id|snd_azf3328_setdmaa
c_func
(paren
id|chip
comma
id|runtime-&gt;dma_addr
comma
id|count
comma
id|size
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_azf3328_capture_prepare
r_static
r_int
id|snd_azf3328_capture_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
macro_line|#if 0
id|azf3328_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
r_int
id|size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|count
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
macro_line|#endif
id|snd_azf3328_dbgcallenter
c_func
(paren
)paren
suffix:semicolon
macro_line|#if 0
id|snd_azf3328_setfmt
c_func
(paren
id|chip
comma
id|IDX_IO_REC_SOUNDFORMAT
comma
id|runtime-&gt;rate
comma
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
comma
id|runtime-&gt;channels
)paren
suffix:semicolon
id|snd_azf3328_setdmaa
c_func
(paren
id|chip
comma
id|runtime-&gt;dma_addr
comma
id|count
comma
id|size
comma
l_int|1
)paren
suffix:semicolon
macro_line|#endif
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_azf3328_playback_trigger
r_static
r_int
id|snd_azf3328_playback_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|azf3328_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|status1
suffix:semicolon
id|snd_azf3328_dbgcalls
c_func
(paren
l_string|&quot;snd_azf3328_playback_trigger cmd %d&bslash;n&quot;
comma
id|cmd
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
id|snd_azf3328_dbgio
c_func
(paren
id|chip
comma
l_string|&quot;trigger1&quot;
)paren
suffix:semicolon
multiline_comment|/* mute WaveOut */
id|snd_azf3328_mixer_set_mute
c_func
(paren
id|chip
comma
id|IDX_MIXER_WAVEOUT
comma
l_int|1
)paren
suffix:semicolon
id|snd_azf3328_setfmt
c_func
(paren
id|chip
comma
id|IDX_IO_PLAY_SOUNDFORMAT
comma
id|runtime-&gt;rate
comma
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
comma
id|runtime-&gt;channels
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
multiline_comment|/* stop playback */
id|status1
op_assign
id|inw
c_func
(paren
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_FLAGS
)paren
suffix:semicolon
id|status1
op_and_assign
op_complement
id|DMA_RESUME
suffix:semicolon
id|outw
c_func
(paren
id|status1
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_FLAGS
)paren
suffix:semicolon
multiline_comment|/* FIXME: clear interrupts or what??? */
id|outw
c_func
(paren
l_int|0xffff
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_IRQMASK
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|snd_azf3328_setdmaa
c_func
(paren
id|chip
comma
id|runtime-&gt;dma_addr
comma
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
comma
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
comma
l_int|0
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
macro_line|#ifdef WIN9X
multiline_comment|/* FIXME: enable playback/recording??? */
id|status1
op_or_assign
id|DMA_PLAY_SOMETHING1
op_or
id|DMA_PLAY_SOMETHING2
suffix:semicolon
id|outw
c_func
(paren
id|status1
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_FLAGS
)paren
suffix:semicolon
multiline_comment|/* start playback again */
multiline_comment|/* FIXME: what is this value (0x0010)??? */
id|status1
op_or_assign
id|DMA_RESUME
op_or
id|DMA_EPILOGUE_SOMETHING
suffix:semicolon
id|outw
c_func
(paren
id|status1
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_FLAGS
)paren
suffix:semicolon
macro_line|#else /* NT4 */
id|outw
c_func
(paren
l_int|0x00
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_FLAGS
)paren
suffix:semicolon
id|outw
c_func
(paren
id|DMA_PLAY_SOMETHING1
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_FLAGS
)paren
suffix:semicolon
id|outw
c_func
(paren
id|DMA_PLAY_SOMETHING1
op_or
id|DMA_PLAY_SOMETHING2
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_FLAGS
)paren
suffix:semicolon
id|outw
c_func
(paren
id|DMA_RESUME
op_or
id|SOMETHING_ALMOST_ALWAYS_SET
op_or
id|DMA_EPILOGUE_SOMETHING
op_or
id|DMA_SOMETHING_ELSE
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_FLAGS
)paren
suffix:semicolon
macro_line|#endif
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
multiline_comment|/* now unmute WaveOut */
id|snd_azf3328_mixer_set_mute
c_func
(paren
id|chip
comma
id|IDX_MIXER_WAVEOUT
comma
l_int|0
)paren
suffix:semicolon
id|snd_azf3328_dbgio
c_func
(paren
id|chip
comma
l_string|&quot;trigger2&quot;
)paren
suffix:semicolon
id|chip-&gt;is_playing
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
multiline_comment|/* mute WaveOut */
id|snd_azf3328_mixer_set_mute
c_func
(paren
id|chip
comma
id|IDX_MIXER_WAVEOUT
comma
l_int|1
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
multiline_comment|/* stop playback */
id|status1
op_assign
id|inw
c_func
(paren
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_FLAGS
)paren
suffix:semicolon
id|status1
op_and_assign
op_complement
id|DMA_RESUME
suffix:semicolon
id|outw
c_func
(paren
id|status1
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_FLAGS
)paren
suffix:semicolon
id|status1
op_or_assign
id|DMA_PLAY_SOMETHING1
suffix:semicolon
id|outw
c_func
(paren
id|status1
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_FLAGS
)paren
suffix:semicolon
id|status1
op_and_assign
op_complement
id|DMA_PLAY_SOMETHING1
suffix:semicolon
id|outw
c_func
(paren
id|status1
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_FLAGS
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
multiline_comment|/* now unmute WaveOut */
id|snd_azf3328_mixer_set_mute
c_func
(paren
id|chip
comma
id|IDX_MIXER_WAVEOUT
comma
l_int|0
)paren
suffix:semicolon
id|chip-&gt;is_playing
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_PUSH
suffix:colon
id|snd_printk
c_func
(paren
l_string|&quot;FIXME: SNDRV_PCM_TRIGGER_PAUSE_PUSH NIY!&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_RELEASE
suffix:colon
id|snd_printk
c_func
(paren
l_string|&quot;FIXME: SNDRV_PCM_TRIGGER_PAUSE_RELEASE NIY!&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/* this is just analogous to playback; I&squot;m not quite sure whether recording&n; * should actually be triggered like that */
DECL|function|snd_azf3328_capture_trigger
r_static
r_int
id|snd_azf3328_capture_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|azf3328_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|status1
suffix:semicolon
id|snd_azf3328_dbgcalls
c_func
(paren
l_string|&quot;snd_azf3328_capture_trigger cmd %d&bslash;n&quot;
comma
id|cmd
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
id|snd_azf3328_dbgio
c_func
(paren
id|chip
comma
l_string|&quot;trigger1&quot;
)paren
suffix:semicolon
id|snd_azf3328_setfmt
c_func
(paren
id|chip
comma
id|IDX_IO_REC_SOUNDFORMAT
comma
id|runtime-&gt;rate
comma
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
comma
id|runtime-&gt;channels
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
multiline_comment|/* stop recording */
id|status1
op_assign
id|inw
c_func
(paren
id|chip-&gt;codec_port
op_plus
id|IDX_IO_REC_FLAGS
)paren
suffix:semicolon
id|status1
op_and_assign
op_complement
id|DMA_RESUME
suffix:semicolon
id|outw
c_func
(paren
id|status1
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_REC_FLAGS
)paren
suffix:semicolon
multiline_comment|/* FIXME: clear interrupts or what??? */
id|outw
c_func
(paren
l_int|0xffff
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_REC_IRQMASK
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|snd_azf3328_setdmaa
c_func
(paren
id|chip
comma
id|runtime-&gt;dma_addr
comma
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
comma
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
comma
l_int|1
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
macro_line|#ifdef WIN9X
multiline_comment|/* FIXME: enable playback/recording??? */
id|status1
op_or_assign
id|DMA_PLAY_SOMETHING1
op_or
id|DMA_PLAY_SOMETHING2
suffix:semicolon
id|outw
c_func
(paren
id|status1
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_REC_FLAGS
)paren
suffix:semicolon
multiline_comment|/* start playback again */
multiline_comment|/* FIXME: what is this value (0x0010)??? */
id|status1
op_or_assign
id|DMA_RESUME
op_or
id|DMA_EPILOGUE_SOMETHING
suffix:semicolon
id|outw
c_func
(paren
id|status1
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_REC_FLAGS
)paren
suffix:semicolon
macro_line|#else
id|outw
c_func
(paren
l_int|0x00
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_REC_FLAGS
)paren
suffix:semicolon
id|outw
c_func
(paren
id|DMA_PLAY_SOMETHING1
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_REC_FLAGS
)paren
suffix:semicolon
id|outw
c_func
(paren
id|DMA_PLAY_SOMETHING1
op_or
id|DMA_PLAY_SOMETHING2
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_REC_FLAGS
)paren
suffix:semicolon
id|outw
c_func
(paren
id|DMA_RESUME
op_or
id|SOMETHING_ALMOST_ALWAYS_SET
op_or
id|DMA_EPILOGUE_SOMETHING
op_or
id|DMA_SOMETHING_ELSE
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_REC_FLAGS
)paren
suffix:semicolon
macro_line|#endif
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|snd_azf3328_dbgio
c_func
(paren
id|chip
comma
l_string|&quot;trigger2&quot;
)paren
suffix:semicolon
id|chip-&gt;is_playing
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
multiline_comment|/* stop recording */
id|status1
op_assign
id|inw
c_func
(paren
id|chip-&gt;codec_port
op_plus
id|IDX_IO_REC_FLAGS
)paren
suffix:semicolon
id|status1
op_and_assign
op_complement
id|DMA_RESUME
suffix:semicolon
id|outw
c_func
(paren
id|status1
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_REC_FLAGS
)paren
suffix:semicolon
id|status1
op_or_assign
id|DMA_PLAY_SOMETHING1
suffix:semicolon
id|outw
c_func
(paren
id|status1
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_REC_FLAGS
)paren
suffix:semicolon
id|status1
op_and_assign
op_complement
id|DMA_PLAY_SOMETHING1
suffix:semicolon
id|outw
c_func
(paren
id|status1
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_REC_FLAGS
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|chip-&gt;is_playing
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_PUSH
suffix:colon
id|snd_printk
c_func
(paren
l_string|&quot;FIXME: SNDRV_PCM_TRIGGER_PAUSE_PUSH NIY!&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_RELEASE
suffix:colon
id|snd_printk
c_func
(paren
l_string|&quot;FIXME: SNDRV_PCM_TRIGGER_PAUSE_RELEASE NIY!&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_azf3328_playback_pointer
r_static
id|snd_pcm_uframes_t
id|snd_azf3328_playback_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|azf3328_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|bufptr
comma
id|playptr
suffix:semicolon
r_int
r_int
id|result
suffix:semicolon
id|snd_pcm_uframes_t
id|frmres
suffix:semicolon
macro_line|#ifdef QUERY_HARDWARE
id|bufptr
op_assign
id|inl
c_func
(paren
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_DMA_START_1
)paren
suffix:semicolon
macro_line|#else
id|bufptr
op_assign
id|substream-&gt;runtime-&gt;dma_addr
suffix:semicolon
macro_line|#endif
id|playptr
op_assign
id|inl
c_func
(paren
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_DMA_CURRPOS
)paren
suffix:semicolon
id|result
op_assign
id|playptr
op_minus
id|bufptr
suffix:semicolon
id|frmres
op_assign
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|result
)paren
suffix:semicolon
id|snd_azf3328_dbgplay
c_func
(paren
l_string|&quot;result %lx, playptr %lx (base %x), frames %ld&bslash;n&quot;
comma
id|result
comma
id|playptr
comma
id|substream-&gt;runtime-&gt;dma_addr
comma
id|frmres
)paren
suffix:semicolon
r_return
id|frmres
suffix:semicolon
)brace
DECL|function|snd_azf3328_capture_pointer
r_static
id|snd_pcm_uframes_t
id|snd_azf3328_capture_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|azf3328_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|bufptr
comma
id|recptr
suffix:semicolon
r_int
r_int
id|result
suffix:semicolon
id|snd_pcm_uframes_t
id|frmres
suffix:semicolon
macro_line|#ifdef QUERY_HARDWARE
id|bufptr
op_assign
id|inl
c_func
(paren
id|chip-&gt;codec_port
op_plus
id|IDX_IO_REC_DMA_START_1
)paren
suffix:semicolon
macro_line|#else
id|bufptr
op_assign
id|substream-&gt;runtime-&gt;dma_addr
suffix:semicolon
macro_line|#endif
id|recptr
op_assign
id|inl
c_func
(paren
id|chip-&gt;codec_port
op_plus
id|IDX_IO_REC_DMA_CURRPOS
)paren
suffix:semicolon
id|result
op_assign
id|recptr
op_minus
id|bufptr
suffix:semicolon
id|frmres
op_assign
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|result
)paren
suffix:semicolon
id|snd_azf3328_dbgplay
c_func
(paren
l_string|&quot;result %lx, rec ptr %lx (base %x), frames %ld&bslash;n&quot;
comma
id|result
comma
id|recptr
comma
id|substream-&gt;runtime-&gt;dma_addr
comma
id|frmres
)paren
suffix:semicolon
r_return
id|frmres
suffix:semicolon
)brace
DECL|function|snd_azf3328_interrupt
r_static
id|irqreturn_t
id|snd_azf3328_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|azf3328_t
op_star
id|chip
op_assign
id|dev_id
suffix:semicolon
r_int
r_int
id|status
comma
id|which
suffix:semicolon
r_static
r_int
r_int
id|count
suffix:semicolon
id|status
op_assign
id|inw
c_func
(paren
id|chip-&gt;codec_port
op_plus
id|IDX_IO_IRQSTATUS
)paren
suffix:semicolon
multiline_comment|/* fast path out, to ease interrupt sharing */
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
(paren
id|IRQ_PLAYBACK
op_or
id|IRQ_RECORDING
op_or
id|IRQ_MPU401
op_or
id|IRQ_SOMEIRQ
)paren
)paren
)paren
r_return
id|IRQ_NONE
suffix:semicolon
multiline_comment|/* must be interrupt for another device */
id|snd_azf3328_dbgplay
c_func
(paren
l_string|&quot;Interrupt %ld!&bslash;nIDX_IO_PLAY_FLAGS %04x, IDX_IO_PLAY_IRQMASK %04x, IDX_IO_IRQSTATUS %04x&bslash;n&quot;
comma
id|count
comma
id|inw
c_func
(paren
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_FLAGS
)paren
comma
id|inw
c_func
(paren
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_IRQMASK
)paren
comma
id|inw
c_func
(paren
id|chip-&gt;codec_port
op_plus
id|IDX_IO_IRQSTATUS
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|IRQ_PLAYBACK
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|which
op_assign
id|inw
c_func
(paren
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_IRQMASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|which
op_amp
id|IRQ_FINISHED_PLAYBUF_1
)paren
multiline_comment|/* ack IRQ */
id|outw
c_func
(paren
id|which
op_or
id|IRQ_FINISHED_PLAYBUF_1
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_IRQMASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|which
op_amp
id|IRQ_FINISHED_PLAYBUF_2
)paren
multiline_comment|/* ack IRQ */
id|outw
c_func
(paren
id|which
op_or
id|IRQ_FINISHED_PLAYBUF_2
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_IRQMASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|which
op_amp
id|IRQ_PLAY_SOMETHING
)paren
(brace
id|snd_azf3328_dbgplay
c_func
(paren
l_string|&quot;azt3328: unknown play IRQ type occurred, please report!&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chip-&gt;pcm
op_logical_and
id|chip-&gt;playback_substream
)paren
(brace
id|snd_azf3328_dbgplay
c_func
(paren
l_string|&quot;which %x, playptr %lx&bslash;n&quot;
comma
id|which
comma
id|inl
c_func
(paren
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_DMA_CURRPOS
)paren
)paren
suffix:semicolon
id|snd_pcm_period_elapsed
c_func
(paren
id|chip-&gt;playback_substream
)paren
suffix:semicolon
id|snd_azf3328_dbgplay
c_func
(paren
l_string|&quot;period done, playptr %lx.&bslash;n&quot;
comma
id|inl
c_func
(paren
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_DMA_CURRPOS
)paren
)paren
suffix:semicolon
)brace
r_else
id|snd_azf3328_dbgplay
c_func
(paren
l_string|&quot;azt3328: ouch, irq handler problem!&bslash;n&quot;
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|IRQ_RECORDING
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|which
op_assign
id|inw
c_func
(paren
id|chip-&gt;codec_port
op_plus
id|IDX_IO_REC_IRQMASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|which
op_amp
id|IRQ_FINISHED_RECBUF_1
)paren
multiline_comment|/* ack interrupt */
id|outw
c_func
(paren
id|which
op_or
id|IRQ_FINISHED_RECBUF_1
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_REC_IRQMASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|which
op_amp
id|IRQ_FINISHED_RECBUF_2
)paren
multiline_comment|/* ack interrupt */
id|outw
c_func
(paren
id|which
op_or
id|IRQ_FINISHED_RECBUF_2
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_REC_IRQMASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|which
op_amp
id|IRQ_REC_SOMETHING
)paren
(brace
id|snd_azf3328_dbgplay
c_func
(paren
l_string|&quot;azt3328: unknown rec IRQ type occurred, please report!&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chip-&gt;pcm
op_logical_and
id|chip-&gt;capture_substream
)paren
(brace
id|snd_azf3328_dbgplay
c_func
(paren
l_string|&quot;which %x, recptr %lx&bslash;n&quot;
comma
id|which
comma
id|inl
c_func
(paren
id|chip-&gt;codec_port
op_plus
id|IDX_IO_REC_DMA_CURRPOS
)paren
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|snd_pcm_period_elapsed
c_func
(paren
id|chip-&gt;capture_substream
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|snd_azf3328_dbgplay
c_func
(paren
l_string|&quot;period done, recptr %lx.&bslash;n&quot;
comma
id|inl
c_func
(paren
id|chip-&gt;codec_port
op_plus
id|IDX_IO_REC_DMA_CURRPOS
)paren
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|IRQ_MPU401
)paren
id|snd_mpu401_uart_interrupt
c_func
(paren
id|irq
comma
id|chip-&gt;rmidi-&gt;private_data
comma
id|regs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|IRQ_SOMEIRQ
)paren
id|snd_azf3328_dbgplay
c_func
(paren
l_string|&quot;azt3328: unknown IRQ type occurred, please report!&bslash;n&quot;
)paren
suffix:semicolon
id|count
op_increment
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
multiline_comment|/*****************************************************************/
DECL|variable|snd_azf3328_playback
r_static
id|snd_pcm_hardware_t
id|snd_azf3328_playback
op_assign
(brace
multiline_comment|/* FIXME!! Correct? */
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_S8
op_or
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
op_or
id|SNDRV_PCM_FMTBIT_U16_LE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_8000_48000
op_or
id|SNDRV_PCM_RATE_64000
op_or
id|SNDRV_PCM_RATE_KNOT
comma
dot
id|rate_min
op_assign
l_int|5512
comma
dot
id|rate_max
op_assign
l_int|64000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
l_int|65536
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
l_int|65536
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|1024
comma
multiline_comment|/* FIXME: maybe that card actually has a FIFO?&n;&t; * Hmm, it seems newer revisions do have one, but we still don&squot;t know&n;&t; * its size... */
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|snd_azf3328_capture
r_static
id|snd_pcm_hardware_t
id|snd_azf3328_capture
op_assign
(brace
multiline_comment|/* FIXME */
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_S8
op_or
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
op_or
id|SNDRV_PCM_FMTBIT_U16_LE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_8000_48000
op_or
id|SNDRV_PCM_RATE_64000
op_or
id|SNDRV_PCM_RATE_KNOT
comma
dot
id|rate_min
op_assign
l_int|5512
comma
dot
id|rate_max
op_assign
l_int|64000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
l_int|65536
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
l_int|65536
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|1024
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|snd_azf3328_fixed_rates
r_static
r_int
r_int
id|snd_azf3328_fixed_rates
(braket
)braket
op_assign
(brace
l_int|5512
comma
l_int|6620
comma
l_int|8000
comma
l_int|9600
comma
l_int|11025
comma
l_int|16000
comma
l_int|22050
comma
l_int|32000
comma
l_int|44100
comma
l_int|48000
comma
l_int|64000
)brace
suffix:semicolon
DECL|variable|snd_azf3328_hw_constraints_rates
r_static
id|snd_pcm_hw_constraint_list_t
id|snd_azf3328_hw_constraints_rates
op_assign
(brace
dot
id|count
op_assign
id|ARRAY_SIZE
c_func
(paren
id|snd_azf3328_fixed_rates
)paren
comma
dot
id|list
op_assign
id|snd_azf3328_fixed_rates
comma
dot
id|mask
op_assign
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/*****************************************************************/
DECL|function|snd_azf3328_playback_open
r_static
r_int
id|snd_azf3328_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|azf3328_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_azf3328_dbgcallenter
c_func
(paren
)paren
suffix:semicolon
id|chip-&gt;playback_substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_azf3328_playback
suffix:semicolon
id|snd_pcm_hw_constraint_list
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
op_amp
id|snd_azf3328_hw_constraints_rates
)paren
suffix:semicolon
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_azf3328_capture_open
r_static
r_int
id|snd_azf3328_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|azf3328_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_azf3328_dbgcallenter
c_func
(paren
)paren
suffix:semicolon
id|chip-&gt;capture_substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_azf3328_capture
suffix:semicolon
id|snd_pcm_hw_constraint_list
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
op_amp
id|snd_azf3328_hw_constraints_rates
)paren
suffix:semicolon
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_azf3328_playback_close
r_static
r_int
id|snd_azf3328_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|azf3328_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_azf3328_dbgcallenter
c_func
(paren
)paren
suffix:semicolon
id|chip-&gt;playback_substream
op_assign
l_int|NULL
suffix:semicolon
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_azf3328_capture_close
r_static
r_int
id|snd_azf3328_capture_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|azf3328_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_azf3328_dbgcallenter
c_func
(paren
)paren
suffix:semicolon
id|chip-&gt;capture_substream
op_assign
l_int|NULL
suffix:semicolon
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/******************************************************************/
DECL|variable|snd_azf3328_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_azf3328_playback_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_azf3328_playback_open
comma
dot
id|close
op_assign
id|snd_azf3328_playback_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_azf3328_hw_params
comma
dot
id|hw_free
op_assign
id|snd_azf3328_hw_free
comma
dot
id|prepare
op_assign
id|snd_azf3328_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_azf3328_playback_trigger
comma
dot
id|pointer
op_assign
id|snd_azf3328_playback_pointer
)brace
suffix:semicolon
DECL|variable|snd_azf3328_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_azf3328_capture_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_azf3328_capture_open
comma
dot
id|close
op_assign
id|snd_azf3328_capture_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_azf3328_hw_params
comma
dot
id|hw_free
op_assign
id|snd_azf3328_hw_free
comma
dot
id|prepare
op_assign
id|snd_azf3328_capture_prepare
comma
dot
id|trigger
op_assign
id|snd_azf3328_capture_trigger
comma
dot
id|pointer
op_assign
id|snd_azf3328_capture_pointer
)brace
suffix:semicolon
DECL|function|snd_azf3328_pcm_free
r_static
r_void
id|snd_azf3328_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|azf3328_t
op_star
id|chip
op_assign
id|pcm-&gt;private_data
suffix:semicolon
id|chip-&gt;pcm
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_azf3328_pcm
r_static
r_int
id|__devinit
id|snd_azf3328_pcm
c_func
(paren
id|azf3328_t
op_star
id|chip
comma
r_int
id|device
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
id|snd_azf3328_dbgcallenter
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;AZF3328 DSP&quot;
comma
id|device
comma
l_int|1
comma
l_int|1
comma
op_amp
id|pcm
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_azf3328_playback_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_azf3328_capture_ops
)paren
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_azf3328_pcm_free
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
id|chip-&gt;card-&gt;shortname
)paren
suffix:semicolon
id|chip-&gt;pcm
op_assign
id|pcm
suffix:semicolon
id|snd_pcm_lib_preallocate_pages_for_all
c_func
(paren
id|pcm
comma
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|chip-&gt;pci
)paren
comma
l_int|64
op_star
l_int|1024
comma
l_int|64
op_star
l_int|1024
)paren
suffix:semicolon
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/******************************************************************/
DECL|function|snd_azf3328_free
r_static
r_int
id|snd_azf3328_free
c_func
(paren
id|azf3328_t
op_star
id|chip
)paren
(brace
r_if
c_cond
(paren
id|chip-&gt;irq
OL
l_int|0
)paren
r_goto
id|__end_hw
suffix:semicolon
multiline_comment|/* reset (close) mixer */
id|snd_azf3328_mixer_set_mute
c_func
(paren
id|chip
comma
id|IDX_MIXER_PLAY_MASTER
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* first mute master volume */
id|snd_azf3328_mixer_write
c_func
(paren
id|chip
comma
id|IDX_MIXER_RESET
comma
l_int|0x0
comma
id|WORD_VALUE
)paren
suffix:semicolon
multiline_comment|/* interrupt setup - mask everything */
multiline_comment|/* FIXME */
id|synchronize_irq
c_func
(paren
id|chip-&gt;irq
)paren
suffix:semicolon
id|__end_hw
suffix:colon
macro_line|#ifdef SUPPORT_JOYSTICK
r_if
c_cond
(paren
id|chip-&gt;res_joystick
)paren
(brace
id|gameport_unregister_port
c_func
(paren
op_amp
id|chip-&gt;gameport
)paren
suffix:semicolon
multiline_comment|/* disable gameport */
id|snd_azf3328_io2_write
c_func
(paren
id|chip
comma
id|IDX_IO2_LEGACY_ADDR
comma
id|snd_azf3328_io2_read
c_func
(paren
id|chip
comma
id|IDX_IO2_LEGACY_ADDR
)paren
op_amp
op_complement
id|LEGACY_JOY
)paren
suffix:semicolon
id|release_resource
c_func
(paren
id|chip-&gt;res_joystick
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|chip-&gt;res_joystick
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|chip-&gt;irq
op_ge
l_int|0
)paren
id|free_irq
c_func
(paren
id|chip-&gt;irq
comma
(paren
r_void
op_star
)paren
id|chip
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|chip-&gt;pci
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|chip-&gt;pci
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_azf3328_dev_free
r_static
r_int
id|snd_azf3328_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|azf3328_t
op_star
id|chip
op_assign
id|device-&gt;device_data
suffix:semicolon
r_return
id|snd_azf3328_free
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
macro_line|#if 0
multiline_comment|/* check whether a bit can be modified */
r_static
r_void
id|snd_azf3328_test_bit
c_func
(paren
r_int
r_int
id|reg
comma
r_int
id|bit
)paren
(brace
r_int
r_char
id|val
comma
id|valoff
comma
id|valon
suffix:semicolon
id|val
op_assign
id|inb
c_func
(paren
id|reg
)paren
suffix:semicolon
id|outb
c_func
(paren
id|val
op_amp
op_complement
(paren
l_int|1
op_lshift
id|bit
)paren
comma
id|reg
)paren
suffix:semicolon
id|valoff
op_assign
id|inb
c_func
(paren
id|reg
)paren
suffix:semicolon
id|outb
c_func
(paren
id|val
op_or
(paren
l_int|1
op_lshift
id|bit
)paren
comma
id|reg
)paren
suffix:semicolon
id|valon
op_assign
id|inb
c_func
(paren
id|reg
)paren
suffix:semicolon
id|outb
c_func
(paren
id|val
comma
id|reg
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;reg %04x bit %d: %02x %02x %02x&bslash;n&quot;
comma
id|reg
comma
id|bit
comma
id|val
comma
id|valoff
comma
id|valon
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|snd_azf3328_create
r_static
r_int
id|__devinit
id|snd_azf3328_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_struct
id|pci_dev
op_star
id|pci
comma
r_int
r_int
id|device_type
comma
id|azf3328_t
op_star
op_star
id|rchip
)paren
(brace
id|azf3328_t
op_star
id|chip
suffix:semicolon
r_int
id|err
suffix:semicolon
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
dot
id|dev_free
op_assign
id|snd_azf3328_dev_free
comma
)brace
suffix:semicolon
id|u16
id|tmp
suffix:semicolon
op_star
id|rchip
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pci
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|chip
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|chip
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip
op_eq
l_int|NULL
)paren
(brace
id|pci_disable_device
c_func
(paren
id|pci
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|spin_lock_init
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|chip-&gt;card
op_assign
id|card
suffix:semicolon
id|chip-&gt;pci
op_assign
id|pci
suffix:semicolon
id|chip-&gt;irq
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* check if we can restrict PCI DMA transfers to 24 bits */
r_if
c_cond
(paren
id|pci_set_dma_mask
c_func
(paren
id|pci
comma
l_int|0x00ffffff
)paren
OL
l_int|0
op_logical_or
id|pci_set_consistent_dma_mask
c_func
(paren
id|pci
comma
l_int|0x00ffffff
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;architecture does not support 24bit PCI busmaster DMA&bslash;n&quot;
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pci
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_request_regions
c_func
(paren
id|pci
comma
l_string|&quot;Aztech AZF3328&quot;
)paren
)paren
OL
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|chip
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pci
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|chip-&gt;codec_port
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
suffix:semicolon
id|chip-&gt;io2_port
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|1
)paren
suffix:semicolon
id|chip-&gt;mpu_port
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|2
)paren
suffix:semicolon
id|chip-&gt;synth_port
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|3
)paren
suffix:semicolon
id|chip-&gt;mixer_port
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|pci-&gt;irq
comma
id|snd_azf3328_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
id|card-&gt;shortname
comma
(paren
r_void
op_star
)paren
id|chip
)paren
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab IRQ %d&bslash;n&quot;
comma
id|pci-&gt;irq
)paren
suffix:semicolon
id|snd_azf3328_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|chip-&gt;irq
op_assign
id|pci-&gt;irq
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pci
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
id|chip-&gt;irq
)paren
suffix:semicolon
id|snd_azf3328_dbgmisc
c_func
(paren
l_string|&quot;codec_port 0x%lx, io2_port 0x%lx, mpu_port 0x%lx, synth_port 0x%lx, mixer_port 0x%lx, irq %d&bslash;n&quot;
comma
id|chip-&gt;codec_port
comma
id|chip-&gt;io2_port
comma
id|chip-&gt;mpu_port
comma
id|chip-&gt;synth_port
comma
id|chip-&gt;mixer_port
comma
id|chip-&gt;irq
)paren
suffix:semicolon
id|snd_azf3328_dbgmisc
c_func
(paren
l_string|&quot;io2 %02x %02x %02x %02x %02x %02x&bslash;n&quot;
comma
id|snd_azf3328_io2_read
c_func
(paren
id|chip
comma
l_int|0
)paren
comma
id|snd_azf3328_io2_read
c_func
(paren
id|chip
comma
l_int|1
)paren
comma
id|snd_azf3328_io2_read
c_func
(paren
id|chip
comma
l_int|2
)paren
comma
id|snd_azf3328_io2_read
c_func
(paren
id|chip
comma
l_int|3
)paren
comma
id|snd_azf3328_io2_read
c_func
(paren
id|chip
comma
l_int|4
)paren
comma
id|snd_azf3328_io2_read
c_func
(paren
id|chip
comma
l_int|5
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
op_le
l_int|0x01
suffix:semicolon
id|tmp
op_add_assign
l_int|1
)paren
id|snd_azf3328_dbgmisc
c_func
(paren
l_string|&quot;0x%02x: opl 0x%04x, mpu300 0x%04x, mpu310 0x%04x, mpu320 0x%04x, mpu330 0x%04x&bslash;n&quot;
comma
id|tmp
comma
id|inb
c_func
(paren
l_int|0x388
op_plus
id|tmp
)paren
comma
id|inb
c_func
(paren
l_int|0x300
op_plus
id|tmp
)paren
comma
id|inb
c_func
(paren
l_int|0x310
op_plus
id|tmp
)paren
comma
id|inb
c_func
(paren
l_int|0x320
op_plus
id|tmp
)paren
comma
id|inb
c_func
(paren
l_int|0x330
op_plus
id|tmp
)paren
)paren
suffix:semicolon
multiline_comment|/* create mixer interface &amp; switches */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_azf3328_mixer_new
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|chip
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_azf3328_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#if 0
multiline_comment|/* set very low bitrate to reduce noise and power consumption? */
id|snd_azf3328_setfmt
c_func
(paren
id|chip
comma
id|IDX_IO_PLAY_SOUNDFORMAT
comma
l_int|5512
comma
l_int|8
comma
l_int|1
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* standard chip init stuff */
id|spin_lock_irq
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|outb
c_func
(paren
id|DMA_PLAY_SOMETHING2
op_or
id|DMA_EPILOGUE_SOMETHING
op_or
id|DMA_SOMETHING_ELSE
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_PLAY_FLAGS
)paren
suffix:semicolon
id|outb
c_func
(paren
id|DMA_PLAY_SOMETHING2
op_or
id|DMA_EPILOGUE_SOMETHING
op_or
id|DMA_SOMETHING_ELSE
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_SOMETHING_FLAGS
)paren
suffix:semicolon
id|outb
c_func
(paren
id|DMA_PLAY_SOMETHING2
op_or
id|DMA_EPILOGUE_SOMETHING
op_or
id|DMA_SOMETHING_ELSE
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_REC_FLAGS
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x0
comma
id|chip-&gt;codec_port
op_plus
id|IDX_IO_IRQ63H
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|snd_card_set_dev
c_func
(paren
id|card
comma
op_amp
id|pci-&gt;dev
)paren
suffix:semicolon
op_star
id|rchip
op_assign
id|chip
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef SUPPORT_JOYSTICK
DECL|function|snd_azf3328_config_joystick
r_static
r_void
id|__devinit
id|snd_azf3328_config_joystick
c_func
(paren
id|azf3328_t
op_star
id|chip
comma
r_int
id|joystick
)paren
(brace
r_int
r_char
id|val
suffix:semicolon
r_if
c_cond
(paren
id|joystick
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|chip-&gt;res_joystick
op_assign
id|request_region
c_func
(paren
l_int|0x200
comma
l_int|8
comma
l_string|&quot;AZF3328 gameport&quot;
)paren
)paren
op_ne
l_int|NULL
)paren
id|chip-&gt;gameport.io
op_assign
l_int|0x200
suffix:semicolon
)brace
id|val
op_assign
id|inb
c_func
(paren
id|chip-&gt;io2_port
op_plus
id|IDX_IO2_LEGACY_ADDR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;res_joystick
)paren
id|val
op_or_assign
id|LEGACY_JOY
suffix:semicolon
r_else
id|val
op_and_assign
op_complement
id|LEGACY_JOY
suffix:semicolon
id|outb
c_func
(paren
id|val
comma
id|chip-&gt;io2_port
op_plus
id|IDX_IO2_LEGACY_ADDR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;res_joystick
)paren
id|gameport_register_port
c_func
(paren
op_amp
id|chip-&gt;gameport
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|snd_azf3328_probe
r_static
r_int
id|__devinit
id|snd_azf3328_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_const
r_struct
id|pci_device_id
op_star
id|pci_id
)paren
(brace
r_static
r_int
id|dev
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
id|azf3328_t
op_star
id|chip
suffix:semicolon
id|opl3_t
op_star
id|opl3
suffix:semicolon
r_int
id|err
suffix:semicolon
id|snd_azf3328_dbgcallenter
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_ge
id|SNDRV_CARDS
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|enable
(braket
id|dev
)braket
)paren
(brace
id|dev
op_increment
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|card
op_assign
id|snd_card_new
c_func
(paren
id|index
(braket
id|dev
)braket
comma
id|id
(braket
id|dev
)braket
comma
id|THIS_MODULE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;AZF3328&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;shortname
comma
l_string|&quot;Aztech AZF3328 (PCI168)&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_azf3328_create
c_func
(paren
id|card
comma
id|pci
comma
id|pci_id-&gt;driver_data
comma
op_amp
id|chip
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_mpu401_uart_new
c_func
(paren
id|card
comma
l_int|0
comma
id|MPU401_HW_MPU401
comma
id|chip-&gt;mpu_port
comma
l_int|1
comma
id|pci-&gt;irq
comma
l_int|0
comma
op_amp
id|chip-&gt;rmidi
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;azf3328: no MPU-401 device at 0x%lx?&bslash;n&quot;
comma
id|chip-&gt;mpu_port
)paren
suffix:semicolon
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_azf3328_pcm
c_func
(paren
id|chip
comma
l_int|0
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|snd_opl3_create
c_func
(paren
id|card
comma
id|chip-&gt;synth_port
comma
id|chip-&gt;synth_port
op_plus
l_int|2
comma
id|OPL3_HW_AUTO
comma
l_int|1
comma
op_amp
id|opl3
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;azf3328: no OPL3 device at 0x%lx-0x%lx?&bslash;n&quot;
comma
id|chip-&gt;synth_port
comma
id|chip-&gt;synth_port
op_plus
l_int|2
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_opl3_hwdep_new
c_func
(paren
id|opl3
comma
l_int|0
comma
l_int|1
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
)brace
id|snd_azf3328_dbgio
c_func
(paren
id|chip
comma
l_string|&quot;create&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;%s at 0x%lx, irq %i&quot;
comma
id|card-&gt;shortname
comma
id|chip-&gt;codec_port
comma
id|chip-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_card_register
c_func
(paren
id|card
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#ifdef MODULE
id|printk
c_func
(paren
l_string|&quot;azt3328: Experimental driver for Aztech AZF3328-based soundcards such as PCI168.&bslash;n&quot;
l_string|&quot;azt3328: ZERO support from Aztech: you might think hard about future purchase.&bslash;n&quot;
l_string|&quot;azt3328: Feel free to contact hw7oshyuv3001@sneakemail.com for bug reports etc.!&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef SUPPORT_JOYSTICK
id|snd_azf3328_config_joystick
c_func
(paren
id|chip
comma
id|joystick
(braket
id|dev
)braket
)paren
suffix:semicolon
macro_line|#endif
id|pci_set_drvdata
c_func
(paren
id|pci
comma
id|card
)paren
suffix:semicolon
id|dev
op_increment
suffix:semicolon
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_azf3328_remove
r_static
r_void
id|__devexit
id|snd_azf3328_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
id|snd_azf3328_dbgcallenter
c_func
(paren
)paren
suffix:semicolon
id|snd_card_free
c_func
(paren
id|pci_get_drvdata
c_func
(paren
id|pci
)paren
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci
comma
l_int|NULL
)paren
suffix:semicolon
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|driver
r_static
r_struct
id|pci_driver
id|driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;AZF3328&quot;
comma
dot
id|id_table
op_assign
id|snd_azf3328_ids
comma
dot
id|probe
op_assign
id|snd_azf3328_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|snd_azf3328_remove
)paren
comma
)brace
suffix:semicolon
DECL|function|alsa_card_azf3328_init
r_static
r_int
id|__init
id|alsa_card_azf3328_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
id|snd_azf3328_dbgcallenter
c_func
(paren
)paren
suffix:semicolon
id|err
op_assign
id|pci_module_init
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|alsa_card_azf3328_exit
r_static
r_void
id|__exit
id|alsa_card_azf3328_exit
c_func
(paren
r_void
)paren
(brace
id|snd_azf3328_dbgcallenter
c_func
(paren
)paren
suffix:semicolon
id|pci_unregister_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
id|snd_azf3328_dbgcallleave
c_func
(paren
)paren
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|alsa_card_azf3328_init
)paren
id|module_exit
c_func
(paren
id|alsa_card_azf3328_exit
)paren
eof
