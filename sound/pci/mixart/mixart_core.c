multiline_comment|/*&n; * Driver for Digigram miXart soundcards&n; *&n; * low level interface with interrupt handling and mail box implementation&n; *&n; * Copyright (c) 2003 by Digigram &lt;alsa@digigram.com&gt;&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &quot;mixart.h&quot;
macro_line|#include &quot;mixart_hwdep.h&quot;
macro_line|#include &quot;mixart_core.h&quot;
DECL|macro|MSG_TIMEOUT_JIFFIES
mdefine_line|#define MSG_TIMEOUT_JIFFIES         (400 * HZ) / 1000 /* 400 ms */
DECL|macro|MSG_DESCRIPTOR_SIZE
mdefine_line|#define MSG_DESCRIPTOR_SIZE         0x24
DECL|macro|MSG_HEADER_SIZE
mdefine_line|#define MSG_HEADER_SIZE             (MSG_DESCRIPTOR_SIZE + 4)
DECL|macro|MSG_DEFAULT_SIZE
mdefine_line|#define MSG_DEFAULT_SIZE            512
DECL|macro|MSG_TYPE_MASK
mdefine_line|#define MSG_TYPE_MASK               0x00000003    /* mask for following types */
DECL|macro|MSG_TYPE_NOTIFY
mdefine_line|#define MSG_TYPE_NOTIFY             0             /* embedded -&gt; driver (only notification, do not get_msg() !) */
DECL|macro|MSG_TYPE_COMMAND
mdefine_line|#define MSG_TYPE_COMMAND            1             /* driver &lt;-&gt; embedded (a command has no answer) */
DECL|macro|MSG_TYPE_REQUEST
mdefine_line|#define MSG_TYPE_REQUEST            2             /* driver -&gt; embedded (request will get an answer back) */
DECL|macro|MSG_TYPE_ANSWER
mdefine_line|#define MSG_TYPE_ANSWER             3             /* embedded -&gt; driver */
DECL|macro|MSG_CANCEL_NOTIFY_MASK
mdefine_line|#define MSG_CANCEL_NOTIFY_MASK      0x80000000    /* this bit is set for a notification that has been canceled */
DECL|function|retrieve_msg_frame
r_static
r_int
id|retrieve_msg_frame
c_func
(paren
id|mixart_mgr_t
op_star
id|mgr
comma
id|u32
op_star
id|msg_frame
)paren
(brace
multiline_comment|/* read the message frame fifo */
id|u32
id|headptr
comma
id|tailptr
suffix:semicolon
id|tailptr
op_assign
id|readl_be
c_func
(paren
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|MSG_OUTBOUND_POST_TAIL
)paren
)paren
suffix:semicolon
id|headptr
op_assign
id|readl_be
c_func
(paren
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|MSG_OUTBOUND_POST_HEAD
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tailptr
op_eq
id|headptr
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* no message posted */
id|snd_assert
c_func
(paren
id|tailptr
op_ge
id|MSG_OUTBOUND_POST_STACK
comma
r_return
l_int|0
)paren
suffix:semicolon
multiline_comment|/* error */
id|snd_assert
c_func
(paren
id|tailptr
OL
(paren
id|MSG_OUTBOUND_POST_STACK
op_plus
id|MSG_BOUND_STACK_SIZE
)paren
comma
r_return
l_int|0
)paren
suffix:semicolon
multiline_comment|/* error */
op_star
id|msg_frame
op_assign
id|readl_be
c_func
(paren
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|tailptr
)paren
)paren
suffix:semicolon
multiline_comment|/* increment the tail index */
id|tailptr
op_add_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|tailptr
op_ge
(paren
id|MSG_OUTBOUND_POST_STACK
op_plus
id|MSG_BOUND_STACK_SIZE
)paren
)paren
(brace
id|tailptr
op_assign
id|MSG_OUTBOUND_POST_STACK
suffix:semicolon
)brace
id|writel_be
c_func
(paren
id|tailptr
comma
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|MSG_OUTBOUND_POST_TAIL
)paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|get_msg
r_static
r_int
id|get_msg
c_func
(paren
id|mixart_mgr_t
op_star
id|mgr
comma
id|mixart_msg_t
op_star
id|resp
comma
id|u32
id|msg_frame_address
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|u32
id|headptr
suffix:semicolon
id|u32
id|size
suffix:semicolon
r_int
id|err
suffix:semicolon
macro_line|#ifndef __BIG_ENDIAN
r_int
r_int
id|i
suffix:semicolon
macro_line|#endif
id|spin_lock_irqsave
c_func
(paren
op_amp
id|mgr-&gt;msg_lock
comma
id|flags
)paren
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* copy message descriptor from miXart to driver */
id|size
op_assign
id|readl_be
c_func
(paren
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|msg_frame_address
)paren
)paren
suffix:semicolon
multiline_comment|/* size of descriptor + response */
id|resp-&gt;message_id
op_assign
id|readl_be
c_func
(paren
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|msg_frame_address
op_plus
l_int|4
)paren
)paren
suffix:semicolon
multiline_comment|/* dwMessageID */
id|resp-&gt;uid.object_id
op_assign
id|readl_be
c_func
(paren
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|msg_frame_address
op_plus
l_int|8
)paren
)paren
suffix:semicolon
multiline_comment|/* uidDest */
id|resp-&gt;uid.desc
op_assign
id|readl_be
c_func
(paren
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|msg_frame_address
op_plus
l_int|12
)paren
)paren
suffix:semicolon
multiline_comment|/* */
r_if
c_cond
(paren
(paren
id|size
OL
id|MSG_DESCRIPTOR_SIZE
)paren
op_logical_or
(paren
id|resp-&gt;size
OL
(paren
id|size
op_minus
id|MSG_DESCRIPTOR_SIZE
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;problem with response size = %d&bslash;n&quot;
comma
id|size
)paren
suffix:semicolon
r_goto
id|_clean_exit
suffix:semicolon
)brace
id|size
op_sub_assign
id|MSG_DESCRIPTOR_SIZE
suffix:semicolon
id|memcpy_fromio
c_func
(paren
id|resp-&gt;data
comma
(paren
r_void
op_star
)paren
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|msg_frame_address
op_plus
id|MSG_HEADER_SIZE
)paren
comma
id|size
)paren
suffix:semicolon
id|resp-&gt;size
op_assign
id|size
suffix:semicolon
multiline_comment|/* swap if necessary */
macro_line|#ifndef __BIG_ENDIAN
id|size
op_div_assign
l_int|4
suffix:semicolon
multiline_comment|/* u32 size */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
id|i
op_increment
)paren
(brace
(paren
(paren
id|u32
op_star
)paren
id|resp-&gt;data
)paren
(braket
id|i
)braket
op_assign
id|be32_to_cpu
c_func
(paren
(paren
(paren
id|u32
op_star
)paren
id|resp-&gt;data
)paren
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n;&t; * free message frame address&n;&t; */
id|headptr
op_assign
id|readl_be
c_func
(paren
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|MSG_OUTBOUND_FREE_HEAD
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|headptr
OL
id|MSG_OUTBOUND_FREE_STACK
)paren
op_logical_or
(paren
id|headptr
op_ge
(paren
id|MSG_OUTBOUND_FREE_STACK
op_plus
id|MSG_BOUND_STACK_SIZE
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|_clean_exit
suffix:semicolon
)brace
multiline_comment|/* give address back to outbound fifo */
id|writel_be
c_func
(paren
id|msg_frame_address
comma
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|headptr
)paren
)paren
suffix:semicolon
multiline_comment|/* increment the outbound free head */
id|headptr
op_add_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|headptr
op_ge
(paren
id|MSG_OUTBOUND_FREE_STACK
op_plus
id|MSG_BOUND_STACK_SIZE
)paren
)paren
(brace
id|headptr
op_assign
id|MSG_OUTBOUND_FREE_STACK
suffix:semicolon
)brace
id|writel_be
c_func
(paren
id|headptr
comma
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|MSG_OUTBOUND_FREE_HEAD
)paren
)paren
suffix:semicolon
id|_clean_exit
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|mgr-&gt;msg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; * send a message to miXart. return: the msg_frame used for this message&n; */
multiline_comment|/* call with mgr-&gt;msg_lock held! */
DECL|function|send_msg
r_static
r_int
id|send_msg
c_func
(paren
id|mixart_mgr_t
op_star
id|mgr
comma
id|mixart_msg_t
op_star
id|msg
comma
r_int
id|max_answersize
comma
r_int
id|mark_pending
comma
id|u32
op_star
id|msg_event
)paren
(brace
id|u32
id|headptr
comma
id|tailptr
suffix:semicolon
id|u32
id|msg_frame_address
suffix:semicolon
r_int
id|err
comma
id|i
suffix:semicolon
id|snd_assert
c_func
(paren
id|msg-&gt;size
op_mod
l_int|4
op_eq
l_int|0
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|err
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* get message frame address */
id|tailptr
op_assign
id|readl_be
c_func
(paren
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|MSG_INBOUND_FREE_TAIL
)paren
)paren
suffix:semicolon
id|headptr
op_assign
id|readl_be
c_func
(paren
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|MSG_INBOUND_FREE_HEAD
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tailptr
op_eq
id|headptr
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;error: no message frame available&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tailptr
OL
id|MSG_INBOUND_FREE_STACK
)paren
op_logical_or
(paren
id|tailptr
op_ge
(paren
id|MSG_INBOUND_FREE_STACK
op_plus
id|MSG_BOUND_STACK_SIZE
)paren
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|msg_frame_address
op_assign
id|readl_be
c_func
(paren
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|tailptr
)paren
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|tailptr
)paren
)paren
suffix:semicolon
multiline_comment|/* set address to zero on this fifo position */
multiline_comment|/* increment the inbound free tail */
id|tailptr
op_add_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|tailptr
op_ge
(paren
id|MSG_INBOUND_FREE_STACK
op_plus
id|MSG_BOUND_STACK_SIZE
)paren
)paren
(brace
id|tailptr
op_assign
id|MSG_INBOUND_FREE_STACK
suffix:semicolon
)brace
id|writel_be
c_func
(paren
id|tailptr
comma
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|MSG_INBOUND_FREE_TAIL
)paren
)paren
suffix:semicolon
multiline_comment|/* TODO : use memcpy_toio() with intermediate buffer to copy the message */
multiline_comment|/* copy message descriptor to card memory */
id|writel_be
c_func
(paren
id|msg-&gt;size
op_plus
id|MSG_DESCRIPTOR_SIZE
comma
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|msg_frame_address
)paren
)paren
suffix:semicolon
multiline_comment|/* size of descriptor + request */
id|writel_be
c_func
(paren
id|msg-&gt;message_id
comma
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|msg_frame_address
op_plus
l_int|4
)paren
)paren
suffix:semicolon
multiline_comment|/* dwMessageID */
id|writel_be
c_func
(paren
id|msg-&gt;uid.object_id
comma
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|msg_frame_address
op_plus
l_int|8
)paren
)paren
suffix:semicolon
multiline_comment|/* uidDest */
id|writel_be
c_func
(paren
id|msg-&gt;uid.desc
comma
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|msg_frame_address
op_plus
l_int|12
)paren
)paren
suffix:semicolon
multiline_comment|/* */
id|writel_be
c_func
(paren
id|MSG_DESCRIPTOR_SIZE
comma
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|msg_frame_address
op_plus
l_int|16
)paren
)paren
suffix:semicolon
multiline_comment|/* SizeHeader */
id|writel_be
c_func
(paren
id|MSG_DESCRIPTOR_SIZE
comma
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|msg_frame_address
op_plus
l_int|20
)paren
)paren
suffix:semicolon
multiline_comment|/* OffsetDLL_T16 */
id|writel_be
c_func
(paren
id|msg-&gt;size
comma
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|msg_frame_address
op_plus
l_int|24
)paren
)paren
suffix:semicolon
multiline_comment|/* SizeDLL_T16 */
id|writel_be
c_func
(paren
id|MSG_DESCRIPTOR_SIZE
comma
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|msg_frame_address
op_plus
l_int|28
)paren
)paren
suffix:semicolon
multiline_comment|/* OffsetDLL_DRV */
id|writel_be
c_func
(paren
l_int|0
comma
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|msg_frame_address
op_plus
l_int|32
)paren
)paren
suffix:semicolon
multiline_comment|/* SizeDLL_DRV */
id|writel_be
c_func
(paren
id|MSG_DESCRIPTOR_SIZE
op_plus
id|max_answersize
comma
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|msg_frame_address
op_plus
l_int|36
)paren
)paren
suffix:semicolon
multiline_comment|/* dwExpectedAnswerSize */
multiline_comment|/* copy message data to card memory */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|msg-&gt;size
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
(brace
id|writel_be
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
(paren
id|msg-&gt;data
op_plus
id|i
)paren
comma
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|MSG_HEADER_SIZE
op_plus
id|msg_frame_address
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mark_pending
)paren
(brace
r_if
c_cond
(paren
op_star
id|msg_event
)paren
(brace
multiline_comment|/* the pending event is the notification we wait for ! */
id|mgr-&gt;pending_event
op_assign
op_star
id|msg_event
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* the pending event is the answer we wait for (same address than the request)! */
id|mgr-&gt;pending_event
op_assign
id|msg_frame_address
suffix:semicolon
multiline_comment|/* copy address back to caller */
op_star
id|msg_event
op_assign
id|msg_frame_address
suffix:semicolon
)brace
)brace
multiline_comment|/* mark the frame as a request (will have an answer) */
id|msg_frame_address
op_or_assign
id|MSG_TYPE_REQUEST
suffix:semicolon
multiline_comment|/* post the frame */
id|headptr
op_assign
id|readl_be
c_func
(paren
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|MSG_INBOUND_POST_HEAD
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|headptr
OL
id|MSG_INBOUND_POST_STACK
)paren
op_logical_or
(paren
id|headptr
op_ge
(paren
id|MSG_INBOUND_POST_STACK
op_plus
id|MSG_BOUND_STACK_SIZE
)paren
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|writel_be
c_func
(paren
id|msg_frame_address
comma
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|headptr
)paren
)paren
suffix:semicolon
multiline_comment|/* increment the inbound post head */
id|headptr
op_add_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|headptr
op_ge
(paren
id|MSG_INBOUND_POST_STACK
op_plus
id|MSG_BOUND_STACK_SIZE
)paren
)paren
(brace
id|headptr
op_assign
id|MSG_INBOUND_POST_STACK
suffix:semicolon
)brace
id|writel_be
c_func
(paren
id|headptr
comma
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|MSG_INBOUND_POST_HEAD
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_mixart_send_msg
r_int
id|snd_mixart_send_msg
c_func
(paren
id|mixart_mgr_t
op_star
id|mgr
comma
id|mixart_msg_t
op_star
id|request
comma
r_int
id|max_resp_size
comma
r_void
op_star
id|resp_data
)paren
(brace
id|mixart_msg_t
id|resp
suffix:semicolon
id|u32
id|msg_frame
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* set to 0, so it&squot;s no notification to wait for, but the answer */
r_int
id|err
suffix:semicolon
id|wait_queue_t
id|wait
suffix:semicolon
r_int
id|timeout
suffix:semicolon
id|down
c_func
(paren
op_amp
id|mgr-&gt;msg_mutex
)paren
suffix:semicolon
id|init_waitqueue_entry
c_func
(paren
op_amp
id|wait
comma
id|current
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|mgr-&gt;msg_lock
)paren
suffix:semicolon
multiline_comment|/* send the message */
id|err
op_assign
id|send_msg
c_func
(paren
id|mgr
comma
id|request
comma
id|max_resp_size
comma
l_int|1
comma
op_amp
id|msg_frame
)paren
suffix:semicolon
multiline_comment|/* send and mark the answer pending */
r_if
c_cond
(paren
id|err
)paren
(brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|mgr-&gt;msg_lock
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|mgr-&gt;msg_mutex
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|mgr-&gt;msg_sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|mgr-&gt;msg_lock
)paren
suffix:semicolon
id|timeout
op_assign
id|schedule_timeout
c_func
(paren
id|MSG_TIMEOUT_JIFFIES
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|mgr-&gt;msg_sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|timeout
)paren
(brace
multiline_comment|/* error - no ack */
id|up
c_func
(paren
op_amp
id|mgr-&gt;msg_mutex
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;error: no reponse on msg %x&bslash;n&quot;
comma
id|msg_frame
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/* retrieve the answer into the same mixart_msg_t */
id|resp.message_id
op_assign
l_int|0
suffix:semicolon
id|resp.uid
op_assign
(paren
id|mixart_uid_t
)paren
(brace
l_int|0
comma
l_int|0
)brace
suffix:semicolon
id|resp.data
op_assign
id|resp_data
suffix:semicolon
id|resp.size
op_assign
id|max_resp_size
suffix:semicolon
id|err
op_assign
id|get_msg
c_func
(paren
id|mgr
comma
op_amp
id|resp
comma
id|msg_frame
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request-&gt;message_id
op_ne
id|resp.message_id
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;REPONSE ERROR!&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|mgr-&gt;msg_mutex
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|snd_mixart_send_msg_wait_notif
r_int
id|snd_mixart_send_msg_wait_notif
c_func
(paren
id|mixart_mgr_t
op_star
id|mgr
comma
id|mixart_msg_t
op_star
id|request
comma
id|u32
id|notif_event
)paren
(brace
r_int
id|err
suffix:semicolon
id|wait_queue_t
id|wait
suffix:semicolon
r_int
id|timeout
suffix:semicolon
id|snd_assert
c_func
(paren
id|notif_event
op_ne
l_int|0
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
(paren
id|notif_event
op_amp
id|MSG_TYPE_MASK
)paren
op_eq
id|MSG_TYPE_NOTIFY
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
(paren
id|notif_event
op_amp
id|MSG_CANCEL_NOTIFY_MASK
)paren
op_eq
l_int|0
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|mgr-&gt;msg_mutex
)paren
suffix:semicolon
id|init_waitqueue_entry
c_func
(paren
op_amp
id|wait
comma
id|current
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|mgr-&gt;msg_lock
)paren
suffix:semicolon
multiline_comment|/* send the message */
id|err
op_assign
id|send_msg
c_func
(paren
id|mgr
comma
id|request
comma
id|MSG_DEFAULT_SIZE
comma
l_int|1
comma
op_amp
id|notif_event
)paren
suffix:semicolon
multiline_comment|/* send and mark the notification event pending */
r_if
c_cond
(paren
id|err
)paren
(brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|mgr-&gt;msg_lock
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|mgr-&gt;msg_mutex
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|mgr-&gt;msg_sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|mgr-&gt;msg_lock
)paren
suffix:semicolon
id|timeout
op_assign
id|schedule_timeout
c_func
(paren
id|MSG_TIMEOUT_JIFFIES
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|mgr-&gt;msg_sleep
comma
op_amp
id|wait
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|timeout
)paren
(brace
multiline_comment|/* error - no ack */
id|up
c_func
(paren
op_amp
id|mgr-&gt;msg_mutex
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;error: notification %x not received&bslash;n&quot;
comma
id|notif_event
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|mgr-&gt;msg_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_mixart_send_msg_nonblock
r_int
id|snd_mixart_send_msg_nonblock
c_func
(paren
id|mixart_mgr_t
op_star
id|mgr
comma
id|mixart_msg_t
op_star
id|request
)paren
(brace
id|u32
id|message_frame
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* just send the message (do not mark it as a pending one) */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|mgr-&gt;msg_lock
comma
id|flags
)paren
suffix:semicolon
id|err
op_assign
id|send_msg
c_func
(paren
id|mgr
comma
id|request
comma
id|MSG_DEFAULT_SIZE
comma
l_int|0
comma
op_amp
id|message_frame
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|mgr-&gt;msg_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* the answer will be handled by snd_mixart_msg_tasklet()  */
id|atomic_inc
c_func
(paren
op_amp
id|mgr-&gt;msg_processed
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* common buffer of tasklet and interrupt to send/receive messages */
DECL|variable|mixart_msg_data
r_static
id|u32
id|mixart_msg_data
(braket
id|MSG_DEFAULT_SIZE
op_div
l_int|4
)braket
suffix:semicolon
DECL|function|snd_mixart_msg_tasklet
r_void
id|snd_mixart_msg_tasklet
c_func
(paren
r_int
r_int
id|arg
)paren
(brace
id|mixart_mgr_t
op_star
id|mgr
op_assign
(paren
id|mixart_mgr_t
op_star
)paren
(paren
id|arg
)paren
suffix:semicolon
id|mixart_msg_t
id|resp
suffix:semicolon
id|u32
id|msg
comma
id|addr
comma
id|type
suffix:semicolon
r_int
id|err
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|mgr-&gt;lock
)paren
suffix:semicolon
r_while
c_loop
(paren
id|mgr-&gt;msg_fifo_readptr
op_ne
id|mgr-&gt;msg_fifo_writeptr
)paren
(brace
id|msg
op_assign
id|mgr-&gt;msg_fifo
(braket
id|mgr-&gt;msg_fifo_readptr
)braket
suffix:semicolon
id|mgr-&gt;msg_fifo_readptr
op_increment
suffix:semicolon
id|mgr-&gt;msg_fifo_readptr
op_mod_assign
id|MSG_FIFO_SIZE
suffix:semicolon
multiline_comment|/* process the message ... */
id|addr
op_assign
id|msg
op_amp
op_complement
id|MSG_TYPE_MASK
suffix:semicolon
id|type
op_assign
id|msg
op_amp
id|MSG_TYPE_MASK
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|MSG_TYPE_ANSWER
suffix:colon
multiline_comment|/* answer to a message on that we did not wait for (send_msg_nonblock) */
id|resp.message_id
op_assign
l_int|0
suffix:semicolon
id|resp.data
op_assign
id|mixart_msg_data
suffix:semicolon
id|resp.size
op_assign
r_sizeof
(paren
id|mixart_msg_data
)paren
suffix:semicolon
id|err
op_assign
id|get_msg
c_func
(paren
id|mgr
comma
op_amp
id|resp
comma
id|addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;tasklet: error(%d) reading mf %x&bslash;n&quot;
comma
id|err
comma
id|msg
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|resp.message_id
)paren
(brace
r_case
id|MSG_STREAM_START_INPUT_STAGE_PACKET
suffix:colon
r_case
id|MSG_STREAM_START_OUTPUT_STAGE_PACKET
suffix:colon
r_case
id|MSG_STREAM_STOP_INPUT_STAGE_PACKET
suffix:colon
r_case
id|MSG_STREAM_STOP_OUTPUT_STAGE_PACKET
suffix:colon
r_if
c_cond
(paren
id|mixart_msg_data
(braket
l_int|0
)braket
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;tasklet : error MSG_STREAM_ST***_***PUT_STAGE_PACKET status=%x&bslash;n&quot;
comma
id|mixart_msg_data
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|snd_printdd
c_func
(paren
l_string|&quot;tasklet received mf(%x) : msg_id(%x) uid(%x, %x) size(%zd)&bslash;n&quot;
comma
id|msg
comma
id|resp.message_id
comma
id|resp.uid.object_id
comma
id|resp.uid.desc
comma
id|resp.size
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|MSG_TYPE_NOTIFY
suffix:colon
multiline_comment|/* msg contains no address ! do not get_msg() ! */
r_case
id|MSG_TYPE_COMMAND
suffix:colon
multiline_comment|/* get_msg() necessary */
r_default
suffix:colon
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;tasklet doesn&squot;t know what to do with message %x&bslash;n&quot;
comma
id|msg
)paren
suffix:semicolon
)brace
multiline_comment|/* switch type */
multiline_comment|/* decrement counter */
id|atomic_dec
c_func
(paren
op_amp
id|mgr-&gt;msg_processed
)paren
suffix:semicolon
)brace
multiline_comment|/* while there is a msg in fifo */
id|spin_unlock
c_func
(paren
op_amp
id|mgr-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|snd_mixart_interrupt
id|irqreturn_t
id|snd_mixart_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|mixart_mgr_t
op_star
id|mgr
op_assign
id|dev_id
suffix:semicolon
r_int
id|err
suffix:semicolon
id|mixart_msg_t
id|resp
suffix:semicolon
id|u32
id|msg
suffix:semicolon
id|u32
id|it_reg
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|mgr-&gt;lock
)paren
suffix:semicolon
id|it_reg
op_assign
id|readl_le
c_func
(paren
id|MIXART_REG
c_func
(paren
id|mgr
comma
id|MIXART_PCI_OMISR_OFFSET
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|it_reg
op_amp
id|MIXART_OIDI
)paren
)paren
(brace
multiline_comment|/* this device did not cause the interrupt */
id|spin_unlock
c_func
(paren
op_amp
id|mgr-&gt;lock
)paren
suffix:semicolon
r_return
id|IRQ_NONE
suffix:semicolon
)brace
multiline_comment|/* mask all interrupts */
id|writel_le
c_func
(paren
id|MIXART_HOST_ALL_INTERRUPT_MASKED
comma
id|MIXART_REG
c_func
(paren
id|mgr
comma
id|MIXART_PCI_OMIMR_OFFSET
)paren
)paren
suffix:semicolon
multiline_comment|/* outdoorbell register clear */
id|it_reg
op_assign
id|readl
c_func
(paren
id|MIXART_REG
c_func
(paren
id|mgr
comma
id|MIXART_PCI_ODBR_OFFSET
)paren
)paren
suffix:semicolon
id|writel
c_func
(paren
id|it_reg
comma
id|MIXART_REG
c_func
(paren
id|mgr
comma
id|MIXART_PCI_ODBR_OFFSET
)paren
)paren
suffix:semicolon
multiline_comment|/* clear interrupt */
id|writel_le
c_func
(paren
id|MIXART_OIDI
comma
id|MIXART_REG
c_func
(paren
id|mgr
comma
id|MIXART_PCI_OMISR_OFFSET
)paren
)paren
suffix:semicolon
multiline_comment|/* process interrupt */
r_while
c_loop
(paren
id|retrieve_msg_frame
c_func
(paren
id|mgr
comma
op_amp
id|msg
)paren
)paren
(brace
r_switch
c_cond
(paren
id|msg
op_amp
id|MSG_TYPE_MASK
)paren
(brace
r_case
id|MSG_TYPE_COMMAND
suffix:colon
id|resp.message_id
op_assign
l_int|0
suffix:semicolon
id|resp.data
op_assign
id|mixart_msg_data
suffix:semicolon
id|resp.size
op_assign
r_sizeof
(paren
id|mixart_msg_data
)paren
suffix:semicolon
id|err
op_assign
id|get_msg
c_func
(paren
id|mgr
comma
op_amp
id|resp
comma
id|msg
op_amp
op_complement
id|MSG_TYPE_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;interrupt: error(%d) reading mf %x&bslash;n&quot;
comma
id|err
comma
id|msg
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|resp.message_id
op_eq
id|MSG_SERVICES_TIMER_NOTIFY
)paren
(brace
r_int
id|i
suffix:semicolon
id|mixart_timer_notify_t
op_star
id|notify
op_assign
(paren
id|mixart_timer_notify_t
op_star
)paren
id|mixart_msg_data
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|notify-&gt;stream_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|u32
id|buffer_id
op_assign
id|notify-&gt;streams
(braket
id|i
)braket
dot
id|buffer_id
suffix:semicolon
r_int
r_int
id|chip_number
op_assign
(paren
id|buffer_id
op_amp
id|MIXART_NOTIFY_CARD_MASK
)paren
op_rshift
id|MIXART_NOTIFY_CARD_OFFSET
suffix:semicolon
multiline_comment|/* card0 to 3 */
r_int
r_int
id|pcm_number
op_assign
(paren
id|buffer_id
op_amp
id|MIXART_NOTIFY_PCM_MASK
)paren
op_rshift
id|MIXART_NOTIFY_PCM_OFFSET
suffix:semicolon
multiline_comment|/* pcm0 to 3  */
r_int
r_int
id|sub_number
op_assign
id|buffer_id
op_amp
id|MIXART_NOTIFY_SUBS_MASK
suffix:semicolon
multiline_comment|/* 0 to MIXART_PLAYBACK_STREAMS */
r_int
r_int
id|is_capture
op_assign
(paren
(paren
id|buffer_id
op_amp
id|MIXART_NOTIFY_CAPT_MASK
)paren
op_ne
l_int|0
)paren
suffix:semicolon
multiline_comment|/* playback == 0 / capture == 1 */
id|mixart_t
op_star
id|chip
op_assign
id|mgr-&gt;chip
(braket
id|chip_number
)braket
suffix:semicolon
id|mixart_stream_t
op_star
id|stream
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chip_number
op_ge
id|mgr-&gt;num_cards
)paren
op_logical_or
(paren
id|pcm_number
op_ge
id|MIXART_PCM_TOTAL
)paren
op_logical_or
(paren
id|sub_number
op_ge
id|MIXART_PLAYBACK_STREAMS
)paren
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;error MSG_SERVICES_TIMER_NOTIFY buffer_id (%x) pos(%d)&bslash;n&quot;
comma
id|buffer_id
comma
id|notify-&gt;streams
(braket
id|i
)braket
dot
id|sample_pos_low_part
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|is_capture
)paren
id|stream
op_assign
op_amp
id|chip-&gt;capture_stream
(braket
id|pcm_number
)braket
suffix:semicolon
r_else
id|stream
op_assign
op_amp
id|chip-&gt;playback_stream
(braket
id|pcm_number
)braket
(braket
id|sub_number
)braket
suffix:semicolon
r_if
c_cond
(paren
id|stream-&gt;substream
op_logical_and
(paren
id|stream-&gt;status
op_eq
id|MIXART_STREAM_STATUS_RUNNING
)paren
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|stream-&gt;substream-&gt;runtime
suffix:semicolon
r_int
id|elapsed
op_assign
l_int|0
suffix:semicolon
id|u64
id|sample_count
op_assign
(paren
(paren
id|u64
)paren
id|notify-&gt;streams
(braket
id|i
)braket
dot
id|sample_pos_high_part
)paren
op_lshift
l_int|32
suffix:semicolon
id|sample_count
op_or_assign
id|notify-&gt;streams
(braket
id|i
)braket
dot
id|sample_pos_low_part
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|u64
id|new_elapse_pos
op_assign
id|stream-&gt;abs_period_elapsed
op_plus
id|runtime-&gt;period_size
suffix:semicolon
r_if
c_cond
(paren
id|new_elapse_pos
OG
id|sample_count
)paren
(brace
r_break
suffix:semicolon
multiline_comment|/* while */
)brace
r_else
(brace
id|elapsed
op_assign
l_int|1
suffix:semicolon
id|stream-&gt;buf_periods
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|stream-&gt;buf_periods
op_ge
id|runtime-&gt;periods
)paren
id|stream-&gt;buf_periods
op_assign
l_int|0
suffix:semicolon
id|stream-&gt;abs_period_elapsed
op_assign
id|new_elapse_pos
suffix:semicolon
)brace
)brace
id|stream-&gt;buf_period_frag
op_assign
(paren
id|u32
)paren
(paren
id|sample_count
op_minus
id|stream-&gt;abs_period_elapsed
)paren
suffix:semicolon
r_if
c_cond
(paren
id|elapsed
)paren
(brace
id|spin_unlock
c_func
(paren
op_amp
id|mgr-&gt;lock
)paren
suffix:semicolon
id|snd_pcm_period_elapsed
c_func
(paren
id|stream-&gt;substream
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|mgr-&gt;lock
)paren
suffix:semicolon
)brace
)brace
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|resp.message_id
op_eq
id|MSG_SERVICES_REPORT_TRACES
)paren
(brace
r_if
c_cond
(paren
id|resp.size
OG
l_int|1
)paren
(brace
macro_line|#ifndef __BIG_ENDIAN
multiline_comment|/* Traces are text: the swapped msg_data has to be swapped back ! */
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|resp.size
op_div
l_int|4
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
(paren
id|mixart_msg_data
)paren
(braket
id|i
)braket
op_assign
id|cpu_to_be32
c_func
(paren
(paren
id|mixart_msg_data
)paren
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
macro_line|#endif
(paren
(paren
r_char
op_star
)paren
id|mixart_msg_data
)paren
(braket
id|resp.size
op_minus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|snd_printdd
c_func
(paren
l_string|&quot;MIXART TRACE : %s&bslash;n&quot;
comma
(paren
r_char
op_star
)paren
id|mixart_msg_data
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
id|snd_printdd
c_func
(paren
l_string|&quot;command %x not handled&bslash;n&quot;
comma
id|resp.message_id
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MSG_TYPE_NOTIFY
suffix:colon
r_if
c_cond
(paren
id|msg
op_amp
id|MSG_CANCEL_NOTIFY_MASK
)paren
(brace
id|msg
op_and_assign
op_complement
id|MSG_CANCEL_NOTIFY_MASK
suffix:semicolon
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;canceled notification %x !&bslash;n&quot;
comma
id|msg
)paren
suffix:semicolon
)brace
multiline_comment|/* no break, continue ! */
r_case
id|MSG_TYPE_ANSWER
suffix:colon
multiline_comment|/* answer or notification to a message we are waiting for*/
id|spin_lock
c_func
(paren
op_amp
id|mgr-&gt;msg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|msg
op_amp
op_complement
id|MSG_TYPE_MASK
)paren
op_eq
id|mgr-&gt;pending_event
)paren
(brace
id|wake_up
c_func
(paren
op_amp
id|mgr-&gt;msg_sleep
)paren
suffix:semicolon
id|mgr-&gt;pending_event
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* answer to a message we did&squot;t want to wait for */
r_else
(brace
id|mgr-&gt;msg_fifo
(braket
id|mgr-&gt;msg_fifo_writeptr
)braket
op_assign
id|msg
suffix:semicolon
id|mgr-&gt;msg_fifo_writeptr
op_increment
suffix:semicolon
id|mgr-&gt;msg_fifo_writeptr
op_mod_assign
id|MSG_FIFO_SIZE
suffix:semicolon
id|tasklet_hi_schedule
c_func
(paren
op_amp
id|mgr-&gt;msg_taskq
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|mgr-&gt;msg_lock
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MSG_TYPE_REQUEST
suffix:colon
r_default
suffix:colon
id|snd_printdd
c_func
(paren
l_string|&quot;interrupt received request %x&bslash;n&quot;
comma
id|msg
)paren
suffix:semicolon
multiline_comment|/* TODO : are there things to do here ? */
r_break
suffix:semicolon
)brace
multiline_comment|/* switch on msg type */
)brace
multiline_comment|/* while there are msgs */
multiline_comment|/* allow interrupt again */
id|writel_le
c_func
(paren
id|MIXART_ALLOW_OUTBOUND_DOORBELL
comma
id|MIXART_REG
c_func
(paren
id|mgr
comma
id|MIXART_PCI_OMIMR_OFFSET
)paren
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|mgr-&gt;lock
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|snd_mixart_init_mailbox
r_void
id|snd_mixart_init_mailbox
c_func
(paren
id|mixart_mgr_t
op_star
id|mgr
)paren
(brace
id|writel
c_func
(paren
l_int|0
comma
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|MSG_HOST_RSC_PROTECTION
)paren
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|MIXART_MEM
c_func
(paren
id|mgr
comma
id|MSG_AGENT_RSC_PROTECTION
)paren
)paren
suffix:semicolon
multiline_comment|/* allow outbound messagebox to generate interrupts */
r_if
c_cond
(paren
id|mgr-&gt;irq
op_ge
l_int|0
)paren
(brace
id|writel_le
c_func
(paren
id|MIXART_ALLOW_OUTBOUND_DOORBELL
comma
id|MIXART_REG
c_func
(paren
id|mgr
comma
id|MIXART_PCI_OMIMR_OFFSET
)paren
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|snd_mixart_exit_mailbox
r_void
id|snd_mixart_exit_mailbox
c_func
(paren
id|mixart_mgr_t
op_star
id|mgr
)paren
(brace
multiline_comment|/* no more interrupts on outbound messagebox */
id|writel_le
c_func
(paren
id|MIXART_HOST_ALL_INTERRUPT_MASKED
comma
id|MIXART_REG
c_func
(paren
id|mgr
comma
id|MIXART_PCI_OMIMR_OFFSET
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|snd_mixart_reset_board
r_void
id|snd_mixart_reset_board
c_func
(paren
id|mixart_mgr_t
op_star
id|mgr
)paren
(brace
multiline_comment|/* reset miXart */
id|writel_be
c_func
(paren
l_int|1
comma
id|MIXART_REG
c_func
(paren
id|mgr
comma
id|MIXART_BA1_BRUTAL_RESET_OFFSET
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
eof
