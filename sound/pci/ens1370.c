multiline_comment|/*&n; *  Driver for Ensoniq ES1370/ES1371 AudioPCI soundcard&n; *  Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;,&n; *&t;&t;     Thomas Sailer &lt;sailer@ife.ee.ethz.ch&gt;&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/gameport.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/control.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
macro_line|#include &lt;sound/rawmidi.h&gt;
macro_line|#ifdef CHIP1371
macro_line|#include &lt;sound/ac97_codec.h&gt;
macro_line|#else
macro_line|#include &lt;sound/ak4531_codec.h&gt;
macro_line|#endif
macro_line|#include &lt;sound/initval.h&gt;
macro_line|#include &lt;sound/asoundef.h&gt;
macro_line|#ifndef CHIP1371
DECL|macro|CHIP1370
macro_line|#undef CHIP1370
DECL|macro|CHIP1370
mdefine_line|#define CHIP1370
macro_line|#endif
macro_line|#ifdef CHIP1370
DECL|macro|DRIVER_NAME
mdefine_line|#define DRIVER_NAME &quot;ENS1370&quot;
macro_line|#else
DECL|macro|DRIVER_NAME
mdefine_line|#define DRIVER_NAME &quot;ENS1371&quot;
macro_line|#endif
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jaroslav Kysela &lt;perex@suse.cz&gt;, Thomas Sailer &lt;sailer@ife.ee.ethz.ch&gt;&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
macro_line|#ifdef CHIP1370
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Ensoniq AudioPCI ES1370&quot;
)paren
suffix:semicolon
id|MODULE_SUPPORTED_DEVICE
c_func
(paren
l_string|&quot;{{Ensoniq,AudioPCI-97 ES1370},&quot;
l_string|&quot;{Creative Labs,SB PCI64/128 (ES1370)}}&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CHIP1371
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Ensoniq/Creative AudioPCI ES1371+&quot;
)paren
suffix:semicolon
id|MODULE_SUPPORTED_DEVICE
c_func
(paren
l_string|&quot;{{Ensoniq,AudioPCI ES1371/73},&quot;
l_string|&quot;{Ensoniq,AudioPCI ES1373},&quot;
l_string|&quot;{Creative Labs,Ectiva EV1938},&quot;
l_string|&quot;{Creative Labs,SB PCI64/128 (ES1371/73)},&quot;
l_string|&quot;{Creative Labs,Vibra PCI128},&quot;
l_string|&quot;{Ectiva,EV1938}}&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_GAMEPORT) || (defined(MODULE) &amp;&amp; defined(CONFIG_GAMEPORT_MODULE))
DECL|macro|SUPPORT_JOYSTICK
mdefine_line|#define SUPPORT_JOYSTICK
macro_line|#endif
DECL|variable|index
r_static
r_int
id|index
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_IDX
suffix:semicolon
multiline_comment|/* Index 0-MAX */
DECL|variable|id
r_static
r_char
op_star
id|id
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_STR
suffix:semicolon
multiline_comment|/* ID for this card */
DECL|variable|enable
r_static
r_int
id|enable
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_ENABLE_PNP
suffix:semicolon
multiline_comment|/* Enable switches */
macro_line|#ifdef SUPPORT_JOYSTICK
macro_line|#ifdef CHIP1371
DECL|variable|joystick_port
r_static
r_int
id|joystick_port
(braket
id|SNDRV_CARDS
)braket
suffix:semicolon
macro_line|#else
DECL|variable|joystick
r_static
r_int
id|joystick
(braket
id|SNDRV_CARDS
)braket
suffix:semicolon
macro_line|#endif
macro_line|#endif
id|module_param_array
c_func
(paren
id|index
comma
r_int
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|index
comma
l_string|&quot;Index value for Ensoniq AudioPCI soundcard.&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|id
comma
id|charp
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|id
comma
l_string|&quot;ID string for Ensoniq AudioPCI soundcard.&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|enable
comma
r_bool
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|enable
comma
l_string|&quot;Enable Ensoniq AudioPCI soundcard.&quot;
)paren
suffix:semicolon
macro_line|#ifdef SUPPORT_JOYSTICK
macro_line|#ifdef CHIP1371
id|module_param_array
c_func
(paren
id|joystick_port
comma
r_int
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|joystick_port
comma
l_string|&quot;Joystick port address.&quot;
)paren
suffix:semicolon
macro_line|#else
id|module_param_array
c_func
(paren
id|joystick
comma
r_bool
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|joystick
comma
l_string|&quot;Enable joystick.&quot;
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif /* SUPPORT_JOYSTICK */
macro_line|#ifndef PCI_DEVICE_ID_ENSONIQ_CT5880
DECL|macro|PCI_DEVICE_ID_ENSONIQ_CT5880
mdefine_line|#define PCI_DEVICE_ID_ENSONIQ_CT5880    0x5880
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_ENSONIQ_ES1371
DECL|macro|PCI_DEVICE_ID_ENSONIQ_ES1371
mdefine_line|#define PCI_DEVICE_ID_ENSONIQ_ES1371&t;0x1371
macro_line|#endif
multiline_comment|/* ES1371 chip ID */
multiline_comment|/* This is a little confusing because all ES1371 compatible chips have the&n;   same DEVICE_ID, the only thing differentiating them is the REV_ID field.&n;   This is only significant if you want to enable features on the later parts.&n;   Yes, I know it&squot;s stupid and why didn&squot;t we use the sub IDs?&n;*/
DECL|macro|ES1371REV_ES1373_A
mdefine_line|#define ES1371REV_ES1373_A  0x04
DECL|macro|ES1371REV_ES1373_B
mdefine_line|#define ES1371REV_ES1373_B  0x06
DECL|macro|ES1371REV_CT5880_A
mdefine_line|#define ES1371REV_CT5880_A  0x07
DECL|macro|CT5880REV_CT5880_C
mdefine_line|#define CT5880REV_CT5880_C  0x02
DECL|macro|CT5880REV_CT5880_D
mdefine_line|#define CT5880REV_CT5880_D  0x03&t;/* ??? -jk */
DECL|macro|CT5880REV_CT5880_E
mdefine_line|#define CT5880REV_CT5880_E  0x04&t;/* mw */
DECL|macro|ES1371REV_ES1371_B
mdefine_line|#define ES1371REV_ES1371_B  0x09
DECL|macro|EV1938REV_EV1938_A
mdefine_line|#define EV1938REV_EV1938_A  0x00
DECL|macro|ES1371REV_ES1373_8
mdefine_line|#define ES1371REV_ES1373_8  0x08
multiline_comment|/*&n; * Direct registers&n; */
DECL|macro|ES_REG
mdefine_line|#define ES_REG(ensoniq, x) ((ensoniq)-&gt;port + ES_REG_##x)
DECL|macro|ES_REG_CONTROL
mdefine_line|#define ES_REG_CONTROL&t;0x00&t;/* R/W: Interrupt/Chip select control register */
DECL|macro|ES_1370_ADC_STOP
mdefine_line|#define   ES_1370_ADC_STOP&t;(1&lt;&lt;31)&t;&t;/* disable capture buffer transfers */
DECL|macro|ES_1370_XCTL1
mdefine_line|#define   ES_1370_XCTL1 &t;(1&lt;&lt;30)&t;&t;/* general purpose output bit */
DECL|macro|ES_1373_BYPASS_P1
mdefine_line|#define   ES_1373_BYPASS_P1&t;(1&lt;&lt;31)&t;&t;/* bypass SRC for PB1 */
DECL|macro|ES_1373_BYPASS_P2
mdefine_line|#define   ES_1373_BYPASS_P2&t;(1&lt;&lt;30)&t;&t;/* bypass SRC for PB2 */
DECL|macro|ES_1373_BYPASS_R
mdefine_line|#define   ES_1373_BYPASS_R&t;(1&lt;&lt;29)&t;&t;/* bypass SRC for REC */
DECL|macro|ES_1373_TEST_BIT
mdefine_line|#define   ES_1373_TEST_BIT&t;(1&lt;&lt;28)&t;&t;/* should be set to 0 for normal operation */
DECL|macro|ES_1373_RECEN_B
mdefine_line|#define   ES_1373_RECEN_B&t;(1&lt;&lt;27)&t;&t;/* mix record with playback for I2S/SPDIF out */
DECL|macro|ES_1373_SPDIF_THRU
mdefine_line|#define   ES_1373_SPDIF_THRU&t;(1&lt;&lt;26)&t;&t;/* 0 = SPDIF thru mode, 1 = SPDIF == dig out */
DECL|macro|ES_1371_JOY_ASEL
mdefine_line|#define   ES_1371_JOY_ASEL(o)&t;(((o)&amp;0x03)&lt;&lt;24)/* joystick port mapping */
DECL|macro|ES_1371_JOY_ASELM
mdefine_line|#define   ES_1371_JOY_ASELM&t;(0x03&lt;&lt;24)&t;/* mask for above */
DECL|macro|ES_1371_JOY_ASELI
mdefine_line|#define   ES_1371_JOY_ASELI(i)  (((i)&gt;&gt;24)&amp;0x03)
DECL|macro|ES_1371_GPIO_IN
mdefine_line|#define   ES_1371_GPIO_IN(i)&t;(((i)&gt;&gt;20)&amp;0x0f)/* GPIO in [3:0] pins - R/O */
DECL|macro|ES_1370_PCLKDIVO
mdefine_line|#define   ES_1370_PCLKDIVO(o)&t;(((o)&amp;0x1fff)&lt;&lt;16)/* clock divide ratio for DAC2 */
DECL|macro|ES_1370_PCLKDIVM
mdefine_line|#define   ES_1370_PCLKDIVM&t;((0x1fff)&lt;&lt;16)&t;/* mask for above */
DECL|macro|ES_1370_PCLKDIVI
mdefine_line|#define   ES_1370_PCLKDIVI(i)&t;(((i)&gt;&gt;16)&amp;0x1fff)/* clock divide ratio for DAC2 */
DECL|macro|ES_1371_GPIO_OUT
mdefine_line|#define   ES_1371_GPIO_OUT(o)&t;(((o)&amp;0x0f)&lt;&lt;16)/* GPIO out [3:0] pins - W/R */
DECL|macro|ES_1371_GPIO_OUTM
mdefine_line|#define   ES_1371_GPIO_OUTM     (0x0f&lt;&lt;16)&t;/* mask for above */
DECL|macro|ES_MSFMTSEL
mdefine_line|#define   ES_MSFMTSEL&t;&t;(1&lt;&lt;15)&t;&t;/* MPEG serial data format; 0 = SONY, 1 = I2S */
DECL|macro|ES_1370_M_SBB
mdefine_line|#define   ES_1370_M_SBB&t;&t;(1&lt;&lt;14)&t;&t;/* clock source for DAC - 0 = clock generator; 1 = MPEG clocks */
DECL|macro|ES_1371_SYNC_RES
mdefine_line|#define   ES_1371_SYNC_RES&t;(1&lt;&lt;14)&t;&t;/* Warm AC97 reset */
DECL|macro|ES_1370_WTSRSEL
mdefine_line|#define   ES_1370_WTSRSEL(o)&t;(((o)&amp;0x03)&lt;&lt;12)/* fixed frequency clock for DAC1 */
DECL|macro|ES_1370_WTSRSELM
mdefine_line|#define   ES_1370_WTSRSELM&t;(0x03&lt;&lt;12)&t;/* mask for above */
DECL|macro|ES_1371_ADC_STOP
mdefine_line|#define   ES_1371_ADC_STOP&t;(1&lt;&lt;13)&t;&t;/* disable CCB transfer capture information */
DECL|macro|ES_1371_PWR_INTRM
mdefine_line|#define   ES_1371_PWR_INTRM&t;(1&lt;&lt;12)&t;&t;/* power level change interrupts enable */
DECL|macro|ES_1370_DAC_SYNC
mdefine_line|#define   ES_1370_DAC_SYNC&t;(1&lt;&lt;11)&t;&t;/* DAC&squot;s are synchronous */
DECL|macro|ES_1371_M_CB
mdefine_line|#define   ES_1371_M_CB&t;&t;(1&lt;&lt;11)&t;&t;/* capture clock source; 0 = AC&squot;97 ADC; 1 = I2S */
DECL|macro|ES_CCB_INTRM
mdefine_line|#define   ES_CCB_INTRM&t;&t;(1&lt;&lt;10)&t;&t;/* CCB voice interrupts enable */
DECL|macro|ES_1370_M_CB
mdefine_line|#define   ES_1370_M_CB&t;&t;(1&lt;&lt;9)&t;&t;/* capture clock source; 0 = ADC; 1 = MPEG */
DECL|macro|ES_1370_XCTL0
mdefine_line|#define   ES_1370_XCTL0&t;&t;(1&lt;&lt;8)&t;&t;/* generap purpose output bit */
DECL|macro|ES_1371_PDLEV
mdefine_line|#define   ES_1371_PDLEV(o)&t;(((o)&amp;0x03)&lt;&lt;8)&t;/* current power down level */
DECL|macro|ES_1371_PDLEVM
mdefine_line|#define   ES_1371_PDLEVM&t;(0x03&lt;&lt;8)&t;/* mask for above */
DECL|macro|ES_BREQ
mdefine_line|#define   ES_BREQ&t;&t;(1&lt;&lt;7)&t;&t;/* memory bus request enable */
DECL|macro|ES_DAC1_EN
mdefine_line|#define   ES_DAC1_EN&t;&t;(1&lt;&lt;6)&t;&t;/* DAC1 playback channel enable */
DECL|macro|ES_DAC2_EN
mdefine_line|#define   ES_DAC2_EN&t;&t;(1&lt;&lt;5)&t;&t;/* DAC2 playback channel enable */
DECL|macro|ES_ADC_EN
mdefine_line|#define   ES_ADC_EN&t;&t;(1&lt;&lt;4)&t;&t;/* ADC capture channel enable */
DECL|macro|ES_UART_EN
mdefine_line|#define   ES_UART_EN&t;&t;(1&lt;&lt;3)&t;&t;/* UART enable */
DECL|macro|ES_JYSTK_EN
mdefine_line|#define   ES_JYSTK_EN&t;&t;(1&lt;&lt;2)&t;&t;/* Joystick module enable */
DECL|macro|ES_1370_CDC_EN
mdefine_line|#define   ES_1370_CDC_EN&t;(1&lt;&lt;1)&t;&t;/* Codec interface enable */
DECL|macro|ES_1371_XTALCKDIS
mdefine_line|#define   ES_1371_XTALCKDIS&t;(1&lt;&lt;1)&t;&t;/* Xtal clock disable */
DECL|macro|ES_1370_SERR_DISABLE
mdefine_line|#define   ES_1370_SERR_DISABLE&t;(1&lt;&lt;0)&t;&t;/* PCI serr signal disable */
DECL|macro|ES_1371_PCICLKDIS
mdefine_line|#define   ES_1371_PCICLKDIS     (1&lt;&lt;0)&t;&t;/* PCI clock disable */
DECL|macro|ES_REG_STATUS
mdefine_line|#define ES_REG_STATUS&t;0x04&t;/* R/O: Interrupt/Chip select status register */
DECL|macro|ES_INTR
mdefine_line|#define   ES_INTR               (1&lt;&lt;31)&t;&t;/* Interrupt is pending */
DECL|macro|ES_1371_ST_AC97_RST
mdefine_line|#define   ES_1371_ST_AC97_RST&t;(1&lt;&lt;29)&t;&t;/* CT5880 AC&squot;97 Reset bit */
DECL|macro|ES_1373_REAR_BIT27
mdefine_line|#define   ES_1373_REAR_BIT27&t;(1&lt;&lt;27)&t;&t;/* rear bits: 000 - front, 010 - mirror, 101 - separate */
DECL|macro|ES_1373_REAR_BIT26
mdefine_line|#define   ES_1373_REAR_BIT26&t;(1&lt;&lt;26)
DECL|macro|ES_1373_REAR_BIT24
mdefine_line|#define   ES_1373_REAR_BIT24&t;(1&lt;&lt;24)
DECL|macro|ES_1373_GPIO_INT_EN
mdefine_line|#define   ES_1373_GPIO_INT_EN(o)(((o)&amp;0x0f)&lt;&lt;20)/* GPIO [3:0] pins - interrupt enable */
DECL|macro|ES_1373_SPDIF_EN
mdefine_line|#define   ES_1373_SPDIF_EN&t;(1&lt;&lt;18)&t;&t;/* SPDIF enable */
DECL|macro|ES_1373_SPDIF_TEST
mdefine_line|#define   ES_1373_SPDIF_TEST&t;(1&lt;&lt;17)&t;&t;/* SPDIF test */
DECL|macro|ES_1371_TEST
mdefine_line|#define   ES_1371_TEST          (1&lt;&lt;16)&t;&t;/* test ASIC */
DECL|macro|ES_1373_GPIO_INT
mdefine_line|#define   ES_1373_GPIO_INT(i)&t;(((i)&amp;0x0f)&gt;&gt;12)/* GPIO [3:0] pins - interrupt pending */
DECL|macro|ES_1370_CSTAT
mdefine_line|#define   ES_1370_CSTAT&t;&t;(1&lt;&lt;10)&t;&t;/* CODEC is busy or register write in progress */
DECL|macro|ES_1370_CBUSY
mdefine_line|#define   ES_1370_CBUSY         (1&lt;&lt;9)&t;&t;/* CODEC is busy */
DECL|macro|ES_1370_CWRIP
mdefine_line|#define   ES_1370_CWRIP&t;&t;(1&lt;&lt;8)&t;&t;/* CODEC register write in progress */
DECL|macro|ES_1371_SYNC_ERR
mdefine_line|#define   ES_1371_SYNC_ERR&t;(1&lt;&lt;8)&t;&t;/* CODEC synchronization error occurred */
DECL|macro|ES_1371_VC
mdefine_line|#define   ES_1371_VC(i)         (((i)&gt;&gt;6)&amp;0x03)&t;/* voice code from CCB module */
DECL|macro|ES_1370_VC
mdefine_line|#define   ES_1370_VC(i)&t;&t;(((i)&gt;&gt;5)&amp;0x03)&t;/* voice code from CCB module */
DECL|macro|ES_1371_MPWR
mdefine_line|#define   ES_1371_MPWR          (1&lt;&lt;5)&t;&t;/* power level interrupt pending */
DECL|macro|ES_MCCB
mdefine_line|#define   ES_MCCB&t;&t;(1&lt;&lt;4)&t;&t;/* CCB interrupt pending */
DECL|macro|ES_UART
mdefine_line|#define   ES_UART&t;&t;(1&lt;&lt;3)&t;&t;/* UART interrupt pending */
DECL|macro|ES_DAC1
mdefine_line|#define   ES_DAC1&t;&t;(1&lt;&lt;2)&t;&t;/* DAC1 channel interrupt pending */
DECL|macro|ES_DAC2
mdefine_line|#define   ES_DAC2&t;&t;(1&lt;&lt;1)&t;&t;/* DAC2 channel interrupt pending */
DECL|macro|ES_ADC
mdefine_line|#define   ES_ADC&t;&t;(1&lt;&lt;0)&t;&t;/* ADC channel interrupt pending */
DECL|macro|ES_REG_UART_DATA
mdefine_line|#define ES_REG_UART_DATA 0x08&t;/* R/W: UART data register */
DECL|macro|ES_REG_UART_STATUS
mdefine_line|#define ES_REG_UART_STATUS 0x09&t;/* R/O: UART status register */
DECL|macro|ES_RXINT
mdefine_line|#define   ES_RXINT&t;&t;(1&lt;&lt;7)&t;&t;/* RX interrupt occurred */
DECL|macro|ES_TXINT
mdefine_line|#define   ES_TXINT&t;&t;(1&lt;&lt;2)&t;&t;/* TX interrupt occurred */
DECL|macro|ES_TXRDY
mdefine_line|#define   ES_TXRDY&t;&t;(1&lt;&lt;1)&t;&t;/* transmitter ready */
DECL|macro|ES_RXRDY
mdefine_line|#define   ES_RXRDY&t;&t;(1&lt;&lt;0)&t;&t;/* receiver ready */
DECL|macro|ES_REG_UART_CONTROL
mdefine_line|#define ES_REG_UART_CONTROL 0x09&t;/* W/O: UART control register */
DECL|macro|ES_RXINTEN
mdefine_line|#define   ES_RXINTEN&t;&t;(1&lt;&lt;7)&t;&t;/* RX interrupt enable */
DECL|macro|ES_TXINTENO
mdefine_line|#define   ES_TXINTENO(o)&t;(((o)&amp;0x03)&lt;&lt;5)&t;/* TX interrupt enable */
DECL|macro|ES_TXINTENM
mdefine_line|#define   ES_TXINTENM&t;&t;(0x03&lt;&lt;5)&t;/* mask for above */
DECL|macro|ES_TXINTENI
mdefine_line|#define   ES_TXINTENI(i)&t;(((i)&gt;&gt;5)&amp;0x03)
DECL|macro|ES_CNTRL
mdefine_line|#define   ES_CNTRL(o)&t;&t;(((o)&amp;0x03)&lt;&lt;0)&t;/* control */
DECL|macro|ES_CNTRLM
mdefine_line|#define   ES_CNTRLM&t;&t;(0x03&lt;&lt;0)&t;/* mask for above */
DECL|macro|ES_REG_UART_RES
mdefine_line|#define ES_REG_UART_RES&t;0x0a&t;/* R/W: UART reserver register */
DECL|macro|ES_TEST_MODE
mdefine_line|#define   ES_TEST_MODE&t;&t;(1&lt;&lt;0)&t;&t;/* test mode enabled */
DECL|macro|ES_REG_MEM_PAGE
mdefine_line|#define ES_REG_MEM_PAGE&t;0x0c&t;/* R/W: Memory page register */
DECL|macro|ES_MEM_PAGEO
mdefine_line|#define   ES_MEM_PAGEO(o)&t;(((o)&amp;0x0f)&lt;&lt;0)&t;/* memory page select - out */
DECL|macro|ES_MEM_PAGEM
mdefine_line|#define   ES_MEM_PAGEM&t;&t;(0x0f&lt;&lt;0)&t;/* mask for above */
DECL|macro|ES_MEM_PAGEI
mdefine_line|#define   ES_MEM_PAGEI(i)&t;(((i)&gt;&gt;0)&amp;0x0f) /* memory page select - in */
DECL|macro|ES_REG_1370_CODEC
mdefine_line|#define ES_REG_1370_CODEC 0x10&t;/* W/O: Codec write register address */
DECL|macro|ES_1370_CODEC_WRITE
mdefine_line|#define   ES_1370_CODEC_WRITE(a,d) ((((a)&amp;0xff)&lt;&lt;8)|(((d)&amp;0xff)&lt;&lt;0))
DECL|macro|ES_REG_1371_CODEC
mdefine_line|#define ES_REG_1371_CODEC 0x14&t;/* W/R: Codec Read/Write register address */
DECL|macro|ES_1371_CODEC_RDY
mdefine_line|#define   ES_1371_CODEC_RDY&t;   (1&lt;&lt;31)&t;/* codec ready */
DECL|macro|ES_1371_CODEC_WIP
mdefine_line|#define   ES_1371_CODEC_WIP&t;   (1&lt;&lt;30)&t;/* codec register access in progress */
DECL|macro|ES_1371_CODEC_PIRD
mdefine_line|#define   ES_1371_CODEC_PIRD&t;   (1&lt;&lt;23)&t;/* codec read/write select register */
DECL|macro|ES_1371_CODEC_WRITE
mdefine_line|#define   ES_1371_CODEC_WRITE(a,d) ((((a)&amp;0x7f)&lt;&lt;16)|(((d)&amp;0xffff)&lt;&lt;0))
DECL|macro|ES_1371_CODEC_READS
mdefine_line|#define   ES_1371_CODEC_READS(a)   ((((a)&amp;0x7f)&lt;&lt;16)|ES_1371_CODEC_PIRD)
DECL|macro|ES_1371_CODEC_READ
mdefine_line|#define   ES_1371_CODEC_READ(i)    (((i)&gt;&gt;0)&amp;0xffff)
DECL|macro|ES_REG_1371_SMPRATE
mdefine_line|#define ES_REG_1371_SMPRATE 0x10&t;/* W/R: Codec rate converter interface register */
DECL|macro|ES_1371_SRC_RAM_ADDRO
mdefine_line|#define   ES_1371_SRC_RAM_ADDRO(o) (((o)&amp;0x7f)&lt;&lt;25)/* address of the sample rate converter */
DECL|macro|ES_1371_SRC_RAM_ADDRM
mdefine_line|#define   ES_1371_SRC_RAM_ADDRM&t;   (0x7f&lt;&lt;25)&t;/* mask for above */
DECL|macro|ES_1371_SRC_RAM_ADDRI
mdefine_line|#define   ES_1371_SRC_RAM_ADDRI(i) (((i)&gt;&gt;25)&amp;0x7f)/* address of the sample rate converter */
DECL|macro|ES_1371_SRC_RAM_WE
mdefine_line|#define   ES_1371_SRC_RAM_WE&t;   (1&lt;&lt;24)&t;/* R/W: read/write control for sample rate converter */
DECL|macro|ES_1371_SRC_RAM_BUSY
mdefine_line|#define   ES_1371_SRC_RAM_BUSY     (1&lt;&lt;23)&t;/* R/O: sample rate memory is busy */
DECL|macro|ES_1371_SRC_DISABLE
mdefine_line|#define   ES_1371_SRC_DISABLE      (1&lt;&lt;22)&t;/* sample rate converter disable */
DECL|macro|ES_1371_DIS_P1
mdefine_line|#define   ES_1371_DIS_P1&t;   (1&lt;&lt;21)&t;/* playback channel 1 accumulator update disable */
DECL|macro|ES_1371_DIS_P2
mdefine_line|#define   ES_1371_DIS_P2&t;   (1&lt;&lt;20)&t;/* playback channel 1 accumulator update disable */
DECL|macro|ES_1371_DIS_R1
mdefine_line|#define   ES_1371_DIS_R1&t;   (1&lt;&lt;19)&t;/* capture channel accumulator update disable */
DECL|macro|ES_1371_SRC_RAM_DATAO
mdefine_line|#define   ES_1371_SRC_RAM_DATAO(o) (((o)&amp;0xffff)&lt;&lt;0)/* current value of the sample rate converter */
DECL|macro|ES_1371_SRC_RAM_DATAM
mdefine_line|#define   ES_1371_SRC_RAM_DATAM&t;   (0xffff&lt;&lt;0)&t;/* mask for above */
DECL|macro|ES_1371_SRC_RAM_DATAI
mdefine_line|#define   ES_1371_SRC_RAM_DATAI(i) (((i)&gt;&gt;0)&amp;0xffff)/* current value of the sample rate converter */
DECL|macro|ES_REG_1371_LEGACY
mdefine_line|#define ES_REG_1371_LEGACY 0x18&t;/* W/R: Legacy control/status register */
DECL|macro|ES_1371_JFAST
mdefine_line|#define   ES_1371_JFAST&t;&t;(1&lt;&lt;31)&t;&t;/* fast joystick timing */
DECL|macro|ES_1371_HIB
mdefine_line|#define   ES_1371_HIB&t;&t;(1&lt;&lt;30)&t;&t;/* host interrupt blocking enable */
DECL|macro|ES_1371_VSB
mdefine_line|#define   ES_1371_VSB&t;&t;(1&lt;&lt;29)&t;&t;/* SB; 0 = addr 0x220xH, 1 = 0x22FxH */
DECL|macro|ES_1371_VMPUO
mdefine_line|#define   ES_1371_VMPUO(o)&t;(((o)&amp;0x03)&lt;&lt;27)/* base register address; 0 = 0x320xH; 1 = 0x330xH; 2 = 0x340xH; 3 = 0x350xH */
DECL|macro|ES_1371_VMPUM
mdefine_line|#define   ES_1371_VMPUM&t;&t;(0x03&lt;&lt;27)&t;/* mask for above */
DECL|macro|ES_1371_VMPUI
mdefine_line|#define   ES_1371_VMPUI(i)&t;(((i)&gt;&gt;27)&amp;0x03)/* base register address */
DECL|macro|ES_1371_VCDCO
mdefine_line|#define   ES_1371_VCDCO(o)&t;(((o)&amp;0x03)&lt;&lt;25)/* CODEC; 0 = 0x530xH; 1 = undefined; 2 = 0xe80xH; 3 = 0xF40xH */
DECL|macro|ES_1371_VCDCM
mdefine_line|#define   ES_1371_VCDCM&t;&t;(0x03&lt;&lt;25)&t;/* mask for above */
DECL|macro|ES_1371_VCDCI
mdefine_line|#define   ES_1371_VCDCI(i)&t;(((i)&gt;&gt;25)&amp;0x03)/* CODEC address */
DECL|macro|ES_1371_FIRQ
mdefine_line|#define   ES_1371_FIRQ&t;&t;(1&lt;&lt;24)&t;&t;/* force an interrupt */
DECL|macro|ES_1371_SDMACAP
mdefine_line|#define   ES_1371_SDMACAP&t;(1&lt;&lt;23)&t;&t;/* enable event capture for slave DMA controller */
DECL|macro|ES_1371_SPICAP
mdefine_line|#define   ES_1371_SPICAP&t;(1&lt;&lt;22)&t;&t;/* enable event capture for slave IRQ controller */
DECL|macro|ES_1371_MDMACAP
mdefine_line|#define   ES_1371_MDMACAP&t;(1&lt;&lt;21)&t;&t;/* enable event capture for master DMA controller */
DECL|macro|ES_1371_MPICAP
mdefine_line|#define   ES_1371_MPICAP&t;(1&lt;&lt;20)&t;&t;/* enable event capture for master IRQ controller */
DECL|macro|ES_1371_ADCAP
mdefine_line|#define   ES_1371_ADCAP&t;&t;(1&lt;&lt;19)&t;&t;/* enable event capture for ADLIB register; 0x388xH */
DECL|macro|ES_1371_SVCAP
mdefine_line|#define   ES_1371_SVCAP&t;&t;(1&lt;&lt;18)&t;&t;/* enable event capture for SB registers */
DECL|macro|ES_1371_CDCCAP
mdefine_line|#define   ES_1371_CDCCAP&t;(1&lt;&lt;17)&t;&t;/* enable event capture for CODEC registers */
DECL|macro|ES_1371_BACAP
mdefine_line|#define   ES_1371_BACAP&t;&t;(1&lt;&lt;16)&t;&t;/* enable event capture for SoundScape base address */
DECL|macro|ES_1371_EXI
mdefine_line|#define   ES_1371_EXI(i)&t;(((i)&gt;&gt;8)&amp;0x07)&t;/* event number */
DECL|macro|ES_1371_AI
mdefine_line|#define   ES_1371_AI(i)&t;&t;(((i)&gt;&gt;3)&amp;0x1f)&t;/* event significant I/O address */
DECL|macro|ES_1371_WR
mdefine_line|#define   ES_1371_WR&t;&t;(1&lt;&lt;2)&t;/* event capture; 0 = read; 1 = write */
DECL|macro|ES_1371_LEGINT
mdefine_line|#define   ES_1371_LEGINT&t;(1&lt;&lt;0)&t;/* interrupt for legacy events; 0 = interrupt did occur */
DECL|macro|ES_REG_CHANNEL_STATUS
mdefine_line|#define ES_REG_CHANNEL_STATUS 0x1c /* R/W: first 32-bits from S/PDIF channel status block, es1373 */
DECL|macro|ES_REG_SERIAL
mdefine_line|#define ES_REG_SERIAL&t;0x20&t;/* R/W: Serial interface control register */
DECL|macro|ES_1371_DAC_TEST
mdefine_line|#define   ES_1371_DAC_TEST&t;(1&lt;&lt;22)&t;&t;/* DAC test mode enable */
DECL|macro|ES_P2_END_INCO
mdefine_line|#define   ES_P2_END_INCO(o)&t;(((o)&amp;0x07)&lt;&lt;19)/* binary offset value to increment / loop end */
DECL|macro|ES_P2_END_INCM
mdefine_line|#define   ES_P2_END_INCM&t;(0x07&lt;&lt;19)&t;/* mask for above */
DECL|macro|ES_P2_END_INCI
mdefine_line|#define   ES_P2_END_INCI(i)&t;(((i)&gt;&gt;16)&amp;0x07)/* binary offset value to increment / loop end */
DECL|macro|ES_P2_ST_INCO
mdefine_line|#define   ES_P2_ST_INCO(o)&t;(((o)&amp;0x07)&lt;&lt;16)/* binary offset value to increment / start */
DECL|macro|ES_P2_ST_INCM
mdefine_line|#define   ES_P2_ST_INCM&t;&t;(0x07&lt;&lt;16)&t;/* mask for above */
DECL|macro|ES_P2_ST_INCI
mdefine_line|#define   ES_P2_ST_INCI(i)&t;(((i)&lt;&lt;16)&amp;0x07)/* binary offset value to increment / start */
DECL|macro|ES_R1_LOOP_SEL
mdefine_line|#define   ES_R1_LOOP_SEL&t;(1&lt;&lt;15)&t;&t;/* ADC; 0 - loop mode; 1 = stop mode */
DECL|macro|ES_P2_LOOP_SEL
mdefine_line|#define   ES_P2_LOOP_SEL&t;(1&lt;&lt;14)&t;&t;/* DAC2; 0 - loop mode; 1 = stop mode */
DECL|macro|ES_P1_LOOP_SEL
mdefine_line|#define   ES_P1_LOOP_SEL&t;(1&lt;&lt;13)&t;&t;/* DAC1; 0 - loop mode; 1 = stop mode */
DECL|macro|ES_P2_PAUSE
mdefine_line|#define   ES_P2_PAUSE&t;&t;(1&lt;&lt;12)&t;&t;/* DAC2; 0 - play mode; 1 = pause mode */
DECL|macro|ES_P1_PAUSE
mdefine_line|#define   ES_P1_PAUSE&t;&t;(1&lt;&lt;11)&t;&t;/* DAC1; 0 - play mode; 1 = pause mode */
DECL|macro|ES_R1_INT_EN
mdefine_line|#define   ES_R1_INT_EN&t;&t;(1&lt;&lt;10)&t;&t;/* ADC interrupt enable */
DECL|macro|ES_P2_INT_EN
mdefine_line|#define   ES_P2_INT_EN&t;&t;(1&lt;&lt;9)&t;&t;/* DAC2 interrupt enable */
DECL|macro|ES_P1_INT_EN
mdefine_line|#define   ES_P1_INT_EN&t;&t;(1&lt;&lt;8)&t;&t;/* DAC1 interrupt enable */
DECL|macro|ES_P1_SCT_RLD
mdefine_line|#define   ES_P1_SCT_RLD&t;&t;(1&lt;&lt;7)&t;&t;/* force sample counter reload for DAC1 */
DECL|macro|ES_P2_DAC_SEN
mdefine_line|#define   ES_P2_DAC_SEN&t;&t;(1&lt;&lt;6)&t;&t;/* when stop mode: 0 - DAC2 play back zeros; 1 = DAC2 play back last sample */
DECL|macro|ES_R1_MODEO
mdefine_line|#define   ES_R1_MODEO(o)&t;(((o)&amp;0x03)&lt;&lt;4)&t;/* ADC mode; 0 = 8-bit mono; 1 = 8-bit stereo; 2 = 16-bit mono; 3 = 16-bit stereo */
DECL|macro|ES_R1_MODEM
mdefine_line|#define   ES_R1_MODEM&t;&t;(0x03&lt;&lt;4)&t;/* mask for above */
DECL|macro|ES_R1_MODEI
mdefine_line|#define   ES_R1_MODEI(i)&t;(((i)&gt;&gt;4)&amp;0x03)
DECL|macro|ES_P2_MODEO
mdefine_line|#define   ES_P2_MODEO(o)&t;(((o)&amp;0x03)&lt;&lt;2)&t;/* DAC2 mode; -- &squot;&squot; -- */
DECL|macro|ES_P2_MODEM
mdefine_line|#define   ES_P2_MODEM&t;&t;(0x03&lt;&lt;2)&t;/* mask for above */
DECL|macro|ES_P2_MODEI
mdefine_line|#define   ES_P2_MODEI(i)&t;(((i)&gt;&gt;2)&amp;0x03)
DECL|macro|ES_P1_MODEO
mdefine_line|#define   ES_P1_MODEO(o)&t;(((o)&amp;0x03)&lt;&lt;0)&t;/* DAC1 mode; -- &squot;&squot; -- */
DECL|macro|ES_P1_MODEM
mdefine_line|#define   ES_P1_MODEM&t;&t;(0x03&lt;&lt;0)&t;/* mask for above */
DECL|macro|ES_P1_MODEI
mdefine_line|#define   ES_P1_MODEI(i)&t;(((i)&gt;&gt;0)&amp;0x03)
DECL|macro|ES_REG_DAC1_COUNT
mdefine_line|#define ES_REG_DAC1_COUNT 0x24&t;/* R/W: DAC1 sample count register */
DECL|macro|ES_REG_DAC2_COUNT
mdefine_line|#define ES_REG_DAC2_COUNT 0x28&t;/* R/W: DAC2 sample count register */
DECL|macro|ES_REG_ADC_COUNT
mdefine_line|#define ES_REG_ADC_COUNT  0x2c&t;/* R/W: ADC sample count register */
DECL|macro|ES_REG_CURR_COUNT
mdefine_line|#define   ES_REG_CURR_COUNT(i)  (((i)&gt;&gt;16)&amp;0xffff)
DECL|macro|ES_REG_COUNTO
mdefine_line|#define   ES_REG_COUNTO(o)&t;(((o)&amp;0xffff)&lt;&lt;0)
DECL|macro|ES_REG_COUNTM
mdefine_line|#define   ES_REG_COUNTM&t;&t;(0xffff&lt;&lt;0)
DECL|macro|ES_REG_COUNTI
mdefine_line|#define   ES_REG_COUNTI(i)&t;(((i)&gt;&gt;0)&amp;0xffff)
DECL|macro|ES_REG_DAC1_FRAME
mdefine_line|#define ES_REG_DAC1_FRAME 0x30&t;/* R/W: PAGE 0x0c; DAC1 frame address */
DECL|macro|ES_REG_DAC1_SIZE
mdefine_line|#define ES_REG_DAC1_SIZE  0x34&t;/* R/W: PAGE 0x0c; DAC1 frame size */
DECL|macro|ES_REG_DAC2_FRAME
mdefine_line|#define ES_REG_DAC2_FRAME 0x38&t;/* R/W: PAGE 0x0c; DAC2 frame address */
DECL|macro|ES_REG_DAC2_SIZE
mdefine_line|#define ES_REG_DAC2_SIZE  0x3c&t;/* R/W: PAGE 0x0c; DAC2 frame size */
DECL|macro|ES_REG_ADC_FRAME
mdefine_line|#define ES_REG_ADC_FRAME  0x30&t;/* R/W: PAGE 0x0d; ADC frame address */
DECL|macro|ES_REG_ADC_SIZE
mdefine_line|#define ES_REG_ADC_SIZE&t;  0x34&t;/* R/W: PAGE 0x0d; ADC frame size */
DECL|macro|ES_REG_FCURR_COUNTO
mdefine_line|#define   ES_REG_FCURR_COUNTO(o) (((o)&amp;0xffff)&lt;&lt;16)
DECL|macro|ES_REG_FCURR_COUNTM
mdefine_line|#define   ES_REG_FCURR_COUNTM    (0xffff&lt;&lt;16)
DECL|macro|ES_REG_FCURR_COUNTI
mdefine_line|#define   ES_REG_FCURR_COUNTI(i) (((i)&gt;&gt;14)&amp;0x3fffc)
DECL|macro|ES_REG_FSIZEO
mdefine_line|#define   ES_REG_FSIZEO(o)&t; (((o)&amp;0xffff)&lt;&lt;0)
DECL|macro|ES_REG_FSIZEM
mdefine_line|#define   ES_REG_FSIZEM&t;&t; (0xffff&lt;&lt;0)
DECL|macro|ES_REG_FSIZEI
mdefine_line|#define   ES_REG_FSIZEI(i)&t; (((i)&gt;&gt;0)&amp;0xffff)
DECL|macro|ES_REG_PHANTOM_FRAME
mdefine_line|#define ES_REG_PHANTOM_FRAME 0x38 /* R/W: PAGE 0x0d: phantom frame address */
DECL|macro|ES_REG_PHANTOM_COUNT
mdefine_line|#define ES_REG_PHANTOM_COUNT 0x3c /* R/W: PAGE 0x0d: phantom frame count */
DECL|macro|ES_REG_UART_FIFO
mdefine_line|#define ES_REG_UART_FIFO  0x30&t;/* R/W: PAGE 0x0e; UART FIFO register */
DECL|macro|ES_REG_UF_VALID
mdefine_line|#define   ES_REG_UF_VALID&t; (1&lt;&lt;8)
DECL|macro|ES_REG_UF_BYTEO
mdefine_line|#define   ES_REG_UF_BYTEO(o)&t; (((o)&amp;0xff)&lt;&lt;0)
DECL|macro|ES_REG_UF_BYTEM
mdefine_line|#define   ES_REG_UF_BYTEM&t; (0xff&lt;&lt;0)
DECL|macro|ES_REG_UF_BYTEI
mdefine_line|#define   ES_REG_UF_BYTEI(i)&t; (((i)&gt;&gt;0)&amp;0xff)
multiline_comment|/*&n; *  Pages&n; */
DECL|macro|ES_PAGE_DAC
mdefine_line|#define ES_PAGE_DAC&t;0x0c
DECL|macro|ES_PAGE_ADC
mdefine_line|#define ES_PAGE_ADC&t;0x0d
DECL|macro|ES_PAGE_UART
mdefine_line|#define ES_PAGE_UART&t;0x0e
DECL|macro|ES_PAGE_UART1
mdefine_line|#define ES_PAGE_UART1&t;0x0f
multiline_comment|/*&n; *  Sample rate converter addresses&n; */
DECL|macro|ES_SMPREG_DAC1
mdefine_line|#define ES_SMPREG_DAC1&t;&t;0x70
DECL|macro|ES_SMPREG_DAC2
mdefine_line|#define ES_SMPREG_DAC2&t;&t;0x74
DECL|macro|ES_SMPREG_ADC
mdefine_line|#define ES_SMPREG_ADC&t;&t;0x78
DECL|macro|ES_SMPREG_VOL_ADC
mdefine_line|#define ES_SMPREG_VOL_ADC&t;0x6c
DECL|macro|ES_SMPREG_VOL_DAC1
mdefine_line|#define ES_SMPREG_VOL_DAC1&t;0x7c
DECL|macro|ES_SMPREG_VOL_DAC2
mdefine_line|#define ES_SMPREG_VOL_DAC2&t;0x7e
DECL|macro|ES_SMPREG_TRUNC_N
mdefine_line|#define ES_SMPREG_TRUNC_N&t;0x00
DECL|macro|ES_SMPREG_INT_REGS
mdefine_line|#define ES_SMPREG_INT_REGS&t;0x01
DECL|macro|ES_SMPREG_ACCUM_FRAC
mdefine_line|#define ES_SMPREG_ACCUM_FRAC&t;0x02
DECL|macro|ES_SMPREG_VFREQ_FRAC
mdefine_line|#define ES_SMPREG_VFREQ_FRAC&t;0x03
multiline_comment|/*&n; *  Some contants&n; */
DECL|macro|ES_1370_SRCLOCK
mdefine_line|#define ES_1370_SRCLOCK&t;   1411200
DECL|macro|ES_1370_SRTODIV
mdefine_line|#define ES_1370_SRTODIV(x) (ES_1370_SRCLOCK/(x)-2)
multiline_comment|/*&n; *  Open modes&n; */
DECL|macro|ES_MODE_PLAY1
mdefine_line|#define ES_MODE_PLAY1&t;0x0001
DECL|macro|ES_MODE_PLAY2
mdefine_line|#define ES_MODE_PLAY2&t;0x0002
DECL|macro|ES_MODE_CAPTURE
mdefine_line|#define ES_MODE_CAPTURE&t;0x0004
DECL|macro|ES_MODE_OUTPUT
mdefine_line|#define ES_MODE_OUTPUT&t;0x0001&t;/* for MIDI */
DECL|macro|ES_MODE_INPUT
mdefine_line|#define ES_MODE_INPUT&t;0x0002&t;/* for MIDI */
multiline_comment|/*&n;&n; */
DECL|typedef|ensoniq_t
r_typedef
r_struct
id|_snd_ensoniq
id|ensoniq_t
suffix:semicolon
DECL|struct|_snd_ensoniq
r_struct
id|_snd_ensoniq
(brace
DECL|member|reg_lock
id|spinlock_t
id|reg_lock
suffix:semicolon
DECL|member|src_mutex
r_struct
id|semaphore
id|src_mutex
suffix:semicolon
DECL|member|irq
r_int
id|irq
suffix:semicolon
DECL|member|playback1size
r_int
r_int
id|playback1size
suffix:semicolon
DECL|member|playback2size
r_int
r_int
id|playback2size
suffix:semicolon
DECL|member|capture3size
r_int
r_int
id|capture3size
suffix:semicolon
DECL|member|port
r_int
r_int
id|port
suffix:semicolon
DECL|member|mode
r_int
r_int
id|mode
suffix:semicolon
DECL|member|uartm
r_int
r_int
id|uartm
suffix:semicolon
multiline_comment|/* UART mode */
DECL|member|ctrl
r_int
r_int
id|ctrl
suffix:semicolon
multiline_comment|/* control register */
DECL|member|sctrl
r_int
r_int
id|sctrl
suffix:semicolon
multiline_comment|/* serial control register */
DECL|member|cssr
r_int
r_int
id|cssr
suffix:semicolon
multiline_comment|/* control status register */
DECL|member|uartc
r_int
r_int
id|uartc
suffix:semicolon
multiline_comment|/* uart control register */
DECL|member|rev
r_int
r_int
id|rev
suffix:semicolon
multiline_comment|/* chip revision */
r_union
(brace
macro_line|#ifdef CHIP1371
r_struct
(brace
DECL|member|ac97
id|ac97_t
op_star
id|ac97
suffix:semicolon
DECL|member|es1371
)brace
id|es1371
suffix:semicolon
macro_line|#else
r_struct
(brace
r_int
id|pclkdiv_lock
suffix:semicolon
id|ak4531_t
op_star
id|ak4531
suffix:semicolon
)brace
id|es1370
suffix:semicolon
macro_line|#endif
DECL|member|u
)brace
id|u
suffix:semicolon
DECL|member|pci
r_struct
id|pci_dev
op_star
id|pci
suffix:semicolon
DECL|member|subsystem_vendor_id
r_int
r_int
id|subsystem_vendor_id
suffix:semicolon
DECL|member|subsystem_device_id
r_int
r_int
id|subsystem_device_id
suffix:semicolon
DECL|member|card
id|snd_card_t
op_star
id|card
suffix:semicolon
DECL|member|pcm1
id|snd_pcm_t
op_star
id|pcm1
suffix:semicolon
multiline_comment|/* DAC1/ADC PCM */
DECL|member|pcm2
id|snd_pcm_t
op_star
id|pcm2
suffix:semicolon
multiline_comment|/* DAC2 PCM */
DECL|member|playback1_substream
id|snd_pcm_substream_t
op_star
id|playback1_substream
suffix:semicolon
DECL|member|playback2_substream
id|snd_pcm_substream_t
op_star
id|playback2_substream
suffix:semicolon
DECL|member|capture_substream
id|snd_pcm_substream_t
op_star
id|capture_substream
suffix:semicolon
DECL|member|p1_dma_size
r_int
r_int
id|p1_dma_size
suffix:semicolon
DECL|member|p2_dma_size
r_int
r_int
id|p2_dma_size
suffix:semicolon
DECL|member|c_dma_size
r_int
r_int
id|c_dma_size
suffix:semicolon
DECL|member|p1_period_size
r_int
r_int
id|p1_period_size
suffix:semicolon
DECL|member|p2_period_size
r_int
r_int
id|p2_period_size
suffix:semicolon
DECL|member|c_period_size
r_int
r_int
id|c_period_size
suffix:semicolon
DECL|member|rmidi
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
DECL|member|midi_input
id|snd_rawmidi_substream_t
op_star
id|midi_input
suffix:semicolon
DECL|member|midi_output
id|snd_rawmidi_substream_t
op_star
id|midi_output
suffix:semicolon
DECL|member|spdif
r_int
r_int
id|spdif
suffix:semicolon
DECL|member|spdif_default
r_int
r_int
id|spdif_default
suffix:semicolon
DECL|member|spdif_stream
r_int
r_int
id|spdif_stream
suffix:semicolon
macro_line|#ifdef CHIP1370
DECL|member|dma_bug
r_struct
id|snd_dma_buffer
id|dma_bug
suffix:semicolon
macro_line|#endif
macro_line|#ifdef SUPPORT_JOYSTICK
DECL|member|gameport
r_struct
id|gameport
id|gameport
suffix:semicolon
macro_line|#endif
)brace
suffix:semicolon
r_static
id|irqreturn_t
id|snd_audiopci_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
DECL|variable|snd_audiopci_ids
r_static
r_struct
id|pci_device_id
id|snd_audiopci_ids
(braket
)braket
op_assign
(brace
macro_line|#ifdef CHIP1370
(brace
l_int|0x1274
comma
l_int|0x5000
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
comma
multiline_comment|/* ES1370 */
macro_line|#endif
macro_line|#ifdef CHIP1371
(brace
l_int|0x1274
comma
l_int|0x1371
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
comma
multiline_comment|/* ES1371 */
(brace
l_int|0x1274
comma
l_int|0x5880
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
comma
multiline_comment|/* ES1373 - CT5880 */
(brace
l_int|0x1102
comma
l_int|0x8938
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
comma
multiline_comment|/* Ectiva EV1938 */
macro_line|#endif
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|snd_audiopci_ids
)paren
suffix:semicolon
multiline_comment|/*&n; *  constants&n; */
DECL|macro|POLL_COUNT
mdefine_line|#define POLL_COUNT&t;0xa000
macro_line|#ifdef CHIP1370
DECL|variable|snd_es1370_fixed_rates
r_static
r_int
r_int
id|snd_es1370_fixed_rates
(braket
)braket
op_assign
(brace
l_int|5512
comma
l_int|11025
comma
l_int|22050
comma
l_int|44100
)brace
suffix:semicolon
DECL|variable|snd_es1370_hw_constraints_rates
r_static
id|snd_pcm_hw_constraint_list_t
id|snd_es1370_hw_constraints_rates
op_assign
(brace
dot
id|count
op_assign
l_int|4
comma
dot
id|list
op_assign
id|snd_es1370_fixed_rates
comma
dot
id|mask
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|es1370_clock
r_static
id|ratnum_t
id|es1370_clock
op_assign
(brace
dot
id|num
op_assign
id|ES_1370_SRCLOCK
comma
dot
id|den_min
op_assign
l_int|29
comma
dot
id|den_max
op_assign
l_int|353
comma
dot
id|den_step
op_assign
l_int|1
comma
)brace
suffix:semicolon
DECL|variable|snd_es1370_hw_constraints_clock
r_static
id|snd_pcm_hw_constraint_ratnums_t
id|snd_es1370_hw_constraints_clock
op_assign
(brace
dot
id|nrats
op_assign
l_int|1
comma
dot
id|rats
op_assign
op_amp
id|es1370_clock
comma
)brace
suffix:semicolon
macro_line|#else
DECL|variable|es1371_dac_clock
r_static
id|ratden_t
id|es1371_dac_clock
op_assign
(brace
dot
id|num_min
op_assign
l_int|3000
op_star
(paren
l_int|1
op_lshift
l_int|15
)paren
comma
dot
id|num_max
op_assign
l_int|48000
op_star
(paren
l_int|1
op_lshift
l_int|15
)paren
comma
dot
id|num_step
op_assign
l_int|3000
comma
dot
id|den
op_assign
l_int|1
op_lshift
l_int|15
comma
)brace
suffix:semicolon
DECL|variable|snd_es1371_hw_constraints_dac_clock
r_static
id|snd_pcm_hw_constraint_ratdens_t
id|snd_es1371_hw_constraints_dac_clock
op_assign
(brace
dot
id|nrats
op_assign
l_int|1
comma
dot
id|rats
op_assign
op_amp
id|es1371_dac_clock
comma
)brace
suffix:semicolon
DECL|variable|es1371_adc_clock
r_static
id|ratnum_t
id|es1371_adc_clock
op_assign
(brace
dot
id|num
op_assign
l_int|48000
op_lshift
l_int|15
comma
dot
id|den_min
op_assign
l_int|32768
comma
dot
id|den_max
op_assign
l_int|393216
comma
dot
id|den_step
op_assign
l_int|1
comma
)brace
suffix:semicolon
DECL|variable|snd_es1371_hw_constraints_adc_clock
r_static
id|snd_pcm_hw_constraint_ratnums_t
id|snd_es1371_hw_constraints_adc_clock
op_assign
(brace
dot
id|nrats
op_assign
l_int|1
comma
dot
id|rats
op_assign
op_amp
id|es1371_adc_clock
comma
)brace
suffix:semicolon
macro_line|#endif
DECL|variable|snd_ensoniq_sample_shift
r_static
r_const
r_int
r_int
id|snd_ensoniq_sample_shift
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|1
comma
l_int|1
comma
l_int|2
)brace
suffix:semicolon
multiline_comment|/*&n; *  common I/O routines&n; */
macro_line|#ifdef CHIP1371
DECL|function|snd_es1371_wait_src_ready
r_static
r_int
r_int
id|snd_es1371_wait_src_ready
c_func
(paren
id|ensoniq_t
op_star
id|ensoniq
)paren
(brace
r_int
r_int
id|t
comma
id|r
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|t
op_assign
l_int|0
suffix:semicolon
id|t
OL
id|POLL_COUNT
suffix:semicolon
id|t
op_increment
)paren
(brace
id|r
op_assign
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_SMPRATE
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_amp
id|ES_1371_SRC_RAM_BUSY
)paren
op_eq
l_int|0
)paren
r_return
id|r
suffix:semicolon
id|cond_resched
c_func
(paren
)paren
suffix:semicolon
)brace
id|snd_printk
c_func
(paren
l_string|&quot;wait source ready timeout 0x%lx [0x%x]&bslash;n&quot;
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_SMPRATE
)paren
comma
id|r
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1371_src_read
r_static
r_int
r_int
id|snd_es1371_src_read
c_func
(paren
id|ensoniq_t
op_star
id|ensoniq
comma
r_int
r_int
id|reg
)paren
(brace
r_int
r_int
id|temp
comma
id|i
comma
id|orig
comma
id|r
suffix:semicolon
multiline_comment|/* wait for ready */
id|temp
op_assign
id|orig
op_assign
id|snd_es1371_wait_src_ready
c_func
(paren
id|ensoniq
)paren
suffix:semicolon
multiline_comment|/* expose the SRC state bits */
id|r
op_assign
id|temp
op_amp
(paren
id|ES_1371_SRC_DISABLE
op_or
id|ES_1371_DIS_P1
op_or
id|ES_1371_DIS_P2
op_or
id|ES_1371_DIS_R1
)paren
suffix:semicolon
id|r
op_or_assign
id|ES_1371_SRC_RAM_ADDRO
c_func
(paren
id|reg
)paren
op_or
l_int|0x10000
suffix:semicolon
id|outl
c_func
(paren
id|r
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_SMPRATE
)paren
)paren
suffix:semicolon
multiline_comment|/* now, wait for busy and the correct time to read */
id|temp
op_assign
id|snd_es1371_wait_src_ready
c_func
(paren
id|ensoniq
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp
op_amp
l_int|0x00870000
)paren
op_ne
l_int|0x00010000
)paren
(brace
multiline_comment|/* wait for the right state */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|POLL_COUNT
suffix:semicolon
id|i
op_increment
)paren
(brace
id|temp
op_assign
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_SMPRATE
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|temp
op_amp
l_int|0x00870000
)paren
op_eq
l_int|0x00010000
)paren
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* hide the state bits */
id|r
op_assign
id|orig
op_amp
(paren
id|ES_1371_SRC_DISABLE
op_or
id|ES_1371_DIS_P1
op_or
id|ES_1371_DIS_P2
op_or
id|ES_1371_DIS_R1
)paren
suffix:semicolon
id|r
op_or_assign
id|ES_1371_SRC_RAM_ADDRO
c_func
(paren
id|reg
)paren
suffix:semicolon
id|outl
c_func
(paren
id|r
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_SMPRATE
)paren
)paren
suffix:semicolon
r_return
id|temp
suffix:semicolon
)brace
DECL|function|snd_es1371_src_write
r_static
r_void
id|snd_es1371_src_write
c_func
(paren
id|ensoniq_t
op_star
id|ensoniq
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|data
)paren
(brace
r_int
r_int
id|r
suffix:semicolon
id|r
op_assign
id|snd_es1371_wait_src_ready
c_func
(paren
id|ensoniq
)paren
op_amp
(paren
id|ES_1371_SRC_DISABLE
op_or
id|ES_1371_DIS_P1
op_or
id|ES_1371_DIS_P2
op_or
id|ES_1371_DIS_R1
)paren
suffix:semicolon
id|r
op_or_assign
id|ES_1371_SRC_RAM_ADDRO
c_func
(paren
id|reg
)paren
op_or
id|ES_1371_SRC_RAM_DATAO
c_func
(paren
id|data
)paren
suffix:semicolon
id|outl
c_func
(paren
id|r
op_or
id|ES_1371_SRC_RAM_WE
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_SMPRATE
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif /* CHIP1371 */
macro_line|#ifdef CHIP1370
DECL|function|snd_es1370_codec_write
r_static
r_void
id|snd_es1370_codec_write
c_func
(paren
id|ak4531_t
op_star
id|ak4531
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|ak4531-&gt;private_data
suffix:semicolon
r_int
r_int
id|end_time
op_assign
id|jiffies
op_plus
id|HZ
op_div
l_int|10
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;CODEC WRITE: reg = 0x%x, val = 0x%x (0x%x), creg = 0x%x&bslash;n&quot;
comma
id|reg
comma
id|val
comma
id|ES_1370_CODEC_WRITE
c_func
(paren
id|reg
comma
id|val
)paren
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1370
id|_CODEC
)paren
)paren
suffix:semicolon
macro_line|#endif
r_do
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|STATUS
)paren
)paren
op_amp
id|ES_1370_CSTAT
)paren
)paren
(brace
id|outw
c_func
(paren
id|ES_1370_CODEC_WRITE
c_func
(paren
id|reg
comma
id|val
)paren
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1370
id|_CODEC
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|time_after
c_func
(paren
id|end_time
comma
id|jiffies
)paren
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;codec write timeout, status = 0x%x&bslash;n&quot;
comma
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|STATUS
)paren
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif /* CHIP1370 */
macro_line|#ifdef CHIP1371
DECL|function|snd_es1371_codec_write
r_static
r_void
id|snd_es1371_codec_write
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|ac97-&gt;private_data
suffix:semicolon
r_int
r_int
id|t
comma
id|x
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ensoniq-&gt;src_mutex
)paren
suffix:semicolon
r_for
c_loop
(paren
id|t
op_assign
l_int|0
suffix:semicolon
id|t
OL
id|POLL_COUNT
suffix:semicolon
id|t
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_CODEC
)paren
)paren
op_amp
id|ES_1371_CODEC_WIP
)paren
)paren
(brace
multiline_comment|/* save the current state for latter */
id|x
op_assign
id|snd_es1371_wait_src_ready
c_func
(paren
id|ensoniq
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|x
op_amp
(paren
id|ES_1371_SRC_DISABLE
op_or
id|ES_1371_DIS_P1
op_or
id|ES_1371_DIS_P2
op_or
id|ES_1371_DIS_R1
)paren
)paren
op_or
l_int|0x00010000
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_SMPRATE
)paren
)paren
suffix:semicolon
multiline_comment|/* wait for not busy (state 0) first to avoid&n;&t;&t;&t;   transition states */
r_for
c_loop
(paren
id|t
op_assign
l_int|0
suffix:semicolon
id|t
OL
id|POLL_COUNT
suffix:semicolon
id|t
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_SMPRATE
)paren
)paren
op_amp
l_int|0x00870000
)paren
op_eq
l_int|0x00000000
)paren
r_break
suffix:semicolon
)brace
multiline_comment|/* wait for a SAFE time to write addr/data and then do it, dammit */
r_for
c_loop
(paren
id|t
op_assign
l_int|0
suffix:semicolon
id|t
OL
id|POLL_COUNT
suffix:semicolon
id|t
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_SMPRATE
)paren
)paren
op_amp
l_int|0x00870000
)paren
op_eq
l_int|0x00010000
)paren
r_break
suffix:semicolon
)brace
id|outl
c_func
(paren
id|ES_1371_CODEC_WRITE
c_func
(paren
id|reg
comma
id|val
)paren
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_CODEC
)paren
)paren
suffix:semicolon
multiline_comment|/* restore SRC reg */
id|snd_es1371_wait_src_ready
c_func
(paren
id|ensoniq
)paren
suffix:semicolon
id|outl
c_func
(paren
id|x
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_SMPRATE
)paren
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ensoniq-&gt;src_mutex
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|ensoniq-&gt;src_mutex
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;codec write timeout at 0x%lx [0x%x]&bslash;n&quot;
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_CODEC
)paren
comma
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_CODEC
)paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_es1371_codec_read
r_static
r_int
r_int
id|snd_es1371_codec_read
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|ac97-&gt;private_data
suffix:semicolon
r_int
r_int
id|t
comma
id|x
comma
id|fail
op_assign
l_int|0
suffix:semicolon
id|__again
suffix:colon
id|down
c_func
(paren
op_amp
id|ensoniq-&gt;src_mutex
)paren
suffix:semicolon
r_for
c_loop
(paren
id|t
op_assign
l_int|0
suffix:semicolon
id|t
OL
id|POLL_COUNT
suffix:semicolon
id|t
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_CODEC
)paren
)paren
op_amp
id|ES_1371_CODEC_WIP
)paren
)paren
(brace
multiline_comment|/* save the current state for latter */
id|x
op_assign
id|snd_es1371_wait_src_ready
c_func
(paren
id|ensoniq
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|x
op_amp
(paren
id|ES_1371_SRC_DISABLE
op_or
id|ES_1371_DIS_P1
op_or
id|ES_1371_DIS_P2
op_or
id|ES_1371_DIS_R1
)paren
)paren
op_or
l_int|0x00010000
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_SMPRATE
)paren
)paren
suffix:semicolon
multiline_comment|/* wait for not busy (state 0) first to avoid&n;&t;&t;&t;   transition states */
r_for
c_loop
(paren
id|t
op_assign
l_int|0
suffix:semicolon
id|t
OL
id|POLL_COUNT
suffix:semicolon
id|t
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_SMPRATE
)paren
)paren
op_amp
l_int|0x00870000
)paren
op_eq
l_int|0x00000000
)paren
r_break
suffix:semicolon
)brace
multiline_comment|/* wait for a SAFE time to write addr/data and then do it, dammit */
r_for
c_loop
(paren
id|t
op_assign
l_int|0
suffix:semicolon
id|t
OL
id|POLL_COUNT
suffix:semicolon
id|t
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_SMPRATE
)paren
)paren
op_amp
l_int|0x00870000
)paren
op_eq
l_int|0x00010000
)paren
r_break
suffix:semicolon
)brace
id|outl
c_func
(paren
id|ES_1371_CODEC_READS
c_func
(paren
id|reg
)paren
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_CODEC
)paren
)paren
suffix:semicolon
multiline_comment|/* restore SRC reg */
id|snd_es1371_wait_src_ready
c_func
(paren
id|ensoniq
)paren
suffix:semicolon
id|outl
c_func
(paren
id|x
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_SMPRATE
)paren
)paren
suffix:semicolon
multiline_comment|/* wait for WIP again */
r_for
c_loop
(paren
id|t
op_assign
l_int|0
suffix:semicolon
id|t
OL
id|POLL_COUNT
suffix:semicolon
id|t
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_CODEC
)paren
)paren
op_amp
id|ES_1371_CODEC_WIP
)paren
)paren
r_break
suffix:semicolon
)brace
multiline_comment|/* now wait for the stinkin&squot; data (RDY) */
r_for
c_loop
(paren
id|t
op_assign
l_int|0
suffix:semicolon
id|t
OL
id|POLL_COUNT
suffix:semicolon
id|t
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|x
op_assign
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_CODEC
)paren
)paren
)paren
op_amp
id|ES_1371_CODEC_RDY
)paren
(brace
id|up
c_func
(paren
op_amp
id|ensoniq-&gt;src_mutex
)paren
suffix:semicolon
r_return
id|ES_1371_CODEC_READ
c_func
(paren
id|x
)paren
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|ensoniq-&gt;src_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|fail
OG
l_int|10
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;codec read timeout (final) at 0x%lx, reg = 0x%x [0x%x]&bslash;n&quot;
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_CODEC
)paren
comma
id|reg
comma
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_CODEC
)paren
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_goto
id|__again
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|ensoniq-&gt;src_mutex
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;es1371: codec read timeout at 0x%lx [0x%x]&bslash;n&quot;
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_CODEC
)paren
comma
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_CODEC
)paren
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1371_adc_rate
r_static
r_void
id|snd_es1371_adc_rate
c_func
(paren
id|ensoniq_t
op_star
id|ensoniq
comma
r_int
r_int
id|rate
)paren
(brace
r_int
r_int
id|n
comma
id|truncm
comma
id|freq
comma
id|result
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ensoniq-&gt;src_mutex
)paren
suffix:semicolon
id|n
op_assign
id|rate
op_div
l_int|3000
suffix:semicolon
r_if
c_cond
(paren
(paren
l_int|1
op_lshift
id|n
)paren
op_amp
(paren
(paren
l_int|1
op_lshift
l_int|15
)paren
op_or
(paren
l_int|1
op_lshift
l_int|13
)paren
op_or
(paren
l_int|1
op_lshift
l_int|11
)paren
op_or
(paren
l_int|1
op_lshift
l_int|9
)paren
)paren
)paren
id|n
op_decrement
suffix:semicolon
id|truncm
op_assign
(paren
l_int|21
op_star
id|n
op_minus
l_int|1
)paren
op_or
l_int|1
suffix:semicolon
id|freq
op_assign
(paren
(paren
l_int|48000UL
op_lshift
l_int|15
)paren
op_div
id|rate
)paren
op_star
id|n
suffix:semicolon
id|result
op_assign
(paren
l_int|48000UL
op_lshift
l_int|15
)paren
op_div
(paren
id|freq
op_div
id|n
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rate
op_ge
l_int|24000
)paren
(brace
r_if
c_cond
(paren
id|truncm
OG
l_int|239
)paren
id|truncm
op_assign
l_int|239
suffix:semicolon
id|snd_es1371_src_write
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_ADC
op_plus
id|ES_SMPREG_TRUNC_N
comma
(paren
(paren
(paren
l_int|239
op_minus
id|truncm
)paren
op_rshift
l_int|1
)paren
op_lshift
l_int|9
)paren
op_or
(paren
id|n
op_lshift
l_int|4
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|truncm
OG
l_int|119
)paren
id|truncm
op_assign
l_int|119
suffix:semicolon
id|snd_es1371_src_write
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_ADC
op_plus
id|ES_SMPREG_TRUNC_N
comma
l_int|0x8000
op_or
(paren
(paren
(paren
l_int|119
op_minus
id|truncm
)paren
op_rshift
l_int|1
)paren
op_lshift
l_int|9
)paren
op_or
(paren
id|n
op_lshift
l_int|4
)paren
)paren
suffix:semicolon
)brace
id|snd_es1371_src_write
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_ADC
op_plus
id|ES_SMPREG_INT_REGS
comma
(paren
id|snd_es1371_src_read
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_ADC
op_plus
id|ES_SMPREG_INT_REGS
)paren
op_amp
l_int|0x00ff
)paren
op_or
(paren
(paren
id|freq
op_rshift
l_int|5
)paren
op_amp
l_int|0xfc00
)paren
)paren
suffix:semicolon
id|snd_es1371_src_write
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_ADC
op_plus
id|ES_SMPREG_VFREQ_FRAC
comma
id|freq
op_amp
l_int|0x7fff
)paren
suffix:semicolon
id|snd_es1371_src_write
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_VOL_ADC
comma
id|n
op_lshift
l_int|8
)paren
suffix:semicolon
id|snd_es1371_src_write
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_VOL_ADC
op_plus
l_int|1
comma
id|n
op_lshift
l_int|8
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ensoniq-&gt;src_mutex
)paren
suffix:semicolon
)brace
DECL|function|snd_es1371_dac1_rate
r_static
r_void
id|snd_es1371_dac1_rate
c_func
(paren
id|ensoniq_t
op_star
id|ensoniq
comma
r_int
r_int
id|rate
)paren
(brace
r_int
r_int
id|freq
comma
id|r
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ensoniq-&gt;src_mutex
)paren
suffix:semicolon
id|freq
op_assign
(paren
(paren
id|rate
op_lshift
l_int|15
)paren
op_plus
l_int|1500
)paren
op_div
l_int|3000
suffix:semicolon
id|r
op_assign
(paren
id|snd_es1371_wait_src_ready
c_func
(paren
id|ensoniq
)paren
op_amp
(paren
id|ES_1371_SRC_DISABLE
op_or
id|ES_1371_DIS_P2
op_or
id|ES_1371_DIS_R1
)paren
)paren
op_or
id|ES_1371_DIS_P1
suffix:semicolon
id|outl
c_func
(paren
id|r
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_SMPRATE
)paren
)paren
suffix:semicolon
id|snd_es1371_src_write
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_DAC1
op_plus
id|ES_SMPREG_INT_REGS
comma
(paren
id|snd_es1371_src_read
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_DAC1
op_plus
id|ES_SMPREG_INT_REGS
)paren
op_amp
l_int|0x00ff
)paren
op_or
(paren
(paren
id|freq
op_rshift
l_int|5
)paren
op_amp
l_int|0xfc00
)paren
)paren
suffix:semicolon
id|snd_es1371_src_write
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_DAC1
op_plus
id|ES_SMPREG_VFREQ_FRAC
comma
id|freq
op_amp
l_int|0x7fff
)paren
suffix:semicolon
id|r
op_assign
(paren
id|snd_es1371_wait_src_ready
c_func
(paren
id|ensoniq
)paren
op_amp
(paren
id|ES_1371_SRC_DISABLE
op_or
id|ES_1371_DIS_P2
op_or
id|ES_1371_DIS_R1
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|r
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_SMPRATE
)paren
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ensoniq-&gt;src_mutex
)paren
suffix:semicolon
)brace
DECL|function|snd_es1371_dac2_rate
r_static
r_void
id|snd_es1371_dac2_rate
c_func
(paren
id|ensoniq_t
op_star
id|ensoniq
comma
r_int
r_int
id|rate
)paren
(brace
r_int
r_int
id|freq
comma
id|r
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ensoniq-&gt;src_mutex
)paren
suffix:semicolon
id|freq
op_assign
(paren
(paren
id|rate
op_lshift
l_int|15
)paren
op_plus
l_int|1500
)paren
op_div
l_int|3000
suffix:semicolon
id|r
op_assign
(paren
id|snd_es1371_wait_src_ready
c_func
(paren
id|ensoniq
)paren
op_amp
(paren
id|ES_1371_SRC_DISABLE
op_or
id|ES_1371_DIS_P1
op_or
id|ES_1371_DIS_R1
)paren
)paren
op_or
id|ES_1371_DIS_P2
suffix:semicolon
id|outl
c_func
(paren
id|r
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_SMPRATE
)paren
)paren
suffix:semicolon
id|snd_es1371_src_write
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_DAC2
op_plus
id|ES_SMPREG_INT_REGS
comma
(paren
id|snd_es1371_src_read
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_DAC2
op_plus
id|ES_SMPREG_INT_REGS
)paren
op_amp
l_int|0x00ff
)paren
op_or
(paren
(paren
id|freq
op_rshift
l_int|5
)paren
op_amp
l_int|0xfc00
)paren
)paren
suffix:semicolon
id|snd_es1371_src_write
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_DAC2
op_plus
id|ES_SMPREG_VFREQ_FRAC
comma
id|freq
op_amp
l_int|0x7fff
)paren
suffix:semicolon
id|r
op_assign
(paren
id|snd_es1371_wait_src_ready
c_func
(paren
id|ensoniq
)paren
op_amp
(paren
id|ES_1371_SRC_DISABLE
op_or
id|ES_1371_DIS_P1
op_or
id|ES_1371_DIS_R1
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|r
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_SMPRATE
)paren
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ensoniq-&gt;src_mutex
)paren
suffix:semicolon
)brace
macro_line|#endif /* CHIP1371 */
DECL|function|snd_ensoniq_trigger
r_static
r_int
id|snd_ensoniq_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_PUSH
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_RELEASE
suffix:colon
(brace
r_int
r_int
id|what
op_assign
l_int|0
suffix:semicolon
r_struct
id|list_head
op_star
id|pos
suffix:semicolon
id|snd_pcm_substream_t
op_star
id|s
suffix:semicolon
id|snd_pcm_group_for_each
c_func
(paren
id|pos
comma
id|substream
)paren
(brace
id|s
op_assign
id|snd_pcm_group_substream_entry
c_func
(paren
id|pos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s
op_eq
id|ensoniq-&gt;playback1_substream
)paren
(brace
id|what
op_or_assign
id|ES_P1_PAUSE
suffix:semicolon
id|snd_pcm_trigger_done
c_func
(paren
id|s
comma
id|substream
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|s
op_eq
id|ensoniq-&gt;playback2_substream
)paren
(brace
id|what
op_or_assign
id|ES_P2_PAUSE
suffix:semicolon
id|snd_pcm_trigger_done
c_func
(paren
id|s
comma
id|substream
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|s
op_eq
id|ensoniq-&gt;capture_substream
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_lock
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_PAUSE_PUSH
)paren
id|ensoniq-&gt;sctrl
op_or_assign
id|what
suffix:semicolon
r_else
id|ensoniq-&gt;sctrl
op_and_assign
op_complement
id|what
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;sctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|SERIAL
)paren
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
(brace
r_int
r_int
id|what
op_assign
l_int|0
suffix:semicolon
r_struct
id|list_head
op_star
id|pos
suffix:semicolon
id|snd_pcm_substream_t
op_star
id|s
suffix:semicolon
id|snd_pcm_group_for_each
c_func
(paren
id|pos
comma
id|substream
)paren
(brace
id|s
op_assign
id|snd_pcm_group_substream_entry
c_func
(paren
id|pos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s
op_eq
id|ensoniq-&gt;playback1_substream
)paren
(brace
id|what
op_or_assign
id|ES_DAC1_EN
suffix:semicolon
id|snd_pcm_trigger_done
c_func
(paren
id|s
comma
id|substream
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|s
op_eq
id|ensoniq-&gt;playback2_substream
)paren
(brace
id|what
op_or_assign
id|ES_DAC2_EN
suffix:semicolon
id|snd_pcm_trigger_done
c_func
(paren
id|s
comma
id|substream
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|s
op_eq
id|ensoniq-&gt;capture_substream
)paren
(brace
id|what
op_or_assign
id|ES_ADC_EN
suffix:semicolon
id|snd_pcm_trigger_done
c_func
(paren
id|s
comma
id|substream
)paren
suffix:semicolon
)brace
)brace
id|spin_lock
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_START
)paren
id|ensoniq-&gt;ctrl
op_or_assign
id|what
suffix:semicolon
r_else
id|ensoniq-&gt;ctrl
op_and_assign
op_complement
id|what
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;ctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  PCM part&n; */
DECL|function|snd_ensoniq_hw_params
r_static
r_int
id|snd_ensoniq_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
r_return
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_ensoniq_hw_free
r_static
r_int
id|snd_ensoniq_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
DECL|function|snd_ensoniq_playback1_prepare
r_static
r_int
id|snd_ensoniq_playback1_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
r_int
id|mode
op_assign
l_int|0
suffix:semicolon
id|ensoniq-&gt;p1_dma_size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|ensoniq-&gt;p1_period_size
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|16
)paren
id|mode
op_or_assign
l_int|0x02
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;channels
OG
l_int|1
)paren
id|mode
op_or_assign
l_int|0x01
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
id|ensoniq-&gt;ctrl
op_and_assign
op_complement
id|ES_DAC1_EN
suffix:semicolon
macro_line|#ifdef CHIP1371
multiline_comment|/* 48k doesn&squot;t need SRC (it breaks AC3-passthru) */
r_if
c_cond
(paren
id|runtime-&gt;rate
op_eq
l_int|48000
)paren
id|ensoniq-&gt;ctrl
op_or_assign
id|ES_1373_BYPASS_P1
suffix:semicolon
r_else
id|ensoniq-&gt;ctrl
op_and_assign
op_complement
id|ES_1373_BYPASS_P1
suffix:semicolon
macro_line|#endif
id|outl
c_func
(paren
id|ensoniq-&gt;ctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ES_MEM_PAGEO
c_func
(paren
id|ES_PAGE_DAC
)paren
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|MEM_PAGE
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|runtime-&gt;dma_addr
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|DAC1_FRAME
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|ensoniq-&gt;p1_dma_size
op_rshift
l_int|2
)paren
op_minus
l_int|1
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|DAC1_SIZE
)paren
)paren
suffix:semicolon
id|ensoniq-&gt;sctrl
op_and_assign
op_complement
(paren
id|ES_P1_LOOP_SEL
op_or
id|ES_P1_PAUSE
op_or
id|ES_P1_SCT_RLD
op_or
id|ES_P1_MODEM
)paren
suffix:semicolon
id|ensoniq-&gt;sctrl
op_or_assign
id|ES_P1_INT_EN
op_or
id|ES_P1_MODEO
c_func
(paren
id|mode
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;sctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|SERIAL
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|ensoniq-&gt;p1_period_size
op_rshift
id|snd_ensoniq_sample_shift
(braket
id|mode
)braket
)paren
op_minus
l_int|1
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|DAC1_COUNT
)paren
)paren
suffix:semicolon
macro_line|#ifdef CHIP1370
id|ensoniq-&gt;ctrl
op_and_assign
op_complement
id|ES_1370_WTSRSELM
suffix:semicolon
r_switch
c_cond
(paren
id|runtime-&gt;rate
)paren
(brace
r_case
l_int|5512
suffix:colon
id|ensoniq-&gt;ctrl
op_or_assign
id|ES_1370_WTSRSEL
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|11025
suffix:colon
id|ensoniq-&gt;ctrl
op_or_assign
id|ES_1370_WTSRSEL
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|22050
suffix:colon
id|ensoniq-&gt;ctrl
op_or_assign
id|ES_1370_WTSRSEL
c_func
(paren
l_int|2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|44100
suffix:colon
id|ensoniq-&gt;ctrl
op_or_assign
id|ES_1370_WTSRSEL
c_func
(paren
l_int|3
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|snd_BUG
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
id|outl
c_func
(paren
id|ensoniq-&gt;ctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
macro_line|#ifndef CHIP1370
id|snd_es1371_dac1_rate
c_func
(paren
id|ensoniq
comma
id|runtime-&gt;rate
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ensoniq_playback2_prepare
r_static
r_int
id|snd_ensoniq_playback2_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
r_int
id|mode
op_assign
l_int|0
suffix:semicolon
id|ensoniq-&gt;p2_dma_size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|ensoniq-&gt;p2_period_size
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|16
)paren
id|mode
op_or_assign
l_int|0x02
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;channels
OG
l_int|1
)paren
id|mode
op_or_assign
l_int|0x01
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
id|ensoniq-&gt;ctrl
op_and_assign
op_complement
id|ES_DAC2_EN
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;ctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ES_MEM_PAGEO
c_func
(paren
id|ES_PAGE_DAC
)paren
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|MEM_PAGE
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|runtime-&gt;dma_addr
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|DAC2_FRAME
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|ensoniq-&gt;p2_dma_size
op_rshift
l_int|2
)paren
op_minus
l_int|1
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|DAC2_SIZE
)paren
)paren
suffix:semicolon
id|ensoniq-&gt;sctrl
op_and_assign
op_complement
(paren
id|ES_P2_LOOP_SEL
op_or
id|ES_P2_PAUSE
op_or
id|ES_P2_DAC_SEN
op_or
id|ES_P2_END_INCM
op_or
id|ES_P2_ST_INCM
op_or
id|ES_P2_MODEM
)paren
suffix:semicolon
id|ensoniq-&gt;sctrl
op_or_assign
id|ES_P2_INT_EN
op_or
id|ES_P2_MODEO
c_func
(paren
id|mode
)paren
op_or
id|ES_P2_END_INCO
c_func
(paren
id|mode
op_amp
l_int|2
ques
c_cond
l_int|2
suffix:colon
l_int|1
)paren
op_or
id|ES_P2_ST_INCO
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;sctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|SERIAL
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|ensoniq-&gt;p2_period_size
op_rshift
id|snd_ensoniq_sample_shift
(braket
id|mode
)braket
)paren
op_minus
l_int|1
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|DAC2_COUNT
)paren
)paren
suffix:semicolon
macro_line|#ifdef CHIP1370
r_if
c_cond
(paren
op_logical_neg
(paren
id|ensoniq-&gt;u.es1370.pclkdiv_lock
op_amp
id|ES_MODE_CAPTURE
)paren
)paren
(brace
id|ensoniq-&gt;ctrl
op_and_assign
op_complement
id|ES_1370_PCLKDIVM
suffix:semicolon
id|ensoniq-&gt;ctrl
op_or_assign
id|ES_1370_PCLKDIVO
c_func
(paren
id|ES_1370_SRTODIV
c_func
(paren
id|runtime-&gt;rate
)paren
)paren
suffix:semicolon
id|ensoniq-&gt;u.es1370.pclkdiv_lock
op_or_assign
id|ES_MODE_PLAY2
suffix:semicolon
)brace
macro_line|#endif
id|outl
c_func
(paren
id|ensoniq-&gt;ctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
macro_line|#ifndef CHIP1370
id|snd_es1371_dac2_rate
c_func
(paren
id|ensoniq
comma
id|runtime-&gt;rate
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ensoniq_capture_prepare
r_static
r_int
id|snd_ensoniq_capture_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
r_int
id|mode
op_assign
l_int|0
suffix:semicolon
id|ensoniq-&gt;c_dma_size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|ensoniq-&gt;c_period_size
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|16
)paren
id|mode
op_or_assign
l_int|0x02
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;channels
OG
l_int|1
)paren
id|mode
op_or_assign
l_int|0x01
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
id|ensoniq-&gt;ctrl
op_and_assign
op_complement
id|ES_ADC_EN
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;ctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ES_MEM_PAGEO
c_func
(paren
id|ES_PAGE_ADC
)paren
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|MEM_PAGE
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|runtime-&gt;dma_addr
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|ADC_FRAME
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|ensoniq-&gt;c_dma_size
op_rshift
l_int|2
)paren
op_minus
l_int|1
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|ADC_SIZE
)paren
)paren
suffix:semicolon
id|ensoniq-&gt;sctrl
op_and_assign
op_complement
(paren
id|ES_R1_LOOP_SEL
op_or
id|ES_R1_MODEM
)paren
suffix:semicolon
id|ensoniq-&gt;sctrl
op_or_assign
id|ES_R1_INT_EN
op_or
id|ES_R1_MODEO
c_func
(paren
id|mode
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;sctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|SERIAL
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|ensoniq-&gt;c_period_size
op_rshift
id|snd_ensoniq_sample_shift
(braket
id|mode
)braket
)paren
op_minus
l_int|1
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|ADC_COUNT
)paren
)paren
suffix:semicolon
macro_line|#ifdef CHIP1370
r_if
c_cond
(paren
op_logical_neg
(paren
id|ensoniq-&gt;u.es1370.pclkdiv_lock
op_amp
id|ES_MODE_PLAY2
)paren
)paren
(brace
id|ensoniq-&gt;ctrl
op_and_assign
op_complement
id|ES_1370_PCLKDIVM
suffix:semicolon
id|ensoniq-&gt;ctrl
op_or_assign
id|ES_1370_PCLKDIVO
c_func
(paren
id|ES_1370_SRTODIV
c_func
(paren
id|runtime-&gt;rate
)paren
)paren
suffix:semicolon
id|ensoniq-&gt;u.es1370.pclkdiv_lock
op_or_assign
id|ES_MODE_CAPTURE
suffix:semicolon
)brace
macro_line|#endif
id|outl
c_func
(paren
id|ensoniq-&gt;ctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
macro_line|#ifndef CHIP1370
id|snd_es1371_adc_rate
c_func
(paren
id|ensoniq
comma
id|runtime-&gt;rate
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ensoniq_playback1_pointer
r_static
id|snd_pcm_uframes_t
id|snd_ensoniq_playback1_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
op_amp
id|ES_DAC1_EN
)paren
(brace
id|outl
c_func
(paren
id|ES_MEM_PAGEO
c_func
(paren
id|ES_PAGE_DAC
)paren
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|MEM_PAGE
)paren
)paren
suffix:semicolon
id|ptr
op_assign
id|ES_REG_FCURR_COUNTI
c_func
(paren
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|DAC1_SIZE
)paren
)paren
)paren
suffix:semicolon
id|ptr
op_assign
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|ptr
)paren
suffix:semicolon
)brace
r_else
(brace
id|ptr
op_assign
l_int|0
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|ptr
suffix:semicolon
)brace
DECL|function|snd_ensoniq_playback2_pointer
r_static
id|snd_pcm_uframes_t
id|snd_ensoniq_playback2_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
op_amp
id|ES_DAC2_EN
)paren
(brace
id|outl
c_func
(paren
id|ES_MEM_PAGEO
c_func
(paren
id|ES_PAGE_DAC
)paren
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|MEM_PAGE
)paren
)paren
suffix:semicolon
id|ptr
op_assign
id|ES_REG_FCURR_COUNTI
c_func
(paren
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|DAC2_SIZE
)paren
)paren
)paren
suffix:semicolon
id|ptr
op_assign
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|ptr
)paren
suffix:semicolon
)brace
r_else
(brace
id|ptr
op_assign
l_int|0
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|ptr
suffix:semicolon
)brace
DECL|function|snd_ensoniq_capture_pointer
r_static
id|snd_pcm_uframes_t
id|snd_ensoniq_capture_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
op_amp
id|ES_ADC_EN
)paren
(brace
id|outl
c_func
(paren
id|ES_MEM_PAGEO
c_func
(paren
id|ES_PAGE_ADC
)paren
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|MEM_PAGE
)paren
)paren
suffix:semicolon
id|ptr
op_assign
id|ES_REG_FCURR_COUNTI
c_func
(paren
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|ADC_SIZE
)paren
)paren
)paren
suffix:semicolon
id|ptr
op_assign
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|ptr
)paren
suffix:semicolon
)brace
r_else
(brace
id|ptr
op_assign
l_int|0
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|ptr
suffix:semicolon
)brace
DECL|variable|snd_ensoniq_playback1
r_static
id|snd_pcm_hardware_t
id|snd_ensoniq_playback1
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_PAUSE
op_or
id|SNDRV_PCM_INFO_SYNC_START
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
macro_line|#ifndef CHIP1370
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
macro_line|#else
(paren
id|SNDRV_PCM_RATE_KNOT
op_or
multiline_comment|/* 5512Hz rate */
id|SNDRV_PCM_RATE_11025
op_or
id|SNDRV_PCM_RATE_22050
op_or
id|SNDRV_PCM_RATE_44100
)paren
comma
macro_line|#endif
dot
id|rate_min
op_assign
l_int|4000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|1024
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|snd_ensoniq_playback2
r_static
id|snd_pcm_hardware_t
id|snd_ensoniq_playback2
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_PAUSE
op_or
id|SNDRV_PCM_INFO_SYNC_START
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
dot
id|rate_min
op_assign
l_int|4000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|1024
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|snd_ensoniq_capture
r_static
id|snd_pcm_hardware_t
id|snd_ensoniq_capture
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_SYNC_START
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
dot
id|rate_min
op_assign
l_int|4000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|1024
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|function|snd_ensoniq_playback1_open
r_static
r_int
id|snd_ensoniq_playback1_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|ensoniq-&gt;mode
op_or_assign
id|ES_MODE_PLAY1
suffix:semicolon
id|ensoniq-&gt;playback1_substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_ensoniq_playback1
suffix:semicolon
id|snd_pcm_set_sync
c_func
(paren
id|substream
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ensoniq-&gt;spdif
op_logical_and
id|ensoniq-&gt;playback2_substream
op_eq
l_int|NULL
)paren
id|ensoniq-&gt;spdif_stream
op_assign
id|ensoniq-&gt;spdif_default
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
macro_line|#ifdef CHIP1370
id|snd_pcm_hw_constraint_list
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
op_amp
id|snd_es1370_hw_constraints_rates
)paren
suffix:semicolon
macro_line|#else
id|snd_pcm_hw_constraint_ratdens
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
op_amp
id|snd_es1371_hw_constraints_dac_clock
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ensoniq_playback2_open
r_static
r_int
id|snd_ensoniq_playback2_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|ensoniq-&gt;mode
op_or_assign
id|ES_MODE_PLAY2
suffix:semicolon
id|ensoniq-&gt;playback2_substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_ensoniq_playback2
suffix:semicolon
id|snd_pcm_set_sync
c_func
(paren
id|substream
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ensoniq-&gt;spdif
op_logical_and
id|ensoniq-&gt;playback1_substream
op_eq
l_int|NULL
)paren
id|ensoniq-&gt;spdif_stream
op_assign
id|ensoniq-&gt;spdif_default
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
macro_line|#ifdef CHIP1370
id|snd_pcm_hw_constraint_ratnums
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
op_amp
id|snd_es1370_hw_constraints_clock
)paren
suffix:semicolon
macro_line|#else
id|snd_pcm_hw_constraint_ratdens
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
op_amp
id|snd_es1371_hw_constraints_dac_clock
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ensoniq_capture_open
r_static
r_int
id|snd_ensoniq_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|ensoniq-&gt;mode
op_or_assign
id|ES_MODE_CAPTURE
suffix:semicolon
id|ensoniq-&gt;capture_substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_ensoniq_capture
suffix:semicolon
id|snd_pcm_set_sync
c_func
(paren
id|substream
)paren
suffix:semicolon
macro_line|#ifdef CHIP1370
id|snd_pcm_hw_constraint_ratnums
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
op_amp
id|snd_es1370_hw_constraints_clock
)paren
suffix:semicolon
macro_line|#else
id|snd_pcm_hw_constraint_ratnums
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
op_amp
id|snd_es1371_hw_constraints_adc_clock
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ensoniq_playback1_close
r_static
r_int
id|snd_ensoniq_playback1_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|ensoniq-&gt;playback1_substream
op_assign
l_int|NULL
suffix:semicolon
id|ensoniq-&gt;mode
op_and_assign
op_complement
id|ES_MODE_PLAY1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ensoniq_playback2_close
r_static
r_int
id|snd_ensoniq_playback2_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|ensoniq-&gt;playback2_substream
op_assign
l_int|NULL
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
macro_line|#ifdef CHIP1370
id|ensoniq-&gt;u.es1370.pclkdiv_lock
op_and_assign
op_complement
id|ES_MODE_PLAY2
suffix:semicolon
macro_line|#endif
id|ensoniq-&gt;mode
op_and_assign
op_complement
id|ES_MODE_PLAY2
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ensoniq_capture_close
r_static
r_int
id|snd_ensoniq_capture_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|ensoniq-&gt;capture_substream
op_assign
l_int|NULL
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
macro_line|#ifdef CHIP1370
id|ensoniq-&gt;u.es1370.pclkdiv_lock
op_and_assign
op_complement
id|ES_MODE_CAPTURE
suffix:semicolon
macro_line|#endif
id|ensoniq-&gt;mode
op_and_assign
op_complement
id|ES_MODE_CAPTURE
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_ensoniq_playback1_ops
r_static
id|snd_pcm_ops_t
id|snd_ensoniq_playback1_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_ensoniq_playback1_open
comma
dot
id|close
op_assign
id|snd_ensoniq_playback1_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_ensoniq_hw_params
comma
dot
id|hw_free
op_assign
id|snd_ensoniq_hw_free
comma
dot
id|prepare
op_assign
id|snd_ensoniq_playback1_prepare
comma
dot
id|trigger
op_assign
id|snd_ensoniq_trigger
comma
dot
id|pointer
op_assign
id|snd_ensoniq_playback1_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_ensoniq_playback2_ops
r_static
id|snd_pcm_ops_t
id|snd_ensoniq_playback2_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_ensoniq_playback2_open
comma
dot
id|close
op_assign
id|snd_ensoniq_playback2_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_ensoniq_hw_params
comma
dot
id|hw_free
op_assign
id|snd_ensoniq_hw_free
comma
dot
id|prepare
op_assign
id|snd_ensoniq_playback2_prepare
comma
dot
id|trigger
op_assign
id|snd_ensoniq_trigger
comma
dot
id|pointer
op_assign
id|snd_ensoniq_playback2_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_ensoniq_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_ensoniq_capture_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_ensoniq_capture_open
comma
dot
id|close
op_assign
id|snd_ensoniq_capture_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_ensoniq_hw_params
comma
dot
id|hw_free
op_assign
id|snd_ensoniq_hw_free
comma
dot
id|prepare
op_assign
id|snd_ensoniq_capture_prepare
comma
dot
id|trigger
op_assign
id|snd_ensoniq_trigger
comma
dot
id|pointer
op_assign
id|snd_ensoniq_capture_pointer
comma
)brace
suffix:semicolon
DECL|function|snd_ensoniq_pcm_free
r_static
r_void
id|snd_ensoniq_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|pcm-&gt;private_data
suffix:semicolon
id|ensoniq-&gt;pcm1
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_ensoniq_pcm
r_static
r_int
id|__devinit
id|snd_ensoniq_pcm
c_func
(paren
id|ensoniq_t
op_star
id|ensoniq
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
macro_line|#ifdef CHIP1370
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|ensoniq-&gt;card
comma
l_string|&quot;ES1370/1&quot;
comma
id|device
comma
l_int|1
comma
l_int|1
comma
op_amp
id|pcm
)paren
suffix:semicolon
macro_line|#else
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|ensoniq-&gt;card
comma
l_string|&quot;ES1371/1&quot;
comma
id|device
comma
l_int|1
comma
l_int|1
comma
op_amp
id|pcm
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
macro_line|#ifdef CHIP1370
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_ensoniq_playback2_ops
)paren
suffix:semicolon
macro_line|#else
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_ensoniq_playback1_ops
)paren
suffix:semicolon
macro_line|#endif
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_ensoniq_capture_ops
)paren
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|ensoniq
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_ensoniq_pcm_free
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CHIP1370
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;ES1370 DAC2/ADC&quot;
)paren
suffix:semicolon
macro_line|#else
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;ES1371 DAC2/ADC&quot;
)paren
suffix:semicolon
macro_line|#endif
id|ensoniq-&gt;pcm1
op_assign
id|pcm
suffix:semicolon
id|snd_pcm_lib_preallocate_pages_for_all
c_func
(paren
id|pcm
comma
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|ensoniq-&gt;pci
)paren
comma
l_int|64
op_star
l_int|1024
comma
l_int|128
op_star
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ensoniq_pcm_free2
r_static
r_void
id|snd_ensoniq_pcm_free2
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|pcm-&gt;private_data
suffix:semicolon
id|ensoniq-&gt;pcm2
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_ensoniq_pcm2
r_static
r_int
id|__devinit
id|snd_ensoniq_pcm2
c_func
(paren
id|ensoniq_t
op_star
id|ensoniq
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
macro_line|#ifdef CHIP1370
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|ensoniq-&gt;card
comma
l_string|&quot;ES1370/2&quot;
comma
id|device
comma
l_int|1
comma
l_int|0
comma
op_amp
id|pcm
)paren
suffix:semicolon
macro_line|#else
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|ensoniq-&gt;card
comma
l_string|&quot;ES1371/2&quot;
comma
id|device
comma
l_int|1
comma
l_int|0
comma
op_amp
id|pcm
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
macro_line|#ifdef CHIP1370
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_ensoniq_playback1_ops
)paren
suffix:semicolon
macro_line|#else
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_ensoniq_playback2_ops
)paren
suffix:semicolon
macro_line|#endif
id|pcm-&gt;private_data
op_assign
id|ensoniq
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_ensoniq_pcm_free2
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CHIP1370
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;ES1370 DAC1&quot;
)paren
suffix:semicolon
macro_line|#else
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;ES1371 DAC1&quot;
)paren
suffix:semicolon
macro_line|#endif
id|ensoniq-&gt;pcm2
op_assign
id|pcm
suffix:semicolon
id|snd_pcm_lib_preallocate_pages_for_all
c_func
(paren
id|pcm
comma
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|ensoniq-&gt;pci
)paren
comma
l_int|64
op_star
l_int|1024
comma
l_int|128
op_star
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Mixer section&n; */
multiline_comment|/*&n; * ENS1371 mixer (including SPDIF interface)&n; */
macro_line|#ifdef CHIP1371
DECL|function|snd_ens1373_spdif_info
r_static
r_int
id|snd_ens1373_spdif_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_IEC958
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ens1373_spdif_default_get
r_static
r_int
id|snd_ens1373_spdif_default_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_assign
(paren
id|ensoniq-&gt;spdif_default
op_rshift
l_int|0
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|1
)braket
op_assign
(paren
id|ensoniq-&gt;spdif_default
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|2
)braket
op_assign
(paren
id|ensoniq-&gt;spdif_default
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
op_assign
(paren
id|ensoniq-&gt;spdif_default
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ens1373_spdif_default_put
r_static
r_int
id|snd_ens1373_spdif_default_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|change
suffix:semicolon
id|val
op_assign
(paren
(paren
id|u32
)paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_lshift
l_int|0
)paren
op_or
(paren
(paren
id|u32
)paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|u32
)paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|2
)braket
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|u32
)paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
op_lshift
l_int|24
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
id|change
op_assign
id|ensoniq-&gt;spdif_default
op_ne
id|val
suffix:semicolon
id|ensoniq-&gt;spdif_default
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|change
op_logical_and
id|ensoniq-&gt;playback1_substream
op_eq
l_int|NULL
op_logical_and
id|ensoniq-&gt;playback2_substream
op_eq
l_int|NULL
)paren
id|outl
c_func
(paren
id|val
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CHANNEL_STATUS
)paren
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|function|snd_ens1373_spdif_mask_get
r_static
r_int
id|snd_ens1373_spdif_mask_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_assign
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|1
)braket
op_assign
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|2
)braket
op_assign
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
op_assign
l_int|0xff
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ens1373_spdif_stream_get
r_static
r_int
id|snd_ens1373_spdif_stream_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_assign
(paren
id|ensoniq-&gt;spdif_stream
op_rshift
l_int|0
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|1
)braket
op_assign
(paren
id|ensoniq-&gt;spdif_stream
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|2
)braket
op_assign
(paren
id|ensoniq-&gt;spdif_stream
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
op_assign
(paren
id|ensoniq-&gt;spdif_stream
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ens1373_spdif_stream_put
r_static
r_int
id|snd_ens1373_spdif_stream_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|change
suffix:semicolon
id|val
op_assign
(paren
(paren
id|u32
)paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_lshift
l_int|0
)paren
op_or
(paren
(paren
id|u32
)paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
(paren
(paren
id|u32
)paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|2
)braket
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|u32
)paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
op_lshift
l_int|24
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
id|change
op_assign
id|ensoniq-&gt;spdif_stream
op_ne
id|val
suffix:semicolon
id|ensoniq-&gt;spdif_stream
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|change
op_logical_and
(paren
id|ensoniq-&gt;playback1_substream
op_ne
l_int|NULL
op_logical_or
id|ensoniq-&gt;playback2_substream
op_ne
l_int|NULL
)paren
)paren
id|outl
c_func
(paren
id|val
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CHANNEL_STATUS
)paren
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|macro|ES1371_SPDIF
mdefine_line|#define ES1371_SPDIF(xname) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, .info = snd_es1371_spdif_info, &bslash;&n;  .get = snd_es1371_spdif_get, .put = snd_es1371_spdif_put }
DECL|function|snd_es1371_spdif_info
r_static
r_int
id|snd_es1371_spdif_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1371_spdif_get
r_static
r_int
id|snd_es1371_spdif_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|ensoniq-&gt;ctrl
op_amp
id|ES_1373_SPDIF_THRU
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1371_spdif_put
r_static
r_int
id|snd_es1371_spdif_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|nval1
comma
id|nval2
suffix:semicolon
r_int
id|change
suffix:semicolon
id|nval1
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
ques
c_cond
id|ES_1373_SPDIF_THRU
suffix:colon
l_int|0
suffix:semicolon
id|nval2
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
ques
c_cond
id|ES_1373_SPDIF_EN
suffix:colon
l_int|0
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
id|change
op_assign
(paren
id|ensoniq-&gt;ctrl
op_amp
id|ES_1373_SPDIF_THRU
)paren
op_ne
id|nval1
suffix:semicolon
id|ensoniq-&gt;ctrl
op_and_assign
op_complement
id|ES_1373_SPDIF_THRU
suffix:semicolon
id|ensoniq-&gt;ctrl
op_or_assign
id|nval1
suffix:semicolon
id|ensoniq-&gt;cssr
op_and_assign
op_complement
id|ES_1373_SPDIF_EN
suffix:semicolon
id|ensoniq-&gt;cssr
op_or_assign
id|nval2
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;ctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;cssr
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|STATUS
)paren
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
multiline_comment|/* spdif controls */
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_es1371_mixer_spdif
(braket
)braket
id|__devinitdata
op_assign
(brace
id|ES1371_SPDIF
c_func
(paren
l_string|&quot;IEC958 Playback Switch&quot;
)paren
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_PCM
comma
dot
id|name
op_assign
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|PLAYBACK
comma
id|DEFAULT
)paren
comma
dot
id|info
op_assign
id|snd_ens1373_spdif_info
comma
dot
id|get
op_assign
id|snd_ens1373_spdif_default_get
comma
dot
id|put
op_assign
id|snd_ens1373_spdif_default_put
comma
)brace
comma
(brace
dot
id|access
op_assign
id|SNDRV_CTL_ELEM_ACCESS_READ
comma
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_PCM
comma
dot
id|name
op_assign
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|PLAYBACK
comma
id|MASK
)paren
comma
dot
id|info
op_assign
id|snd_ens1373_spdif_info
comma
dot
id|get
op_assign
id|snd_ens1373_spdif_mask_get
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_PCM
comma
dot
id|name
op_assign
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|PLAYBACK
comma
id|PCM_STREAM
)paren
comma
dot
id|info
op_assign
id|snd_ens1373_spdif_info
comma
dot
id|get
op_assign
id|snd_ens1373_spdif_stream_get
comma
dot
id|put
op_assign
id|snd_ens1373_spdif_stream_put
)brace
comma
)brace
suffix:semicolon
DECL|function|snd_es1373_rear_info
r_static
r_int
id|snd_es1373_rear_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1373_rear_get
r_static
r_int
id|snd_es1373_rear_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|val
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ensoniq-&gt;cssr
op_amp
(paren
id|ES_1373_REAR_BIT27
op_or
id|ES_1373_REAR_BIT26
op_or
id|ES_1373_REAR_BIT24
)paren
)paren
op_eq
id|ES_1373_REAR_BIT26
)paren
id|val
op_assign
l_int|1
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|val
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1373_rear_put
r_static
r_int
id|snd_es1373_rear_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|nval1
suffix:semicolon
r_int
id|change
suffix:semicolon
id|nval1
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
ques
c_cond
id|ES_1373_REAR_BIT26
suffix:colon
(paren
id|ES_1373_REAR_BIT27
op_or
id|ES_1373_REAR_BIT24
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
id|change
op_assign
(paren
id|ensoniq-&gt;cssr
op_amp
(paren
id|ES_1373_REAR_BIT27
op_or
id|ES_1373_REAR_BIT26
op_or
id|ES_1373_REAR_BIT24
)paren
)paren
op_ne
id|nval1
suffix:semicolon
id|ensoniq-&gt;cssr
op_and_assign
op_complement
(paren
id|ES_1373_REAR_BIT27
op_or
id|ES_1373_REAR_BIT26
op_or
id|ES_1373_REAR_BIT24
)paren
suffix:semicolon
id|ensoniq-&gt;cssr
op_or_assign
id|nval1
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;cssr
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|STATUS
)paren
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_ens1373_rear
id|__devinitdata
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;AC97 2ch-&gt;4ch Copy Switch&quot;
comma
dot
id|info
op_assign
id|snd_es1373_rear_info
comma
dot
id|get
op_assign
id|snd_es1373_rear_get
comma
dot
id|put
op_assign
id|snd_es1373_rear_put
comma
)brace
suffix:semicolon
DECL|function|snd_es1373_line_info
r_static
r_int
id|snd_es1373_line_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1373_line_get
r_static
r_int
id|snd_es1373_line_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|val
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ensoniq-&gt;ctrl
op_amp
id|ES_1371_GPIO_OUTM
)paren
op_ge
l_int|4
)paren
id|val
op_assign
l_int|1
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|val
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_es1373_line_put
r_static
r_int
id|snd_es1373_line_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|changed
suffix:semicolon
r_int
r_int
id|ctrl
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
id|ctrl
op_assign
id|ensoniq-&gt;ctrl
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
id|ensoniq-&gt;ctrl
op_or_assign
id|ES_1371_GPIO_OUT
c_func
(paren
l_int|4
)paren
suffix:semicolon
multiline_comment|/* switch line-in -&gt; rear out */
r_else
id|ensoniq-&gt;ctrl
op_and_assign
op_complement
id|ES_1371_GPIO_OUT
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|changed
op_assign
(paren
id|ctrl
op_ne
id|ensoniq-&gt;ctrl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|changed
)paren
id|outl
c_func
(paren
id|ensoniq-&gt;ctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|changed
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_ens1373_line
id|__devinitdata
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Line In-&gt;Rear Out Switch&quot;
comma
dot
id|info
op_assign
id|snd_es1373_line_info
comma
dot
id|get
op_assign
id|snd_es1373_line_get
comma
dot
id|put
op_assign
id|snd_es1373_line_put
comma
)brace
suffix:semicolon
DECL|function|snd_ensoniq_mixer_free_ac97
r_static
r_void
id|snd_ensoniq_mixer_free_ac97
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|ac97-&gt;private_data
suffix:semicolon
id|ensoniq-&gt;u.es1371.ac97
op_assign
l_int|NULL
suffix:semicolon
)brace
r_static
r_struct
(brace
DECL|member|vid
r_int
r_int
id|vid
suffix:semicolon
multiline_comment|/* vendor ID */
DECL|member|did
r_int
r_int
id|did
suffix:semicolon
multiline_comment|/* device ID */
DECL|member|rev
r_int
r_char
id|rev
suffix:semicolon
multiline_comment|/* revision */
DECL|variable|__devinitdata
)brace
id|es1371_spdif_present
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
dot
id|vid
op_assign
id|PCI_VENDOR_ID_ENSONIQ
comma
dot
id|did
op_assign
id|PCI_DEVICE_ID_ENSONIQ_CT5880
comma
dot
id|rev
op_assign
id|CT5880REV_CT5880_C
)brace
comma
(brace
dot
id|vid
op_assign
id|PCI_VENDOR_ID_ENSONIQ
comma
dot
id|did
op_assign
id|PCI_DEVICE_ID_ENSONIQ_CT5880
comma
dot
id|rev
op_assign
id|CT5880REV_CT5880_D
)brace
comma
(brace
dot
id|vid
op_assign
id|PCI_VENDOR_ID_ENSONIQ
comma
dot
id|did
op_assign
id|PCI_DEVICE_ID_ENSONIQ_CT5880
comma
dot
id|rev
op_assign
id|CT5880REV_CT5880_E
)brace
comma
(brace
dot
id|vid
op_assign
id|PCI_VENDOR_ID_ENSONIQ
comma
dot
id|did
op_assign
id|PCI_DEVICE_ID_ENSONIQ_ES1371
comma
dot
id|rev
op_assign
id|ES1371REV_CT5880_A
)brace
comma
(brace
dot
id|vid
op_assign
id|PCI_VENDOR_ID_ENSONIQ
comma
dot
id|did
op_assign
id|PCI_DEVICE_ID_ENSONIQ_ES1371
comma
dot
id|rev
op_assign
id|ES1371REV_ES1373_8
)brace
comma
(brace
dot
id|vid
op_assign
id|PCI_ANY_ID
comma
dot
id|did
op_assign
id|PCI_ANY_ID
)brace
)brace
suffix:semicolon
DECL|function|snd_ensoniq_1371_mixer
r_static
r_int
id|snd_ensoniq_1371_mixer
c_func
(paren
id|ensoniq_t
op_star
id|ensoniq
)paren
(brace
id|snd_card_t
op_star
id|card
op_assign
id|ensoniq-&gt;card
suffix:semicolon
id|ac97_bus_t
op_star
id|pbus
suffix:semicolon
id|ac97_template_t
id|ac97
suffix:semicolon
r_int
id|err
comma
id|idx
suffix:semicolon
r_static
id|ac97_bus_ops_t
id|ops
op_assign
(brace
dot
id|write
op_assign
id|snd_es1371_codec_write
comma
dot
id|read
op_assign
id|snd_es1371_codec_read
comma
)brace
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_bus
c_func
(paren
id|card
comma
l_int|0
comma
op_amp
id|ops
comma
l_int|NULL
comma
op_amp
id|pbus
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ac97
comma
l_int|0
comma
r_sizeof
(paren
id|ac97
)paren
)paren
suffix:semicolon
id|ac97.private_data
op_assign
id|ensoniq
suffix:semicolon
id|ac97.private_free
op_assign
id|snd_ensoniq_mixer_free_ac97
suffix:semicolon
id|ac97.scaps
op_assign
id|AC97_SCAP_AUDIO
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_mixer
c_func
(paren
id|pbus
comma
op_amp
id|ac97
comma
op_amp
id|ensoniq-&gt;u.es1371.ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|es1371_spdif_present
(braket
id|idx
)braket
dot
id|vid
op_ne
(paren
r_int
r_int
)paren
id|PCI_ANY_ID
suffix:semicolon
id|idx
op_increment
)paren
r_if
c_cond
(paren
id|ensoniq-&gt;pci-&gt;vendor
op_eq
id|es1371_spdif_present
(braket
id|idx
)braket
dot
id|vid
op_logical_and
id|ensoniq-&gt;pci-&gt;device
op_eq
id|es1371_spdif_present
(braket
id|idx
)braket
dot
id|did
op_logical_and
id|ensoniq-&gt;rev
op_eq
id|es1371_spdif_present
(braket
id|idx
)braket
dot
id|rev
)paren
(brace
id|snd_kcontrol_t
op_star
id|kctl
suffix:semicolon
r_int
id|i
comma
id|index
op_assign
l_int|0
suffix:semicolon
id|ensoniq-&gt;spdif_default
op_assign
id|ensoniq-&gt;spdif_stream
op_assign
id|SNDRV_PCM_DEFAULT_CON_SPDIF
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;spdif_default
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CHANNEL_STATUS
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ensoniq-&gt;u.es1371.ac97-&gt;ext_id
op_amp
id|AC97_EI_SPDIF
)paren
id|index
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
r_int
)paren
id|ARRAY_SIZE
c_func
(paren
id|snd_es1371_mixer_spdif
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_es1371_mixer_spdif
(braket
id|i
)braket
comma
id|ensoniq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|kctl
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|kctl-&gt;id.index
op_assign
id|index
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ensoniq-&gt;u.es1371.ac97-&gt;ext_id
op_amp
id|AC97_EI_SDAC
)paren
(brace
multiline_comment|/* mirror rear to front speakers */
id|ensoniq-&gt;cssr
op_and_assign
op_complement
(paren
id|ES_1373_REAR_BIT27
op_or
id|ES_1373_REAR_BIT24
)paren
suffix:semicolon
id|ensoniq-&gt;cssr
op_or_assign
id|ES_1373_REAR_BIT26
suffix:semicolon
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_ens1373_rear
comma
id|ensoniq
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
(paren
id|ensoniq-&gt;subsystem_vendor_id
op_eq
l_int|0x1274
)paren
op_logical_and
(paren
id|ensoniq-&gt;subsystem_device_id
op_eq
l_int|0x2000
)paren
)paren
op_logical_or
multiline_comment|/* GA-7DXR */
(paren
(paren
id|ensoniq-&gt;subsystem_vendor_id
op_eq
l_int|0x1458
)paren
op_logical_and
(paren
id|ensoniq-&gt;subsystem_device_id
op_eq
l_int|0xa000
)paren
)paren
)paren
(brace
multiline_comment|/* GA-8IEXP */
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_ens1373_line
comma
id|ensoniq
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CHIP1371 */
multiline_comment|/* generic control callbacks for ens1370 */
macro_line|#ifdef CHIP1370
DECL|macro|ENSONIQ_CONTROL
mdefine_line|#define ENSONIQ_CONTROL(xname, mask) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_CARD, .name = xname, .info = snd_ensoniq_control_info, &bslash;&n;  .get = snd_ensoniq_control_get, .put = snd_ensoniq_control_put, &bslash;&n;  .private_value = mask }
DECL|function|snd_ensoniq_control_info
r_static
r_int
id|snd_ensoniq_control_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ensoniq_control_get
r_static
r_int
id|snd_ensoniq_control_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|mask
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|ensoniq-&gt;ctrl
op_amp
id|mask
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ensoniq_control_put
r_static
r_int
id|snd_ensoniq_control_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|mask
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
r_int
r_int
id|nval
suffix:semicolon
r_int
id|change
suffix:semicolon
id|nval
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
ques
c_cond
id|mask
suffix:colon
l_int|0
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
id|change
op_assign
(paren
id|ensoniq-&gt;ctrl
op_amp
id|mask
)paren
op_ne
id|nval
suffix:semicolon
id|ensoniq-&gt;ctrl
op_and_assign
op_complement
id|mask
suffix:semicolon
id|ensoniq-&gt;ctrl
op_or_assign
id|nval
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;ctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
multiline_comment|/*&n; * ENS1370 mixer&n; */
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_es1370_controls
(braket
l_int|2
)braket
id|__devinitdata
op_assign
(brace
id|ENSONIQ_CONTROL
c_func
(paren
l_string|&quot;PCM 0 Output also on Line-In Jack&quot;
comma
id|ES_1370_XCTL0
)paren
comma
id|ENSONIQ_CONTROL
c_func
(paren
l_string|&quot;Mic +5V bias&quot;
comma
id|ES_1370_XCTL1
)paren
)brace
suffix:semicolon
DECL|macro|ES1370_CONTROLS
mdefine_line|#define ES1370_CONTROLS ARRAY_SIZE(snd_es1370_controls)
DECL|function|snd_ensoniq_mixer_free_ak4531
r_static
r_void
id|snd_ensoniq_mixer_free_ak4531
c_func
(paren
id|ak4531_t
op_star
id|ak4531
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|ak4531-&gt;private_data
suffix:semicolon
id|ensoniq-&gt;u.es1370.ak4531
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|snd_ensoniq_1370_mixer
r_static
r_int
id|__devinit
id|snd_ensoniq_1370_mixer
c_func
(paren
id|ensoniq_t
op_star
id|ensoniq
)paren
(brace
id|snd_card_t
op_star
id|card
op_assign
id|ensoniq-&gt;card
suffix:semicolon
id|ak4531_t
id|ak4531
suffix:semicolon
r_int
r_int
id|idx
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* try reset AK4531 */
id|outw
c_func
(paren
id|ES_1370_CODEC_WRITE
c_func
(paren
id|AK4531_RESET
comma
l_int|0x02
)paren
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1370
id|_CODEC
)paren
)paren
suffix:semicolon
id|inw
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1370
id|_CODEC
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|outw
c_func
(paren
id|ES_1370_CODEC_WRITE
c_func
(paren
id|AK4531_RESET
comma
l_int|0x03
)paren
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1370
id|_CODEC
)paren
)paren
suffix:semicolon
id|inw
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1370
id|_CODEC
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ak4531
comma
l_int|0
comma
r_sizeof
(paren
id|ak4531
)paren
)paren
suffix:semicolon
id|ak4531.write
op_assign
id|snd_es1370_codec_write
suffix:semicolon
id|ak4531.private_data
op_assign
id|ensoniq
suffix:semicolon
id|ak4531.private_free
op_assign
id|snd_ensoniq_mixer_free_ak4531
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ak4531_mixer
c_func
(paren
id|card
comma
op_amp
id|ak4531
comma
op_amp
id|ensoniq-&gt;u.es1370.ak4531
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|ES1370_CONTROLS
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_es1370_controls
(braket
id|idx
)braket
comma
id|ensoniq
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CHIP1370 */
macro_line|#ifdef SUPPORT_JOYSTICK
DECL|function|snd_ensoniq_joystick
r_static
r_int
id|snd_ensoniq_joystick
c_func
(paren
id|ensoniq_t
op_star
id|ensoniq
comma
r_int
id|port
)paren
(brace
macro_line|#ifdef CHIP1371
r_if
c_cond
(paren
id|port
op_eq
l_int|1
)paren
(brace
multiline_comment|/* auto-detect */
r_for
c_loop
(paren
id|port
op_assign
l_int|0x200
suffix:semicolon
id|port
op_le
l_int|0x218
suffix:semicolon
id|port
op_add_assign
l_int|8
)paren
r_if
c_cond
(paren
id|request_region
c_func
(paren
id|port
comma
l_int|8
comma
l_string|&quot;ens137x: gameport&quot;
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|port
OG
l_int|0x218
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;no gameport available&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
)brace
r_else
macro_line|#endif
(brace
r_if
c_cond
(paren
op_logical_neg
id|request_region
c_func
(paren
id|port
comma
l_int|8
comma
l_string|&quot;ens137x: gameport&quot;
)paren
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;gameport io port 0x%03x in use&quot;
comma
id|ensoniq-&gt;gameport.io
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
)brace
id|ensoniq-&gt;gameport.io
op_assign
id|port
suffix:semicolon
id|ensoniq-&gt;ctrl
op_or_assign
id|ES_JYSTK_EN
suffix:semicolon
macro_line|#ifdef CHIP1371
id|ensoniq-&gt;ctrl
op_and_assign
op_complement
id|ES_1371_JOY_ASELM
suffix:semicolon
id|ensoniq-&gt;ctrl
op_or_assign
id|ES_1371_JOY_ASEL
c_func
(paren
(paren
id|ensoniq-&gt;gameport.io
op_minus
l_int|0x200
)paren
op_div
l_int|8
)paren
suffix:semicolon
macro_line|#endif
id|outl
c_func
(paren
id|ensoniq-&gt;ctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
id|gameport_register_port
c_func
(paren
op_amp
id|ensoniq-&gt;gameport
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ensoniq_joystick_free
r_static
r_void
id|snd_ensoniq_joystick_free
c_func
(paren
id|ensoniq_t
op_star
id|ensoniq
)paren
(brace
id|gameport_unregister_port
c_func
(paren
op_amp
id|ensoniq-&gt;gameport
)paren
suffix:semicolon
id|ensoniq-&gt;ctrl
op_and_assign
op_complement
id|ES_JYSTK_EN
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;ctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
id|release_region
c_func
(paren
id|ensoniq-&gt;gameport.io
comma
l_int|8
)paren
suffix:semicolon
)brace
macro_line|#endif /* SUPPORT_JOYSTICK */
multiline_comment|/*&n;&n; */
DECL|function|snd_ensoniq_proc_read
r_static
r_void
id|snd_ensoniq_proc_read
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|entry-&gt;private_data
suffix:semicolon
macro_line|#ifdef CHIP1370
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Ensoniq AudioPCI ES1370&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#else
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Ensoniq AudioPCI ES1371&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Joystick enable  : %s&bslash;n&quot;
comma
id|ensoniq-&gt;ctrl
op_amp
id|ES_JYSTK_EN
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
)paren
suffix:semicolon
macro_line|#ifdef CHIP1370
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;MIC +5V bias     : %s&bslash;n&quot;
comma
id|ensoniq-&gt;ctrl
op_amp
id|ES_1370_XCTL1
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Line In to AOUT  : %s&bslash;n&quot;
comma
id|ensoniq-&gt;ctrl
op_amp
id|ES_1370_XCTL0
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
)paren
suffix:semicolon
macro_line|#else
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Joystick port    : 0x%x&bslash;n&quot;
comma
(paren
id|ES_1371_JOY_ASELI
c_func
(paren
id|ensoniq-&gt;ctrl
)paren
op_star
l_int|8
)paren
op_plus
l_int|0x200
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|snd_ensoniq_proc_init
r_static
r_void
id|__devinit
id|snd_ensoniq_proc_init
c_func
(paren
id|ensoniq_t
op_star
id|ensoniq
)paren
(brace
id|snd_info_entry_t
op_star
id|entry
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_card_proc_new
c_func
(paren
id|ensoniq-&gt;card
comma
l_string|&quot;audiopci&quot;
comma
op_amp
id|entry
)paren
)paren
id|snd_info_set_text_ops
c_func
(paren
id|entry
comma
id|ensoniq
comma
l_int|1024
comma
id|snd_ensoniq_proc_read
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&n; */
DECL|function|snd_ensoniq_free
r_static
r_int
id|snd_ensoniq_free
c_func
(paren
id|ensoniq_t
op_star
id|ensoniq
)paren
(brace
macro_line|#ifdef SUPPORT_JOYSTICK
r_if
c_cond
(paren
id|ensoniq-&gt;ctrl
op_amp
id|ES_JYSTK_EN
)paren
id|snd_ensoniq_joystick_free
c_func
(paren
id|ensoniq
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ensoniq-&gt;irq
OL
l_int|0
)paren
r_goto
id|__hw_end
suffix:semicolon
macro_line|#ifdef CHIP1370
id|outl
c_func
(paren
id|ES_1370_SERR_DISABLE
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
multiline_comment|/* switch everything off */
id|outl
c_func
(paren
l_int|0
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|SERIAL
)paren
)paren
suffix:semicolon
multiline_comment|/* clear serial interface */
macro_line|#else
id|outl
c_func
(paren
l_int|0
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
multiline_comment|/* switch everything off */
id|outl
c_func
(paren
l_int|0
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|SERIAL
)paren
)paren
suffix:semicolon
multiline_comment|/* clear serial interface */
macro_line|#endif
id|synchronize_irq
c_func
(paren
id|ensoniq-&gt;irq
)paren
suffix:semicolon
id|pci_set_power_state
c_func
(paren
id|ensoniq-&gt;pci
comma
l_int|3
)paren
suffix:semicolon
id|__hw_end
suffix:colon
macro_line|#ifdef CHIP1370
r_if
c_cond
(paren
id|ensoniq-&gt;dma_bug.area
)paren
id|snd_dma_free_pages
c_func
(paren
op_amp
id|ensoniq-&gt;dma_bug
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|ensoniq-&gt;irq
op_ge
l_int|0
)paren
id|free_irq
c_func
(paren
id|ensoniq-&gt;irq
comma
(paren
r_void
op_star
)paren
id|ensoniq
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|ensoniq-&gt;pci
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|ensoniq-&gt;pci
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ensoniq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ensoniq_dev_free
r_static
r_int
id|snd_ensoniq_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|device-&gt;device_data
suffix:semicolon
r_return
id|snd_ensoniq_free
c_func
(paren
id|ensoniq
)paren
suffix:semicolon
)brace
macro_line|#ifdef CHIP1371
r_static
r_struct
(brace
DECL|member|svid
r_int
r_int
id|svid
suffix:semicolon
multiline_comment|/* subsystem vendor ID */
DECL|member|sdid
r_int
r_int
id|sdid
suffix:semicolon
multiline_comment|/* subsystem device ID */
DECL|variable|es1371_amplifier_hack
)brace
id|es1371_amplifier_hack
(braket
)braket
op_assign
(brace
(brace
dot
id|svid
op_assign
l_int|0x107b
comma
dot
id|sdid
op_assign
l_int|0x2150
)brace
comma
multiline_comment|/* Gateway Solo 2150 */
(brace
dot
id|svid
op_assign
l_int|0x13bd
comma
dot
id|sdid
op_assign
l_int|0x100c
)brace
comma
multiline_comment|/* EV1938 on Mebius PC-MJ100V */
(brace
dot
id|svid
op_assign
l_int|0x1102
comma
dot
id|sdid
op_assign
l_int|0x5938
)brace
comma
multiline_comment|/* Targa Xtender300 */
(brace
dot
id|svid
op_assign
l_int|0x1102
comma
dot
id|sdid
op_assign
l_int|0x8938
)brace
comma
multiline_comment|/* IPC Topnote G notebook */
(brace
dot
id|svid
op_assign
id|PCI_ANY_ID
comma
dot
id|sdid
op_assign
id|PCI_ANY_ID
)brace
)brace
suffix:semicolon
r_static
r_struct
(brace
DECL|member|vid
r_int
r_int
id|vid
suffix:semicolon
multiline_comment|/* vendor ID */
DECL|member|did
r_int
r_int
id|did
suffix:semicolon
multiline_comment|/* device ID */
DECL|member|rev
r_int
r_char
id|rev
suffix:semicolon
multiline_comment|/* revision */
DECL|variable|es1371_ac97_reset_hack
)brace
id|es1371_ac97_reset_hack
(braket
)braket
op_assign
(brace
(brace
dot
id|vid
op_assign
id|PCI_VENDOR_ID_ENSONIQ
comma
dot
id|did
op_assign
id|PCI_DEVICE_ID_ENSONIQ_CT5880
comma
dot
id|rev
op_assign
id|CT5880REV_CT5880_C
)brace
comma
(brace
dot
id|vid
op_assign
id|PCI_VENDOR_ID_ENSONIQ
comma
dot
id|did
op_assign
id|PCI_DEVICE_ID_ENSONIQ_CT5880
comma
dot
id|rev
op_assign
id|CT5880REV_CT5880_D
)brace
comma
(brace
dot
id|vid
op_assign
id|PCI_VENDOR_ID_ENSONIQ
comma
dot
id|did
op_assign
id|PCI_DEVICE_ID_ENSONIQ_CT5880
comma
dot
id|rev
op_assign
id|CT5880REV_CT5880_E
)brace
comma
(brace
dot
id|vid
op_assign
id|PCI_VENDOR_ID_ENSONIQ
comma
dot
id|did
op_assign
id|PCI_DEVICE_ID_ENSONIQ_ES1371
comma
dot
id|rev
op_assign
id|ES1371REV_CT5880_A
)brace
comma
(brace
dot
id|vid
op_assign
id|PCI_VENDOR_ID_ENSONIQ
comma
dot
id|did
op_assign
id|PCI_DEVICE_ID_ENSONIQ_ES1371
comma
dot
id|rev
op_assign
id|ES1371REV_ES1373_8
)brace
comma
(brace
dot
id|vid
op_assign
id|PCI_ANY_ID
comma
dot
id|did
op_assign
id|PCI_ANY_ID
)brace
)brace
suffix:semicolon
macro_line|#endif
DECL|function|snd_ensoniq_create
r_static
r_int
id|__devinit
id|snd_ensoniq_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_struct
id|pci_dev
op_star
id|pci
comma
id|ensoniq_t
op_star
op_star
id|rensoniq
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
suffix:semicolon
r_int
r_int
id|cmdw
suffix:semicolon
r_int
r_char
id|cmdb
suffix:semicolon
macro_line|#ifdef CHIP1371
r_int
id|idx
suffix:semicolon
macro_line|#endif
r_int
id|err
suffix:semicolon
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
dot
id|dev_free
op_assign
id|snd_ensoniq_dev_free
comma
)brace
suffix:semicolon
op_star
id|rensoniq
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pci
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|ensoniq
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|ensoniq
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ensoniq
op_eq
l_int|NULL
)paren
(brace
id|pci_disable_device
c_func
(paren
id|pci
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|spin_lock_init
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|ensoniq-&gt;src_mutex
)paren
suffix:semicolon
id|ensoniq-&gt;card
op_assign
id|card
suffix:semicolon
id|ensoniq-&gt;pci
op_assign
id|pci
suffix:semicolon
id|ensoniq-&gt;irq
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_request_regions
c_func
(paren
id|pci
comma
l_string|&quot;Ensoniq AudioPCI&quot;
)paren
)paren
OL
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|ensoniq
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pci
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|ensoniq-&gt;port
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|pci-&gt;irq
comma
id|snd_audiopci_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
l_string|&quot;Ensoniq AudioPCI&quot;
comma
(paren
r_void
op_star
)paren
id|ensoniq
)paren
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab IRQ %d&bslash;n&quot;
comma
id|pci-&gt;irq
)paren
suffix:semicolon
id|snd_ensoniq_free
c_func
(paren
id|ensoniq
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|ensoniq-&gt;irq
op_assign
id|pci-&gt;irq
suffix:semicolon
macro_line|#ifdef CHIP1370
r_if
c_cond
(paren
id|snd_dma_alloc_pages
c_func
(paren
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|pci
)paren
comma
l_int|16
comma
op_amp
id|ensoniq-&gt;dma_bug
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unable to allocate space for phantom area - dma_bug&bslash;n&quot;
)paren
suffix:semicolon
id|snd_ensoniq_free
c_func
(paren
id|ensoniq
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
macro_line|#endif
id|pci_set_master
c_func
(paren
id|pci
)paren
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pci
comma
id|PCI_REVISION_ID
comma
op_amp
id|cmdb
)paren
suffix:semicolon
id|ensoniq-&gt;rev
op_assign
id|cmdb
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pci
comma
id|PCI_SUBSYSTEM_VENDOR_ID
comma
op_amp
id|cmdw
)paren
suffix:semicolon
id|ensoniq-&gt;subsystem_vendor_id
op_assign
id|cmdw
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|pci
comma
id|PCI_SUBSYSTEM_ID
comma
op_amp
id|cmdw
)paren
suffix:semicolon
id|ensoniq-&gt;subsystem_device_id
op_assign
id|cmdw
suffix:semicolon
macro_line|#ifdef CHIP1370
macro_line|#if 0
id|ensoniq-&gt;ctrl
op_assign
id|ES_1370_CDC_EN
op_or
id|ES_1370_SERR_DISABLE
op_or
id|ES_1370_PCLKDIVO
c_func
(paren
id|ES_1370_SRTODIV
c_func
(paren
l_int|8000
)paren
)paren
suffix:semicolon
macro_line|#else&t;/* get microphone working */
id|ensoniq-&gt;ctrl
op_assign
id|ES_1370_CDC_EN
op_or
id|ES_1370_PCLKDIVO
c_func
(paren
id|ES_1370_SRTODIV
c_func
(paren
l_int|8000
)paren
)paren
suffix:semicolon
macro_line|#endif
id|ensoniq-&gt;sctrl
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* initialize the chips */
id|outl
c_func
(paren
id|ensoniq-&gt;ctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;sctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|SERIAL
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ES_MEM_PAGEO
c_func
(paren
id|ES_PAGE_ADC
)paren
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|MEM_PAGE
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;dma_bug.addr
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|PHANTOM_FRAME
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|PHANTOM_COUNT
)paren
)paren
suffix:semicolon
macro_line|#else
id|ensoniq-&gt;ctrl
op_assign
l_int|0
suffix:semicolon
id|ensoniq-&gt;sctrl
op_assign
l_int|0
suffix:semicolon
id|ensoniq-&gt;cssr
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|es1371_amplifier_hack
(braket
id|idx
)braket
dot
id|svid
op_ne
(paren
r_int
r_int
)paren
id|PCI_ANY_ID
suffix:semicolon
id|idx
op_increment
)paren
r_if
c_cond
(paren
id|ensoniq-&gt;subsystem_vendor_id
op_eq
id|es1371_amplifier_hack
(braket
id|idx
)braket
dot
id|svid
op_logical_and
id|ensoniq-&gt;subsystem_device_id
op_eq
id|es1371_amplifier_hack
(braket
id|idx
)braket
dot
id|sdid
)paren
(brace
id|ensoniq-&gt;ctrl
op_or_assign
id|ES_1371_GPIO_OUT
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* turn amplifier on */
r_break
suffix:semicolon
)brace
multiline_comment|/* initialize the chips */
id|outl
c_func
(paren
id|ensoniq-&gt;ctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;sctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|SERIAL
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_LEGACY
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|es1371_ac97_reset_hack
(braket
id|idx
)braket
dot
id|vid
op_ne
(paren
r_int
r_int
)paren
id|PCI_ANY_ID
suffix:semicolon
id|idx
op_increment
)paren
r_if
c_cond
(paren
id|pci-&gt;vendor
op_eq
id|es1371_ac97_reset_hack
(braket
id|idx
)braket
dot
id|vid
op_logical_and
id|pci-&gt;device
op_eq
id|es1371_ac97_reset_hack
(braket
id|idx
)braket
dot
id|did
op_logical_and
id|ensoniq-&gt;rev
op_eq
id|es1371_ac97_reset_hack
(braket
id|idx
)braket
dot
id|rev
)paren
(brace
r_int
r_int
id|tmo
suffix:semicolon
r_int
r_int
id|tmo2
suffix:semicolon
id|ensoniq-&gt;cssr
op_or_assign
id|ES_1371_ST_AC97_RST
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;cssr
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* need to delay around 20ms(bleech) to give&n;&t;&t;&t;some CODECs enough time to wakeup */
id|tmo
op_assign
id|jiffies
op_plus
(paren
id|HZ
op_div
l_int|50
)paren
op_plus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|tmo2
op_assign
id|tmo
op_minus
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|tmo2
op_le
l_int|0
)paren
r_break
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|tmo2
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
multiline_comment|/* AC&squot;97 warm reset to start the bitclk */
id|outl
c_func
(paren
id|ensoniq-&gt;ctrl
op_or
id|ES_1371_SYNC_RES
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;ctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
multiline_comment|/* Init the sample rate converter */
id|snd_es1371_wait_src_ready
c_func
(paren
id|ensoniq
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ES_1371_SRC_DISABLE
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_SMPRATE
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|0x80
suffix:semicolon
id|idx
op_increment
)paren
id|snd_es1371_src_write
c_func
(paren
id|ensoniq
comma
id|idx
comma
l_int|0
)paren
suffix:semicolon
id|snd_es1371_src_write
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_DAC1
op_plus
id|ES_SMPREG_TRUNC_N
comma
l_int|16
op_lshift
l_int|4
)paren
suffix:semicolon
id|snd_es1371_src_write
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_DAC1
op_plus
id|ES_SMPREG_INT_REGS
comma
l_int|16
op_lshift
l_int|10
)paren
suffix:semicolon
id|snd_es1371_src_write
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_DAC2
op_plus
id|ES_SMPREG_TRUNC_N
comma
l_int|16
op_lshift
l_int|4
)paren
suffix:semicolon
id|snd_es1371_src_write
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_DAC2
op_plus
id|ES_SMPREG_INT_REGS
comma
l_int|16
op_lshift
l_int|10
)paren
suffix:semicolon
id|snd_es1371_src_write
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_VOL_ADC
comma
l_int|1
op_lshift
l_int|12
)paren
suffix:semicolon
id|snd_es1371_src_write
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_VOL_ADC
op_plus
l_int|1
comma
l_int|1
op_lshift
l_int|12
)paren
suffix:semicolon
id|snd_es1371_src_write
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_VOL_DAC1
comma
l_int|1
op_lshift
l_int|12
)paren
suffix:semicolon
id|snd_es1371_src_write
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_VOL_DAC1
op_plus
l_int|1
comma
l_int|1
op_lshift
l_int|12
)paren
suffix:semicolon
id|snd_es1371_src_write
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_VOL_DAC2
comma
l_int|1
op_lshift
l_int|12
)paren
suffix:semicolon
id|snd_es1371_src_write
c_func
(paren
id|ensoniq
comma
id|ES_SMPREG_VOL_DAC2
op_plus
l_int|1
comma
l_int|1
op_lshift
l_int|12
)paren
suffix:semicolon
id|snd_es1371_adc_rate
c_func
(paren
id|ensoniq
comma
l_int|22050
)paren
suffix:semicolon
id|snd_es1371_dac1_rate
c_func
(paren
id|ensoniq
comma
l_int|22050
)paren
suffix:semicolon
id|snd_es1371_dac2_rate
c_func
(paren
id|ensoniq
comma
l_int|22050
)paren
suffix:semicolon
multiline_comment|/* WARNING:&n;&t; * enabling the sample rate converter without properly programming&n;&t; * its parameters causes the chip to lock up (the SRC busy bit will&n;&t; * be stuck high, and I&squot;ve found no way to rectify this other than&n;&t; * power cycle) - Thomas Sailer&n;&t; */
id|snd_es1371_wait_src_ready
c_func
(paren
id|ensoniq
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_SMPRATE
)paren
)paren
suffix:semicolon
multiline_comment|/* try reset codec directly */
id|outl
c_func
(paren
id|ES_1371_CODEC_WRITE
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
l_int|1371
id|_CODEC
)paren
)paren
suffix:semicolon
macro_line|#endif
id|outb
c_func
(paren
id|ensoniq-&gt;uartc
op_assign
l_int|0x00
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_CONTROL
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_RES
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;cssr
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|STATUS
)paren
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
id|ensoniq-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|ensoniq
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_ensoniq_free
c_func
(paren
id|ensoniq
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|snd_ensoniq_proc_init
c_func
(paren
id|ensoniq
)paren
suffix:semicolon
id|snd_card_set_dev
c_func
(paren
id|card
comma
op_amp
id|pci-&gt;dev
)paren
suffix:semicolon
op_star
id|rensoniq
op_assign
id|ensoniq
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  MIDI section&n; */
DECL|function|snd_ensoniq_midi_interrupt
r_static
r_void
id|snd_ensoniq_midi_interrupt
c_func
(paren
id|ensoniq_t
op_star
id|ensoniq
)paren
(brace
id|snd_rawmidi_t
op_star
id|rmidi
op_assign
id|ensoniq-&gt;rmidi
suffix:semicolon
r_int
r_char
id|status
comma
id|mask
comma
id|byte
suffix:semicolon
r_if
c_cond
(paren
id|rmidi
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
multiline_comment|/* do Rx at first */
id|spin_lock
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
id|mask
op_assign
id|ensoniq-&gt;uartm
op_amp
id|ES_MODE_INPUT
ques
c_cond
id|ES_RXRDY
suffix:colon
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|mask
)paren
(brace
id|status
op_assign
id|inb
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_STATUS
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|mask
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
id|byte
op_assign
id|inb
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_DATA
)paren
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
id|snd_rawmidi_receive
c_func
(paren
id|ensoniq-&gt;midi_input
comma
op_amp
id|byte
comma
l_int|1
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
multiline_comment|/* do Tx at second */
id|spin_lock
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
id|mask
op_assign
id|ensoniq-&gt;uartm
op_amp
id|ES_MODE_OUTPUT
ques
c_cond
id|ES_TXRDY
suffix:colon
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|mask
)paren
(brace
id|status
op_assign
id|inb
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_STATUS
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|mask
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|snd_rawmidi_transmit
c_func
(paren
id|ensoniq-&gt;midi_output
comma
op_amp
id|byte
comma
l_int|1
)paren
op_ne
l_int|1
)paren
(brace
id|ensoniq-&gt;uartc
op_and_assign
op_complement
id|ES_TXINTENM
suffix:semicolon
id|outb
c_func
(paren
id|ensoniq-&gt;uartc
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_CONTROL
)paren
)paren
suffix:semicolon
id|mask
op_and_assign
op_complement
id|ES_TXRDY
suffix:semicolon
)brace
r_else
(brace
id|outb
c_func
(paren
id|byte
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_DATA
)paren
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
)brace
DECL|function|snd_ensoniq_midi_input_open
r_static
r_int
id|snd_ensoniq_midi_input_open
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|substream-&gt;rmidi-&gt;private_data
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
id|ensoniq-&gt;uartm
op_or_assign
id|ES_MODE_INPUT
suffix:semicolon
id|ensoniq-&gt;midi_input
op_assign
id|substream
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ensoniq-&gt;uartm
op_amp
id|ES_MODE_OUTPUT
)paren
)paren
(brace
id|outb
c_func
(paren
id|ES_CNTRL
c_func
(paren
l_int|3
)paren
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_CONTROL
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|ensoniq-&gt;uartc
op_assign
l_int|0
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_CONTROL
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;ctrl
op_or_assign
id|ES_UART_EN
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ensoniq_midi_input_close
r_static
r_int
id|snd_ensoniq_midi_input_close
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|substream-&gt;rmidi-&gt;private_data
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ensoniq-&gt;uartm
op_amp
id|ES_MODE_OUTPUT
)paren
)paren
(brace
id|outb
c_func
(paren
id|ensoniq-&gt;uartc
op_assign
l_int|0
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_CONTROL
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;ctrl
op_and_assign
op_complement
id|ES_UART_EN
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|outb
c_func
(paren
id|ensoniq-&gt;uartc
op_and_assign
op_complement
id|ES_RXINTEN
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_CONTROL
)paren
)paren
suffix:semicolon
)brace
id|ensoniq-&gt;midi_input
op_assign
l_int|NULL
suffix:semicolon
id|ensoniq-&gt;uartm
op_and_assign
op_complement
id|ES_MODE_INPUT
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ensoniq_midi_output_open
r_static
r_int
id|snd_ensoniq_midi_output_open
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|substream-&gt;rmidi-&gt;private_data
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
id|ensoniq-&gt;uartm
op_or_assign
id|ES_MODE_OUTPUT
suffix:semicolon
id|ensoniq-&gt;midi_output
op_assign
id|substream
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ensoniq-&gt;uartm
op_amp
id|ES_MODE_INPUT
)paren
)paren
(brace
id|outb
c_func
(paren
id|ES_CNTRL
c_func
(paren
l_int|3
)paren
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_CONTROL
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|ensoniq-&gt;uartc
op_assign
l_int|0
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_CONTROL
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;ctrl
op_or_assign
id|ES_UART_EN
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ensoniq_midi_output_close
r_static
r_int
id|snd_ensoniq_midi_output_close
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|substream-&gt;rmidi-&gt;private_data
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ensoniq-&gt;uartm
op_amp
id|ES_MODE_INPUT
)paren
)paren
(brace
id|outb
c_func
(paren
id|ensoniq-&gt;uartc
op_assign
l_int|0
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_CONTROL
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;ctrl
op_and_assign
op_complement
id|ES_UART_EN
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|CONTROL
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|outb
c_func
(paren
id|ensoniq-&gt;uartc
op_and_assign
op_complement
id|ES_TXINTENM
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_CONTROL
)paren
)paren
suffix:semicolon
)brace
id|ensoniq-&gt;midi_output
op_assign
l_int|NULL
suffix:semicolon
id|ensoniq-&gt;uartm
op_and_assign
op_complement
id|ES_MODE_OUTPUT
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ensoniq_midi_input_trigger
r_static
r_void
id|snd_ensoniq_midi_input_trigger
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
r_int
id|up
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|substream-&gt;rmidi-&gt;private_data
suffix:semicolon
r_int
id|idx
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|up
)paren
(brace
r_if
c_cond
(paren
(paren
id|ensoniq-&gt;uartc
op_amp
id|ES_RXINTEN
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* empty input FIFO */
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|32
suffix:semicolon
id|idx
op_increment
)paren
id|inb
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_DATA
)paren
)paren
suffix:semicolon
id|ensoniq-&gt;uartc
op_or_assign
id|ES_RXINTEN
suffix:semicolon
id|outb
c_func
(paren
id|ensoniq-&gt;uartc
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_CONTROL
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|ensoniq-&gt;uartc
op_amp
id|ES_RXINTEN
)paren
(brace
id|ensoniq-&gt;uartc
op_and_assign
op_complement
id|ES_RXINTEN
suffix:semicolon
id|outb
c_func
(paren
id|ensoniq-&gt;uartc
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_CONTROL
)paren
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_ensoniq_midi_output_trigger
r_static
r_void
id|snd_ensoniq_midi_output_trigger
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
r_int
id|up
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|substream-&gt;rmidi-&gt;private_data
suffix:semicolon
r_int
r_char
id|byte
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|up
)paren
(brace
r_if
c_cond
(paren
id|ES_TXINTENI
c_func
(paren
id|ensoniq-&gt;uartc
)paren
op_eq
l_int|0
)paren
(brace
id|ensoniq-&gt;uartc
op_or_assign
id|ES_TXINTENO
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* fill UART FIFO buffer at first, and turn Tx interrupts only if necessary */
r_while
c_loop
(paren
id|ES_TXINTENI
c_func
(paren
id|ensoniq-&gt;uartc
)paren
op_eq
l_int|1
op_logical_and
(paren
id|inb
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_STATUS
)paren
)paren
op_amp
id|ES_TXRDY
)paren
)paren
(brace
r_if
c_cond
(paren
id|snd_rawmidi_transmit
c_func
(paren
id|substream
comma
op_amp
id|byte
comma
l_int|1
)paren
op_ne
l_int|1
)paren
(brace
id|ensoniq-&gt;uartc
op_and_assign
op_complement
id|ES_TXINTENM
suffix:semicolon
)brace
r_else
(brace
id|outb
c_func
(paren
id|byte
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_DATA
)paren
)paren
suffix:semicolon
)brace
)brace
id|outb
c_func
(paren
id|ensoniq-&gt;uartc
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_CONTROL
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|ES_TXINTENI
c_func
(paren
id|ensoniq-&gt;uartc
)paren
op_eq
l_int|1
)paren
(brace
id|ensoniq-&gt;uartc
op_and_assign
op_complement
id|ES_TXINTENM
suffix:semicolon
id|outb
c_func
(paren
id|ensoniq-&gt;uartc
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|UART_CONTROL
)paren
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|variable|snd_ensoniq_midi_output
r_static
id|snd_rawmidi_ops_t
id|snd_ensoniq_midi_output
op_assign
(brace
dot
id|open
op_assign
id|snd_ensoniq_midi_output_open
comma
dot
id|close
op_assign
id|snd_ensoniq_midi_output_close
comma
dot
id|trigger
op_assign
id|snd_ensoniq_midi_output_trigger
comma
)brace
suffix:semicolon
DECL|variable|snd_ensoniq_midi_input
r_static
id|snd_rawmidi_ops_t
id|snd_ensoniq_midi_input
op_assign
(brace
dot
id|open
op_assign
id|snd_ensoniq_midi_input_open
comma
dot
id|close
op_assign
id|snd_ensoniq_midi_input_close
comma
dot
id|trigger
op_assign
id|snd_ensoniq_midi_input_trigger
comma
)brace
suffix:semicolon
DECL|function|snd_ensoniq_midi
r_static
r_int
id|__devinit
id|snd_ensoniq_midi
c_func
(paren
id|ensoniq_t
op_star
id|ensoniq
comma
r_int
id|device
comma
id|snd_rawmidi_t
op_star
op_star
id|rrawmidi
)paren
(brace
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rrawmidi
)paren
op_star
id|rrawmidi
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_rawmidi_new
c_func
(paren
id|ensoniq-&gt;card
comma
l_string|&quot;ES1370/1&quot;
comma
id|device
comma
l_int|1
comma
l_int|1
comma
op_amp
id|rmidi
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
macro_line|#ifdef CHIP1370
id|strcpy
c_func
(paren
id|rmidi-&gt;name
comma
l_string|&quot;ES1370&quot;
)paren
suffix:semicolon
macro_line|#else
id|strcpy
c_func
(paren
id|rmidi-&gt;name
comma
l_string|&quot;ES1371&quot;
)paren
suffix:semicolon
macro_line|#endif
id|snd_rawmidi_set_ops
c_func
(paren
id|rmidi
comma
id|SNDRV_RAWMIDI_STREAM_OUTPUT
comma
op_amp
id|snd_ensoniq_midi_output
)paren
suffix:semicolon
id|snd_rawmidi_set_ops
c_func
(paren
id|rmidi
comma
id|SNDRV_RAWMIDI_STREAM_INPUT
comma
op_amp
id|snd_ensoniq_midi_input
)paren
suffix:semicolon
id|rmidi-&gt;info_flags
op_or_assign
id|SNDRV_RAWMIDI_INFO_OUTPUT
op_or
id|SNDRV_RAWMIDI_INFO_INPUT
op_or
id|SNDRV_RAWMIDI_INFO_DUPLEX
suffix:semicolon
id|rmidi-&gt;private_data
op_assign
id|ensoniq
suffix:semicolon
id|ensoniq-&gt;rmidi
op_assign
id|rmidi
suffix:semicolon
r_if
c_cond
(paren
id|rrawmidi
)paren
op_star
id|rrawmidi
op_assign
id|rmidi
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Interrupt handler&n; */
DECL|function|snd_audiopci_interrupt
r_static
id|irqreturn_t
id|snd_audiopci_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|ensoniq_t
op_star
id|ensoniq
op_assign
id|dev_id
suffix:semicolon
r_int
r_int
id|status
comma
id|sctrl
suffix:semicolon
r_if
c_cond
(paren
id|ensoniq
op_eq
l_int|NULL
)paren
r_return
id|IRQ_NONE
suffix:semicolon
id|status
op_assign
id|inl
c_func
(paren
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|STATUS
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
id|ES_INTR
)paren
)paren
r_return
id|IRQ_NONE
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
id|sctrl
op_assign
id|ensoniq-&gt;sctrl
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|ES_DAC1
)paren
id|sctrl
op_and_assign
op_complement
id|ES_P1_INT_EN
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|ES_DAC2
)paren
id|sctrl
op_and_assign
op_complement
id|ES_P2_INT_EN
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|ES_ADC
)paren
id|sctrl
op_and_assign
op_complement
id|ES_R1_INT_EN
suffix:semicolon
id|outl
c_func
(paren
id|sctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|SERIAL
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|ensoniq-&gt;sctrl
comma
id|ES_REG
c_func
(paren
id|ensoniq
comma
id|SERIAL
)paren
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|ensoniq-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|ES_UART
)paren
id|snd_ensoniq_midi_interrupt
c_func
(paren
id|ensoniq
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|ES_DAC2
)paren
op_logical_and
id|ensoniq-&gt;playback2_substream
)paren
id|snd_pcm_period_elapsed
c_func
(paren
id|ensoniq-&gt;playback2_substream
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|ES_ADC
)paren
op_logical_and
id|ensoniq-&gt;capture_substream
)paren
id|snd_pcm_period_elapsed
c_func
(paren
id|ensoniq-&gt;capture_substream
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|ES_DAC1
)paren
op_logical_and
id|ensoniq-&gt;playback1_substream
)paren
id|snd_pcm_period_elapsed
c_func
(paren
id|ensoniq-&gt;playback1_substream
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|snd_audiopci_probe
r_static
r_int
id|__devinit
id|snd_audiopci_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_const
r_struct
id|pci_device_id
op_star
id|pci_id
)paren
(brace
r_static
r_int
id|dev
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
id|ensoniq_t
op_star
id|ensoniq
suffix:semicolon
r_int
id|err
comma
id|pcm_devs
(braket
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_ge
id|SNDRV_CARDS
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|enable
(braket
id|dev
)braket
)paren
(brace
id|dev
op_increment
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|card
op_assign
id|snd_card_new
c_func
(paren
id|index
(braket
id|dev
)braket
comma
id|id
(braket
id|dev
)braket
comma
id|THIS_MODULE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ensoniq_create
c_func
(paren
id|card
comma
id|pci
comma
op_amp
id|ensoniq
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|pcm_devs
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|pcm_devs
(braket
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef CHIP1370
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ensoniq_1370_mixer
c_func
(paren
id|ensoniq
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CHIP1371
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ensoniq_1371_mixer
c_func
(paren
id|ensoniq
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ensoniq_pcm
c_func
(paren
id|ensoniq
comma
l_int|0
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ensoniq_pcm2
c_func
(paren
id|ensoniq
comma
l_int|1
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ensoniq_midi
c_func
(paren
id|ensoniq
comma
l_int|0
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#ifdef SUPPORT_JOYSTICK
macro_line|#ifdef CHIP1371
r_switch
c_cond
(paren
id|joystick_port
(braket
id|dev
)braket
)paren
(brace
r_case
l_int|1
suffix:colon
multiline_comment|/* auto-detect */
r_case
l_int|0x200
suffix:colon
r_case
l_int|0x208
suffix:colon
r_case
l_int|0x210
suffix:colon
r_case
l_int|0x218
suffix:colon
id|snd_ensoniq_joystick
c_func
(paren
id|ensoniq
comma
id|joystick_port
(braket
id|dev
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#else
r_if
c_cond
(paren
id|joystick
(braket
id|dev
)braket
)paren
id|snd_ensoniq_joystick
c_func
(paren
id|ensoniq
comma
l_int|0x200
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif /* SUPPORT_JOYSTICK */
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
id|DRIVER_NAME
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;shortname
comma
l_string|&quot;Ensoniq AudioPCI&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;%s %s at 0x%lx, irq %i&quot;
comma
id|card-&gt;shortname
comma
id|card-&gt;driver
comma
id|ensoniq-&gt;port
comma
id|ensoniq-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_card_register
c_func
(paren
id|card
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pci
comma
id|card
)paren
suffix:semicolon
id|dev
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_audiopci_remove
r_static
r_void
id|__devexit
id|snd_audiopci_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
id|snd_card_free
c_func
(paren
id|pci_get_drvdata
c_func
(paren
id|pci
)paren
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|driver
r_static
r_struct
id|pci_driver
id|driver
op_assign
(brace
dot
id|name
op_assign
id|DRIVER_NAME
comma
dot
id|id_table
op_assign
id|snd_audiopci_ids
comma
dot
id|probe
op_assign
id|snd_audiopci_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|snd_audiopci_remove
)paren
comma
)brace
suffix:semicolon
DECL|function|alsa_card_ens137x_init
r_static
r_int
id|__init
id|alsa_card_ens137x_init
c_func
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
DECL|function|alsa_card_ens137x_exit
r_static
r_void
id|__exit
id|alsa_card_ens137x_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|alsa_card_ens137x_init
)paren
id|module_exit
c_func
(paren
id|alsa_card_ens137x_exit
)paren
eof
