multiline_comment|/*&n; *   ALSA modem driver for VIA VT82xx (South Bridge)&n; *&n; *   VT82C686A/B/C, VT8233A/C, VT8235&n; *&n; *&t;Copyright (c) 2000 Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *&t;                   Tjeerd.Mulder &lt;Tjeerd.Mulder@fujitsu-siemens.com&gt;&n; *                    2002 Takashi Iwai &lt;tiwai@suse.de&gt;&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
multiline_comment|/*&n; * Changes:&n; *&n; * Sep. 2,  2004  Sasha Khapyorsky &lt;sashak@smlink.com&gt;&n; *      Modified from original audio driver &squot;via82xx.c&squot; to support AC97&n; *      modems.&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
macro_line|#include &lt;sound/pcm_params.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#include &lt;sound/ac97_codec.h&gt;
macro_line|#include &lt;sound/initval.h&gt;
macro_line|#if 0
mdefine_line|#define POINTER_DEBUG
macro_line|#endif
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jaroslav Kysela &lt;perex@suse.cz&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;VIA VT82xx modem&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_SUPPORTED_DEVICE
c_func
(paren
l_string|&quot;{{VIA,VT82C686A/B/C modem,pci}}&quot;
)paren
suffix:semicolon
DECL|variable|index
r_static
r_int
id|index
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_IDX
suffix:semicolon
multiline_comment|/* Index 0-MAX */
DECL|variable|id
r_static
r_char
op_star
id|id
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_STR
suffix:semicolon
multiline_comment|/* ID for this card */
DECL|variable|enable
r_static
r_int
id|enable
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_ENABLE_PNP
suffix:semicolon
multiline_comment|/* Enable this card */
DECL|variable|ac97_clock
r_static
r_int
id|ac97_clock
(braket
id|SNDRV_CARDS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
(paren
id|SNDRV_CARDS
op_minus
l_int|1
)paren
)braket
op_assign
l_int|48000
)brace
suffix:semicolon
id|module_param_array
c_func
(paren
id|index
comma
r_int
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|index
comma
l_string|&quot;Index value for VIA 82xx bridge.&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|id
comma
id|charp
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|id
comma
l_string|&quot;ID string for VIA 82xx bridge.&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|enable
comma
r_bool
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|enable
comma
l_string|&quot;Enable modem part of VIA 82xx bridge.&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|ac97_clock
comma
r_int
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|ac97_clock
comma
l_string|&quot;AC&squot;97 codec clock (default 48000Hz).&quot;
)paren
suffix:semicolon
multiline_comment|/*&n; *  Direct registers&n; */
DECL|macro|VIAREG
mdefine_line|#define VIAREG(via, x) ((via)-&gt;port + VIA_REG_##x)
DECL|macro|VIADEV_REG
mdefine_line|#define VIADEV_REG(viadev, x) ((viadev)-&gt;port + VIA_REG_##x)
multiline_comment|/* common offsets */
DECL|macro|VIA_REG_OFFSET_STATUS
mdefine_line|#define VIA_REG_OFFSET_STATUS&t;&t;0x00&t;/* byte - channel status */
DECL|macro|VIA_REG_STAT_ACTIVE
mdefine_line|#define   VIA_REG_STAT_ACTIVE&t;&t;0x80&t;/* RO */
DECL|macro|VIA_REG_STAT_PAUSED
mdefine_line|#define   VIA_REG_STAT_PAUSED&t;&t;0x40&t;/* RO */
DECL|macro|VIA_REG_STAT_TRIGGER_QUEUED
mdefine_line|#define   VIA_REG_STAT_TRIGGER_QUEUED&t;0x08&t;/* RO */
DECL|macro|VIA_REG_STAT_STOPPED
mdefine_line|#define   VIA_REG_STAT_STOPPED&t;&t;0x04&t;/* RWC */
DECL|macro|VIA_REG_STAT_EOL
mdefine_line|#define   VIA_REG_STAT_EOL&t;&t;0x02&t;/* RWC */
DECL|macro|VIA_REG_STAT_FLAG
mdefine_line|#define   VIA_REG_STAT_FLAG&t;&t;0x01&t;/* RWC */
DECL|macro|VIA_REG_OFFSET_CONTROL
mdefine_line|#define VIA_REG_OFFSET_CONTROL&t;&t;0x01&t;/* byte - channel control */
DECL|macro|VIA_REG_CTRL_START
mdefine_line|#define   VIA_REG_CTRL_START&t;&t;0x80&t;/* WO */
DECL|macro|VIA_REG_CTRL_TERMINATE
mdefine_line|#define   VIA_REG_CTRL_TERMINATE&t;0x40&t;/* WO */
DECL|macro|VIA_REG_CTRL_AUTOSTART
mdefine_line|#define   VIA_REG_CTRL_AUTOSTART&t;0x20
DECL|macro|VIA_REG_CTRL_PAUSE
mdefine_line|#define   VIA_REG_CTRL_PAUSE&t;&t;0x08&t;/* RW */
DECL|macro|VIA_REG_CTRL_INT_STOP
mdefine_line|#define   VIA_REG_CTRL_INT_STOP&t;&t;0x04&t;&t;
DECL|macro|VIA_REG_CTRL_INT_EOL
mdefine_line|#define   VIA_REG_CTRL_INT_EOL&t;&t;0x02
DECL|macro|VIA_REG_CTRL_INT_FLAG
mdefine_line|#define   VIA_REG_CTRL_INT_FLAG&t;&t;0x01
DECL|macro|VIA_REG_CTRL_RESET
mdefine_line|#define   VIA_REG_CTRL_RESET&t;&t;0x01&t;/* RW - probably reset? undocumented */
DECL|macro|VIA_REG_CTRL_INT
mdefine_line|#define   VIA_REG_CTRL_INT (VIA_REG_CTRL_INT_FLAG | VIA_REG_CTRL_INT_EOL | VIA_REG_CTRL_AUTOSTART)
DECL|macro|VIA_REG_OFFSET_TYPE
mdefine_line|#define VIA_REG_OFFSET_TYPE&t;&t;0x02&t;/* byte - channel type (686 only) */
DECL|macro|VIA_REG_TYPE_AUTOSTART
mdefine_line|#define   VIA_REG_TYPE_AUTOSTART&t;0x80&t;/* RW - autostart at EOL */
DECL|macro|VIA_REG_TYPE_16BIT
mdefine_line|#define   VIA_REG_TYPE_16BIT&t;&t;0x20&t;/* RW */
DECL|macro|VIA_REG_TYPE_STEREO
mdefine_line|#define   VIA_REG_TYPE_STEREO&t;&t;0x10&t;/* RW */
DECL|macro|VIA_REG_TYPE_INT_LLINE
mdefine_line|#define   VIA_REG_TYPE_INT_LLINE&t;0x00
DECL|macro|VIA_REG_TYPE_INT_LSAMPLE
mdefine_line|#define   VIA_REG_TYPE_INT_LSAMPLE&t;0x04
DECL|macro|VIA_REG_TYPE_INT_LESSONE
mdefine_line|#define   VIA_REG_TYPE_INT_LESSONE&t;0x08
DECL|macro|VIA_REG_TYPE_INT_MASK
mdefine_line|#define   VIA_REG_TYPE_INT_MASK&t;&t;0x0c
DECL|macro|VIA_REG_TYPE_INT_EOL
mdefine_line|#define   VIA_REG_TYPE_INT_EOL&t;&t;0x02
DECL|macro|VIA_REG_TYPE_INT_FLAG
mdefine_line|#define   VIA_REG_TYPE_INT_FLAG&t;&t;0x01
DECL|macro|VIA_REG_OFFSET_TABLE_PTR
mdefine_line|#define VIA_REG_OFFSET_TABLE_PTR&t;0x04&t;/* dword - channel table pointer */
DECL|macro|VIA_REG_OFFSET_CURR_PTR
mdefine_line|#define VIA_REG_OFFSET_CURR_PTR&t;&t;0x04&t;/* dword - channel current pointer */
DECL|macro|VIA_REG_OFFSET_STOP_IDX
mdefine_line|#define VIA_REG_OFFSET_STOP_IDX&t;&t;0x08&t;/* dword - stop index, channel type, sample rate */
DECL|macro|VIA_REG_OFFSET_CURR_COUNT
mdefine_line|#define VIA_REG_OFFSET_CURR_COUNT&t;0x0c&t;/* dword - channel current count (24 bit) */
DECL|macro|VIA_REG_OFFSET_CURR_INDEX
mdefine_line|#define VIA_REG_OFFSET_CURR_INDEX&t;0x0f&t;/* byte - channel current index (for via8233 only) */
DECL|macro|DEFINE_VIA_REGSET
mdefine_line|#define DEFINE_VIA_REGSET(name,val) &bslash;&n;enum {&bslash;&n;&t;VIA_REG_##name##_STATUS&t;&t;= (val),&bslash;&n;&t;VIA_REG_##name##_CONTROL&t;= (val) + 0x01,&bslash;&n;&t;VIA_REG_##name##_TYPE&t;&t;= (val) + 0x02,&bslash;&n;&t;VIA_REG_##name##_TABLE_PTR&t;= (val) + 0x04,&bslash;&n;&t;VIA_REG_##name##_CURR_PTR&t;= (val) + 0x04,&bslash;&n;&t;VIA_REG_##name##_STOP_IDX&t;= (val) + 0x08,&bslash;&n;&t;VIA_REG_##name##_CURR_COUNT&t;= (val) + 0x0c,&bslash;&n;}
multiline_comment|/* modem block */
id|DEFINE_VIA_REGSET
c_func
(paren
id|MO
comma
l_int|0x40
)paren
suffix:semicolon
id|DEFINE_VIA_REGSET
c_func
(paren
id|MI
comma
l_int|0x50
)paren
suffix:semicolon
multiline_comment|/* AC&squot;97 */
DECL|macro|VIA_REG_AC97
mdefine_line|#define VIA_REG_AC97&t;&t;&t;0x80&t;/* dword */
DECL|macro|VIA_REG_AC97_CODEC_ID_MASK
mdefine_line|#define   VIA_REG_AC97_CODEC_ID_MASK&t;(3&lt;&lt;30)
DECL|macro|VIA_REG_AC97_CODEC_ID_SHIFT
mdefine_line|#define   VIA_REG_AC97_CODEC_ID_SHIFT&t;30
DECL|macro|VIA_REG_AC97_CODEC_ID_PRIMARY
mdefine_line|#define   VIA_REG_AC97_CODEC_ID_PRIMARY&t;0x00
DECL|macro|VIA_REG_AC97_CODEC_ID_SECONDARY
mdefine_line|#define   VIA_REG_AC97_CODEC_ID_SECONDARY 0x01
DECL|macro|VIA_REG_AC97_SECONDARY_VALID
mdefine_line|#define   VIA_REG_AC97_SECONDARY_VALID&t;(1&lt;&lt;27)
DECL|macro|VIA_REG_AC97_PRIMARY_VALID
mdefine_line|#define   VIA_REG_AC97_PRIMARY_VALID&t;(1&lt;&lt;25)
DECL|macro|VIA_REG_AC97_BUSY
mdefine_line|#define   VIA_REG_AC97_BUSY&t;&t;(1&lt;&lt;24)
DECL|macro|VIA_REG_AC97_READ
mdefine_line|#define   VIA_REG_AC97_READ&t;&t;(1&lt;&lt;23)
DECL|macro|VIA_REG_AC97_CMD_SHIFT
mdefine_line|#define   VIA_REG_AC97_CMD_SHIFT&t;16
DECL|macro|VIA_REG_AC97_CMD_MASK
mdefine_line|#define   VIA_REG_AC97_CMD_MASK&t;&t;0x7e
DECL|macro|VIA_REG_AC97_DATA_SHIFT
mdefine_line|#define   VIA_REG_AC97_DATA_SHIFT&t;0
DECL|macro|VIA_REG_AC97_DATA_MASK
mdefine_line|#define   VIA_REG_AC97_DATA_MASK&t;0xffff
DECL|macro|VIA_REG_SGD_SHADOW
mdefine_line|#define VIA_REG_SGD_SHADOW&t;&t;0x84&t;/* dword */
DECL|macro|VIA_REG_SGD_STAT_PB_FLAG
mdefine_line|#define   VIA_REG_SGD_STAT_PB_FLAG&t;(1&lt;&lt;0)
DECL|macro|VIA_REG_SGD_STAT_CP_FLAG
mdefine_line|#define   VIA_REG_SGD_STAT_CP_FLAG&t;(1&lt;&lt;1)
DECL|macro|VIA_REG_SGD_STAT_FM_FLAG
mdefine_line|#define   VIA_REG_SGD_STAT_FM_FLAG&t;(1&lt;&lt;2)
DECL|macro|VIA_REG_SGD_STAT_PB_EOL
mdefine_line|#define   VIA_REG_SGD_STAT_PB_EOL&t;(1&lt;&lt;4)
DECL|macro|VIA_REG_SGD_STAT_CP_EOL
mdefine_line|#define   VIA_REG_SGD_STAT_CP_EOL&t;(1&lt;&lt;5)
DECL|macro|VIA_REG_SGD_STAT_FM_EOL
mdefine_line|#define   VIA_REG_SGD_STAT_FM_EOL&t;(1&lt;&lt;6)
DECL|macro|VIA_REG_SGD_STAT_PB_STOP
mdefine_line|#define   VIA_REG_SGD_STAT_PB_STOP&t;(1&lt;&lt;8)
DECL|macro|VIA_REG_SGD_STAT_CP_STOP
mdefine_line|#define   VIA_REG_SGD_STAT_CP_STOP&t;(1&lt;&lt;9)
DECL|macro|VIA_REG_SGD_STAT_FM_STOP
mdefine_line|#define   VIA_REG_SGD_STAT_FM_STOP&t;(1&lt;&lt;10)
DECL|macro|VIA_REG_SGD_STAT_PB_ACTIVE
mdefine_line|#define   VIA_REG_SGD_STAT_PB_ACTIVE&t;(1&lt;&lt;12)
DECL|macro|VIA_REG_SGD_STAT_CP_ACTIVE
mdefine_line|#define   VIA_REG_SGD_STAT_CP_ACTIVE&t;(1&lt;&lt;13)
DECL|macro|VIA_REG_SGD_STAT_FM_ACTIVE
mdefine_line|#define   VIA_REG_SGD_STAT_FM_ACTIVE&t;(1&lt;&lt;14)
DECL|macro|VIA_REG_SGD_STAT_MR_FLAG
mdefine_line|#define   VIA_REG_SGD_STAT_MR_FLAG      (1&lt;&lt;16)
DECL|macro|VIA_REG_SGD_STAT_MW_FLAG
mdefine_line|#define   VIA_REG_SGD_STAT_MW_FLAG      (1&lt;&lt;17)
DECL|macro|VIA_REG_SGD_STAT_MR_EOL
mdefine_line|#define   VIA_REG_SGD_STAT_MR_EOL       (1&lt;&lt;20)
DECL|macro|VIA_REG_SGD_STAT_MW_EOL
mdefine_line|#define   VIA_REG_SGD_STAT_MW_EOL       (1&lt;&lt;21)
DECL|macro|VIA_REG_SGD_STAT_MR_STOP
mdefine_line|#define   VIA_REG_SGD_STAT_MR_STOP      (1&lt;&lt;24)
DECL|macro|VIA_REG_SGD_STAT_MW_STOP
mdefine_line|#define   VIA_REG_SGD_STAT_MW_STOP      (1&lt;&lt;25)
DECL|macro|VIA_REG_SGD_STAT_MR_ACTIVE
mdefine_line|#define   VIA_REG_SGD_STAT_MR_ACTIVE    (1&lt;&lt;28)
DECL|macro|VIA_REG_SGD_STAT_MW_ACTIVE
mdefine_line|#define   VIA_REG_SGD_STAT_MW_ACTIVE    (1&lt;&lt;29)
DECL|macro|VIA_REG_GPI_STATUS
mdefine_line|#define VIA_REG_GPI_STATUS&t;&t;0x88
DECL|macro|VIA_REG_GPI_INTR
mdefine_line|#define VIA_REG_GPI_INTR&t;&t;0x8c
DECL|macro|VIA_TBL_BIT_FLAG
mdefine_line|#define VIA_TBL_BIT_FLAG&t;0x40000000
DECL|macro|VIA_TBL_BIT_EOL
mdefine_line|#define VIA_TBL_BIT_EOL&t;&t;0x80000000
multiline_comment|/* pci space */
DECL|macro|VIA_ACLINK_STAT
mdefine_line|#define VIA_ACLINK_STAT&t;&t;0x40
DECL|macro|VIA_ACLINK_C11_READY
mdefine_line|#define  VIA_ACLINK_C11_READY&t;0x20
DECL|macro|VIA_ACLINK_C10_READY
mdefine_line|#define  VIA_ACLINK_C10_READY&t;0x10
DECL|macro|VIA_ACLINK_C01_READY
mdefine_line|#define  VIA_ACLINK_C01_READY&t;0x04 /* secondary codec ready */
DECL|macro|VIA_ACLINK_LOWPOWER
mdefine_line|#define  VIA_ACLINK_LOWPOWER&t;0x02 /* low-power state */
DECL|macro|VIA_ACLINK_C00_READY
mdefine_line|#define  VIA_ACLINK_C00_READY&t;0x01 /* primary codec ready */
DECL|macro|VIA_ACLINK_CTRL
mdefine_line|#define VIA_ACLINK_CTRL&t;&t;0x41
DECL|macro|VIA_ACLINK_CTRL_ENABLE
mdefine_line|#define  VIA_ACLINK_CTRL_ENABLE&t;0x80 /* 0: disable, 1: enable */
DECL|macro|VIA_ACLINK_CTRL_RESET
mdefine_line|#define  VIA_ACLINK_CTRL_RESET&t;0x40 /* 0: assert, 1: de-assert */
DECL|macro|VIA_ACLINK_CTRL_SYNC
mdefine_line|#define  VIA_ACLINK_CTRL_SYNC&t;0x20 /* 0: release SYNC, 1: force SYNC hi */
DECL|macro|VIA_ACLINK_CTRL_SDO
mdefine_line|#define  VIA_ACLINK_CTRL_SDO&t;0x10 /* 0: release SDO, 1: force SDO hi */
DECL|macro|VIA_ACLINK_CTRL_VRA
mdefine_line|#define  VIA_ACLINK_CTRL_VRA&t;0x08 /* 0: disable VRA, 1: enable VRA */
DECL|macro|VIA_ACLINK_CTRL_PCM
mdefine_line|#define  VIA_ACLINK_CTRL_PCM&t;0x04 /* 0: disable PCM, 1: enable PCM */
DECL|macro|VIA_ACLINK_CTRL_FM
mdefine_line|#define  VIA_ACLINK_CTRL_FM&t;0x02 /* via686 only */
DECL|macro|VIA_ACLINK_CTRL_SB
mdefine_line|#define  VIA_ACLINK_CTRL_SB&t;0x01 /* via686 only */
DECL|macro|VIA_ACLINK_CTRL_INIT
mdefine_line|#define  VIA_ACLINK_CTRL_INIT&t;(VIA_ACLINK_CTRL_ENABLE|&bslash;&n;&t;&t;&t;&t; VIA_ACLINK_CTRL_RESET|&bslash;&n;&t;&t;&t;&t; VIA_ACLINK_CTRL_PCM)
DECL|macro|VIA_FUNC_ENABLE
mdefine_line|#define VIA_FUNC_ENABLE&t;&t;0x42
DECL|macro|VIA_FUNC_MIDI_PNP
mdefine_line|#define  VIA_FUNC_MIDI_PNP&t;0x80 /* FIXME: it&squot;s 0x40 in the datasheet! */
DECL|macro|VIA_FUNC_MIDI_IRQMASK
mdefine_line|#define  VIA_FUNC_MIDI_IRQMASK&t;0x40 /* FIXME: not documented! */
DECL|macro|VIA_FUNC_RX2C_WRITE
mdefine_line|#define  VIA_FUNC_RX2C_WRITE&t;0x20
DECL|macro|VIA_FUNC_SB_FIFO_EMPTY
mdefine_line|#define  VIA_FUNC_SB_FIFO_EMPTY&t;0x10
DECL|macro|VIA_FUNC_ENABLE_GAME
mdefine_line|#define  VIA_FUNC_ENABLE_GAME&t;0x08
DECL|macro|VIA_FUNC_ENABLE_FM
mdefine_line|#define  VIA_FUNC_ENABLE_FM&t;0x04
DECL|macro|VIA_FUNC_ENABLE_MIDI
mdefine_line|#define  VIA_FUNC_ENABLE_MIDI&t;0x02
DECL|macro|VIA_FUNC_ENABLE_SB
mdefine_line|#define  VIA_FUNC_ENABLE_SB&t;0x01
DECL|macro|VIA_PNP_CONTROL
mdefine_line|#define VIA_PNP_CONTROL&t;&t;0x43
DECL|macro|VIA_MC97_CTRL
mdefine_line|#define VIA_MC97_CTRL&t;&t;0x44
DECL|macro|VIA_MC97_CTRL_ENABLE
mdefine_line|#define  VIA_MC97_CTRL_ENABLE   0x80
DECL|macro|VIA_MC97_CTRL_SECONDARY
mdefine_line|#define  VIA_MC97_CTRL_SECONDARY 0x40
DECL|macro|VIA_MC97_CTRL_INIT
mdefine_line|#define  VIA_MC97_CTRL_INIT     (VIA_MC97_CTRL_ENABLE|&bslash;&n;                                 VIA_MC97_CTRL_SECONDARY)
DECL|typedef|via82xx_t
r_typedef
r_struct
id|_snd_via82xx_modem
id|via82xx_t
suffix:semicolon
DECL|typedef|viadev_t
r_typedef
r_struct
id|via_dev
id|viadev_t
suffix:semicolon
multiline_comment|/*&n; * pcm stream&n; */
DECL|struct|snd_via_sg_table
r_struct
id|snd_via_sg_table
(brace
DECL|member|offset
r_int
r_int
id|offset
suffix:semicolon
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|VIA_TABLE_SIZE
mdefine_line|#define VIA_TABLE_SIZE&t;255
DECL|struct|via_dev
r_struct
id|via_dev
(brace
DECL|member|reg_offset
r_int
r_int
id|reg_offset
suffix:semicolon
DECL|member|port
r_int
r_int
id|port
suffix:semicolon
DECL|member|direction
r_int
id|direction
suffix:semicolon
multiline_comment|/* playback = 0, capture = 1 */
DECL|member|substream
id|snd_pcm_substream_t
op_star
id|substream
suffix:semicolon
DECL|member|running
r_int
id|running
suffix:semicolon
DECL|member|tbl_entries
r_int
r_int
id|tbl_entries
suffix:semicolon
multiline_comment|/* # descriptors */
DECL|member|table
r_struct
id|snd_dma_buffer
id|table
suffix:semicolon
DECL|member|idx_table
r_struct
id|snd_via_sg_table
op_star
id|idx_table
suffix:semicolon
multiline_comment|/* for recovery from the unexpected pointer */
DECL|member|lastpos
r_int
r_int
id|lastpos
suffix:semicolon
DECL|member|bufsize
r_int
r_int
id|bufsize
suffix:semicolon
DECL|member|bufsize2
r_int
r_int
id|bufsize2
suffix:semicolon
)brace
suffix:semicolon
DECL|enumerator|TYPE_CARD_VIA82XX_MODEM
r_enum
(brace
id|TYPE_CARD_VIA82XX_MODEM
op_assign
l_int|1
)brace
suffix:semicolon
DECL|macro|VIA_MAX_MODEM_DEVS
mdefine_line|#define VIA_MAX_MODEM_DEVS&t;2
DECL|struct|_snd_via82xx_modem
r_struct
id|_snd_via82xx_modem
(brace
DECL|member|irq
r_int
id|irq
suffix:semicolon
DECL|member|port
r_int
r_int
id|port
suffix:semicolon
DECL|member|intr_mask
r_int
r_int
id|intr_mask
suffix:semicolon
multiline_comment|/* SGD_SHADOW mask to check interrupts */
DECL|member|pci
r_struct
id|pci_dev
op_star
id|pci
suffix:semicolon
DECL|member|card
id|snd_card_t
op_star
id|card
suffix:semicolon
DECL|member|num_devs
r_int
r_int
id|num_devs
suffix:semicolon
DECL|member|playback_devno
DECL|member|capture_devno
r_int
r_int
id|playback_devno
comma
id|capture_devno
suffix:semicolon
DECL|member|devs
id|viadev_t
id|devs
(braket
id|VIA_MAX_MODEM_DEVS
)braket
suffix:semicolon
DECL|member|pcms
id|snd_pcm_t
op_star
id|pcms
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|ac97_bus
id|ac97_bus_t
op_star
id|ac97_bus
suffix:semicolon
DECL|member|ac97
id|ac97_t
op_star
id|ac97
suffix:semicolon
DECL|member|ac97_clock
r_int
r_int
id|ac97_clock
suffix:semicolon
DECL|member|ac97_secondary
r_int
r_int
id|ac97_secondary
suffix:semicolon
multiline_comment|/* secondary AC&squot;97 codec is present */
DECL|member|reg_lock
id|spinlock_t
id|reg_lock
suffix:semicolon
DECL|member|ac97_lock
id|spinlock_t
id|ac97_lock
suffix:semicolon
DECL|member|proc_entry
id|snd_info_entry_t
op_star
id|proc_entry
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|snd_via82xx_modem_ids
r_static
r_struct
id|pci_device_id
id|snd_via82xx_modem_ids
(braket
)braket
op_assign
(brace
(brace
l_int|0x1106
comma
l_int|0x3068
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
id|TYPE_CARD_VIA82XX_MODEM
comma
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|snd_via82xx_modem_ids
)paren
suffix:semicolon
multiline_comment|/*&n; */
multiline_comment|/*&n; * allocate and initialize the descriptor buffers&n; * periods = number of periods&n; * fragsize = period size in bytes&n; */
DECL|function|build_via_table
r_static
r_int
id|build_via_table
c_func
(paren
id|viadev_t
op_star
id|dev
comma
id|snd_pcm_substream_t
op_star
id|substream
comma
r_struct
id|pci_dev
op_star
id|pci
comma
r_int
r_int
id|periods
comma
r_int
r_int
id|fragsize
)paren
(brace
r_int
r_int
id|i
comma
id|idx
comma
id|ofs
comma
id|rest
suffix:semicolon
id|via82xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_struct
id|snd_sg_buf
op_star
id|sgbuf
op_assign
id|snd_pcm_substream_sgbuf
c_func
(paren
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;table.area
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* the start of each lists must be aligned to 8 bytes,&n;&t;&t; * but the kernel pages are much bigger, so we don&squot;t care&n;&t;&t; */
r_if
c_cond
(paren
id|snd_dma_alloc_pages
c_func
(paren
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|chip-&gt;pci
)paren
comma
id|PAGE_ALIGN
c_func
(paren
id|VIA_TABLE_SIZE
op_star
l_int|2
op_star
l_int|8
)paren
comma
op_amp
id|dev-&gt;table
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;idx_table
)paren
(brace
id|dev-&gt;idx_table
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|dev-&gt;idx_table
)paren
op_star
id|VIA_TABLE_SIZE
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;idx_table
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* fill the entries */
id|idx
op_assign
l_int|0
suffix:semicolon
id|ofs
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|periods
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rest
op_assign
id|fragsize
suffix:semicolon
multiline_comment|/* fill descriptors for a period.&n;&t;&t; * a period can be split to several descriptors if it&squot;s&n;&t;&t; * over page boundary.&n;&t;&t; */
r_do
(brace
r_int
r_int
id|r
suffix:semicolon
r_int
r_int
id|flag
suffix:semicolon
r_if
c_cond
(paren
id|idx
op_ge
id|VIA_TABLE_SIZE
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;via82xx: too much table size!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
(paren
(paren
id|u32
op_star
)paren
id|dev-&gt;table.area
)paren
(braket
id|idx
op_lshift
l_int|1
)braket
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|u32
)paren
id|snd_pcm_sgbuf_get_addr
c_func
(paren
id|sgbuf
comma
id|ofs
)paren
)paren
suffix:semicolon
id|r
op_assign
id|PAGE_SIZE
op_minus
(paren
id|ofs
op_mod
id|PAGE_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rest
OL
id|r
)paren
id|r
op_assign
id|rest
suffix:semicolon
id|rest
op_sub_assign
id|r
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rest
)paren
(brace
r_if
c_cond
(paren
id|i
op_eq
id|periods
op_minus
l_int|1
)paren
id|flag
op_assign
id|VIA_TBL_BIT_EOL
suffix:semicolon
multiline_comment|/* buffer boundary */
r_else
id|flag
op_assign
id|VIA_TBL_BIT_FLAG
suffix:semicolon
multiline_comment|/* period boundary */
)brace
r_else
id|flag
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* period continues to the next */
singleline_comment|// printk(&quot;via: tbl %d: at %d  size %d (rest %d)&bslash;n&quot;, idx, ofs, r, rest);
(paren
(paren
id|u32
op_star
)paren
id|dev-&gt;table.area
)paren
(braket
(paren
id|idx
op_lshift
l_int|1
)paren
op_plus
l_int|1
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|r
op_or
id|flag
)paren
suffix:semicolon
id|dev-&gt;idx_table
(braket
id|idx
)braket
dot
id|offset
op_assign
id|ofs
suffix:semicolon
id|dev-&gt;idx_table
(braket
id|idx
)braket
dot
id|size
op_assign
id|r
suffix:semicolon
id|ofs
op_add_assign
id|r
suffix:semicolon
id|idx
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|rest
OG
l_int|0
)paren
suffix:semicolon
)brace
id|dev-&gt;tbl_entries
op_assign
id|idx
suffix:semicolon
id|dev-&gt;bufsize
op_assign
id|periods
op_star
id|fragsize
suffix:semicolon
id|dev-&gt;bufsize2
op_assign
id|dev-&gt;bufsize
op_div
l_int|2
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|clean_via_table
r_static
r_int
id|clean_via_table
c_func
(paren
id|viadev_t
op_star
id|dev
comma
id|snd_pcm_substream_t
op_star
id|substream
comma
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;table.area
)paren
(brace
id|snd_dma_free_pages
c_func
(paren
op_amp
id|dev-&gt;table
)paren
suffix:semicolon
id|dev-&gt;table.area
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;idx_table
)paren
(brace
id|kfree
c_func
(paren
id|dev-&gt;idx_table
)paren
suffix:semicolon
id|dev-&gt;idx_table
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Basic I/O&n; */
DECL|function|snd_via82xx_codec_xread
r_static
r_inline
r_int
r_int
id|snd_via82xx_codec_xread
c_func
(paren
id|via82xx_t
op_star
id|chip
)paren
(brace
r_return
id|inl
c_func
(paren
id|VIAREG
c_func
(paren
id|chip
comma
id|AC97
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_via82xx_codec_xwrite
r_static
r_inline
r_void
id|snd_via82xx_codec_xwrite
c_func
(paren
id|via82xx_t
op_star
id|chip
comma
r_int
r_int
id|val
)paren
(brace
id|outl
c_func
(paren
id|val
comma
id|VIAREG
c_func
(paren
id|chip
comma
id|AC97
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_via82xx_codec_ready
r_static
r_int
id|snd_via82xx_codec_ready
c_func
(paren
id|via82xx_t
op_star
id|chip
comma
r_int
id|secondary
)paren
(brace
r_int
r_int
id|timeout
op_assign
l_int|1000
suffix:semicolon
multiline_comment|/* 1ms */
r_int
r_int
id|val
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_decrement
OG
l_int|0
)paren
(brace
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
(paren
id|val
op_assign
id|snd_via82xx_codec_xread
c_func
(paren
id|chip
)paren
)paren
op_amp
id|VIA_REG_AC97_BUSY
)paren
)paren
r_return
id|val
op_amp
l_int|0xffff
suffix:semicolon
)brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;codec_ready: codec %i is not ready [0x%x]&bslash;n&quot;
comma
id|secondary
comma
id|snd_via82xx_codec_xread
c_func
(paren
id|chip
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|snd_via82xx_codec_valid
r_static
r_int
id|snd_via82xx_codec_valid
c_func
(paren
id|via82xx_t
op_star
id|chip
comma
r_int
id|secondary
)paren
(brace
r_int
r_int
id|timeout
op_assign
l_int|1000
suffix:semicolon
multiline_comment|/* 1ms */
r_int
r_int
id|val
comma
id|val1
suffix:semicolon
r_int
r_int
id|stat
op_assign
op_logical_neg
id|secondary
ques
c_cond
id|VIA_REG_AC97_PRIMARY_VALID
suffix:colon
id|VIA_REG_AC97_SECONDARY_VALID
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_decrement
OG
l_int|0
)paren
(brace
id|val
op_assign
id|snd_via82xx_codec_xread
c_func
(paren
id|chip
)paren
suffix:semicolon
id|val1
op_assign
id|val
op_amp
(paren
id|VIA_REG_AC97_BUSY
op_or
id|stat
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val1
op_eq
id|stat
)paren
r_return
id|val
op_amp
l_int|0xffff
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_return
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|snd_via82xx_codec_wait
r_static
r_void
id|snd_via82xx_codec_wait
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
id|via82xx_t
op_star
id|chip
op_assign
id|ac97-&gt;private_data
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|snd_via82xx_codec_ready
c_func
(paren
id|chip
comma
id|ac97-&gt;num
)paren
suffix:semicolon
multiline_comment|/* here we need to wait fairly for long time.. */
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
op_div
l_int|2
)paren
suffix:semicolon
)brace
DECL|function|snd_via82xx_codec_write
r_static
r_void
id|snd_via82xx_codec_write
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
id|via82xx_t
op_star
id|chip
op_assign
id|ac97-&gt;private_data
suffix:semicolon
r_int
r_int
id|xval
suffix:semicolon
id|xval
op_assign
op_logical_neg
id|ac97-&gt;num
ques
c_cond
id|VIA_REG_AC97_CODEC_ID_PRIMARY
suffix:colon
id|VIA_REG_AC97_CODEC_ID_SECONDARY
suffix:semicolon
id|xval
op_lshift_assign
id|VIA_REG_AC97_CODEC_ID_SHIFT
suffix:semicolon
id|xval
op_or_assign
id|reg
op_lshift
id|VIA_REG_AC97_CMD_SHIFT
suffix:semicolon
id|xval
op_or_assign
id|val
op_lshift
id|VIA_REG_AC97_DATA_SHIFT
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;ac97_lock
)paren
suffix:semicolon
id|snd_via82xx_codec_xwrite
c_func
(paren
id|chip
comma
id|xval
)paren
suffix:semicolon
id|snd_via82xx_codec_ready
c_func
(paren
id|chip
comma
id|ac97-&gt;num
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;ac97_lock
)paren
suffix:semicolon
)brace
DECL|function|snd_via82xx_codec_read
r_static
r_int
r_int
id|snd_via82xx_codec_read
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
)paren
(brace
id|via82xx_t
op_star
id|chip
op_assign
id|ac97-&gt;private_data
suffix:semicolon
r_int
r_int
id|xval
comma
id|val
op_assign
l_int|0xffff
suffix:semicolon
r_int
id|again
op_assign
l_int|0
suffix:semicolon
id|xval
op_assign
id|ac97-&gt;num
op_lshift
id|VIA_REG_AC97_CODEC_ID_SHIFT
suffix:semicolon
id|xval
op_or_assign
id|ac97-&gt;num
ques
c_cond
id|VIA_REG_AC97_SECONDARY_VALID
suffix:colon
id|VIA_REG_AC97_PRIMARY_VALID
suffix:semicolon
id|xval
op_or_assign
id|VIA_REG_AC97_READ
suffix:semicolon
id|xval
op_or_assign
(paren
id|reg
op_amp
l_int|0x7f
)paren
op_lshift
id|VIA_REG_AC97_CMD_SHIFT
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;ac97_lock
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|again
op_increment
OG
l_int|3
)paren
(brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;ac97_lock
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;codec_read: codec %i is not valid [0x%x]&bslash;n&quot;
comma
id|ac97-&gt;num
comma
id|snd_via82xx_codec_xread
c_func
(paren
id|chip
)paren
)paren
suffix:semicolon
r_return
l_int|0xffff
suffix:semicolon
)brace
id|snd_via82xx_codec_xwrite
c_func
(paren
id|chip
comma
id|xval
)paren
suffix:semicolon
id|udelay
(paren
l_int|20
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_via82xx_codec_valid
c_func
(paren
id|chip
comma
id|ac97-&gt;num
)paren
op_ge
l_int|0
)paren
(brace
id|udelay
c_func
(paren
l_int|25
)paren
suffix:semicolon
id|val
op_assign
id|snd_via82xx_codec_xread
c_func
(paren
id|chip
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;ac97_lock
)paren
suffix:semicolon
r_return
id|val
op_amp
l_int|0xffff
suffix:semicolon
)brace
DECL|function|snd_via82xx_channel_reset
r_static
r_void
id|snd_via82xx_channel_reset
c_func
(paren
id|via82xx_t
op_star
id|chip
comma
id|viadev_t
op_star
id|viadev
)paren
(brace
id|outb
c_func
(paren
id|VIA_REG_CTRL_PAUSE
op_or
id|VIA_REG_CTRL_TERMINATE
op_or
id|VIA_REG_CTRL_RESET
comma
id|VIADEV_REG
c_func
(paren
id|viadev
comma
id|OFFSET_CONTROL
)paren
)paren
suffix:semicolon
id|inb
c_func
(paren
id|VIADEV_REG
c_func
(paren
id|viadev
comma
id|OFFSET_CONTROL
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
multiline_comment|/* disable interrupts */
id|outb
c_func
(paren
l_int|0x00
comma
id|VIADEV_REG
c_func
(paren
id|viadev
comma
id|OFFSET_CONTROL
)paren
)paren
suffix:semicolon
multiline_comment|/* clear interrupts */
id|outb
c_func
(paren
l_int|0x03
comma
id|VIADEV_REG
c_func
(paren
id|viadev
comma
id|OFFSET_STATUS
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|VIADEV_REG
c_func
(paren
id|viadev
comma
id|OFFSET_TYPE
)paren
)paren
suffix:semicolon
multiline_comment|/* for via686 */
singleline_comment|// outl(0, VIADEV_REG(viadev, OFFSET_CURR_PTR));
id|viadev-&gt;lastpos
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Interrupt handler&n; */
DECL|function|snd_via82xx_interrupt
r_static
id|irqreturn_t
id|snd_via82xx_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|via82xx_t
op_star
id|chip
op_assign
id|dev_id
suffix:semicolon
r_int
r_int
id|status
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
id|status
op_assign
id|inl
c_func
(paren
id|VIAREG
c_func
(paren
id|chip
comma
id|SGD_SHADOW
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
id|chip-&gt;intr_mask
)paren
)paren
(brace
r_return
id|IRQ_NONE
suffix:semicolon
)brace
singleline_comment|// _skip_sgd:
multiline_comment|/* check status for each stream */
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|chip-&gt;num_devs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|viadev_t
op_star
id|viadev
op_assign
op_amp
id|chip-&gt;devs
(braket
id|i
)braket
suffix:semicolon
r_int
r_char
id|c_status
op_assign
id|inb
c_func
(paren
id|VIADEV_REG
c_func
(paren
id|viadev
comma
id|OFFSET_STATUS
)paren
)paren
suffix:semicolon
id|c_status
op_and_assign
(paren
id|VIA_REG_STAT_EOL
op_or
id|VIA_REG_STAT_FLAG
op_or
id|VIA_REG_STAT_STOPPED
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c_status
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|viadev-&gt;substream
op_logical_and
id|viadev-&gt;running
)paren
(brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|snd_pcm_period_elapsed
c_func
(paren
id|viadev-&gt;substream
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
)brace
id|outb
c_func
(paren
id|c_status
comma
id|VIADEV_REG
c_func
(paren
id|viadev
comma
id|OFFSET_STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* ack */
)brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
multiline_comment|/*&n; *  PCM callbacks&n; */
multiline_comment|/*&n; * trigger callback&n; */
DECL|function|snd_via82xx_pcm_trigger
r_static
r_int
id|snd_via82xx_pcm_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|via82xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|viadev_t
op_star
id|viadev
op_assign
(paren
id|viadev_t
op_star
)paren
id|substream-&gt;runtime-&gt;private_data
suffix:semicolon
r_int
r_char
id|val
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
id|val
op_or_assign
id|VIA_REG_CTRL_START
suffix:semicolon
id|viadev-&gt;running
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
id|val
op_assign
id|VIA_REG_CTRL_TERMINATE
suffix:semicolon
id|viadev-&gt;running
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_PUSH
suffix:colon
id|val
op_or_assign
id|VIA_REG_CTRL_PAUSE
suffix:semicolon
id|viadev-&gt;running
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_RELEASE
suffix:colon
id|viadev-&gt;running
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|outb
c_func
(paren
id|val
comma
id|VIADEV_REG
c_func
(paren
id|viadev
comma
id|OFFSET_CONTROL
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_STOP
)paren
id|snd_via82xx_channel_reset
c_func
(paren
id|chip
comma
id|viadev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_via82xx_modem_pcm_trigger
r_static
r_int
id|snd_via82xx_modem_pcm_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|via82xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|val
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
id|val
op_assign
id|snd_ac97_read
c_func
(paren
id|chip-&gt;ac97
comma
id|AC97_GPIO_STATUS
)paren
suffix:semicolon
id|outl
c_func
(paren
id|val
op_or
id|AC97_GPIO_LINE1_OH
comma
id|VIAREG
c_func
(paren
id|chip
comma
id|GPI_STATUS
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
id|val
op_assign
id|snd_ac97_read
c_func
(paren
id|chip-&gt;ac97
comma
id|AC97_GPIO_STATUS
)paren
suffix:semicolon
id|outl
c_func
(paren
id|val
op_amp
op_complement
id|AC97_GPIO_LINE1_OH
comma
id|VIAREG
c_func
(paren
id|chip
comma
id|GPI_STATUS
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
id|snd_via82xx_pcm_trigger
c_func
(paren
id|substream
comma
id|cmd
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * pointer callbacks&n; */
multiline_comment|/*&n; * calculate the linear position at the given sg-buffer index and the rest count&n; */
DECL|macro|check_invalid_pos
mdefine_line|#define check_invalid_pos(viadev,pos) &bslash;&n;&t;((pos) &lt; viadev-&gt;lastpos &amp;&amp; ((pos) &gt;= viadev-&gt;bufsize2 || viadev-&gt;lastpos &lt; viadev-&gt;bufsize2))
DECL|function|calc_linear_pos
r_static
r_inline
r_int
r_int
id|calc_linear_pos
c_func
(paren
id|viadev_t
op_star
id|viadev
comma
r_int
r_int
id|idx
comma
r_int
r_int
id|count
)paren
(brace
r_int
r_int
id|size
comma
id|res
suffix:semicolon
id|size
op_assign
id|viadev-&gt;idx_table
(braket
id|idx
)braket
dot
id|size
suffix:semicolon
id|res
op_assign
id|viadev-&gt;idx_table
(braket
id|idx
)braket
dot
id|offset
op_plus
id|size
op_minus
id|count
suffix:semicolon
multiline_comment|/* check the validity of the calculated position */
r_if
c_cond
(paren
id|size
OL
id|count
)paren
(brace
id|snd_printd
c_func
(paren
id|KERN_ERR
l_string|&quot;invalid via82xx_cur_ptr (size = %d, count = %d)&bslash;n&quot;
comma
(paren
r_int
)paren
id|size
comma
(paren
r_int
)paren
id|count
)paren
suffix:semicolon
id|res
op_assign
id|viadev-&gt;lastpos
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|check_invalid_pos
c_func
(paren
id|viadev
comma
id|res
)paren
)paren
(brace
macro_line|#ifdef POINTER_DEBUG
id|printk
c_func
(paren
l_string|&quot;fail: idx = %i/%i, lastpos = 0x%x, bufsize2 = 0x%x, offsize = 0x%x, size = 0x%x, count = 0x%x&bslash;n&quot;
comma
id|idx
comma
id|viadev-&gt;tbl_entries
comma
id|viadev-&gt;lastpos
comma
id|viadev-&gt;bufsize2
comma
id|viadev-&gt;idx_table
(braket
id|idx
)braket
dot
id|offset
comma
id|viadev-&gt;idx_table
(braket
id|idx
)braket
dot
id|size
comma
id|count
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|count
op_logical_and
id|size
OL
id|count
)paren
(brace
id|snd_printd
c_func
(paren
id|KERN_ERR
l_string|&quot;invalid via82xx_cur_ptr, using last valid pointer&bslash;n&quot;
)paren
suffix:semicolon
id|res
op_assign
id|viadev-&gt;lastpos
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|count
)paren
multiline_comment|/* bogus count 0 on the DMA boundary? */
id|res
op_assign
id|viadev-&gt;idx_table
(braket
id|idx
)braket
dot
id|offset
suffix:semicolon
r_else
multiline_comment|/* count register returns full size when end of buffer is reached */
id|res
op_assign
id|viadev-&gt;idx_table
(braket
id|idx
)braket
dot
id|offset
op_plus
id|size
suffix:semicolon
r_if
c_cond
(paren
id|check_invalid_pos
c_func
(paren
id|viadev
comma
id|res
)paren
)paren
(brace
id|snd_printd
c_func
(paren
id|KERN_ERR
l_string|&quot;invalid via82xx_cur_ptr (2), using last valid pointer&bslash;n&quot;
)paren
suffix:semicolon
id|res
op_assign
id|viadev-&gt;lastpos
suffix:semicolon
)brace
)brace
)brace
id|viadev-&gt;lastpos
op_assign
id|res
suffix:semicolon
multiline_comment|/* remember the last position */
r_if
c_cond
(paren
id|res
op_ge
id|viadev-&gt;bufsize
)paren
id|res
op_sub_assign
id|viadev-&gt;bufsize
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
multiline_comment|/*&n; * get the current pointer on via686&n; */
DECL|function|snd_via686_pcm_pointer
r_static
id|snd_pcm_uframes_t
id|snd_via686_pcm_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|via82xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|viadev_t
op_star
id|viadev
op_assign
(paren
id|viadev_t
op_star
)paren
id|substream-&gt;runtime-&gt;private_data
suffix:semicolon
r_int
r_int
id|idx
comma
id|ptr
comma
id|count
comma
id|res
suffix:semicolon
id|snd_assert
c_func
(paren
id|viadev-&gt;tbl_entries
comma
r_return
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|inb
c_func
(paren
id|VIADEV_REG
c_func
(paren
id|viadev
comma
id|OFFSET_STATUS
)paren
)paren
op_amp
id|VIA_REG_STAT_ACTIVE
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|count
op_assign
id|inl
c_func
(paren
id|VIADEV_REG
c_func
(paren
id|viadev
comma
id|OFFSET_CURR_COUNT
)paren
)paren
op_amp
l_int|0xffffff
suffix:semicolon
multiline_comment|/* The via686a does not have the current index register,&n;&t; * so we need to calculate the index from CURR_PTR.&n;&t; */
id|ptr
op_assign
id|inl
c_func
(paren
id|VIADEV_REG
c_func
(paren
id|viadev
comma
id|OFFSET_CURR_PTR
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr
op_le
(paren
r_int
r_int
)paren
id|viadev-&gt;table.addr
)paren
id|idx
op_assign
l_int|0
suffix:semicolon
r_else
multiline_comment|/* CURR_PTR holds the address + 8 */
id|idx
op_assign
(paren
(paren
id|ptr
op_minus
(paren
r_int
r_int
)paren
id|viadev-&gt;table.addr
)paren
op_div
l_int|8
op_minus
l_int|1
)paren
op_mod
id|viadev-&gt;tbl_entries
suffix:semicolon
id|res
op_assign
id|calc_linear_pos
c_func
(paren
id|viadev
comma
id|idx
comma
id|count
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|res
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * hw_params callback:&n; * allocate the buffer and build up the buffer description table&n; */
DECL|function|snd_via82xx_hw_params
r_static
r_int
id|snd_via82xx_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
id|via82xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|viadev_t
op_star
id|viadev
op_assign
(paren
id|viadev_t
op_star
)paren
id|substream-&gt;runtime-&gt;private_data
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|err
op_assign
id|build_via_table
c_func
(paren
id|viadev
comma
id|substream
comma
id|chip-&gt;pci
comma
id|params_periods
c_func
(paren
id|hw_params
)paren
comma
id|params_period_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_ac97_write
c_func
(paren
id|chip-&gt;ac97
comma
id|AC97_LINE1_RATE
comma
id|params_rate
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
id|snd_ac97_write
c_func
(paren
id|chip-&gt;ac97
comma
id|AC97_LINE1_LEVEL
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * hw_free callback:&n; * clean up the buffer description table and release the buffer&n; */
DECL|function|snd_via82xx_hw_free
r_static
r_int
id|snd_via82xx_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|via82xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|viadev_t
op_star
id|viadev
op_assign
(paren
id|viadev_t
op_star
)paren
id|substream-&gt;runtime-&gt;private_data
suffix:semicolon
id|clean_via_table
c_func
(paren
id|viadev
comma
id|substream
comma
id|chip-&gt;pci
)paren
suffix:semicolon
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * set up the table pointer&n; */
DECL|function|snd_via82xx_set_table_ptr
r_static
r_void
id|snd_via82xx_set_table_ptr
c_func
(paren
id|via82xx_t
op_star
id|chip
comma
id|viadev_t
op_star
id|viadev
)paren
(brace
id|snd_via82xx_codec_ready
c_func
(paren
id|chip
comma
id|chip-&gt;ac97_secondary
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|u32
)paren
id|viadev-&gt;table.addr
comma
id|VIADEV_REG
c_func
(paren
id|viadev
comma
id|OFFSET_TABLE_PTR
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|snd_via82xx_codec_ready
c_func
(paren
id|chip
comma
id|chip-&gt;ac97_secondary
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * prepare callback for playback and capture&n; */
DECL|function|snd_via82xx_pcm_prepare
r_static
r_int
id|snd_via82xx_pcm_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|via82xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|viadev_t
op_star
id|viadev
op_assign
(paren
id|viadev_t
op_star
)paren
id|substream-&gt;runtime-&gt;private_data
suffix:semicolon
id|snd_via82xx_channel_reset
c_func
(paren
id|chip
comma
id|viadev
)paren
suffix:semicolon
multiline_comment|/* this must be set after channel_reset */
id|snd_via82xx_set_table_ptr
c_func
(paren
id|chip
comma
id|viadev
)paren
suffix:semicolon
id|outb
c_func
(paren
id|VIA_REG_TYPE_AUTOSTART
op_or
id|VIA_REG_TYPE_INT_EOL
op_or
id|VIA_REG_TYPE_INT_FLAG
comma
id|VIADEV_REG
c_func
(paren
id|viadev
comma
id|OFFSET_TYPE
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * pcm hardware definition, identical for both playback and capture&n; */
DECL|variable|snd_via82xx_hw
r_static
id|snd_pcm_hardware_t
id|snd_via82xx_hw
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_RESUME
op_or
id|SNDRV_PCM_INFO_PAUSE
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_8000
op_or
id|SNDRV_PCM_RATE_16000
op_or
id|SNDRV_PCM_RATE_KNOT
comma
dot
id|rate_min
op_assign
l_int|8000
comma
dot
id|rate_max
op_assign
l_int|16000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|1
comma
dot
id|buffer_bytes_max
op_assign
l_int|128
op_star
l_int|1024
comma
dot
id|period_bytes_min
op_assign
l_int|32
comma
dot
id|period_bytes_max
op_assign
l_int|128
op_star
l_int|1024
comma
dot
id|periods_min
op_assign
l_int|2
comma
dot
id|periods_max
op_assign
id|VIA_TABLE_SIZE
op_div
l_int|2
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * open callback skeleton&n; */
DECL|function|snd_via82xx_modem_pcm_open
r_static
r_int
id|snd_via82xx_modem_pcm_open
c_func
(paren
id|via82xx_t
op_star
id|chip
comma
id|viadev_t
op_star
id|viadev
comma
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
r_static
r_int
r_int
id|rates
(braket
)braket
op_assign
(brace
l_int|8000
comma
l_int|9600
comma
l_int|12000
comma
l_int|16000
)brace
suffix:semicolon
r_static
id|snd_pcm_hw_constraint_list_t
id|hw_constraints_rates
op_assign
(brace
dot
id|count
op_assign
id|ARRAY_SIZE
c_func
(paren
id|rates
)paren
comma
dot
id|list
op_assign
id|rates
comma
dot
id|mask
op_assign
l_int|0
comma
)brace
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_via82xx_hw
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_list
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
op_amp
id|hw_constraints_rates
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* we may remove following constaint when we modify table entries&n;&t;   in interrupt */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_integer
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_PERIODS
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|runtime-&gt;private_data
op_assign
id|viadev
suffix:semicolon
id|viadev-&gt;substream
op_assign
id|substream
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * open callback for playback&n; */
DECL|function|snd_via82xx_playback_open
r_static
r_int
id|snd_via82xx_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|via82xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|viadev_t
op_star
id|viadev
op_assign
op_amp
id|chip-&gt;devs
(braket
id|chip-&gt;playback_devno
op_plus
id|substream-&gt;number
)braket
suffix:semicolon
r_return
id|snd_via82xx_modem_pcm_open
c_func
(paren
id|chip
comma
id|viadev
comma
id|substream
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * open callback for capture&n; */
DECL|function|snd_via82xx_capture_open
r_static
r_int
id|snd_via82xx_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|via82xx_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|viadev_t
op_star
id|viadev
op_assign
op_amp
id|chip-&gt;devs
(braket
id|chip-&gt;capture_devno
op_plus
id|substream-&gt;pcm-&gt;device
)braket
suffix:semicolon
r_return
id|snd_via82xx_modem_pcm_open
c_func
(paren
id|chip
comma
id|viadev
comma
id|substream
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * close callback&n; */
DECL|function|snd_via82xx_pcm_close
r_static
r_int
id|snd_via82xx_pcm_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|viadev_t
op_star
id|viadev
op_assign
(paren
id|viadev_t
op_star
)paren
id|substream-&gt;runtime-&gt;private_data
suffix:semicolon
id|viadev-&gt;substream
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* via686 playback callbacks */
DECL|variable|snd_via686_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_via686_playback_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_via82xx_playback_open
comma
dot
id|close
op_assign
id|snd_via82xx_pcm_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_via82xx_hw_params
comma
dot
id|hw_free
op_assign
id|snd_via82xx_hw_free
comma
dot
id|prepare
op_assign
id|snd_via82xx_pcm_prepare
comma
dot
id|trigger
op_assign
id|snd_via82xx_modem_pcm_trigger
comma
dot
id|pointer
op_assign
id|snd_via686_pcm_pointer
comma
dot
id|page
op_assign
id|snd_pcm_sgbuf_ops_page
comma
)brace
suffix:semicolon
multiline_comment|/* via686 capture callbacks */
DECL|variable|snd_via686_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_via686_capture_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_via82xx_capture_open
comma
dot
id|close
op_assign
id|snd_via82xx_pcm_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_via82xx_hw_params
comma
dot
id|hw_free
op_assign
id|snd_via82xx_hw_free
comma
dot
id|prepare
op_assign
id|snd_via82xx_pcm_prepare
comma
dot
id|trigger
op_assign
id|snd_via82xx_modem_pcm_trigger
comma
dot
id|pointer
op_assign
id|snd_via686_pcm_pointer
comma
dot
id|page
op_assign
id|snd_pcm_sgbuf_ops_page
comma
)brace
suffix:semicolon
DECL|function|init_viadev
r_static
r_void
id|init_viadev
c_func
(paren
id|via82xx_t
op_star
id|chip
comma
r_int
id|idx
comma
r_int
r_int
id|reg_offset
comma
r_int
id|direction
)paren
(brace
id|chip-&gt;devs
(braket
id|idx
)braket
dot
id|reg_offset
op_assign
id|reg_offset
suffix:semicolon
id|chip-&gt;devs
(braket
id|idx
)braket
dot
id|direction
op_assign
id|direction
suffix:semicolon
id|chip-&gt;devs
(braket
id|idx
)braket
dot
id|port
op_assign
id|chip-&gt;port
op_plus
id|reg_offset
suffix:semicolon
)brace
multiline_comment|/*&n; * create a pcm instance for via686a/b&n; */
DECL|function|snd_via686_pcm_new
r_static
r_int
id|__devinit
id|snd_via686_pcm_new
c_func
(paren
id|via82xx_t
op_star
id|chip
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
id|chip-&gt;playback_devno
op_assign
l_int|0
suffix:semicolon
id|chip-&gt;capture_devno
op_assign
l_int|1
suffix:semicolon
id|chip-&gt;num_devs
op_assign
l_int|2
suffix:semicolon
id|chip-&gt;intr_mask
op_assign
l_int|0x330000
suffix:semicolon
multiline_comment|/* FLAGS | EOL for MR, MW */
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|chip-&gt;card
comma
id|chip-&gt;card-&gt;shortname
comma
l_int|0
comma
l_int|1
comma
l_int|1
comma
op_amp
id|pcm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_via686_playback_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_via686_capture_ops
)paren
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
id|chip-&gt;card-&gt;shortname
)paren
suffix:semicolon
id|chip-&gt;pcms
(braket
l_int|0
)braket
op_assign
id|pcm
suffix:semicolon
id|init_viadev
c_func
(paren
id|chip
comma
l_int|0
comma
id|VIA_REG_MO_STATUS
comma
l_int|0
)paren
suffix:semicolon
id|init_viadev
c_func
(paren
id|chip
comma
l_int|1
comma
id|VIA_REG_MI_STATUS
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_lib_preallocate_pages_for_all
c_func
(paren
id|pcm
comma
id|SNDRV_DMA_TYPE_DEV_SG
comma
id|snd_dma_pci_data
c_func
(paren
id|chip-&gt;pci
)paren
comma
l_int|64
op_star
l_int|1024
comma
l_int|128
op_star
l_int|1024
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Mixer part&n; */
DECL|function|snd_via82xx_mixer_free_ac97_bus
r_static
r_void
id|snd_via82xx_mixer_free_ac97_bus
c_func
(paren
id|ac97_bus_t
op_star
id|bus
)paren
(brace
id|via82xx_t
op_star
id|chip
op_assign
id|bus-&gt;private_data
suffix:semicolon
id|chip-&gt;ac97_bus
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|snd_via82xx_mixer_free_ac97
r_static
r_void
id|snd_via82xx_mixer_free_ac97
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
id|via82xx_t
op_star
id|chip
op_assign
id|ac97-&gt;private_data
suffix:semicolon
id|chip-&gt;ac97
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|snd_via82xx_mixer_new
r_static
r_int
id|__devinit
id|snd_via82xx_mixer_new
c_func
(paren
id|via82xx_t
op_star
id|chip
)paren
(brace
id|ac97_template_t
id|ac97
suffix:semicolon
r_int
id|err
suffix:semicolon
r_static
id|ac97_bus_ops_t
id|ops
op_assign
(brace
dot
id|write
op_assign
id|snd_via82xx_codec_write
comma
dot
id|read
op_assign
id|snd_via82xx_codec_read
comma
dot
id|wait
op_assign
id|snd_via82xx_codec_wait
comma
)brace
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_bus
c_func
(paren
id|chip-&gt;card
comma
l_int|0
comma
op_amp
id|ops
comma
id|chip
comma
op_amp
id|chip-&gt;ac97_bus
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|chip-&gt;ac97_bus-&gt;private_free
op_assign
id|snd_via82xx_mixer_free_ac97_bus
suffix:semicolon
id|chip-&gt;ac97_bus-&gt;clock
op_assign
id|chip-&gt;ac97_clock
suffix:semicolon
id|chip-&gt;ac97_bus-&gt;shared_type
op_assign
id|AC97_SHARED_TYPE_VIA
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ac97
comma
l_int|0
comma
r_sizeof
(paren
id|ac97
)paren
)paren
suffix:semicolon
id|ac97.private_data
op_assign
id|chip
suffix:semicolon
id|ac97.private_free
op_assign
id|snd_via82xx_mixer_free_ac97
suffix:semicolon
id|ac97.pci
op_assign
id|chip-&gt;pci
suffix:semicolon
id|ac97.scaps
op_assign
id|AC97_SCAP_SKIP_AUDIO
suffix:semicolon
id|ac97.num
op_assign
id|chip-&gt;ac97_secondary
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_mixer
c_func
(paren
id|chip-&gt;ac97_bus
comma
op_amp
id|ac97
comma
op_amp
id|chip-&gt;ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * proc interface&n; */
DECL|function|snd_via82xx_proc_read
r_static
r_void
id|snd_via82xx_proc_read
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|via82xx_t
op_star
id|chip
op_assign
id|entry-&gt;private_data
suffix:semicolon
r_int
id|i
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%s&bslash;n&bslash;n&quot;
comma
id|chip-&gt;card-&gt;longname
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0xa0
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%02x: %08x&bslash;n&quot;
comma
id|i
comma
id|inl
c_func
(paren
id|chip-&gt;port
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_via82xx_proc_init
r_static
r_void
id|__devinit
id|snd_via82xx_proc_init
c_func
(paren
id|via82xx_t
op_star
id|chip
)paren
(brace
id|snd_info_entry_t
op_star
id|entry
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_card_proc_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;via82xx&quot;
comma
op_amp
id|entry
)paren
)paren
id|snd_info_set_text_ops
c_func
(paren
id|entry
comma
id|chip
comma
l_int|1024
comma
id|snd_via82xx_proc_read
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&n; */
DECL|function|snd_via82xx_chip_init
r_static
r_int
id|__devinit
id|snd_via82xx_chip_init
c_func
(paren
id|via82xx_t
op_star
id|chip
)paren
(brace
id|ac97_t
id|ac97
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|max_count
suffix:semicolon
r_int
r_char
id|pval
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ac97
comma
l_int|0
comma
r_sizeof
(paren
id|ac97
)paren
)paren
suffix:semicolon
id|ac97.private_data
op_assign
id|chip
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|chip-&gt;pci
comma
id|VIA_MC97_CTRL
comma
op_amp
id|pval
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pval
op_amp
id|VIA_MC97_CTRL_INIT
)paren
op_ne
id|VIA_MC97_CTRL_INIT
)paren
(brace
id|pci_write_config_byte
c_func
(paren
id|chip-&gt;pci
comma
l_int|0x44
comma
id|pval
op_or
id|VIA_MC97_CTRL_INIT
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
id|pci_read_config_byte
c_func
(paren
id|chip-&gt;pci
comma
id|VIA_ACLINK_STAT
comma
op_amp
id|pval
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|pval
op_amp
id|VIA_ACLINK_C00_READY
)paren
)paren
(brace
multiline_comment|/* codec not ready? */
multiline_comment|/* deassert ACLink reset, force SYNC */
id|pci_write_config_byte
c_func
(paren
id|chip-&gt;pci
comma
id|VIA_ACLINK_CTRL
comma
id|VIA_ACLINK_CTRL_ENABLE
op_or
id|VIA_ACLINK_CTRL_RESET
op_or
id|VIA_ACLINK_CTRL_SYNC
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
macro_line|#if 1 /* FIXME: should we do full reset here for all chip models? */
id|pci_write_config_byte
c_func
(paren
id|chip-&gt;pci
comma
id|VIA_ACLINK_CTRL
comma
l_int|0x00
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
macro_line|#else
multiline_comment|/* deassert ACLink reset, force SYNC (warm AC&squot;97 reset) */
id|pci_write_config_byte
c_func
(paren
id|chip-&gt;pci
comma
id|VIA_ACLINK_CTRL
comma
id|VIA_ACLINK_CTRL_RESET
op_or
id|VIA_ACLINK_CTRL_SYNC
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|2
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* ACLink on, deassert ACLink reset, VSR, SGD data out */
id|pci_write_config_byte
c_func
(paren
id|chip-&gt;pci
comma
id|VIA_ACLINK_CTRL
comma
id|VIA_ACLINK_CTRL_INIT
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
id|pci_read_config_byte
c_func
(paren
id|chip-&gt;pci
comma
id|VIA_ACLINK_CTRL
comma
op_amp
id|pval
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pval
op_amp
id|VIA_ACLINK_CTRL_INIT
)paren
op_ne
id|VIA_ACLINK_CTRL_INIT
)paren
(brace
multiline_comment|/* ACLink on, deassert ACLink reset, VSR, SGD data out */
id|pci_write_config_byte
c_func
(paren
id|chip-&gt;pci
comma
id|VIA_ACLINK_CTRL
comma
id|VIA_ACLINK_CTRL_INIT
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
multiline_comment|/* wait until codec ready */
id|max_count
op_assign
(paren
(paren
l_int|3
op_star
id|HZ
)paren
op_div
l_int|4
)paren
op_plus
l_int|1
suffix:semicolon
r_do
(brace
id|pci_read_config_byte
c_func
(paren
id|chip-&gt;pci
comma
id|VIA_ACLINK_STAT
comma
op_amp
id|pval
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pval
op_amp
id|VIA_ACLINK_C00_READY
)paren
multiline_comment|/* primary codec ready */
r_break
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|max_count
OG
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_assign
id|snd_via82xx_codec_xread
c_func
(paren
id|chip
)paren
)paren
op_amp
id|VIA_REG_AC97_BUSY
)paren
id|snd_printk
c_func
(paren
l_string|&quot;AC&squot;97 codec is not ready [0x%x]&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
multiline_comment|/* and then reset codec.. */
macro_line|#if 0 /* do we need it? when? */
id|snd_via82xx_codec_ready
c_func
(paren
id|chip
comma
l_int|0
)paren
suffix:semicolon
id|snd_via82xx_codec_write
c_func
(paren
op_amp
id|ac97
comma
id|AC97_RESET
comma
l_int|0x0000
)paren
suffix:semicolon
id|snd_via82xx_codec_read
c_func
(paren
op_amp
id|ac97
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|snd_via82xx_codec_xwrite
c_func
(paren
id|chip
comma
id|VIA_REG_AC97_READ
op_or
id|VIA_REG_AC97_SECONDARY_VALID
op_or
(paren
id|VIA_REG_AC97_CODEC_ID_SECONDARY
op_lshift
id|VIA_REG_AC97_CODEC_ID_SHIFT
)paren
)paren
suffix:semicolon
id|max_count
op_assign
(paren
(paren
l_int|3
op_star
id|HZ
)paren
op_div
l_int|4
)paren
op_plus
l_int|1
suffix:semicolon
id|snd_via82xx_codec_xwrite
c_func
(paren
id|chip
comma
id|VIA_REG_AC97_READ
op_or
id|VIA_REG_AC97_SECONDARY_VALID
op_or
(paren
id|VIA_REG_AC97_CODEC_ID_SECONDARY
op_lshift
id|VIA_REG_AC97_CODEC_ID_SHIFT
)paren
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|val
op_assign
id|snd_via82xx_codec_xread
c_func
(paren
id|chip
)paren
)paren
op_amp
id|VIA_REG_AC97_SECONDARY_VALID
)paren
(brace
id|chip-&gt;ac97_secondary
op_assign
l_int|1
suffix:semicolon
r_goto
id|__ac97_ok2
suffix:semicolon
)brace
id|set_current_state
c_func
(paren
id|TASK_INTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|max_count
OG
l_int|0
)paren
suffix:semicolon
multiline_comment|/* This is ok, the most of motherboards have only one codec */
id|__ac97_ok2
suffix:colon
multiline_comment|/* route FM trap to IRQ, disable FM trap */
singleline_comment|// pci_write_config_byte(chip-&gt;pci, VIA_FM_NMI_CTRL, 0);
multiline_comment|/* disable all GPI interrupts */
id|outl
c_func
(paren
l_int|0
comma
id|VIAREG
c_func
(paren
id|chip
comma
id|GPI_INTR
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PM
multiline_comment|/*&n; * power management&n; */
DECL|function|snd_via82xx_suspend
r_static
r_int
id|snd_via82xx_suspend
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_int
r_int
id|state
)paren
(brace
id|via82xx_t
op_star
id|chip
op_assign
id|card-&gt;pm_private_data
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|chip-&gt;pcms
(braket
id|i
)braket
)paren
id|snd_pcm_suspend_all
c_func
(paren
id|chip-&gt;pcms
(braket
id|i
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|chip-&gt;num_devs
suffix:semicolon
id|i
op_increment
)paren
id|snd_via82xx_channel_reset
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;devs
(braket
id|i
)braket
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
id|chip-&gt;irq
)paren
suffix:semicolon
id|snd_ac97_suspend
c_func
(paren
id|chip-&gt;ac97
)paren
suffix:semicolon
id|pci_set_power_state
c_func
(paren
id|chip-&gt;pci
comma
l_int|3
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|chip-&gt;pci
)paren
suffix:semicolon
id|snd_power_change_state
c_func
(paren
id|card
comma
id|SNDRV_CTL_POWER_D3hot
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_via82xx_resume
r_static
r_int
id|snd_via82xx_resume
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_int
r_int
id|state
)paren
(brace
id|via82xx_t
op_star
id|chip
op_assign
id|card-&gt;pm_private_data
suffix:semicolon
r_int
id|i
suffix:semicolon
id|pci_enable_device
c_func
(paren
id|chip-&gt;pci
)paren
suffix:semicolon
id|pci_set_power_state
c_func
(paren
id|chip-&gt;pci
comma
l_int|0
)paren
suffix:semicolon
id|pci_set_master
c_func
(paren
id|chip-&gt;pci
)paren
suffix:semicolon
id|snd_via82xx_chip_init
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_ac97_resume
c_func
(paren
id|chip-&gt;ac97
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|chip-&gt;num_devs
suffix:semicolon
id|i
op_increment
)paren
id|snd_via82xx_channel_reset
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;devs
(braket
id|i
)braket
)paren
suffix:semicolon
id|snd_power_change_state
c_func
(paren
id|card
comma
id|SNDRV_CTL_POWER_D0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PM */
DECL|function|snd_via82xx_free
r_static
r_int
id|snd_via82xx_free
c_func
(paren
id|via82xx_t
op_star
id|chip
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;irq
OL
l_int|0
)paren
r_goto
id|__end_hw
suffix:semicolon
multiline_comment|/* disable interrupts */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|chip-&gt;num_devs
suffix:semicolon
id|i
op_increment
)paren
id|snd_via82xx_channel_reset
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;devs
(braket
id|i
)braket
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
id|chip-&gt;irq
)paren
suffix:semicolon
id|__end_hw
suffix:colon
r_if
c_cond
(paren
id|chip-&gt;irq
op_ge
l_int|0
)paren
id|free_irq
c_func
(paren
id|chip-&gt;irq
comma
(paren
r_void
op_star
)paren
id|chip
)paren
suffix:semicolon
id|pci_release_regions
c_func
(paren
id|chip-&gt;pci
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|chip-&gt;pci
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_via82xx_dev_free
r_static
r_int
id|snd_via82xx_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|via82xx_t
op_star
id|chip
op_assign
id|device-&gt;device_data
suffix:semicolon
r_return
id|snd_via82xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
DECL|function|snd_via82xx_create
r_static
r_int
id|__devinit
id|snd_via82xx_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_struct
id|pci_dev
op_star
id|pci
comma
r_int
id|chip_type
comma
r_int
id|revision
comma
r_int
r_int
id|ac97_clock
comma
id|via82xx_t
op_star
op_star
id|r_via
)paren
(brace
id|via82xx_t
op_star
id|chip
suffix:semicolon
r_int
id|err
suffix:semicolon
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
dot
id|dev_free
op_assign
id|snd_via82xx_dev_free
comma
)brace
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pci
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chip
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|chip
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|pci_disable_device
c_func
(paren
id|pci
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|spin_lock_init
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|chip-&gt;ac97_lock
)paren
suffix:semicolon
id|chip-&gt;card
op_assign
id|card
suffix:semicolon
id|chip-&gt;pci
op_assign
id|pci
suffix:semicolon
id|chip-&gt;irq
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_request_regions
c_func
(paren
id|pci
comma
id|card-&gt;driver
)paren
)paren
OL
l_int|0
)paren
(brace
id|kfree
c_func
(paren
id|chip
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pci
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|chip-&gt;port
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|pci-&gt;irq
comma
id|snd_via82xx_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
id|card-&gt;driver
comma
(paren
r_void
op_star
)paren
id|chip
)paren
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab IRQ %d&bslash;n&quot;
comma
id|pci-&gt;irq
)paren
suffix:semicolon
id|snd_via82xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|chip-&gt;irq
op_assign
id|pci-&gt;irq
suffix:semicolon
r_if
c_cond
(paren
id|ac97_clock
op_ge
l_int|8000
op_logical_and
id|ac97_clock
op_le
l_int|48000
)paren
id|chip-&gt;ac97_clock
op_assign
id|ac97_clock
suffix:semicolon
id|synchronize_irq
c_func
(paren
id|chip-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_via82xx_chip_init
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_via82xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|chip
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_via82xx_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* The 8233 ac97 controller does not implement the master bit&n;&t; * in the pci command register. IMHO this is a violation of the PCI spec.&n;&t; * We call pci_set_master here because it does not hurt. */
id|pci_set_master
c_func
(paren
id|pci
)paren
suffix:semicolon
id|snd_card_set_dev
c_func
(paren
id|card
comma
op_amp
id|pci-&gt;dev
)paren
suffix:semicolon
op_star
id|r_via
op_assign
id|chip
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_via82xx_probe
r_static
r_int
id|__devinit
id|snd_via82xx_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_const
r_struct
id|pci_device_id
op_star
id|pci_id
)paren
(brace
r_static
r_int
id|dev
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
id|via82xx_t
op_star
id|chip
suffix:semicolon
r_int
r_char
id|revision
suffix:semicolon
r_int
id|chip_type
op_assign
l_int|0
comma
id|card_type
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_ge
id|SNDRV_CARDS
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|enable
(braket
id|dev
)braket
)paren
(brace
id|dev
op_increment
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|card
op_assign
id|snd_card_new
c_func
(paren
id|index
(braket
id|dev
)braket
comma
id|id
(braket
id|dev
)braket
comma
id|THIS_MODULE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|card_type
op_assign
id|pci_id-&gt;driver_data
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pci
comma
id|PCI_REVISION_ID
comma
op_amp
id|revision
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|card_type
)paren
(brace
r_case
id|TYPE_CARD_VIA82XX_MODEM
suffix:colon
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;VIA82XX-MODEM&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;shortname
comma
l_string|&quot;VIA 82XX modem&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;invalid card type %d&bslash;n&quot;
comma
id|card_type
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|__error
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_via82xx_create
c_func
(paren
id|card
comma
id|pci
comma
id|chip_type
comma
id|revision
comma
id|ac97_clock
(braket
id|dev
)braket
comma
op_amp
id|chip
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_via82xx_mixer_new
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_via686_pcm_new
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__error
suffix:semicolon
id|snd_card_set_pm_callback
c_func
(paren
id|card
comma
id|snd_via82xx_suspend
comma
id|snd_via82xx_resume
comma
id|chip
)paren
suffix:semicolon
multiline_comment|/* disable interrupts */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|chip-&gt;num_devs
suffix:semicolon
id|i
op_increment
)paren
id|snd_via82xx_channel_reset
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;devs
(braket
id|i
)braket
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;%s at 0x%lx, irq %d&quot;
comma
id|card-&gt;shortname
comma
id|chip-&gt;port
comma
id|chip-&gt;irq
)paren
suffix:semicolon
id|snd_via82xx_proc_init
c_func
(paren
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_card_register
c_func
(paren
id|card
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pci
comma
id|card
)paren
suffix:semicolon
id|dev
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|__error
suffix:colon
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|snd_via82xx_remove
r_static
r_void
id|__devexit
id|snd_via82xx_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
id|snd_card_free
c_func
(paren
id|pci_get_drvdata
c_func
(paren
id|pci
)paren
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|driver
r_static
r_struct
id|pci_driver
id|driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;VIA 82xx Modem&quot;
comma
dot
id|id_table
op_assign
id|snd_via82xx_modem_ids
comma
dot
id|probe
op_assign
id|snd_via82xx_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|snd_via82xx_remove
)paren
comma
id|SND_PCI_PM_CALLBACKS
)brace
suffix:semicolon
DECL|function|alsa_card_via82xx_init
r_static
r_int
id|__init
id|alsa_card_via82xx_init
c_func
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
DECL|function|alsa_card_via82xx_exit
r_static
r_void
id|__exit
id|alsa_card_via82xx_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|alsa_card_via82xx_init
)paren
id|module_exit
c_func
(paren
id|alsa_card_via82xx_exit
)paren
eof
