multiline_comment|/*&n; *  The driver for the ForteMedia FM801 based soundcards&n; *  Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
macro_line|#include &lt;sound/ac97_codec.h&gt;
macro_line|#include &lt;sound/mpu401.h&gt;
macro_line|#include &lt;sound/opl3.h&gt;
DECL|macro|SNDRV_GET_ID
mdefine_line|#define SNDRV_GET_ID
macro_line|#include &lt;sound/initval.h&gt;
DECL|macro|chip_t
mdefine_line|#define chip_t fm801_t
id|EXPORT_NO_SYMBOLS
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jaroslav Kysela &lt;perex@suse.cz&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;ForteMedia FM801&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_CLASSES
c_func
(paren
l_string|&quot;{sound}&quot;
)paren
suffix:semicolon
id|MODULE_DEVICES
c_func
(paren
l_string|&quot;{{ForteMedia,FM801},&quot;
l_string|&quot;{Genius,SoundMaker Live 5.1}}&quot;
)paren
suffix:semicolon
DECL|variable|snd_index
r_static
r_int
id|snd_index
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_IDX
suffix:semicolon
multiline_comment|/* Index 0-MAX */
DECL|variable|snd_id
r_static
r_char
op_star
id|snd_id
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_STR
suffix:semicolon
multiline_comment|/* ID for this card */
DECL|variable|snd_enable
r_static
r_int
id|snd_enable
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_ENABLE_PNP
suffix:semicolon
multiline_comment|/* Enable this card */
id|MODULE_PARM
c_func
(paren
id|snd_index
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_index
comma
l_string|&quot;Index value for the FM801 soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_index
comma
id|SNDRV_INDEX_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_id
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_id
comma
l_string|&quot;ID string for the FM801 soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_id
comma
id|SNDRV_ID_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_enable
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_enable
comma
l_string|&quot;Enable FM801 soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_enable
comma
id|SNDRV_ENABLE_DESC
)paren
suffix:semicolon
multiline_comment|/*&n; *  Direct registers&n; */
DECL|macro|FM801_REG
mdefine_line|#define FM801_REG(chip, reg)&t;(chip-&gt;port + FM801_##reg)
DECL|macro|FM801_PCM_VOL
mdefine_line|#define FM801_PCM_VOL&t;&t;0x00&t;/* PCM Output Volume */
DECL|macro|FM801_FM_VOL
mdefine_line|#define FM801_FM_VOL&t;&t;0x02&t;/* FM Output Volume */
DECL|macro|FM801_I2S_VOL
mdefine_line|#define FM801_I2S_VOL&t;&t;0x04&t;/* I2S Volume */
DECL|macro|FM801_REC_SRC
mdefine_line|#define FM801_REC_SRC&t;&t;0x06&t;/* Record Source */
DECL|macro|FM801_PLY_CTRL
mdefine_line|#define FM801_PLY_CTRL&t;&t;0x08&t;/* Playback Control */
DECL|macro|FM801_PLY_COUNT
mdefine_line|#define FM801_PLY_COUNT&t;&t;0x0a&t;/* Playback Count */
DECL|macro|FM801_PLY_BUF1
mdefine_line|#define FM801_PLY_BUF1&t;&t;0x0c&t;/* Playback Bufer I */
DECL|macro|FM801_PLY_BUF2
mdefine_line|#define FM801_PLY_BUF2&t;&t;0x10&t;/* Playback Buffer II */
DECL|macro|FM801_CAP_CTRL
mdefine_line|#define FM801_CAP_CTRL&t;&t;0x14&t;/* Capture Control */
DECL|macro|FM801_CAP_COUNT
mdefine_line|#define FM801_CAP_COUNT&t;&t;0x16&t;/* Capture Count */
DECL|macro|FM801_CAP_BUF1
mdefine_line|#define FM801_CAP_BUF1&t;&t;0x18&t;/* Capture Buffer I */
DECL|macro|FM801_CAP_BUF2
mdefine_line|#define FM801_CAP_BUF2&t;&t;0x1c&t;/* Capture Buffer II */
DECL|macro|FM801_CODEC_CTRL
mdefine_line|#define FM801_CODEC_CTRL&t;0x22&t;/* Codec Control */
DECL|macro|FM801_I2S_MODE
mdefine_line|#define FM801_I2S_MODE&t;&t;0x24&t;/* I2S Mode Control */
DECL|macro|FM801_VOLUME
mdefine_line|#define FM801_VOLUME&t;&t;0x26&t;/* Volume Up/Down/Mute Status */
DECL|macro|FM801_I2C_CTRL
mdefine_line|#define FM801_I2C_CTRL&t;&t;0x29&t;/* I2C Control */
DECL|macro|FM801_AC97_CMD
mdefine_line|#define FM801_AC97_CMD&t;&t;0x2a&t;/* AC&squot;97 Command */
DECL|macro|FM801_AC97_DATA
mdefine_line|#define FM801_AC97_DATA&t;&t;0x2c&t;/* AC&squot;97 Data */
DECL|macro|FM801_MPU401_DATA
mdefine_line|#define FM801_MPU401_DATA&t;0x30&t;/* MPU401 Data */
DECL|macro|FM801_MPU401_CMD
mdefine_line|#define FM801_MPU401_CMD&t;0x31&t;/* MPU401 Command */
DECL|macro|FM801_GPIO_CTRL
mdefine_line|#define FM801_GPIO_CTRL&t;&t;0x52&t;/* General Purpose I/O Control */
DECL|macro|FM801_GEN_CTRL
mdefine_line|#define FM801_GEN_CTRL&t;&t;0x54&t;/* General Control */
DECL|macro|FM801_IRQ_MASK
mdefine_line|#define FM801_IRQ_MASK&t;&t;0x56&t;/* Interrupt Mask */
DECL|macro|FM801_IRQ_STATUS
mdefine_line|#define FM801_IRQ_STATUS&t;0x5a&t;/* Interrupt Status */
DECL|macro|FM801_OPL3_BANK0
mdefine_line|#define FM801_OPL3_BANK0&t;0x68&t;/* OPL3 Status Read / Bank 0 Write */
DECL|macro|FM801_OPL3_DATA0
mdefine_line|#define FM801_OPL3_DATA0&t;0x69&t;/* OPL3 Data 0 Write */
DECL|macro|FM801_OPL3_BANK1
mdefine_line|#define FM801_OPL3_BANK1&t;0x6a&t;/* OPL3 Bank 1 Write */
DECL|macro|FM801_OPL3_DATA1
mdefine_line|#define FM801_OPL3_DATA1&t;0x6b&t;/* OPL3 Bank 1 Write */
DECL|macro|FM801_POWERDOWN
mdefine_line|#define FM801_POWERDOWN&t;&t;0x70&t;/* Blocks Power Down Control */
DECL|macro|FM801_AC97_ADDR_SHIFT
mdefine_line|#define FM801_AC97_ADDR_SHIFT&t;10
multiline_comment|/* playback and record control register bits */
DECL|macro|FM801_BUF1_LAST
mdefine_line|#define FM801_BUF1_LAST&t;&t;(1&lt;&lt;1)
DECL|macro|FM801_BUF2_LAST
mdefine_line|#define FM801_BUF2_LAST&t;&t;(1&lt;&lt;2)
DECL|macro|FM801_START
mdefine_line|#define FM801_START&t;&t;(1&lt;&lt;5)
DECL|macro|FM801_PAUSE
mdefine_line|#define FM801_PAUSE&t;&t;(1&lt;&lt;6)
DECL|macro|FM801_IMMED_STOP
mdefine_line|#define FM801_IMMED_STOP&t;(1&lt;&lt;7)
DECL|macro|FM801_RATE_SHIFT
mdefine_line|#define FM801_RATE_SHIFT&t;8
DECL|macro|FM801_RATE_MASK
mdefine_line|#define FM801_RATE_MASK&t;&t;(15 &lt;&lt; FM801_RATE_SHIFT)
DECL|macro|FM801_CHANNELS_4
mdefine_line|#define FM801_CHANNELS_4&t;(1&lt;&lt;12)&t;/* playback only */
DECL|macro|FM801_CHANNELS_6
mdefine_line|#define FM801_CHANNELS_6&t;(2&lt;&lt;12)&t;/* playback only */
DECL|macro|FM801_CHANNELS_6MS
mdefine_line|#define FM801_CHANNELS_6MS&t;(3&lt;&lt;12)&t;/* playback only */
DECL|macro|FM801_CHANNELS_MASK
mdefine_line|#define FM801_CHANNELS_MASK&t;(3&lt;&lt;12)
DECL|macro|FM801_16BIT
mdefine_line|#define FM801_16BIT&t;&t;(1&lt;&lt;14)
DECL|macro|FM801_STEREO
mdefine_line|#define FM801_STEREO&t;&t;(1&lt;&lt;15)
multiline_comment|/* IRQ status bits */
DECL|macro|FM801_IRQ_PLAYBACK
mdefine_line|#define FM801_IRQ_PLAYBACK&t;(1&lt;&lt;8)
DECL|macro|FM801_IRQ_CAPTURE
mdefine_line|#define FM801_IRQ_CAPTURE&t;(1&lt;&lt;9)
DECL|macro|FM801_IRQ_VOLUME
mdefine_line|#define FM801_IRQ_VOLUME&t;(1&lt;&lt;14)
DECL|macro|FM801_IRQ_MPU
mdefine_line|#define FM801_IRQ_MPU&t;&t;(1&lt;&lt;15)
multiline_comment|/*&n;&n; */
DECL|typedef|fm801_t
r_typedef
r_struct
id|_snd_fm801
id|fm801_t
suffix:semicolon
DECL|struct|_snd_fm801
r_struct
id|_snd_fm801
(brace
DECL|member|irq
r_int
id|irq
suffix:semicolon
DECL|member|port
r_int
r_int
id|port
suffix:semicolon
multiline_comment|/* I/O port number */
DECL|member|res_port
r_struct
id|resource
op_star
id|res_port
suffix:semicolon
DECL|member|multichannel
r_int
r_int
id|multichannel
suffix:colon
l_int|1
comma
multiline_comment|/* multichannel support */
DECL|member|secondary
id|secondary
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* secondary codec */
DECL|member|secondary_addr
r_int
r_char
id|secondary_addr
suffix:semicolon
multiline_comment|/* addres of the secondary codec */
DECL|member|ply_ctrl
r_int
r_int
id|ply_ctrl
suffix:semicolon
multiline_comment|/* playback control */
DECL|member|cap_ctrl
r_int
r_int
id|cap_ctrl
suffix:semicolon
multiline_comment|/* capture control */
DECL|member|ply_buffer
r_int
r_int
id|ply_buffer
suffix:semicolon
DECL|member|ply_buf
r_int
r_int
id|ply_buf
suffix:semicolon
DECL|member|ply_count
r_int
r_int
id|ply_count
suffix:semicolon
DECL|member|ply_size
r_int
r_int
id|ply_size
suffix:semicolon
DECL|member|ply_pos
r_int
r_int
id|ply_pos
suffix:semicolon
DECL|member|cap_buffer
r_int
r_int
id|cap_buffer
suffix:semicolon
DECL|member|cap_buf
r_int
r_int
id|cap_buf
suffix:semicolon
DECL|member|cap_count
r_int
r_int
id|cap_count
suffix:semicolon
DECL|member|cap_size
r_int
r_int
id|cap_size
suffix:semicolon
DECL|member|cap_pos
r_int
r_int
id|cap_pos
suffix:semicolon
DECL|member|ac97
id|ac97_t
op_star
id|ac97
suffix:semicolon
DECL|member|ac97_sec
id|ac97_t
op_star
id|ac97_sec
suffix:semicolon
DECL|member|pci
r_struct
id|pci_dev
op_star
id|pci
suffix:semicolon
DECL|member|card
id|snd_card_t
op_star
id|card
suffix:semicolon
DECL|member|pcm
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
DECL|member|rmidi
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
DECL|member|playback_substream
id|snd_pcm_substream_t
op_star
id|playback_substream
suffix:semicolon
DECL|member|capture_substream
id|snd_pcm_substream_t
op_star
id|capture_substream
suffix:semicolon
DECL|member|p_dma_size
r_int
r_int
id|p_dma_size
suffix:semicolon
DECL|member|c_dma_size
r_int
r_int
id|c_dma_size
suffix:semicolon
DECL|member|reg_lock
id|spinlock_t
id|reg_lock
suffix:semicolon
DECL|member|proc_entry
id|snd_info_entry_t
op_star
id|proc_entry
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|snd_fm801_ids
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
l_int|0x1319
comma
l_int|0x0801
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
comma
multiline_comment|/* FM801 */
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|snd_fm801_ids
)paren
suffix:semicolon
multiline_comment|/*&n; *  common I/O routines&n; */
DECL|function|snd_fm801_update_bits
r_static
r_int
id|snd_fm801_update_bits
c_func
(paren
id|fm801_t
op_star
id|chip
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|mask
comma
r_int
r_int
id|value
)paren
(brace
r_int
id|change
suffix:semicolon
r_int
r_int
id|old
comma
r_new
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|old
op_assign
id|inw
c_func
(paren
id|chip-&gt;port
op_plus
id|reg
)paren
suffix:semicolon
r_new
op_assign
(paren
id|old
op_amp
op_complement
id|mask
)paren
op_or
id|value
suffix:semicolon
id|change
op_assign
id|old
op_ne
r_new
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
id|outw
c_func
(paren
r_new
comma
id|chip-&gt;port
op_plus
id|reg
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|function|snd_fm801_codec_write
r_static
r_void
id|snd_fm801_codec_write
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
id|fm801_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|fm801_t
comma
id|ac97-&gt;private_data
comma
r_return
)paren
suffix:semicolon
r_int
id|idx
suffix:semicolon
multiline_comment|/*&n;&t; *  Wait until the codec interface is not ready..&n;&t; */
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|100
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|inw
c_func
(paren
id|FM801_REG
c_func
(paren
id|chip
comma
id|AC97_CMD
)paren
)paren
op_amp
(paren
l_int|1
op_lshift
l_int|9
)paren
)paren
)paren
r_goto
id|ok1
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|snd_printk
c_func
(paren
l_string|&quot;AC&squot;97 interface is busy (1)&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
id|ok1
suffix:colon
multiline_comment|/* write data and address */
id|outw
c_func
(paren
id|val
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|AC97_DATA
)paren
)paren
suffix:semicolon
id|outw
c_func
(paren
id|reg
op_or
(paren
id|ac97-&gt;addr
op_lshift
id|FM801_AC97_ADDR_SHIFT
)paren
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|AC97_CMD
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Wait until the write command is not completed..&n;         */
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|1000
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|inw
c_func
(paren
id|FM801_REG
c_func
(paren
id|chip
comma
id|AC97_CMD
)paren
)paren
op_amp
(paren
l_int|1
op_lshift
l_int|9
)paren
)paren
)paren
r_return
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|snd_printk
c_func
(paren
l_string|&quot;AC&squot;97 interface #%d is busy (2)&bslash;n&quot;
comma
id|ac97-&gt;num
)paren
suffix:semicolon
)brace
DECL|function|snd_fm801_codec_read
r_static
r_int
r_int
id|snd_fm801_codec_read
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
)paren
(brace
id|fm801_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|fm801_t
comma
id|ac97-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_int
id|idx
suffix:semicolon
multiline_comment|/*&n;&t; *  Wait until the codec interface is not ready..&n;&t; */
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|100
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|inw
c_func
(paren
id|FM801_REG
c_func
(paren
id|chip
comma
id|AC97_CMD
)paren
)paren
op_amp
(paren
l_int|1
op_lshift
l_int|9
)paren
)paren
)paren
r_goto
id|ok1
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|snd_printk
c_func
(paren
l_string|&quot;AC&squot;97 interface is busy (1)&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|ok1
suffix:colon
multiline_comment|/* read command */
id|outw
c_func
(paren
id|reg
op_or
(paren
id|ac97-&gt;addr
op_lshift
id|FM801_AC97_ADDR_SHIFT
)paren
op_or
(paren
l_int|1
op_lshift
l_int|7
)paren
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|AC97_CMD
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|100
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|inw
c_func
(paren
id|FM801_REG
c_func
(paren
id|chip
comma
id|AC97_CMD
)paren
)paren
op_amp
(paren
l_int|1
op_lshift
l_int|9
)paren
)paren
)paren
r_goto
id|ok2
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|snd_printk
c_func
(paren
l_string|&quot;AC&squot;97 interface #%d is busy (2)&bslash;n&quot;
comma
id|ac97-&gt;num
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|ok2
suffix:colon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|1000
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
id|inw
c_func
(paren
id|FM801_REG
c_func
(paren
id|chip
comma
id|AC97_CMD
)paren
)paren
op_amp
(paren
l_int|1
op_lshift
l_int|8
)paren
)paren
r_goto
id|ok3
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|snd_printk
c_func
(paren
l_string|&quot;AC&squot;97 interface #%d is not valid (2)&bslash;n&quot;
comma
id|ac97-&gt;num
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|ok3
suffix:colon
r_return
id|inw
c_func
(paren
id|FM801_REG
c_func
(paren
id|chip
comma
id|AC97_DATA
)paren
)paren
suffix:semicolon
)brace
DECL|variable|rates
r_static
r_int
r_int
id|rates
(braket
)braket
op_assign
(brace
l_int|5500
comma
l_int|8000
comma
l_int|9600
comma
l_int|11025
comma
l_int|16000
comma
l_int|19200
comma
l_int|22050
comma
l_int|32000
comma
l_int|38400
comma
l_int|44100
comma
l_int|48000
)brace
suffix:semicolon
DECL|macro|RATES
mdefine_line|#define RATES sizeof(rates) / sizeof(rates[0])
DECL|variable|hw_constraints_rates
r_static
id|snd_pcm_hw_constraint_list_t
id|hw_constraints_rates
op_assign
(brace
id|count
suffix:colon
id|RATES
comma
id|list
suffix:colon
id|rates
comma
id|mask
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|channels
r_static
r_int
r_int
id|channels
(braket
)braket
op_assign
(brace
l_int|2
comma
l_int|4
comma
l_int|6
)brace
suffix:semicolon
DECL|macro|CHANNELS
mdefine_line|#define CHANNELS sizeof(channels) / sizeof(channels[0])
DECL|variable|hw_constraints_channels
r_static
id|snd_pcm_hw_constraint_list_t
id|hw_constraints_channels
op_assign
(brace
id|count
suffix:colon
id|CHANNELS
comma
id|list
suffix:colon
id|channels
comma
id|mask
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/*&n; *  Sample rate routines&n; */
DECL|function|snd_fm801_rate_bits
r_static
r_int
r_int
id|snd_fm801_rate_bits
c_func
(paren
r_int
id|rate
)paren
(brace
r_int
r_int
id|idx
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|11
suffix:semicolon
id|idx
op_increment
)paren
r_if
c_cond
(paren
id|rates
(braket
id|idx
)braket
op_eq
id|rate
)paren
r_return
id|idx
suffix:semicolon
id|snd_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
id|RATES
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; *  PCM part&n; */
DECL|function|snd_fm801_playback_trigger
r_static
r_int
id|snd_fm801_playback_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|fm801_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_START
)paren
(brace
id|chip-&gt;ply_ctrl
op_and_assign
op_complement
(paren
id|FM801_BUF1_LAST
op_or
id|FM801_BUF2_LAST
op_or
id|FM801_PAUSE
)paren
suffix:semicolon
id|chip-&gt;ply_ctrl
op_or_assign
id|FM801_START
op_or
id|FM801_IMMED_STOP
suffix:semicolon
id|outw
c_func
(paren
id|chip-&gt;ply_ctrl
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|PLY_CTRL
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_STOP
)paren
(brace
id|chip-&gt;ply_ctrl
op_and_assign
op_complement
id|FM801_START
suffix:semicolon
id|outw
c_func
(paren
id|chip-&gt;ply_ctrl
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|PLY_CTRL
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_fm801_capture_trigger
r_static
r_int
id|snd_fm801_capture_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|fm801_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_START
)paren
(brace
id|chip-&gt;cap_ctrl
op_and_assign
op_complement
(paren
id|FM801_BUF1_LAST
op_or
id|FM801_BUF2_LAST
op_or
id|FM801_PAUSE
)paren
suffix:semicolon
id|chip-&gt;cap_ctrl
op_or_assign
id|FM801_START
op_or
id|FM801_IMMED_STOP
suffix:semicolon
id|outw
c_func
(paren
id|chip-&gt;cap_ctrl
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|CAP_CTRL
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_STOP
)paren
(brace
id|chip-&gt;cap_ctrl
op_and_assign
op_complement
id|FM801_START
suffix:semicolon
id|outw
c_func
(paren
id|chip-&gt;cap_ctrl
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|CAP_CTRL
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_fm801_hw_params
r_static
r_int
id|snd_fm801_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
r_return
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_fm801_hw_free
r_static
r_int
id|snd_fm801_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
DECL|function|snd_fm801_playback_prepare
r_static
r_int
id|snd_fm801_playback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|fm801_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|chip-&gt;ply_size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;ply_count
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|chip-&gt;ply_ctrl
op_and_assign
op_complement
(paren
id|FM801_START
op_or
id|FM801_16BIT
op_or
id|FM801_STEREO
op_or
id|FM801_RATE_MASK
op_or
id|FM801_CHANNELS_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|16
)paren
id|chip-&gt;ply_ctrl
op_or_assign
id|FM801_16BIT
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;channels
OG
l_int|1
)paren
(brace
id|chip-&gt;ply_ctrl
op_or_assign
id|FM801_STEREO
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;channels
op_eq
l_int|4
)paren
id|chip-&gt;ply_ctrl
op_or_assign
id|FM801_CHANNELS_4
suffix:semicolon
r_else
r_if
c_cond
(paren
id|runtime-&gt;channels
op_eq
l_int|6
)paren
id|chip-&gt;ply_ctrl
op_or_assign
id|FM801_CHANNELS_6
suffix:semicolon
)brace
id|chip-&gt;ply_ctrl
op_or_assign
id|snd_fm801_rate_bits
c_func
(paren
id|runtime-&gt;rate
)paren
op_lshift
id|FM801_RATE_SHIFT
suffix:semicolon
id|chip-&gt;ply_buf
op_assign
l_int|0
suffix:semicolon
id|outw
c_func
(paren
id|chip-&gt;ply_ctrl
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|PLY_CTRL
)paren
)paren
suffix:semicolon
id|outw
c_func
(paren
id|chip-&gt;ply_count
op_minus
l_int|1
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|PLY_COUNT
)paren
)paren
suffix:semicolon
id|chip-&gt;ply_buffer
op_assign
id|runtime-&gt;dma_addr
suffix:semicolon
id|chip-&gt;ply_pos
op_assign
l_int|0
suffix:semicolon
id|outl
c_func
(paren
id|chip-&gt;ply_buffer
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|PLY_BUF1
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|chip-&gt;ply_buffer
op_plus
(paren
id|chip-&gt;ply_count
op_mod
id|chip-&gt;ply_size
)paren
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|PLY_BUF2
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_fm801_capture_prepare
r_static
r_int
id|snd_fm801_capture_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|fm801_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|chip-&gt;cap_size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;cap_count
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|chip-&gt;cap_ctrl
op_and_assign
op_complement
(paren
id|FM801_START
op_or
id|FM801_16BIT
op_or
id|FM801_STEREO
op_or
id|FM801_RATE_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|16
)paren
id|chip-&gt;cap_ctrl
op_or_assign
id|FM801_16BIT
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;channels
OG
l_int|1
)paren
id|chip-&gt;cap_ctrl
op_or_assign
id|FM801_STEREO
suffix:semicolon
id|chip-&gt;cap_ctrl
op_or_assign
id|snd_fm801_rate_bits
c_func
(paren
id|runtime-&gt;rate
)paren
op_lshift
id|FM801_RATE_SHIFT
suffix:semicolon
id|chip-&gt;cap_buf
op_assign
l_int|0
suffix:semicolon
id|outw
c_func
(paren
id|chip-&gt;cap_ctrl
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|CAP_CTRL
)paren
)paren
suffix:semicolon
id|outw
c_func
(paren
id|chip-&gt;cap_count
op_minus
l_int|1
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|CAP_COUNT
)paren
)paren
suffix:semicolon
id|chip-&gt;cap_buffer
op_assign
id|runtime-&gt;dma_addr
suffix:semicolon
id|chip-&gt;cap_pos
op_assign
l_int|0
suffix:semicolon
id|outl
c_func
(paren
id|chip-&gt;cap_buffer
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|CAP_BUF1
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|chip-&gt;cap_buffer
op_plus
(paren
id|chip-&gt;cap_count
op_mod
id|chip-&gt;cap_size
)paren
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|CAP_BUF2
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_fm801_playback_pointer
r_static
id|snd_pcm_uframes_t
id|snd_fm801_playback_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|fm801_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|ptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chip-&gt;ply_ctrl
op_amp
id|FM801_START
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|ptr
op_assign
id|chip-&gt;ply_pos
op_plus
(paren
id|chip-&gt;ply_count
op_minus
l_int|1
)paren
op_minus
id|inw
c_func
(paren
id|FM801_REG
c_func
(paren
id|chip
comma
id|PLY_COUNT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inw
c_func
(paren
id|FM801_REG
c_func
(paren
id|chip
comma
id|IRQ_STATUS
)paren
)paren
op_amp
id|FM801_IRQ_PLAYBACK
)paren
(brace
id|ptr
op_add_assign
id|chip-&gt;ply_count
suffix:semicolon
id|ptr
op_mod_assign
id|chip-&gt;ply_size
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|ptr
)paren
suffix:semicolon
)brace
DECL|function|snd_fm801_capture_pointer
r_static
id|snd_pcm_uframes_t
id|snd_fm801_capture_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|fm801_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|ptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chip-&gt;cap_ctrl
op_amp
id|FM801_START
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|ptr
op_assign
id|chip-&gt;cap_pos
op_plus
(paren
id|chip-&gt;cap_count
op_minus
l_int|1
)paren
op_minus
id|inw
c_func
(paren
id|FM801_REG
c_func
(paren
id|chip
comma
id|CAP_COUNT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|inw
c_func
(paren
id|FM801_REG
c_func
(paren
id|chip
comma
id|IRQ_STATUS
)paren
)paren
op_amp
id|FM801_IRQ_CAPTURE
)paren
(brace
id|ptr
op_add_assign
id|chip-&gt;cap_count
suffix:semicolon
id|ptr
op_mod_assign
id|chip-&gt;cap_size
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|ptr
)paren
suffix:semicolon
)brace
DECL|function|snd_fm801_interrupt
r_static
r_void
id|snd_fm801_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|fm801_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|fm801_t
comma
id|dev_id
comma
r_return
)paren
suffix:semicolon
r_int
r_int
id|status
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
id|status
op_assign
id|inw
c_func
(paren
id|FM801_REG
c_func
(paren
id|chip
comma
id|IRQ_STATUS
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
(paren
id|FM801_IRQ_PLAYBACK
op_or
id|FM801_IRQ_CAPTURE
op_or
id|FM801_IRQ_MPU
op_or
id|FM801_IRQ_VOLUME
)paren
)paren
op_eq
l_int|0
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;pcm
op_logical_and
(paren
id|status
op_amp
id|FM801_IRQ_PLAYBACK
)paren
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|chip-&gt;ply_buf
op_increment
suffix:semicolon
id|chip-&gt;ply_pos
op_add_assign
id|chip-&gt;ply_count
suffix:semicolon
id|chip-&gt;ply_pos
op_mod_assign
id|chip-&gt;ply_size
suffix:semicolon
id|tmp
op_assign
id|chip-&gt;ply_pos
op_plus
id|chip-&gt;ply_count
suffix:semicolon
id|tmp
op_mod_assign
id|chip-&gt;ply_size
suffix:semicolon
id|outl
c_func
(paren
id|chip-&gt;ply_buffer
op_plus
id|tmp
comma
(paren
id|chip-&gt;ply_buf
op_amp
l_int|1
)paren
ques
c_cond
id|FM801_REG
c_func
(paren
id|chip
comma
id|PLY_BUF1
)paren
suffix:colon
id|FM801_REG
c_func
(paren
id|chip
comma
id|PLY_BUF2
)paren
)paren
suffix:semicolon
id|outw
c_func
(paren
id|FM801_IRQ_PLAYBACK
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|IRQ_STATUS
)paren
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|snd_pcm_period_elapsed
c_func
(paren
id|chip-&gt;playback_substream
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chip-&gt;pcm
op_logical_and
(paren
id|status
op_amp
id|FM801_IRQ_CAPTURE
)paren
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|chip-&gt;cap_buf
op_increment
suffix:semicolon
id|chip-&gt;cap_pos
op_add_assign
id|chip-&gt;cap_count
suffix:semicolon
id|chip-&gt;cap_pos
op_mod_assign
id|chip-&gt;cap_size
suffix:semicolon
id|tmp
op_assign
id|chip-&gt;cap_pos
op_plus
id|chip-&gt;cap_count
suffix:semicolon
id|tmp
op_mod_assign
id|chip-&gt;cap_size
suffix:semicolon
id|outl
c_func
(paren
id|chip-&gt;cap_buffer
op_plus
id|tmp
comma
(paren
id|chip-&gt;cap_buf
op_amp
l_int|1
)paren
ques
c_cond
id|FM801_REG
c_func
(paren
id|chip
comma
id|CAP_BUF1
)paren
suffix:colon
id|FM801_REG
c_func
(paren
id|chip
comma
id|CAP_BUF2
)paren
)paren
suffix:semicolon
id|outw
c_func
(paren
id|FM801_IRQ_CAPTURE
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|IRQ_STATUS
)paren
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|snd_pcm_period_elapsed
c_func
(paren
id|chip-&gt;capture_substream
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|status
op_amp
id|FM801_IRQ_MPU
)paren
op_logical_and
id|chip-&gt;rmidi
op_ne
l_int|NULL
)paren
(brace
id|snd_mpu401_uart_interrupt
c_func
(paren
id|irq
comma
id|chip-&gt;rmidi-&gt;private_data
comma
id|regs
)paren
suffix:semicolon
id|outw
c_func
(paren
id|FM801_IRQ_MPU
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|IRQ_STATUS
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|FM801_IRQ_VOLUME
)paren
(brace
multiline_comment|/* TODO */
id|outw
c_func
(paren
id|FM801_IRQ_VOLUME
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|IRQ_STATUS
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|variable|snd_fm801_playback
r_static
id|snd_pcm_hardware_t
id|snd_fm801_playback
op_assign
(brace
id|info
suffix:colon
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
id|formats
suffix:colon
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
comma
id|rates
suffix:colon
id|SNDRV_PCM_RATE_KNOT
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
id|rate_min
suffix:colon
l_int|5500
comma
id|rate_max
suffix:colon
l_int|48000
comma
id|channels_min
suffix:colon
l_int|1
comma
id|channels_max
suffix:colon
l_int|2
comma
id|buffer_bytes_max
suffix:colon
(paren
l_int|128
op_star
l_int|1024
)paren
comma
id|period_bytes_min
suffix:colon
l_int|64
comma
id|period_bytes_max
suffix:colon
(paren
l_int|128
op_star
l_int|1024
)paren
comma
id|periods_min
suffix:colon
l_int|1
comma
id|periods_max
suffix:colon
l_int|1024
comma
id|fifo_size
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|snd_fm801_capture
r_static
id|snd_pcm_hardware_t
id|snd_fm801_capture
op_assign
(brace
id|info
suffix:colon
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
id|formats
suffix:colon
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
comma
id|rates
suffix:colon
id|SNDRV_PCM_RATE_KNOT
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
id|rate_min
suffix:colon
l_int|5500
comma
id|rate_max
suffix:colon
l_int|48000
comma
id|channels_min
suffix:colon
l_int|1
comma
id|channels_max
suffix:colon
l_int|2
comma
id|buffer_bytes_max
suffix:colon
(paren
l_int|128
op_star
l_int|1024
)paren
comma
id|period_bytes_min
suffix:colon
l_int|64
comma
id|period_bytes_max
suffix:colon
(paren
l_int|128
op_star
l_int|1024
)paren
comma
id|periods_min
suffix:colon
l_int|1
comma
id|periods_max
suffix:colon
l_int|1024
comma
id|fifo_size
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
DECL|function|snd_fm801_playback_open
r_static
r_int
id|snd_fm801_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|fm801_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
id|chip-&gt;playback_substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_fm801_playback
suffix:semicolon
id|snd_pcm_hw_constraint_list
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
op_amp
id|hw_constraints_rates
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;multichannel
)paren
(brace
id|runtime-&gt;hw.channels_max
op_assign
l_int|6
suffix:semicolon
id|snd_pcm_hw_constraint_list
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_CHANNELS
comma
op_amp
id|hw_constraints_channels
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_integer
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_PERIODS
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_fm801_capture_open
r_static
r_int
id|snd_fm801_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|fm801_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
id|chip-&gt;capture_substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_fm801_capture
suffix:semicolon
id|snd_pcm_hw_constraint_list
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
op_amp
id|hw_constraints_rates
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_integer
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_PERIODS
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_fm801_playback_close
r_static
r_int
id|snd_fm801_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|fm801_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;playback_substream
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_fm801_capture_close
r_static
r_int
id|snd_fm801_capture_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|fm801_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;capture_substream
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_fm801_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_fm801_playback_ops
op_assign
(brace
id|open
suffix:colon
id|snd_fm801_playback_open
comma
id|close
suffix:colon
id|snd_fm801_playback_close
comma
id|ioctl
suffix:colon
id|snd_pcm_lib_ioctl
comma
id|hw_params
suffix:colon
id|snd_fm801_hw_params
comma
id|hw_free
suffix:colon
id|snd_fm801_hw_free
comma
id|prepare
suffix:colon
id|snd_fm801_playback_prepare
comma
id|trigger
suffix:colon
id|snd_fm801_playback_trigger
comma
id|pointer
suffix:colon
id|snd_fm801_playback_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_fm801_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_fm801_capture_ops
op_assign
(brace
id|open
suffix:colon
id|snd_fm801_capture_open
comma
id|close
suffix:colon
id|snd_fm801_capture_close
comma
id|ioctl
suffix:colon
id|snd_pcm_lib_ioctl
comma
id|hw_params
suffix:colon
id|snd_fm801_hw_params
comma
id|hw_free
suffix:colon
id|snd_fm801_hw_free
comma
id|prepare
suffix:colon
id|snd_fm801_capture_prepare
comma
id|trigger
suffix:colon
id|snd_fm801_capture_trigger
comma
id|pointer
suffix:colon
id|snd_fm801_capture_pointer
comma
)brace
suffix:semicolon
DECL|function|snd_fm801_pcm_free
r_static
r_void
id|snd_fm801_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|fm801_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|fm801_t
comma
id|pcm-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|chip-&gt;pcm
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_fm801_pcm
r_static
r_int
id|__devinit
id|snd_fm801_pcm
c_func
(paren
id|fm801_t
op_star
id|chip
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;FM801&quot;
comma
id|device
comma
l_int|1
comma
l_int|1
comma
op_amp
id|pcm
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_fm801_playback_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_fm801_capture_ops
)paren
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_fm801_pcm_free
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;FM801&quot;
)paren
suffix:semicolon
id|chip-&gt;pcm
op_assign
id|pcm
suffix:semicolon
id|snd_pcm_lib_preallocate_pci_pages_for_all
c_func
(paren
id|chip-&gt;pci
comma
id|pcm
comma
id|chip-&gt;multichannel
ques
c_cond
l_int|128
op_star
l_int|1024
suffix:colon
l_int|64
op_star
l_int|1024
comma
l_int|128
op_star
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Mixer routines&n; */
DECL|macro|FM801_SINGLE
mdefine_line|#define FM801_SINGLE(xname, reg, shift, mask, invert) &bslash;&n;{ iface: SNDRV_CTL_ELEM_IFACE_MIXER, name: xname, info: snd_fm801_info_single, &bslash;&n;  get: snd_fm801_get_single, put: snd_fm801_put_single, &bslash;&n;  private_value: reg | (shift &lt;&lt; 8) | (mask &lt;&lt; 16) | (invert &lt;&lt; 24) }
DECL|function|snd_fm801_info_single
r_static
r_int
id|snd_fm801_info_single
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|mask
op_eq
l_int|1
ques
c_cond
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:colon
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
id|mask
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_fm801_get_single
r_static
r_int
id|snd_fm801_get_single
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|fm801_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|inw
c_func
(paren
id|chip-&gt;port
op_plus
id|reg
)paren
op_rshift
id|shift
)paren
op_amp
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|mask
op_minus
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_fm801_put_single
r_static
r_int
id|snd_fm801_put_single
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|fm801_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
id|mask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
id|val
op_assign
id|mask
op_minus
id|val
suffix:semicolon
r_return
id|snd_fm801_update_bits
c_func
(paren
id|chip
comma
id|reg
comma
id|mask
op_lshift
id|shift
comma
id|val
op_lshift
id|shift
)paren
suffix:semicolon
)brace
DECL|macro|FM801_DOUBLE
mdefine_line|#define FM801_DOUBLE(xname, reg, shift_left, shift_right, mask, invert) &bslash;&n;{ iface: SNDRV_CTL_ELEM_IFACE_MIXER, name: xname, info: snd_fm801_info_double, &bslash;&n;  get: snd_fm801_get_double, put: snd_fm801_put_double, &bslash;&n;  private_value: reg | (shift_left &lt;&lt; 8) | (shift_right &lt;&lt; 12) | (mask &lt;&lt; 16) | (invert &lt;&lt; 24) }
DECL|function|snd_fm801_info_double
r_static
r_int
id|snd_fm801_info_double
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|mask
op_eq
l_int|1
ques
c_cond
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:colon
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
id|mask
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_fm801_get_double
r_static
r_int
id|snd_fm801_get_double
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|fm801_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift_left
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_int
id|shift_right
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|12
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|inw
c_func
(paren
id|chip-&gt;port
op_plus
id|reg
)paren
op_rshift
id|shift_left
)paren
op_amp
id|mask
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
(paren
id|inw
c_func
(paren
id|chip-&gt;port
op_plus
id|reg
)paren
op_rshift
id|shift_right
)paren
op_amp
id|mask
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
(brace
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|mask
op_minus
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
id|mask
op_minus
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_fm801_put_double
r_static
r_int
id|snd_fm801_put_double
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|fm801_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift_left
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_int
id|shift_right
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|12
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
r_int
id|val1
comma
id|val2
suffix:semicolon
id|val1
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
id|mask
suffix:semicolon
id|val2
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_amp
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
(brace
id|val1
op_assign
id|mask
op_minus
id|val1
suffix:semicolon
id|val2
op_assign
id|mask
op_minus
id|val2
suffix:semicolon
)brace
r_return
id|snd_fm801_update_bits
c_func
(paren
id|chip
comma
id|reg
comma
(paren
id|mask
op_lshift
id|shift_left
)paren
op_or
(paren
id|mask
op_lshift
id|shift_right
)paren
comma
(paren
id|val1
op_lshift
id|shift_left
)paren
op_or
(paren
id|val2
op_lshift
id|shift_right
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_fm801_info_mux
r_static
r_int
id|snd_fm801_info_mux
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_static
r_char
op_star
id|texts
(braket
l_int|5
)braket
op_assign
(brace
l_string|&quot;AC97 Primary&quot;
comma
l_string|&quot;FM&quot;
comma
l_string|&quot;I2S&quot;
comma
l_string|&quot;PCM&quot;
comma
l_string|&quot;AC97 Secondary&quot;
)brace
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_ENUMERATED
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.enumerated.items
op_assign
l_int|5
suffix:semicolon
r_if
c_cond
(paren
id|uinfo-&gt;value.enumerated.item
OG
l_int|4
)paren
id|uinfo-&gt;value.enumerated.item
op_assign
l_int|4
suffix:semicolon
id|strcpy
c_func
(paren
id|uinfo-&gt;value.enumerated.name
comma
id|texts
(braket
id|uinfo-&gt;value.enumerated.item
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_fm801_get_mux
r_static
r_int
id|snd_fm801_get_mux
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|fm801_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
id|inw
c_func
(paren
id|FM801_REG
c_func
(paren
id|chip
comma
id|REC_SRC
)paren
)paren
op_amp
l_int|7
suffix:semicolon
r_if
c_cond
(paren
id|val
OG
l_int|4
)paren
id|val
op_assign
l_int|4
suffix:semicolon
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
op_assign
id|val
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_fm801_put_mux
r_static
r_int
id|snd_fm801_put_mux
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|fm801_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_assign
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
)paren
OG
l_int|4
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_return
id|snd_fm801_update_bits
c_func
(paren
id|chip
comma
id|FM801_REC_SRC
comma
l_int|7
comma
id|val
)paren
suffix:semicolon
)brace
DECL|macro|FM801_CONTROLS
mdefine_line|#define FM801_CONTROLS (sizeof(snd_fm801_controls)/sizeof(snd_kcontrol_new_t))
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_fm801_controls
(braket
)braket
id|__devinitdata
op_assign
(brace
id|FM801_DOUBLE
c_func
(paren
l_string|&quot;Wave Playback Volume&quot;
comma
id|FM801_PCM_VOL
comma
l_int|0
comma
l_int|8
comma
l_int|31
comma
l_int|1
)paren
comma
id|FM801_SINGLE
c_func
(paren
l_string|&quot;Wave Playback Switch&quot;
comma
id|FM801_PCM_VOL
comma
l_int|15
comma
l_int|1
comma
l_int|1
)paren
comma
id|FM801_DOUBLE
c_func
(paren
l_string|&quot;I2S Playback Volume&quot;
comma
id|FM801_I2S_VOL
comma
l_int|0
comma
l_int|8
comma
l_int|31
comma
l_int|1
)paren
comma
id|FM801_SINGLE
c_func
(paren
l_string|&quot;I2S Playback Switch&quot;
comma
id|FM801_I2S_VOL
comma
l_int|15
comma
l_int|1
comma
l_int|1
)paren
comma
id|FM801_DOUBLE
c_func
(paren
l_string|&quot;FM Playback Volume&quot;
comma
id|FM801_FM_VOL
comma
l_int|0
comma
l_int|8
comma
l_int|31
comma
l_int|1
)paren
comma
id|FM801_SINGLE
c_func
(paren
l_string|&quot;FM Playback Switch&quot;
comma
id|FM801_FM_VOL
comma
l_int|15
comma
l_int|1
comma
l_int|1
)paren
comma
(brace
id|iface
suffix:colon
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
id|name
suffix:colon
l_string|&quot;Digital Capture Source&quot;
comma
id|info
suffix:colon
id|snd_fm801_info_mux
comma
id|get
suffix:colon
id|snd_fm801_get_mux
comma
id|put
suffix:colon
id|snd_fm801_put_mux
comma
)brace
)brace
suffix:semicolon
DECL|macro|FM801_CONTROLS_MULTI
mdefine_line|#define FM801_CONTROLS_MULTI (sizeof(snd_fm801_controls_multi)/sizeof(snd_kcontrol_new_t))
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_fm801_controls_multi
(braket
)braket
id|__devinitdata
op_assign
(brace
id|FM801_SINGLE
c_func
(paren
l_string|&quot;AC97 2ch-&gt;4ch Copy Switch&quot;
comma
id|FM801_CODEC_CTRL
comma
l_int|7
comma
l_int|1
comma
l_int|0
)paren
comma
id|FM801_SINGLE
c_func
(paren
l_string|&quot;AC97 18-bit Switch&quot;
comma
id|FM801_CODEC_CTRL
comma
l_int|10
comma
l_int|1
comma
l_int|0
)paren
comma
id|FM801_SINGLE
c_func
(paren
l_string|&quot;IEC958 Capture Switch&quot;
comma
id|FM801_I2S_MODE
comma
l_int|8
comma
l_int|1
comma
l_int|0
)paren
comma
id|FM801_SINGLE
c_func
(paren
l_string|&quot;IEC958 Raw Data Playback Switch&quot;
comma
id|FM801_I2S_MODE
comma
l_int|9
comma
l_int|1
comma
l_int|0
)paren
comma
id|FM801_SINGLE
c_func
(paren
l_string|&quot;IEC958 Raw Data Capture Switch&quot;
comma
id|FM801_I2S_MODE
comma
l_int|10
comma
l_int|1
comma
l_int|0
)paren
comma
)brace
suffix:semicolon
DECL|function|snd_fm801_mixer_free_ac97
r_static
r_void
id|snd_fm801_mixer_free_ac97
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
id|fm801_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|fm801_t
comma
id|ac97-&gt;private_data
comma
r_return
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;num
op_eq
l_int|0
)paren
(brace
id|chip-&gt;ac97
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|chip-&gt;ac97_sec
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
DECL|function|snd_fm801_mixer
r_static
r_int
id|__init
id|snd_fm801_mixer
c_func
(paren
id|fm801_t
op_star
id|chip
)paren
(brace
id|ac97_t
id|ac97
suffix:semicolon
r_int
id|err
comma
id|i
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ac97
comma
l_int|0
comma
r_sizeof
(paren
id|ac97
)paren
)paren
suffix:semicolon
id|ac97.write
op_assign
id|snd_fm801_codec_write
suffix:semicolon
id|ac97.read
op_assign
id|snd_fm801_codec_read
suffix:semicolon
id|ac97.private_data
op_assign
id|chip
suffix:semicolon
id|ac97.private_free
op_assign
id|snd_fm801_mixer_free_ac97
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_mixer
c_func
(paren
id|chip-&gt;card
comma
op_amp
id|ac97
comma
op_amp
id|chip-&gt;ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;secondary
)paren
(brace
id|ac97.num
op_assign
l_int|1
suffix:semicolon
id|ac97.addr
op_assign
id|chip-&gt;secondary_addr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_mixer
c_func
(paren
id|chip-&gt;card
comma
op_amp
id|ac97
comma
op_amp
id|chip-&gt;ac97_sec
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|FM801_CONTROLS
suffix:semicolon
id|i
op_increment
)paren
id|snd_ctl_add
c_func
(paren
id|chip-&gt;card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_fm801_controls
(braket
id|i
)braket
comma
id|chip
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;multichannel
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|FM801_CONTROLS_MULTI
suffix:semicolon
id|i
op_increment
)paren
id|snd_ctl_add
c_func
(paren
id|chip-&gt;card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_fm801_controls_multi
(braket
id|i
)braket
comma
id|chip
)paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  initialization routines&n; */
DECL|function|snd_fm801_free
r_static
r_int
id|snd_fm801_free
c_func
(paren
id|fm801_t
op_star
id|chip
)paren
(brace
r_int
r_int
id|cmdw
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;irq
OL
l_int|0
)paren
r_goto
id|__end_hw
suffix:semicolon
multiline_comment|/* interrupt setup - mask everything */
id|cmdw
op_assign
id|inw
c_func
(paren
id|FM801_REG
c_func
(paren
id|chip
comma
id|IRQ_MASK
)paren
)paren
suffix:semicolon
id|cmdw
op_or_assign
l_int|0x00c3
suffix:semicolon
id|outw
c_func
(paren
id|cmdw
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|IRQ_MASK
)paren
)paren
suffix:semicolon
id|__end_hw
suffix:colon
r_if
c_cond
(paren
id|chip-&gt;res_port
)paren
(brace
id|release_resource
c_func
(paren
id|chip-&gt;res_port
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|chip-&gt;res_port
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chip-&gt;irq
op_ge
l_int|0
)paren
id|free_irq
c_func
(paren
id|chip-&gt;irq
comma
(paren
r_void
op_star
)paren
id|chip
)paren
suffix:semicolon
id|snd_magic_kfree
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_fm801_dev_free
r_static
r_int
id|snd_fm801_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|fm801_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|fm801_t
comma
id|device-&gt;device_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_return
id|snd_fm801_free
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
DECL|function|snd_fm801_create
r_static
r_int
id|__devinit
id|snd_fm801_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_struct
id|pci_dev
op_star
id|pci
comma
id|fm801_t
op_star
op_star
id|rchip
)paren
(brace
id|fm801_t
op_star
id|chip
suffix:semicolon
r_int
r_char
id|rev
comma
id|id
suffix:semicolon
r_int
r_int
id|cmdw
suffix:semicolon
r_int
r_int
id|timeout
suffix:semicolon
r_int
id|err
suffix:semicolon
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
id|dev_free
suffix:colon
id|snd_fm801_dev_free
comma
)brace
suffix:semicolon
op_star
id|rchip
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pci
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|chip
op_assign
id|snd_magic_kcalloc
c_func
(paren
id|fm801_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|chip-&gt;card
op_assign
id|card
suffix:semicolon
id|chip-&gt;pci
op_assign
id|pci
suffix:semicolon
id|chip-&gt;irq
op_assign
op_minus
l_int|1
suffix:semicolon
id|chip-&gt;port
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chip-&gt;res_port
op_assign
id|request_region
c_func
(paren
id|chip-&gt;port
comma
l_int|0x80
comma
l_string|&quot;FM801&quot;
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_fm801_free
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab region 0x%lx-0x%lx&bslash;n&quot;
comma
id|chip-&gt;port
comma
id|chip-&gt;port
op_plus
l_int|0x80
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|pci-&gt;irq
comma
id|snd_fm801_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
l_string|&quot;FM801&quot;
comma
(paren
r_void
op_star
)paren
id|chip
)paren
)paren
(brace
id|snd_fm801_free
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab IRQ %d&bslash;n&quot;
comma
id|chip-&gt;irq
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|chip-&gt;irq
op_assign
id|pci-&gt;irq
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pci
)paren
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pci
comma
id|PCI_REVISION_ID
comma
op_amp
id|rev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rev
op_ge
l_int|0xb1
)paren
multiline_comment|/* FM801-AU */
id|chip-&gt;multichannel
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* codec cold reset + AC&squot;97 warm reset */
id|outw
c_func
(paren
(paren
l_int|1
op_lshift
l_int|5
)paren
op_or
(paren
l_int|1
op_lshift
l_int|6
)paren
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|CODEC_CTRL
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|CODEC_CTRL
)paren
)paren
suffix:semicolon
id|timeout
op_assign
(paren
id|jiffies
op_plus
(paren
l_int|3
op_star
id|HZ
)paren
op_div
l_int|4
)paren
op_plus
l_int|1
suffix:semicolon
multiline_comment|/* min 750ms */
id|outw
c_func
(paren
(paren
l_int|1
op_lshift
l_int|7
)paren
op_or
(paren
l_int|0
op_lshift
id|FM801_AC97_ADDR_SHIFT
)paren
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|AC97_CMD
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|inw
c_func
(paren
id|FM801_REG
c_func
(paren
id|chip
comma
id|AC97_CMD
)paren
)paren
op_amp
(paren
l_int|3
op_lshift
l_int|8
)paren
)paren
op_eq
(paren
l_int|1
op_lshift
l_int|8
)paren
)paren
r_goto
id|__ac97_secondary
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|timeout
op_minus
(paren
r_int
r_int
)paren
id|jiffies
)paren
OG
l_int|0
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;Primary AC&squot;97 codec not found&bslash;n&quot;
)paren
suffix:semicolon
id|snd_fm801_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
id|__ac97_secondary
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|chip-&gt;multichannel
)paren
multiline_comment|/* lookup is not required */
r_goto
id|__ac97_ok
suffix:semicolon
r_for
c_loop
(paren
id|id
op_assign
l_int|3
suffix:semicolon
id|id
OG
l_int|0
suffix:semicolon
id|id
op_decrement
)paren
(brace
multiline_comment|/* my card has the secondary codec */
multiline_comment|/* at address #3, so the loop is inverted */
r_if
c_cond
(paren
(paren
id|timeout
op_minus
(paren
r_int
r_int
)paren
id|jiffies
)paren
OL
id|HZ
op_div
l_int|20
)paren
id|timeout
op_assign
id|jiffies
op_plus
id|HZ
op_div
l_int|20
suffix:semicolon
id|outw
c_func
(paren
(paren
l_int|1
op_lshift
l_int|7
)paren
op_or
(paren
id|id
op_lshift
id|FM801_AC97_ADDR_SHIFT
)paren
op_or
id|AC97_VENDOR_ID1
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|AC97_CMD
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|inw
c_func
(paren
id|FM801_REG
c_func
(paren
id|chip
comma
id|AC97_CMD
)paren
)paren
op_amp
(paren
l_int|3
op_lshift
l_int|8
)paren
)paren
op_eq
(paren
l_int|1
op_lshift
l_int|8
)paren
)paren
(brace
id|cmdw
op_assign
id|inw
c_func
(paren
id|FM801_REG
c_func
(paren
id|chip
comma
id|AC97_DATA
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmdw
op_ne
l_int|0xffff
op_logical_and
id|cmdw
op_ne
l_int|0
)paren
(brace
id|chip-&gt;secondary
op_assign
l_int|1
suffix:semicolon
id|chip-&gt;secondary_addr
op_assign
id|id
suffix:semicolon
r_goto
id|__ac97_ok
suffix:semicolon
)brace
)brace
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|timeout
op_minus
(paren
r_int
r_int
)paren
id|jiffies
)paren
OG
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* the recovery phase, it seems that probing for non-existing codec might */
multiline_comment|/* cause timeout problems */
id|timeout
op_assign
(paren
id|jiffies
op_plus
(paren
l_int|3
op_star
id|HZ
)paren
op_div
l_int|4
)paren
op_plus
l_int|1
suffix:semicolon
multiline_comment|/* min 750ms */
id|outw
c_func
(paren
(paren
l_int|1
op_lshift
l_int|7
)paren
op_or
(paren
l_int|0
op_lshift
id|FM801_AC97_ADDR_SHIFT
)paren
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|AC97_CMD
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|inw
c_func
(paren
id|FM801_REG
c_func
(paren
id|chip
comma
id|AC97_CMD
)paren
)paren
op_amp
(paren
l_int|3
op_lshift
l_int|8
)paren
)paren
op_eq
(paren
l_int|1
op_lshift
l_int|8
)paren
)paren
r_goto
id|__ac97_ok
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|timeout
op_minus
(paren
r_int
r_int
)paren
id|jiffies
)paren
OG
l_int|0
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;Primary AC&squot;97 codec not responding&bslash;n&quot;
)paren
suffix:semicolon
id|snd_fm801_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
id|__ac97_ok
suffix:colon
multiline_comment|/* init volume */
id|outw
c_func
(paren
l_int|0x0808
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|PCM_VOL
)paren
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x9f1f
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|FM_VOL
)paren
)paren
suffix:semicolon
id|outw
c_func
(paren
l_int|0x8808
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|I2S_VOL
)paren
)paren
suffix:semicolon
multiline_comment|/* I2S control - I2S mode */
id|outw
c_func
(paren
l_int|0x0003
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|I2S_MODE
)paren
)paren
suffix:semicolon
multiline_comment|/* interrupt setup - unmask MPU, PLAYBACK &amp; CAPTURE */
id|cmdw
op_assign
id|inw
c_func
(paren
id|FM801_REG
c_func
(paren
id|chip
comma
id|IRQ_MASK
)paren
)paren
suffix:semicolon
id|cmdw
op_and_assign
op_complement
l_int|0x0083
suffix:semicolon
id|outw
c_func
(paren
id|cmdw
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|IRQ_MASK
)paren
)paren
suffix:semicolon
multiline_comment|/* interrupt clear */
id|outw
c_func
(paren
id|FM801_IRQ_PLAYBACK
op_or
id|FM801_IRQ_CAPTURE
op_or
id|FM801_IRQ_MPU
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|IRQ_STATUS
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|chip
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_fm801_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
op_star
id|rchip
op_assign
id|chip
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_card_fm801_probe
r_static
r_int
id|__devinit
id|snd_card_fm801_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
r_static
r_int
id|dev
op_assign
l_int|0
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
id|fm801_t
op_star
id|chip
suffix:semicolon
id|opl3_t
op_star
id|opl3
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_ge
id|SNDRV_CARDS
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_enable
(braket
id|dev
)braket
)paren
(brace
id|dev
op_increment
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|card
op_assign
id|snd_card_new
c_func
(paren
id|snd_index
(braket
id|dev
)braket
comma
id|snd_id
(braket
id|dev
)braket
comma
id|THIS_MODULE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_fm801_create
c_func
(paren
id|card
comma
id|pci
comma
op_amp
id|chip
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_fm801_pcm
c_func
(paren
id|chip
comma
l_int|0
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_fm801_mixer
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_mpu401_uart_new
c_func
(paren
id|card
comma
l_int|0
comma
id|MPU401_HW_FM801
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|MPU401_DATA
)paren
comma
l_int|1
comma
id|chip-&gt;irq
comma
l_int|0
comma
op_amp
id|chip-&gt;rmidi
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_opl3_create
c_func
(paren
id|card
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|OPL3_BANK0
)paren
comma
id|FM801_REG
c_func
(paren
id|chip
comma
id|OPL3_BANK1
)paren
comma
id|OPL3_HW_OPL3_FM801
comma
l_int|1
comma
op_amp
id|opl3
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_opl3_hwdep_new
c_func
(paren
id|opl3
comma
l_int|0
comma
l_int|1
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;FM801&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;shortname
comma
l_string|&quot;ForteMedia FM801-&quot;
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|card-&gt;shortname
comma
id|chip-&gt;multichannel
ques
c_cond
l_string|&quot;AU&quot;
suffix:colon
l_string|&quot;AS&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;%s at 0x%lx, irq %i&quot;
comma
id|card-&gt;shortname
comma
id|chip-&gt;port
comma
id|chip-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_card_register
c_func
(paren
id|card
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pci
comma
id|card
)paren
suffix:semicolon
id|dev
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_card_fm801_remove
r_static
r_void
id|__devexit
id|snd_card_fm801_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
id|snd_card_free
c_func
(paren
id|pci_get_drvdata
c_func
(paren
id|pci
)paren
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|driver
r_static
r_struct
id|pci_driver
id|driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;FM801&quot;
comma
id|id_table
suffix:colon
id|snd_fm801_ids
comma
id|probe
suffix:colon
id|snd_card_fm801_probe
comma
id|remove
suffix:colon
id|__devexit_p
c_func
(paren
id|snd_card_fm801_remove
)paren
comma
)brace
suffix:semicolon
DECL|function|alsa_card_fm801_init
r_static
r_int
id|__init
id|alsa_card_fm801_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_module_init
c_func
(paren
op_amp
id|driver
)paren
)paren
OL
l_int|0
)paren
(brace
macro_line|#ifdef MODULE
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ForteMedia FM801 soundcard not found or device busy&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|alsa_card_fm801_exit
r_static
r_void
id|__exit
id|alsa_card_fm801_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|alsa_card_fm801_init
)paren
id|module_exit
c_func
(paren
id|alsa_card_fm801_exit
)paren
macro_line|#ifndef MODULE
multiline_comment|/* format is: snd-fm801=snd_enable,snd_index,snd_id */
DECL|function|alsa_card_fm801_setup
r_static
r_int
id|__init
id|alsa_card_fm801_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_static
r_int
id|__initdata
id|nr_dev
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|nr_dev
op_ge
id|SNDRV_CARDS
)paren
r_return
l_int|0
suffix:semicolon
(paren
r_void
)paren
(paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_enable
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_index
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_id
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_id
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
)paren
suffix:semicolon
id|nr_dev
op_increment
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;snd-fm801=&quot;
comma
id|alsa_card_fm801_setup
)paren
suffix:semicolon
macro_line|#endif /* ifndef MODULE */
eof
