multiline_comment|/*&n; *  Maintained by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *  Originated by audio@tridentmicro.com&n; *  Fri Feb 19 15:55:28 MST 1999&n; *  Routines for control of Trident 4DWave (DX and NX) chip&n; *&n; *  BUGS:&n; *&n; *  TODO:&n; *    ---&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; *&n; *  SiS7018 S/PDIF support by Thomas Winischhofer &lt;thomas@winischhofer.net&gt;&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/gameport.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#include &lt;sound/control.h&gt;
macro_line|#include &lt;sound/trident.h&gt;
macro_line|#include &lt;sound/asoundef.h&gt;
macro_line|#include &lt;asm/io.h&gt;
DECL|macro|chip_t
mdefine_line|#define chip_t trident_t
r_static
r_int
id|snd_trident_pcm_mixer_build
c_func
(paren
id|trident_t
op_star
id|trident
comma
id|snd_trident_voice_t
op_star
id|voice
comma
id|snd_pcm_substream_t
op_star
id|substream
)paren
suffix:semicolon
r_static
r_int
id|snd_trident_pcm_mixer_free
c_func
(paren
id|trident_t
op_star
id|trident
comma
id|snd_trident_voice_t
op_star
id|voice
comma
id|snd_pcm_substream_t
op_star
id|substream
)paren
suffix:semicolon
r_static
id|irqreturn_t
id|snd_trident_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PM
r_static
r_int
id|snd_trident_set_power_state
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_int
r_int
id|power_state
)paren
suffix:semicolon
macro_line|#endif
r_static
r_int
id|snd_trident_sis_reset
c_func
(paren
id|trident_t
op_star
id|trident
)paren
suffix:semicolon
multiline_comment|/*&n; *  common I/O routines&n; */
macro_line|#if 0
r_static
r_void
id|snd_trident_print_voice_regs
c_func
(paren
id|trident_t
op_star
id|trident
comma
r_int
id|voice
)paren
(brace
r_int
r_int
id|val
comma
id|tmp
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Trident voice %i:&bslash;n&quot;
comma
id|voice
)paren
suffix:semicolon
id|outb
c_func
(paren
id|voice
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_LFO_GC_CIR
)paren
)paren
suffix:semicolon
id|val
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_LBA
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;LBA: 0x%x&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_GVSEL_PAN_VOL_CTRL_EC
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;GVSel: %i&bslash;n&quot;
comma
id|val
op_rshift
l_int|31
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Pan: 0x%x&bslash;n&quot;
comma
(paren
id|val
op_rshift
l_int|24
)paren
op_amp
l_int|0x7f
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Vol: 0x%x&bslash;n&quot;
comma
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;CTRL: 0x%x&bslash;n&quot;
comma
(paren
id|val
op_rshift
l_int|12
)paren
op_amp
l_int|0x0f
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;EC: 0x%x&bslash;n&quot;
comma
id|val
op_amp
l_int|0x0fff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_ne
id|TRIDENT_DEVICE_ID_NX
)paren
(brace
id|val
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_DX_CSO_ALPHA_FMS
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;CSO: 0x%x&bslash;n&quot;
comma
id|val
op_rshift
l_int|16
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Alpha: 0x%x&bslash;n&quot;
comma
(paren
id|val
op_rshift
l_int|4
)paren
op_amp
l_int|0x0fff
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;FMS: 0x%x&bslash;n&quot;
comma
id|val
op_amp
l_int|0x0f
)paren
suffix:semicolon
id|val
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_DX_ESO_DELTA
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;ESO: 0x%x&bslash;n&quot;
comma
id|val
op_rshift
l_int|16
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Delta: 0x%x&bslash;n&quot;
comma
id|val
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|val
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_DX_FMC_RVOL_CVOL
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
singleline_comment|// TRIDENT_DEVICE_ID_NX
id|val
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_NX_DELTA_CSO
)paren
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|val
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;CSO: 0x%x&bslash;n&quot;
comma
id|val
op_amp
l_int|0x00ffffff
)paren
suffix:semicolon
id|val
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_NX_DELTA_ESO
)paren
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xff00
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Delta: 0x%x&bslash;n&quot;
comma
id|tmp
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;ESO: 0x%x&bslash;n&quot;
comma
id|val
op_amp
l_int|0x00ffffff
)paren
suffix:semicolon
id|val
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_NX_ALPHA_FMS_FMC_RVOL_CVOL
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Alpha: 0x%x&bslash;n&quot;
comma
id|val
op_rshift
l_int|20
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;FMS: 0x%x&bslash;n&quot;
comma
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0x0f
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;FMC: 0x%x&bslash;n&quot;
comma
(paren
id|val
op_rshift
l_int|14
)paren
op_amp
l_int|3
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;RVol: 0x%x&bslash;n&quot;
comma
(paren
id|val
op_rshift
l_int|7
)paren
op_amp
l_int|0x7f
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;CVol: 0x%x&bslash;n&quot;
comma
id|val
op_amp
l_int|0x7f
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*---------------------------------------------------------------------------&n;   unsigned short snd_trident_codec_read(ac97_t *ac97, unsigned short reg)&n;  &n;   Description: This routine will do all of the reading from the external&n;                CODEC (AC97).&n;  &n;   Parameters:  ac97 - ac97 codec structure&n;                reg - CODEC register index, from AC97 Hal.&n; &n;   returns:     16 bit value read from the AC97.&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_codec_read
r_static
r_int
r_int
id|snd_trident_codec_read
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
)paren
(brace
r_int
r_int
id|data
op_assign
l_int|0
comma
id|treg
suffix:semicolon
r_int
r_int
id|count
op_assign
l_int|0xffff
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|trident_t
op_star
id|trident
op_assign
id|snd_magic_cast
c_func
(paren
id|trident_t
comma
id|ac97-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_DX
)paren
(brace
id|data
op_assign
(paren
id|DX_AC97_BUSY_READ
op_or
(paren
id|reg
op_amp
l_int|0x000000ff
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|data
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|DX_ACR1_AC97_R
)paren
)paren
suffix:semicolon
r_do
(brace
id|data
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|DX_ACR1_AC97_R
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data
op_amp
id|DX_AC97_BUSY_READ
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|count
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_NX
)paren
(brace
id|data
op_assign
(paren
id|NX_AC97_BUSY_READ
op_or
(paren
id|reg
op_amp
l_int|0x000000ff
)paren
)paren
suffix:semicolon
id|treg
op_assign
id|ac97-&gt;num
op_eq
l_int|0
ques
c_cond
id|NX_ACR2_AC97_R_PRIMARY
suffix:colon
id|NX_ACR3_AC97_R_SECONDARY
suffix:semicolon
id|outl
c_func
(paren
id|data
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|treg
)paren
)paren
suffix:semicolon
r_do
(brace
id|data
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|treg
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data
op_amp
l_int|0x00000C00
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|count
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_SI7018
)paren
(brace
id|data
op_assign
id|SI_AC97_BUSY_READ
op_or
id|SI_AC97_AUDIO_BUSY
op_or
(paren
id|reg
op_amp
l_int|0x000000ff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;num
op_eq
l_int|1
)paren
id|data
op_or_assign
id|SI_AC97_SECONDARY
suffix:semicolon
id|outl
c_func
(paren
id|data
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_AC97_READ
)paren
)paren
suffix:semicolon
r_do
(brace
id|data
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_AC97_READ
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|data
op_amp
(paren
id|SI_AC97_BUSY_READ
)paren
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|count
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|count
op_eq
l_int|0
op_logical_and
op_logical_neg
id|trident-&gt;ac97_detect
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;ac97 codec read TIMEOUT [0x%x/0x%x]!!!&bslash;n&quot;
comma
id|reg
comma
id|data
)paren
suffix:semicolon
id|data
op_assign
l_int|0
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
(paren
(paren
r_int
r_int
)paren
(paren
id|data
op_rshift
l_int|16
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   void snd_trident_codec_write(ac97_t *ac97, unsigned short reg, unsigned short wdata)&n;  &n;   Description: This routine will do all of the writing to the external&n;                CODEC (AC97).&n;  &n;   Parameters:&t;ac97 - ac97 codec structure&n;   &t;        reg - CODEC register index, from AC97 Hal.&n;                data  - Lower 16 bits are the data to write to CODEC.&n;  &n;   returns:     TRUE if everything went ok, else FALSE.&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_codec_write
r_static
r_void
id|snd_trident_codec_write
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|wdata
)paren
(brace
r_int
r_int
id|address
comma
id|data
suffix:semicolon
r_int
r_int
id|count
op_assign
l_int|0xffff
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|trident_t
op_star
id|trident
op_assign
id|snd_magic_cast
c_func
(paren
id|trident_t
comma
id|ac97-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|data
op_assign
(paren
(paren
r_int
r_int
)paren
id|wdata
)paren
op_lshift
l_int|16
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_DX
)paren
(brace
id|address
op_assign
id|DX_ACR0_AC97_W
suffix:semicolon
multiline_comment|/* read AC-97 write register status */
r_do
(brace
r_if
c_cond
(paren
(paren
id|inw
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|address
)paren
)paren
op_amp
id|DX_AC97_BUSY_WRITE
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|count
)paren
suffix:semicolon
id|data
op_or_assign
(paren
id|DX_AC97_BUSY_WRITE
op_or
(paren
id|reg
op_amp
l_int|0x000000ff
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_NX
)paren
(brace
id|address
op_assign
id|NX_ACR1_AC97_W
suffix:semicolon
multiline_comment|/* read AC-97 write register status */
r_do
(brace
r_if
c_cond
(paren
(paren
id|inw
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|address
)paren
)paren
op_amp
id|NX_AC97_BUSY_WRITE
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|count
)paren
suffix:semicolon
id|data
op_or_assign
(paren
id|NX_AC97_BUSY_WRITE
op_or
(paren
id|ac97-&gt;num
op_lshift
l_int|8
)paren
op_or
(paren
id|reg
op_amp
l_int|0x000000ff
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_SI7018
)paren
(brace
id|address
op_assign
id|SI_AC97_WRITE
suffix:semicolon
multiline_comment|/* read AC-97 write register status */
r_do
(brace
r_if
c_cond
(paren
(paren
id|inw
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|address
)paren
)paren
op_amp
(paren
id|SI_AC97_BUSY_WRITE
)paren
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|count
)paren
suffix:semicolon
id|data
op_or_assign
id|SI_AC97_BUSY_WRITE
op_or
id|SI_AC97_AUDIO_BUSY
op_or
(paren
id|reg
op_amp
l_int|0x000000ff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;num
op_eq
l_int|1
)paren
id|data
op_or_assign
id|SI_AC97_SECONDARY
suffix:semicolon
)brace
r_else
(brace
id|address
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* keep GCC happy */
id|count
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* return */
)brace
r_if
c_cond
(paren
id|count
op_eq
l_int|0
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|outl
c_func
(paren
id|data
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|address
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   void snd_trident_enable_eso(trident_t *trident)&n;  &n;   Description: This routine will enable end of loop interrupts.&n;                End of loop interrupts will occur when a running&n;                channel reaches ESO.&n;                Also enables middle of loop interrupts.&n;  &n;   Parameters:  trident - pointer to target device class for 4DWave.&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_enable_eso
r_static
r_void
id|snd_trident_enable_eso
c_func
(paren
id|trident_t
op_star
id|trident
)paren
(brace
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_LFO_GC_CIR
)paren
)paren
suffix:semicolon
id|val
op_or_assign
id|ENDLP_IE
suffix:semicolon
id|val
op_or_assign
id|MIDLP_IE
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_SI7018
)paren
id|val
op_or_assign
id|BANK_B_EN
suffix:semicolon
id|outl
c_func
(paren
id|val
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_LFO_GC_CIR
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   void snd_trident_disable_eso(trident_t *trident)&n;  &n;   Description: This routine will disable end of loop interrupts.&n;                End of loop interrupts will occur when a running&n;                channel reaches ESO.&n;                Also disables middle of loop interrupts.&n;  &n;   Parameters:  &n;                trident - pointer to target device class for 4DWave.&n;  &n;   returns:     TRUE if everything went ok, else FALSE.&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_disable_eso
r_static
r_void
id|snd_trident_disable_eso
c_func
(paren
id|trident_t
op_star
id|trident
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
id|tmp
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_LFO_GC_CIR
)paren
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|ENDLP_IE
suffix:semicolon
id|tmp
op_and_assign
op_complement
id|MIDLP_IE
suffix:semicolon
id|outl
c_func
(paren
id|tmp
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_LFO_GC_CIR
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   void snd_trident_start_voice(trident_t * trident, unsigned int voice)&n;&n;    Description: Start a voice, any channel 0 thru 63.&n;                 This routine automatically handles the fact that there are&n;                 more than 32 channels available.&n;&n;    Parameters : voice - Voice number 0 thru n.&n;                 trident - pointer to target device class for 4DWave.&n;&n;    Return Value: None.&n;&n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_start_voice
r_void
id|snd_trident_start_voice
c_func
(paren
id|trident_t
op_star
id|trident
comma
r_int
r_int
id|voice
)paren
(brace
r_int
r_int
id|mask
op_assign
l_int|1
op_lshift
(paren
id|voice
op_amp
l_int|0x1f
)paren
suffix:semicolon
r_int
r_int
id|reg
op_assign
(paren
id|voice
op_amp
l_int|0x20
)paren
ques
c_cond
id|T4D_START_B
suffix:colon
id|T4D_START_A
suffix:semicolon
id|outl
c_func
(paren
id|mask
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|reg
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   void snd_trident_stop_voice(trident_t * trident, unsigned int voice)&n;&n;    Description: Stop a voice, any channel 0 thru 63.&n;                 This routine automatically handles the fact that there are&n;                 more than 32 channels available.&n;&n;    Parameters : voice - Voice number 0 thru n.&n;                 trident - pointer to target device class for 4DWave.&n;&n;    Return Value: None.&n;&n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_stop_voice
r_void
id|snd_trident_stop_voice
c_func
(paren
id|trident_t
op_star
id|trident
comma
r_int
r_int
id|voice
)paren
(brace
r_int
r_int
id|mask
op_assign
l_int|1
op_lshift
(paren
id|voice
op_amp
l_int|0x1f
)paren
suffix:semicolon
r_int
r_int
id|reg
op_assign
(paren
id|voice
op_amp
l_int|0x20
)paren
ques
c_cond
id|T4D_STOP_B
suffix:colon
id|T4D_STOP_A
suffix:semicolon
id|outl
c_func
(paren
id|mask
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|reg
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;    int snd_trident_allocate_pcm_channel(trident_t *trident)&n;  &n;    Description: Allocate hardware channel in Bank B (32-63).&n;  &n;    Parameters :  trident - pointer to target device class for 4DWave.&n;  &n;    Return Value: hardware channel - 32-63 or -1 when no channel is available&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_allocate_pcm_channel
r_static
r_int
id|snd_trident_allocate_pcm_channel
c_func
(paren
id|trident_t
op_star
id|trident
)paren
(brace
r_int
id|idx
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;ChanPCMcnt
op_ge
id|trident-&gt;ChanPCM
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|31
suffix:semicolon
id|idx
op_ge
l_int|0
suffix:semicolon
id|idx
op_decrement
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|trident-&gt;ChanMap
(braket
id|T4D_BANK_B
)braket
op_amp
(paren
l_int|1
op_lshift
id|idx
)paren
)paren
)paren
(brace
id|trident-&gt;ChanMap
(braket
id|T4D_BANK_B
)braket
op_or_assign
l_int|1
op_lshift
id|idx
suffix:semicolon
id|trident-&gt;ChanPCMcnt
op_increment
suffix:semicolon
r_return
id|idx
op_plus
l_int|32
suffix:semicolon
)brace
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;    void snd_trident_free_pcm_channel(int channel)&n;  &n;    Description: Free hardware channel in Bank B (32-63)&n;  &n;    Parameters :  trident - pointer to target device class for 4DWave.&n;&t;          channel - hardware channel number 0-63&n;  &n;    Return Value: none&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_free_pcm_channel
r_static
r_void
id|snd_trident_free_pcm_channel
c_func
(paren
id|trident_t
op_star
id|trident
comma
r_int
id|channel
)paren
(brace
r_if
c_cond
(paren
id|channel
template_param
l_int|63
)paren
r_return
suffix:semicolon
id|channel
op_and_assign
l_int|0x1f
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;ChanMap
(braket
id|T4D_BANK_B
)braket
op_amp
(paren
l_int|1
op_lshift
id|channel
)paren
)paren
(brace
id|trident-&gt;ChanMap
(braket
id|T4D_BANK_B
)braket
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|channel
)paren
suffix:semicolon
id|trident-&gt;ChanPCMcnt
op_decrement
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;    unsigned int snd_trident_allocate_synth_channel(void)&n;  &n;    Description: Allocate hardware channel in Bank A (0-31).&n;  &n;    Parameters :  trident - pointer to target device class for 4DWave.&n;  &n;    Return Value: hardware channel - 0-31 or -1 when no channel is available&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_allocate_synth_channel
r_static
r_int
id|snd_trident_allocate_synth_channel
c_func
(paren
id|trident_t
op_star
id|trident
)paren
(brace
r_int
id|idx
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|31
suffix:semicolon
id|idx
op_ge
l_int|0
suffix:semicolon
id|idx
op_decrement
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|trident-&gt;ChanMap
(braket
id|T4D_BANK_A
)braket
op_amp
(paren
l_int|1
op_lshift
id|idx
)paren
)paren
)paren
(brace
id|trident-&gt;ChanMap
(braket
id|T4D_BANK_A
)braket
op_or_assign
l_int|1
op_lshift
id|idx
suffix:semicolon
id|trident-&gt;synth.ChanSynthCount
op_increment
suffix:semicolon
r_return
id|idx
suffix:semicolon
)brace
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;    void snd_trident_free_synth_channel( int channel )&n;  &n;    Description: Free hardware channel in Bank B (0-31).&n;  &n;    Parameters :  trident - pointer to target device class for 4DWave.&n;&t;          channel - hardware channel number 0-63&n;  &n;    Return Value: none&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_free_synth_channel
r_static
r_void
id|snd_trident_free_synth_channel
c_func
(paren
id|trident_t
op_star
id|trident
comma
r_int
id|channel
)paren
(brace
r_if
c_cond
(paren
id|channel
template_param
l_int|31
)paren
r_return
suffix:semicolon
id|channel
op_and_assign
l_int|0x1f
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;ChanMap
(braket
id|T4D_BANK_A
)braket
op_amp
(paren
l_int|1
op_lshift
id|channel
)paren
)paren
(brace
id|trident-&gt;ChanMap
(braket
id|T4D_BANK_A
)braket
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|channel
)paren
suffix:semicolon
id|trident-&gt;synth.ChanSynthCount
op_decrement
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_write_voice_regs&n;  &n;   Description: This routine will complete and write the 5 hardware channel&n;                registers to hardware.&n;  &n;   Paramters:   trident - pointer to target device class for 4DWave.&n;                voice - synthesizer voice structure&n;                Each register field.&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_write_voice_regs
r_void
id|snd_trident_write_voice_regs
c_func
(paren
id|trident_t
op_star
id|trident
comma
id|snd_trident_voice_t
op_star
id|voice
)paren
(brace
r_int
r_int
id|FmcRvolCvol
suffix:semicolon
r_int
r_int
id|regs
(braket
l_int|5
)braket
suffix:semicolon
id|regs
(braket
l_int|1
)braket
op_assign
id|voice-&gt;LBA
suffix:semicolon
id|regs
(braket
l_int|4
)braket
op_assign
(paren
id|voice-&gt;GVSel
op_lshift
l_int|31
)paren
op_or
(paren
(paren
id|voice-&gt;Pan
op_amp
l_int|0x0000007f
)paren
op_lshift
l_int|24
)paren
op_or
(paren
(paren
id|voice-&gt;CTRL
op_amp
l_int|0x0000000f
)paren
op_lshift
l_int|12
)paren
suffix:semicolon
id|FmcRvolCvol
op_assign
(paren
(paren
id|voice-&gt;FMC
op_amp
l_int|3
)paren
op_lshift
l_int|14
)paren
op_or
(paren
(paren
id|voice-&gt;RVol
op_amp
l_int|0x7f
)paren
op_lshift
l_int|7
)paren
op_or
(paren
id|voice-&gt;CVol
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|trident-&gt;device
)paren
(brace
r_case
id|TRIDENT_DEVICE_ID_SI7018
suffix:colon
id|regs
(braket
l_int|4
)braket
op_or_assign
id|voice-&gt;number
OG
l_int|31
ques
c_cond
(paren
id|voice-&gt;Vol
op_amp
l_int|0x000003ff
)paren
suffix:colon
(paren
(paren
id|voice-&gt;Vol
op_amp
l_int|0x00003fc
)paren
op_lshift
(paren
l_int|16
op_minus
l_int|2
)paren
)paren
op_or
(paren
id|voice-&gt;EC
op_amp
l_int|0x00000fff
)paren
suffix:semicolon
id|regs
(braket
l_int|0
)braket
op_assign
(paren
id|voice-&gt;CSO
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|voice-&gt;Alpha
op_amp
l_int|0x00000fff
)paren
op_lshift
l_int|4
)paren
op_or
(paren
id|voice-&gt;FMS
op_amp
l_int|0x0000000f
)paren
suffix:semicolon
id|regs
(braket
l_int|2
)braket
op_assign
(paren
id|voice-&gt;ESO
op_lshift
l_int|16
)paren
op_or
(paren
id|voice-&gt;Delta
op_amp
l_int|0x0ffff
)paren
suffix:semicolon
id|regs
(braket
l_int|3
)braket
op_assign
(paren
id|voice-&gt;Attribute
op_lshift
l_int|16
)paren
op_or
id|FmcRvolCvol
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TRIDENT_DEVICE_ID_DX
suffix:colon
id|regs
(braket
l_int|4
)braket
op_or_assign
(paren
(paren
id|voice-&gt;Vol
op_amp
l_int|0x000003fc
)paren
op_lshift
(paren
l_int|16
op_minus
l_int|2
)paren
)paren
op_or
(paren
id|voice-&gt;EC
op_amp
l_int|0x00000fff
)paren
suffix:semicolon
id|regs
(braket
l_int|0
)braket
op_assign
(paren
id|voice-&gt;CSO
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|voice-&gt;Alpha
op_amp
l_int|0x00000fff
)paren
op_lshift
l_int|4
)paren
op_or
(paren
id|voice-&gt;FMS
op_amp
l_int|0x0000000f
)paren
suffix:semicolon
id|regs
(braket
l_int|2
)braket
op_assign
(paren
id|voice-&gt;ESO
op_lshift
l_int|16
)paren
op_or
(paren
id|voice-&gt;Delta
op_amp
l_int|0x0ffff
)paren
suffix:semicolon
id|regs
(braket
l_int|3
)braket
op_assign
id|FmcRvolCvol
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TRIDENT_DEVICE_ID_NX
suffix:colon
id|regs
(braket
l_int|4
)braket
op_or_assign
(paren
(paren
id|voice-&gt;Vol
op_amp
l_int|0x000003fc
)paren
op_lshift
(paren
l_int|16
op_minus
l_int|2
)paren
)paren
op_or
(paren
id|voice-&gt;EC
op_amp
l_int|0x00000fff
)paren
suffix:semicolon
id|regs
(braket
l_int|0
)braket
op_assign
(paren
id|voice-&gt;Delta
op_lshift
l_int|24
)paren
op_or
(paren
id|voice-&gt;CSO
op_amp
l_int|0x00ffffff
)paren
suffix:semicolon
id|regs
(braket
l_int|2
)braket
op_assign
(paren
(paren
id|voice-&gt;Delta
op_lshift
l_int|16
)paren
op_amp
l_int|0xff000000
)paren
op_or
(paren
id|voice-&gt;ESO
op_amp
l_int|0x00ffffff
)paren
suffix:semicolon
id|regs
(braket
l_int|3
)braket
op_assign
(paren
id|voice-&gt;Alpha
op_lshift
l_int|20
)paren
op_or
(paren
(paren
id|voice-&gt;FMS
op_amp
l_int|0x0000000f
)paren
op_lshift
l_int|16
)paren
op_or
id|FmcRvolCvol
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|snd_BUG
c_func
(paren
)paren
suffix:semicolon
)brace
id|outb
c_func
(paren
id|voice-&gt;number
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_LFO_GC_CIR
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|regs
(braket
l_int|0
)braket
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_START
op_plus
l_int|0
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|regs
(braket
l_int|1
)braket
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_START
op_plus
l_int|4
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|regs
(braket
l_int|2
)braket
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_START
op_plus
l_int|8
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|regs
(braket
l_int|3
)braket
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_START
op_plus
l_int|12
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|regs
(braket
l_int|4
)braket
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_START
op_plus
l_int|16
)paren
)paren
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;written %i channel:&bslash;n&quot;
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  regs[0] = 0x%x/0x%x&bslash;n&quot;
comma
id|regs
(braket
l_int|0
)braket
comma
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_START
op_plus
l_int|0
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  regs[1] = 0x%x/0x%x&bslash;n&quot;
comma
id|regs
(braket
l_int|1
)braket
comma
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_START
op_plus
l_int|4
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  regs[2] = 0x%x/0x%x&bslash;n&quot;
comma
id|regs
(braket
l_int|2
)braket
comma
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_START
op_plus
l_int|8
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  regs[3] = 0x%x/0x%x&bslash;n&quot;
comma
id|regs
(braket
l_int|3
)braket
comma
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_START
op_plus
l_int|12
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  regs[4] = 0x%x/0x%x&bslash;n&quot;
comma
id|regs
(braket
l_int|4
)braket
comma
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_START
op_plus
l_int|16
)paren
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_write_cso_reg&n;  &n;   Description: This routine will write the new CSO offset&n;                register to hardware.&n;  &n;   Paramters:   trident - pointer to target device class for 4DWave.&n;                voice - synthesizer voice structure&n;                CSO - new CSO value&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_write_cso_reg
r_static
r_void
id|snd_trident_write_cso_reg
c_func
(paren
id|trident_t
op_star
id|trident
comma
id|snd_trident_voice_t
op_star
id|voice
comma
r_int
r_int
id|CSO
)paren
(brace
id|voice-&gt;CSO
op_assign
id|CSO
suffix:semicolon
id|outb
c_func
(paren
id|voice-&gt;number
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_LFO_GC_CIR
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_ne
id|TRIDENT_DEVICE_ID_NX
)paren
(brace
id|outw
c_func
(paren
id|voice-&gt;CSO
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_DX_CSO_ALPHA_FMS
)paren
op_plus
l_int|2
)paren
suffix:semicolon
)brace
r_else
(brace
id|outl
c_func
(paren
(paren
id|voice-&gt;Delta
op_lshift
l_int|24
)paren
op_or
(paren
id|voice-&gt;CSO
op_amp
l_int|0x00ffffff
)paren
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_NX_DELTA_CSO
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_write_eso_reg&n;  &n;   Description: This routine will write the new ESO offset&n;                register to hardware.&n;  &n;   Paramters:   trident - pointer to target device class for 4DWave.&n;                voice - synthesizer voice structure&n;                ESO - new ESO value&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_write_eso_reg
r_static
r_void
id|snd_trident_write_eso_reg
c_func
(paren
id|trident_t
op_star
id|trident
comma
id|snd_trident_voice_t
op_star
id|voice
comma
r_int
r_int
id|ESO
)paren
(brace
id|voice-&gt;ESO
op_assign
id|ESO
suffix:semicolon
id|outb
c_func
(paren
id|voice-&gt;number
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_LFO_GC_CIR
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_ne
id|TRIDENT_DEVICE_ID_NX
)paren
(brace
id|outw
c_func
(paren
id|voice-&gt;ESO
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_DX_ESO_DELTA
)paren
op_plus
l_int|2
)paren
suffix:semicolon
)brace
r_else
(brace
id|outl
c_func
(paren
(paren
(paren
id|voice-&gt;Delta
op_lshift
l_int|16
)paren
op_amp
l_int|0xff000000
)paren
op_or
(paren
id|voice-&gt;ESO
op_amp
l_int|0x00ffffff
)paren
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_NX_DELTA_ESO
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_write_vol_reg&n;  &n;   Description: This routine will write the new voice volume&n;                register to hardware.&n;  &n;   Paramters:   trident - pointer to target device class for 4DWave.&n;                voice - synthesizer voice structure&n;                Vol - new voice volume&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_write_vol_reg
r_static
r_void
id|snd_trident_write_vol_reg
c_func
(paren
id|trident_t
op_star
id|trident
comma
id|snd_trident_voice_t
op_star
id|voice
comma
r_int
r_int
id|Vol
)paren
(brace
id|voice-&gt;Vol
op_assign
id|Vol
suffix:semicolon
id|outb
c_func
(paren
id|voice-&gt;number
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_LFO_GC_CIR
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|trident-&gt;device
)paren
(brace
r_case
id|TRIDENT_DEVICE_ID_DX
suffix:colon
r_case
id|TRIDENT_DEVICE_ID_NX
suffix:colon
id|outb
c_func
(paren
id|voice-&gt;Vol
op_rshift
l_int|2
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_GVSEL_PAN_VOL_CTRL_EC
op_plus
l_int|2
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TRIDENT_DEVICE_ID_SI7018
suffix:colon
singleline_comment|// printk(&quot;voice-&gt;Vol = 0x%x&bslash;n&quot;, voice-&gt;Vol);
id|outw
c_func
(paren
(paren
id|voice-&gt;CTRL
op_lshift
l_int|12
)paren
op_or
id|voice-&gt;Vol
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_GVSEL_PAN_VOL_CTRL_EC
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_write_pan_reg&n;  &n;   Description: This routine will write the new voice pan&n;                register to hardware.&n;  &n;   Paramters:   trident - pointer to target device class for 4DWave.&n;                voice - synthesizer voice structure&n;                Pan - new pan value&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_write_pan_reg
r_static
r_void
id|snd_trident_write_pan_reg
c_func
(paren
id|trident_t
op_star
id|trident
comma
id|snd_trident_voice_t
op_star
id|voice
comma
r_int
r_int
id|Pan
)paren
(brace
id|voice-&gt;Pan
op_assign
id|Pan
suffix:semicolon
id|outb
c_func
(paren
id|voice-&gt;number
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_LFO_GC_CIR
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
(paren
id|voice-&gt;GVSel
op_amp
l_int|0x01
)paren
op_lshift
l_int|7
)paren
op_or
(paren
id|voice-&gt;Pan
op_amp
l_int|0x7f
)paren
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_GVSEL_PAN_VOL_CTRL_EC
op_plus
l_int|3
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_write_rvol_reg&n;  &n;   Description: This routine will write the new reverb volume&n;                register to hardware.&n;  &n;   Paramters:   trident - pointer to target device class for 4DWave.&n;                voice - synthesizer voice structure&n;                RVol - new reverb volume&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_write_rvol_reg
r_static
r_void
id|snd_trident_write_rvol_reg
c_func
(paren
id|trident_t
op_star
id|trident
comma
id|snd_trident_voice_t
op_star
id|voice
comma
r_int
r_int
id|RVol
)paren
(brace
id|voice-&gt;RVol
op_assign
id|RVol
suffix:semicolon
id|outb
c_func
(paren
id|voice-&gt;number
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_LFO_GC_CIR
)paren
)paren
suffix:semicolon
id|outw
c_func
(paren
(paren
(paren
id|voice-&gt;FMC
op_amp
l_int|0x0003
)paren
op_lshift
l_int|14
)paren
op_or
(paren
(paren
id|voice-&gt;RVol
op_amp
l_int|0x007f
)paren
op_lshift
l_int|7
)paren
op_or
(paren
id|voice-&gt;CVol
op_amp
l_int|0x007f
)paren
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_NX
ques
c_cond
id|CH_NX_ALPHA_FMS_FMC_RVOL_CVOL
suffix:colon
id|CH_DX_FMC_RVOL_CVOL
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_write_cvol_reg&n;  &n;   Description: This routine will write the new chorus volume&n;                register to hardware.&n;  &n;   Paramters:   trident - pointer to target device class for 4DWave.&n;                voice - synthesizer voice structure&n;                CVol - new chorus volume&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_write_cvol_reg
r_static
r_void
id|snd_trident_write_cvol_reg
c_func
(paren
id|trident_t
op_star
id|trident
comma
id|snd_trident_voice_t
op_star
id|voice
comma
r_int
r_int
id|CVol
)paren
(brace
id|voice-&gt;CVol
op_assign
id|CVol
suffix:semicolon
id|outb
c_func
(paren
id|voice-&gt;number
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_LFO_GC_CIR
)paren
)paren
suffix:semicolon
id|outw
c_func
(paren
(paren
(paren
id|voice-&gt;FMC
op_amp
l_int|0x0003
)paren
op_lshift
l_int|14
)paren
op_or
(paren
(paren
id|voice-&gt;RVol
op_amp
l_int|0x007f
)paren
op_lshift
l_int|7
)paren
op_or
(paren
id|voice-&gt;CVol
op_amp
l_int|0x007f
)paren
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_NX
ques
c_cond
id|CH_NX_ALPHA_FMS_FMC_RVOL_CVOL
suffix:colon
id|CH_DX_FMC_RVOL_CVOL
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_convert_rate&n;&n;   Description: This routine converts rate in HZ to hardware delta value.&n;  &n;   Paramters:   trident - pointer to target device class for 4DWave.&n;                rate - Real or Virtual channel number.&n;  &n;   Returns:     Delta value.&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_convert_rate
r_int
r_int
id|snd_trident_convert_rate
c_func
(paren
r_int
r_int
id|rate
)paren
(brace
r_int
r_int
id|delta
suffix:semicolon
singleline_comment|// We special case 44100 and 8000 since rounding with the equation
singleline_comment|// does not give us an accurate enough value. For 11025 and 22050
singleline_comment|// the equation gives us the best answer. All other frequencies will
singleline_comment|// also use the equation. JDW
r_if
c_cond
(paren
id|rate
op_eq
l_int|44100
)paren
id|delta
op_assign
l_int|0xeb3
suffix:semicolon
r_else
r_if
c_cond
(paren
id|rate
op_eq
l_int|8000
)paren
id|delta
op_assign
l_int|0x2ab
suffix:semicolon
r_else
r_if
c_cond
(paren
id|rate
op_eq
l_int|48000
)paren
id|delta
op_assign
l_int|0x1000
suffix:semicolon
r_else
id|delta
op_assign
(paren
(paren
(paren
id|rate
op_lshift
l_int|12
)paren
op_plus
l_int|24000
)paren
op_div
l_int|48000
)paren
op_amp
l_int|0x0000ffff
suffix:semicolon
r_return
id|delta
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_convert_adc_rate&n;&n;   Description: This routine converts rate in HZ to hardware delta value.&n;  &n;   Paramters:   trident - pointer to target device class for 4DWave.&n;                rate - Real or Virtual channel number.&n;  &n;   Returns:     Delta value.&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_convert_adc_rate
r_static
r_int
r_int
id|snd_trident_convert_adc_rate
c_func
(paren
r_int
r_int
id|rate
)paren
(brace
r_int
r_int
id|delta
suffix:semicolon
singleline_comment|// We special case 44100 and 8000 since rounding with the equation
singleline_comment|// does not give us an accurate enough value. For 11025 and 22050
singleline_comment|// the equation gives us the best answer. All other frequencies will
singleline_comment|// also use the equation. JDW
r_if
c_cond
(paren
id|rate
op_eq
l_int|44100
)paren
id|delta
op_assign
l_int|0x116a
suffix:semicolon
r_else
r_if
c_cond
(paren
id|rate
op_eq
l_int|8000
)paren
id|delta
op_assign
l_int|0x6000
suffix:semicolon
r_else
r_if
c_cond
(paren
id|rate
op_eq
l_int|48000
)paren
id|delta
op_assign
l_int|0x1000
suffix:semicolon
r_else
id|delta
op_assign
(paren
(paren
l_int|48000
op_lshift
l_int|12
)paren
op_div
id|rate
)paren
op_amp
l_int|0x0000ffff
suffix:semicolon
r_return
id|delta
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_spurious_threshold&n;&n;   Description: This routine converts rate in HZ to spurious threshold.&n;  &n;   Paramters:   trident - pointer to target device class for 4DWave.&n;                rate - Real or Virtual channel number.&n;  &n;   Returns:     Delta value.&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_spurious_threshold
r_int
r_int
id|snd_trident_spurious_threshold
c_func
(paren
r_int
r_int
id|rate
comma
r_int
r_int
id|period_size
)paren
(brace
r_int
r_int
id|res
op_assign
(paren
id|rate
op_star
id|period_size
)paren
op_div
l_int|48000
suffix:semicolon
r_if
c_cond
(paren
id|res
OL
l_int|64
)paren
id|res
op_assign
id|res
op_div
l_int|2
suffix:semicolon
r_else
id|res
op_sub_assign
l_int|32
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_control_mode&n;&n;   Description: This routine returns a control mode for a PCM channel.&n;  &n;   Paramters:   trident - pointer to target device class for 4DWave.&n;                substream  - PCM substream&n;  &n;   Returns:     Control value.&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_control_mode
r_int
r_int
id|snd_trident_control_mode
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|CTRL
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
multiline_comment|/* set ctrl mode&n;&t;   CTRL default: 8-bit (unsigned) mono, loop mode enabled&n;&t; */
id|CTRL
op_assign
l_int|0x00000001
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|16
)paren
id|CTRL
op_or_assign
l_int|0x00000008
suffix:semicolon
singleline_comment|// 16-bit data
r_if
c_cond
(paren
id|snd_pcm_format_signed
c_func
(paren
id|runtime-&gt;format
)paren
)paren
id|CTRL
op_or_assign
l_int|0x00000002
suffix:semicolon
singleline_comment|// signed data
r_if
c_cond
(paren
id|runtime-&gt;channels
OG
l_int|1
)paren
id|CTRL
op_or_assign
l_int|0x00000004
suffix:semicolon
singleline_comment|// stereo data
r_return
id|CTRL
suffix:semicolon
)brace
multiline_comment|/*&n; *  PCM part&n; */
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_ioctl&n;  &n;   Description: Device I/O control handler for playback/capture parameters.&n;  &n;   Paramters:   substream  - PCM substream class&n;                cmd     - what ioctl message to process&n;                arg     - additional message infoarg     &n;  &n;   Returns:     Error status&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_ioctl
r_static
r_int
id|snd_trident_ioctl
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
r_int
id|cmd
comma
r_void
op_star
id|arg
)paren
(brace
multiline_comment|/* FIXME: it seems that with small periods the behaviour of&n;&t;          trident hardware is unpredictable and interrupt generator&n;&t;          is broken */
r_return
id|snd_pcm_lib_ioctl
c_func
(paren
id|substream
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_allocate_pcm_mem&n;  &n;   Description: Allocate PCM ring buffer for given substream&n;  &n;   Parameters:  substream  - PCM substream class&n;&t;&t;hw_params  - hardware parameters&n;  &n;   Returns:     Error status&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_allocate_pcm_mem
r_int
id|snd_trident_allocate_pcm_mem
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_trident_voice_t
op_star
id|voice
op_assign
(paren
id|snd_trident_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;tlb.entries
)paren
(brace
r_if
c_cond
(paren
id|err
OG
l_int|0
)paren
(brace
multiline_comment|/* change */
r_if
c_cond
(paren
id|voice-&gt;memblk
)paren
id|snd_trident_free_pages
c_func
(paren
id|trident
comma
id|voice-&gt;memblk
)paren
suffix:semicolon
id|voice-&gt;memblk
op_assign
id|snd_trident_alloc_pages
c_func
(paren
id|trident
comma
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;memblk
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_allocate_evoice&n;  &n;   Description: Allocate extra voice as interrupt generator&n;  &n;   Parameters:  substream  - PCM substream class&n;&t;&t;hw_params  - hardware parameters&n;  &n;   Returns:     Error status&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_allocate_evoice
r_int
id|snd_trident_allocate_evoice
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_trident_voice_t
op_star
id|voice
op_assign
(paren
id|snd_trident_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
id|snd_trident_voice_t
op_star
id|evoice
op_assign
id|voice-&gt;extra
suffix:semicolon
multiline_comment|/* voice management */
r_if
c_cond
(paren
id|params_buffer_size
c_func
(paren
id|hw_params
)paren
op_div
l_int|2
op_ne
id|params_period_size
c_func
(paren
id|hw_params
)paren
)paren
(brace
r_if
c_cond
(paren
id|evoice
op_eq
l_int|NULL
)paren
(brace
id|evoice
op_assign
id|snd_trident_alloc_voice
c_func
(paren
id|trident
comma
id|SNDRV_TRIDENT_VOICE_TYPE_PCM
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|evoice
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|voice-&gt;extra
op_assign
id|evoice
suffix:semicolon
id|evoice-&gt;substream
op_assign
id|substream
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|evoice
op_ne
l_int|NULL
)paren
(brace
id|snd_trident_free_voice
c_func
(paren
id|trident
comma
id|evoice
)paren
suffix:semicolon
id|voice-&gt;extra
op_assign
id|evoice
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_hw_params&n;  &n;   Description: Set the hardware parameters for the playback device.&n;  &n;   Parameters:  substream  - PCM substream class&n;&t;&t;hw_params  - hardware parameters&n;  &n;   Returns:     Error status&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_hw_params
r_static
r_int
id|snd_trident_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
r_int
id|err
suffix:semicolon
id|err
op_assign
id|snd_trident_allocate_pcm_mem
c_func
(paren
id|substream
comma
id|hw_params
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ge
l_int|0
)paren
id|err
op_assign
id|snd_trident_allocate_evoice
c_func
(paren
id|substream
comma
id|hw_params
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_playback_hw_free&n;  &n;   Description: Release the hardware resources for the playback device.&n;  &n;   Parameters:  substream  - PCM substream class&n;  &n;   Returns:     Error status&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_hw_free
r_static
r_int
id|snd_trident_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_trident_voice_t
op_star
id|voice
op_assign
(paren
id|snd_trident_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
id|snd_trident_voice_t
op_star
id|evoice
op_assign
id|voice
ques
c_cond
id|voice-&gt;extra
suffix:colon
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;tlb.entries
)paren
(brace
r_if
c_cond
(paren
id|voice
op_logical_and
id|voice-&gt;memblk
)paren
(brace
id|snd_trident_free_pages
c_func
(paren
id|trident
comma
id|voice-&gt;memblk
)paren
suffix:semicolon
id|voice-&gt;memblk
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|evoice
op_ne
l_int|NULL
)paren
(brace
id|snd_trident_free_voice
c_func
(paren
id|trident
comma
id|evoice
)paren
suffix:semicolon
id|voice-&gt;extra
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_playback_prepare&n;  &n;   Description: Prepare playback device for playback.&n;  &n;   Parameters:  substream  - PCM substream class&n;  &n;   Returns:     Error status&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_playback_prepare
r_static
r_int
id|snd_trident_playback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_trident_voice_t
op_star
id|voice
op_assign
(paren
id|snd_trident_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
id|snd_trident_voice_t
op_star
id|evoice
op_assign
id|voice-&gt;extra
suffix:semicolon
id|snd_trident_pcm_mixer_t
op_star
id|mix
op_assign
op_amp
id|trident-&gt;pcm_mixer
(braket
id|substream-&gt;number
)braket
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
multiline_comment|/* set delta (rate) value */
id|voice-&gt;Delta
op_assign
id|snd_trident_convert_rate
c_func
(paren
id|runtime-&gt;rate
)paren
suffix:semicolon
id|voice-&gt;spurious_threshold
op_assign
id|snd_trident_spurious_threshold
c_func
(paren
id|runtime-&gt;rate
comma
id|runtime-&gt;period_size
)paren
suffix:semicolon
multiline_comment|/* set Loop Begin Address */
r_if
c_cond
(paren
id|voice-&gt;memblk
)paren
id|voice-&gt;LBA
op_assign
id|voice-&gt;memblk-&gt;offset
suffix:semicolon
r_else
id|voice-&gt;LBA
op_assign
id|runtime-&gt;dma_addr
suffix:semicolon
id|voice-&gt;CSO
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;ESO
op_assign
id|runtime-&gt;buffer_size
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* in samples */
id|voice-&gt;CTRL
op_assign
id|snd_trident_control_mode
c_func
(paren
id|substream
)paren
suffix:semicolon
id|voice-&gt;FMC
op_assign
l_int|3
suffix:semicolon
id|voice-&gt;GVSel
op_assign
l_int|1
suffix:semicolon
id|voice-&gt;EC
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;Alpha
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;FMS
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;Vol
op_assign
id|mix-&gt;vol
suffix:semicolon
id|voice-&gt;RVol
op_assign
id|mix-&gt;rvol
suffix:semicolon
id|voice-&gt;CVol
op_assign
id|mix-&gt;cvol
suffix:semicolon
id|voice-&gt;Pan
op_assign
id|mix-&gt;pan
suffix:semicolon
id|voice-&gt;Attribute
op_assign
l_int|0
suffix:semicolon
macro_line|#if 0
id|voice-&gt;Attribute
op_assign
(paren
l_int|1
op_lshift
(paren
l_int|30
op_minus
l_int|16
)paren
)paren
op_or
(paren
l_int|2
op_lshift
(paren
l_int|26
op_minus
l_int|16
)paren
)paren
op_or
(paren
l_int|0
op_lshift
(paren
l_int|24
op_minus
l_int|16
)paren
)paren
op_or
(paren
l_int|0x1f
op_lshift
(paren
l_int|19
op_minus
l_int|16
)paren
)paren
suffix:semicolon
macro_line|#else
id|voice-&gt;Attribute
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|snd_trident_write_voice_regs
c_func
(paren
id|trident
comma
id|voice
)paren
suffix:semicolon
r_if
c_cond
(paren
id|evoice
op_ne
l_int|NULL
)paren
(brace
id|evoice-&gt;Delta
op_assign
id|voice-&gt;Delta
suffix:semicolon
id|evoice-&gt;spurious_threshold
op_assign
id|voice-&gt;spurious_threshold
suffix:semicolon
id|evoice-&gt;LBA
op_assign
id|voice-&gt;LBA
suffix:semicolon
id|evoice-&gt;CSO
op_assign
l_int|0
suffix:semicolon
id|evoice-&gt;ESO
op_assign
(paren
id|runtime-&gt;period_size
op_star
l_int|2
)paren
op_plus
l_int|4
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* in samples */
id|evoice-&gt;CTRL
op_assign
id|voice-&gt;CTRL
suffix:semicolon
id|evoice-&gt;FMC
op_assign
l_int|3
suffix:semicolon
id|evoice-&gt;GVSel
op_assign
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_SI7018
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|evoice-&gt;EC
op_assign
l_int|0
suffix:semicolon
id|evoice-&gt;Alpha
op_assign
l_int|0
suffix:semicolon
id|evoice-&gt;FMS
op_assign
l_int|0
suffix:semicolon
id|evoice-&gt;Vol
op_assign
l_int|0x3ff
suffix:semicolon
multiline_comment|/* mute */
id|evoice-&gt;RVol
op_assign
id|evoice-&gt;CVol
op_assign
l_int|0x7f
suffix:semicolon
multiline_comment|/* mute */
id|evoice-&gt;Pan
op_assign
l_int|0x7f
suffix:semicolon
multiline_comment|/* mute */
macro_line|#if 0
id|evoice-&gt;Attribute
op_assign
(paren
l_int|1
op_lshift
(paren
l_int|30
op_minus
l_int|16
)paren
)paren
op_or
(paren
l_int|2
op_lshift
(paren
l_int|26
op_minus
l_int|16
)paren
)paren
op_or
(paren
l_int|0
op_lshift
(paren
l_int|24
op_minus
l_int|16
)paren
)paren
op_or
(paren
l_int|0x1f
op_lshift
(paren
l_int|19
op_minus
l_int|16
)paren
)paren
suffix:semicolon
macro_line|#else
id|evoice-&gt;Attribute
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|snd_trident_write_voice_regs
c_func
(paren
id|trident
comma
id|evoice
)paren
suffix:semicolon
id|evoice-&gt;isync2
op_assign
l_int|1
suffix:semicolon
id|evoice-&gt;isync_mark
op_assign
id|runtime-&gt;period_size
suffix:semicolon
id|evoice-&gt;ESO
op_assign
(paren
id|runtime-&gt;period_size
op_star
l_int|2
)paren
op_minus
l_int|1
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_capture_hw_params&n;  &n;   Description: Set the hardware parameters for the capture device.&n;  &n;   Parameters:  substream  - PCM substream class&n;&t;&t;hw_params  - hardware parameters&n;  &n;   Returns:     Error status&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_capture_hw_params
r_static
r_int
id|snd_trident_capture_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
r_return
id|snd_trident_allocate_pcm_mem
c_func
(paren
id|substream
comma
id|hw_params
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_capture_prepare&n;  &n;   Description: Prepare capture device for playback.&n;  &n;   Parameters:  substream  - PCM substream class&n;  &n;   Returns:     Error status&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_capture_prepare
r_static
r_int
id|snd_trident_capture_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_trident_voice_t
op_star
id|voice
op_assign
(paren
id|snd_trident_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
r_int
r_int
id|val
comma
id|ESO_bytes
suffix:semicolon
id|snd_assert
c_func
(paren
id|substream-&gt;dma_device.type
op_eq
id|SNDRV_DMA_TYPE_PCI
comma
r_return
op_minus
id|EIO
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
singleline_comment|// Initilize the channel and set channel Mode
id|outb
c_func
(paren
l_int|0
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|LEGACY_DMAR15
)paren
)paren
suffix:semicolon
singleline_comment|// Set DMA channel operation mode register
id|outb
c_func
(paren
l_int|0x54
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|LEGACY_DMAR11
)paren
)paren
suffix:semicolon
singleline_comment|// Set channel buffer Address, DMAR0 expects contiguous PCI memory area&t;
id|voice-&gt;LBA
op_assign
id|runtime-&gt;dma_addr
suffix:semicolon
id|outl
c_func
(paren
id|voice-&gt;LBA
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|LEGACY_DMAR0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;memblk
)paren
id|voice-&gt;LBA
op_assign
id|voice-&gt;memblk-&gt;offset
suffix:semicolon
singleline_comment|// set ESO
id|ESO_bytes
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
op_minus
l_int|1
suffix:semicolon
id|outb
c_func
(paren
(paren
id|ESO_bytes
op_amp
l_int|0x00ff0000
)paren
op_rshift
l_int|16
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|LEGACY_DMAR6
)paren
)paren
suffix:semicolon
id|outw
c_func
(paren
(paren
id|ESO_bytes
op_amp
l_int|0x0000ffff
)paren
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|LEGACY_DMAR4
)paren
)paren
suffix:semicolon
id|ESO_bytes
op_increment
suffix:semicolon
singleline_comment|// Set channel sample rate, 4.12 format
id|val
op_assign
(paren
(paren
(paren
r_int
r_int
)paren
l_int|48000L
op_lshift
l_int|12
)paren
op_plus
(paren
id|runtime-&gt;rate
op_div
l_int|2
)paren
)paren
op_div
id|runtime-&gt;rate
suffix:semicolon
id|outw
c_func
(paren
id|val
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_SBDELTA_DELTA_R
)paren
)paren
suffix:semicolon
singleline_comment|// Set channel interrupt blk length
r_if
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|16
)paren
(brace
id|val
op_assign
(paren
r_int
r_int
)paren
(paren
(paren
id|ESO_bytes
op_rshift
l_int|1
)paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|val
op_assign
(paren
r_int
r_int
)paren
(paren
id|ESO_bytes
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|outl
c_func
(paren
(paren
id|val
op_lshift
l_int|16
)paren
op_or
id|val
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_SBBL_SBCL
)paren
)paren
suffix:semicolon
singleline_comment|// Right now, set format and start to run captureing, 
singleline_comment|// continuous run loop enable.
id|trident-&gt;bDMAStart
op_assign
l_int|0x19
suffix:semicolon
singleline_comment|// 0001 1001b
r_if
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|16
)paren
id|trident-&gt;bDMAStart
op_or_assign
l_int|0x80
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_signed
c_func
(paren
id|runtime-&gt;format
)paren
)paren
id|trident-&gt;bDMAStart
op_or_assign
l_int|0x20
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;channels
OG
l_int|1
)paren
id|trident-&gt;bDMAStart
op_or_assign
l_int|0x40
suffix:semicolon
singleline_comment|// Prepare capture intr channel
id|voice-&gt;Delta
op_assign
id|snd_trident_convert_rate
c_func
(paren
id|runtime-&gt;rate
)paren
suffix:semicolon
id|voice-&gt;spurious_threshold
op_assign
id|snd_trident_spurious_threshold
c_func
(paren
id|runtime-&gt;rate
comma
id|runtime-&gt;period_size
)paren
suffix:semicolon
id|voice-&gt;isync
op_assign
l_int|1
suffix:semicolon
id|voice-&gt;isync_mark
op_assign
id|runtime-&gt;period_size
suffix:semicolon
id|voice-&gt;isync_max
op_assign
id|runtime-&gt;buffer_size
suffix:semicolon
singleline_comment|// Set voice parameters
id|voice-&gt;CSO
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;ESO
op_assign
id|voice-&gt;isync_ESO
op_assign
(paren
id|runtime-&gt;period_size
op_star
l_int|2
)paren
op_plus
l_int|6
op_minus
l_int|1
suffix:semicolon
id|voice-&gt;CTRL
op_assign
id|snd_trident_control_mode
c_func
(paren
id|substream
)paren
suffix:semicolon
id|voice-&gt;FMC
op_assign
l_int|3
suffix:semicolon
id|voice-&gt;RVol
op_assign
l_int|0x7f
suffix:semicolon
id|voice-&gt;CVol
op_assign
l_int|0x7f
suffix:semicolon
id|voice-&gt;GVSel
op_assign
l_int|1
suffix:semicolon
id|voice-&gt;Pan
op_assign
l_int|0x7f
suffix:semicolon
multiline_comment|/* mute */
id|voice-&gt;Vol
op_assign
l_int|0x3ff
suffix:semicolon
multiline_comment|/* mute */
id|voice-&gt;EC
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;Alpha
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;FMS
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;Attribute
op_assign
l_int|0
suffix:semicolon
id|snd_trident_write_voice_regs
c_func
(paren
id|trident
comma
id|voice
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_si7018_capture_hw_params&n;  &n;   Description: Set the hardware parameters for the capture device.&n;  &n;   Parameters:  substream  - PCM substream class&n;&t;&t;hw_params  - hardware parameters&n;  &n;   Returns:     Error status&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_si7018_capture_hw_params
r_static
r_int
id|snd_trident_si7018_capture_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_return
id|snd_trident_allocate_evoice
c_func
(paren
id|substream
comma
id|hw_params
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_si7018_capture_hw_free&n;  &n;   Description: Release the hardware resources for the capture device.&n;  &n;   Parameters:  substream  - PCM substream class&n;  &n;   Returns:     Error status&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_si7018_capture_hw_free
r_static
r_int
id|snd_trident_si7018_capture_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_trident_voice_t
op_star
id|voice
op_assign
(paren
id|snd_trident_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
id|snd_trident_voice_t
op_star
id|evoice
op_assign
id|voice
ques
c_cond
id|voice-&gt;extra
suffix:colon
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|evoice
op_ne
l_int|NULL
)paren
(brace
id|snd_trident_free_voice
c_func
(paren
id|trident
comma
id|evoice
)paren
suffix:semicolon
id|voice-&gt;extra
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_si7018_capture_prepare&n;  &n;   Description: Prepare capture device for playback.&n;  &n;   Parameters:  substream  - PCM substream class&n;  &n;   Returns:     Error status&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_si7018_capture_prepare
r_static
r_int
id|snd_trident_si7018_capture_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_trident_voice_t
op_star
id|voice
op_assign
(paren
id|snd_trident_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
id|snd_trident_voice_t
op_star
id|evoice
op_assign
id|voice-&gt;extra
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
id|voice-&gt;LBA
op_assign
id|runtime-&gt;dma_addr
suffix:semicolon
id|voice-&gt;Delta
op_assign
id|snd_trident_convert_adc_rate
c_func
(paren
id|runtime-&gt;rate
)paren
suffix:semicolon
id|voice-&gt;spurious_threshold
op_assign
id|snd_trident_spurious_threshold
c_func
(paren
id|runtime-&gt;rate
comma
id|runtime-&gt;period_size
)paren
suffix:semicolon
singleline_comment|// Set voice parameters
id|voice-&gt;CSO
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;ESO
op_assign
id|runtime-&gt;buffer_size
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* in samples */
id|voice-&gt;CTRL
op_assign
id|snd_trident_control_mode
c_func
(paren
id|substream
)paren
suffix:semicolon
id|voice-&gt;FMC
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;RVol
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;CVol
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;GVSel
op_assign
l_int|1
suffix:semicolon
id|voice-&gt;Pan
op_assign
id|T4D_DEFAULT_PCM_PAN
suffix:semicolon
id|voice-&gt;Vol
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;EC
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;Alpha
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;FMS
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;Attribute
op_assign
(paren
l_int|2
op_lshift
(paren
l_int|30
op_minus
l_int|16
)paren
)paren
op_or
(paren
l_int|2
op_lshift
(paren
l_int|26
op_minus
l_int|16
)paren
)paren
op_or
(paren
l_int|2
op_lshift
(paren
l_int|24
op_minus
l_int|16
)paren
)paren
op_or
(paren
l_int|1
op_lshift
(paren
l_int|23
op_minus
l_int|16
)paren
)paren
suffix:semicolon
id|snd_trident_write_voice_regs
c_func
(paren
id|trident
comma
id|voice
)paren
suffix:semicolon
r_if
c_cond
(paren
id|evoice
op_ne
l_int|NULL
)paren
(brace
id|evoice-&gt;Delta
op_assign
id|snd_trident_convert_rate
c_func
(paren
id|runtime-&gt;rate
)paren
suffix:semicolon
id|evoice-&gt;spurious_threshold
op_assign
id|voice-&gt;spurious_threshold
suffix:semicolon
id|evoice-&gt;LBA
op_assign
id|voice-&gt;LBA
suffix:semicolon
id|evoice-&gt;CSO
op_assign
l_int|0
suffix:semicolon
id|evoice-&gt;ESO
op_assign
(paren
id|runtime-&gt;period_size
op_star
l_int|2
)paren
op_plus
l_int|20
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* in samples, 20 means correction */
id|evoice-&gt;CTRL
op_assign
id|voice-&gt;CTRL
suffix:semicolon
id|evoice-&gt;FMC
op_assign
l_int|3
suffix:semicolon
id|evoice-&gt;GVSel
op_assign
l_int|0
suffix:semicolon
id|evoice-&gt;EC
op_assign
l_int|0
suffix:semicolon
id|evoice-&gt;Alpha
op_assign
l_int|0
suffix:semicolon
id|evoice-&gt;FMS
op_assign
l_int|0
suffix:semicolon
id|evoice-&gt;Vol
op_assign
l_int|0x3ff
suffix:semicolon
multiline_comment|/* mute */
id|evoice-&gt;RVol
op_assign
id|evoice-&gt;CVol
op_assign
l_int|0x7f
suffix:semicolon
multiline_comment|/* mute */
id|evoice-&gt;Pan
op_assign
l_int|0x7f
suffix:semicolon
multiline_comment|/* mute */
id|evoice-&gt;Attribute
op_assign
l_int|0
suffix:semicolon
id|snd_trident_write_voice_regs
c_func
(paren
id|trident
comma
id|evoice
)paren
suffix:semicolon
id|evoice-&gt;isync2
op_assign
l_int|1
suffix:semicolon
id|evoice-&gt;isync_mark
op_assign
id|runtime-&gt;period_size
suffix:semicolon
id|evoice-&gt;ESO
op_assign
(paren
id|runtime-&gt;period_size
op_star
l_int|2
)paren
op_minus
l_int|1
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_foldback_prepare&n;  &n;   Description: Prepare foldback capture device for playback.&n;  &n;   Parameters:  substream  - PCM substream class&n;  &n;   Returns:     Error status&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_foldback_prepare
r_static
r_int
id|snd_trident_foldback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_trident_voice_t
op_star
id|voice
op_assign
(paren
id|snd_trident_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
id|snd_trident_voice_t
op_star
id|evoice
op_assign
id|voice-&gt;extra
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
multiline_comment|/* Set channel buffer Address */
r_if
c_cond
(paren
id|voice-&gt;memblk
)paren
id|voice-&gt;LBA
op_assign
id|voice-&gt;memblk-&gt;offset
suffix:semicolon
r_else
id|voice-&gt;LBA
op_assign
id|runtime-&gt;dma_addr
suffix:semicolon
multiline_comment|/* set target ESO for channel */
id|voice-&gt;ESO
op_assign
id|runtime-&gt;buffer_size
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* in samples */
multiline_comment|/* set sample rate */
id|voice-&gt;Delta
op_assign
l_int|0x1000
suffix:semicolon
id|voice-&gt;spurious_threshold
op_assign
id|snd_trident_spurious_threshold
c_func
(paren
l_int|48000
comma
id|runtime-&gt;period_size
)paren
suffix:semicolon
id|voice-&gt;CSO
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;CTRL
op_assign
id|snd_trident_control_mode
c_func
(paren
id|substream
)paren
suffix:semicolon
id|voice-&gt;FMC
op_assign
l_int|3
suffix:semicolon
id|voice-&gt;RVol
op_assign
l_int|0x7f
suffix:semicolon
id|voice-&gt;CVol
op_assign
l_int|0x7f
suffix:semicolon
id|voice-&gt;GVSel
op_assign
l_int|1
suffix:semicolon
id|voice-&gt;Pan
op_assign
l_int|0x7f
suffix:semicolon
multiline_comment|/* mute */
id|voice-&gt;Vol
op_assign
l_int|0x3ff
suffix:semicolon
multiline_comment|/* mute */
id|voice-&gt;EC
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;Alpha
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;FMS
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;Attribute
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* set up capture channel */
id|outb
c_func
(paren
(paren
(paren
id|voice-&gt;number
op_amp
l_int|0x3f
)paren
op_or
l_int|0x80
)paren
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_RCI
op_plus
id|voice-&gt;foldback_chan
)paren
)paren
suffix:semicolon
id|snd_trident_write_voice_regs
c_func
(paren
id|trident
comma
id|voice
)paren
suffix:semicolon
r_if
c_cond
(paren
id|evoice
op_ne
l_int|NULL
)paren
(brace
id|evoice-&gt;Delta
op_assign
id|voice-&gt;Delta
suffix:semicolon
id|evoice-&gt;spurious_threshold
op_assign
id|voice-&gt;spurious_threshold
suffix:semicolon
id|evoice-&gt;LBA
op_assign
id|voice-&gt;LBA
suffix:semicolon
id|evoice-&gt;CSO
op_assign
l_int|0
suffix:semicolon
id|evoice-&gt;ESO
op_assign
(paren
id|runtime-&gt;period_size
op_star
l_int|2
)paren
op_plus
l_int|4
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* in samples */
id|evoice-&gt;CTRL
op_assign
id|voice-&gt;CTRL
suffix:semicolon
id|evoice-&gt;FMC
op_assign
l_int|3
suffix:semicolon
id|evoice-&gt;GVSel
op_assign
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_SI7018
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|evoice-&gt;EC
op_assign
l_int|0
suffix:semicolon
id|evoice-&gt;Alpha
op_assign
l_int|0
suffix:semicolon
id|evoice-&gt;FMS
op_assign
l_int|0
suffix:semicolon
id|evoice-&gt;Vol
op_assign
l_int|0x3ff
suffix:semicolon
multiline_comment|/* mute */
id|evoice-&gt;RVol
op_assign
id|evoice-&gt;CVol
op_assign
l_int|0x7f
suffix:semicolon
multiline_comment|/* mute */
id|evoice-&gt;Pan
op_assign
l_int|0x7f
suffix:semicolon
multiline_comment|/* mute */
id|evoice-&gt;Attribute
op_assign
l_int|0
suffix:semicolon
id|snd_trident_write_voice_regs
c_func
(paren
id|trident
comma
id|evoice
)paren
suffix:semicolon
id|evoice-&gt;isync2
op_assign
l_int|1
suffix:semicolon
id|evoice-&gt;isync_mark
op_assign
id|runtime-&gt;period_size
suffix:semicolon
id|evoice-&gt;ESO
op_assign
(paren
id|runtime-&gt;period_size
op_star
l_int|2
)paren
op_minus
l_int|1
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_spdif_hw_params&n;  &n;   Description: Set the hardware parameters for the spdif device.&n;  &n;   Parameters:  substream  - PCM substream class&n;&t;&t;hw_params  - hardware parameters&n;  &n;   Returns:     Error status&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_spdif_hw_params
r_static
r_int
id|snd_trident_spdif_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|old_bits
op_assign
l_int|0
comma
id|change
op_assign
l_int|0
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|snd_trident_allocate_pcm_mem
c_func
(paren
id|substream
comma
id|hw_params
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_SI7018
)paren
(brace
id|err
op_assign
id|snd_trident_allocate_evoice
c_func
(paren
id|substream
comma
id|hw_params
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* prepare SPDIF channel */
id|spin_lock_irq
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
id|old_bits
op_assign
id|trident-&gt;spdif_pcm_bits
suffix:semicolon
r_if
c_cond
(paren
id|old_bits
op_amp
id|IEC958_AES0_PROFESSIONAL
)paren
id|trident-&gt;spdif_pcm_bits
op_and_assign
op_complement
id|IEC958_AES0_PRO_FS
suffix:semicolon
r_else
id|trident-&gt;spdif_pcm_bits
op_and_assign
op_complement
(paren
id|IEC958_AES3_CON_FS
op_lshift
l_int|24
)paren
suffix:semicolon
r_if
c_cond
(paren
id|params_rate
c_func
(paren
id|hw_params
)paren
op_ge
l_int|48000
)paren
(brace
id|trident-&gt;spdif_pcm_ctrl
op_assign
l_int|0x3c
suffix:semicolon
singleline_comment|// 48000 Hz
id|trident-&gt;spdif_pcm_bits
op_or_assign
id|trident-&gt;spdif_bits
op_amp
id|IEC958_AES0_PROFESSIONAL
ques
c_cond
id|IEC958_AES0_PRO_FS_48000
suffix:colon
(paren
id|IEC958_AES3_CON_FS_48000
op_lshift
l_int|24
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|params_rate
c_func
(paren
id|hw_params
)paren
op_ge
l_int|44100
)paren
(brace
id|trident-&gt;spdif_pcm_ctrl
op_assign
l_int|0x3e
suffix:semicolon
singleline_comment|// 44100 Hz
id|trident-&gt;spdif_pcm_bits
op_or_assign
id|trident-&gt;spdif_bits
op_amp
id|IEC958_AES0_PROFESSIONAL
ques
c_cond
id|IEC958_AES0_PRO_FS_44100
suffix:colon
(paren
id|IEC958_AES3_CON_FS_44100
op_lshift
l_int|24
)paren
suffix:semicolon
)brace
r_else
(brace
id|trident-&gt;spdif_pcm_ctrl
op_assign
l_int|0x3d
suffix:semicolon
singleline_comment|// 32000 Hz
id|trident-&gt;spdif_pcm_bits
op_or_assign
id|trident-&gt;spdif_bits
op_amp
id|IEC958_AES0_PROFESSIONAL
ques
c_cond
id|IEC958_AES0_PRO_FS_32000
suffix:colon
(paren
id|IEC958_AES3_CON_FS_32000
op_lshift
l_int|24
)paren
suffix:semicolon
)brace
id|change
op_assign
id|old_bits
op_ne
id|trident-&gt;spdif_pcm_bits
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
id|snd_ctl_notify
c_func
(paren
id|trident-&gt;card
comma
id|SNDRV_CTL_EVENT_MASK_VALUE
comma
op_amp
id|trident-&gt;spdif_pcm_ctl-&gt;id
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_spdif_prepare&n;  &n;   Description: Prepare SPDIF device for playback.&n;  &n;   Parameters:  substream  - PCM substream class&n;  &n;   Returns:     Error status&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_spdif_prepare
r_static
r_int
id|snd_trident_spdif_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_trident_voice_t
op_star
id|voice
op_assign
(paren
id|snd_trident_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
id|snd_trident_voice_t
op_star
id|evoice
op_assign
id|voice-&gt;extra
suffix:semicolon
id|snd_trident_pcm_mixer_t
op_star
id|mix
op_assign
op_amp
id|trident-&gt;pcm_mixer
(braket
id|substream-&gt;number
)braket
suffix:semicolon
r_int
r_int
id|RESO
comma
id|LBAO
suffix:semicolon
r_int
r_int
id|temp
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_ne
id|TRIDENT_DEVICE_ID_SI7018
)paren
(brace
multiline_comment|/* set delta (rate) value */
id|voice-&gt;Delta
op_assign
id|snd_trident_convert_rate
c_func
(paren
id|runtime-&gt;rate
)paren
suffix:semicolon
id|voice-&gt;spurious_threshold
op_assign
id|snd_trident_spurious_threshold
c_func
(paren
id|runtime-&gt;rate
comma
id|runtime-&gt;period_size
)paren
suffix:semicolon
multiline_comment|/* set Loop Back Address */
id|LBAO
op_assign
id|runtime-&gt;dma_addr
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;memblk
)paren
id|voice-&gt;LBA
op_assign
id|voice-&gt;memblk-&gt;offset
suffix:semicolon
r_else
id|voice-&gt;LBA
op_assign
id|LBAO
suffix:semicolon
id|voice-&gt;isync
op_assign
l_int|1
suffix:semicolon
id|voice-&gt;isync3
op_assign
l_int|1
suffix:semicolon
id|voice-&gt;isync_mark
op_assign
id|runtime-&gt;period_size
suffix:semicolon
id|voice-&gt;isync_max
op_assign
id|runtime-&gt;buffer_size
suffix:semicolon
multiline_comment|/* set target ESO for channel */
id|RESO
op_assign
id|runtime-&gt;buffer_size
op_minus
l_int|1
suffix:semicolon
id|voice-&gt;ESO
op_assign
id|voice-&gt;isync_ESO
op_assign
(paren
id|runtime-&gt;period_size
op_star
l_int|2
)paren
op_plus
l_int|6
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* set ctrl mode */
id|voice-&gt;CTRL
op_assign
id|snd_trident_control_mode
c_func
(paren
id|substream
)paren
suffix:semicolon
id|voice-&gt;FMC
op_assign
l_int|3
suffix:semicolon
id|voice-&gt;RVol
op_assign
l_int|0x7f
suffix:semicolon
id|voice-&gt;CVol
op_assign
l_int|0x7f
suffix:semicolon
id|voice-&gt;GVSel
op_assign
l_int|1
suffix:semicolon
id|voice-&gt;Pan
op_assign
l_int|0x7f
suffix:semicolon
id|voice-&gt;Vol
op_assign
l_int|0x3ff
suffix:semicolon
id|voice-&gt;EC
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;CSO
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;Alpha
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;FMS
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;Attribute
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* prepare surrogate IRQ channel */
id|snd_trident_write_voice_regs
c_func
(paren
id|trident
comma
id|voice
)paren
suffix:semicolon
id|outw
c_func
(paren
(paren
id|RESO
op_amp
l_int|0xffff
)paren
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPESO
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
id|RESO
op_rshift
l_int|16
)paren
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPESO
op_plus
l_int|2
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
(paren
id|LBAO
op_amp
l_int|0xfffffffc
)paren
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPLBA
)paren
)paren
suffix:semicolon
id|outw
c_func
(paren
(paren
id|voice-&gt;CSO
op_amp
l_int|0xffff
)paren
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPCTRL_SPCSO
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
id|voice-&gt;CSO
op_rshift
l_int|16
)paren
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPCTRL_SPCSO
op_plus
l_int|2
)paren
)paren
suffix:semicolon
multiline_comment|/* set SPDIF setting */
id|outb
c_func
(paren
id|trident-&gt;spdif_pcm_ctrl
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPCTRL_SPCSO
op_plus
l_int|3
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|trident-&gt;spdif_pcm_bits
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPCSTATUS
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* SiS */
multiline_comment|/* set delta (rate) value */
id|voice-&gt;Delta
op_assign
l_int|0x800
suffix:semicolon
id|voice-&gt;spurious_threshold
op_assign
id|snd_trident_spurious_threshold
c_func
(paren
l_int|48000
comma
id|runtime-&gt;period_size
)paren
suffix:semicolon
multiline_comment|/* set Loop Begin Address */
r_if
c_cond
(paren
id|voice-&gt;memblk
)paren
id|voice-&gt;LBA
op_assign
id|voice-&gt;memblk-&gt;offset
suffix:semicolon
r_else
id|voice-&gt;LBA
op_assign
id|runtime-&gt;dma_addr
suffix:semicolon
id|voice-&gt;CSO
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;ESO
op_assign
id|runtime-&gt;buffer_size
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* in samples */
id|voice-&gt;CTRL
op_assign
id|snd_trident_control_mode
c_func
(paren
id|substream
)paren
suffix:semicolon
id|voice-&gt;FMC
op_assign
l_int|3
suffix:semicolon
id|voice-&gt;GVSel
op_assign
l_int|1
suffix:semicolon
id|voice-&gt;EC
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;Alpha
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;FMS
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;Vol
op_assign
id|mix-&gt;vol
suffix:semicolon
id|voice-&gt;RVol
op_assign
id|mix-&gt;rvol
suffix:semicolon
id|voice-&gt;CVol
op_assign
id|mix-&gt;cvol
suffix:semicolon
id|voice-&gt;Pan
op_assign
id|mix-&gt;pan
suffix:semicolon
id|voice-&gt;Attribute
op_assign
(paren
l_int|1
op_lshift
(paren
l_int|30
op_minus
l_int|16
)paren
)paren
op_or
(paren
l_int|7
op_lshift
(paren
l_int|26
op_minus
l_int|16
)paren
)paren
op_or
(paren
l_int|0
op_lshift
(paren
l_int|24
op_minus
l_int|16
)paren
)paren
op_or
(paren
l_int|0
op_lshift
(paren
l_int|19
op_minus
l_int|16
)paren
)paren
suffix:semicolon
id|snd_trident_write_voice_regs
c_func
(paren
id|trident
comma
id|voice
)paren
suffix:semicolon
r_if
c_cond
(paren
id|evoice
op_ne
l_int|NULL
)paren
(brace
id|evoice-&gt;Delta
op_assign
id|voice-&gt;Delta
suffix:semicolon
id|evoice-&gt;spurious_threshold
op_assign
id|voice-&gt;spurious_threshold
suffix:semicolon
id|evoice-&gt;LBA
op_assign
id|voice-&gt;LBA
suffix:semicolon
id|evoice-&gt;CSO
op_assign
l_int|0
suffix:semicolon
id|evoice-&gt;ESO
op_assign
(paren
id|runtime-&gt;period_size
op_star
l_int|2
)paren
op_plus
l_int|4
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* in samples */
id|evoice-&gt;CTRL
op_assign
id|voice-&gt;CTRL
suffix:semicolon
id|evoice-&gt;FMC
op_assign
l_int|3
suffix:semicolon
id|evoice-&gt;GVSel
op_assign
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_SI7018
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|evoice-&gt;EC
op_assign
l_int|0
suffix:semicolon
id|evoice-&gt;Alpha
op_assign
l_int|0
suffix:semicolon
id|evoice-&gt;FMS
op_assign
l_int|0
suffix:semicolon
id|evoice-&gt;Vol
op_assign
l_int|0x3ff
suffix:semicolon
multiline_comment|/* mute */
id|evoice-&gt;RVol
op_assign
id|evoice-&gt;CVol
op_assign
l_int|0x7f
suffix:semicolon
multiline_comment|/* mute */
id|evoice-&gt;Pan
op_assign
l_int|0x7f
suffix:semicolon
multiline_comment|/* mute */
id|evoice-&gt;Attribute
op_assign
l_int|0
suffix:semicolon
id|snd_trident_write_voice_regs
c_func
(paren
id|trident
comma
id|evoice
)paren
suffix:semicolon
id|evoice-&gt;isync2
op_assign
l_int|1
suffix:semicolon
id|evoice-&gt;isync_mark
op_assign
id|runtime-&gt;period_size
suffix:semicolon
id|evoice-&gt;ESO
op_assign
(paren
id|runtime-&gt;period_size
op_star
l_int|2
)paren
op_minus
l_int|1
suffix:semicolon
)brace
id|outl
c_func
(paren
id|trident-&gt;spdif_pcm_bits
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SPDIF_CS
)paren
)paren
suffix:semicolon
id|temp
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_LFO_GC_CIR
)paren
)paren
suffix:semicolon
id|temp
op_and_assign
op_complement
(paren
l_int|1
op_lshift
l_int|19
)paren
suffix:semicolon
id|outl
c_func
(paren
id|temp
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_LFO_GC_CIR
)paren
)paren
suffix:semicolon
id|temp
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SERIAL_INTF_CTRL
)paren
)paren
suffix:semicolon
id|temp
op_or_assign
id|SPDIF_EN
suffix:semicolon
id|outl
c_func
(paren
id|temp
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SERIAL_INTF_CTRL
)paren
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_trigger&n;  &n;   Description: Start/stop devices&n;  &n;   Parameters:  substream  - PCM substream class&n;   &t;&t;cmd&t;- trigger command (STOP, GO)&n;  &n;   Returns:     Error status&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_trigger
r_static
r_int
id|snd_trident_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_struct
id|list_head
op_star
id|pos
suffix:semicolon
id|snd_pcm_substream_t
op_star
id|s
suffix:semicolon
r_int
r_int
id|what
comma
id|whati
comma
id|capture_flag
comma
id|spdif_flag
suffix:semicolon
id|snd_trident_voice_t
op_star
id|voice
comma
op_star
id|evoice
suffix:semicolon
r_int
r_int
id|val
comma
id|go
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_RELEASE
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_RESUME
suffix:colon
id|go
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_PUSH
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_SUSPEND
suffix:colon
id|go
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|what
op_assign
id|whati
op_assign
id|capture_flag
op_assign
id|spdif_flag
op_assign
l_int|0
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
id|val
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_STIMER
)paren
)paren
op_amp
l_int|0x00ffffff
suffix:semicolon
id|snd_pcm_group_for_each
c_func
(paren
id|pos
comma
id|substream
)paren
(brace
id|s
op_assign
id|snd_pcm_group_substream_entry
c_func
(paren
id|pos
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|trident_t
op_star
)paren
id|_snd_pcm_chip
c_func
(paren
id|s-&gt;pcm
)paren
op_eq
id|trident
)paren
(brace
id|voice
op_assign
(paren
id|snd_trident_voice_t
op_star
)paren
id|s-&gt;runtime-&gt;private_data
suffix:semicolon
id|evoice
op_assign
id|voice-&gt;extra
suffix:semicolon
id|what
op_or_assign
l_int|1
op_lshift
(paren
id|voice-&gt;number
op_amp
l_int|0x1f
)paren
suffix:semicolon
r_if
c_cond
(paren
id|evoice
op_eq
l_int|NULL
)paren
(brace
id|whati
op_or_assign
l_int|1
op_lshift
(paren
id|voice-&gt;number
op_amp
l_int|0x1f
)paren
suffix:semicolon
)brace
r_else
(brace
id|what
op_or_assign
l_int|1
op_lshift
(paren
id|evoice-&gt;number
op_amp
l_int|0x1f
)paren
suffix:semicolon
id|whati
op_or_assign
l_int|1
op_lshift
(paren
id|evoice-&gt;number
op_amp
l_int|0x1f
)paren
suffix:semicolon
r_if
c_cond
(paren
id|go
)paren
id|evoice-&gt;stimer
op_assign
id|val
suffix:semicolon
)brace
r_if
c_cond
(paren
id|go
)paren
(brace
id|voice-&gt;running
op_assign
l_int|1
suffix:semicolon
id|voice-&gt;stimer
op_assign
id|val
suffix:semicolon
)brace
r_else
(brace
id|voice-&gt;running
op_assign
l_int|0
suffix:semicolon
)brace
id|snd_pcm_trigger_done
c_func
(paren
id|s
comma
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;capture
)paren
id|capture_flag
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;spdif
)paren
id|spdif_flag
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|spdif_flag
)paren
(brace
r_if
c_cond
(paren
id|trident-&gt;device
op_ne
id|TRIDENT_DEVICE_ID_SI7018
)paren
(brace
id|outl
c_func
(paren
id|trident-&gt;spdif_pcm_bits
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPCSTATUS
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|trident-&gt;spdif_pcm_ctrl
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPCTRL_SPCSO
op_plus
l_int|3
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|outl
c_func
(paren
id|trident-&gt;spdif_pcm_bits
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SPDIF_CS
)paren
)paren
suffix:semicolon
id|val
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SERIAL_INTF_CTRL
)paren
)paren
op_or
id|SPDIF_EN
suffix:semicolon
id|outl
c_func
(paren
id|val
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SERIAL_INTF_CTRL
)paren
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|go
)paren
id|outl
c_func
(paren
id|what
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_STOP_B
)paren
)paren
suffix:semicolon
id|val
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_AINTEN_B
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|go
)paren
(brace
id|val
op_or_assign
id|whati
suffix:semicolon
)brace
r_else
(brace
id|val
op_and_assign
op_complement
id|whati
suffix:semicolon
)brace
id|outl
c_func
(paren
id|val
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_AINTEN_B
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|go
)paren
(brace
id|outl
c_func
(paren
id|what
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_START_B
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|capture_flag
op_logical_and
id|trident-&gt;device
op_ne
id|TRIDENT_DEVICE_ID_SI7018
)paren
id|outb
c_func
(paren
id|trident-&gt;bDMAStart
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_SBCTRL_SBE2R_SBDD
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|capture_flag
op_logical_and
id|trident-&gt;device
op_ne
id|TRIDENT_DEVICE_ID_SI7018
)paren
id|outb
c_func
(paren
l_int|0x00
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_SBCTRL_SBE2R_SBDD
)paren
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_playback_pointer&n;  &n;   Description: This routine return the playback position&n;                &n;   Parameters:&t;substream  - PCM substream class&n;&n;   Returns:     position of buffer&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_playback_pointer
r_static
id|snd_pcm_uframes_t
id|snd_trident_playback_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_trident_voice_t
op_star
id|voice
op_assign
(paren
id|snd_trident_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
r_int
r_int
id|cso
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|voice-&gt;running
)paren
r_return
l_int|0
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
id|outb
c_func
(paren
id|voice-&gt;number
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_LFO_GC_CIR
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_ne
id|TRIDENT_DEVICE_ID_NX
)paren
(brace
id|cso
op_assign
id|inw
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_DX_CSO_ALPHA_FMS
op_plus
l_int|2
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
singleline_comment|// ID_4DWAVE_NX
id|cso
op_assign
(paren
r_int
r_int
)paren
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|CH_NX_DELTA_CSO
)paren
)paren
op_amp
l_int|0x00ffffff
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cso
op_ge
id|runtime-&gt;buffer_size
)paren
id|cso
op_assign
l_int|0
suffix:semicolon
r_return
id|cso
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_capture_pointer&n;  &n;   Description: This routine return the capture position&n;                &n;   Paramters:   pcm1    - PCM device class&n;&n;   Returns:     position of buffer&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_capture_pointer
r_static
id|snd_pcm_uframes_t
id|snd_trident_capture_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_trident_voice_t
op_star
id|voice
op_assign
(paren
id|snd_trident_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
r_int
r_int
id|result
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|voice-&gt;running
)paren
r_return
l_int|0
suffix:semicolon
id|result
op_assign
id|inw
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_SBBL_SBCL
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;channels
OG
l_int|1
)paren
id|result
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|result
OG
l_int|0
)paren
id|result
op_assign
id|runtime-&gt;buffer_size
op_minus
id|result
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_spdif_pointer&n;  &n;   Description: This routine return the SPDIF playback position&n;                &n;   Parameters:&t;substream  - PCM substream class&n;&n;   Returns:     position of buffer&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_spdif_pointer
r_static
id|snd_pcm_uframes_t
id|snd_trident_spdif_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_trident_voice_t
op_star
id|voice
op_assign
(paren
id|snd_trident_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
r_int
r_int
id|result
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|voice-&gt;running
)paren
r_return
l_int|0
suffix:semicolon
id|result
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPCTRL_SPCSO
)paren
)paren
op_amp
l_int|0x00ffffff
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/*&n; *  Playback support device description&n; */
DECL|variable|snd_trident_playback
r_static
id|snd_pcm_hardware_t
id|snd_trident_playback
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_SYNC_START
op_or
id|SNDRV_PCM_INFO_PAUSE
op_or
id|SNDRV_PCM_INFO_RESUME
)paren
comma
dot
id|formats
op_assign
(paren
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
op_or
id|SNDRV_PCM_FMTBIT_S8
op_or
id|SNDRV_PCM_FMTBIT_U16_LE
)paren
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
dot
id|rate_min
op_assign
l_int|4000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|256
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|256
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|1024
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/*&n; *  Capture support device description&n; */
DECL|variable|snd_trident_capture
r_static
id|snd_pcm_hardware_t
id|snd_trident_capture
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_SYNC_START
op_or
id|SNDRV_PCM_INFO_PAUSE
op_or
id|SNDRV_PCM_INFO_RESUME
)paren
comma
dot
id|formats
op_assign
(paren
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
op_or
id|SNDRV_PCM_FMTBIT_S8
op_or
id|SNDRV_PCM_FMTBIT_U16_LE
)paren
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
dot
id|rate_min
op_assign
l_int|4000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|1024
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/*&n; *  Foldback capture support device description&n; */
DECL|variable|snd_trident_foldback
r_static
id|snd_pcm_hardware_t
id|snd_trident_foldback
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_SYNC_START
op_or
id|SNDRV_PCM_INFO_PAUSE
op_or
id|SNDRV_PCM_INFO_RESUME
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_48000
comma
dot
id|rate_min
op_assign
l_int|48000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|2
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|1024
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/*&n; *  SPDIF playback support device description&n; */
DECL|variable|snd_trident_spdif
r_static
id|snd_pcm_hardware_t
id|snd_trident_spdif
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_SYNC_START
op_or
id|SNDRV_PCM_INFO_PAUSE
op_or
id|SNDRV_PCM_INFO_RESUME
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
(paren
id|SNDRV_PCM_RATE_32000
op_or
id|SNDRV_PCM_RATE_44100
op_or
id|SNDRV_PCM_RATE_48000
)paren
comma
dot
id|rate_min
op_assign
l_int|32000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|2
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|1024
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|snd_trident_spdif_7018
r_static
id|snd_pcm_hardware_t
id|snd_trident_spdif_7018
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_SYNC_START
op_or
id|SNDRV_PCM_INFO_PAUSE
op_or
id|SNDRV_PCM_INFO_RESUME
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_48000
comma
dot
id|rate_min
op_assign
l_int|48000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|2
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|128
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|1024
comma
dot
id|fifo_size
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|function|snd_trident_pcm_free_substream
r_static
r_void
id|snd_trident_pcm_free_substream
c_func
(paren
id|snd_pcm_runtime_t
op_star
id|runtime
)paren
(brace
id|snd_trident_voice_t
op_star
id|voice
op_assign
(paren
id|snd_trident_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
id|trident_t
op_star
id|trident
suffix:semicolon
r_if
c_cond
(paren
id|voice
)paren
(brace
id|trident
op_assign
id|voice-&gt;trident
suffix:semicolon
id|snd_trident_free_voice
c_func
(paren
id|trident
comma
id|voice
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_trident_playback_open
r_static
r_int
id|snd_trident_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_trident_voice_t
op_star
id|voice
suffix:semicolon
id|voice
op_assign
id|snd_trident_alloc_voice
c_func
(paren
id|trident
comma
id|SNDRV_TRIDENT_VOICE_TYPE_PCM
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|snd_trident_pcm_mixer_build
c_func
(paren
id|trident
comma
id|voice
comma
id|substream
)paren
suffix:semicolon
id|voice-&gt;substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;private_data
op_assign
id|voice
suffix:semicolon
id|runtime-&gt;private_free
op_assign
id|snd_trident_pcm_free_substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_trident_playback
suffix:semicolon
id|snd_pcm_set_sync
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_hw_constraint_minmax
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_BUFFER_SIZE
comma
l_int|0
comma
l_int|64
op_star
l_int|1024
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_playback_close&n;  &n;   Description: This routine will close the 4DWave playback device. For now &n;                we will simply free the dma transfer buffer.&n;                &n;   Parameters:&t;substream  - PCM substream class&n;&n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_playback_close
r_static
r_int
id|snd_trident_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|snd_trident_voice_t
op_star
id|voice
op_assign
(paren
id|snd_trident_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
id|snd_trident_pcm_mixer_free
c_func
(paren
id|trident
comma
id|voice
comma
id|substream
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_spdif_open&n;  &n;   Description: This routine will open the 4DWave SPDIF device.&n;&n;   Parameters:&t;substream  - PCM substream class&n;&n;   Returns:     status  - success or failure flag&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_spdif_open
r_static
r_int
id|snd_trident_spdif_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_trident_voice_t
op_star
id|voice
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|voice
op_assign
id|snd_trident_alloc_voice
c_func
(paren
id|trident
comma
id|SNDRV_TRIDENT_VOICE_TYPE_PCM
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|voice-&gt;spdif
op_assign
l_int|1
suffix:semicolon
id|voice-&gt;substream
op_assign
id|substream
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
id|trident-&gt;spdif_pcm_bits
op_assign
id|trident-&gt;spdif_bits
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
id|runtime-&gt;private_data
op_assign
id|voice
suffix:semicolon
id|runtime-&gt;private_free
op_assign
id|snd_trident_pcm_free_substream
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_SI7018
)paren
(brace
id|runtime-&gt;hw
op_assign
id|snd_trident_spdif
suffix:semicolon
)brace
r_else
(brace
id|runtime-&gt;hw
op_assign
id|snd_trident_spdif_7018
suffix:semicolon
)brace
id|trident-&gt;spdif_pcm_ctl-&gt;vd
(braket
l_int|0
)braket
dot
id|access
op_and_assign
op_complement
id|SNDRV_CTL_ELEM_ACCESS_INACTIVE
suffix:semicolon
id|snd_ctl_notify
c_func
(paren
id|trident-&gt;card
comma
id|SNDRV_CTL_EVENT_MASK_VALUE
op_or
id|SNDRV_CTL_EVENT_MASK_INFO
comma
op_amp
id|trident-&gt;spdif_pcm_ctl-&gt;id
)paren
suffix:semicolon
id|snd_pcm_hw_constraint_minmax
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_BUFFER_SIZE
comma
l_int|0
comma
l_int|64
op_star
l_int|1024
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_spdif_close&n;  &n;   Description: This routine will close the 4DWave SPDIF device.&n;                &n;   Parameters:&t;substream  - PCM substream class&n;&n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_spdif_close
r_static
r_int
id|snd_trident_spdif_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|temp
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
singleline_comment|// restore default SPDIF setting
r_if
c_cond
(paren
id|trident-&gt;device
op_ne
id|TRIDENT_DEVICE_ID_SI7018
)paren
(brace
id|outb
c_func
(paren
id|trident-&gt;spdif_ctrl
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPCTRL_SPCSO
op_plus
l_int|3
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|trident-&gt;spdif_bits
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPCSTATUS
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|outl
c_func
(paren
id|trident-&gt;spdif_bits
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SPDIF_CS
)paren
)paren
suffix:semicolon
id|temp
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SERIAL_INTF_CTRL
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;spdif_ctrl
)paren
(brace
id|temp
op_or_assign
id|SPDIF_EN
suffix:semicolon
)brace
r_else
(brace
id|temp
op_and_assign
op_complement
id|SPDIF_EN
suffix:semicolon
)brace
id|outl
c_func
(paren
id|temp
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SERIAL_INTF_CTRL
)paren
)paren
suffix:semicolon
)brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
id|trident-&gt;spdif_pcm_ctl-&gt;vd
(braket
l_int|0
)braket
dot
id|access
op_or_assign
id|SNDRV_CTL_ELEM_ACCESS_INACTIVE
suffix:semicolon
id|snd_ctl_notify
c_func
(paren
id|trident-&gt;card
comma
id|SNDRV_CTL_EVENT_MASK_VALUE
op_or
id|SNDRV_CTL_EVENT_MASK_INFO
comma
op_amp
id|trident-&gt;spdif_pcm_ctl-&gt;id
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_capture_open&n;  &n;   Description: This routine will open the 4DWave capture device.&n;&n;   Parameters:&t;substream  - PCM substream class&n;&n;   Returns:     status  - success or failure flag&n;&n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_capture_open
r_static
r_int
id|snd_trident_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_trident_voice_t
op_star
id|voice
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|voice
op_assign
id|snd_trident_alloc_voice
c_func
(paren
id|trident
comma
id|SNDRV_TRIDENT_VOICE_TYPE_PCM
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|voice-&gt;capture
op_assign
l_int|1
suffix:semicolon
id|voice-&gt;substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;private_data
op_assign
id|voice
suffix:semicolon
id|runtime-&gt;private_free
op_assign
id|snd_trident_pcm_free_substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_trident_capture
suffix:semicolon
id|snd_pcm_set_sync
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_hw_constraint_minmax
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_BUFFER_SIZE
comma
l_int|0
comma
l_int|64
op_star
l_int|1024
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_capture_close&n;  &n;   Description: This routine will close the 4DWave capture device. For now &n;                we will simply free the dma transfer buffer.&n;                &n;   Parameters:&t;substream  - PCM substream class&n;&n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_capture_close
r_static
r_int
id|snd_trident_capture_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_foldback_open&n;  &n;   Description: This routine will open the 4DWave foldback capture device.&n;&n;   Parameters:&t;substream  - PCM substream class&n;&n;   Returns:     status  - success or failure flag&n;&n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_foldback_open
r_static
r_int
id|snd_trident_foldback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_trident_voice_t
op_star
id|voice
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|voice
op_assign
id|snd_trident_alloc_voice
c_func
(paren
id|trident
comma
id|SNDRV_TRIDENT_VOICE_TYPE_PCM
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EAGAIN
suffix:semicolon
id|voice-&gt;foldback_chan
op_assign
id|substream-&gt;number
suffix:semicolon
id|voice-&gt;substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;private_data
op_assign
id|voice
suffix:semicolon
id|runtime-&gt;private_free
op_assign
id|snd_trident_pcm_free_substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_trident_foldback
suffix:semicolon
id|snd_pcm_hw_constraint_minmax
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_BUFFER_SIZE
comma
l_int|0
comma
l_int|64
op_star
l_int|1024
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_foldback_close&n;  &n;   Description: This routine will close the 4DWave foldback capture device. &n;&t;&t;For now we will simply free the dma transfer buffer.&n;                &n;   Parameters:&t;substream  - PCM substream class&n;&n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_foldback_close
r_static
r_int
id|snd_trident_foldback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_trident_voice_t
op_star
id|voice
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|voice
op_assign
(paren
id|snd_trident_voice_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
multiline_comment|/* stop capture channel */
id|spin_lock_irq
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_RCI
op_plus
id|voice-&gt;foldback_chan
)paren
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   PCM operations&n;  ---------------------------------------------------------------------------*/
DECL|variable|snd_trident_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_trident_playback_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_trident_playback_open
comma
dot
id|close
op_assign
id|snd_trident_playback_close
comma
dot
id|ioctl
op_assign
id|snd_trident_ioctl
comma
dot
id|hw_params
op_assign
id|snd_trident_hw_params
comma
dot
id|hw_free
op_assign
id|snd_trident_hw_free
comma
dot
id|prepare
op_assign
id|snd_trident_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_trident_trigger
comma
dot
id|pointer
op_assign
id|snd_trident_playback_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_trident_nx_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_trident_nx_playback_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_trident_playback_open
comma
dot
id|close
op_assign
id|snd_trident_playback_close
comma
dot
id|ioctl
op_assign
id|snd_trident_ioctl
comma
dot
id|hw_params
op_assign
id|snd_trident_hw_params
comma
dot
id|hw_free
op_assign
id|snd_trident_hw_free
comma
dot
id|prepare
op_assign
id|snd_trident_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_trident_trigger
comma
dot
id|pointer
op_assign
id|snd_trident_playback_pointer
comma
dot
id|page
op_assign
id|snd_pcm_sgbuf_ops_page
comma
)brace
suffix:semicolon
DECL|variable|snd_trident_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_trident_capture_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_trident_capture_open
comma
dot
id|close
op_assign
id|snd_trident_capture_close
comma
dot
id|ioctl
op_assign
id|snd_trident_ioctl
comma
dot
id|hw_params
op_assign
id|snd_trident_capture_hw_params
comma
dot
id|hw_free
op_assign
id|snd_trident_hw_free
comma
dot
id|prepare
op_assign
id|snd_trident_capture_prepare
comma
dot
id|trigger
op_assign
id|snd_trident_trigger
comma
dot
id|pointer
op_assign
id|snd_trident_capture_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_trident_si7018_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_trident_si7018_capture_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_trident_capture_open
comma
dot
id|close
op_assign
id|snd_trident_capture_close
comma
dot
id|ioctl
op_assign
id|snd_trident_ioctl
comma
dot
id|hw_params
op_assign
id|snd_trident_si7018_capture_hw_params
comma
dot
id|hw_free
op_assign
id|snd_trident_si7018_capture_hw_free
comma
dot
id|prepare
op_assign
id|snd_trident_si7018_capture_prepare
comma
dot
id|trigger
op_assign
id|snd_trident_trigger
comma
dot
id|pointer
op_assign
id|snd_trident_playback_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_trident_foldback_ops
r_static
id|snd_pcm_ops_t
id|snd_trident_foldback_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_trident_foldback_open
comma
dot
id|close
op_assign
id|snd_trident_foldback_close
comma
dot
id|ioctl
op_assign
id|snd_trident_ioctl
comma
dot
id|hw_params
op_assign
id|snd_trident_hw_params
comma
dot
id|hw_free
op_assign
id|snd_trident_hw_free
comma
dot
id|prepare
op_assign
id|snd_trident_foldback_prepare
comma
dot
id|trigger
op_assign
id|snd_trident_trigger
comma
dot
id|pointer
op_assign
id|snd_trident_playback_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_trident_nx_foldback_ops
r_static
id|snd_pcm_ops_t
id|snd_trident_nx_foldback_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_trident_foldback_open
comma
dot
id|close
op_assign
id|snd_trident_foldback_close
comma
dot
id|ioctl
op_assign
id|snd_trident_ioctl
comma
dot
id|hw_params
op_assign
id|snd_trident_hw_params
comma
dot
id|hw_free
op_assign
id|snd_trident_hw_free
comma
dot
id|prepare
op_assign
id|snd_trident_foldback_prepare
comma
dot
id|trigger
op_assign
id|snd_trident_trigger
comma
dot
id|pointer
op_assign
id|snd_trident_playback_pointer
comma
dot
id|page
op_assign
id|snd_pcm_sgbuf_ops_page
comma
)brace
suffix:semicolon
DECL|variable|snd_trident_spdif_ops
r_static
id|snd_pcm_ops_t
id|snd_trident_spdif_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_trident_spdif_open
comma
dot
id|close
op_assign
id|snd_trident_spdif_close
comma
dot
id|ioctl
op_assign
id|snd_trident_ioctl
comma
dot
id|hw_params
op_assign
id|snd_trident_spdif_hw_params
comma
dot
id|hw_free
op_assign
id|snd_trident_hw_free
comma
dot
id|prepare
op_assign
id|snd_trident_spdif_prepare
comma
dot
id|trigger
op_assign
id|snd_trident_trigger
comma
dot
id|pointer
op_assign
id|snd_trident_spdif_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_trident_spdif_7018_ops
r_static
id|snd_pcm_ops_t
id|snd_trident_spdif_7018_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_trident_spdif_open
comma
dot
id|close
op_assign
id|snd_trident_spdif_close
comma
dot
id|ioctl
op_assign
id|snd_trident_ioctl
comma
dot
id|hw_params
op_assign
id|snd_trident_spdif_hw_params
comma
dot
id|hw_free
op_assign
id|snd_trident_hw_free
comma
dot
id|prepare
op_assign
id|snd_trident_spdif_prepare
comma
dot
id|trigger
op_assign
id|snd_trident_trigger
comma
dot
id|pointer
op_assign
id|snd_trident_playback_pointer
comma
)brace
suffix:semicolon
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_pcm_free&n;  &n;   Description: This routine release the 4DWave private data.&n;                &n;   Paramters:   private_data - pointer to 4DWave device info.&n;&n;   Returns:     None&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_pcm_free
r_static
r_void
id|snd_trident_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_magic_cast
c_func
(paren
id|trident_t
comma
id|pcm-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|trident-&gt;pcm
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_trident_foldback_pcm_free
r_static
r_void
id|snd_trident_foldback_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_magic_cast
c_func
(paren
id|trident_t
comma
id|pcm-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|trident-&gt;foldback
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_trident_spdif_pcm_free
r_static
r_void
id|snd_trident_spdif_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_magic_cast
c_func
(paren
id|trident_t
comma
id|pcm-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|trident-&gt;spdif
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_pcm&n;  &n;   Description: This routine registers the 4DWave device for PCM support.&n;                &n;   Paramters:   trident - pointer to target device class for 4DWave.&n;&n;   Returns:     None&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_pcm
r_int
id|__devinit
id|snd_trident_pcm
c_func
(paren
id|trident_t
op_star
id|trident
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|trident-&gt;card
comma
l_string|&quot;trident_dx_nx&quot;
comma
id|device
comma
id|trident-&gt;ChanPCM
comma
l_int|1
comma
op_amp
id|pcm
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|trident
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_trident_pcm_free
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;tlb.entries
)paren
(brace
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_trident_nx_playback_ops
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_trident_playback_ops
)paren
suffix:semicolon
)brace
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
id|trident-&gt;device
op_ne
id|TRIDENT_DEVICE_ID_SI7018
ques
c_cond
op_amp
id|snd_trident_capture_ops
suffix:colon
op_amp
id|snd_trident_si7018_capture_ops
)paren
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|pcm-&gt;dev_subclass
op_assign
id|SNDRV_PCM_SUBCLASS_GENERIC_MIX
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;Trident 4DWave&quot;
)paren
suffix:semicolon
id|trident-&gt;pcm
op_assign
id|pcm
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;tlb.entries
)paren
(brace
id|snd_pcm_substream_t
op_star
id|substream
suffix:semicolon
r_for
c_loop
(paren
id|substream
op_assign
id|pcm-&gt;streams
(braket
id|SNDRV_PCM_STREAM_PLAYBACK
)braket
dot
id|substream
suffix:semicolon
id|substream
suffix:semicolon
id|substream
op_assign
id|substream-&gt;next
)paren
id|snd_pcm_lib_preallocate_pages
c_func
(paren
id|substream
comma
id|SNDRV_DMA_TYPE_PCI_SG
comma
id|trident-&gt;pci
comma
l_int|64
op_star
l_int|1024
comma
l_int|128
op_star
l_int|1024
)paren
suffix:semicolon
id|snd_pcm_lib_preallocate_pages
c_func
(paren
id|pcm-&gt;streams
(braket
id|SNDRV_PCM_STREAM_CAPTURE
)braket
dot
id|substream
comma
id|SNDRV_DMA_TYPE_PCI
comma
id|trident-&gt;pci
comma
l_int|64
op_star
l_int|1024
comma
l_int|128
op_star
l_int|1024
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_pcm_lib_preallocate_pages_for_all
c_func
(paren
id|pcm
comma
id|SNDRV_DMA_TYPE_PCI
comma
id|trident-&gt;pci
comma
l_int|64
op_star
l_int|1024
comma
l_int|128
op_star
l_int|1024
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_foldback_pcm&n;  &n;   Description: This routine registers the 4DWave device for foldback PCM support.&n;                &n;   Paramters:   trident - pointer to target device class for 4DWave.&n;&n;   Returns:     None&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_foldback_pcm
r_int
id|__devinit
id|snd_trident_foldback_pcm
c_func
(paren
id|trident_t
op_star
id|trident
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|foldback
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|num_chan
op_assign
l_int|3
suffix:semicolon
id|snd_pcm_substream_t
op_star
id|substream
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_NX
)paren
id|num_chan
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|trident-&gt;card
comma
l_string|&quot;trident_dx_nx&quot;
comma
id|device
comma
l_int|0
comma
id|num_chan
comma
op_amp
id|foldback
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|foldback-&gt;private_data
op_assign
id|trident
suffix:semicolon
id|foldback-&gt;private_free
op_assign
id|snd_trident_foldback_pcm_free
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;tlb.entries
)paren
id|snd_pcm_set_ops
c_func
(paren
id|foldback
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_trident_nx_foldback_ops
)paren
suffix:semicolon
r_else
id|snd_pcm_set_ops
c_func
(paren
id|foldback
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_trident_foldback_ops
)paren
suffix:semicolon
id|foldback-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|foldback-&gt;name
comma
l_string|&quot;Trident 4DWave&quot;
)paren
suffix:semicolon
id|substream
op_assign
id|foldback-&gt;streams
(braket
id|SNDRV_PCM_STREAM_CAPTURE
)braket
dot
id|substream
suffix:semicolon
id|strcpy
c_func
(paren
id|substream-&gt;name
comma
l_string|&quot;Front Mixer&quot;
)paren
suffix:semicolon
id|substream
op_assign
id|substream-&gt;next
suffix:semicolon
id|strcpy
c_func
(paren
id|substream-&gt;name
comma
l_string|&quot;Reverb Mixer&quot;
)paren
suffix:semicolon
id|substream
op_assign
id|substream-&gt;next
suffix:semicolon
id|strcpy
c_func
(paren
id|substream-&gt;name
comma
l_string|&quot;Chorus Mixer&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|num_chan
op_eq
l_int|4
)paren
(brace
id|substream
op_assign
id|substream-&gt;next
suffix:semicolon
id|strcpy
c_func
(paren
id|substream-&gt;name
comma
l_string|&quot;Second AC&squot;97 ADC&quot;
)paren
suffix:semicolon
)brace
id|trident-&gt;foldback
op_assign
id|foldback
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;tlb.entries
)paren
id|snd_pcm_lib_preallocate_pages_for_all
c_func
(paren
id|foldback
comma
id|SNDRV_DMA_TYPE_PCI_SG
comma
id|trident-&gt;pci
comma
l_int|0
comma
l_int|128
op_star
l_int|1024
)paren
suffix:semicolon
r_else
id|snd_pcm_lib_preallocate_pages_for_all
c_func
(paren
id|foldback
comma
id|SNDRV_DMA_TYPE_PCI
comma
id|trident-&gt;pci
comma
l_int|64
op_star
l_int|1024
comma
l_int|128
op_star
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|foldback
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_spdif&n;  &n;   Description: This routine registers the 4DWave-NX device for SPDIF support.&n;                &n;   Paramters:   trident - pointer to target device class for 4DWave-NX.&n;&n;   Returns:     None&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_spdif_pcm
r_int
id|__devinit
id|snd_trident_spdif_pcm
c_func
(paren
id|trident_t
op_star
id|trident
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|spdif
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|trident-&gt;card
comma
l_string|&quot;trident_dx_nx IEC958&quot;
comma
id|device
comma
l_int|1
comma
l_int|0
comma
op_amp
id|spdif
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|spdif-&gt;private_data
op_assign
id|trident
suffix:semicolon
id|spdif-&gt;private_free
op_assign
id|snd_trident_spdif_pcm_free
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_ne
id|TRIDENT_DEVICE_ID_SI7018
)paren
(brace
id|snd_pcm_set_ops
c_func
(paren
id|spdif
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_trident_spdif_ops
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_pcm_set_ops
c_func
(paren
id|spdif
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_trident_spdif_7018_ops
)paren
suffix:semicolon
)brace
id|spdif-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|spdif-&gt;name
comma
l_string|&quot;Trident 4DWave IEC958&quot;
)paren
suffix:semicolon
id|trident-&gt;spdif
op_assign
id|spdif
suffix:semicolon
id|snd_pcm_lib_preallocate_pages_for_all
c_func
(paren
id|spdif
comma
id|SNDRV_DMA_TYPE_PCI
comma
id|trident-&gt;pci
comma
l_int|64
op_star
l_int|1024
comma
l_int|128
op_star
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|spdif
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Mixer part&n; */
multiline_comment|/*---------------------------------------------------------------------------&n;    snd_trident_spdif_control&n;&n;    Description: enable/disable S/PDIF out from ac97 mixer&n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_spdif_control_info
r_static
r_int
id|snd_trident_spdif_control_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_spdif_control_get
r_static
r_int
id|snd_trident_spdif_control_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|val
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|val
op_assign
id|trident-&gt;spdif_ctrl
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|val
op_eq
id|kcontrol-&gt;private_value
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_spdif_control_put
r_static
r_int
id|snd_trident_spdif_control_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|val
suffix:semicolon
r_int
id|change
suffix:semicolon
id|val
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
ques
c_cond
(paren
r_int
r_char
)paren
id|kcontrol-&gt;private_value
suffix:colon
l_int|0x00
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* S/PDIF C Channel bits 0-31 : 48khz, SCMS disabled */
id|change
op_assign
id|trident-&gt;spdif_ctrl
op_ne
id|val
suffix:semicolon
id|trident-&gt;spdif_ctrl
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_ne
id|TRIDENT_DEVICE_ID_SI7018
)paren
(brace
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPCTRL_SPCSO
op_plus
l_int|3
)paren
)paren
op_amp
l_int|0x10
)paren
op_eq
l_int|0
)paren
(brace
id|outl
c_func
(paren
id|trident-&gt;spdif_bits
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPCSTATUS
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|trident-&gt;spdif_ctrl
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPCTRL_SPCSO
op_plus
l_int|3
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|trident-&gt;spdif
op_eq
l_int|NULL
)paren
(brace
r_int
r_int
id|temp
suffix:semicolon
id|outl
c_func
(paren
id|trident-&gt;spdif_bits
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SPDIF_CS
)paren
)paren
suffix:semicolon
id|temp
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SERIAL_INTF_CTRL
)paren
)paren
op_amp
op_complement
id|SPDIF_EN
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
id|temp
op_or_assign
id|SPDIF_EN
suffix:semicolon
id|outl
c_func
(paren
id|temp
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SERIAL_INTF_CTRL
)paren
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_trident_spdif_control
id|__devinitdata
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|PLAYBACK
comma
id|SWITCH
)paren
comma
dot
id|info
op_assign
id|snd_trident_spdif_control_info
comma
dot
id|get
op_assign
id|snd_trident_spdif_control_get
comma
dot
id|put
op_assign
id|snd_trident_spdif_control_put
comma
dot
id|private_value
op_assign
l_int|0x28
comma
)brace
suffix:semicolon
multiline_comment|/*---------------------------------------------------------------------------&n;    snd_trident_spdif_default&n;&n;    Description: put/get the S/PDIF default settings&n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_spdif_default_info
r_static
r_int
id|snd_trident_spdif_default_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_IEC958
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_spdif_default_get
r_static
r_int
id|snd_trident_spdif_default_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_assign
(paren
id|trident-&gt;spdif_bits
op_rshift
l_int|0
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|1
)braket
op_assign
(paren
id|trident-&gt;spdif_bits
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|2
)braket
op_assign
(paren
id|trident-&gt;spdif_bits
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
op_assign
(paren
id|trident-&gt;spdif_bits
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_spdif_default_put
r_static
r_int
id|snd_trident_spdif_default_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|change
suffix:semicolon
id|val
op_assign
(paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_lshift
l_int|0
)paren
op_or
(paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|2
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
op_lshift
l_int|24
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|change
op_assign
id|trident-&gt;spdif_bits
op_ne
id|val
suffix:semicolon
id|trident-&gt;spdif_bits
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_ne
id|TRIDENT_DEVICE_ID_SI7018
)paren
(brace
r_if
c_cond
(paren
(paren
id|inb
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPCTRL_SPCSO
op_plus
l_int|3
)paren
)paren
op_amp
l_int|0x10
)paren
op_eq
l_int|0
)paren
id|outl
c_func
(paren
id|trident-&gt;spdif_bits
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPCSTATUS
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|trident-&gt;spdif
op_eq
l_int|NULL
)paren
id|outl
c_func
(paren
id|trident-&gt;spdif_bits
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SPDIF_CS
)paren
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_trident_spdif_default
id|__devinitdata
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_PCM
comma
dot
id|name
op_assign
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|PLAYBACK
comma
id|DEFAULT
)paren
comma
dot
id|info
op_assign
id|snd_trident_spdif_default_info
comma
dot
id|get
op_assign
id|snd_trident_spdif_default_get
comma
dot
id|put
op_assign
id|snd_trident_spdif_default_put
)brace
suffix:semicolon
multiline_comment|/*---------------------------------------------------------------------------&n;    snd_trident_spdif_mask&n;&n;    Description: put/get the S/PDIF mask&n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_spdif_mask_info
r_static
r_int
id|snd_trident_spdif_mask_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_IEC958
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_spdif_mask_get
r_static
r_int
id|snd_trident_spdif_mask_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_assign
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|1
)braket
op_assign
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|2
)braket
op_assign
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
op_assign
l_int|0xff
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_trident_spdif_mask
id|__devinitdata
op_assign
(brace
dot
id|access
op_assign
id|SNDRV_CTL_ELEM_ACCESS_READ
comma
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_PCM
comma
dot
id|name
op_assign
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|PLAYBACK
comma
id|MASK
)paren
comma
dot
id|info
op_assign
id|snd_trident_spdif_mask_info
comma
dot
id|get
op_assign
id|snd_trident_spdif_mask_get
comma
)brace
suffix:semicolon
multiline_comment|/*---------------------------------------------------------------------------&n;    snd_trident_spdif_stream&n;&n;    Description: put/get the S/PDIF stream settings&n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_spdif_stream_info
r_static
r_int
id|snd_trident_spdif_stream_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_IEC958
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_spdif_stream_get
r_static
r_int
id|snd_trident_spdif_stream_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_assign
(paren
id|trident-&gt;spdif_pcm_bits
op_rshift
l_int|0
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|1
)braket
op_assign
(paren
id|trident-&gt;spdif_pcm_bits
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|2
)braket
op_assign
(paren
id|trident-&gt;spdif_pcm_bits
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
op_assign
(paren
id|trident-&gt;spdif_pcm_bits
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_spdif_stream_put
r_static
r_int
id|snd_trident_spdif_stream_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|change
suffix:semicolon
id|val
op_assign
(paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_lshift
l_int|0
)paren
op_or
(paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|2
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
op_lshift
l_int|24
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|change
op_assign
id|trident-&gt;spdif_pcm_bits
op_ne
id|val
suffix:semicolon
id|trident-&gt;spdif_pcm_bits
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;spdif
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|trident-&gt;device
op_ne
id|TRIDENT_DEVICE_ID_SI7018
)paren
(brace
id|outl
c_func
(paren
id|trident-&gt;spdif_pcm_bits
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPCSTATUS
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|outl
c_func
(paren
id|trident-&gt;spdif_bits
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SPDIF_CS
)paren
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_trident_spdif_stream
id|__devinitdata
op_assign
(brace
dot
id|access
op_assign
id|SNDRV_CTL_ELEM_ACCESS_READWRITE
op_or
id|SNDRV_CTL_ELEM_ACCESS_INACTIVE
comma
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_PCM
comma
dot
id|name
op_assign
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|PLAYBACK
comma
id|PCM_STREAM
)paren
comma
dot
id|info
op_assign
id|snd_trident_spdif_stream_info
comma
dot
id|get
op_assign
id|snd_trident_spdif_stream_get
comma
dot
id|put
op_assign
id|snd_trident_spdif_stream_put
)brace
suffix:semicolon
multiline_comment|/*---------------------------------------------------------------------------&n;    snd_trident_ac97_control&n;&n;    Description: enable/disable rear path for ac97&n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_ac97_control_info
r_static
r_int
id|snd_trident_ac97_control_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_ac97_control_get
r_static
r_int
id|snd_trident_ac97_control_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|val
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|val
op_assign
id|trident-&gt;ac97_ctrl
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_ACR0_AC97_COM_STAT
)paren
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|val
op_amp
(paren
l_int|1
op_lshift
id|kcontrol-&gt;private_value
)paren
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_ac97_control_put
r_static
r_int
id|snd_trident_ac97_control_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|val
suffix:semicolon
r_int
id|change
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|val
op_assign
id|trident-&gt;ac97_ctrl
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_ACR0_AC97_COM_STAT
)paren
)paren
suffix:semicolon
id|val
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|kcontrol-&gt;private_value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
id|val
op_or_assign
l_int|1
op_lshift
id|kcontrol-&gt;private_value
suffix:semicolon
id|change
op_assign
id|val
op_ne
id|trident-&gt;ac97_ctrl
suffix:semicolon
id|trident-&gt;ac97_ctrl
op_assign
id|val
suffix:semicolon
id|outl
c_func
(paren
id|trident-&gt;ac97_ctrl
op_assign
id|val
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_ACR0_AC97_COM_STAT
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_trident_ac97_rear_control
id|__devinitdata
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Rear Path&quot;
comma
dot
id|info
op_assign
id|snd_trident_ac97_control_info
comma
dot
id|get
op_assign
id|snd_trident_ac97_control_get
comma
dot
id|put
op_assign
id|snd_trident_ac97_control_put
comma
dot
id|private_value
op_assign
l_int|4
comma
)brace
suffix:semicolon
multiline_comment|/*---------------------------------------------------------------------------&n;    snd_trident_vol_control&n;&n;    Description: wave &amp; music volume control&n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_vol_control_info
r_static
r_int
id|snd_trident_vol_control_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|255
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_vol_control_get
r_static
r_int
id|snd_trident_vol_control_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
id|trident-&gt;musicvol_wavevol
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
l_int|255
op_minus
(paren
(paren
id|val
op_rshift
id|kcontrol-&gt;private_value
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
l_int|255
op_minus
(paren
(paren
id|val
op_rshift
(paren
id|kcontrol-&gt;private_value
op_plus
l_int|8
)paren
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_vol_control_put
r_static
r_int
id|snd_trident_vol_control_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|trident_t
op_star
id|trident
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|change
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|val
op_assign
id|trident-&gt;musicvol_wavevol
suffix:semicolon
id|val
op_and_assign
op_complement
(paren
l_int|0xffff
op_lshift
id|kcontrol-&gt;private_value
)paren
suffix:semicolon
id|val
op_or_assign
(paren
(paren
l_int|255
op_minus
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|0xff
)paren
)paren
op_or
(paren
(paren
l_int|255
op_minus
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_amp
l_int|0xff
)paren
)paren
op_lshift
l_int|8
)paren
)paren
op_lshift
id|kcontrol-&gt;private_value
suffix:semicolon
id|change
op_assign
id|val
op_ne
id|trident-&gt;musicvol_wavevol
suffix:semicolon
id|outl
c_func
(paren
id|trident-&gt;musicvol_wavevol
op_assign
id|val
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_MUSICVOL_WAVEVOL
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_trident_vol_music_control
id|__devinitdata
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Music Playback Volume&quot;
comma
dot
id|info
op_assign
id|snd_trident_vol_control_info
comma
dot
id|get
op_assign
id|snd_trident_vol_control_get
comma
dot
id|put
op_assign
id|snd_trident_vol_control_put
comma
dot
id|private_value
op_assign
l_int|16
comma
)brace
suffix:semicolon
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_trident_vol_wave_control
id|__devinitdata
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Wave Playback Volume&quot;
comma
dot
id|info
op_assign
id|snd_trident_vol_control_info
comma
dot
id|get
op_assign
id|snd_trident_vol_control_get
comma
dot
id|put
op_assign
id|snd_trident_vol_control_put
comma
dot
id|private_value
op_assign
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/*---------------------------------------------------------------------------&n;    snd_trident_pcm_vol_control&n;&n;    Description: PCM front volume control&n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_pcm_vol_control_info
r_static
r_int
id|snd_trident_pcm_vol_control_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|255
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_SI7018
)paren
id|uinfo-&gt;value.integer.max
op_assign
l_int|1023
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_pcm_vol_control_get
r_static
r_int
id|snd_trident_pcm_vol_control_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|snd_trident_pcm_mixer_t
op_star
id|mix
op_assign
op_amp
id|trident-&gt;pcm_mixer
(braket
id|snd_ctl_get_ioffnum
c_func
(paren
id|kcontrol
comma
op_amp
id|ucontrol-&gt;id
)paren
)braket
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_SI7018
)paren
(brace
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
l_int|1023
op_minus
id|mix-&gt;vol
suffix:semicolon
)brace
r_else
(brace
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
l_int|255
op_minus
(paren
id|mix-&gt;vol
op_rshift
l_int|2
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_pcm_vol_control_put
r_static
r_int
id|snd_trident_pcm_vol_control_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|trident_t
op_star
id|trident
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|snd_trident_pcm_mixer_t
op_star
id|mix
op_assign
op_amp
id|trident-&gt;pcm_mixer
(braket
id|snd_ctl_get_ioffnum
c_func
(paren
id|kcontrol
comma
op_amp
id|ucontrol-&gt;id
)paren
)braket
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|change
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_SI7018
)paren
(brace
id|val
op_assign
l_int|1023
op_minus
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|1023
)paren
suffix:semicolon
)brace
r_else
(brace
id|val
op_assign
(paren
l_int|255
op_minus
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|255
)paren
)paren
op_lshift
l_int|2
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|change
op_assign
id|val
op_ne
id|mix-&gt;vol
suffix:semicolon
id|mix-&gt;vol
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|mix-&gt;voice
op_ne
l_int|NULL
)paren
id|snd_trident_write_vol_reg
c_func
(paren
id|trident
comma
id|mix-&gt;voice
comma
id|val
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_trident_pcm_vol_control
id|__devinitdata
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;PCM Front Playback Volume&quot;
comma
dot
id|access
op_assign
id|SNDRV_CTL_ELEM_ACCESS_READWRITE
op_or
id|SNDRV_CTL_ELEM_ACCESS_INACTIVE
comma
dot
id|count
op_assign
l_int|32
comma
dot
id|info
op_assign
id|snd_trident_pcm_vol_control_info
comma
dot
id|get
op_assign
id|snd_trident_pcm_vol_control_get
comma
dot
id|put
op_assign
id|snd_trident_pcm_vol_control_put
comma
)brace
suffix:semicolon
multiline_comment|/*---------------------------------------------------------------------------&n;    snd_trident_pcm_pan_control&n;&n;    Description: PCM front pan control&n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_pcm_pan_control_info
r_static
r_int
id|snd_trident_pcm_pan_control_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|127
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_pcm_pan_control_get
r_static
r_int
id|snd_trident_pcm_pan_control_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|snd_trident_pcm_mixer_t
op_star
id|mix
op_assign
op_amp
id|trident-&gt;pcm_mixer
(braket
id|snd_ctl_get_ioffnum
c_func
(paren
id|kcontrol
comma
op_amp
id|ucontrol-&gt;id
)paren
)braket
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|mix-&gt;pan
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|0x40
)paren
(brace
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
l_int|0x3f
op_minus
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|0x3f
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_or_assign
l_int|0x40
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_pcm_pan_control_put
r_static
r_int
id|snd_trident_pcm_pan_control_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|trident_t
op_star
id|trident
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|snd_trident_pcm_mixer_t
op_star
id|mix
op_assign
op_amp
id|trident-&gt;pcm_mixer
(braket
id|snd_ctl_get_ioffnum
c_func
(paren
id|kcontrol
comma
op_amp
id|ucontrol-&gt;id
)paren
)braket
suffix:semicolon
r_int
r_char
id|val
suffix:semicolon
r_int
id|change
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|0x40
)paren
id|val
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|0x3f
suffix:semicolon
r_else
id|val
op_assign
(paren
l_int|0x3f
op_minus
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|0x3f
)paren
)paren
op_or
l_int|0x40
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|change
op_assign
id|val
op_ne
id|mix-&gt;pan
suffix:semicolon
id|mix-&gt;pan
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|mix-&gt;voice
op_ne
l_int|NULL
)paren
id|snd_trident_write_pan_reg
c_func
(paren
id|trident
comma
id|mix-&gt;voice
comma
id|val
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_trident_pcm_pan_control
id|__devinitdata
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;PCM Pan Playback Control&quot;
comma
dot
id|access
op_assign
id|SNDRV_CTL_ELEM_ACCESS_READWRITE
op_or
id|SNDRV_CTL_ELEM_ACCESS_INACTIVE
comma
dot
id|count
op_assign
l_int|32
comma
dot
id|info
op_assign
id|snd_trident_pcm_pan_control_info
comma
dot
id|get
op_assign
id|snd_trident_pcm_pan_control_get
comma
dot
id|put
op_assign
id|snd_trident_pcm_pan_control_put
comma
)brace
suffix:semicolon
multiline_comment|/*---------------------------------------------------------------------------&n;    snd_trident_pcm_rvol_control&n;&n;    Description: PCM reverb volume control&n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_pcm_rvol_control_info
r_static
r_int
id|snd_trident_pcm_rvol_control_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|127
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_pcm_rvol_control_get
r_static
r_int
id|snd_trident_pcm_rvol_control_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|snd_trident_pcm_mixer_t
op_star
id|mix
op_assign
op_amp
id|trident-&gt;pcm_mixer
(braket
id|snd_ctl_get_ioffnum
c_func
(paren
id|kcontrol
comma
op_amp
id|ucontrol-&gt;id
)paren
)braket
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
l_int|127
op_minus
id|mix-&gt;rvol
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_pcm_rvol_control_put
r_static
r_int
id|snd_trident_pcm_rvol_control_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|trident_t
op_star
id|trident
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|snd_trident_pcm_mixer_t
op_star
id|mix
op_assign
op_amp
id|trident-&gt;pcm_mixer
(braket
id|snd_ctl_get_ioffnum
c_func
(paren
id|kcontrol
comma
op_amp
id|ucontrol-&gt;id
)paren
)braket
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|change
op_assign
l_int|0
suffix:semicolon
id|val
op_assign
l_int|0x7f
op_minus
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|0x7f
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|change
op_assign
id|val
op_ne
id|mix-&gt;rvol
suffix:semicolon
id|mix-&gt;rvol
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|mix-&gt;voice
op_ne
l_int|NULL
)paren
id|snd_trident_write_rvol_reg
c_func
(paren
id|trident
comma
id|mix-&gt;voice
comma
id|val
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_trident_pcm_rvol_control
id|__devinitdata
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;PCM Reverb Playback Volume&quot;
comma
dot
id|access
op_assign
id|SNDRV_CTL_ELEM_ACCESS_READWRITE
op_or
id|SNDRV_CTL_ELEM_ACCESS_INACTIVE
comma
dot
id|count
op_assign
l_int|32
comma
dot
id|info
op_assign
id|snd_trident_pcm_rvol_control_info
comma
dot
id|get
op_assign
id|snd_trident_pcm_rvol_control_get
comma
dot
id|put
op_assign
id|snd_trident_pcm_rvol_control_put
comma
)brace
suffix:semicolon
multiline_comment|/*---------------------------------------------------------------------------&n;    snd_trident_pcm_cvol_control&n;&n;    Description: PCM chorus volume control&n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_pcm_cvol_control_info
r_static
r_int
id|snd_trident_pcm_cvol_control_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|127
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_pcm_cvol_control_get
r_static
r_int
id|snd_trident_pcm_cvol_control_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|snd_trident_pcm_mixer_t
op_star
id|mix
op_assign
op_amp
id|trident-&gt;pcm_mixer
(braket
id|snd_ctl_get_ioffnum
c_func
(paren
id|kcontrol
comma
op_amp
id|ucontrol-&gt;id
)paren
)braket
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
l_int|127
op_minus
id|mix-&gt;cvol
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_pcm_cvol_control_put
r_static
r_int
id|snd_trident_pcm_cvol_control_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|trident_t
op_star
id|trident
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|snd_trident_pcm_mixer_t
op_star
id|mix
op_assign
op_amp
id|trident-&gt;pcm_mixer
(braket
id|snd_ctl_get_ioffnum
c_func
(paren
id|kcontrol
comma
op_amp
id|ucontrol-&gt;id
)paren
)braket
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|change
op_assign
l_int|0
suffix:semicolon
id|val
op_assign
l_int|0x7f
op_minus
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|0x7f
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|change
op_assign
id|val
op_ne
id|mix-&gt;cvol
suffix:semicolon
id|mix-&gt;cvol
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|mix-&gt;voice
op_ne
l_int|NULL
)paren
id|snd_trident_write_cvol_reg
c_func
(paren
id|trident
comma
id|mix-&gt;voice
comma
id|val
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_trident_pcm_cvol_control
id|__devinitdata
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;PCM Chorus Playback Volume&quot;
comma
dot
id|access
op_assign
id|SNDRV_CTL_ELEM_ACCESS_READWRITE
op_or
id|SNDRV_CTL_ELEM_ACCESS_INACTIVE
comma
dot
id|count
op_assign
l_int|32
comma
dot
id|info
op_assign
id|snd_trident_pcm_cvol_control_info
comma
dot
id|get
op_assign
id|snd_trident_pcm_cvol_control_get
comma
dot
id|put
op_assign
id|snd_trident_pcm_cvol_control_put
comma
)brace
suffix:semicolon
DECL|function|snd_trident_notify_pcm_change1
r_static
r_void
id|snd_trident_notify_pcm_change1
c_func
(paren
id|snd_card_t
op_star
id|card
comma
id|snd_kcontrol_t
op_star
id|kctl
comma
r_int
id|num
comma
r_int
id|activate
)paren
(brace
id|snd_ctl_elem_id_t
id|id
suffix:semicolon
id|snd_runtime_check
c_func
(paren
id|kctl
op_ne
l_int|NULL
comma
r_return
)paren
suffix:semicolon
r_if
c_cond
(paren
id|activate
)paren
id|kctl-&gt;vd
(braket
id|num
)braket
dot
id|access
op_and_assign
op_complement
id|SNDRV_CTL_ELEM_ACCESS_INACTIVE
suffix:semicolon
r_else
id|kctl-&gt;vd
(braket
id|num
)braket
dot
id|access
op_or_assign
id|SNDRV_CTL_ELEM_ACCESS_INACTIVE
suffix:semicolon
id|snd_ctl_notify
c_func
(paren
id|card
comma
id|SNDRV_CTL_EVENT_MASK_VALUE
op_or
id|SNDRV_CTL_EVENT_MASK_INFO
comma
id|snd_ctl_build_ioff
c_func
(paren
op_amp
id|id
comma
id|kctl
comma
id|num
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_trident_notify_pcm_change
r_static
r_void
id|snd_trident_notify_pcm_change
c_func
(paren
id|trident_t
op_star
id|trident
comma
id|snd_trident_pcm_mixer_t
op_star
id|tmix
comma
r_int
id|num
comma
r_int
id|activate
)paren
(brace
id|snd_trident_notify_pcm_change1
c_func
(paren
id|trident-&gt;card
comma
id|trident-&gt;ctl_vol
comma
id|num
comma
id|activate
)paren
suffix:semicolon
id|snd_trident_notify_pcm_change1
c_func
(paren
id|trident-&gt;card
comma
id|trident-&gt;ctl_pan
comma
id|num
comma
id|activate
)paren
suffix:semicolon
id|snd_trident_notify_pcm_change1
c_func
(paren
id|trident-&gt;card
comma
id|trident-&gt;ctl_rvol
comma
id|num
comma
id|activate
)paren
suffix:semicolon
id|snd_trident_notify_pcm_change1
c_func
(paren
id|trident-&gt;card
comma
id|trident-&gt;ctl_cvol
comma
id|num
comma
id|activate
)paren
suffix:semicolon
)brace
DECL|function|snd_trident_pcm_mixer_build
r_static
r_int
id|snd_trident_pcm_mixer_build
c_func
(paren
id|trident_t
op_star
id|trident
comma
id|snd_trident_voice_t
op_star
id|voice
comma
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_trident_pcm_mixer_t
op_star
id|tmix
suffix:semicolon
id|snd_assert
c_func
(paren
id|trident
op_ne
l_int|NULL
op_logical_and
id|voice
op_ne
l_int|NULL
op_logical_and
id|substream
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|tmix
op_assign
op_amp
id|trident-&gt;pcm_mixer
(braket
id|substream-&gt;number
)braket
suffix:semicolon
id|tmix-&gt;voice
op_assign
id|voice
suffix:semicolon
id|tmix-&gt;vol
op_assign
id|T4D_DEFAULT_PCM_VOL
suffix:semicolon
id|tmix-&gt;pan
op_assign
id|T4D_DEFAULT_PCM_PAN
suffix:semicolon
id|tmix-&gt;rvol
op_assign
id|T4D_DEFAULT_PCM_RVOL
suffix:semicolon
id|tmix-&gt;cvol
op_assign
id|T4D_DEFAULT_PCM_CVOL
suffix:semicolon
id|snd_trident_notify_pcm_change
c_func
(paren
id|trident
comma
id|tmix
comma
id|substream-&gt;number
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_pcm_mixer_free
r_static
r_int
id|snd_trident_pcm_mixer_free
c_func
(paren
id|trident_t
op_star
id|trident
comma
id|snd_trident_voice_t
op_star
id|voice
comma
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_trident_pcm_mixer_t
op_star
id|tmix
suffix:semicolon
id|snd_assert
c_func
(paren
id|trident
op_ne
l_int|NULL
op_logical_and
id|substream
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|tmix
op_assign
op_amp
id|trident-&gt;pcm_mixer
(braket
id|substream-&gt;number
)braket
suffix:semicolon
id|tmix-&gt;voice
op_assign
l_int|NULL
suffix:semicolon
id|snd_trident_notify_pcm_change
c_func
(paren
id|trident
comma
id|tmix
comma
id|substream-&gt;number
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_mixer&n;  &n;   Description: This routine registers the 4DWave device for mixer support.&n;                &n;   Paramters:   trident - pointer to target device class for 4DWave.&n;&n;   Returns:     None&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_mixer
r_static
r_int
id|__devinit
id|snd_trident_mixer
c_func
(paren
id|trident_t
op_star
id|trident
comma
r_int
id|pcm_spdif_device
)paren
(brace
id|ac97_bus_t
id|_bus
suffix:semicolon
id|ac97_t
id|_ac97
suffix:semicolon
id|snd_card_t
op_star
id|card
op_assign
id|trident-&gt;card
suffix:semicolon
id|snd_kcontrol_t
op_star
id|kctl
suffix:semicolon
id|snd_ctl_elem_value_t
op_star
id|uctl
suffix:semicolon
r_int
id|idx
comma
id|err
comma
id|retries
op_assign
l_int|2
suffix:semicolon
id|uctl
op_assign
(paren
id|snd_ctl_elem_value_t
op_star
)paren
id|snd_kcalloc
c_func
(paren
r_sizeof
(paren
op_star
id|uctl
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|uctl
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|_bus
comma
l_int|0
comma
r_sizeof
(paren
id|_bus
)paren
)paren
suffix:semicolon
id|_bus.write
op_assign
id|snd_trident_codec_write
suffix:semicolon
id|_bus.read
op_assign
id|snd_trident_codec_read
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_bus
c_func
(paren
id|trident-&gt;card
comma
op_amp
id|_bus
comma
op_amp
id|trident-&gt;ac97_bus
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__out
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|_ac97
comma
l_int|0
comma
r_sizeof
(paren
id|_ac97
)paren
)paren
suffix:semicolon
id|_ac97.private_data
op_assign
id|trident
suffix:semicolon
id|trident-&gt;ac97_detect
op_assign
l_int|1
suffix:semicolon
id|__again
suffix:colon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_mixer
c_func
(paren
id|trident-&gt;ac97_bus
comma
op_amp
id|_ac97
comma
op_amp
id|trident-&gt;ac97
)paren
)paren
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_SI7018
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_trident_sis_reset
c_func
(paren
id|trident
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__out
suffix:semicolon
r_if
c_cond
(paren
id|retries
op_decrement
OG
l_int|0
)paren
r_goto
id|__again
suffix:semicolon
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
)brace
r_goto
id|__out
suffix:semicolon
)brace
multiline_comment|/* secondary codec? */
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_SI7018
op_logical_and
(paren
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SERIAL_INTF_CTRL
)paren
)paren
op_amp
id|SI_AC97_PRIMARY_READY
)paren
op_ne
l_int|0
)paren
(brace
id|_ac97.num
op_assign
l_int|1
suffix:semicolon
id|err
op_assign
id|snd_ac97_mixer
c_func
(paren
id|trident-&gt;ac97_bus
comma
op_amp
id|_ac97
comma
op_amp
id|trident-&gt;ac97_sec
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
id|snd_printk
c_func
(paren
l_string|&quot;SI7018: the secondary codec - invalid access&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#if 0&t;
singleline_comment|// only for my testing purpose --jk
(brace
id|ac97_t
op_star
id|mc97
suffix:semicolon
id|err
op_assign
id|snd_ac97_modem
c_func
(paren
id|trident-&gt;card
comma
op_amp
id|_ac97
comma
op_amp
id|mc97
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
id|snd_printk
c_func
(paren
l_string|&quot;snd_ac97_modem returned error %i&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
id|trident-&gt;ac97_detect
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_ne
id|TRIDENT_DEVICE_ID_SI7018
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_trident_vol_wave_control
comma
id|trident
)paren
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__out
suffix:semicolon
id|kctl
op_member_access_from_pointer
id|put
c_func
(paren
id|kctl
comma
id|uctl
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_trident_vol_music_control
comma
id|trident
)paren
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__out
suffix:semicolon
id|kctl
op_member_access_from_pointer
id|put
c_func
(paren
id|kctl
comma
id|uctl
)paren
suffix:semicolon
id|outl
c_func
(paren
id|trident-&gt;musicvol_wavevol
op_assign
l_int|0x00000000
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_MUSICVOL_WAVEVOL
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|outl
c_func
(paren
id|trident-&gt;musicvol_wavevol
op_assign
l_int|0xffff0000
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_MUSICVOL_WAVEVOL
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|32
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|snd_trident_pcm_mixer_t
op_star
id|tmix
suffix:semicolon
id|tmix
op_assign
op_amp
id|trident-&gt;pcm_mixer
(braket
id|idx
)braket
suffix:semicolon
id|tmix-&gt;voice
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|trident-&gt;ctl_vol
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_trident_pcm_vol_control
comma
id|trident
)paren
)paren
op_eq
l_int|NULL
)paren
r_goto
id|__nomem
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|trident-&gt;ctl_vol
)paren
)paren
)paren
r_goto
id|__out
suffix:semicolon
r_if
c_cond
(paren
(paren
id|trident-&gt;ctl_pan
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_trident_pcm_pan_control
comma
id|trident
)paren
)paren
op_eq
l_int|NULL
)paren
r_goto
id|__nomem
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|trident-&gt;ctl_pan
)paren
)paren
)paren
r_goto
id|__out
suffix:semicolon
r_if
c_cond
(paren
(paren
id|trident-&gt;ctl_rvol
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_trident_pcm_rvol_control
comma
id|trident
)paren
)paren
op_eq
l_int|NULL
)paren
r_goto
id|__nomem
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|trident-&gt;ctl_rvol
)paren
)paren
)paren
r_goto
id|__out
suffix:semicolon
r_if
c_cond
(paren
(paren
id|trident-&gt;ctl_cvol
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_trident_pcm_cvol_control
comma
id|trident
)paren
)paren
op_eq
l_int|NULL
)paren
r_goto
id|__nomem
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|trident-&gt;ctl_cvol
)paren
)paren
)paren
r_goto
id|__out
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_NX
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_trident_ac97_rear_control
comma
id|trident
)paren
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__out
suffix:semicolon
id|kctl
op_member_access_from_pointer
id|put
c_func
(paren
id|kctl
comma
id|uctl
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_NX
op_logical_or
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_SI7018
)paren
(brace
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_trident_spdif_control
comma
id|trident
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kctl
op_eq
l_int|NULL
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|__out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|trident-&gt;ac97-&gt;ext_id
op_amp
id|AC97_EI_SPDIF
)paren
id|kctl-&gt;id.index
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;ac97_sec
op_logical_and
(paren
id|trident-&gt;ac97_sec-&gt;ext_id
op_amp
id|AC97_EI_SPDIF
)paren
)paren
id|kctl-&gt;id.index
op_increment
suffix:semicolon
id|idx
op_assign
id|kctl-&gt;id.index
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__out
suffix:semicolon
id|kctl
op_member_access_from_pointer
id|put
c_func
(paren
id|kctl
comma
id|uctl
)paren
suffix:semicolon
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_trident_spdif_default
comma
id|trident
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kctl
op_eq
l_int|NULL
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|__out
suffix:semicolon
)brace
id|kctl-&gt;id.index
op_assign
id|idx
suffix:semicolon
id|kctl-&gt;id.device
op_assign
id|pcm_spdif_device
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__out
suffix:semicolon
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_trident_spdif_mask
comma
id|trident
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kctl
op_eq
l_int|NULL
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|__out
suffix:semicolon
)brace
id|kctl-&gt;id.index
op_assign
id|idx
suffix:semicolon
id|kctl-&gt;id.device
op_assign
id|pcm_spdif_device
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__out
suffix:semicolon
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_trident_spdif_stream
comma
id|trident
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kctl
op_eq
l_int|NULL
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|__out
suffix:semicolon
)brace
id|kctl-&gt;id.index
op_assign
id|idx
suffix:semicolon
id|kctl-&gt;id.device
op_assign
id|pcm_spdif_device
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__out
suffix:semicolon
id|trident-&gt;spdif_pcm_ctl
op_assign
id|kctl
suffix:semicolon
)brace
id|err
op_assign
l_int|0
suffix:semicolon
r_goto
id|__out
suffix:semicolon
id|__nomem
suffix:colon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|__out
suffix:colon
id|kfree
c_func
(paren
id|uctl
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; * gameport interface&n; */
macro_line|#if defined(CONFIG_GAMEPORT) || (defined(MODULE) &amp;&amp; defined(CONFIG_GAMEPORT_MODULE))
DECL|struct|snd_trident_gameport
r_typedef
r_struct
id|snd_trident_gameport
(brace
DECL|member|info
r_struct
id|gameport
id|info
suffix:semicolon
DECL|member|chip
id|trident_t
op_star
id|chip
suffix:semicolon
DECL|typedef|trident_gameport_t
)brace
id|trident_gameport_t
suffix:semicolon
DECL|function|snd_trident_gameport_read
r_static
r_int
r_char
id|snd_trident_gameport_read
c_func
(paren
r_struct
id|gameport
op_star
id|gameport
)paren
(brace
id|trident_gameport_t
op_star
id|gp
op_assign
(paren
id|trident_gameport_t
op_star
)paren
id|gameport
suffix:semicolon
id|trident_t
op_star
id|chip
suffix:semicolon
id|snd_assert
c_func
(paren
id|gp
comma
r_return
l_int|0
)paren
suffix:semicolon
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|trident_t
comma
id|gp-&gt;chip
comma
r_return
l_int|0
)paren
suffix:semicolon
r_return
id|inb
c_func
(paren
id|TRID_REG
c_func
(paren
id|chip
comma
id|GAMEPORT_LEGACY
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_trident_gameport_trigger
r_static
r_void
id|snd_trident_gameport_trigger
c_func
(paren
r_struct
id|gameport
op_star
id|gameport
)paren
(brace
id|trident_gameport_t
op_star
id|gp
op_assign
(paren
id|trident_gameport_t
op_star
)paren
id|gameport
suffix:semicolon
id|trident_t
op_star
id|chip
suffix:semicolon
id|snd_assert
c_func
(paren
id|gp
comma
r_return
)paren
suffix:semicolon
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|trident_t
comma
id|gp-&gt;chip
comma
r_return
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0xff
comma
id|TRID_REG
c_func
(paren
id|chip
comma
id|GAMEPORT_LEGACY
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_trident_gameport_cooked_read
r_static
r_int
id|snd_trident_gameport_cooked_read
c_func
(paren
r_struct
id|gameport
op_star
id|gameport
comma
r_int
op_star
id|axes
comma
r_int
op_star
id|buttons
)paren
(brace
id|trident_gameport_t
op_star
id|gp
op_assign
(paren
id|trident_gameport_t
op_star
)paren
id|gameport
suffix:semicolon
id|trident_t
op_star
id|chip
suffix:semicolon
r_int
id|i
suffix:semicolon
id|snd_assert
c_func
(paren
id|gp
comma
r_return
l_int|0
)paren
suffix:semicolon
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|trident_t
comma
id|gp-&gt;chip
comma
r_return
l_int|0
)paren
suffix:semicolon
op_star
id|buttons
op_assign
(paren
op_complement
id|inb
c_func
(paren
id|TRID_REG
c_func
(paren
id|chip
comma
id|GAMEPORT_LEGACY
)paren
)paren
op_rshift
l_int|4
)paren
op_amp
l_int|0xf
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|axes
(braket
id|i
)braket
op_assign
id|inw
c_func
(paren
id|TRID_REG
c_func
(paren
id|chip
comma
id|GAMEPORT_AXES
op_plus
id|i
op_star
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|axes
(braket
id|i
)braket
op_eq
l_int|0xffff
)paren
id|axes
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_gameport_open
r_static
r_int
id|snd_trident_gameport_open
c_func
(paren
r_struct
id|gameport
op_star
id|gameport
comma
r_int
id|mode
)paren
(brace
id|trident_gameport_t
op_star
id|gp
op_assign
(paren
id|trident_gameport_t
op_star
)paren
id|gameport
suffix:semicolon
id|trident_t
op_star
id|chip
suffix:semicolon
id|snd_assert
c_func
(paren
id|gp
comma
r_return
op_minus
l_int|1
)paren
suffix:semicolon
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|trident_t
comma
id|gp-&gt;chip
comma
r_return
op_minus
l_int|1
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|GAMEPORT_MODE_COOKED
suffix:colon
id|outb
c_func
(paren
id|GAMEPORT_MODE_ADC
comma
id|TRID_REG
c_func
(paren
id|chip
comma
id|GAMEPORT_GCR
)paren
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
op_plus
l_int|20
op_star
id|HZ
op_div
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* 20msec */
r_return
l_int|0
suffix:semicolon
r_case
id|GAMEPORT_MODE_RAW
suffix:colon
id|outb
c_func
(paren
l_int|0
comma
id|TRID_REG
c_func
(paren
id|chip
comma
id|GAMEPORT_GCR
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|snd_trident_gameport
r_void
id|__devinit
id|snd_trident_gameport
c_func
(paren
id|trident_t
op_star
id|chip
)paren
(brace
id|trident_gameport_t
op_star
id|gp
suffix:semicolon
id|gp
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|gp
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gp
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;cannot allocate gameport area&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memset
c_func
(paren
id|gp
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|gp
)paren
)paren
suffix:semicolon
id|gp-&gt;chip
op_assign
id|chip
suffix:semicolon
id|gp-&gt;info.fuzz
op_assign
l_int|64
suffix:semicolon
id|gp-&gt;info.read
op_assign
id|snd_trident_gameport_read
suffix:semicolon
id|gp-&gt;info.trigger
op_assign
id|snd_trident_gameport_trigger
suffix:semicolon
id|gp-&gt;info.cooked_read
op_assign
id|snd_trident_gameport_cooked_read
suffix:semicolon
id|gp-&gt;info.open
op_assign
id|snd_trident_gameport_open
suffix:semicolon
id|chip-&gt;gameport
op_assign
id|gp
suffix:semicolon
id|gameport_register_port
c_func
(paren
op_amp
id|gp-&gt;info
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|function|snd_trident_gameport
r_void
id|__devinit
id|snd_trident_gameport
c_func
(paren
id|trident_t
op_star
id|chip
)paren
(brace
)brace
macro_line|#endif /* CONFIG_GAMEPORT */
multiline_comment|/*&n; * delay for 1 tick&n; */
DECL|function|do_delay
r_inline
r_static
r_void
id|do_delay
c_func
(paren
id|trident_t
op_star
id|chip
)paren
(brace
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  SiS reset routine&n; */
DECL|function|snd_trident_sis_reset
r_static
r_int
id|snd_trident_sis_reset
c_func
(paren
id|trident_t
op_star
id|trident
)paren
(brace
r_int
r_int
id|end_time
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
r_int
id|r
suffix:semicolon
id|r
op_assign
id|trident-&gt;in_suspend
ques
c_cond
l_int|0
suffix:colon
l_int|2
suffix:semicolon
multiline_comment|/* count of retries */
id|__si7018_retry
suffix:colon
id|pci_write_config_byte
c_func
(paren
id|trident-&gt;pci
comma
l_int|0x46
comma
l_int|0x04
)paren
suffix:semicolon
multiline_comment|/* SOFTWARE RESET */
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|trident-&gt;pci
comma
l_int|0x46
comma
l_int|0x00
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* disable AC97 GPIO interrupt */
id|outb
c_func
(paren
l_int|0x00
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_AC97_GPIO
)paren
)paren
suffix:semicolon
multiline_comment|/* initialize serial interface, force cold reset */
id|i
op_assign
id|PCMOUT
op_or
id|SURROUT
op_or
id|CENTEROUT
op_or
id|LFEOUT
op_or
id|SECONDARY_ID
op_or
id|COLD_RESET
suffix:semicolon
id|outl
c_func
(paren
id|i
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SERIAL_INTF_CTRL
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* remove cold reset */
id|i
op_and_assign
op_complement
id|COLD_RESET
suffix:semicolon
id|outl
c_func
(paren
id|i
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SERIAL_INTF_CTRL
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|2000
)paren
suffix:semicolon
multiline_comment|/* wait, until the codec is ready */
id|end_time
op_assign
(paren
id|jiffies
op_plus
(paren
id|HZ
op_star
l_int|3
)paren
op_div
l_int|4
)paren
op_plus
l_int|1
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SERIAL_INTF_CTRL
)paren
)paren
op_amp
id|SI_AC97_PRIMARY_READY
)paren
op_ne
l_int|0
)paren
r_goto
id|__si7018_ok
suffix:semicolon
id|do_delay
c_func
(paren
id|trident
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|time_after_eq
c_func
(paren
id|end_time
comma
id|jiffies
)paren
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;AC&squot;97 codec ready error [0x%x]&bslash;n&quot;
comma
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SERIAL_INTF_CTRL
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
op_decrement
OG
l_int|0
)paren
(brace
id|end_time
op_assign
id|jiffies
op_plus
id|HZ
suffix:semicolon
r_do
(brace
id|do_delay
c_func
(paren
id|trident
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|time_after_eq
c_func
(paren
id|end_time
comma
id|jiffies
)paren
)paren
suffix:semicolon
r_goto
id|__si7018_retry
suffix:semicolon
)brace
id|__si7018_ok
suffix:colon
multiline_comment|/* wait for the second codec */
r_do
(brace
r_if
c_cond
(paren
(paren
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SERIAL_INTF_CTRL
)paren
)paren
op_amp
id|SI_AC97_SECONDARY_READY
)paren
op_ne
l_int|0
)paren
r_break
suffix:semicolon
id|do_delay
c_func
(paren
id|trident
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|time_after_eq
c_func
(paren
id|end_time
comma
id|jiffies
)paren
)paren
suffix:semicolon
multiline_comment|/* enable 64 channel mode */
id|outl
c_func
(paren
id|BANK_B_EN
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_LFO_GC_CIR
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*  &n; *  /proc interface&n; */
DECL|function|snd_trident_proc_read
r_static
r_void
id|snd_trident_proc_read
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_magic_cast
c_func
(paren
id|trident_t
comma
id|entry-&gt;private_data
comma
r_return
)paren
suffix:semicolon
r_char
op_star
id|s
suffix:semicolon
r_switch
c_cond
(paren
id|trident-&gt;device
)paren
(brace
r_case
id|TRIDENT_DEVICE_ID_SI7018
suffix:colon
id|s
op_assign
l_string|&quot;SiS 7018 Audio&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TRIDENT_DEVICE_ID_DX
suffix:colon
id|s
op_assign
l_string|&quot;Trident 4DWave PCI DX&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TRIDENT_DEVICE_ID_NX
suffix:colon
id|s
op_assign
l_string|&quot;Trident 4DWave PCI NX&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|s
op_assign
l_string|&quot;???&quot;
suffix:semicolon
)brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%s&bslash;n&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Spurious IRQs    : %d&bslash;n&quot;
comma
id|trident-&gt;spurious_irq_count
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Spurious IRQ dlta: %d&bslash;n&quot;
comma
id|trident-&gt;spurious_irq_max_delta
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_NX
op_logical_or
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_SI7018
)paren
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;IEC958 Mixer Out : %s&bslash;n&quot;
comma
id|trident-&gt;spdif_ctrl
op_eq
l_int|0x28
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_NX
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Rear Speakers    : %s&bslash;n&quot;
comma
id|trident-&gt;ac97_ctrl
op_amp
l_int|0x00000010
ques
c_cond
l_string|&quot;on&quot;
suffix:colon
l_string|&quot;off&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;tlb.entries
)paren
(brace
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;nVirtual Memory&bslash;n&quot;
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Memory Maximum : %d&bslash;n&quot;
comma
id|trident-&gt;tlb.memhdr-&gt;size
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Memory Used    : %d&bslash;n&quot;
comma
id|trident-&gt;tlb.memhdr-&gt;used
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Memory Free    : %d&bslash;n&quot;
comma
id|snd_util_mem_avail
c_func
(paren
id|trident-&gt;tlb.memhdr
)paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#if defined(CONFIG_SND_SEQUENCER) || (defined(MODULE) &amp;&amp; defined(CONFIG_SND_SEQUENCER_MODULE))
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;nWavetable Synth&bslash;n&quot;
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Memory Maximum : %d&bslash;n&quot;
comma
id|trident-&gt;synth.max_size
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Memory Used    : %d&bslash;n&quot;
comma
id|trident-&gt;synth.current_size
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Memory Free    : %d&bslash;n&quot;
comma
(paren
id|trident-&gt;synth.max_size
op_minus
id|trident-&gt;synth.current_size
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|snd_trident_proc_init
r_static
r_void
id|__devinit
id|snd_trident_proc_init
c_func
(paren
id|trident_t
op_star
id|trident
)paren
(brace
id|snd_info_entry_t
op_star
id|entry
suffix:semicolon
r_const
r_char
op_star
id|s
op_assign
l_string|&quot;trident&quot;
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_SI7018
)paren
id|s
op_assign
l_string|&quot;sis7018&quot;
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_card_proc_new
c_func
(paren
id|trident-&gt;card
comma
id|s
comma
op_amp
id|entry
)paren
)paren
id|snd_info_set_text_ops
c_func
(paren
id|entry
comma
id|trident
comma
l_int|1024
comma
id|snd_trident_proc_read
)paren
suffix:semicolon
)brace
DECL|function|snd_trident_dev_free
r_static
r_int
id|snd_trident_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_magic_cast
c_func
(paren
id|trident_t
comma
id|device-&gt;device_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_return
id|snd_trident_free
c_func
(paren
id|trident
)paren
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_tlb_alloc&n;  &n;   Description: Allocate and set up the TLB page table on 4D NX.&n;&t;&t;Each entry has 4 bytes (physical PCI address).&n;                &n;   Paramters:   trident - pointer to target device class for 4DWave.&n;&n;   Returns:     0 or negative error code&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_tlb_alloc
r_static
r_int
id|__devinit
id|snd_trident_tlb_alloc
c_func
(paren
id|trident_t
op_star
id|trident
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* TLB array must be aligned to 16kB !!! so we allocate&n;&t;   32kB region and correct offset when necessary */
r_if
c_cond
(paren
id|snd_dma_alloc_pages
c_func
(paren
op_amp
id|trident-&gt;dma_dev
comma
l_int|2
op_star
id|SNDRV_TRIDENT_MAX_PAGES
op_star
l_int|4
comma
op_amp
id|trident-&gt;tlb.buffer
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;trident: unable to allocate TLB buffer&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|trident-&gt;tlb.entries
op_assign
(paren
r_int
r_int
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|trident-&gt;tlb.buffer.area
op_plus
id|SNDRV_TRIDENT_MAX_PAGES
op_star
l_int|4
op_minus
l_int|1
)paren
op_amp
op_complement
(paren
id|SNDRV_TRIDENT_MAX_PAGES
op_star
l_int|4
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|trident-&gt;tlb.entries_dmaaddr
op_assign
(paren
id|trident-&gt;tlb.buffer.addr
op_plus
id|SNDRV_TRIDENT_MAX_PAGES
op_star
l_int|4
op_minus
l_int|1
)paren
op_amp
op_complement
(paren
id|SNDRV_TRIDENT_MAX_PAGES
op_star
l_int|4
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* allocate shadow TLB page table (virtual addresses) */
id|trident-&gt;tlb.shadow_entries
op_assign
(paren
r_int
r_int
op_star
)paren
id|vmalloc
c_func
(paren
id|SNDRV_TRIDENT_MAX_PAGES
op_star
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;tlb.shadow_entries
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;trident: unable to allocate shadow TLB entries&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
multiline_comment|/* allocate and setup silent page and initialise TLB entries */
r_if
c_cond
(paren
id|snd_dma_alloc_pages
c_func
(paren
op_amp
id|trident-&gt;dma_dev
comma
id|SNDRV_TRIDENT_PAGE_SIZE
comma
op_amp
id|trident-&gt;tlb.silent_page
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;trident: unable to allocate silent page&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|trident-&gt;tlb.silent_page.area
comma
l_int|0
comma
id|SNDRV_TRIDENT_PAGE_SIZE
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SNDRV_TRIDENT_MAX_PAGES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|trident-&gt;tlb.entries
(braket
id|i
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|trident-&gt;tlb.silent_page.addr
op_amp
op_complement
(paren
id|SNDRV_TRIDENT_PAGE_SIZE
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|trident-&gt;tlb.shadow_entries
(braket
id|i
)braket
op_assign
(paren
r_int
r_int
)paren
id|trident-&gt;tlb.silent_page.area
suffix:semicolon
)brace
multiline_comment|/* use emu memory block manager code to manage tlb page allocation */
id|trident-&gt;tlb.memhdr
op_assign
id|snd_util_memhdr_new
c_func
(paren
id|SNDRV_TRIDENT_PAGE_SIZE
op_star
id|SNDRV_TRIDENT_MAX_PAGES
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;tlb.memhdr
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|trident-&gt;tlb.memhdr-&gt;block_extra_size
op_assign
r_sizeof
(paren
id|snd_trident_memblk_arg_t
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * initialize 4D DX chip&n; */
DECL|function|snd_trident_stop_all_voices
r_static
r_void
id|snd_trident_stop_all_voices
c_func
(paren
id|trident_t
op_star
id|trident
)paren
(brace
id|outl
c_func
(paren
l_int|0xffffffff
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_STOP_A
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0xffffffff
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_STOP_B
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_AINTEN_A
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_AINTEN_B
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_trident_4d_dx_init
r_static
r_int
id|snd_trident_4d_dx_init
c_func
(paren
id|trident_t
op_star
id|trident
)paren
(brace
r_struct
id|pci_dev
op_star
id|pci
op_assign
id|trident-&gt;pci
suffix:semicolon
r_int
r_int
id|end_time
suffix:semicolon
multiline_comment|/* reset the legacy configuration and whole audio/wavetable block */
id|pci_write_config_dword
c_func
(paren
id|pci
comma
l_int|0x40
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* DDMA */
id|pci_write_config_byte
c_func
(paren
id|pci
comma
l_int|0x44
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* ports */
id|pci_write_config_byte
c_func
(paren
id|pci
comma
l_int|0x45
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Legacy DMA */
id|pci_write_config_byte
c_func
(paren
id|pci
comma
l_int|0x46
comma
l_int|4
)paren
suffix:semicolon
multiline_comment|/* reset */
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pci
comma
l_int|0x46
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* release reset */
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* warm reset of the AC&squot;97 codec */
id|outl
c_func
(paren
l_int|0x00000001
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|DX_ACR2_AC97_COM_STAT
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x00000000
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|DX_ACR2_AC97_COM_STAT
)paren
)paren
suffix:semicolon
multiline_comment|/* DAC on, disable SB IRQ and try to force ADC valid signal */
id|trident-&gt;ac97_ctrl
op_assign
l_int|0x0000004a
suffix:semicolon
id|outl
c_func
(paren
id|trident-&gt;ac97_ctrl
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|DX_ACR2_AC97_COM_STAT
)paren
)paren
suffix:semicolon
multiline_comment|/* wait, until the codec is ready */
id|end_time
op_assign
(paren
id|jiffies
op_plus
(paren
id|HZ
op_star
l_int|3
)paren
op_div
l_int|4
)paren
op_plus
l_int|1
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|DX_ACR2_AC97_COM_STAT
)paren
)paren
op_amp
l_int|0x0010
)paren
op_ne
l_int|0
)paren
r_goto
id|__dx_ok
suffix:semicolon
id|do_delay
c_func
(paren
id|trident
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|time_after_eq
c_func
(paren
id|end_time
comma
id|jiffies
)paren
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;AC&squot;97 codec ready error&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
id|__dx_ok
suffix:colon
id|snd_trident_stop_all_voices
c_func
(paren
id|trident
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * initialize 4D NX chip&n; */
DECL|function|snd_trident_4d_nx_init
r_static
r_int
id|snd_trident_4d_nx_init
c_func
(paren
id|trident_t
op_star
id|trident
)paren
(brace
r_struct
id|pci_dev
op_star
id|pci
op_assign
id|trident-&gt;pci
suffix:semicolon
r_int
r_int
id|end_time
suffix:semicolon
multiline_comment|/* reset the legacy configuration and whole audio/wavetable block */
id|pci_write_config_dword
c_func
(paren
id|pci
comma
l_int|0x40
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* DDMA */
id|pci_write_config_byte
c_func
(paren
id|pci
comma
l_int|0x44
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* ports */
id|pci_write_config_byte
c_func
(paren
id|pci
comma
l_int|0x45
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Legacy DMA */
id|pci_write_config_byte
c_func
(paren
id|pci
comma
l_int|0x46
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* reset */
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pci
comma
l_int|0x46
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* release reset */
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* warm reset of the AC&squot;97 codec */
id|outl
c_func
(paren
l_int|0x00000001
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_ACR0_AC97_COM_STAT
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|outl
c_func
(paren
l_int|0x00000000
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_ACR0_AC97_COM_STAT
)paren
)paren
suffix:semicolon
multiline_comment|/* wait, until the codec is ready */
id|end_time
op_assign
(paren
id|jiffies
op_plus
(paren
id|HZ
op_star
l_int|3
)paren
op_div
l_int|4
)paren
op_plus
l_int|1
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_ACR0_AC97_COM_STAT
)paren
)paren
op_amp
l_int|0x0008
)paren
op_ne
l_int|0
)paren
r_goto
id|__nx_ok
suffix:semicolon
id|do_delay
c_func
(paren
id|trident
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|time_after_eq
c_func
(paren
id|end_time
comma
id|jiffies
)paren
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;AC&squot;97 codec ready error [0x%x]&bslash;n&quot;
comma
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_ACR0_AC97_COM_STAT
)paren
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
id|__nx_ok
suffix:colon
multiline_comment|/* DAC on */
id|trident-&gt;ac97_ctrl
op_assign
l_int|0x00000002
suffix:semicolon
id|outl
c_func
(paren
id|trident-&gt;ac97_ctrl
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_ACR0_AC97_COM_STAT
)paren
)paren
suffix:semicolon
multiline_comment|/* disable SB IRQ */
id|outl
c_func
(paren
id|NX_SB_IRQ_DISABLE
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_MISCINT
)paren
)paren
suffix:semicolon
id|snd_trident_stop_all_voices
c_func
(paren
id|trident
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;tlb.entries
op_ne
l_int|NULL
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
multiline_comment|/* enable virtual addressing via TLB */
id|i
op_assign
id|trident-&gt;tlb.entries_dmaaddr
suffix:semicolon
id|i
op_or_assign
l_int|0x00000001
suffix:semicolon
id|outl
c_func
(paren
id|i
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_TLBC
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|outl
c_func
(paren
l_int|0
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_TLBC
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* initialize S/PDIF */
id|outl
c_func
(paren
id|trident-&gt;spdif_bits
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPCSTATUS
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|trident-&gt;spdif_ctrl
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPCTRL_SPCSO
op_plus
l_int|3
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * initialize sis7018 chip&n; */
DECL|function|snd_trident_sis_init
r_static
r_int
id|snd_trident_sis_init
c_func
(paren
id|trident_t
op_star
id|trident
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_trident_sis_reset
c_func
(paren
id|trident
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_trident_stop_all_voices
c_func
(paren
id|trident
)paren
suffix:semicolon
multiline_comment|/* initialize S/PDIF */
id|outl
c_func
(paren
id|trident-&gt;spdif_bits
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SPDIF_CS
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_create&n;  &n;   Description: This routine will create the device specific class for&n;                the 4DWave card. It will also perform basic initialization.&n;                &n;   Paramters:   card  - which card to create&n;                pci   - interface to PCI bus resource info&n;                dma1ptr - playback dma buffer&n;                dma2ptr - capture dma buffer&n;                irqptr  -  interrupt resource info&n;&n;   Returns:     4DWave device class private data&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_create
r_int
id|__devinit
id|snd_trident_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_struct
id|pci_dev
op_star
id|pci
comma
r_int
id|pcm_streams
comma
r_int
id|pcm_spdif_device
comma
r_int
id|max_wavetable_size
comma
id|trident_t
op_star
op_star
id|rtrident
)paren
(brace
id|trident_t
op_star
id|trident
suffix:semicolon
r_int
id|i
comma
id|err
suffix:semicolon
id|snd_trident_voice_t
op_star
id|voice
suffix:semicolon
id|snd_trident_pcm_mixer_t
op_star
id|tmix
suffix:semicolon
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
dot
id|dev_free
op_assign
id|snd_trident_dev_free
comma
)brace
suffix:semicolon
op_star
id|rtrident
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* enable PCI device */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pci
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* check, if we can restrict PCI DMA transfers to 30 bits */
r_if
c_cond
(paren
id|pci_set_dma_mask
c_func
(paren
id|pci
comma
l_int|0x3fffffff
)paren
OL
l_int|0
op_logical_or
id|pci_set_consistent_dma_mask
c_func
(paren
id|pci
comma
l_int|0x3fffffff
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;architecture does not support 30bit PCI busmaster DMA&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
id|trident
op_assign
id|snd_magic_kcalloc
c_func
(paren
id|trident_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|trident-&gt;device
op_assign
(paren
id|pci-&gt;vendor
op_lshift
l_int|16
)paren
op_or
id|pci-&gt;device
suffix:semicolon
id|trident-&gt;card
op_assign
id|card
suffix:semicolon
id|trident-&gt;pci
op_assign
id|pci
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|trident-&gt;event_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|trident-&gt;voice_alloc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcm_streams
OL
l_int|1
)paren
id|pcm_streams
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|pcm_streams
OG
l_int|32
)paren
id|pcm_streams
op_assign
l_int|32
suffix:semicolon
id|trident-&gt;ChanPCM
op_assign
id|pcm_streams
suffix:semicolon
r_if
c_cond
(paren
id|max_wavetable_size
OL
l_int|0
)paren
id|max_wavetable_size
op_assign
l_int|0
suffix:semicolon
id|trident-&gt;synth.max_size
op_assign
id|max_wavetable_size
op_star
l_int|1024
suffix:semicolon
id|trident-&gt;port
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
suffix:semicolon
id|trident-&gt;irq
op_assign
op_minus
l_int|1
suffix:semicolon
id|trident-&gt;midi_port
op_assign
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_MPU401_BASE
)paren
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pci
)paren
suffix:semicolon
id|trident-&gt;port
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|trident-&gt;res_port
op_assign
id|request_region
c_func
(paren
id|trident-&gt;port
comma
l_int|0x100
comma
l_string|&quot;Trident Audio&quot;
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab I/O region 0x%lx-0x%lx&bslash;n&quot;
comma
id|trident-&gt;port
comma
id|trident-&gt;port
op_plus
l_int|0x100
op_minus
l_int|1
)paren
suffix:semicolon
id|snd_trident_free
c_func
(paren
id|trident
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|pci-&gt;irq
comma
id|snd_trident_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
l_string|&quot;Trident Audio&quot;
comma
(paren
r_void
op_star
)paren
id|trident
)paren
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab IRQ %d&bslash;n&quot;
comma
id|pci-&gt;irq
)paren
suffix:semicolon
id|snd_trident_free
c_func
(paren
id|trident
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|trident-&gt;irq
op_assign
id|pci-&gt;irq
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|trident-&gt;dma_dev
comma
l_int|0
comma
r_sizeof
(paren
id|trident-&gt;dma_dev
)paren
)paren
suffix:semicolon
id|trident-&gt;dma_dev.type
op_assign
id|SNDRV_DMA_TYPE_PCI
suffix:semicolon
id|trident-&gt;dma_dev.dev.pci
op_assign
id|pci
suffix:semicolon
multiline_comment|/* allocate 16k-aligned TLB for NX cards */
id|trident-&gt;tlb.entries
op_assign
l_int|NULL
suffix:semicolon
id|trident-&gt;tlb.buffer.area
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_NX
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_trident_tlb_alloc
c_func
(paren
id|trident
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_trident_free
c_func
(paren
id|trident
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
)brace
id|trident-&gt;spdif_bits
op_assign
id|trident-&gt;spdif_pcm_bits
op_assign
id|SNDRV_PCM_DEFAULT_CON_SPDIF
suffix:semicolon
multiline_comment|/* initialize chip */
r_switch
c_cond
(paren
id|trident-&gt;device
)paren
(brace
r_case
id|TRIDENT_DEVICE_ID_DX
suffix:colon
id|err
op_assign
id|snd_trident_4d_dx_init
c_func
(paren
id|trident
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TRIDENT_DEVICE_ID_NX
suffix:colon
id|err
op_assign
id|snd_trident_4d_nx_init
c_func
(paren
id|trident
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TRIDENT_DEVICE_ID_SI7018
suffix:colon
id|err
op_assign
id|snd_trident_sis_init
c_func
(paren
id|trident
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|snd_BUG
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_trident_free
c_func
(paren
id|trident
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_trident_mixer
c_func
(paren
id|trident
comma
id|pcm_spdif_device
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_trident_free
c_func
(paren
id|trident
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* initialise synth voices */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|64
suffix:semicolon
id|i
op_increment
)paren
(brace
id|voice
op_assign
op_amp
id|trident-&gt;synth.voices
(braket
id|i
)braket
suffix:semicolon
id|voice-&gt;number
op_assign
id|i
suffix:semicolon
id|voice-&gt;trident
op_assign
id|trident
suffix:semicolon
)brace
multiline_comment|/* initialize pcm mixer entries */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
id|tmix
op_assign
op_amp
id|trident-&gt;pcm_mixer
(braket
id|i
)braket
suffix:semicolon
id|tmix-&gt;vol
op_assign
id|T4D_DEFAULT_PCM_VOL
suffix:semicolon
id|tmix-&gt;pan
op_assign
id|T4D_DEFAULT_PCM_PAN
suffix:semicolon
id|tmix-&gt;rvol
op_assign
id|T4D_DEFAULT_PCM_RVOL
suffix:semicolon
id|tmix-&gt;cvol
op_assign
id|T4D_DEFAULT_PCM_CVOL
suffix:semicolon
)brace
id|snd_trident_enable_eso
c_func
(paren
id|trident
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PM
id|card-&gt;set_power_state
op_assign
id|snd_trident_set_power_state
suffix:semicolon
id|card-&gt;power_state_private_data
op_assign
id|trident
suffix:semicolon
macro_line|#endif
id|snd_trident_proc_init
c_func
(paren
id|trident
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|trident
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_trident_free
c_func
(paren
id|trident
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|snd_card_set_dev
c_func
(paren
id|card
comma
op_amp
id|pci-&gt;dev
)paren
suffix:semicolon
op_star
id|rtrident
op_assign
id|trident
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_free&n;  &n;   Description: This routine will free the device specific class for&n;            q    the 4DWave card. &n;                &n;   Paramters:   trident  - device specific private data for 4DWave card&n;&n;   Returns:     None.&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_free
r_int
id|snd_trident_free
c_func
(paren
id|trident_t
op_star
id|trident
)paren
(brace
macro_line|#if defined(CONFIG_GAMEPORT) || (defined(MODULE) &amp;&amp; defined(CONFIG_GAMEPORT_MODULE))
r_if
c_cond
(paren
id|trident-&gt;gameport
)paren
(brace
id|gameport_unregister_port
c_func
(paren
op_amp
id|trident-&gt;gameport-&gt;info
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|trident-&gt;gameport
)paren
suffix:semicolon
)brace
macro_line|#endif
id|snd_trident_disable_eso
c_func
(paren
id|trident
)paren
suffix:semicolon
singleline_comment|// Disable S/PDIF out
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_NX
)paren
id|outb
c_func
(paren
l_int|0x00
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPCTRL_SPCSO
op_plus
l_int|3
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|trident-&gt;device
op_eq
id|TRIDENT_DEVICE_ID_SI7018
)paren
(brace
id|outl
c_func
(paren
l_int|0
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|SI_SERIAL_INTF_CTRL
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|trident-&gt;tlb.buffer.area
)paren
(brace
id|outl
c_func
(paren
l_int|0
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_TLBC
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;tlb.memhdr
)paren
id|snd_util_memhdr_free
c_func
(paren
id|trident-&gt;tlb.memhdr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;tlb.silent_page.area
)paren
id|snd_dma_free_pages
c_func
(paren
op_amp
id|trident-&gt;dma_dev
comma
op_amp
id|trident-&gt;tlb.silent_page
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;tlb.shadow_entries
)paren
id|vfree
c_func
(paren
id|trident-&gt;tlb.shadow_entries
)paren
suffix:semicolon
id|snd_dma_free_pages
c_func
(paren
op_amp
id|trident-&gt;dma_dev
comma
op_amp
id|trident-&gt;tlb.buffer
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|trident-&gt;irq
op_ge
l_int|0
)paren
id|free_irq
c_func
(paren
id|trident-&gt;irq
comma
(paren
r_void
op_star
)paren
id|trident
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;res_port
)paren
(brace
id|release_resource
c_func
(paren
id|trident-&gt;res_port
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|trident-&gt;res_port
)paren
suffix:semicolon
)brace
id|snd_magic_kfree
c_func
(paren
id|trident
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_interrupt&n;  &n;   Description: ISR for Trident 4DWave device&n;                &n;   Paramters:   trident  - device specific private data for 4DWave card&n;&n;   Problems:    It seems that Trident chips generates interrupts more than&n;                one time in special cases. The spurious interrupts are&n;                detected via sample timer (T4D_STIMER) and computing&n;                corresponding delta value. The limits are detected with&n;                the method try &amp; fail so it is possible that it won&squot;t&n;                work on all computers. [jaroslav]&n;&n;   Returns:     None.&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_interrupt
r_static
id|irqreturn_t
id|snd_trident_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|trident_t
op_star
id|trident
op_assign
id|snd_magic_cast
c_func
(paren
id|trident_t
comma
id|dev_id
comma
r_return
id|IRQ_NONE
)paren
suffix:semicolon
r_int
r_int
id|audio_int
comma
id|chn_int
comma
id|stimer
comma
id|channel
comma
id|mask
comma
id|tmp
suffix:semicolon
r_int
id|delta
suffix:semicolon
id|snd_trident_voice_t
op_star
id|voice
suffix:semicolon
id|audio_int
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_MISCINT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|audio_int
op_amp
(paren
id|ADDRESS_IRQ
op_or
id|MPU401_IRQ
)paren
)paren
op_eq
l_int|0
)paren
r_return
id|IRQ_NONE
suffix:semicolon
r_if
c_cond
(paren
id|audio_int
op_amp
id|ADDRESS_IRQ
)paren
(brace
singleline_comment|// get interrupt status for all channels
id|spin_lock
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
id|stimer
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_STIMER
)paren
)paren
op_amp
l_int|0x00ffffff
suffix:semicolon
id|chn_int
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_AINT_A
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chn_int
op_eq
l_int|0
)paren
r_goto
id|__skip1
suffix:semicolon
id|outl
c_func
(paren
id|chn_int
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_AINT_A
)paren
)paren
suffix:semicolon
multiline_comment|/* ack */
id|__skip1
suffix:colon
id|chn_int
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_AINT_B
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chn_int
op_eq
l_int|0
)paren
r_goto
id|__skip2
suffix:semicolon
r_for
c_loop
(paren
id|channel
op_assign
l_int|63
suffix:semicolon
id|channel
op_ge
l_int|32
suffix:semicolon
id|channel
op_decrement
)paren
(brace
id|mask
op_assign
l_int|1
op_lshift
(paren
id|channel
op_amp
l_int|0x1f
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chn_int
op_amp
id|mask
)paren
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
id|voice
op_assign
op_amp
id|trident-&gt;synth.voices
(braket
id|channel
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|voice-&gt;pcm
op_logical_or
id|voice-&gt;substream
op_eq
l_int|NULL
)paren
(brace
id|outl
c_func
(paren
id|mask
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_STOP_B
)paren
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|delta
op_assign
(paren
r_int
)paren
id|stimer
op_minus
(paren
r_int
)paren
id|voice-&gt;stimer
suffix:semicolon
r_if
c_cond
(paren
id|delta
OL
l_int|0
)paren
id|delta
op_assign
op_minus
id|delta
suffix:semicolon
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
id|delta
OL
id|voice-&gt;spurious_threshold
)paren
(brace
multiline_comment|/* do some statistics here */
id|trident-&gt;spurious_irq_count
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;spurious_irq_max_delta
OL
(paren
r_int
r_int
)paren
id|delta
)paren
id|trident-&gt;spurious_irq_max_delta
op_assign
id|delta
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|voice-&gt;stimer
op_assign
id|stimer
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;isync
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|voice-&gt;isync3
)paren
(brace
id|tmp
op_assign
id|inw
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_SBBL_SBCL
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;bDMAStart
op_amp
l_int|0x40
)paren
id|tmp
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|tmp
OG
l_int|0
)paren
id|tmp
op_assign
id|voice-&gt;isync_max
op_minus
id|tmp
suffix:semicolon
)brace
r_else
(brace
id|tmp
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|NX_SPCTRL_SPCSO
)paren
)paren
op_amp
l_int|0x00ffffff
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tmp
OL
id|voice-&gt;isync_mark
)paren
(brace
r_if
c_cond
(paren
id|tmp
OG
l_int|0x10
)paren
id|tmp
op_assign
id|voice-&gt;isync_ESO
op_minus
l_int|7
suffix:semicolon
r_else
id|tmp
op_assign
id|voice-&gt;isync_ESO
op_plus
l_int|2
suffix:semicolon
multiline_comment|/* update ESO for IRQ voice to preserve sync */
id|snd_trident_stop_voice
c_func
(paren
id|trident
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|snd_trident_write_eso_reg
c_func
(paren
id|trident
comma
id|voice
comma
id|tmp
)paren
suffix:semicolon
id|snd_trident_start_voice
c_func
(paren
id|trident
comma
id|voice-&gt;number
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|voice-&gt;isync2
)paren
(brace
id|voice-&gt;isync2
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* write original ESO and update CSO for IRQ voice to preserve sync */
id|snd_trident_stop_voice
c_func
(paren
id|trident
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|snd_trident_write_cso_reg
c_func
(paren
id|trident
comma
id|voice
comma
id|voice-&gt;isync_mark
)paren
suffix:semicolon
id|snd_trident_write_eso_reg
c_func
(paren
id|trident
comma
id|voice
comma
id|voice-&gt;ESO
)paren
suffix:semicolon
id|snd_trident_start_voice
c_func
(paren
id|trident
comma
id|voice-&gt;number
)paren
suffix:semicolon
)brace
macro_line|#if 0
r_if
c_cond
(paren
id|voice-&gt;extra
)paren
(brace
multiline_comment|/* update CSO for extra voice to preserve sync */
id|snd_trident_stop_voice
c_func
(paren
id|trident
comma
id|voice-&gt;extra-&gt;number
)paren
suffix:semicolon
id|snd_trident_write_cso_reg
c_func
(paren
id|trident
comma
id|voice-&gt;extra
comma
l_int|0
)paren
suffix:semicolon
id|snd_trident_start_voice
c_func
(paren
id|trident
comma
id|voice-&gt;extra-&gt;number
)paren
suffix:semicolon
)brace
macro_line|#endif
id|spin_unlock
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
id|snd_pcm_period_elapsed
c_func
(paren
id|voice-&gt;substream
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
)brace
id|outl
c_func
(paren
id|chn_int
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_AINT_B
)paren
)paren
suffix:semicolon
multiline_comment|/* ack */
id|__skip2
suffix:colon
id|spin_unlock
c_func
(paren
op_amp
id|trident-&gt;reg_lock
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|audio_int
op_amp
id|MPU401_IRQ
)paren
(brace
r_if
c_cond
(paren
id|trident-&gt;rmidi
)paren
(brace
id|snd_mpu401_uart_interrupt
c_func
(paren
id|irq
comma
id|trident-&gt;rmidi-&gt;private_data
comma
id|regs
)paren
suffix:semicolon
)brace
r_else
(brace
id|inb
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_MPUR0
)paren
)paren
suffix:semicolon
)brace
)brace
singleline_comment|// outl((ST_TARGET_REACHED | MIXER_OVERFLOW | MIXER_UNDERFLOW), TRID_REG(trident, T4D_MISCINT));
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
multiline_comment|/*---------------------------------------------------------------------------&n;   snd_trident_attach_synthesizer, snd_trident_detach_synthesizer&n;  &n;   Description: Attach/detach synthesizer hooks&n;                &n;   Paramters:   trident  - device specific private data for 4DWave card&n;&n;   Returns:     None.&n;  &n;  ---------------------------------------------------------------------------*/
DECL|function|snd_trident_attach_synthesizer
r_int
id|snd_trident_attach_synthesizer
c_func
(paren
id|trident_t
op_star
id|trident
)paren
(brace
macro_line|#if defined(CONFIG_SND_SEQUENCER) || (defined(MODULE) &amp;&amp; defined(CONFIG_SND_SEQUENCER_MODULE))
r_if
c_cond
(paren
id|snd_seq_device_new
c_func
(paren
id|trident-&gt;card
comma
l_int|1
comma
id|SNDRV_SEQ_DEV_ID_TRIDENT
comma
r_sizeof
(paren
id|trident_t
op_star
)paren
comma
op_amp
id|trident-&gt;seq_dev
)paren
op_ge
l_int|0
)paren
(brace
id|strcpy
c_func
(paren
id|trident-&gt;seq_dev-&gt;name
comma
l_string|&quot;4DWave&quot;
)paren
suffix:semicolon
op_star
(paren
id|trident_t
op_star
op_star
)paren
id|SNDRV_SEQ_DEVICE_ARGPTR
c_func
(paren
id|trident-&gt;seq_dev
)paren
op_assign
id|trident
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_detach_synthesizer
r_int
id|snd_trident_detach_synthesizer
c_func
(paren
id|trident_t
op_star
id|trident
)paren
(brace
macro_line|#if defined(CONFIG_SND_SEQUENCER) || (defined(MODULE) &amp;&amp; defined(CONFIG_SND_SEQUENCER_MODULE))
r_if
c_cond
(paren
id|trident-&gt;seq_dev
)paren
(brace
id|snd_device_free
c_func
(paren
id|trident-&gt;card
comma
id|trident-&gt;seq_dev
)paren
suffix:semicolon
id|trident-&gt;seq_dev
op_assign
l_int|NULL
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_alloc_voice
id|snd_trident_voice_t
op_star
id|snd_trident_alloc_voice
c_func
(paren
id|trident_t
op_star
id|trident
comma
r_int
id|type
comma
r_int
id|client
comma
r_int
id|port
)paren
(brace
id|snd_trident_voice_t
op_star
id|pvoice
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|idx
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|trident-&gt;voice_alloc
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|type
op_eq
id|SNDRV_TRIDENT_VOICE_TYPE_PCM
)paren
(brace
id|idx
op_assign
id|snd_trident_allocate_pcm_channel
c_func
(paren
id|trident
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idx
OL
l_int|0
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;voice_alloc
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|pvoice
op_assign
op_amp
id|trident-&gt;synth.voices
(braket
id|idx
)braket
suffix:semicolon
id|pvoice-&gt;use
op_assign
l_int|1
suffix:semicolon
id|pvoice-&gt;pcm
op_assign
l_int|1
suffix:semicolon
id|pvoice-&gt;capture
op_assign
l_int|0
suffix:semicolon
id|pvoice-&gt;spdif
op_assign
l_int|0
suffix:semicolon
id|pvoice-&gt;memblk
op_assign
l_int|NULL
suffix:semicolon
id|pvoice-&gt;substream
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;voice_alloc
comma
id|flags
)paren
suffix:semicolon
r_return
id|pvoice
suffix:semicolon
)brace
r_if
c_cond
(paren
id|type
op_eq
id|SNDRV_TRIDENT_VOICE_TYPE_SYNTH
)paren
(brace
id|idx
op_assign
id|snd_trident_allocate_synth_channel
c_func
(paren
id|trident
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idx
OL
l_int|0
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;voice_alloc
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|pvoice
op_assign
op_amp
id|trident-&gt;synth.voices
(braket
id|idx
)braket
suffix:semicolon
id|pvoice-&gt;use
op_assign
l_int|1
suffix:semicolon
id|pvoice-&gt;synth
op_assign
l_int|1
suffix:semicolon
id|pvoice-&gt;client
op_assign
id|client
suffix:semicolon
id|pvoice-&gt;port
op_assign
id|port
suffix:semicolon
id|pvoice-&gt;memblk
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;voice_alloc
comma
id|flags
)paren
suffix:semicolon
r_return
id|pvoice
suffix:semicolon
)brace
r_if
c_cond
(paren
id|type
op_eq
id|SNDRV_TRIDENT_VOICE_TYPE_MIDI
)paren
(brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;voice_alloc
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|snd_trident_free_voice
r_void
id|snd_trident_free_voice
c_func
(paren
id|trident_t
op_star
id|trident
comma
id|snd_trident_voice_t
op_star
id|voice
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_void
(paren
op_star
id|private_free
)paren
(paren
id|snd_trident_voice_t
op_star
)paren
suffix:semicolon
r_void
op_star
id|private_data
suffix:semicolon
r_if
c_cond
(paren
id|voice
op_eq
l_int|NULL
op_logical_or
op_logical_neg
id|voice-&gt;use
)paren
r_return
suffix:semicolon
id|snd_trident_clear_voices
c_func
(paren
id|trident
comma
id|voice-&gt;number
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|trident-&gt;voice_alloc
comma
id|flags
)paren
suffix:semicolon
id|private_free
op_assign
id|voice-&gt;private_free
suffix:semicolon
id|private_data
op_assign
id|voice-&gt;private_data
suffix:semicolon
id|voice-&gt;private_free
op_assign
l_int|NULL
suffix:semicolon
id|voice-&gt;private_data
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;pcm
)paren
id|snd_trident_free_pcm_channel
c_func
(paren
id|trident
comma
id|voice-&gt;number
)paren
suffix:semicolon
r_if
c_cond
(paren
id|voice-&gt;synth
)paren
id|snd_trident_free_synth_channel
c_func
(paren
id|trident
comma
id|voice-&gt;number
)paren
suffix:semicolon
id|voice-&gt;use
op_assign
id|voice-&gt;pcm
op_assign
id|voice-&gt;synth
op_assign
id|voice-&gt;midi
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;capture
op_assign
id|voice-&gt;spdif
op_assign
l_int|0
suffix:semicolon
id|voice-&gt;sample_ops
op_assign
l_int|NULL
suffix:semicolon
id|voice-&gt;substream
op_assign
l_int|NULL
suffix:semicolon
id|voice-&gt;extra
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|trident-&gt;voice_alloc
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|private_free
)paren
id|private_free
c_func
(paren
id|voice
)paren
suffix:semicolon
)brace
DECL|function|snd_trident_clear_voices
r_void
id|snd_trident_clear_voices
c_func
(paren
id|trident_t
op_star
id|trident
comma
r_int
r_int
id|v_min
comma
r_int
r_int
id|v_max
)paren
(brace
r_int
r_int
id|i
comma
id|val
comma
id|mask
(braket
l_int|2
)braket
op_assign
(brace
l_int|0
comma
l_int|0
)brace
suffix:semicolon
id|snd_assert
c_func
(paren
id|v_min
op_le
l_int|63
comma
r_return
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|v_max
op_le
l_int|63
comma
r_return
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|v_min
suffix:semicolon
id|i
op_le
id|v_max
suffix:semicolon
id|i
op_increment
)paren
id|mask
(braket
id|i
op_rshift
l_int|5
)braket
op_or_assign
l_int|1
op_lshift
(paren
id|i
op_amp
l_int|0x1f
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mask
(braket
l_int|0
)braket
)paren
(brace
id|outl
c_func
(paren
id|mask
(braket
l_int|0
)braket
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_STOP_A
)paren
)paren
suffix:semicolon
id|val
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_AINTEN_A
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|val
op_amp
op_complement
id|mask
(braket
l_int|0
)braket
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_AINTEN_A
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mask
(braket
l_int|1
)braket
)paren
(brace
id|outl
c_func
(paren
id|mask
(braket
l_int|1
)braket
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_STOP_B
)paren
)paren
suffix:semicolon
id|val
op_assign
id|inl
c_func
(paren
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_AINTEN_B
)paren
)paren
suffix:semicolon
id|outl
c_func
(paren
id|val
op_amp
op_complement
id|mask
(braket
l_int|1
)braket
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_AINTEN_B
)paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_PM
DECL|function|snd_trident_suspend
r_void
id|snd_trident_suspend
c_func
(paren
id|trident_t
op_star
id|trident
)paren
(brace
id|snd_card_t
op_star
id|card
op_assign
id|trident-&gt;card
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;power_state
op_eq
id|SNDRV_CTL_POWER_D3hot
)paren
r_return
suffix:semicolon
id|trident-&gt;in_suspend
op_assign
l_int|1
suffix:semicolon
id|snd_pcm_suspend_all
c_func
(paren
id|trident-&gt;pcm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;foldback
)paren
id|snd_pcm_suspend_all
c_func
(paren
id|trident-&gt;foldback
)paren
suffix:semicolon
r_if
c_cond
(paren
id|trident-&gt;spdif
)paren
id|snd_pcm_suspend_all
c_func
(paren
id|trident-&gt;spdif
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|trident-&gt;device
)paren
(brace
r_case
id|TRIDENT_DEVICE_ID_DX
suffix:colon
r_case
id|TRIDENT_DEVICE_ID_NX
suffix:colon
r_break
suffix:semicolon
multiline_comment|/* TODO */
r_case
id|TRIDENT_DEVICE_ID_SI7018
suffix:colon
r_break
suffix:semicolon
)brace
id|snd_power_change_state
c_func
(paren
id|card
comma
id|SNDRV_CTL_POWER_D3hot
)paren
suffix:semicolon
)brace
DECL|function|snd_trident_resume
r_void
id|snd_trident_resume
c_func
(paren
id|trident_t
op_star
id|trident
)paren
(brace
id|snd_card_t
op_star
id|card
op_assign
id|trident-&gt;card
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;power_state
op_eq
id|SNDRV_CTL_POWER_D0
)paren
r_return
suffix:semicolon
id|pci_enable_device
c_func
(paren
id|trident-&gt;pci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_set_dma_mask
c_func
(paren
id|trident-&gt;pci
comma
l_int|0x3fffffff
)paren
OL
l_int|0
op_logical_or
id|pci_set_consistent_dma_mask
c_func
(paren
id|trident-&gt;pci
comma
l_int|0x3fffffff
)paren
OL
l_int|0
)paren
id|snd_printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;trident: can&squot;t set the proper DMA mask&bslash;n&quot;
)paren
suffix:semicolon
id|pci_set_master
c_func
(paren
id|trident-&gt;pci
)paren
suffix:semicolon
multiline_comment|/* to be sure */
r_switch
c_cond
(paren
id|trident-&gt;device
)paren
(brace
r_case
id|TRIDENT_DEVICE_ID_DX
suffix:colon
id|snd_trident_4d_dx_init
c_func
(paren
id|trident
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TRIDENT_DEVICE_ID_NX
suffix:colon
id|snd_trident_4d_nx_init
c_func
(paren
id|trident
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TRIDENT_DEVICE_ID_SI7018
suffix:colon
id|snd_trident_sis_init
c_func
(paren
id|trident
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|snd_ac97_resume
c_func
(paren
id|trident-&gt;ac97
)paren
suffix:semicolon
multiline_comment|/* restore some registers */
id|outl
c_func
(paren
id|trident-&gt;musicvol_wavevol
comma
id|TRID_REG
c_func
(paren
id|trident
comma
id|T4D_MUSICVOL_WAVEVOL
)paren
)paren
suffix:semicolon
id|snd_trident_enable_eso
c_func
(paren
id|trident
)paren
suffix:semicolon
id|snd_power_change_state
c_func
(paren
id|card
comma
id|SNDRV_CTL_POWER_D0
)paren
suffix:semicolon
id|trident-&gt;in_suspend
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|snd_trident_set_power_state
r_static
r_int
id|snd_trident_set_power_state
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_int
r_int
id|power_state
)paren
(brace
id|trident_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|trident_t
comma
id|card-&gt;power_state_private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|power_state
)paren
(brace
r_case
id|SNDRV_CTL_POWER_D0
suffix:colon
r_case
id|SNDRV_CTL_POWER_D1
suffix:colon
r_case
id|SNDRV_CTL_POWER_D2
suffix:colon
id|snd_trident_resume
c_func
(paren
id|chip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_CTL_POWER_D3hot
suffix:colon
r_case
id|SNDRV_CTL_POWER_D3cold
suffix:colon
id|snd_trident_suspend
c_func
(paren
id|chip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PM */
DECL|variable|snd_trident_alloc_voice
id|EXPORT_SYMBOL
c_func
(paren
id|snd_trident_alloc_voice
)paren
suffix:semicolon
DECL|variable|snd_trident_free_voice
id|EXPORT_SYMBOL
c_func
(paren
id|snd_trident_free_voice
)paren
suffix:semicolon
DECL|variable|snd_trident_start_voice
id|EXPORT_SYMBOL
c_func
(paren
id|snd_trident_start_voice
)paren
suffix:semicolon
DECL|variable|snd_trident_stop_voice
id|EXPORT_SYMBOL
c_func
(paren
id|snd_trident_stop_voice
)paren
suffix:semicolon
DECL|variable|snd_trident_write_voice_regs
id|EXPORT_SYMBOL
c_func
(paren
id|snd_trident_write_voice_regs
)paren
suffix:semicolon
DECL|variable|snd_trident_clear_voices
id|EXPORT_SYMBOL
c_func
(paren
id|snd_trident_clear_voices
)paren
suffix:semicolon
multiline_comment|/* trident_memory.c symbols */
DECL|variable|snd_trident_synth_alloc
id|EXPORT_SYMBOL
c_func
(paren
id|snd_trident_synth_alloc
)paren
suffix:semicolon
DECL|variable|snd_trident_synth_free
id|EXPORT_SYMBOL
c_func
(paren
id|snd_trident_synth_free
)paren
suffix:semicolon
DECL|variable|snd_trident_synth_bzero
id|EXPORT_SYMBOL
c_func
(paren
id|snd_trident_synth_bzero
)paren
suffix:semicolon
DECL|variable|snd_trident_synth_copy_from_user
id|EXPORT_SYMBOL
c_func
(paren
id|snd_trident_synth_copy_from_user
)paren
suffix:semicolon
eof
