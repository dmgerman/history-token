multiline_comment|/*&n; *  Driver for Cirrus Logic CS4281 based PCI soundcard&n; *  Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;,&n; *&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/gameport.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/control.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
macro_line|#include &lt;sound/rawmidi.h&gt;
macro_line|#include &lt;sound/ac97_codec.h&gt;
macro_line|#include &lt;sound/opl3.h&gt;
DECL|macro|SNDRV_GET_ID
mdefine_line|#define SNDRV_GET_ID
macro_line|#include &lt;sound/initval.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jaroslav Kysela &lt;perex@suse.cz&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Cirrus Logic CS4281&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_CLASSES
c_func
(paren
l_string|&quot;{sound}&quot;
)paren
suffix:semicolon
id|MODULE_DEVICES
c_func
(paren
l_string|&quot;{{Cirrus Logic,CS4281}}&quot;
)paren
suffix:semicolon
DECL|variable|index
r_static
r_int
id|index
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_IDX
suffix:semicolon
multiline_comment|/* Index 0-MAX */
DECL|variable|id
r_static
r_char
op_star
id|id
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_STR
suffix:semicolon
multiline_comment|/* ID for this card */
DECL|variable|enable
r_static
r_int
id|enable
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_ENABLE_PNP
suffix:semicolon
multiline_comment|/* Enable switches */
DECL|variable|dual_codec
r_static
r_int
id|dual_codec
(braket
id|SNDRV_CARDS
)braket
suffix:semicolon
multiline_comment|/* dual codec */
id|MODULE_PARM
c_func
(paren
id|index
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|index
comma
l_string|&quot;Index value for CS4281 soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|index
comma
id|SNDRV_INDEX_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|id
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|id
comma
l_string|&quot;ID string for CS4281 soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|id
comma
id|SNDRV_ID_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|enable
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|enable
comma
l_string|&quot;Enable CS4281 soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|enable
comma
id|SNDRV_ENABLE_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|dual_codec
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|dual_codec
comma
l_string|&quot;Secondary Codec ID (0 = disabled).&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|dual_codec
comma
id|SNDRV_ENABLED
l_string|&quot;,allows:{{0,3}}&quot;
)paren
suffix:semicolon
multiline_comment|/*&n; *&n; */
macro_line|#ifndef PCI_VENDOR_ID_CIRRUS
DECL|macro|PCI_VENDOR_ID_CIRRUS
mdefine_line|#define PCI_VENDOR_ID_CIRRUS            0x1013
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_CIRRUS_4281
DECL|macro|PCI_DEVICE_ID_CIRRUS_4281
mdefine_line|#define PCI_DEVICE_ID_CIRRUS_4281&t;0x6005
macro_line|#endif
multiline_comment|/*&n; *  Direct registers&n; */
DECL|macro|CS4281_BA0_SIZE
mdefine_line|#define CS4281_BA0_SIZE&t;&t;0x1000
DECL|macro|CS4281_BA1_SIZE
mdefine_line|#define CS4281_BA1_SIZE&t;&t;0x10000
multiline_comment|/*&n; *  BA0 registers&n; */
DECL|macro|BA0_HISR
mdefine_line|#define BA0_HISR&t;&t;0x0000&t;/* Host Interrupt Status Register */
DECL|macro|BA0_HISR_INTENA
mdefine_line|#define BA0_HISR_INTENA&t;&t;(1&lt;&lt;31)&t;/* Internal Interrupt Enable Bit */
DECL|macro|BA0_HISR_MIDI
mdefine_line|#define BA0_HISR_MIDI&t;&t;(1&lt;&lt;22)&t;/* MIDI port interrupt */
DECL|macro|BA0_HISR_FIFOI
mdefine_line|#define BA0_HISR_FIFOI&t;&t;(1&lt;&lt;20)&t;/* FIFO polled interrupt */
DECL|macro|BA0_HISR_DMAI
mdefine_line|#define BA0_HISR_DMAI&t;&t;(1&lt;&lt;18)&t;/* DMA interrupt (half or end) */
DECL|macro|BA0_HISR_FIFO
mdefine_line|#define BA0_HISR_FIFO(c)&t;(1&lt;&lt;(12+(c))) /* FIFO channel interrupt */
DECL|macro|BA0_HISR_DMA
mdefine_line|#define BA0_HISR_DMA(c)&t;&t;(1&lt;&lt;(8+(c)))  /* DMA channel interrupt */
DECL|macro|BA0_HISR_GPPI
mdefine_line|#define BA0_HISR_GPPI&t;&t;(1&lt;&lt;5)&t;/* General Purpose Input (Primary chip) */
DECL|macro|BA0_HISR_GPSI
mdefine_line|#define BA0_HISR_GPSI&t;&t;(1&lt;&lt;4)&t;/* General Purpose Input (Secondary chip) */
DECL|macro|BA0_HISR_GP3I
mdefine_line|#define BA0_HISR_GP3I&t;&t;(1&lt;&lt;3)&t;/* GPIO3 pin Interrupt */
DECL|macro|BA0_HISR_GP1I
mdefine_line|#define BA0_HISR_GP1I&t;&t;(1&lt;&lt;2)&t;/* GPIO1 pin Interrupt */
DECL|macro|BA0_HISR_VUPI
mdefine_line|#define BA0_HISR_VUPI&t;&t;(1&lt;&lt;1)&t;/* VOLUP pin Interrupt */
DECL|macro|BA0_HISR_VDNI
mdefine_line|#define BA0_HISR_VDNI&t;&t;(1&lt;&lt;0)&t;/* VOLDN pin Interrupt */
DECL|macro|BA0_HICR
mdefine_line|#define BA0_HICR&t;&t;0x0008&t;/* Host Interrupt Control Register */
DECL|macro|BA0_HICR_CHGM
mdefine_line|#define BA0_HICR_CHGM&t;&t;(1&lt;&lt;1)&t;/* INTENA Change Mask */
DECL|macro|BA0_HICR_IEV
mdefine_line|#define BA0_HICR_IEV&t;&t;(1&lt;&lt;0)&t;/* INTENA Value */
DECL|macro|BA0_HICR_EOI
mdefine_line|#define BA0_HICR_EOI&t;&t;(3&lt;&lt;0)&t;/* End of Interrupt command */
DECL|macro|BA0_HIMR
mdefine_line|#define BA0_HIMR&t;&t;0x000c&t;/* Host Interrupt Mask Register */
multiline_comment|/* Use same contants as for BA0_HISR */
DECL|macro|BA0_IIER
mdefine_line|#define BA0_IIER&t;&t;0x0010&t;/* ISA Interrupt Enable Register */
DECL|macro|BA0_HDSR0
mdefine_line|#define BA0_HDSR0&t;&t;0x00f0&t;/* Host DMA Engine 0 Status Register */
DECL|macro|BA0_HDSR1
mdefine_line|#define BA0_HDSR1&t;&t;0x00f4&t;/* Host DMA Engine 1 Status Register */
DECL|macro|BA0_HDSR2
mdefine_line|#define BA0_HDSR2&t;&t;0x00f8&t;/* Host DMA Engine 2 Status Register */
DECL|macro|BA0_HDSR3
mdefine_line|#define BA0_HDSR3&t;&t;0x00fc&t;/* Host DMA Engine 3 Status Register */
DECL|macro|BA0_HDSR_CH1P
mdefine_line|#define BA0_HDSR_CH1P&t;&t;(1&lt;&lt;25)&t;/* Channel 1 Pending */
DECL|macro|BA0_HDSR_CH2P
mdefine_line|#define BA0_HDSR_CH2P&t;&t;(1&lt;&lt;24)&t;/* Channel 2 Pending */
DECL|macro|BA0_HDSR_DHTC
mdefine_line|#define BA0_HDSR_DHTC&t;&t;(1&lt;&lt;17)&t;/* DMA Half Terminal Count */
DECL|macro|BA0_HDSR_DTC
mdefine_line|#define BA0_HDSR_DTC&t;&t;(1&lt;&lt;16)&t;/* DMA Terminal Count */
DECL|macro|BA0_HDSR_DRUN
mdefine_line|#define BA0_HDSR_DRUN&t;&t;(1&lt;&lt;15)&t;/* DMA Running */
DECL|macro|BA0_HDSR_RQ
mdefine_line|#define BA0_HDSR_RQ&t;&t;(1&lt;&lt;7)&t;/* Pending Request */
DECL|macro|BA0_DCA0
mdefine_line|#define BA0_DCA0&t;&t;0x0110&t;/* Host DMA Engine 0 Current Address */
DECL|macro|BA0_DCC0
mdefine_line|#define BA0_DCC0&t;&t;0x0114&t;/* Host DMA Engine 0 Current Count */
DECL|macro|BA0_DBA0
mdefine_line|#define BA0_DBA0&t;&t;0x0118&t;/* Host DMA Engine 0 Base Address */
DECL|macro|BA0_DBC0
mdefine_line|#define BA0_DBC0&t;&t;0x011c&t;/* Host DMA Engine 0 Base Count */
DECL|macro|BA0_DCA1
mdefine_line|#define BA0_DCA1&t;&t;0x0120&t;/* Host DMA Engine 1 Current Address */
DECL|macro|BA0_DCC1
mdefine_line|#define BA0_DCC1&t;&t;0x0124&t;/* Host DMA Engine 1 Current Count */
DECL|macro|BA0_DBA1
mdefine_line|#define BA0_DBA1&t;&t;0x0128&t;/* Host DMA Engine 1 Base Address */
DECL|macro|BA0_DBC1
mdefine_line|#define BA0_DBC1&t;&t;0x012c&t;/* Host DMA Engine 1 Base Count */
DECL|macro|BA0_DCA2
mdefine_line|#define BA0_DCA2&t;&t;0x0130&t;/* Host DMA Engine 2 Current Address */
DECL|macro|BA0_DCC2
mdefine_line|#define BA0_DCC2&t;&t;0x0134&t;/* Host DMA Engine 2 Current Count */
DECL|macro|BA0_DBA2
mdefine_line|#define BA0_DBA2&t;&t;0x0138&t;/* Host DMA Engine 2 Base Address */
DECL|macro|BA0_DBC2
mdefine_line|#define BA0_DBC2&t;&t;0x013c&t;/* Host DMA Engine 2 Base Count */
DECL|macro|BA0_DCA3
mdefine_line|#define BA0_DCA3&t;&t;0x0140&t;/* Host DMA Engine 3 Current Address */
DECL|macro|BA0_DCC3
mdefine_line|#define BA0_DCC3&t;&t;0x0144&t;/* Host DMA Engine 3 Current Count */
DECL|macro|BA0_DBA3
mdefine_line|#define BA0_DBA3&t;&t;0x0148&t;/* Host DMA Engine 3 Base Address */
DECL|macro|BA0_DBC3
mdefine_line|#define BA0_DBC3&t;&t;0x014c&t;/* Host DMA Engine 3 Base Count */
DECL|macro|BA0_DMR0
mdefine_line|#define BA0_DMR0&t;&t;0x0150&t;/* Host DMA Engine 0 Mode */
DECL|macro|BA0_DCR0
mdefine_line|#define BA0_DCR0&t;&t;0x0154&t;/* Host DMA Engine 0 Command */
DECL|macro|BA0_DMR1
mdefine_line|#define BA0_DMR1&t;&t;0x0158&t;/* Host DMA Engine 1 Mode */
DECL|macro|BA0_DCR1
mdefine_line|#define BA0_DCR1&t;&t;0x015c&t;/* Host DMA Engine 1 Command */
DECL|macro|BA0_DMR2
mdefine_line|#define BA0_DMR2&t;&t;0x0160&t;/* Host DMA Engine 2 Mode */
DECL|macro|BA0_DCR2
mdefine_line|#define BA0_DCR2&t;&t;0x0164&t;/* Host DMA Engine 2 Command */
DECL|macro|BA0_DMR3
mdefine_line|#define BA0_DMR3&t;&t;0x0168&t;/* Host DMA Engine 3 Mode */
DECL|macro|BA0_DCR3
mdefine_line|#define BA0_DCR3&t;&t;0x016c&t;/* Host DMA Engine 3 Command */
DECL|macro|BA0_DMR_DMA
mdefine_line|#define BA0_DMR_DMA&t;&t;(1&lt;&lt;29)&t;/* Enable DMA mode */
DECL|macro|BA0_DMR_POLL
mdefine_line|#define BA0_DMR_POLL&t;&t;(1&lt;&lt;28)&t;/* Enable poll mode */
DECL|macro|BA0_DMR_TBC
mdefine_line|#define BA0_DMR_TBC&t;&t;(1&lt;&lt;25)&t;/* Transfer By Channel */
DECL|macro|BA0_DMR_CBC
mdefine_line|#define BA0_DMR_CBC&t;&t;(1&lt;&lt;24)&t;/* Count By Channel (0 = frame resolution) */
DECL|macro|BA0_DMR_SWAPC
mdefine_line|#define BA0_DMR_SWAPC&t;&t;(1&lt;&lt;22)&t;/* Swap Left/Right Channels */
DECL|macro|BA0_DMR_SIZE20
mdefine_line|#define BA0_DMR_SIZE20&t;&t;(1&lt;&lt;20)&t;/* Sample is 20-bit */
DECL|macro|BA0_DMR_USIGN
mdefine_line|#define BA0_DMR_USIGN&t;&t;(1&lt;&lt;19)&t;/* Unsigned */
DECL|macro|BA0_DMR_BEND
mdefine_line|#define BA0_DMR_BEND&t;&t;(1&lt;&lt;18)&t;/* Big Endian */
DECL|macro|BA0_DMR_MONO
mdefine_line|#define BA0_DMR_MONO&t;&t;(1&lt;&lt;17)&t;/* Mono */
DECL|macro|BA0_DMR_SIZE8
mdefine_line|#define BA0_DMR_SIZE8&t;&t;(1&lt;&lt;16)&t;/* Sample is 8-bit */
DECL|macro|BA0_DMR_TYPE_DEMAND
mdefine_line|#define BA0_DMR_TYPE_DEMAND&t;(0&lt;&lt;6)
DECL|macro|BA0_DMR_TYPE_SINGLE
mdefine_line|#define BA0_DMR_TYPE_SINGLE&t;(1&lt;&lt;6)
DECL|macro|BA0_DMR_TYPE_BLOCK
mdefine_line|#define BA0_DMR_TYPE_BLOCK&t;(2&lt;&lt;6)
DECL|macro|BA0_DMR_TYPE_CASCADE
mdefine_line|#define BA0_DMR_TYPE_CASCADE&t;(3&lt;&lt;6)&t;/* Not supported */
DECL|macro|BA0_DMR_DEC
mdefine_line|#define BA0_DMR_DEC&t;&t;(1&lt;&lt;5)&t;/* Access Increment (0) or Decrement (1) */
DECL|macro|BA0_DMR_AUTO
mdefine_line|#define BA0_DMR_AUTO&t;&t;(1&lt;&lt;4)&t;/* Auto-Initialize */
DECL|macro|BA0_DMR_TR_VERIFY
mdefine_line|#define BA0_DMR_TR_VERIFY&t;(0&lt;&lt;2)&t;/* Verify Transfer */
DECL|macro|BA0_DMR_TR_WRITE
mdefine_line|#define BA0_DMR_TR_WRITE&t;(1&lt;&lt;2)&t;/* Write Transfer */
DECL|macro|BA0_DMR_TR_READ
mdefine_line|#define BA0_DMR_TR_READ&t;&t;(2&lt;&lt;2)&t;/* Read Transfer */
DECL|macro|BA0_DCR_HTCIE
mdefine_line|#define BA0_DCR_HTCIE&t;&t;(1&lt;&lt;17)&t;/* Half Terminal Count Interrupt */
DECL|macro|BA0_DCR_TCIE
mdefine_line|#define BA0_DCR_TCIE&t;&t;(1&lt;&lt;16)&t;/* Terminal Count Interrupt */
DECL|macro|BA0_DCR_MSK
mdefine_line|#define BA0_DCR_MSK&t;&t;(1&lt;&lt;0)&t;/* DMA Mask bit */
DECL|macro|BA0_FCR0
mdefine_line|#define BA0_FCR0&t;&t;0x0180&t;/* FIFO Control 0 */
DECL|macro|BA0_FCR1
mdefine_line|#define BA0_FCR1&t;&t;0x0184&t;/* FIFO Control 1 */
DECL|macro|BA0_FCR2
mdefine_line|#define BA0_FCR2&t;&t;0x0188&t;/* FIFO Control 2 */
DECL|macro|BA0_FCR3
mdefine_line|#define BA0_FCR3&t;&t;0x018c&t;/* FIFO Control 3 */
DECL|macro|BA0_FCR_FEN
mdefine_line|#define BA0_FCR_FEN&t;&t;(1&lt;&lt;31)&t;/* FIFO Enable bit */
DECL|macro|BA0_FCR_DACZ
mdefine_line|#define BA0_FCR_DACZ&t;&t;(1&lt;&lt;30)&t;/* DAC Zero */
DECL|macro|BA0_FCR_PSH
mdefine_line|#define BA0_FCR_PSH&t;&t;(1&lt;&lt;29)&t;/* Previous Sample Hold */
DECL|macro|BA0_FCR_RS
mdefine_line|#define BA0_FCR_RS(x)&t;&t;(((x)&amp;0x1f)&lt;&lt;24) /* Right Slot Mapping */
DECL|macro|BA0_FCR_LS
mdefine_line|#define BA0_FCR_LS(x)&t;&t;(((x)&amp;0x1f)&lt;&lt;16) /* Left Slot Mapping */
DECL|macro|BA0_FCR_SZ
mdefine_line|#define BA0_FCR_SZ(x)&t;&t;(((x)&amp;0x7f)&lt;&lt;8)&t;/* FIFO buffer size (in samples) */
DECL|macro|BA0_FCR_OF
mdefine_line|#define BA0_FCR_OF(x)&t;&t;(((x)&amp;0x7f)&lt;&lt;0)&t;/* FIFO starting offset (in samples) */
DECL|macro|BA0_FPDR0
mdefine_line|#define BA0_FPDR0&t;&t;0x0190&t;/* FIFO Polled Data 0 */
DECL|macro|BA0_FPDR1
mdefine_line|#define BA0_FPDR1&t;&t;0x0194&t;/* FIFO Polled Data 1 */
DECL|macro|BA0_FPDR2
mdefine_line|#define BA0_FPDR2&t;&t;0x0198&t;/* FIFO Polled Data 2 */
DECL|macro|BA0_FPDR3
mdefine_line|#define BA0_FPDR3&t;&t;0x019c&t;/* FIFO Polled Data 3 */
DECL|macro|BA0_FCHS
mdefine_line|#define BA0_FCHS&t;&t;0x020c&t;/* FIFO Channel Status */
DECL|macro|BA0_FCHS_RCO
mdefine_line|#define BA0_FCHS_RCO(x)&t;&t;(1&lt;&lt;(7+(((x)&amp;3)&lt;&lt;3))) /* Right Channel Out */
DECL|macro|BA0_FCHS_LCO
mdefine_line|#define BA0_FCHS_LCO(x)&t;&t;(1&lt;&lt;(6+(((x)&amp;3)&lt;&lt;3))) /* Left Channel Out */
DECL|macro|BA0_FCHS_MRP
mdefine_line|#define BA0_FCHS_MRP(x)&t;&t;(1&lt;&lt;(5+(((x)&amp;3)&lt;&lt;3))) /* Move Read Pointer */
DECL|macro|BA0_FCHS_FE
mdefine_line|#define BA0_FCHS_FE(x)&t;&t;(1&lt;&lt;(4+(((x)&amp;3)&lt;&lt;3))) /* FIFO Empty */
DECL|macro|BA0_FCHS_FF
mdefine_line|#define BA0_FCHS_FF(x)&t;&t;(1&lt;&lt;(3+(((x)&amp;3)&lt;&lt;3))) /* FIFO Full */
DECL|macro|BA0_FCHS_IOR
mdefine_line|#define BA0_FCHS_IOR(x)&t;&t;(1&lt;&lt;(2+(((x)&amp;3)&lt;&lt;3))) /* Internal Overrun Flag */
DECL|macro|BA0_FCHS_RCI
mdefine_line|#define BA0_FCHS_RCI(x)&t;&t;(1&lt;&lt;(1+(((x)&amp;3)&lt;&lt;3))) /* Right Channel In */
DECL|macro|BA0_FCHS_LCI
mdefine_line|#define BA0_FCHS_LCI(x)&t;&t;(1&lt;&lt;(0+(((x)&amp;3)&lt;&lt;3))) /* Left Channel In */
DECL|macro|BA0_FSIC0
mdefine_line|#define BA0_FSIC0&t;&t;0x0210&t;/* FIFO Status and Interrupt Control 0 */
DECL|macro|BA0_FSIC1
mdefine_line|#define BA0_FSIC1&t;&t;0x0214&t;/* FIFO Status and Interrupt Control 1 */
DECL|macro|BA0_FSIC2
mdefine_line|#define BA0_FSIC2&t;&t;0x0218&t;/* FIFO Status and Interrupt Control 2 */
DECL|macro|BA0_FSIC3
mdefine_line|#define BA0_FSIC3&t;&t;0x021c&t;/* FIFO Status and Interrupt Control 3 */
DECL|macro|BA0_FSIC_FIC
mdefine_line|#define BA0_FSIC_FIC(x)&t;&t;(((x)&amp;0x7f)&lt;&lt;24) /* FIFO Interrupt Count */
DECL|macro|BA0_FSIC_FORIE
mdefine_line|#define BA0_FSIC_FORIE&t;&t;(1&lt;&lt;23) /* FIFO OverRun Interrupt Enable */
DECL|macro|BA0_FSIC_FURIE
mdefine_line|#define BA0_FSIC_FURIE&t;&t;(1&lt;&lt;22) /* FIFO UnderRun Interrupt Enable */
DECL|macro|BA0_FSIC_FSCIE
mdefine_line|#define BA0_FSIC_FSCIE&t;&t;(1&lt;&lt;16)&t;/* FIFO Sample Count Interrupt Enable */
DECL|macro|BA0_FSIC_FSC
mdefine_line|#define BA0_FSIC_FSC(x)&t;&t;(((x)&amp;0x7f)&lt;&lt;8) /* FIFO Sample Count */
DECL|macro|BA0_FSIC_FOR
mdefine_line|#define BA0_FSIC_FOR&t;&t;(1&lt;&lt;7)&t;/* FIFO OverRun */
DECL|macro|BA0_FSIC_FUR
mdefine_line|#define BA0_FSIC_FUR&t;&t;(1&lt;&lt;6)&t;/* FIFO UnderRun */
DECL|macro|BA0_FSIC_FSCR
mdefine_line|#define BA0_FSIC_FSCR&t;&t;(1&lt;&lt;0)&t;/* FIFO Sample Count Reached */
DECL|macro|BA0_PMCS
mdefine_line|#define BA0_PMCS&t;&t;0x0344&t;/* Power Management Control/Status */
DECL|macro|BA0_CWPR
mdefine_line|#define BA0_CWPR&t;&t;0x03e0&t;/* Configuration Write Protect */
DECL|macro|BA0_EPPMC
mdefine_line|#define BA0_EPPMC&t;&t;0x03e4&t;/* Extended PCI Power Management Control */
DECL|macro|BA0_GPIOR
mdefine_line|#define BA0_GPIOR&t;&t;0x03e8&t;/* GPIO Pin Interface Register */
DECL|macro|BA0_SPMC
mdefine_line|#define BA0_SPMC&t;&t;0x03ec&t;/* Serial Port Power Management Control (&amp; ASDIN2 enable) */
DECL|macro|BA0_SPMC_GIPPEN
mdefine_line|#define BA0_SPMC_GIPPEN&t;&t;(1&lt;&lt;15)&t;/* GP INT Primary PME# Enable */
DECL|macro|BA0_SPMC_GISPEN
mdefine_line|#define BA0_SPMC_GISPEN&t;&t;(1&lt;&lt;14)&t;/* GP INT Secondary PME# Enable */
DECL|macro|BA0_SPMC_EESPD
mdefine_line|#define BA0_SPMC_EESPD&t;&t;(1&lt;&lt;9)&t;/* EEPROM Serial Port Disable */
DECL|macro|BA0_SPMC_ASDI2E
mdefine_line|#define BA0_SPMC_ASDI2E&t;&t;(1&lt;&lt;8)&t;/* ASDIN2 Enable */
DECL|macro|BA0_SPMC_ASDO
mdefine_line|#define BA0_SPMC_ASDO&t;&t;(1&lt;&lt;7)&t;/* Asynchronous ASDOUT Assertion */
DECL|macro|BA0_SPMC_WUP2
mdefine_line|#define BA0_SPMC_WUP2&t;&t;(1&lt;&lt;3)&t;/* Wakeup for Secondary Input */
DECL|macro|BA0_SPMC_WUP1
mdefine_line|#define BA0_SPMC_WUP1&t;&t;(1&lt;&lt;2)&t;/* Wakeup for Primary Input */
DECL|macro|BA0_SPMC_ASYNC
mdefine_line|#define BA0_SPMC_ASYNC&t;&t;(1&lt;&lt;1)&t;/* Asynchronous ASYNC Assertion */
DECL|macro|BA0_SPMC_RSTN
mdefine_line|#define BA0_SPMC_RSTN&t;&t;(1&lt;&lt;0)&t;/* Reset Not! */
DECL|macro|BA0_CFLR
mdefine_line|#define BA0_CFLR&t;&t;0x03f0&t;/* Configuration Load Register (EEPROM or BIOS) */
DECL|macro|BA0_CFLR_DEFAULT
mdefine_line|#define BA0_CFLR_DEFAULT&t;0x00000001 /* CFLR must be in AC97 link mode */
DECL|macro|BA0_IISR
mdefine_line|#define BA0_IISR&t;&t;0x03f4&t;/* ISA Interrupt Select */
DECL|macro|BA0_TMS
mdefine_line|#define BA0_TMS&t;&t;&t;0x03f8&t;/* Test Register */
DECL|macro|BA0_SSVID
mdefine_line|#define BA0_SSVID&t;&t;0x03fc&t;/* Subsystem ID register */
DECL|macro|BA0_CLKCR1
mdefine_line|#define BA0_CLKCR1&t;&t;0x0400&t;/* Clock Control Register 1 */
DECL|macro|BA0_CLKCR1_CLKON
mdefine_line|#define BA0_CLKCR1_CLKON&t;(1&lt;&lt;25)&t;/* Read Only */
DECL|macro|BA0_CLKCR1_DLLRDY
mdefine_line|#define BA0_CLKCR1_DLLRDY&t;(1&lt;&lt;24)&t;/* DLL Ready */
DECL|macro|BA0_CLKCR1_DLLOS
mdefine_line|#define BA0_CLKCR1_DLLOS&t;(1&lt;&lt;6)&t;/* DLL Output Select */
DECL|macro|BA0_CLKCR1_SWCE
mdefine_line|#define BA0_CLKCR1_SWCE&t;&t;(1&lt;&lt;5)&t;/* Clock Enable */
DECL|macro|BA0_CLKCR1_DLLP
mdefine_line|#define BA0_CLKCR1_DLLP&t;&t;(1&lt;&lt;4)&t;/* DLL PowerUp */
DECL|macro|BA0_CLKCR1_DLLSS
mdefine_line|#define BA0_CLKCR1_DLLSS&t;(((x)&amp;3)&lt;&lt;3) /* DLL Source Select */
DECL|macro|BA0_FRR
mdefine_line|#define BA0_FRR&t;&t;&t;0x0410&t;/* Feature Reporting Register */
DECL|macro|BA0_SLT12O
mdefine_line|#define BA0_SLT12O&t;&t;0x041c&t;/* Slot 12 GPIO Output Register for AC-Link */
DECL|macro|BA0_SERMC
mdefine_line|#define BA0_SERMC&t;&t;0x0420&t;/* Serial Port Master Control */
DECL|macro|BA0_SERMC_FCRN
mdefine_line|#define BA0_SERMC_FCRN&t;&t;(1&lt;&lt;27)&t;/* Force Codec Ready Not */
DECL|macro|BA0_SERMC_ODSEN2
mdefine_line|#define BA0_SERMC_ODSEN2&t;(1&lt;&lt;25)&t;/* On-Demand Support Enable ASDIN2 */
DECL|macro|BA0_SERMC_ODSEN1
mdefine_line|#define BA0_SERMC_ODSEN1&t;(1&lt;&lt;24)&t;/* On-Demand Support Enable ASDIN1 */
DECL|macro|BA0_SERMC_SXLB
mdefine_line|#define BA0_SERMC_SXLB&t;&t;(1&lt;&lt;21)&t;/* ASDIN2 to ASDOUT Loopback */
DECL|macro|BA0_SERMC_SLB
mdefine_line|#define BA0_SERMC_SLB&t;&t;(1&lt;&lt;20)&t;/* ASDOUT to ASDIN2 Loopback */
DECL|macro|BA0_SERMC_LOVF
mdefine_line|#define BA0_SERMC_LOVF&t;&t;(1&lt;&lt;19)&t;/* Loopback Output Valid Frame bit */
DECL|macro|BA0_SERMC_TCID
mdefine_line|#define BA0_SERMC_TCID(x)&t;(((x)&amp;3)&lt;&lt;16) /* Target Secondary Codec ID */
DECL|macro|BA0_SERMC_PXLB
mdefine_line|#define BA0_SERMC_PXLB&t;&t;(5&lt;&lt;1)&t;/* Primary Port External Loopback */
DECL|macro|BA0_SERMC_PLB
mdefine_line|#define BA0_SERMC_PLB&t;&t;(4&lt;&lt;1)&t;/* Primary Port Internal Loopback */
DECL|macro|BA0_SERMC_PTC
mdefine_line|#define BA0_SERMC_PTC&t;&t;(7&lt;&lt;1)&t;/* Port Timing Configuration */
DECL|macro|BA0_SERMC_PTC_AC97
mdefine_line|#define BA0_SERMC_PTC_AC97&t;(1&lt;&lt;1)&t;/* AC97 mode */
DECL|macro|BA0_SERMC_MSPE
mdefine_line|#define BA0_SERMC_MSPE&t;&t;(1&lt;&lt;0)&t;/* Master Serial Port Enable */
DECL|macro|BA0_SERC1
mdefine_line|#define BA0_SERC1&t;&t;0x0428&t;/* Serial Port Configuration 1 */
DECL|macro|BA0_SERC1_SO1F
mdefine_line|#define BA0_SERC1_SO1F(x)&t;(((x)&amp;7)&gt;&gt;1) /* Primary Output Port Format */
DECL|macro|BA0_SERC1_AC97
mdefine_line|#define BA0_SERC1_AC97&t;&t;(1&lt;&lt;1)
DECL|macro|BA0_SERC1_SO1EN
mdefine_line|#define BA0_SERC1_SO1EN&t;&t;(1&lt;&lt;0)&t;/* Primary Output Port Enable */
DECL|macro|BA0_SERC2
mdefine_line|#define BA0_SERC2&t;&t;0x042c&t;/* Serial Port Configuration 2 */
DECL|macro|BA0_SERC2_SI1F
mdefine_line|#define BA0_SERC2_SI1F(x)&t;(((x)&amp;7)&gt;&gt;1) /* Primary Input Port Format */
DECL|macro|BA0_SERC2_AC97
mdefine_line|#define BA0_SERC2_AC97&t;&t;(1&lt;&lt;1)
DECL|macro|BA0_SERC2_SI1EN
mdefine_line|#define BA0_SERC2_SI1EN&t;&t;(1&lt;&lt;0)&t;/* Primary Input Port Enable */
DECL|macro|BA0_SLT12M
mdefine_line|#define BA0_SLT12M&t;&t;0x045c&t;/* Slot 12 Monitor Register for Primary AC-Link */
DECL|macro|BA0_ACCTL
mdefine_line|#define BA0_ACCTL&t;&t;0x0460&t;/* AC&squot;97 Control */
DECL|macro|BA0_ACCTL_TC
mdefine_line|#define BA0_ACCTL_TC&t;&t;(1&lt;&lt;6)&t;/* Target Codec */
DECL|macro|BA0_ACCTL_CRW
mdefine_line|#define BA0_ACCTL_CRW&t;&t;(1&lt;&lt;4)&t;/* 0=Write, 1=Read Command */
DECL|macro|BA0_ACCTL_DCV
mdefine_line|#define BA0_ACCTL_DCV&t;&t;(1&lt;&lt;3)&t;/* Dynamic Command Valid */
DECL|macro|BA0_ACCTL_VFRM
mdefine_line|#define BA0_ACCTL_VFRM&t;&t;(1&lt;&lt;2)&t;/* Valid Frame */
DECL|macro|BA0_ACCTL_ESYN
mdefine_line|#define BA0_ACCTL_ESYN&t;&t;(1&lt;&lt;1)&t;/* Enable Sync */
DECL|macro|BA0_ACSTS
mdefine_line|#define BA0_ACSTS&t;&t;0x0464&t;/* AC&squot;97 Status */
DECL|macro|BA0_ACSTS_VSTS
mdefine_line|#define BA0_ACSTS_VSTS&t;&t;(1&lt;&lt;1)&t;/* Valid Status */
DECL|macro|BA0_ACSTS_CRDY
mdefine_line|#define BA0_ACSTS_CRDY&t;&t;(1&lt;&lt;0)&t;/* Codec Ready */
DECL|macro|BA0_ACOSV
mdefine_line|#define BA0_ACOSV&t;&t;0x0468&t;/* AC&squot;97 Output Slot Valid */
DECL|macro|BA0_ACOSV_SLV
mdefine_line|#define BA0_ACOSV_SLV(x)&t;(1&lt;&lt;((x)-3))
DECL|macro|BA0_ACCAD
mdefine_line|#define BA0_ACCAD&t;&t;0x046c&t;/* AC&squot;97 Command Address */
DECL|macro|BA0_ACCDA
mdefine_line|#define BA0_ACCDA&t;&t;0x0470&t;/* AC&squot;97 Command Data */
DECL|macro|BA0_ACISV
mdefine_line|#define BA0_ACISV&t;&t;0x0474&t;/* AC&squot;97 Input Slot Valid */
DECL|macro|BA0_ACISV_SLV
mdefine_line|#define BA0_ACISV_SLV(x)&t;(1&lt;&lt;((x)-3))
DECL|macro|BA0_ACSAD
mdefine_line|#define BA0_ACSAD&t;&t;0x0478&t;/* AC&squot;97 Status Address */
DECL|macro|BA0_ACSDA
mdefine_line|#define BA0_ACSDA&t;&t;0x047c&t;/* AC&squot;97 Status Data */
DECL|macro|BA0_JSPT
mdefine_line|#define BA0_JSPT&t;&t;0x0480&t;/* Joystick poll/trigger */
DECL|macro|BA0_JSCTL
mdefine_line|#define BA0_JSCTL&t;&t;0x0484&t;/* Joystick control */
DECL|macro|BA0_JSC1
mdefine_line|#define BA0_JSC1&t;&t;0x0488&t;/* Joystick control */
DECL|macro|BA0_JSC2
mdefine_line|#define BA0_JSC2&t;&t;0x048c&t;/* Joystick control */
DECL|macro|BA0_JSIO
mdefine_line|#define BA0_JSIO&t;&t;0x04a0
DECL|macro|BA0_MIDCR
mdefine_line|#define BA0_MIDCR&t;&t;0x0490&t;/* MIDI Control */
DECL|macro|BA0_MIDCR_MRST
mdefine_line|#define BA0_MIDCR_MRST&t;&t;(1&lt;&lt;5)&t;/* Reset MIDI Interface */
DECL|macro|BA0_MIDCR_MLB
mdefine_line|#define BA0_MIDCR_MLB&t;&t;(1&lt;&lt;4)&t;/* MIDI Loop Back Enable */
DECL|macro|BA0_MIDCR_TIE
mdefine_line|#define BA0_MIDCR_TIE&t;&t;(1&lt;&lt;3)&t;/* MIDI Transmuit Interrupt Enable */
DECL|macro|BA0_MIDCR_RIE
mdefine_line|#define BA0_MIDCR_RIE&t;&t;(1&lt;&lt;2)&t;/* MIDI Receive Interrupt Enable */
DECL|macro|BA0_MIDCR_RXE
mdefine_line|#define BA0_MIDCR_RXE&t;&t;(1&lt;&lt;1)&t;/* MIDI Receive Enable */
DECL|macro|BA0_MIDCR_TXE
mdefine_line|#define BA0_MIDCR_TXE&t;&t;(1&lt;&lt;0)&t;/* MIDI Transmit Enable */
DECL|macro|BA0_MIDCMD
mdefine_line|#define BA0_MIDCMD&t;&t;0x0494&t;/* MIDI Command (wo) */
DECL|macro|BA0_MIDSR
mdefine_line|#define BA0_MIDSR&t;&t;0x0494&t;/* MIDI Status (ro) */
DECL|macro|BA0_MIDSR_RDA
mdefine_line|#define BA0_MIDSR_RDA&t;&t;(1&lt;&lt;15)&t;/* Sticky bit (RBE 1-&gt;0) */
DECL|macro|BA0_MIDSR_TBE
mdefine_line|#define BA0_MIDSR_TBE&t;&t;(1&lt;&lt;14) /* Sticky bit (TBF 0-&gt;1) */
DECL|macro|BA0_MIDSR_RBE
mdefine_line|#define BA0_MIDSR_RBE&t;&t;(1&lt;&lt;7)&t;/* Receive Buffer Empty */
DECL|macro|BA0_MIDSR_TBF
mdefine_line|#define BA0_MIDSR_TBF&t;&t;(1&lt;&lt;6)&t;/* Transmit Buffer Full */
DECL|macro|BA0_MIDWP
mdefine_line|#define BA0_MIDWP&t;&t;0x0498&t;/* MIDI Write */
DECL|macro|BA0_MIDRP
mdefine_line|#define BA0_MIDRP&t;&t;0x049c&t;/* MIDI Read (ro) */
DECL|macro|BA0_AODSD1
mdefine_line|#define BA0_AODSD1&t;&t;0x04a8&t;/* AC&squot;97 On-Demand Slot Disable for primary link (ro) */
DECL|macro|BA0_AODSD1_NDS
mdefine_line|#define BA0_AODSD1_NDS(x)&t;(1&lt;&lt;((x)-3))
DECL|macro|BA0_AODSD2
mdefine_line|#define BA0_AODSD2&t;&t;0x04ac&t;/* AC&squot;97 On-Demand Slot Disable for secondary link (ro) */
DECL|macro|BA0_AODSD2_NDS
mdefine_line|#define BA0_AODSD2_NDS(x)&t;(1&lt;&lt;((x)-3))
DECL|macro|BA0_CFGI
mdefine_line|#define BA0_CFGI&t;&t;0x04b0&t;/* Configure Interface (EEPROM interface) */
DECL|macro|BA0_SLT12M2
mdefine_line|#define BA0_SLT12M2&t;&t;0x04dc&t;/* Slot 12 Monitor Register 2 for secondary AC-link */
DECL|macro|BA0_ACSTS2
mdefine_line|#define BA0_ACSTS2&t;&t;0x04e4&t;/* AC&squot;97 Status Register 2 */
DECL|macro|BA0_ACISV2
mdefine_line|#define BA0_ACISV2&t;&t;0x04f4&t;/* AC&squot;97 Input Slot Valid Register 2 */
DECL|macro|BA0_ACSAD2
mdefine_line|#define BA0_ACSAD2&t;&t;0x04f8&t;/* AC&squot;97 Status Address Register 2 */
DECL|macro|BA0_ACSDA2
mdefine_line|#define BA0_ACSDA2&t;&t;0x04fc&t;/* AC&squot;97 Status Data Register 2 */
DECL|macro|BA0_FMSR
mdefine_line|#define BA0_FMSR&t;&t;0x0730&t;/* FM Synthesis Status (ro) */
DECL|macro|BA0_B0AP
mdefine_line|#define BA0_B0AP&t;&t;0x0730&t;/* FM Bank 0 Address Port (wo) */
DECL|macro|BA0_FMDP
mdefine_line|#define BA0_FMDP&t;&t;0x0734&t;/* FM Data Port */
DECL|macro|BA0_B1AP
mdefine_line|#define BA0_B1AP&t;&t;0x0738&t;/* FM Bank 1 Address Port */
DECL|macro|BA0_B1DP
mdefine_line|#define BA0_B1DP&t;&t;0x073c&t;/* FM Bank 1 Data Port */
DECL|macro|BA0_SSPM
mdefine_line|#define BA0_SSPM&t;&t;0x0740&t;/* Sound System Power Management */
DECL|macro|BA0_SSPM_MIXEN
mdefine_line|#define BA0_SSPM_MIXEN&t;&t;(1&lt;&lt;6)&t;/* Playback SRC + FM/Wavetable MIX */
DECL|macro|BA0_SSPM_CSRCEN
mdefine_line|#define BA0_SSPM_CSRCEN&t;&t;(1&lt;&lt;5)&t;/* Capture Sample Rate Converter Enable */
DECL|macro|BA0_SSPM_PSRCEN
mdefine_line|#define BA0_SSPM_PSRCEN&t;&t;(1&lt;&lt;4)&t;/* Playback Sample Rate Converter Enable */
DECL|macro|BA0_SSPM_JSEN
mdefine_line|#define BA0_SSPM_JSEN&t;&t;(1&lt;&lt;3)&t;/* Joystick Enable */
DECL|macro|BA0_SSPM_ACLEN
mdefine_line|#define BA0_SSPM_ACLEN&t;&t;(1&lt;&lt;2)&t;/* Serial Port Engine and AC-Link Enable */
DECL|macro|BA0_SSPM_FMEN
mdefine_line|#define BA0_SSPM_FMEN&t;&t;(1&lt;&lt;1)&t;/* FM Synthesis Block Enable */
DECL|macro|BA0_DACSR
mdefine_line|#define BA0_DACSR&t;&t;0x0744&t;/* DAC Sample Rate - Playback SRC */
DECL|macro|BA0_ADCSR
mdefine_line|#define BA0_ADCSR&t;&t;0x0748&t;/* ADC Sample Rate - Capture SRC */
DECL|macro|BA0_SSCR
mdefine_line|#define BA0_SSCR&t;&t;0x074c&t;/* Sound System Control Register */
DECL|macro|BA0_SSCR_HVS1
mdefine_line|#define BA0_SSCR_HVS1&t;&t;(1&lt;&lt;23)&t;/* Hardwave Volume Step (0=1,1=2) */
DECL|macro|BA0_SSCR_MVCS
mdefine_line|#define BA0_SSCR_MVCS&t;&t;(1&lt;&lt;19)&t;/* Master Volume Codec Select */
DECL|macro|BA0_SSCR_MVLD
mdefine_line|#define BA0_SSCR_MVLD&t;&t;(1&lt;&lt;18)&t;/* Master Volume Line Out Disable */
DECL|macro|BA0_SSCR_MVAD
mdefine_line|#define BA0_SSCR_MVAD&t;&t;(1&lt;&lt;17)&t;/* Master Volume Alternate Out Disable */
DECL|macro|BA0_SSCR_MVMD
mdefine_line|#define BA0_SSCR_MVMD&t;&t;(1&lt;&lt;16)&t;/* Master Volume Mono Out Disable */
DECL|macro|BA0_SSCR_XLPSRC
mdefine_line|#define BA0_SSCR_XLPSRC&t;&t;(1&lt;&lt;8)&t;/* External SRC Loopback Mode */
DECL|macro|BA0_SSCR_LPSRC
mdefine_line|#define BA0_SSCR_LPSRC&t;&t;(1&lt;&lt;7)&t;/* SRC Loopback Mode */
DECL|macro|BA0_SSCR_CDTX
mdefine_line|#define BA0_SSCR_CDTX&t;&t;(1&lt;&lt;5)&t;/* CD Transfer Data */
DECL|macro|BA0_SSCR_HVC
mdefine_line|#define BA0_SSCR_HVC&t;&t;(1&lt;&lt;3)&t;/* Harware Volume Control Enable */
DECL|macro|BA0_FMLVC
mdefine_line|#define BA0_FMLVC&t;&t;0x0754&t;/* FM Synthesis Left Volume Control */
DECL|macro|BA0_FMRVC
mdefine_line|#define BA0_FMRVC&t;&t;0x0758&t;/* FM Synthesis Right Volume Control */
DECL|macro|BA0_SRCSA
mdefine_line|#define BA0_SRCSA&t;&t;0x075c&t;/* SRC Slot Assignments */
DECL|macro|BA0_PPLVC
mdefine_line|#define BA0_PPLVC&t;&t;0x0760&t;/* PCM Playback Left Volume Control */
DECL|macro|BA0_PPRVC
mdefine_line|#define BA0_PPRVC&t;&t;0x0764&t;/* PCM Playback Right Volume Control */
DECL|macro|BA0_PASR
mdefine_line|#define BA0_PASR&t;&t;0x0768&t;/* playback sample rate */
DECL|macro|BA0_CASR
mdefine_line|#define BA0_CASR&t;&t;0x076C&t;/* capture sample rate */
multiline_comment|/* Source Slot Numbers - Playback */
DECL|macro|SRCSLOT_LEFT_PCM_PLAYBACK
mdefine_line|#define SRCSLOT_LEFT_PCM_PLAYBACK&t;&t;0
DECL|macro|SRCSLOT_RIGHT_PCM_PLAYBACK
mdefine_line|#define SRCSLOT_RIGHT_PCM_PLAYBACK&t;&t;1
DECL|macro|SRCSLOT_PHONE_LINE_1_DAC
mdefine_line|#define SRCSLOT_PHONE_LINE_1_DAC&t;&t;2
DECL|macro|SRCSLOT_CENTER_PCM_PLAYBACK
mdefine_line|#define SRCSLOT_CENTER_PCM_PLAYBACK&t;&t;3
DECL|macro|SRCSLOT_LEFT_SURROUND_PCM_PLAYBACK
mdefine_line|#define SRCSLOT_LEFT_SURROUND_PCM_PLAYBACK&t;4
DECL|macro|SRCSLOT_RIGHT_SURROUND_PCM_PLAYBACK
mdefine_line|#define SRCSLOT_RIGHT_SURROUND_PCM_PLAYBACK&t;5
DECL|macro|SRCSLOT_LFE_PCM_PLAYBACK
mdefine_line|#define SRCSLOT_LFE_PCM_PLAYBACK&t;&t;6
DECL|macro|SRCSLOT_PHONE_LINE_2_DAC
mdefine_line|#define SRCSLOT_PHONE_LINE_2_DAC&t;&t;7
DECL|macro|SRCSLOT_HEADSET_DAC
mdefine_line|#define SRCSLOT_HEADSET_DAC&t;&t;&t;8
DECL|macro|SRCSLOT_LEFT_WT
mdefine_line|#define SRCSLOT_LEFT_WT&t;&t;&t;&t;29  /* invalid for BA0_SRCSA */
DECL|macro|SRCSLOT_RIGHT_WT
mdefine_line|#define SRCSLOT_RIGHT_WT&t;&t;&t;30  /* invalid for BA0_SRCSA */
multiline_comment|/* Source Slot Numbers - Capture */
DECL|macro|SRCSLOT_LEFT_PCM_RECORD
mdefine_line|#define SRCSLOT_LEFT_PCM_RECORD&t;&t;&t;10
DECL|macro|SRCSLOT_RIGHT_PCM_RECORD
mdefine_line|#define SRCSLOT_RIGHT_PCM_RECORD&t;&t;11
DECL|macro|SRCSLOT_PHONE_LINE_1_ADC
mdefine_line|#define SRCSLOT_PHONE_LINE_1_ADC&t;&t;12
DECL|macro|SRCSLOT_MIC_ADC
mdefine_line|#define SRCSLOT_MIC_ADC&t;&t;&t;&t;13
DECL|macro|SRCSLOT_PHONE_LINE_2_ADC
mdefine_line|#define SRCSLOT_PHONE_LINE_2_ADC&t;&t;17
DECL|macro|SRCSLOT_HEADSET_ADC
mdefine_line|#define SRCSLOT_HEADSET_ADC&t;&t;&t;18
DECL|macro|SRCSLOT_SECONDARY_LEFT_PCM_RECORD
mdefine_line|#define SRCSLOT_SECONDARY_LEFT_PCM_RECORD&t;20
DECL|macro|SRCSLOT_SECONDARY_RIGHT_PCM_RECORD
mdefine_line|#define SRCSLOT_SECONDARY_RIGHT_PCM_RECORD&t;21
DECL|macro|SRCSLOT_SECONDARY_PHONE_LINE_1_ADC
mdefine_line|#define SRCSLOT_SECONDARY_PHONE_LINE_1_ADC&t;22
DECL|macro|SRCSLOT_SECONDARY_MIC_ADC
mdefine_line|#define SRCSLOT_SECONDARY_MIC_ADC&t;&t;23
DECL|macro|SRCSLOT_SECONDARY_PHONE_LINE_2_ADC
mdefine_line|#define SRCSLOT_SECONDARY_PHONE_LINE_2_ADC&t;27
DECL|macro|SRCSLOT_SECONDARY_HEADSET_ADC
mdefine_line|#define SRCSLOT_SECONDARY_HEADSET_ADC&t;&t;28
multiline_comment|/* Source Slot Numbers - Others */
DECL|macro|SRCSLOT_POWER_DOWN
mdefine_line|#define SRCSLOT_POWER_DOWN&t;&t;&t;31
multiline_comment|/* MIDI modes */
DECL|macro|CS4281_MODE_OUTPUT
mdefine_line|#define CS4281_MODE_OUTPUT&t;&t;(1&lt;&lt;0)
DECL|macro|CS4281_MODE_INPUT
mdefine_line|#define CS4281_MODE_INPUT&t;&t;(1&lt;&lt;1)
multiline_comment|/* joystick bits */
multiline_comment|/* Bits for JSPT */
DECL|macro|JSPT_CAX
mdefine_line|#define JSPT_CAX                                0x00000001
DECL|macro|JSPT_CAY
mdefine_line|#define JSPT_CAY                                0x00000002
DECL|macro|JSPT_CBX
mdefine_line|#define JSPT_CBX                                0x00000004
DECL|macro|JSPT_CBY
mdefine_line|#define JSPT_CBY                                0x00000008
DECL|macro|JSPT_BA1
mdefine_line|#define JSPT_BA1                                0x00000010
DECL|macro|JSPT_BA2
mdefine_line|#define JSPT_BA2                                0x00000020
DECL|macro|JSPT_BB1
mdefine_line|#define JSPT_BB1                                0x00000040
DECL|macro|JSPT_BB2
mdefine_line|#define JSPT_BB2                                0x00000080
multiline_comment|/* Bits for JSCTL */
DECL|macro|JSCTL_SP_MASK
mdefine_line|#define JSCTL_SP_MASK                           0x00000003
DECL|macro|JSCTL_SP_SLOW
mdefine_line|#define JSCTL_SP_SLOW                           0x00000000
DECL|macro|JSCTL_SP_MEDIUM_SLOW
mdefine_line|#define JSCTL_SP_MEDIUM_SLOW                    0x00000001
DECL|macro|JSCTL_SP_MEDIUM_FAST
mdefine_line|#define JSCTL_SP_MEDIUM_FAST                    0x00000002
DECL|macro|JSCTL_SP_FAST
mdefine_line|#define JSCTL_SP_FAST                           0x00000003
DECL|macro|JSCTL_ARE
mdefine_line|#define JSCTL_ARE                               0x00000004
multiline_comment|/* Data register pairs masks */
DECL|macro|JSC1_Y1V_MASK
mdefine_line|#define JSC1_Y1V_MASK                           0x0000FFFF
DECL|macro|JSC1_X1V_MASK
mdefine_line|#define JSC1_X1V_MASK                           0xFFFF0000
DECL|macro|JSC1_Y1V_SHIFT
mdefine_line|#define JSC1_Y1V_SHIFT                          0
DECL|macro|JSC1_X1V_SHIFT
mdefine_line|#define JSC1_X1V_SHIFT                          16
DECL|macro|JSC2_Y2V_MASK
mdefine_line|#define JSC2_Y2V_MASK                           0x0000FFFF
DECL|macro|JSC2_X2V_MASK
mdefine_line|#define JSC2_X2V_MASK                           0xFFFF0000
DECL|macro|JSC2_Y2V_SHIFT
mdefine_line|#define JSC2_Y2V_SHIFT                          0
DECL|macro|JSC2_X2V_SHIFT
mdefine_line|#define JSC2_X2V_SHIFT                          16
multiline_comment|/* JS GPIO */
DECL|macro|JSIO_DAX
mdefine_line|#define JSIO_DAX                                0x00000001
DECL|macro|JSIO_DAY
mdefine_line|#define JSIO_DAY                                0x00000002
DECL|macro|JSIO_DBX
mdefine_line|#define JSIO_DBX                                0x00000004
DECL|macro|JSIO_DBY
mdefine_line|#define JSIO_DBY                                0x00000008
DECL|macro|JSIO_AXOE
mdefine_line|#define JSIO_AXOE                               0x00000010
DECL|macro|JSIO_AYOE
mdefine_line|#define JSIO_AYOE                               0x00000020
DECL|macro|JSIO_BXOE
mdefine_line|#define JSIO_BXOE                               0x00000040
DECL|macro|JSIO_BYOE
mdefine_line|#define JSIO_BYOE                               0x00000080
multiline_comment|/*&n; *&n; */
DECL|macro|chip_t
mdefine_line|#define chip_t cs4281_t
DECL|typedef|cs4281_t
r_typedef
r_struct
id|snd_cs4281
id|cs4281_t
suffix:semicolon
DECL|typedef|cs4281_dma_t
r_typedef
r_struct
id|snd_cs4281_dma
id|cs4281_dma_t
suffix:semicolon
DECL|struct|snd_cs4281_dma
r_struct
id|snd_cs4281_dma
(brace
DECL|member|substream
id|snd_pcm_substream_t
op_star
id|substream
suffix:semicolon
DECL|member|regDBA
r_int
r_int
id|regDBA
suffix:semicolon
multiline_comment|/* offset to DBA register */
DECL|member|regDCA
r_int
r_int
id|regDCA
suffix:semicolon
multiline_comment|/* offset to DCA register */
DECL|member|regDBC
r_int
r_int
id|regDBC
suffix:semicolon
multiline_comment|/* offset to DBC register */
DECL|member|regDCC
r_int
r_int
id|regDCC
suffix:semicolon
multiline_comment|/* offset to DCC register */
DECL|member|regDMR
r_int
r_int
id|regDMR
suffix:semicolon
multiline_comment|/* offset to DMR register */
DECL|member|regDCR
r_int
r_int
id|regDCR
suffix:semicolon
multiline_comment|/* offset to DCR register */
DECL|member|regHDSR
r_int
r_int
id|regHDSR
suffix:semicolon
multiline_comment|/* offset to HDSR register */
DECL|member|regFCR
r_int
r_int
id|regFCR
suffix:semicolon
multiline_comment|/* offset to FCR register */
DECL|member|regFSIC
r_int
r_int
id|regFSIC
suffix:semicolon
multiline_comment|/* offset to FSIC register */
DECL|member|valDMR
r_int
r_int
id|valDMR
suffix:semicolon
multiline_comment|/* DMA mode */
DECL|member|valDCR
r_int
r_int
id|valDCR
suffix:semicolon
multiline_comment|/* DMA command */
DECL|member|valFCR
r_int
r_int
id|valFCR
suffix:semicolon
multiline_comment|/* FIFO control */
DECL|member|fifo_offset
r_int
r_int
id|fifo_offset
suffix:semicolon
multiline_comment|/* FIFO offset within BA1 */
DECL|member|left_slot
r_int
r_char
id|left_slot
suffix:semicolon
multiline_comment|/* FIFO left slot */
DECL|member|right_slot
r_int
r_char
id|right_slot
suffix:semicolon
multiline_comment|/* FIFO right slot */
DECL|member|frag
r_int
id|frag
suffix:semicolon
multiline_comment|/* period number */
)brace
suffix:semicolon
DECL|macro|SUSPEND_REGISTERS
mdefine_line|#define SUSPEND_REGISTERS&t;20
DECL|struct|snd_cs4281
r_struct
id|snd_cs4281
(brace
DECL|member|irq
r_int
id|irq
suffix:semicolon
DECL|member|ba0
r_int
r_int
id|ba0
suffix:semicolon
multiline_comment|/* virtual (accessible) address */
DECL|member|ba1
r_int
r_int
id|ba1
suffix:semicolon
multiline_comment|/* virtual (accessible) address */
DECL|member|ba0_addr
r_int
r_int
id|ba0_addr
suffix:semicolon
DECL|member|ba1_addr
r_int
r_int
id|ba1_addr
suffix:semicolon
DECL|member|ba0_res
r_struct
id|resource
op_star
id|ba0_res
suffix:semicolon
DECL|member|ba1_res
r_struct
id|resource
op_star
id|ba1_res
suffix:semicolon
DECL|member|dual_codec
r_int
id|dual_codec
suffix:semicolon
DECL|member|ac97
id|ac97_t
op_star
id|ac97
suffix:semicolon
DECL|member|ac97_secondary
id|ac97_t
op_star
id|ac97_secondary
suffix:semicolon
DECL|member|pci
r_struct
id|pci_dev
op_star
id|pci
suffix:semicolon
DECL|member|card
id|snd_card_t
op_star
id|card
suffix:semicolon
DECL|member|pcm
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
DECL|member|rmidi
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
DECL|member|midi_input
id|snd_rawmidi_substream_t
op_star
id|midi_input
suffix:semicolon
DECL|member|midi_output
id|snd_rawmidi_substream_t
op_star
id|midi_output
suffix:semicolon
DECL|member|dma
id|cs4281_dma_t
id|dma
(braket
l_int|4
)braket
suffix:semicolon
DECL|member|src_left_play_slot
r_int
r_char
id|src_left_play_slot
suffix:semicolon
DECL|member|src_right_play_slot
r_int
r_char
id|src_right_play_slot
suffix:semicolon
DECL|member|src_left_rec_slot
r_int
r_char
id|src_left_rec_slot
suffix:semicolon
DECL|member|src_right_rec_slot
r_int
r_char
id|src_right_rec_slot
suffix:semicolon
DECL|member|spurious_dhtc_irq
r_int
r_int
id|spurious_dhtc_irq
suffix:semicolon
DECL|member|spurious_dtc_irq
r_int
r_int
id|spurious_dtc_irq
suffix:semicolon
DECL|member|reg_lock
id|spinlock_t
id|reg_lock
suffix:semicolon
DECL|member|midcr
r_int
r_int
id|midcr
suffix:semicolon
DECL|member|uartm
r_int
r_int
id|uartm
suffix:semicolon
DECL|member|gameport
r_struct
id|snd_cs4281_gameport
op_star
id|gameport
suffix:semicolon
macro_line|#ifdef CONFIG_PM
DECL|member|suspend_regs
id|u32
id|suspend_regs
(braket
id|SUSPEND_REGISTERS
)braket
suffix:semicolon
macro_line|#endif
)brace
suffix:semicolon
r_static
id|irqreturn_t
id|snd_cs4281_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|snd_cs4281_ids
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
l_int|0x1013
comma
l_int|0x6005
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
comma
multiline_comment|/* CS4281 */
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|snd_cs4281_ids
)paren
suffix:semicolon
multiline_comment|/*&n; *  constants&n; */
DECL|macro|CS4281_FIFO_SIZE
mdefine_line|#define CS4281_FIFO_SIZE&t;32
multiline_comment|/*&n; *  common I/O routines&n; */
DECL|function|snd_cs4281_delay
r_static
r_void
id|snd_cs4281_delay
c_func
(paren
r_int
r_int
id|delay
comma
r_int
id|can_schedule
)paren
(brace
r_if
c_cond
(paren
id|delay
OG
l_int|999
)paren
(brace
r_if
c_cond
(paren
id|can_schedule
)paren
(brace
r_int
r_int
id|end_time
suffix:semicolon
id|delay
op_assign
(paren
id|delay
op_star
id|HZ
)paren
op_div
l_int|1000000
suffix:semicolon
r_if
c_cond
(paren
id|delay
OL
l_int|1
)paren
id|delay
op_assign
l_int|1
suffix:semicolon
id|end_time
op_assign
id|jiffies
op_plus
id|delay
suffix:semicolon
r_do
(brace
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|time_after_eq
c_func
(paren
id|end_time
comma
id|jiffies
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|delay
op_add_assign
l_int|999
suffix:semicolon
id|delay
op_div_assign
l_int|1000
suffix:semicolon
id|mdelay
c_func
(paren
id|delay
OG
l_int|0
ques
c_cond
id|delay
suffix:colon
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|udelay
c_func
(paren
id|delay
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_cs4281_delay_long
r_inline
r_static
r_void
id|snd_cs4281_delay_long
c_func
(paren
r_int
id|can_schedule
)paren
(brace
r_if
c_cond
(paren
id|can_schedule
)paren
(brace
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_else
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4281_pokeBA0
r_static
r_inline
r_void
id|snd_cs4281_pokeBA0
c_func
(paren
id|cs4281_t
op_star
id|chip
comma
r_int
r_int
id|offset
comma
r_int
r_int
id|val
)paren
(brace
id|writel
c_func
(paren
id|val
comma
id|chip-&gt;ba0
op_plus
id|offset
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4281_peekBA0
r_static
r_inline
r_int
r_int
id|snd_cs4281_peekBA0
c_func
(paren
id|cs4281_t
op_star
id|chip
comma
r_int
r_int
id|offset
)paren
(brace
r_return
id|readl
c_func
(paren
id|chip-&gt;ba0
op_plus
id|offset
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4281_ac97_write
r_static
r_void
id|snd_cs4281_ac97_write
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
multiline_comment|/*&n;&t; *  1. Write ACCAD = Command Address Register = 46Ch for AC97 register address&n;&t; *  2. Write ACCDA = Command Data Register = 470h    for data to write to AC97&n;&t; *  3. Write ACCTL = Control Register = 460h for initiating the write&n;&t; *  4. Read ACCTL = 460h, DCV should be reset by now and 460h = 07h&n;&t; *  5. if DCV not cleared, break and return error&n;&t; */
id|cs4281_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|ac97-&gt;private_data
comma
r_return
)paren
suffix:semicolon
r_int
id|count
suffix:semicolon
multiline_comment|/*&n;&t; *  Setup the AC97 control registers on the CS461x to send the&n;&t; *  appropriate command to the AC97 to perform the read.&n;&t; *  ACCAD = Command Address Register = 46Ch&n;&t; *  ACCDA = Command Data Register = 470h&n;&t; *  ACCTL = Control Register = 460h&n;&t; *  set DCV - will clear when process completed&n;&t; *  reset CRW - Write command&n;&t; *  set VFRM - valid frame enabled&n;&t; *  set ESYN - ASYNC generation enabled&n;&t; *  set RSTN - ARST# inactive, AC97 codec not reset&n;         */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCAD
comma
id|reg
)paren
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCDA
comma
id|val
)paren
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
id|BA0_ACCTL_DCV
op_or
id|BA0_ACCTL_VFRM
op_or
id|BA0_ACCTL_ESYN
op_or
(paren
id|ac97-&gt;num
ques
c_cond
id|BA0_ACCTL_TC
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
l_int|2000
suffix:semicolon
id|count
op_increment
)paren
(brace
multiline_comment|/*&n;&t;&t; *  First, we want to wait for a short time.&n;&t;&t; */
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; *  Now, check to see if the write has completed.&n;&t;&t; *  ACCTL = 460h, DCV should be reset by now and 460h = 07h&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
)paren
op_amp
id|BA0_ACCTL_DCV
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
)brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;AC&squot;97 write problem, reg = 0x%x, val = 0x%x&bslash;n&quot;
comma
id|reg
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4281_ac97_read
r_static
r_int
r_int
id|snd_cs4281_ac97_read
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
)paren
(brace
id|cs4281_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|ac97-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_int
id|count
suffix:semicolon
r_int
r_int
id|result
suffix:semicolon
singleline_comment|// FIXME: volatile is necessary in the following due to a bug of
singleline_comment|// some gcc versions
r_volatile
r_int
id|ac97_num
op_assign
(paren
(paren
r_volatile
id|ac97_t
op_star
)paren
id|ac97
)paren
op_member_access_from_pointer
id|num
suffix:semicolon
multiline_comment|/*&n;&t; *  1. Write ACCAD = Command Address Register = 46Ch for AC97 register address&n;&t; *  2. Write ACCDA = Command Data Register = 470h    for data to write to AC97 &n;&t; *  3. Write ACCTL = Control Register = 460h for initiating the write&n;&t; *  4. Read ACCTL = 460h, DCV should be reset by now and 460h = 17h&n;&t; *  5. if DCV not cleared, break and return error&n;&t; *  6. Read ACSTS = Status Register = 464h, check VSTS bit&n;&t; */
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|ac97_num
ques
c_cond
id|BA0_ACSDA2
suffix:colon
id|BA0_ACSDA
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Setup the AC97 control registers on the CS461x to send the&n;&t; *  appropriate command to the AC97 to perform the read.&n;&t; *  ACCAD = Command Address Register = 46Ch&n;&t; *  ACCDA = Command Data Register = 470h&n;&t; *  ACCTL = Control Register = 460h&n;&t; *  set DCV - will clear when process completed&n;&t; *  set CRW - Read command&n;&t; *  set VFRM - valid frame enabled&n;&t; *  set ESYN - ASYNC generation enabled&n;&t; *  set RSTN - ARST# inactive, AC97 codec not reset&n;&t; */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCAD
comma
id|reg
)paren
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCDA
comma
l_int|0
)paren
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
id|BA0_ACCTL_DCV
op_or
id|BA0_ACCTL_CRW
op_or
id|BA0_ACCTL_VFRM
op_or
id|BA0_ACCTL_ESYN
op_or
(paren
id|ac97_num
ques
c_cond
id|BA0_ACCTL_TC
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Wait for the read to occur.&n;&t; */
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
l_int|500
suffix:semicolon
id|count
op_increment
)paren
(brace
multiline_comment|/*&n;&t;&t; *  First, we want to wait for a short time.&n;&t; &t; */
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; *  Now, check to see if the read has completed.&n;&t;&t; *  ACCTL = 460h, DCV should be reset by now and 460h = 17h&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
)paren
op_amp
id|BA0_ACCTL_DCV
)paren
)paren
r_goto
id|__ok1
suffix:semicolon
)brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;AC&squot;97 read problem (ACCTL_DCV), reg = 0x%x&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
id|result
op_assign
l_int|0xffff
suffix:semicolon
r_goto
id|__end
suffix:semicolon
id|__ok1
suffix:colon
multiline_comment|/*&n;&t; *  Wait for the valid status bit to go active.&n;&t; */
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
l_int|100
suffix:semicolon
id|count
op_increment
)paren
(brace
multiline_comment|/*&n;&t;&t; *  Read the AC97 status register.&n;&t;&t; *  ACSTS = Status Register = 464h&n;&t;&t; *  VSTS - Valid Status&n;&t;&t; */
r_if
c_cond
(paren
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|ac97_num
ques
c_cond
id|BA0_ACSTS2
suffix:colon
id|BA0_ACSTS
)paren
op_amp
id|BA0_ACSTS_VSTS
)paren
r_goto
id|__ok2
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;AC&squot;97 read problem (ACSTS_VSTS), reg = 0x%x&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
id|result
op_assign
l_int|0xffff
suffix:semicolon
r_goto
id|__end
suffix:semicolon
id|__ok2
suffix:colon
multiline_comment|/*&n;&t; *  Read the data returned from the AC97 register.&n;&t; *  ACSDA = Status Data Register = 474h&n;&t; */
id|result
op_assign
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|ac97_num
ques
c_cond
id|BA0_ACSDA2
suffix:colon
id|BA0_ACSDA
)paren
suffix:semicolon
id|__end
suffix:colon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/*&n; *  PCM part&n; */
DECL|function|snd_cs4281_trigger
r_static
r_int
id|snd_cs4281_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|cs4281_dma_t
op_star
id|dma
op_assign
(paren
id|cs4281_dma_t
op_star
)paren
id|substream-&gt;runtime-&gt;private_data
suffix:semicolon
id|cs4281_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_PUSH
suffix:colon
id|dma-&gt;valDCR
op_or_assign
id|BA0_DCR_MSK
suffix:semicolon
id|dma-&gt;valFCR
op_or_assign
id|BA0_FCR_FEN
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_RELEASE
suffix:colon
id|dma-&gt;valDCR
op_and_assign
op_complement
id|BA0_DCR_MSK
suffix:semicolon
id|dma-&gt;valFCR
op_and_assign
op_complement
id|BA0_FCR_FEN
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_RESUME
suffix:colon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|dma-&gt;regDMR
comma
id|dma-&gt;valDMR
op_amp
op_complement
id|BA0_DMR_DMA
)paren
suffix:semicolon
id|dma-&gt;valDMR
op_or_assign
id|BA0_DMR_DMA
suffix:semicolon
id|dma-&gt;valDCR
op_and_assign
op_complement
id|BA0_DCR_MSK
suffix:semicolon
id|dma-&gt;valFCR
op_or_assign
id|BA0_FCR_FEN
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_SUSPEND
suffix:colon
id|dma-&gt;valDMR
op_and_assign
op_complement
(paren
id|BA0_DMR_DMA
op_or
id|BA0_DMR_POLL
)paren
suffix:semicolon
id|dma-&gt;valDCR
op_or_assign
id|BA0_DCR_MSK
suffix:semicolon
id|dma-&gt;valFCR
op_and_assign
op_complement
id|BA0_FCR_FEN
suffix:semicolon
multiline_comment|/* Leave wave playback FIFO enabled for FM */
r_if
c_cond
(paren
id|dma-&gt;regFCR
op_ne
id|BA0_FCR0
)paren
id|dma-&gt;valFCR
op_and_assign
op_complement
id|BA0_FCR_FEN
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|dma-&gt;regDMR
comma
id|dma-&gt;valDMR
)paren
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|dma-&gt;regFCR
comma
id|dma-&gt;valFCR
)paren
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|dma-&gt;regDCR
comma
id|dma-&gt;valDCR
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4281_rate
r_static
r_int
r_int
id|snd_cs4281_rate
c_func
(paren
r_int
r_int
id|rate
comma
r_int
r_int
op_star
id|real_rate
)paren
(brace
r_int
r_int
id|val
op_assign
op_complement
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|real_rate
)paren
op_star
id|real_rate
op_assign
id|rate
suffix:semicolon
multiline_comment|/* special &quot;hardcoded&quot; rates */
r_switch
c_cond
(paren
id|rate
)paren
(brace
r_case
l_int|8000
suffix:colon
r_return
l_int|5
suffix:semicolon
r_case
l_int|11025
suffix:colon
r_return
l_int|4
suffix:semicolon
r_case
l_int|16000
suffix:colon
r_return
l_int|3
suffix:semicolon
r_case
l_int|22050
suffix:colon
r_return
l_int|2
suffix:semicolon
r_case
l_int|44100
suffix:colon
r_return
l_int|1
suffix:semicolon
r_case
l_int|48000
suffix:colon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_goto
id|__variable
suffix:semicolon
)brace
id|__variable
suffix:colon
id|val
op_assign
l_int|1536000
op_div
id|rate
suffix:semicolon
r_if
c_cond
(paren
id|real_rate
)paren
op_star
id|real_rate
op_assign
l_int|1536000
op_div
id|val
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
DECL|function|snd_cs4281_mode
r_static
r_void
id|snd_cs4281_mode
c_func
(paren
id|cs4281_t
op_star
id|chip
comma
id|cs4281_dma_t
op_star
id|dma
comma
id|snd_pcm_runtime_t
op_star
id|runtime
comma
r_int
id|capture
comma
r_int
id|src
)paren
(brace
r_int
id|rec_mono
suffix:semicolon
id|dma-&gt;valDMR
op_assign
id|BA0_DMR_TYPE_SINGLE
op_or
id|BA0_DMR_AUTO
op_or
(paren
id|capture
ques
c_cond
id|BA0_DMR_TR_WRITE
suffix:colon
id|BA0_DMR_TR_READ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;channels
op_eq
l_int|1
)paren
id|dma-&gt;valDMR
op_or_assign
id|BA0_DMR_MONO
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_unsigned
c_func
(paren
id|runtime-&gt;format
)paren
OG
l_int|0
)paren
id|dma-&gt;valDMR
op_or_assign
id|BA0_DMR_USIGN
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_big_endian
c_func
(paren
id|runtime-&gt;format
)paren
OG
l_int|0
)paren
id|dma-&gt;valDMR
op_or_assign
id|BA0_DMR_BEND
suffix:semicolon
r_switch
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
)paren
(brace
r_case
l_int|8
suffix:colon
id|dma-&gt;valDMR
op_or_assign
id|BA0_DMR_SIZE8
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;channels
op_eq
l_int|1
)paren
id|dma-&gt;valDMR
op_or_assign
id|BA0_DMR_SWAPC
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|32
suffix:colon
id|dma-&gt;valDMR
op_or_assign
id|BA0_DMR_SIZE20
suffix:semicolon
r_break
suffix:semicolon
)brace
id|dma-&gt;frag
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* for workaround */
id|dma-&gt;valDCR
op_assign
id|BA0_DCR_TCIE
op_or
id|BA0_DCR_MSK
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;buffer_size
op_ne
id|runtime-&gt;period_size
)paren
id|dma-&gt;valDCR
op_or_assign
id|BA0_DCR_HTCIE
suffix:semicolon
multiline_comment|/* Initialize DMA */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|dma-&gt;regDBA
comma
id|runtime-&gt;dma_addr
)paren
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|dma-&gt;regDBC
comma
id|runtime-&gt;buffer_size
op_minus
l_int|1
)paren
suffix:semicolon
id|rec_mono
op_assign
(paren
id|chip-&gt;dma
(braket
l_int|1
)braket
dot
id|valDMR
op_amp
id|BA0_DMR_MONO
)paren
op_eq
id|BA0_DMR_MONO
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SRCSA
comma
(paren
id|chip-&gt;src_left_play_slot
op_lshift
l_int|0
)paren
op_or
(paren
id|chip-&gt;src_right_play_slot
op_lshift
l_int|8
)paren
op_or
(paren
id|chip-&gt;src_left_rec_slot
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|rec_mono
ques
c_cond
l_int|31
suffix:colon
id|chip-&gt;src_right_rec_slot
)paren
op_lshift
l_int|24
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|src
)paren
r_goto
id|__skip_src
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|capture
)paren
(brace
r_if
c_cond
(paren
id|dma-&gt;left_slot
op_eq
id|chip-&gt;src_left_play_slot
)paren
(brace
r_int
r_int
id|val
op_assign
id|snd_cs4281_rate
c_func
(paren
id|runtime-&gt;rate
comma
l_int|NULL
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|dma-&gt;right_slot
op_eq
id|chip-&gt;src_right_play_slot
comma
)paren
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_DACSR
comma
id|val
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|dma-&gt;left_slot
op_eq
id|chip-&gt;src_left_rec_slot
)paren
(brace
r_int
r_int
id|val
op_assign
id|snd_cs4281_rate
c_func
(paren
id|runtime-&gt;rate
comma
l_int|NULL
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|dma-&gt;right_slot
op_eq
id|chip-&gt;src_right_rec_slot
comma
)paren
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ADCSR
comma
id|val
)paren
suffix:semicolon
)brace
)brace
id|__skip_src
suffix:colon
multiline_comment|/* Deactivate wave playback FIFO before changing slot assignments */
r_if
c_cond
(paren
id|dma-&gt;regFCR
op_eq
id|BA0_FCR0
)paren
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|dma-&gt;regFCR
comma
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|dma-&gt;regFCR
)paren
op_amp
op_complement
id|BA0_FCR_FEN
)paren
suffix:semicolon
multiline_comment|/* Initialize FIFO */
id|dma-&gt;valFCR
op_assign
id|BA0_FCR_LS
c_func
(paren
id|dma-&gt;left_slot
)paren
op_or
id|BA0_FCR_RS
c_func
(paren
id|capture
op_logical_and
(paren
id|dma-&gt;valDMR
op_amp
id|BA0_DMR_MONO
)paren
ques
c_cond
l_int|31
suffix:colon
id|dma-&gt;right_slot
)paren
op_or
id|BA0_FCR_SZ
c_func
(paren
id|CS4281_FIFO_SIZE
)paren
op_or
id|BA0_FCR_OF
c_func
(paren
id|dma-&gt;fifo_offset
)paren
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|dma-&gt;regFCR
comma
id|dma-&gt;valFCR
op_or
(paren
id|capture
ques
c_cond
id|BA0_FCR_PSH
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
multiline_comment|/* Activate FIFO again for FM playback */
r_if
c_cond
(paren
id|dma-&gt;regFCR
op_eq
id|BA0_FCR0
)paren
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|dma-&gt;regFCR
comma
id|dma-&gt;valFCR
op_or
id|BA0_FCR_FEN
)paren
suffix:semicolon
multiline_comment|/* Clear FIFO Status and Interrupt Control Register */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|dma-&gt;regFSIC
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4281_hw_params
r_static
r_int
id|snd_cs4281_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
r_return
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4281_hw_free
r_static
r_int
id|snd_cs4281_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4281_playback_prepare
r_static
r_int
id|snd_cs4281_playback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|cs4281_dma_t
op_star
id|dma
op_assign
(paren
id|cs4281_dma_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
id|cs4281_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4281_mode
c_func
(paren
id|chip
comma
id|dma
comma
id|runtime
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4281_capture_prepare
r_static
r_int
id|snd_cs4281_capture_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|cs4281_dma_t
op_star
id|dma
op_assign
(paren
id|cs4281_dma_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
id|cs4281_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4281_mode
c_func
(paren
id|chip
comma
id|dma
comma
id|runtime
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4281_pointer
r_static
id|snd_pcm_uframes_t
id|snd_cs4281_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|cs4281_dma_t
op_star
id|dma
op_assign
(paren
id|cs4281_dma_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
id|cs4281_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
singleline_comment|// printk(&quot;DCC = 0x%x, buffer_size = 0x%x, jiffies = %li&bslash;n&quot;, snd_cs4281_peekBA0(chip, dma-&gt;regDCC), runtime-&gt;buffer_size, jiffies);
r_return
id|runtime-&gt;buffer_size
op_minus
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|dma-&gt;regDCC
)paren
op_minus
l_int|1
suffix:semicolon
)brace
DECL|variable|snd_cs4281_playback
r_static
id|snd_pcm_hardware_t
id|snd_cs4281_playback
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_PAUSE
op_or
id|SNDRV_PCM_INFO_RESUME
op_or
id|SNDRV_PCM_INFO_SYNC_START
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S8
op_or
id|SNDRV_PCM_FMTBIT_U16_LE
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
op_or
id|SNDRV_PCM_FMTBIT_U16_BE
op_or
id|SNDRV_PCM_FMTBIT_S16_BE
op_or
id|SNDRV_PCM_FMTBIT_U32_LE
op_or
id|SNDRV_PCM_FMTBIT_S32_LE
op_or
id|SNDRV_PCM_FMTBIT_U32_BE
op_or
id|SNDRV_PCM_FMTBIT_S32_BE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
dot
id|rate_min
op_assign
l_int|4000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|512
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|512
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|2
comma
dot
id|fifo_size
op_assign
id|CS4281_FIFO_SIZE
comma
)brace
suffix:semicolon
DECL|variable|snd_cs4281_capture
r_static
id|snd_pcm_hardware_t
id|snd_cs4281_capture
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_PAUSE
op_or
id|SNDRV_PCM_INFO_RESUME
op_or
id|SNDRV_PCM_INFO_SYNC_START
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S8
op_or
id|SNDRV_PCM_FMTBIT_U16_LE
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
op_or
id|SNDRV_PCM_FMTBIT_U16_BE
op_or
id|SNDRV_PCM_FMTBIT_S16_BE
op_or
id|SNDRV_PCM_FMTBIT_U32_LE
op_or
id|SNDRV_PCM_FMTBIT_S32_LE
op_or
id|SNDRV_PCM_FMTBIT_U32_BE
op_or
id|SNDRV_PCM_FMTBIT_S32_BE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
dot
id|rate_min
op_assign
l_int|4000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|512
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|512
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|2
comma
dot
id|fifo_size
op_assign
id|CS4281_FIFO_SIZE
comma
)brace
suffix:semicolon
DECL|function|snd_cs4281_playback_open
r_static
r_int
id|snd_cs4281_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs4281_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|cs4281_dma_t
op_star
id|dma
suffix:semicolon
id|dma
op_assign
op_amp
id|chip-&gt;dma
(braket
l_int|0
)braket
suffix:semicolon
id|dma-&gt;substream
op_assign
id|substream
suffix:semicolon
id|dma-&gt;left_slot
op_assign
l_int|0
suffix:semicolon
id|dma-&gt;right_slot
op_assign
l_int|1
suffix:semicolon
id|runtime-&gt;private_data
op_assign
id|dma
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_cs4281_playback
suffix:semicolon
id|snd_pcm_set_sync
c_func
(paren
id|substream
)paren
suffix:semicolon
multiline_comment|/* should be detected from the AC&squot;97 layer, but it seems&n;&t;   that although CS4297A rev B reports 18-bit ADC resolution,&n;&t;   samples are 20-bit */
id|snd_pcm_hw_constraint_msbits
c_func
(paren
id|runtime
comma
l_int|0
comma
l_int|32
comma
l_int|20
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4281_capture_open
r_static
r_int
id|snd_cs4281_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs4281_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|cs4281_dma_t
op_star
id|dma
suffix:semicolon
id|dma
op_assign
op_amp
id|chip-&gt;dma
(braket
l_int|1
)braket
suffix:semicolon
id|dma-&gt;substream
op_assign
id|substream
suffix:semicolon
id|dma-&gt;left_slot
op_assign
l_int|10
suffix:semicolon
id|dma-&gt;right_slot
op_assign
l_int|11
suffix:semicolon
id|runtime-&gt;private_data
op_assign
id|dma
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_cs4281_capture
suffix:semicolon
id|snd_pcm_set_sync
c_func
(paren
id|substream
)paren
suffix:semicolon
multiline_comment|/* should be detected from the AC&squot;97 layer, but it seems&n;&t;   that although CS4297A rev B reports 18-bit ADC resolution,&n;&t;   samples are 20-bit */
id|snd_pcm_hw_constraint_msbits
c_func
(paren
id|runtime
comma
l_int|0
comma
l_int|32
comma
l_int|20
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4281_playback_close
r_static
r_int
id|snd_cs4281_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs4281_dma_t
op_star
id|dma
op_assign
(paren
id|cs4281_dma_t
op_star
)paren
id|substream-&gt;runtime-&gt;private_data
suffix:semicolon
id|dma-&gt;substream
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4281_capture_close
r_static
r_int
id|snd_cs4281_capture_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs4281_dma_t
op_star
id|dma
op_assign
(paren
id|cs4281_dma_t
op_star
)paren
id|substream-&gt;runtime-&gt;private_data
suffix:semicolon
id|dma-&gt;substream
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_cs4281_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_cs4281_playback_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_cs4281_playback_open
comma
dot
id|close
op_assign
id|snd_cs4281_playback_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_cs4281_hw_params
comma
dot
id|hw_free
op_assign
id|snd_cs4281_hw_free
comma
dot
id|prepare
op_assign
id|snd_cs4281_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_cs4281_trigger
comma
dot
id|pointer
op_assign
id|snd_cs4281_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_cs4281_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_cs4281_capture_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_cs4281_capture_open
comma
dot
id|close
op_assign
id|snd_cs4281_capture_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_cs4281_hw_params
comma
dot
id|hw_free
op_assign
id|snd_cs4281_hw_free
comma
dot
id|prepare
op_assign
id|snd_cs4281_capture_prepare
comma
dot
id|trigger
op_assign
id|snd_cs4281_trigger
comma
dot
id|pointer
op_assign
id|snd_cs4281_pointer
comma
)brace
suffix:semicolon
DECL|function|snd_cs4281_pcm_free
r_static
r_void
id|snd_cs4281_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|cs4281_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|pcm-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|chip-&gt;pcm
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4281_pcm
r_static
r_int
id|__devinit
id|snd_cs4281_pcm
c_func
(paren
id|cs4281_t
op_star
id|chip
comma
r_int
id|device
comma
id|snd_pcm_t
op_star
op_star
id|rpcm
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
l_int|NULL
suffix:semicolon
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;CS4281&quot;
comma
id|device
comma
l_int|1
comma
l_int|1
comma
op_amp
id|pcm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_cs4281_playback_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_cs4281_capture_ops
)paren
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_cs4281_pcm_free
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;CS4281&quot;
)paren
suffix:semicolon
id|chip-&gt;pcm
op_assign
id|pcm
suffix:semicolon
id|snd_pcm_lib_preallocate_pci_pages_for_all
c_func
(paren
id|chip-&gt;pci
comma
id|pcm
comma
l_int|64
op_star
l_int|1024
comma
l_int|512
op_star
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rpcm
)paren
op_star
id|rpcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Mixer section&n; */
DECL|macro|CS_VOL_MASK
mdefine_line|#define CS_VOL_MASK&t;0x1f
DECL|function|snd_cs4281_info_volume
r_static
r_int
id|snd_cs4281_info_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
id|CS_VOL_MASK
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4281_get_volume
r_static
r_int
id|snd_cs4281_get_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs4281_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|regL
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
suffix:semicolon
r_int
id|regR
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xffff
suffix:semicolon
r_int
id|volL
comma
id|volR
suffix:semicolon
id|volL
op_assign
id|CS_VOL_MASK
op_minus
(paren
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|regL
)paren
op_amp
id|CS_VOL_MASK
)paren
suffix:semicolon
id|volR
op_assign
id|CS_VOL_MASK
op_minus
(paren
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|regR
)paren
op_amp
id|CS_VOL_MASK
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|volL
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
id|volR
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4281_put_volume
r_static
r_int
id|snd_cs4281_put_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs4281_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|change
op_assign
l_int|0
suffix:semicolon
r_int
id|regL
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
suffix:semicolon
r_int
id|regR
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xffff
suffix:semicolon
r_int
id|volL
comma
id|volR
suffix:semicolon
id|volL
op_assign
id|CS_VOL_MASK
op_minus
(paren
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|regL
)paren
op_amp
id|CS_VOL_MASK
)paren
suffix:semicolon
id|volR
op_assign
id|CS_VOL_MASK
op_minus
(paren
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|regR
)paren
op_amp
id|CS_VOL_MASK
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_ne
id|volL
)paren
(brace
id|volL
op_assign
id|CS_VOL_MASK
op_minus
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
id|CS_VOL_MASK
)paren
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|regL
comma
id|volL
)paren
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_ne
id|volL
)paren
(brace
id|volR
op_assign
id|CS_VOL_MASK
op_minus
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_amp
id|CS_VOL_MASK
)paren
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|regR
comma
id|volR
)paren
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|change
suffix:semicolon
)brace
DECL|variable|snd_cs4281_fm_vol
r_static
id|snd_kcontrol_new_t
id|snd_cs4281_fm_vol
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Synth Playback Volume&quot;
comma
dot
id|info
op_assign
id|snd_cs4281_info_volume
comma
dot
id|get
op_assign
id|snd_cs4281_get_volume
comma
dot
id|put
op_assign
id|snd_cs4281_put_volume
comma
dot
id|private_value
op_assign
(paren
(paren
id|BA0_FMLVC
op_lshift
l_int|16
)paren
op_or
id|BA0_FMRVC
)paren
comma
)brace
suffix:semicolon
DECL|variable|snd_cs4281_pcm_vol
r_static
id|snd_kcontrol_new_t
id|snd_cs4281_pcm_vol
op_assign
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;PCM Stream Playback Volume&quot;
comma
dot
id|info
op_assign
id|snd_cs4281_info_volume
comma
dot
id|get
op_assign
id|snd_cs4281_get_volume
comma
dot
id|put
op_assign
id|snd_cs4281_put_volume
comma
dot
id|private_value
op_assign
(paren
(paren
id|BA0_PPLVC
op_lshift
l_int|16
)paren
op_or
id|BA0_PPRVC
)paren
comma
)brace
suffix:semicolon
DECL|function|snd_cs4281_mixer_free_ac97
r_static
r_void
id|snd_cs4281_mixer_free_ac97
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
id|cs4281_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|ac97-&gt;private_data
comma
r_return
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;num
)paren
id|chip-&gt;ac97_secondary
op_assign
l_int|NULL
suffix:semicolon
r_else
id|chip-&gt;ac97
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|snd_cs4281_mixer
r_static
r_int
id|__devinit
id|snd_cs4281_mixer
c_func
(paren
id|cs4281_t
op_star
id|chip
)paren
(brace
id|snd_card_t
op_star
id|card
op_assign
id|chip-&gt;card
suffix:semicolon
id|ac97_t
id|ac97
suffix:semicolon
r_int
id|err
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ac97
comma
l_int|0
comma
r_sizeof
(paren
id|ac97
)paren
)paren
suffix:semicolon
id|ac97.write
op_assign
id|snd_cs4281_ac97_write
suffix:semicolon
id|ac97.read
op_assign
id|snd_cs4281_ac97_read
suffix:semicolon
id|ac97.private_data
op_assign
id|chip
suffix:semicolon
id|ac97.private_free
op_assign
id|snd_cs4281_mixer_free_ac97
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_mixer
c_func
(paren
id|card
comma
op_amp
id|ac97
comma
op_amp
id|chip-&gt;ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;dual_codec
)paren
(brace
id|ac97.num
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_mixer
c_func
(paren
id|card
comma
op_amp
id|ac97
comma
op_amp
id|chip-&gt;ac97_secondary
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_cs4281_fm_vol
comma
id|chip
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_cs4281_pcm_vol
comma
id|chip
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * proc interface&n; */
DECL|function|snd_cs4281_proc_read
r_static
r_void
id|snd_cs4281_proc_read
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|cs4281_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|entry-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Cirrus Logic CS4281&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Spurious half IRQs   : %u&bslash;n&quot;
comma
id|chip-&gt;spurious_dhtc_irq
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Spurious end IRQs    : %u&bslash;n&quot;
comma
id|chip-&gt;spurious_dtc_irq
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4281_BA0_read
r_static
r_int
id|snd_cs4281_BA0_read
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
r_void
op_star
id|file_private_data
comma
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|size
suffix:semicolon
id|cs4281_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|entry-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|size
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_pos
op_plus
id|size
OG
id|CS4281_BA0_SIZE
)paren
id|size
op_assign
(paren
r_int
)paren
id|CS4281_BA0_SIZE
op_minus
id|file-&gt;f_pos
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
l_int|0
)paren
(brace
r_char
op_star
id|tmp
suffix:semicolon
r_int
id|res
suffix:semicolon
r_int
r_int
id|virt
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|virt
op_assign
id|chip-&gt;ba0
op_plus
id|file-&gt;f_pos
suffix:semicolon
id|memcpy_fromio
c_func
(paren
id|tmp
comma
id|virt
comma
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|tmp
comma
id|size
)paren
)paren
id|res
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
(brace
id|res
op_assign
id|size
suffix:semicolon
id|file-&gt;f_pos
op_add_assign
id|size
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|tmp
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4281_BA1_read
r_static
r_int
id|snd_cs4281_BA1_read
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
r_void
op_star
id|file_private_data
comma
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_int
id|size
suffix:semicolon
id|cs4281_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|entry-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|size
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|file-&gt;f_pos
op_plus
id|size
OG
id|CS4281_BA1_SIZE
)paren
id|size
op_assign
(paren
r_int
)paren
id|CS4281_BA1_SIZE
op_minus
id|file-&gt;f_pos
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
l_int|0
)paren
(brace
r_char
op_star
id|tmp
suffix:semicolon
r_int
id|res
suffix:semicolon
r_int
r_int
id|virt
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_assign
id|kmalloc
c_func
(paren
id|size
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|virt
op_assign
id|chip-&gt;ba1
op_plus
id|file-&gt;f_pos
suffix:semicolon
id|memcpy_fromio
c_func
(paren
id|tmp
comma
id|virt
comma
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buf
comma
id|tmp
comma
id|size
)paren
)paren
id|res
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
(brace
id|res
op_assign
id|size
suffix:semicolon
id|file-&gt;f_pos
op_add_assign
id|size
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|tmp
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_cs4281_proc_ops_BA0
r_static
r_struct
id|snd_info_entry_ops
id|snd_cs4281_proc_ops_BA0
op_assign
(brace
dot
id|read
op_assign
id|snd_cs4281_BA0_read
comma
)brace
suffix:semicolon
DECL|variable|snd_cs4281_proc_ops_BA1
r_static
r_struct
id|snd_info_entry_ops
id|snd_cs4281_proc_ops_BA1
op_assign
(brace
dot
id|read
op_assign
id|snd_cs4281_BA1_read
comma
)brace
suffix:semicolon
DECL|function|snd_cs4281_proc_init
r_static
r_void
id|__devinit
id|snd_cs4281_proc_init
c_func
(paren
id|cs4281_t
op_star
id|chip
)paren
(brace
id|snd_info_entry_t
op_star
id|entry
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_card_proc_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;cs4281&quot;
comma
op_amp
id|entry
)paren
)paren
id|snd_info_set_text_ops
c_func
(paren
id|entry
comma
id|chip
comma
id|snd_cs4281_proc_read
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_card_proc_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;cs4281_BA0&quot;
comma
op_amp
id|entry
)paren
)paren
(brace
id|entry-&gt;content
op_assign
id|SNDRV_INFO_CONTENT_DATA
suffix:semicolon
id|entry-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|entry-&gt;c.ops
op_assign
op_amp
id|snd_cs4281_proc_ops_BA0
suffix:semicolon
id|entry-&gt;size
op_assign
id|CS4281_BA0_SIZE
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|snd_card_proc_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;cs4281_BA1&quot;
comma
op_amp
id|entry
)paren
)paren
(brace
id|entry-&gt;content
op_assign
id|SNDRV_INFO_CONTENT_DATA
suffix:semicolon
id|entry-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|entry-&gt;c.ops
op_assign
op_amp
id|snd_cs4281_proc_ops_BA1
suffix:semicolon
id|entry-&gt;size
op_assign
id|CS4281_BA1_SIZE
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * joystick support&n; */
macro_line|#if defined(CONFIG_GAMEPORT) || defined(CONFIG_GAMEPORT_MODULE)
DECL|struct|snd_cs4281_gameport
r_typedef
r_struct
id|snd_cs4281_gameport
(brace
DECL|member|info
r_struct
id|gameport
id|info
suffix:semicolon
DECL|member|chip
id|cs4281_t
op_star
id|chip
suffix:semicolon
DECL|typedef|cs4281_gameport_t
)brace
id|cs4281_gameport_t
suffix:semicolon
DECL|function|snd_cs4281_gameport_trigger
r_static
r_void
id|snd_cs4281_gameport_trigger
c_func
(paren
r_struct
id|gameport
op_star
id|gameport
)paren
(brace
id|cs4281_gameport_t
op_star
id|gp
op_assign
(paren
id|cs4281_gameport_t
op_star
)paren
id|gameport
suffix:semicolon
id|cs4281_t
op_star
id|chip
suffix:semicolon
id|snd_assert
c_func
(paren
id|gp
comma
r_return
)paren
suffix:semicolon
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|gp-&gt;chip
comma
r_return
)paren
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_JSPT
comma
l_int|0xff
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4281_gameport_read
r_static
r_int
r_char
id|snd_cs4281_gameport_read
c_func
(paren
r_struct
id|gameport
op_star
id|gameport
)paren
(brace
id|cs4281_gameport_t
op_star
id|gp
op_assign
(paren
id|cs4281_gameport_t
op_star
)paren
id|gameport
suffix:semicolon
id|cs4281_t
op_star
id|chip
suffix:semicolon
id|snd_assert
c_func
(paren
id|gp
comma
r_return
l_int|0
)paren
suffix:semicolon
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|gp-&gt;chip
comma
r_return
l_int|0
)paren
suffix:semicolon
r_return
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_JSPT
)paren
suffix:semicolon
)brace
macro_line|#ifdef COOKED_MODE
DECL|function|snd_cs4281_gameport_cooked_read
r_static
r_int
id|snd_cs4281_gameport_cooked_read
c_func
(paren
r_struct
id|gameport
op_star
id|gameport
comma
r_int
op_star
id|axes
comma
r_int
op_star
id|buttons
)paren
(brace
id|cs4281_gameport_t
op_star
id|gp
op_assign
(paren
id|cs4281_gameport_t
op_star
)paren
id|gameport
suffix:semicolon
id|cs4281_t
op_star
id|chip
suffix:semicolon
r_int
id|js1
comma
id|js2
comma
id|jst
suffix:semicolon
id|snd_assert
c_func
(paren
id|gp
comma
r_return
l_int|0
)paren
suffix:semicolon
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|gp-&gt;chip
comma
r_return
l_int|0
)paren
suffix:semicolon
id|js1
op_assign
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_JSC1
)paren
suffix:semicolon
id|js2
op_assign
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_JSC2
)paren
suffix:semicolon
id|jst
op_assign
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_JSPT
)paren
suffix:semicolon
op_star
id|buttons
op_assign
(paren
op_complement
id|jst
op_rshift
l_int|4
)paren
op_amp
l_int|0x0F
suffix:semicolon
id|axes
(braket
l_int|0
)braket
op_assign
(paren
(paren
id|js1
op_amp
id|JSC1_Y1V_MASK
)paren
op_rshift
id|JSC1_Y1V_SHIFT
)paren
op_amp
l_int|0xFFFF
suffix:semicolon
id|axes
(braket
l_int|1
)braket
op_assign
(paren
(paren
id|js1
op_amp
id|JSC1_X1V_MASK
)paren
op_rshift
id|JSC1_X1V_SHIFT
)paren
op_amp
l_int|0xFFFF
suffix:semicolon
id|axes
(braket
l_int|2
)braket
op_assign
(paren
(paren
id|js2
op_amp
id|JSC2_Y2V_MASK
)paren
op_rshift
id|JSC2_Y2V_SHIFT
)paren
op_amp
l_int|0xFFFF
suffix:semicolon
id|axes
(braket
l_int|3
)braket
op_assign
(paren
(paren
id|js2
op_amp
id|JSC2_X2V_MASK
)paren
op_rshift
id|JSC2_X2V_SHIFT
)paren
op_amp
l_int|0xFFFF
suffix:semicolon
r_for
c_loop
(paren
id|jst
op_assign
l_int|0
suffix:semicolon
id|jst
OL
l_int|4
suffix:semicolon
op_increment
id|jst
)paren
r_if
c_cond
(paren
id|axes
(braket
id|jst
)braket
op_eq
l_int|0xFFFF
)paren
(brace
id|axes
(braket
id|jst
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
DECL|function|snd_cs4281_gameport_open
r_static
r_int
id|snd_cs4281_gameport_open
c_func
(paren
r_struct
id|gameport
op_star
id|gameport
comma
r_int
id|mode
)paren
(brace
r_switch
c_cond
(paren
id|mode
)paren
(brace
macro_line|#ifdef COOKED_MODE
r_case
id|GAMEPORT_MODE_COOKED
suffix:colon
r_return
l_int|0
suffix:semicolon
macro_line|#endif
r_case
id|GAMEPORT_MODE_RAW
suffix:colon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4281_gameport
r_static
r_void
id|__devinit
id|snd_cs4281_gameport
c_func
(paren
id|cs4281_t
op_star
id|chip
)paren
(brace
id|cs4281_gameport_t
op_star
id|gp
suffix:semicolon
id|gp
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|gp
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|gp
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cannot allocate gameport area&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memset
c_func
(paren
id|gp
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|gp
)paren
)paren
suffix:semicolon
id|gp-&gt;info.open
op_assign
id|snd_cs4281_gameport_open
suffix:semicolon
id|gp-&gt;info.read
op_assign
id|snd_cs4281_gameport_read
suffix:semicolon
id|gp-&gt;info.trigger
op_assign
id|snd_cs4281_gameport_trigger
suffix:semicolon
macro_line|#ifdef COOKED_MODE
id|gp-&gt;info.cooked_read
op_assign
id|snd_cs4281_gameport_cooked_read
suffix:semicolon
macro_line|#endif
id|gp-&gt;chip
op_assign
id|chip
suffix:semicolon
id|chip-&gt;gameport
op_assign
id|gp
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_JSIO
comma
l_int|0xFF
)paren
suffix:semicolon
singleline_comment|// ?
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_JSCTL
comma
id|JSCTL_SP_MEDIUM_SLOW
)paren
suffix:semicolon
id|gameport_register_port
c_func
(paren
op_amp
id|gp-&gt;info
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|macro|snd_cs4281_gameport
mdefine_line|#define snd_cs4281_gameport(chip) /*NOP*/
macro_line|#endif /* CONFIG_GAMEPORT || CONFIG_GAMEPORT_MODULE */
multiline_comment|/*&n;&n; */
DECL|function|snd_cs4281_free
r_static
r_int
id|snd_cs4281_free
c_func
(paren
id|cs4281_t
op_star
id|chip
)paren
(brace
macro_line|#if defined(CONFIG_GAMEPORT) || defined(CONFIG_GAMEPORT_MODULE)
r_if
c_cond
(paren
id|chip-&gt;gameport
)paren
(brace
id|gameport_unregister_port
c_func
(paren
op_amp
id|chip-&gt;gameport-&gt;info
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|chip-&gt;gameport
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|chip-&gt;irq
op_ge
l_int|0
)paren
id|synchronize_irq
c_func
(paren
id|chip-&gt;irq
)paren
suffix:semicolon
multiline_comment|/* Mask interrupts */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_HIMR
comma
l_int|0x7fffffff
)paren
suffix:semicolon
multiline_comment|/* Stop the DLL Clock logic. */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Sound System Power Management - Turn Everything OFF */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SSPM
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* PCI interface - D3 state */
id|pci_set_power_state
c_func
(paren
id|chip-&gt;pci
comma
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;ba0
)paren
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|chip-&gt;ba0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;ba1
)paren
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|chip-&gt;ba1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;ba0_res
)paren
(brace
id|release_resource
c_func
(paren
id|chip-&gt;ba0_res
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|chip-&gt;ba0_res
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chip-&gt;ba1_res
)paren
(brace
id|release_resource
c_func
(paren
id|chip-&gt;ba1_res
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|chip-&gt;ba1_res
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chip-&gt;irq
op_ge
l_int|0
)paren
id|free_irq
c_func
(paren
id|chip-&gt;irq
comma
(paren
r_void
op_star
)paren
id|chip
)paren
suffix:semicolon
id|snd_magic_kfree
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4281_dev_free
r_static
r_int
id|snd_cs4281_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|cs4281_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|device-&gt;device_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_return
id|snd_cs4281_free
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
r_static
r_int
id|snd_cs4281_chip_init
c_func
(paren
id|cs4281_t
op_star
id|chip
comma
r_int
id|can_schedule
)paren
suffix:semicolon
multiline_comment|/* defined below */
macro_line|#ifdef CONFIG_PM
r_static
r_int
id|snd_cs4281_set_power_state
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_int
r_int
id|power_state
)paren
suffix:semicolon
macro_line|#endif
DECL|function|snd_cs4281_create
r_static
r_int
id|__devinit
id|snd_cs4281_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_struct
id|pci_dev
op_star
id|pci
comma
id|cs4281_t
op_star
op_star
id|rchip
comma
r_int
id|dual_codec
)paren
(brace
id|cs4281_t
op_star
id|chip
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
r_int
id|err
suffix:semicolon
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
dot
id|dev_free
op_assign
id|snd_cs4281_dev_free
comma
)brace
suffix:semicolon
op_star
id|rchip
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pci
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|chip
op_assign
id|snd_magic_kcalloc
c_func
(paren
id|cs4281_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|chip-&gt;card
op_assign
id|card
suffix:semicolon
id|chip-&gt;pci
op_assign
id|pci
suffix:semicolon
id|chip-&gt;irq
op_assign
op_minus
l_int|1
suffix:semicolon
id|chip-&gt;ba0_addr
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
suffix:semicolon
id|chip-&gt;ba1_addr
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|1
)paren
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dual_codec
template_param
l_int|3
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;invalid dual_codec option %d&bslash;n&quot;
comma
id|dual_codec
)paren
suffix:semicolon
id|dual_codec
op_assign
l_int|0
suffix:semicolon
)brace
id|chip-&gt;dual_codec
op_assign
id|dual_codec
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chip-&gt;ba0_res
op_assign
id|request_mem_region
c_func
(paren
id|chip-&gt;ba0_addr
comma
id|CS4281_BA0_SIZE
comma
l_string|&quot;CS4281 BA0&quot;
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_cs4281_free
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;unable to grab memory region 0x%lx-0x%lx&bslash;n&quot;
comma
id|chip-&gt;ba0_addr
comma
id|chip-&gt;ba0_addr
op_plus
id|CS4281_BA0_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|chip-&gt;ba1_res
op_assign
id|request_mem_region
c_func
(paren
id|chip-&gt;ba1_addr
comma
id|CS4281_BA1_SIZE
comma
l_string|&quot;CS4281 BA1&quot;
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_cs4281_free
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;unable to grab memory region 0x%lx-0x%lx&bslash;n&quot;
comma
id|chip-&gt;ba1_addr
comma
id|chip-&gt;ba1_addr
op_plus
id|CS4281_BA1_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|pci-&gt;irq
comma
id|snd_cs4281_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
l_string|&quot;CS4281&quot;
comma
(paren
r_void
op_star
)paren
id|chip
)paren
)paren
(brace
id|snd_cs4281_free
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;unable to grab IRQ %d&bslash;n&quot;
comma
id|pci-&gt;irq
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|chip-&gt;irq
op_assign
id|pci-&gt;irq
suffix:semicolon
id|chip-&gt;ba0
op_assign
(paren
r_int
r_int
)paren
id|ioremap_nocache
c_func
(paren
id|chip-&gt;ba0_addr
comma
id|CS4281_BA0_SIZE
)paren
suffix:semicolon
id|chip-&gt;ba1
op_assign
(paren
r_int
r_int
)paren
id|ioremap_nocache
c_func
(paren
id|chip-&gt;ba1_addr
comma
id|CS4281_BA1_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chip-&gt;ba0
op_logical_or
op_logical_neg
id|chip-&gt;ba1
)paren
(brace
id|snd_cs4281_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|tmp
op_assign
id|snd_cs4281_chip_init
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
)paren
(brace
id|snd_cs4281_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|tmp
suffix:semicolon
)brace
id|snd_cs4281_proc_init
c_func
(paren
id|chip
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PM
id|card-&gt;set_power_state
op_assign
id|snd_cs4281_set_power_state
suffix:semicolon
id|card-&gt;power_state_private_data
op_assign
id|chip
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|chip
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_cs4281_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
op_star
id|rchip
op_assign
id|chip
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4281_chip_init
r_static
r_int
id|snd_cs4281_chip_init
c_func
(paren
id|cs4281_t
op_star
id|chip
comma
r_int
id|can_schedule
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
r_int
id|timeout
suffix:semicolon
id|tmp
op_assign
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_CFLR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_ne
id|BA0_CFLR_DEFAULT
)paren
(brace
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CFLR
comma
id|BA0_CFLR_DEFAULT
)paren
suffix:semicolon
id|tmp
op_assign
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_CFLR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tmp
op_ne
id|BA0_CFLR_DEFAULT
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;CFLR setup failed (0x%x)&bslash;n&quot;
comma
id|tmp
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
)brace
multiline_comment|/* Set the &squot;Configuration Write Protect&squot; register&n;&t; * to 4281h.  Allows vendor-defined configuration&n;         * space between 0e4h and 0ffh to be written. */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CWPR
comma
l_int|0x4281
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|tmp
op_assign
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_SERC1
)paren
)paren
op_ne
(paren
id|BA0_SERC1_SO1EN
op_or
id|BA0_SERC1_AC97
)paren
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;SERC1 AC&squot;97 check failed (0x%x)&bslash;n&quot;
comma
id|tmp
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|tmp
op_assign
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_SERC2
)paren
)paren
op_ne
(paren
id|BA0_SERC2_SI1EN
op_or
id|BA0_SERC2_AC97
)paren
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;SERC2 AC&squot;97 check failed (0x%x)&bslash;n&quot;
comma
id|tmp
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
multiline_comment|/* Sound System Power Management */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SSPM
comma
id|BA0_SSPM_MIXEN
op_or
id|BA0_SSPM_CSRCEN
op_or
id|BA0_SSPM_PSRCEN
op_or
id|BA0_SSPM_JSEN
op_or
id|BA0_SSPM_ACLEN
op_or
id|BA0_SSPM_FMEN
)paren
suffix:semicolon
multiline_comment|/* Serial Port Power Management */
multiline_comment|/* Blast the clock control register to zero so that the&n;         * PLL starts out in a known state, and blast the master serial&n;         * port control register to zero so that the serial ports also&n;         * start out in a known state. */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
l_int|0
)paren
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERMC
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Make ESYN go to zero to turn off&n;         * the Sync pulse on the AC97 link. */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
multiline_comment|/*  Drive the ARST# pin low for a minimum of 1uS (as defined in the AC97&n;&t; *  spec) and then drive it high.  This is done for non AC97 modes since&n;&t; *  there might be logic external to the CS4281 that uses the ARST# line&n;&t; *  for a reset. */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SPMC
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SPMC
comma
id|BA0_SPMC_RSTN
)paren
suffix:semicolon
id|snd_cs4281_delay
c_func
(paren
l_int|50000
comma
id|can_schedule
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;dual_codec
)paren
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SPMC
comma
id|BA0_SPMC_RSTN
op_or
id|BA0_SPMC_ASDI2E
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Set the serial port timing configuration.&n;&t; */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERMC
comma
(paren
id|chip-&gt;dual_codec
ques
c_cond
id|BA0_SERMC_TCID
c_func
(paren
id|chip-&gt;dual_codec
)paren
suffix:colon
id|BA0_SERMC_TCID
c_func
(paren
l_int|1
)paren
)paren
op_or
id|BA0_SERMC_PTC_AC97
op_or
id|BA0_SERMC_MSPE
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Start the DLL Clock logic.&n;&t; */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
id|BA0_CLKCR1_DLLP
)paren
suffix:semicolon
id|snd_cs4281_delay
c_func
(paren
l_int|50000
comma
id|can_schedule
)paren
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
id|BA0_CLKCR1_SWCE
op_or
id|BA0_CLKCR1_DLLP
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Wait for the DLL ready signal from the clock logic.&n;&t; */
id|timeout
op_assign
id|HZ
suffix:semicolon
r_do
(brace
multiline_comment|/*&n;&t;&t; *  Read the AC97 status register to see if we&squot;ve seen a CODEC&n;&t;&t; *  signal from the AC97 codec.&n;&t;&t; */
r_if
c_cond
(paren
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
)paren
op_amp
id|BA0_CLKCR1_DLLRDY
)paren
r_goto
id|__ok0
suffix:semicolon
id|snd_cs4281_delay_long
c_func
(paren
id|can_schedule
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|timeout
op_decrement
OG
l_int|0
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;DLLRDY not seen&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
id|__ok0
suffix:colon
multiline_comment|/*&n;&t; *  The first thing we do here is to enable sync generation.  As soon&n;&t; *  as we start receiving bit clock, we&squot;ll start producing the SYNC&n;&t; *  signal.&n;&t; */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
id|BA0_ACCTL_ESYN
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Wait for the codec ready signal from the AC97 codec.&n;&t; */
id|timeout
op_assign
id|HZ
suffix:semicolon
r_do
(brace
multiline_comment|/*&n;&t;&t; *  Read the AC97 status register to see if we&squot;ve seen a CODEC&n;&t;&t; *  signal from the AC97 codec.&n;&t;&t; */
r_if
c_cond
(paren
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACSTS
)paren
op_amp
id|BA0_ACSTS_CRDY
)paren
r_goto
id|__ok1
suffix:semicolon
id|snd_cs4281_delay_long
c_func
(paren
id|can_schedule
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|timeout
op_decrement
OG
l_int|0
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;never read codec ready from AC&squot;97 (0x%x)&bslash;n&quot;
comma
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACSTS
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
id|__ok1
suffix:colon
r_if
c_cond
(paren
id|chip-&gt;dual_codec
)paren
(brace
id|timeout
op_assign
id|HZ
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACSTS2
)paren
op_amp
id|BA0_ACSTS_CRDY
)paren
r_goto
id|__codec2_ok
suffix:semicolon
id|snd_cs4281_delay_long
c_func
(paren
id|can_schedule
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|timeout
op_decrement
OG
l_int|0
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
id|KERN_INFO
l_string|&quot;secondary codec doesn&squot;t respond. disable it...&bslash;n&quot;
)paren
suffix:semicolon
id|chip-&gt;dual_codec
op_assign
l_int|0
suffix:semicolon
id|__codec2_ok
suffix:colon
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *  Assert the valid frame signal so that we can start sending commands&n;&t; *  to the AC97 codec.&n;&t; */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACCTL
comma
id|BA0_ACCTL_VFRM
op_or
id|BA0_ACCTL_ESYN
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Wait until we&squot;ve sampled input slots 3 and 4 as valid, meaning that&n;&t; *  the codec is pumping ADC data across the AC-link.&n;&t; */
id|timeout
op_assign
id|HZ
suffix:semicolon
r_do
(brace
multiline_comment|/*&n;&t;&t; *  Read the input slot valid register and see if input slots 3&n;&t;&t; *  4 are valid yet.&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_ACISV
)paren
op_amp
(paren
id|BA0_ACISV_SLV
c_func
(paren
l_int|3
)paren
op_or
id|BA0_ACISV_SLV
c_func
(paren
l_int|4
)paren
)paren
)paren
op_eq
(paren
id|BA0_ACISV_SLV
c_func
(paren
l_int|3
)paren
op_or
id|BA0_ACISV_SLV
c_func
(paren
l_int|4
)paren
)paren
)paren
r_goto
id|__ok2
suffix:semicolon
id|snd_cs4281_delay_long
c_func
(paren
id|can_schedule
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|timeout
op_decrement
OG
l_int|0
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;never read ISV3 and ISV4 from AC&squot;97&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
id|__ok2
suffix:colon
multiline_comment|/*&n;&t; *  Now, assert valid frame and the slot 3 and 4 valid bits.  This will&n;&t; *  commense the transfer of digital audio data to the AC97 codec.&n;&t; */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_ACOSV
comma
id|BA0_ACOSV_SLV
c_func
(paren
l_int|3
)paren
op_or
id|BA0_ACOSV_SLV
c_func
(paren
l_int|4
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Initialize DMA structures&n;&t; */
r_for
c_loop
(paren
id|tmp
op_assign
l_int|0
suffix:semicolon
id|tmp
OL
l_int|4
suffix:semicolon
id|tmp
op_increment
)paren
(brace
id|cs4281_dma_t
op_star
id|dma
op_assign
op_amp
id|chip-&gt;dma
(braket
id|tmp
)braket
suffix:semicolon
id|dma-&gt;regDBA
op_assign
id|BA0_DBA0
op_plus
(paren
id|tmp
op_star
l_int|0x10
)paren
suffix:semicolon
id|dma-&gt;regDCA
op_assign
id|BA0_DCA0
op_plus
(paren
id|tmp
op_star
l_int|0x10
)paren
suffix:semicolon
id|dma-&gt;regDBC
op_assign
id|BA0_DBC0
op_plus
(paren
id|tmp
op_star
l_int|0x10
)paren
suffix:semicolon
id|dma-&gt;regDCC
op_assign
id|BA0_DCC0
op_plus
(paren
id|tmp
op_star
l_int|0x10
)paren
suffix:semicolon
id|dma-&gt;regDMR
op_assign
id|BA0_DMR0
op_plus
(paren
id|tmp
op_star
l_int|8
)paren
suffix:semicolon
id|dma-&gt;regDCR
op_assign
id|BA0_DCR0
op_plus
(paren
id|tmp
op_star
l_int|8
)paren
suffix:semicolon
id|dma-&gt;regHDSR
op_assign
id|BA0_HDSR0
op_plus
(paren
id|tmp
op_star
l_int|4
)paren
suffix:semicolon
id|dma-&gt;regFCR
op_assign
id|BA0_FCR0
op_plus
(paren
id|tmp
op_star
l_int|4
)paren
suffix:semicolon
id|dma-&gt;regFSIC
op_assign
id|BA0_FSIC0
op_plus
(paren
id|tmp
op_star
l_int|4
)paren
suffix:semicolon
id|dma-&gt;fifo_offset
op_assign
id|tmp
op_star
id|CS4281_FIFO_SIZE
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|dma-&gt;regFCR
comma
id|BA0_FCR_LS
c_func
(paren
l_int|31
)paren
op_or
id|BA0_FCR_RS
c_func
(paren
l_int|31
)paren
op_or
id|BA0_FCR_SZ
c_func
(paren
id|CS4281_FIFO_SIZE
)paren
op_or
id|BA0_FCR_OF
c_func
(paren
id|dma-&gt;fifo_offset
)paren
)paren
suffix:semicolon
)brace
id|chip-&gt;src_left_play_slot
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* AC&squot;97 left PCM playback (3) */
id|chip-&gt;src_right_play_slot
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* AC&squot;97 right PCM playback (4) */
id|chip-&gt;src_left_rec_slot
op_assign
l_int|10
suffix:semicolon
multiline_comment|/* AC&squot;97 left PCM record (3) */
id|chip-&gt;src_right_rec_slot
op_assign
l_int|11
suffix:semicolon
multiline_comment|/* AC&squot;97 right PCM record (4) */
multiline_comment|/* Activate wave playback FIFO for FM playback */
id|chip-&gt;dma
(braket
l_int|0
)braket
dot
id|valFCR
op_assign
id|BA0_FCR_FEN
op_or
id|BA0_FCR_LS
c_func
(paren
l_int|0
)paren
op_or
id|BA0_FCR_RS
c_func
(paren
l_int|1
)paren
op_or
id|BA0_FCR_SZ
c_func
(paren
id|CS4281_FIFO_SIZE
)paren
op_or
id|BA0_FCR_OF
c_func
(paren
id|chip-&gt;dma
(braket
l_int|0
)braket
dot
id|fifo_offset
)paren
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|chip-&gt;dma
(braket
l_int|0
)braket
dot
id|regFCR
comma
id|chip-&gt;dma
(braket
l_int|0
)braket
dot
id|valFCR
)paren
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SRCSA
comma
(paren
id|chip-&gt;src_left_play_slot
op_lshift
l_int|0
)paren
op_or
(paren
id|chip-&gt;src_right_play_slot
op_lshift
l_int|8
)paren
op_or
(paren
id|chip-&gt;src_left_rec_slot
op_lshift
l_int|16
)paren
op_or
(paren
id|chip-&gt;src_right_rec_slot
op_lshift
l_int|24
)paren
)paren
suffix:semicolon
multiline_comment|/* Initialize digital volume */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_PPLVC
comma
l_int|0
)paren
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_PPRVC
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Enable IRQs */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_HICR
comma
id|BA0_HICR_EOI
)paren
suffix:semicolon
multiline_comment|/* Unmask interrupts */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_HIMR
comma
l_int|0x7fffffff
op_amp
op_complement
(paren
id|BA0_HISR_MIDI
op_or
id|BA0_HISR_DMAI
op_or
id|BA0_HISR_DMA
c_func
(paren
l_int|0
)paren
op_or
id|BA0_HISR_DMA
c_func
(paren
l_int|1
)paren
op_or
id|BA0_HISR_DMA
c_func
(paren
l_int|2
)paren
op_or
id|BA0_HISR_DMA
c_func
(paren
l_int|3
)paren
)paren
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
id|chip-&gt;irq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  MIDI section&n; */
DECL|function|snd_cs4281_midi_reset
r_static
r_void
id|snd_cs4281_midi_reset
c_func
(paren
id|cs4281_t
op_star
id|chip
)paren
(brace
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
op_or
id|BA0_MIDCR_MRST
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4281_midi_input_open
r_static
r_int
id|snd_cs4281_midi_input_open
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|cs4281_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|substream-&gt;rmidi-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|chip-&gt;midcr
op_or_assign
id|BA0_MIDCR_RXE
suffix:semicolon
id|chip-&gt;midi_input
op_assign
id|substream
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chip-&gt;uartm
op_amp
id|CS4281_MODE_OUTPUT
)paren
)paren
(brace
id|snd_cs4281_midi_reset
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4281_midi_input_close
r_static
r_int
id|snd_cs4281_midi_input_close
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|cs4281_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|substream-&gt;rmidi-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|chip-&gt;midcr
op_and_assign
op_complement
(paren
id|BA0_MIDCR_RXE
op_or
id|BA0_MIDCR_RIE
)paren
suffix:semicolon
id|chip-&gt;midi_input
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chip-&gt;uartm
op_amp
id|CS4281_MODE_OUTPUT
)paren
)paren
(brace
id|snd_cs4281_midi_reset
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
id|chip-&gt;uartm
op_and_assign
op_complement
id|CS4281_MODE_INPUT
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4281_midi_output_open
r_static
r_int
id|snd_cs4281_midi_output_open
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|cs4281_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|substream-&gt;rmidi-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|chip-&gt;uartm
op_or_assign
id|CS4281_MODE_OUTPUT
suffix:semicolon
id|chip-&gt;midcr
op_or_assign
id|BA0_MIDCR_TXE
suffix:semicolon
id|chip-&gt;midi_output
op_assign
id|substream
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chip-&gt;uartm
op_amp
id|CS4281_MODE_INPUT
)paren
)paren
(brace
id|snd_cs4281_midi_reset
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4281_midi_output_close
r_static
r_int
id|snd_cs4281_midi_output_close
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|cs4281_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|substream-&gt;rmidi-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|chip-&gt;midcr
op_and_assign
op_complement
(paren
id|BA0_MIDCR_TXE
op_or
id|BA0_MIDCR_TIE
)paren
suffix:semicolon
id|chip-&gt;midi_output
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chip-&gt;uartm
op_amp
id|CS4281_MODE_INPUT
)paren
)paren
(brace
id|snd_cs4281_midi_reset
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
id|chip-&gt;uartm
op_and_assign
op_complement
id|CS4281_MODE_OUTPUT
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4281_midi_input_trigger
r_static
r_void
id|snd_cs4281_midi_input_trigger
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
r_int
id|up
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|cs4281_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|substream-&gt;rmidi-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|up
)paren
(brace
r_if
c_cond
(paren
(paren
id|chip-&gt;midcr
op_amp
id|BA0_MIDCR_RIE
)paren
op_eq
l_int|0
)paren
(brace
id|chip-&gt;midcr
op_or_assign
id|BA0_MIDCR_RIE
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|chip-&gt;midcr
op_amp
id|BA0_MIDCR_RIE
)paren
(brace
id|chip-&gt;midcr
op_and_assign
op_complement
id|BA0_MIDCR_RIE
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4281_midi_output_trigger
r_static
r_void
id|snd_cs4281_midi_output_trigger
c_func
(paren
id|snd_rawmidi_substream_t
op_star
id|substream
comma
r_int
id|up
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|cs4281_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|substream-&gt;rmidi-&gt;private_data
comma
r_return
)paren
suffix:semicolon
r_int
r_char
id|byte
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|up
)paren
(brace
r_if
c_cond
(paren
(paren
id|chip-&gt;midcr
op_amp
id|BA0_MIDCR_TIE
)paren
op_eq
l_int|0
)paren
(brace
id|chip-&gt;midcr
op_or_assign
id|BA0_MIDCR_TIE
suffix:semicolon
multiline_comment|/* fill UART FIFO buffer at first, and turn Tx interrupts only if necessary */
r_while
c_loop
(paren
(paren
id|chip-&gt;midcr
op_amp
id|BA0_MIDCR_TIE
)paren
op_logical_and
(paren
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_MIDSR
)paren
op_amp
id|BA0_MIDSR_TBF
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|snd_rawmidi_transmit
c_func
(paren
id|substream
comma
op_amp
id|byte
comma
l_int|1
)paren
op_ne
l_int|1
)paren
(brace
id|chip-&gt;midcr
op_and_assign
op_complement
id|BA0_MIDCR_TIE
suffix:semicolon
)brace
r_else
(brace
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDWP
comma
id|byte
)paren
suffix:semicolon
)brace
)brace
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|chip-&gt;midcr
op_amp
id|BA0_MIDCR_TIE
)paren
(brace
id|chip-&gt;midcr
op_and_assign
op_complement
id|BA0_MIDCR_TIE
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|variable|snd_cs4281_midi_output
r_static
id|snd_rawmidi_ops_t
id|snd_cs4281_midi_output
op_assign
(brace
dot
id|open
op_assign
id|snd_cs4281_midi_output_open
comma
dot
id|close
op_assign
id|snd_cs4281_midi_output_close
comma
dot
id|trigger
op_assign
id|snd_cs4281_midi_output_trigger
comma
)brace
suffix:semicolon
DECL|variable|snd_cs4281_midi_input
r_static
id|snd_rawmidi_ops_t
id|snd_cs4281_midi_input
op_assign
(brace
dot
id|open
op_assign
id|snd_cs4281_midi_input_open
comma
dot
id|close
op_assign
id|snd_cs4281_midi_input_close
comma
dot
id|trigger
op_assign
id|snd_cs4281_midi_input_trigger
comma
)brace
suffix:semicolon
DECL|function|snd_cs4281_midi
r_static
r_int
id|__devinit
id|snd_cs4281_midi
c_func
(paren
id|cs4281_t
op_star
id|chip
comma
r_int
id|device
comma
id|snd_rawmidi_t
op_star
op_star
id|rrawmidi
)paren
(brace
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rrawmidi
)paren
op_star
id|rrawmidi
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_rawmidi_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;CS4281&quot;
comma
id|device
comma
l_int|1
comma
l_int|1
comma
op_amp
id|rmidi
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|strcpy
c_func
(paren
id|rmidi-&gt;name
comma
l_string|&quot;CS4281&quot;
)paren
suffix:semicolon
id|snd_rawmidi_set_ops
c_func
(paren
id|rmidi
comma
id|SNDRV_RAWMIDI_STREAM_OUTPUT
comma
op_amp
id|snd_cs4281_midi_output
)paren
suffix:semicolon
id|snd_rawmidi_set_ops
c_func
(paren
id|rmidi
comma
id|SNDRV_RAWMIDI_STREAM_INPUT
comma
op_amp
id|snd_cs4281_midi_input
)paren
suffix:semicolon
id|rmidi-&gt;info_flags
op_or_assign
id|SNDRV_RAWMIDI_INFO_OUTPUT
op_or
id|SNDRV_RAWMIDI_INFO_INPUT
op_or
id|SNDRV_RAWMIDI_INFO_DUPLEX
suffix:semicolon
id|rmidi-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|chip-&gt;rmidi
op_assign
id|rmidi
suffix:semicolon
r_if
c_cond
(paren
id|rrawmidi
)paren
op_star
id|rrawmidi
op_assign
id|rmidi
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Interrupt handler&n; */
DECL|function|snd_cs4281_interrupt
r_static
id|irqreturn_t
id|snd_cs4281_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|cs4281_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|dev_id
comma
r_return
)paren
suffix:semicolon
r_int
r_int
id|status
comma
id|dma
comma
id|val
suffix:semicolon
id|cs4281_dma_t
op_star
id|cdma
suffix:semicolon
r_if
c_cond
(paren
id|chip
op_eq
l_int|NULL
)paren
r_return
id|IRQ_NONE
suffix:semicolon
id|status
op_assign
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_HISR
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
l_int|0x7fffffff
)paren
op_eq
l_int|0
)paren
(brace
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_HICR
comma
id|BA0_HICR_EOI
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
(paren
id|BA0_HISR_DMA
c_func
(paren
l_int|0
)paren
op_or
id|BA0_HISR_DMA
c_func
(paren
l_int|1
)paren
op_or
id|BA0_HISR_DMA
c_func
(paren
l_int|2
)paren
op_or
id|BA0_HISR_DMA
c_func
(paren
l_int|3
)paren
)paren
)paren
(brace
r_for
c_loop
(paren
id|dma
op_assign
l_int|0
suffix:semicolon
id|dma
OL
l_int|4
suffix:semicolon
id|dma
op_increment
)paren
r_if
c_cond
(paren
id|status
op_amp
id|BA0_HISR_DMA
c_func
(paren
id|dma
)paren
)paren
(brace
id|cdma
op_assign
op_amp
id|chip-&gt;dma
(braket
id|dma
)braket
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
multiline_comment|/* ack DMA IRQ */
id|val
op_assign
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|cdma-&gt;regHDSR
)paren
suffix:semicolon
multiline_comment|/* workaround, sometimes CS4281 acknowledges */
multiline_comment|/* end or middle transfer position twice */
id|cdma-&gt;frag
op_increment
suffix:semicolon
r_if
c_cond
(paren
(paren
id|val
op_amp
id|BA0_HDSR_DHTC
)paren
op_logical_and
op_logical_neg
(paren
id|cdma-&gt;frag
op_amp
l_int|1
)paren
)paren
(brace
id|cdma-&gt;frag
op_decrement
suffix:semicolon
id|chip-&gt;spurious_dhtc_irq
op_increment
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|val
op_amp
id|BA0_HDSR_DTC
)paren
op_logical_and
(paren
id|cdma-&gt;frag
op_amp
l_int|1
)paren
)paren
(brace
id|cdma-&gt;frag
op_decrement
suffix:semicolon
id|chip-&gt;spurious_dtc_irq
op_increment
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|snd_pcm_period_elapsed
c_func
(paren
id|cdma-&gt;substream
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|status
op_amp
id|BA0_HISR_MIDI
)paren
op_logical_and
id|chip-&gt;rmidi
)paren
(brace
r_int
r_char
id|c
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_MIDSR
)paren
op_amp
id|BA0_MIDSR_RBE
)paren
op_eq
l_int|0
)paren
(brace
id|c
op_assign
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_MIDRP
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chip-&gt;midcr
op_amp
id|BA0_MIDCR_RIE
)paren
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
id|snd_rawmidi_receive
c_func
(paren
id|chip-&gt;midi_input
comma
op_amp
id|c
comma
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_MIDSR
)paren
op_amp
id|BA0_MIDSR_TBF
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|chip-&gt;midcr
op_amp
id|BA0_MIDCR_TIE
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|snd_rawmidi_transmit
c_func
(paren
id|chip-&gt;midi_output
comma
op_amp
id|c
comma
l_int|1
)paren
op_ne
l_int|1
)paren
(brace
id|chip-&gt;midcr
op_and_assign
op_complement
id|BA0_MIDCR_TIE
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDCR
comma
id|chip-&gt;midcr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_MIDWP
comma
id|c
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
)brace
multiline_comment|/* EOI to the PCI part... reenables interrupts */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_HICR
comma
id|BA0_HICR_EOI
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|snd_cs4281_probe
r_static
r_int
id|__devinit
id|snd_cs4281_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_const
r_struct
id|pci_device_id
op_star
id|pci_id
)paren
(brace
r_static
r_int
id|dev
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
id|cs4281_t
op_star
id|chip
suffix:semicolon
id|opl3_t
op_star
id|opl3
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_ge
id|SNDRV_CARDS
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|enable
(braket
id|dev
)braket
)paren
(brace
id|dev
op_increment
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|card
op_assign
id|snd_card_new
c_func
(paren
id|index
(braket
id|dev
)braket
comma
id|id
(braket
id|dev
)braket
comma
id|THIS_MODULE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_cs4281_create
c_func
(paren
id|card
comma
id|pci
comma
op_amp
id|chip
comma
id|dual_codec
(braket
id|dev
)braket
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_cs4281_mixer
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_cs4281_pcm
c_func
(paren
id|chip
comma
l_int|0
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_cs4281_midi
c_func
(paren
id|chip
comma
l_int|0
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_opl3_create
c_func
(paren
id|card
comma
(paren
id|chip-&gt;ba0
op_plus
id|BA0_B0AP
)paren
op_rshift
l_int|2
comma
(paren
id|chip-&gt;ba0
op_plus
id|BA0_B1AP
)paren
op_rshift
l_int|2
comma
id|OPL3_HW_OPL3_CS4281
comma
l_int|1
comma
op_amp
id|opl3
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_opl3_hwdep_new
c_func
(paren
id|opl3
comma
l_int|0
comma
l_int|1
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|snd_cs4281_gameport
c_func
(paren
id|chip
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;CS4281&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;shortname
comma
l_string|&quot;Cirrus Logic CS4281&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;%s at 0x%lx, irq %d&quot;
comma
id|card-&gt;shortname
comma
id|chip-&gt;ba0_addr
comma
id|chip-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_card_register
c_func
(paren
id|card
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pci
comma
id|chip
)paren
suffix:semicolon
id|dev
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4281_remove
r_static
r_void
id|__devexit
id|snd_cs4281_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
id|cs4281_t
op_star
id|chip
op_assign
id|pci_get_drvdata
c_func
(paren
id|pci
)paren
suffix:semicolon
id|snd_card_free
c_func
(paren
id|chip-&gt;card
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Power Management&n; */
macro_line|#ifdef CONFIG_PM
DECL|variable|saved_regs
r_static
r_int
id|saved_regs
(braket
id|SUSPEND_REGISTERS
)braket
op_assign
(brace
id|BA0_JSCTL
comma
id|BA0_GPIOR
comma
id|BA0_SSCR
comma
id|BA0_MIDCR
comma
id|BA0_SRCSA
comma
id|BA0_PASR
comma
id|BA0_CASR
comma
id|BA0_DACSR
comma
id|BA0_ADCSR
comma
id|BA0_FMLVC
comma
id|BA0_FMRVC
comma
id|BA0_PPLVC
comma
id|BA0_PPRVC
comma
)brace
suffix:semicolon
DECL|macro|number_of
mdefine_line|#define number_of(array)&t;(sizeof(array) / sizeof(array[0]))
DECL|macro|CLKCR1_CKRA
mdefine_line|#define CLKCR1_CKRA                             0x00010000L
DECL|function|cs4281_suspend
r_static
r_void
id|cs4281_suspend
c_func
(paren
id|cs4281_t
op_star
id|chip
)paren
(brace
id|snd_card_t
op_star
id|card
op_assign
id|chip-&gt;card
suffix:semicolon
id|u32
id|ulCLK
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;power_state
op_eq
id|SNDRV_CTL_POWER_D3hot
)paren
r_return
suffix:semicolon
id|snd_pcm_suspend_all
c_func
(paren
id|chip-&gt;pcm
)paren
suffix:semicolon
id|ulCLK
op_assign
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
)paren
suffix:semicolon
id|ulCLK
op_or_assign
id|CLKCR1_CKRA
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
id|ulCLK
)paren
suffix:semicolon
multiline_comment|/* Disable interrupts. */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_HICR
comma
id|BA0_HICR_CHGM
)paren
suffix:semicolon
multiline_comment|/* remember the status registers */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|number_of
c_func
(paren
id|saved_regs
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|saved_regs
(braket
id|i
)braket
)paren
id|chip-&gt;suspend_regs
(braket
id|i
)braket
op_assign
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|saved_regs
(braket
id|i
)braket
)paren
suffix:semicolon
multiline_comment|/* Turn off the serial ports. */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SERMC
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Power off FM, Joystick, AC link, */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SSPM
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* DLL off. */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* AC link off. */
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_SPMC
comma
l_int|0
)paren
suffix:semicolon
id|ulCLK
op_assign
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
)paren
suffix:semicolon
id|ulCLK
op_and_assign
op_complement
id|CLKCR1_CKRA
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
id|ulCLK
)paren
suffix:semicolon
id|snd_power_change_state
c_func
(paren
id|card
comma
id|SNDRV_CTL_POWER_D3hot
)paren
suffix:semicolon
)brace
DECL|function|cs4281_resume
r_static
r_void
id|cs4281_resume
c_func
(paren
id|cs4281_t
op_star
id|chip
)paren
(brace
id|snd_card_t
op_star
id|card
op_assign
id|chip-&gt;card
suffix:semicolon
r_int
r_int
id|i
suffix:semicolon
id|u32
id|ulCLK
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;power_state
op_eq
id|SNDRV_CTL_POWER_D0
)paren
r_return
suffix:semicolon
id|pci_enable_device
c_func
(paren
id|chip-&gt;pci
)paren
suffix:semicolon
id|ulCLK
op_assign
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
)paren
suffix:semicolon
id|ulCLK
op_or_assign
id|CLKCR1_CKRA
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
id|ulCLK
)paren
suffix:semicolon
id|snd_cs4281_chip_init
c_func
(paren
id|chip
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* restore the status registers */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|number_of
c_func
(paren
id|saved_regs
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|saved_regs
(braket
id|i
)braket
)paren
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|saved_regs
(braket
id|i
)braket
comma
id|chip-&gt;suspend_regs
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;ac97
)paren
id|snd_ac97_resume
c_func
(paren
id|chip-&gt;ac97
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;ac97_secondary
)paren
id|snd_ac97_resume
c_func
(paren
id|chip-&gt;ac97_secondary
)paren
suffix:semicolon
id|ulCLK
op_assign
id|snd_cs4281_peekBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
)paren
suffix:semicolon
id|ulCLK
op_and_assign
op_complement
id|CLKCR1_CKRA
suffix:semicolon
id|snd_cs4281_pokeBA0
c_func
(paren
id|chip
comma
id|BA0_CLKCR1
comma
id|ulCLK
)paren
suffix:semicolon
id|snd_power_change_state
c_func
(paren
id|card
comma
id|SNDRV_CTL_POWER_D0
)paren
suffix:semicolon
)brace
macro_line|#ifndef PCI_OLD_SUSPEND
DECL|function|snd_cs4281_suspend
r_static
r_int
id|snd_cs4281_suspend
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
id|u32
id|state
)paren
(brace
id|cs4281_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|cs4281_suspend
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4281_resume
r_static
r_int
id|snd_cs4281_resume
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
id|cs4281_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|cs4281_resume
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#else
DECL|function|snd_cs4281_suspend
r_static
r_void
id|snd_cs4281_suspend
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
id|cs4281_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
comma
r_return
)paren
suffix:semicolon
id|cs4281_suspend
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4281_resume
r_static
r_void
id|snd_cs4281_resume
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
id|cs4281_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|pci_get_drvdata
c_func
(paren
id|dev
)paren
comma
r_return
)paren
suffix:semicolon
id|cs4281_resume
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* callback */
DECL|function|snd_cs4281_set_power_state
r_static
r_int
id|snd_cs4281_set_power_state
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_int
r_int
id|power_state
)paren
(brace
id|cs4281_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|cs4281_t
comma
id|card-&gt;power_state_private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|power_state
)paren
(brace
r_case
id|SNDRV_CTL_POWER_D0
suffix:colon
r_case
id|SNDRV_CTL_POWER_D1
suffix:colon
r_case
id|SNDRV_CTL_POWER_D2
suffix:colon
id|cs4281_resume
c_func
(paren
id|chip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_CTL_POWER_D3hot
suffix:colon
r_case
id|SNDRV_CTL_POWER_D3cold
suffix:colon
id|cs4281_suspend
c_func
(paren
id|chip
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PM */
DECL|variable|driver
r_static
r_struct
id|pci_driver
id|driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;CS4281&quot;
comma
dot
id|id_table
op_assign
id|snd_cs4281_ids
comma
dot
id|probe
op_assign
id|snd_cs4281_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|snd_cs4281_remove
)paren
comma
macro_line|#ifdef CONFIG_PM
dot
id|suspend
op_assign
id|snd_cs4281_suspend
comma
dot
id|resume
op_assign
id|snd_cs4281_resume
comma
macro_line|#endif
)brace
suffix:semicolon
DECL|function|alsa_card_cs4281_init
r_static
r_int
id|__init
id|alsa_card_cs4281_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_module_init
c_func
(paren
op_amp
id|driver
)paren
)paren
OL
l_int|0
)paren
(brace
macro_line|#ifdef MODULE
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;CS4281 soundcard not found or device busy&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|alsa_card_cs4281_exit
r_static
r_void
id|__exit
id|alsa_card_cs4281_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|alsa_card_cs4281_init
)paren
id|module_exit
c_func
(paren
id|alsa_card_cs4281_exit
)paren
macro_line|#ifndef MODULE
multiline_comment|/* format is: snd-cs4281=enable,index,id */
DECL|function|alsa_card_cs4281_setup
r_static
r_int
id|__init
id|alsa_card_cs4281_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_static
r_int
id|__initdata
id|nr_dev
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|nr_dev
op_ge
id|SNDRV_CARDS
)paren
r_return
l_int|0
suffix:semicolon
(paren
r_void
)paren
(paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|enable
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|index
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_id
c_func
(paren
op_amp
id|str
comma
op_amp
id|id
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
)paren
suffix:semicolon
id|nr_dev
op_increment
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;snd-cs4281=&quot;
comma
id|alsa_card_cs4281_setup
)paren
suffix:semicolon
macro_line|#endif /* ifndef MODULE */
eof
