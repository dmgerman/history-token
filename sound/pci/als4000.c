multiline_comment|/*&n; *  card-als4000.c - driver for Avance Logic ALS4000 based soundcards.&n; *  Copyright (C) 2000 by Bart Hartgers &lt;bart@etpmod.phys.tue.nl&gt;,&n; *&t;&t;&t;  Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *  Copyright (C) 2002 by Andreas Mohr &lt;hw7oshyuv3001@sneakemail.com&gt;&n; *&n; *  Framework borrowed from Massimo Piccioni&squot;s card-als100.c.&n; *&n; * NOTES&n; *&n; *  Since Avance does not provide any meaningful documentation, and I&n; *  bought an ALS4000 based soundcard, I was forced to base this driver&n; *  on reverse engineering.&n; *&n; *  Note: this is no longer true. Pretty verbose chip docu (ALS4000a.PDF)&n; *  can be found on the ALSA web site.&n; *&n; *  The ALS4000 seems to be the PCI-cousin of the ALS100. It contains an&n; *  ALS100-like SB DSP/mixer, an OPL3 synth, a MPU401 and a gameport &n; *  interface. These subsystems can be mapped into ISA io-port space, &n; *  using the PCI-interface. In addition, the PCI-bit provides DMA and IRQ &n; *  services to the subsystems.&n; * &n; * While ALS4000 is very similar to a SoundBlaster, the differences in&n; * DMA and capturing require more changes to the SoundBlaster than&n; * desirable, so I made this separate driver.&n; * &n; * The ALS4000 can do real full duplex playback/capture.&n; *&n; * FMDAC:&n; * - 0x4f -&gt; port 0x14&n; * - port 0x15 |= 1&n; *&n; * Enable/disable 3D sound:&n; * - 0x50 -&gt; port 0x14&n; * - change bit 6 (0x40) of port 0x15&n; *&n; * Set QSound:&n; * - 0xdb -&gt; port 0x14&n; * - set port 0x15:&n; *   0x3e (mode 3), 0x3c (mode 2), 0x3a (mode 1), 0x38 (mode 0)&n; *&n; * Set KSound:&n; * - value -&gt; some port 0x0c0d&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or&n; *  (at your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n;&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/gameport.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
macro_line|#include &lt;sound/rawmidi.h&gt;
macro_line|#include &lt;sound/mpu401.h&gt;
macro_line|#include &lt;sound/opl3.h&gt;
macro_line|#include &lt;sound/sb.h&gt;
DECL|macro|SNDRV_GET_ID
mdefine_line|#define SNDRV_GET_ID
macro_line|#include &lt;sound/initval.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Bart Hartgers &lt;bart@etpmod.phys.tue.nl&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Avance Logic ALS4000&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_CLASSES
c_func
(paren
l_string|&quot;{sound}&quot;
)paren
suffix:semicolon
id|MODULE_DEVICES
c_func
(paren
l_string|&quot;{{Avance Logic,ALS4000}}&quot;
)paren
suffix:semicolon
macro_line|#if defined(CONFIG_GAMEPORT) || (defined(MODULE) &amp;&amp; defined(CONFIG_GAMEPORT_MODULE))
DECL|macro|SUPPORT_JOYSTICK
mdefine_line|#define SUPPORT_JOYSTICK 1
macro_line|#endif
DECL|variable|index
r_static
r_int
id|index
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_IDX
suffix:semicolon
multiline_comment|/* Index 0-MAX */
DECL|variable|id
r_static
r_char
op_star
id|id
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_STR
suffix:semicolon
multiline_comment|/* ID for this card */
DECL|variable|enable
r_static
r_int
id|enable
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_ENABLE_PNP
suffix:semicolon
multiline_comment|/* Enable this card */
macro_line|#ifdef SUPPORT_JOYSTICK
DECL|variable|joystick_port
r_static
r_int
id|joystick_port
(braket
id|SNDRV_CARDS
)braket
suffix:semicolon
macro_line|#endif
id|MODULE_PARM
c_func
(paren
id|index
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|index
comma
l_string|&quot;Index value for ALS4000 soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|index
comma
id|SNDRV_INDEX_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|id
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|id
comma
l_string|&quot;ID string for ALS4000 soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|id
comma
id|SNDRV_ID_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|enable
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|enable
comma
l_string|&quot;Enable ALS4000 soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|enable
comma
id|SNDRV_INDEX_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|joystick_port
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|joystick_port
comma
l_string|&quot;Joystick port address for ALS4000 soundcard. (0 = disabled)&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|joystick_port
comma
id|SNDRV_ENABLED
)paren
suffix:semicolon
DECL|macro|chip_t
mdefine_line|#define chip_t sb_t
r_typedef
r_struct
(brace
DECL|member|gcr
r_int
r_int
id|gcr
suffix:semicolon
DECL|member|res_gcr
r_struct
id|resource
op_star
id|res_gcr
suffix:semicolon
macro_line|#ifdef SUPPORT_JOYSTICK
DECL|member|gameport
r_struct
id|gameport
id|gameport
suffix:semicolon
DECL|member|res_joystick
r_struct
id|resource
op_star
id|res_joystick
suffix:semicolon
macro_line|#endif
DECL|typedef|snd_card_als4000_t
)brace
id|snd_card_als4000_t
suffix:semicolon
DECL|variable|snd_als4000_ids
r_static
r_struct
id|pci_device_id
id|snd_als4000_ids
(braket
)braket
op_assign
(brace
(brace
l_int|0x4005
comma
l_int|0x4000
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
)brace
comma
multiline_comment|/* ALS4000 */
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|snd_als4000_ids
)paren
suffix:semicolon
DECL|function|snd_als4000_gcr_write_addr
r_static
r_inline
r_void
id|snd_als4000_gcr_write_addr
c_func
(paren
r_int
r_int
id|port
comma
id|u32
id|reg
comma
id|u32
id|val
)paren
(brace
id|outb
c_func
(paren
id|reg
comma
id|port
op_plus
l_int|0x0c
)paren
suffix:semicolon
id|outl
c_func
(paren
id|val
comma
id|port
op_plus
l_int|0x08
)paren
suffix:semicolon
)brace
DECL|function|snd_als4000_gcr_write
r_static
r_inline
r_void
id|snd_als4000_gcr_write
c_func
(paren
id|sb_t
op_star
id|sb
comma
id|u32
id|reg
comma
id|u32
id|val
)paren
(brace
id|snd_als4000_gcr_write_addr
c_func
(paren
id|sb-&gt;alt_port
comma
id|reg
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|snd_als4000_gcr_read_addr
r_static
r_inline
id|u32
id|snd_als4000_gcr_read_addr
c_func
(paren
r_int
r_int
id|port
comma
id|u32
id|reg
)paren
(brace
id|outb
c_func
(paren
id|reg
comma
id|port
op_plus
l_int|0x0c
)paren
suffix:semicolon
r_return
id|inl
c_func
(paren
id|port
op_plus
l_int|0x08
)paren
suffix:semicolon
)brace
DECL|function|snd_als4000_gcr_read
r_static
r_inline
id|u32
id|snd_als4000_gcr_read
c_func
(paren
id|sb_t
op_star
id|sb
comma
id|u32
id|reg
)paren
(brace
r_return
id|snd_als4000_gcr_read_addr
c_func
(paren
id|sb-&gt;alt_port
comma
id|reg
)paren
suffix:semicolon
)brace
DECL|function|snd_als4000_set_rate
r_static
r_void
id|snd_als4000_set_rate
c_func
(paren
id|sb_t
op_star
id|chip
comma
r_int
r_int
id|rate
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|chip-&gt;mode
op_amp
id|SB_RATE_LOCK
)paren
)paren
(brace
id|snd_sbdsp_command
c_func
(paren
id|chip
comma
id|SB_DSP_SAMPLE_RATE_OUT
)paren
suffix:semicolon
id|snd_sbdsp_command
c_func
(paren
id|chip
comma
id|rate
op_rshift
l_int|8
)paren
suffix:semicolon
id|snd_sbdsp_command
c_func
(paren
id|chip
comma
id|rate
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_als4000_set_capture_dma
r_static
r_void
id|snd_als4000_set_capture_dma
c_func
(paren
id|sb_t
op_star
id|chip
comma
id|dma_addr_t
id|addr
comma
r_int
id|size
)paren
(brace
id|snd_als4000_gcr_write
c_func
(paren
id|chip
comma
l_int|0xa2
comma
id|addr
)paren
suffix:semicolon
id|snd_als4000_gcr_write
c_func
(paren
id|chip
comma
l_int|0xa3
comma
(paren
id|size
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_als4000_set_playback_dma
r_static
r_void
id|snd_als4000_set_playback_dma
c_func
(paren
id|sb_t
op_star
id|chip
comma
id|dma_addr_t
id|addr
comma
r_int
id|size
)paren
(brace
id|snd_als4000_gcr_write
c_func
(paren
id|chip
comma
l_int|0x91
comma
id|addr
)paren
suffix:semicolon
id|snd_als4000_gcr_write
c_func
(paren
id|chip
comma
l_int|0x92
comma
(paren
id|size
op_minus
l_int|1
)paren
op_or
l_int|0x180000
)paren
suffix:semicolon
)brace
DECL|macro|ALS4000_FORMAT_SIGNED
mdefine_line|#define ALS4000_FORMAT_SIGNED&t;(1&lt;&lt;0)
DECL|macro|ALS4000_FORMAT_16BIT
mdefine_line|#define ALS4000_FORMAT_16BIT&t;(1&lt;&lt;1)
DECL|macro|ALS4000_FORMAT_STEREO
mdefine_line|#define ALS4000_FORMAT_STEREO&t;(1&lt;&lt;2)
DECL|function|snd_als4000_get_format
r_static
r_int
id|snd_als4000_get_format
c_func
(paren
id|snd_pcm_runtime_t
op_star
id|runtime
)paren
(brace
r_int
id|result
suffix:semicolon
id|result
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_signed
c_func
(paren
id|runtime-&gt;format
)paren
)paren
id|result
op_or_assign
id|ALS4000_FORMAT_SIGNED
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_physical_width
c_func
(paren
id|runtime-&gt;format
)paren
op_eq
l_int|16
)paren
id|result
op_or_assign
id|ALS4000_FORMAT_16BIT
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;channels
OG
l_int|1
)paren
id|result
op_or_assign
id|ALS4000_FORMAT_STEREO
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/* structure for setting up playback */
r_static
r_struct
(brace
DECL|member|dsp_cmd
DECL|member|dma_on
DECL|member|dma_off
DECL|member|format
r_int
r_char
id|dsp_cmd
comma
id|dma_on
comma
id|dma_off
comma
id|format
suffix:semicolon
DECL|variable|playback_cmd_vals
)brace
id|playback_cmd_vals
(braket
)braket
op_assign
initialization_block
suffix:semicolon
DECL|macro|playback_cmd
mdefine_line|#define playback_cmd(chip) (playback_cmd_vals[(chip)-&gt;playback_format])
multiline_comment|/* structure for setting up capture */
DECL|enumerator|CMD_WIDTH8
DECL|enumerator|CMD_SIGNED
DECL|enumerator|CMD_MONO
DECL|enumerator|CMD_STEREO
r_enum
(brace
id|CMD_WIDTH8
op_assign
l_int|0x04
comma
id|CMD_SIGNED
op_assign
l_int|0x10
comma
id|CMD_MONO
op_assign
l_int|0x80
comma
id|CMD_STEREO
op_assign
l_int|0xA0
)brace
suffix:semicolon
DECL|variable|capture_cmd_vals
r_static
r_int
r_char
id|capture_cmd_vals
(braket
)braket
op_assign
(brace
id|CMD_WIDTH8
op_or
id|CMD_MONO
comma
multiline_comment|/* ALS4000_FORMAT_U8_MONO */
id|CMD_WIDTH8
op_or
id|CMD_SIGNED
op_or
id|CMD_MONO
comma
multiline_comment|/* ALS4000_FORMAT_S8_MONO */
id|CMD_MONO
comma
multiline_comment|/* ALS4000_FORMAT_U16L_MONO */
id|CMD_SIGNED
op_or
id|CMD_MONO
comma
multiline_comment|/* ALS4000_FORMAT_S16L_MONO */
id|CMD_WIDTH8
op_or
id|CMD_STEREO
comma
multiline_comment|/* ALS4000_FORMAT_U8_STEREO */
id|CMD_WIDTH8
op_or
id|CMD_SIGNED
op_or
id|CMD_STEREO
comma
multiline_comment|/* ALS4000_FORMAT_S8_STEREO */
id|CMD_STEREO
comma
multiline_comment|/* ALS4000_FORMAT_U16L_STEREO */
id|CMD_SIGNED
op_or
id|CMD_STEREO
comma
multiline_comment|/* ALS4000_FORMAT_S16L_STEREO */
)brace
suffix:semicolon
DECL|macro|capture_cmd
mdefine_line|#define capture_cmd(chip) (capture_cmd_vals[(chip)-&gt;capture_format])
DECL|function|snd_als4000_hw_params
r_static
r_int
id|snd_als4000_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
r_return
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_als4000_hw_free
r_static
r_int
id|snd_als4000_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_als4000_capture_prepare
r_static
r_int
id|snd_als4000_capture_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|sb_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
r_int
id|size
suffix:semicolon
r_int
id|count
suffix:semicolon
id|chip-&gt;capture_format
op_assign
id|snd_als4000_get_format
c_func
(paren
id|runtime
)paren
suffix:semicolon
id|size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|count
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;capture_format
op_amp
id|ALS4000_FORMAT_16BIT
)paren
id|count
op_rshift_assign
l_int|1
suffix:semicolon
id|count
op_decrement
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_als4000_set_rate
c_func
(paren
id|chip
comma
id|runtime-&gt;rate
)paren
suffix:semicolon
id|snd_als4000_set_capture_dma
c_func
(paren
id|chip
comma
id|runtime-&gt;dma_addr
comma
id|size
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_sbmixer_write
c_func
(paren
id|chip
comma
l_int|0xdc
comma
id|count
)paren
suffix:semicolon
id|snd_sbmixer_write
c_func
(paren
id|chip
comma
l_int|0xdd
comma
id|count
op_rshift
l_int|8
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_als4000_playback_prepare
r_static
r_int
id|snd_als4000_playback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|sb_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
r_int
id|size
suffix:semicolon
r_int
id|count
suffix:semicolon
id|chip-&gt;playback_format
op_assign
id|snd_als4000_get_format
c_func
(paren
id|runtime
)paren
suffix:semicolon
id|size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|count
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;playback_format
op_amp
id|ALS4000_FORMAT_16BIT
)paren
id|count
op_rshift_assign
l_int|1
suffix:semicolon
id|count
op_decrement
suffix:semicolon
multiline_comment|/* FIXME: from second playback on, there&squot;s a lot more clicks and pops&n;&t; * involved here than on first playback. Fiddling with&n;&t; * tons of different settings didn&squot;t help (DMA, speaker on/off,&n;&t; * reordering, ...). Something seems to get enabled on playback&n;&t; * that I haven&squot;t found out how to disable again, which then causes&n;&t; * the switching pops to reach the speakers the next time here. */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_als4000_set_rate
c_func
(paren
id|chip
comma
id|runtime-&gt;rate
)paren
suffix:semicolon
id|snd_als4000_set_playback_dma
c_func
(paren
id|chip
comma
id|runtime-&gt;dma_addr
comma
id|size
)paren
suffix:semicolon
multiline_comment|/* SPEAKER_ON not needed, since dma_on seems to also enable speaker */
multiline_comment|/* snd_sbdsp_command(chip, SB_DSP_SPEAKER_ON); */
id|snd_sbdsp_command
c_func
(paren
id|chip
comma
id|playback_cmd
c_func
(paren
id|chip
)paren
dot
id|dsp_cmd
)paren
suffix:semicolon
id|snd_sbdsp_command
c_func
(paren
id|chip
comma
id|playback_cmd
c_func
(paren
id|chip
)paren
dot
id|format
)paren
suffix:semicolon
id|snd_sbdsp_command
c_func
(paren
id|chip
comma
id|count
)paren
suffix:semicolon
id|snd_sbdsp_command
c_func
(paren
id|chip
comma
id|count
op_rshift
l_int|8
)paren
suffix:semicolon
id|snd_sbdsp_command
c_func
(paren
id|chip
comma
id|playback_cmd
c_func
(paren
id|chip
)paren
dot
id|dma_off
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_als4000_capture_trigger
r_static
r_int
id|snd_als4000_capture_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|sb_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_START
)paren
(brace
id|chip-&gt;mode
op_or_assign
id|SB_RATE_LOCK_CAPTURE
suffix:semicolon
id|snd_sbmixer_write
c_func
(paren
id|chip
comma
l_int|0xde
comma
id|capture_cmd
c_func
(paren
id|chip
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_STOP
)paren
(brace
id|chip-&gt;mode
op_and_assign
op_complement
id|SB_RATE_LOCK_CAPTURE
suffix:semicolon
id|snd_sbmixer_write
c_func
(paren
id|chip
comma
l_int|0xde
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_als4000_playback_trigger
r_static
r_int
id|snd_als4000_playback_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|sb_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_START
)paren
(brace
id|chip-&gt;mode
op_or_assign
id|SB_RATE_LOCK_PLAYBACK
suffix:semicolon
id|snd_sbdsp_command
c_func
(paren
id|chip
comma
id|playback_cmd
c_func
(paren
id|chip
)paren
dot
id|dma_on
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_STOP
)paren
(brace
id|snd_sbdsp_command
c_func
(paren
id|chip
comma
id|playback_cmd
c_func
(paren
id|chip
)paren
dot
id|dma_off
)paren
suffix:semicolon
id|chip-&gt;mode
op_and_assign
op_complement
id|SB_RATE_LOCK_PLAYBACK
suffix:semicolon
)brace
r_else
(brace
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_als4000_capture_pointer
r_static
id|snd_pcm_uframes_t
id|snd_als4000_capture_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|sb_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|result
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|result
op_assign
id|snd_als4000_gcr_read
c_func
(paren
id|chip
comma
l_int|0xa4
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|result
)paren
suffix:semicolon
)brace
DECL|function|snd_als4000_playback_pointer
r_static
id|snd_pcm_uframes_t
id|snd_als4000_playback_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|sb_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|result
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|result
op_assign
id|snd_als4000_gcr_read
c_func
(paren
id|chip
comma
l_int|0xa0
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|result
)paren
suffix:semicolon
)brace
DECL|function|snd_als4000_interrupt
r_static
id|irqreturn_t
id|snd_als4000_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|sb_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|sb_t
comma
id|dev_id
comma
r_return
id|IRQ_NONE
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|gcr_status
suffix:semicolon
r_int
id|sb_status
suffix:semicolon
multiline_comment|/* find out which bit of the ALS4000 produced the interrupt */
id|gcr_status
op_assign
id|inb
c_func
(paren
id|chip-&gt;alt_port
op_plus
l_int|0xe
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|gcr_status
op_amp
l_int|0x80
)paren
op_logical_and
(paren
id|chip-&gt;playback_substream
)paren
)paren
multiline_comment|/* playback */
id|snd_pcm_period_elapsed
c_func
(paren
id|chip-&gt;playback_substream
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|gcr_status
op_amp
l_int|0x40
)paren
op_logical_and
(paren
id|chip-&gt;capture_substream
)paren
)paren
multiline_comment|/* capturing */
id|snd_pcm_period_elapsed
c_func
(paren
id|chip-&gt;capture_substream
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|gcr_status
op_amp
l_int|0x10
)paren
op_logical_and
(paren
id|chip-&gt;rmidi
)paren
)paren
multiline_comment|/* MPU401 interrupt */
id|snd_mpu401_uart_interrupt
c_func
(paren
id|irq
comma
id|chip-&gt;rmidi
comma
id|regs
)paren
suffix:semicolon
multiline_comment|/* release the gcr */
id|outb
c_func
(paren
id|gcr_status
comma
id|chip-&gt;alt_port
op_plus
l_int|0xe
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
id|sb_status
op_assign
id|snd_sbmixer_read
c_func
(paren
id|chip
comma
id|SB_DSP4_IRQSTATUS
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_status
op_amp
id|SB_IRQTYPE_8BIT
)paren
id|snd_sb_ack_8bit
c_func
(paren
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_status
op_amp
id|SB_IRQTYPE_16BIT
)paren
id|snd_sb_ack_16bit
c_func
(paren
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_status
op_amp
id|SB_IRQTYPE_MPUIN
)paren
id|inb
c_func
(paren
id|chip-&gt;mpu_port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb_status
op_amp
l_int|0x20
)paren
id|inb
c_func
(paren
id|SBP
c_func
(paren
id|chip
comma
id|RESET
)paren
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
multiline_comment|/*****************************************************************/
DECL|variable|snd_als4000_playback
r_static
id|snd_pcm_hardware_t
id|snd_als4000_playback
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_S8
op_or
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
op_or
id|SNDRV_PCM_FMTBIT_U16_LE
comma
multiline_comment|/* formats */
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
dot
id|rate_min
op_assign
l_int|4000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
l_int|65536
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
l_int|65536
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|1024
comma
dot
id|fifo_size
op_assign
l_int|0
)brace
suffix:semicolon
DECL|variable|snd_als4000_capture
r_static
id|snd_pcm_hardware_t
id|snd_als4000_capture
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_S8
op_or
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
op_or
id|SNDRV_PCM_FMTBIT_U16_LE
comma
multiline_comment|/* formats */
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_CONTINUOUS
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
dot
id|rate_min
op_assign
l_int|4000
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
l_int|65536
comma
dot
id|period_bytes_min
op_assign
l_int|64
comma
dot
id|period_bytes_max
op_assign
l_int|65536
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|1024
comma
dot
id|fifo_size
op_assign
l_int|0
)brace
suffix:semicolon
multiline_comment|/*****************************************************************/
DECL|function|snd_als4000_playback_open
r_static
r_int
id|snd_als4000_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|sb_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|chip-&gt;playback_substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_als4000_playback
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_als4000_playback_close
r_static
r_int
id|snd_als4000_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|sb_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;playback_substream
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_als4000_capture_open
r_static
r_int
id|snd_als4000_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|sb_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|chip-&gt;capture_substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_als4000_capture
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_als4000_capture_close
r_static
r_int
id|snd_als4000_capture_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|sb_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;capture_substream
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/******************************************************************/
DECL|variable|snd_als4000_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_als4000_playback_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_als4000_playback_open
comma
dot
id|close
op_assign
id|snd_als4000_playback_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_als4000_hw_params
comma
dot
id|hw_free
op_assign
id|snd_als4000_hw_free
comma
dot
id|prepare
op_assign
id|snd_als4000_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_als4000_playback_trigger
comma
dot
id|pointer
op_assign
id|snd_als4000_playback_pointer
)brace
suffix:semicolon
DECL|variable|snd_als4000_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_als4000_capture_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_als4000_capture_open
comma
dot
id|close
op_assign
id|snd_als4000_capture_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_als4000_hw_params
comma
dot
id|hw_free
op_assign
id|snd_als4000_hw_free
comma
dot
id|prepare
op_assign
id|snd_als4000_capture_prepare
comma
dot
id|trigger
op_assign
id|snd_als4000_capture_trigger
comma
dot
id|pointer
op_assign
id|snd_als4000_capture_pointer
)brace
suffix:semicolon
DECL|function|snd_als4000_pcm_free
r_static
r_void
id|snd_als4000_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|sb_t
op_star
id|chip
op_assign
id|snd_magic_cast
c_func
(paren
id|sb_t
comma
id|pcm-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|chip-&gt;pcm
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_als4000_pcm
r_static
r_int
id|__devinit
id|snd_als4000_pcm
c_func
(paren
id|sb_t
op_star
id|chip
comma
r_int
id|device
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;ALS4000 DSP&quot;
comma
id|device
comma
l_int|1
comma
l_int|1
comma
op_amp
id|pcm
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_als4000_pcm_free
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
id|SNDRV_PCM_INFO_JOINT_DUPLEX
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_als4000_playback_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_als4000_capture_ops
)paren
suffix:semicolon
id|snd_pcm_lib_preallocate_pci_pages_for_all
c_func
(paren
id|chip-&gt;pci
comma
id|pcm
comma
l_int|64
op_star
l_int|1024
comma
l_int|64
op_star
l_int|1024
)paren
suffix:semicolon
id|chip-&gt;pcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/******************************************************************/
DECL|function|snd_als4000_set_addr
r_static
r_void
id|snd_als4000_set_addr
c_func
(paren
r_int
r_int
id|gcr
comma
r_int
r_int
id|sb
comma
r_int
r_int
id|mpu
comma
r_int
r_int
id|opl
comma
r_int
r_int
id|game
)paren
(brace
id|u32
id|confA
op_assign
l_int|0
suffix:semicolon
id|u32
id|confB
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|mpu
OG
l_int|0
)paren
id|confB
op_or_assign
(paren
id|mpu
op_or
l_int|1
)paren
op_lshift
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|sb
OG
l_int|0
)paren
id|confB
op_or_assign
(paren
id|sb
op_or
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|game
OG
l_int|0
)paren
id|confA
op_or_assign
(paren
id|game
op_or
l_int|1
)paren
op_lshift
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|opl
OG
l_int|0
)paren
id|confA
op_or_assign
(paren
id|opl
op_or
l_int|1
)paren
suffix:semicolon
id|snd_als4000_gcr_write_addr
c_func
(paren
id|gcr
comma
l_int|0xa8
comma
id|confA
)paren
suffix:semicolon
id|snd_als4000_gcr_write_addr
c_func
(paren
id|gcr
comma
l_int|0xa9
comma
id|confB
)paren
suffix:semicolon
)brace
DECL|function|snd_als4000_configure
r_static
r_void
id|__devinit
id|snd_als4000_configure
c_func
(paren
id|sb_t
op_star
id|chip
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|tmp
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* do some more configuration */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
id|tmp
op_assign
id|snd_sbmixer_read
c_func
(paren
id|chip
comma
l_int|0xc0
)paren
suffix:semicolon
id|snd_sbmixer_write
c_func
(paren
id|chip
comma
l_int|0xc0
comma
id|tmp
op_or
l_int|0x80
)paren
suffix:semicolon
multiline_comment|/* always select DMA channel 0, since we do not actually use DMA */
id|snd_sbmixer_write
c_func
(paren
id|chip
comma
id|SB_DSP4_DMASETUP
comma
id|SB_DMASETUP_DMA0
)paren
suffix:semicolon
id|snd_sbmixer_write
c_func
(paren
id|chip
comma
l_int|0xc0
comma
id|tmp
op_amp
l_int|0x7f
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;mixer_lock
comma
id|flags
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* magic number. Enables interrupts(?) */
id|snd_als4000_gcr_write
c_func
(paren
id|chip
comma
l_int|0x8c
comma
l_int|0x28000
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0x91
suffix:semicolon
id|i
op_le
l_int|0x96
suffix:semicolon
op_increment
id|i
)paren
(brace
id|snd_als4000_gcr_write
c_func
(paren
id|chip
comma
id|i
comma
l_int|0
)paren
suffix:semicolon
)brace
id|snd_als4000_gcr_write
c_func
(paren
id|chip
comma
l_int|0x99
comma
id|snd_als4000_gcr_read
c_func
(paren
id|chip
comma
l_int|0x99
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_card_als4000_free
r_static
r_void
id|snd_card_als4000_free
c_func
(paren
id|snd_card_t
op_star
id|card
)paren
(brace
id|snd_card_als4000_t
op_star
id|acard
op_assign
(paren
id|snd_card_als4000_t
op_star
)paren
id|card-&gt;private_data
suffix:semicolon
multiline_comment|/* make sure that interrupts are disabled */
id|snd_als4000_gcr_write_addr
c_func
(paren
id|acard-&gt;gcr
comma
l_int|0x8c
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* free resources */
macro_line|#ifdef SUPPORT_JOYSTICK
r_if
c_cond
(paren
id|acard-&gt;res_joystick
)paren
(brace
r_if
c_cond
(paren
id|acard-&gt;gameport.io
)paren
id|gameport_unregister_port
c_func
(paren
op_amp
id|acard-&gt;gameport
)paren
suffix:semicolon
id|snd_als4000_set_addr
c_func
(paren
id|acard-&gt;gcr
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* disable joystick */
id|release_resource
c_func
(paren
id|acard-&gt;res_joystick
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|acard-&gt;res_joystick
)paren
suffix:semicolon
)brace
macro_line|#endif
id|release_resource
c_func
(paren
id|acard-&gt;res_gcr
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|acard-&gt;res_gcr
)paren
suffix:semicolon
)brace
DECL|function|snd_card_als4000_probe
r_static
r_int
id|__devinit
id|snd_card_als4000_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_const
r_struct
id|pci_device_id
op_star
id|pci_id
)paren
(brace
r_static
r_int
id|dev
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
id|snd_card_als4000_t
op_star
id|acard
suffix:semicolon
r_int
r_int
id|gcr
suffix:semicolon
r_struct
id|resource
op_star
id|res_gcr_port
suffix:semicolon
id|sb_t
op_star
id|chip
suffix:semicolon
id|opl3_t
op_star
id|opl3
suffix:semicolon
r_int
r_int
id|word
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|joystick
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_ge
id|SNDRV_CARDS
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|enable
(braket
id|dev
)braket
)paren
(brace
id|dev
op_increment
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
multiline_comment|/* enable PCI device */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pci
)paren
)paren
OL
l_int|0
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* check, if we can restrict PCI DMA transfers to 24 bits */
r_if
c_cond
(paren
id|pci_set_dma_mask
c_func
(paren
id|pci
comma
l_int|0x00ffffff
)paren
OL
l_int|0
op_logical_or
id|pci_set_consistent_dma_mask
c_func
(paren
id|pci
comma
l_int|0x00ffffff
)paren
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;architecture does not support 24bit PCI busmaster DMA&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
id|gcr
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|res_gcr_port
op_assign
id|request_region
c_func
(paren
id|gcr
comma
l_int|0x40
comma
l_string|&quot;ALS4000&quot;
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab region 0x%lx-0x%lx&bslash;n&quot;
comma
id|gcr
comma
id|gcr
op_plus
l_int|0x40
op_minus
l_int|1
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|pci_read_config_word
c_func
(paren
id|pci
comma
id|PCI_COMMAND
comma
op_amp
id|word
)paren
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|pci
comma
id|PCI_COMMAND
comma
id|word
op_or
id|PCI_COMMAND_IO
)paren
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pci
)paren
suffix:semicolon
id|card
op_assign
id|snd_card_new
c_func
(paren
id|index
(braket
id|dev
)braket
comma
id|id
(braket
id|dev
)braket
comma
id|THIS_MODULE
comma
r_sizeof
(paren
id|snd_card_als4000_t
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
(brace
id|release_resource
c_func
(paren
id|res_gcr_port
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|res_gcr_port
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|acard
op_assign
(paren
id|snd_card_als4000_t
op_star
)paren
id|card-&gt;private_data
suffix:semicolon
id|acard-&gt;gcr
op_assign
id|gcr
suffix:semicolon
id|acard-&gt;res_gcr
op_assign
id|res_gcr_port
suffix:semicolon
id|card-&gt;private_free
op_assign
id|snd_card_als4000_free
suffix:semicolon
multiline_comment|/* disable all legacy ISA stuff except for joystick */
macro_line|#ifdef SUPPORT_JOYSTICK
r_if
c_cond
(paren
id|joystick_port
(braket
id|dev
)braket
op_eq
l_int|1
)paren
(brace
multiline_comment|/* auto-detect */
r_int
id|p
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
l_int|0x200
suffix:semicolon
id|p
op_le
l_int|0x218
suffix:semicolon
id|p
op_add_assign
l_int|8
)paren
(brace
r_if
c_cond
(paren
(paren
id|acard-&gt;res_joystick
op_assign
id|request_region
c_func
(paren
id|p
comma
l_int|8
comma
l_string|&quot;ALS4000 gameport&quot;
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|joystick_port
(braket
id|dev
)braket
op_assign
id|p
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|joystick_port
(braket
id|dev
)braket
OG
l_int|0
)paren
id|acard-&gt;res_joystick
op_assign
id|request_region
c_func
(paren
id|joystick_port
(braket
id|dev
)braket
comma
l_int|8
comma
l_string|&quot;ALS4000 gameport&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|acard-&gt;res_joystick
)paren
id|joystick
op_assign
id|joystick_port
(braket
id|dev
)braket
suffix:semicolon
r_else
id|joystick
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|snd_als4000_set_addr
c_func
(paren
id|gcr
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|joystick
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_sbdsp_create
c_func
(paren
id|card
comma
id|gcr
op_plus
l_int|0x10
comma
id|pci-&gt;irq
comma
id|snd_als4000_interrupt
comma
op_minus
l_int|1
comma
op_minus
l_int|1
comma
id|SB_HW_ALS4000
comma
op_amp
id|chip
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|chip-&gt;pci
op_assign
id|pci
suffix:semicolon
id|chip-&gt;alt_port
op_assign
id|gcr
suffix:semicolon
id|snd_als4000_configure
c_func
(paren
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_mpu401_uart_new
c_func
(paren
id|card
comma
l_int|0
comma
id|MPU401_HW_ALS4000
comma
id|gcr
op_plus
l_int|0x30
comma
l_int|1
comma
id|pci-&gt;irq
comma
l_int|0
comma
op_amp
id|chip-&gt;rmidi
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;als4000: no MPU-401device at 0x%lx ?&bslash;n&quot;
comma
id|gcr
op_plus
l_int|0x30
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_als4000_pcm
c_func
(paren
id|chip
comma
l_int|0
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_sbmixer_new
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|snd_opl3_create
c_func
(paren
id|card
comma
id|gcr
op_plus
l_int|0x10
comma
id|gcr
op_plus
l_int|0x12
comma
id|OPL3_HW_AUTO
comma
l_int|1
comma
op_amp
id|opl3
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;als4000: no OPL device at 0x%lx-0x%lx ?&bslash;n&quot;
comma
id|gcr
op_plus
l_int|0x10
comma
id|gcr
op_plus
l_int|0x12
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_opl3_hwdep_new
c_func
(paren
id|opl3
comma
l_int|0
comma
l_int|1
comma
l_int|NULL
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
)brace
macro_line|#ifdef SUPPORT_JOYSTICK
r_if
c_cond
(paren
id|acard-&gt;res_joystick
)paren
(brace
id|acard-&gt;gameport.io
op_assign
id|joystick
suffix:semicolon
id|gameport_register_port
c_func
(paren
op_amp
id|acard-&gt;gameport
)paren
suffix:semicolon
)brace
macro_line|#endif
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;ALS4000&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;shortname
comma
l_string|&quot;Avance Logic ALS4000&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;%s at 0x%lx, irq %i&quot;
comma
id|card-&gt;shortname
comma
id|chip-&gt;alt_port
comma
id|chip-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_card_register
c_func
(paren
id|card
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pci
comma
id|card
)paren
suffix:semicolon
id|dev
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_card_als4000_remove
r_static
r_void
id|__devexit
id|snd_card_als4000_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
id|snd_card_free
c_func
(paren
id|pci_get_drvdata
c_func
(paren
id|pci
)paren
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|driver
r_static
r_struct
id|pci_driver
id|driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;ALS4000&quot;
comma
dot
id|id_table
op_assign
id|snd_als4000_ids
comma
dot
id|probe
op_assign
id|snd_card_als4000_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|snd_card_als4000_remove
)paren
comma
)brace
suffix:semicolon
DECL|function|alsa_card_als4000_init
r_static
r_int
id|__init
id|alsa_card_als4000_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_module_init
c_func
(paren
op_amp
id|driver
)paren
)paren
OL
l_int|0
)paren
(brace
macro_line|#ifdef MODULE
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;no ALS4000 based soundcards found or device busy&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|alsa_card_als4000_exit
r_static
r_void
id|__exit
id|alsa_card_als4000_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|alsa_card_als4000_init
)paren
id|module_exit
c_func
(paren
id|alsa_card_als4000_exit
)paren
macro_line|#ifndef MODULE
multiline_comment|/* format is: snd-als4000=enable,index,id,joystick_port */
DECL|function|alsa_card_als4000_setup
r_static
r_int
id|__init
id|alsa_card_als4000_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_static
r_int
id|__initdata
id|nr_dev
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|nr_dev
op_ge
id|SNDRV_CARDS
)paren
r_return
l_int|0
suffix:semicolon
(paren
r_void
)paren
(paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|enable
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|index
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_id
c_func
(paren
op_amp
id|str
comma
op_amp
id|id
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
macro_line|#ifdef SUPPORT_JOYSTICK
op_logical_and
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|joystick_port
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
macro_line|#endif
)paren
suffix:semicolon
id|nr_dev
op_increment
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;snd-als4000=&quot;
comma
id|alsa_card_als4000_setup
)paren
suffix:semicolon
macro_line|#endif /* ifndef MODULE */
eof
