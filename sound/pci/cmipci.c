multiline_comment|/*&n; * Driver for C-Media CMI8338 and 8738 PCI soundcards.&n; * Copyright (c) 2000 by Takashi Iwai &lt;tiwai@suse.de&gt;&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#include &lt;sound/control.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
macro_line|#include &lt;sound/rawmidi.h&gt;
macro_line|#include &lt;sound/mpu401.h&gt;
macro_line|#include &lt;sound/opl3.h&gt;
macro_line|#include &lt;sound/sb.h&gt;
macro_line|#include &lt;sound/asoundef.h&gt;
DECL|macro|SNDRV_GET_ID
mdefine_line|#define SNDRV_GET_ID
macro_line|#include &lt;sound/initval.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Takashi Iwai &lt;tiwai@suse.de&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;C-Media CMI8x38 PCI&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_CLASSES
c_func
(paren
l_string|&quot;{sound}&quot;
)paren
suffix:semicolon
id|MODULE_DEVICES
c_func
(paren
l_string|&quot;{{C-Media,CMI8738},&quot;
l_string|&quot;{C-Media,CMI8738B},&quot;
l_string|&quot;{C-Media,CMI8338A},&quot;
l_string|&quot;{C-Media,CMI8338B}}&quot;
)paren
suffix:semicolon
DECL|variable|snd_index
r_static
r_int
id|snd_index
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_IDX
suffix:semicolon
multiline_comment|/* Index 0-MAX */
DECL|variable|snd_id
r_static
r_char
op_star
id|snd_id
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_STR
suffix:semicolon
multiline_comment|/* ID for this card */
DECL|variable|snd_enable
r_static
r_int
id|snd_enable
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_ENABLE_PNP
suffix:semicolon
multiline_comment|/* Enable switches */
DECL|variable|snd_mpu_port
r_static
r_int
id|snd_mpu_port
(braket
id|SNDRV_CARDS
)braket
op_assign
(brace
l_int|0x330
comma
(braket
l_int|1
dot
dot
dot
(paren
id|SNDRV_CARDS
op_minus
l_int|1
)paren
)braket
op_assign
op_minus
l_int|1
)brace
suffix:semicolon
DECL|variable|snd_fm_port
r_static
r_int
id|snd_fm_port
(braket
id|SNDRV_CARDS
)braket
op_assign
(brace
l_int|0x388
comma
(braket
l_int|1
dot
dot
dot
(paren
id|SNDRV_CARDS
op_minus
l_int|1
)paren
)braket
op_assign
op_minus
l_int|1
)brace
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_index
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_index
comma
l_string|&quot;Index value for C-Media PCI soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_index
comma
id|SNDRV_INDEX_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_id
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_id
comma
l_string|&quot;ID string for C-Media PCI soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_id
comma
id|SNDRV_ID_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_enable
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_enable
comma
l_string|&quot;Enable C-Media PCI soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_enable
comma
id|SNDRV_ENABLE_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_mpu_port
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;l&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_mpu_port
comma
l_string|&quot;MPU-401 port.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_mpu_port
comma
id|SNDRV_ENABLED
l_string|&quot;,allows:{{-1},{0x330},{0x320},{0x310},{0x300}},dialog:list&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_fm_port
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;l&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_fm_port
comma
l_string|&quot;FM port.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_fm_port
comma
id|SNDRV_ENABLED
l_string|&quot;,allows:{{-1},{0x388},{0x3c8},{0x3e0},{0x3e8}},dialog:list&quot;
)paren
suffix:semicolon
macro_line|#ifndef PCI_DEVICE_ID_CMEDIA_CM8738
DECL|macro|PCI_DEVICE_ID_CMEDIA_CM8738
mdefine_line|#define PCI_DEVICE_ID_CMEDIA_CM8738&t;0x0111
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_CMEDIA_CM8738B
DECL|macro|PCI_DEVICE_ID_CMEDIA_CM8738B
mdefine_line|#define PCI_DEVICE_ID_CMEDIA_CM8738B&t;0x0112
macro_line|#endif
multiline_comment|/*&n; * CM8x38 registers definition&n; */
DECL|macro|CM_REG_FUNCTRL0
mdefine_line|#define CM_REG_FUNCTRL0&t;&t;0x00
DECL|macro|CM_RST_CH1
mdefine_line|#define CM_RST_CH1&t;&t;0x00080000
DECL|macro|CM_RST_CH0
mdefine_line|#define CM_RST_CH0&t;&t;0x00040000
DECL|macro|CM_CHEN1
mdefine_line|#define CM_CHEN1&t;&t;0x00020000&t;/* ch1: enable */
DECL|macro|CM_CHEN0
mdefine_line|#define CM_CHEN0&t;&t;0x00010000&t;/* ch0: enable */
DECL|macro|CM_PAUSE1
mdefine_line|#define CM_PAUSE1&t;&t;0x00000008&t;/* ch1: pause */
DECL|macro|CM_PAUSE0
mdefine_line|#define CM_PAUSE0&t;&t;0x00000004&t;/* ch0: pause */
DECL|macro|CM_CHADC1
mdefine_line|#define CM_CHADC1&t;&t;0x00000002&t;/* ch1, 0:playback, 1:record */
DECL|macro|CM_CHADC0
mdefine_line|#define CM_CHADC0&t;&t;0x00000001&t;/* ch0, 0:playback, 1:record */
DECL|macro|CM_REG_FUNCTRL1
mdefine_line|#define CM_REG_FUNCTRL1&t;&t;0x04
DECL|macro|CM_ASFC_MASK
mdefine_line|#define CM_ASFC_MASK&t;&t;0x0000E000&t;/* ADC sampling frequency */
DECL|macro|CM_ASFC_SHIFT
mdefine_line|#define CM_ASFC_SHIFT&t;&t;13
DECL|macro|CM_DSFC_MASK
mdefine_line|#define CM_DSFC_MASK&t;&t;0x00001C00&t;/* DAC sampling frequency */
DECL|macro|CM_DSFC_SHIFT
mdefine_line|#define CM_DSFC_SHIFT&t;&t;10
DECL|macro|CM_SPDF_1
mdefine_line|#define CM_SPDF_1&t;&t;0x00000200&t;/* SPDIF IN/OUT at channel B */
DECL|macro|CM_SPDF_0
mdefine_line|#define CM_SPDF_0&t;&t;0x00000100&t;/* SPDIF OUT only channel A */
DECL|macro|CM_SPDFLOOP
mdefine_line|#define CM_SPDFLOOP&t;&t;0x00000080&t;/* ext. SPDIIF/OUT -&gt; IN loopback */
DECL|macro|CM_SPDO2DAC
mdefine_line|#define CM_SPDO2DAC&t;&t;0x00000040&t;/* SPDIF/OUT can be heard from internal DAC */
DECL|macro|CM_INTRM
mdefine_line|#define CM_INTRM&t;&t;0x00000020&t;/* master control block (MCB) interrupt enabled */
DECL|macro|CM_BREQ
mdefine_line|#define CM_BREQ&t;&t;&t;0x00000010&t;/* bus master enabled */
DECL|macro|CM_VOICE_EN
mdefine_line|#define CM_VOICE_EN&t;&t;0x00000008&t;/* legacy voice (SB16,FM) */
DECL|macro|CM_UART_EN
mdefine_line|#define CM_UART_EN&t;&t;0x00000004&t;/* UART */
DECL|macro|CM_JYSTK_EN
mdefine_line|#define CM_JYSTK_EN&t;&t;0x00000002&t;/* joy stick */
DECL|macro|CM_REG_CHFORMAT
mdefine_line|#define CM_REG_CHFORMAT&t;&t;0x08
DECL|macro|CM_CHB3D5C
mdefine_line|#define CM_CHB3D5C&t;&t;0x80000000&t;/* 5,6 channels */
DECL|macro|CM_CHB3D
mdefine_line|#define CM_CHB3D&t;&t;0x20000000&t;/* 4 channels */
DECL|macro|CM_CHIP_MASK1
mdefine_line|#define CM_CHIP_MASK1&t;&t;0x1f000000
DECL|macro|CM_CHIP_037
mdefine_line|#define CM_CHIP_037&t;&t;0x01000000
DECL|macro|CM_SPDIF_SELECT1
mdefine_line|#define CM_SPDIF_SELECT1&t;0x00080000&t;/* for model &lt;= 037 ? */
DECL|macro|CM_AC3EN1
mdefine_line|#define CM_AC3EN1&t;&t;0x00100000&t;/* enable AC3: model 037 */
DECL|macro|CM_SPD24SEL
mdefine_line|#define CM_SPD24SEL&t;&t;0x00020000&t;/* 24bit spdif: model 037 */
multiline_comment|/* #define CM_SPDIF_INVERSE&t;0x00010000 */
multiline_comment|/* ??? */
DECL|macro|CM_ADCBITLEN_MASK
mdefine_line|#define CM_ADCBITLEN_MASK&t;0x0000C000&t;
DECL|macro|CM_ADCBITLEN_16
mdefine_line|#define CM_ADCBITLEN_16&t;&t;0x00000000
DECL|macro|CM_ADCBITLEN_15
mdefine_line|#define CM_ADCBITLEN_15&t;&t;0x00004000
DECL|macro|CM_ADCBITLEN_14
mdefine_line|#define CM_ADCBITLEN_14&t;&t;0x00008000
DECL|macro|CM_ADCBITLEN_13
mdefine_line|#define CM_ADCBITLEN_13&t;&t;0x0000C000
DECL|macro|CM_ADCDACLEN_MASK
mdefine_line|#define CM_ADCDACLEN_MASK&t;0x00003000
DECL|macro|CM_ADCDACLEN_060
mdefine_line|#define CM_ADCDACLEN_060&t;0x00000000
DECL|macro|CM_ADCDACLEN_066
mdefine_line|#define CM_ADCDACLEN_066&t;0x00001000
DECL|macro|CM_ADCDACLEN_130
mdefine_line|#define CM_ADCDACLEN_130&t;0x00002000
DECL|macro|CM_ADCDACLEN_280
mdefine_line|#define CM_ADCDACLEN_280&t;0x00003000
DECL|macro|CM_CH1_SRATE_176K
mdefine_line|#define CM_CH1_SRATE_176K&t;0x00000800
DECL|macro|CM_CH1_SRATE_88K
mdefine_line|#define CM_CH1_SRATE_88K&t;0x00000400
DECL|macro|CM_CH0_SRATE_176K
mdefine_line|#define CM_CH0_SRATE_176K&t;0x00000200
DECL|macro|CM_CH0_SRATE_88K
mdefine_line|#define CM_CH0_SRATE_88K&t;0x00000100
DECL|macro|CM_SPDIF_INVERSE2
mdefine_line|#define CM_SPDIF_INVERSE2&t;0x00000080&t;/* model 055? */
DECL|macro|CM_CH1FMT_MASK
mdefine_line|#define CM_CH1FMT_MASK&t;&t;0x0000000C
DECL|macro|CM_CH1FMT_SHIFT
mdefine_line|#define CM_CH1FMT_SHIFT&t;&t;2
DECL|macro|CM_CH0FMT_MASK
mdefine_line|#define CM_CH0FMT_MASK&t;&t;0x00000003
DECL|macro|CM_CH0FMT_SHIFT
mdefine_line|#define CM_CH0FMT_SHIFT&t;&t;0
DECL|macro|CM_REG_INT_HLDCLR
mdefine_line|#define CM_REG_INT_HLDCLR&t;0x0C
DECL|macro|CM_CHIP_MASK2
mdefine_line|#define CM_CHIP_MASK2&t;&t;0xff000000
DECL|macro|CM_CHIP_039
mdefine_line|#define CM_CHIP_039&t;&t;0x04000000
DECL|macro|CM_CHIP_039_6CH
mdefine_line|#define CM_CHIP_039_6CH&t;&t;0x01000000
DECL|macro|CM_TDMA_INT_EN
mdefine_line|#define CM_TDMA_INT_EN&t;&t;0x00040000
DECL|macro|CM_CH1_INT_EN
mdefine_line|#define CM_CH1_INT_EN&t;&t;0x00020000
DECL|macro|CM_CH0_INT_EN
mdefine_line|#define CM_CH0_INT_EN&t;&t;0x00010000
DECL|macro|CM_INT_HOLD
mdefine_line|#define CM_INT_HOLD&t;&t;0x00000002
DECL|macro|CM_INT_CLEAR
mdefine_line|#define CM_INT_CLEAR&t;&t;0x00000001
DECL|macro|CM_REG_INT_STATUS
mdefine_line|#define CM_REG_INT_STATUS&t;0x10
DECL|macro|CM_INTR
mdefine_line|#define CM_INTR&t;&t;&t;0x80000000
DECL|macro|CM_UARTINT
mdefine_line|#define CM_UARTINT&t;&t;0x00010000
DECL|macro|CM_LTDMAINT
mdefine_line|#define CM_LTDMAINT&t;&t;0x00008000
DECL|macro|CM_HTDMAINT
mdefine_line|#define CM_HTDMAINT&t;&t;0x00004000
DECL|macro|CM_CH1BUSY
mdefine_line|#define CM_CH1BUSY&t;&t;0x00000008
DECL|macro|CM_CH0BUSY
mdefine_line|#define CM_CH0BUSY&t;&t;0x00000004
DECL|macro|CM_CHINT1
mdefine_line|#define CM_CHINT1&t;&t;0x00000002
DECL|macro|CM_CHINT0
mdefine_line|#define CM_CHINT0&t;&t;0x00000001
DECL|macro|CM_REG_LEGACY_CTRL
mdefine_line|#define CM_REG_LEGACY_CTRL&t;0x14
DECL|macro|CM_NXCHG
mdefine_line|#define CM_NXCHG&t;&t;0x80000000&t;/* h/w multi channels? */
DECL|macro|CM_VMPU_MASK
mdefine_line|#define CM_VMPU_MASK&t;&t;0x60000000&t;/* MPU401 i/o port address */
DECL|macro|CM_VMPU_330
mdefine_line|#define CM_VMPU_330&t;&t;0x00000000
DECL|macro|CM_VMPU_320
mdefine_line|#define CM_VMPU_320&t;&t;0x20000000
DECL|macro|CM_VMPU_310
mdefine_line|#define CM_VMPU_310&t;&t;0x40000000
DECL|macro|CM_VMPU_300
mdefine_line|#define CM_VMPU_300&t;&t;0x60000000
DECL|macro|CM_VSBSEL_MASK
mdefine_line|#define CM_VSBSEL_MASK&t;&t;0x0C000000&t;/* SB16 base address */
DECL|macro|CM_VSBSEL_220
mdefine_line|#define CM_VSBSEL_220&t;&t;0x00000000
DECL|macro|CM_VSBSEL_240
mdefine_line|#define CM_VSBSEL_240&t;&t;0x04000000
DECL|macro|CM_VSBSEL_260
mdefine_line|#define CM_VSBSEL_260&t;&t;0x08000000
DECL|macro|CM_VSBSEL_280
mdefine_line|#define CM_VSBSEL_280&t;&t;0x0C000000
DECL|macro|CM_FMSEL_MASK
mdefine_line|#define CM_FMSEL_MASK&t;&t;0x03000000&t;/* FM OPL3 base address */
DECL|macro|CM_FMSEL_388
mdefine_line|#define CM_FMSEL_388&t;&t;0x00000000
DECL|macro|CM_FMSEL_3C8
mdefine_line|#define CM_FMSEL_3C8&t;&t;0x01000000
DECL|macro|CM_FMSEL_3E0
mdefine_line|#define CM_FMSEL_3E0&t;&t;0x02000000
DECL|macro|CM_FMSEL_3E8
mdefine_line|#define CM_FMSEL_3E8&t;&t;0x03000000
DECL|macro|CM_ENSPDOUT
mdefine_line|#define CM_ENSPDOUT&t;&t;0x00800000&t;/* enable XPDIF/OUT to I/O interface */
DECL|macro|CM_SPDCOPYRHT
mdefine_line|#define CM_SPDCOPYRHT&t;&t;0x00400000&t;/* set copyright spdif in/out */
DECL|macro|CM_DAC2SPDO
mdefine_line|#define CM_DAC2SPDO&t;&t;0x00200000&t;/* enable wave+fm_midi -&gt; SPDIF/OUT */
DECL|macro|CM_SETRETRY
mdefine_line|#define CM_SETRETRY&t;&t;0x00010000&t;/* 0: legacy i/o wait (default), 1: legacy i/o bus retry */
DECL|macro|CM_CHB3D6C
mdefine_line|#define CM_CHB3D6C&t;&t;0x00008000&t;/* 5.1 channels support */
DECL|macro|CM_LINE_AS_BASS
mdefine_line|#define CM_LINE_AS_BASS&t;&t;0x00006000&t;/* use line-in as bass */
DECL|macro|CM_REG_MISC_CTRL
mdefine_line|#define CM_REG_MISC_CTRL&t;0x18
DECL|macro|CM_PWD
mdefine_line|#define CM_PWD&t;&t;&t;0x80000000
DECL|macro|CM_RESET
mdefine_line|#define CM_RESET&t;&t;0x40000000
DECL|macro|CM_SFIL_MASK
mdefine_line|#define CM_SFIL_MASK&t;&t;0x30000000
DECL|macro|CM_TXVX
mdefine_line|#define CM_TXVX&t;&t;&t;0x08000000
DECL|macro|CM_N4SPK3D
mdefine_line|#define CM_N4SPK3D&t;&t;0x04000000&t;/* 4ch output */
DECL|macro|CM_SPDO5V
mdefine_line|#define CM_SPDO5V&t;&t;0x02000000&t;/* 5V spdif output (1 = 0.5v (coax)) */
DECL|macro|CM_SPDIF48K
mdefine_line|#define CM_SPDIF48K&t;&t;0x01000000&t;/* write */
DECL|macro|CM_SPATUS48K
mdefine_line|#define CM_SPATUS48K&t;&t;0x01000000&t;/* read */
DECL|macro|CM_ENDBDAC
mdefine_line|#define CM_ENDBDAC&t;&t;0x00800000&t;/* enable dual dac */
DECL|macro|CM_XCHGDAC
mdefine_line|#define CM_XCHGDAC&t;&t;0x00400000&t;/* 0: front=ch0, 1: front=ch1 */
DECL|macro|CM_SPD32SEL
mdefine_line|#define CM_SPD32SEL&t;&t;0x00200000&t;/* 0: 16bit SPDIF, 1: 32bit */
DECL|macro|CM_SPDFLOOPI
mdefine_line|#define CM_SPDFLOOPI&t;&t;0x00100000&t;/* int. SPDIF-IN -&gt; int. OUT */
DECL|macro|CM_FM_EN
mdefine_line|#define CM_FM_EN&t;&t;0x00080000&t;/* enalbe FM */
DECL|macro|CM_AC3EN2
mdefine_line|#define CM_AC3EN2&t;&t;0x00040000&t;/* enable AC3: model 039 */
DECL|macro|CM_VIDWPDSB
mdefine_line|#define CM_VIDWPDSB&t;&t;0x00010000 
DECL|macro|CM_SPDF_AC97
mdefine_line|#define CM_SPDF_AC97&t;&t;0x00008000&t;/* 0: SPDIF/OUT 44.1K, 1: 48K */
DECL|macro|CM_MASK_EN
mdefine_line|#define CM_MASK_EN&t;&t;0x00004000
DECL|macro|CM_VIDWPPRT
mdefine_line|#define CM_VIDWPPRT&t;&t;0x00002000
DECL|macro|CM_SFILENB
mdefine_line|#define CM_SFILENB&t;&t;0x00001000
DECL|macro|CM_MMODE_MASK
mdefine_line|#define CM_MMODE_MASK&t;&t;0x00000E00
DECL|macro|CM_SPDIF_SELECT2
mdefine_line|#define CM_SPDIF_SELECT2&t;0x00000100&t;/* for model &gt; 039 ? */
DECL|macro|CM_ENCENTER
mdefine_line|#define CM_ENCENTER&t;&t;0x00000080&t;/* shared with FLINKON? */
DECL|macro|CM_FLINKON
mdefine_line|#define CM_FLINKON&t;&t;0x00000080
DECL|macro|CM_FLINKOFF
mdefine_line|#define CM_FLINKOFF&t;&t;0x00000040
DECL|macro|CM_MIDSMP
mdefine_line|#define CM_MIDSMP&t;&t;0x00000010
DECL|macro|CM_UPDDMA_MASK
mdefine_line|#define CM_UPDDMA_MASK&t;&t;0x0000000C
DECL|macro|CM_TWAIT_MASK
mdefine_line|#define CM_TWAIT_MASK&t;&t;0x00000003
multiline_comment|/* byte */
DECL|macro|CM_REG_MIXER0
mdefine_line|#define CM_REG_MIXER0&t;&t;0x20
DECL|macro|CM_REG_SB16_DATA
mdefine_line|#define CM_REG_SB16_DATA&t;0x22
DECL|macro|CM_REG_SB16_ADDR
mdefine_line|#define CM_REG_SB16_ADDR&t;0x23
DECL|macro|CM_REG_MIXER1
mdefine_line|#define CM_REG_MIXER1&t;&t;0x24
DECL|macro|CM_FMMUTE
mdefine_line|#define CM_FMMUTE&t;&t;0x80&t;/* mute FM */
DECL|macro|CM_FMMUTE_SHIFT
mdefine_line|#define CM_FMMUTE_SHIFT&t;&t;7
DECL|macro|CM_WSMUTE
mdefine_line|#define CM_WSMUTE&t;&t;0x40&t;/* mute PCM */
DECL|macro|CM_WSMUTE_SHIFT
mdefine_line|#define CM_WSMUTE_SHIFT&t;&t;6
DECL|macro|CM_SPK4
mdefine_line|#define CM_SPK4&t;&t;&t;0x20&t;/* lin-in -&gt; rear line out */
DECL|macro|CM_SPK4_SHIFT
mdefine_line|#define CM_SPK4_SHIFT&t;&t;5
DECL|macro|CM_REAR2FRONT
mdefine_line|#define CM_REAR2FRONT&t;&t;0x10&t;/* exchange rear/front */
DECL|macro|CM_REAR2FRONT_SHIFT
mdefine_line|#define CM_REAR2FRONT_SHIFT&t;4
DECL|macro|CM_WAVEINL
mdefine_line|#define CM_WAVEINL&t;&t;0x08&t;/* digital wave rec. left chan */
DECL|macro|CM_WAVEINL_SHIFT
mdefine_line|#define CM_WAVEINL_SHIFT&t;3
DECL|macro|CM_WAVEINR
mdefine_line|#define CM_WAVEINR&t;&t;0x04&t;/* digical wave rec. right */
DECL|macro|CM_WAVEINR_SHIFT
mdefine_line|#define CM_WAVEINR_SHIFT&t;2
DECL|macro|CM_X3DEN
mdefine_line|#define CM_X3DEN&t;&t;0x02&t;/* 3D surround enable */
DECL|macro|CM_X3DEN_SHIFT
mdefine_line|#define CM_X3DEN_SHIFT&t;&t;1
DECL|macro|CM_CDPLAY
mdefine_line|#define CM_CDPLAY&t;&t;0x01&t;/* enable SPDIF/IN PCM -&gt; DAC */
DECL|macro|CM_CDPLAY_SHIFT
mdefine_line|#define CM_CDPLAY_SHIFT&t;&t;0
DECL|macro|CM_REG_MIXER2
mdefine_line|#define CM_REG_MIXER2&t;&t;0x25
DECL|macro|CM_RAUXREN
mdefine_line|#define CM_RAUXREN&t;&t;0x80&t;/* AUX right capture */
DECL|macro|CM_RAUXREN_SHIFT
mdefine_line|#define CM_RAUXREN_SHIFT&t;7
DECL|macro|CM_RAUXLEN
mdefine_line|#define CM_RAUXLEN&t;&t;0x40&t;/* AUX left capture */
DECL|macro|CM_RAUXLEN_SHIFT
mdefine_line|#define CM_RAUXLEN_SHIFT&t;6
DECL|macro|CM_VAUXRM
mdefine_line|#define CM_VAUXRM&t;&t;0x20&t;/* AUX right mute */
DECL|macro|CM_VAUXRM_SHIFT
mdefine_line|#define CM_VAUXRM_SHIFT&t;&t;5
DECL|macro|CM_VAUXLM
mdefine_line|#define CM_VAUXLM&t;&t;0x10&t;/* AUX left mute */
DECL|macro|CM_VAUXLM_SHIFT
mdefine_line|#define CM_VAUXLM_SHIFT&t;&t;4
DECL|macro|CM_VADMIC_MASK
mdefine_line|#define CM_VADMIC_MASK&t;&t;0x0e&t;/* mic gain level (0-3) &lt;&lt; 1 */
DECL|macro|CM_VADMIC_SHIFT
mdefine_line|#define CM_VADMIC_SHIFT&t;&t;1
DECL|macro|CM_MICGAINZ
mdefine_line|#define CM_MICGAINZ&t;&t;0x01&t;/* mic boost */
DECL|macro|CM_MICGAINZ_SHIFT
mdefine_line|#define CM_MICGAINZ_SHIFT&t;0
DECL|macro|CM_REG_AUX_VOL
mdefine_line|#define CM_REG_AUX_VOL&t;&t;0x26
DECL|macro|CM_VAUXL_MASK
mdefine_line|#define CM_VAUXL_MASK&t;&t;0xf0
DECL|macro|CM_VAUXR_MASK
mdefine_line|#define CM_VAUXR_MASK&t;&t;0x0f
DECL|macro|CM_REG_MISC
mdefine_line|#define CM_REG_MISC&t;&t;0x27
DECL|macro|CM_XGPO1
mdefine_line|#define CM_XGPO1&t;&t;0x20
singleline_comment|// #define CM_XGPBIO&t;&t;0x04
DECL|macro|CM_SPDIF_INVERSE
mdefine_line|#define CM_SPDIF_INVERSE&t;0x04&t;/* spdif input phase inverse (model 037) */
DECL|macro|CM_SPDVALID
mdefine_line|#define CM_SPDVALID&t;&t;0x02&t;/* spdif input valid check */
DECL|macro|CM_DMAUTO
mdefine_line|#define CM_DMAUTO&t;&t;0x01
DECL|macro|CM_REG_AC97
mdefine_line|#define CM_REG_AC97&t;&t;0x28&t;/* hmmm.. do we have ac97 link? */
multiline_comment|/*&n; * extended registers&n; */
DECL|macro|CM_REG_CH0_FRAME1
mdefine_line|#define CM_REG_CH0_FRAME1&t;0x80&t;/* base address */
DECL|macro|CM_REG_CH0_FRAME2
mdefine_line|#define CM_REG_CH0_FRAME2&t;0x84
DECL|macro|CM_REG_CH1_FRAME1
mdefine_line|#define CM_REG_CH1_FRAME1&t;0x88&t;/* 0-15: count of samples at bus master; buffer size */
DECL|macro|CM_REG_CH1_FRAME2
mdefine_line|#define CM_REG_CH1_FRAME2&t;0x8C&t;/* 16-31: count of samples at codec; fragment size */
multiline_comment|/*&n; * size of i/o region&n; */
DECL|macro|CM_EXTENT_CODEC
mdefine_line|#define CM_EXTENT_CODEC&t;  0x100
DECL|macro|CM_EXTENT_MIDI
mdefine_line|#define CM_EXTENT_MIDI&t;  0x2
DECL|macro|CM_EXTENT_SYNTH
mdefine_line|#define CM_EXTENT_SYNTH&t;  0x4
multiline_comment|/*&n; * pci ids&n; */
macro_line|#ifndef PCI_VENDOR_ID_CMEDIA
DECL|macro|PCI_VENDOR_ID_CMEDIA
mdefine_line|#define PCI_VENDOR_ID_CMEDIA         0x13F6
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_CMEDIA_CM8338A
DECL|macro|PCI_DEVICE_ID_CMEDIA_CM8338A
mdefine_line|#define PCI_DEVICE_ID_CMEDIA_CM8338A 0x0100
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_CMEDIA_CM8338B
DECL|macro|PCI_DEVICE_ID_CMEDIA_CM8338B
mdefine_line|#define PCI_DEVICE_ID_CMEDIA_CM8338B 0x0101
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_CMEDIA_CM8738
DECL|macro|PCI_DEVICE_ID_CMEDIA_CM8738
mdefine_line|#define PCI_DEVICE_ID_CMEDIA_CM8738  0x0111
macro_line|#endif
macro_line|#ifndef PCI_DEVICE_ID_CMEDIA_CM8738B
DECL|macro|PCI_DEVICE_ID_CMEDIA_CM8738B
mdefine_line|#define PCI_DEVICE_ID_CMEDIA_CM8738B 0x0112
macro_line|#endif
multiline_comment|/*&n; * channels for playback / capture&n; */
DECL|macro|CM_CH_PLAY
mdefine_line|#define CM_CH_PLAY&t;0
DECL|macro|CM_CH_CAPT
mdefine_line|#define CM_CH_CAPT&t;1
multiline_comment|/*&n; * flags to check device open/close&n; */
DECL|macro|CM_OPEN_NONE
mdefine_line|#define CM_OPEN_NONE&t;0
DECL|macro|CM_OPEN_CH_MASK
mdefine_line|#define CM_OPEN_CH_MASK&t;0x01
DECL|macro|CM_OPEN_DAC
mdefine_line|#define CM_OPEN_DAC&t;0x10
DECL|macro|CM_OPEN_ADC
mdefine_line|#define CM_OPEN_ADC&t;0x20
DECL|macro|CM_OPEN_SPDIF
mdefine_line|#define CM_OPEN_SPDIF&t;0x40
DECL|macro|CM_OPEN_PLAYBACK
mdefine_line|#define CM_OPEN_PLAYBACK&t;(CM_CH_PLAY | CM_OPEN_DAC)
DECL|macro|CM_OPEN_PLAYBACK2
mdefine_line|#define CM_OPEN_PLAYBACK2&t;(CM_CH_CAPT | CM_OPEN_DAC)
DECL|macro|CM_OPEN_CAPTURE
mdefine_line|#define CM_OPEN_CAPTURE&t;&t;(CM_CH_CAPT | CM_OPEN_ADC)
DECL|macro|CM_OPEN_SPDIF_PLAYBACK
mdefine_line|#define CM_OPEN_SPDIF_PLAYBACK&t;(CM_CH_PLAY | CM_OPEN_DAC | CM_OPEN_SPDIF)
DECL|macro|CM_OPEN_SPDIF_CAPTURE
mdefine_line|#define CM_OPEN_SPDIF_CAPTURE&t;(CM_CH_CAPT | CM_OPEN_ADC | CM_OPEN_SPDIF)
macro_line|#if CM_CH_PLAY == 1
DECL|macro|CM_PLAYBACK_SRATE_176K
mdefine_line|#define CM_PLAYBACK_SRATE_176K&t;CM_CH1_SRATE_176K
DECL|macro|CM_PLAYBACK_SPDF
mdefine_line|#define CM_PLAYBACK_SPDF&t;CM_SPDF_1
DECL|macro|CM_CAPTURE_SPDF
mdefine_line|#define CM_CAPTURE_SPDF&t;&t;CM_SPDF_0
macro_line|#else
DECL|macro|CM_PLAYBACK_SRATE_176K
mdefine_line|#define CM_PLAYBACK_SRATE_176K CM_CH0_SRATE_176K
DECL|macro|CM_PLAYBACK_SPDF
mdefine_line|#define CM_PLAYBACK_SPDF&t;CM_SPDF_0
DECL|macro|CM_CAPTURE_SPDF
mdefine_line|#define CM_CAPTURE_SPDF&t;&t;CM_SPDF_1
macro_line|#endif
multiline_comment|/*&n; * define this if you want soft ac3 encoding - it&squot;s still buggy..&n; */
multiline_comment|/* #define DO_SOFT_AC3 */
multiline_comment|/*&n; * driver data&n; */
DECL|typedef|cmipci_t
r_typedef
r_struct
id|snd_stru_cmipci
id|cmipci_t
suffix:semicolon
DECL|typedef|cmipci_pcm_t
r_typedef
r_struct
id|snd_stru_cmipci_pcm
id|cmipci_pcm_t
suffix:semicolon
DECL|macro|chip_t
mdefine_line|#define chip_t cmipci_t
DECL|struct|snd_stru_cmipci_pcm
r_struct
id|snd_stru_cmipci_pcm
(brace
DECL|member|substream
id|snd_pcm_substream_t
op_star
id|substream
suffix:semicolon
DECL|member|running
r_int
id|running
suffix:semicolon
multiline_comment|/* dac/adc running? */
DECL|member|dma_size
r_int
r_int
id|dma_size
suffix:semicolon
multiline_comment|/* in frames */
DECL|member|period_size
r_int
r_int
id|period_size
suffix:semicolon
multiline_comment|/* in frames */
DECL|member|offset
r_int
r_int
id|offset
suffix:semicolon
multiline_comment|/* physical address of the buffer */
DECL|member|fmt
r_int
r_int
id|fmt
suffix:semicolon
multiline_comment|/* format bits */
DECL|member|ch
r_int
id|ch
suffix:semicolon
multiline_comment|/* channel (0/1) */
DECL|member|is_dac
r_int
r_int
id|is_dac
suffix:semicolon
multiline_comment|/* is dac? */
DECL|member|bytes_per_frame
r_int
id|bytes_per_frame
suffix:semicolon
DECL|member|shift
r_int
id|shift
suffix:semicolon
DECL|member|ac3_shift
r_int
id|ac3_shift
suffix:semicolon
multiline_comment|/* extra shift: 1 on soft ac3 mode */
)brace
suffix:semicolon
multiline_comment|/* mixer elements toggled/resumed during ac3 playback */
DECL|struct|cmipci_mixer_auto_switches
r_struct
id|cmipci_mixer_auto_switches
(brace
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
multiline_comment|/* switch to toggle */
DECL|member|toggle_on
r_int
id|toggle_on
suffix:semicolon
multiline_comment|/* value to change when ac3 mode */
)brace
suffix:semicolon
DECL|variable|cm_saved_mixer
r_static
r_const
r_struct
id|cmipci_mixer_auto_switches
id|cm_saved_mixer
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;PCM Playback Switch&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;IEC958 Output Switch&quot;
comma
l_int|1
)brace
comma
(brace
l_string|&quot;IEC958 Mix Analog&quot;
comma
l_int|0
)brace
comma
singleline_comment|// {&quot;IEC958 Out To DAC&quot;, 1}, // no longer used
(brace
l_string|&quot;IEC958 Loop&quot;
comma
l_int|0
)brace
comma
)brace
suffix:semicolon
DECL|macro|CM_SAVED_MIXERS
mdefine_line|#define CM_SAVED_MIXERS&t;&t;(sizeof(cm_saved_mixer)/sizeof(cm_saved_mixer[0]))
DECL|struct|snd_stru_cmipci
r_struct
id|snd_stru_cmipci
(brace
DECL|member|card
id|snd_card_t
op_star
id|card
suffix:semicolon
DECL|member|pci
r_struct
id|pci_dev
op_star
id|pci
suffix:semicolon
DECL|member|device
r_int
r_int
id|device
suffix:semicolon
multiline_comment|/* device ID */
DECL|member|irq
r_int
id|irq
suffix:semicolon
DECL|member|iobase
r_int
r_int
id|iobase
suffix:semicolon
DECL|member|res_iobase
r_struct
id|resource
op_star
id|res_iobase
suffix:semicolon
DECL|member|ctrl
r_int
r_int
id|ctrl
suffix:semicolon
multiline_comment|/* FUNCTRL0 current value */
DECL|member|pcm
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
multiline_comment|/* DAC/ADC PCM */
DECL|member|pcm2
id|snd_pcm_t
op_star
id|pcm2
suffix:semicolon
multiline_comment|/* 2nd DAC */
DECL|member|pcm_spdif
id|snd_pcm_t
op_star
id|pcm_spdif
suffix:semicolon
multiline_comment|/* SPDIF */
DECL|member|chip_version
r_int
id|chip_version
suffix:semicolon
DECL|member|max_channels
r_int
id|max_channels
suffix:semicolon
DECL|member|has_dual_dac
r_int
r_int
id|has_dual_dac
suffix:colon
l_int|1
suffix:semicolon
DECL|member|can_ac3_sw
r_int
r_int
id|can_ac3_sw
suffix:colon
l_int|1
suffix:semicolon
DECL|member|can_ac3_hw
r_int
r_int
id|can_ac3_hw
suffix:colon
l_int|1
suffix:semicolon
DECL|member|can_multi_ch
r_int
r_int
id|can_multi_ch
suffix:colon
l_int|1
suffix:semicolon
DECL|member|spdif_playback_avail
r_int
r_int
id|spdif_playback_avail
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* spdif ready? */
DECL|member|spdif_playback_enabled
r_int
r_int
id|spdif_playback_enabled
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* spdif switch enabled? */
DECL|member|spdif_counter
r_int
id|spdif_counter
suffix:semicolon
multiline_comment|/* for software AC3 */
DECL|member|dig_status
r_int
r_int
id|dig_status
suffix:semicolon
DECL|member|dig_pcm_status
r_int
r_int
id|dig_pcm_status
suffix:semicolon
DECL|member|spdif_pcm_ctl
id|snd_kcontrol_t
op_star
id|spdif_pcm_ctl
suffix:semicolon
DECL|member|hw_info
id|snd_pcm_hardware_t
op_star
id|hw_info
(braket
l_int|3
)braket
suffix:semicolon
multiline_comment|/* for playbacks */
DECL|member|opened
r_int
id|opened
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* open mode */
DECL|member|open_mutex
r_struct
id|semaphore
id|open_mutex
suffix:semicolon
DECL|member|mixer_insensitive
r_int
id|mixer_insensitive
suffix:colon
l_int|1
suffix:semicolon
DECL|member|mixer_res_ctl
id|snd_kcontrol_t
op_star
id|mixer_res_ctl
(braket
id|CM_SAVED_MIXERS
)braket
suffix:semicolon
DECL|member|mixer_res_status
r_int
id|mixer_res_status
(braket
id|CM_SAVED_MIXERS
)braket
suffix:semicolon
DECL|member|opl3
id|opl3_t
op_star
id|opl3
suffix:semicolon
DECL|member|opl3hwdep
id|snd_hwdep_t
op_star
id|opl3hwdep
suffix:semicolon
DECL|member|channel
id|cmipci_pcm_t
id|channel
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* ch0 - DAC, ch1 - ADC or 2nd DAC */
multiline_comment|/* external MIDI */
DECL|member|rmidi
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
DECL|member|reg_lock
id|spinlock_t
id|reg_lock
suffix:semicolon
DECL|member|proc_entry
id|snd_info_entry_t
op_star
id|proc_entry
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* read/write operations for dword register */
DECL|function|snd_cmipci_write
r_inline
r_static
r_void
id|snd_cmipci_write
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|data
)paren
(brace
id|outl
c_func
(paren
id|data
comma
id|cm-&gt;iobase
op_plus
id|cmd
)paren
suffix:semicolon
)brace
DECL|function|snd_cmipci_read
r_inline
r_static
r_int
r_int
id|snd_cmipci_read
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
r_int
r_int
id|cmd
)paren
(brace
r_return
id|inl
c_func
(paren
id|cm-&gt;iobase
op_plus
id|cmd
)paren
suffix:semicolon
)brace
multiline_comment|/* read/write operations for word register */
DECL|function|snd_cmipci_write_w
r_inline
r_static
r_void
id|snd_cmipci_write_w
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|data
)paren
(brace
id|outw
c_func
(paren
id|data
comma
id|cm-&gt;iobase
op_plus
id|cmd
)paren
suffix:semicolon
)brace
DECL|function|snd_cmipci_read_w
r_inline
r_static
r_int
r_int
id|snd_cmipci_read_w
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
r_int
r_int
id|cmd
)paren
(brace
r_return
id|inw
c_func
(paren
id|cm-&gt;iobase
op_plus
id|cmd
)paren
suffix:semicolon
)brace
multiline_comment|/* read/write operations for byte register */
DECL|function|snd_cmipci_write_b
r_inline
r_static
r_void
id|snd_cmipci_write_b
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
r_int
r_int
id|cmd
comma
r_int
r_char
id|data
)paren
(brace
id|outb
c_func
(paren
id|data
comma
id|cm-&gt;iobase
op_plus
id|cmd
)paren
suffix:semicolon
)brace
DECL|function|snd_cmipci_read_b
r_inline
r_static
r_int
r_char
id|snd_cmipci_read_b
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
r_int
r_int
id|cmd
)paren
(brace
r_return
id|inb
c_func
(paren
id|cm-&gt;iobase
op_plus
id|cmd
)paren
suffix:semicolon
)brace
multiline_comment|/* bit operations for dword register */
DECL|function|snd_cmipci_set_bit
r_static
r_void
id|snd_cmipci_set_bit
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|flag
)paren
(brace
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
id|inl
c_func
(paren
id|cm-&gt;iobase
op_plus
id|cmd
)paren
suffix:semicolon
id|val
op_or_assign
id|flag
suffix:semicolon
id|outl
c_func
(paren
id|val
comma
id|cm-&gt;iobase
op_plus
id|cmd
)paren
suffix:semicolon
)brace
DECL|function|snd_cmipci_clear_bit
r_static
r_void
id|snd_cmipci_clear_bit
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|flag
)paren
(brace
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
id|inl
c_func
(paren
id|cm-&gt;iobase
op_plus
id|cmd
)paren
suffix:semicolon
id|val
op_and_assign
op_complement
id|flag
suffix:semicolon
id|outl
c_func
(paren
id|val
comma
id|cm-&gt;iobase
op_plus
id|cmd
)paren
suffix:semicolon
)brace
macro_line|#if 0 
singleline_comment|// not used
multiline_comment|/* bit operations for byte register */
r_static
r_void
id|snd_cmipci_set_bit_b
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
r_int
r_int
id|cmd
comma
r_int
r_char
id|flag
)paren
(brace
r_int
r_char
id|val
suffix:semicolon
id|val
op_assign
id|inb
c_func
(paren
id|cm-&gt;iobase
op_plus
id|cmd
)paren
suffix:semicolon
id|val
op_or_assign
id|flag
suffix:semicolon
id|outb
c_func
(paren
id|val
comma
id|cm-&gt;iobase
op_plus
id|cmd
)paren
suffix:semicolon
)brace
r_static
r_void
id|snd_cmipci_clear_bit_b
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
r_int
r_int
id|cmd
comma
r_int
r_char
id|flag
)paren
(brace
r_int
r_char
id|val
suffix:semicolon
id|val
op_assign
id|inb
c_func
(paren
id|cm-&gt;iobase
op_plus
id|cmd
)paren
suffix:semicolon
id|val
op_and_assign
op_complement
id|flag
suffix:semicolon
id|outb
c_func
(paren
id|val
comma
id|cm-&gt;iobase
op_plus
id|cmd
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * PCM interface&n; */
multiline_comment|/*&n; * calculate frequency&n; */
DECL|variable|rates
r_static
r_int
id|rates
(braket
)braket
op_assign
(brace
l_int|5512
comma
l_int|11025
comma
l_int|22050
comma
l_int|44100
comma
l_int|8000
comma
l_int|16000
comma
l_int|32000
comma
l_int|48000
)brace
suffix:semicolon
DECL|macro|RATES
mdefine_line|#define RATES (sizeof(rates) / sizeof(rates[0]))
DECL|function|snd_cmipci_rate_freq
r_static
r_int
r_int
id|snd_cmipci_rate_freq
c_func
(paren
r_int
r_int
id|rate
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RATES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|rates
(braket
id|i
)braket
op_eq
id|rate
)paren
r_return
id|i
suffix:semicolon
)brace
id|snd_BUG
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_hw_params
r_static
r_int
id|snd_cmipci_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
r_return
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_cmipci_hw_free
r_static
r_int
id|snd_cmipci_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; */
DECL|variable|hw_channels
r_static
r_int
r_int
id|hw_channels
(braket
)braket
op_assign
(brace
l_int|1
comma
l_int|2
comma
l_int|4
comma
l_int|5
comma
l_int|6
)brace
suffix:semicolon
DECL|variable|hw_constraints_channels_4
r_static
id|snd_pcm_hw_constraint_list_t
id|hw_constraints_channels_4
op_assign
(brace
id|count
suffix:colon
l_int|3
comma
id|list
suffix:colon
id|hw_channels
comma
id|mask
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|hw_constraints_channels_6
r_static
id|snd_pcm_hw_constraint_list_t
id|hw_constraints_channels_6
op_assign
(brace
id|count
suffix:colon
l_int|5
comma
id|list
suffix:colon
id|hw_channels
comma
id|mask
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
DECL|function|set_dac_channels
r_static
r_int
id|set_dac_channels
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
id|cmipci_pcm_t
op_star
id|rec
comma
r_int
id|channels
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|channels
OG
l_int|2
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cm-&gt;can_multi_ch
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|rec-&gt;fmt
op_ne
l_int|0x03
)paren
multiline_comment|/* stereo 16bit only */
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cmipci_set_bit
c_func
(paren
id|cm
comma
id|CM_REG_LEGACY_CTRL
comma
id|CM_NXCHG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|channels
OG
l_int|4
)paren
(brace
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_CHFORMAT
comma
id|CM_CHB3D
)paren
suffix:semicolon
id|snd_cmipci_set_bit
c_func
(paren
id|cm
comma
id|CM_REG_CHFORMAT
comma
id|CM_CHB3D5C
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_CHFORMAT
comma
id|CM_CHB3D5C
)paren
suffix:semicolon
id|snd_cmipci_set_bit
c_func
(paren
id|cm
comma
id|CM_REG_CHFORMAT
comma
id|CM_CHB3D
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|channels
op_eq
l_int|6
)paren
(brace
id|snd_cmipci_set_bit
c_func
(paren
id|cm
comma
id|CM_REG_LEGACY_CTRL
comma
id|CM_CHB3D6C
)paren
suffix:semicolon
id|snd_cmipci_set_bit
c_func
(paren
id|cm
comma
id|CM_REG_MISC_CTRL
comma
id|CM_ENCENTER
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_LEGACY_CTRL
comma
id|CM_CHB3D6C
)paren
suffix:semicolon
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_MISC_CTRL
comma
id|CM_ENCENTER
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|cm-&gt;can_multi_ch
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_LEGACY_CTRL
comma
id|CM_NXCHG
)paren
suffix:semicolon
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_CHFORMAT
comma
id|CM_CHB3D
)paren
suffix:semicolon
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_CHFORMAT
comma
id|CM_CHB3D5C
)paren
suffix:semicolon
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_LEGACY_CTRL
comma
id|CM_CHB3D6C
)paren
suffix:semicolon
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_MISC_CTRL
comma
id|CM_ENCENTER
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * prepare playback/capture channel&n; * channel to be used must have been set in rec-&gt;ch.&n; */
DECL|function|snd_cmipci_pcm_prepare
r_static
r_int
id|snd_cmipci_pcm_prepare
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
id|cmipci_pcm_t
op_star
id|rec
comma
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|reg
comma
id|freq
comma
id|val
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|rec-&gt;fmt
op_assign
l_int|0
suffix:semicolon
id|rec-&gt;shift
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
op_ge
l_int|16
)paren
(brace
id|rec-&gt;fmt
op_or_assign
l_int|0x02
suffix:semicolon
r_if
c_cond
(paren
id|snd_pcm_format_width
c_func
(paren
id|runtime-&gt;format
)paren
OG
l_int|16
)paren
id|rec-&gt;shift
op_increment
suffix:semicolon
multiline_comment|/* 24/32bit */
)brace
r_if
c_cond
(paren
id|runtime-&gt;channels
OG
l_int|1
)paren
id|rec-&gt;fmt
op_or_assign
l_int|0x01
suffix:semicolon
r_if
c_cond
(paren
id|rec-&gt;is_dac
op_logical_and
id|set_dac_channels
c_func
(paren
id|cm
comma
id|rec
comma
id|runtime-&gt;channels
)paren
OL
l_int|0
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;cannot set dac channels&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|rec-&gt;offset
op_assign
id|runtime-&gt;dma_addr
suffix:semicolon
multiline_comment|/* buffer and period sizes in frame */
id|rec-&gt;dma_size
op_assign
id|runtime-&gt;buffer_size
op_lshift
id|rec-&gt;shift
suffix:semicolon
id|rec-&gt;period_size
op_assign
id|runtime-&gt;period_size
op_lshift
id|rec-&gt;shift
suffix:semicolon
id|rec-&gt;dma_size
op_lshift_assign
id|rec-&gt;ac3_shift
suffix:semicolon
id|rec-&gt;period_size
op_lshift_assign
id|rec-&gt;ac3_shift
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* set buffer address */
id|reg
op_assign
id|rec-&gt;ch
ques
c_cond
id|CM_REG_CH1_FRAME1
suffix:colon
id|CM_REG_CH0_FRAME1
suffix:semicolon
id|snd_cmipci_write
c_func
(paren
id|cm
comma
id|reg
comma
id|rec-&gt;offset
)paren
suffix:semicolon
multiline_comment|/* program sample counts */
id|reg
op_assign
id|rec-&gt;ch
ques
c_cond
id|CM_REG_CH1_FRAME2
suffix:colon
id|CM_REG_CH0_FRAME2
suffix:semicolon
id|snd_cmipci_write_w
c_func
(paren
id|cm
comma
id|reg
comma
id|rec-&gt;dma_size
op_minus
l_int|1
)paren
suffix:semicolon
id|snd_cmipci_write_w
c_func
(paren
id|cm
comma
id|reg
op_plus
l_int|2
comma
id|rec-&gt;period_size
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* set adc/dac flag */
id|val
op_assign
id|rec-&gt;ch
ques
c_cond
id|CM_CHADC1
suffix:colon
id|CM_CHADC0
suffix:semicolon
r_if
c_cond
(paren
id|rec-&gt;is_dac
)paren
id|cm-&gt;ctrl
op_and_assign
op_complement
id|val
suffix:semicolon
r_else
id|cm-&gt;ctrl
op_or_assign
id|val
suffix:semicolon
id|snd_cmipci_write
c_func
(paren
id|cm
comma
id|CM_REG_FUNCTRL0
comma
id|cm-&gt;ctrl
)paren
suffix:semicolon
singleline_comment|//snd_printd(&quot;cmipci: functrl0 = %08x&bslash;n&quot;, cm-&gt;ctrl);
multiline_comment|/* set sample rate */
id|freq
op_assign
id|snd_cmipci_rate_freq
c_func
(paren
id|runtime-&gt;rate
)paren
suffix:semicolon
id|val
op_assign
id|snd_cmipci_read
c_func
(paren
id|cm
comma
id|CM_REG_FUNCTRL1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rec-&gt;ch
)paren
(brace
id|val
op_and_assign
op_complement
id|CM_ASFC_MASK
suffix:semicolon
id|val
op_or_assign
(paren
id|freq
op_lshift
id|CM_ASFC_SHIFT
)paren
op_amp
id|CM_ASFC_MASK
suffix:semicolon
)brace
r_else
(brace
id|val
op_and_assign
op_complement
id|CM_DSFC_MASK
suffix:semicolon
id|val
op_or_assign
(paren
id|freq
op_lshift
id|CM_DSFC_SHIFT
)paren
op_amp
id|CM_DSFC_MASK
suffix:semicolon
)brace
id|snd_cmipci_write
c_func
(paren
id|cm
comma
id|CM_REG_FUNCTRL1
comma
id|val
)paren
suffix:semicolon
singleline_comment|//snd_printd(&quot;cmipci: functrl1 = %08x&bslash;n&quot;, val);
multiline_comment|/* set format */
id|val
op_assign
id|snd_cmipci_read
c_func
(paren
id|cm
comma
id|CM_REG_CHFORMAT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rec-&gt;ch
)paren
(brace
id|val
op_and_assign
op_complement
id|CM_CH1FMT_MASK
suffix:semicolon
id|val
op_or_assign
id|rec-&gt;fmt
op_lshift
id|CM_CH1FMT_SHIFT
suffix:semicolon
)brace
r_else
(brace
id|val
op_and_assign
op_complement
id|CM_CH0FMT_MASK
suffix:semicolon
id|val
op_or_assign
id|rec-&gt;fmt
op_lshift
id|CM_CH0FMT_SHIFT
suffix:semicolon
)brace
id|snd_cmipci_write
c_func
(paren
id|cm
comma
id|CM_REG_CHFORMAT
comma
id|val
)paren
suffix:semicolon
singleline_comment|//snd_printd(&quot;cmipci: chformat = %08x&bslash;n&quot;, val);
id|rec-&gt;running
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * PCM trigger/stop&n; */
DECL|function|snd_cmipci_pcm_trigger
r_static
r_int
id|snd_cmipci_pcm_trigger
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
id|cmipci_pcm_t
op_star
id|rec
comma
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
r_int
r_int
id|inthld
comma
id|chen
comma
id|reset
comma
id|pause
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
id|inthld
op_assign
id|CM_CH0_INT_EN
op_lshift
id|rec-&gt;ch
suffix:semicolon
id|chen
op_assign
id|CM_CHEN0
op_lshift
id|rec-&gt;ch
suffix:semicolon
id|reset
op_assign
id|CM_RST_CH0
op_lshift
id|rec-&gt;ch
suffix:semicolon
id|pause
op_assign
id|CM_PAUSE0
op_lshift
id|rec-&gt;ch
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|cm-&gt;reg_lock
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
id|rec-&gt;running
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* set interrupt */
id|snd_cmipci_set_bit
c_func
(paren
id|cm
comma
id|CM_REG_INT_HLDCLR
comma
id|inthld
)paren
suffix:semicolon
id|cm-&gt;ctrl
op_or_assign
id|chen
suffix:semicolon
multiline_comment|/* enable channel */
id|snd_cmipci_write
c_func
(paren
id|cm
comma
id|CM_REG_FUNCTRL0
comma
id|cm-&gt;ctrl
)paren
suffix:semicolon
singleline_comment|//snd_printd(&quot;cmipci: functrl0 = %08x&bslash;n&quot;, cm-&gt;ctrl);
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
id|rec-&gt;running
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* disable interrupt */
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_INT_HLDCLR
comma
id|inthld
)paren
suffix:semicolon
multiline_comment|/* reset */
id|cm-&gt;ctrl
op_and_assign
op_complement
id|chen
suffix:semicolon
id|snd_cmipci_write
c_func
(paren
id|cm
comma
id|CM_REG_FUNCTRL0
comma
id|cm-&gt;ctrl
op_or
id|reset
)paren
suffix:semicolon
id|snd_cmipci_write
c_func
(paren
id|cm
comma
id|CM_REG_FUNCTRL0
comma
id|cm-&gt;ctrl
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_PUSH
suffix:colon
id|cm-&gt;ctrl
op_or_assign
id|pause
suffix:semicolon
id|snd_cmipci_write
c_func
(paren
id|cm
comma
id|CM_REG_FUNCTRL0
comma
id|cm-&gt;ctrl
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_TRIGGER_PAUSE_RELEASE
suffix:colon
id|cm-&gt;ctrl
op_and_assign
op_complement
id|pause
suffix:semicolon
id|snd_cmipci_write
c_func
(paren
id|cm
comma
id|CM_REG_FUNCTRL0
comma
id|cm-&gt;ctrl
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|cm-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/*&n; * return the current pointer&n; */
DECL|function|snd_cmipci_pcm_pointer
r_static
id|snd_pcm_uframes_t
id|snd_cmipci_pcm_pointer
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
id|cmipci_pcm_t
op_star
id|rec
comma
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_int
id|ptr
suffix:semicolon
r_int
r_int
id|reg
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rec-&gt;running
)paren
r_return
l_int|0
suffix:semicolon
macro_line|#if 1 
singleline_comment|// this seems better..
id|reg
op_assign
id|rec-&gt;ch
ques
c_cond
id|CM_REG_CH1_FRAME2
suffix:colon
id|CM_REG_CH0_FRAME2
suffix:semicolon
id|ptr
op_assign
id|rec-&gt;dma_size
op_minus
(paren
id|snd_cmipci_read_w
c_func
(paren
id|cm
comma
id|reg
)paren
op_plus
l_int|1
)paren
suffix:semicolon
id|ptr
op_rshift_assign
id|rec-&gt;shift
suffix:semicolon
macro_line|#else
id|reg
op_assign
id|rec-&gt;ch
ques
c_cond
id|CM_REG_CH1_FRAME1
suffix:colon
id|CM_REG_CH0_FRAME1
suffix:semicolon
id|ptr
op_assign
id|snd_cmipci_read
c_func
(paren
id|cm
comma
id|reg
)paren
op_minus
id|rec-&gt;offset
suffix:semicolon
id|ptr
op_assign
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|ptr
)paren
suffix:semicolon
macro_line|#endif
id|ptr
op_rshift_assign
id|rec-&gt;ac3_shift
suffix:semicolon
r_return
id|ptr
suffix:semicolon
)brace
multiline_comment|/*&n; * playback&n; */
DECL|function|snd_cmipci_playback_trigger
r_static
r_int
id|snd_cmipci_playback_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|snd_cmipci_pcm_trigger
c_func
(paren
id|cm
comma
op_amp
id|cm-&gt;channel
(braket
id|CM_CH_PLAY
)braket
comma
id|substream
comma
id|cmd
)paren
suffix:semicolon
)brace
DECL|function|snd_cmipci_playback_pointer
r_static
id|snd_pcm_uframes_t
id|snd_cmipci_playback_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|snd_cmipci_pcm_pointer
c_func
(paren
id|cm
comma
op_amp
id|cm-&gt;channel
(braket
id|CM_CH_PLAY
)braket
comma
id|substream
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * capture&n; */
DECL|function|snd_cmipci_capture_trigger
r_static
r_int
id|snd_cmipci_capture_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|snd_cmipci_pcm_trigger
c_func
(paren
id|cm
comma
op_amp
id|cm-&gt;channel
(braket
id|CM_CH_CAPT
)braket
comma
id|substream
comma
id|cmd
)paren
suffix:semicolon
)brace
DECL|function|snd_cmipci_capture_pointer
r_static
id|snd_pcm_uframes_t
id|snd_cmipci_capture_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|snd_cmipci_pcm_pointer
c_func
(paren
id|cm
comma
op_amp
id|cm-&gt;channel
(braket
id|CM_CH_CAPT
)braket
comma
id|substream
)paren
suffix:semicolon
)brace
macro_line|#ifdef DO_SOFT_AC3
multiline_comment|/*&n; * special tricks for soft ac3 transfer:&n; *&n; * we compose an iec958 subframe from 16bit ac3 sample and&n; * write the raw subframe via 32bit data mode.&n; */
multiline_comment|/* find parity for bit 4~30 */
DECL|function|parity
r_static
r_int
id|parity
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_int
r_int
id|parity
op_assign
l_int|0
suffix:semicolon
r_int
id|counter
op_assign
l_int|4
suffix:semicolon
id|data
op_rshift_assign
l_int|4
suffix:semicolon
multiline_comment|/* start from bit 4 */
r_while
c_loop
(paren
id|counter
op_le
l_int|30
)paren
(brace
r_if
c_cond
(paren
id|data
op_amp
l_int|1
)paren
id|parity
op_increment
suffix:semicolon
id|data
op_rshift_assign
l_int|1
suffix:semicolon
id|counter
op_increment
suffix:semicolon
)brace
r_return
id|parity
op_amp
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * compose 32bit iec958 subframe with non-audio data.&n; * bit 0-3  = preamble&n; *     4-7  = aux (=0)&n; *     8-27 = data (12-27 for 16bit)&n; *     28   = validity (=0)&n; *     29   = user data (=0)&n; *     30   = channel status&n; *     31   = parity&n; *&n; * channel status is assumed as consumer, non-audio&n; * thus all 0 except bit 1&n; */
DECL|function|convert_ac3_32bit
r_inline
r_static
id|u32
id|convert_ac3_32bit
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
id|u32
id|val
)paren
(brace
id|u32
id|data
op_assign
(paren
id|u32
)paren
id|val
op_lshift
l_int|12
suffix:semicolon
r_if
c_cond
(paren
id|cm-&gt;spdif_counter
op_eq
l_int|2
op_logical_or
id|cm-&gt;spdif_counter
op_eq
l_int|3
)paren
multiline_comment|/* bit 1 */
id|data
op_or_assign
l_int|0x40000000
suffix:semicolon
multiline_comment|/* indicate AC-3 raw data */
r_if
c_cond
(paren
id|parity
c_func
(paren
id|data
)paren
)paren
multiline_comment|/* parity bit 4-30 */
id|data
op_or_assign
l_int|0x80000000
suffix:semicolon
r_if
c_cond
(paren
id|cm-&gt;spdif_counter
op_eq
l_int|0
)paren
id|data
op_or_assign
l_int|3
suffix:semicolon
multiline_comment|/* preamble &squot;M&squot; */
r_else
r_if
c_cond
(paren
id|cm-&gt;spdif_counter
op_amp
l_int|1
)paren
id|data
op_or_assign
l_int|5
suffix:semicolon
multiline_comment|/* odd, &squot;W&squot; */
r_else
id|data
op_or_assign
l_int|9
suffix:semicolon
multiline_comment|/* even, &squot;M&squot; */
id|cm-&gt;spdif_counter
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|cm-&gt;spdif_counter
op_eq
l_int|384
)paren
id|cm-&gt;spdif_counter
op_assign
l_int|0
suffix:semicolon
r_return
id|data
suffix:semicolon
)brace
DECL|function|snd_cmipci_ac3_copy
r_static
r_int
id|snd_cmipci_ac3_copy
c_func
(paren
id|snd_pcm_substream_t
op_star
id|subs
comma
r_int
id|channel
comma
id|snd_pcm_uframes_t
id|pos
comma
r_void
op_star
id|src
comma
id|snd_pcm_uframes_t
id|count
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|subs
)paren
suffix:semicolon
id|u32
op_star
id|dst
suffix:semicolon
id|u16
op_star
id|srcp
op_assign
id|src
comma
id|val
suffix:semicolon
id|snd_pcm_uframes_t
id|offset
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|subs-&gt;runtime
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cm-&gt;channel
(braket
id|CM_CH_PLAY
)braket
dot
id|ac3_shift
)paren
(brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|runtime-&gt;dma_area
op_plus
id|frames_to_bytes
c_func
(paren
id|runtime
comma
id|pos
)paren
comma
id|src
comma
id|frames_to_bytes
c_func
(paren
id|runtime
comma
id|count
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_READ
comma
id|src
comma
id|count
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
multiline_comment|/* frame = 16bit stereo */
id|offset
op_assign
(paren
id|pos
op_lshift
l_int|1
)paren
op_mod
(paren
id|cm-&gt;channel
(braket
id|CM_CH_PLAY
)braket
dot
id|dma_size
op_lshift
l_int|2
)paren
suffix:semicolon
id|dst
op_assign
(paren
id|u32
op_star
)paren
(paren
id|runtime-&gt;dma_area
op_plus
id|offset
)paren
suffix:semicolon
id|count
op_div_assign
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
OG
l_int|0
)paren
(brace
id|get_user
c_func
(paren
id|val
comma
id|srcp
)paren
suffix:semicolon
id|srcp
op_increment
suffix:semicolon
op_star
id|dst
op_increment
op_assign
id|convert_ac3_32bit
c_func
(paren
id|cm
comma
id|val
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_ac3_silence
r_static
r_int
id|snd_cmipci_ac3_silence
c_func
(paren
id|snd_pcm_substream_t
op_star
id|subs
comma
r_int
id|channel
comma
id|snd_pcm_uframes_t
id|pos
comma
id|snd_pcm_uframes_t
id|count
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|subs
)paren
suffix:semicolon
id|u32
op_star
id|dst
suffix:semicolon
id|snd_pcm_uframes_t
id|offset
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|subs-&gt;runtime
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cm-&gt;channel
(braket
id|CM_CH_PLAY
)braket
dot
id|ac3_shift
)paren
r_return
id|snd_pcm_format_set_silence
c_func
(paren
id|runtime-&gt;format
comma
id|runtime-&gt;dma_area
op_plus
id|frames_to_bytes
c_func
(paren
id|runtime
comma
id|pos
)paren
comma
id|count
)paren
suffix:semicolon
multiline_comment|/* frame = 16bit stereo */
id|offset
op_assign
(paren
id|pos
op_lshift
l_int|1
)paren
op_mod
(paren
id|cm-&gt;channel
(braket
id|CM_CH_PLAY
)braket
dot
id|dma_size
op_lshift
l_int|2
)paren
suffix:semicolon
id|dst
op_assign
(paren
id|u32
op_star
)paren
(paren
id|subs-&gt;runtime-&gt;dma_area
op_plus
id|offset
)paren
suffix:semicolon
id|count
op_div_assign
l_int|2
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
OG
l_int|0
)paren
(brace
op_star
id|dst
op_increment
op_assign
id|convert_ac3_32bit
c_func
(paren
id|cm
comma
l_int|0
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* DO_SOFT_AC3 */
multiline_comment|/*&n; * hw preparation for spdif&n; */
DECL|function|snd_cmipci_spdif_default_info
r_static
r_int
id|snd_cmipci_spdif_default_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_IEC958
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_spdif_default_get
r_static
r_int
id|snd_cmipci_spdif_default_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cmipci_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|ucontrol-&gt;value.iec958.status
(braket
id|i
)braket
op_assign
(paren
id|chip-&gt;dig_status
op_rshift
(paren
id|i
op_star
l_int|8
)paren
)paren
op_amp
l_int|0xff
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_spdif_default_put
r_static
r_int
id|snd_cmipci_spdif_default_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cmipci_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
comma
id|change
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|val
op_or_assign
(paren
r_int
r_int
)paren
id|ucontrol-&gt;value.iec958.status
(braket
id|i
)braket
op_lshift
(paren
id|i
op_star
l_int|8
)paren
suffix:semicolon
id|change
op_assign
id|val
op_ne
id|chip-&gt;dig_status
suffix:semicolon
id|chip-&gt;dig_status
op_assign
id|val
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_cmipci_spdif_default
id|__devinitdata
op_assign
(brace
id|iface
suffix:colon
id|SNDRV_CTL_ELEM_IFACE_PCM
comma
id|name
suffix:colon
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|PLAYBACK
comma
id|DEFAULT
)paren
comma
id|info
suffix:colon
id|snd_cmipci_spdif_default_info
comma
id|get
suffix:colon
id|snd_cmipci_spdif_default_get
comma
id|put
suffix:colon
id|snd_cmipci_spdif_default_put
)brace
suffix:semicolon
DECL|function|snd_cmipci_spdif_mask_info
r_static
r_int
id|snd_cmipci_spdif_mask_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_IEC958
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_spdif_mask_get
r_static
r_int
id|snd_cmipci_spdif_mask_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_assign
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|1
)braket
op_assign
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|2
)braket
op_assign
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
op_assign
l_int|0xff
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_cmipci_spdif_mask
id|__devinitdata
op_assign
(brace
id|access
suffix:colon
id|SNDRV_CTL_ELEM_ACCESS_READ
comma
id|iface
suffix:colon
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
id|name
suffix:colon
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|PLAYBACK
comma
id|CON_MASK
)paren
comma
id|info
suffix:colon
id|snd_cmipci_spdif_mask_info
comma
id|get
suffix:colon
id|snd_cmipci_spdif_mask_get
comma
)brace
suffix:semicolon
DECL|function|snd_cmipci_spdif_stream_info
r_static
r_int
id|snd_cmipci_spdif_stream_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_IEC958
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_spdif_stream_get
r_static
r_int
id|snd_cmipci_spdif_stream_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cmipci_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|ucontrol-&gt;value.iec958.status
(braket
id|i
)braket
op_assign
(paren
id|chip-&gt;dig_pcm_status
op_rshift
(paren
id|i
op_star
l_int|8
)paren
)paren
op_amp
l_int|0xff
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_spdif_stream_put
r_static
r_int
id|snd_cmipci_spdif_stream_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cmipci_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
comma
id|change
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|val
op_or_assign
(paren
r_int
r_int
)paren
id|ucontrol-&gt;value.iec958.status
(braket
id|i
)braket
op_lshift
(paren
id|i
op_star
l_int|8
)paren
suffix:semicolon
id|change
op_assign
id|val
op_ne
id|chip-&gt;dig_pcm_status
suffix:semicolon
id|chip-&gt;dig_pcm_status
op_assign
id|val
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_cmipci_spdif_stream
id|__devinitdata
op_assign
(brace
id|access
suffix:colon
id|SNDRV_CTL_ELEM_ACCESS_READWRITE
op_or
id|SNDRV_CTL_ELEM_ACCESS_INACTIVE
comma
id|iface
suffix:colon
id|SNDRV_CTL_ELEM_IFACE_PCM
comma
id|name
suffix:colon
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|PLAYBACK
comma
id|PCM_STREAM
)paren
comma
id|info
suffix:colon
id|snd_cmipci_spdif_stream_info
comma
id|get
suffix:colon
id|snd_cmipci_spdif_stream_get
comma
id|put
suffix:colon
id|snd_cmipci_spdif_stream_put
)brace
suffix:semicolon
multiline_comment|/*&n; */
multiline_comment|/* save mixer setting and mute for AC3 playback */
DECL|function|save_mixer_state
r_static
r_void
id|save_mixer_state
c_func
(paren
id|cmipci_t
op_star
id|cm
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cm-&gt;mixer_insensitive
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CM_SAVED_MIXERS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|snd_kcontrol_t
op_star
id|ctl
op_assign
id|cm-&gt;mixer_res_ctl
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ctl
)paren
(brace
id|snd_ctl_elem_value_t
id|val
suffix:semicolon
r_int
id|event
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|val
comma
l_int|0
comma
r_sizeof
(paren
id|val
)paren
)paren
suffix:semicolon
id|ctl
op_member_access_from_pointer
id|get
c_func
(paren
id|ctl
comma
op_amp
id|val
)paren
suffix:semicolon
id|cm-&gt;mixer_res_status
(braket
id|i
)braket
op_assign
id|val.value.integer.value
(braket
l_int|0
)braket
suffix:semicolon
id|val.value.integer.value
(braket
l_int|0
)braket
op_assign
id|cm_saved_mixer
(braket
id|i
)braket
dot
id|toggle_on
suffix:semicolon
id|event
op_assign
id|SNDRV_CTL_EVENT_MASK_INFO
suffix:semicolon
r_if
c_cond
(paren
id|cm-&gt;mixer_res_status
(braket
id|i
)braket
op_ne
id|val.value.integer.value
(braket
l_int|0
)braket
)paren
(brace
id|ctl
op_member_access_from_pointer
id|put
c_func
(paren
id|ctl
comma
op_amp
id|val
)paren
suffix:semicolon
multiline_comment|/* toggle */
id|event
op_or_assign
id|SNDRV_CTL_EVENT_MASK_VALUE
suffix:semicolon
)brace
id|ctl-&gt;access
op_or_assign
id|SNDRV_CTL_ELEM_ACCESS_INACTIVE
suffix:semicolon
id|snd_ctl_notify
c_func
(paren
id|cm-&gt;card
comma
id|event
comma
op_amp
id|ctl-&gt;id
)paren
suffix:semicolon
)brace
)brace
id|cm-&gt;mixer_insensitive
op_assign
l_int|1
suffix:semicolon
)brace
)brace
multiline_comment|/* restore the previously saved mixer status */
DECL|function|restore_mixer_state
r_static
r_void
id|restore_mixer_state
c_func
(paren
id|cmipci_t
op_star
id|cm
)paren
(brace
r_if
c_cond
(paren
id|cm-&gt;mixer_insensitive
)paren
(brace
r_int
id|i
suffix:semicolon
id|cm-&gt;mixer_insensitive
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* at first clear this;&n;&t;&t;&t;&t;&t;      otherwise the changes will be ignored */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CM_SAVED_MIXERS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|snd_kcontrol_t
op_star
id|ctl
op_assign
id|cm-&gt;mixer_res_ctl
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ctl
)paren
(brace
id|snd_ctl_elem_value_t
id|val
suffix:semicolon
r_int
id|event
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|val
comma
l_int|0
comma
r_sizeof
(paren
id|val
)paren
)paren
suffix:semicolon
id|ctl-&gt;access
op_and_assign
op_complement
id|SNDRV_CTL_ELEM_ACCESS_INACTIVE
suffix:semicolon
id|ctl
op_member_access_from_pointer
id|get
c_func
(paren
id|ctl
comma
op_amp
id|val
)paren
suffix:semicolon
id|event
op_assign
id|SNDRV_CTL_EVENT_MASK_INFO
suffix:semicolon
r_if
c_cond
(paren
id|val.value.integer.value
(braket
l_int|0
)braket
op_ne
id|cm-&gt;mixer_res_status
(braket
id|i
)braket
)paren
(brace
id|val.value.integer.value
(braket
l_int|0
)braket
op_assign
id|cm-&gt;mixer_res_status
(braket
id|i
)braket
suffix:semicolon
id|ctl
op_member_access_from_pointer
id|put
c_func
(paren
id|ctl
comma
op_amp
id|val
)paren
suffix:semicolon
id|event
op_or_assign
id|SNDRV_CTL_EVENT_MASK_VALUE
suffix:semicolon
)brace
id|snd_ctl_notify
c_func
(paren
id|cm-&gt;card
comma
id|event
comma
op_amp
id|ctl-&gt;id
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
multiline_comment|/* spinlock held! */
DECL|function|setup_ac3
r_static
r_void
id|setup_ac3
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
r_int
id|do_ac3
comma
r_int
id|rate
)paren
(brace
id|cm-&gt;channel
(braket
id|CM_CH_PLAY
)braket
dot
id|ac3_shift
op_assign
l_int|0
suffix:semicolon
id|cm-&gt;spdif_counter
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|do_ac3
)paren
(brace
multiline_comment|/* AC3EN for 037 */
id|snd_cmipci_set_bit
c_func
(paren
id|cm
comma
id|CM_REG_CHFORMAT
comma
id|CM_AC3EN1
)paren
suffix:semicolon
multiline_comment|/* AC3EN for 039 */
id|snd_cmipci_set_bit
c_func
(paren
id|cm
comma
id|CM_REG_MISC_CTRL
comma
id|CM_AC3EN2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cm-&gt;can_ac3_hw
)paren
(brace
multiline_comment|/* SPD24SEL for 037, 0x02 */
multiline_comment|/* SPD24SEL for 039, 0x20, but cannot be set */
id|snd_cmipci_set_bit
c_func
(paren
id|cm
comma
id|CM_REG_CHFORMAT
comma
id|CM_SPD24SEL
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* can_ac3_sw */
macro_line|#ifdef DO_SOFT_AC3
multiline_comment|/* FIXME: ugly hack! */
id|subs-&gt;runtime-&gt;buffer_size
op_div_assign
l_int|2
suffix:semicolon
multiline_comment|/* SPD32SEL for 037 &amp; 039, 0x20 */
id|snd_cmipci_set_bit
c_func
(paren
id|cm
comma
id|CM_REG_MISC_CTRL
comma
id|CM_SPD32SEL
)paren
suffix:semicolon
multiline_comment|/* set 176K sample rate to fix 033 HW bug */
r_if
c_cond
(paren
id|cm-&gt;chip_version
op_eq
l_int|33
)paren
(brace
r_if
c_cond
(paren
id|rate
op_ge
l_int|48000
)paren
(brace
id|snd_cmipci_set_bit
c_func
(paren
id|cm
comma
id|CM_REG_CHFORMAT
comma
id|CM_PLAYBACK_176K
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_CHFORMAT
comma
id|CM_PLAYBACK_SRATE_176K
)paren
suffix:semicolon
)brace
)brace
id|cm-&gt;channel
(braket
id|CM_CH_PLAY
)braket
dot
id|ac3_shift
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* use 32bit */
macro_line|#endif /* DO_SOFT_AC3 */
)brace
)brace
r_else
(brace
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_CHFORMAT
comma
id|CM_AC3EN1
)paren
suffix:semicolon
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_MISC_CTRL
comma
id|CM_AC3EN2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cm-&gt;can_ac3_hw
)paren
(brace
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_CHFORMAT
comma
id|CM_SPD24SEL
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_MISC_CTRL
comma
id|CM_SPD32SEL
)paren
suffix:semicolon
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_CHFORMAT
comma
id|CM_SPD24SEL
)paren
suffix:semicolon
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_CHFORMAT
comma
id|CM_PLAYBACK_SRATE_176K
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|setup_spdif_playback
r_static
r_void
id|setup_spdif_playback
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
id|snd_pcm_substream_t
op_star
id|subs
comma
r_int
id|up
comma
r_int
id|do_ac3
)paren
(brace
r_int
id|rate
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|rate
op_assign
id|subs-&gt;runtime-&gt;rate
suffix:semicolon
r_if
c_cond
(paren
id|up
op_logical_and
id|do_ac3
)paren
id|save_mixer_state
c_func
(paren
id|cm
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|cm-&gt;spdif_playback_avail
op_assign
id|up
suffix:semicolon
r_if
c_cond
(paren
id|up
)paren
(brace
multiline_comment|/* they are controlled via &quot;IEC958 Output Switch&quot; */
multiline_comment|/* snd_cmipci_set_bit(cm, CM_REG_LEGACY_CTRL, CM_ENSPDOUT); */
multiline_comment|/* snd_cmipci_set_bit(cm, CM_REG_FUNCTRL1, CM_SPDO2DAC); */
r_if
c_cond
(paren
id|cm-&gt;spdif_playback_enabled
)paren
id|snd_cmipci_set_bit
c_func
(paren
id|cm
comma
id|CM_REG_FUNCTRL1
comma
id|CM_PLAYBACK_SPDF
)paren
suffix:semicolon
id|setup_ac3
c_func
(paren
id|cm
comma
id|do_ac3
comma
id|rate
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rate
op_eq
l_int|48000
)paren
id|snd_cmipci_set_bit
c_func
(paren
id|cm
comma
id|CM_REG_MISC_CTRL
comma
id|CM_SPDIF48K
op_or
id|CM_SPDF_AC97
)paren
suffix:semicolon
r_else
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_MISC_CTRL
comma
id|CM_SPDIF48K
op_or
id|CM_SPDF_AC97
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* they are controlled via &quot;IEC958 Output Switch&quot; */
multiline_comment|/* snd_cmipci_clear_bit(cm, CM_REG_LEGACY_CTRL, CM_ENSPDOUT); */
multiline_comment|/* snd_cmipci_clear_bit(cm, CM_REG_FUNCTRL1, CM_SPDO2DAC); */
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_FUNCTRL1
comma
id|CM_PLAYBACK_SPDF
)paren
suffix:semicolon
id|setup_ac3
c_func
(paren
id|cm
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * preparation&n; */
multiline_comment|/* playback - enable spdif only on the certain condition */
DECL|function|snd_cmipci_playback_prepare
r_static
r_int
id|snd_cmipci_playback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|rate
op_assign
id|substream-&gt;runtime-&gt;rate
suffix:semicolon
r_int
id|do_spdif
comma
id|do_ac3
suffix:semicolon
id|do_spdif
op_assign
(paren
(paren
id|rate
op_eq
l_int|44100
op_logical_or
id|rate
op_eq
l_int|48000
)paren
op_logical_and
id|substream-&gt;runtime-&gt;format
op_eq
id|SNDRV_PCM_FORMAT_S16_LE
op_logical_and
id|substream-&gt;runtime-&gt;channels
op_eq
l_int|2
)paren
suffix:semicolon
id|do_ac3
op_assign
id|cm-&gt;dig_pcm_status
op_amp
id|IEC958_AES0_NONAUDIO
suffix:semicolon
macro_line|#ifdef DO_SOFT_AC3
r_if
c_cond
(paren
id|do_ac3
op_logical_and
id|cm-&gt;can_ac3_sw
)paren
id|do_spdif
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|setup_spdif_playback
c_func
(paren
id|cm
comma
id|substream
comma
id|do_spdif
comma
id|do_ac3
)paren
suffix:semicolon
r_return
id|snd_cmipci_pcm_prepare
c_func
(paren
id|cm
comma
op_amp
id|cm-&gt;channel
(braket
id|CM_CH_PLAY
)braket
comma
id|substream
)paren
suffix:semicolon
)brace
multiline_comment|/* playback  (via device #2) - enable spdif always */
DECL|function|snd_cmipci_playback_spdif_prepare
r_static
r_int
id|snd_cmipci_playback_spdif_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|setup_spdif_playback
c_func
(paren
id|cm
comma
id|substream
comma
l_int|1
comma
id|cm-&gt;dig_pcm_status
op_amp
id|IEC958_AES0_NONAUDIO
)paren
suffix:semicolon
r_return
id|snd_cmipci_pcm_prepare
c_func
(paren
id|cm
comma
op_amp
id|cm-&gt;channel
(braket
id|CM_CH_PLAY
)braket
comma
id|substream
)paren
suffix:semicolon
)brace
DECL|function|snd_cmipci_playback_hw_free
r_static
r_int
id|snd_cmipci_playback_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|setup_spdif_playback
c_func
(paren
id|cm
comma
id|substream
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|restore_mixer_state
c_func
(paren
id|cm
)paren
suffix:semicolon
r_return
id|snd_cmipci_hw_free
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
multiline_comment|/* capture */
DECL|function|snd_cmipci_capture_prepare
r_static
r_int
id|snd_cmipci_capture_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|snd_cmipci_pcm_prepare
c_func
(paren
id|cm
comma
op_amp
id|cm-&gt;channel
(braket
id|CM_CH_CAPT
)braket
comma
id|substream
)paren
suffix:semicolon
)brace
multiline_comment|/* capture with spdif (via device #2) */
DECL|function|snd_cmipci_capture_spdif_prepare
r_static
r_int
id|snd_cmipci_capture_spdif_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cmipci_set_bit
c_func
(paren
id|cm
comma
id|CM_REG_FUNCTRL1
comma
id|CM_CAPTURE_SPDF
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|snd_cmipci_pcm_prepare
c_func
(paren
id|cm
comma
op_amp
id|cm-&gt;channel
(braket
id|CM_CH_CAPT
)braket
comma
id|substream
)paren
suffix:semicolon
)brace
DECL|function|snd_cmipci_capture_spdif_hw_free
r_static
r_int
id|snd_cmipci_capture_spdif_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|subs
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|subs
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_FUNCTRL1
comma
id|CM_CAPTURE_SPDF
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|snd_cmipci_hw_free
c_func
(paren
id|subs
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * interrupt handler&n; */
DECL|function|snd_cmipci_interrupt
r_static
r_void
id|snd_cmipci_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_magic_cast
c_func
(paren
id|cmipci_t
comma
id|dev_id
comma
r_return
)paren
suffix:semicolon
r_int
r_int
id|status
suffix:semicolon
multiline_comment|/* fastpath out, to ease interrupt sharing */
id|status
op_assign
id|snd_cmipci_read
c_func
(paren
id|cm
comma
id|CM_REG_INT_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
id|CM_INTR
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* acknowledge interrupt */
id|spin_lock
c_func
(paren
op_amp
id|cm-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|CM_CHINT0
)paren
(brace
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_INT_HLDCLR
comma
id|CM_CH0_INT_EN
)paren
suffix:semicolon
id|snd_cmipci_set_bit
c_func
(paren
id|cm
comma
id|CM_REG_INT_HLDCLR
comma
id|CM_CH0_INT_EN
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|CM_CHINT1
)paren
(brace
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_INT_HLDCLR
comma
id|CM_CH1_INT_EN
)paren
suffix:semicolon
id|snd_cmipci_set_bit
c_func
(paren
id|cm
comma
id|CM_REG_INT_HLDCLR
comma
id|CM_CH1_INT_EN
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|cm-&gt;reg_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cm-&gt;rmidi
op_logical_and
(paren
id|status
op_amp
id|CM_UARTINT
)paren
)paren
id|snd_mpu401_uart_interrupt
c_func
(paren
id|irq
comma
id|cm-&gt;rmidi-&gt;private_data
comma
id|regs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cm-&gt;pcm
)paren
(brace
r_if
c_cond
(paren
(paren
id|status
op_amp
id|CM_CHINT0
)paren
op_logical_and
id|cm-&gt;channel
(braket
l_int|0
)braket
dot
id|running
)paren
id|snd_pcm_period_elapsed
c_func
(paren
id|cm-&gt;channel
(braket
l_int|0
)braket
dot
id|substream
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|CM_CHINT1
)paren
op_logical_and
id|cm-&gt;channel
(braket
l_int|1
)braket
dot
id|running
)paren
id|snd_pcm_period_elapsed
c_func
(paren
id|cm-&gt;channel
(braket
l_int|1
)braket
dot
id|substream
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * h/w infos&n; */
multiline_comment|/* playback on channel A */
DECL|variable|snd_cmipci_playback
r_static
id|snd_pcm_hardware_t
id|snd_cmipci_playback
op_assign
(brace
id|info
suffix:colon
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
id|formats
suffix:colon
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
comma
id|rates
suffix:colon
id|SNDRV_PCM_RATE_5512
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
id|rate_min
suffix:colon
l_int|5512
comma
id|rate_max
suffix:colon
l_int|48000
comma
id|channels_min
suffix:colon
l_int|1
comma
id|channels_max
suffix:colon
l_int|2
comma
id|buffer_bytes_max
suffix:colon
(paren
l_int|128
op_star
l_int|1024
)paren
comma
id|period_bytes_min
suffix:colon
l_int|64
comma
id|period_bytes_max
suffix:colon
(paren
l_int|128
op_star
l_int|1024
)paren
comma
id|periods_min
suffix:colon
l_int|2
comma
id|periods_max
suffix:colon
l_int|1024
comma
id|fifo_size
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/* capture on channel B */
DECL|variable|snd_cmipci_capture
r_static
id|snd_pcm_hardware_t
id|snd_cmipci_capture
op_assign
(brace
id|info
suffix:colon
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
id|formats
suffix:colon
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
comma
id|rates
suffix:colon
id|SNDRV_PCM_RATE_5512
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
id|rate_min
suffix:colon
l_int|5512
comma
id|rate_max
suffix:colon
l_int|48000
comma
id|channels_min
suffix:colon
l_int|1
comma
id|channels_max
suffix:colon
l_int|2
comma
id|buffer_bytes_max
suffix:colon
(paren
l_int|128
op_star
l_int|1024
)paren
comma
id|period_bytes_min
suffix:colon
l_int|64
comma
id|period_bytes_max
suffix:colon
(paren
l_int|128
op_star
l_int|1024
)paren
comma
id|periods_min
suffix:colon
l_int|2
comma
id|periods_max
suffix:colon
l_int|1024
comma
id|fifo_size
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/* playback on channel B - stereo 16bit only? */
DECL|variable|snd_cmipci_playback2
r_static
id|snd_pcm_hardware_t
id|snd_cmipci_playback2
op_assign
(brace
id|info
suffix:colon
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
id|formats
suffix:colon
id|SNDRV_PCM_FMTBIT_S16_LE
comma
id|rates
suffix:colon
id|SNDRV_PCM_RATE_5512
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
id|rate_min
suffix:colon
l_int|5512
comma
id|rate_max
suffix:colon
l_int|48000
comma
id|channels_min
suffix:colon
l_int|2
comma
id|channels_max
suffix:colon
l_int|2
comma
id|buffer_bytes_max
suffix:colon
(paren
l_int|128
op_star
l_int|1024
)paren
comma
id|period_bytes_min
suffix:colon
l_int|64
comma
id|period_bytes_max
suffix:colon
(paren
l_int|128
op_star
l_int|1024
)paren
comma
id|periods_min
suffix:colon
l_int|2
comma
id|periods_max
suffix:colon
l_int|1024
comma
id|fifo_size
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/* spdif playback on channel A */
DECL|variable|snd_cmipci_playback_spdif
r_static
id|snd_pcm_hardware_t
id|snd_cmipci_playback_spdif
op_assign
(brace
id|info
suffix:colon
(paren
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
)paren
comma
id|formats
suffix:colon
id|SNDRV_PCM_FMTBIT_S16_LE
multiline_comment|/*| SNDRV_PCM_FMTBIT_S32_LE*/
comma
id|rates
suffix:colon
id|SNDRV_PCM_RATE_44100
op_or
id|SNDRV_PCM_RATE_48000
comma
id|rate_min
suffix:colon
l_int|44100
comma
id|rate_max
suffix:colon
l_int|48000
comma
id|channels_min
suffix:colon
l_int|2
comma
id|channels_max
suffix:colon
l_int|2
comma
id|buffer_bytes_max
suffix:colon
(paren
l_int|128
op_star
l_int|1024
)paren
comma
id|period_bytes_min
suffix:colon
l_int|64
comma
id|period_bytes_max
suffix:colon
(paren
l_int|128
op_star
l_int|1024
)paren
comma
id|periods_min
suffix:colon
l_int|2
comma
id|periods_max
suffix:colon
l_int|1024
comma
id|fifo_size
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/* spdif capture on channel B */
DECL|variable|snd_cmipci_capture_spdif
r_static
id|snd_pcm_hardware_t
id|snd_cmipci_capture_spdif
op_assign
(brace
id|info
suffix:colon
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
id|formats
suffix:colon
id|SNDRV_PCM_FMTBIT_S16_LE
comma
id|rates
suffix:colon
id|SNDRV_PCM_RATE_44100
op_or
id|SNDRV_PCM_RATE_48000
comma
id|rate_min
suffix:colon
l_int|44100
comma
id|rate_max
suffix:colon
l_int|48000
comma
id|channels_min
suffix:colon
l_int|2
comma
id|channels_max
suffix:colon
l_int|2
comma
id|buffer_bytes_max
suffix:colon
(paren
l_int|128
op_star
l_int|1024
)paren
comma
id|period_bytes_min
suffix:colon
l_int|64
comma
id|period_bytes_max
suffix:colon
(paren
l_int|128
op_star
l_int|1024
)paren
comma
id|periods_min
suffix:colon
l_int|2
comma
id|periods_max
suffix:colon
l_int|1024
comma
id|fifo_size
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * check device open/close&n; */
DECL|function|open_device_check
r_static
r_int
id|open_device_check
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
r_int
id|mode
comma
id|snd_pcm_substream_t
op_star
id|subs
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|ch
op_assign
id|mode
op_amp
id|CM_OPEN_CH_MASK
suffix:semicolon
multiline_comment|/* FIXME: a file should wait until the device becomes free&n;&t; * when it&squot;s opened on blocking mode.  however, since the current&n;&t; * pcm framework doesn&squot;t pass file pointer before actually opened,&n;&t; * we can&squot;t know whether blocking mode or not in open callback..&n;&t; */
id|down
c_func
(paren
op_amp
id|cm-&gt;open_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cm-&gt;opened
(braket
id|ch
)braket
)paren
(brace
id|up
c_func
(paren
op_amp
id|cm-&gt;open_mutex
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|cm-&gt;opened
(braket
id|ch
)braket
op_assign
id|mode
suffix:semicolon
id|cm-&gt;channel
(braket
id|ch
)braket
dot
id|substream
op_assign
id|subs
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|mode
op_amp
id|CM_OPEN_DAC
)paren
)paren
(brace
multiline_comment|/* disable dual DAC mode */
id|cm-&gt;channel
(braket
id|ch
)braket
dot
id|is_dac
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_MISC_CTRL
comma
id|CM_ENDBDAC
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|cm-&gt;open_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|close_device_check
r_static
r_void
id|close_device_check
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
r_int
id|mode
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|ch
op_assign
id|mode
op_amp
id|CM_OPEN_CH_MASK
suffix:semicolon
id|down
c_func
(paren
op_amp
id|cm-&gt;open_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cm-&gt;opened
(braket
id|ch
)braket
op_eq
id|mode
)paren
(brace
id|cm-&gt;channel
(braket
id|ch
)braket
dot
id|running
op_assign
l_int|0
suffix:semicolon
id|cm-&gt;channel
(braket
id|ch
)braket
dot
id|substream
op_assign
l_int|NULL
suffix:semicolon
id|cm-&gt;opened
(braket
id|ch
)braket
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cm-&gt;channel
(braket
id|ch
)braket
dot
id|is_dac
)paren
(brace
multiline_comment|/* enable dual DAC mode again */
id|cm-&gt;channel
(braket
id|ch
)braket
dot
id|is_dac
op_assign
l_int|1
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cmipci_set_bit
c_func
(paren
id|cm
comma
id|CM_REG_MISC_CTRL
comma
id|CM_ENDBDAC
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|cm-&gt;open_mutex
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; */
DECL|function|snd_cmipci_playback_open
r_static
r_int
id|snd_cmipci_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|open_device_check
c_func
(paren
id|cm
comma
id|CM_OPEN_PLAYBACK
comma
id|substream
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_cmipci_playback
suffix:semicolon
r_if
c_cond
(paren
id|cm-&gt;can_multi_ch
)paren
(brace
id|runtime-&gt;hw.channels_max
op_assign
id|cm-&gt;max_channels
suffix:semicolon
r_if
c_cond
(paren
id|cm-&gt;max_channels
op_eq
l_int|4
)paren
id|snd_pcm_hw_constraint_list
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_CHANNELS
comma
op_amp
id|hw_constraints_channels_4
)paren
suffix:semicolon
r_else
id|snd_pcm_hw_constraint_list
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_CHANNELS
comma
op_amp
id|hw_constraints_channels_6
)paren
suffix:semicolon
)brace
id|snd_pcm_hw_constraint_minmax
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_BUFFER_SIZE
comma
l_int|0
comma
l_int|0x10000
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_capture_open
r_static
r_int
id|snd_cmipci_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|open_device_check
c_func
(paren
id|cm
comma
id|CM_OPEN_CAPTURE
comma
id|substream
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_cmipci_capture
suffix:semicolon
id|snd_pcm_hw_constraint_minmax
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_BUFFER_SIZE
comma
l_int|0
comma
l_int|0x10000
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_playback2_open
r_static
r_int
id|snd_cmipci_playback2_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|open_device_check
c_func
(paren
id|cm
comma
id|CM_OPEN_PLAYBACK2
comma
id|substream
)paren
)paren
OL
l_int|0
)paren
multiline_comment|/* use channel B */
r_return
id|err
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_cmipci_playback2
suffix:semicolon
id|snd_pcm_hw_constraint_minmax
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_BUFFER_SIZE
comma
l_int|0
comma
l_int|0x10000
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_playback_spdif_open
r_static
r_int
id|snd_cmipci_playback_spdif_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|open_device_check
c_func
(paren
id|cm
comma
id|CM_OPEN_SPDIF_PLAYBACK
comma
id|substream
)paren
)paren
OL
l_int|0
)paren
multiline_comment|/* use channel A */
r_return
id|err
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_cmipci_playback_spdif
suffix:semicolon
macro_line|#ifdef DO_SOFT_AC3
r_if
c_cond
(paren
id|cm-&gt;can_ac3_hw
)paren
macro_line|#endif
id|runtime-&gt;hw.info
op_or_assign
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
suffix:semicolon
id|snd_pcm_hw_constraint_minmax
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_BUFFER_SIZE
comma
l_int|0
comma
l_int|0x40000
)paren
suffix:semicolon
id|cm-&gt;dig_pcm_status
op_assign
id|cm-&gt;dig_status
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_capture_spdif_open
r_static
r_int
id|snd_cmipci_capture_spdif_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|open_device_check
c_func
(paren
id|cm
comma
id|CM_OPEN_SPDIF_CAPTURE
comma
id|substream
)paren
)paren
OL
l_int|0
)paren
multiline_comment|/* use channel B */
r_return
id|err
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_cmipci_capture_spdif
suffix:semicolon
id|snd_pcm_hw_constraint_minmax
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_BUFFER_SIZE
comma
l_int|0
comma
l_int|0x40000
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; */
DECL|function|snd_cmipci_playback_close
r_static
r_int
id|snd_cmipci_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|close_device_check
c_func
(paren
id|cm
comma
id|CM_OPEN_PLAYBACK
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_capture_close
r_static
r_int
id|snd_cmipci_capture_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|close_device_check
c_func
(paren
id|cm
comma
id|CM_OPEN_CAPTURE
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_playback2_close
r_static
r_int
id|snd_cmipci_playback2_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|close_device_check
c_func
(paren
id|cm
comma
id|CM_OPEN_PLAYBACK2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_playback_spdif_close
r_static
r_int
id|snd_cmipci_playback_spdif_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|close_device_check
c_func
(paren
id|cm
comma
id|CM_OPEN_SPDIF_PLAYBACK
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_capture_spdif_close
r_static
r_int
id|snd_cmipci_capture_spdif_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|close_device_check
c_func
(paren
id|cm
comma
id|CM_OPEN_SPDIF_CAPTURE
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; */
DECL|variable|snd_cmipci_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_cmipci_playback_ops
op_assign
(brace
id|open
suffix:colon
id|snd_cmipci_playback_open
comma
id|close
suffix:colon
id|snd_cmipci_playback_close
comma
id|ioctl
suffix:colon
id|snd_pcm_lib_ioctl
comma
id|hw_params
suffix:colon
id|snd_cmipci_hw_params
comma
id|hw_free
suffix:colon
id|snd_cmipci_playback_hw_free
comma
id|prepare
suffix:colon
id|snd_cmipci_playback_prepare
comma
id|trigger
suffix:colon
id|snd_cmipci_playback_trigger
comma
id|pointer
suffix:colon
id|snd_cmipci_playback_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_cmipci_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_cmipci_capture_ops
op_assign
(brace
id|open
suffix:colon
id|snd_cmipci_capture_open
comma
id|close
suffix:colon
id|snd_cmipci_capture_close
comma
id|ioctl
suffix:colon
id|snd_pcm_lib_ioctl
comma
id|hw_params
suffix:colon
id|snd_cmipci_hw_params
comma
id|hw_free
suffix:colon
id|snd_cmipci_hw_free
comma
id|prepare
suffix:colon
id|snd_cmipci_capture_prepare
comma
id|trigger
suffix:colon
id|snd_cmipci_capture_trigger
comma
id|pointer
suffix:colon
id|snd_cmipci_capture_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_cmipci_playback2_ops
r_static
id|snd_pcm_ops_t
id|snd_cmipci_playback2_ops
op_assign
(brace
id|open
suffix:colon
id|snd_cmipci_playback2_open
comma
id|close
suffix:colon
id|snd_cmipci_playback2_close
comma
id|ioctl
suffix:colon
id|snd_pcm_lib_ioctl
comma
id|hw_params
suffix:colon
id|snd_cmipci_hw_params
comma
id|hw_free
suffix:colon
id|snd_cmipci_hw_free
comma
id|prepare
suffix:colon
id|snd_cmipci_capture_prepare
comma
multiline_comment|/* channel B */
id|trigger
suffix:colon
id|snd_cmipci_capture_trigger
comma
multiline_comment|/* channel B */
id|pointer
suffix:colon
id|snd_cmipci_capture_pointer
comma
multiline_comment|/* channel B */
)brace
suffix:semicolon
DECL|variable|snd_cmipci_playback_spdif_ops
r_static
id|snd_pcm_ops_t
id|snd_cmipci_playback_spdif_ops
op_assign
(brace
id|open
suffix:colon
id|snd_cmipci_playback_spdif_open
comma
id|close
suffix:colon
id|snd_cmipci_playback_spdif_close
comma
id|ioctl
suffix:colon
id|snd_pcm_lib_ioctl
comma
id|hw_params
suffix:colon
id|snd_cmipci_hw_params
comma
id|hw_free
suffix:colon
id|snd_cmipci_playback_hw_free
comma
id|prepare
suffix:colon
id|snd_cmipci_playback_spdif_prepare
comma
multiline_comment|/* set up rate */
id|trigger
suffix:colon
id|snd_cmipci_playback_trigger
comma
id|pointer
suffix:colon
id|snd_cmipci_playback_pointer
comma
macro_line|#ifdef DO_SOFT_AC3
id|copy
suffix:colon
id|snd_cmipci_ac3_copy
comma
id|silence
suffix:colon
id|snd_cmipci_ac3_silence
comma
macro_line|#endif
)brace
suffix:semicolon
DECL|variable|snd_cmipci_capture_spdif_ops
r_static
id|snd_pcm_ops_t
id|snd_cmipci_capture_spdif_ops
op_assign
(brace
id|open
suffix:colon
id|snd_cmipci_capture_spdif_open
comma
id|close
suffix:colon
id|snd_cmipci_capture_spdif_close
comma
id|ioctl
suffix:colon
id|snd_pcm_lib_ioctl
comma
id|hw_params
suffix:colon
id|snd_cmipci_hw_params
comma
id|hw_free
suffix:colon
id|snd_cmipci_capture_spdif_hw_free
comma
id|prepare
suffix:colon
id|snd_cmipci_capture_spdif_prepare
comma
id|trigger
suffix:colon
id|snd_cmipci_capture_trigger
comma
id|pointer
suffix:colon
id|snd_cmipci_capture_pointer
comma
)brace
suffix:semicolon
multiline_comment|/*&n; */
DECL|function|snd_cmipci_pcm_free
r_static
r_void
id|snd_cmipci_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_cmipci_pcm_new
r_static
r_int
id|__devinit
id|snd_cmipci_pcm_new
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
r_int
id|device
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|cm-&gt;card
comma
id|cm-&gt;card-&gt;driver
comma
id|device
comma
l_int|1
comma
l_int|1
comma
op_amp
id|pcm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_cmipci_playback_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_cmipci_capture_ops
)paren
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|cm
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_cmipci_pcm_free
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;C-Media PCI DAC/ADC&quot;
)paren
suffix:semicolon
id|cm-&gt;pcm
op_assign
id|pcm
suffix:semicolon
id|snd_pcm_lib_preallocate_pci_pages_for_all
c_func
(paren
id|cm-&gt;pci
comma
id|pcm
comma
l_int|64
op_star
l_int|1024
comma
l_int|128
op_star
l_int|1024
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_pcm2_new
r_static
r_int
id|__devinit
id|snd_cmipci_pcm2_new
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
r_int
id|device
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|cm-&gt;card
comma
id|cm-&gt;card-&gt;driver
comma
id|device
comma
l_int|1
comma
l_int|0
comma
op_amp
id|pcm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_cmipci_playback2_ops
)paren
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|cm
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_cmipci_pcm_free
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;C-Media PCI 2nd DAC&quot;
)paren
suffix:semicolon
id|cm-&gt;pcm2
op_assign
id|pcm
suffix:semicolon
id|snd_pcm_lib_preallocate_pci_pages_for_all
c_func
(paren
id|cm-&gt;pci
comma
id|pcm
comma
l_int|64
op_star
l_int|1024
comma
l_int|128
op_star
l_int|1024
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_pcm_spdif_new
r_static
r_int
id|__devinit
id|snd_cmipci_pcm_spdif_new
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
r_int
id|device
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|cm-&gt;card
comma
id|cm-&gt;card-&gt;driver
comma
id|device
comma
l_int|1
comma
l_int|1
comma
op_amp
id|pcm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_cmipci_playback_spdif_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_cmipci_capture_spdif_ops
)paren
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|cm
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_cmipci_pcm_free
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;C-Media PCI IEC958&quot;
)paren
suffix:semicolon
id|cm-&gt;pcm_spdif
op_assign
id|pcm
suffix:semicolon
id|snd_pcm_lib_preallocate_pci_pages_for_all
c_func
(paren
id|cm-&gt;pci
comma
id|pcm
comma
l_int|64
op_star
l_int|1024
comma
l_int|128
op_star
l_int|1024
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * mixer interface:&n; * - CM8338/8738 has a compatible mixer interface with SB16, but&n; *   lack of some elements like tone control, i/o gain and AGC.&n; * - Access to native registers:&n; *   - A 3D switch&n; *   - Output mute switches&n; */
DECL|function|snd_cmipci_mixer_write
r_static
r_void
id|snd_cmipci_mixer_write
c_func
(paren
id|cmipci_t
op_star
id|s
comma
r_int
r_char
id|idx
comma
r_int
r_char
id|data
)paren
(brace
id|outb
c_func
(paren
id|idx
comma
id|s-&gt;iobase
op_plus
id|CM_REG_SB16_ADDR
)paren
suffix:semicolon
id|outb
c_func
(paren
id|data
comma
id|s-&gt;iobase
op_plus
id|CM_REG_SB16_DATA
)paren
suffix:semicolon
)brace
DECL|function|snd_cmipci_mixer_read
r_static
r_int
r_char
id|snd_cmipci_mixer_read
c_func
(paren
id|cmipci_t
op_star
id|s
comma
r_int
r_char
id|idx
)paren
(brace
r_int
r_char
id|v
suffix:semicolon
id|outb
c_func
(paren
id|idx
comma
id|s-&gt;iobase
op_plus
id|CM_REG_SB16_ADDR
)paren
suffix:semicolon
id|v
op_assign
id|inb
c_func
(paren
id|s-&gt;iobase
op_plus
id|CM_REG_SB16_DATA
)paren
suffix:semicolon
r_return
id|v
suffix:semicolon
)brace
multiline_comment|/*&n; * general mixer element&n; */
DECL|struct|cmipci_sb_reg
r_typedef
r_struct
id|cmipci_sb_reg
(brace
DECL|member|left_reg
DECL|member|right_reg
r_int
r_int
id|left_reg
comma
id|right_reg
suffix:semicolon
DECL|member|left_shift
DECL|member|right_shift
r_int
r_int
id|left_shift
comma
id|right_shift
suffix:semicolon
DECL|member|mask
r_int
r_int
id|mask
suffix:semicolon
DECL|member|invert
r_int
r_int
id|invert
suffix:colon
l_int|1
suffix:semicolon
DECL|member|stereo
r_int
r_int
id|stereo
suffix:colon
l_int|1
suffix:semicolon
DECL|typedef|cmipci_sb_reg_t
)brace
id|cmipci_sb_reg_t
suffix:semicolon
DECL|macro|COMPOSE_SB_REG
mdefine_line|#define COMPOSE_SB_REG(lreg,rreg,lshift,rshift,mask,invert,stereo) &bslash;&n; ((lreg) | ((rreg) &lt;&lt; 8) | (lshift &lt;&lt; 16) | (rshift &lt;&lt; 19) | (mask &lt;&lt; 24) | (invert &lt;&lt; 22) | (stereo &lt;&lt; 23))
DECL|macro|CMIPCI_DOUBLE
mdefine_line|#define CMIPCI_DOUBLE(xname, left_reg, right_reg, left_shift, right_shift, mask, invert, stereo) &bslash;&n;{ iface: SNDRV_CTL_ELEM_IFACE_MIXER, name: xname, &bslash;&n;  info: snd_cmipci_info_volume, &bslash;&n;  get: snd_cmipci_get_volume, put: snd_cmipci_put_volume, &bslash;&n;  private_value: COMPOSE_SB_REG(left_reg, right_reg, left_shift, right_shift, mask, invert, stereo), &bslash;&n;}
DECL|macro|CMIPCI_SB_VOL_STEREO
mdefine_line|#define CMIPCI_SB_VOL_STEREO(xname,reg,shift,mask) CMIPCI_DOUBLE(xname, reg, reg+1, shift, shift, mask, 0, 1)
DECL|macro|CMIPCI_SB_VOL_MONO
mdefine_line|#define CMIPCI_SB_VOL_MONO(xname,reg,shift,mask) CMIPCI_DOUBLE(xname, reg, reg, shift, shift, mask, 0, 0)
DECL|macro|CMIPCI_SB_SW_STEREO
mdefine_line|#define CMIPCI_SB_SW_STEREO(xname,lshift,rshift) CMIPCI_DOUBLE(xname, SB_DSP4_OUTPUT_SW, SB_DSP4_OUTPUT_SW, lshift, rshift, 1, 0, 1)
DECL|macro|CMIPCI_SB_SW_MONO
mdefine_line|#define CMIPCI_SB_SW_MONO(xname,shift) CMIPCI_DOUBLE(xname, SB_DSP4_OUTPUT_SW, SB_DSP4_OUTPUT_SW, shift, shift, 1, 0, 0)
DECL|function|cmipci_sb_reg_decode
r_static
r_void
id|cmipci_sb_reg_decode
c_func
(paren
id|cmipci_sb_reg_t
op_star
id|r
comma
r_int
r_int
id|val
)paren
(brace
id|r-&gt;left_reg
op_assign
id|val
op_amp
l_int|0xff
suffix:semicolon
id|r-&gt;right_reg
op_assign
(paren
id|val
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|r-&gt;left_shift
op_assign
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0x07
suffix:semicolon
id|r-&gt;right_shift
op_assign
(paren
id|val
op_rshift
l_int|19
)paren
op_amp
l_int|0x07
suffix:semicolon
id|r-&gt;invert
op_assign
(paren
id|val
op_rshift
l_int|22
)paren
op_amp
l_int|1
suffix:semicolon
id|r-&gt;stereo
op_assign
(paren
id|val
op_rshift
l_int|23
)paren
op_amp
l_int|1
suffix:semicolon
id|r-&gt;mask
op_assign
(paren
id|val
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
)brace
DECL|function|snd_cmipci_info_volume
r_static
r_int
id|snd_cmipci_info_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|cmipci_sb_reg_t
id|reg
suffix:semicolon
id|cmipci_sb_reg_decode
c_func
(paren
op_amp
id|reg
comma
id|kcontrol-&gt;private_value
)paren
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|reg.mask
op_eq
l_int|1
ques
c_cond
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:colon
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
id|reg.stereo
op_plus
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
id|reg.mask
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_get_volume
r_static
r_int
id|snd_cmipci_get_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|cmipci_sb_reg_t
id|reg
suffix:semicolon
r_int
id|val
suffix:semicolon
id|cmipci_sb_reg_decode
c_func
(paren
op_amp
id|reg
comma
id|kcontrol-&gt;private_value
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|val
op_assign
(paren
id|snd_cmipci_mixer_read
c_func
(paren
id|cm
comma
id|reg.left_reg
)paren
op_rshift
id|reg.left_shift
)paren
op_amp
id|reg.mask
suffix:semicolon
r_if
c_cond
(paren
id|reg.invert
)paren
id|val
op_assign
id|reg.mask
op_minus
id|val
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|reg.stereo
)paren
(brace
id|val
op_assign
(paren
id|snd_cmipci_mixer_read
c_func
(paren
id|cm
comma
id|reg.right_reg
)paren
op_rshift
id|reg.right_shift
)paren
op_amp
id|reg.mask
suffix:semicolon
r_if
c_cond
(paren
id|reg.invert
)paren
id|val
op_assign
id|reg.mask
op_minus
id|val
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
id|val
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_put_volume
r_static
r_int
id|snd_cmipci_put_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|cmipci_sb_reg_t
id|reg
suffix:semicolon
r_int
id|change
suffix:semicolon
r_int
id|left
comma
id|right
comma
id|oleft
comma
id|oright
suffix:semicolon
id|cmipci_sb_reg_decode
c_func
(paren
op_amp
id|reg
comma
id|kcontrol-&gt;private_value
)paren
suffix:semicolon
id|left
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
id|reg.mask
suffix:semicolon
r_if
c_cond
(paren
id|reg.invert
)paren
id|left
op_assign
id|reg.mask
op_minus
id|left
suffix:semicolon
id|left
op_lshift_assign
id|reg.left_shift
suffix:semicolon
r_if
c_cond
(paren
id|reg.stereo
)paren
(brace
id|right
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_amp
id|reg.mask
suffix:semicolon
r_if
c_cond
(paren
id|reg.invert
)paren
id|right
op_assign
id|reg.mask
op_minus
id|right
suffix:semicolon
id|right
op_lshift_assign
id|reg.right_shift
suffix:semicolon
)brace
r_else
id|right
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|oleft
op_assign
id|snd_cmipci_mixer_read
c_func
(paren
id|cm
comma
id|reg.left_reg
)paren
suffix:semicolon
id|left
op_or_assign
id|oleft
op_amp
op_complement
(paren
id|reg.mask
op_lshift
id|reg.left_shift
)paren
suffix:semicolon
id|change
op_assign
id|left
op_ne
id|oleft
suffix:semicolon
r_if
c_cond
(paren
id|reg.stereo
)paren
(brace
r_if
c_cond
(paren
id|reg.left_reg
op_ne
id|reg.right_reg
)paren
(brace
id|snd_cmipci_mixer_write
c_func
(paren
id|cm
comma
id|reg.left_reg
comma
id|left
)paren
suffix:semicolon
id|oright
op_assign
id|snd_cmipci_mixer_read
c_func
(paren
id|cm
comma
id|reg.right_reg
)paren
suffix:semicolon
)brace
r_else
id|oright
op_assign
id|left
suffix:semicolon
id|right
op_or_assign
id|oright
op_amp
op_complement
(paren
id|reg.mask
op_lshift
id|reg.right_shift
)paren
suffix:semicolon
id|change
op_or_assign
id|right
op_ne
id|oright
suffix:semicolon
id|snd_cmipci_mixer_write
c_func
(paren
id|cm
comma
id|reg.right_reg
comma
id|right
)paren
suffix:semicolon
)brace
r_else
id|snd_cmipci_mixer_write
c_func
(paren
id|cm
comma
id|reg.left_reg
comma
id|left
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
multiline_comment|/*&n; * input route (left,right) -&gt; (left,right)&n; */
DECL|macro|CMIPCI_SB_INPUT_SW
mdefine_line|#define CMIPCI_SB_INPUT_SW(xname, left_shift, right_shift) &bslash;&n;{ iface: SNDRV_CTL_ELEM_IFACE_MIXER, name: xname, &bslash;&n;  info: snd_cmipci_info_input_sw, &bslash;&n;  get: snd_cmipci_get_input_sw, put: snd_cmipci_put_input_sw, &bslash;&n;  private_value: COMPOSE_SB_REG(SB_DSP4_INPUT_LEFT, SB_DSP4_INPUT_RIGHT, left_shift, right_shift, 1, 0, 1), &bslash;&n;}
DECL|function|snd_cmipci_info_input_sw
r_static
r_int
id|snd_cmipci_info_input_sw
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|4
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_get_input_sw
r_static
r_int
id|snd_cmipci_get_input_sw
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|cmipci_sb_reg_t
id|reg
suffix:semicolon
r_int
id|val1
comma
id|val2
suffix:semicolon
id|cmipci_sb_reg_decode
c_func
(paren
op_amp
id|reg
comma
id|kcontrol-&gt;private_value
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|val1
op_assign
id|snd_cmipci_mixer_read
c_func
(paren
id|cm
comma
id|reg.left_reg
)paren
suffix:semicolon
id|val2
op_assign
id|snd_cmipci_mixer_read
c_func
(paren
id|cm
comma
id|reg.right_reg
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|val1
op_rshift
id|reg.left_shift
)paren
op_amp
l_int|1
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
(paren
id|val2
op_rshift
id|reg.left_shift
)paren
op_amp
l_int|1
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|2
)braket
op_assign
(paren
id|val1
op_rshift
id|reg.right_shift
)paren
op_amp
l_int|1
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|3
)braket
op_assign
(paren
id|val2
op_rshift
id|reg.right_shift
)paren
op_amp
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_put_input_sw
r_static
r_int
id|snd_cmipci_put_input_sw
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|cmipci_sb_reg_t
id|reg
suffix:semicolon
r_int
id|change
suffix:semicolon
r_int
id|val1
comma
id|val2
comma
id|oval1
comma
id|oval2
suffix:semicolon
id|cmipci_sb_reg_decode
c_func
(paren
op_amp
id|reg
comma
id|kcontrol-&gt;private_value
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|oval1
op_assign
id|snd_cmipci_mixer_read
c_func
(paren
id|cm
comma
id|reg.left_reg
)paren
suffix:semicolon
id|oval2
op_assign
id|snd_cmipci_mixer_read
c_func
(paren
id|cm
comma
id|reg.right_reg
)paren
suffix:semicolon
id|val1
op_assign
id|oval1
op_amp
op_complement
(paren
(paren
l_int|1
op_lshift
id|reg.left_shift
)paren
op_or
(paren
l_int|1
op_lshift
id|reg.right_shift
)paren
)paren
suffix:semicolon
id|val2
op_assign
id|oval2
op_amp
op_complement
(paren
(paren
l_int|1
op_lshift
id|reg.left_shift
)paren
op_or
(paren
l_int|1
op_lshift
id|reg.right_shift
)paren
)paren
suffix:semicolon
id|val1
op_or_assign
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|1
)paren
op_lshift
id|reg.left_shift
suffix:semicolon
id|val2
op_or_assign
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_amp
l_int|1
)paren
op_lshift
id|reg.left_shift
suffix:semicolon
id|val1
op_or_assign
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|2
)braket
op_amp
l_int|1
)paren
op_lshift
id|reg.right_shift
suffix:semicolon
id|val2
op_or_assign
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|3
)braket
op_amp
l_int|1
)paren
op_lshift
id|reg.right_shift
suffix:semicolon
id|change
op_assign
id|val1
op_ne
id|oval1
op_logical_or
id|val2
op_ne
id|oval2
suffix:semicolon
id|snd_cmipci_mixer_write
c_func
(paren
id|cm
comma
id|reg.left_reg
comma
id|val1
)paren
suffix:semicolon
id|snd_cmipci_mixer_write
c_func
(paren
id|cm
comma
id|reg.right_reg
comma
id|val2
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
multiline_comment|/*&n; * native mixer switches/volumes&n; */
DECL|macro|CMIPCI_MIXER_SW_STEREO
mdefine_line|#define CMIPCI_MIXER_SW_STEREO(xname, reg, lshift, rshift, invert) &bslash;&n;{ iface: SNDRV_CTL_ELEM_IFACE_MIXER, name: xname, &bslash;&n;  info: snd_cmipci_info_native_mixer, &bslash;&n;  get: snd_cmipci_get_native_mixer, put: snd_cmipci_put_native_mixer, &bslash;&n;  private_value: COMPOSE_SB_REG(reg, reg, lshift, rshift, 1, invert, 1), &bslash;&n;}
DECL|macro|CMIPCI_MIXER_SW_MONO
mdefine_line|#define CMIPCI_MIXER_SW_MONO(xname, reg, shift, invert) &bslash;&n;{ iface: SNDRV_CTL_ELEM_IFACE_MIXER, name: xname, &bslash;&n;  info: snd_cmipci_info_native_mixer, &bslash;&n;  get: snd_cmipci_get_native_mixer, put: snd_cmipci_put_native_mixer, &bslash;&n;  private_value: COMPOSE_SB_REG(reg, reg, shift, shift, 1, invert, 0), &bslash;&n;}
DECL|macro|CMIPCI_MIXER_VOL_STEREO
mdefine_line|#define CMIPCI_MIXER_VOL_STEREO(xname, reg, lshift, rshift, mask) &bslash;&n;{ iface: SNDRV_CTL_ELEM_IFACE_MIXER, name: xname, &bslash;&n;  info: snd_cmipci_info_native_mixer, &bslash;&n;  get: snd_cmipci_get_native_mixer, put: snd_cmipci_put_native_mixer, &bslash;&n;  private_value: COMPOSE_SB_REG(reg, reg, lshift, rshift, mask, 0, 1), &bslash;&n;}
DECL|macro|CMIPCI_MIXER_VOL_MONO
mdefine_line|#define CMIPCI_MIXER_VOL_MONO(xname, reg, shift, mask) &bslash;&n;{ iface: SNDRV_CTL_ELEM_IFACE_MIXER, name: xname, &bslash;&n;  info: snd_cmipci_info_native_mixer, &bslash;&n;  get: snd_cmipci_get_native_mixer, put: snd_cmipci_put_native_mixer, &bslash;&n;  private_value: COMPOSE_SB_REG(reg, reg, shift, shift, mask, 0, 0), &bslash;&n;}
DECL|function|snd_cmipci_info_native_mixer
r_static
r_int
id|snd_cmipci_info_native_mixer
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|cmipci_sb_reg_t
id|reg
suffix:semicolon
id|cmipci_sb_reg_decode
c_func
(paren
op_amp
id|reg
comma
id|kcontrol-&gt;private_value
)paren
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|reg.mask
op_eq
l_int|1
ques
c_cond
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:colon
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
id|reg.stereo
op_plus
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
id|reg.mask
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_get_native_mixer
r_static
r_int
id|snd_cmipci_get_native_mixer
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|cmipci_sb_reg_t
id|reg
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|oreg
comma
id|val
suffix:semicolon
id|cmipci_sb_reg_decode
c_func
(paren
op_amp
id|reg
comma
id|kcontrol-&gt;private_value
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|oreg
op_assign
id|inb
c_func
(paren
id|cm-&gt;iobase
op_plus
id|reg.left_reg
)paren
suffix:semicolon
id|val
op_assign
(paren
id|oreg
op_rshift
id|reg.left_shift
)paren
op_amp
id|reg.mask
suffix:semicolon
r_if
c_cond
(paren
id|reg.invert
)paren
id|val
op_assign
id|reg.mask
op_minus
id|val
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|val
suffix:semicolon
r_if
c_cond
(paren
id|reg.stereo
)paren
(brace
id|val
op_assign
(paren
id|oreg
op_rshift
id|reg.right_shift
)paren
op_amp
id|reg.mask
suffix:semicolon
r_if
c_cond
(paren
id|reg.invert
)paren
id|val
op_assign
id|reg.mask
op_minus
id|val
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
id|val
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_put_native_mixer
r_static
r_int
id|snd_cmipci_put_native_mixer
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|cmipci_sb_reg_t
id|reg
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|oreg
comma
id|nreg
comma
id|val
suffix:semicolon
id|cmipci_sb_reg_decode
c_func
(paren
op_amp
id|reg
comma
id|kcontrol-&gt;private_value
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|oreg
op_assign
id|inb
c_func
(paren
id|cm-&gt;iobase
op_plus
id|reg.left_reg
)paren
suffix:semicolon
id|val
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
id|reg.mask
suffix:semicolon
r_if
c_cond
(paren
id|reg.invert
)paren
id|val
op_assign
id|reg.mask
op_minus
id|val
suffix:semicolon
id|nreg
op_assign
id|oreg
op_amp
op_complement
(paren
id|reg.mask
op_lshift
id|reg.left_shift
)paren
suffix:semicolon
id|nreg
op_or_assign
(paren
id|val
op_lshift
id|reg.left_shift
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg.stereo
)paren
(brace
id|val
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_amp
id|reg.mask
suffix:semicolon
r_if
c_cond
(paren
id|reg.invert
)paren
id|val
op_assign
id|reg.mask
op_minus
id|val
suffix:semicolon
id|nreg
op_and_assign
op_complement
(paren
id|reg.mask
op_lshift
id|reg.right_shift
)paren
suffix:semicolon
id|nreg
op_or_assign
(paren
id|val
op_lshift
id|reg.right_shift
)paren
suffix:semicolon
)brace
id|outb
c_func
(paren
id|nreg
comma
id|cm-&gt;iobase
op_plus
id|reg.left_reg
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
(paren
id|nreg
op_ne
id|oreg
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * special case - check mixer sensitivity&n; */
DECL|function|snd_cmipci_get_native_mixer_sensitive
r_static
r_int
id|snd_cmipci_get_native_mixer_sensitive
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
singleline_comment|//cmipci_t *cm = snd_kcontrol_chip(kcontrol);
r_return
id|snd_cmipci_get_native_mixer
c_func
(paren
id|kcontrol
comma
id|ucontrol
)paren
suffix:semicolon
)brace
DECL|function|snd_cmipci_put_native_mixer_sensitive
r_static
r_int
id|snd_cmipci_put_native_mixer_sensitive
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cm-&gt;mixer_insensitive
)paren
(brace
multiline_comment|/* ignored */
r_return
l_int|0
suffix:semicolon
)brace
r_return
id|snd_cmipci_put_native_mixer
c_func
(paren
id|kcontrol
comma
id|ucontrol
)paren
suffix:semicolon
)brace
DECL|macro|num_controls
mdefine_line|#define num_controls(ary) (sizeof(ary) / sizeof(snd_kcontrol_new_t))
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_cmipci_mixers
(braket
)braket
id|__devinitdata
op_assign
(brace
id|CMIPCI_SB_VOL_STEREO
c_func
(paren
l_string|&quot;Master Playback Volume&quot;
comma
id|SB_DSP4_MASTER_DEV
comma
l_int|3
comma
l_int|31
)paren
comma
id|CMIPCI_MIXER_SW_MONO
c_func
(paren
l_string|&quot;3D Control - Switch&quot;
comma
id|CM_REG_MIXER1
comma
id|CM_X3DEN_SHIFT
comma
l_int|0
)paren
comma
id|CMIPCI_SB_VOL_STEREO
c_func
(paren
l_string|&quot;PCM Playback Volume&quot;
comma
id|SB_DSP4_PCM_DEV
comma
l_int|3
comma
l_int|31
)paren
comma
singleline_comment|//CMIPCI_MIXER_SW_MONO(&quot;PCM Playback Switch&quot;, CM_REG_MIXER1, CM_WSMUTE_SHIFT, 1),
(brace
multiline_comment|/* switch with sensitivity */
id|iface
suffix:colon
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
id|name
suffix:colon
l_string|&quot;PCM Playback Switch&quot;
comma
id|info
suffix:colon
id|snd_cmipci_info_native_mixer
comma
id|get
suffix:colon
id|snd_cmipci_get_native_mixer_sensitive
comma
id|put
suffix:colon
id|snd_cmipci_put_native_mixer_sensitive
comma
id|private_value
suffix:colon
id|COMPOSE_SB_REG
c_func
(paren
id|CM_REG_MIXER1
comma
id|CM_REG_MIXER1
comma
id|CM_WSMUTE_SHIFT
comma
id|CM_WSMUTE_SHIFT
comma
l_int|1
comma
l_int|1
comma
l_int|0
)paren
comma
)brace
comma
id|CMIPCI_MIXER_SW_STEREO
c_func
(paren
l_string|&quot;PCM Capture Switch&quot;
comma
id|CM_REG_MIXER1
comma
id|CM_WAVEINL_SHIFT
comma
id|CM_WAVEINR_SHIFT
comma
l_int|0
)paren
comma
id|CMIPCI_SB_VOL_STEREO
c_func
(paren
l_string|&quot;Synth Playback Volume&quot;
comma
id|SB_DSP4_SYNTH_DEV
comma
l_int|3
comma
l_int|31
)paren
comma
id|CMIPCI_MIXER_SW_MONO
c_func
(paren
l_string|&quot;Synth Playback Switch&quot;
comma
id|CM_REG_MIXER1
comma
id|CM_FMMUTE_SHIFT
comma
l_int|1
)paren
comma
id|CMIPCI_SB_INPUT_SW
c_func
(paren
l_string|&quot;Synth Capture Route&quot;
comma
l_int|6
comma
l_int|5
)paren
comma
id|CMIPCI_SB_VOL_STEREO
c_func
(paren
l_string|&quot;CD Playback Volume&quot;
comma
id|SB_DSP4_CD_DEV
comma
l_int|3
comma
l_int|31
)paren
comma
id|CMIPCI_SB_SW_STEREO
c_func
(paren
l_string|&quot;CD Playback Switch&quot;
comma
l_int|2
comma
l_int|1
)paren
comma
id|CMIPCI_SB_INPUT_SW
c_func
(paren
l_string|&quot;CD Capture Route&quot;
comma
l_int|2
comma
l_int|1
)paren
comma
id|CMIPCI_SB_VOL_STEREO
c_func
(paren
l_string|&quot;Line Playback Volume&quot;
comma
id|SB_DSP4_LINE_DEV
comma
l_int|3
comma
l_int|31
)paren
comma
id|CMIPCI_SB_SW_STEREO
c_func
(paren
l_string|&quot;Line Playback Switch&quot;
comma
l_int|4
comma
l_int|3
)paren
comma
id|CMIPCI_SB_INPUT_SW
c_func
(paren
l_string|&quot;Line Capture Route&quot;
comma
l_int|4
comma
l_int|3
)paren
comma
id|CMIPCI_SB_VOL_MONO
c_func
(paren
l_string|&quot;Mic Playback Volume&quot;
comma
id|SB_DSP4_MIC_DEV
comma
l_int|3
comma
l_int|31
)paren
comma
id|CMIPCI_SB_SW_MONO
c_func
(paren
l_string|&quot;Mic Playback Switch&quot;
comma
l_int|0
)paren
comma
id|CMIPCI_DOUBLE
c_func
(paren
l_string|&quot;Mic Capture Switch&quot;
comma
id|SB_DSP4_INPUT_LEFT
comma
id|SB_DSP4_INPUT_RIGHT
comma
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|0
)paren
comma
id|CMIPCI_SB_VOL_MONO
c_func
(paren
l_string|&quot;PC Speaker Playback Volume&quot;
comma
id|SB_DSP4_SPEAKER_DEV
comma
l_int|6
comma
l_int|3
)paren
comma
id|CMIPCI_MIXER_VOL_STEREO
c_func
(paren
l_string|&quot;Aux Playback Volume&quot;
comma
id|CM_REG_AUX_VOL
comma
l_int|4
comma
l_int|0
comma
l_int|15
)paren
comma
id|CMIPCI_MIXER_SW_STEREO
c_func
(paren
l_string|&quot;Aux Playback Switch&quot;
comma
id|CM_REG_MIXER2
comma
id|CM_VAUXLM_SHIFT
comma
id|CM_VAUXRM_SHIFT
comma
l_int|0
)paren
comma
id|CMIPCI_MIXER_SW_STEREO
c_func
(paren
l_string|&quot;Aux Capture Switch&quot;
comma
id|CM_REG_MIXER2
comma
id|CM_RAUXLEN_SHIFT
comma
id|CM_RAUXREN_SHIFT
comma
l_int|0
)paren
comma
id|CMIPCI_MIXER_SW_MONO
c_func
(paren
l_string|&quot;Mic Boost&quot;
comma
id|CM_REG_MIXER2
comma
id|CM_MICGAINZ_SHIFT
comma
l_int|1
)paren
comma
id|CMIPCI_MIXER_VOL_MONO
c_func
(paren
l_string|&quot;Mic Capture Volume&quot;
comma
id|CM_REG_MIXER2
comma
id|CM_VADMIC_SHIFT
comma
l_int|7
)paren
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * other switches&n; */
DECL|struct|snd_cmipci_switch_args
r_typedef
r_struct
id|snd_cmipci_switch_args
(brace
DECL|member|reg
r_int
id|reg
suffix:semicolon
multiline_comment|/* register index */
DECL|member|mask
r_int
r_int
id|mask
suffix:semicolon
multiline_comment|/* mask bits */
DECL|member|mask_on
r_int
r_int
id|mask_on
suffix:semicolon
multiline_comment|/* mask bits to turn on */
DECL|member|is_byte
r_int
id|is_byte
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* byte access? */
DECL|member|ac3_sensitive
r_int
id|ac3_sensitive
suffix:colon
l_int|1
suffix:semicolon
multiline_comment|/* access forbidden during non-audio operation? */
DECL|typedef|snd_cmipci_switch_args_t
)brace
id|snd_cmipci_switch_args_t
suffix:semicolon
DECL|function|snd_cmipci_uswitch_info
r_static
r_int
id|snd_cmipci_uswitch_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|_snd_cmipci_uswitch_get
r_static
r_int
id|_snd_cmipci_uswitch_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
comma
id|snd_cmipci_switch_args_t
op_star
id|args
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
id|cmipci_t
op_star
id|cm
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|args-&gt;ac3_sensitive
op_logical_and
id|cm-&gt;mixer_insensitive
)paren
(brace
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|args-&gt;is_byte
)paren
id|val
op_assign
id|inb
c_func
(paren
id|cm-&gt;iobase
op_plus
id|args-&gt;reg
)paren
suffix:semicolon
r_else
id|val
op_assign
id|snd_cmipci_read
c_func
(paren
id|cm
comma
id|args-&gt;reg
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
(paren
id|val
op_amp
id|args-&gt;mask
)paren
op_eq
id|args-&gt;mask_on
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_uswitch_get
r_static
r_int
id|snd_cmipci_uswitch_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|snd_cmipci_switch_args_t
op_star
id|args
op_assign
(paren
id|snd_cmipci_switch_args_t
op_star
)paren
id|kcontrol-&gt;private_value
suffix:semicolon
id|snd_assert
c_func
(paren
id|args
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
r_return
id|_snd_cmipci_uswitch_get
c_func
(paren
id|kcontrol
comma
id|ucontrol
comma
id|args
)paren
suffix:semicolon
)brace
DECL|function|_snd_cmipci_uswitch_put
r_static
r_int
id|_snd_cmipci_uswitch_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
comma
id|snd_cmipci_switch_args_t
op_star
id|args
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
id|change
suffix:semicolon
id|cmipci_t
op_star
id|cm
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|args-&gt;ac3_sensitive
op_logical_and
id|cm-&gt;mixer_insensitive
)paren
(brace
multiline_comment|/* ignored */
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|args-&gt;is_byte
)paren
id|val
op_assign
id|inb
c_func
(paren
id|cm-&gt;iobase
op_plus
id|args-&gt;reg
)paren
suffix:semicolon
r_else
id|val
op_assign
id|snd_cmipci_read
c_func
(paren
id|cm
comma
id|args-&gt;reg
)paren
suffix:semicolon
id|change
op_assign
(paren
id|val
op_amp
id|args-&gt;mask
)paren
op_ne
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
ques
c_cond
id|args-&gt;mask
suffix:colon
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
(brace
id|val
op_and_assign
op_complement
id|args-&gt;mask
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
id|val
op_or_assign
id|args-&gt;mask_on
suffix:semicolon
r_else
id|val
op_or_assign
(paren
id|args-&gt;mask
op_amp
op_complement
id|args-&gt;mask_on
)paren
suffix:semicolon
r_if
c_cond
(paren
id|args-&gt;is_byte
)paren
id|outb
c_func
(paren
(paren
r_int
r_char
)paren
id|val
comma
id|cm-&gt;iobase
op_plus
id|args-&gt;reg
)paren
suffix:semicolon
r_else
id|snd_cmipci_write
c_func
(paren
id|cm
comma
id|args-&gt;reg
comma
id|val
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|function|snd_cmipci_uswitch_put
r_static
r_int
id|snd_cmipci_uswitch_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|snd_cmipci_switch_args_t
op_star
id|args
op_assign
(paren
id|snd_cmipci_switch_args_t
op_star
)paren
id|kcontrol-&gt;private_value
suffix:semicolon
id|snd_assert
c_func
(paren
id|args
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
r_return
id|_snd_cmipci_uswitch_put
c_func
(paren
id|kcontrol
comma
id|ucontrol
comma
id|args
)paren
suffix:semicolon
)brace
DECL|macro|DEFINE_SWITCH_ARG
mdefine_line|#define DEFINE_SWITCH_ARG(sname, xreg, xmask, xmask_on, xis_byte, xac3) &bslash;&n;static snd_cmipci_switch_args_t cmipci_switch_arg_##sname = { &bslash;&n;  reg: xreg, &bslash;&n;  mask: xmask, &bslash;&n;  mask_on: xmask_on, &bslash;&n;  is_byte: xis_byte, &bslash;&n;  ac3_sensitive: xac3, &bslash;&n;}
DECL|macro|DEFINE_BIT_SWITCH_ARG
mdefine_line|#define DEFINE_BIT_SWITCH_ARG(sname, xreg, xmask, xis_byte, xac3) &bslash;&n;&t;DEFINE_SWITCH_ARG(sname, xreg, xmask, xmask, xis_byte, xac3)
macro_line|#if 0 /* these will be controlled in pcm device */
id|DEFINE_BIT_SWITCH_ARG
c_func
(paren
id|spdif_in
comma
id|CM_REG_FUNCTRL1
comma
id|CM_SPDF_1
comma
l_int|0
)paren
suffix:semicolon
id|DEFINE_BIT_SWITCH_ARG
c_func
(paren
id|spdif_0
comma
id|CM_REG_FUNCTRL1
comma
id|CM_SPDF_0
comma
l_int|0
)paren
suffix:semicolon
id|DEFINE_BIT_SWITCH_ARG
c_func
(paren
id|spdo_48k
comma
id|CM_REG_MISC_CTRL
comma
id|CM_SPDF_AC97
op_or
id|CM_SPDIF48K
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|DEFINE_BIT_SWITCH_ARG
c_func
(paren
id|spdif_in_sel1
comma
id|CM_REG_CHFORMAT
comma
id|CM_SPDIF_SELECT1
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|DEFINE_BIT_SWITCH_ARG
c_func
(paren
id|spdif_in_sel2
comma
id|CM_REG_MISC_CTRL
comma
id|CM_SPDIF_SELECT2
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|DEFINE_BIT_SWITCH_ARG
c_func
(paren
id|spdif_enable
comma
id|CM_REG_LEGACY_CTRL
comma
id|CM_ENSPDOUT
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|DEFINE_BIT_SWITCH_ARG
c_func
(paren
id|spdo2dac
comma
id|CM_REG_FUNCTRL1
comma
id|CM_SPDO2DAC
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
id|DEFINE_BIT_SWITCH_ARG
c_func
(paren
id|spdi_valid
comma
id|CM_REG_MISC
comma
id|CM_SPDVALID
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|DEFINE_BIT_SWITCH_ARG
c_func
(paren
id|spdif_copyright
comma
id|CM_REG_LEGACY_CTRL
comma
id|CM_SPDCOPYRHT
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|DEFINE_BIT_SWITCH_ARG
c_func
(paren
id|spdif_dac_out
comma
id|CM_REG_LEGACY_CTRL
comma
id|CM_DAC2SPDO
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
id|DEFINE_SWITCH_ARG
c_func
(paren
id|spdo_5v
comma
id|CM_REG_MISC_CTRL
comma
id|CM_SPDO5V
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* inverse: 0 = 5V */
id|DEFINE_BIT_SWITCH_ARG
c_func
(paren
id|spdif_loop
comma
id|CM_REG_FUNCTRL1
comma
id|CM_SPDFLOOP
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
id|DEFINE_BIT_SWITCH_ARG
c_func
(paren
id|spdi_monitor
comma
id|CM_REG_MIXER1
comma
id|CM_CDPLAY
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* DEFINE_BIT_SWITCH_ARG(spdi_phase, CM_REG_CHFORMAT, CM_SPDIF_INVERSE, 0, 0); */
id|DEFINE_BIT_SWITCH_ARG
c_func
(paren
id|spdi_phase
comma
id|CM_REG_MISC
comma
id|CM_SPDIF_INVERSE
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|DEFINE_BIT_SWITCH_ARG
c_func
(paren
id|spdi_phase2
comma
id|CM_REG_CHFORMAT
comma
id|CM_SPDIF_INVERSE2
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
macro_line|#if CM_CH_PLAY == 1
id|DEFINE_SWITCH_ARG
c_func
(paren
id|exchange_dac
comma
id|CM_REG_MISC_CTRL
comma
id|CM_XCHGDAC
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* reversed */
macro_line|#else
id|DEFINE_SWITCH_ARG
c_func
(paren
id|exchange_dac
comma
id|CM_REG_MISC_CTRL
comma
id|CM_XCHGDAC
comma
id|CM_XCHGDAC
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|DEFINE_BIT_SWITCH_ARG
c_func
(paren
id|fourch
comma
id|CM_REG_MISC_CTRL
comma
id|CM_N4SPK3D
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|DEFINE_BIT_SWITCH_ARG
c_func
(paren
id|line_rear
comma
id|CM_REG_MIXER1
comma
id|CM_SPK4
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|DEFINE_BIT_SWITCH_ARG
c_func
(paren
id|line_bass
comma
id|CM_REG_LEGACY_CTRL
comma
id|CM_LINE_AS_BASS
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|DEFINE_BIT_SWITCH_ARG
c_func
(paren
id|joystick
comma
id|CM_REG_FUNCTRL1
comma
id|CM_JYSTK_EN
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|DEFINE_SWITCH_ARG
c_func
(paren
id|modem
comma
id|CM_REG_MISC_CTRL
comma
id|CM_FLINKON
op_or
id|CM_FLINKOFF
comma
id|CM_FLINKON
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
DECL|macro|DEFINE_SWITCH
mdefine_line|#define DEFINE_SWITCH(sname, stype, sarg) &bslash;&n;{ name: sname, &bslash;&n;  iface: stype, &bslash;&n;  info: snd_cmipci_uswitch_info, &bslash;&n;  get: snd_cmipci_uswitch_get, &bslash;&n;  put: snd_cmipci_uswitch_put, &bslash;&n;  private_value: (unsigned long)&amp;cmipci_switch_arg_##sarg,&bslash;&n;}
DECL|macro|DEFINE_CARD_SWITCH
mdefine_line|#define DEFINE_CARD_SWITCH(sname, sarg) DEFINE_SWITCH(sname, SNDRV_CTL_ELEM_IFACE_CARD, sarg)
DECL|macro|DEFINE_MIXER_SWITCH
mdefine_line|#define DEFINE_MIXER_SWITCH(sname, sarg) DEFINE_SWITCH(sname, SNDRV_CTL_ELEM_IFACE_MIXER, sarg)
multiline_comment|/*&n; * callbacks for spdif output switch&n; * needs toggle two registers..&n; */
DECL|function|snd_cmipci_spdout_enable_get
r_static
r_int
id|snd_cmipci_spdout_enable_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
r_int
id|changed
suffix:semicolon
id|changed
op_assign
id|_snd_cmipci_uswitch_get
c_func
(paren
id|kcontrol
comma
id|ucontrol
comma
op_amp
id|cmipci_switch_arg_spdif_enable
)paren
suffix:semicolon
id|changed
op_or_assign
id|_snd_cmipci_uswitch_get
c_func
(paren
id|kcontrol
comma
id|ucontrol
comma
op_amp
id|cmipci_switch_arg_spdo2dac
)paren
suffix:semicolon
r_return
id|changed
suffix:semicolon
)brace
DECL|function|snd_cmipci_spdout_enable_put
r_static
r_int
id|snd_cmipci_spdout_enable_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cmipci_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|changed
suffix:semicolon
id|changed
op_assign
id|_snd_cmipci_uswitch_put
c_func
(paren
id|kcontrol
comma
id|ucontrol
comma
op_amp
id|cmipci_switch_arg_spdif_enable
)paren
suffix:semicolon
id|changed
op_or_assign
id|_snd_cmipci_uswitch_put
c_func
(paren
id|kcontrol
comma
id|ucontrol
comma
op_amp
id|cmipci_switch_arg_spdo2dac
)paren
suffix:semicolon
r_if
c_cond
(paren
id|changed
)paren
(brace
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
(brace
r_if
c_cond
(paren
id|chip-&gt;spdif_playback_avail
)paren
id|snd_cmipci_set_bit
c_func
(paren
id|chip
comma
id|CM_REG_FUNCTRL1
comma
id|CM_PLAYBACK_SPDF
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|chip-&gt;spdif_playback_avail
)paren
id|snd_cmipci_clear_bit
c_func
(paren
id|chip
comma
id|CM_REG_FUNCTRL1
comma
id|CM_PLAYBACK_SPDF
)paren
suffix:semicolon
)brace
)brace
id|chip-&gt;spdif_playback_enabled
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
suffix:semicolon
r_return
id|changed
suffix:semicolon
)brace
multiline_comment|/* both for CM8338/8738 */
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_cmipci_mixer_switches
(braket
)braket
id|__devinitdata
op_assign
(brace
id|DEFINE_MIXER_SWITCH
c_func
(paren
l_string|&quot;Exchange DAC&quot;
comma
id|exchange_dac
)paren
comma
id|DEFINE_MIXER_SWITCH
c_func
(paren
l_string|&quot;Four Channel Mode&quot;
comma
id|fourch
)paren
comma
id|DEFINE_MIXER_SWITCH
c_func
(paren
l_string|&quot;Line-In As Rear&quot;
comma
id|line_rear
)paren
comma
)brace
suffix:semicolon
multiline_comment|/* only for CM8738 */
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_cmipci_8738_mixer_switches
(braket
)braket
id|__devinitdata
op_assign
(brace
macro_line|#if 0 /* controlled in pcm device */
id|DEFINE_MIXER_SWITCH
c_func
(paren
l_string|&quot;IEC958 In Record&quot;
comma
id|spdif_in
)paren
comma
id|DEFINE_MIXER_SWITCH
c_func
(paren
l_string|&quot;IEC958 Out&quot;
comma
id|spdif_0
)paren
comma
id|DEFINE_MIXER_SWITCH
c_func
(paren
l_string|&quot;IEC958 Out 48KHz&quot;
comma
id|spdo_48k
)paren
comma
id|DEFINE_MIXER_SWITCH
c_func
(paren
l_string|&quot;IEC958 Out To DAC&quot;
comma
id|spdo2dac
)paren
comma
macro_line|#endif
singleline_comment|// DEFINE_MIXER_SWITCH(&quot;IEC958 Output Switch&quot;, spdif_enable),
(brace
id|name
suffix:colon
l_string|&quot;IEC958 Output Switch&quot;
comma
id|iface
suffix:colon
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
id|info
suffix:colon
id|snd_cmipci_uswitch_info
comma
id|get
suffix:colon
id|snd_cmipci_spdout_enable_get
comma
id|put
suffix:colon
id|snd_cmipci_spdout_enable_put
comma
)brace
comma
id|DEFINE_MIXER_SWITCH
c_func
(paren
l_string|&quot;IEC958 In Valid&quot;
comma
id|spdi_valid
)paren
comma
id|DEFINE_MIXER_SWITCH
c_func
(paren
l_string|&quot;IEC958 Copyright&quot;
comma
id|spdif_copyright
)paren
comma
id|DEFINE_MIXER_SWITCH
c_func
(paren
l_string|&quot;IEC958 5V&quot;
comma
id|spdo_5v
)paren
comma
id|DEFINE_MIXER_SWITCH
c_func
(paren
l_string|&quot;IEC958 Loop&quot;
comma
id|spdif_loop
)paren
comma
id|DEFINE_MIXER_SWITCH
c_func
(paren
l_string|&quot;IEC958 In Monitor&quot;
comma
id|spdi_monitor
)paren
comma
)brace
suffix:semicolon
multiline_comment|/* only for model 033/037 */
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_cmipci_old_mixer_switches
(braket
)braket
id|__devinitdata
op_assign
(brace
id|DEFINE_MIXER_SWITCH
c_func
(paren
l_string|&quot;IEC958 Mix Analog&quot;
comma
id|spdif_dac_out
)paren
comma
id|DEFINE_MIXER_SWITCH
c_func
(paren
l_string|&quot;IEC958 In Phase Inverse&quot;
comma
id|spdi_phase
)paren
comma
id|DEFINE_MIXER_SWITCH
c_func
(paren
l_string|&quot;IEC958 In Select&quot;
comma
id|spdif_in_sel1
)paren
comma
)brace
suffix:semicolon
multiline_comment|/* only for model 039 or later */
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_cmipci_extra_mixer_switches
(braket
)braket
id|__devinitdata
op_assign
(brace
id|DEFINE_MIXER_SWITCH
c_func
(paren
l_string|&quot;Line-In As Bass&quot;
comma
id|line_bass
)paren
comma
id|DEFINE_MIXER_SWITCH
c_func
(paren
l_string|&quot;IEC958 In Select&quot;
comma
id|spdif_in_sel2
)paren
comma
id|DEFINE_MIXER_SWITCH
c_func
(paren
l_string|&quot;IEC958 In Phase Inverse&quot;
comma
id|spdi_phase2
)paren
comma
)brace
suffix:semicolon
multiline_comment|/* card control switches */
DECL|variable|__devinitdata
r_static
id|snd_kcontrol_new_t
id|snd_cmipci_control_switches
(braket
)braket
id|__devinitdata
op_assign
(brace
id|DEFINE_CARD_SWITCH
c_func
(paren
l_string|&quot;Joystick&quot;
comma
id|joystick
)paren
comma
id|DEFINE_CARD_SWITCH
c_func
(paren
l_string|&quot;Modem&quot;
comma
id|modem
)paren
comma
)brace
suffix:semicolon
DECL|function|snd_cmipci_mixer_new
r_static
r_int
id|__devinit
id|snd_cmipci_mixer_new
c_func
(paren
id|cmipci_t
op_star
id|cm
comma
r_int
id|pcm_spdif_device
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
id|snd_kcontrol_new_t
op_star
id|sw
suffix:semicolon
id|snd_kcontrol_t
op_star
id|kctl
suffix:semicolon
r_int
id|idx
comma
id|err
suffix:semicolon
id|snd_assert
c_func
(paren
id|cm
op_ne
l_int|NULL
op_logical_and
id|cm-&gt;card
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|card
op_assign
id|cm-&gt;card
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;mixername
comma
l_string|&quot;CMedia PCI&quot;
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cmipci_mixer_write
c_func
(paren
id|cm
comma
l_int|0x00
comma
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* mixer reset */
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|cm-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|num_controls
c_func
(paren
id|snd_cmipci_mixers
)paren
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_cmipci_mixers
(braket
id|idx
)braket
comma
id|cm
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* mixer switches */
id|sw
op_assign
id|snd_cmipci_mixer_switches
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|num_controls
c_func
(paren
id|snd_cmipci_mixer_switches
)paren
suffix:semicolon
id|idx
op_increment
comma
id|sw
op_increment
)paren
(brace
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|cm-&gt;card
comma
id|snd_ctl_new1
c_func
(paren
id|sw
comma
id|cm
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cm-&gt;device
op_eq
id|PCI_DEVICE_ID_CMEDIA_CM8738
op_logical_or
id|cm-&gt;device
op_eq
id|PCI_DEVICE_ID_CMEDIA_CM8738B
)paren
(brace
id|sw
op_assign
id|snd_cmipci_8738_mixer_switches
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|num_controls
c_func
(paren
id|snd_cmipci_8738_mixer_switches
)paren
suffix:semicolon
id|idx
op_increment
comma
id|sw
op_increment
)paren
(brace
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|cm-&gt;card
comma
id|snd_ctl_new1
c_func
(paren
id|sw
comma
id|cm
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_cmipci_spdif_default
comma
id|cm
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|kctl-&gt;id.device
op_assign
id|pcm_spdif_device
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_cmipci_spdif_mask
comma
id|cm
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|kctl-&gt;id.device
op_assign
id|pcm_spdif_device
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_cmipci_spdif_stream
comma
id|cm
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|kctl-&gt;id.device
op_assign
id|pcm_spdif_device
suffix:semicolon
id|cm-&gt;spdif_pcm_ctl
op_assign
id|kctl
suffix:semicolon
r_if
c_cond
(paren
id|cm-&gt;chip_version
op_le
l_int|37
)paren
(brace
id|sw
op_assign
id|snd_cmipci_old_mixer_switches
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|num_controls
c_func
(paren
id|snd_cmipci_old_mixer_switches
)paren
suffix:semicolon
id|idx
op_increment
comma
id|sw
op_increment
)paren
(brace
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|cm-&gt;card
comma
id|snd_ctl_new1
c_func
(paren
id|sw
comma
id|cm
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|cm-&gt;chip_version
op_ge
l_int|39
)paren
(brace
id|sw
op_assign
id|snd_cmipci_extra_mixer_switches
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|num_controls
c_func
(paren
id|snd_cmipci_extra_mixer_switches
)paren
suffix:semicolon
id|idx
op_increment
comma
id|sw
op_increment
)paren
(brace
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|cm-&gt;card
comma
id|snd_ctl_new1
c_func
(paren
id|sw
comma
id|cm
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
)brace
multiline_comment|/* card switches */
id|sw
op_assign
id|snd_cmipci_control_switches
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|num_controls
c_func
(paren
id|snd_cmipci_control_switches
)paren
suffix:semicolon
id|idx
op_increment
comma
id|sw
op_increment
)paren
(brace
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|cm-&gt;card
comma
id|snd_ctl_new1
c_func
(paren
id|sw
comma
id|cm
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|CM_SAVED_MIXERS
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|snd_ctl_elem_id_t
id|id
suffix:semicolon
id|snd_kcontrol_t
op_star
id|ctl
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|id
comma
l_int|0
comma
r_sizeof
(paren
id|id
)paren
)paren
suffix:semicolon
id|id.iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
suffix:semicolon
id|strcpy
c_func
(paren
id|id.name
comma
id|cm_saved_mixer
(braket
id|idx
)braket
dot
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ctl
op_assign
id|snd_ctl_find_id
c_func
(paren
id|cm-&gt;card
comma
op_amp
id|id
)paren
)paren
op_ne
l_int|NULL
)paren
id|cm-&gt;mixer_res_ctl
(braket
id|idx
)braket
op_assign
id|ctl
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * proc interface&n; */
DECL|function|snd_cmipci_proc_read
r_static
r_void
id|snd_cmipci_proc_read
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_magic_cast
c_func
(paren
id|cmipci_t
comma
id|entry-&gt;private_data
comma
r_return
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%s&bslash;n&bslash;n&quot;
comma
id|cm-&gt;card-&gt;longname
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x40
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|v
op_assign
id|inb
c_func
(paren
id|cm-&gt;iobase
op_plus
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_mod
l_int|4
op_eq
l_int|0
)paren
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%02x: &quot;
comma
id|i
)paren
suffix:semicolon
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%02x&quot;
comma
id|v
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_mod
l_int|4
op_eq
l_int|3
)paren
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot; &quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_cmipci_proc_init
r_static
r_void
id|__devinit
id|snd_cmipci_proc_init
c_func
(paren
id|cmipci_t
op_star
id|cm
)paren
(brace
id|snd_info_entry_t
op_star
id|entry
suffix:semicolon
r_if
c_cond
(paren
(paren
id|entry
op_assign
id|snd_info_create_card_entry
c_func
(paren
id|cm-&gt;card
comma
l_string|&quot;cmipci&quot;
comma
id|cm-&gt;card-&gt;proc_root
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|entry-&gt;content
op_assign
id|SNDRV_INFO_CONTENT_TEXT
suffix:semicolon
id|entry-&gt;private_data
op_assign
id|cm
suffix:semicolon
id|entry-&gt;mode
op_assign
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IWUSR
suffix:semicolon
id|entry-&gt;c.text.read_size
op_assign
l_int|256
suffix:semicolon
id|entry-&gt;c.text.read
op_assign
id|snd_cmipci_proc_read
suffix:semicolon
r_if
c_cond
(paren
id|snd_info_register
c_func
(paren
id|entry
)paren
OL
l_int|0
)paren
(brace
id|snd_info_free_entry
c_func
(paren
id|entry
)paren
suffix:semicolon
id|entry
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|cm-&gt;proc_entry
op_assign
id|entry
suffix:semicolon
)brace
DECL|function|snd_cmipci_proc_done
r_static
r_void
id|snd_cmipci_proc_done
c_func
(paren
id|cmipci_t
op_star
id|cm
)paren
(brace
r_if
c_cond
(paren
id|cm-&gt;proc_entry
)paren
(brace
id|snd_info_unregister
c_func
(paren
id|cm-&gt;proc_entry
)paren
suffix:semicolon
id|cm-&gt;proc_entry
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
DECL|variable|__devinitdata
r_static
r_struct
id|pci_device_id
id|snd_cmipci_ids
(braket
)braket
id|__devinitdata
op_assign
(brace
(brace
id|PCI_VENDOR_ID_CMEDIA
comma
id|PCI_DEVICE_ID_CMEDIA_CM8338A
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_CMEDIA
comma
id|PCI_DEVICE_ID_CMEDIA_CM8338B
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_CMEDIA
comma
id|PCI_DEVICE_ID_CMEDIA_CM8738
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_CMEDIA
comma
id|PCI_DEVICE_ID_CMEDIA_CM8738B
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|PCI_VENDOR_ID_AL
comma
id|PCI_DEVICE_ID_CMEDIA_CM8738
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
)brace
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * check chip version and capabilities&n; * driver name is modified according to the chip model&n; */
DECL|function|query_chip
r_static
r_void
id|__devinit
id|query_chip
c_func
(paren
id|cmipci_t
op_star
id|cm
)paren
(brace
r_int
r_int
id|detect
suffix:semicolon
multiline_comment|/* check reg 0Ch, bit 24-31 */
id|detect
op_assign
id|snd_cmipci_read
c_func
(paren
id|cm
comma
id|CM_REG_INT_HLDCLR
)paren
op_amp
id|CM_CHIP_MASK2
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|detect
)paren
(brace
multiline_comment|/* check reg 08h, bit 24-28 */
id|detect
op_assign
id|snd_cmipci_read
c_func
(paren
id|cm
comma
id|CM_REG_CHFORMAT
)paren
op_amp
id|CM_CHIP_MASK1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|detect
)paren
(brace
id|cm-&gt;chip_version
op_assign
l_int|33
suffix:semicolon
id|cm-&gt;max_channels
op_assign
l_int|2
suffix:semicolon
id|cm-&gt;can_ac3_sw
op_assign
l_int|1
suffix:semicolon
id|cm-&gt;has_dual_dac
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|cm-&gt;chip_version
op_assign
l_int|37
suffix:semicolon
id|cm-&gt;max_channels
op_assign
l_int|2
suffix:semicolon
id|cm-&gt;can_ac3_hw
op_assign
l_int|1
suffix:semicolon
id|cm-&gt;has_dual_dac
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* check reg 0Ch, bit 26 */
r_if
c_cond
(paren
id|detect
op_amp
id|CM_CHIP_039
)paren
(brace
id|cm-&gt;chip_version
op_assign
l_int|39
suffix:semicolon
r_if
c_cond
(paren
id|detect
op_amp
id|CM_CHIP_039_6CH
)paren
id|cm-&gt;max_channels
op_assign
l_int|6
suffix:semicolon
r_else
id|cm-&gt;max_channels
op_assign
l_int|4
suffix:semicolon
id|cm-&gt;can_ac3_hw
op_assign
l_int|1
suffix:semicolon
id|cm-&gt;has_dual_dac
op_assign
l_int|1
suffix:semicolon
id|cm-&gt;can_multi_ch
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|cm-&gt;chip_version
op_assign
l_int|55
suffix:semicolon
multiline_comment|/* 4 or 6 channels */
id|cm-&gt;max_channels
op_assign
l_int|6
suffix:semicolon
id|cm-&gt;can_ac3_hw
op_assign
l_int|1
suffix:semicolon
id|cm-&gt;has_dual_dac
op_assign
l_int|1
suffix:semicolon
id|cm-&gt;can_multi_ch
op_assign
l_int|1
suffix:semicolon
)brace
)brace
multiline_comment|/* added -MCx suffix for chip supporting multi-channels */
r_if
c_cond
(paren
id|cm-&gt;can_multi_ch
)paren
id|sprintf
c_func
(paren
id|cm-&gt;card-&gt;driver
op_plus
id|strlen
c_func
(paren
id|cm-&gt;card-&gt;driver
)paren
comma
l_string|&quot;-MC%d&quot;
comma
id|cm-&gt;max_channels
)paren
suffix:semicolon
)brace
DECL|function|snd_cmipci_free
r_static
r_int
id|snd_cmipci_free
c_func
(paren
id|cmipci_t
op_star
id|cm
)paren
(brace
id|snd_cmipci_proc_done
c_func
(paren
id|cm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cm-&gt;irq
op_ge
l_int|0
)paren
(brace
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_MISC_CTRL
comma
id|CM_FM_EN
)paren
suffix:semicolon
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_LEGACY_CTRL
comma
id|CM_ENSPDOUT
)paren
suffix:semicolon
id|snd_cmipci_write
c_func
(paren
id|cm
comma
id|CM_REG_INT_HLDCLR
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* disable ints */
id|snd_cmipci_write
c_func
(paren
id|cm
comma
id|CM_REG_FUNCTRL0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* disable channels */
id|snd_cmipci_write
c_func
(paren
id|cm
comma
id|CM_REG_FUNCTRL1
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* reset mixer */
id|snd_cmipci_mixer_write
c_func
(paren
id|cm
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|cm-&gt;irq
comma
(paren
r_void
op_star
)paren
id|cm
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cm-&gt;res_iobase
)paren
(brace
id|release_resource
c_func
(paren
id|cm-&gt;res_iobase
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|cm-&gt;res_iobase
)paren
suffix:semicolon
)brace
id|snd_magic_kfree
c_func
(paren
id|cm
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_dev_free
r_static
r_int
id|snd_cmipci_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|cmipci_t
op_star
id|cm
op_assign
id|snd_magic_cast
c_func
(paren
id|cmipci_t
comma
id|device-&gt;device_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_return
id|snd_cmipci_free
c_func
(paren
id|cm
)paren
suffix:semicolon
)brace
DECL|function|snd_cmipci_create
r_static
r_int
id|__devinit
id|snd_cmipci_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_struct
id|pci_dev
op_star
id|pci
comma
r_int
r_int
id|iomidi
comma
r_int
r_int
id|iosynth
comma
id|cmipci_t
op_star
op_star
id|rcmipci
)paren
(brace
id|cmipci_t
op_star
id|cm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
id|dev_free
suffix:colon
id|snd_cmipci_dev_free
comma
)brace
suffix:semicolon
r_int
r_int
id|val
op_assign
l_int|0
suffix:semicolon
r_int
id|pcm_index
comma
id|pcm_spdif_index
suffix:semicolon
op_star
id|rcmipci
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pci
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|cm
op_assign
id|snd_magic_kcalloc
c_func
(paren
id|cmipci_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cm
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|cm-&gt;reg_lock
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|cm-&gt;open_mutex
)paren
suffix:semicolon
id|cm-&gt;device
op_assign
id|pci-&gt;device
suffix:semicolon
id|cm-&gt;card
op_assign
id|card
suffix:semicolon
id|cm-&gt;pci
op_assign
id|pci
suffix:semicolon
id|cm-&gt;irq
op_assign
op_minus
l_int|1
suffix:semicolon
id|cm-&gt;iobase
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
suffix:semicolon
id|cm-&gt;channel
(braket
l_int|0
)braket
dot
id|ch
op_assign
l_int|0
suffix:semicolon
id|cm-&gt;channel
(braket
l_int|1
)braket
dot
id|ch
op_assign
l_int|1
suffix:semicolon
id|cm-&gt;channel
(braket
l_int|0
)braket
dot
id|is_dac
op_assign
id|cm-&gt;channel
(braket
l_int|1
)braket
dot
id|is_dac
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* dual DAC mode */
r_if
c_cond
(paren
(paren
id|cm-&gt;res_iobase
op_assign
id|request_region
c_func
(paren
id|cm-&gt;iobase
comma
id|CM_EXTENT_CODEC
comma
id|card-&gt;driver
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab ports 0x%lx-0x%lx&bslash;n&quot;
comma
id|cm-&gt;iobase
comma
id|cm-&gt;iobase
op_plus
id|CM_EXTENT_CODEC
op_minus
l_int|1
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|__error
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|pci-&gt;irq
comma
id|snd_cmipci_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
id|card-&gt;driver
comma
(paren
r_void
op_star
)paren
id|cm
)paren
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;unable to grab IRQ %d&bslash;n&quot;
comma
id|pci-&gt;irq
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|__error
suffix:semicolon
)brace
id|cm-&gt;irq
op_assign
id|pci-&gt;irq
suffix:semicolon
id|pci_set_master
c_func
(paren
id|cm-&gt;pci
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * check chip version, max channels and capabilities&n;&t; */
id|cm-&gt;chip_version
op_assign
l_int|0
suffix:semicolon
id|cm-&gt;max_channels
op_assign
l_int|2
suffix:semicolon
id|query_chip
c_func
(paren
id|cm
)paren
suffix:semicolon
id|cm-&gt;dig_status
op_assign
id|SNDRV_PCM_DEFAULT_CON_SPDIF
suffix:semicolon
id|cm-&gt;dig_pcm_status
op_assign
id|SNDRV_PCM_DEFAULT_CON_SPDIF
suffix:semicolon
macro_line|#if CM_CH_PLAY == 1
id|cm-&gt;ctrl
op_assign
id|CM_CHADC0
suffix:semicolon
multiline_comment|/* default FUNCNTRL0 */
macro_line|#else
id|cm-&gt;ctrl
op_assign
id|CM_CHADC1
suffix:semicolon
multiline_comment|/* default FUNCNTRL0 */
macro_line|#endif
multiline_comment|/* initialize codec registers */
id|snd_cmipci_write
c_func
(paren
id|cm
comma
id|CM_REG_INT_HLDCLR
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* disable ints */
id|snd_cmipci_write
c_func
(paren
id|cm
comma
id|CM_REG_FUNCTRL0
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* disable channels */
id|snd_cmipci_write
c_func
(paren
id|cm
comma
id|CM_REG_FUNCTRL1
comma
l_int|0
)paren
suffix:semicolon
id|snd_cmipci_write
c_func
(paren
id|cm
comma
id|CM_REG_CHFORMAT
comma
l_int|0
)paren
suffix:semicolon
id|snd_cmipci_set_bit
c_func
(paren
id|cm
comma
id|CM_REG_MISC_CTRL
comma
id|CM_ENDBDAC
op_or
id|CM_N4SPK3D
)paren
suffix:semicolon
macro_line|#if CM_CH_PLAY == 1
id|snd_cmipci_set_bit
c_func
(paren
id|cm
comma
id|CM_REG_MISC_CTRL
comma
id|CM_XCHGDAC
)paren
suffix:semicolon
macro_line|#else
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_MISC_CTRL
comma
id|CM_XCHGDAC
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* set MPU address */
r_switch
c_cond
(paren
id|iomidi
)paren
(brace
r_case
l_int|0x320
suffix:colon
id|val
op_assign
id|CM_VMPU_320
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x310
suffix:colon
id|val
op_assign
id|CM_VMPU_310
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x300
suffix:colon
id|val
op_assign
id|CM_VMPU_300
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x330
suffix:colon
id|val
op_assign
id|CM_VMPU_330
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|iomidi
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|iomidi
OG
l_int|0
)paren
(brace
id|snd_cmipci_write
c_func
(paren
id|cm
comma
id|CM_REG_LEGACY_CTRL
comma
id|val
)paren
suffix:semicolon
multiline_comment|/* enable UART */
id|snd_cmipci_set_bit
c_func
(paren
id|cm
comma
id|CM_REG_FUNCTRL1
comma
id|CM_UART_EN
)paren
suffix:semicolon
)brace
multiline_comment|/* set FM address */
id|val
op_assign
id|snd_cmipci_read
c_func
(paren
id|cm
comma
id|CM_REG_LEGACY_CTRL
)paren
op_amp
op_complement
id|CM_FMSEL_MASK
suffix:semicolon
r_switch
c_cond
(paren
id|iosynth
)paren
(brace
r_case
l_int|0x3E8
suffix:colon
id|val
op_or_assign
id|CM_FMSEL_3E8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3E0
suffix:colon
id|val
op_or_assign
id|CM_FMSEL_3E0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3C8
suffix:colon
id|val
op_or_assign
id|CM_FMSEL_3C8
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x388
suffix:colon
id|val
op_or_assign
id|CM_FMSEL_388
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|iosynth
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|iosynth
OG
l_int|0
)paren
(brace
id|snd_cmipci_write
c_func
(paren
id|cm
comma
id|CM_REG_LEGACY_CTRL
comma
id|val
)paren
suffix:semicolon
multiline_comment|/* enable FM */
id|snd_cmipci_set_bit
c_func
(paren
id|cm
comma
id|CM_REG_MISC_CTRL
comma
id|CM_FM_EN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_opl3_create
c_func
(paren
id|card
comma
id|iosynth
comma
id|iosynth
op_plus
l_int|2
comma
id|OPL3_HW_OPL3
comma
l_int|0
comma
op_amp
id|cm-&gt;opl3
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cmipci: no OPL device at 0x%lx, skipping...&bslash;n&quot;
comma
id|iosynth
)paren
suffix:semicolon
id|iosynth
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_opl3_hwdep_new
c_func
(paren
id|cm-&gt;opl3
comma
l_int|0
comma
l_int|1
comma
op_amp
id|cm-&gt;opl3hwdep
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cmipci: cannot create OPL3 hwdep&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|iosynth
)paren
(brace
multiline_comment|/* disable FM */
id|snd_cmipci_write
c_func
(paren
id|cm
comma
id|CM_REG_LEGACY_CTRL
comma
id|val
op_amp
op_complement
id|CM_FMSEL_MASK
)paren
suffix:semicolon
id|snd_cmipci_clear_bit
c_func
(paren
id|cm
comma
id|CM_REG_MISC_CTRL
comma
id|CM_FM_EN
)paren
suffix:semicolon
)brace
multiline_comment|/* reset mixer */
id|snd_cmipci_mixer_write
c_func
(paren
id|cm
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|snd_cmipci_proc_init
c_func
(paren
id|cm
)paren
suffix:semicolon
multiline_comment|/* create pcm devices */
id|pcm_index
op_assign
id|pcm_spdif_index
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_cmipci_pcm_new
c_func
(paren
id|cm
comma
id|pcm_index
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__error
suffix:semicolon
id|pcm_index
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|cm-&gt;has_dual_dac
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_cmipci_pcm2_new
c_func
(paren
id|cm
comma
id|pcm_index
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__error
suffix:semicolon
id|pcm_index
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cm-&gt;can_ac3_hw
op_logical_or
id|cm-&gt;can_ac3_sw
)paren
(brace
id|pcm_spdif_index
op_assign
id|pcm_index
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_cmipci_pcm_spdif_new
c_func
(paren
id|cm
comma
id|pcm_index
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__error
suffix:semicolon
)brace
multiline_comment|/* create mixer interface &amp; switches */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_cmipci_mixer_new
c_func
(paren
id|cm
comma
id|pcm_spdif_index
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__error
suffix:semicolon
r_if
c_cond
(paren
id|iomidi
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_mpu401_uart_new
c_func
(paren
id|card
comma
l_int|0
comma
id|MPU401_HW_CMIPCI
comma
id|iomidi
comma
l_int|0
comma
id|cm-&gt;irq
comma
l_int|0
comma
op_amp
id|cm-&gt;rmidi
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cmipci: no UART401 device at 0x%lx&bslash;n&quot;
comma
id|iomidi
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|cm
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_cmipci_free
c_func
(paren
id|cm
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
op_star
id|rcmipci
op_assign
id|cm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|__error
suffix:colon
id|snd_cmipci_free
c_func
(paren
id|cm
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; */
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|snd_cmipci_ids
)paren
suffix:semicolon
DECL|function|snd_cmipci_probe
r_static
r_int
id|__devinit
id|snd_cmipci_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_const
r_struct
id|pci_device_id
op_star
id|id
)paren
(brace
r_static
r_int
id|dev
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
id|cmipci_t
op_star
id|cm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_ge
id|SNDRV_CARDS
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_enable
(braket
id|dev
)braket
)paren
(brace
id|dev
op_increment
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|card
op_assign
id|snd_card_new
c_func
(paren
id|snd_index
(braket
id|dev
)braket
comma
id|snd_id
(braket
id|dev
)braket
comma
id|THIS_MODULE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_switch
c_cond
(paren
id|pci-&gt;device
)paren
(brace
r_case
id|PCI_DEVICE_ID_CMEDIA_CM8738
suffix:colon
r_case
id|PCI_DEVICE_ID_CMEDIA_CM8738B
suffix:colon
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;CMI8738&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_CMEDIA_CM8338A
suffix:colon
r_case
id|PCI_DEVICE_ID_CMEDIA_CM8338B
suffix:colon
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;CMI8338&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;CMIPCI&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_cmipci_create
c_func
(paren
id|card
comma
id|pci
comma
id|snd_mpu_port
(braket
id|dev
)braket
comma
id|snd_fm_port
(braket
id|dev
)braket
comma
op_amp
id|cm
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|sprintf
c_func
(paren
id|card-&gt;shortname
comma
l_string|&quot;C-Media PCI %s&quot;
comma
id|card-&gt;driver
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;%s (model %d) at 0x%lx, irq %i&quot;
comma
id|card-&gt;shortname
comma
id|cm-&gt;chip_version
comma
id|cm-&gt;iobase
comma
id|cm-&gt;irq
)paren
suffix:semicolon
singleline_comment|//snd_printd(&quot;%s is detected&bslash;n&quot;, card-&gt;longname);
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_card_register
c_func
(paren
id|card
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pci
comma
id|card
)paren
suffix:semicolon
id|dev
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cmipci_remove
r_static
r_void
id|__devexit
id|snd_cmipci_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
id|snd_card_free
c_func
(paren
id|pci_get_drvdata
c_func
(paren
id|pci
)paren
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|driver
r_static
r_struct
id|pci_driver
id|driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;C-Media PCI&quot;
comma
id|id_table
suffix:colon
id|snd_cmipci_ids
comma
id|probe
suffix:colon
id|snd_cmipci_probe
comma
id|remove
suffix:colon
id|__devexit_p
c_func
(paren
id|snd_cmipci_remove
)paren
comma
)brace
suffix:semicolon
DECL|function|alsa_card_cmipci_init
r_static
r_int
id|__init
id|alsa_card_cmipci_init
c_func
(paren
r_void
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_module_init
c_func
(paren
op_amp
id|driver
)paren
)paren
OL
l_int|0
)paren
(brace
macro_line|#ifdef MODULE
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;C-Media PCI soundcard not found or device busy&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|alsa_card_cmipci_exit
r_static
r_void
id|__exit
id|alsa_card_cmipci_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|alsa_card_cmipci_init
)paren
id|module_exit
c_func
(paren
id|alsa_card_cmipci_exit
)paren
macro_line|#ifndef MODULE
multiline_comment|/* format is: snd-cmipci=snd_enable,snd_index,snd_id,&n;&t;&t;&t; snd_mpu_port,snd_fm_port */
DECL|function|alsa_card_cmipci_setup
r_static
r_int
id|__init
id|alsa_card_cmipci_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_static
r_int
id|__initdata
id|nr_dev
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|nr_dev
op_ge
id|SNDRV_CARDS
)paren
r_return
l_int|0
suffix:semicolon
(paren
r_void
)paren
(paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_enable
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_index
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_id
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_id
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_option
c_func
(paren
op_amp
id|str
comma
(paren
r_int
op_star
)paren
op_amp
id|snd_mpu_port
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_option
c_func
(paren
op_amp
id|str
comma
(paren
r_int
op_star
)paren
op_amp
id|snd_fm_port
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
)paren
suffix:semicolon
id|nr_dev
op_increment
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;snd-cmipci=&quot;
comma
id|alsa_card_cmipci_setup
)paren
suffix:semicolon
macro_line|#endif /* ifndef MODULE */
eof
