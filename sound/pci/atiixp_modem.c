multiline_comment|/*&n; *   ALSA driver for ATI IXP 150/200/250 AC97 modem controllers&n; *&n; *&t;Copyright (c) 2004 Takashi Iwai &lt;tiwai@suse.de&gt;&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
macro_line|#include &lt;sound/pcm_params.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#include &lt;sound/ac97_codec.h&gt;
macro_line|#include &lt;sound/initval.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Takashi Iwai &lt;tiwai@suse.de&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;ATI IXP MC97 controller&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_SUPPORTED_DEVICE
c_func
(paren
l_string|&quot;{{ATI,IXP150/200/250}}&quot;
)paren
suffix:semicolon
DECL|variable|index
r_static
r_int
id|index
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_IDX
suffix:semicolon
multiline_comment|/* Index 0-MAX */
DECL|variable|id
r_static
r_char
op_star
id|id
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_STR
suffix:semicolon
multiline_comment|/* ID for this card */
DECL|variable|enable
r_static
r_int
id|enable
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_ENABLE_PNP
suffix:semicolon
multiline_comment|/* Enable this card */
DECL|variable|ac97_clock
r_static
r_int
id|ac97_clock
(braket
id|SNDRV_CARDS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
(paren
id|SNDRV_CARDS
op_minus
l_int|1
)paren
)braket
op_assign
l_int|48000
)brace
suffix:semicolon
DECL|variable|boot_devs
r_static
r_int
id|boot_devs
suffix:semicolon
id|module_param_array
c_func
(paren
id|index
comma
r_int
comma
id|boot_devs
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|index
comma
l_string|&quot;Index value for ATI IXP controller.&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|id
comma
id|charp
comma
id|boot_devs
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|id
comma
l_string|&quot;ID string for ATI IXP controller.&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|enable
comma
r_bool
comma
id|boot_devs
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|enable
comma
l_string|&quot;Enable audio part of ATI IXP controller.&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|ac97_clock
comma
r_int
comma
id|boot_devs
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|ac97_clock
comma
l_string|&quot;AC&squot;97 codec clock (default 48000Hz).&quot;
)paren
suffix:semicolon
multiline_comment|/*&n; */
DECL|macro|ATI_REG_ISR
mdefine_line|#define ATI_REG_ISR&t;&t;&t;0x00&t;/* interrupt source */
DECL|macro|ATI_REG_ISR_MODEM_IN_XRUN
mdefine_line|#define  ATI_REG_ISR_MODEM_IN_XRUN&t;(1U&lt;&lt;0)
DECL|macro|ATI_REG_ISR_MODEM_IN_STATUS
mdefine_line|#define  ATI_REG_ISR_MODEM_IN_STATUS&t;(1U&lt;&lt;1)
DECL|macro|ATI_REG_ISR_MODEM_OUT1_XRUN
mdefine_line|#define  ATI_REG_ISR_MODEM_OUT1_XRUN&t;(1U&lt;&lt;2)
DECL|macro|ATI_REG_ISR_MODEM_OUT1_STATUS
mdefine_line|#define  ATI_REG_ISR_MODEM_OUT1_STATUS&t;(1U&lt;&lt;3)
DECL|macro|ATI_REG_ISR_MODEM_OUT2_XRUN
mdefine_line|#define  ATI_REG_ISR_MODEM_OUT2_XRUN&t;(1U&lt;&lt;4)
DECL|macro|ATI_REG_ISR_MODEM_OUT2_STATUS
mdefine_line|#define  ATI_REG_ISR_MODEM_OUT2_STATUS&t;(1U&lt;&lt;5)
DECL|macro|ATI_REG_ISR_MODEM_OUT3_XRUN
mdefine_line|#define  ATI_REG_ISR_MODEM_OUT3_XRUN&t;(1U&lt;&lt;6)
DECL|macro|ATI_REG_ISR_MODEM_OUT3_STATUS
mdefine_line|#define  ATI_REG_ISR_MODEM_OUT3_STATUS&t;(1U&lt;&lt;7)
DECL|macro|ATI_REG_ISR_PHYS_INTR
mdefine_line|#define  ATI_REG_ISR_PHYS_INTR&t;&t;(1U&lt;&lt;8)
DECL|macro|ATI_REG_ISR_PHYS_MISMATCH
mdefine_line|#define  ATI_REG_ISR_PHYS_MISMATCH&t;(1U&lt;&lt;9)
DECL|macro|ATI_REG_ISR_CODEC0_NOT_READY
mdefine_line|#define  ATI_REG_ISR_CODEC0_NOT_READY&t;(1U&lt;&lt;10)
DECL|macro|ATI_REG_ISR_CODEC1_NOT_READY
mdefine_line|#define  ATI_REG_ISR_CODEC1_NOT_READY&t;(1U&lt;&lt;11)
DECL|macro|ATI_REG_ISR_CODEC2_NOT_READY
mdefine_line|#define  ATI_REG_ISR_CODEC2_NOT_READY&t;(1U&lt;&lt;12)
DECL|macro|ATI_REG_ISR_NEW_FRAME
mdefine_line|#define  ATI_REG_ISR_NEW_FRAME&t;&t;(1U&lt;&lt;13)
DECL|macro|ATI_REG_ISR_MODEM_GPIO_DATA
mdefine_line|#define  ATI_REG_ISR_MODEM_GPIO_DATA&t;(1U&lt;&lt;14)
DECL|macro|ATI_REG_IER
mdefine_line|#define ATI_REG_IER&t;&t;&t;0x04&t;/* interrupt enable */
DECL|macro|ATI_REG_IER_MODEM_IN_XRUN_EN
mdefine_line|#define  ATI_REG_IER_MODEM_IN_XRUN_EN&t;(1U&lt;&lt;0)
DECL|macro|ATI_REG_IER_MODEM_STATUS_EN
mdefine_line|#define  ATI_REG_IER_MODEM_STATUS_EN&t;(1U&lt;&lt;1)
DECL|macro|ATI_REG_IER_MODEM_OUT1_XRUN_EN
mdefine_line|#define  ATI_REG_IER_MODEM_OUT1_XRUN_EN&t;(1U&lt;&lt;2)
DECL|macro|ATI_REG_IER_MODEM_OUT2_XRUN_EN
mdefine_line|#define  ATI_REG_IER_MODEM_OUT2_XRUN_EN&t;(1U&lt;&lt;4)
DECL|macro|ATI_REG_IER_MODEM_OUT3_XRUN_EN
mdefine_line|#define  ATI_REG_IER_MODEM_OUT3_XRUN_EN&t;(1U&lt;&lt;6)
DECL|macro|ATI_REG_IER_PHYS_INTR_EN
mdefine_line|#define  ATI_REG_IER_PHYS_INTR_EN&t;(1U&lt;&lt;8)
DECL|macro|ATI_REG_IER_PHYS_MISMATCH_EN
mdefine_line|#define  ATI_REG_IER_PHYS_MISMATCH_EN&t;(1U&lt;&lt;9)
DECL|macro|ATI_REG_IER_CODEC0_INTR_EN
mdefine_line|#define  ATI_REG_IER_CODEC0_INTR_EN&t;(1U&lt;&lt;10)
DECL|macro|ATI_REG_IER_CODEC1_INTR_EN
mdefine_line|#define  ATI_REG_IER_CODEC1_INTR_EN&t;(1U&lt;&lt;11)
DECL|macro|ATI_REG_IER_CODEC2_INTR_EN
mdefine_line|#define  ATI_REG_IER_CODEC2_INTR_EN&t;(1U&lt;&lt;12)
DECL|macro|ATI_REG_IER_NEW_FRAME_EN
mdefine_line|#define  ATI_REG_IER_NEW_FRAME_EN&t;(1U&lt;&lt;13)&t;/* (RO */
DECL|macro|ATI_REG_IER_MODEM_GPIO_DATA_EN
mdefine_line|#define  ATI_REG_IER_MODEM_GPIO_DATA_EN&t;(1U&lt;&lt;14)&t;/* (WO) modem is running */
DECL|macro|ATI_REG_IER_MODEM_SET_BUS_BUSY
mdefine_line|#define  ATI_REG_IER_MODEM_SET_BUS_BUSY&t;(1U&lt;&lt;15)
DECL|macro|ATI_REG_CMD
mdefine_line|#define ATI_REG_CMD&t;&t;&t;0x08&t;/* command */
DECL|macro|ATI_REG_CMD_POWERDOWN
mdefine_line|#define  ATI_REG_CMD_POWERDOWN&t;(1U&lt;&lt;0)
DECL|macro|ATI_REG_CMD_MODEM_RECEIVE_EN
mdefine_line|#define  ATI_REG_CMD_MODEM_RECEIVE_EN&t;(1U&lt;&lt;1)&t;/* modem only */
DECL|macro|ATI_REG_CMD_MODEM_SEND1_EN
mdefine_line|#define  ATI_REG_CMD_MODEM_SEND1_EN&t;(1U&lt;&lt;2)&t;/* modem only */
DECL|macro|ATI_REG_CMD_MODEM_SEND2_EN
mdefine_line|#define  ATI_REG_CMD_MODEM_SEND2_EN&t;(1U&lt;&lt;3)&t;/* modem only */
DECL|macro|ATI_REG_CMD_MODEM_SEND3_EN
mdefine_line|#define  ATI_REG_CMD_MODEM_SEND3_EN&t;(1U&lt;&lt;4)&t;/* modem only */
DECL|macro|ATI_REG_CMD_MODEM_STATUS_MEM
mdefine_line|#define  ATI_REG_CMD_MODEM_STATUS_MEM&t;(1U&lt;&lt;5)&t;/* modem only */
DECL|macro|ATI_REG_CMD_MODEM_IN_DMA_EN
mdefine_line|#define  ATI_REG_CMD_MODEM_IN_DMA_EN&t;(1U&lt;&lt;8)&t;/* modem only */
DECL|macro|ATI_REG_CMD_MODEM_OUT_DMA1_EN
mdefine_line|#define  ATI_REG_CMD_MODEM_OUT_DMA1_EN&t;(1U&lt;&lt;9)&t;/* modem only */
DECL|macro|ATI_REG_CMD_MODEM_OUT_DMA2_EN
mdefine_line|#define  ATI_REG_CMD_MODEM_OUT_DMA2_EN&t;(1U&lt;&lt;10)&t;/* modem only */
DECL|macro|ATI_REG_CMD_MODEM_OUT_DMA3_EN
mdefine_line|#define  ATI_REG_CMD_MODEM_OUT_DMA3_EN&t;(1U&lt;&lt;11)&t;/* modem only */
DECL|macro|ATI_REG_CMD_AUDIO_PRESENT
mdefine_line|#define  ATI_REG_CMD_AUDIO_PRESENT&t;(1U&lt;&lt;20)
DECL|macro|ATI_REG_CMD_MODEM_GPIO_THRU_DMA
mdefine_line|#define  ATI_REG_CMD_MODEM_GPIO_THRU_DMA&t;(1U&lt;&lt;22)&t;/* modem only */
DECL|macro|ATI_REG_CMD_LOOPBACK_EN
mdefine_line|#define  ATI_REG_CMD_LOOPBACK_EN&t;(1U&lt;&lt;23)
DECL|macro|ATI_REG_CMD_PACKED_DIS
mdefine_line|#define  ATI_REG_CMD_PACKED_DIS&t;&t;(1U&lt;&lt;24)
DECL|macro|ATI_REG_CMD_BURST_EN
mdefine_line|#define  ATI_REG_CMD_BURST_EN&t;&t;(1U&lt;&lt;25)
DECL|macro|ATI_REG_CMD_PANIC_EN
mdefine_line|#define  ATI_REG_CMD_PANIC_EN&t;&t;(1U&lt;&lt;26)
DECL|macro|ATI_REG_CMD_MODEM_PRESENT
mdefine_line|#define  ATI_REG_CMD_MODEM_PRESENT&t;(1U&lt;&lt;27)
DECL|macro|ATI_REG_CMD_ACLINK_ACTIVE
mdefine_line|#define  ATI_REG_CMD_ACLINK_ACTIVE&t;(1U&lt;&lt;28)
DECL|macro|ATI_REG_CMD_AC_SOFT_RESET
mdefine_line|#define  ATI_REG_CMD_AC_SOFT_RESET&t;(1U&lt;&lt;29)
DECL|macro|ATI_REG_CMD_AC_SYNC
mdefine_line|#define  ATI_REG_CMD_AC_SYNC&t;&t;(1U&lt;&lt;30)
DECL|macro|ATI_REG_CMD_AC_RESET
mdefine_line|#define  ATI_REG_CMD_AC_RESET&t;&t;(1U&lt;&lt;31)
DECL|macro|ATI_REG_PHYS_OUT_ADDR
mdefine_line|#define ATI_REG_PHYS_OUT_ADDR&t;&t;0x0c
DECL|macro|ATI_REG_PHYS_OUT_CODEC_MASK
mdefine_line|#define  ATI_REG_PHYS_OUT_CODEC_MASK&t;(3U&lt;&lt;0)
DECL|macro|ATI_REG_PHYS_OUT_RW
mdefine_line|#define  ATI_REG_PHYS_OUT_RW&t;&t;(1U&lt;&lt;2)
DECL|macro|ATI_REG_PHYS_OUT_ADDR_EN
mdefine_line|#define  ATI_REG_PHYS_OUT_ADDR_EN&t;(1U&lt;&lt;8)
DECL|macro|ATI_REG_PHYS_OUT_ADDR_SHIFT
mdefine_line|#define  ATI_REG_PHYS_OUT_ADDR_SHIFT&t;9
DECL|macro|ATI_REG_PHYS_OUT_DATA_SHIFT
mdefine_line|#define  ATI_REG_PHYS_OUT_DATA_SHIFT&t;16
DECL|macro|ATI_REG_PHYS_IN_ADDR
mdefine_line|#define ATI_REG_PHYS_IN_ADDR&t;&t;0x10
DECL|macro|ATI_REG_PHYS_IN_READ_FLAG
mdefine_line|#define  ATI_REG_PHYS_IN_READ_FLAG&t;(1U&lt;&lt;8)
DECL|macro|ATI_REG_PHYS_IN_ADDR_SHIFT
mdefine_line|#define  ATI_REG_PHYS_IN_ADDR_SHIFT&t;9
DECL|macro|ATI_REG_PHYS_IN_DATA_SHIFT
mdefine_line|#define  ATI_REG_PHYS_IN_DATA_SHIFT&t;16
DECL|macro|ATI_REG_SLOTREQ
mdefine_line|#define ATI_REG_SLOTREQ&t;&t;&t;0x14
DECL|macro|ATI_REG_COUNTER
mdefine_line|#define ATI_REG_COUNTER&t;&t;&t;0x18
DECL|macro|ATI_REG_COUNTER_SLOT
mdefine_line|#define  ATI_REG_COUNTER_SLOT&t;&t;(3U&lt;&lt;0)&t;/* slot # */
DECL|macro|ATI_REG_COUNTER_BITCLOCK
mdefine_line|#define  ATI_REG_COUNTER_BITCLOCK&t;(31U&lt;&lt;8)
DECL|macro|ATI_REG_IN_FIFO_THRESHOLD
mdefine_line|#define ATI_REG_IN_FIFO_THRESHOLD&t;0x1c
DECL|macro|ATI_REG_MODEM_IN_DMA_LINKPTR
mdefine_line|#define ATI_REG_MODEM_IN_DMA_LINKPTR&t;0x20
DECL|macro|ATI_REG_MODEM_IN_DMA_DT_START
mdefine_line|#define ATI_REG_MODEM_IN_DMA_DT_START&t;0x24&t;/* RO */
DECL|macro|ATI_REG_MODEM_IN_DMA_DT_NEXT
mdefine_line|#define ATI_REG_MODEM_IN_DMA_DT_NEXT&t;0x28&t;/* RO */
DECL|macro|ATI_REG_MODEM_IN_DMA_DT_CUR
mdefine_line|#define ATI_REG_MODEM_IN_DMA_DT_CUR&t;0x2c&t;/* RO */
DECL|macro|ATI_REG_MODEM_IN_DMA_DT_SIZE
mdefine_line|#define ATI_REG_MODEM_IN_DMA_DT_SIZE&t;0x30
DECL|macro|ATI_REG_MODEM_OUT_FIFO
mdefine_line|#define ATI_REG_MODEM_OUT_FIFO&t;&t;0x34&t;/* output threshold */
DECL|macro|ATI_REG_MODEM_OUT1_DMA_THRESHOLD_MASK
mdefine_line|#define  ATI_REG_MODEM_OUT1_DMA_THRESHOLD_MASK&t;(0xf&lt;&lt;16)
DECL|macro|ATI_REG_MODEM_OUT1_DMA_THRESHOLD_SHIFT
mdefine_line|#define  ATI_REG_MODEM_OUT1_DMA_THRESHOLD_SHIFT&t;16
DECL|macro|ATI_REG_MODEM_OUT_DMA1_LINKPTR
mdefine_line|#define ATI_REG_MODEM_OUT_DMA1_LINKPTR&t;0x38
DECL|macro|ATI_REG_MODEM_OUT_DMA2_LINKPTR
mdefine_line|#define ATI_REG_MODEM_OUT_DMA2_LINKPTR&t;0x3c
DECL|macro|ATI_REG_MODEM_OUT_DMA3_LINKPTR
mdefine_line|#define ATI_REG_MODEM_OUT_DMA3_LINKPTR&t;0x40
DECL|macro|ATI_REG_MODEM_OUT_DMA1_DT_START
mdefine_line|#define ATI_REG_MODEM_OUT_DMA1_DT_START&t;0x44
DECL|macro|ATI_REG_MODEM_OUT_DMA1_DT_NEXT
mdefine_line|#define ATI_REG_MODEM_OUT_DMA1_DT_NEXT&t;0x48
DECL|macro|ATI_REG_MODEM_OUT_DMA1_DT_CUR
mdefine_line|#define ATI_REG_MODEM_OUT_DMA1_DT_CUR&t;0x4c
DECL|macro|ATI_REG_MODEM_OUT_DMA2_DT_START
mdefine_line|#define ATI_REG_MODEM_OUT_DMA2_DT_START&t;0x50
DECL|macro|ATI_REG_MODEM_OUT_DMA2_DT_NEXT
mdefine_line|#define ATI_REG_MODEM_OUT_DMA2_DT_NEXT&t;0x54
DECL|macro|ATI_REG_MODEM_OUT_DMA2_DT_CUR
mdefine_line|#define ATI_REG_MODEM_OUT_DMA2_DT_CUR&t;0x58
DECL|macro|ATI_REG_MODEM_OUT_DMA3_DT_START
mdefine_line|#define ATI_REG_MODEM_OUT_DMA3_DT_START&t;0x5c
DECL|macro|ATI_REG_MODEM_OUT_DMA3_DT_NEXT
mdefine_line|#define ATI_REG_MODEM_OUT_DMA3_DT_NEXT&t;0x60
DECL|macro|ATI_REG_MODEM_OUT_DMA3_DT_CUR
mdefine_line|#define ATI_REG_MODEM_OUT_DMA3_DT_CUR&t;0x64
DECL|macro|ATI_REG_MODEM_OUT_DMA12_DT_SIZE
mdefine_line|#define ATI_REG_MODEM_OUT_DMA12_DT_SIZE&t;0x68
DECL|macro|ATI_REG_MODEM_OUT_DMA3_DT_SIZE
mdefine_line|#define ATI_REG_MODEM_OUT_DMA3_DT_SIZE&t;0x6c
DECL|macro|ATI_REG_MODEM_OUT_FIFO_USED
mdefine_line|#define ATI_REG_MODEM_OUT_FIFO_USED     0x70
DECL|macro|ATI_REG_MODEM_OUT_GPIO
mdefine_line|#define ATI_REG_MODEM_OUT_GPIO&t;&t;0x74
DECL|macro|ATI_REG_MODEM_OUT_GPIO_EN
mdefine_line|#define  ATI_REG_MODEM_OUT_GPIO_EN&t;   1
DECL|macro|ATI_REG_MODEM_OUT_GPIO_DATA_SHIFT
mdefine_line|#define  ATI_REG_MODEM_OUT_GPIO_DATA_SHIFT 5
DECL|macro|ATI_REG_MODEM_IN_GPIO
mdefine_line|#define ATI_REG_MODEM_IN_GPIO&t;&t;0x78
DECL|macro|ATI_REG_MODEM_MIRROR
mdefine_line|#define ATI_REG_MODEM_MIRROR&t;&t;0x7c
DECL|macro|ATI_REG_AUDIO_MIRROR
mdefine_line|#define ATI_REG_AUDIO_MIRROR&t;&t;0x80
DECL|macro|ATI_REG_MODEM_FIFO_FLUSH
mdefine_line|#define ATI_REG_MODEM_FIFO_FLUSH&t;0x88
DECL|macro|ATI_REG_MODEM_FIFO_OUT1_FLUSH
mdefine_line|#define  ATI_REG_MODEM_FIFO_OUT1_FLUSH&t;(1U&lt;&lt;0)
DECL|macro|ATI_REG_MODEM_FIFO_OUT2_FLUSH
mdefine_line|#define  ATI_REG_MODEM_FIFO_OUT2_FLUSH&t;(1U&lt;&lt;1)
DECL|macro|ATI_REG_MODEM_FIFO_OUT3_FLUSH
mdefine_line|#define  ATI_REG_MODEM_FIFO_OUT3_FLUSH&t;(1U&lt;&lt;2)
DECL|macro|ATI_REG_MODEM_FIFO_IN_FLUSH
mdefine_line|#define  ATI_REG_MODEM_FIFO_IN_FLUSH&t;(1U&lt;&lt;3)
multiline_comment|/* LINKPTR */
DECL|macro|ATI_REG_LINKPTR_EN
mdefine_line|#define  ATI_REG_LINKPTR_EN&t;&t;(1U&lt;&lt;0)
DECL|macro|ATI_MEM_REGION
mdefine_line|#define ATI_MEM_REGION&t;&t;256&t;/* i/o memory size */
DECL|macro|ATI_MAX_DESCRIPTORS
mdefine_line|#define ATI_MAX_DESCRIPTORS&t;256&t;/* max number of descriptor packets */
multiline_comment|/*&n; */
DECL|typedef|atiixp_t
r_typedef
r_struct
id|snd_atiixp
id|atiixp_t
suffix:semicolon
DECL|typedef|atiixp_dma_t
r_typedef
r_struct
id|snd_atiixp_dma
id|atiixp_dma_t
suffix:semicolon
DECL|typedef|atiixp_dma_ops_t
r_typedef
r_struct
id|snd_atiixp_dma_ops
id|atiixp_dma_ops_t
suffix:semicolon
multiline_comment|/*&n; * DMA packate descriptor&n; */
DECL|struct|atiixp_dma_desc
r_typedef
r_struct
id|atiixp_dma_desc
(brace
DECL|member|addr
id|u32
id|addr
suffix:semicolon
multiline_comment|/* DMA buffer address */
DECL|member|status
id|u16
id|status
suffix:semicolon
multiline_comment|/* status bits */
DECL|member|size
id|u16
id|size
suffix:semicolon
multiline_comment|/* size of the packet in dwords */
DECL|member|next
id|u32
id|next
suffix:semicolon
multiline_comment|/* address of the next packet descriptor */
DECL|typedef|atiixp_dma_desc_t
)brace
id|atiixp_dma_desc_t
suffix:semicolon
multiline_comment|/*&n; * stream enum&n; */
DECL|enumerator|ATI_DMA_PLAYBACK
DECL|enumerator|ATI_DMA_CAPTURE
DECL|enumerator|NUM_ATI_DMAS
r_enum
(brace
id|ATI_DMA_PLAYBACK
comma
id|ATI_DMA_CAPTURE
comma
id|NUM_ATI_DMAS
)brace
suffix:semicolon
multiline_comment|/* DMAs */
DECL|enumerator|ATI_PCM_OUT
DECL|enumerator|ATI_PCM_IN
DECL|enumerator|NUM_ATI_PCMS
r_enum
(brace
id|ATI_PCM_OUT
comma
id|ATI_PCM_IN
comma
id|NUM_ATI_PCMS
)brace
suffix:semicolon
multiline_comment|/* AC97 pcm slots */
DECL|enumerator|ATI_PCMDEV_ANALOG
DECL|enumerator|NUM_ATI_PCMDEVS
r_enum
(brace
id|ATI_PCMDEV_ANALOG
comma
id|NUM_ATI_PCMDEVS
)brace
suffix:semicolon
multiline_comment|/* pcm devices */
DECL|macro|NUM_ATI_CODECS
mdefine_line|#define NUM_ATI_CODECS&t;3
multiline_comment|/*&n; * constants and callbacks for each DMA type&n; */
DECL|struct|snd_atiixp_dma_ops
r_struct
id|snd_atiixp_dma_ops
(brace
DECL|member|type
r_int
id|type
suffix:semicolon
multiline_comment|/* ATI_DMA_XXX */
DECL|member|llp_offset
r_int
r_int
id|llp_offset
suffix:semicolon
multiline_comment|/* LINKPTR offset */
DECL|member|dt_cur
r_int
r_int
id|dt_cur
suffix:semicolon
multiline_comment|/* DT_CUR offset */
DECL|member|enable_dma
r_void
(paren
op_star
id|enable_dma
)paren
(paren
id|atiixp_t
op_star
id|chip
comma
r_int
id|on
)paren
suffix:semicolon
multiline_comment|/* called from open callback */
DECL|member|enable_transfer
r_void
(paren
op_star
id|enable_transfer
)paren
(paren
id|atiixp_t
op_star
id|chip
comma
r_int
id|on
)paren
suffix:semicolon
multiline_comment|/* called from trigger (START/STOP) */
DECL|member|flush_dma
r_void
(paren
op_star
id|flush_dma
)paren
(paren
id|atiixp_t
op_star
id|chip
)paren
suffix:semicolon
multiline_comment|/* called from trigger (STOP only) */
)brace
suffix:semicolon
multiline_comment|/*&n; * DMA stream&n; */
DECL|struct|snd_atiixp_dma
r_struct
id|snd_atiixp_dma
(brace
DECL|member|ops
r_const
id|atiixp_dma_ops_t
op_star
id|ops
suffix:semicolon
DECL|member|desc_dev
r_struct
id|snd_dma_device
id|desc_dev
suffix:semicolon
DECL|member|desc_buf
r_struct
id|snd_dma_buffer
id|desc_buf
suffix:semicolon
DECL|member|substream
id|snd_pcm_substream_t
op_star
id|substream
suffix:semicolon
multiline_comment|/* assigned PCM substream */
DECL|member|buf_addr
DECL|member|buf_bytes
r_int
r_int
id|buf_addr
comma
id|buf_bytes
suffix:semicolon
multiline_comment|/* DMA buffer address, bytes */
DECL|member|period_bytes
DECL|member|periods
r_int
r_int
id|period_bytes
comma
id|periods
suffix:semicolon
DECL|member|opened
r_int
id|opened
suffix:semicolon
DECL|member|running
r_int
id|running
suffix:semicolon
DECL|member|pcm_open_flag
r_int
id|pcm_open_flag
suffix:semicolon
DECL|member|ac97_pcm_type
r_int
id|ac97_pcm_type
suffix:semicolon
multiline_comment|/* index # of ac97_pcm to access, -1 = not used */
)brace
suffix:semicolon
multiline_comment|/*&n; * ATI IXP chip&n; */
DECL|struct|snd_atiixp
r_struct
id|snd_atiixp
(brace
DECL|member|card
id|snd_card_t
op_star
id|card
suffix:semicolon
DECL|member|pci
r_struct
id|pci_dev
op_star
id|pci
suffix:semicolon
DECL|member|res
r_struct
id|resource
op_star
id|res
suffix:semicolon
multiline_comment|/* memory i/o */
DECL|member|addr
r_int
r_int
id|addr
suffix:semicolon
DECL|member|remap_addr
r_int
r_int
id|remap_addr
suffix:semicolon
DECL|member|irq
r_int
id|irq
suffix:semicolon
DECL|member|ac97_bus
id|ac97_bus_t
op_star
id|ac97_bus
suffix:semicolon
DECL|member|ac97
id|ac97_t
op_star
id|ac97
(braket
id|NUM_ATI_CODECS
)braket
suffix:semicolon
DECL|member|reg_lock
id|spinlock_t
id|reg_lock
suffix:semicolon
DECL|member|ac97_lock
id|spinlock_t
id|ac97_lock
suffix:semicolon
DECL|member|dmas
id|atiixp_dma_t
id|dmas
(braket
id|NUM_ATI_DMAS
)braket
suffix:semicolon
DECL|member|pcms
r_struct
id|ac97_pcm
op_star
id|pcms
(braket
id|NUM_ATI_PCMS
)braket
suffix:semicolon
DECL|member|pcmdevs
id|snd_pcm_t
op_star
id|pcmdevs
(braket
id|NUM_ATI_PCMDEVS
)braket
suffix:semicolon
DECL|member|max_channels
r_int
id|max_channels
suffix:semicolon
multiline_comment|/* max. channels for PCM out */
DECL|member|codec_not_ready_bits
r_int
r_int
id|codec_not_ready_bits
suffix:semicolon
multiline_comment|/* for codec detection */
DECL|member|spdif_over_aclink
r_int
id|spdif_over_aclink
suffix:semicolon
multiline_comment|/* passed from the module option */
DECL|member|open_mutex
r_struct
id|semaphore
id|open_mutex
suffix:semicolon
multiline_comment|/* playback open mutex */
macro_line|#ifdef CONFIG_PM
DECL|member|pci_state
id|u32
id|pci_state
(braket
l_int|16
)braket
suffix:semicolon
macro_line|#endif
)brace
suffix:semicolon
multiline_comment|/*&n; */
DECL|variable|snd_atiixp_ids
r_static
r_struct
id|pci_device_id
id|snd_atiixp_ids
(braket
)braket
op_assign
(brace
(brace
l_int|0x1002
comma
l_int|0x434d
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* SB200 */
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|snd_atiixp_ids
)paren
suffix:semicolon
multiline_comment|/*&n; * lowlevel functions&n; */
multiline_comment|/*&n; * update the bits of the given register.&n; * return 1 if the bits changed.&n; */
DECL|function|snd_atiixp_update_bits
r_static
r_int
id|snd_atiixp_update_bits
c_func
(paren
id|atiixp_t
op_star
id|chip
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|mask
comma
r_int
r_int
id|value
)paren
(brace
r_int
r_int
id|addr
op_assign
id|chip-&gt;remap_addr
op_plus
id|reg
suffix:semicolon
r_int
r_int
id|data
comma
id|old_data
suffix:semicolon
id|old_data
op_assign
id|data
op_assign
id|readl
c_func
(paren
id|addr
)paren
suffix:semicolon
id|data
op_and_assign
op_complement
id|mask
suffix:semicolon
id|data
op_or_assign
id|value
suffix:semicolon
r_if
c_cond
(paren
id|old_data
op_eq
id|data
)paren
r_return
l_int|0
suffix:semicolon
id|writel
c_func
(paren
id|data
comma
id|addr
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * macros for easy use&n; */
DECL|macro|atiixp_write
mdefine_line|#define atiixp_write(chip,reg,value) &bslash;&n;&t;writel(value, chip-&gt;remap_addr + ATI_REG_##reg)
DECL|macro|atiixp_read
mdefine_line|#define atiixp_read(chip,reg) &bslash;&n;&t;readl(chip-&gt;remap_addr + ATI_REG_##reg)
DECL|macro|atiixp_update
mdefine_line|#define atiixp_update(chip,reg,mask,val) &bslash;&n;&t;snd_atiixp_update_bits(chip, ATI_REG_##reg, mask, val)
multiline_comment|/* delay for one tick */
DECL|macro|do_delay
mdefine_line|#define do_delay() do { &bslash;&n;&t;set_current_state(TASK_UNINTERRUPTIBLE); &bslash;&n;&t;schedule_timeout(1); &bslash;&n;} while (0)
multiline_comment|/*&n; * handling DMA packets&n; *&n; * we allocate a linear buffer for the DMA, and split it to  each packet.&n; * in a future version, a scatter-gather buffer should be implemented.&n; */
DECL|macro|ATI_DESC_LIST_SIZE
mdefine_line|#define ATI_DESC_LIST_SIZE &bslash;&n;&t;PAGE_ALIGN(ATI_MAX_DESCRIPTORS * sizeof(atiixp_dma_desc_t))
multiline_comment|/*&n; * build packets ring for the given buffer size.&n; *&n; * IXP handles the buffer descriptors, which are connected as a linked&n; * list.  although we can change the list dynamically, in this version,&n; * a static RING of buffer descriptors is used.&n; *&n; * the ring is built in this function, and is set up to the hardware. &n; */
DECL|function|atiixp_build_dma_packets
r_static
r_int
id|atiixp_build_dma_packets
c_func
(paren
id|atiixp_t
op_star
id|chip
comma
id|atiixp_dma_t
op_star
id|dma
comma
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
r_int
id|periods
comma
r_int
r_int
id|period_bytes
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
id|u32
id|addr
comma
id|desc_addr
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|periods
OG
id|ATI_MAX_DESCRIPTORS
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|dma-&gt;desc_buf.area
op_eq
l_int|NULL
)paren
(brace
id|memset
c_func
(paren
op_amp
id|dma-&gt;desc_dev
comma
l_int|0
comma
r_sizeof
(paren
id|dma-&gt;desc_dev
)paren
)paren
suffix:semicolon
id|dma-&gt;desc_dev.type
op_assign
id|SNDRV_DMA_TYPE_DEV
suffix:semicolon
id|dma-&gt;desc_dev.dev
op_assign
id|snd_dma_pci_data
c_func
(paren
id|chip-&gt;pci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_dma_alloc_pages
c_func
(paren
op_amp
id|dma-&gt;desc_dev
comma
id|ATI_DESC_LIST_SIZE
comma
op_amp
id|dma-&gt;desc_buf
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|dma-&gt;period_bytes
op_assign
id|dma-&gt;periods
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* clear */
)brace
r_if
c_cond
(paren
id|dma-&gt;periods
op_eq
id|periods
op_logical_and
id|dma-&gt;period_bytes
op_eq
id|period_bytes
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* reset DMA before changing the descriptor table */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|chip-&gt;remap_addr
op_plus
id|dma-&gt;ops-&gt;llp_offset
)paren
suffix:semicolon
id|dma-&gt;ops
op_member_access_from_pointer
id|enable_dma
c_func
(paren
id|chip
comma
l_int|0
)paren
suffix:semicolon
id|dma-&gt;ops
op_member_access_from_pointer
id|enable_dma
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* fill the entries */
id|addr
op_assign
(paren
id|u32
)paren
id|substream-&gt;runtime-&gt;dma_addr
suffix:semicolon
id|desc_addr
op_assign
(paren
id|u32
)paren
id|dma-&gt;desc_buf.addr
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|periods
suffix:semicolon
id|i
op_increment
)paren
(brace
id|atiixp_dma_desc_t
op_star
id|desc
op_assign
op_amp
(paren
(paren
id|atiixp_dma_desc_t
op_star
)paren
id|dma-&gt;desc_buf.area
)paren
(braket
id|i
)braket
suffix:semicolon
id|desc-&gt;addr
op_assign
id|cpu_to_le32
c_func
(paren
id|addr
)paren
suffix:semicolon
id|desc-&gt;status
op_assign
l_int|0
suffix:semicolon
id|desc-&gt;size
op_assign
id|period_bytes
op_rshift
l_int|2
suffix:semicolon
multiline_comment|/* in dwords */
id|desc_addr
op_add_assign
r_sizeof
(paren
id|atiixp_dma_desc_t
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
id|periods
op_minus
l_int|1
)paren
id|desc-&gt;next
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|u32
)paren
id|dma-&gt;desc_buf.addr
)paren
suffix:semicolon
r_else
id|desc-&gt;next
op_assign
id|cpu_to_le32
c_func
(paren
id|desc_addr
)paren
suffix:semicolon
id|addr
op_add_assign
id|period_bytes
suffix:semicolon
)brace
id|writel
c_func
(paren
(paren
id|u32
)paren
id|dma-&gt;desc_buf.addr
op_or
id|ATI_REG_LINKPTR_EN
comma
id|chip-&gt;remap_addr
op_plus
id|dma-&gt;ops-&gt;llp_offset
)paren
suffix:semicolon
id|dma-&gt;period_bytes
op_assign
id|period_bytes
suffix:semicolon
id|dma-&gt;periods
op_assign
id|periods
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * remove the ring buffer and release it if assigned&n; */
DECL|function|atiixp_clear_dma_packets
r_static
r_void
id|atiixp_clear_dma_packets
c_func
(paren
id|atiixp_t
op_star
id|chip
comma
id|atiixp_dma_t
op_star
id|dma
comma
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_if
c_cond
(paren
id|dma-&gt;desc_buf.area
)paren
(brace
id|writel
c_func
(paren
l_int|0
comma
id|chip-&gt;remap_addr
op_plus
id|dma-&gt;ops-&gt;llp_offset
)paren
suffix:semicolon
id|snd_dma_free_pages
c_func
(paren
op_amp
id|dma-&gt;desc_dev
comma
op_amp
id|dma-&gt;desc_buf
)paren
suffix:semicolon
id|dma-&gt;desc_buf.area
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * AC97 interface&n; */
DECL|function|snd_atiixp_acquire_codec
r_static
r_int
id|snd_atiixp_acquire_codec
c_func
(paren
id|atiixp_t
op_star
id|chip
)paren
(brace
r_int
id|timeout
op_assign
l_int|1000
suffix:semicolon
r_while
c_loop
(paren
id|atiixp_read
c_func
(paren
id|chip
comma
id|PHYS_OUT_ADDR
)paren
op_amp
id|ATI_REG_PHYS_OUT_ADDR_EN
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|timeout
op_decrement
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;atiixp: codec acquire timeout&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_atiixp_codec_read
r_static
r_int
r_int
id|snd_atiixp_codec_read
c_func
(paren
id|atiixp_t
op_star
id|chip
comma
r_int
r_int
id|codec
comma
r_int
r_int
id|reg
)paren
(brace
r_int
r_int
id|data
suffix:semicolon
r_int
id|timeout
suffix:semicolon
r_if
c_cond
(paren
id|snd_atiixp_acquire_codec
c_func
(paren
id|chip
)paren
OL
l_int|0
)paren
r_return
l_int|0xffff
suffix:semicolon
id|data
op_assign
(paren
id|reg
op_lshift
id|ATI_REG_PHYS_OUT_ADDR_SHIFT
)paren
op_or
id|ATI_REG_PHYS_OUT_ADDR_EN
op_or
id|ATI_REG_PHYS_OUT_RW
op_or
id|codec
suffix:semicolon
id|atiixp_write
c_func
(paren
id|chip
comma
id|PHYS_OUT_ADDR
comma
id|data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_atiixp_acquire_codec
c_func
(paren
id|chip
)paren
OL
l_int|0
)paren
r_return
l_int|0xffff
suffix:semicolon
id|timeout
op_assign
l_int|1000
suffix:semicolon
r_do
(brace
id|data
op_assign
id|atiixp_read
c_func
(paren
id|chip
comma
id|PHYS_IN_ADDR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_amp
id|ATI_REG_PHYS_IN_READ_FLAG
)paren
r_return
id|data
op_rshift
id|ATI_REG_PHYS_IN_DATA_SHIFT
suffix:semicolon
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_decrement
id|timeout
)paren
suffix:semicolon
multiline_comment|/* time out may happen during reset */
r_if
c_cond
(paren
id|reg
OL
l_int|0x7c
)paren
id|snd_printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;atiixp: codec read timeout (reg %x)&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
r_return
l_int|0xffff
suffix:semicolon
)brace
DECL|function|snd_atiixp_codec_write
r_static
r_void
id|snd_atiixp_codec_write
c_func
(paren
id|atiixp_t
op_star
id|chip
comma
r_int
r_int
id|codec
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
r_int
r_int
id|data
suffix:semicolon
r_if
c_cond
(paren
id|snd_atiixp_acquire_codec
c_func
(paren
id|chip
)paren
OL
l_int|0
)paren
r_return
suffix:semicolon
id|data
op_assign
(paren
(paren
r_int
r_int
)paren
id|val
op_lshift
id|ATI_REG_PHYS_OUT_DATA_SHIFT
)paren
op_or
(paren
(paren
r_int
r_int
)paren
id|reg
op_lshift
id|ATI_REG_PHYS_OUT_ADDR_SHIFT
)paren
op_or
id|ATI_REG_PHYS_OUT_ADDR_EN
op_or
id|codec
suffix:semicolon
id|atiixp_write
c_func
(paren
id|chip
comma
id|PHYS_OUT_ADDR
comma
id|data
)paren
suffix:semicolon
)brace
DECL|function|snd_atiixp_ac97_read
r_static
r_int
r_int
id|snd_atiixp_ac97_read
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
)paren
(brace
id|atiixp_t
op_star
id|chip
op_assign
id|ac97-&gt;private_data
suffix:semicolon
r_int
r_int
id|data
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;ac97_lock
)paren
suffix:semicolon
id|data
op_assign
id|snd_atiixp_codec_read
c_func
(paren
id|chip
comma
id|ac97-&gt;num
comma
id|reg
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;ac97_lock
)paren
suffix:semicolon
r_return
id|data
suffix:semicolon
)brace
DECL|function|snd_atiixp_ac97_write
r_static
r_void
id|snd_atiixp_ac97_write
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|val
)paren
(brace
id|atiixp_t
op_star
id|chip
op_assign
id|ac97-&gt;private_data
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;ac97_lock
)paren
suffix:semicolon
id|snd_atiixp_codec_write
c_func
(paren
id|chip
comma
id|ac97-&gt;num
comma
id|reg
comma
id|val
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;ac97_lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * reset AC link&n; */
DECL|function|snd_atiixp_aclink_reset
r_static
r_int
id|snd_atiixp_aclink_reset
c_func
(paren
id|atiixp_t
op_star
id|chip
)paren
(brace
r_int
id|timeout
suffix:semicolon
multiline_comment|/* reset powerdoewn */
r_if
c_cond
(paren
id|atiixp_update
c_func
(paren
id|chip
comma
id|CMD
comma
id|ATI_REG_CMD_POWERDOWN
comma
l_int|0
)paren
)paren
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
multiline_comment|/* perform a software reset */
id|atiixp_update
c_func
(paren
id|chip
comma
id|CMD
comma
id|ATI_REG_CMD_AC_SOFT_RESET
comma
id|ATI_REG_CMD_AC_SOFT_RESET
)paren
suffix:semicolon
id|atiixp_read
c_func
(paren
id|chip
comma
id|CMD
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|atiixp_update
c_func
(paren
id|chip
comma
id|CMD
comma
id|ATI_REG_CMD_AC_SOFT_RESET
comma
l_int|0
)paren
suffix:semicolon
id|timeout
op_assign
l_int|10
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|atiixp_read
c_func
(paren
id|chip
comma
id|CMD
)paren
op_amp
id|ATI_REG_CMD_ACLINK_ACTIVE
)paren
)paren
(brace
multiline_comment|/* do a hard reset */
id|atiixp_update
c_func
(paren
id|chip
comma
id|CMD
comma
id|ATI_REG_CMD_AC_SYNC
op_or
id|ATI_REG_CMD_AC_RESET
comma
id|ATI_REG_CMD_AC_SYNC
)paren
suffix:semicolon
id|atiixp_read
c_func
(paren
id|chip
comma
id|CMD
)paren
suffix:semicolon
id|do_delay
c_func
(paren
)paren
suffix:semicolon
id|atiixp_update
c_func
(paren
id|chip
comma
id|CMD
comma
id|ATI_REG_CMD_AC_RESET
comma
id|ATI_REG_CMD_AC_RESET
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|timeout
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;atiixp: codec reset timeout&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* deassert RESET and assert SYNC to make sure */
id|atiixp_update
c_func
(paren
id|chip
comma
id|CMD
comma
id|ATI_REG_CMD_AC_SYNC
op_or
id|ATI_REG_CMD_AC_RESET
comma
id|ATI_REG_CMD_AC_SYNC
op_or
id|ATI_REG_CMD_AC_RESET
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PM
DECL|function|snd_atiixp_aclink_down
r_static
r_int
id|snd_atiixp_aclink_down
c_func
(paren
id|atiixp_t
op_star
id|chip
)paren
(brace
singleline_comment|// if (atiixp_read(chip, MODEM_MIRROR) &amp; 0x1) /* modem running, too? */
singleline_comment|//&t;return -EBUSY;
id|atiixp_update
c_func
(paren
id|chip
comma
id|CMD
comma
id|ATI_REG_CMD_POWERDOWN
op_or
id|ATI_REG_CMD_AC_RESET
comma
id|ATI_REG_CMD_POWERDOWN
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * auto-detection of codecs&n; *&n; * the IXP chip can generate interrupts for the non-existing codecs.&n; * NEW_FRAME interrupt is used to make sure that the interrupt is generated&n; * even if all three codecs are connected.&n; */
DECL|macro|ALL_CODEC_NOT_READY
mdefine_line|#define ALL_CODEC_NOT_READY &bslash;&n;&t;    (ATI_REG_ISR_CODEC0_NOT_READY |&bslash;&n;&t;     ATI_REG_ISR_CODEC1_NOT_READY |&bslash;&n;&t;     ATI_REG_ISR_CODEC2_NOT_READY)
DECL|macro|CODEC_CHECK_BITS
mdefine_line|#define CODEC_CHECK_BITS (ALL_CODEC_NOT_READY|ATI_REG_ISR_NEW_FRAME)
DECL|function|snd_atiixp_codec_detect
r_static
r_int
id|snd_atiixp_codec_detect
c_func
(paren
id|atiixp_t
op_star
id|chip
)paren
(brace
r_int
id|timeout
suffix:semicolon
id|chip-&gt;codec_not_ready_bits
op_assign
l_int|0
suffix:semicolon
id|atiixp_write
c_func
(paren
id|chip
comma
id|IER
comma
id|CODEC_CHECK_BITS
)paren
suffix:semicolon
multiline_comment|/* wait for the interrupts */
id|timeout
op_assign
id|HZ
op_div
l_int|10
suffix:semicolon
r_while
c_loop
(paren
id|timeout
op_decrement
OG
l_int|0
)paren
(brace
id|do_delay
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;codec_not_ready_bits
)paren
r_break
suffix:semicolon
)brace
id|atiixp_write
c_func
(paren
id|chip
comma
id|IER
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* disable irqs */
r_if
c_cond
(paren
(paren
id|chip-&gt;codec_not_ready_bits
op_amp
id|ALL_CODEC_NOT_READY
)paren
op_eq
id|ALL_CODEC_NOT_READY
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;atiixp: no codec detected!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * enable DMA and irqs&n; */
DECL|function|snd_atiixp_chip_start
r_static
r_int
id|snd_atiixp_chip_start
c_func
(paren
id|atiixp_t
op_star
id|chip
)paren
(brace
r_int
r_int
id|reg
suffix:semicolon
multiline_comment|/* set up spdif, enable burst mode */
id|reg
op_assign
id|atiixp_read
c_func
(paren
id|chip
comma
id|CMD
)paren
suffix:semicolon
id|reg
op_or_assign
id|ATI_REG_CMD_BURST_EN
suffix:semicolon
id|atiixp_write
c_func
(paren
id|chip
comma
id|CMD
comma
id|reg
)paren
suffix:semicolon
multiline_comment|/* clear all interrupt source */
id|atiixp_write
c_func
(paren
id|chip
comma
id|ISR
comma
l_int|0xffffffff
)paren
suffix:semicolon
multiline_comment|/* enable irqs */
id|atiixp_write
c_func
(paren
id|chip
comma
id|IER
comma
id|ATI_REG_IER_MODEM_STATUS_EN
op_or
id|ATI_REG_IER_MODEM_IN_XRUN_EN
op_or
id|ATI_REG_IER_MODEM_OUT1_XRUN_EN
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * disable DMA and IRQs&n; */
DECL|function|snd_atiixp_chip_stop
r_static
r_int
id|snd_atiixp_chip_stop
c_func
(paren
id|atiixp_t
op_star
id|chip
)paren
(brace
multiline_comment|/* clear interrupt source */
id|atiixp_write
c_func
(paren
id|chip
comma
id|ISR
comma
id|atiixp_read
c_func
(paren
id|chip
comma
id|ISR
)paren
)paren
suffix:semicolon
multiline_comment|/* disable irqs */
id|atiixp_write
c_func
(paren
id|chip
comma
id|IER
comma
l_int|0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * PCM section&n; */
multiline_comment|/*&n; * pointer callback simplly reads XXX_DMA_DT_CUR register as the current&n; * position.  when SG-buffer is implemented, the offset must be calculated&n; * correctly...&n; */
DECL|function|snd_atiixp_pcm_pointer
r_static
id|snd_pcm_uframes_t
id|snd_atiixp_pcm_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|atiixp_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|atiixp_dma_t
op_star
id|dma
op_assign
(paren
id|atiixp_dma_t
op_star
)paren
id|runtime-&gt;private_data
suffix:semicolon
r_int
r_int
id|curptr
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|curptr
op_assign
id|readl
c_func
(paren
id|chip-&gt;remap_addr
op_plus
id|dma-&gt;ops-&gt;dt_cur
)paren
suffix:semicolon
r_if
c_cond
(paren
id|curptr
OL
id|dma-&gt;buf_addr
)paren
(brace
id|snd_printdd
c_func
(paren
l_string|&quot;curptr = %x, base = %x&bslash;n&quot;
comma
id|curptr
comma
id|dma-&gt;buf_addr
)paren
suffix:semicolon
id|curptr
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|curptr
op_sub_assign
id|dma-&gt;buf_addr
suffix:semicolon
r_if
c_cond
(paren
id|curptr
op_ge
id|dma-&gt;buf_bytes
)paren
(brace
id|snd_printdd
c_func
(paren
l_string|&quot;curptr = %x, size = %x&bslash;n&quot;
comma
id|curptr
comma
id|dma-&gt;buf_bytes
)paren
suffix:semicolon
id|curptr
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_return
id|bytes_to_frames
c_func
(paren
id|runtime
comma
id|curptr
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * XRUN detected, and stop the PCM substream&n; */
DECL|function|snd_atiixp_xrun_dma
r_static
r_void
id|snd_atiixp_xrun_dma
c_func
(paren
id|atiixp_t
op_star
id|chip
comma
id|atiixp_dma_t
op_star
id|dma
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dma-&gt;substream
op_logical_or
op_logical_neg
id|dma-&gt;running
)paren
r_return
suffix:semicolon
id|snd_printdd
c_func
(paren
l_string|&quot;atiixp: XRUN detected (DMA %d)&bslash;n&quot;
comma
id|dma-&gt;ops-&gt;type
)paren
suffix:semicolon
id|snd_pcm_stop
c_func
(paren
id|dma-&gt;substream
comma
id|SNDRV_PCM_STATE_XRUN
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * the period ack.  update the substream.&n; */
DECL|function|snd_atiixp_update_dma
r_static
r_void
id|snd_atiixp_update_dma
c_func
(paren
id|atiixp_t
op_star
id|chip
comma
id|atiixp_dma_t
op_star
id|dma
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|dma-&gt;substream
op_logical_or
op_logical_neg
id|dma-&gt;running
)paren
r_return
suffix:semicolon
id|snd_pcm_period_elapsed
c_func
(paren
id|dma-&gt;substream
)paren
suffix:semicolon
)brace
multiline_comment|/* set BUS_BUSY interrupt bit if any DMA is running */
multiline_comment|/* call with spinlock held */
DECL|function|snd_atiixp_check_bus_busy
r_static
r_void
id|snd_atiixp_check_bus_busy
c_func
(paren
id|atiixp_t
op_star
id|chip
)paren
(brace
r_int
r_int
id|bus_busy
suffix:semicolon
r_if
c_cond
(paren
id|atiixp_read
c_func
(paren
id|chip
comma
id|CMD
)paren
op_amp
(paren
id|ATI_REG_CMD_MODEM_SEND1_EN
op_or
id|ATI_REG_CMD_MODEM_RECEIVE_EN
)paren
)paren
id|bus_busy
op_assign
id|ATI_REG_IER_MODEM_SET_BUS_BUSY
suffix:semicolon
r_else
id|bus_busy
op_assign
l_int|0
suffix:semicolon
id|atiixp_update
c_func
(paren
id|chip
comma
id|IER
comma
id|ATI_REG_IER_MODEM_SET_BUS_BUSY
comma
id|bus_busy
)paren
suffix:semicolon
)brace
multiline_comment|/* common trigger callback&n; * calling the lowlevel callbacks in it&n; */
DECL|function|snd_atiixp_pcm_trigger
r_static
r_int
id|snd_atiixp_pcm_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|atiixp_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|atiixp_dma_t
op_star
id|dma
op_assign
(paren
id|atiixp_dma_t
op_star
)paren
id|substream-&gt;runtime-&gt;private_data
suffix:semicolon
r_int
r_int
id|reg
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
id|snd_assert
c_func
(paren
id|dma-&gt;ops-&gt;enable_transfer
op_logical_and
id|dma-&gt;ops-&gt;flush_dma
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_ne
id|SNDRV_PCM_TRIGGER_START
op_logical_and
id|cmd
op_ne
id|SNDRV_PCM_TRIGGER_STOP
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
multiline_comment|/* hook off/on: via GPIO_OUT */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_ATI_CODECS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|chip-&gt;ac97
(braket
id|i
)braket
)paren
(brace
id|reg
op_assign
id|snd_ac97_read
c_func
(paren
id|chip-&gt;ac97
(braket
id|i
)braket
comma
id|AC97_GPIO_STATUS
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_START
)paren
(brace
id|reg
op_or_assign
id|AC97_GPIO_LINE1_OH
suffix:semicolon
)brace
r_else
id|reg
op_and_assign
op_complement
id|AC97_GPIO_LINE1_OH
suffix:semicolon
id|reg
op_assign
(paren
id|reg
op_lshift
id|ATI_REG_MODEM_OUT_GPIO_DATA_SHIFT
)paren
op_or
id|ATI_REG_MODEM_OUT_GPIO_EN
suffix:semicolon
id|atiixp_write
c_func
(paren
id|chip
comma
id|MODEM_OUT_GPIO
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_START
)paren
(brace
id|dma-&gt;ops
op_member_access_from_pointer
id|enable_transfer
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
id|dma-&gt;running
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|dma-&gt;ops
op_member_access_from_pointer
id|enable_transfer
c_func
(paren
id|chip
comma
l_int|0
)paren
suffix:semicolon
id|dma-&gt;running
op_assign
l_int|0
suffix:semicolon
)brace
id|snd_atiixp_check_bus_busy
c_func
(paren
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_STOP
)paren
(brace
id|dma-&gt;ops
op_member_access_from_pointer
id|flush_dma
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_atiixp_check_bus_busy
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * lowlevel callbacks for each DMA type&n; *&n; * every callback is supposed to be called in chip-&gt;reg_lock spinlock&n; */
multiline_comment|/* flush FIFO of analog OUT DMA */
DECL|function|atiixp_out_flush_dma
r_static
r_void
id|atiixp_out_flush_dma
c_func
(paren
id|atiixp_t
op_star
id|chip
)paren
(brace
id|atiixp_write
c_func
(paren
id|chip
comma
id|MODEM_FIFO_FLUSH
comma
id|ATI_REG_MODEM_FIFO_OUT1_FLUSH
)paren
suffix:semicolon
)brace
multiline_comment|/* enable/disable analog OUT DMA */
DECL|function|atiixp_out_enable_dma
r_static
r_void
id|atiixp_out_enable_dma
c_func
(paren
id|atiixp_t
op_star
id|chip
comma
r_int
id|on
)paren
(brace
r_int
r_int
id|data
suffix:semicolon
id|data
op_assign
id|atiixp_read
c_func
(paren
id|chip
comma
id|CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
id|on
)paren
(brace
r_if
c_cond
(paren
id|data
op_amp
id|ATI_REG_CMD_MODEM_OUT_DMA1_EN
)paren
r_return
suffix:semicolon
id|atiixp_out_flush_dma
c_func
(paren
id|chip
)paren
suffix:semicolon
id|data
op_or_assign
id|ATI_REG_CMD_MODEM_OUT_DMA1_EN
suffix:semicolon
)brace
r_else
id|data
op_and_assign
op_complement
id|ATI_REG_CMD_MODEM_OUT_DMA1_EN
suffix:semicolon
id|atiixp_write
c_func
(paren
id|chip
comma
id|CMD
comma
id|data
)paren
suffix:semicolon
)brace
multiline_comment|/* start/stop transfer over OUT DMA */
DECL|function|atiixp_out_enable_transfer
r_static
r_void
id|atiixp_out_enable_transfer
c_func
(paren
id|atiixp_t
op_star
id|chip
comma
r_int
id|on
)paren
(brace
id|atiixp_update
c_func
(paren
id|chip
comma
id|CMD
comma
id|ATI_REG_CMD_MODEM_SEND1_EN
comma
id|on
ques
c_cond
id|ATI_REG_CMD_MODEM_SEND1_EN
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* enable/disable analog IN DMA */
DECL|function|atiixp_in_enable_dma
r_static
r_void
id|atiixp_in_enable_dma
c_func
(paren
id|atiixp_t
op_star
id|chip
comma
r_int
id|on
)paren
(brace
id|atiixp_update
c_func
(paren
id|chip
comma
id|CMD
comma
id|ATI_REG_CMD_MODEM_IN_DMA_EN
comma
id|on
ques
c_cond
id|ATI_REG_CMD_MODEM_IN_DMA_EN
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* start/stop analog IN DMA */
DECL|function|atiixp_in_enable_transfer
r_static
r_void
id|atiixp_in_enable_transfer
c_func
(paren
id|atiixp_t
op_star
id|chip
comma
r_int
id|on
)paren
(brace
r_if
c_cond
(paren
id|on
)paren
(brace
r_int
r_int
id|data
op_assign
id|atiixp_read
c_func
(paren
id|chip
comma
id|CMD
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|data
op_amp
id|ATI_REG_CMD_MODEM_RECEIVE_EN
)paren
)paren
(brace
id|data
op_or_assign
id|ATI_REG_CMD_MODEM_RECEIVE_EN
suffix:semicolon
id|atiixp_write
c_func
(paren
id|chip
comma
id|CMD
comma
id|data
)paren
suffix:semicolon
)brace
)brace
r_else
id|atiixp_update
c_func
(paren
id|chip
comma
id|CMD
comma
id|ATI_REG_CMD_MODEM_RECEIVE_EN
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* flush FIFO of analog IN DMA */
DECL|function|atiixp_in_flush_dma
r_static
r_void
id|atiixp_in_flush_dma
c_func
(paren
id|atiixp_t
op_star
id|chip
)paren
(brace
id|atiixp_write
c_func
(paren
id|chip
comma
id|MODEM_FIFO_FLUSH
comma
id|ATI_REG_MODEM_FIFO_IN_FLUSH
)paren
suffix:semicolon
)brace
multiline_comment|/* set up slots and formats for analog OUT */
DECL|function|snd_atiixp_playback_prepare
r_static
r_int
id|snd_atiixp_playback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|atiixp_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|data
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
multiline_comment|/* set output threshold */
id|data
op_assign
id|atiixp_read
c_func
(paren
id|chip
comma
id|MODEM_OUT_FIFO
)paren
suffix:semicolon
id|data
op_and_assign
op_complement
id|ATI_REG_MODEM_OUT1_DMA_THRESHOLD_MASK
suffix:semicolon
id|data
op_or_assign
l_int|0x04
op_lshift
id|ATI_REG_MODEM_OUT1_DMA_THRESHOLD_SHIFT
suffix:semicolon
id|atiixp_write
c_func
(paren
id|chip
comma
id|MODEM_OUT_FIFO
comma
id|data
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* set up slots and formats for analog IN */
DECL|function|snd_atiixp_capture_prepare
r_static
r_int
id|snd_atiixp_capture_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * hw_params - allocate the buffer and set up buffer descriptors&n; */
DECL|function|snd_atiixp_pcm_hw_params
r_static
r_int
id|snd_atiixp_pcm_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
id|atiixp_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|atiixp_dma_t
op_star
id|dma
op_assign
(paren
id|atiixp_dma_t
op_star
)paren
id|substream-&gt;runtime-&gt;private_data
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
id|i
suffix:semicolon
id|err
op_assign
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|dma-&gt;buf_addr
op_assign
id|substream-&gt;runtime-&gt;dma_addr
suffix:semicolon
id|dma-&gt;buf_bytes
op_assign
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
suffix:semicolon
id|err
op_assign
id|atiixp_build_dma_packets
c_func
(paren
id|chip
comma
id|dma
comma
id|substream
comma
id|params_periods
c_func
(paren
id|hw_params
)paren
comma
id|params_period_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* set up modem rate */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_ATI_CODECS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|chip-&gt;ac97
(braket
id|i
)braket
)paren
r_continue
suffix:semicolon
id|snd_ac97_write
c_func
(paren
id|chip-&gt;ac97
(braket
id|i
)braket
comma
id|AC97_LINE1_RATE
comma
id|params_rate
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
id|snd_ac97_write
c_func
(paren
id|chip-&gt;ac97
(braket
id|i
)braket
comma
id|AC97_LINE1_LEVEL
comma
l_int|0
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|snd_atiixp_pcm_hw_free
r_static
r_int
id|snd_atiixp_pcm_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|atiixp_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|atiixp_dma_t
op_star
id|dma
op_assign
(paren
id|atiixp_dma_t
op_star
)paren
id|substream-&gt;runtime-&gt;private_data
suffix:semicolon
id|atiixp_clear_dma_packets
c_func
(paren
id|chip
comma
id|dma
comma
id|substream
)paren
suffix:semicolon
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * pcm hardware definition, identical for all DMA types&n; */
DECL|variable|snd_atiixp_pcm_hw
r_static
id|snd_pcm_hardware_t
id|snd_atiixp_pcm_hw
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_S16_LE
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_8000
op_or
id|SNDRV_PCM_RATE_16000
op_or
id|SNDRV_PCM_RATE_KNOT
comma
dot
id|rate_min
op_assign
l_int|8000
comma
dot
id|rate_max
op_assign
l_int|16000
comma
dot
id|channels_min
op_assign
l_int|2
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
l_int|256
op_star
l_int|1024
comma
dot
id|period_bytes_min
op_assign
l_int|32
comma
dot
id|period_bytes_max
op_assign
l_int|128
op_star
l_int|1024
comma
dot
id|periods_min
op_assign
l_int|2
comma
dot
id|periods_max
op_assign
id|ATI_MAX_DESCRIPTORS
comma
)brace
suffix:semicolon
DECL|function|snd_atiixp_pcm_open
r_static
r_int
id|snd_atiixp_pcm_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|atiixp_dma_t
op_star
id|dma
comma
r_int
id|pcm_type
)paren
(brace
id|atiixp_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
r_static
r_int
r_int
id|rates
(braket
)braket
op_assign
(brace
l_int|8000
comma
l_int|9600
comma
l_int|12000
comma
l_int|16000
)brace
suffix:semicolon
r_static
id|snd_pcm_hw_constraint_list_t
id|hw_constraints_rates
op_assign
(brace
dot
id|count
op_assign
id|ARRAY_SIZE
c_func
(paren
id|rates
)paren
comma
dot
id|list
op_assign
id|rates
comma
dot
id|mask
op_assign
l_int|0
comma
)brace
suffix:semicolon
id|snd_assert
c_func
(paren
id|dma-&gt;ops
op_logical_and
id|dma-&gt;ops-&gt;enable_dma
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dma-&gt;opened
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|dma-&gt;substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_atiixp_pcm_hw
suffix:semicolon
id|dma-&gt;ac97_pcm_type
op_assign
id|pcm_type
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_list
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
op_amp
id|hw_constraints_rates
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_hw_constraint_integer
c_func
(paren
id|runtime
comma
id|SNDRV_PCM_HW_PARAM_PERIODS
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|runtime-&gt;private_data
op_assign
id|dma
suffix:semicolon
multiline_comment|/* enable DMA bits */
id|spin_lock_irq
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|dma-&gt;ops
op_member_access_from_pointer
id|enable_dma
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|dma-&gt;opened
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_atiixp_pcm_close
r_static
r_int
id|snd_atiixp_pcm_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|atiixp_dma_t
op_star
id|dma
)paren
(brace
id|atiixp_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
multiline_comment|/* disable DMA bits */
id|snd_assert
c_func
(paren
id|dma-&gt;ops
op_logical_and
id|dma-&gt;ops-&gt;enable_dma
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|dma-&gt;ops
op_member_access_from_pointer
id|enable_dma
c_func
(paren
id|chip
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|dma-&gt;substream
op_assign
l_int|NULL
suffix:semicolon
id|dma-&gt;opened
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; */
DECL|function|snd_atiixp_playback_open
r_static
r_int
id|snd_atiixp_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|atiixp_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|err
suffix:semicolon
id|down
c_func
(paren
op_amp
id|chip-&gt;open_mutex
)paren
suffix:semicolon
id|err
op_assign
id|snd_atiixp_pcm_open
c_func
(paren
id|substream
comma
op_amp
id|chip-&gt;dmas
(braket
id|ATI_DMA_PLAYBACK
)braket
comma
l_int|0
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|chip-&gt;open_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_atiixp_playback_close
r_static
r_int
id|snd_atiixp_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|atiixp_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|err
suffix:semicolon
id|down
c_func
(paren
op_amp
id|chip-&gt;open_mutex
)paren
suffix:semicolon
id|err
op_assign
id|snd_atiixp_pcm_close
c_func
(paren
id|substream
comma
op_amp
id|chip-&gt;dmas
(braket
id|ATI_DMA_PLAYBACK
)braket
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|chip-&gt;open_mutex
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|snd_atiixp_capture_open
r_static
r_int
id|snd_atiixp_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|atiixp_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|snd_atiixp_pcm_open
c_func
(paren
id|substream
comma
op_amp
id|chip-&gt;dmas
(braket
id|ATI_DMA_CAPTURE
)braket
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|snd_atiixp_capture_close
r_static
r_int
id|snd_atiixp_capture_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|atiixp_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|snd_atiixp_pcm_close
c_func
(paren
id|substream
comma
op_amp
id|chip-&gt;dmas
(braket
id|ATI_DMA_CAPTURE
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/* AC97 playback */
DECL|variable|snd_atiixp_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_atiixp_playback_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_atiixp_playback_open
comma
dot
id|close
op_assign
id|snd_atiixp_playback_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_atiixp_pcm_hw_params
comma
dot
id|hw_free
op_assign
id|snd_atiixp_pcm_hw_free
comma
dot
id|prepare
op_assign
id|snd_atiixp_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_atiixp_pcm_trigger
comma
dot
id|pointer
op_assign
id|snd_atiixp_pcm_pointer
comma
)brace
suffix:semicolon
multiline_comment|/* AC97 capture */
DECL|variable|snd_atiixp_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_atiixp_capture_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_atiixp_capture_open
comma
dot
id|close
op_assign
id|snd_atiixp_capture_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_atiixp_pcm_hw_params
comma
dot
id|hw_free
op_assign
id|snd_atiixp_pcm_hw_free
comma
dot
id|prepare
op_assign
id|snd_atiixp_capture_prepare
comma
dot
id|trigger
op_assign
id|snd_atiixp_pcm_trigger
comma
dot
id|pointer
op_assign
id|snd_atiixp_pcm_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_atiixp_playback_dma_ops
r_static
id|atiixp_dma_ops_t
id|snd_atiixp_playback_dma_ops
op_assign
(brace
dot
id|type
op_assign
id|ATI_DMA_PLAYBACK
comma
dot
id|llp_offset
op_assign
id|ATI_REG_MODEM_OUT_DMA1_LINKPTR
comma
dot
id|dt_cur
op_assign
id|ATI_REG_MODEM_OUT_DMA1_DT_CUR
comma
dot
id|enable_dma
op_assign
id|atiixp_out_enable_dma
comma
dot
id|enable_transfer
op_assign
id|atiixp_out_enable_transfer
comma
dot
id|flush_dma
op_assign
id|atiixp_out_flush_dma
comma
)brace
suffix:semicolon
DECL|variable|snd_atiixp_capture_dma_ops
r_static
id|atiixp_dma_ops_t
id|snd_atiixp_capture_dma_ops
op_assign
(brace
dot
id|type
op_assign
id|ATI_DMA_CAPTURE
comma
dot
id|llp_offset
op_assign
id|ATI_REG_MODEM_IN_DMA_LINKPTR
comma
dot
id|dt_cur
op_assign
id|ATI_REG_MODEM_IN_DMA_DT_CUR
comma
dot
id|enable_dma
op_assign
id|atiixp_in_enable_dma
comma
dot
id|enable_transfer
op_assign
id|atiixp_in_enable_transfer
comma
dot
id|flush_dma
op_assign
id|atiixp_in_flush_dma
comma
)brace
suffix:semicolon
DECL|function|snd_atiixp_pcm_new
r_static
r_int
id|__devinit
id|snd_atiixp_pcm_new
c_func
(paren
id|atiixp_t
op_star
id|chip
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* initialize constants */
id|chip-&gt;dmas
(braket
id|ATI_DMA_PLAYBACK
)braket
dot
id|ops
op_assign
op_amp
id|snd_atiixp_playback_dma_ops
suffix:semicolon
id|chip-&gt;dmas
(braket
id|ATI_DMA_CAPTURE
)braket
dot
id|ops
op_assign
op_amp
id|snd_atiixp_capture_dma_ops
suffix:semicolon
multiline_comment|/* PCM #0: analog I/O */
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;ATI IXP MC97&quot;
comma
id|ATI_PCMDEV_ANALOG
comma
l_int|1
comma
l_int|1
comma
op_amp
id|pcm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_atiixp_playback_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_atiixp_capture_ops
)paren
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;ATI IXP MC97&quot;
)paren
suffix:semicolon
id|chip-&gt;pcmdevs
(braket
id|ATI_PCMDEV_ANALOG
)braket
op_assign
id|pcm
suffix:semicolon
id|snd_pcm_lib_preallocate_pages_for_all
c_func
(paren
id|pcm
comma
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|chip-&gt;pci
)paren
comma
l_int|64
op_star
l_int|1024
comma
l_int|128
op_star
l_int|1024
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * interrupt handler&n; */
DECL|function|snd_atiixp_interrupt
r_static
id|irqreturn_t
id|snd_atiixp_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|atiixp_t
op_star
id|chip
op_assign
id|dev_id
suffix:semicolon
r_int
r_int
id|status
suffix:semicolon
id|status
op_assign
id|atiixp_read
c_func
(paren
id|chip
comma
id|ISR
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
r_return
id|IRQ_NONE
suffix:semicolon
multiline_comment|/* process audio DMA */
r_if
c_cond
(paren
id|status
op_amp
id|ATI_REG_ISR_MODEM_OUT1_XRUN
)paren
id|snd_atiixp_xrun_dma
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;dmas
(braket
id|ATI_DMA_PLAYBACK
)braket
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|status
op_amp
id|ATI_REG_ISR_MODEM_OUT1_STATUS
)paren
id|snd_atiixp_update_dma
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;dmas
(braket
id|ATI_DMA_PLAYBACK
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|ATI_REG_ISR_MODEM_IN_XRUN
)paren
id|snd_atiixp_xrun_dma
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;dmas
(braket
id|ATI_DMA_CAPTURE
)braket
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|status
op_amp
id|ATI_REG_ISR_MODEM_IN_STATUS
)paren
id|snd_atiixp_update_dma
c_func
(paren
id|chip
comma
op_amp
id|chip-&gt;dmas
(braket
id|ATI_DMA_CAPTURE
)braket
)paren
suffix:semicolon
multiline_comment|/* for codec detection */
r_if
c_cond
(paren
id|status
op_amp
id|CODEC_CHECK_BITS
)paren
(brace
r_int
r_int
id|detected
suffix:semicolon
id|detected
op_assign
id|status
op_amp
id|CODEC_CHECK_BITS
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|chip-&gt;codec_not_ready_bits
op_or_assign
id|detected
suffix:semicolon
id|atiixp_update
c_func
(paren
id|chip
comma
id|IER
comma
id|detected
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* disable the detected irqs */
id|spin_unlock
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
)brace
multiline_comment|/* ack */
id|atiixp_write
c_func
(paren
id|chip
comma
id|ISR
comma
id|status
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
multiline_comment|/*&n; * ac97 mixer section&n; */
DECL|function|snd_atiixp_mixer_new
r_static
r_int
id|__devinit
id|snd_atiixp_mixer_new
c_func
(paren
id|atiixp_t
op_star
id|chip
comma
r_int
id|clock
)paren
(brace
id|ac97_bus_t
op_star
id|pbus
suffix:semicolon
id|ac97_template_t
id|ac97
suffix:semicolon
r_int
id|i
comma
id|err
suffix:semicolon
r_int
id|codec_count
suffix:semicolon
r_static
id|ac97_bus_ops_t
id|ops
op_assign
(brace
dot
id|write
op_assign
id|snd_atiixp_ac97_write
comma
dot
id|read
op_assign
id|snd_atiixp_ac97_read
comma
)brace
suffix:semicolon
r_static
r_int
r_int
id|codec_skip
(braket
id|NUM_ATI_CODECS
)braket
op_assign
(brace
id|ATI_REG_ISR_CODEC0_NOT_READY
comma
id|ATI_REG_ISR_CODEC1_NOT_READY
comma
id|ATI_REG_ISR_CODEC2_NOT_READY
comma
)brace
suffix:semicolon
r_if
c_cond
(paren
id|snd_atiixp_codec_detect
c_func
(paren
id|chip
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_bus
c_func
(paren
id|chip-&gt;card
comma
l_int|0
comma
op_amp
id|ops
comma
id|chip
comma
op_amp
id|pbus
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|pbus-&gt;clock
op_assign
id|clock
suffix:semicolon
id|chip-&gt;ac97_bus
op_assign
id|pbus
suffix:semicolon
id|codec_count
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_ATI_CODECS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|chip-&gt;codec_not_ready_bits
op_amp
id|codec_skip
(braket
id|i
)braket
)paren
r_continue
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ac97
comma
l_int|0
comma
r_sizeof
(paren
id|ac97
)paren
)paren
suffix:semicolon
id|ac97.private_data
op_assign
id|chip
suffix:semicolon
id|ac97.pci
op_assign
id|chip-&gt;pci
suffix:semicolon
id|ac97.num
op_assign
id|i
suffix:semicolon
id|ac97.scaps
op_assign
id|AC97_SCAP_SKIP_AUDIO
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_mixer
c_func
(paren
id|pbus
comma
op_amp
id|ac97
comma
op_amp
id|chip-&gt;ac97
(braket
id|i
)braket
)paren
)paren
OL
l_int|0
)paren
(brace
id|chip-&gt;ac97
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* to be sure */
id|snd_printdd
c_func
(paren
l_string|&quot;atiixp: codec %d not available for modem&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|codec_count
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|codec_count
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;atiixp: no codec available&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* snd_ac97_tune_hardware(chip-&gt;ac97, ac97_quirks); */
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PM
multiline_comment|/*&n; * power management&n; */
DECL|function|snd_atiixp_suspend
r_static
r_int
id|snd_atiixp_suspend
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_int
r_int
id|state
)paren
(brace
id|atiixp_t
op_star
id|chip
op_assign
id|card-&gt;pm_private_data
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_ATI_PCMDEVS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|chip-&gt;pcmdevs
(braket
id|i
)braket
)paren
id|snd_pcm_suspend_all
c_func
(paren
id|chip-&gt;pcmdevs
(braket
id|i
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_ATI_CODECS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|chip-&gt;ac97
(braket
id|i
)braket
)paren
id|snd_ac97_suspend
c_func
(paren
id|chip-&gt;ac97
(braket
id|i
)braket
)paren
suffix:semicolon
id|snd_atiixp_aclink_down
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_atiixp_chip_stop
c_func
(paren
id|chip
)paren
suffix:semicolon
id|pci_save_state
c_func
(paren
id|chip-&gt;pci
comma
id|chip-&gt;pci_state
)paren
suffix:semicolon
id|pci_set_power_state
c_func
(paren
id|chip-&gt;pci
comma
l_int|3
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|chip-&gt;pci
)paren
suffix:semicolon
id|snd_power_change_state
c_func
(paren
id|card
comma
id|SNDRV_CTL_POWER_D3hot
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_atiixp_resume
r_static
r_int
id|snd_atiixp_resume
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_int
r_int
id|state
)paren
(brace
id|atiixp_t
op_star
id|chip
op_assign
id|card-&gt;pm_private_data
suffix:semicolon
r_int
id|i
suffix:semicolon
id|pci_enable_device
c_func
(paren
id|chip-&gt;pci
)paren
suffix:semicolon
id|pci_restore_state
c_func
(paren
id|chip-&gt;pci
comma
id|chip-&gt;pci_state
)paren
suffix:semicolon
id|pci_set_power_state
c_func
(paren
id|chip-&gt;pci
comma
l_int|0
)paren
suffix:semicolon
id|snd_atiixp_aclink_reset
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_atiixp_chip_start
c_func
(paren
id|chip
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_ATI_CODECS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|chip-&gt;ac97
(braket
id|i
)braket
)paren
id|snd_ac97_resume
c_func
(paren
id|chip-&gt;ac97
(braket
id|i
)braket
)paren
suffix:semicolon
id|snd_power_change_state
c_func
(paren
id|card
comma
id|SNDRV_CTL_POWER_D0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PM */
multiline_comment|/*&n; * proc interface for register dump&n; */
DECL|function|snd_atiixp_proc_read
r_static
r_void
id|snd_atiixp_proc_read
c_func
(paren
id|snd_info_entry_t
op_star
id|entry
comma
id|snd_info_buffer_t
op_star
id|buffer
)paren
(brace
id|atiixp_t
op_star
id|chip
op_assign
id|entry-&gt;private_data
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
id|snd_iprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%02x: %08x&bslash;n&quot;
comma
id|i
comma
id|readl
c_func
(paren
id|chip-&gt;remap_addr
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_atiixp_proc_init
r_static
r_void
id|__devinit
id|snd_atiixp_proc_init
c_func
(paren
id|atiixp_t
op_star
id|chip
)paren
(brace
id|snd_info_entry_t
op_star
id|entry
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_card_proc_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;atiixp&quot;
comma
op_amp
id|entry
)paren
)paren
id|snd_info_set_text_ops
c_func
(paren
id|entry
comma
id|chip
comma
l_int|1024
comma
id|snd_atiixp_proc_read
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * destructor&n; */
DECL|function|snd_atiixp_free
r_static
r_int
id|snd_atiixp_free
c_func
(paren
id|atiixp_t
op_star
id|chip
)paren
(brace
r_if
c_cond
(paren
id|chip-&gt;irq
OL
l_int|0
)paren
r_goto
id|__hw_end
suffix:semicolon
id|snd_atiixp_chip_stop
c_func
(paren
id|chip
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
id|chip-&gt;irq
)paren
suffix:semicolon
id|__hw_end
suffix:colon
r_if
c_cond
(paren
id|chip-&gt;remap_addr
)paren
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|chip-&gt;remap_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;res
)paren
(brace
id|release_resource
c_func
(paren
id|chip-&gt;res
)paren
suffix:semicolon
id|kfree_nocheck
c_func
(paren
id|chip-&gt;res
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chip-&gt;irq
op_ge
l_int|0
)paren
id|free_irq
c_func
(paren
id|chip-&gt;irq
comma
(paren
r_void
op_star
)paren
id|chip
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_atiixp_dev_free
r_static
r_int
id|snd_atiixp_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|atiixp_t
op_star
id|chip
op_assign
id|device-&gt;device_data
suffix:semicolon
r_return
id|snd_atiixp_free
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * constructor for chip instance&n; */
DECL|function|snd_atiixp_create
r_static
r_int
id|__devinit
id|snd_atiixp_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_struct
id|pci_dev
op_star
id|pci
comma
id|atiixp_t
op_star
op_star
id|r_chip
)paren
(brace
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
dot
id|dev_free
op_assign
id|snd_atiixp_dev_free
comma
)brace
suffix:semicolon
id|atiixp_t
op_star
id|chip
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|pci_enable_device
c_func
(paren
id|pci
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|chip
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|chip
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|chip-&gt;reg_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|chip-&gt;ac97_lock
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|chip-&gt;open_mutex
)paren
suffix:semicolon
id|chip-&gt;card
op_assign
id|card
suffix:semicolon
id|chip-&gt;pci
op_assign
id|pci
suffix:semicolon
id|chip-&gt;irq
op_assign
op_minus
l_int|1
suffix:semicolon
id|chip-&gt;addr
op_assign
id|pci_resource_start
c_func
(paren
id|pci
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chip-&gt;res
op_assign
id|request_mem_region
c_func
(paren
id|chip-&gt;addr
comma
id|ATI_MEM_REGION
comma
l_string|&quot;ATI IXP MC97&quot;
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;unable to grab I/O memory 0x%lx&bslash;n&quot;
comma
id|chip-&gt;addr
)paren
suffix:semicolon
id|snd_atiixp_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|chip-&gt;remap_addr
op_assign
(paren
r_int
r_int
)paren
id|ioremap_nocache
c_func
(paren
id|chip-&gt;addr
comma
id|ATI_MEM_REGION
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;remap_addr
op_eq
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;AC&squot;97 space ioremap problem&bslash;n&quot;
)paren
suffix:semicolon
id|snd_atiixp_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|pci-&gt;irq
comma
id|snd_atiixp_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
id|card-&gt;shortname
comma
(paren
r_void
op_star
)paren
id|chip
)paren
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;unable to grab IRQ %d&bslash;n&quot;
comma
id|pci-&gt;irq
)paren
suffix:semicolon
id|snd_atiixp_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|chip-&gt;irq
op_assign
id|pci-&gt;irq
suffix:semicolon
id|pci_set_master
c_func
(paren
id|pci
)paren
suffix:semicolon
id|synchronize_irq
c_func
(paren
id|chip-&gt;irq
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|chip
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_atiixp_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|snd_card_set_dev
c_func
(paren
id|card
comma
op_amp
id|pci-&gt;dev
)paren
suffix:semicolon
op_star
id|r_chip
op_assign
id|chip
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_atiixp_probe
r_static
r_int
id|__devinit
id|snd_atiixp_probe
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
comma
r_const
r_struct
id|pci_device_id
op_star
id|pci_id
)paren
(brace
r_static
r_int
id|dev
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
id|atiixp_t
op_star
id|chip
suffix:semicolon
r_int
r_char
id|revision
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_ge
id|SNDRV_CARDS
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|enable
(braket
id|dev
)braket
)paren
(brace
id|dev
op_increment
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|card
op_assign
id|snd_card_new
c_func
(paren
id|index
(braket
id|dev
)braket
comma
id|id
(braket
id|dev
)braket
comma
id|THIS_MODULE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pci
comma
id|PCI_REVISION_ID
comma
op_amp
id|revision
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;ATIIXP-MODEM&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;shortname
comma
l_string|&quot;ATI IXP Modem&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_atiixp_create
c_func
(paren
id|card
comma
id|pci
comma
op_amp
id|chip
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_atiixp_aclink_reset
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_atiixp_mixer_new
c_func
(paren
id|chip
comma
id|ac97_clock
(braket
id|dev
)braket
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__error
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_atiixp_pcm_new
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__error
suffix:semicolon
id|snd_atiixp_proc_init
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_atiixp_chip_start
c_func
(paren
id|chip
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;%s rev %x at 0x%lx, irq %i&quot;
comma
id|card-&gt;shortname
comma
id|revision
comma
id|chip-&gt;addr
comma
id|chip-&gt;irq
)paren
suffix:semicolon
id|snd_card_set_pm_callback
c_func
(paren
id|card
comma
id|snd_atiixp_suspend
comma
id|snd_atiixp_resume
comma
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_card_register
c_func
(paren
id|card
)paren
)paren
OL
l_int|0
)paren
r_goto
id|__error
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci
comma
id|card
)paren
suffix:semicolon
id|dev
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|__error
suffix:colon
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|snd_atiixp_remove
r_static
r_void
id|__devexit
id|snd_atiixp_remove
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci
)paren
(brace
id|snd_card_free
c_func
(paren
id|pci_get_drvdata
c_func
(paren
id|pci
)paren
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|driver
r_static
r_struct
id|pci_driver
id|driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;ATI IXP MC97 controller&quot;
comma
dot
id|id_table
op_assign
id|snd_atiixp_ids
comma
dot
id|probe
op_assign
id|snd_atiixp_probe
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|snd_atiixp_remove
)paren
comma
id|SND_PCI_PM_CALLBACKS
)brace
suffix:semicolon
DECL|function|alsa_card_atiixp_init
r_static
r_int
id|__init
id|alsa_card_atiixp_init
c_func
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
DECL|function|alsa_card_atiixp_exit
r_static
r_void
id|__exit
id|alsa_card_atiixp_exit
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|driver
)paren
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|alsa_card_atiixp_init
)paren
id|module_exit
c_func
(paren
id|alsa_card_atiixp_exit
)paren
eof
