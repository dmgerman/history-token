multiline_comment|/*&n; *  Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; *  Universal interface for Audio Codec &squot;97&n; *&n; *  For more details look to AC &squot;97 component specification revision 2.2&n; *  by Intel Corporation (http://developer.intel.com).&n; *&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; *&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
macro_line|#include &lt;sound/ac97_codec.h&gt;
macro_line|#include &lt;sound/asoundef.h&gt;
macro_line|#include &lt;sound/initval.h&gt;
macro_line|#include &quot;ac97_local.h&quot;
macro_line|#include &quot;ac97_id.h&quot;
macro_line|#include &quot;ac97_patch.h&quot;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jaroslav Kysela &lt;perex@suse.cz&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Universal interface for Audio Codec &squot;97&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|enable_loopback
r_static
r_int
id|enable_loopback
suffix:semicolon
id|module_param
c_func
(paren
id|enable_loopback
comma
r_bool
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|enable_loopback
comma
l_string|&quot;Enable AC97 ADC/DAC Loopback Control&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&n; */
r_typedef
r_struct
(brace
DECL|member|id
r_int
r_int
id|id
suffix:semicolon
DECL|member|mask
r_int
r_int
id|mask
suffix:semicolon
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|patch
r_int
(paren
op_star
id|patch
)paren
(paren
id|ac97_t
op_star
id|ac97
)paren
suffix:semicolon
DECL|member|mpatch
r_int
(paren
op_star
id|mpatch
)paren
(paren
id|ac97_t
op_star
id|ac97
)paren
suffix:semicolon
DECL|member|flags
r_int
r_int
id|flags
suffix:semicolon
DECL|typedef|ac97_codec_id_t
)brace
id|ac97_codec_id_t
suffix:semicolon
DECL|variable|snd_ac97_codec_id_vendors
r_static
r_const
id|ac97_codec_id_t
id|snd_ac97_codec_id_vendors
(braket
)braket
op_assign
(brace
(brace
l_int|0x414b4d00
comma
l_int|0xffffff00
comma
l_string|&quot;Asahi Kasei&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x41445300
comma
l_int|0xffffff00
comma
l_string|&quot;Analog Devices&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x414c4300
comma
l_int|0xffffff00
comma
l_string|&quot;Realtek&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x414c4700
comma
l_int|0xffffff00
comma
l_string|&quot;Realtek&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x434d4900
comma
l_int|0xffffff00
comma
l_string|&quot;C-Media Electronics&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x43525900
comma
l_int|0xffffff00
comma
l_string|&quot;Cirrus Logic&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x43585400
comma
l_int|0xffffff00
comma
l_string|&quot;Conexant&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x44543000
comma
l_int|0xffffff00
comma
l_string|&quot;Diamond Technology&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x454d4300
comma
l_int|0xffffff00
comma
l_string|&quot;eMicro&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x45838300
comma
l_int|0xffffff00
comma
l_string|&quot;ESS Technology&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x48525300
comma
l_int|0xffffff00
comma
l_string|&quot;Intersil&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x49434500
comma
l_int|0xffffff00
comma
l_string|&quot;ICEnsemble&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x49544500
comma
l_int|0xffffff00
comma
l_string|&quot;ITE Tech.Inc&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x4e534300
comma
l_int|0xffffff00
comma
l_string|&quot;National Semiconductor&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x50534300
comma
l_int|0xffffff00
comma
l_string|&quot;Philips&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x53494c00
comma
l_int|0xffffff00
comma
l_string|&quot;Silicon Laboratory&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x54524100
comma
l_int|0xffffff00
comma
l_string|&quot;TriTech&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x54584e00
comma
l_int|0xffffff00
comma
l_string|&quot;Texas Instruments&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x56494100
comma
l_int|0xffffff00
comma
l_string|&quot;VIA Technologies&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x57454300
comma
l_int|0xffffff00
comma
l_string|&quot;Winbond&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x574d4c00
comma
l_int|0xffffff00
comma
l_string|&quot;Wolfson&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x594d4800
comma
l_int|0xffffff00
comma
l_string|&quot;Yamaha&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x83847600
comma
l_int|0xffffff00
comma
l_string|&quot;SigmaTel&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
)brace
suffix:semicolon
DECL|variable|snd_ac97_codec_ids
r_static
r_const
id|ac97_codec_id_t
id|snd_ac97_codec_ids
(braket
)braket
op_assign
(brace
(brace
l_int|0x414b4d00
comma
l_int|0xffffffff
comma
l_string|&quot;AK4540&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x414b4d01
comma
l_int|0xffffffff
comma
l_string|&quot;AK4542&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x414b4d02
comma
l_int|0xffffffff
comma
l_string|&quot;AK4543&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x414b4d06
comma
l_int|0xffffffff
comma
l_string|&quot;AK4544A&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x414b4d07
comma
l_int|0xffffffff
comma
l_string|&quot;AK4545&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x41445303
comma
l_int|0xffffffff
comma
l_string|&quot;AD1819&quot;
comma
id|patch_ad1819
comma
l_int|NULL
)brace
comma
(brace
l_int|0x41445340
comma
l_int|0xffffffff
comma
l_string|&quot;AD1881&quot;
comma
id|patch_ad1881
comma
l_int|NULL
)brace
comma
(brace
l_int|0x41445348
comma
l_int|0xffffffff
comma
l_string|&quot;AD1881A&quot;
comma
id|patch_ad1881
comma
l_int|NULL
)brace
comma
(brace
l_int|0x41445360
comma
l_int|0xffffffff
comma
l_string|&quot;AD1885&quot;
comma
id|patch_ad1885
comma
l_int|NULL
)brace
comma
(brace
l_int|0x41445361
comma
l_int|0xffffffff
comma
l_string|&quot;AD1886&quot;
comma
id|patch_ad1886
comma
l_int|NULL
)brace
comma
(brace
l_int|0x41445362
comma
l_int|0xffffffff
comma
l_string|&quot;AD1887&quot;
comma
id|patch_ad1881
comma
l_int|NULL
)brace
comma
(brace
l_int|0x41445363
comma
l_int|0xffffffff
comma
l_string|&quot;AD1886A&quot;
comma
id|patch_ad1881
comma
l_int|NULL
)brace
comma
(brace
l_int|0x41445368
comma
l_int|0xffffffff
comma
l_string|&quot;AD1888&quot;
comma
id|patch_ad1888
comma
l_int|NULL
)brace
comma
(brace
l_int|0x41445370
comma
l_int|0xffffffff
comma
l_string|&quot;AD1980&quot;
comma
id|patch_ad1980
comma
l_int|NULL
)brace
comma
(brace
l_int|0x41445372
comma
l_int|0xffffffff
comma
l_string|&quot;AD1981A&quot;
comma
id|patch_ad1981a
comma
l_int|NULL
)brace
comma
(brace
l_int|0x41445374
comma
l_int|0xffffffff
comma
l_string|&quot;AD1981B&quot;
comma
id|patch_ad1981b
comma
l_int|NULL
)brace
comma
(brace
l_int|0x41445375
comma
l_int|0xffffffff
comma
l_string|&quot;AD1985&quot;
comma
id|patch_ad1985
comma
l_int|NULL
)brace
comma
(brace
l_int|0x41445378
comma
l_int|0xffffffff
comma
l_string|&quot;AD1986&quot;
comma
id|patch_ad1985
comma
l_int|NULL
)brace
comma
(brace
l_int|0x414c4300
comma
l_int|0xffffff00
comma
l_string|&quot;ALC100,100P&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x414c4710
comma
l_int|0xfffffff0
comma
l_string|&quot;ALC200,200P&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x414c4721
comma
l_int|0xffffffff
comma
l_string|&quot;ALC650D&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
multiline_comment|/* already patched */
(brace
l_int|0x414c4722
comma
l_int|0xffffffff
comma
l_string|&quot;ALC650E&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
multiline_comment|/* already patched */
(brace
l_int|0x414c4723
comma
l_int|0xffffffff
comma
l_string|&quot;ALC650F&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
multiline_comment|/* already patched */
(brace
l_int|0x414c4720
comma
l_int|0xfffffff0
comma
l_string|&quot;ALC650&quot;
comma
id|patch_alc650
comma
l_int|NULL
)brace
comma
(brace
l_int|0x414c4760
comma
l_int|0xfffffff0
comma
l_string|&quot;ALC655&quot;
comma
id|patch_alc655
comma
l_int|NULL
)brace
comma
(brace
l_int|0x414c4780
comma
l_int|0xfffffff0
comma
l_string|&quot;ALC658&quot;
comma
id|patch_alc655
comma
l_int|NULL
)brace
comma
(brace
l_int|0x414c4790
comma
l_int|0xfffffff0
comma
l_string|&quot;ALC850&quot;
comma
id|patch_alc850
comma
l_int|NULL
)brace
comma
(brace
l_int|0x414c4730
comma
l_int|0xffffffff
comma
l_string|&quot;ALC101&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x414c4740
comma
l_int|0xfffffff0
comma
l_string|&quot;ALC202&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x414c4750
comma
l_int|0xfffffff0
comma
l_string|&quot;ALC250&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x414c4770
comma
l_int|0xfffffff0
comma
l_string|&quot;ALC203&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x434d4941
comma
l_int|0xffffffff
comma
l_string|&quot;CMI9738&quot;
comma
id|patch_cm9738
comma
l_int|NULL
)brace
comma
(brace
l_int|0x434d4961
comma
l_int|0xffffffff
comma
l_string|&quot;CMI9739&quot;
comma
id|patch_cm9739
comma
l_int|NULL
)brace
comma
(brace
l_int|0x434d4978
comma
l_int|0xffffffff
comma
l_string|&quot;CMI9761&quot;
comma
id|patch_cm9761
comma
l_int|NULL
)brace
comma
(brace
l_int|0x434d4982
comma
l_int|0xffffffff
comma
l_string|&quot;CMI9761&quot;
comma
id|patch_cm9761
comma
l_int|NULL
)brace
comma
(brace
l_int|0x434d4983
comma
l_int|0xffffffff
comma
l_string|&quot;CMI9761&quot;
comma
id|patch_cm9761
comma
l_int|NULL
)brace
comma
(brace
l_int|0x43525900
comma
l_int|0xfffffff8
comma
l_string|&quot;CS4297&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x43525910
comma
l_int|0xfffffff8
comma
l_string|&quot;CS4297A&quot;
comma
id|patch_cirrus_spdif
comma
l_int|NULL
)brace
comma
(brace
l_int|0x43525920
comma
l_int|0xfffffff8
comma
l_string|&quot;CS4298&quot;
comma
id|patch_cirrus_spdif
comma
l_int|NULL
)brace
comma
(brace
l_int|0x43525928
comma
l_int|0xfffffff8
comma
l_string|&quot;CS4294&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x43525930
comma
l_int|0xfffffff8
comma
l_string|&quot;CS4299&quot;
comma
id|patch_cirrus_cs4299
comma
l_int|NULL
)brace
comma
(brace
l_int|0x43525948
comma
l_int|0xfffffff8
comma
l_string|&quot;CS4201&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x43525958
comma
l_int|0xfffffff8
comma
l_string|&quot;CS4205&quot;
comma
id|patch_cirrus_spdif
comma
l_int|NULL
)brace
comma
(brace
l_int|0x43525960
comma
l_int|0xfffffff8
comma
l_string|&quot;CS4291&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x43525970
comma
l_int|0xfffffff8
comma
l_string|&quot;CS4202&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x43585421
comma
l_int|0xffffffff
comma
l_string|&quot;HSD11246&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
singleline_comment|// SmartMC II
(brace
l_int|0x43585428
comma
l_int|0xfffffff8
comma
l_string|&quot;Cx20468&quot;
comma
id|patch_conexant
comma
l_int|NULL
)brace
comma
singleline_comment|// SmartAMC fixme: the mask might be different
(brace
l_int|0x44543031
comma
l_int|0xfffffff0
comma
l_string|&quot;DT0398&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x454d4328
comma
l_int|0xffffffff
comma
l_string|&quot;28028&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
singleline_comment|// same as TR28028?
(brace
l_int|0x45838308
comma
l_int|0xffffffff
comma
l_string|&quot;ESS1988&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x48525300
comma
l_int|0xffffff00
comma
l_string|&quot;HMP9701&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x49434501
comma
l_int|0xffffffff
comma
l_string|&quot;ICE1230&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x49434511
comma
l_int|0xffffffff
comma
l_string|&quot;ICE1232&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
singleline_comment|// alias VIA VT1611A?
(brace
l_int|0x49434514
comma
l_int|0xffffffff
comma
l_string|&quot;ICE1232A&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x49434551
comma
l_int|0xffffffff
comma
l_string|&quot;VT1616&quot;
comma
id|patch_vt1616
comma
l_int|NULL
)brace
comma
(brace
l_int|0x49434552
comma
l_int|0xffffffff
comma
l_string|&quot;VT1616i&quot;
comma
id|patch_vt1616
comma
l_int|NULL
)brace
comma
singleline_comment|// VT1616 compatible (chipset integrated)
(brace
l_int|0x49544520
comma
l_int|0xffffffff
comma
l_string|&quot;IT2226E&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x49544561
comma
l_int|0xffffffff
comma
l_string|&quot;IT2646E&quot;
comma
id|patch_it2646
comma
l_int|NULL
)brace
comma
(brace
l_int|0x4e534300
comma
l_int|0xffffffff
comma
l_string|&quot;LM4540,43,45,46,48&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
singleline_comment|// only guess --jk
(brace
l_int|0x4e534331
comma
l_int|0xffffffff
comma
l_string|&quot;LM4549&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x4e534350
comma
l_int|0xffffffff
comma
l_string|&quot;LM4550&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x50534304
comma
l_int|0xffffffff
comma
l_string|&quot;UCB1400&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x53494c20
comma
l_int|0xffffffe0
comma
l_string|&quot;Si3036,8&quot;
comma
l_int|NULL
comma
id|mpatch_si3036
)brace
comma
(brace
l_int|0x54524102
comma
l_int|0xffffffff
comma
l_string|&quot;TR28022&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x54524106
comma
l_int|0xffffffff
comma
l_string|&quot;TR28026&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x54524108
comma
l_int|0xffffffff
comma
l_string|&quot;TR28028&quot;
comma
id|patch_tritech_tr28028
comma
l_int|NULL
)brace
comma
singleline_comment|// added by xin jin [07/09/99]
(brace
l_int|0x54524123
comma
l_int|0xffffffff
comma
l_string|&quot;TR28602&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
singleline_comment|// only guess --jk [TR28023 = eMicro EM28023 (new CT1297)]
(brace
l_int|0x54584e20
comma
l_int|0xffffffff
comma
l_string|&quot;TLC320AD9xC&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x56494161
comma
l_int|0xffffffff
comma
l_string|&quot;VIA1612A&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
singleline_comment|// modified ICE1232 with S/PDIF
(brace
l_int|0x57454301
comma
l_int|0xffffffff
comma
l_string|&quot;W83971D&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x574d4c00
comma
l_int|0xffffffff
comma
l_string|&quot;WM9701A&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x574d4C03
comma
l_int|0xffffffff
comma
l_string|&quot;WM9703,WM9707,WM9708,WM9717&quot;
comma
id|patch_wolfson03
comma
l_int|NULL
)brace
comma
(brace
l_int|0x574d4C04
comma
l_int|0xffffffff
comma
l_string|&quot;WM9704M,WM9704Q&quot;
comma
id|patch_wolfson04
comma
l_int|NULL
)brace
comma
(brace
l_int|0x574d4C05
comma
l_int|0xffffffff
comma
l_string|&quot;WM9705,WM9710&quot;
comma
id|patch_wolfson05
comma
l_int|NULL
)brace
comma
(brace
l_int|0x574d4C09
comma
l_int|0xffffffff
comma
l_string|&quot;WM9709&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x574d4C12
comma
l_int|0xffffffff
comma
l_string|&quot;WM9711,WM9712&quot;
comma
id|patch_wolfson11
comma
l_int|NULL
)brace
comma
(brace
l_int|0x574d4c13
comma
l_int|0xffffffff
comma
l_string|&quot;WM9713,WM9714&quot;
comma
id|patch_wolfson13
comma
l_int|NULL
comma
id|AC97_DEFAULT_POWER_OFF
)brace
comma
(brace
l_int|0x594d4800
comma
l_int|0xffffffff
comma
l_string|&quot;YMF743&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x594d4802
comma
l_int|0xffffffff
comma
l_string|&quot;YMF752&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x594d4803
comma
l_int|0xffffffff
comma
l_string|&quot;YMF753&quot;
comma
id|patch_yamaha_ymf753
comma
l_int|NULL
)brace
comma
(brace
l_int|0x83847600
comma
l_int|0xffffffff
comma
l_string|&quot;STAC9700,83,84&quot;
comma
id|patch_sigmatel_stac9700
comma
l_int|NULL
)brace
comma
(brace
l_int|0x83847604
comma
l_int|0xffffffff
comma
l_string|&quot;STAC9701,3,4,5&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x83847605
comma
l_int|0xffffffff
comma
l_string|&quot;STAC9704&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
(brace
l_int|0x83847608
comma
l_int|0xffffffff
comma
l_string|&quot;STAC9708,11&quot;
comma
id|patch_sigmatel_stac9708
comma
l_int|NULL
)brace
comma
(brace
l_int|0x83847609
comma
l_int|0xffffffff
comma
l_string|&quot;STAC9721,23&quot;
comma
id|patch_sigmatel_stac9721
comma
l_int|NULL
)brace
comma
(brace
l_int|0x83847644
comma
l_int|0xffffffff
comma
l_string|&quot;STAC9744&quot;
comma
id|patch_sigmatel_stac9744
comma
l_int|NULL
)brace
comma
(brace
l_int|0x83847650
comma
l_int|0xffffffff
comma
l_string|&quot;STAC9750,51&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
singleline_comment|// patch?
(brace
l_int|0x83847652
comma
l_int|0xffffffff
comma
l_string|&quot;STAC9752,53&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
singleline_comment|// patch?
(brace
l_int|0x83847656
comma
l_int|0xffffffff
comma
l_string|&quot;STAC9756,57&quot;
comma
id|patch_sigmatel_stac9756
comma
l_int|NULL
)brace
comma
(brace
l_int|0x83847658
comma
l_int|0xffffffff
comma
l_string|&quot;STAC9758,59&quot;
comma
id|patch_sigmatel_stac9758
comma
l_int|NULL
)brace
comma
(brace
l_int|0x83847666
comma
l_int|0xffffffff
comma
l_string|&quot;STAC9766,67&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
comma
singleline_comment|// patch?
(brace
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
)brace
suffix:semicolon
DECL|variable|snd_ac97_stereo_enhancements
r_const
r_char
op_star
id|snd_ac97_stereo_enhancements
(braket
)braket
op_assign
(brace
multiline_comment|/*   0 */
l_string|&quot;No 3D Stereo Enhancement&quot;
comma
multiline_comment|/*   1 */
l_string|&quot;Analog Devices Phat Stereo&quot;
comma
multiline_comment|/*   2 */
l_string|&quot;Creative Stereo Enhancement&quot;
comma
multiline_comment|/*   3 */
l_string|&quot;National Semi 3D Stereo Enhancement&quot;
comma
multiline_comment|/*   4 */
l_string|&quot;YAMAHA Ymersion&quot;
comma
multiline_comment|/*   5 */
l_string|&quot;BBE 3D Stereo Enhancement&quot;
comma
multiline_comment|/*   6 */
l_string|&quot;Crystal Semi 3D Stereo Enhancement&quot;
comma
multiline_comment|/*   7 */
l_string|&quot;Qsound QXpander&quot;
comma
multiline_comment|/*   8 */
l_string|&quot;Spatializer 3D Stereo Enhancement&quot;
comma
multiline_comment|/*   9 */
l_string|&quot;SRS 3D Stereo Enhancement&quot;
comma
multiline_comment|/*  10 */
l_string|&quot;Platform Tech 3D Stereo Enhancement&quot;
comma
multiline_comment|/*  11 */
l_string|&quot;AKM 3D Audio&quot;
comma
multiline_comment|/*  12 */
l_string|&quot;Aureal Stereo Enhancement&quot;
comma
multiline_comment|/*  13 */
l_string|&quot;Aztech 3D Enhancement&quot;
comma
multiline_comment|/*  14 */
l_string|&quot;Binaura 3D Audio Enhancement&quot;
comma
multiline_comment|/*  15 */
l_string|&quot;ESS Technology Stereo Enhancement&quot;
comma
multiline_comment|/*  16 */
l_string|&quot;Harman International VMAx&quot;
comma
multiline_comment|/*  17 */
l_string|&quot;Nvidea/IC Ensemble/KS Waves 3D Stereo Enhancement&quot;
comma
multiline_comment|/*  18 */
l_string|&quot;Philips Incredible Sound&quot;
comma
multiline_comment|/*  19 */
l_string|&quot;Texas Instruments 3D Stereo Enhancement&quot;
comma
multiline_comment|/*  20 */
l_string|&quot;VLSI Technology 3D Stereo Enhancement&quot;
comma
multiline_comment|/*  21 */
l_string|&quot;TriTech 3D Stereo Enhancement&quot;
comma
multiline_comment|/*  22 */
l_string|&quot;Realtek 3D Stereo Enhancement&quot;
comma
multiline_comment|/*  23 */
l_string|&quot;Samsung 3D Stereo Enhancement&quot;
comma
multiline_comment|/*  24 */
l_string|&quot;Wolfson Microelectronics 3D Enhancement&quot;
comma
multiline_comment|/*  25 */
l_string|&quot;Delta Integration 3D Enhancement&quot;
comma
multiline_comment|/*  26 */
l_string|&quot;SigmaTel 3D Enhancement&quot;
comma
multiline_comment|/*  27 */
l_string|&quot;IC Ensemble/KS Waves&quot;
comma
multiline_comment|/*  28 */
l_string|&quot;Rockwell 3D Stereo Enhancement&quot;
comma
multiline_comment|/*  29 */
l_string|&quot;Reserved 29&quot;
comma
multiline_comment|/*  30 */
l_string|&quot;Reserved 30&quot;
comma
multiline_comment|/*  31 */
l_string|&quot;Reserved 31&quot;
)brace
suffix:semicolon
multiline_comment|/*&n; * Shared AC97 controllers (ICH, ATIIXP...)&n; */
r_static
id|DECLARE_MUTEX
c_func
(paren
id|shared_codec_mutex
)paren
suffix:semicolon
DECL|variable|shared_codec
r_static
id|ac97_t
op_star
id|shared_codec
(braket
id|AC97_SHARED_TYPES
)braket
(braket
l_int|4
)braket
suffix:semicolon
multiline_comment|/*&n; *  I/O routines&n; */
DECL|function|snd_ac97_valid_reg
r_static
r_int
id|snd_ac97_valid_reg
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
)paren
(brace
r_if
c_cond
(paren
id|ac97-&gt;limited_regs
op_logical_and
op_logical_neg
id|test_bit
c_func
(paren
id|reg
comma
id|ac97-&gt;reg_accessed
)paren
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* filter some registers for buggy codecs */
r_switch
c_cond
(paren
id|ac97-&gt;id
)paren
(brace
r_case
id|AC97_ID_AK4540
suffix:colon
r_case
id|AC97_ID_AK4542
suffix:colon
r_if
c_cond
(paren
id|reg
op_le
l_int|0x1c
op_logical_or
id|reg
op_eq
l_int|0x20
op_logical_or
id|reg
op_eq
l_int|0x26
op_logical_or
id|reg
op_ge
l_int|0x7c
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|AC97_ID_AD1819
suffix:colon
multiline_comment|/* AD1819 */
r_case
id|AC97_ID_AD1881
suffix:colon
multiline_comment|/* AD1881 */
r_case
id|AC97_ID_AD1881A
suffix:colon
multiline_comment|/* AD1881A */
r_if
c_cond
(paren
id|reg
op_ge
l_int|0x3a
op_logical_and
id|reg
op_le
l_int|0x6e
)paren
multiline_comment|/* 0x59 */
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_case
id|AC97_ID_AD1885
suffix:colon
multiline_comment|/* AD1885 */
r_case
id|AC97_ID_AD1886
suffix:colon
multiline_comment|/* AD1886 */
r_case
id|AC97_ID_AD1886A
suffix:colon
multiline_comment|/* AD1886A - !!verify!! --jk */
r_case
id|AC97_ID_AD1887
suffix:colon
multiline_comment|/* AD1887 - !!verify!! --jk */
r_if
c_cond
(paren
id|reg
op_eq
l_int|0x5a
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_ge
l_int|0x3c
op_logical_and
id|reg
op_le
l_int|0x6e
)paren
multiline_comment|/* 0x59 */
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
r_case
id|AC97_ID_STAC9700
suffix:colon
r_case
id|AC97_ID_STAC9704
suffix:colon
r_case
id|AC97_ID_STAC9705
suffix:colon
r_case
id|AC97_ID_STAC9708
suffix:colon
r_case
id|AC97_ID_STAC9721
suffix:colon
r_case
id|AC97_ID_STAC9744
suffix:colon
r_case
id|AC97_ID_STAC9756
suffix:colon
r_if
c_cond
(paren
id|reg
op_le
l_int|0x3a
op_logical_or
id|reg
op_ge
l_int|0x5a
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/**&n; * snd_ac97_write - write a value on the given register&n; * @ac97: the ac97 instance&n; * @reg: the register to change&n; * @value: the value to set&n; *&n; * Writes a value on the given register.  This will invoke the write&n; * callback directly after the register check.&n; * This function doesn&squot;t change the register cache unlike&n; * #snd_ca97_write_cache(), so use this only when you don&squot;t want to&n; * reflect the change to the suspend/resume state.&n; */
DECL|function|snd_ac97_write
r_void
id|snd_ac97_write
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|value
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|snd_ac97_valid_reg
c_func
(paren
id|ac97
comma
id|reg
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ac97-&gt;id
op_amp
l_int|0xffffff00
)paren
op_eq
id|AC97_ID_ALC100
)paren
(brace
multiline_comment|/* Fix H/W bug of ALC100/100P */
r_if
c_cond
(paren
id|reg
op_eq
id|AC97_MASTER
op_logical_or
id|reg
op_eq
id|AC97_HEADPHONE
)paren
id|ac97-&gt;bus-&gt;ops
op_member_access_from_pointer
id|write
c_func
(paren
id|ac97
comma
id|AC97_RESET
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* reset audio codec */
)brace
id|ac97-&gt;bus-&gt;ops
op_member_access_from_pointer
id|write
c_func
(paren
id|ac97
comma
id|reg
comma
id|value
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * snd_ac97_read - read a value from the given register&n; * &n; * @ac97: the ac97 instance&n; * @reg: the register to read&n; *&n; * Reads a value from the given register.  This will invoke the read&n; * callback directly after the register check.&n; *&n; * Returns the read value.&n; */
DECL|function|snd_ac97_read
r_int
r_int
id|snd_ac97_read
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|snd_ac97_valid_reg
c_func
(paren
id|ac97
comma
id|reg
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|ac97-&gt;bus-&gt;ops
op_member_access_from_pointer
id|read
c_func
(paren
id|ac97
comma
id|reg
)paren
suffix:semicolon
)brace
multiline_comment|/* read a register - return the cached value if already read */
DECL|function|snd_ac97_read_cache
r_static
r_inline
r_int
r_int
id|snd_ac97_read_cache
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|reg
comma
id|ac97-&gt;reg_accessed
)paren
)paren
(brace
id|ac97-&gt;regs
(braket
id|reg
)braket
op_assign
id|ac97-&gt;bus-&gt;ops
op_member_access_from_pointer
id|read
c_func
(paren
id|ac97
comma
id|reg
)paren
suffix:semicolon
singleline_comment|// set_bit(reg, ac97-&gt;reg_accessed);
)brace
r_return
id|ac97-&gt;regs
(braket
id|reg
)braket
suffix:semicolon
)brace
multiline_comment|/**&n; * snd_ac97_write_cache - write a value on the given register and update the cache&n; * @ac97: the ac97 instance&n; * @reg: the register to change&n; * @value: the value to set&n; *&n; * Writes a value on the given register and updates the register&n; * cache.  The cached values are used for the cached-read and the&n; * suspend/resume.&n; */
DECL|function|snd_ac97_write_cache
r_void
id|snd_ac97_write_cache
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|value
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|snd_ac97_valid_reg
c_func
(paren
id|ac97
comma
id|reg
)paren
)paren
r_return
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ac97-&gt;reg_mutex
)paren
suffix:semicolon
id|ac97-&gt;regs
(braket
id|reg
)braket
op_assign
id|value
suffix:semicolon
id|ac97-&gt;bus-&gt;ops
op_member_access_from_pointer
id|write
c_func
(paren
id|ac97
comma
id|reg
comma
id|value
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|reg
comma
id|ac97-&gt;reg_accessed
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ac97-&gt;reg_mutex
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * snd_ac97_update - update the value on the given register&n; * @ac97: the ac97 instance&n; * @reg: the register to change&n; * @value: the value to set&n; *&n; * Compares the value with the register cache and updates the value&n; * only when the value is changed.&n; *&n; * Returns 1 if the value is changed, 0 if no change, or a negative&n; * code on failure.&n; */
DECL|function|snd_ac97_update
r_int
id|snd_ac97_update
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|value
)paren
(brace
r_int
id|change
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_ac97_valid_reg
c_func
(paren
id|ac97
comma
id|reg
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ac97-&gt;reg_mutex
)paren
suffix:semicolon
id|change
op_assign
id|ac97-&gt;regs
(braket
id|reg
)braket
op_ne
id|value
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
(brace
id|ac97-&gt;regs
(braket
id|reg
)braket
op_assign
id|value
suffix:semicolon
id|ac97-&gt;bus-&gt;ops
op_member_access_from_pointer
id|write
c_func
(paren
id|ac97
comma
id|reg
comma
id|value
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|ac97-&gt;reg_mutex
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
multiline_comment|/**&n; * snd_ac97_update_bits - update the bits on the given register&n; * @ac97: the ac97 instance&n; * @reg: the register to change&n; * @mask: the bit-mask to change&n; * @value: the value to set&n; *&n; * Updates the masked-bits on the given register only when the value&n; * is changed.&n; *&n; * Returns 1 if the bits are changed, 0 if no change, or a negative&n; * code on failure.&n; */
DECL|function|snd_ac97_update_bits
r_int
id|snd_ac97_update_bits
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|mask
comma
r_int
r_int
id|value
)paren
(brace
r_int
id|change
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_ac97_valid_reg
c_func
(paren
id|ac97
comma
id|reg
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ac97-&gt;reg_mutex
)paren
suffix:semicolon
id|change
op_assign
id|snd_ac97_update_bits_nolock
c_func
(paren
id|ac97
comma
id|reg
comma
id|mask
comma
id|value
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ac97-&gt;reg_mutex
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
multiline_comment|/* no lock version - see snd_ac97_updat_bits() */
DECL|function|snd_ac97_update_bits_nolock
r_int
id|snd_ac97_update_bits_nolock
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|reg
comma
r_int
r_int
id|mask
comma
r_int
r_int
id|value
)paren
(brace
r_int
id|change
suffix:semicolon
r_int
r_int
id|old
comma
r_new
suffix:semicolon
id|old
op_assign
id|snd_ac97_read_cache
c_func
(paren
id|ac97
comma
id|reg
)paren
suffix:semicolon
r_new
op_assign
(paren
id|old
op_amp
op_complement
id|mask
)paren
op_or
id|value
suffix:semicolon
id|change
op_assign
id|old
op_ne
r_new
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
(brace
id|ac97-&gt;regs
(braket
id|reg
)braket
op_assign
r_new
suffix:semicolon
id|ac97-&gt;bus-&gt;ops
op_member_access_from_pointer
id|write
c_func
(paren
id|ac97
comma
id|reg
comma
r_new
)paren
suffix:semicolon
)brace
r_return
id|change
suffix:semicolon
)brace
DECL|function|snd_ac97_ad18xx_update_pcm_bits
r_static
r_int
id|snd_ac97_ad18xx_update_pcm_bits
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
id|codec
comma
r_int
r_int
id|mask
comma
r_int
r_int
id|value
)paren
(brace
r_int
id|change
suffix:semicolon
r_int
r_int
id|old
comma
r_new
comma
id|cfg
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ac97-&gt;page_mutex
)paren
suffix:semicolon
id|old
op_assign
id|ac97-&gt;spec.ad18xx.pcmreg
(braket
id|codec
)braket
suffix:semicolon
r_new
op_assign
(paren
id|old
op_amp
op_complement
id|mask
)paren
op_or
id|value
suffix:semicolon
id|change
op_assign
id|old
op_ne
r_new
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
(brace
id|down
c_func
(paren
op_amp
id|ac97-&gt;reg_mutex
)paren
suffix:semicolon
id|cfg
op_assign
id|snd_ac97_read_cache
c_func
(paren
id|ac97
comma
id|AC97_AD_SERIAL_CFG
)paren
suffix:semicolon
id|ac97-&gt;spec.ad18xx.pcmreg
(braket
id|codec
)braket
op_assign
r_new
suffix:semicolon
multiline_comment|/* select single codec */
id|ac97-&gt;bus-&gt;ops
op_member_access_from_pointer
id|write
c_func
(paren
id|ac97
comma
id|AC97_AD_SERIAL_CFG
comma
(paren
id|cfg
op_amp
op_complement
l_int|0x7000
)paren
op_or
id|ac97-&gt;spec.ad18xx.unchained
(braket
id|codec
)braket
op_or
id|ac97-&gt;spec.ad18xx.chained
(braket
id|codec
)braket
)paren
suffix:semicolon
multiline_comment|/* update PCM bits */
id|ac97-&gt;bus-&gt;ops
op_member_access_from_pointer
id|write
c_func
(paren
id|ac97
comma
id|AC97_PCM
comma
r_new
)paren
suffix:semicolon
multiline_comment|/* select all codecs */
id|ac97-&gt;bus-&gt;ops
op_member_access_from_pointer
id|write
c_func
(paren
id|ac97
comma
id|AC97_AD_SERIAL_CFG
comma
id|cfg
op_or
l_int|0x7000
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ac97-&gt;reg_mutex
)paren
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|ac97-&gt;page_mutex
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
multiline_comment|/*&n; * Controls&n; */
DECL|function|snd_ac97_info_enum_double
r_int
id|snd_ac97_info_enum_double
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_struct
id|ac97_enum
op_star
id|e
op_assign
(paren
r_struct
id|ac97_enum
op_star
)paren
id|kcontrol-&gt;private_value
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_ENUMERATED
suffix:semicolon
id|uinfo-&gt;count
op_assign
id|e-&gt;shift_l
op_eq
id|e-&gt;shift_r
ques
c_cond
l_int|1
suffix:colon
l_int|2
suffix:semicolon
id|uinfo-&gt;value.enumerated.items
op_assign
id|e-&gt;mask
suffix:semicolon
r_if
c_cond
(paren
id|uinfo-&gt;value.enumerated.item
OG
id|e-&gt;mask
op_minus
l_int|1
)paren
id|uinfo-&gt;value.enumerated.item
op_assign
id|e-&gt;mask
op_minus
l_int|1
suffix:semicolon
id|strcpy
c_func
(paren
id|uinfo-&gt;value.enumerated.name
comma
id|e-&gt;texts
(braket
id|uinfo-&gt;value.enumerated.item
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ac97_get_enum_double
r_int
id|snd_ac97_get_enum_double
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ac97_t
op_star
id|ac97
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_struct
id|ac97_enum
op_star
id|e
op_assign
(paren
r_struct
id|ac97_enum
op_star
)paren
id|kcontrol-&gt;private_value
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
id|snd_ac97_read_cache
c_func
(paren
id|ac97
comma
id|e-&gt;reg
)paren
suffix:semicolon
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
op_assign
(paren
id|val
op_rshift
id|e-&gt;shift_l
)paren
op_amp
(paren
id|e-&gt;mask
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|e-&gt;shift_l
op_ne
id|e-&gt;shift_r
)paren
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|1
)braket
op_assign
(paren
id|val
op_rshift
id|e-&gt;shift_r
)paren
op_amp
(paren
id|e-&gt;mask
op_minus
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ac97_put_enum_double
r_int
id|snd_ac97_put_enum_double
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ac97_t
op_star
id|ac97
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_struct
id|ac97_enum
op_star
id|e
op_assign
(paren
r_struct
id|ac97_enum
op_star
)paren
id|kcontrol-&gt;private_value
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
r_int
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
OG
id|e-&gt;mask
op_minus
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|val
op_assign
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
op_lshift
id|e-&gt;shift_l
suffix:semicolon
id|mask
op_assign
(paren
id|e-&gt;mask
op_minus
l_int|1
)paren
op_lshift
id|e-&gt;shift_l
suffix:semicolon
r_if
c_cond
(paren
id|e-&gt;shift_l
op_ne
id|e-&gt;shift_r
)paren
(brace
r_if
c_cond
(paren
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|1
)braket
OG
id|e-&gt;mask
op_minus
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|val
op_or_assign
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|1
)braket
op_lshift
id|e-&gt;shift_r
suffix:semicolon
id|mask
op_or_assign
(paren
id|e-&gt;mask
op_minus
l_int|1
)paren
op_lshift
id|e-&gt;shift_r
suffix:semicolon
)brace
r_return
id|snd_ac97_update_bits
c_func
(paren
id|ac97
comma
id|e-&gt;reg
comma
id|mask
comma
id|val
)paren
suffix:semicolon
)brace
multiline_comment|/* save/restore ac97 v2.3 paging */
DECL|function|snd_ac97_page_save
r_static
r_int
id|snd_ac97_page_save
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
id|reg
comma
id|snd_kcontrol_t
op_star
id|kcontrol
)paren
(brace
r_int
id|page_save
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|kcontrol-&gt;private_value
op_amp
(paren
l_int|1
op_lshift
l_int|25
)paren
)paren
op_logical_and
(paren
id|ac97-&gt;ext_id
op_amp
id|AC97_EI_REV_MASK
)paren
op_ge
id|AC97_EI_REV_23
op_logical_and
(paren
id|reg
op_ge
l_int|0x60
op_logical_and
id|reg
OL
l_int|0x70
)paren
)paren
(brace
r_int
r_int
id|page
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|26
)paren
op_amp
l_int|0x0f
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ac97-&gt;page_mutex
)paren
suffix:semicolon
multiline_comment|/* lock paging */
id|page_save
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_INT_PAGING
)paren
op_amp
id|AC97_PAGE_MASK
suffix:semicolon
id|snd_ac97_update_bits
c_func
(paren
id|ac97
comma
id|AC97_INT_PAGING
comma
id|AC97_PAGE_MASK
comma
id|page
)paren
suffix:semicolon
)brace
r_return
id|page_save
suffix:semicolon
)brace
DECL|function|snd_ac97_page_restore
r_static
r_void
id|snd_ac97_page_restore
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
id|page_save
)paren
(brace
r_if
c_cond
(paren
id|page_save
op_ge
l_int|0
)paren
(brace
id|snd_ac97_update_bits
c_func
(paren
id|ac97
comma
id|AC97_INT_PAGING
comma
id|AC97_PAGE_MASK
comma
id|page_save
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ac97-&gt;page_mutex
)paren
suffix:semicolon
multiline_comment|/* unlock paging */
)brace
)brace
multiline_comment|/* volume and switch controls */
DECL|function|snd_ac97_info_volsw
r_int
id|snd_ac97_info_volsw
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_int
id|rshift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|12
)paren
op_amp
l_int|0x0f
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|mask
op_eq
l_int|1
ques
c_cond
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:colon
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
id|shift
op_eq
id|rshift
ques
c_cond
l_int|1
suffix:colon
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
id|mask
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ac97_get_volsw
r_int
id|snd_ac97_get_volsw
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ac97_t
op_star
id|ac97
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_int
id|rshift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|12
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0x01
suffix:semicolon
r_int
id|page_save
suffix:semicolon
id|page_save
op_assign
id|snd_ac97_page_save
c_func
(paren
id|ac97
comma
id|reg
comma
id|kcontrol
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|snd_ac97_read_cache
c_func
(paren
id|ac97
comma
id|reg
)paren
op_rshift
id|shift
)paren
op_amp
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|shift
op_ne
id|rshift
)paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
(paren
id|snd_ac97_read_cache
c_func
(paren
id|ac97
comma
id|reg
)paren
op_rshift
id|rshift
)paren
op_amp
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
(brace
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|mask
op_minus
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|shift
op_ne
id|rshift
)paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
id|mask
op_minus
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
suffix:semicolon
)brace
id|snd_ac97_page_restore
c_func
(paren
id|ac97
comma
id|page_save
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ac97_put_volsw
r_int
id|snd_ac97_put_volsw
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ac97_t
op_star
id|ac97
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_int
id|rshift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|12
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0x01
suffix:semicolon
r_int
id|err
comma
id|page_save
suffix:semicolon
r_int
r_int
id|val
comma
id|val2
comma
id|val_mask
suffix:semicolon
id|page_save
op_assign
id|snd_ac97_page_save
c_func
(paren
id|ac97
comma
id|reg
comma
id|kcontrol
)paren
suffix:semicolon
id|val
op_assign
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
id|mask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
id|val
op_assign
id|mask
op_minus
id|val
suffix:semicolon
id|val_mask
op_assign
id|mask
op_lshift
id|shift
suffix:semicolon
id|val
op_assign
id|val
op_lshift
id|shift
suffix:semicolon
r_if
c_cond
(paren
id|shift
op_ne
id|rshift
)paren
(brace
id|val2
op_assign
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_amp
id|mask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
id|val2
op_assign
id|mask
op_minus
id|val2
suffix:semicolon
id|val_mask
op_or_assign
id|mask
op_lshift
id|rshift
suffix:semicolon
id|val
op_or_assign
id|val2
op_lshift
id|rshift
suffix:semicolon
)brace
id|err
op_assign
id|snd_ac97_update_bits
c_func
(paren
id|ac97
comma
id|reg
comma
id|val_mask
comma
id|val
)paren
suffix:semicolon
id|snd_ac97_page_restore
c_func
(paren
id|ac97
comma
id|page_save
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|variable|snd_ac97_controls_master_mono
r_static
r_const
id|snd_kcontrol_new_t
id|snd_ac97_controls_master_mono
(braket
l_int|2
)braket
op_assign
(brace
id|AC97_SINGLE
c_func
(paren
l_string|&quot;Master Mono Playback Switch&quot;
comma
id|AC97_MASTER_MONO
comma
l_int|15
comma
l_int|1
comma
l_int|1
)paren
comma
id|AC97_SINGLE
c_func
(paren
l_string|&quot;Master Mono Playback Volume&quot;
comma
id|AC97_MASTER_MONO
comma
l_int|0
comma
l_int|31
comma
l_int|1
)paren
)brace
suffix:semicolon
DECL|variable|snd_ac97_controls_tone
r_static
r_const
id|snd_kcontrol_new_t
id|snd_ac97_controls_tone
(braket
l_int|2
)braket
op_assign
(brace
id|AC97_SINGLE
c_func
(paren
l_string|&quot;Tone Control - Bass&quot;
comma
id|AC97_MASTER_TONE
comma
l_int|8
comma
l_int|15
comma
l_int|1
)paren
comma
id|AC97_SINGLE
c_func
(paren
l_string|&quot;Tone Control - Treble&quot;
comma
id|AC97_MASTER_TONE
comma
l_int|0
comma
l_int|15
comma
l_int|1
)paren
)brace
suffix:semicolon
DECL|variable|snd_ac97_controls_pc_beep
r_static
r_const
id|snd_kcontrol_new_t
id|snd_ac97_controls_pc_beep
(braket
l_int|2
)braket
op_assign
(brace
id|AC97_SINGLE
c_func
(paren
l_string|&quot;PC Speaker Playback Switch&quot;
comma
id|AC97_PC_BEEP
comma
l_int|15
comma
l_int|1
comma
l_int|1
)paren
comma
id|AC97_SINGLE
c_func
(paren
l_string|&quot;PC Speaker Playback Volume&quot;
comma
id|AC97_PC_BEEP
comma
l_int|1
comma
l_int|15
comma
l_int|1
)paren
)brace
suffix:semicolon
DECL|variable|snd_ac97_controls_mic_boost
r_static
r_const
id|snd_kcontrol_new_t
id|snd_ac97_controls_mic_boost
op_assign
id|AC97_SINGLE
c_func
(paren
l_string|&quot;Mic Boost (+20dB)&quot;
comma
id|AC97_MIC
comma
l_int|6
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
DECL|variable|std_rec_sel
r_static
r_const
r_char
op_star
id|std_rec_sel
(braket
)braket
op_assign
(brace
l_string|&quot;Mic&quot;
comma
l_string|&quot;CD&quot;
comma
l_string|&quot;Video&quot;
comma
l_string|&quot;Aux&quot;
comma
l_string|&quot;Line&quot;
comma
l_string|&quot;Mix&quot;
comma
l_string|&quot;Mix Mono&quot;
comma
l_string|&quot;Phone&quot;
)brace
suffix:semicolon
DECL|variable|std_3d_path
r_static
r_const
r_char
op_star
id|std_3d_path
(braket
)braket
op_assign
(brace
l_string|&quot;pre 3D&quot;
comma
l_string|&quot;post 3D&quot;
)brace
suffix:semicolon
DECL|variable|std_mix
r_static
r_const
r_char
op_star
id|std_mix
(braket
)braket
op_assign
(brace
l_string|&quot;Mix&quot;
comma
l_string|&quot;Mic&quot;
)brace
suffix:semicolon
DECL|variable|std_mic
r_static
r_const
r_char
op_star
id|std_mic
(braket
)braket
op_assign
(brace
l_string|&quot;Mic1&quot;
comma
l_string|&quot;Mic2&quot;
)brace
suffix:semicolon
DECL|variable|std_enum
r_static
r_const
r_struct
id|ac97_enum
id|std_enum
(braket
)braket
op_assign
(brace
id|AC97_ENUM_DOUBLE
c_func
(paren
id|AC97_REC_SEL
comma
l_int|8
comma
l_int|0
comma
l_int|8
comma
id|std_rec_sel
)paren
comma
id|AC97_ENUM_SINGLE
c_func
(paren
id|AC97_GENERAL_PURPOSE
comma
l_int|15
comma
l_int|2
comma
id|std_3d_path
)paren
comma
id|AC97_ENUM_SINGLE
c_func
(paren
id|AC97_GENERAL_PURPOSE
comma
l_int|9
comma
l_int|2
comma
id|std_mix
)paren
comma
id|AC97_ENUM_SINGLE
c_func
(paren
id|AC97_GENERAL_PURPOSE
comma
l_int|8
comma
l_int|2
comma
id|std_mic
)paren
comma
)brace
suffix:semicolon
DECL|variable|snd_ac97_control_capture_src
r_static
r_const
id|snd_kcontrol_new_t
id|snd_ac97_control_capture_src
op_assign
id|AC97_ENUM
c_func
(paren
l_string|&quot;Capture Source&quot;
comma
id|std_enum
(braket
l_int|0
)braket
)paren
suffix:semicolon
DECL|variable|snd_ac97_control_capture_vol
r_static
r_const
id|snd_kcontrol_new_t
id|snd_ac97_control_capture_vol
op_assign
id|AC97_DOUBLE
c_func
(paren
l_string|&quot;Capture Volume&quot;
comma
id|AC97_REC_GAIN
comma
l_int|8
comma
l_int|0
comma
l_int|15
comma
l_int|0
)paren
suffix:semicolon
DECL|variable|snd_ac97_controls_mic_capture
r_static
r_const
id|snd_kcontrol_new_t
id|snd_ac97_controls_mic_capture
(braket
l_int|2
)braket
op_assign
(brace
id|AC97_SINGLE
c_func
(paren
l_string|&quot;Mic Capture Switch&quot;
comma
id|AC97_REC_GAIN_MIC
comma
l_int|15
comma
l_int|1
comma
l_int|1
)paren
comma
id|AC97_SINGLE
c_func
(paren
l_string|&quot;Mic Capture Volume&quot;
comma
id|AC97_REC_GAIN_MIC
comma
l_int|0
comma
l_int|15
comma
l_int|0
)paren
)brace
suffix:semicolon
r_typedef
r_enum
(brace
DECL|enumerator|AC97_GENERAL_PCM_OUT
id|AC97_GENERAL_PCM_OUT
op_assign
l_int|0
comma
DECL|enumerator|AC97_GENERAL_STEREO_ENHANCEMENT
id|AC97_GENERAL_STEREO_ENHANCEMENT
comma
DECL|enumerator|AC97_GENERAL_3D
id|AC97_GENERAL_3D
comma
DECL|enumerator|AC97_GENERAL_LOUDNESS
id|AC97_GENERAL_LOUDNESS
comma
DECL|enumerator|AC97_GENERAL_MONO
id|AC97_GENERAL_MONO
comma
DECL|enumerator|AC97_GENERAL_MIC
id|AC97_GENERAL_MIC
comma
DECL|enumerator|AC97_GENERAL_LOOPBACK
id|AC97_GENERAL_LOOPBACK
DECL|typedef|ac97_general_index_t
)brace
id|ac97_general_index_t
suffix:semicolon
DECL|variable|snd_ac97_controls_general
r_static
r_const
id|snd_kcontrol_new_t
id|snd_ac97_controls_general
(braket
l_int|7
)braket
op_assign
(brace
id|AC97_ENUM
c_func
(paren
l_string|&quot;PCM Out Path &amp; Mute&quot;
comma
id|std_enum
(braket
l_int|1
)braket
)paren
comma
id|AC97_SINGLE
c_func
(paren
l_string|&quot;Simulated Stereo Enhancement&quot;
comma
id|AC97_GENERAL_PURPOSE
comma
l_int|14
comma
l_int|1
comma
l_int|0
)paren
comma
id|AC97_SINGLE
c_func
(paren
l_string|&quot;3D Control - Switch&quot;
comma
id|AC97_GENERAL_PURPOSE
comma
l_int|13
comma
l_int|1
comma
l_int|0
)paren
comma
id|AC97_SINGLE
c_func
(paren
l_string|&quot;Loudness (bass boost)&quot;
comma
id|AC97_GENERAL_PURPOSE
comma
l_int|12
comma
l_int|1
comma
l_int|0
)paren
comma
id|AC97_ENUM
c_func
(paren
l_string|&quot;Mono Output Select&quot;
comma
id|std_enum
(braket
l_int|2
)braket
)paren
comma
id|AC97_ENUM
c_func
(paren
l_string|&quot;Mic Select&quot;
comma
id|std_enum
(braket
l_int|3
)braket
)paren
comma
id|AC97_SINGLE
c_func
(paren
l_string|&quot;ADC/DAC Loopback&quot;
comma
id|AC97_GENERAL_PURPOSE
comma
l_int|7
comma
l_int|1
comma
l_int|0
)paren
)brace
suffix:semicolon
DECL|variable|snd_ac97_controls_3d
r_const
id|snd_kcontrol_new_t
id|snd_ac97_controls_3d
(braket
l_int|2
)braket
op_assign
(brace
id|AC97_SINGLE
c_func
(paren
l_string|&quot;3D Control - Center&quot;
comma
id|AC97_3D_CONTROL
comma
l_int|8
comma
l_int|15
comma
l_int|0
)paren
comma
id|AC97_SINGLE
c_func
(paren
l_string|&quot;3D Control - Depth&quot;
comma
id|AC97_3D_CONTROL
comma
l_int|0
comma
l_int|15
comma
l_int|0
)paren
)brace
suffix:semicolon
DECL|variable|snd_ac97_controls_center
r_static
r_const
id|snd_kcontrol_new_t
id|snd_ac97_controls_center
(braket
l_int|2
)braket
op_assign
(brace
id|AC97_SINGLE
c_func
(paren
l_string|&quot;Center Playback Switch&quot;
comma
id|AC97_CENTER_LFE_MASTER
comma
l_int|7
comma
l_int|1
comma
l_int|1
)paren
comma
id|AC97_SINGLE
c_func
(paren
l_string|&quot;Center Playback Volume&quot;
comma
id|AC97_CENTER_LFE_MASTER
comma
l_int|0
comma
l_int|31
comma
l_int|1
)paren
)brace
suffix:semicolon
DECL|variable|snd_ac97_controls_lfe
r_static
r_const
id|snd_kcontrol_new_t
id|snd_ac97_controls_lfe
(braket
l_int|2
)braket
op_assign
(brace
id|AC97_SINGLE
c_func
(paren
l_string|&quot;LFE Playback Switch&quot;
comma
id|AC97_CENTER_LFE_MASTER
comma
l_int|15
comma
l_int|1
comma
l_int|1
)paren
comma
id|AC97_SINGLE
c_func
(paren
l_string|&quot;LFE Playback Volume&quot;
comma
id|AC97_CENTER_LFE_MASTER
comma
l_int|8
comma
l_int|31
comma
l_int|1
)paren
)brace
suffix:semicolon
DECL|variable|snd_ac97_controls_surround
r_static
r_const
id|snd_kcontrol_new_t
id|snd_ac97_controls_surround
(braket
l_int|2
)braket
op_assign
(brace
id|AC97_DOUBLE
c_func
(paren
l_string|&quot;Surround Playback Switch&quot;
comma
id|AC97_SURROUND_MASTER
comma
l_int|15
comma
l_int|7
comma
l_int|1
comma
l_int|1
)paren
comma
id|AC97_DOUBLE
c_func
(paren
l_string|&quot;Surround Playback Volume&quot;
comma
id|AC97_SURROUND_MASTER
comma
l_int|8
comma
l_int|0
comma
l_int|31
comma
l_int|1
)paren
comma
)brace
suffix:semicolon
DECL|variable|snd_ac97_control_eapd
r_static
r_const
id|snd_kcontrol_new_t
id|snd_ac97_control_eapd
op_assign
id|AC97_SINGLE
c_func
(paren
l_string|&quot;External Amplifier&quot;
comma
id|AC97_POWERDOWN
comma
l_int|15
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* change the existing EAPD control as inverted */
DECL|function|set_inv_eapd
r_static
r_void
id|set_inv_eapd
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
id|snd_kcontrol_t
op_star
id|kctl
)paren
(brace
id|kctl-&gt;private_value
op_assign
id|AC97_SINGLE_VALUE
c_func
(paren
id|AC97_POWERDOWN
comma
l_int|15
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|snd_ac97_update_bits
c_func
(paren
id|ac97
comma
id|AC97_POWERDOWN
comma
(paren
l_int|1
op_lshift
l_int|15
)paren
comma
(paren
l_int|1
op_lshift
l_int|15
)paren
)paren
suffix:semicolon
multiline_comment|/* EAPD up */
id|ac97-&gt;scaps
op_or_assign
id|AC97_SCAP_INV_EAPD
suffix:semicolon
)brace
DECL|function|snd_ac97_spdif_mask_info
r_static
r_int
id|snd_ac97_spdif_mask_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_IEC958
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ac97_spdif_cmask_get
r_static
r_int
id|snd_ac97_spdif_cmask_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_assign
id|IEC958_AES0_PROFESSIONAL
op_or
id|IEC958_AES0_NONAUDIO
op_or
id|IEC958_AES0_CON_EMPHASIS_5015
op_or
id|IEC958_AES0_CON_NOT_COPYRIGHT
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|1
)braket
op_assign
id|IEC958_AES1_CON_CATEGORY
op_or
id|IEC958_AES1_CON_ORIGINAL
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
op_assign
id|IEC958_AES3_CON_FS
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ac97_spdif_pmask_get
r_static
r_int
id|snd_ac97_spdif_pmask_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
multiline_comment|/* FIXME: AC&squot;97 spec doesn&squot;t say which bits are used for what */
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_assign
id|IEC958_AES0_PROFESSIONAL
op_or
id|IEC958_AES0_NONAUDIO
op_or
id|IEC958_AES0_PRO_FS
op_or
id|IEC958_AES0_PRO_EMPHASIS_5015
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ac97_spdif_default_get
r_static
r_int
id|snd_ac97_spdif_default_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ac97_t
op_star
id|ac97
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ac97-&gt;reg_mutex
)paren
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_assign
id|ac97-&gt;spdif_status
op_amp
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|1
)braket
op_assign
(paren
id|ac97-&gt;spdif_status
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|2
)braket
op_assign
(paren
id|ac97-&gt;spdif_status
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
op_assign
(paren
id|ac97-&gt;spdif_status
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ac97-&gt;reg_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ac97_spdif_default_put
r_static
r_int
id|snd_ac97_spdif_default_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ac97_t
op_star
id|ac97
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
r_new
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|val
op_assign
l_int|0
suffix:semicolon
r_int
id|change
suffix:semicolon
r_new
op_assign
id|val
op_assign
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_amp
(paren
id|IEC958_AES0_PROFESSIONAL
op_or
id|IEC958_AES0_NONAUDIO
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_amp
id|IEC958_AES0_PROFESSIONAL
)paren
(brace
r_new
op_or_assign
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_amp
(paren
id|IEC958_AES0_PRO_FS
op_or
id|IEC958_AES0_PRO_EMPHASIS_5015
)paren
suffix:semicolon
r_switch
c_cond
(paren
r_new
op_amp
id|IEC958_AES0_PRO_FS
)paren
(brace
r_case
id|IEC958_AES0_PRO_FS_44100
suffix:colon
id|val
op_or_assign
l_int|0
op_lshift
l_int|12
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IEC958_AES0_PRO_FS_48000
suffix:colon
id|val
op_or_assign
l_int|2
op_lshift
l_int|12
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IEC958_AES0_PRO_FS_32000
suffix:colon
id|val
op_or_assign
l_int|3
op_lshift
l_int|12
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|val
op_or_assign
l_int|1
op_lshift
l_int|12
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
r_new
op_amp
id|IEC958_AES0_PRO_EMPHASIS
)paren
op_eq
id|IEC958_AES0_PRO_EMPHASIS_5015
)paren
id|val
op_or_assign
l_int|1
op_lshift
l_int|3
suffix:semicolon
)brace
r_else
(brace
r_new
op_or_assign
id|ucontrol-&gt;value.iec958.status
(braket
l_int|0
)braket
op_amp
(paren
id|IEC958_AES0_CON_EMPHASIS_5015
op_or
id|IEC958_AES0_CON_NOT_COPYRIGHT
)paren
suffix:semicolon
r_new
op_or_assign
(paren
(paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|1
)braket
op_amp
(paren
id|IEC958_AES1_CON_CATEGORY
op_or
id|IEC958_AES1_CON_ORIGINAL
)paren
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
r_new
op_or_assign
(paren
(paren
id|ucontrol-&gt;value.iec958.status
(braket
l_int|3
)braket
op_amp
id|IEC958_AES3_CON_FS
)paren
op_lshift
l_int|24
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
r_new
op_amp
id|IEC958_AES0_CON_EMPHASIS
)paren
op_eq
id|IEC958_AES0_CON_EMPHASIS_5015
)paren
id|val
op_or_assign
l_int|1
op_lshift
l_int|3
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
r_new
op_amp
id|IEC958_AES0_CON_NOT_COPYRIGHT
)paren
)paren
id|val
op_or_assign
l_int|1
op_lshift
l_int|2
suffix:semicolon
id|val
op_or_assign
(paren
(paren
r_new
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
op_lshift
l_int|4
suffix:semicolon
singleline_comment|// category + original
r_switch
c_cond
(paren
(paren
r_new
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
)paren
(brace
r_case
id|IEC958_AES3_CON_FS_44100
suffix:colon
id|val
op_or_assign
l_int|0
op_lshift
l_int|12
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IEC958_AES3_CON_FS_48000
suffix:colon
id|val
op_or_assign
l_int|2
op_lshift
l_int|12
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IEC958_AES3_CON_FS_32000
suffix:colon
id|val
op_or_assign
l_int|3
op_lshift
l_int|12
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|val
op_or_assign
l_int|1
op_lshift
l_int|12
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|down
c_func
(paren
op_amp
id|ac97-&gt;reg_mutex
)paren
suffix:semicolon
id|change
op_assign
id|ac97-&gt;spdif_status
op_ne
r_new
suffix:semicolon
id|ac97-&gt;spdif_status
op_assign
r_new
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;flags
op_amp
id|AC97_CS_SPDIF
)paren
(brace
r_int
id|x
op_assign
(paren
id|val
op_rshift
l_int|12
)paren
op_amp
l_int|0x03
suffix:semicolon
r_switch
c_cond
(paren
id|x
)paren
(brace
r_case
l_int|0
suffix:colon
id|x
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
singleline_comment|// 44.1
r_case
l_int|2
suffix:colon
id|x
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
singleline_comment|// 48.0
r_default
suffix:colon
id|x
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
singleline_comment|// illegal.
)brace
id|change
op_or_assign
id|snd_ac97_update_bits_nolock
c_func
(paren
id|ac97
comma
id|AC97_CSR_SPDIF
comma
l_int|0x3fff
comma
(paren
(paren
id|val
op_amp
l_int|0xcfff
)paren
op_or
(paren
id|x
op_lshift
l_int|12
)paren
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|ac97-&gt;flags
op_amp
id|AC97_CX_SPDIF
)paren
(brace
r_int
id|v
suffix:semicolon
id|v
op_assign
r_new
op_amp
(paren
id|IEC958_AES0_CON_EMPHASIS_5015
op_or
id|IEC958_AES0_CON_NOT_COPYRIGHT
)paren
ques
c_cond
l_int|0
suffix:colon
id|AC97_CXR_COPYRGT
suffix:semicolon
id|v
op_or_assign
r_new
op_amp
id|IEC958_AES0_NONAUDIO
ques
c_cond
id|AC97_CXR_SPDIF_AC3
suffix:colon
id|AC97_CXR_SPDIF_PCM
suffix:semicolon
id|change
op_or_assign
id|snd_ac97_update_bits_nolock
c_func
(paren
id|ac97
comma
id|AC97_CXR_AUDIO_MISC
comma
id|AC97_CXR_SPDIF_MASK
op_or
id|AC97_CXR_COPYRGT
comma
id|v
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
r_int
id|extst
op_assign
id|snd_ac97_read_cache
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_STATUS
)paren
suffix:semicolon
id|snd_ac97_update_bits_nolock
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_STATUS
comma
id|AC97_EA_SPDIF
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* turn off */
id|change
op_or_assign
id|snd_ac97_update_bits_nolock
c_func
(paren
id|ac97
comma
id|AC97_SPDIF
comma
l_int|0x3fff
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|extst
op_amp
id|AC97_EA_SPDIF
)paren
(brace
id|snd_ac97_update_bits_nolock
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_STATUS
comma
id|AC97_EA_SPDIF
comma
id|AC97_EA_SPDIF
)paren
suffix:semicolon
multiline_comment|/* turn on again */
)brace
)brace
id|up
c_func
(paren
op_amp
id|ac97-&gt;reg_mutex
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|function|snd_ac97_put_spsa
r_static
r_int
id|snd_ac97_put_spsa
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ac97_t
op_star
id|ac97
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
singleline_comment|// int invert = (kcontrol-&gt;private_value &gt;&gt; 24) &amp; 0xff;
r_int
r_int
id|value
comma
id|old
comma
r_new
suffix:semicolon
r_int
id|change
suffix:semicolon
id|value
op_assign
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
id|mask
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ac97-&gt;reg_mutex
)paren
suffix:semicolon
id|mask
op_lshift_assign
id|shift
suffix:semicolon
id|value
op_lshift_assign
id|shift
suffix:semicolon
id|old
op_assign
id|snd_ac97_read_cache
c_func
(paren
id|ac97
comma
id|reg
)paren
suffix:semicolon
r_new
op_assign
(paren
id|old
op_amp
op_complement
id|mask
)paren
op_or
id|value
suffix:semicolon
id|change
op_assign
id|old
op_ne
r_new
suffix:semicolon
r_if
c_cond
(paren
id|change
)paren
(brace
r_int
r_int
id|extst
op_assign
id|snd_ac97_read_cache
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_STATUS
)paren
suffix:semicolon
id|snd_ac97_update_bits_nolock
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_STATUS
comma
id|AC97_EA_SPDIF
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* turn off */
id|change
op_assign
id|snd_ac97_update_bits_nolock
c_func
(paren
id|ac97
comma
id|reg
comma
id|mask
comma
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|extst
op_amp
id|AC97_EA_SPDIF
)paren
id|snd_ac97_update_bits_nolock
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_STATUS
comma
id|AC97_EA_SPDIF
comma
id|AC97_EA_SPDIF
)paren
suffix:semicolon
multiline_comment|/* turn on again */
)brace
id|up
c_func
(paren
op_amp
id|ac97-&gt;reg_mutex
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|snd_ac97_controls_spdif
r_const
id|snd_kcontrol_new_t
id|snd_ac97_controls_spdif
(braket
l_int|5
)braket
op_assign
(brace
(brace
dot
id|access
op_assign
id|SNDRV_CTL_ELEM_ACCESS_READ
comma
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|PLAYBACK
comma
id|CON_MASK
)paren
comma
dot
id|info
op_assign
id|snd_ac97_spdif_mask_info
comma
dot
id|get
op_assign
id|snd_ac97_spdif_cmask_get
comma
)brace
comma
(brace
dot
id|access
op_assign
id|SNDRV_CTL_ELEM_ACCESS_READ
comma
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|PLAYBACK
comma
id|PRO_MASK
)paren
comma
dot
id|info
op_assign
id|snd_ac97_spdif_mask_info
comma
dot
id|get
op_assign
id|snd_ac97_spdif_pmask_get
comma
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|PLAYBACK
comma
id|DEFAULT
)paren
comma
dot
id|info
op_assign
id|snd_ac97_spdif_mask_info
comma
dot
id|get
op_assign
id|snd_ac97_spdif_default_get
comma
dot
id|put
op_assign
id|snd_ac97_spdif_default_put
comma
)brace
comma
id|AC97_SINGLE
c_func
(paren
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|PLAYBACK
comma
id|SWITCH
)paren
comma
id|AC97_EXTENDED_STATUS
comma
l_int|2
comma
l_int|1
comma
l_int|0
)paren
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
id|SNDRV_CTL_NAME_IEC958
c_func
(paren
l_string|&quot;&quot;
comma
id|PLAYBACK
comma
id|NONE
)paren
l_string|&quot;AC97-SPSA&quot;
comma
dot
id|info
op_assign
id|snd_ac97_info_volsw
comma
dot
id|get
op_assign
id|snd_ac97_get_volsw
comma
dot
id|put
op_assign
id|snd_ac97_put_spsa
comma
dot
id|private_value
op_assign
id|AC97_SINGLE_VALUE
c_func
(paren
id|AC97_EXTENDED_STATUS
comma
l_int|4
comma
l_int|3
comma
l_int|0
)paren
)brace
comma
)brace
suffix:semicolon
DECL|macro|AD18XX_PCM_BITS
mdefine_line|#define AD18XX_PCM_BITS(xname, codec, lshift, rshift, mask) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, .info = snd_ac97_ad18xx_pcm_info_bits, &bslash;&n;  .get = snd_ac97_ad18xx_pcm_get_bits, .put = snd_ac97_ad18xx_pcm_put_bits, &bslash;&n;  .private_value = (codec) | ((lshift) &lt;&lt; 8) | ((rshift) &lt;&lt; 12) | ((mask) &lt;&lt; 16) }
DECL|function|snd_ac97_ad18xx_pcm_info_bits
r_static
r_int
id|snd_ac97_ad18xx_pcm_info_bits
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|ac97_t
op_star
id|ac97
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_int
id|lshift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_int
id|rshift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|12
)paren
op_amp
l_int|0x0f
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|mask
op_eq
l_int|1
ques
c_cond
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:colon
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
r_if
c_cond
(paren
id|lshift
op_ne
id|rshift
op_logical_and
(paren
id|ac97-&gt;flags
op_amp
id|AC97_STEREO_MUTES
)paren
)paren
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
r_else
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
id|mask
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ac97_ad18xx_pcm_get_bits
r_static
r_int
id|snd_ac97_ad18xx_pcm_get_bits
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ac97_t
op_star
id|ac97
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|codec
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|3
suffix:semicolon
r_int
id|lshift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_int
id|rshift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|12
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|mask
op_minus
(paren
(paren
id|ac97-&gt;spec.ad18xx.pcmreg
(braket
id|codec
)braket
op_rshift
id|lshift
)paren
op_amp
id|mask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lshift
op_ne
id|rshift
op_logical_and
(paren
id|ac97-&gt;flags
op_amp
id|AC97_STEREO_MUTES
)paren
)paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
id|mask
op_minus
(paren
(paren
id|ac97-&gt;spec.ad18xx.pcmreg
(braket
id|codec
)braket
op_rshift
id|rshift
)paren
op_amp
id|mask
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ac97_ad18xx_pcm_put_bits
r_static
r_int
id|snd_ac97_ad18xx_pcm_put_bits
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ac97_t
op_star
id|ac97
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|codec
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|3
suffix:semicolon
r_int
id|lshift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_int
id|rshift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|12
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
r_int
id|val
comma
id|valmask
suffix:semicolon
id|val
op_assign
(paren
id|mask
op_minus
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
id|mask
)paren
)paren
op_lshift
id|lshift
suffix:semicolon
id|valmask
op_assign
id|mask
op_lshift
id|lshift
suffix:semicolon
r_if
c_cond
(paren
id|lshift
op_ne
id|rshift
op_logical_and
(paren
id|ac97-&gt;flags
op_amp
id|AC97_STEREO_MUTES
)paren
)paren
(brace
id|val
op_or_assign
(paren
id|mask
op_minus
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_amp
id|mask
)paren
)paren
op_lshift
id|rshift
suffix:semicolon
id|valmask
op_or_assign
id|mask
op_lshift
id|rshift
suffix:semicolon
)brace
r_return
id|snd_ac97_ad18xx_update_pcm_bits
c_func
(paren
id|ac97
comma
id|codec
comma
id|valmask
comma
id|val
)paren
suffix:semicolon
)brace
DECL|macro|AD18XX_PCM_VOLUME
mdefine_line|#define AD18XX_PCM_VOLUME(xname, codec) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, .info = snd_ac97_ad18xx_pcm_info_volume, &bslash;&n;  .get = snd_ac97_ad18xx_pcm_get_volume, .put = snd_ac97_ad18xx_pcm_put_volume, &bslash;&n;  .private_value = codec }
DECL|function|snd_ac97_ad18xx_pcm_info_volume
r_static
r_int
id|snd_ac97_ad18xx_pcm_info_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|31
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ac97_ad18xx_pcm_get_volume
r_static
r_int
id|snd_ac97_ad18xx_pcm_get_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ac97_t
op_star
id|ac97
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|codec
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|3
suffix:semicolon
id|down
c_func
(paren
op_amp
id|ac97-&gt;page_mutex
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
l_int|31
op_minus
(paren
(paren
id|ac97-&gt;spec.ad18xx.pcmreg
(braket
id|codec
)braket
op_rshift
l_int|0
)paren
op_amp
l_int|31
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
l_int|31
op_minus
(paren
(paren
id|ac97-&gt;spec.ad18xx.pcmreg
(braket
id|codec
)braket
op_rshift
l_int|8
)paren
op_amp
l_int|31
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|ac97-&gt;page_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ac97_ad18xx_pcm_put_volume
r_static
r_int
id|snd_ac97_ad18xx_pcm_put_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|ac97_t
op_star
id|ac97
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|codec
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|3
suffix:semicolon
r_int
r_int
id|val1
comma
id|val2
suffix:semicolon
id|val1
op_assign
l_int|31
op_minus
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|31
)paren
suffix:semicolon
id|val2
op_assign
l_int|31
op_minus
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_amp
l_int|31
)paren
suffix:semicolon
r_return
id|snd_ac97_ad18xx_update_pcm_bits
c_func
(paren
id|ac97
comma
id|codec
comma
l_int|0x1f1f
comma
(paren
id|val1
op_lshift
l_int|8
)paren
op_or
id|val2
)paren
suffix:semicolon
)brace
DECL|variable|snd_ac97_controls_ad18xx_pcm
r_static
r_const
id|snd_kcontrol_new_t
id|snd_ac97_controls_ad18xx_pcm
(braket
l_int|2
)braket
op_assign
(brace
id|AD18XX_PCM_BITS
c_func
(paren
l_string|&quot;PCM Playback Switch&quot;
comma
l_int|0
comma
l_int|15
comma
l_int|7
comma
l_int|1
)paren
comma
id|AD18XX_PCM_VOLUME
c_func
(paren
l_string|&quot;PCM Playback Volume&quot;
comma
l_int|0
)paren
)brace
suffix:semicolon
DECL|variable|snd_ac97_controls_ad18xx_surround
r_static
r_const
id|snd_kcontrol_new_t
id|snd_ac97_controls_ad18xx_surround
(braket
l_int|2
)braket
op_assign
(brace
id|AD18XX_PCM_BITS
c_func
(paren
l_string|&quot;Surround Playback Switch&quot;
comma
l_int|1
comma
l_int|15
comma
l_int|7
comma
l_int|1
)paren
comma
id|AD18XX_PCM_VOLUME
c_func
(paren
l_string|&quot;Surround Playback Volume&quot;
comma
l_int|1
)paren
)brace
suffix:semicolon
DECL|variable|snd_ac97_controls_ad18xx_center
r_static
r_const
id|snd_kcontrol_new_t
id|snd_ac97_controls_ad18xx_center
(braket
l_int|2
)braket
op_assign
(brace
id|AD18XX_PCM_BITS
c_func
(paren
l_string|&quot;Center Playback Switch&quot;
comma
l_int|2
comma
l_int|15
comma
l_int|15
comma
l_int|1
)paren
comma
id|AD18XX_PCM_BITS
c_func
(paren
l_string|&quot;Center Playback Volume&quot;
comma
l_int|2
comma
l_int|8
comma
l_int|8
comma
l_int|31
)paren
)brace
suffix:semicolon
DECL|variable|snd_ac97_controls_ad18xx_lfe
r_static
r_const
id|snd_kcontrol_new_t
id|snd_ac97_controls_ad18xx_lfe
(braket
l_int|2
)braket
op_assign
(brace
id|AD18XX_PCM_BITS
c_func
(paren
l_string|&quot;LFE Playback Switch&quot;
comma
l_int|2
comma
l_int|7
comma
l_int|7
comma
l_int|1
)paren
comma
id|AD18XX_PCM_BITS
c_func
(paren
l_string|&quot;LFE Playback Volume&quot;
comma
l_int|2
comma
l_int|0
comma
l_int|0
comma
l_int|31
)paren
)brace
suffix:semicolon
multiline_comment|/*&n; *&n; */
r_static
r_void
id|snd_ac97_powerdown
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
suffix:semicolon
DECL|function|snd_ac97_bus_free
r_static
r_int
id|snd_ac97_bus_free
c_func
(paren
id|ac97_bus_t
op_star
id|bus
)paren
(brace
r_if
c_cond
(paren
id|bus
)paren
(brace
id|snd_ac97_bus_proc_done
c_func
(paren
id|bus
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|bus-&gt;pcms
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bus-&gt;private_free
)paren
id|bus
op_member_access_from_pointer
id|private_free
c_func
(paren
id|bus
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|bus
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ac97_bus_dev_free
r_static
r_int
id|snd_ac97_bus_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|ac97_bus_t
op_star
id|bus
op_assign
id|device-&gt;device_data
suffix:semicolon
r_return
id|snd_ac97_bus_free
c_func
(paren
id|bus
)paren
suffix:semicolon
)brace
DECL|function|snd_ac97_free
r_static
r_int
id|snd_ac97_free
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
r_if
c_cond
(paren
id|ac97
)paren
(brace
id|snd_ac97_proc_done
c_func
(paren
id|ac97
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;bus
)paren
(brace
id|ac97-&gt;bus-&gt;codec
(braket
id|ac97-&gt;num
)braket
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;bus-&gt;shared_type
)paren
(brace
id|down
c_func
(paren
op_amp
id|shared_codec_mutex
)paren
suffix:semicolon
id|shared_codec
(braket
id|ac97-&gt;bus-&gt;shared_type
op_minus
l_int|1
)braket
(braket
id|ac97-&gt;num
)braket
op_assign
l_int|NULL
suffix:semicolon
id|up
c_func
(paren
op_amp
id|shared_codec_mutex
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ac97-&gt;private_free
)paren
id|ac97
op_member_access_from_pointer
id|private_free
c_func
(paren
id|ac97
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ac97
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ac97_dev_free
r_static
r_int
id|snd_ac97_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|ac97_t
op_star
id|ac97
op_assign
id|device-&gt;device_data
suffix:semicolon
id|snd_ac97_powerdown
c_func
(paren
id|ac97
)paren
suffix:semicolon
multiline_comment|/* for avoiding click noises during shut down */
r_return
id|snd_ac97_free
c_func
(paren
id|ac97
)paren
suffix:semicolon
)brace
DECL|function|snd_ac97_try_volume_mix
r_static
r_int
id|snd_ac97_try_volume_mix
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
id|reg
)paren
(brace
r_int
r_int
id|val
comma
id|mask
op_assign
l_int|0x8000
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_ac97_valid_reg
c_func
(paren
id|ac97
comma
id|reg
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|reg
)paren
(brace
r_case
id|AC97_MASTER_TONE
suffix:colon
r_return
id|ac97-&gt;caps
op_amp
l_int|0x04
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_case
id|AC97_HEADPHONE
suffix:colon
r_return
id|ac97-&gt;caps
op_amp
l_int|0x10
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_case
id|AC97_REC_GAIN_MIC
suffix:colon
r_return
id|ac97-&gt;caps
op_amp
l_int|0x01
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_case
id|AC97_3D_CONTROL
suffix:colon
r_if
c_cond
(paren
id|ac97-&gt;caps
op_amp
l_int|0x7c00
)paren
(brace
id|val
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|reg
)paren
suffix:semicolon
multiline_comment|/* if nonzero - fixed and we can&squot;t set it */
r_return
id|val
op_eq
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_case
id|AC97_CENTER_LFE_MASTER
suffix:colon
multiline_comment|/* center */
r_if
c_cond
(paren
(paren
id|ac97-&gt;ext_id
op_amp
id|AC97_EI_CDAC
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AC97_CENTER_LFE_MASTER
op_plus
l_int|1
suffix:colon
multiline_comment|/* lfe */
r_if
c_cond
(paren
(paren
id|ac97-&gt;ext_id
op_amp
id|AC97_EI_LDAC
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|reg
op_assign
id|AC97_CENTER_LFE_MASTER
suffix:semicolon
id|mask
op_assign
l_int|0x0080
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AC97_SURROUND_MASTER
suffix:colon
r_if
c_cond
(paren
(paren
id|ac97-&gt;ext_id
op_amp
id|AC97_EI_SDAC
)paren
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ac97-&gt;limited_regs
op_logical_and
id|test_bit
c_func
(paren
id|reg
comma
id|ac97-&gt;reg_accessed
)paren
)paren
r_return
l_int|1
suffix:semicolon
multiline_comment|/* allow without check */
id|val
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|val
op_amp
id|mask
)paren
)paren
(brace
multiline_comment|/* nothing seems to be here - mute flag is not set */
multiline_comment|/* try another test */
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|reg
comma
id|val
op_or
id|mask
)paren
suffix:semicolon
id|val
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|val
op_amp
id|mask
)paren
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* nothing here */
)brace
r_return
l_int|1
suffix:semicolon
multiline_comment|/* success, useable */
)brace
DECL|function|check_volume_resolution
r_static
r_void
id|check_volume_resolution
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
id|reg
comma
r_int
r_char
op_star
id|lo_max
comma
r_int
r_char
op_star
id|hi_max
)paren
(brace
r_int
r_int
id|cbit
(braket
l_int|3
)braket
op_assign
(brace
l_int|0x20
comma
l_int|0x10
comma
l_int|0x01
)brace
suffix:semicolon
r_int
r_char
id|max
(braket
l_int|3
)braket
op_assign
(brace
l_int|63
comma
l_int|31
comma
l_int|15
)brace
suffix:semicolon
r_int
id|i
suffix:semicolon
op_star
id|lo_max
op_assign
op_star
id|hi_max
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|cbit
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|val
suffix:semicolon
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|reg
comma
l_int|0x8080
op_or
id|cbit
(braket
id|i
)braket
op_or
(paren
id|cbit
(braket
id|i
)braket
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
id|val
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|lo_max
op_logical_and
(paren
id|val
op_amp
id|cbit
(braket
id|i
)braket
)paren
)paren
op_star
id|lo_max
op_assign
id|max
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|hi_max
op_logical_and
(paren
id|val
op_amp
(paren
id|cbit
(braket
id|i
)braket
op_lshift
l_int|8
)paren
)paren
)paren
op_star
id|hi_max
op_assign
id|max
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_star
id|lo_max
op_logical_and
op_star
id|hi_max
)paren
r_break
suffix:semicolon
)brace
)brace
DECL|function|snd_ac97_try_bit
r_int
id|snd_ac97_try_bit
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
id|reg
comma
r_int
id|bit
)paren
(brace
r_int
r_int
id|mask
comma
id|val
comma
id|orig
comma
id|res
suffix:semicolon
id|mask
op_assign
l_int|1
op_lshift
id|bit
suffix:semicolon
id|orig
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|reg
)paren
suffix:semicolon
id|val
op_assign
id|orig
op_xor
id|mask
suffix:semicolon
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|reg
comma
id|val
)paren
suffix:semicolon
id|res
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|reg
)paren
suffix:semicolon
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|reg
comma
id|orig
)paren
suffix:semicolon
r_return
id|res
op_eq
id|val
suffix:semicolon
)brace
multiline_comment|/* check the volume resolution of center/lfe */
DECL|function|snd_ac97_change_volume_params2
r_static
r_void
id|snd_ac97_change_volume_params2
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
id|reg
comma
r_int
id|shift
comma
r_int
r_char
op_star
id|max
)paren
(brace
r_int
r_int
id|val
comma
id|val1
suffix:semicolon
op_star
id|max
op_assign
l_int|63
suffix:semicolon
id|val
op_assign
l_int|0x8080
op_or
(paren
l_int|0x20
op_lshift
id|shift
)paren
suffix:semicolon
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|reg
comma
id|val
)paren
suffix:semicolon
id|val1
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
id|val1
)paren
(brace
op_star
id|max
op_assign
l_int|31
suffix:semicolon
)brace
multiline_comment|/* reset volume to zero */
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|reg
comma
l_int|0x8080
)paren
suffix:semicolon
)brace
DECL|function|printable
r_static
r_inline
r_int
id|printable
c_func
(paren
r_int
r_int
id|x
)paren
(brace
id|x
op_and_assign
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|x
OL
l_char|&squot; &squot;
op_logical_or
id|x
op_ge
l_int|0x71
)paren
(brace
r_if
c_cond
(paren
id|x
op_le
l_int|0x89
)paren
r_return
id|x
op_minus
l_int|0x71
op_plus
l_char|&squot;A&squot;
suffix:semicolon
r_return
l_char|&squot;?&squot;
suffix:semicolon
)brace
r_return
id|x
suffix:semicolon
)brace
DECL|function|snd_ac97_cnew
id|snd_kcontrol_t
op_star
id|snd_ac97_cnew
c_func
(paren
r_const
id|snd_kcontrol_new_t
op_star
id|_template
comma
id|ac97_t
op_star
id|ac97
)paren
(brace
id|snd_kcontrol_new_t
r_template
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
r_template
comma
id|_template
comma
r_sizeof
(paren
r_template
)paren
)paren
suffix:semicolon
id|snd_runtime_check
c_func
(paren
op_logical_neg
r_template
dot
id|index
comma
r_return
l_int|NULL
)paren
suffix:semicolon
r_template
dot
id|index
op_assign
id|ac97-&gt;num
suffix:semicolon
r_return
id|snd_ctl_new1
c_func
(paren
op_amp
r_template
comma
id|ac97
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * create mute switch(es) for normal stereo controls&n; */
DECL|function|snd_ac97_cmute_new_stereo
r_static
r_int
id|snd_ac97_cmute_new_stereo
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_char
op_star
id|name
comma
r_int
id|reg
comma
r_int
id|check_stereo
comma
id|ac97_t
op_star
id|ac97
)paren
(brace
id|snd_kcontrol_t
op_star
id|kctl
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
r_int
id|val
comma
id|val1
comma
id|mute_mask
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_ac97_valid_reg
c_func
(paren
id|ac97
comma
id|reg
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|mute_mask
op_assign
l_int|0x8000
suffix:semicolon
id|val
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|check_stereo
op_logical_or
(paren
id|ac97-&gt;flags
op_amp
id|AC97_STEREO_MUTES
)paren
)paren
(brace
multiline_comment|/* check whether both mute bits work */
id|val1
op_assign
id|val
op_or
l_int|0x8080
suffix:semicolon
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|reg
comma
id|val1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val1
op_eq
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|reg
)paren
)paren
id|mute_mask
op_assign
l_int|0x8080
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mute_mask
op_eq
l_int|0x8080
)paren
(brace
id|snd_kcontrol_new_t
id|tmp
op_assign
id|AC97_DOUBLE
c_func
(paren
id|name
comma
id|reg
comma
l_int|15
comma
l_int|7
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
id|tmp.index
op_assign
id|ac97-&gt;num
suffix:semicolon
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|tmp
comma
id|ac97
)paren
suffix:semicolon
)brace
r_else
(brace
id|snd_kcontrol_new_t
id|tmp
op_assign
id|AC97_SINGLE
c_func
(paren
id|name
comma
id|reg
comma
l_int|15
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
id|tmp.index
op_assign
id|ac97-&gt;num
suffix:semicolon
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|tmp
comma
id|ac97
)paren
suffix:semicolon
)brace
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* mute as default */
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|reg
comma
id|val
op_or
id|mute_mask
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * create a volume for normal stereo/mono controls&n; */
DECL|function|snd_ac97_cvol_new
r_static
r_int
id|snd_ac97_cvol_new
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_char
op_star
id|name
comma
r_int
id|reg
comma
r_int
r_int
id|lo_max
comma
r_int
r_int
id|hi_max
comma
id|ac97_t
op_star
id|ac97
)paren
(brace
r_int
id|err
suffix:semicolon
id|snd_kcontrol_t
op_star
id|kctl
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_ac97_valid_reg
c_func
(paren
id|ac97
comma
id|reg
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|hi_max
)paren
(brace
multiline_comment|/* invert */
id|snd_kcontrol_new_t
id|tmp
op_assign
id|AC97_DOUBLE
c_func
(paren
id|name
comma
id|reg
comma
l_int|8
comma
l_int|0
comma
id|lo_max
comma
l_int|1
)paren
suffix:semicolon
id|tmp.index
op_assign
id|ac97-&gt;num
suffix:semicolon
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|tmp
comma
id|ac97
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* invert */
id|snd_kcontrol_new_t
id|tmp
op_assign
id|AC97_SINGLE
c_func
(paren
id|name
comma
id|reg
comma
l_int|0
comma
id|lo_max
comma
l_int|1
)paren
suffix:semicolon
id|tmp.index
op_assign
id|ac97-&gt;num
suffix:semicolon
id|kctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|tmp
comma
id|ac97
)paren
suffix:semicolon
)brace
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|reg
comma
(paren
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|reg
)paren
op_amp
l_int|0x8080
)paren
op_or
id|lo_max
op_or
(paren
id|hi_max
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * create a mute-switch and a volume for normal stereo/mono controls&n; */
DECL|function|snd_ac97_cmix_new_stereo
r_static
r_int
id|snd_ac97_cmix_new_stereo
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_const
r_char
op_star
id|pfx
comma
r_int
id|reg
comma
r_int
id|check_stereo
comma
id|ac97_t
op_star
id|ac97
)paren
(brace
r_int
id|err
suffix:semicolon
r_char
id|name
(braket
l_int|44
)braket
suffix:semicolon
r_int
r_char
id|lo_max
comma
id|hi_max
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|snd_ac97_valid_reg
c_func
(paren
id|ac97
comma
id|reg
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|snd_ac97_try_bit
c_func
(paren
id|ac97
comma
id|reg
comma
l_int|15
)paren
)paren
(brace
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;%s Switch&quot;
comma
id|pfx
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_cmute_new_stereo
c_func
(paren
id|card
comma
id|name
comma
id|reg
comma
id|check_stereo
comma
id|ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
id|check_volume_resolution
c_func
(paren
id|ac97
comma
id|reg
comma
op_amp
id|lo_max
comma
op_amp
id|hi_max
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lo_max
)paren
(brace
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;%s Volume&quot;
comma
id|pfx
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_cvol_new
c_func
(paren
id|card
comma
id|name
comma
id|reg
comma
id|lo_max
comma
id|hi_max
comma
id|ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|snd_ac97_cmix_new
mdefine_line|#define snd_ac97_cmix_new(card, pfx, reg, ac97)&t;snd_ac97_cmix_new_stereo(card, pfx, reg, 0, ac97)
DECL|macro|snd_ac97_cmute_new
mdefine_line|#define snd_ac97_cmute_new(card, name, reg, ac97)&t;snd_ac97_cmute_new_stereo(card, name, reg, 0, ac97)
r_static
r_int
r_int
id|snd_ac97_determine_spdif_rates
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
suffix:semicolon
DECL|function|snd_ac97_mixer_build
r_static
r_int
id|snd_ac97_mixer_build
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
id|snd_card_t
op_star
id|card
op_assign
id|ac97-&gt;bus-&gt;card
suffix:semicolon
id|snd_kcontrol_t
op_star
id|kctl
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
r_int
id|idx
suffix:semicolon
r_int
r_char
id|max
suffix:semicolon
multiline_comment|/* build master controls */
multiline_comment|/* AD claims to remove this control from AD1887, although spec v2.2 does not allow this */
r_if
c_cond
(paren
id|snd_ac97_try_volume_mix
c_func
(paren
id|ac97
comma
id|AC97_MASTER
)paren
)paren
(brace
r_if
c_cond
(paren
id|ac97-&gt;flags
op_amp
id|AC97_HAS_NO_MASTER_VOL
)paren
id|err
op_assign
id|snd_ac97_cmute_new
c_func
(paren
id|card
comma
l_string|&quot;Master Playback Switch&quot;
comma
id|AC97_MASTER
comma
id|ac97
)paren
suffix:semicolon
r_else
id|err
op_assign
id|snd_ac97_cmix_new
c_func
(paren
id|card
comma
l_string|&quot;Master Playback&quot;
comma
id|AC97_MASTER
comma
id|ac97
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
id|ac97-&gt;regs
(braket
id|AC97_CENTER_LFE_MASTER
)braket
op_assign
l_int|0x8080
suffix:semicolon
multiline_comment|/* build center controls */
r_if
c_cond
(paren
id|snd_ac97_try_volume_mix
c_func
(paren
id|ac97
comma
id|AC97_CENTER_LFE_MASTER
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_center
(braket
l_int|0
)braket
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
op_assign
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_center
(braket
l_int|1
)braket
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_ac97_change_volume_params2
c_func
(paren
id|ac97
comma
id|AC97_CENTER_LFE_MASTER
comma
l_int|0
comma
op_amp
id|max
)paren
suffix:semicolon
id|kctl-&gt;private_value
op_and_assign
op_complement
(paren
l_int|0xff
op_lshift
l_int|16
)paren
suffix:semicolon
id|kctl-&gt;private_value
op_or_assign
(paren
r_int
)paren
id|max
op_lshift
l_int|16
suffix:semicolon
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_CENTER_LFE_MASTER
comma
id|ac97-&gt;regs
(braket
id|AC97_CENTER_LFE_MASTER
)braket
op_or
id|max
)paren
suffix:semicolon
)brace
multiline_comment|/* build LFE controls */
r_if
c_cond
(paren
id|snd_ac97_try_volume_mix
c_func
(paren
id|ac97
comma
id|AC97_CENTER_LFE_MASTER
op_plus
l_int|1
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_lfe
(braket
l_int|0
)braket
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
op_assign
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_lfe
(braket
l_int|1
)braket
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_ac97_change_volume_params2
c_func
(paren
id|ac97
comma
id|AC97_CENTER_LFE_MASTER
comma
l_int|8
comma
op_amp
id|max
)paren
suffix:semicolon
id|kctl-&gt;private_value
op_and_assign
op_complement
(paren
l_int|0xff
op_lshift
l_int|16
)paren
suffix:semicolon
id|kctl-&gt;private_value
op_or_assign
(paren
r_int
)paren
id|max
op_lshift
l_int|16
suffix:semicolon
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_CENTER_LFE_MASTER
comma
id|ac97-&gt;regs
(braket
id|AC97_CENTER_LFE_MASTER
)braket
op_or
id|max
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
multiline_comment|/* build surround controls */
r_if
c_cond
(paren
id|snd_ac97_try_volume_mix
c_func
(paren
id|ac97
comma
id|AC97_SURROUND_MASTER
)paren
)paren
(brace
multiline_comment|/* Surround Master (0x38) is with stereo mutes */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_cmix_new_stereo
c_func
(paren
id|card
comma
l_string|&quot;Surround Playback&quot;
comma
id|AC97_SURROUND_MASTER
comma
l_int|1
comma
id|ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* build headphone controls */
r_if
c_cond
(paren
id|snd_ac97_try_volume_mix
c_func
(paren
id|ac97
comma
id|AC97_HEADPHONE
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_cmix_new
c_func
(paren
id|card
comma
l_string|&quot;Headphone Playback&quot;
comma
id|AC97_HEADPHONE
comma
id|ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* build master mono controls */
r_if
c_cond
(paren
id|snd_ac97_try_volume_mix
c_func
(paren
id|ac97
comma
id|AC97_MASTER_MONO
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_cmix_new
c_func
(paren
id|card
comma
l_string|&quot;Master Mono Playback&quot;
comma
id|AC97_MASTER_MONO
comma
id|ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* build master tone controls */
r_if
c_cond
(paren
id|snd_ac97_try_volume_mix
c_func
(paren
id|ac97
comma
id|AC97_MASTER_TONE
)paren
)paren
(brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|2
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
op_assign
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_tone
(braket
id|idx
)braket
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;id
op_eq
id|AC97_ID_YMF753
)paren
(brace
id|kctl-&gt;private_value
op_and_assign
op_complement
(paren
l_int|0xff
op_lshift
l_int|16
)paren
suffix:semicolon
id|kctl-&gt;private_value
op_or_assign
l_int|7
op_lshift
l_int|16
suffix:semicolon
)brace
)brace
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_MASTER_TONE
comma
l_int|0x0f0f
)paren
suffix:semicolon
)brace
multiline_comment|/* build PC Speaker controls */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ac97-&gt;flags
op_amp
id|AC97_HAS_NO_PC_BEEP
)paren
op_logical_and
(paren
(paren
id|ac97-&gt;flags
op_amp
id|AC97_HAS_PC_BEEP
)paren
op_logical_or
id|snd_ac97_try_volume_mix
c_func
(paren
id|ac97
comma
id|AC97_PC_BEEP
)paren
)paren
)paren
(brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|2
suffix:semicolon
id|idx
op_increment
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_pc_beep
(braket
id|idx
)braket
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_PC_BEEP
comma
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_PC_BEEP
)paren
op_or
l_int|0x801e
)paren
suffix:semicolon
)brace
multiline_comment|/* build Phone controls */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ac97-&gt;flags
op_amp
id|AC97_HAS_NO_PHONE
)paren
)paren
(brace
r_if
c_cond
(paren
id|snd_ac97_try_volume_mix
c_func
(paren
id|ac97
comma
id|AC97_PHONE
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_cmix_new
c_func
(paren
id|card
comma
l_string|&quot;Phone Playback&quot;
comma
id|AC97_PHONE
comma
id|ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
)brace
multiline_comment|/* build MIC controls */
r_if
c_cond
(paren
id|snd_ac97_try_volume_mix
c_func
(paren
id|ac97
comma
id|AC97_MIC
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_cmix_new
c_func
(paren
id|card
comma
l_string|&quot;Mic Playback&quot;
comma
id|AC97_MIC
comma
id|ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_mic_boost
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* build Line controls */
r_if
c_cond
(paren
id|snd_ac97_try_volume_mix
c_func
(paren
id|ac97
comma
id|AC97_LINE
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_cmix_new
c_func
(paren
id|card
comma
l_string|&quot;Line Playback&quot;
comma
id|AC97_LINE
comma
id|ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* build CD controls */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ac97-&gt;flags
op_amp
id|AC97_HAS_NO_CD
)paren
)paren
(brace
r_if
c_cond
(paren
id|snd_ac97_try_volume_mix
c_func
(paren
id|ac97
comma
id|AC97_CD
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_cmix_new
c_func
(paren
id|card
comma
l_string|&quot;CD Playback&quot;
comma
id|AC97_CD
comma
id|ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
)brace
multiline_comment|/* build Video controls */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ac97-&gt;flags
op_amp
id|AC97_HAS_NO_VIDEO
)paren
)paren
(brace
r_if
c_cond
(paren
id|snd_ac97_try_volume_mix
c_func
(paren
id|ac97
comma
id|AC97_VIDEO
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_cmix_new
c_func
(paren
id|card
comma
l_string|&quot;Video Playback&quot;
comma
id|AC97_VIDEO
comma
id|ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
)brace
multiline_comment|/* build Aux controls */
r_if
c_cond
(paren
id|snd_ac97_try_volume_mix
c_func
(paren
id|ac97
comma
id|AC97_AUX
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_cmix_new
c_func
(paren
id|card
comma
l_string|&quot;Aux Playback&quot;
comma
id|AC97_AUX
comma
id|ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* build PCM controls */
r_if
c_cond
(paren
id|ac97-&gt;flags
op_amp
id|AC97_AD_MULTI
)paren
(brace
r_int
r_int
id|init_val
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;flags
op_amp
id|AC97_STEREO_MUTES
)paren
id|init_val
op_assign
l_int|0x9f9f
suffix:semicolon
r_else
id|init_val
op_assign
l_int|0x9f1f
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|2
suffix:semicolon
id|idx
op_increment
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_ad18xx_pcm
(braket
id|idx
)braket
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|ac97-&gt;spec.ad18xx.pcmreg
(braket
l_int|0
)braket
op_assign
id|init_val
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;scaps
op_amp
id|AC97_SCAP_SURROUND_DAC
)paren
(brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|2
suffix:semicolon
id|idx
op_increment
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_ad18xx_surround
(braket
id|idx
)braket
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|ac97-&gt;spec.ad18xx.pcmreg
(braket
l_int|1
)braket
op_assign
id|init_val
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ac97-&gt;scaps
op_amp
id|AC97_SCAP_CENTER_LFE_DAC
)paren
(brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|2
suffix:semicolon
id|idx
op_increment
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_ad18xx_center
(braket
id|idx
)braket
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|2
suffix:semicolon
id|idx
op_increment
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_ad18xx_lfe
(braket
id|idx
)braket
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|ac97-&gt;spec.ad18xx.pcmreg
(braket
l_int|2
)braket
op_assign
id|init_val
suffix:semicolon
)brace
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_PCM
comma
id|init_val
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|ac97-&gt;flags
op_amp
id|AC97_HAS_NO_PCM_VOL
)paren
id|err
op_assign
id|snd_ac97_cmute_new
c_func
(paren
id|card
comma
l_string|&quot;PCM Playback Switch&quot;
comma
id|AC97_PCM
comma
id|ac97
)paren
suffix:semicolon
r_else
id|err
op_assign
id|snd_ac97_cmix_new
c_func
(paren
id|card
comma
l_string|&quot;PCM Playback&quot;
comma
id|AC97_PCM
comma
id|ac97
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* build Capture controls */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ac97-&gt;flags
op_amp
id|AC97_HAS_NO_REC_GAIN
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_control_capture_src
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|snd_ac97_try_bit
c_func
(paren
id|ac97
comma
id|AC97_REC_GAIN
comma
l_int|15
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ac97_cmute_new
c_func
(paren
id|card
comma
l_string|&quot;Capture Switch&quot;
comma
id|AC97_REC_GAIN
comma
id|ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_control_capture_vol
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_REC_SEL
comma
l_int|0x0000
)paren
suffix:semicolon
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_REC_GAIN
comma
l_int|0x0000
)paren
suffix:semicolon
)brace
multiline_comment|/* build MIC Capture controls */
r_if
c_cond
(paren
id|snd_ac97_try_volume_mix
c_func
(paren
id|ac97
comma
id|AC97_REC_GAIN_MIC
)paren
)paren
(brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|2
suffix:semicolon
id|idx
op_increment
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_mic_capture
(braket
id|idx
)braket
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_REC_GAIN_MIC
comma
l_int|0x0000
)paren
suffix:semicolon
)brace
multiline_comment|/* build PCM out path &amp; mute control */
r_if
c_cond
(paren
id|snd_ac97_try_bit
c_func
(paren
id|ac97
comma
id|AC97_GENERAL_PURPOSE
comma
l_int|15
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_general
(braket
id|AC97_GENERAL_PCM_OUT
)braket
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* build Simulated Stereo Enhancement control */
r_if
c_cond
(paren
id|ac97-&gt;caps
op_amp
l_int|0x0008
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_general
(braket
id|AC97_GENERAL_STEREO_ENHANCEMENT
)braket
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* build 3D Stereo Enhancement control */
r_if
c_cond
(paren
id|snd_ac97_try_bit
c_func
(paren
id|ac97
comma
id|AC97_GENERAL_PURPOSE
comma
l_int|13
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_general
(braket
id|AC97_GENERAL_3D
)braket
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* build Loudness control */
r_if
c_cond
(paren
id|ac97-&gt;caps
op_amp
l_int|0x0020
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_general
(braket
id|AC97_GENERAL_LOUDNESS
)braket
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* build Mono output select control */
r_if
c_cond
(paren
id|snd_ac97_try_bit
c_func
(paren
id|ac97
comma
id|AC97_GENERAL_PURPOSE
comma
l_int|9
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_general
(braket
id|AC97_GENERAL_MONO
)braket
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* build Mic select control */
r_if
c_cond
(paren
id|snd_ac97_try_bit
c_func
(paren
id|ac97
comma
id|AC97_GENERAL_PURPOSE
comma
l_int|8
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_general
(braket
id|AC97_GENERAL_MIC
)braket
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* build ADC/DAC loopback control */
r_if
c_cond
(paren
id|enable_loopback
op_logical_and
id|snd_ac97_try_bit
c_func
(paren
id|ac97
comma
id|AC97_GENERAL_PURPOSE
comma
l_int|7
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_general
(braket
id|AC97_GENERAL_LOOPBACK
)braket
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
id|snd_ac97_update_bits
c_func
(paren
id|ac97
comma
id|AC97_GENERAL_PURPOSE
comma
op_complement
id|AC97_GP_DRSS_MASK
comma
l_int|0x0000
)paren
suffix:semicolon
multiline_comment|/* build 3D controls */
r_if
c_cond
(paren
id|ac97-&gt;build_ops-&gt;build_3d
)paren
(brace
id|ac97-&gt;build_ops
op_member_access_from_pointer
id|build_3d
c_func
(paren
id|ac97
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|snd_ac97_try_volume_mix
c_func
(paren
id|ac97
comma
id|AC97_3D_CONTROL
)paren
)paren
(brace
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
l_int|0x0707
suffix:semicolon
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_3D_CONTROL
comma
id|val
)paren
suffix:semicolon
id|val
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_3D_CONTROL
)paren
suffix:semicolon
id|val
op_assign
id|val
op_eq
l_int|0x0606
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
op_assign
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_3d
(braket
l_int|0
)braket
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
id|kctl-&gt;private_value
op_assign
id|AC97_3D_CONTROL
op_or
(paren
l_int|9
op_lshift
l_int|8
)paren
op_or
(paren
l_int|7
op_lshift
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
op_assign
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_3d
(braket
l_int|1
)braket
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|val
)paren
id|kctl-&gt;private_value
op_assign
id|AC97_3D_CONTROL
op_or
(paren
l_int|1
op_lshift
l_int|8
)paren
op_or
(paren
l_int|7
op_lshift
l_int|16
)paren
suffix:semicolon
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_3D_CONTROL
comma
l_int|0x0000
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* build S/PDIF controls */
r_if
c_cond
(paren
(paren
id|ac97-&gt;ext_id
op_amp
id|AC97_EI_SPDIF
)paren
op_logical_and
op_logical_neg
(paren
id|ac97-&gt;scaps
op_amp
id|AC97_SCAP_NO_SPDIF
)paren
)paren
(brace
r_if
c_cond
(paren
id|ac97-&gt;build_ops-&gt;build_spdif
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ac97-&gt;build_ops
op_member_access_from_pointer
id|build_spdif
c_func
(paren
id|ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_else
(brace
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
l_int|5
suffix:semicolon
id|idx
op_increment
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_controls_spdif
(braket
id|idx
)braket
comma
id|ac97
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;build_ops-&gt;build_post_spdif
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ac97-&gt;build_ops
op_member_access_from_pointer
id|build_post_spdif
c_func
(paren
id|ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* set default PCM S/PDIF params */
multiline_comment|/* consumer,PCM audio,no copyright,no preemphasis,PCM coder,original,48000Hz */
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_SPDIF
comma
l_int|0x2a20
)paren
suffix:semicolon
id|ac97-&gt;rates
(braket
id|AC97_RATES_SPDIF
)braket
op_assign
id|snd_ac97_determine_spdif_rates
c_func
(paren
id|ac97
)paren
suffix:semicolon
)brace
id|ac97-&gt;spdif_status
op_assign
id|SNDRV_PCM_DEFAULT_CON_SPDIF
suffix:semicolon
)brace
multiline_comment|/* build chip specific controls */
r_if
c_cond
(paren
id|ac97-&gt;build_ops-&gt;build_specific
)paren
r_if
c_cond
(paren
(paren
id|err
op_assign
id|ac97-&gt;build_ops
op_member_access_from_pointer
id|build_specific
c_func
(paren
id|ac97
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_if
c_cond
(paren
id|snd_ac97_try_bit
c_func
(paren
id|ac97
comma
id|AC97_POWERDOWN
comma
l_int|15
)paren
)paren
(brace
id|kctl
op_assign
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_control_eapd
comma
id|ac97
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|kctl
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;scaps
op_amp
id|AC97_SCAP_INV_EAPD
)paren
id|set_inv_eapd
c_func
(paren
id|ac97
comma
id|kctl
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|kctl
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ac97_modem_build
r_static
r_int
id|snd_ac97_modem_build
c_func
(paren
id|snd_card_t
op_star
id|card
comma
id|ac97_t
op_star
id|ac97
)paren
(brace
multiline_comment|/* TODO */
singleline_comment|//printk(&quot;AC97_GPIO_CFG = %x&bslash;n&quot;,snd_ac97_read(ac97,AC97_GPIO_CFG));
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_GPIO_CFG
comma
l_int|0xffff
op_amp
op_complement
(paren
id|AC97_GPIO_LINE1_OH
)paren
)paren
suffix:semicolon
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_GPIO_POLARITY
comma
l_int|0xffff
op_amp
op_complement
(paren
id|AC97_GPIO_LINE1_OH
)paren
)paren
suffix:semicolon
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_GPIO_STICKY
comma
l_int|0xffff
)paren
suffix:semicolon
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_GPIO_WAKEUP
comma
l_int|0x0
)paren
suffix:semicolon
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_MISC_AFE
comma
l_int|0x0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_ac97_test_rate
r_static
r_int
id|snd_ac97_test_rate
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
id|reg
comma
r_int
id|shadow_reg
comma
r_int
id|rate
)paren
(brace
r_int
r_int
id|val
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
id|tmp
op_assign
(paren
(paren
r_int
r_int
)paren
id|rate
op_star
id|ac97-&gt;bus-&gt;clock
)paren
op_div
l_int|48000
suffix:semicolon
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|reg
comma
id|tmp
op_amp
l_int|0xffff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|shadow_reg
)paren
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|shadow_reg
comma
id|tmp
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|val
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|reg
)paren
suffix:semicolon
r_return
id|val
op_eq
(paren
id|tmp
op_amp
l_int|0xffff
)paren
suffix:semicolon
)brace
DECL|function|snd_ac97_determine_rates
r_static
r_void
id|snd_ac97_determine_rates
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
id|reg
comma
r_int
id|shadow_reg
comma
r_int
r_int
op_star
id|r_result
)paren
(brace
r_int
r_int
id|result
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|saved
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;bus-&gt;no_vra
)paren
(brace
op_star
id|r_result
op_assign
id|SNDRV_PCM_RATE_48000
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ac97-&gt;flags
op_amp
id|AC97_DOUBLE_RATE
)paren
op_logical_and
id|reg
op_eq
id|AC97_PCM_FRONT_DAC_RATE
)paren
op_star
id|r_result
op_or_assign
id|SNDRV_PCM_RATE_96000
suffix:semicolon
r_return
suffix:semicolon
)brace
id|saved
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ac97-&gt;ext_id
op_amp
id|AC97_EI_DRA
)paren
op_logical_and
id|reg
op_eq
id|AC97_PCM_FRONT_DAC_RATE
)paren
id|snd_ac97_update_bits
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_STATUS
comma
id|AC97_EA_DRA
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* test a non-standard rate */
r_if
c_cond
(paren
id|snd_ac97_test_rate
c_func
(paren
id|ac97
comma
id|reg
comma
id|shadow_reg
comma
l_int|11000
)paren
)paren
id|result
op_or_assign
id|SNDRV_PCM_RATE_CONTINUOUS
suffix:semicolon
multiline_comment|/* let&squot;s try to obtain standard rates */
r_if
c_cond
(paren
id|snd_ac97_test_rate
c_func
(paren
id|ac97
comma
id|reg
comma
id|shadow_reg
comma
l_int|8000
)paren
)paren
id|result
op_or_assign
id|SNDRV_PCM_RATE_8000
suffix:semicolon
r_if
c_cond
(paren
id|snd_ac97_test_rate
c_func
(paren
id|ac97
comma
id|reg
comma
id|shadow_reg
comma
l_int|11025
)paren
)paren
id|result
op_or_assign
id|SNDRV_PCM_RATE_11025
suffix:semicolon
r_if
c_cond
(paren
id|snd_ac97_test_rate
c_func
(paren
id|ac97
comma
id|reg
comma
id|shadow_reg
comma
l_int|16000
)paren
)paren
id|result
op_or_assign
id|SNDRV_PCM_RATE_16000
suffix:semicolon
r_if
c_cond
(paren
id|snd_ac97_test_rate
c_func
(paren
id|ac97
comma
id|reg
comma
id|shadow_reg
comma
l_int|22050
)paren
)paren
id|result
op_or_assign
id|SNDRV_PCM_RATE_22050
suffix:semicolon
r_if
c_cond
(paren
id|snd_ac97_test_rate
c_func
(paren
id|ac97
comma
id|reg
comma
id|shadow_reg
comma
l_int|32000
)paren
)paren
id|result
op_or_assign
id|SNDRV_PCM_RATE_32000
suffix:semicolon
r_if
c_cond
(paren
id|snd_ac97_test_rate
c_func
(paren
id|ac97
comma
id|reg
comma
id|shadow_reg
comma
l_int|44100
)paren
)paren
id|result
op_or_assign
id|SNDRV_PCM_RATE_44100
suffix:semicolon
r_if
c_cond
(paren
id|snd_ac97_test_rate
c_func
(paren
id|ac97
comma
id|reg
comma
id|shadow_reg
comma
l_int|48000
)paren
)paren
id|result
op_or_assign
id|SNDRV_PCM_RATE_48000
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ac97-&gt;flags
op_amp
id|AC97_DOUBLE_RATE
)paren
op_logical_and
id|reg
op_eq
id|AC97_PCM_FRONT_DAC_RATE
)paren
(brace
multiline_comment|/* test standard double rates */
id|snd_ac97_update_bits
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_STATUS
comma
id|AC97_EA_DRA
comma
id|AC97_EA_DRA
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_ac97_test_rate
c_func
(paren
id|ac97
comma
id|reg
comma
id|shadow_reg
comma
l_int|64000
op_div
l_int|2
)paren
)paren
id|result
op_or_assign
id|SNDRV_PCM_RATE_64000
suffix:semicolon
r_if
c_cond
(paren
id|snd_ac97_test_rate
c_func
(paren
id|ac97
comma
id|reg
comma
id|shadow_reg
comma
l_int|88200
op_div
l_int|2
)paren
)paren
id|result
op_or_assign
id|SNDRV_PCM_RATE_88200
suffix:semicolon
r_if
c_cond
(paren
id|snd_ac97_test_rate
c_func
(paren
id|ac97
comma
id|reg
comma
id|shadow_reg
comma
l_int|96000
op_div
l_int|2
)paren
)paren
id|result
op_or_assign
id|SNDRV_PCM_RATE_96000
suffix:semicolon
multiline_comment|/* some codecs don&squot;t support variable double rates */
r_if
c_cond
(paren
op_logical_neg
id|snd_ac97_test_rate
c_func
(paren
id|ac97
comma
id|reg
comma
id|shadow_reg
comma
l_int|76100
op_div
l_int|2
)paren
)paren
id|result
op_and_assign
op_complement
id|SNDRV_PCM_RATE_CONTINUOUS
suffix:semicolon
id|snd_ac97_update_bits
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_STATUS
comma
id|AC97_EA_DRA
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* restore the default value */
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|reg
comma
id|saved
)paren
suffix:semicolon
r_if
c_cond
(paren
id|shadow_reg
)paren
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|shadow_reg
comma
id|saved
)paren
suffix:semicolon
op_star
id|r_result
op_assign
id|result
suffix:semicolon
)brace
multiline_comment|/* check AC97_SPDIF register to accept which sample rates */
DECL|function|snd_ac97_determine_spdif_rates
r_static
r_int
r_int
id|snd_ac97_determine_spdif_rates
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
r_int
r_int
id|result
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_static
r_int
r_int
id|ctl_bits
(braket
)braket
op_assign
(brace
id|AC97_SC_SPSR_44K
comma
id|AC97_SC_SPSR_32K
comma
id|AC97_SC_SPSR_48K
)brace
suffix:semicolon
r_static
r_int
r_int
id|rate_bits
(braket
)braket
op_assign
(brace
id|SNDRV_PCM_RATE_44100
comma
id|SNDRV_PCM_RATE_32000
comma
id|SNDRV_PCM_RATE_48000
)brace
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
r_int
)paren
id|ARRAY_SIZE
c_func
(paren
id|ctl_bits
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|snd_ac97_update_bits
c_func
(paren
id|ac97
comma
id|AC97_SPDIF
comma
id|AC97_SC_SPSR_MASK
comma
id|ctl_bits
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_SPDIF
)paren
op_amp
id|AC97_SC_SPSR_MASK
)paren
op_eq
id|ctl_bits
(braket
id|i
)braket
)paren
id|result
op_or_assign
id|rate_bits
(braket
id|i
)braket
suffix:semicolon
)brace
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/* look for the codec id table matching with the given id */
DECL|function|look_for_codec_id
r_static
r_const
id|ac97_codec_id_t
op_star
id|look_for_codec_id
c_func
(paren
r_const
id|ac97_codec_id_t
op_star
id|table
comma
r_int
r_int
id|id
)paren
(brace
r_const
id|ac97_codec_id_t
op_star
id|pid
suffix:semicolon
r_for
c_loop
(paren
id|pid
op_assign
id|table
suffix:semicolon
id|pid-&gt;id
suffix:semicolon
id|pid
op_increment
)paren
r_if
c_cond
(paren
id|pid-&gt;id
op_eq
(paren
id|id
op_amp
id|pid-&gt;mask
)paren
)paren
r_return
id|pid
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|snd_ac97_get_name
r_void
id|snd_ac97_get_name
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
r_int
id|id
comma
r_char
op_star
id|name
comma
r_int
id|modem
)paren
(brace
r_const
id|ac97_codec_id_t
op_star
id|pid
suffix:semicolon
id|sprintf
c_func
(paren
id|name
comma
l_string|&quot;0x%x %c%c%c&quot;
comma
id|id
comma
id|printable
c_func
(paren
id|id
op_rshift
l_int|24
)paren
comma
id|printable
c_func
(paren
id|id
op_rshift
l_int|16
)paren
comma
id|printable
c_func
(paren
id|id
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|pid
op_assign
id|look_for_codec_id
c_func
(paren
id|snd_ac97_codec_id_vendors
comma
id|id
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pid
)paren
r_return
suffix:semicolon
id|strcpy
c_func
(paren
id|name
comma
id|pid-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac97
op_logical_and
id|pid-&gt;patch
)paren
(brace
r_if
c_cond
(paren
(paren
id|modem
op_logical_and
(paren
id|pid-&gt;flags
op_amp
id|AC97_MODEM_PATCH
)paren
)paren
op_logical_or
(paren
op_logical_neg
id|modem
op_logical_and
op_logical_neg
(paren
id|pid-&gt;flags
op_amp
id|AC97_MODEM_PATCH
)paren
)paren
)paren
id|pid
op_member_access_from_pointer
id|patch
c_func
(paren
id|ac97
)paren
suffix:semicolon
)brace
id|pid
op_assign
id|look_for_codec_id
c_func
(paren
id|snd_ac97_codec_ids
comma
id|id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pid
)paren
(brace
id|strcat
c_func
(paren
id|name
comma
l_string|&quot; &quot;
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|name
comma
id|pid-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pid-&gt;mask
op_ne
l_int|0xffffffff
)paren
id|sprintf
c_func
(paren
id|name
op_plus
id|strlen
c_func
(paren
id|name
)paren
comma
l_string|&quot; rev %d&quot;
comma
id|id
op_amp
op_complement
id|pid-&gt;mask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac97
op_logical_and
id|pid-&gt;patch
)paren
(brace
r_if
c_cond
(paren
(paren
id|modem
op_logical_and
(paren
id|pid-&gt;flags
op_amp
id|AC97_MODEM_PATCH
)paren
)paren
op_logical_or
(paren
op_logical_neg
id|modem
op_logical_and
op_logical_neg
(paren
id|pid-&gt;flags
op_amp
id|AC97_MODEM_PATCH
)paren
)paren
)paren
id|pid
op_member_access_from_pointer
id|patch
c_func
(paren
id|ac97
)paren
suffix:semicolon
)brace
)brace
r_else
id|sprintf
c_func
(paren
id|name
op_plus
id|strlen
c_func
(paren
id|name
)paren
comma
l_string|&quot; id %x&quot;
comma
id|id
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * snd_ac97_get_short_name - retrieve codec name&n; * @ac97: the codec instance&n; *&n; * Returns the short identifying name of the codec.&n; */
DECL|function|snd_ac97_get_short_name
r_const
r_char
op_star
id|snd_ac97_get_short_name
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
r_const
id|ac97_codec_id_t
op_star
id|pid
suffix:semicolon
r_for
c_loop
(paren
id|pid
op_assign
id|snd_ac97_codec_ids
suffix:semicolon
id|pid-&gt;id
suffix:semicolon
id|pid
op_increment
)paren
r_if
c_cond
(paren
id|pid-&gt;id
op_eq
(paren
id|ac97-&gt;id
op_amp
id|pid-&gt;mask
)paren
)paren
r_return
id|pid-&gt;name
suffix:semicolon
r_return
l_string|&quot;unknown codec&quot;
suffix:semicolon
)brace
multiline_comment|/* wait for a while until registers are accessible after RESET&n; * return 0 if ok, negative not ready&n; */
DECL|function|ac97_reset_wait
r_static
r_int
id|ac97_reset_wait
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
id|timeout
comma
r_int
id|with_modem
)paren
(brace
r_int
r_int
id|end_time
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
id|end_time
op_assign
id|jiffies
op_plus
id|timeout
suffix:semicolon
r_do
(brace
multiline_comment|/* use preliminary reads to settle the communication */
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_RESET
)paren
suffix:semicolon
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_VENDOR_ID1
)paren
suffix:semicolon
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_VENDOR_ID2
)paren
suffix:semicolon
multiline_comment|/* modem? */
r_if
c_cond
(paren
id|with_modem
)paren
(brace
id|val
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_MID
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
l_int|0xffff
op_logical_and
(paren
id|val
op_amp
l_int|1
)paren
op_ne
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ac97-&gt;scaps
op_amp
id|AC97_SCAP_DETECT_BY_VENDOR
)paren
(brace
multiline_comment|/* probably only Xbox issue - all registers are read as zero */
id|val
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_VENDOR_ID1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
l_int|0
op_logical_and
id|val
op_ne
l_int|0xffff
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* because the PCM or MASTER volume registers can be modified,&n;&t;&t;&t; * the REC_GAIN register is used for tests&n;&t;&t;&t; */
multiline_comment|/* test if we can write to the record gain volume register */
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_REC_GAIN
comma
l_int|0x8a05
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_REC_GAIN
)paren
op_amp
l_int|0x7fff
)paren
op_eq
l_int|0x0a05
)paren
r_return
l_int|0
suffix:semicolon
)brace
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|time_after_eq
c_func
(paren
id|end_time
comma
id|jiffies
)paren
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/**&n; * snd_ac97_bus - create an AC97 bus component&n; * @card: the card instance&n; * @num: the bus number&n; * @ops: the bus callbacks table&n; * @private_data: private data pointer for the new instance&n; * @rbus: the pointer to store the new AC97 bus instance.&n; *&n; * Creates an AC97 bus component.  An ac97_bus_t instance is newly&n; * allocated and initialized.&n; *&n; * The ops table must include valid callbacks (at least read and&n; * write).  The other callbacks, wait and reset, are not mandatory.&n; * &n; * The clock is set to 48000.  If another clock is needed, set&n; * (*rbus)-&gt;clock manually.&n; *&n; * The AC97 bus instance is registered as a low-level device, so you don&squot;t&n; * have to release it manually.&n; *&n; * Returns zero if successful, or a negative error code on failure.&n; */
DECL|function|snd_ac97_bus
r_int
id|snd_ac97_bus
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_int
id|num
comma
id|ac97_bus_ops_t
op_star
id|ops
comma
r_void
op_star
id|private_data
comma
id|ac97_bus_t
op_star
op_star
id|rbus
)paren
(brace
r_int
id|err
suffix:semicolon
id|ac97_bus_t
op_star
id|bus
suffix:semicolon
r_static
id|snd_device_ops_t
id|dev_ops
op_assign
(brace
dot
id|dev_free
op_assign
id|snd_ac97_bus_dev_free
comma
)brace
suffix:semicolon
id|snd_assert
c_func
(paren
id|card
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|rbus
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|bus
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|bus
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bus
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|bus-&gt;card
op_assign
id|card
suffix:semicolon
id|bus-&gt;num
op_assign
id|num
suffix:semicolon
id|bus-&gt;ops
op_assign
id|ops
suffix:semicolon
id|bus-&gt;private_data
op_assign
id|private_data
suffix:semicolon
id|bus-&gt;clock
op_assign
l_int|48000
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|bus-&gt;bus_lock
)paren
suffix:semicolon
id|snd_ac97_bus_proc_init
c_func
(paren
id|bus
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_BUS
comma
id|bus
comma
op_amp
id|dev_ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_ac97_bus_free
c_func
(paren
id|bus
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
op_star
id|rbus
op_assign
id|bus
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* build_ops to do nothing */
DECL|variable|null_build_ops
r_static
r_struct
id|snd_ac97_build_ops
id|null_build_ops
suffix:semicolon
multiline_comment|/**&n; * snd_ac97_mixer - create an Codec97 component&n; * @bus: the AC97 bus which codec is attached to&n; * @template: the template of ac97, including index, callbacks and&n; *         the private data.&n; * @rac97: the pointer to store the new ac97 instance.&n; *&n; * Creates an Codec97 component.  An ac97_t instance is newly&n; * allocated and initialized from the template.  The codec&n; * is then initialized by the standard procedure.&n; *&n; * The template must include the codec number (num) and address (addr),&n; * and the private data (private_data).&n; * &n; * The ac97 instance is registered as a low-level device, so you don&squot;t&n; * have to release it manually.&n; *&n; * Returns zero if successful, or a negative error code on failure.&n; */
DECL|function|snd_ac97_mixer
r_int
id|snd_ac97_mixer
c_func
(paren
id|ac97_bus_t
op_star
id|bus
comma
id|ac97_template_t
op_star
r_template
comma
id|ac97_t
op_star
op_star
id|rac97
)paren
(brace
r_int
id|err
suffix:semicolon
id|ac97_t
op_star
id|ac97
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
r_char
id|name
(braket
l_int|64
)braket
suffix:semicolon
r_int
r_int
id|end_time
suffix:semicolon
r_int
r_int
id|reg
suffix:semicolon
r_const
id|ac97_codec_id_t
op_star
id|pid
suffix:semicolon
r_static
id|snd_device_ops_t
id|ops
op_assign
(brace
dot
id|dev_free
op_assign
id|snd_ac97_dev_free
comma
)brace
suffix:semicolon
id|snd_assert
c_func
(paren
id|rac97
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
op_star
id|rac97
op_assign
l_int|NULL
suffix:semicolon
id|snd_assert
c_func
(paren
id|bus
op_ne
l_int|NULL
op_logical_and
r_template
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
r_template
op_member_access_from_pointer
id|num
OL
l_int|4
op_logical_and
id|bus-&gt;codec
(braket
r_template
op_member_access_from_pointer
id|num
)braket
op_eq
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|bus-&gt;shared_type
op_le
id|AC97_SHARED_TYPES
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bus-&gt;shared_type
)paren
(brace
multiline_comment|/* already shared? */
id|down
c_func
(paren
op_amp
id|shared_codec_mutex
)paren
suffix:semicolon
id|ac97
op_assign
id|shared_codec
(braket
id|bus-&gt;shared_type
op_minus
l_int|1
)braket
(braket
r_template
op_member_access_from_pointer
id|num
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ac97
)paren
(brace
r_if
c_cond
(paren
(paren
id|ac97_is_audio
c_func
(paren
id|ac97
)paren
op_logical_and
(paren
r_template
op_member_access_from_pointer
id|scaps
op_amp
id|AC97_SCAP_SKIP_AUDIO
)paren
)paren
op_logical_or
(paren
id|ac97_is_modem
c_func
(paren
id|ac97
)paren
op_logical_and
(paren
r_template
op_member_access_from_pointer
id|scaps
op_amp
id|AC97_SCAP_SKIP_MODEM
)paren
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|shared_codec_mutex
)paren
suffix:semicolon
r_return
op_minus
id|EACCES
suffix:semicolon
multiline_comment|/* skip this */
)brace
)brace
id|up
c_func
(paren
op_amp
id|shared_codec_mutex
)paren
suffix:semicolon
)brace
id|card
op_assign
id|bus-&gt;card
suffix:semicolon
id|ac97
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|ac97
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac97
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|ac97-&gt;private_data
op_assign
r_template
op_member_access_from_pointer
id|private_data
suffix:semicolon
id|ac97-&gt;private_free
op_assign
r_template
op_member_access_from_pointer
id|private_free
suffix:semicolon
id|ac97-&gt;bus
op_assign
id|bus
suffix:semicolon
id|ac97-&gt;pci
op_assign
r_template
op_member_access_from_pointer
id|pci
suffix:semicolon
id|ac97-&gt;num
op_assign
r_template
op_member_access_from_pointer
id|num
suffix:semicolon
id|ac97-&gt;addr
op_assign
r_template
op_member_access_from_pointer
id|addr
suffix:semicolon
id|ac97-&gt;scaps
op_assign
r_template
op_member_access_from_pointer
id|scaps
suffix:semicolon
id|ac97-&gt;limited_regs
op_assign
r_template
op_member_access_from_pointer
id|limited_regs
suffix:semicolon
id|memcpy
c_func
(paren
id|ac97-&gt;reg_accessed
comma
r_template
op_member_access_from_pointer
id|reg_accessed
comma
r_sizeof
(paren
id|ac97-&gt;reg_accessed
)paren
)paren
suffix:semicolon
id|bus-&gt;codec
(braket
id|ac97-&gt;num
)braket
op_assign
id|ac97
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|ac97-&gt;reg_mutex
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|ac97-&gt;page_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;pci
)paren
(brace
id|pci_read_config_word
c_func
(paren
id|ac97-&gt;pci
comma
id|PCI_SUBSYSTEM_VENDOR_ID
comma
op_amp
id|ac97-&gt;subsystem_vendor
)paren
suffix:semicolon
id|pci_read_config_word
c_func
(paren
id|ac97-&gt;pci
comma
id|PCI_SUBSYSTEM_ID
comma
op_amp
id|ac97-&gt;subsystem_device
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bus-&gt;ops-&gt;reset
)paren
(brace
id|bus-&gt;ops
op_member_access_from_pointer
id|reset
c_func
(paren
id|ac97
)paren
suffix:semicolon
r_goto
id|__access_ok
suffix:semicolon
)brace
id|ac97-&gt;id
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_VENDOR_ID1
)paren
op_lshift
l_int|16
suffix:semicolon
id|ac97-&gt;id
op_or_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_VENDOR_ID2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;id
op_logical_and
id|ac97-&gt;id
op_ne
(paren
r_int
r_int
)paren
op_minus
l_int|1
)paren
(brace
id|pid
op_assign
id|look_for_codec_id
c_func
(paren
id|snd_ac97_codec_ids
comma
id|ac97-&gt;id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pid
op_logical_and
(paren
id|pid-&gt;flags
op_amp
id|AC97_DEFAULT_POWER_OFF
)paren
)paren
r_goto
id|__access_ok
suffix:semicolon
)brace
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_RESET
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* reset to defaults */
r_if
c_cond
(paren
id|bus-&gt;ops-&gt;wait
)paren
id|bus-&gt;ops
op_member_access_from_pointer
id|wait
c_func
(paren
id|ac97
)paren
suffix:semicolon
r_else
(brace
id|udelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;scaps
op_amp
id|AC97_SCAP_SKIP_AUDIO
)paren
id|err
op_assign
id|ac97_reset_wait
c_func
(paren
id|ac97
comma
id|HZ
op_div
l_int|2
comma
l_int|1
)paren
suffix:semicolon
r_else
(brace
id|err
op_assign
id|ac97_reset_wait
c_func
(paren
id|ac97
comma
id|HZ
op_div
l_int|2
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
id|err
op_assign
id|ac97_reset_wait
c_func
(paren
id|ac97
comma
id|HZ
op_div
l_int|2
comma
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AC&squot;97 %d does not respond - RESET&bslash;n&quot;
comma
id|ac97-&gt;num
)paren
suffix:semicolon
multiline_comment|/* proceed anyway - it&squot;s often non-critical */
)brace
)brace
id|__access_ok
suffix:colon
id|ac97-&gt;id
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_VENDOR_ID1
)paren
op_lshift
l_int|16
suffix:semicolon
id|ac97-&gt;id
op_or_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_VENDOR_ID2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ac97-&gt;scaps
op_amp
id|AC97_SCAP_DETECT_BY_VENDOR
)paren
op_logical_and
(paren
id|ac97-&gt;id
op_eq
l_int|0x00000000
op_logical_or
id|ac97-&gt;id
op_eq
l_int|0xffffffff
)paren
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;AC&squot;97 %d access is not valid [0x%x], removing mixer.&bslash;n&quot;
comma
id|ac97-&gt;num
comma
id|ac97-&gt;id
)paren
suffix:semicolon
id|snd_ac97_free
c_func
(paren
id|ac97
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|pid
op_assign
id|look_for_codec_id
c_func
(paren
id|snd_ac97_codec_ids
comma
id|ac97-&gt;id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pid
)paren
id|ac97-&gt;flags
op_or_assign
id|pid-&gt;flags
suffix:semicolon
multiline_comment|/* test for AC&squot;97 */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ac97-&gt;scaps
op_amp
id|AC97_SCAP_SKIP_AUDIO
)paren
op_logical_and
op_logical_neg
(paren
id|ac97-&gt;scaps
op_amp
id|AC97_SCAP_AUDIO
)paren
)paren
(brace
multiline_comment|/* test if we can write to the record gain volume register */
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_REC_GAIN
comma
l_int|0x8a06
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|err
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_REC_GAIN
)paren
)paren
op_amp
l_int|0x7fff
)paren
op_eq
l_int|0x0a06
)paren
id|ac97-&gt;scaps
op_or_assign
id|AC97_SCAP_AUDIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ac97-&gt;scaps
op_amp
id|AC97_SCAP_AUDIO
)paren
(brace
id|ac97-&gt;caps
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_RESET
)paren
suffix:semicolon
id|ac97-&gt;ext_id
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_ID
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;ext_id
op_eq
l_int|0xffff
)paren
multiline_comment|/* invalid combination */
id|ac97-&gt;ext_id
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* test for MC&squot;97 */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ac97-&gt;scaps
op_amp
id|AC97_SCAP_SKIP_MODEM
)paren
op_logical_and
op_logical_neg
(paren
id|ac97-&gt;scaps
op_amp
id|AC97_SCAP_MODEM
)paren
)paren
(brace
id|ac97-&gt;ext_mid
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_MID
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;ext_mid
op_eq
l_int|0xffff
)paren
multiline_comment|/* invalid combination */
id|ac97-&gt;ext_mid
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;ext_mid
op_amp
l_int|1
)paren
id|ac97-&gt;scaps
op_or_assign
id|AC97_SCAP_MODEM
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ac97_is_audio
c_func
(paren
id|ac97
)paren
op_logical_and
op_logical_neg
id|ac97_is_modem
c_func
(paren
id|ac97
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ac97-&gt;scaps
op_amp
(paren
id|AC97_SCAP_SKIP_AUDIO
op_or
id|AC97_SCAP_SKIP_MODEM
)paren
)paren
)paren
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;AC&squot;97 %d access error (not audio or modem codec)&bslash;n&quot;
comma
id|ac97-&gt;num
)paren
suffix:semicolon
id|snd_ac97_free
c_func
(paren
id|ac97
)paren
suffix:semicolon
r_return
op_minus
id|EACCES
suffix:semicolon
)brace
r_if
c_cond
(paren
id|bus-&gt;ops-&gt;reset
)paren
singleline_comment|// FIXME: always skipping?
r_goto
id|__ready_ok
suffix:semicolon
multiline_comment|/* FIXME: add powerdown control */
r_if
c_cond
(paren
id|ac97_is_audio
c_func
(paren
id|ac97
)paren
)paren
(brace
multiline_comment|/* nothing should be in powerdown mode */
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_POWERDOWN
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ac97-&gt;flags
op_amp
id|AC97_DEFAULT_POWER_OFF
)paren
)paren
(brace
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_RESET
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* reset to defaults */
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_POWERDOWN
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* nothing should be in powerdown mode */
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_GENERAL_PURPOSE
comma
l_int|0
)paren
suffix:semicolon
id|end_time
op_assign
id|jiffies
op_plus
(paren
id|HZ
op_div
l_int|10
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_POWERDOWN
)paren
op_amp
l_int|0x0f
)paren
op_eq
l_int|0x0f
)paren
r_goto
id|__ready_ok
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|time_after_eq
c_func
(paren
id|end_time
comma
id|jiffies
)paren
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;AC&squot;97 %d analog subsections not ready&bslash;n&quot;
comma
id|ac97-&gt;num
)paren
suffix:semicolon
)brace
multiline_comment|/* FIXME: add powerdown control */
r_if
c_cond
(paren
id|ac97_is_modem
c_func
(paren
id|ac97
)paren
)paren
(brace
r_int
r_char
id|tmp
suffix:semicolon
multiline_comment|/* nothing should be in powerdown mode */
multiline_comment|/* note: it&squot;s important to set the rate at first */
id|tmp
op_assign
id|AC97_MEA_GPIO
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;ext_mid
op_amp
id|AC97_MEI_LINE1
)paren
(brace
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_LINE1_RATE
comma
l_int|12000
)paren
suffix:semicolon
id|tmp
op_or_assign
id|AC97_MEA_ADC1
op_or
id|AC97_MEA_DAC1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ac97-&gt;ext_mid
op_amp
id|AC97_MEI_LINE2
)paren
(brace
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_LINE2_RATE
comma
l_int|12000
)paren
suffix:semicolon
id|tmp
op_or_assign
id|AC97_MEA_ADC2
op_or
id|AC97_MEA_DAC2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ac97-&gt;ext_mid
op_amp
id|AC97_MEI_HANDSET
)paren
(brace
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_HANDSET_RATE
comma
l_int|12000
)paren
suffix:semicolon
id|tmp
op_or_assign
id|AC97_MEA_HADC
op_or
id|AC97_MEA_HDAC
suffix:semicolon
)brace
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_MSTATUS
comma
l_int|0xff00
op_amp
op_complement
(paren
id|tmp
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* nothing should be in powerdown mode */
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_MSTATUS
comma
l_int|0xff00
op_amp
op_complement
(paren
id|tmp
op_lshift
l_int|8
)paren
)paren
suffix:semicolon
id|end_time
op_assign
id|jiffies
op_plus
(paren
id|HZ
op_div
l_int|10
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
(paren
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_MSTATUS
)paren
op_amp
id|tmp
)paren
op_eq
id|tmp
)paren
r_goto
id|__ready_ok
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|time_after_eq
c_func
(paren
id|end_time
comma
id|jiffies
)paren
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;MC&squot;97 %d converters and GPIO not ready (0x%x)&bslash;n&quot;
comma
id|ac97-&gt;num
comma
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_MSTATUS
)paren
)paren
suffix:semicolon
)brace
id|__ready_ok
suffix:colon
r_if
c_cond
(paren
id|ac97_is_audio
c_func
(paren
id|ac97
)paren
)paren
id|ac97-&gt;addr
op_assign
(paren
id|ac97-&gt;ext_id
op_amp
id|AC97_EI_ADDR_MASK
)paren
op_rshift
id|AC97_EI_ADDR_SHIFT
suffix:semicolon
r_else
id|ac97-&gt;addr
op_assign
(paren
id|ac97-&gt;ext_mid
op_amp
id|AC97_MEI_ADDR_MASK
)paren
op_rshift
id|AC97_MEI_ADDR_SHIFT
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;ext_id
op_amp
l_int|0x01c9
)paren
(brace
multiline_comment|/* L/R, MIC, SDAC, LDAC VRA support */
id|reg
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_STATUS
)paren
suffix:semicolon
id|reg
op_or_assign
id|ac97-&gt;ext_id
op_amp
l_int|0x01c0
suffix:semicolon
multiline_comment|/* LDAC/SDAC/CDAC */
r_if
c_cond
(paren
op_logical_neg
id|bus-&gt;no_vra
)paren
id|reg
op_or_assign
id|ac97-&gt;ext_id
op_amp
l_int|0x0009
suffix:semicolon
multiline_comment|/* VRA/VRM */
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_STATUS
comma
id|reg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ac97-&gt;ext_id
op_amp
id|AC97_EI_DRA
)paren
op_logical_and
id|bus-&gt;dra
)paren
(brace
multiline_comment|/* Intel controllers require double rate data to be put in&n;&t;&t; * slots 7+8, so let&squot;s hope the codec supports it. */
id|snd_ac97_update_bits
c_func
(paren
id|ac97
comma
id|AC97_GENERAL_PURPOSE
comma
id|AC97_GP_DRSS_MASK
comma
id|AC97_GP_DRSS_78
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_GENERAL_PURPOSE
)paren
op_amp
id|AC97_GP_DRSS_MASK
)paren
op_eq
id|AC97_GP_DRSS_78
)paren
id|ac97-&gt;flags
op_or_assign
id|AC97_DOUBLE_RATE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ac97-&gt;ext_id
op_amp
id|AC97_EI_VRA
)paren
(brace
multiline_comment|/* VRA support */
id|snd_ac97_determine_rates
c_func
(paren
id|ac97
comma
id|AC97_PCM_FRONT_DAC_RATE
comma
l_int|0
comma
op_amp
id|ac97-&gt;rates
(braket
id|AC97_RATES_FRONT_DAC
)braket
)paren
suffix:semicolon
id|snd_ac97_determine_rates
c_func
(paren
id|ac97
comma
id|AC97_PCM_LR_ADC_RATE
comma
l_int|0
comma
op_amp
id|ac97-&gt;rates
(braket
id|AC97_RATES_ADC
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
id|ac97-&gt;rates
(braket
id|AC97_RATES_FRONT_DAC
)braket
op_assign
id|SNDRV_PCM_RATE_48000
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;flags
op_amp
id|AC97_DOUBLE_RATE
)paren
id|ac97-&gt;rates
(braket
id|AC97_RATES_FRONT_DAC
)braket
op_or_assign
id|SNDRV_PCM_RATE_96000
suffix:semicolon
id|ac97-&gt;rates
(braket
id|AC97_RATES_ADC
)braket
op_assign
id|SNDRV_PCM_RATE_48000
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ac97-&gt;ext_id
op_amp
id|AC97_EI_SPDIF
)paren
(brace
multiline_comment|/* codec specific code (patch) should override these values */
id|ac97-&gt;rates
(braket
id|AC97_RATES_SPDIF
)braket
op_assign
id|SNDRV_PCM_RATE_48000
op_or
id|SNDRV_PCM_RATE_44100
op_or
id|SNDRV_PCM_RATE_32000
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ac97-&gt;ext_id
op_amp
id|AC97_EI_VRM
)paren
(brace
multiline_comment|/* MIC VRA support */
id|snd_ac97_determine_rates
c_func
(paren
id|ac97
comma
id|AC97_PCM_MIC_ADC_RATE
comma
l_int|0
comma
op_amp
id|ac97-&gt;rates
(braket
id|AC97_RATES_MIC_ADC
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
id|ac97-&gt;rates
(braket
id|AC97_RATES_MIC_ADC
)braket
op_assign
id|SNDRV_PCM_RATE_48000
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ac97-&gt;ext_id
op_amp
id|AC97_EI_SDAC
)paren
(brace
multiline_comment|/* SDAC support */
id|snd_ac97_determine_rates
c_func
(paren
id|ac97
comma
id|AC97_PCM_SURR_DAC_RATE
comma
id|AC97_PCM_FRONT_DAC_RATE
comma
op_amp
id|ac97-&gt;rates
(braket
id|AC97_RATES_SURR_DAC
)braket
)paren
suffix:semicolon
id|ac97-&gt;scaps
op_or_assign
id|AC97_SCAP_SURROUND_DAC
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ac97-&gt;ext_id
op_amp
id|AC97_EI_LDAC
)paren
(brace
multiline_comment|/* LDAC support */
id|snd_ac97_determine_rates
c_func
(paren
id|ac97
comma
id|AC97_PCM_LFE_DAC_RATE
comma
id|AC97_PCM_FRONT_DAC_RATE
comma
op_amp
id|ac97-&gt;rates
(braket
id|AC97_RATES_LFE_DAC
)braket
)paren
suffix:semicolon
id|ac97-&gt;scaps
op_or_assign
id|AC97_SCAP_CENTER_LFE_DAC
suffix:semicolon
)brace
multiline_comment|/* additional initializations */
r_if
c_cond
(paren
id|bus-&gt;ops-&gt;init
)paren
id|bus-&gt;ops
op_member_access_from_pointer
id|init
c_func
(paren
id|ac97
)paren
suffix:semicolon
id|snd_ac97_get_name
c_func
(paren
id|ac97
comma
id|ac97-&gt;id
comma
id|name
comma
op_logical_neg
id|ac97_is_audio
c_func
(paren
id|ac97
)paren
)paren
suffix:semicolon
id|snd_ac97_get_name
c_func
(paren
l_int|NULL
comma
id|ac97-&gt;id
comma
id|name
comma
op_logical_neg
id|ac97_is_audio
c_func
(paren
id|ac97
)paren
)paren
suffix:semicolon
singleline_comment|// ac97-&gt;id might be changed in the special setup code
r_if
c_cond
(paren
op_logical_neg
id|ac97-&gt;build_ops
)paren
id|ac97-&gt;build_ops
op_assign
op_amp
id|null_build_ops
suffix:semicolon
r_if
c_cond
(paren
id|ac97_is_audio
c_func
(paren
id|ac97
)paren
)paren
(brace
r_char
id|comp
(braket
l_int|16
)braket
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;mixername
(braket
l_int|0
)braket
op_eq
l_char|&squot;&bslash;0&squot;
)paren
(brace
id|strcpy
c_func
(paren
id|card-&gt;mixername
comma
id|name
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|card-&gt;mixername
)paren
op_plus
l_int|1
op_plus
id|strlen
c_func
(paren
id|name
)paren
op_plus
l_int|1
op_le
r_sizeof
(paren
id|card-&gt;mixername
)paren
)paren
(brace
id|strcat
c_func
(paren
id|card-&gt;mixername
comma
l_string|&quot;,&quot;
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|card-&gt;mixername
comma
id|name
)paren
suffix:semicolon
)brace
)brace
id|sprintf
c_func
(paren
id|comp
comma
l_string|&quot;AC97a:%08x&quot;
comma
id|ac97-&gt;id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_component_add
c_func
(paren
id|card
comma
id|comp
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_ac97_free
c_func
(paren
id|ac97
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|snd_ac97_mixer_build
c_func
(paren
id|ac97
)paren
OL
l_int|0
)paren
(brace
id|snd_ac97_free
c_func
(paren
id|ac97
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|ac97_is_modem
c_func
(paren
id|ac97
)paren
)paren
(brace
r_char
id|comp
(braket
l_int|16
)braket
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;mixername
(braket
l_int|0
)braket
op_eq
l_char|&squot;&bslash;0&squot;
)paren
(brace
id|strcpy
c_func
(paren
id|card-&gt;mixername
comma
id|name
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|card-&gt;mixername
)paren
op_plus
l_int|1
op_plus
id|strlen
c_func
(paren
id|name
)paren
op_plus
l_int|1
op_le
r_sizeof
(paren
id|card-&gt;mixername
)paren
)paren
(brace
id|strcat
c_func
(paren
id|card-&gt;mixername
comma
l_string|&quot;,&quot;
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|card-&gt;mixername
comma
id|name
)paren
suffix:semicolon
)brace
)brace
id|sprintf
c_func
(paren
id|comp
comma
l_string|&quot;AC97m:%08x&quot;
comma
id|ac97-&gt;id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_component_add
c_func
(paren
id|card
comma
id|comp
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_ac97_free
c_func
(paren
id|ac97
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|snd_ac97_modem_build
c_func
(paren
id|card
comma
id|ac97
)paren
OL
l_int|0
)paren
(brace
id|snd_ac97_free
c_func
(paren
id|ac97
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
)brace
multiline_comment|/* make sure the proper powerdown bits are cleared */
r_if
c_cond
(paren
id|ac97-&gt;scaps
)paren
(brace
id|reg
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;scaps
op_amp
id|AC97_SCAP_SURROUND_DAC
)paren
id|reg
op_and_assign
op_complement
id|AC97_EA_PRJ
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;scaps
op_amp
id|AC97_SCAP_CENTER_LFE_DAC
)paren
id|reg
op_and_assign
op_complement
(paren
id|AC97_EA_PRI
op_or
id|AC97_EA_PRK
)paren
suffix:semicolon
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_STATUS
comma
id|reg
)paren
suffix:semicolon
)brace
id|snd_ac97_proc_init
c_func
(paren
id|ac97
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_CODEC
comma
id|ac97
comma
op_amp
id|ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_ac97_free
c_func
(paren
id|ac97
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
op_star
id|rac97
op_assign
id|ac97
suffix:semicolon
r_if
c_cond
(paren
id|bus-&gt;shared_type
)paren
(brace
id|down
c_func
(paren
op_amp
id|shared_codec_mutex
)paren
suffix:semicolon
id|shared_codec
(braket
id|bus-&gt;shared_type
op_minus
l_int|1
)braket
(braket
id|ac97-&gt;num
)braket
op_assign
id|ac97
suffix:semicolon
id|up
c_func
(paren
op_amp
id|shared_codec_mutex
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Power down the chip.&n; *&n; * MASTER and HEADPHONE registers are muted but the register cache values&n; * are not changed, so that the values can be restored in snd_ac97_resume().&n; */
DECL|function|snd_ac97_powerdown
r_static
r_void
id|snd_ac97_powerdown
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
r_int
r_int
id|power
suffix:semicolon
r_if
c_cond
(paren
id|ac97_is_audio
c_func
(paren
id|ac97
)paren
)paren
(brace
multiline_comment|/* some codecs have stereo mute bits */
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_MASTER
comma
l_int|0x9f9f
)paren
suffix:semicolon
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_HEADPHONE
comma
l_int|0x9f9f
)paren
suffix:semicolon
)brace
id|power
op_assign
id|ac97-&gt;regs
(braket
id|AC97_POWERDOWN
)braket
op_or
l_int|0x8000
suffix:semicolon
multiline_comment|/* EAPD */
id|power
op_or_assign
l_int|0x4000
suffix:semicolon
multiline_comment|/* Headphone amplifier powerdown */
id|power
op_or_assign
l_int|0x0300
suffix:semicolon
multiline_comment|/* ADC &amp; DAC powerdown */
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_POWERDOWN
comma
id|power
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|power
op_or_assign
l_int|0x0400
suffix:semicolon
multiline_comment|/* Analog Mixer powerdown (Vref on) */
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_POWERDOWN
comma
id|power
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
macro_line|#if 0
multiline_comment|/* FIXME: this causes click noises on some boards at resume */
id|power
op_or_assign
l_int|0x3800
suffix:semicolon
multiline_comment|/* AC-link powerdown, internal Clk disable */
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_POWERDOWN
comma
id|power
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#ifdef CONFIG_PM
multiline_comment|/**&n; * snd_ac97_suspend - General suspend function for AC97 codec&n; * @ac97: the ac97 instance&n; *&n; * Suspends the codec, power down the chip.&n; */
DECL|function|snd_ac97_suspend
r_void
id|snd_ac97_suspend
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
r_if
c_cond
(paren
id|ac97-&gt;build_ops-&gt;suspend
)paren
id|ac97-&gt;build_ops
op_member_access_from_pointer
id|suspend
c_func
(paren
id|ac97
)paren
suffix:semicolon
id|snd_ac97_powerdown
c_func
(paren
id|ac97
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * restore ac97 status&n; */
DECL|function|snd_ac97_restore_status
r_void
id|snd_ac97_restore_status
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|2
suffix:semicolon
id|i
OL
l_int|0x7c
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|i
op_eq
id|AC97_POWERDOWN
op_logical_or
id|i
op_eq
id|AC97_EXTENDED_ID
)paren
r_continue
suffix:semicolon
multiline_comment|/* restore only accessible registers&n;&t;&t; * some chip (e.g. nm256) may hang up when unsupported registers&n;&t;&t; * are accessed..!&n;&t;&t; */
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|i
comma
id|ac97-&gt;reg_accessed
)paren
)paren
(brace
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|i
comma
id|ac97-&gt;regs
(braket
id|i
)braket
)paren
suffix:semicolon
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|i
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; * restore IEC958 status&n; */
DECL|function|snd_ac97_restore_iec958
r_void
id|snd_ac97_restore_iec958
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
r_if
c_cond
(paren
id|ac97-&gt;ext_id
op_amp
id|AC97_EI_SPDIF
)paren
(brace
r_if
c_cond
(paren
id|ac97-&gt;regs
(braket
id|AC97_EXTENDED_STATUS
)braket
op_amp
id|AC97_EA_SPDIF
)paren
(brace
multiline_comment|/* reset spdif status */
id|snd_ac97_update_bits
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_STATUS
comma
id|AC97_EA_SPDIF
comma
l_int|0
)paren
suffix:semicolon
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_STATUS
comma
id|ac97-&gt;regs
(braket
id|AC97_EXTENDED_STATUS
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;flags
op_amp
id|AC97_CS_SPDIF
)paren
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_CSR_SPDIF
comma
id|ac97-&gt;regs
(braket
id|AC97_CSR_SPDIF
)braket
)paren
suffix:semicolon
r_else
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_SPDIF
comma
id|ac97-&gt;regs
(braket
id|AC97_SPDIF
)braket
)paren
suffix:semicolon
id|snd_ac97_update_bits
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_STATUS
comma
id|AC97_EA_SPDIF
comma
id|AC97_EA_SPDIF
)paren
suffix:semicolon
multiline_comment|/* turn on again */
)brace
)brace
)brace
multiline_comment|/**&n; * snd_ac97_resume - General resume function for AC97 codec&n; * @ac97: the ac97 instance&n; *&n; * Do the standard resume procedure, power up and restoring the&n; * old register values.&n; */
DECL|function|snd_ac97_resume
r_void
id|snd_ac97_resume
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;bus-&gt;ops-&gt;reset
)paren
(brace
id|ac97-&gt;bus-&gt;ops
op_member_access_from_pointer
id|reset
c_func
(paren
id|ac97
)paren
suffix:semicolon
r_goto
id|__reset_ready
suffix:semicolon
)brace
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_POWERDOWN
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ac97-&gt;flags
op_amp
id|AC97_DEFAULT_POWER_OFF
)paren
)paren
(brace
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_RESET
comma
l_int|0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_POWERDOWN
comma
l_int|0
)paren
suffix:semicolon
)brace
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_GENERAL_PURPOSE
comma
l_int|0
)paren
suffix:semicolon
id|snd_ac97_write
c_func
(paren
id|ac97
comma
id|AC97_POWERDOWN
comma
id|ac97-&gt;regs
(braket
id|AC97_POWERDOWN
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac97_is_audio
c_func
(paren
id|ac97
)paren
)paren
(brace
id|ac97-&gt;bus-&gt;ops
op_member_access_from_pointer
id|write
c_func
(paren
id|ac97
comma
id|AC97_MASTER
comma
l_int|0x8101
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|HZ
op_div
l_int|10
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_MASTER
)paren
op_eq
l_int|0x8101
)paren
r_break
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* FIXME: extra delay */
id|ac97-&gt;bus-&gt;ops
op_member_access_from_pointer
id|write
c_func
(paren
id|ac97
comma
id|AC97_MASTER
comma
l_int|0x8000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_MASTER
)paren
op_ne
l_int|0x8000
)paren
(brace
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
id|HZ
op_div
l_int|4
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
r_for
c_loop
(paren
id|i
op_assign
id|HZ
op_div
l_int|10
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_int
r_int
id|val
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_EXTENDED_MID
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
l_int|0xffff
op_logical_and
(paren
id|val
op_amp
l_int|1
)paren
op_ne
l_int|0
)paren
r_break
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|schedule_timeout
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
)brace
id|__reset_ready
suffix:colon
r_if
c_cond
(paren
id|ac97-&gt;bus-&gt;ops-&gt;init
)paren
id|ac97-&gt;bus-&gt;ops
op_member_access_from_pointer
id|init
c_func
(paren
id|ac97
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac97-&gt;build_ops-&gt;resume
)paren
id|ac97-&gt;build_ops
op_member_access_from_pointer
id|resume
c_func
(paren
id|ac97
)paren
suffix:semicolon
r_else
(brace
id|snd_ac97_restore_status
c_func
(paren
id|ac97
)paren
suffix:semicolon
id|snd_ac97_restore_iec958
c_func
(paren
id|ac97
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/*&n; * Hardware tuning&n; */
DECL|function|set_ctl_name
r_static
r_void
id|set_ctl_name
c_func
(paren
r_char
op_star
id|dst
comma
r_const
r_char
op_star
id|src
comma
r_const
r_char
op_star
id|suffix
)paren
(brace
r_if
c_cond
(paren
id|suffix
)paren
id|sprintf
c_func
(paren
id|dst
comma
l_string|&quot;%s %s&quot;
comma
id|src
comma
id|suffix
)paren
suffix:semicolon
r_else
id|strcpy
c_func
(paren
id|dst
comma
id|src
)paren
suffix:semicolon
)brace
multiline_comment|/* remove the control with the given name and optional suffix */
DECL|function|snd_ac97_remove_ctl
r_int
id|snd_ac97_remove_ctl
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_const
r_char
op_star
id|name
comma
r_const
r_char
op_star
id|suffix
)paren
(brace
id|snd_ctl_elem_id_t
id|id
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|id
comma
l_int|0
comma
r_sizeof
(paren
id|id
)paren
)paren
suffix:semicolon
id|set_ctl_name
c_func
(paren
id|id.name
comma
id|name
comma
id|suffix
)paren
suffix:semicolon
id|id.iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
suffix:semicolon
r_return
id|snd_ctl_remove_id
c_func
(paren
id|ac97-&gt;bus-&gt;card
comma
op_amp
id|id
)paren
suffix:semicolon
)brace
DECL|function|ctl_find
r_static
id|snd_kcontrol_t
op_star
id|ctl_find
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_const
r_char
op_star
id|name
comma
r_const
r_char
op_star
id|suffix
)paren
(brace
id|snd_ctl_elem_id_t
id|sid
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|sid
comma
l_int|0
comma
r_sizeof
(paren
id|sid
)paren
)paren
suffix:semicolon
id|set_ctl_name
c_func
(paren
id|sid.name
comma
id|name
comma
id|suffix
)paren
suffix:semicolon
id|sid.iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
suffix:semicolon
r_return
id|snd_ctl_find_id
c_func
(paren
id|ac97-&gt;bus-&gt;card
comma
op_amp
id|sid
)paren
suffix:semicolon
)brace
multiline_comment|/* rename the control with the given name and optional suffix */
DECL|function|snd_ac97_rename_ctl
r_int
id|snd_ac97_rename_ctl
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_const
r_char
op_star
id|src
comma
r_const
r_char
op_star
id|dst
comma
r_const
r_char
op_star
id|suffix
)paren
(brace
id|snd_kcontrol_t
op_star
id|kctl
op_assign
id|ctl_find
c_func
(paren
id|ac97
comma
id|src
comma
id|suffix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kctl
)paren
(brace
id|set_ctl_name
c_func
(paren
id|kctl-&gt;id.name
comma
id|dst
comma
id|suffix
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
multiline_comment|/* rename both Volume and Switch controls - don&squot;t check the return value */
DECL|function|snd_ac97_rename_vol_ctl
r_void
id|snd_ac97_rename_vol_ctl
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_const
r_char
op_star
id|src
comma
r_const
r_char
op_star
id|dst
)paren
(brace
id|snd_ac97_rename_ctl
c_func
(paren
id|ac97
comma
id|src
comma
id|dst
comma
l_string|&quot;Switch&quot;
)paren
suffix:semicolon
id|snd_ac97_rename_ctl
c_func
(paren
id|ac97
comma
id|src
comma
id|dst
comma
l_string|&quot;Volume&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* swap controls */
DECL|function|snd_ac97_swap_ctl
r_int
id|snd_ac97_swap_ctl
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_const
r_char
op_star
id|s1
comma
r_const
r_char
op_star
id|s2
comma
r_const
r_char
op_star
id|suffix
)paren
(brace
id|snd_kcontrol_t
op_star
id|kctl1
comma
op_star
id|kctl2
suffix:semicolon
id|kctl1
op_assign
id|ctl_find
c_func
(paren
id|ac97
comma
id|s1
comma
id|suffix
)paren
suffix:semicolon
id|kctl2
op_assign
id|ctl_find
c_func
(paren
id|ac97
comma
id|s2
comma
id|suffix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|kctl1
op_logical_and
id|kctl2
)paren
(brace
id|set_ctl_name
c_func
(paren
id|kctl1-&gt;id.name
comma
id|s2
comma
id|suffix
)paren
suffix:semicolon
id|set_ctl_name
c_func
(paren
id|kctl2-&gt;id.name
comma
id|s1
comma
id|suffix
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
macro_line|#if 1
multiline_comment|/* bind hp and master controls instead of using only hp control */
DECL|function|bind_hp_volsw_put
r_static
r_int
id|bind_hp_volsw_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
r_int
id|err
op_assign
id|snd_ac97_put_volsw
c_func
(paren
id|kcontrol
comma
id|ucontrol
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OG
l_int|0
)paren
(brace
r_int
r_int
id|priv_saved
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
id|kcontrol-&gt;private_value
op_assign
(paren
id|kcontrol-&gt;private_value
op_amp
op_complement
l_int|0xff
)paren
op_or
id|AC97_HEADPHONE
suffix:semicolon
id|snd_ac97_put_volsw
c_func
(paren
id|kcontrol
comma
id|ucontrol
)paren
suffix:semicolon
id|kcontrol-&gt;private_value
op_assign
id|priv_saved
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* ac97 tune: bind Master and Headphone controls */
DECL|function|tune_hp_only
r_static
r_int
id|tune_hp_only
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
id|snd_kcontrol_t
op_star
id|msw
op_assign
id|ctl_find
c_func
(paren
id|ac97
comma
l_string|&quot;Master Playback Switch&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|snd_kcontrol_t
op_star
id|mvol
op_assign
id|ctl_find
c_func
(paren
id|ac97
comma
l_string|&quot;Master Playback Volume&quot;
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|msw
op_logical_or
op_logical_neg
id|mvol
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
id|msw-&gt;put
op_assign
id|bind_hp_volsw_put
suffix:semicolon
id|mvol-&gt;put
op_assign
id|bind_hp_volsw_put
suffix:semicolon
id|snd_ac97_remove_ctl
c_func
(paren
id|ac97
comma
l_string|&quot;Headphone Playback&quot;
comma
l_string|&quot;Switch&quot;
)paren
suffix:semicolon
id|snd_ac97_remove_ctl
c_func
(paren
id|ac97
comma
l_string|&quot;Headphone Playback&quot;
comma
l_string|&quot;Volume&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#else
multiline_comment|/* ac97 tune: use Headphone control as master */
DECL|function|tune_hp_only
r_static
r_int
id|tune_hp_only
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
r_if
c_cond
(paren
id|ctl_find
c_func
(paren
id|ac97
comma
l_string|&quot;Headphone Playback Switch&quot;
comma
l_int|NULL
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
id|snd_ac97_remove_ctl
c_func
(paren
id|ac97
comma
l_string|&quot;Master Playback&quot;
comma
l_string|&quot;Switch&quot;
)paren
suffix:semicolon
id|snd_ac97_remove_ctl
c_func
(paren
id|ac97
comma
l_string|&quot;Master Playback&quot;
comma
l_string|&quot;Volume&quot;
)paren
suffix:semicolon
id|snd_ac97_rename_vol_ctl
c_func
(paren
id|ac97
comma
l_string|&quot;Headphone Playback&quot;
comma
l_string|&quot;Master Playback&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* ac97 tune: swap Headphone and Master controls */
DECL|function|tune_swap_hp
r_static
r_int
id|tune_swap_hp
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
r_if
c_cond
(paren
id|ctl_find
c_func
(paren
id|ac97
comma
l_string|&quot;Headphone Playback Switch&quot;
comma
l_int|NULL
)paren
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
id|snd_ac97_rename_vol_ctl
c_func
(paren
id|ac97
comma
l_string|&quot;Master Playback&quot;
comma
l_string|&quot;Line-Out Playback&quot;
)paren
suffix:semicolon
id|snd_ac97_rename_vol_ctl
c_func
(paren
id|ac97
comma
l_string|&quot;Headphone Playback&quot;
comma
l_string|&quot;Master Playback&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ac97 tune: swap Surround and Master controls */
DECL|function|tune_swap_surround
r_static
r_int
id|tune_swap_surround
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
r_if
c_cond
(paren
id|snd_ac97_swap_ctl
c_func
(paren
id|ac97
comma
l_string|&quot;Master Playback&quot;
comma
l_string|&quot;Surround Playback&quot;
comma
l_string|&quot;Switch&quot;
)paren
op_logical_or
id|snd_ac97_swap_ctl
c_func
(paren
id|ac97
comma
l_string|&quot;Master Playback&quot;
comma
l_string|&quot;Surround Playback&quot;
comma
l_string|&quot;Volume&quot;
)paren
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ac97 tune: set up mic sharing for AD codecs */
DECL|function|tune_ad_sharing
r_static
r_int
id|tune_ad_sharing
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
r_int
r_int
id|scfg
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ac97-&gt;id
op_amp
l_int|0xffffff00
)paren
op_ne
l_int|0x41445300
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ac97_quirk AD_SHARING is only for AD codecs&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* Turn on OMS bit to route microphone to back panel */
id|scfg
op_assign
id|snd_ac97_read
c_func
(paren
id|ac97
comma
id|AC97_AD_SERIAL_CFG
)paren
suffix:semicolon
id|snd_ac97_write_cache
c_func
(paren
id|ac97
comma
id|AC97_AD_SERIAL_CFG
comma
id|scfg
op_or
l_int|0x0200
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_ac97_alc_jack_detect
r_static
r_const
id|snd_kcontrol_new_t
id|snd_ac97_alc_jack_detect
op_assign
id|AC97_SINGLE
c_func
(paren
l_string|&quot;Jack Detect&quot;
comma
id|AC97_ALC650_CLOCK
comma
l_int|5
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* ac97 tune: set up ALC jack-select */
DECL|function|tune_alc_jack
r_static
r_int
id|tune_alc_jack
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
r_if
c_cond
(paren
(paren
id|ac97-&gt;id
op_amp
l_int|0xffffff00
)paren
op_ne
l_int|0x414c4700
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ac97_quirk ALC_JACK is only for Realtek codecs&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|snd_ac97_update_bits
c_func
(paren
id|ac97
comma
l_int|0x7a
comma
l_int|0x20
comma
l_int|0x20
)paren
suffix:semicolon
multiline_comment|/* select jack detect function */
id|snd_ac97_update_bits
c_func
(paren
id|ac97
comma
l_int|0x7a
comma
l_int|0x01
comma
l_int|0x01
)paren
suffix:semicolon
multiline_comment|/* Line-out auto mute */
r_return
id|snd_ctl_add
c_func
(paren
id|ac97-&gt;bus-&gt;card
comma
id|snd_ac97_cnew
c_func
(paren
op_amp
id|snd_ac97_alc_jack_detect
comma
id|ac97
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* ac97 tune: inversed EAPD bit */
DECL|function|tune_inv_eapd
r_static
r_int
id|tune_inv_eapd
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
id|snd_kcontrol_t
op_star
id|kctl
op_assign
id|ctl_find
c_func
(paren
id|ac97
comma
l_string|&quot;External Amplifier&quot;
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|kctl
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
id|set_inv_eapd
c_func
(paren
id|ac97
comma
id|kctl
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|master_mute_sw_put
r_static
r_int
id|master_mute_sw_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
r_int
id|err
op_assign
id|snd_ac97_put_volsw
c_func
(paren
id|kcontrol
comma
id|ucontrol
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OG
l_int|0
)paren
(brace
id|ac97_t
op_star
id|ac97
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|shift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_int
id|rshift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|12
)paren
op_amp
l_int|0x0f
suffix:semicolon
r_int
r_int
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|shift
op_ne
id|rshift
)paren
id|mask
op_assign
l_int|0x8080
suffix:semicolon
r_else
id|mask
op_assign
l_int|0x8000
suffix:semicolon
id|snd_ac97_update_bits
c_func
(paren
id|ac97
comma
id|AC97_POWERDOWN
comma
l_int|0x8000
comma
(paren
id|ac97-&gt;regs
(braket
id|AC97_MASTER
)braket
op_amp
id|mask
)paren
op_eq
id|mask
ques
c_cond
l_int|0x8000
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/* ac97 tune: EAPD controls mute LED bound with the master mute */
DECL|function|tune_mute_led
r_static
r_int
id|tune_mute_led
c_func
(paren
id|ac97_t
op_star
id|ac97
)paren
(brace
id|snd_kcontrol_t
op_star
id|msw
op_assign
id|ctl_find
c_func
(paren
id|ac97
comma
l_string|&quot;Master Playback Switch&quot;
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|msw
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
id|msw-&gt;put
op_assign
id|master_mute_sw_put
suffix:semicolon
id|snd_ac97_remove_ctl
c_func
(paren
id|ac97
comma
l_string|&quot;External Amplifier&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|snd_ac97_update_bits
c_func
(paren
id|ac97
comma
id|AC97_POWERDOWN
comma
l_int|0x8000
comma
l_int|0x8000
)paren
suffix:semicolon
multiline_comment|/* mute LED on */
r_return
l_int|0
suffix:semicolon
)brace
DECL|struct|quirk_table
r_struct
id|quirk_table
(brace
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|func
r_int
(paren
op_star
id|func
)paren
(paren
id|ac97_t
op_star
)paren
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|applicable_quirks
r_static
r_struct
id|quirk_table
id|applicable_quirks
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;none&quot;
comma
l_int|NULL
)brace
comma
(brace
l_string|&quot;hp_only&quot;
comma
id|tune_hp_only
)brace
comma
(brace
l_string|&quot;swap_hp&quot;
comma
id|tune_swap_hp
)brace
comma
(brace
l_string|&quot;swap_surround&quot;
comma
id|tune_swap_surround
)brace
comma
(brace
l_string|&quot;ad_sharing&quot;
comma
id|tune_ad_sharing
)brace
comma
(brace
l_string|&quot;alc_jack&quot;
comma
id|tune_alc_jack
)brace
comma
(brace
l_string|&quot;inv_eapd&quot;
comma
id|tune_inv_eapd
)brace
comma
(brace
l_string|&quot;mute_led&quot;
comma
id|tune_mute_led
)brace
comma
)brace
suffix:semicolon
multiline_comment|/* apply the quirk with the given type */
DECL|function|apply_quirk
r_static
r_int
id|apply_quirk
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_int
id|type
)paren
(brace
r_if
c_cond
(paren
id|type
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
id|type
op_ge
id|ARRAY_SIZE
c_func
(paren
id|applicable_quirks
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|applicable_quirks
(braket
id|type
)braket
dot
id|func
)paren
r_return
id|applicable_quirks
(braket
id|type
)braket
dot
id|func
c_func
(paren
id|ac97
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* apply the quirk with the given name */
DECL|function|apply_quirk_str
r_static
r_int
id|apply_quirk_str
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_const
r_char
op_star
id|typestr
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|quirk_table
op_star
id|q
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|applicable_quirks
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|q
op_assign
op_amp
id|applicable_quirks
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|q-&gt;name
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|typestr
comma
id|q-&gt;name
)paren
)paren
r_return
id|apply_quirk
c_func
(paren
id|ac97
comma
id|i
)paren
suffix:semicolon
)brace
multiline_comment|/* for compatibility, accept the numbers, too */
r_if
c_cond
(paren
op_star
id|typestr
op_ge
l_char|&squot;0&squot;
op_logical_and
op_star
id|typestr
op_le
l_char|&squot;9&squot;
)paren
r_return
id|apply_quirk
c_func
(paren
id|ac97
comma
(paren
r_int
)paren
id|simple_strtoul
c_func
(paren
id|typestr
comma
l_int|NULL
comma
l_int|10
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/**&n; * snd_ac97_tune_hardware - tune up the hardware&n; * @ac97: the ac97 instance&n; * @quirk: quirk list&n; * @override: explicit quirk value (overrides the list if non-NULL)&n; *&n; * Do some workaround for each pci device, such as renaming of the&n; * headphone (true line-out) control as &quot;Master&quot;.&n; * The quirk-list must be terminated with a zero-filled entry.&n; *&n; * Returns zero if successful, or a negative error code on failure.&n; */
DECL|function|snd_ac97_tune_hardware
r_int
id|snd_ac97_tune_hardware
c_func
(paren
id|ac97_t
op_star
id|ac97
comma
r_struct
id|ac97_quirk
op_star
id|quirk
comma
r_const
r_char
op_star
id|override
)paren
(brace
r_int
id|result
suffix:semicolon
id|snd_assert
c_func
(paren
id|quirk
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
multiline_comment|/* quirk overriden? */
r_if
c_cond
(paren
id|override
op_logical_and
id|strcmp
c_func
(paren
id|override
comma
l_string|&quot;-1&quot;
)paren
op_logical_and
id|strcmp
c_func
(paren
id|override
comma
l_string|&quot;default&quot;
)paren
)paren
(brace
id|result
op_assign
id|apply_quirk_str
c_func
(paren
id|ac97
comma
id|override
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;applying quirk type %s failed (%d)&bslash;n&quot;
comma
id|override
comma
id|result
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
r_for
c_loop
(paren
suffix:semicolon
id|quirk-&gt;vendor
suffix:semicolon
id|quirk
op_increment
)paren
(brace
r_if
c_cond
(paren
id|quirk-&gt;vendor
op_ne
id|ac97-&gt;subsystem_vendor
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|quirk-&gt;mask
op_logical_and
id|quirk-&gt;device
op_eq
id|ac97-&gt;subsystem_device
)paren
op_logical_or
id|quirk-&gt;device
op_eq
(paren
id|quirk-&gt;mask
op_amp
id|ac97-&gt;subsystem_device
)paren
)paren
(brace
r_if
c_cond
(paren
id|quirk-&gt;codec_id
op_logical_and
id|quirk-&gt;codec_id
op_ne
id|ac97-&gt;id
)paren
r_continue
suffix:semicolon
id|snd_printdd
c_func
(paren
l_string|&quot;ac97 quirk for %s (%04x:%04x)&bslash;n&quot;
comma
id|quirk-&gt;name
comma
id|ac97-&gt;subsystem_vendor
comma
id|ac97-&gt;subsystem_device
)paren
suffix:semicolon
id|result
op_assign
id|apply_quirk
c_func
(paren
id|ac97
comma
id|quirk-&gt;type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;applying quirk type %d for %s failed (%d)&bslash;n&quot;
comma
id|quirk-&gt;type
comma
id|quirk-&gt;name
comma
id|result
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Exported symbols&n; */
DECL|variable|snd_ac97_write
id|EXPORT_SYMBOL
c_func
(paren
id|snd_ac97_write
)paren
suffix:semicolon
DECL|variable|snd_ac97_read
id|EXPORT_SYMBOL
c_func
(paren
id|snd_ac97_read
)paren
suffix:semicolon
DECL|variable|snd_ac97_write_cache
id|EXPORT_SYMBOL
c_func
(paren
id|snd_ac97_write_cache
)paren
suffix:semicolon
DECL|variable|snd_ac97_update
id|EXPORT_SYMBOL
c_func
(paren
id|snd_ac97_update
)paren
suffix:semicolon
DECL|variable|snd_ac97_update_bits
id|EXPORT_SYMBOL
c_func
(paren
id|snd_ac97_update_bits
)paren
suffix:semicolon
DECL|variable|snd_ac97_get_short_name
id|EXPORT_SYMBOL
c_func
(paren
id|snd_ac97_get_short_name
)paren
suffix:semicolon
DECL|variable|snd_ac97_bus
id|EXPORT_SYMBOL
c_func
(paren
id|snd_ac97_bus
)paren
suffix:semicolon
DECL|variable|snd_ac97_mixer
id|EXPORT_SYMBOL
c_func
(paren
id|snd_ac97_mixer
)paren
suffix:semicolon
DECL|variable|snd_ac97_pcm_assign
id|EXPORT_SYMBOL
c_func
(paren
id|snd_ac97_pcm_assign
)paren
suffix:semicolon
DECL|variable|snd_ac97_pcm_open
id|EXPORT_SYMBOL
c_func
(paren
id|snd_ac97_pcm_open
)paren
suffix:semicolon
DECL|variable|snd_ac97_pcm_close
id|EXPORT_SYMBOL
c_func
(paren
id|snd_ac97_pcm_close
)paren
suffix:semicolon
DECL|variable|snd_ac97_pcm_double_rate_rules
id|EXPORT_SYMBOL
c_func
(paren
id|snd_ac97_pcm_double_rate_rules
)paren
suffix:semicolon
DECL|variable|snd_ac97_tune_hardware
id|EXPORT_SYMBOL
c_func
(paren
id|snd_ac97_tune_hardware
)paren
suffix:semicolon
DECL|variable|snd_ac97_set_rate
id|EXPORT_SYMBOL
c_func
(paren
id|snd_ac97_set_rate
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PM
DECL|variable|snd_ac97_resume
id|EXPORT_SYMBOL
c_func
(paren
id|snd_ac97_resume
)paren
suffix:semicolon
DECL|variable|snd_ac97_suspend
id|EXPORT_SYMBOL
c_func
(paren
id|snd_ac97_suspend
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; *  INIT part&n; */
DECL|function|alsa_ac97_init
r_static
r_int
id|__init
id|alsa_ac97_init
c_func
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|alsa_ac97_exit
r_static
r_void
id|__exit
id|alsa_ac97_exit
c_func
(paren
r_void
)paren
(brace
)brace
id|module_init
c_func
(paren
id|alsa_ac97_init
)paren
id|module_exit
c_func
(paren
id|alsa_ac97_exit
)paren
eof
