multiline_comment|/*&n; * usbusy2y.c - ALSA USB US-428 Driver&n; *&n;2004-10-26 Karsten Wiese&n;&t;Version 0.8.6:&n;&t;wake_up() process waiting in usX2Y_urbs_start() on error.&n;&n;2004-10-21 Karsten Wiese&n;&t;Version 0.8.5:&n;&t;nrpacks is runtime or compiletime configurable now with tested values from 1 to 4.&n;&n;2004-10-03 Karsten Wiese&n;&t;Version 0.8.2:&n;&t;Avoid any possible racing while in prepare callback.&n;&n;2004-09-30 Karsten Wiese&n;&t;Version 0.8.0:&n;&t;Simplified things and made ohci work again.&n;&n;2004-09-20 Karsten Wiese&n;&t;Version 0.7.3:&n;&t;Use usb_kill_urb() instead of deprecated (kernel 2.6.9) usb_unlink_urb().&n;&n;2004-07-13 Karsten Wiese&n;&t;Version 0.7.1:&n;&t;Don&squot;t sleep in START/STOP callbacks anymore.&n;&t;us428 channels C/D not handled just for this version, sorry.&n;&n;2004-06-21 Karsten Wiese&n;&t;Version 0.6.4:&n;&t;Temporarely suspend midi input&n;&t;to sanely call usb_set_interface() when setting format.&n;&n;2004-06-12 Karsten Wiese&n;&t;Version 0.6.3:&n;&t;Made it thus the following rule is enforced:&n;&t;&quot;All pcm substreams of one usX2Y have to operate at the same rate &amp; format.&quot;&n;&n;2004-04-06 Karsten Wiese&n;&t;Version 0.6.0:&n;&t;Runs on 2.6.5 kernel without any &quot;--with-debug=&quot; things.&n;&t;us224 reported running.&n;&n;2004-01-14 Karsten Wiese&n;&t;Version 0.5.1:&n;&t;Runs with 2.6.1 kernel.&n;&n;2003-12-30 Karsten Wiese&n;&t;Version 0.4.1:&n;&t;Fix 24Bit 4Channel capturing for the us428.&n;&n;2003-11-27 Karsten Wiese, Martin Langer&n;&t;Version 0.4:&n;&t;us122 support.&n;&t;us224 could be tested by uncommenting the sections containing USB_ID_US224&n;&n;2003-11-03 Karsten Wiese&n;&t;Version 0.3:&n;&t;24Bit support. &n;&t;&quot;arecord -D hw:1 -c 2 -r 48000 -M -f S24_3LE|aplay -D hw:1 -c 2 -r 48000 -M -f S24_3LE&quot; works.&n;&n;2003-08-22 Karsten Wiese&n;&t;Version 0.0.8:&n;&t;Removed EZUSB Firmware. First Stage Firmwaredownload is now done by tascam-firmware downloader.&n;&t;See:&n;&t;http://usb-midi-fw.sourceforge.net/tascam-firmware.tar.gz&n;&n;2003-06-18 Karsten Wiese&n;&t;Version 0.0.5:&n;&t;changed to compile with kernel 2.4.21 and alsa 0.9.4&n;&n;2002-10-16 Karsten Wiese&n;&t;Version 0.0.4:&n;&t;compiles again with alsa-current.&n;&t;USB_ISO_ASAP not used anymore (most of the time), instead&n;&t;urb-&gt;start_frame is calculated here now, some calls inside usb-driver don&squot;t need to happen anymore.&n;&n;&t;To get the best out of this:&n;&t;Disable APM-support in the kernel as APM-BIOS calls (once each second) hard disable interrupt for many precious milliseconds.&n;&t;This helped me much on my slowish PII 400 &amp; PIII 500.&n;&t;ACPI yet untested but might cause the same bad behaviour.&n;&t;Use a kernel with lowlatency and preemptiv patches applied.&n;&t;To autoload snd-usb-midi append a line &n;&t;&t;post-install snd-usb-us428 modprobe snd-usb-midi&n;&t;to /etc/modules.conf.&n;&n;&t;known problems:&n;&t;sliders, knobs, lights not yet handled except MASTER Volume slider.&n;       &t;&quot;pcm -c 2&quot; doesn&squot;t work. &quot;pcm -c 2 -m direct_interleaved&quot; does.&n;&t;KDE3: &quot;Enable full duplex operation&quot; deadlocks.&n;&n;&t;&n;2002-08-31 Karsten Wiese&n;&t;Version 0.0.3: audio also simplex;&n;&t;simplifying: iso urbs only 1 packet, melted structs.&n;&t;ASYNC_UNLINK not used anymore: no more crashes so far.....&n;&t;for alsa 0.9 rc3.&n;&n;2002-08-09 Karsten Wiese&n;&t;Version 0.0.2: midi works with snd-usb-midi, audio (only fullduplex now) with i.e. bristol.&n;&t;The firmware has been sniffed from win2k us-428 driver 3.09.&n;&n; *   Copyright (c) 2002 - 2004 Karsten Wiese&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n;*/
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/usb.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/initval.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
macro_line|#include &lt;sound/rawmidi.h&gt;
macro_line|#include &quot;usx2y.h&quot;
macro_line|#include &quot;usbusx2y.h&quot;
macro_line|#include &quot;usX2Yhwdep.h&quot;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Karsten Wiese &lt;annabellesgarden@yahoo.de&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;TASCAM &quot;
id|NAME_ALLCAPS
l_string|&quot; Version 0.8.6&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_SUPPORTED_DEVICE
c_func
(paren
l_string|&quot;{{TASCAM(0x1604), &quot;
id|NAME_ALLCAPS
l_string|&quot;(0x8001)(0x8005)(0x8007) }}&quot;
)paren
suffix:semicolon
DECL|variable|index
r_static
r_int
id|index
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_IDX
suffix:semicolon
multiline_comment|/* Index 0-max */
DECL|variable|id
r_static
r_char
op_star
id|id
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_STR
suffix:semicolon
multiline_comment|/* Id for this card */
DECL|variable|enable
r_static
r_int
id|enable
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_ENABLE_PNP
suffix:semicolon
multiline_comment|/* Enable this card */
id|module_param_array
c_func
(paren
id|index
comma
r_int
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|index
comma
l_string|&quot;Index value for &quot;
id|NAME_ALLCAPS
l_string|&quot;.&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|id
comma
id|charp
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|id
comma
l_string|&quot;ID string for &quot;
id|NAME_ALLCAPS
l_string|&quot;.&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|enable
comma
r_bool
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|enable
comma
l_string|&quot;Enable &quot;
id|NAME_ALLCAPS
l_string|&quot;.&quot;
)paren
suffix:semicolon
DECL|variable|snd_usX2Y_card_used
r_static
r_int
id|snd_usX2Y_card_used
(braket
id|SNDRV_CARDS
)braket
suffix:semicolon
r_static
r_void
id|usX2Y_usb_disconnect
c_func
(paren
r_struct
id|usb_device
op_star
id|usb_device
comma
r_void
op_star
id|ptr
)paren
suffix:semicolon
r_static
r_void
id|snd_usX2Y_card_private_free
c_func
(paren
id|snd_card_t
op_star
id|card
)paren
suffix:semicolon
multiline_comment|/* &n; * pipe 4 is used for switching the lamps, setting samplerate, volumes ....   &n; */
DECL|function|i_usX2Y_Out04Int
r_static
r_void
id|i_usX2Y_Out04Int
c_func
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
macro_line|#ifdef CONFIG_SND_DEBUG
r_if
c_cond
(paren
id|urb-&gt;status
)paren
(brace
r_int
id|i
suffix:semicolon
id|usX2Ydev_t
op_star
id|usX2Y
op_assign
id|urb-&gt;context
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
op_logical_and
id|usX2Y-&gt;AS04.urb
(braket
id|i
)braket
op_ne
id|urb
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
id|snd_printdd
c_func
(paren
l_string|&quot;i_usX2Y_Out04Int() urb %i status=%i&bslash;n&quot;
comma
id|i
comma
id|urb-&gt;status
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
DECL|function|i_usX2Y_In04Int
r_static
r_void
id|i_usX2Y_In04Int
c_func
(paren
r_struct
id|urb
op_star
id|urb
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|usX2Ydev_t
op_star
id|usX2Y
op_assign
id|urb-&gt;context
suffix:semicolon
id|us428ctls_sharedmem_t
op_star
id|us428ctls
op_assign
id|usX2Y-&gt;us428ctls_sharedmem
suffix:semicolon
id|usX2Y-&gt;In04IntCalls
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
)paren
(brace
id|snd_printdd
c_func
(paren
l_string|&quot;Interrupt Pipe 4 came back with status=%i&bslash;n&quot;
comma
id|urb-&gt;status
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
singleline_comment|//&t;printk(&quot;%i:0x%02X &quot;, 8, (int)((unsigned char*)usX2Y-&gt;In04Buf)[8]); Master volume shows 0 here if fader is at max during boot ?!?
r_if
c_cond
(paren
id|us428ctls
)paren
(brace
r_int
id|diff
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_minus
l_int|2
op_eq
id|us428ctls-&gt;CtlSnapShotLast
)paren
(brace
id|diff
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|usX2Y-&gt;In04Last
comma
id|usX2Y-&gt;In04Buf
comma
r_sizeof
(paren
id|usX2Y-&gt;In04Last
)paren
)paren
suffix:semicolon
id|us428ctls-&gt;CtlSnapShotLast
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|21
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|usX2Y-&gt;In04Last
(braket
id|i
)braket
op_ne
(paren
(paren
r_char
op_star
)paren
id|usX2Y-&gt;In04Buf
)paren
(braket
id|i
)braket
)paren
(brace
r_if
c_cond
(paren
id|diff
OL
l_int|0
)paren
id|diff
op_assign
id|i
suffix:semicolon
id|usX2Y-&gt;In04Last
(braket
id|i
)braket
op_assign
(paren
(paren
r_char
op_star
)paren
id|usX2Y-&gt;In04Buf
)paren
(braket
id|i
)braket
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
l_int|0
op_le
id|diff
)paren
(brace
r_int
id|n
op_assign
id|us428ctls-&gt;CtlSnapShotLast
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|n
op_ge
id|N_us428_ctl_BUFS
op_logical_or
id|n
OL
l_int|0
)paren
id|n
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|us428ctls-&gt;CtlSnapShot
op_plus
id|n
comma
id|usX2Y-&gt;In04Buf
comma
r_sizeof
(paren
id|us428ctls-&gt;CtlSnapShot
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|us428ctls-&gt;CtlSnapShotDiffersAt
(braket
id|n
)braket
op_assign
id|diff
suffix:semicolon
id|us428ctls-&gt;CtlSnapShotLast
op_assign
id|n
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|usX2Y-&gt;us428ctls_wait_queue_head
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|usX2Y-&gt;US04
)paren
(brace
r_if
c_cond
(paren
l_int|0
op_eq
id|usX2Y-&gt;US04-&gt;submitted
)paren
r_do
id|err
op_assign
id|usb_submit_urb
c_func
(paren
id|usX2Y-&gt;US04-&gt;urb
(braket
id|usX2Y-&gt;US04-&gt;submitted
op_increment
)braket
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|err
op_logical_and
id|usX2Y-&gt;US04-&gt;submitted
OL
id|usX2Y-&gt;US04-&gt;len
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|us428ctls
op_logical_and
id|us428ctls-&gt;p4outLast
op_ge
l_int|0
op_logical_and
id|us428ctls-&gt;p4outLast
OL
id|N_us428_p4out_BUFS
)paren
(brace
r_if
c_cond
(paren
id|us428ctls-&gt;p4outLast
op_ne
id|us428ctls-&gt;p4outSent
)paren
(brace
r_int
id|j
comma
id|send
op_assign
id|us428ctls-&gt;p4outSent
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|send
op_ge
id|N_us428_p4out_BUFS
)paren
id|send
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|URBS_AsyncSeq
op_logical_and
op_logical_neg
id|err
suffix:semicolon
op_increment
id|j
)paren
r_if
c_cond
(paren
l_int|0
op_eq
id|usX2Y-&gt;AS04.urb
(braket
id|j
)braket
op_member_access_from_pointer
id|status
)paren
(brace
id|us428_p4out_t
op_star
id|p4out
op_assign
id|us428ctls-&gt;p4out
op_plus
id|send
suffix:semicolon
singleline_comment|// FIXME if more then 1 p4out is new, 1 gets lost.
id|usb_fill_bulk_urb
c_func
(paren
id|usX2Y-&gt;AS04.urb
(braket
id|j
)braket
comma
id|usX2Y-&gt;chip.dev
comma
id|usb_sndbulkpipe
c_func
(paren
id|usX2Y-&gt;chip.dev
comma
l_int|0x04
)paren
comma
op_amp
id|p4out-&gt;val.vol
comma
id|p4out-&gt;type
op_eq
id|eLT_Light
ques
c_cond
r_sizeof
(paren
id|us428_lights_t
)paren
suffix:colon
l_int|5
comma
id|i_usX2Y_Out04Int
comma
id|usX2Y
)paren
suffix:semicolon
id|err
op_assign
id|usb_submit_urb
c_func
(paren
id|usX2Y-&gt;AS04.urb
(braket
id|j
)braket
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|us428ctls-&gt;p4outSent
op_assign
id|send
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|err
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;In04Int() usb_submit_urb err=%i&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
)brace
id|urb-&gt;dev
op_assign
id|usX2Y-&gt;chip.dev
suffix:semicolon
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Prepare some urbs&n; */
DECL|function|usX2Y_AsyncSeq04_init
r_int
id|usX2Y_AsyncSeq04_init
c_func
(paren
id|usX2Ydev_t
op_star
id|usX2Y
)paren
(brace
r_int
id|err
op_assign
l_int|0
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
(paren
id|usX2Y-&gt;AS04.buffer
op_assign
id|kmalloc
c_func
(paren
id|URB_DataLen_AsyncSeq
op_star
id|URBS_AsyncSeq
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_else
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|URBS_AsyncSeq
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
l_int|NULL
op_eq
(paren
id|usX2Y-&gt;AS04.urb
(braket
id|i
)braket
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_break
suffix:semicolon
)brace
id|usb_fill_bulk_urb
c_func
(paren
id|usX2Y-&gt;AS04.urb
(braket
id|i
)braket
comma
id|usX2Y-&gt;chip.dev
comma
id|usb_sndbulkpipe
c_func
(paren
id|usX2Y-&gt;chip.dev
comma
l_int|0x04
)paren
comma
id|usX2Y-&gt;AS04.buffer
op_plus
id|URB_DataLen_AsyncSeq
op_star
id|i
comma
l_int|0
comma
id|i_usX2Y_Out04Int
comma
id|usX2Y
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|usX2Y_In04_init
r_int
id|usX2Y_In04_init
c_func
(paren
id|usX2Ydev_t
op_star
id|usX2Y
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|usX2Y-&gt;In04urb
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
comma
id|GFP_KERNEL
)paren
)paren
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|usX2Y-&gt;In04Buf
op_assign
id|kmalloc
c_func
(paren
l_int|21
comma
id|GFP_KERNEL
)paren
)paren
)paren
(brace
id|usb_free_urb
c_func
(paren
id|usX2Y-&gt;In04urb
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|init_waitqueue_head
c_func
(paren
op_amp
id|usX2Y-&gt;In04WaitQueue
)paren
suffix:semicolon
id|usb_fill_int_urb
c_func
(paren
id|usX2Y-&gt;In04urb
comma
id|usX2Y-&gt;chip.dev
comma
id|usb_rcvintpipe
c_func
(paren
id|usX2Y-&gt;chip.dev
comma
l_int|0x4
)paren
comma
id|usX2Y-&gt;In04Buf
comma
l_int|21
comma
id|i_usX2Y_In04Int
comma
id|usX2Y
comma
l_int|10
)paren
suffix:semicolon
id|err
op_assign
id|usb_submit_urb
c_func
(paren
id|usX2Y-&gt;In04urb
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|usX2Y_unlinkSeq
r_static
r_void
id|usX2Y_unlinkSeq
c_func
(paren
id|snd_usX2Y_AsyncSeq_t
op_star
id|S
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|URBS_AsyncSeq
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
id|S
(braket
id|i
)braket
dot
id|urb
)paren
(brace
id|usb_kill_urb
c_func
(paren
id|S-&gt;urb
(braket
id|i
)braket
)paren
suffix:semicolon
id|usb_free_urb
c_func
(paren
id|S-&gt;urb
(braket
id|i
)braket
)paren
suffix:semicolon
id|S-&gt;urb
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|S-&gt;buffer
)paren
id|kfree
c_func
(paren
id|S-&gt;buffer
)paren
suffix:semicolon
)brace
DECL|variable|snd_usX2Y_usb_id_table
r_static
r_struct
id|usb_device_id
id|snd_usX2Y_usb_id_table
(braket
)braket
op_assign
(brace
(brace
dot
id|match_flags
op_assign
id|USB_DEVICE_ID_MATCH_DEVICE
comma
dot
id|idVendor
op_assign
l_int|0x1604
comma
dot
id|idProduct
op_assign
id|USB_ID_US428
)brace
comma
(brace
dot
id|match_flags
op_assign
id|USB_DEVICE_ID_MATCH_DEVICE
comma
dot
id|idVendor
op_assign
l_int|0x1604
comma
dot
id|idProduct
op_assign
id|USB_ID_US122
)brace
comma
(brace
dot
id|match_flags
op_assign
id|USB_DEVICE_ID_MATCH_DEVICE
comma
dot
id|idVendor
op_assign
l_int|0x1604
comma
dot
id|idProduct
op_assign
id|USB_ID_US224
)brace
comma
(brace
multiline_comment|/* terminator */
)brace
)brace
suffix:semicolon
DECL|function|usX2Y_create_card
r_static
id|snd_card_t
op_star
id|usX2Y_create_card
c_func
(paren
r_struct
id|usb_device
op_star
id|device
)paren
(brace
r_int
id|dev
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
r_for
c_loop
(paren
id|dev
op_assign
l_int|0
suffix:semicolon
id|dev
OL
id|SNDRV_CARDS
suffix:semicolon
op_increment
id|dev
)paren
r_if
c_cond
(paren
id|enable
(braket
id|dev
)braket
op_logical_and
op_logical_neg
id|snd_usX2Y_card_used
(braket
id|dev
)braket
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_ge
id|SNDRV_CARDS
)paren
r_return
l_int|NULL
suffix:semicolon
id|card
op_assign
id|snd_card_new
c_func
(paren
id|index
(braket
id|dev
)braket
comma
id|id
(braket
id|dev
)braket
comma
id|THIS_MODULE
comma
r_sizeof
(paren
id|usX2Ydev_t
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
)paren
r_return
l_int|NULL
suffix:semicolon
id|snd_usX2Y_card_used
(braket
id|usX2Y
c_func
(paren
id|card
)paren
op_member_access_from_pointer
id|chip.index
op_assign
id|dev
)braket
op_assign
l_int|1
suffix:semicolon
id|card-&gt;private_free
op_assign
id|snd_usX2Y_card_private_free
suffix:semicolon
id|usX2Y
c_func
(paren
id|card
)paren
op_member_access_from_pointer
id|chip.dev
op_assign
id|device
suffix:semicolon
id|usX2Y
c_func
(paren
id|card
)paren
op_member_access_from_pointer
id|chip.card
op_assign
id|card
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|usX2Y
c_func
(paren
id|card
)paren
op_member_access_from_pointer
id|prepare_wait_queue
)paren
suffix:semicolon
id|init_MUTEX
(paren
op_amp
id|usX2Y
c_func
(paren
id|card
)paren
op_member_access_from_pointer
id|prepare_mutex
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|usX2Y
c_func
(paren
id|card
)paren
op_member_access_from_pointer
id|chip.midi_list
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;USB &quot;
id|NAME_ALLCAPS
l_string|&quot;&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;shortname
comma
l_string|&quot;TASCAM &quot;
id|NAME_ALLCAPS
l_string|&quot;&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;%s (%x:%x if %d at %03d/%03d)&quot;
comma
id|card-&gt;shortname
comma
id|device-&gt;descriptor.idVendor
comma
id|device-&gt;descriptor.idProduct
comma
l_int|0
comma
singleline_comment|//us428(card)-&gt;usbmidi.ifnum,
id|usX2Y
c_func
(paren
id|card
)paren
op_member_access_from_pointer
id|chip.dev-&gt;bus-&gt;busnum
comma
id|usX2Y
c_func
(paren
id|card
)paren
op_member_access_from_pointer
id|chip.dev-&gt;devnum
)paren
suffix:semicolon
id|snd_card_set_dev
c_func
(paren
id|card
comma
op_amp
id|device-&gt;dev
)paren
suffix:semicolon
r_return
id|card
suffix:semicolon
)brace
DECL|function|usX2Y_usb_probe
r_static
r_void
op_star
id|usX2Y_usb_probe
c_func
(paren
r_struct
id|usb_device
op_star
id|device
comma
r_struct
id|usb_interface
op_star
id|intf
comma
r_const
r_struct
id|usb_device_id
op_star
id|device_id
)paren
(brace
r_int
id|err
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
r_if
c_cond
(paren
id|device-&gt;descriptor.idVendor
op_ne
l_int|0x1604
op_logical_or
(paren
id|device-&gt;descriptor.idProduct
op_ne
id|USB_ID_US122
op_logical_and
id|device-&gt;descriptor.idProduct
op_ne
id|USB_ID_US224
op_logical_and
id|device-&gt;descriptor.idProduct
op_ne
id|USB_ID_US428
)paren
op_logical_or
op_logical_neg
(paren
id|card
op_assign
id|usX2Y_create_card
c_func
(paren
id|device
)paren
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|usX2Y_hwdep_new
c_func
(paren
id|card
comma
id|device
)paren
)paren
OL
l_int|0
op_logical_or
(paren
id|err
op_assign
id|snd_card_register
c_func
(paren
id|card
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_return
id|card
suffix:semicolon
)brace
multiline_comment|/*&n; * new 2.5 USB kernel API&n; */
DECL|function|snd_usX2Y_probe
r_static
r_int
id|snd_usX2Y_probe
c_func
(paren
r_struct
id|usb_interface
op_star
id|intf
comma
r_const
r_struct
id|usb_device_id
op_star
id|id
)paren
(brace
r_void
op_star
id|chip
suffix:semicolon
id|chip
op_assign
id|usX2Y_usb_probe
c_func
(paren
id|interface_to_usbdev
c_func
(paren
id|intf
)paren
comma
id|intf
comma
id|id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip
)paren
(brace
id|dev_set_drvdata
c_func
(paren
op_amp
id|intf-&gt;dev
comma
id|chip
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|snd_usX2Y_disconnect
r_static
r_void
id|snd_usX2Y_disconnect
c_func
(paren
r_struct
id|usb_interface
op_star
id|intf
)paren
(brace
id|usX2Y_usb_disconnect
c_func
(paren
id|interface_to_usbdev
c_func
(paren
id|intf
)paren
comma
id|dev_get_drvdata
c_func
(paren
op_amp
id|intf-&gt;dev
)paren
)paren
suffix:semicolon
)brace
id|MODULE_DEVICE_TABLE
c_func
(paren
id|usb
comma
id|snd_usX2Y_usb_id_table
)paren
suffix:semicolon
DECL|variable|snd_usX2Y_usb_driver
r_static
r_struct
id|usb_driver
id|snd_usX2Y_usb_driver
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|name
op_assign
l_string|&quot;snd-usb-usx2y&quot;
comma
dot
id|probe
op_assign
id|snd_usX2Y_probe
comma
dot
id|disconnect
op_assign
id|snd_usX2Y_disconnect
comma
dot
id|id_table
op_assign
id|snd_usX2Y_usb_id_table
comma
)brace
suffix:semicolon
DECL|function|snd_usX2Y_card_private_free
r_static
r_void
id|snd_usX2Y_card_private_free
c_func
(paren
id|snd_card_t
op_star
id|card
)paren
(brace
r_if
c_cond
(paren
id|usX2Y
c_func
(paren
id|card
)paren
op_member_access_from_pointer
id|In04Buf
)paren
id|kfree
c_func
(paren
id|usX2Y
c_func
(paren
id|card
)paren
op_member_access_from_pointer
id|In04Buf
)paren
suffix:semicolon
id|usb_free_urb
c_func
(paren
id|usX2Y
c_func
(paren
id|card
)paren
op_member_access_from_pointer
id|In04urb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usX2Y
c_func
(paren
id|card
)paren
op_member_access_from_pointer
id|us428ctls_sharedmem
)paren
id|snd_free_pages
c_func
(paren
id|usX2Y
c_func
(paren
id|card
)paren
op_member_access_from_pointer
id|us428ctls_sharedmem
comma
r_sizeof
(paren
op_star
id|usX2Y
c_func
(paren
id|card
)paren
op_member_access_from_pointer
id|us428ctls_sharedmem
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usX2Y
c_func
(paren
id|card
)paren
op_member_access_from_pointer
id|chip.index
op_ge
l_int|0
op_logical_and
id|usX2Y
c_func
(paren
id|card
)paren
op_member_access_from_pointer
id|chip.index
OL
id|SNDRV_CARDS
)paren
id|snd_usX2Y_card_used
(braket
id|usX2Y
c_func
(paren
id|card
)paren
op_member_access_from_pointer
id|chip.index
)braket
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Frees the device.&n; */
DECL|function|usX2Y_usb_disconnect
r_static
r_void
id|usX2Y_usb_disconnect
c_func
(paren
r_struct
id|usb_device
op_star
id|device
comma
r_void
op_star
id|ptr
)paren
(brace
r_if
c_cond
(paren
id|ptr
)paren
(brace
id|usX2Ydev_t
op_star
id|usX2Y
op_assign
id|usX2Y
c_func
(paren
(paren
id|snd_card_t
op_star
)paren
id|ptr
)paren
suffix:semicolon
r_struct
id|list_head
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|usX2Y-&gt;chip_status
op_eq
id|USX2Y_STAT_CHIP_HUP
)paren
singleline_comment|// on 2.6.1 kernel snd_usbmidi_disconnect()
r_return
suffix:semicolon
singleline_comment|// calls us back. better leave :-) .
id|usX2Y-&gt;chip.shutdown
op_assign
l_int|1
suffix:semicolon
id|usX2Y-&gt;chip_status
op_assign
id|USX2Y_STAT_CHIP_HUP
suffix:semicolon
id|usX2Y_unlinkSeq
c_func
(paren
op_amp
id|usX2Y-&gt;AS04
)paren
suffix:semicolon
id|usb_kill_urb
c_func
(paren
id|usX2Y-&gt;In04urb
)paren
suffix:semicolon
id|snd_card_disconnect
c_func
(paren
(paren
id|snd_card_t
op_star
)paren
id|ptr
)paren
suffix:semicolon
multiline_comment|/* release the midi resources */
id|list_for_each
c_func
(paren
id|p
comma
op_amp
id|usX2Y-&gt;chip.midi_list
)paren
(brace
id|snd_usbmidi_disconnect
c_func
(paren
id|p
comma
op_amp
id|snd_usX2Y_usb_driver
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|usX2Y-&gt;us428ctls_sharedmem
)paren
id|wake_up
c_func
(paren
op_amp
id|usX2Y-&gt;us428ctls_wait_queue_head
)paren
suffix:semicolon
id|snd_card_free_in_thread
c_func
(paren
(paren
id|snd_card_t
op_star
)paren
id|ptr
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_usX2Y_module_init
r_static
r_int
id|__init
id|snd_usX2Y_module_init
c_func
(paren
r_void
)paren
(brace
r_return
id|usb_register
c_func
(paren
op_amp
id|snd_usX2Y_usb_driver
)paren
suffix:semicolon
)brace
DECL|function|snd_usX2Y_module_exit
r_static
r_void
id|__exit
id|snd_usX2Y_module_exit
c_func
(paren
r_void
)paren
(brace
id|usb_deregister
c_func
(paren
op_amp
id|snd_usX2Y_usb_driver
)paren
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|snd_usX2Y_module_init
)paren
id|module_exit
c_func
(paren
id|snd_usX2Y_module_exit
)paren
eof
