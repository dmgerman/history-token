multiline_comment|/*&n; * usbmidi.c - ALSA USB MIDI driver&n; *&n; * Copyright (c) 2002 Clemens Ladisch&n; * All rights reserved.&n; *&n; * Redistribution and use in source and binary forms, with or without&n; * modification, are permitted provided that the following conditions&n; * are met:&n; * 1. Redistributions of source code must retain the above copyright&n; *    notice, this list of conditions, and the following disclaimer,&n; *    without modification.&n; * 2. The name of the author may not be used to endorse or promote products&n; *    derived from this software without specific prior written permission.&n; *&n; * Alternatively, this software may be distributed and/or modified under the&n; * terms of the GNU General Public License as published by the Free Software&n; * Foundation; either version 2 of the License, or (at your option) any later&n; * version.&n; *&n; * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS&squot;&squot; AND&n; * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE&n; * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE&n; * ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE FOR&n; * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL&n; * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS&n; * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)&n; * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT&n; * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY&n; * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF&n; * SUCH DAMAGE.&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/usb.h&gt;
macro_line|#include &lt;asm/semaphore.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/minors.h&gt;
macro_line|#include &lt;sound/asequencer.h&gt;
macro_line|#include &lt;sound/seq_device.h&gt;
macro_line|#include &lt;sound/seq_kernel.h&gt;
macro_line|#include &lt;sound/seq_virmidi.h&gt;
macro_line|#include &lt;sound/seq_midi_event.h&gt;
DECL|macro|SNDRV_GET_ID
mdefine_line|#define SNDRV_GET_ID
macro_line|#include &lt;sound/initval.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Clemens Ladisch &lt;clemens@ladisch.de&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;USB MIDI&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;Dual BSD/GPL&quot;
)paren
suffix:semicolon
id|MODULE_CLASSES
c_func
(paren
l_string|&quot;{sound}&quot;
)paren
suffix:semicolon
id|MODULE_DEVICES
c_func
(paren
l_string|&quot;{{Generic,USB MIDI},&quot;
l_string|&quot;{Roland/EDIROL,PC-300},&quot;
l_string|&quot;{Roland/EDIROL,SC-8820},&quot;
l_string|&quot;{Roland/EDIROL,SC-8850},&quot;
l_string|&quot;{Roland/EDIROL,SC-D70},&quot;
l_string|&quot;{Roland/EDIROL,SD-20},&quot;
l_string|&quot;{Roland/EDIROL,SD-80},&quot;
l_string|&quot;{Roland/EDIROL,SD-90},&quot;
l_string|&quot;{Roland/EDIROL,SK-500},&quot;
l_string|&quot;{Roland/EDIROL,U-8},&quot;
l_string|&quot;{Roland/EDIROL,UA-100(G)},&quot;
l_string|&quot;{Roland/EDIROL,UA-700},&quot;
l_string|&quot;{Roland/EDIROL,UM-1(S)},&quot;
l_string|&quot;{Roland/EDIROL,UM-2(E)},&quot;
l_string|&quot;{Roland/EDIROL,UM-4},&quot;
l_string|&quot;{Roland/EDIROL,UM-550},&quot;
l_string|&quot;{Roland/EDIROL,UM-880},&quot;
l_string|&quot;{Roland/EDIROL,XV-5050},&quot;
l_string|&quot;{Yamaha,MU1000},&quot;
l_string|&quot;{Yamaha,UX256}}&quot;
)paren
suffix:semicolon
DECL|variable|snd_index
r_static
r_int
id|snd_index
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_IDX
suffix:semicolon
multiline_comment|/* Index 0-max */
DECL|variable|snd_id
r_static
r_char
op_star
id|snd_id
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_STR
suffix:semicolon
multiline_comment|/* Id for this card */
DECL|variable|snd_enable
r_static
r_int
id|snd_enable
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_ENABLE_PNP
suffix:semicolon
multiline_comment|/* Enable this card */
DECL|variable|snd_vid
r_static
r_int
id|snd_vid
(braket
id|SNDRV_CARDS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
(paren
id|SNDRV_CARDS
op_minus
l_int|1
)paren
)braket
op_assign
op_minus
l_int|1
)brace
suffix:semicolon
multiline_comment|/* Vendor id of this card */
DECL|variable|snd_pid
r_static
r_int
id|snd_pid
(braket
id|SNDRV_CARDS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
(paren
id|SNDRV_CARDS
op_minus
l_int|1
)paren
)braket
op_assign
op_minus
l_int|1
)brace
suffix:semicolon
multiline_comment|/* Product id of this card */
DECL|variable|snd_int_transfer
r_static
r_int
id|snd_int_transfer
(braket
id|SNDRV_CARDS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
(paren
id|SNDRV_CARDS
op_minus
l_int|1
)paren
)braket
op_assign
l_int|0
)brace
suffix:semicolon
multiline_comment|/* Use interrupt transfers for this card */
id|MODULE_PARM
c_func
(paren
id|snd_index
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_index
comma
l_string|&quot;Index value for USB MIDI.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_index
comma
id|SNDRV_INDEX_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_id
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_id
comma
l_string|&quot;ID string for USB MIDI.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_id
comma
id|SNDRV_ID_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_enable
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_enable
comma
l_string|&quot;Enable USB MIDI.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_enable
comma
id|SNDRV_ENABLE_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_vid
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_vid
comma
l_string|&quot;USB Vendor ID for USB MIDI.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_vid
comma
id|SNDRV_ENABLED
l_string|&quot;,allows:{{-1,0xffff}},base:16&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_pid
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_pid
comma
l_string|&quot;USB Product ID for USB MIDI.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_pid
comma
id|SNDRV_ENABLED
l_string|&quot;,allows:{{-1,0xffff}},base:16&quot;
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|snd_int_transfer
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|snd_int_transfer
comma
l_string|&quot;Use interrupt transfers for USB MIDI input.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|snd_int_transfer
comma
id|SNDRV_ENABLED
l_string|&quot;,&quot;
id|SNDRV_BOOLEAN_FALSE_DESC
l_string|&quot;,skill:advanced&quot;
)paren
suffix:semicolon
multiline_comment|/* size of the per-endpoint output buffer, must be a multiple of 4 */
DECL|macro|OUTPUT_BUFFER_SIZE
mdefine_line|#define OUTPUT_BUFFER_SIZE 0x400
multiline_comment|/* max. size of incoming sysex messages */
DECL|macro|INPUT_BUFFER_SIZE
mdefine_line|#define INPUT_BUFFER_SIZE 0x200
DECL|macro|MAX_ENDPOINTS
mdefine_line|#define MAX_ENDPOINTS 2
DECL|macro|SNDRV_SEQ_DEV_ID_USBMIDI
mdefine_line|#define SNDRV_SEQ_DEV_ID_USBMIDI &quot;usb-midi&quot;
macro_line|#ifndef USB_SUBCLASS_MIDISTREAMING
DECL|macro|USB_SUBCLASS_MIDISTREAMING
mdefine_line|#define USB_SUBCLASS_MIDISTREAMING 3
macro_line|#endif
macro_line|#ifndef USB_DT_CS_INTERFACE
DECL|macro|USB_DT_CS_INTERFACE
mdefine_line|#define USB_DT_CS_INTERFACE (USB_TYPE_CLASS | USB_DT_INTERFACE)
DECL|macro|USB_DT_CS_ENDPOINT
mdefine_line|#define USB_DT_CS_ENDPOINT (USB_TYPE_CLASS | USB_DT_ENDPOINT)
macro_line|#endif
macro_line|#ifndef USB_DST_MS_HEADER
DECL|macro|USB_DST_MS_HEADER
mdefine_line|#define USB_DST_MS_HEADER 0x01
DECL|macro|USB_DST_MS_GENERAL
mdefine_line|#define USB_DST_MS_GENERAL 0x01
DECL|macro|USB_DST_MS_HEADER_SIZE
mdefine_line|#define USB_DST_MS_HEADER_SIZE 7
DECL|macro|USB_DST_MS_GENERAL_SIZE
mdefine_line|#define USB_DST_MS_GENERAL_SIZE 4
macro_line|#endif
DECL|typedef|usb_driver_t
r_typedef
r_struct
id|usb_driver
id|usb_driver_t
suffix:semicolon
DECL|typedef|usb_device_t
r_typedef
r_struct
id|usb_device
id|usb_device_t
suffix:semicolon
DECL|typedef|usb_device_id_t
r_typedef
r_struct
id|usb_device_id
id|usb_device_id_t
suffix:semicolon
DECL|typedef|usb_interface_t
r_typedef
r_struct
id|usb_interface
id|usb_interface_t
suffix:semicolon
DECL|typedef|usb_interface_descriptor_t
r_typedef
r_struct
id|usb_interface_descriptor
id|usb_interface_descriptor_t
suffix:semicolon
DECL|typedef|usb_ms_header_descriptor_t
r_typedef
r_struct
id|usb_ms_header_descriptor
id|usb_ms_header_descriptor_t
suffix:semicolon
DECL|typedef|usb_endpoint_descriptor_t
r_typedef
r_struct
id|usb_endpoint_descriptor
id|usb_endpoint_descriptor_t
suffix:semicolon
DECL|typedef|usb_ms_endpoint_descriptor_t
r_typedef
r_struct
id|usb_ms_endpoint_descriptor
id|usb_ms_endpoint_descriptor_t
suffix:semicolon
DECL|struct|usb_ms_header_descriptor
r_struct
id|usb_ms_header_descriptor
(brace
DECL|member|bLength
id|__u8
id|bLength
suffix:semicolon
DECL|member|bDescriptorType
id|__u8
id|bDescriptorType
suffix:semicolon
DECL|member|bDescriptorSubtype
id|__u8
id|bDescriptorSubtype
suffix:semicolon
DECL|member|bcdMSC
id|__u8
id|bcdMSC
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|wTotalLength
id|__u16
id|wTotalLength
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|struct|usb_ms_endpoint_descriptor
r_struct
id|usb_ms_endpoint_descriptor
(brace
DECL|member|bLength
id|__u8
id|bLength
suffix:semicolon
DECL|member|bDescriptorType
id|__u8
id|bDescriptorType
suffix:semicolon
DECL|member|bDescriptorSubtype
id|__u8
id|bDescriptorSubtype
suffix:semicolon
DECL|member|bNumEmbMIDIJack
id|__u8
id|bNumEmbMIDIJack
suffix:semicolon
DECL|member|baAssocJackID
id|__u8
id|baAssocJackID
(braket
l_int|0
)braket
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|typedef|usbmidi_t
r_typedef
r_struct
id|usbmidi
id|usbmidi_t
suffix:semicolon
DECL|typedef|usbmidi_device_info_t
r_typedef
r_struct
id|usbmidi_device_info
id|usbmidi_device_info_t
suffix:semicolon
DECL|typedef|usbmidi_endpoint_info_t
r_typedef
r_struct
id|usbmidi_endpoint_info
id|usbmidi_endpoint_info_t
suffix:semicolon
DECL|typedef|usbmidi_endpoint_t
r_typedef
r_struct
id|usbmidi_endpoint
id|usbmidi_endpoint_t
suffix:semicolon
DECL|typedef|usbmidi_out_endpoint_t
r_typedef
r_struct
id|usbmidi_out_endpoint
id|usbmidi_out_endpoint_t
suffix:semicolon
DECL|typedef|usbmidi_out_port_t
r_typedef
r_struct
id|usbmidi_out_port
id|usbmidi_out_port_t
suffix:semicolon
DECL|typedef|usbmidi_in_endpoint_t
r_typedef
r_struct
id|usbmidi_in_endpoint
id|usbmidi_in_endpoint_t
suffix:semicolon
DECL|typedef|usbmidi_in_port_t
r_typedef
r_struct
id|usbmidi_in_port
id|usbmidi_in_port_t
suffix:semicolon
multiline_comment|/*&n; * Describes the capabilities of a USB MIDI device.&n; * This structure is filled after parsing the USB descriptors,&n; * or is supplied explicitly for broken devices.&n; */
DECL|struct|usbmidi_device_info
r_struct
id|usbmidi_device_info
(brace
DECL|member|vendor
r_char
id|vendor
(braket
l_int|32
)braket
suffix:semicolon
multiline_comment|/* vendor name */
DECL|member|product
r_char
id|product
(braket
l_int|32
)braket
suffix:semicolon
multiline_comment|/* device name */
DECL|member|ifnum
r_int16
id|ifnum
suffix:semicolon
multiline_comment|/* interface number */
DECL|struct|usbmidi_endpoint_info
r_struct
id|usbmidi_endpoint_info
(brace
DECL|member|epnum
r_int16
id|epnum
suffix:semicolon
multiline_comment|/* endpoint number,&n;&t;&t;&t;&t;&t;   -1: autodetect (first ep only) */
DECL|member|out_cables
r_uint16
id|out_cables
suffix:semicolon
multiline_comment|/* bitmask */
DECL|member|in_cables
r_uint16
id|in_cables
suffix:semicolon
multiline_comment|/* bitmask */
DECL|member|endpoints
)brace
id|endpoints
(braket
id|MAX_ENDPOINTS
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|usbmidi
r_struct
id|usbmidi
(brace
DECL|member|card
id|snd_card_t
op_star
id|card
suffix:semicolon
DECL|member|usb_device
id|usb_device_t
op_star
id|usb_device
suffix:semicolon
DECL|member|dev
r_int
id|dev
suffix:semicolon
DECL|member|seq_client
r_int
id|seq_client
suffix:semicolon
DECL|member|device_info
id|usbmidi_device_info_t
id|device_info
suffix:semicolon
DECL|struct|usbmidi_endpoint
r_struct
id|usbmidi_endpoint
(brace
DECL|member|out
id|usbmidi_out_endpoint_t
op_star
id|out
suffix:semicolon
DECL|member|in
id|usbmidi_in_endpoint_t
op_star
id|in
suffix:semicolon
DECL|member|rmidi
id|snd_rawmidi_t
op_star
id|rmidi
(braket
l_int|0x10
)braket
suffix:semicolon
DECL|member|endpoints
)brace
id|endpoints
(braket
id|MAX_ENDPOINTS
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|usbmidi_out_endpoint
r_struct
id|usbmidi_out_endpoint
(brace
DECL|member|umidi
id|usbmidi_t
op_star
id|umidi
suffix:semicolon
DECL|member|urb
id|urb_t
op_star
id|urb
suffix:semicolon
DECL|member|max_transfer
r_int
id|max_transfer
suffix:semicolon
multiline_comment|/* size of urb buffer */
DECL|member|tasklet
r_struct
id|tasklet_struct
id|tasklet
suffix:semicolon
DECL|member|buffer
r_uint8
id|buffer
(braket
id|OUTPUT_BUFFER_SIZE
)braket
suffix:semicolon
multiline_comment|/* ring buffer */
DECL|member|data_begin
r_int
id|data_begin
suffix:semicolon
DECL|member|data_size
r_int
id|data_size
suffix:semicolon
DECL|member|buffer_lock
id|spinlock_t
id|buffer_lock
suffix:semicolon
DECL|struct|usbmidi_out_port
r_struct
id|usbmidi_out_port
(brace
DECL|member|ep
id|usbmidi_out_endpoint_t
op_star
id|ep
suffix:semicolon
DECL|member|cable
r_uint8
id|cable
suffix:semicolon
multiline_comment|/* cable number &lt;&lt; 4 */
DECL|member|sysex_len
r_uint8
id|sysex_len
suffix:semicolon
DECL|member|sysex
r_uint8
id|sysex
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|ports
)brace
id|ports
(braket
l_int|0x10
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|usbmidi_in_endpoint
r_struct
id|usbmidi_in_endpoint
(brace
DECL|member|umidi
id|usbmidi_t
op_star
id|umidi
suffix:semicolon
DECL|member|ep
id|usbmidi_endpoint_t
op_star
id|ep
suffix:semicolon
DECL|member|urb
id|urb_t
op_star
id|urb
suffix:semicolon
DECL|struct|usbmidi_in_port
r_struct
id|usbmidi_in_port
(brace
DECL|member|seq_port
r_int
id|seq_port
suffix:semicolon
DECL|member|midi_event
id|snd_midi_event_t
op_star
id|midi_event
suffix:semicolon
DECL|member|ports
)brace
id|ports
(braket
l_int|0x10
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|snd_usbmidi_card_used
r_static
r_int
id|snd_usbmidi_card_used
(braket
id|SNDRV_CARDS
)braket
suffix:semicolon
r_static
id|DECLARE_MUTEX
c_func
(paren
id|snd_usbmidi_open_mutex
)paren
suffix:semicolon
r_static
r_void
id|snd_usbmidi_do_output
c_func
(paren
id|usbmidi_out_endpoint_t
op_star
id|ep
)paren
suffix:semicolon
multiline_comment|/*&n; * Submits the URB, with error handling.&n; */
DECL|function|snd_usbmidi_submit_urb
r_static
r_int
id|snd_usbmidi_submit_urb
c_func
(paren
id|urb_t
op_star
id|urb
comma
r_int
id|flags
)paren
(brace
r_int
id|err
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
op_logical_and
id|err
op_ne
op_minus
id|ENODEV
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;snd-usb-midi: usb_submit_urb: %d&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; * Error handling for URB completion functions.&n; */
DECL|function|snd_usbmidi_urb_error
r_static
r_int
id|snd_usbmidi_urb_error
c_func
(paren
r_int
id|status
)paren
(brace
r_if
c_cond
(paren
id|status
op_eq
op_minus
id|ENOENT
)paren
r_return
id|status
suffix:semicolon
multiline_comment|/* killed */
r_if
c_cond
(paren
id|status
op_eq
op_minus
id|ENODEV
op_logical_or
id|status
op_eq
op_minus
id|EILSEQ
op_logical_or
id|status
op_eq
op_minus
id|ETIMEDOUT
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/* device removed */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;snd-usb-midi: urb status %d&bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* continue */
)brace
multiline_comment|/*&n; * Converts a USB MIDI packet into an ALSA sequencer event.&n; */
DECL|function|snd_usbmidi_input_packet
r_static
r_void
id|snd_usbmidi_input_packet
c_func
(paren
id|usbmidi_in_endpoint_t
op_star
id|ep
comma
r_uint8
id|packet
(braket
l_int|4
)braket
)paren
(brace
r_static
r_const
r_uint8
id|cin_length
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|2
comma
l_int|3
comma
l_int|3
comma
l_int|1
comma
l_int|2
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|2
comma
l_int|2
comma
l_int|3
comma
l_int|1
)brace
suffix:semicolon
r_int
id|cable
op_assign
id|packet
(braket
l_int|0
)braket
op_rshift
l_int|4
suffix:semicolon
id|usbmidi_in_port_t
op_star
id|port
op_assign
op_amp
id|ep-&gt;ports
(braket
id|cable
)braket
suffix:semicolon
id|snd_seq_event_t
id|ev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port-&gt;midi_event
)paren
r_return
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ev
comma
l_int|0
comma
r_sizeof
(paren
id|ev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_midi_event_encode
c_func
(paren
id|port-&gt;midi_event
comma
op_amp
id|packet
(braket
l_int|1
)braket
comma
id|cin_length
(braket
id|packet
(braket
l_int|0
)braket
op_amp
l_int|0x0f
)braket
comma
op_amp
id|ev
)paren
OG
l_int|0
op_logical_and
id|ev.type
op_ne
id|SNDRV_SEQ_EVENT_NONE
)paren
(brace
id|ev.source.port
op_assign
id|port-&gt;seq_port
suffix:semicolon
id|ev.dest.client
op_assign
id|SNDRV_SEQ_ADDRESS_SUBSCRIBERS
suffix:semicolon
id|snd_seq_kernel_client_dispatch
c_func
(paren
id|ep-&gt;umidi-&gt;seq_client
comma
op_amp
id|ev
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;ep-&gt;rmidi
(braket
id|cable
)braket
)paren
id|snd_virmidi_receive
c_func
(paren
id|ep-&gt;ep-&gt;rmidi
(braket
id|cable
)braket
comma
op_amp
id|ev
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Processes the data read from the device.&n; */
DECL|function|snd_usbmidi_in_urb_complete
r_static
r_void
id|snd_usbmidi_in_urb_complete
c_func
(paren
id|urb_t
op_star
id|urb
)paren
(brace
id|usbmidi_in_endpoint_t
op_star
id|ep
op_assign
id|snd_magic_cast
c_func
(paren
id|usbmidi_in_endpoint_t
comma
id|urb-&gt;context
comma
r_return
)paren
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
op_eq
l_int|0
)paren
(brace
r_uint8
op_star
id|buffer
op_assign
(paren
r_uint8
op_star
)paren
id|ep-&gt;urb-&gt;transfer_buffer
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_plus
l_int|4
op_le
id|urb-&gt;actual_length
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
r_if
c_cond
(paren
id|buffer
(braket
id|i
)braket
op_ne
l_int|0
)paren
id|snd_usbmidi_input_packet
c_func
(paren
id|ep
comma
op_amp
id|buffer
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|snd_usbmidi_urb_error
c_func
(paren
id|urb-&gt;status
)paren
OL
l_int|0
)paren
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|usb_pipeint
c_func
(paren
id|urb-&gt;pipe
)paren
)paren
(brace
id|urb-&gt;dev
op_assign
id|ep-&gt;umidi-&gt;usb_device
suffix:semicolon
id|snd_usbmidi_submit_urb
c_func
(paren
id|urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_usbmidi_out_urb_complete
r_static
r_void
id|snd_usbmidi_out_urb_complete
c_func
(paren
id|urb_t
op_star
id|urb
)paren
(brace
id|usbmidi_out_endpoint_t
op_star
id|ep
op_assign
id|snd_magic_cast
c_func
(paren
id|usbmidi_out_endpoint_t
comma
id|urb-&gt;context
comma
r_return
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|snd_usbmidi_urb_error
c_func
(paren
id|urb-&gt;status
)paren
OL
l_int|0
)paren
r_return
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ep-&gt;buffer_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_usbmidi_do_output
c_func
(paren
id|ep
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ep-&gt;buffer_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * This is called when some data should be transferred to the device&n; * (after the reception of one or more sequencer events, or after completion&n; * of the previous transfer). ep-&gt;buffer_lock must be held.&n; */
DECL|function|snd_usbmidi_do_output
r_static
r_void
id|snd_usbmidi_do_output
c_func
(paren
id|usbmidi_out_endpoint_t
op_star
id|ep
)paren
(brace
r_int
id|len
suffix:semicolon
r_uint8
op_star
id|buffer
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;urb-&gt;status
op_eq
op_minus
id|EINPROGRESS
op_logical_or
id|ep-&gt;data_size
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|buffer
op_assign
(paren
r_uint8
op_star
)paren
id|ep-&gt;urb-&gt;transfer_buffer
suffix:semicolon
multiline_comment|/* first chunk, up to the end of the buffer */
id|len
op_assign
id|OUTPUT_BUFFER_SIZE
op_minus
id|ep-&gt;data_begin
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|ep-&gt;data_size
)paren
id|len
op_assign
id|ep-&gt;data_size
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|ep-&gt;max_transfer
)paren
id|len
op_assign
id|ep-&gt;max_transfer
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|0
)paren
(brace
id|memcpy
c_func
(paren
id|buffer
comma
id|ep-&gt;buffer
op_plus
id|ep-&gt;data_begin
comma
id|len
)paren
suffix:semicolon
id|ep-&gt;data_begin
op_assign
(paren
id|ep-&gt;data_begin
op_plus
id|len
)paren
op_mod
id|OUTPUT_BUFFER_SIZE
suffix:semicolon
id|ep-&gt;data_size
op_sub_assign
id|len
suffix:semicolon
id|buffer
op_add_assign
id|len
suffix:semicolon
id|ep-&gt;urb-&gt;transfer_buffer_length
op_assign
id|len
suffix:semicolon
)brace
multiline_comment|/* second chunk (after wraparound) */
r_if
c_cond
(paren
id|ep-&gt;data_begin
op_eq
l_int|0
op_logical_and
id|ep-&gt;data_size
OG
l_int|0
op_logical_and
id|len
OL
id|ep-&gt;max_transfer
)paren
(brace
id|len
op_assign
id|ep-&gt;max_transfer
op_minus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|ep-&gt;data_size
)paren
id|len
op_assign
id|ep-&gt;data_size
suffix:semicolon
id|memcpy
c_func
(paren
id|buffer
comma
id|ep-&gt;buffer
comma
id|len
)paren
suffix:semicolon
id|ep-&gt;data_begin
op_assign
id|len
suffix:semicolon
id|ep-&gt;data_size
op_sub_assign
id|len
suffix:semicolon
id|ep-&gt;urb-&gt;transfer_buffer_length
op_add_assign
id|len
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
OG
l_int|0
)paren
(brace
id|ep-&gt;urb-&gt;dev
op_assign
id|ep-&gt;umidi-&gt;usb_device
suffix:semicolon
id|snd_usbmidi_submit_urb
c_func
(paren
id|ep-&gt;urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_usbmidi_out_tasklet
r_static
r_void
id|snd_usbmidi_out_tasklet
c_func
(paren
r_int
r_int
id|data
)paren
(brace
id|usbmidi_out_endpoint_t
op_star
id|ep
op_assign
id|snd_magic_cast
c_func
(paren
id|usbmidi_out_endpoint_t
comma
(paren
r_void
op_star
)paren
id|data
comma
r_return
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ep-&gt;buffer_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_usbmidi_do_output
c_func
(paren
id|ep
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ep-&gt;buffer_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Adds one USB MIDI packet to the output buffer.&n; */
DECL|function|output_packet
r_static
r_void
id|output_packet
c_func
(paren
id|usbmidi_out_port_t
op_star
id|port
comma
r_uint8
id|p0
comma
r_uint8
id|p1
comma
r_uint8
id|p2
comma
r_uint8
id|p3
)paren
(brace
id|usbmidi_out_endpoint_t
op_star
id|ep
op_assign
id|port-&gt;ep
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ep-&gt;buffer_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;data_size
OL
id|OUTPUT_BUFFER_SIZE
)paren
(brace
r_uint8
op_star
id|buf
op_assign
id|ep-&gt;buffer
op_plus
(paren
id|ep-&gt;data_begin
op_plus
id|ep-&gt;data_size
)paren
op_mod
id|OUTPUT_BUFFER_SIZE
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
id|p0
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
id|p1
suffix:semicolon
id|buf
(braket
l_int|2
)braket
op_assign
id|p2
suffix:semicolon
id|buf
(braket
l_int|3
)braket
op_assign
id|p3
suffix:semicolon
id|ep-&gt;data_size
op_add_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;data_size
op_eq
id|ep-&gt;max_transfer
)paren
id|snd_usbmidi_do_output
c_func
(paren
id|ep
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ep-&gt;buffer_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Callback for snd_seq_dump_var_event.&n; */
DECL|function|snd_usbmidi_sysex_dump
r_static
r_int
id|snd_usbmidi_sysex_dump
c_func
(paren
r_void
op_star
id|ptr
comma
r_void
op_star
id|buf
comma
r_int
id|count
)paren
(brace
id|usbmidi_out_port_t
op_star
id|port
op_assign
(paren
id|usbmidi_out_port_t
op_star
)paren
id|ptr
suffix:semicolon
r_const
r_uint8
op_star
id|dump
op_assign
(paren
r_const
r_uint8
op_star
)paren
id|buf
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|count
suffix:semicolon
op_decrement
id|count
)paren
(brace
r_uint8
id|byte
op_assign
op_star
id|dump
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|byte
op_eq
l_int|0xf0
op_logical_and
id|port-&gt;sysex_len
OG
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * The previous SysEx wasn&squot;t terminated correctly.&n;&t;&t;&t; * Send the last bytes anyway, and hope that the&n;&t;&t;&t; * receiving device won&squot;t be too upset about the&n;&t;&t;&t; * missing F7.&n;&t;&t;&t; */
id|output_packet
c_func
(paren
id|port
comma
id|port-&gt;cable
op_or
(paren
l_int|0x04
op_plus
id|port-&gt;sysex_len
)paren
comma
id|port-&gt;sysex
(braket
l_int|0
)braket
comma
id|port-&gt;sysex_len
op_ge
l_int|2
ques
c_cond
id|port-&gt;sysex
(braket
l_int|1
)braket
suffix:colon
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|port-&gt;sysex_len
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|byte
op_ne
l_int|0xf7
)paren
(brace
r_if
c_cond
(paren
id|port-&gt;sysex_len
op_ge
l_int|2
)paren
(brace
id|output_packet
c_func
(paren
id|port
comma
id|port-&gt;cable
op_or
l_int|0x04
comma
id|port-&gt;sysex
(braket
l_int|0
)braket
comma
id|port-&gt;sysex
(braket
l_int|1
)braket
comma
id|byte
)paren
suffix:semicolon
id|port-&gt;sysex_len
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|port-&gt;sysex
(braket
id|port-&gt;sysex_len
op_increment
)braket
op_assign
id|byte
suffix:semicolon
)brace
)brace
r_else
(brace
r_uint8
id|cin
comma
id|data
(braket
l_int|3
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|port-&gt;sysex_len
suffix:semicolon
op_increment
id|i
)paren
id|data
(braket
id|i
)braket
op_assign
id|port-&gt;sysex
(braket
id|i
)braket
suffix:semicolon
id|data
(braket
id|i
op_increment
)braket
op_assign
l_int|0xf7
suffix:semicolon
id|cin
op_assign
id|port-&gt;cable
op_or
(paren
l_int|0x04
op_plus
id|i
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
op_increment
id|i
)paren
id|data
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * cin,data[] is x5,{F7 00 00}&n;&t;&t;&t; *            or x6,{xx F7 00}&n;&t;&t;&t; *            or x7,{xx xx F7}&n;&t;&t;&t; */
id|output_packet
c_func
(paren
id|port
comma
id|cin
comma
id|data
(braket
l_int|0
)braket
comma
id|data
(braket
l_int|1
)braket
comma
id|data
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|port-&gt;sysex_len
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Converts an ALSA sequencer event into USB MIDI packets.&n; */
DECL|function|snd_usbmidi_event_input
r_static
r_int
id|snd_usbmidi_event_input
c_func
(paren
id|snd_seq_event_t
op_star
id|ev
comma
r_int
id|direct
comma
r_void
op_star
id|private_data
comma
r_int
id|atomic
comma
r_int
id|hop
)paren
(brace
id|usbmidi_out_port_t
op_star
id|port
op_assign
(paren
id|usbmidi_out_port_t
op_star
)paren
id|private_data
suffix:semicolon
r_int
id|err
suffix:semicolon
r_uint8
id|p0
comma
id|p1
suffix:semicolon
id|p0
op_assign
id|port-&gt;cable
suffix:semicolon
id|p1
op_assign
id|ev-&gt;data.note.channel
op_amp
l_int|0xf
suffix:semicolon
r_switch
c_cond
(paren
id|ev-&gt;type
)paren
(brace
r_case
id|SNDRV_SEQ_EVENT_NOTEON
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x09
comma
id|p1
op_or
l_int|0x90
comma
id|ev-&gt;data.note.note
op_amp
l_int|0x7f
comma
id|ev-&gt;data.note.velocity
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_NOTEOFF
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x08
comma
id|p1
op_or
l_int|0x80
comma
id|ev-&gt;data.note.note
op_amp
l_int|0x7f
comma
id|ev-&gt;data.note.velocity
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_KEYPRESS
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0a
comma
id|p1
op_or
l_int|0xa0
comma
id|ev-&gt;data.note.note
op_amp
l_int|0x7f
comma
id|ev-&gt;data.note.velocity
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_CONTROLLER
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0b
comma
id|p1
op_or
l_int|0xb0
comma
id|ev-&gt;data.control.param
op_amp
l_int|0x7f
comma
id|ev-&gt;data.control.value
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_PGMCHANGE
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0c
comma
id|p1
op_or
l_int|0xc0
comma
id|ev-&gt;data.control.value
op_amp
l_int|0x7f
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_CHANPRESS
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0d
comma
id|p1
op_or
l_int|0xd0
comma
id|ev-&gt;data.control.value
op_amp
l_int|0x7f
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_PITCHBEND
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0e
comma
id|p1
op_or
l_int|0xe0
comma
(paren
id|ev-&gt;data.control.value
op_plus
l_int|0x2000
)paren
op_amp
l_int|0x7f
comma
(paren
(paren
id|ev-&gt;data.control.value
op_plus
l_int|0x2000
)paren
op_rshift
l_int|7
)paren
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_CONTROL14
suffix:colon
r_if
c_cond
(paren
id|ev-&gt;data.control.param
OL
l_int|0x20
)paren
(brace
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0b
comma
id|p1
op_or
l_int|0xb0
comma
id|ev-&gt;data.control.param
comma
(paren
id|ev-&gt;data.control.value
op_rshift
l_int|7
)paren
op_amp
l_int|0x7f
)paren
suffix:semicolon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0b
comma
id|p1
op_or
l_int|0xb0
comma
id|ev-&gt;data.control.param
op_plus
l_int|0x20
comma
id|ev-&gt;data.control.value
op_amp
l_int|0x7f
)paren
suffix:semicolon
)brace
r_else
(brace
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0b
comma
id|p1
op_or
l_int|0xb0
comma
id|ev-&gt;data.control.param
op_amp
l_int|0x7f
comma
id|ev-&gt;data.control.value
op_amp
l_int|0x7f
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_SONGPOS
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x03
comma
l_int|0xf2
comma
id|ev-&gt;data.control.value
op_amp
l_int|0x7f
comma
(paren
id|ev-&gt;data.control.value
op_rshift
l_int|7
)paren
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_SONGSEL
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x02
comma
l_int|0xf3
comma
id|ev-&gt;data.control.value
op_amp
l_int|0x7f
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_QFRAME
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x02
comma
l_int|0xf1
comma
id|ev-&gt;data.control.value
op_amp
l_int|0x7f
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_START
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0f
comma
l_int|0xfa
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_CONTINUE
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0f
comma
l_int|0xfb
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_STOP
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0f
comma
l_int|0xfc
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_CLOCK
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0f
comma
l_int|0xf8
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_TUNE_REQUEST
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x05
comma
l_int|0xf6
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_RESET
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0f
comma
l_int|0xff
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_SENSING
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0f
comma
l_int|0xfe
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_SYSEX
suffix:colon
id|err
op_assign
id|snd_seq_dump_var_event
c_func
(paren
id|ev
comma
id|snd_usbmidi_sysex_dump
comma
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
id|tasklet_hi_schedule
c_func
(paren
op_amp
id|port-&gt;ep-&gt;tasklet
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Frees an input endpoint.&n; * May be called when ep hasn&squot;t been initialized completely.&n; */
DECL|function|snd_usbmidi_in_endpoint_delete
r_static
r_void
id|snd_usbmidi_in_endpoint_delete
c_func
(paren
id|usbmidi_in_endpoint_t
op_star
id|ep
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;urb
)paren
(brace
r_if
c_cond
(paren
id|ep-&gt;urb-&gt;transfer_buffer
)paren
(brace
id|usb_unlink_urb
c_func
(paren
id|ep-&gt;urb
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ep-&gt;urb-&gt;transfer_buffer
)paren
suffix:semicolon
)brace
id|usb_free_urb
c_func
(paren
id|ep-&gt;urb
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x10
suffix:semicolon
op_increment
id|i
)paren
r_if
c_cond
(paren
id|ep-&gt;ports
(braket
id|i
)braket
dot
id|midi_event
)paren
id|snd_midi_event_free
c_func
(paren
id|ep-&gt;ports
(braket
id|i
)braket
dot
id|midi_event
)paren
suffix:semicolon
id|snd_magic_kfree
c_func
(paren
id|ep
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Searches for an alternate setting in which the endpoint uses interrupt&n; * transfers for input.&n; */
DECL|function|snd_usbmidi_get_int_ep
r_static
r_int
id|snd_usbmidi_get_int_ep
c_func
(paren
id|usbmidi_t
op_star
id|umidi
comma
r_uint8
id|epnum
comma
id|usb_endpoint_descriptor_t
op_star
op_star
id|descriptor
)paren
(brace
id|usb_interface_t
op_star
id|intf
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
op_star
id|descriptor
op_assign
l_int|NULL
suffix:semicolon
id|intf
op_assign
id|usb_ifnum_to_if
c_func
(paren
id|umidi-&gt;usb_device
comma
id|umidi-&gt;device_info.ifnum
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|intf
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|intf-&gt;num_altsetting
suffix:semicolon
op_increment
id|i
)paren
(brace
id|usb_interface_descriptor_t
op_star
id|intfd
op_assign
op_amp
id|intf-&gt;altsetting
(braket
id|i
)braket
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|intfd-&gt;bNumEndpoints
suffix:semicolon
op_increment
id|j
)paren
(brace
id|usb_endpoint_descriptor_t
op_star
id|epd
op_assign
op_amp
id|intfd-&gt;endpoint
(braket
id|j
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|epd-&gt;bEndpointAddress
op_amp
(paren
id|USB_ENDPOINT_NUMBER_MASK
op_or
id|USB_ENDPOINT_DIR_MASK
)paren
)paren
op_eq
(paren
id|epnum
op_or
id|USB_DIR_IN
)paren
op_logical_and
(paren
id|epd-&gt;bmAttributes
op_amp
id|USB_ENDPOINT_XFERTYPE_MASK
)paren
op_eq
id|USB_ENDPOINT_XFER_INT
)paren
(brace
id|usb_set_interface
c_func
(paren
id|umidi-&gt;usb_device
comma
id|intfd-&gt;bInterfaceNumber
comma
id|intfd-&gt;bAlternateSetting
)paren
suffix:semicolon
op_star
id|descriptor
op_assign
op_amp
id|intfd-&gt;endpoint
(braket
id|j
)braket
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
)brace
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
multiline_comment|/*&n; * Creates an input endpoint, and initalizes input ports.&n; * ALSA ports are created later.&n; */
DECL|function|snd_usbmidi_in_endpoint_create
r_static
r_int
id|snd_usbmidi_in_endpoint_create
c_func
(paren
id|usbmidi_t
op_star
id|umidi
comma
id|usbmidi_endpoint_info_t
op_star
id|ep_info
comma
id|usbmidi_endpoint_t
op_star
id|rep
)paren
(brace
id|usbmidi_in_endpoint_t
op_star
id|ep
suffix:semicolon
r_int
id|do_int_transfer
suffix:semicolon
id|usb_endpoint_descriptor_t
op_star
id|epd
suffix:semicolon
r_void
op_star
id|buffer
suffix:semicolon
r_int
r_int
id|pipe
suffix:semicolon
r_int
id|length
comma
id|i
comma
id|err
suffix:semicolon
id|rep-&gt;in
op_assign
l_int|NULL
suffix:semicolon
id|ep
op_assign
id|snd_magic_kcalloc
c_func
(paren
id|usbmidi_in_endpoint_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ep
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|ep-&gt;umidi
op_assign
id|umidi
suffix:semicolon
id|ep-&gt;ep
op_assign
id|rep
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x10
suffix:semicolon
op_increment
id|i
)paren
id|ep-&gt;ports
(braket
id|i
)braket
dot
id|seq_port
op_assign
op_minus
l_int|1
suffix:semicolon
id|do_int_transfer
op_assign
id|snd_int_transfer
(braket
id|umidi-&gt;dev
)braket
suffix:semicolon
r_if
c_cond
(paren
id|do_int_transfer
)paren
(brace
r_if
c_cond
(paren
id|snd_usbmidi_get_int_ep
c_func
(paren
id|umidi
comma
id|ep_info-&gt;epnum
comma
op_amp
id|epd
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;snd-usb-midi: interrupt endpoint not found&bslash;n&quot;
)paren
suffix:semicolon
id|do_int_transfer
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|ep-&gt;urb
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ep-&gt;urb
)paren
(brace
id|snd_usbmidi_in_endpoint_delete
c_func
(paren
id|ep
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|do_int_transfer
)paren
id|pipe
op_assign
id|usb_rcvintpipe
c_func
(paren
id|umidi-&gt;usb_device
comma
id|ep_info-&gt;epnum
)paren
suffix:semicolon
r_else
id|pipe
op_assign
id|usb_rcvbulkpipe
c_func
(paren
id|umidi-&gt;usb_device
comma
id|ep_info-&gt;epnum
)paren
suffix:semicolon
id|length
op_assign
id|usb_maxpacket
c_func
(paren
id|umidi-&gt;usb_device
comma
id|pipe
comma
l_int|0
)paren
suffix:semicolon
id|buffer
op_assign
id|kmalloc
c_func
(paren
id|length
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
(brace
id|snd_usbmidi_in_endpoint_delete
c_func
(paren
id|ep
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|do_int_transfer
)paren
id|FILL_INT_URB
c_func
(paren
id|ep-&gt;urb
comma
id|umidi-&gt;usb_device
comma
id|pipe
comma
id|buffer
comma
id|length
comma
id|snd_usbmidi_in_urb_complete
comma
id|ep
comma
id|epd-&gt;bInterval
)paren
suffix:semicolon
r_else
id|FILL_BULK_URB
c_func
(paren
id|ep-&gt;urb
comma
id|umidi-&gt;usb_device
comma
id|pipe
comma
id|buffer
comma
id|length
comma
id|snd_usbmidi_in_urb_complete
comma
id|ep
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x10
suffix:semicolon
op_increment
id|i
)paren
r_if
c_cond
(paren
id|ep_info-&gt;in_cables
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
(brace
id|err
op_assign
id|snd_midi_event_new
c_func
(paren
id|INPUT_BUFFER_SIZE
comma
op_amp
id|ep-&gt;ports
(braket
id|i
)braket
dot
id|midi_event
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_usbmidi_in_endpoint_delete
c_func
(paren
id|ep
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
)brace
id|rep-&gt;in
op_assign
id|ep
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_usbmidi_count_bits
r_static
r_int
id|snd_usbmidi_count_bits
c_func
(paren
r_uint16
id|x
)paren
(brace
r_int
id|i
comma
id|bits
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
op_increment
id|i
)paren
id|bits
op_add_assign
(paren
id|x
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
op_ne
l_int|0
suffix:semicolon
r_return
id|bits
suffix:semicolon
)brace
multiline_comment|/*&n; * Frees an output endpoint.&n; * May be called when ep hasn&squot;t been initialized completely.&n; */
DECL|function|snd_usbmidi_out_endpoint_delete
r_static
r_void
id|snd_usbmidi_out_endpoint_delete
c_func
(paren
id|usbmidi_out_endpoint_t
op_star
id|ep
)paren
(brace
r_if
c_cond
(paren
id|ep-&gt;tasklet.func
)paren
id|tasklet_kill
c_func
(paren
op_amp
id|ep-&gt;tasklet
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;urb
)paren
(brace
r_if
c_cond
(paren
id|ep-&gt;urb-&gt;transfer_buffer
)paren
(brace
id|usb_unlink_urb
c_func
(paren
id|ep-&gt;urb
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ep-&gt;urb-&gt;transfer_buffer
)paren
suffix:semicolon
)brace
id|usb_free_urb
c_func
(paren
id|ep-&gt;urb
)paren
suffix:semicolon
)brace
id|snd_magic_kfree
c_func
(paren
id|ep
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Creates an output endpoint, and initializes output ports.&n; * ALSA ports are created later.&n; */
DECL|function|snd_usbmidi_out_endpoint_create
r_static
r_int
id|snd_usbmidi_out_endpoint_create
c_func
(paren
id|usbmidi_t
op_star
id|umidi
comma
id|usbmidi_endpoint_info_t
op_star
id|ep_info
comma
id|usbmidi_endpoint_t
op_star
id|rep
)paren
(brace
id|usbmidi_out_endpoint_t
op_star
id|ep
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|pipe
suffix:semicolon
r_void
op_star
id|buffer
suffix:semicolon
id|rep-&gt;out
op_assign
l_int|NULL
suffix:semicolon
id|ep
op_assign
id|snd_magic_kcalloc
c_func
(paren
id|usbmidi_out_endpoint_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ep
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|ep-&gt;umidi
op_assign
id|umidi
suffix:semicolon
id|ep-&gt;urb
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ep-&gt;urb
)paren
(brace
id|snd_usbmidi_out_endpoint_delete
c_func
(paren
id|ep
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|pipe
op_assign
id|usb_sndbulkpipe
c_func
(paren
id|umidi-&gt;usb_device
comma
id|ep_info-&gt;epnum
)paren
suffix:semicolon
id|ep-&gt;max_transfer
op_assign
id|usb_maxpacket
c_func
(paren
id|umidi-&gt;usb_device
comma
id|pipe
comma
l_int|1
)paren
op_amp
op_complement
l_int|3
suffix:semicolon
id|buffer
op_assign
id|kmalloc
c_func
(paren
id|ep-&gt;max_transfer
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
(brace
id|snd_usbmidi_out_endpoint_delete
c_func
(paren
id|ep
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|FILL_BULK_URB
c_func
(paren
id|ep-&gt;urb
comma
id|umidi-&gt;usb_device
comma
id|pipe
comma
id|buffer
comma
id|ep-&gt;max_transfer
comma
id|snd_usbmidi_out_urb_complete
comma
id|ep
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|ep-&gt;buffer_lock
)paren
suffix:semicolon
id|tasklet_init
c_func
(paren
op_amp
id|ep-&gt;tasklet
comma
id|snd_usbmidi_out_tasklet
comma
(paren
r_int
r_int
)paren
id|ep
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x10
suffix:semicolon
op_increment
id|i
)paren
r_if
c_cond
(paren
id|ep_info-&gt;out_cables
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
(brace
id|ep-&gt;ports
(braket
id|i
)braket
dot
id|ep
op_assign
id|ep
suffix:semicolon
id|ep-&gt;ports
(braket
id|i
)braket
dot
id|cable
op_assign
id|i
op_lshift
l_int|4
suffix:semicolon
)brace
id|rep-&gt;out
op_assign
id|ep
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Frees the sequencer client, endpoints and ports.&n; */
DECL|function|snd_usbmidi_seq_device_delete
r_static
r_int
id|snd_usbmidi_seq_device_delete
c_func
(paren
id|snd_seq_device_t
op_star
id|seq_device
)paren
(brace
id|usbmidi_t
op_star
id|umidi
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|umidi
op_assign
(paren
id|usbmidi_t
op_star
)paren
id|SNDRV_SEQ_DEVICE_ARGPTR
c_func
(paren
id|seq_device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|umidi-&gt;seq_client
op_ge
l_int|0
)paren
(brace
id|snd_seq_delete_kernel_client
c_func
(paren
id|umidi-&gt;seq_client
)paren
suffix:semicolon
id|umidi-&gt;seq_client
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_ENDPOINTS
suffix:semicolon
op_increment
id|i
)paren
(brace
id|usbmidi_endpoint_t
op_star
id|ep
op_assign
op_amp
id|umidi-&gt;endpoints
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;out
)paren
(brace
id|snd_usbmidi_out_endpoint_delete
c_func
(paren
id|ep-&gt;out
)paren
suffix:semicolon
id|ep-&gt;out
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ep-&gt;in
)paren
(brace
id|snd_usbmidi_in_endpoint_delete
c_func
(paren
id|ep-&gt;in
)paren
suffix:semicolon
id|ep-&gt;in
op_assign
l_int|NULL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|0x10
suffix:semicolon
op_increment
id|j
)paren
r_if
c_cond
(paren
id|ep-&gt;rmidi
(braket
id|j
)braket
)paren
(brace
id|snd_device_free
c_func
(paren
id|umidi-&gt;card
comma
id|ep-&gt;rmidi
(braket
id|j
)braket
)paren
suffix:semicolon
id|ep-&gt;rmidi
(braket
id|j
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * After input and output endpoints have been initialized, create&n; * the ALSA port for each input/output port pair in the endpoint.&n; * *port_idx is the port number, which must be unique over all endpoints.&n; */
DECL|function|snd_usbmidi_create_endpoint_ports
r_static
r_int
id|snd_usbmidi_create_endpoint_ports
c_func
(paren
id|usbmidi_t
op_star
id|umidi
comma
r_int
id|ep
comma
r_int
op_star
id|port_idx
)paren
(brace
id|usbmidi_endpoint_info_t
op_star
id|ep_info
op_assign
op_amp
id|umidi-&gt;device_info.endpoints
(braket
id|ep
)braket
suffix:semicolon
r_int
id|c
comma
id|err
suffix:semicolon
r_int
id|cap
comma
id|type
comma
id|port
suffix:semicolon
r_int
id|out
comma
id|in
suffix:semicolon
id|snd_seq_port_callback_t
id|port_callback
suffix:semicolon
r_char
id|port_name
(braket
l_int|48
)braket
suffix:semicolon
r_for
c_loop
(paren
id|c
op_assign
l_int|0
suffix:semicolon
id|c
OL
l_int|0x10
suffix:semicolon
op_increment
id|c
)paren
(brace
id|out
op_assign
id|ep_info-&gt;out_cables
op_amp
(paren
l_int|1
op_lshift
id|c
)paren
suffix:semicolon
id|in
op_assign
id|ep_info-&gt;in_cables
op_amp
(paren
l_int|1
op_lshift
id|c
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|in
op_logical_or
id|out
)paren
)paren
r_continue
suffix:semicolon
id|cap
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|port_callback
comma
l_int|0
comma
r_sizeof
(paren
id|port_callback
)paren
)paren
suffix:semicolon
id|port_callback.owner
op_assign
id|THIS_MODULE
suffix:semicolon
r_if
c_cond
(paren
id|out
)paren
(brace
id|port_callback.event_input
op_assign
id|snd_usbmidi_event_input
suffix:semicolon
id|port_callback.private_data
op_assign
op_amp
id|umidi-&gt;endpoints
(braket
id|ep
)braket
dot
id|out-&gt;ports
(braket
id|c
)braket
suffix:semicolon
id|cap
op_or_assign
id|SNDRV_SEQ_PORT_CAP_WRITE
op_or
id|SNDRV_SEQ_PORT_CAP_SUBS_WRITE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|in
)paren
(brace
id|cap
op_or_assign
id|SNDRV_SEQ_PORT_CAP_READ
op_or
id|SNDRV_SEQ_PORT_CAP_SUBS_READ
suffix:semicolon
)brace
r_if
c_cond
(paren
id|out
op_logical_and
id|in
)paren
(brace
id|cap
op_or_assign
id|SNDRV_SEQ_PORT_CAP_DUPLEX
suffix:semicolon
)brace
multiline_comment|/* TODO: read type bits from element descriptor */
id|type
op_assign
id|SNDRV_SEQ_PORT_TYPE_MIDI_GENERIC
suffix:semicolon
multiline_comment|/* TODO: read port name from jack descriptor */
id|sprintf
c_func
(paren
id|port_name
comma
l_string|&quot;%s Port %d&quot;
comma
id|umidi-&gt;device_info.product
comma
op_star
id|port_idx
)paren
suffix:semicolon
id|port
op_assign
id|snd_seq_event_port_attach
c_func
(paren
id|umidi-&gt;seq_client
comma
op_amp
id|port_callback
comma
id|cap
comma
id|type
comma
id|port_name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|port
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cannot create port (error code %d)&bslash;n&quot;
comma
id|port
)paren
suffix:semicolon
r_return
id|port
suffix:semicolon
)brace
r_if
c_cond
(paren
id|in
)paren
id|umidi-&gt;endpoints
(braket
id|ep
)braket
dot
id|in-&gt;ports
(braket
id|c
)braket
dot
id|seq_port
op_assign
id|port
suffix:semicolon
r_if
c_cond
(paren
op_star
id|port_idx
OL
id|SNDRV_MINOR_RAWMIDIS
)paren
(brace
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
id|snd_virmidi_dev_t
op_star
id|rdev
suffix:semicolon
id|err
op_assign
id|snd_virmidi_new
c_func
(paren
id|umidi-&gt;card
comma
op_star
id|port_idx
comma
op_amp
id|rmidi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|rdev
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_virmidi_dev_t
comma
id|rmidi-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|rmidi-&gt;name
comma
id|port_name
)paren
suffix:semicolon
id|rdev-&gt;seq_mode
op_assign
id|SNDRV_VIRMIDI_SEQ_ATTACH
suffix:semicolon
id|rdev-&gt;client
op_assign
id|umidi-&gt;seq_client
suffix:semicolon
id|rdev-&gt;port
op_assign
id|port
suffix:semicolon
id|err
op_assign
id|snd_device_register
c_func
(paren
id|umidi-&gt;card
comma
id|rmidi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_device_free
c_func
(paren
id|umidi-&gt;card
comma
id|rmidi
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|umidi-&gt;endpoints
(braket
id|ep
)braket
dot
id|rmidi
(braket
id|c
)braket
op_assign
id|rmidi
suffix:semicolon
)brace
op_increment
op_star
id|port_idx
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Create the endpoints and their ports.&n; */
DECL|function|snd_usbmidi_create_endpoints
r_static
r_int
id|snd_usbmidi_create_endpoints
c_func
(paren
id|usbmidi_t
op_star
id|umidi
)paren
(brace
r_int
id|i
comma
id|err
comma
id|port_idx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_ENDPOINTS
suffix:semicolon
op_increment
id|i
)paren
(brace
id|usbmidi_endpoint_info_t
op_star
id|ep_info
op_assign
op_amp
id|umidi-&gt;device_info.endpoints
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ep_info-&gt;epnum
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|ep_info-&gt;out_cables
)paren
(brace
id|err
op_assign
id|snd_usbmidi_out_endpoint_create
c_func
(paren
id|umidi
comma
id|ep_info
comma
op_amp
id|umidi-&gt;endpoints
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ep_info-&gt;in_cables
)paren
(brace
id|err
op_assign
id|snd_usbmidi_in_endpoint_create
c_func
(paren
id|umidi
comma
id|ep_info
comma
op_amp
id|umidi-&gt;endpoints
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
id|err
op_assign
id|snd_usbmidi_create_endpoint_ports
c_func
(paren
id|umidi
comma
id|i
comma
op_amp
id|port_idx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;snd-usb-midi: endpoint %d: created %d output and %d input ports&bslash;n&quot;
comma
id|ep_info-&gt;epnum
comma
id|snd_usbmidi_count_bits
c_func
(paren
id|ep_info-&gt;out_cables
)paren
comma
id|snd_usbmidi_count_bits
c_func
(paren
id|ep_info-&gt;in_cables
)paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Initialize the sequencer device.&n; */
DECL|function|snd_usbmidi_seq_device_new
r_static
r_int
id|snd_usbmidi_seq_device_new
c_func
(paren
id|snd_seq_device_t
op_star
id|seq_device
)paren
(brace
id|usbmidi_t
op_star
id|umidi
suffix:semicolon
id|snd_seq_client_callback_t
id|client_callback
suffix:semicolon
id|snd_seq_client_info_t
id|client_info
suffix:semicolon
r_int
id|i
comma
id|err
suffix:semicolon
id|umidi
op_assign
(paren
id|usbmidi_t
op_star
)paren
id|SNDRV_SEQ_DEVICE_ARGPTR
c_func
(paren
id|seq_device
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|client_callback
comma
l_int|0
comma
r_sizeof
(paren
id|client_callback
)paren
)paren
suffix:semicolon
id|client_callback.allow_output
op_assign
l_int|1
suffix:semicolon
id|client_callback.allow_input
op_assign
l_int|1
suffix:semicolon
id|umidi-&gt;seq_client
op_assign
id|snd_seq_create_kernel_client
c_func
(paren
id|umidi-&gt;card
comma
l_int|0
comma
op_amp
id|client_callback
)paren
suffix:semicolon
r_if
c_cond
(paren
id|umidi-&gt;seq_client
OL
l_int|0
)paren
r_return
id|umidi-&gt;seq_client
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|client_info
comma
l_int|0
comma
r_sizeof
(paren
id|client_info
)paren
)paren
suffix:semicolon
id|client_info.client
op_assign
id|umidi-&gt;seq_client
suffix:semicolon
id|client_info.type
op_assign
id|KERNEL_CLIENT
suffix:semicolon
id|sprintf
c_func
(paren
id|client_info.name
comma
l_string|&quot;%s %s&quot;
comma
id|umidi-&gt;device_info.vendor
comma
id|umidi-&gt;device_info.product
)paren
suffix:semicolon
id|snd_seq_kernel_client_ctl
c_func
(paren
id|umidi-&gt;seq_client
comma
id|SNDRV_SEQ_IOCTL_SET_CLIENT_INFO
comma
op_amp
id|client_info
)paren
suffix:semicolon
id|err
op_assign
id|snd_usbmidi_create_endpoints
c_func
(paren
id|umidi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_usbmidi_seq_device_delete
c_func
(paren
id|seq_device
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_ENDPOINTS
suffix:semicolon
op_increment
id|i
)paren
r_if
c_cond
(paren
id|umidi-&gt;endpoints
(braket
id|i
)braket
dot
id|in
)paren
id|snd_usbmidi_submit_urb
c_func
(paren
id|umidi-&gt;endpoints
(braket
id|i
)braket
dot
id|in-&gt;urb
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_usbmidi_card_create
r_static
r_int
id|snd_usbmidi_card_create
c_func
(paren
id|usb_device_t
op_star
id|usb_device
comma
id|usbmidi_device_info_t
op_star
id|device_info
comma
id|snd_card_t
op_star
op_star
id|rcard
)paren
(brace
id|snd_card_t
op_star
id|card
suffix:semicolon
id|snd_seq_device_t
op_star
id|seq_device
suffix:semicolon
id|usbmidi_t
op_star
id|umidi
suffix:semicolon
r_int
id|dev
comma
id|err
suffix:semicolon
r_if
c_cond
(paren
id|rcard
)paren
op_star
id|rcard
op_assign
l_int|NULL
suffix:semicolon
id|down
c_func
(paren
op_amp
id|snd_usbmidi_open_mutex
)paren
suffix:semicolon
r_for
c_loop
(paren
id|dev
op_assign
l_int|0
suffix:semicolon
id|dev
OL
id|SNDRV_CARDS
suffix:semicolon
op_increment
id|dev
)paren
(brace
r_if
c_cond
(paren
id|snd_enable
(braket
id|dev
)braket
op_logical_and
op_logical_neg
id|snd_usbmidi_card_used
(braket
id|dev
)braket
op_logical_and
(paren
id|snd_vid
(braket
id|dev
)braket
op_eq
op_minus
l_int|1
op_logical_or
id|snd_vid
(braket
id|dev
)braket
op_eq
id|usb_device-&gt;descriptor.idVendor
)paren
op_logical_and
(paren
id|snd_pid
(braket
id|dev
)braket
op_eq
op_minus
l_int|1
op_logical_or
id|snd_pid
(braket
id|dev
)braket
op_eq
id|usb_device-&gt;descriptor.idProduct
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev
op_ge
id|SNDRV_CARDS
)paren
(brace
id|up
c_func
(paren
op_amp
id|snd_usbmidi_open_mutex
)paren
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|card
op_assign
id|snd_card_new
c_func
(paren
id|snd_index
(braket
id|dev
)braket
comma
id|snd_id
(braket
id|dev
)braket
comma
id|THIS_MODULE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
)paren
(brace
id|up
c_func
(paren
op_amp
id|snd_usbmidi_open_mutex
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;USB MIDI&quot;
)paren
suffix:semicolon
id|snprintf
c_func
(paren
id|card-&gt;shortname
comma
r_sizeof
(paren
id|card-&gt;shortname
)paren
comma
l_string|&quot;%s %s&quot;
comma
id|device_info-&gt;vendor
comma
id|device_info-&gt;product
)paren
suffix:semicolon
id|snprintf
c_func
(paren
id|card-&gt;longname
comma
r_sizeof
(paren
id|card-&gt;longname
)paren
comma
l_string|&quot;%s %s at %03d/%03d if %d&quot;
comma
id|device_info-&gt;vendor
comma
id|device_info-&gt;product
comma
id|usb_device-&gt;bus-&gt;busnum
comma
id|usb_device-&gt;devnum
comma
id|device_info-&gt;ifnum
)paren
suffix:semicolon
id|card-&gt;private_data
op_assign
(paren
r_void
op_star
)paren
id|dev
suffix:semicolon
id|err
op_assign
id|snd_seq_device_new
c_func
(paren
id|card
comma
l_int|0
comma
id|SNDRV_SEQ_DEV_ID_USBMIDI
comma
r_sizeof
(paren
id|usbmidi_t
)paren
comma
op_amp
id|seq_device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|snd_usbmidi_open_mutex
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|strcpy
c_func
(paren
id|seq_device-&gt;name
comma
id|card-&gt;shortname
)paren
suffix:semicolon
id|umidi
op_assign
(paren
id|usbmidi_t
op_star
)paren
id|SNDRV_SEQ_DEVICE_ARGPTR
c_func
(paren
id|seq_device
)paren
suffix:semicolon
id|umidi-&gt;card
op_assign
id|card
suffix:semicolon
id|umidi-&gt;usb_device
op_assign
id|usb_device
suffix:semicolon
id|umidi-&gt;dev
op_assign
id|dev
suffix:semicolon
id|umidi-&gt;seq_client
op_assign
op_minus
l_int|1
suffix:semicolon
id|umidi-&gt;device_info
op_assign
op_star
id|device_info
suffix:semicolon
id|err
op_assign
id|snd_card_register
c_func
(paren
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|snd_usbmidi_open_mutex
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|snd_usbmidi_card_used
(braket
id|dev
)braket
op_assign
l_int|1
suffix:semicolon
id|up
c_func
(paren
op_amp
id|snd_usbmidi_open_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rcard
)paren
op_star
id|rcard
op_assign
id|card
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * If the first endpoint isn&squot;t specified, use the first endpoint in the&n; * first alternate setting of the interface.&n; */
DECL|function|snd_usbmidi_detect_endpoint
r_static
r_int
id|snd_usbmidi_detect_endpoint
c_func
(paren
id|usb_device_t
op_star
id|usb_device
comma
id|usbmidi_device_info_t
op_star
id|device_info
)paren
(brace
id|usb_interface_t
op_star
id|intf
suffix:semicolon
id|usb_interface_descriptor_t
op_star
id|intfd
suffix:semicolon
id|usb_endpoint_descriptor_t
op_star
id|epd
suffix:semicolon
r_if
c_cond
(paren
id|device_info-&gt;endpoints
(braket
l_int|0
)braket
dot
id|epnum
op_eq
op_minus
l_int|1
)paren
(brace
id|intf
op_assign
id|usb_ifnum_to_if
c_func
(paren
id|usb_device
comma
id|device_info-&gt;ifnum
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|intf
op_logical_or
id|intf-&gt;num_altsetting
OL
l_int|1
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
id|intfd
op_assign
id|intf-&gt;altsetting
suffix:semicolon
r_if
c_cond
(paren
id|intfd-&gt;bNumEndpoints
OL
l_int|1
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
id|epd
op_assign
id|intfd-&gt;endpoint
suffix:semicolon
id|device_info-&gt;endpoints
(braket
l_int|0
)braket
dot
id|epnum
op_assign
id|epd-&gt;bEndpointAddress
op_amp
id|USB_ENDPOINT_NUMBER_MASK
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Searches for the alternate setting with the greatest number of bulk transfer&n; * endpoints.&n; */
DECL|function|snd_usbmidi_get_altsetting
r_static
id|usb_interface_descriptor_t
op_star
id|snd_usbmidi_get_altsetting
c_func
(paren
id|usb_device_t
op_star
id|usb_device
comma
id|usb_interface_t
op_star
id|intf
)paren
(brace
r_int
id|i
comma
id|best
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
id|best_out
op_assign
l_int|0
comma
id|best_in
op_assign
l_int|0
suffix:semicolon
id|usb_interface_descriptor_t
op_star
id|intfd
suffix:semicolon
r_if
c_cond
(paren
id|intf-&gt;num_altsetting
op_eq
l_int|1
)paren
r_return
op_amp
id|intf-&gt;altsetting
(braket
l_int|0
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|intf-&gt;num_altsetting
suffix:semicolon
op_increment
id|i
)paren
(brace
r_int
id|out
op_assign
l_int|0
comma
id|in
op_assign
l_int|0
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|intf-&gt;altsetting
(braket
id|i
)braket
dot
id|bNumEndpoints
suffix:semicolon
op_increment
id|j
)paren
(brace
id|usb_endpoint_descriptor_t
op_star
id|ep
op_assign
op_amp
id|intf-&gt;altsetting
(braket
id|i
)braket
dot
id|endpoint
(braket
id|j
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ep-&gt;bmAttributes
op_amp
id|USB_ENDPOINT_XFERTYPE_MASK
)paren
op_eq
id|USB_ENDPOINT_XFER_BULK
)paren
(brace
r_if
c_cond
(paren
id|ep-&gt;bEndpointAddress
op_amp
id|USB_DIR_IN
)paren
op_increment
id|in
suffix:semicolon
r_else
op_increment
id|out
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
(paren
id|out
op_ge
id|best_out
op_logical_and
id|in
op_ge
id|best_in
)paren
op_logical_and
(paren
id|out
OG
id|best_out
op_logical_or
id|in
OG
id|best_in
)paren
)paren
(brace
id|best_out
op_assign
id|out
suffix:semicolon
id|best_in
op_assign
id|in
suffix:semicolon
id|best
op_assign
id|i
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|best
OL
l_int|0
)paren
r_return
l_int|NULL
suffix:semicolon
id|intfd
op_assign
op_amp
id|intf-&gt;altsetting
(braket
id|best
)braket
suffix:semicolon
id|usb_set_interface
c_func
(paren
id|usb_device
comma
id|intfd-&gt;bInterfaceNumber
comma
id|intfd-&gt;bAlternateSetting
)paren
suffix:semicolon
r_return
id|intfd
suffix:semicolon
)brace
multiline_comment|/*&n; * Returns MIDIStreaming device capabilities in device_info.&n; */
DECL|function|snd_usbmidi_get_ms_info
r_static
r_int
id|snd_usbmidi_get_ms_info
c_func
(paren
id|usb_device_t
op_star
id|usb_device
comma
r_int
r_int
id|ifnum
comma
id|usbmidi_device_info_t
op_star
id|device_info
)paren
(brace
id|usb_interface_t
op_star
id|intf
suffix:semicolon
id|usb_interface_descriptor_t
op_star
id|intfd
suffix:semicolon
id|usb_ms_header_descriptor_t
op_star
id|ms_header
suffix:semicolon
id|usb_endpoint_descriptor_t
op_star
id|ep
suffix:semicolon
id|usb_ms_endpoint_descriptor_t
op_star
id|ms_ep
suffix:semicolon
r_int
id|i
comma
id|epidx
suffix:semicolon
id|memset
c_func
(paren
id|device_info
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|device_info
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usb_device-&gt;descriptor.iManufacturer
op_eq
l_int|0
op_logical_or
id|usb_string
c_func
(paren
id|usb_device
comma
id|usb_device-&gt;descriptor.iManufacturer
comma
id|device_info-&gt;vendor
comma
r_sizeof
(paren
id|device_info-&gt;vendor
)paren
)paren
OL
l_int|0
)paren
id|sprintf
c_func
(paren
id|device_info-&gt;vendor
comma
l_string|&quot;Unknown Vendor %x&quot;
comma
id|usb_device-&gt;descriptor.idVendor
)paren
suffix:semicolon
r_if
c_cond
(paren
id|usb_device-&gt;descriptor.iProduct
op_eq
l_int|0
op_logical_or
id|usb_string
c_func
(paren
id|usb_device
comma
id|usb_device-&gt;descriptor.iProduct
comma
id|device_info-&gt;product
comma
r_sizeof
(paren
id|device_info-&gt;product
)paren
)paren
OL
l_int|0
)paren
id|sprintf
c_func
(paren
id|device_info-&gt;product
comma
l_string|&quot;Unknown Device %x&quot;
comma
id|usb_device-&gt;descriptor.idProduct
)paren
suffix:semicolon
id|intf
op_assign
id|usb_ifnum_to_if
c_func
(paren
id|usb_device
comma
id|ifnum
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|intf
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|device_info-&gt;ifnum
op_assign
id|ifnum
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;snd-usb-midi: using interface %d&bslash;n&quot;
comma
id|intf-&gt;altsetting
(braket
l_int|0
)braket
dot
id|bInterfaceNumber
)paren
suffix:semicolon
id|intfd
op_assign
id|snd_usbmidi_get_altsetting
c_func
(paren
id|usb_device
comma
id|intf
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|intfd
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;snd-usb-midi: could not determine altsetting&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
id|ms_header
op_assign
(paren
id|usb_ms_header_descriptor_t
op_star
)paren
id|intfd-&gt;extra
suffix:semicolon
r_if
c_cond
(paren
id|intfd-&gt;extralen
op_ge
id|USB_DST_MS_HEADER_SIZE
op_logical_and
id|ms_header-&gt;bLength
op_ge
id|USB_DST_MS_HEADER_SIZE
op_logical_and
id|ms_header-&gt;bDescriptorType
op_eq
id|USB_DT_CS_INTERFACE
op_logical_and
id|ms_header-&gt;bDescriptorSubtype
op_eq
id|USB_DST_MS_HEADER
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;snd-usb-midi: MIDIStreaming version %02x.%02x&bslash;n&quot;
comma
id|ms_header-&gt;bcdMSC
(braket
l_int|1
)braket
comma
id|ms_header-&gt;bcdMSC
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;snd-usb-midi: MIDIStreaming interface descriptor not found&bslash;n&quot;
)paren
suffix:semicolon
id|epidx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|intfd-&gt;bNumEndpoints
suffix:semicolon
op_increment
id|i
)paren
(brace
id|ep
op_assign
op_amp
id|intfd-&gt;endpoint
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ep-&gt;bmAttributes
op_amp
id|USB_ENDPOINT_XFERTYPE_MASK
)paren
op_ne
id|USB_ENDPOINT_XFER_BULK
)paren
r_continue
suffix:semicolon
id|ms_ep
op_assign
(paren
id|usb_ms_endpoint_descriptor_t
op_star
)paren
id|ep-&gt;extra
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;extralen
OL
id|USB_DST_MS_GENERAL_SIZE
op_logical_or
id|ms_ep-&gt;bLength
OL
id|USB_DST_MS_GENERAL_SIZE
op_logical_or
id|ms_ep-&gt;bDescriptorType
op_ne
id|USB_DT_CS_ENDPOINT
op_logical_or
id|ms_ep-&gt;bDescriptorSubtype
op_ne
id|USB_DST_MS_GENERAL
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|device_info-&gt;endpoints
(braket
id|epidx
)braket
dot
id|epnum
op_ne
l_int|0
op_logical_and
id|device_info-&gt;endpoints
(braket
id|epidx
)braket
dot
id|epnum
op_ne
(paren
id|ep-&gt;bEndpointAddress
op_amp
id|USB_ENDPOINT_NUMBER_MASK
)paren
)paren
(brace
op_increment
id|epidx
suffix:semicolon
r_if
c_cond
(paren
id|epidx
op_ge
id|MAX_ENDPOINTS
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;snd-usb-midi: too many endpoints&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|device_info-&gt;endpoints
(braket
id|epidx
)braket
dot
id|epnum
op_assign
id|ep-&gt;bEndpointAddress
op_amp
id|USB_ENDPOINT_NUMBER_MASK
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;bEndpointAddress
op_amp
id|USB_DIR_IN
)paren
(brace
id|device_info-&gt;endpoints
(braket
id|epidx
)braket
dot
id|in_cables
op_assign
(paren
l_int|1
op_lshift
id|ms_ep-&gt;bNumEmbMIDIJack
)paren
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|device_info-&gt;endpoints
(braket
id|epidx
)braket
dot
id|out_cables
op_assign
(paren
l_int|1
op_lshift
id|ms_ep-&gt;bNumEmbMIDIJack
)paren
op_minus
l_int|1
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;snd-usb-midi: detected %d %s jack(s) on endpoint %d&bslash;n&quot;
comma
id|ms_ep-&gt;bNumEmbMIDIJack
comma
id|ep-&gt;bEndpointAddress
op_amp
id|USB_DIR_IN
ques
c_cond
l_string|&quot;input&quot;
suffix:colon
l_string|&quot;output&quot;
comma
id|device_info-&gt;endpoints
(braket
id|epidx
)braket
dot
id|epnum
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Returns device capabilities, either explicitly supplied or from the&n; * class-specific descriptors.&n; */
DECL|function|snd_usbmidi_get_device_info
r_static
r_int
id|snd_usbmidi_get_device_info
c_func
(paren
id|usb_device_t
op_star
id|usb_device
comma
r_int
r_int
id|ifnum
comma
r_const
id|usb_device_id_t
op_star
id|usb_device_id
comma
id|usbmidi_device_info_t
op_star
id|device_info
)paren
(brace
r_if
c_cond
(paren
id|usb_device_id-&gt;driver_info
)paren
(brace
id|usbmidi_device_info_t
op_star
id|id_info
op_assign
(paren
id|usbmidi_device_info_t
op_star
)paren
id|usb_device_id-&gt;driver_info
suffix:semicolon
r_if
c_cond
(paren
id|ifnum
op_ne
id|id_info-&gt;ifnum
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
op_star
id|device_info
op_assign
op_star
id|id_info
suffix:semicolon
r_if
c_cond
(paren
id|snd_usbmidi_detect_endpoint
c_func
(paren
id|usb_device
comma
id|device_info
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|snd_usbmidi_get_ms_info
c_func
(paren
id|usb_device
comma
id|ifnum
comma
id|device_info
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Probes for a supported device.&n; */
DECL|function|snd_usbmidi_usb_probe
r_static
r_void
op_star
id|snd_usbmidi_usb_probe
c_func
(paren
id|usb_device_t
op_star
id|device
comma
r_int
r_int
id|ifnum
comma
r_const
id|usb_device_id_t
op_star
id|device_id
)paren
(brace
id|usbmidi_device_info_t
id|device_info
suffix:semicolon
id|snd_card_t
op_star
id|card
op_assign
l_int|NULL
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|snd_usbmidi_get_device_info
c_func
(paren
id|device
comma
id|ifnum
comma
id|device_id
comma
op_amp
id|device_info
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;snd-usb-midi: detected %s %s&bslash;n&quot;
comma
id|device_info.vendor
comma
id|device_info.product
)paren
suffix:semicolon
id|err
op_assign
id|snd_usbmidi_card_create
c_func
(paren
id|device
comma
op_amp
id|device_info
comma
op_amp
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cannot create card (error code %d)&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
)brace
r_return
id|card
suffix:semicolon
)brace
multiline_comment|/*&n; * Frees the device.&n; */
DECL|function|snd_usbmidi_usb_disconnect
r_static
r_void
id|snd_usbmidi_usb_disconnect
c_func
(paren
id|usb_device_t
op_star
id|usb_device
comma
r_void
op_star
id|ptr
)paren
(brace
id|snd_card_t
op_star
id|card
op_assign
(paren
id|snd_card_t
op_star
)paren
id|ptr
suffix:semicolon
r_int
id|dev
op_assign
(paren
r_int
)paren
id|card-&gt;private_data
suffix:semicolon
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|snd_usbmidi_open_mutex
)paren
suffix:semicolon
id|snd_usbmidi_card_used
(braket
id|dev
)braket
op_assign
l_int|0
suffix:semicolon
id|up
c_func
(paren
op_amp
id|snd_usbmidi_open_mutex
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Information about devices with broken descriptors.&n; */
DECL|variable|snd_usbmidi_yamaha_ux256_info
r_static
id|usbmidi_device_info_t
id|snd_usbmidi_yamaha_ux256_info
op_assign
(brace
multiline_comment|/* from NetBSD&squot;s umidi driver */
dot
id|vendor
op_assign
l_string|&quot;Yamaha&quot;
comma
dot
id|product
op_assign
l_string|&quot;UX256&quot;
comma
dot
id|ifnum
op_assign
l_int|0
comma
dot
id|endpoints
op_assign
(brace
(brace
op_minus
l_int|1
comma
l_int|0xffff
comma
l_int|0x00ff
)brace
)brace
)brace
suffix:semicolon
DECL|variable|snd_usbmidi_yamaha_mu1000_info
r_static
id|usbmidi_device_info_t
id|snd_usbmidi_yamaha_mu1000_info
op_assign
(brace
multiline_comment|/* from Nagano Daisuke&squot;s usb-midi driver */
dot
id|vendor
op_assign
l_string|&quot;Yamaha&quot;
comma
dot
id|product
op_assign
l_string|&quot;MU1000&quot;
comma
dot
id|ifnum
op_assign
l_int|0
comma
dot
id|endpoints
op_assign
(brace
(brace
l_int|1
comma
l_int|0x000f
comma
l_int|0x0001
)brace
)brace
)brace
suffix:semicolon
multiline_comment|/*&n; * There ain&squot;t no such thing as a standard-compliant Roland device.&n; * Apparently, Roland decided not to risk to have wrong entries in the USB&n; * descriptors. The consequence is that class-specific descriptors are&n; * conspicuous by their absence.&n; *&n; * And now you may guess which company was responsible for writing the&n; * USB Device Class Definition for MIDI Devices.&n; */
DECL|variable|snd_usbmidi_roland_ua100_info
r_static
id|usbmidi_device_info_t
id|snd_usbmidi_roland_ua100_info
op_assign
(brace
dot
id|vendor
op_assign
l_string|&quot;Roland&quot;
comma
dot
id|product
op_assign
l_string|&quot;UA-100&quot;
comma
dot
id|ifnum
op_assign
l_int|2
comma
dot
id|endpoints
op_assign
(brace
(brace
op_minus
l_int|1
comma
l_int|0x0007
comma
l_int|0x0007
)brace
)brace
)brace
suffix:semicolon
DECL|variable|snd_usbmidi_roland_um4_info
r_static
id|usbmidi_device_info_t
id|snd_usbmidi_roland_um4_info
op_assign
(brace
dot
id|vendor
op_assign
l_string|&quot;EDIROL&quot;
comma
dot
id|product
op_assign
l_string|&quot;UM-4&quot;
comma
dot
id|ifnum
op_assign
l_int|2
comma
dot
id|endpoints
op_assign
(brace
(brace
op_minus
l_int|1
comma
l_int|0x000f
comma
l_int|0x000f
)brace
)brace
)brace
suffix:semicolon
DECL|variable|snd_usbmidi_roland_sc8850_info
r_static
id|usbmidi_device_info_t
id|snd_usbmidi_roland_sc8850_info
op_assign
(brace
dot
id|vendor
op_assign
l_string|&quot;Roland&quot;
comma
dot
id|product
op_assign
l_string|&quot;SC-8850&quot;
comma
dot
id|ifnum
op_assign
l_int|2
comma
dot
id|endpoints
op_assign
(brace
(brace
op_minus
l_int|1
comma
l_int|0x003f
comma
l_int|0x003f
)brace
)brace
)brace
suffix:semicolon
DECL|variable|snd_usbmidi_roland_u8_info
r_static
id|usbmidi_device_info_t
id|snd_usbmidi_roland_u8_info
op_assign
(brace
dot
id|vendor
op_assign
l_string|&quot;Roland&quot;
comma
dot
id|product
op_assign
l_string|&quot;U-8&quot;
comma
dot
id|ifnum
op_assign
l_int|2
comma
dot
id|endpoints
op_assign
(brace
(brace
op_minus
l_int|1
comma
l_int|0x0003
comma
l_int|0x0003
)brace
)brace
)brace
suffix:semicolon
DECL|variable|snd_usbmidi_roland_um2_info
r_static
id|usbmidi_device_info_t
id|snd_usbmidi_roland_um2_info
op_assign
(brace
dot
id|vendor
op_assign
l_string|&quot;EDIROL&quot;
comma
dot
id|product
op_assign
l_string|&quot;UM-2&quot;
comma
dot
id|ifnum
op_assign
l_int|2
comma
dot
id|endpoints
op_assign
(brace
(brace
op_minus
l_int|1
comma
l_int|0x0003
comma
l_int|0x0003
)brace
)brace
)brace
suffix:semicolon
DECL|variable|snd_usbmidi_roland_sc8820_info
r_static
id|usbmidi_device_info_t
id|snd_usbmidi_roland_sc8820_info
op_assign
(brace
dot
id|vendor
op_assign
l_string|&quot;Roland&quot;
comma
dot
id|product
op_assign
l_string|&quot;SC-8820&quot;
comma
dot
id|ifnum
op_assign
l_int|2
comma
dot
id|endpoints
op_assign
(brace
(brace
op_minus
l_int|1
comma
l_int|0x0013
comma
l_int|0x0013
)brace
)brace
)brace
suffix:semicolon
DECL|variable|snd_usbmidi_roland_pc300_info
r_static
id|usbmidi_device_info_t
id|snd_usbmidi_roland_pc300_info
op_assign
(brace
dot
id|vendor
op_assign
l_string|&quot;Roland&quot;
comma
dot
id|product
op_assign
l_string|&quot;PC-300&quot;
comma
dot
id|ifnum
op_assign
l_int|2
comma
dot
id|endpoints
op_assign
(brace
(brace
op_minus
l_int|1
comma
l_int|0x0001
comma
l_int|0x0001
)brace
)brace
)brace
suffix:semicolon
DECL|variable|snd_usbmidi_roland_um1_info
r_static
id|usbmidi_device_info_t
id|snd_usbmidi_roland_um1_info
op_assign
(brace
dot
id|vendor
op_assign
l_string|&quot;EDIROL&quot;
comma
dot
id|product
op_assign
l_string|&quot;UM-1&quot;
comma
dot
id|ifnum
op_assign
l_int|2
comma
dot
id|endpoints
op_assign
(brace
(brace
op_minus
l_int|1
comma
l_int|0x0001
comma
l_int|0x0001
)brace
)brace
)brace
suffix:semicolon
DECL|variable|snd_usbmidi_roland_sk500_info
r_static
id|usbmidi_device_info_t
id|snd_usbmidi_roland_sk500_info
op_assign
(brace
dot
id|vendor
op_assign
l_string|&quot;Roland&quot;
comma
dot
id|product
op_assign
l_string|&quot;SK-500&quot;
comma
dot
id|ifnum
op_assign
l_int|2
comma
dot
id|endpoints
op_assign
(brace
(brace
op_minus
l_int|1
comma
l_int|0x0013
comma
l_int|0x0013
)brace
)brace
)brace
suffix:semicolon
DECL|variable|snd_usbmidi_roland_scd70_info
r_static
id|usbmidi_device_info_t
id|snd_usbmidi_roland_scd70_info
op_assign
(brace
dot
id|vendor
op_assign
l_string|&quot;Roland&quot;
comma
dot
id|product
op_assign
l_string|&quot;SC-D70&quot;
comma
dot
id|ifnum
op_assign
l_int|2
comma
dot
id|endpoints
op_assign
(brace
(brace
op_minus
l_int|1
comma
l_int|0x0007
comma
l_int|0x0007
)brace
)brace
)brace
suffix:semicolon
DECL|variable|snd_usbmidi_roland_xv5050_info
r_static
id|usbmidi_device_info_t
id|snd_usbmidi_roland_xv5050_info
op_assign
(brace
dot
id|vendor
op_assign
l_string|&quot;Roland&quot;
comma
dot
id|product
op_assign
l_string|&quot;XV-5050&quot;
comma
dot
id|ifnum
op_assign
l_int|0
comma
dot
id|endpoints
op_assign
(brace
(brace
op_minus
l_int|1
comma
l_int|0x0001
comma
l_int|0x0001
)brace
)brace
)brace
suffix:semicolon
DECL|variable|snd_usbmidi_roland_um880_info
r_static
id|usbmidi_device_info_t
id|snd_usbmidi_roland_um880_info
op_assign
(brace
dot
id|vendor
op_assign
l_string|&quot;EDIROL&quot;
comma
dot
id|product
op_assign
l_string|&quot;UM-880&quot;
comma
dot
id|ifnum
op_assign
l_int|0
comma
dot
id|endpoints
op_assign
(brace
(brace
op_minus
l_int|1
comma
l_int|0x01ff
comma
l_int|0x01ff
)brace
)brace
)brace
suffix:semicolon
DECL|variable|snd_usbmidi_roland_sd90_info
r_static
id|usbmidi_device_info_t
id|snd_usbmidi_roland_sd90_info
op_assign
(brace
dot
id|vendor
op_assign
l_string|&quot;EDIROL&quot;
comma
dot
id|product
op_assign
l_string|&quot;SD-90&quot;
comma
dot
id|ifnum
op_assign
l_int|2
comma
dot
id|endpoints
op_assign
(brace
(brace
op_minus
l_int|1
comma
l_int|0x000f
comma
l_int|0x000f
)brace
)brace
)brace
suffix:semicolon
DECL|variable|snd_usbmidi_roland_um550_info
r_static
id|usbmidi_device_info_t
id|snd_usbmidi_roland_um550_info
op_assign
(brace
dot
id|vendor
op_assign
l_string|&quot;EDIROL&quot;
comma
dot
id|product
op_assign
l_string|&quot;UM-550&quot;
comma
dot
id|ifnum
op_assign
l_int|0
comma
dot
id|endpoints
op_assign
(brace
(brace
op_minus
l_int|1
comma
l_int|0x003f
comma
l_int|0x003f
)brace
)brace
)brace
suffix:semicolon
DECL|variable|snd_usbmidi_roland_sd20_info
r_static
id|usbmidi_device_info_t
id|snd_usbmidi_roland_sd20_info
op_assign
(brace
dot
id|vendor
op_assign
l_string|&quot;EDIROL&quot;
comma
dot
id|product
op_assign
l_string|&quot;SD-20&quot;
comma
dot
id|ifnum
op_assign
l_int|0
comma
dot
id|endpoints
op_assign
(brace
(brace
op_minus
l_int|1
comma
l_int|0x0003
comma
l_int|0x0007
)brace
)brace
)brace
suffix:semicolon
DECL|variable|snd_usbmidi_roland_sd80_info
r_static
id|usbmidi_device_info_t
id|snd_usbmidi_roland_sd80_info
op_assign
(brace
dot
id|vendor
op_assign
l_string|&quot;EDIROL&quot;
comma
dot
id|product
op_assign
l_string|&quot;SD-80&quot;
comma
dot
id|ifnum
op_assign
l_int|0
comma
dot
id|endpoints
op_assign
(brace
(brace
op_minus
l_int|1
comma
l_int|0x000f
comma
l_int|0x000f
)brace
)brace
)brace
suffix:semicolon
DECL|variable|snd_usbmidi_roland_ua700_info
r_static
id|usbmidi_device_info_t
id|snd_usbmidi_roland_ua700_info
op_assign
(brace
dot
id|vendor
op_assign
l_string|&quot;EDIROL&quot;
comma
dot
id|product
op_assign
l_string|&quot;UA-700&quot;
comma
dot
id|ifnum
op_assign
l_int|3
comma
dot
id|endpoints
op_assign
(brace
(brace
op_minus
l_int|1
comma
l_int|0x0003
comma
l_int|0x0003
)brace
)brace
)brace
suffix:semicolon
DECL|macro|USBMIDI_NONCOMPLIANT_DEVICE
mdefine_line|#define USBMIDI_NONCOMPLIANT_DEVICE(vid, pid, name) &bslash;&n;&t;&t;USB_DEVICE(vid, pid), &bslash;&n;&t;&t;driver_info: (unsigned long)&amp;snd_usbmidi_##name##_info
DECL|variable|snd_usbmidi_usb_id_table
r_static
id|usb_device_id_t
id|snd_usbmidi_usb_id_table
(braket
)braket
op_assign
(brace
(brace
id|match_flags
suffix:colon
id|USB_DEVICE_ID_MATCH_INT_CLASS
op_or
id|USB_DEVICE_ID_MATCH_INT_SUBCLASS
comma
id|bInterfaceClass
suffix:colon
id|USB_CLASS_AUDIO
comma
id|bInterfaceSubClass
suffix:colon
id|USB_SUBCLASS_MIDISTREAMING
)brace
comma
(brace
id|USBMIDI_NONCOMPLIANT_DEVICE
c_func
(paren
l_int|0x0499
comma
l_int|0x1000
comma
id|yamaha_ux256
)paren
)brace
comma
(brace
id|USBMIDI_NONCOMPLIANT_DEVICE
c_func
(paren
l_int|0x0499
comma
l_int|0x1001
comma
id|yamaha_mu1000
)paren
)brace
comma
(brace
id|USBMIDI_NONCOMPLIANT_DEVICE
c_func
(paren
l_int|0x0582
comma
l_int|0x0000
comma
id|roland_ua100
)paren
)brace
comma
(brace
id|USBMIDI_NONCOMPLIANT_DEVICE
c_func
(paren
l_int|0x0582
comma
l_int|0x0002
comma
id|roland_um4
)paren
)brace
comma
(brace
id|USBMIDI_NONCOMPLIANT_DEVICE
c_func
(paren
l_int|0x0582
comma
l_int|0x0003
comma
id|roland_sc8850
)paren
)brace
comma
(brace
id|USBMIDI_NONCOMPLIANT_DEVICE
c_func
(paren
l_int|0x0582
comma
l_int|0x0004
comma
id|roland_u8
)paren
)brace
comma
(brace
id|USBMIDI_NONCOMPLIANT_DEVICE
c_func
(paren
l_int|0x0582
comma
l_int|0x0005
comma
id|roland_um2
)paren
)brace
comma
(brace
id|USBMIDI_NONCOMPLIANT_DEVICE
c_func
(paren
l_int|0x0582
comma
l_int|0x0007
comma
id|roland_sc8820
)paren
)brace
comma
(brace
id|USBMIDI_NONCOMPLIANT_DEVICE
c_func
(paren
l_int|0x0582
comma
l_int|0x0008
comma
id|roland_pc300
)paren
)brace
comma
(brace
id|USBMIDI_NONCOMPLIANT_DEVICE
c_func
(paren
l_int|0x0582
comma
l_int|0x0009
comma
id|roland_um1
)paren
)brace
comma
(brace
id|USBMIDI_NONCOMPLIANT_DEVICE
c_func
(paren
l_int|0x0582
comma
l_int|0x000b
comma
id|roland_sk500
)paren
)brace
comma
(brace
id|USBMIDI_NONCOMPLIANT_DEVICE
c_func
(paren
l_int|0x0582
comma
l_int|0x000c
comma
id|roland_scd70
)paren
)brace
comma
(brace
id|USBMIDI_NONCOMPLIANT_DEVICE
c_func
(paren
l_int|0x0582
comma
l_int|0x0012
comma
id|roland_xv5050
)paren
)brace
comma
(brace
id|USBMIDI_NONCOMPLIANT_DEVICE
c_func
(paren
l_int|0x0582
comma
l_int|0x0014
comma
id|roland_um880
)paren
)brace
comma
(brace
id|USBMIDI_NONCOMPLIANT_DEVICE
c_func
(paren
l_int|0x0582
comma
l_int|0x0016
comma
id|roland_sd90
)paren
)brace
comma
(brace
id|USBMIDI_NONCOMPLIANT_DEVICE
c_func
(paren
l_int|0x0582
comma
l_int|0x0023
comma
id|roland_um550
)paren
)brace
comma
(brace
id|USBMIDI_NONCOMPLIANT_DEVICE
c_func
(paren
l_int|0x0582
comma
l_int|0x0027
comma
id|roland_sd20
)paren
)brace
comma
(brace
id|USBMIDI_NONCOMPLIANT_DEVICE
c_func
(paren
l_int|0x0582
comma
l_int|0x0029
comma
id|roland_sd80
)paren
)brace
comma
(brace
id|USBMIDI_NONCOMPLIANT_DEVICE
c_func
(paren
l_int|0x0582
comma
l_int|0x002b
comma
id|roland_ua700
)paren
)brace
comma
(brace
multiline_comment|/* terminator */
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|usb
comma
id|snd_usbmidi_usb_id_table
)paren
suffix:semicolon
DECL|variable|snd_usbmidi_usb_driver
r_static
id|usb_driver_t
id|snd_usbmidi_usb_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;snd-usb-midi&quot;
comma
dot
id|probe
op_assign
id|snd_usbmidi_usb_probe
comma
dot
id|disconnect
op_assign
id|snd_usbmidi_usb_disconnect
comma
dot
id|id_table
op_assign
id|snd_usbmidi_usb_id_table
comma
dot
id|driver_list
op_assign
id|LIST_HEAD_INIT
c_func
(paren
id|snd_usbmidi_usb_driver.driver_list
)paren
)brace
suffix:semicolon
DECL|function|snd_usbmidi_module_init
r_static
r_int
id|__init
id|snd_usbmidi_module_init
c_func
(paren
r_void
)paren
(brace
r_static
id|snd_seq_dev_ops_t
id|ops
op_assign
(brace
id|snd_usbmidi_seq_device_new
comma
id|snd_usbmidi_seq_device_delete
)brace
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|snd_seq_device_register_driver
c_func
(paren
id|SNDRV_SEQ_DEV_ID_USBMIDI
comma
op_amp
id|ops
comma
r_sizeof
(paren
id|usbmidi_t
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|err
op_assign
id|usb_register
c_func
(paren
op_amp
id|snd_usbmidi_usb_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_seq_device_unregister_driver
c_func
(paren
id|SNDRV_SEQ_DEV_ID_USBMIDI
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_usbmidi_module_exit
r_static
r_void
id|__exit
id|snd_usbmidi_module_exit
c_func
(paren
r_void
)paren
(brace
id|usb_deregister
c_func
(paren
op_amp
id|snd_usbmidi_usb_driver
)paren
suffix:semicolon
id|snd_seq_device_unregister_driver
c_func
(paren
id|SNDRV_SEQ_DEV_ID_USBMIDI
)paren
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|snd_usbmidi_module_init
)paren
id|module_exit
c_func
(paren
id|snd_usbmidi_module_exit
)paren
macro_line|#ifndef MODULE
multiline_comment|/*&n; * format is snd-usb-midi=snd_enable,snd_index,snd_id,&n; *                        snd_vid,snd_pid,snd_int_transfer&n; */
DECL|function|snd_usbmidi_module_setup
r_static
r_int
id|__init
id|snd_usbmidi_module_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_static
r_int
id|__initdata
id|nr_dev
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|nr_dev
op_ge
id|SNDRV_CARDS
)paren
r_return
l_int|0
suffix:semicolon
(paren
r_void
)paren
(paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_enable
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_index
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_id
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_id
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_vid
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_pid
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|snd_int_transfer
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
)paren
suffix:semicolon
op_increment
id|nr_dev
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;snd-usb-midi=&quot;
comma
id|snd_usbmidi_module_setup
)paren
suffix:semicolon
macro_line|#endif /* !MODULE */
eof
