multiline_comment|/*&n; * usbmidi.c - ALSA USB MIDI driver&n; *&n; * Copyright (c) 2002 Clemens Ladisch&n; * All rights reserved.&n; *&n; * Redistribution and use in source and binary forms, with or without&n; * modification, are permitted provided that the following conditions&n; * are met:&n; * 1. Redistributions of source code must retain the above copyright&n; *    notice, this list of conditions, and the following disclaimer,&n; *    without modification.&n; * 2. The name of the author may not be used to endorse or promote products&n; *    derived from this software without specific prior written permission.&n; *&n; * Alternatively, this software may be distributed and/or modified under the&n; * terms of the GNU General Public License as published by the Free Software&n; * Foundation; either version 2 of the License, or (at your option) any later&n; * version.&n; *&n; * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS&squot;&squot; AND&n; * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE&n; * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE&n; * ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE FOR&n; * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL&n; * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS&n; * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)&n; * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT&n; * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY&n; * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF&n; * SUCH DAMAGE.&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/usb.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/minors.h&gt;
macro_line|#include &lt;sound/asequencer.h&gt;
macro_line|#include &lt;sound/seq_device.h&gt;
macro_line|#include &lt;sound/seq_kernel.h&gt;
macro_line|#include &lt;sound/seq_virmidi.h&gt;
macro_line|#include &lt;sound/seq_midi_event.h&gt;
macro_line|#include &lt;sound/initval.h&gt;
macro_line|#include &quot;usbaudio.h&quot;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Clemens Ladisch &lt;clemens@ladisch.de&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;USB MIDI&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;Dual BSD/GPL&quot;
)paren
suffix:semicolon
id|MODULE_CLASSES
c_func
(paren
l_string|&quot;{sound}&quot;
)paren
suffix:semicolon
multiline_comment|/* size of the per-endpoint output buffer, must be a multiple of 4 */
DECL|macro|OUTPUT_BUFFER_SIZE
mdefine_line|#define OUTPUT_BUFFER_SIZE 0x400
multiline_comment|/* max. size of incoming sysex messages */
DECL|macro|INPUT_BUFFER_SIZE
mdefine_line|#define INPUT_BUFFER_SIZE 0x200
DECL|typedef|usb_driver_t
r_typedef
r_struct
id|usb_driver
id|usb_driver_t
suffix:semicolon
DECL|typedef|usb_device_t
r_typedef
r_struct
id|usb_device
id|usb_device_t
suffix:semicolon
DECL|typedef|usb_device_id_t
r_typedef
r_struct
id|usb_device_id
id|usb_device_id_t
suffix:semicolon
DECL|typedef|usb_interface_t
r_typedef
r_struct
id|usb_interface
id|usb_interface_t
suffix:semicolon
DECL|typedef|usb_interface_descriptor_t
r_typedef
r_struct
id|usb_interface_descriptor
id|usb_interface_descriptor_t
suffix:semicolon
DECL|typedef|usb_ms_header_descriptor_t
r_typedef
r_struct
id|usb_ms_header_descriptor
id|usb_ms_header_descriptor_t
suffix:semicolon
DECL|typedef|usb_endpoint_descriptor_t
r_typedef
r_struct
id|usb_endpoint_descriptor
id|usb_endpoint_descriptor_t
suffix:semicolon
DECL|typedef|usb_ms_endpoint_descriptor_t
r_typedef
r_struct
id|usb_ms_endpoint_descriptor
id|usb_ms_endpoint_descriptor_t
suffix:semicolon
DECL|struct|usb_ms_header_descriptor
r_struct
id|usb_ms_header_descriptor
(brace
DECL|member|bLength
id|__u8
id|bLength
suffix:semicolon
DECL|member|bDescriptorType
id|__u8
id|bDescriptorType
suffix:semicolon
DECL|member|bDescriptorSubtype
id|__u8
id|bDescriptorSubtype
suffix:semicolon
DECL|member|bcdMSC
id|__u8
id|bcdMSC
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|wTotalLength
id|__u16
id|wTotalLength
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|struct|usb_ms_endpoint_descriptor
r_struct
id|usb_ms_endpoint_descriptor
(brace
DECL|member|bLength
id|__u8
id|bLength
suffix:semicolon
DECL|member|bDescriptorType
id|__u8
id|bDescriptorType
suffix:semicolon
DECL|member|bDescriptorSubtype
id|__u8
id|bDescriptorSubtype
suffix:semicolon
DECL|member|bNumEmbMIDIJack
id|__u8
id|bNumEmbMIDIJack
suffix:semicolon
DECL|member|baAssocJackID
id|__u8
id|baAssocJackID
(braket
l_int|0
)braket
suffix:semicolon
)brace
id|__attribute__
(paren
(paren
id|packed
)paren
)paren
suffix:semicolon
DECL|typedef|usbmidi_out_port_t
r_typedef
r_struct
id|usbmidi_out_port
id|usbmidi_out_port_t
suffix:semicolon
DECL|typedef|usbmidi_in_port_t
r_typedef
r_struct
id|usbmidi_in_port
id|usbmidi_in_port_t
suffix:semicolon
DECL|struct|snd_usb_midi_out_endpoint
r_struct
id|snd_usb_midi_out_endpoint
(brace
DECL|member|umidi
id|snd_usb_midi_t
op_star
id|umidi
suffix:semicolon
DECL|member|urb
r_struct
id|urb
op_star
id|urb
suffix:semicolon
DECL|member|max_transfer
r_int
id|max_transfer
suffix:semicolon
multiline_comment|/* size of urb buffer */
DECL|member|tasklet
r_struct
id|tasklet_struct
id|tasklet
suffix:semicolon
DECL|member|buffer
r_uint8
id|buffer
(braket
id|OUTPUT_BUFFER_SIZE
)braket
suffix:semicolon
multiline_comment|/* ring buffer */
DECL|member|data_begin
r_int
id|data_begin
suffix:semicolon
DECL|member|data_size
r_int
id|data_size
suffix:semicolon
DECL|member|buffer_lock
id|spinlock_t
id|buffer_lock
suffix:semicolon
DECL|struct|usbmidi_out_port
r_struct
id|usbmidi_out_port
(brace
DECL|member|ep
id|snd_usb_midi_out_endpoint_t
op_star
id|ep
suffix:semicolon
DECL|member|cable
r_uint8
id|cable
suffix:semicolon
multiline_comment|/* cable number &lt;&lt; 4 */
DECL|member|sysex_len
r_uint8
id|sysex_len
suffix:semicolon
DECL|member|sysex
r_uint8
id|sysex
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|ports
)brace
id|ports
(braket
l_int|0x10
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|snd_usb_midi_in_endpoint
r_struct
id|snd_usb_midi_in_endpoint
(brace
DECL|member|umidi
id|snd_usb_midi_t
op_star
id|umidi
suffix:semicolon
DECL|member|ep
id|snd_usb_midi_endpoint_t
op_star
id|ep
suffix:semicolon
DECL|member|urb
r_struct
id|urb
op_star
id|urb
suffix:semicolon
DECL|struct|usbmidi_in_port
r_struct
id|usbmidi_in_port
(brace
DECL|member|seq_port
r_int
id|seq_port
suffix:semicolon
DECL|member|midi_event
id|snd_midi_event_t
op_star
id|midi_event
suffix:semicolon
DECL|member|ports
)brace
id|ports
(braket
l_int|0x10
)braket
suffix:semicolon
)brace
suffix:semicolon
r_static
r_void
id|snd_usbmidi_do_output
c_func
(paren
id|snd_usb_midi_out_endpoint_t
op_star
id|ep
)paren
suffix:semicolon
multiline_comment|/*&n; * Submits the URB, with error handling.&n; */
DECL|function|snd_usbmidi_submit_urb
r_static
r_int
id|snd_usbmidi_submit_urb
c_func
(paren
r_struct
id|urb
op_star
id|urb
comma
r_int
id|flags
)paren
(brace
r_int
id|err
op_assign
id|usb_submit_urb
c_func
(paren
id|urb
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
op_logical_and
id|err
op_ne
op_minus
id|ENODEV
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;snd-usb-midi: usb_submit_urb: %d&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; * Error handling for URB completion functions.&n; */
DECL|function|snd_usbmidi_urb_error
r_static
r_int
id|snd_usbmidi_urb_error
c_func
(paren
r_int
id|status
)paren
(brace
r_if
c_cond
(paren
id|status
op_eq
op_minus
id|ENOENT
)paren
r_return
id|status
suffix:semicolon
multiline_comment|/* killed */
r_if
c_cond
(paren
id|status
op_eq
op_minus
id|ENODEV
op_logical_or
id|status
op_eq
op_minus
id|EILSEQ
op_logical_or
id|status
op_eq
op_minus
id|ETIMEDOUT
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/* device removed */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;snd-usb-midi: urb status %d&bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* continue */
)brace
multiline_comment|/*&n; * Converts a USB MIDI packet into an ALSA sequencer event.&n; */
DECL|function|snd_usbmidi_input_packet
r_static
r_void
id|snd_usbmidi_input_packet
c_func
(paren
id|snd_usb_midi_in_endpoint_t
op_star
id|ep
comma
r_uint8
id|packet
(braket
l_int|4
)braket
)paren
(brace
r_static
r_const
r_uint8
id|cin_length
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|2
comma
l_int|3
comma
l_int|3
comma
l_int|1
comma
l_int|2
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|3
comma
l_int|2
comma
l_int|2
comma
l_int|3
comma
l_int|1
)brace
suffix:semicolon
r_int
id|cable
op_assign
id|packet
(braket
l_int|0
)braket
op_rshift
l_int|4
suffix:semicolon
id|usbmidi_in_port_t
op_star
id|port
op_assign
op_amp
id|ep-&gt;ports
(braket
id|cable
)braket
suffix:semicolon
id|snd_seq_event_t
id|ev
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|port-&gt;midi_event
)paren
r_return
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|ev
comma
l_int|0
comma
r_sizeof
(paren
id|ev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_midi_event_encode
c_func
(paren
id|port-&gt;midi_event
comma
op_amp
id|packet
(braket
l_int|1
)braket
comma
id|cin_length
(braket
id|packet
(braket
l_int|0
)braket
op_amp
l_int|0x0f
)braket
comma
op_amp
id|ev
)paren
OG
l_int|0
op_logical_and
id|ev.type
op_ne
id|SNDRV_SEQ_EVENT_NONE
)paren
(brace
id|ev.source.port
op_assign
id|port-&gt;seq_port
suffix:semicolon
id|ev.dest.client
op_assign
id|SNDRV_SEQ_ADDRESS_SUBSCRIBERS
suffix:semicolon
id|snd_seq_kernel_client_dispatch
c_func
(paren
id|ep-&gt;umidi-&gt;seq_client
comma
op_amp
id|ev
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;ep-&gt;rmidi
(braket
id|cable
)braket
)paren
id|snd_virmidi_receive
c_func
(paren
id|ep-&gt;ep-&gt;rmidi
(braket
id|cable
)braket
comma
op_amp
id|ev
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Processes the data read from the device.&n; */
DECL|function|snd_usbmidi_in_urb_complete
r_static
r_void
id|snd_usbmidi_in_urb_complete
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
(brace
id|snd_usb_midi_in_endpoint_t
op_star
id|ep
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_usb_midi_in_endpoint_t
comma
id|urb-&gt;context
comma
r_return
)paren
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
op_eq
l_int|0
)paren
(brace
r_uint8
op_star
id|buffer
op_assign
(paren
r_uint8
op_star
)paren
id|ep-&gt;urb-&gt;transfer_buffer
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_plus
l_int|4
op_le
id|urb-&gt;actual_length
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
r_if
c_cond
(paren
id|buffer
(braket
id|i
)braket
op_ne
l_int|0
)paren
id|snd_usbmidi_input_packet
c_func
(paren
id|ep
comma
op_amp
id|buffer
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|snd_usbmidi_urb_error
c_func
(paren
id|urb-&gt;status
)paren
OL
l_int|0
)paren
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|usb_pipeint
c_func
(paren
id|urb-&gt;pipe
)paren
)paren
(brace
id|urb-&gt;dev
op_assign
id|ep-&gt;umidi-&gt;chip-&gt;dev
suffix:semicolon
id|snd_usbmidi_submit_urb
c_func
(paren
id|urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_usbmidi_out_urb_complete
r_static
r_void
id|snd_usbmidi_out_urb_complete
c_func
(paren
r_struct
id|urb
op_star
id|urb
)paren
(brace
id|snd_usb_midi_out_endpoint_t
op_star
id|ep
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_usb_midi_out_endpoint_t
comma
id|urb-&gt;context
comma
r_return
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|urb-&gt;status
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|snd_usbmidi_urb_error
c_func
(paren
id|urb-&gt;status
)paren
OL
l_int|0
)paren
r_return
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ep-&gt;buffer_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_usbmidi_do_output
c_func
(paren
id|ep
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ep-&gt;buffer_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * This is called when some data should be transferred to the device&n; * (after the reception of one or more sequencer events, or after completion&n; * of the previous transfer). ep-&gt;buffer_lock must be held.&n; */
DECL|function|snd_usbmidi_do_output
r_static
r_void
id|snd_usbmidi_do_output
c_func
(paren
id|snd_usb_midi_out_endpoint_t
op_star
id|ep
)paren
(brace
r_int
id|len
suffix:semicolon
r_uint8
op_star
id|buffer
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;urb-&gt;status
op_eq
op_minus
id|EINPROGRESS
op_logical_or
id|ep-&gt;data_size
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|buffer
op_assign
(paren
r_uint8
op_star
)paren
id|ep-&gt;urb-&gt;transfer_buffer
suffix:semicolon
multiline_comment|/* first chunk, up to the end of the buffer */
id|len
op_assign
id|OUTPUT_BUFFER_SIZE
op_minus
id|ep-&gt;data_begin
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|ep-&gt;data_size
)paren
id|len
op_assign
id|ep-&gt;data_size
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|ep-&gt;max_transfer
)paren
id|len
op_assign
id|ep-&gt;max_transfer
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|0
)paren
(brace
id|memcpy
c_func
(paren
id|buffer
comma
id|ep-&gt;buffer
op_plus
id|ep-&gt;data_begin
comma
id|len
)paren
suffix:semicolon
id|ep-&gt;data_begin
op_assign
(paren
id|ep-&gt;data_begin
op_plus
id|len
)paren
op_mod
id|OUTPUT_BUFFER_SIZE
suffix:semicolon
id|ep-&gt;data_size
op_sub_assign
id|len
suffix:semicolon
id|buffer
op_add_assign
id|len
suffix:semicolon
id|ep-&gt;urb-&gt;transfer_buffer_length
op_assign
id|len
suffix:semicolon
)brace
multiline_comment|/* second chunk (after wraparound) */
r_if
c_cond
(paren
id|ep-&gt;data_begin
op_eq
l_int|0
op_logical_and
id|ep-&gt;data_size
OG
l_int|0
op_logical_and
id|len
OL
id|ep-&gt;max_transfer
)paren
(brace
id|len
op_assign
id|ep-&gt;max_transfer
op_minus
id|len
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|ep-&gt;data_size
)paren
id|len
op_assign
id|ep-&gt;data_size
suffix:semicolon
id|memcpy
c_func
(paren
id|buffer
comma
id|ep-&gt;buffer
comma
id|len
)paren
suffix:semicolon
id|ep-&gt;data_begin
op_assign
id|len
suffix:semicolon
id|ep-&gt;data_size
op_sub_assign
id|len
suffix:semicolon
id|ep-&gt;urb-&gt;transfer_buffer_length
op_add_assign
id|len
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
OG
l_int|0
)paren
(brace
id|ep-&gt;urb-&gt;dev
op_assign
id|ep-&gt;umidi-&gt;chip-&gt;dev
suffix:semicolon
id|snd_usbmidi_submit_urb
c_func
(paren
id|ep-&gt;urb
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_usbmidi_out_tasklet
r_static
r_void
id|snd_usbmidi_out_tasklet
c_func
(paren
r_int
r_int
id|data
)paren
(brace
id|snd_usb_midi_out_endpoint_t
op_star
id|ep
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_usb_midi_out_endpoint_t
comma
(paren
r_void
op_star
)paren
id|data
comma
r_return
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ep-&gt;buffer_lock
comma
id|flags
)paren
suffix:semicolon
id|snd_usbmidi_do_output
c_func
(paren
id|ep
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ep-&gt;buffer_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Adds one USB MIDI packet to the output buffer.&n; */
DECL|function|output_packet
r_static
r_void
id|output_packet
c_func
(paren
id|usbmidi_out_port_t
op_star
id|port
comma
r_uint8
id|p0
comma
r_uint8
id|p1
comma
r_uint8
id|p2
comma
r_uint8
id|p3
)paren
(brace
id|snd_usb_midi_out_endpoint_t
op_star
id|ep
op_assign
id|port-&gt;ep
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|ep-&gt;buffer_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;data_size
OL
id|OUTPUT_BUFFER_SIZE
)paren
(brace
r_uint8
op_star
id|buf
op_assign
id|ep-&gt;buffer
op_plus
(paren
id|ep-&gt;data_begin
op_plus
id|ep-&gt;data_size
)paren
op_mod
id|OUTPUT_BUFFER_SIZE
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
id|p0
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
id|p1
suffix:semicolon
id|buf
(braket
l_int|2
)braket
op_assign
id|p2
suffix:semicolon
id|buf
(braket
l_int|3
)braket
op_assign
id|p3
suffix:semicolon
id|ep-&gt;data_size
op_add_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;data_size
op_eq
id|ep-&gt;max_transfer
)paren
id|snd_usbmidi_do_output
c_func
(paren
id|ep
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|ep-&gt;buffer_lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Callback for snd_seq_dump_var_event.&n; */
DECL|function|snd_usbmidi_sysex_dump
r_static
r_int
id|snd_usbmidi_sysex_dump
c_func
(paren
r_void
op_star
id|ptr
comma
r_void
op_star
id|buf
comma
r_int
id|count
)paren
(brace
id|usbmidi_out_port_t
op_star
id|port
op_assign
(paren
id|usbmidi_out_port_t
op_star
)paren
id|ptr
suffix:semicolon
r_const
r_uint8
op_star
id|dump
op_assign
(paren
r_const
r_uint8
op_star
)paren
id|buf
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|count
suffix:semicolon
op_decrement
id|count
)paren
(brace
r_uint8
id|byte
op_assign
op_star
id|dump
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|byte
op_eq
l_int|0xf0
op_logical_and
id|port-&gt;sysex_len
OG
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * The previous SysEx wasn&squot;t terminated correctly.&n;&t;&t;&t; * Send the last bytes anyway, and hope that the&n;&t;&t;&t; * receiving device won&squot;t be too upset about the&n;&t;&t;&t; * missing F7.&n;&t;&t;&t; */
id|output_packet
c_func
(paren
id|port
comma
id|port-&gt;cable
op_or
(paren
l_int|0x04
op_plus
id|port-&gt;sysex_len
)paren
comma
id|port-&gt;sysex
(braket
l_int|0
)braket
comma
id|port-&gt;sysex_len
op_ge
l_int|2
ques
c_cond
id|port-&gt;sysex
(braket
l_int|1
)braket
suffix:colon
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|port-&gt;sysex_len
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|byte
op_ne
l_int|0xf7
)paren
(brace
r_if
c_cond
(paren
id|port-&gt;sysex_len
op_ge
l_int|2
)paren
(brace
id|output_packet
c_func
(paren
id|port
comma
id|port-&gt;cable
op_or
l_int|0x04
comma
id|port-&gt;sysex
(braket
l_int|0
)braket
comma
id|port-&gt;sysex
(braket
l_int|1
)braket
comma
id|byte
)paren
suffix:semicolon
id|port-&gt;sysex_len
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|port-&gt;sysex
(braket
id|port-&gt;sysex_len
op_increment
)braket
op_assign
id|byte
suffix:semicolon
)brace
)brace
r_else
(brace
r_uint8
id|cin
comma
id|data
(braket
l_int|3
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|port-&gt;sysex_len
suffix:semicolon
op_increment
id|i
)paren
id|data
(braket
id|i
)braket
op_assign
id|port-&gt;sysex
(braket
id|i
)braket
suffix:semicolon
id|data
(braket
id|i
op_increment
)braket
op_assign
l_int|0xf7
suffix:semicolon
id|cin
op_assign
id|port-&gt;cable
op_or
(paren
l_int|0x04
op_plus
id|i
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
op_increment
id|i
)paren
id|data
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * cin,data[] is x5,{F7 00 00}&n;&t;&t;&t; *            or x6,{xx F7 00}&n;&t;&t;&t; *            or x7,{xx xx F7}&n;&t;&t;&t; */
id|output_packet
c_func
(paren
id|port
comma
id|cin
comma
id|data
(braket
l_int|0
)braket
comma
id|data
(braket
l_int|1
)braket
comma
id|data
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|port-&gt;sysex_len
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Converts an ALSA sequencer event into USB MIDI packets.&n; */
DECL|function|snd_usbmidi_event_input
r_static
r_int
id|snd_usbmidi_event_input
c_func
(paren
id|snd_seq_event_t
op_star
id|ev
comma
r_int
id|direct
comma
r_void
op_star
id|private_data
comma
r_int
id|atomic
comma
r_int
id|hop
)paren
(brace
id|usbmidi_out_port_t
op_star
id|port
op_assign
(paren
id|usbmidi_out_port_t
op_star
)paren
id|private_data
suffix:semicolon
r_int
id|err
suffix:semicolon
r_uint8
id|p0
comma
id|p1
suffix:semicolon
id|p0
op_assign
id|port-&gt;cable
suffix:semicolon
id|p1
op_assign
id|ev-&gt;data.note.channel
op_amp
l_int|0xf
suffix:semicolon
r_switch
c_cond
(paren
id|ev-&gt;type
)paren
(brace
r_case
id|SNDRV_SEQ_EVENT_NOTEON
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x09
comma
id|p1
op_or
l_int|0x90
comma
id|ev-&gt;data.note.note
op_amp
l_int|0x7f
comma
id|ev-&gt;data.note.velocity
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_NOTEOFF
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x08
comma
id|p1
op_or
l_int|0x80
comma
id|ev-&gt;data.note.note
op_amp
l_int|0x7f
comma
id|ev-&gt;data.note.velocity
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_KEYPRESS
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0a
comma
id|p1
op_or
l_int|0xa0
comma
id|ev-&gt;data.note.note
op_amp
l_int|0x7f
comma
id|ev-&gt;data.note.velocity
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_CONTROLLER
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0b
comma
id|p1
op_or
l_int|0xb0
comma
id|ev-&gt;data.control.param
op_amp
l_int|0x7f
comma
id|ev-&gt;data.control.value
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_PGMCHANGE
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0c
comma
id|p1
op_or
l_int|0xc0
comma
id|ev-&gt;data.control.value
op_amp
l_int|0x7f
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_CHANPRESS
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0d
comma
id|p1
op_or
l_int|0xd0
comma
id|ev-&gt;data.control.value
op_amp
l_int|0x7f
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_PITCHBEND
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0e
comma
id|p1
op_or
l_int|0xe0
comma
(paren
id|ev-&gt;data.control.value
op_plus
l_int|0x2000
)paren
op_amp
l_int|0x7f
comma
(paren
(paren
id|ev-&gt;data.control.value
op_plus
l_int|0x2000
)paren
op_rshift
l_int|7
)paren
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_CONTROL14
suffix:colon
r_if
c_cond
(paren
id|ev-&gt;data.control.param
OL
l_int|0x20
)paren
(brace
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0b
comma
id|p1
op_or
l_int|0xb0
comma
id|ev-&gt;data.control.param
comma
(paren
id|ev-&gt;data.control.value
op_rshift
l_int|7
)paren
op_amp
l_int|0x7f
)paren
suffix:semicolon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0b
comma
id|p1
op_or
l_int|0xb0
comma
id|ev-&gt;data.control.param
op_plus
l_int|0x20
comma
id|ev-&gt;data.control.value
op_amp
l_int|0x7f
)paren
suffix:semicolon
)brace
r_else
(brace
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0b
comma
id|p1
op_or
l_int|0xb0
comma
id|ev-&gt;data.control.param
op_amp
l_int|0x7f
comma
id|ev-&gt;data.control.value
op_amp
l_int|0x7f
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_SONGPOS
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x03
comma
l_int|0xf2
comma
id|ev-&gt;data.control.value
op_amp
l_int|0x7f
comma
(paren
id|ev-&gt;data.control.value
op_rshift
l_int|7
)paren
op_amp
l_int|0x7f
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_SONGSEL
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x02
comma
l_int|0xf3
comma
id|ev-&gt;data.control.value
op_amp
l_int|0x7f
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_QFRAME
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x02
comma
l_int|0xf1
comma
id|ev-&gt;data.control.value
op_amp
l_int|0x7f
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_START
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0f
comma
l_int|0xfa
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_CONTINUE
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0f
comma
l_int|0xfb
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_STOP
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0f
comma
l_int|0xfc
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_CLOCK
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0f
comma
l_int|0xf8
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_TUNE_REQUEST
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x05
comma
l_int|0xf6
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_RESET
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0f
comma
l_int|0xff
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_SENSING
suffix:colon
id|output_packet
c_func
(paren
id|port
comma
id|p0
op_or
l_int|0x0f
comma
l_int|0xfe
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_SEQ_EVENT_SYSEX
suffix:colon
id|err
op_assign
id|snd_seq_dump_var_event
c_func
(paren
id|ev
comma
id|snd_usbmidi_sysex_dump
comma
id|port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
id|tasklet_hi_schedule
c_func
(paren
op_amp
id|port-&gt;ep-&gt;tasklet
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Frees an input endpoint.&n; * May be called when ep hasn&squot;t been initialized completely.&n; */
DECL|function|snd_usbmidi_in_endpoint_delete
r_static
r_void
id|snd_usbmidi_in_endpoint_delete
c_func
(paren
id|snd_usb_midi_in_endpoint_t
op_star
id|ep
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;urb
)paren
(brace
r_if
c_cond
(paren
id|ep-&gt;urb-&gt;transfer_buffer
)paren
(brace
id|usb_unlink_urb
c_func
(paren
id|ep-&gt;urb
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ep-&gt;urb-&gt;transfer_buffer
)paren
suffix:semicolon
)brace
id|usb_free_urb
c_func
(paren
id|ep-&gt;urb
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x10
suffix:semicolon
op_increment
id|i
)paren
r_if
c_cond
(paren
id|ep-&gt;ports
(braket
id|i
)braket
dot
id|midi_event
)paren
id|snd_midi_event_free
c_func
(paren
id|ep-&gt;ports
(braket
id|i
)braket
dot
id|midi_event
)paren
suffix:semicolon
id|snd_magic_kfree
c_func
(paren
id|ep
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * For Roland devices, use the alternate setting which uses interrupt&n; * transfers for input.&n; */
DECL|function|snd_usbmidi_get_int_epd
r_static
id|usb_endpoint_descriptor_t
op_star
id|snd_usbmidi_get_int_epd
c_func
(paren
id|snd_usb_midi_t
op_star
id|umidi
comma
r_uint8
id|epnum
)paren
(brace
id|usb_interface_t
op_star
id|intf
suffix:semicolon
id|usb_interface_descriptor_t
op_star
id|intfd
suffix:semicolon
r_if
c_cond
(paren
id|umidi-&gt;chip-&gt;dev-&gt;descriptor.idVendor
op_ne
l_int|0x0582
)paren
r_return
l_int|NULL
suffix:semicolon
id|intf
op_assign
id|usb_ifnum_to_if
c_func
(paren
id|umidi-&gt;chip-&gt;dev
comma
id|umidi-&gt;ifnum
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|intf
op_logical_or
id|intf-&gt;num_altsetting
op_ne
l_int|2
)paren
r_return
l_int|NULL
suffix:semicolon
id|intfd
op_assign
op_amp
id|intf-&gt;altsetting
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|intfd-&gt;bNumEndpoints
op_ne
l_int|2
op_logical_or
(paren
id|intfd-&gt;endpoint
(braket
l_int|0
)braket
dot
id|bmAttributes
op_amp
id|USB_ENDPOINT_XFERTYPE_MASK
)paren
op_ne
id|USB_ENDPOINT_XFER_BULK
op_logical_or
(paren
id|intfd-&gt;endpoint
(braket
l_int|1
)braket
dot
id|bmAttributes
op_amp
id|USB_ENDPOINT_XFERTYPE_MASK
)paren
op_ne
id|USB_ENDPOINT_XFER_BULK
)paren
r_return
l_int|NULL
suffix:semicolon
id|intfd
op_assign
op_amp
id|intf-&gt;altsetting
(braket
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|intfd-&gt;bNumEndpoints
op_ne
l_int|2
op_logical_or
(paren
id|intfd-&gt;endpoint
(braket
l_int|0
)braket
dot
id|bmAttributes
op_amp
id|USB_ENDPOINT_XFERTYPE_MASK
)paren
op_ne
id|USB_ENDPOINT_XFER_BULK
op_logical_or
(paren
id|intfd-&gt;endpoint
(braket
l_int|1
)braket
dot
id|bmAttributes
op_amp
id|USB_ENDPOINT_XFERTYPE_MASK
)paren
op_ne
id|USB_ENDPOINT_XFER_INT
)paren
r_return
l_int|NULL
suffix:semicolon
id|usb_set_interface
c_func
(paren
id|umidi-&gt;chip-&gt;dev
comma
id|intfd-&gt;bInterfaceNumber
comma
id|intfd-&gt;bAlternateSetting
)paren
suffix:semicolon
r_return
op_amp
id|intfd-&gt;endpoint
(braket
l_int|1
)braket
suffix:semicolon
)brace
multiline_comment|/*&n; * Creates an input endpoint, and initalizes input ports.&n; * ALSA ports are created later.&n; */
DECL|function|snd_usbmidi_in_endpoint_create
r_static
r_int
id|snd_usbmidi_in_endpoint_create
c_func
(paren
id|snd_usb_midi_t
op_star
id|umidi
comma
id|snd_usb_midi_endpoint_info_t
op_star
id|ep_info
comma
id|snd_usb_midi_endpoint_t
op_star
id|rep
)paren
(brace
id|snd_usb_midi_in_endpoint_t
op_star
id|ep
suffix:semicolon
id|usb_endpoint_descriptor_t
op_star
id|int_epd
suffix:semicolon
r_void
op_star
id|buffer
suffix:semicolon
r_int
r_int
id|pipe
suffix:semicolon
r_int
id|length
comma
id|i
comma
id|err
suffix:semicolon
id|rep-&gt;in
op_assign
l_int|NULL
suffix:semicolon
id|ep
op_assign
id|snd_magic_kcalloc
c_func
(paren
id|snd_usb_midi_in_endpoint_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ep
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|ep-&gt;umidi
op_assign
id|umidi
suffix:semicolon
id|ep-&gt;ep
op_assign
id|rep
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x10
suffix:semicolon
op_increment
id|i
)paren
id|ep-&gt;ports
(braket
id|i
)braket
dot
id|seq_port
op_assign
op_minus
l_int|1
suffix:semicolon
id|int_epd
op_assign
id|snd_usbmidi_get_int_epd
c_func
(paren
id|umidi
comma
id|ep_info-&gt;epnum
)paren
suffix:semicolon
id|ep-&gt;urb
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ep-&gt;urb
)paren
(brace
id|snd_usbmidi_in_endpoint_delete
c_func
(paren
id|ep
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|int_epd
)paren
id|pipe
op_assign
id|usb_rcvintpipe
c_func
(paren
id|umidi-&gt;chip-&gt;dev
comma
id|ep_info-&gt;epnum
)paren
suffix:semicolon
r_else
id|pipe
op_assign
id|usb_rcvbulkpipe
c_func
(paren
id|umidi-&gt;chip-&gt;dev
comma
id|ep_info-&gt;epnum
)paren
suffix:semicolon
id|length
op_assign
id|usb_maxpacket
c_func
(paren
id|umidi-&gt;chip-&gt;dev
comma
id|pipe
comma
l_int|0
)paren
suffix:semicolon
id|buffer
op_assign
id|kmalloc
c_func
(paren
id|length
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
(brace
id|snd_usbmidi_in_endpoint_delete
c_func
(paren
id|ep
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|int_epd
)paren
id|FILL_INT_URB
c_func
(paren
id|ep-&gt;urb
comma
id|umidi-&gt;chip-&gt;dev
comma
id|pipe
comma
id|buffer
comma
id|length
comma
id|snd_usbmidi_in_urb_complete
comma
id|ep
comma
id|int_epd-&gt;bInterval
)paren
suffix:semicolon
r_else
id|FILL_BULK_URB
c_func
(paren
id|ep-&gt;urb
comma
id|umidi-&gt;chip-&gt;dev
comma
id|pipe
comma
id|buffer
comma
id|length
comma
id|snd_usbmidi_in_urb_complete
comma
id|ep
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x10
suffix:semicolon
op_increment
id|i
)paren
r_if
c_cond
(paren
id|ep_info-&gt;in_cables
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
(brace
id|err
op_assign
id|snd_midi_event_new
c_func
(paren
id|INPUT_BUFFER_SIZE
comma
op_amp
id|ep-&gt;ports
(braket
id|i
)braket
dot
id|midi_event
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_usbmidi_in_endpoint_delete
c_func
(paren
id|ep
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
)brace
id|rep-&gt;in
op_assign
id|ep
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_usbmidi_count_bits
r_static
r_int
id|snd_usbmidi_count_bits
c_func
(paren
r_uint16
id|x
)paren
(brace
r_int
id|i
comma
id|bits
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
op_increment
id|i
)paren
id|bits
op_add_assign
(paren
id|x
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
op_ne
l_int|0
suffix:semicolon
r_return
id|bits
suffix:semicolon
)brace
multiline_comment|/*&n; * Frees an output endpoint.&n; * May be called when ep hasn&squot;t been initialized completely.&n; */
DECL|function|snd_usbmidi_out_endpoint_delete
r_static
r_void
id|snd_usbmidi_out_endpoint_delete
c_func
(paren
id|snd_usb_midi_out_endpoint_t
op_star
id|ep
)paren
(brace
r_if
c_cond
(paren
id|ep-&gt;tasklet.func
)paren
id|tasklet_kill
c_func
(paren
op_amp
id|ep-&gt;tasklet
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;urb
)paren
(brace
r_if
c_cond
(paren
id|ep-&gt;urb-&gt;transfer_buffer
)paren
(brace
id|usb_unlink_urb
c_func
(paren
id|ep-&gt;urb
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ep-&gt;urb-&gt;transfer_buffer
)paren
suffix:semicolon
)brace
id|usb_free_urb
c_func
(paren
id|ep-&gt;urb
)paren
suffix:semicolon
)brace
id|snd_magic_kfree
c_func
(paren
id|ep
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Creates an output endpoint, and initializes output ports.&n; * ALSA ports are created later.&n; */
DECL|function|snd_usbmidi_out_endpoint_create
r_static
r_int
id|snd_usbmidi_out_endpoint_create
c_func
(paren
id|snd_usb_midi_t
op_star
id|umidi
comma
id|snd_usb_midi_endpoint_info_t
op_star
id|ep_info
comma
id|snd_usb_midi_endpoint_t
op_star
id|rep
)paren
(brace
id|snd_usb_midi_out_endpoint_t
op_star
id|ep
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|pipe
suffix:semicolon
r_void
op_star
id|buffer
suffix:semicolon
id|rep-&gt;out
op_assign
l_int|NULL
suffix:semicolon
id|ep
op_assign
id|snd_magic_kcalloc
c_func
(paren
id|snd_usb_midi_out_endpoint_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ep
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|ep-&gt;umidi
op_assign
id|umidi
suffix:semicolon
id|ep-&gt;urb
op_assign
id|usb_alloc_urb
c_func
(paren
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ep-&gt;urb
)paren
(brace
id|snd_usbmidi_out_endpoint_delete
c_func
(paren
id|ep
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|pipe
op_assign
id|usb_sndbulkpipe
c_func
(paren
id|umidi-&gt;chip-&gt;dev
comma
id|ep_info-&gt;epnum
)paren
suffix:semicolon
id|ep-&gt;max_transfer
op_assign
id|usb_maxpacket
c_func
(paren
id|umidi-&gt;chip-&gt;dev
comma
id|pipe
comma
l_int|1
)paren
op_amp
op_complement
l_int|3
suffix:semicolon
id|buffer
op_assign
id|kmalloc
c_func
(paren
id|ep-&gt;max_transfer
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
)paren
(brace
id|snd_usbmidi_out_endpoint_delete
c_func
(paren
id|ep
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|FILL_BULK_URB
c_func
(paren
id|ep-&gt;urb
comma
id|umidi-&gt;chip-&gt;dev
comma
id|pipe
comma
id|buffer
comma
id|ep-&gt;max_transfer
comma
id|snd_usbmidi_out_urb_complete
comma
id|ep
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|ep-&gt;buffer_lock
)paren
suffix:semicolon
id|tasklet_init
c_func
(paren
op_amp
id|ep-&gt;tasklet
comma
id|snd_usbmidi_out_tasklet
comma
(paren
r_int
r_int
)paren
id|ep
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x10
suffix:semicolon
op_increment
id|i
)paren
r_if
c_cond
(paren
id|ep_info-&gt;out_cables
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
(brace
id|ep-&gt;ports
(braket
id|i
)braket
dot
id|ep
op_assign
id|ep
suffix:semicolon
id|ep-&gt;ports
(braket
id|i
)braket
dot
id|cable
op_assign
id|i
op_lshift
l_int|4
suffix:semicolon
)brace
id|rep-&gt;out
op_assign
id|ep
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Frees the sequencer client, endpoints and ports.&n; */
DECL|function|snd_usbmidi_seq_device_delete
r_static
r_int
id|snd_usbmidi_seq_device_delete
c_func
(paren
id|snd_seq_device_t
op_star
id|seq_device
)paren
(brace
id|snd_usb_midi_t
op_star
id|umidi
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|umidi
op_assign
(paren
id|snd_usb_midi_t
op_star
)paren
id|SNDRV_SEQ_DEVICE_ARGPTR
c_func
(paren
id|seq_device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|umidi-&gt;seq_client
op_ge
l_int|0
)paren
(brace
id|snd_seq_delete_kernel_client
c_func
(paren
id|umidi-&gt;seq_client
)paren
suffix:semicolon
id|umidi-&gt;seq_client
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MIDI_MAX_ENDPOINTS
suffix:semicolon
op_increment
id|i
)paren
(brace
id|snd_usb_midi_endpoint_t
op_star
id|ep
op_assign
op_amp
id|umidi-&gt;endpoints
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;out
)paren
(brace
id|snd_usbmidi_out_endpoint_delete
c_func
(paren
id|ep-&gt;out
)paren
suffix:semicolon
id|ep-&gt;out
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ep-&gt;in
)paren
(brace
id|snd_usbmidi_in_endpoint_delete
c_func
(paren
id|ep-&gt;in
)paren
suffix:semicolon
id|ep-&gt;in
op_assign
l_int|NULL
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|0x10
suffix:semicolon
op_increment
id|j
)paren
r_if
c_cond
(paren
id|ep-&gt;rmidi
(braket
id|j
)braket
)paren
(brace
id|snd_device_free
c_func
(paren
id|umidi-&gt;chip-&gt;card
comma
id|ep-&gt;rmidi
(braket
id|j
)braket
)paren
suffix:semicolon
id|ep-&gt;rmidi
(braket
id|j
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * After input and output endpoints have been initialized, create&n; * the ALSA port for each input/output port pair in the endpoint.&n; * *port_idx is the port number, which must be unique over all endpoints.&n; */
DECL|function|snd_usbmidi_create_endpoint_ports
r_static
r_int
id|snd_usbmidi_create_endpoint_ports
c_func
(paren
id|snd_usb_midi_t
op_star
id|umidi
comma
r_int
id|ep
comma
r_int
op_star
id|port_idx
comma
id|snd_usb_midi_endpoint_info_t
op_star
id|ep_info
)paren
(brace
r_int
id|c
comma
id|err
suffix:semicolon
r_int
id|cap
comma
id|type
comma
id|port
suffix:semicolon
r_int
id|out
comma
id|in
suffix:semicolon
id|snd_seq_port_callback_t
id|port_callback
suffix:semicolon
r_char
id|port_name
(braket
l_int|48
)braket
suffix:semicolon
r_for
c_loop
(paren
id|c
op_assign
l_int|0
suffix:semicolon
id|c
OL
l_int|0x10
suffix:semicolon
op_increment
id|c
)paren
(brace
id|out
op_assign
id|ep_info-&gt;out_cables
op_amp
(paren
l_int|1
op_lshift
id|c
)paren
suffix:semicolon
id|in
op_assign
id|ep_info-&gt;in_cables
op_amp
(paren
l_int|1
op_lshift
id|c
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|in
op_logical_or
id|out
)paren
)paren
r_continue
suffix:semicolon
id|cap
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|port_callback
comma
l_int|0
comma
r_sizeof
(paren
id|port_callback
)paren
)paren
suffix:semicolon
id|port_callback.owner
op_assign
id|THIS_MODULE
suffix:semicolon
r_if
c_cond
(paren
id|out
)paren
(brace
id|port_callback.event_input
op_assign
id|snd_usbmidi_event_input
suffix:semicolon
id|port_callback.private_data
op_assign
op_amp
id|umidi-&gt;endpoints
(braket
id|ep
)braket
dot
id|out-&gt;ports
(braket
id|c
)braket
suffix:semicolon
id|cap
op_or_assign
id|SNDRV_SEQ_PORT_CAP_WRITE
op_or
id|SNDRV_SEQ_PORT_CAP_SUBS_WRITE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|in
)paren
(brace
id|cap
op_or_assign
id|SNDRV_SEQ_PORT_CAP_READ
op_or
id|SNDRV_SEQ_PORT_CAP_SUBS_READ
suffix:semicolon
)brace
r_if
c_cond
(paren
id|out
op_logical_and
id|in
)paren
(brace
id|cap
op_or_assign
id|SNDRV_SEQ_PORT_CAP_DUPLEX
suffix:semicolon
)brace
multiline_comment|/* TODO: read type bits from element descriptor */
id|type
op_assign
id|SNDRV_SEQ_PORT_TYPE_MIDI_GENERIC
suffix:semicolon
multiline_comment|/* TODO: read port name from jack descriptor */
id|snprintf
c_func
(paren
id|port_name
comma
r_sizeof
(paren
id|port_name
)paren
comma
l_string|&quot;%s Port %d&quot;
comma
id|umidi-&gt;chip-&gt;card-&gt;shortname
comma
op_star
id|port_idx
)paren
suffix:semicolon
id|port
op_assign
id|snd_seq_event_port_attach
c_func
(paren
id|umidi-&gt;seq_client
comma
op_amp
id|port_callback
comma
id|cap
comma
id|type
comma
id|port_name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|port
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cannot create port (error code %d)&bslash;n&quot;
comma
id|port
)paren
suffix:semicolon
r_return
id|port
suffix:semicolon
)brace
r_if
c_cond
(paren
id|in
)paren
id|umidi-&gt;endpoints
(braket
id|ep
)braket
dot
id|in-&gt;ports
(braket
id|c
)braket
dot
id|seq_port
op_assign
id|port
suffix:semicolon
r_if
c_cond
(paren
op_star
id|port_idx
OL
id|SNDRV_MINOR_RAWMIDIS
)paren
(brace
id|snd_rawmidi_t
op_star
id|rmidi
suffix:semicolon
id|snd_virmidi_dev_t
op_star
id|rdev
suffix:semicolon
id|err
op_assign
id|snd_virmidi_new
c_func
(paren
id|umidi-&gt;chip-&gt;card
comma
op_star
id|port_idx
comma
op_amp
id|rmidi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|rdev
op_assign
id|snd_magic_cast
c_func
(paren
id|snd_virmidi_dev_t
comma
id|rmidi-&gt;private_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|rmidi-&gt;name
comma
id|port_name
)paren
suffix:semicolon
id|rdev-&gt;seq_mode
op_assign
id|SNDRV_VIRMIDI_SEQ_ATTACH
suffix:semicolon
id|rdev-&gt;client
op_assign
id|umidi-&gt;seq_client
suffix:semicolon
id|rdev-&gt;port
op_assign
id|port
suffix:semicolon
id|err
op_assign
id|snd_device_register
c_func
(paren
id|umidi-&gt;chip-&gt;card
comma
id|rmidi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_device_free
c_func
(paren
id|umidi-&gt;chip-&gt;card
comma
id|rmidi
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|umidi-&gt;endpoints
(braket
id|ep
)braket
dot
id|rmidi
(braket
id|c
)braket
op_assign
id|rmidi
suffix:semicolon
)brace
op_increment
op_star
id|port_idx
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Creates the endpoints and their ports.&n; */
DECL|function|snd_usbmidi_create_endpoints
r_static
r_int
id|snd_usbmidi_create_endpoints
c_func
(paren
id|snd_usb_midi_t
op_star
id|umidi
comma
id|snd_usb_midi_endpoint_info_t
op_star
id|endpoints
)paren
(brace
r_int
id|i
comma
id|err
comma
id|port_idx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MIDI_MAX_ENDPOINTS
suffix:semicolon
op_increment
id|i
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|endpoints
(braket
id|i
)braket
dot
id|epnum
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|endpoints
(braket
id|i
)braket
dot
id|out_cables
)paren
(brace
id|err
op_assign
id|snd_usbmidi_out_endpoint_create
c_func
(paren
id|umidi
comma
op_amp
id|endpoints
(braket
id|i
)braket
comma
op_amp
id|umidi-&gt;endpoints
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|endpoints
(braket
id|i
)braket
dot
id|in_cables
)paren
(brace
id|err
op_assign
id|snd_usbmidi_in_endpoint_create
c_func
(paren
id|umidi
comma
op_amp
id|endpoints
(braket
id|i
)braket
comma
op_amp
id|umidi-&gt;endpoints
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
id|err
op_assign
id|snd_usbmidi_create_endpoint_ports
c_func
(paren
id|umidi
comma
id|i
comma
op_amp
id|port_idx
comma
op_amp
id|endpoints
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;snd-usb-midi: endpoint %d: created %d output and %d input ports&bslash;n&quot;
comma
id|endpoints
(braket
id|i
)braket
dot
id|epnum
comma
id|snd_usbmidi_count_bits
c_func
(paren
id|endpoints
(braket
id|i
)braket
dot
id|out_cables
)paren
comma
id|snd_usbmidi_count_bits
c_func
(paren
id|endpoints
(braket
id|i
)braket
dot
id|in_cables
)paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Returns MIDIStreaming device capabilities.&n; */
DECL|function|snd_usbmidi_get_ms_info
r_static
r_int
id|snd_usbmidi_get_ms_info
c_func
(paren
id|snd_usb_midi_t
op_star
id|umidi
comma
id|snd_usb_midi_endpoint_info_t
op_star
id|endpoints
)paren
(brace
id|usb_interface_t
op_star
id|intf
suffix:semicolon
id|usb_interface_descriptor_t
op_star
id|intfd
suffix:semicolon
id|usb_ms_header_descriptor_t
op_star
id|ms_header
suffix:semicolon
id|usb_endpoint_descriptor_t
op_star
id|ep
suffix:semicolon
id|usb_ms_endpoint_descriptor_t
op_star
id|ms_ep
suffix:semicolon
r_int
id|i
comma
id|epidx
suffix:semicolon
id|memset
c_func
(paren
id|endpoints
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|endpoints
)paren
op_star
id|MIDI_MAX_ENDPOINTS
)paren
suffix:semicolon
id|intf
op_assign
id|usb_ifnum_to_if
c_func
(paren
id|umidi-&gt;chip-&gt;dev
comma
id|umidi-&gt;ifnum
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|intf
)paren
r_return
op_minus
id|ENXIO
suffix:semicolon
id|intfd
op_assign
op_amp
id|intf-&gt;altsetting
(braket
l_int|0
)braket
suffix:semicolon
id|ms_header
op_assign
(paren
id|usb_ms_header_descriptor_t
op_star
)paren
id|intfd-&gt;extra
suffix:semicolon
r_if
c_cond
(paren
id|intfd-&gt;extralen
op_ge
l_int|7
op_logical_and
id|ms_header-&gt;bLength
op_ge
l_int|7
op_logical_and
id|ms_header-&gt;bDescriptorType
op_eq
id|USB_DT_CS_INTERFACE
op_logical_and
id|ms_header-&gt;bDescriptorSubtype
op_eq
id|HEADER
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;snd-usb-midi: MIDIStreaming version %02x.%02x&bslash;n&quot;
comma
id|ms_header-&gt;bcdMSC
(braket
l_int|1
)braket
comma
id|ms_header-&gt;bcdMSC
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;snd-usb-midi: MIDIStreaming interface descriptor not found&bslash;n&quot;
)paren
suffix:semicolon
id|epidx
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|intfd-&gt;bNumEndpoints
suffix:semicolon
op_increment
id|i
)paren
(brace
id|ep
op_assign
op_amp
id|intfd-&gt;endpoint
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ep-&gt;bmAttributes
op_amp
id|USB_ENDPOINT_XFERTYPE_MASK
)paren
op_ne
id|USB_ENDPOINT_XFER_BULK
)paren
r_continue
suffix:semicolon
id|ms_ep
op_assign
(paren
id|usb_ms_endpoint_descriptor_t
op_star
)paren
id|ep-&gt;extra
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;extralen
OL
l_int|4
op_logical_or
id|ms_ep-&gt;bLength
OL
l_int|4
op_logical_or
id|ms_ep-&gt;bDescriptorType
op_ne
id|USB_DT_CS_ENDPOINT
op_logical_or
id|ms_ep-&gt;bDescriptorSubtype
op_ne
id|MS_GENERAL
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|endpoints
(braket
id|epidx
)braket
dot
id|epnum
op_ne
l_int|0
op_logical_and
id|endpoints
(braket
id|epidx
)braket
dot
id|epnum
op_ne
(paren
id|ep-&gt;bEndpointAddress
op_amp
id|USB_ENDPOINT_NUMBER_MASK
)paren
)paren
(brace
op_increment
id|epidx
suffix:semicolon
r_if
c_cond
(paren
id|epidx
op_ge
id|MIDI_MAX_ENDPOINTS
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;snd-usb-midi: too many endpoints&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|endpoints
(braket
id|epidx
)braket
dot
id|epnum
op_assign
id|ep-&gt;bEndpointAddress
op_amp
id|USB_ENDPOINT_NUMBER_MASK
suffix:semicolon
r_if
c_cond
(paren
id|ep-&gt;bEndpointAddress
op_amp
id|USB_DIR_IN
)paren
(brace
id|endpoints
(braket
id|epidx
)braket
dot
id|in_cables
op_assign
(paren
l_int|1
op_lshift
id|ms_ep-&gt;bNumEmbMIDIJack
)paren
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|endpoints
(braket
id|epidx
)braket
dot
id|out_cables
op_assign
(paren
l_int|1
op_lshift
id|ms_ep-&gt;bNumEmbMIDIJack
)paren
op_minus
l_int|1
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;snd-usb-midi: detected %d %s jack(s) on endpoint %d&bslash;n&quot;
comma
id|ms_ep-&gt;bNumEmbMIDIJack
comma
id|ep-&gt;bEndpointAddress
op_amp
id|USB_DIR_IN
ques
c_cond
l_string|&quot;input&quot;
suffix:colon
l_string|&quot;output&quot;
comma
id|endpoints
(braket
id|epidx
)braket
dot
id|epnum
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * If the first endpoint isn&squot;t specified, use the first endpoint in the&n; * first alternate setting of the interface.&n; */
DECL|function|snd_usbmidi_detect_endpoint
r_static
r_int
id|snd_usbmidi_detect_endpoint
c_func
(paren
id|snd_usb_midi_t
op_star
id|umidi
comma
id|snd_usb_midi_endpoint_info_t
op_star
id|endpoint
)paren
(brace
id|usb_interface_t
op_star
id|intf
suffix:semicolon
id|usb_interface_descriptor_t
op_star
id|intfd
suffix:semicolon
id|usb_endpoint_descriptor_t
op_star
id|epd
suffix:semicolon
r_if
c_cond
(paren
id|endpoint-&gt;epnum
op_eq
op_minus
l_int|1
)paren
(brace
id|intf
op_assign
id|usb_ifnum_to_if
c_func
(paren
id|umidi-&gt;chip-&gt;dev
comma
id|umidi-&gt;ifnum
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|intf
op_logical_or
id|intf-&gt;num_altsetting
OL
l_int|1
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
id|intfd
op_assign
id|intf-&gt;altsetting
suffix:semicolon
r_if
c_cond
(paren
id|intfd-&gt;bNumEndpoints
OL
l_int|1
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
id|epd
op_assign
id|intfd-&gt;endpoint
suffix:semicolon
id|endpoint-&gt;epnum
op_assign
id|epd-&gt;bEndpointAddress
op_amp
id|USB_ENDPOINT_NUMBER_MASK
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Initialize the sequencer device.&n; */
DECL|function|snd_usbmidi_seq_device_new
r_static
r_int
id|snd_usbmidi_seq_device_new
c_func
(paren
id|snd_seq_device_t
op_star
id|seq_device
)paren
(brace
id|snd_usb_midi_t
op_star
id|umidi
suffix:semicolon
id|usb_device_t
op_star
id|dev
suffix:semicolon
id|snd_seq_client_callback_t
id|client_callback
suffix:semicolon
id|snd_seq_client_info_t
id|client_info
suffix:semicolon
id|snd_usb_midi_endpoint_info_t
id|endpoints
(braket
id|MIDI_MAX_ENDPOINTS
)braket
suffix:semicolon
r_int
id|i
comma
id|err
suffix:semicolon
id|umidi
op_assign
(paren
id|snd_usb_midi_t
op_star
)paren
id|SNDRV_SEQ_DEVICE_ARGPTR
c_func
(paren
id|seq_device
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|client_callback
comma
l_int|0
comma
r_sizeof
(paren
id|client_callback
)paren
)paren
suffix:semicolon
id|client_callback.allow_output
op_assign
l_int|1
suffix:semicolon
id|client_callback.allow_input
op_assign
l_int|1
suffix:semicolon
id|umidi-&gt;seq_client
op_assign
id|snd_seq_create_kernel_client
c_func
(paren
id|umidi-&gt;chip-&gt;card
comma
l_int|0
comma
op_amp
id|client_callback
)paren
suffix:semicolon
r_if
c_cond
(paren
id|umidi-&gt;seq_client
OL
l_int|0
)paren
r_return
id|umidi-&gt;seq_client
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|client_info
comma
l_int|0
comma
r_sizeof
(paren
id|client_info
)paren
)paren
suffix:semicolon
id|client_info.client
op_assign
id|umidi-&gt;seq_client
suffix:semicolon
id|client_info.type
op_assign
id|KERNEL_CLIENT
suffix:semicolon
id|dev
op_assign
id|umidi-&gt;chip-&gt;dev
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;descriptor.iProduct
)paren
id|err
op_assign
id|usb_string
c_func
(paren
id|dev
comma
id|dev-&gt;descriptor.iProduct
comma
id|client_info.name
comma
r_sizeof
(paren
id|client_info.name
)paren
)paren
suffix:semicolon
r_else
id|err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|err
op_le
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|umidi-&gt;quirk
op_logical_and
id|umidi-&gt;quirk-&gt;product_name
)paren
(brace
id|strncpy
c_func
(paren
id|client_info.name
comma
id|umidi-&gt;quirk-&gt;product_name
comma
r_sizeof
(paren
id|client_info.name
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|client_info.name
(braket
r_sizeof
(paren
id|client_info.name
)paren
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
r_else
(brace
id|sprintf
c_func
(paren
id|client_info.name
comma
l_string|&quot;USB Device %#04x:%#04x&quot;
comma
id|dev-&gt;descriptor.idVendor
comma
id|dev-&gt;descriptor.idProduct
)paren
suffix:semicolon
)brace
)brace
id|snd_seq_kernel_client_ctl
c_func
(paren
id|umidi-&gt;seq_client
comma
id|SNDRV_SEQ_IOCTL_SET_CLIENT_INFO
comma
op_amp
id|client_info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|umidi-&gt;quirk
)paren
(brace
id|memcpy
c_func
(paren
id|endpoints
comma
id|umidi-&gt;quirk-&gt;endpoints
comma
r_sizeof
(paren
id|endpoints
)paren
)paren
suffix:semicolon
id|err
op_assign
id|snd_usbmidi_detect_endpoint
c_func
(paren
id|umidi
comma
op_amp
id|endpoints
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
id|err
op_assign
id|snd_usbmidi_get_ms_info
c_func
(paren
id|umidi
comma
id|endpoints
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_usbmidi_seq_device_delete
c_func
(paren
id|seq_device
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|err
op_assign
id|snd_usbmidi_create_endpoints
c_func
(paren
id|umidi
comma
id|endpoints
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_usbmidi_seq_device_delete
c_func
(paren
id|seq_device
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MIDI_MAX_ENDPOINTS
suffix:semicolon
op_increment
id|i
)paren
r_if
c_cond
(paren
id|umidi-&gt;endpoints
(braket
id|i
)braket
dot
id|in
)paren
id|snd_usbmidi_submit_urb
c_func
(paren
id|umidi-&gt;endpoints
(braket
id|i
)braket
dot
id|in-&gt;urb
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_usbmidi_module_init
r_static
r_int
id|__init
id|snd_usbmidi_module_init
c_func
(paren
r_void
)paren
(brace
r_static
id|snd_seq_dev_ops_t
id|ops
op_assign
(brace
id|snd_usbmidi_seq_device_new
comma
id|snd_usbmidi_seq_device_delete
)brace
suffix:semicolon
r_return
id|snd_seq_device_register_driver
c_func
(paren
id|SNDRV_SEQ_DEV_ID_USBMIDI
comma
op_amp
id|ops
comma
r_sizeof
(paren
id|snd_usb_midi_t
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_usbmidi_module_exit
r_static
r_void
id|__exit
id|snd_usbmidi_module_exit
c_func
(paren
r_void
)paren
(brace
id|snd_seq_device_unregister_driver
c_func
(paren
id|SNDRV_SEQ_DEV_ID_USBMIDI
)paren
suffix:semicolon
)brace
id|module_init
c_func
(paren
id|snd_usbmidi_module_init
)paren
id|module_exit
c_func
(paren
id|snd_usbmidi_module_exit
)paren
eof
