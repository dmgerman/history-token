multiline_comment|/*&n; * Driver for CS4231 sound chips found on Sparcs.&n; * Copyright (C) 2002 David S. Miller &lt;davem@redhat.com&gt;&n; *&n; * Based entirely upon drivers/sbus/audio/cs4231.c which is:&n; * Copyright (C) 1996, 1997, 1998, 1998 Derrick J Brashear (shadow@andrew.cmu.edu)&n; * and also sound/isa/cs423x/cs4231_lib.c which is:&n; * Copyright (c) by Jaroslav Kysela &lt;perex@suse.cz&gt;&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#include &lt;sound/control.h&gt;
macro_line|#include &lt;sound/timer.h&gt;
macro_line|#include &lt;sound/initval.h&gt;
macro_line|#include &lt;sound/pcm_params.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#ifdef CONFIG_SBUS
DECL|macro|SBUS_SUPPORT
mdefine_line|#define SBUS_SUPPORT
macro_line|#endif
macro_line|#ifdef SBUS_SUPPORT
macro_line|#include &lt;asm/sbus.h&gt;
macro_line|#endif
macro_line|#if defined(CONFIG_PCI) &amp;&amp; defined(CONFIG_SPARC64)
DECL|macro|EBUS_SUPPORT
mdefine_line|#define EBUS_SUPPORT
macro_line|#endif
macro_line|#ifdef EBUS_SUPPORT
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;asm/ebus.h&gt;
macro_line|#endif
DECL|variable|index
r_static
r_int
id|index
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_IDX
suffix:semicolon
multiline_comment|/* Index 0-MAX */
DECL|variable|id
r_static
r_char
op_star
id|id
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_STR
suffix:semicolon
multiline_comment|/* ID for this card */
DECL|variable|enable
r_static
r_int
id|enable
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_ENABLE_PNP
suffix:semicolon
multiline_comment|/* Enable this card */
id|module_param_array
c_func
(paren
id|index
comma
r_int
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|index
comma
l_string|&quot;Index value for Sun CS4231 soundcard.&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|id
comma
id|charp
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|id
comma
l_string|&quot;ID string for Sun CS4231 soundcard.&quot;
)paren
suffix:semicolon
id|module_param_array
c_func
(paren
id|enable
comma
r_bool
comma
l_int|NULL
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|enable
comma
l_string|&quot;Enable Sun CS4231 soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Jaroslav Kysela, Derrick J. Brashear and David S. Miller&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Sun CS4231&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_SUPPORTED_DEVICE
c_func
(paren
l_string|&quot;{{Sun,CS4231}}&quot;
)paren
suffix:semicolon
DECL|struct|snd_cs4231
r_typedef
r_struct
id|snd_cs4231
(brace
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|port
r_void
id|__iomem
op_star
id|port
suffix:semicolon
macro_line|#ifdef EBUS_SUPPORT
DECL|member|eb2c
r_struct
id|ebus_dma_info
id|eb2c
suffix:semicolon
DECL|member|eb2p
r_struct
id|ebus_dma_info
id|eb2p
suffix:semicolon
macro_line|#endif
DECL|member|flags
id|u32
id|flags
suffix:semicolon
DECL|macro|CS4231_FLAG_EBUS
mdefine_line|#define CS4231_FLAG_EBUS&t;0x00000001
DECL|macro|CS4231_FLAG_PLAYBACK
mdefine_line|#define CS4231_FLAG_PLAYBACK&t;0x00000002
DECL|macro|CS4231_FLAG_CAPTURE
mdefine_line|#define CS4231_FLAG_CAPTURE&t;0x00000004
DECL|member|card
id|snd_card_t
op_star
id|card
suffix:semicolon
DECL|member|pcm
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
DECL|member|playback_substream
id|snd_pcm_substream_t
op_star
id|playback_substream
suffix:semicolon
DECL|member|p_periods_sent
r_int
r_int
id|p_periods_sent
suffix:semicolon
DECL|member|capture_substream
id|snd_pcm_substream_t
op_star
id|capture_substream
suffix:semicolon
DECL|member|c_periods_sent
r_int
r_int
id|c_periods_sent
suffix:semicolon
DECL|member|timer
id|snd_timer_t
op_star
id|timer
suffix:semicolon
DECL|member|mode
r_int
r_int
id|mode
suffix:semicolon
DECL|macro|CS4231_MODE_NONE
mdefine_line|#define CS4231_MODE_NONE&t;0x0000
DECL|macro|CS4231_MODE_PLAY
mdefine_line|#define CS4231_MODE_PLAY&t;0x0001
DECL|macro|CS4231_MODE_RECORD
mdefine_line|#define CS4231_MODE_RECORD&t;0x0002
DECL|macro|CS4231_MODE_TIMER
mdefine_line|#define CS4231_MODE_TIMER&t;0x0004
DECL|macro|CS4231_MODE_OPEN
mdefine_line|#define CS4231_MODE_OPEN&t;(CS4231_MODE_PLAY|CS4231_MODE_RECORD|CS4231_MODE_TIMER)
DECL|member|image
r_int
r_char
id|image
(braket
l_int|32
)braket
suffix:semicolon
multiline_comment|/* registers image */
DECL|member|mce_bit
r_int
id|mce_bit
suffix:semicolon
DECL|member|calibrate_mute
r_int
id|calibrate_mute
suffix:semicolon
DECL|member|mce_mutex
r_struct
id|semaphore
id|mce_mutex
suffix:semicolon
DECL|member|open_mutex
r_struct
id|semaphore
id|open_mutex
suffix:semicolon
r_union
(brace
macro_line|#ifdef SBUS_SUPPORT
DECL|member|sdev
r_struct
id|sbus_dev
op_star
id|sdev
suffix:semicolon
macro_line|#endif
macro_line|#ifdef EBUS_SUPPORT
DECL|member|pdev
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
macro_line|#endif
DECL|member|dev_u
)brace
id|dev_u
suffix:semicolon
DECL|member|irq
r_int
r_int
id|irq
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|regs_size
r_int
r_int
id|regs_size
suffix:semicolon
DECL|member|next
r_struct
id|snd_cs4231
op_star
id|next
suffix:semicolon
DECL|typedef|cs4231_t
)brace
id|cs4231_t
suffix:semicolon
DECL|variable|cs4231_list
r_static
id|cs4231_t
op_star
id|cs4231_list
suffix:semicolon
multiline_comment|/* Eventually we can use sound/isa/cs423x/cs4231_lib.c directly, but for&n; * now....  -DaveM&n; */
multiline_comment|/* IO ports */
DECL|macro|CS4231P
mdefine_line|#define CS4231P(chip, x)&t;((chip)-&gt;port + c_d_c_CS4231##x)
multiline_comment|/* XXX offsets are different than PC ISA chips... */
DECL|macro|c_d_c_CS4231REGSEL
mdefine_line|#define c_d_c_CS4231REGSEL&t;0x0
DECL|macro|c_d_c_CS4231REG
mdefine_line|#define c_d_c_CS4231REG&t;&t;0x4
DECL|macro|c_d_c_CS4231STATUS
mdefine_line|#define c_d_c_CS4231STATUS&t;0x8
DECL|macro|c_d_c_CS4231PIO
mdefine_line|#define c_d_c_CS4231PIO&t;&t;0xc
multiline_comment|/* codec registers */
DECL|macro|CS4231_LEFT_INPUT
mdefine_line|#define CS4231_LEFT_INPUT&t;0x00&t;/* left input control */
DECL|macro|CS4231_RIGHT_INPUT
mdefine_line|#define CS4231_RIGHT_INPUT&t;0x01&t;/* right input control */
DECL|macro|CS4231_AUX1_LEFT_INPUT
mdefine_line|#define CS4231_AUX1_LEFT_INPUT&t;0x02&t;/* left AUX1 input control */
DECL|macro|CS4231_AUX1_RIGHT_INPUT
mdefine_line|#define CS4231_AUX1_RIGHT_INPUT&t;0x03&t;/* right AUX1 input control */
DECL|macro|CS4231_AUX2_LEFT_INPUT
mdefine_line|#define CS4231_AUX2_LEFT_INPUT&t;0x04&t;/* left AUX2 input control */
DECL|macro|CS4231_AUX2_RIGHT_INPUT
mdefine_line|#define CS4231_AUX2_RIGHT_INPUT&t;0x05&t;/* right AUX2 input control */
DECL|macro|CS4231_LEFT_OUTPUT
mdefine_line|#define CS4231_LEFT_OUTPUT&t;0x06&t;/* left output control register */
DECL|macro|CS4231_RIGHT_OUTPUT
mdefine_line|#define CS4231_RIGHT_OUTPUT&t;0x07&t;/* right output control register */
DECL|macro|CS4231_PLAYBK_FORMAT
mdefine_line|#define CS4231_PLAYBK_FORMAT&t;0x08&t;/* clock and data format - playback - bits 7-0 MCE */
DECL|macro|CS4231_IFACE_CTRL
mdefine_line|#define CS4231_IFACE_CTRL&t;0x09&t;/* interface control - bits 7-2 MCE */
DECL|macro|CS4231_PIN_CTRL
mdefine_line|#define CS4231_PIN_CTRL&t;&t;0x0a&t;/* pin control */
DECL|macro|CS4231_TEST_INIT
mdefine_line|#define CS4231_TEST_INIT&t;0x0b&t;/* test and initialization */
DECL|macro|CS4231_MISC_INFO
mdefine_line|#define CS4231_MISC_INFO&t;0x0c&t;/* miscellaneaous information */
DECL|macro|CS4231_LOOPBACK
mdefine_line|#define CS4231_LOOPBACK&t;&t;0x0d&t;/* loopback control */
DECL|macro|CS4231_PLY_UPR_CNT
mdefine_line|#define CS4231_PLY_UPR_CNT&t;0x0e&t;/* playback upper base count */
DECL|macro|CS4231_PLY_LWR_CNT
mdefine_line|#define CS4231_PLY_LWR_CNT&t;0x0f&t;/* playback lower base count */
DECL|macro|CS4231_ALT_FEATURE_1
mdefine_line|#define CS4231_ALT_FEATURE_1&t;0x10&t;/* alternate #1 feature enable */
DECL|macro|CS4231_ALT_FEATURE_2
mdefine_line|#define CS4231_ALT_FEATURE_2&t;0x11&t;/* alternate #2 feature enable */
DECL|macro|CS4231_LEFT_LINE_IN
mdefine_line|#define CS4231_LEFT_LINE_IN&t;0x12&t;/* left line input control */
DECL|macro|CS4231_RIGHT_LINE_IN
mdefine_line|#define CS4231_RIGHT_LINE_IN&t;0x13&t;/* right line input control */
DECL|macro|CS4231_TIMER_LOW
mdefine_line|#define CS4231_TIMER_LOW&t;0x14&t;/* timer low byte */
DECL|macro|CS4231_TIMER_HIGH
mdefine_line|#define CS4231_TIMER_HIGH&t;0x15&t;/* timer high byte */
DECL|macro|CS4231_LEFT_MIC_INPUT
mdefine_line|#define CS4231_LEFT_MIC_INPUT&t;0x16&t;/* left MIC input control register (InterWave only) */
DECL|macro|CS4231_RIGHT_MIC_INPUT
mdefine_line|#define CS4231_RIGHT_MIC_INPUT&t;0x17&t;/* right MIC input control register (InterWave only) */
DECL|macro|CS4236_EXT_REG
mdefine_line|#define CS4236_EXT_REG&t;&t;0x17&t;/* extended register access */
DECL|macro|CS4231_IRQ_STATUS
mdefine_line|#define CS4231_IRQ_STATUS&t;0x18&t;/* irq status register */
DECL|macro|CS4231_LINE_LEFT_OUTPUT
mdefine_line|#define CS4231_LINE_LEFT_OUTPUT&t;0x19&t;/* left line output control register (InterWave only) */
DECL|macro|CS4231_VERSION
mdefine_line|#define CS4231_VERSION&t;&t;0x19&t;/* CS4231(A) - version values */
DECL|macro|CS4231_MONO_CTRL
mdefine_line|#define CS4231_MONO_CTRL&t;0x1a&t;/* mono input/output control */
DECL|macro|CS4231_LINE_RIGHT_OUTPUT
mdefine_line|#define CS4231_LINE_RIGHT_OUTPUT 0x1b&t;/* right line output control register (InterWave only) */
DECL|macro|CS4235_LEFT_MASTER
mdefine_line|#define CS4235_LEFT_MASTER&t;0x1b&t;/* left master output control */
DECL|macro|CS4231_REC_FORMAT
mdefine_line|#define CS4231_REC_FORMAT&t;0x1c&t;/* clock and data format - record - bits 7-0 MCE */
DECL|macro|CS4231_PLY_VAR_FREQ
mdefine_line|#define CS4231_PLY_VAR_FREQ&t;0x1d&t;/* playback variable frequency */
DECL|macro|CS4235_RIGHT_MASTER
mdefine_line|#define CS4235_RIGHT_MASTER&t;0x1d&t;/* right master output control */
DECL|macro|CS4231_REC_UPR_CNT
mdefine_line|#define CS4231_REC_UPR_CNT&t;0x1e&t;/* record upper count */
DECL|macro|CS4231_REC_LWR_CNT
mdefine_line|#define CS4231_REC_LWR_CNT&t;0x1f&t;/* record lower count */
multiline_comment|/* definitions for codec register select port - CODECP( REGSEL ) */
DECL|macro|CS4231_INIT
mdefine_line|#define CS4231_INIT&t;&t;0x80&t;/* CODEC is initializing */
DECL|macro|CS4231_MCE
mdefine_line|#define CS4231_MCE&t;&t;0x40&t;/* mode change enable */
DECL|macro|CS4231_TRD
mdefine_line|#define CS4231_TRD&t;&t;0x20&t;/* transfer request disable */
multiline_comment|/* definitions for codec status register - CODECP( STATUS ) */
DECL|macro|CS4231_GLOBALIRQ
mdefine_line|#define CS4231_GLOBALIRQ&t;0x01&t;/* IRQ is active */
multiline_comment|/* definitions for codec irq status */
DECL|macro|CS4231_PLAYBACK_IRQ
mdefine_line|#define CS4231_PLAYBACK_IRQ&t;0x10
DECL|macro|CS4231_RECORD_IRQ
mdefine_line|#define CS4231_RECORD_IRQ&t;0x20
DECL|macro|CS4231_TIMER_IRQ
mdefine_line|#define CS4231_TIMER_IRQ&t;0x40
DECL|macro|CS4231_ALL_IRQS
mdefine_line|#define CS4231_ALL_IRQS&t;&t;0x70
DECL|macro|CS4231_REC_UNDERRUN
mdefine_line|#define CS4231_REC_UNDERRUN&t;0x08
DECL|macro|CS4231_REC_OVERRUN
mdefine_line|#define CS4231_REC_OVERRUN&t;0x04
DECL|macro|CS4231_PLY_OVERRUN
mdefine_line|#define CS4231_PLY_OVERRUN&t;0x02
DECL|macro|CS4231_PLY_UNDERRUN
mdefine_line|#define CS4231_PLY_UNDERRUN&t;0x01
multiline_comment|/* definitions for CS4231_LEFT_INPUT and CS4231_RIGHT_INPUT registers */
DECL|macro|CS4231_ENABLE_MIC_GAIN
mdefine_line|#define CS4231_ENABLE_MIC_GAIN&t;0x20
DECL|macro|CS4231_MIXS_LINE
mdefine_line|#define CS4231_MIXS_LINE&t;0x00
DECL|macro|CS4231_MIXS_AUX1
mdefine_line|#define CS4231_MIXS_AUX1&t;0x40
DECL|macro|CS4231_MIXS_MIC
mdefine_line|#define CS4231_MIXS_MIC&t;&t;0x80
DECL|macro|CS4231_MIXS_ALL
mdefine_line|#define CS4231_MIXS_ALL&t;&t;0xc0
multiline_comment|/* definitions for clock and data format register - CS4231_PLAYBK_FORMAT */
DECL|macro|CS4231_LINEAR_8
mdefine_line|#define CS4231_LINEAR_8&t;&t;0x00&t;/* 8-bit unsigned data */
DECL|macro|CS4231_ALAW_8
mdefine_line|#define CS4231_ALAW_8&t;&t;0x60&t;/* 8-bit A-law companded */
DECL|macro|CS4231_ULAW_8
mdefine_line|#define CS4231_ULAW_8&t;&t;0x20&t;/* 8-bit U-law companded */
DECL|macro|CS4231_LINEAR_16
mdefine_line|#define CS4231_LINEAR_16&t;0x40&t;/* 16-bit twos complement data - little endian */
DECL|macro|CS4231_LINEAR_16_BIG
mdefine_line|#define CS4231_LINEAR_16_BIG&t;0xc0&t;/* 16-bit twos complement data - big endian */
DECL|macro|CS4231_ADPCM_16
mdefine_line|#define CS4231_ADPCM_16&t;&t;0xa0&t;/* 16-bit ADPCM */
DECL|macro|CS4231_STEREO
mdefine_line|#define CS4231_STEREO&t;&t;0x10&t;/* stereo mode */
multiline_comment|/* bits 3-1 define frequency divisor */
DECL|macro|CS4231_XTAL1
mdefine_line|#define CS4231_XTAL1&t;&t;0x00&t;/* 24.576 crystal */
DECL|macro|CS4231_XTAL2
mdefine_line|#define CS4231_XTAL2&t;&t;0x01&t;/* 16.9344 crystal */
multiline_comment|/* definitions for interface control register - CS4231_IFACE_CTRL */
DECL|macro|CS4231_RECORD_PIO
mdefine_line|#define CS4231_RECORD_PIO&t;0x80&t;/* record PIO enable */
DECL|macro|CS4231_PLAYBACK_PIO
mdefine_line|#define CS4231_PLAYBACK_PIO&t;0x40&t;/* playback PIO enable */
DECL|macro|CS4231_CALIB_MODE
mdefine_line|#define CS4231_CALIB_MODE&t;0x18&t;/* calibration mode bits */
DECL|macro|CS4231_AUTOCALIB
mdefine_line|#define CS4231_AUTOCALIB&t;0x08&t;/* auto calibrate */
DECL|macro|CS4231_SINGLE_DMA
mdefine_line|#define CS4231_SINGLE_DMA&t;0x04&t;/* use single DMA channel */
DECL|macro|CS4231_RECORD_ENABLE
mdefine_line|#define CS4231_RECORD_ENABLE&t;0x02&t;/* record enable */
DECL|macro|CS4231_PLAYBACK_ENABLE
mdefine_line|#define CS4231_PLAYBACK_ENABLE&t;0x01&t;/* playback enable */
multiline_comment|/* definitions for pin control register - CS4231_PIN_CTRL */
DECL|macro|CS4231_IRQ_ENABLE
mdefine_line|#define CS4231_IRQ_ENABLE&t;0x02&t;/* enable IRQ */
DECL|macro|CS4231_XCTL1
mdefine_line|#define CS4231_XCTL1&t;&t;0x40&t;/* external control #1 */
DECL|macro|CS4231_XCTL0
mdefine_line|#define CS4231_XCTL0&t;&t;0x80&t;/* external control #0 */
multiline_comment|/* definitions for test and init register - CS4231_TEST_INIT */
DECL|macro|CS4231_CALIB_IN_PROGRESS
mdefine_line|#define CS4231_CALIB_IN_PROGRESS 0x20&t;/* auto calibrate in progress */
DECL|macro|CS4231_DMA_REQUEST
mdefine_line|#define CS4231_DMA_REQUEST&t;0x10&t;/* DMA request in progress */
multiline_comment|/* definitions for misc control register - CS4231_MISC_INFO */
DECL|macro|CS4231_MODE2
mdefine_line|#define CS4231_MODE2&t;&t;0x40&t;/* MODE 2 */
DECL|macro|CS4231_IW_MODE3
mdefine_line|#define CS4231_IW_MODE3&t;&t;0x6c&t;/* MODE 3 - InterWave enhanced mode */
DECL|macro|CS4231_4236_MODE3
mdefine_line|#define CS4231_4236_MODE3&t;0xe0&t;/* MODE 3 - CS4236+ enhanced mode */
multiline_comment|/* definitions for alternate feature 1 register - CS4231_ALT_FEATURE_1 */
DECL|macro|CS4231_DACZ
mdefine_line|#define&t;CS4231_DACZ&t;&t;0x01&t;/* zero DAC when underrun */
DECL|macro|CS4231_TIMER_ENABLE
mdefine_line|#define CS4231_TIMER_ENABLE&t;0x40&t;/* codec timer enable */
DECL|macro|CS4231_OLB
mdefine_line|#define CS4231_OLB&t;&t;0x80&t;/* output level bit */
multiline_comment|/* SBUS DMA register defines.  */
DECL|macro|APCCSR
mdefine_line|#define APCCSR&t;0x10UL&t;/* APC DMA CSR */
DECL|macro|APCCVA
mdefine_line|#define APCCVA&t;0x20UL&t;/* APC Capture DMA Address */
DECL|macro|APCCC
mdefine_line|#define APCCC&t;0x24UL&t;/* APC Capture Count */
DECL|macro|APCCNVA
mdefine_line|#define APCCNVA&t;0x28UL&t;/* APC Capture DMA Next Address */
DECL|macro|APCCNC
mdefine_line|#define APCCNC&t;0x2cUL&t;/* APC Capture Next Count */
DECL|macro|APCPVA
mdefine_line|#define APCPVA&t;0x30UL&t;/* APC Play DMA Address */
DECL|macro|APCPC
mdefine_line|#define APCPC&t;0x34UL&t;/* APC Play Count */
DECL|macro|APCPNVA
mdefine_line|#define APCPNVA&t;0x38UL&t;/* APC Play DMA Next Address */
DECL|macro|APCPNC
mdefine_line|#define APCPNC&t;0x3cUL&t;/* APC Play Next Count */
multiline_comment|/* APCCSR bits */
DECL|macro|APC_INT_PENDING
mdefine_line|#define APC_INT_PENDING 0x800000 /* Interrupt Pending */
DECL|macro|APC_PLAY_INT
mdefine_line|#define APC_PLAY_INT    0x400000 /* Playback interrupt */
DECL|macro|APC_CAPT_INT
mdefine_line|#define APC_CAPT_INT    0x200000 /* Capture interrupt */
DECL|macro|APC_GENL_INT
mdefine_line|#define APC_GENL_INT    0x100000 /* General interrupt */
DECL|macro|APC_XINT_ENA
mdefine_line|#define APC_XINT_ENA    0x80000  /* General ext int. enable */
DECL|macro|APC_XINT_PLAY
mdefine_line|#define APC_XINT_PLAY   0x40000  /* Playback ext intr */
DECL|macro|APC_XINT_CAPT
mdefine_line|#define APC_XINT_CAPT   0x20000  /* Capture ext intr */
DECL|macro|APC_XINT_GENL
mdefine_line|#define APC_XINT_GENL   0x10000  /* Error ext intr */
DECL|macro|APC_XINT_EMPT
mdefine_line|#define APC_XINT_EMPT   0x8000   /* Pipe empty interrupt (0 write to pva) */
DECL|macro|APC_XINT_PEMP
mdefine_line|#define APC_XINT_PEMP   0x4000   /* Play pipe empty (pva and pnva not set) */
DECL|macro|APC_XINT_PNVA
mdefine_line|#define APC_XINT_PNVA   0x2000   /* Playback NVA dirty */
DECL|macro|APC_XINT_PENA
mdefine_line|#define APC_XINT_PENA   0x1000   /* play pipe empty Int enable */
DECL|macro|APC_XINT_COVF
mdefine_line|#define APC_XINT_COVF   0x800    /* Cap data dropped on floor */
DECL|macro|APC_XINT_CNVA
mdefine_line|#define APC_XINT_CNVA   0x400    /* Capture NVA dirty */
DECL|macro|APC_XINT_CEMP
mdefine_line|#define APC_XINT_CEMP   0x200    /* Capture pipe empty (cva and cnva not set) */
DECL|macro|APC_XINT_CENA
mdefine_line|#define APC_XINT_CENA   0x100    /* Cap. pipe empty int enable */
DECL|macro|APC_PPAUSE
mdefine_line|#define APC_PPAUSE      0x80     /* Pause the play DMA */
DECL|macro|APC_CPAUSE
mdefine_line|#define APC_CPAUSE      0x40     /* Pause the capture DMA */
DECL|macro|APC_CDC_RESET
mdefine_line|#define APC_CDC_RESET   0x20     /* CODEC RESET */
DECL|macro|APC_PDMA_READY
mdefine_line|#define APC_PDMA_READY  0x08     /* Play DMA Go */
DECL|macro|APC_CDMA_READY
mdefine_line|#define APC_CDMA_READY  0x04     /* Capture DMA Go */
DECL|macro|APC_CHIP_RESET
mdefine_line|#define APC_CHIP_RESET  0x01     /* Reset the chip */
multiline_comment|/* EBUS DMA register offsets  */
DECL|macro|EBDMA_CSR
mdefine_line|#define EBDMA_CSR&t;0x00UL&t;/* Control/Status */
DECL|macro|EBDMA_ADDR
mdefine_line|#define EBDMA_ADDR&t;0x04UL&t;/* DMA Address */
DECL|macro|EBDMA_COUNT
mdefine_line|#define EBDMA_COUNT&t;0x08UL&t;/* DMA Count */
multiline_comment|/*&n; *  Some variables&n; */
DECL|variable|freq_bits
r_static
r_int
r_char
id|freq_bits
(braket
l_int|14
)braket
op_assign
(brace
multiline_comment|/* 5510 */
l_int|0x00
op_or
id|CS4231_XTAL2
comma
multiline_comment|/* 6620 */
l_int|0x0E
op_or
id|CS4231_XTAL2
comma
multiline_comment|/* 8000 */
l_int|0x00
op_or
id|CS4231_XTAL1
comma
multiline_comment|/* 9600 */
l_int|0x0E
op_or
id|CS4231_XTAL1
comma
multiline_comment|/* 11025 */
l_int|0x02
op_or
id|CS4231_XTAL2
comma
multiline_comment|/* 16000 */
l_int|0x02
op_or
id|CS4231_XTAL1
comma
multiline_comment|/* 18900 */
l_int|0x04
op_or
id|CS4231_XTAL2
comma
multiline_comment|/* 22050 */
l_int|0x06
op_or
id|CS4231_XTAL2
comma
multiline_comment|/* 27042 */
l_int|0x04
op_or
id|CS4231_XTAL1
comma
multiline_comment|/* 32000 */
l_int|0x06
op_or
id|CS4231_XTAL1
comma
multiline_comment|/* 33075 */
l_int|0x0C
op_or
id|CS4231_XTAL2
comma
multiline_comment|/* 37800 */
l_int|0x08
op_or
id|CS4231_XTAL2
comma
multiline_comment|/* 44100 */
l_int|0x0A
op_or
id|CS4231_XTAL2
comma
multiline_comment|/* 48000 */
l_int|0x0C
op_or
id|CS4231_XTAL1
)brace
suffix:semicolon
DECL|variable|rates
r_static
r_int
r_int
id|rates
(braket
l_int|14
)braket
op_assign
(brace
l_int|5510
comma
l_int|6620
comma
l_int|8000
comma
l_int|9600
comma
l_int|11025
comma
l_int|16000
comma
l_int|18900
comma
l_int|22050
comma
l_int|27042
comma
l_int|32000
comma
l_int|33075
comma
l_int|37800
comma
l_int|44100
comma
l_int|48000
)brace
suffix:semicolon
DECL|variable|hw_constraints_rates
r_static
id|snd_pcm_hw_constraint_list_t
id|hw_constraints_rates
op_assign
(brace
dot
id|count
op_assign
l_int|14
comma
dot
id|list
op_assign
id|rates
comma
)brace
suffix:semicolon
DECL|function|snd_cs4231_xrate
r_static
r_int
id|snd_cs4231_xrate
c_func
(paren
id|snd_pcm_runtime_t
op_star
id|runtime
)paren
(brace
r_return
id|snd_pcm_hw_constraint_list
c_func
(paren
id|runtime
comma
l_int|0
comma
id|SNDRV_PCM_HW_PARAM_RATE
comma
op_amp
id|hw_constraints_rates
)paren
suffix:semicolon
)brace
DECL|variable|snd_cs4231_original_image
r_static
r_int
r_char
id|snd_cs4231_original_image
(braket
l_int|32
)braket
op_assign
(brace
l_int|0x00
comma
multiline_comment|/* 00/00 - lic */
l_int|0x00
comma
multiline_comment|/* 01/01 - ric */
l_int|0x9f
comma
multiline_comment|/* 02/02 - la1ic */
l_int|0x9f
comma
multiline_comment|/* 03/03 - ra1ic */
l_int|0x9f
comma
multiline_comment|/* 04/04 - la2ic */
l_int|0x9f
comma
multiline_comment|/* 05/05 - ra2ic */
l_int|0xbf
comma
multiline_comment|/* 06/06 - loc */
l_int|0xbf
comma
multiline_comment|/* 07/07 - roc */
l_int|0x20
comma
multiline_comment|/* 08/08 - pdfr */
id|CS4231_AUTOCALIB
comma
multiline_comment|/* 09/09 - ic */
l_int|0x00
comma
multiline_comment|/* 0a/10 - pc */
l_int|0x00
comma
multiline_comment|/* 0b/11 - ti */
id|CS4231_MODE2
comma
multiline_comment|/* 0c/12 - mi */
l_int|0x00
comma
multiline_comment|/* 0d/13 - lbc */
l_int|0x00
comma
multiline_comment|/* 0e/14 - pbru */
l_int|0x00
comma
multiline_comment|/* 0f/15 - pbrl */
l_int|0x80
comma
multiline_comment|/* 10/16 - afei */
l_int|0x01
comma
multiline_comment|/* 11/17 - afeii */
l_int|0x9f
comma
multiline_comment|/* 12/18 - llic */
l_int|0x9f
comma
multiline_comment|/* 13/19 - rlic */
l_int|0x00
comma
multiline_comment|/* 14/20 - tlb */
l_int|0x00
comma
multiline_comment|/* 15/21 - thb */
l_int|0x00
comma
multiline_comment|/* 16/22 - la3mic/reserved */
l_int|0x00
comma
multiline_comment|/* 17/23 - ra3mic/reserved */
l_int|0x00
comma
multiline_comment|/* 18/24 - afs */
l_int|0x00
comma
multiline_comment|/* 19/25 - lamoc/version */
l_int|0x00
comma
multiline_comment|/* 1a/26 - mioc */
l_int|0x00
comma
multiline_comment|/* 1b/27 - ramoc/reserved */
l_int|0x20
comma
multiline_comment|/* 1c/28 - cdfr */
l_int|0x00
comma
multiline_comment|/* 1d/29 - res4 */
l_int|0x00
comma
multiline_comment|/* 1e/30 - cbru */
l_int|0x00
comma
multiline_comment|/* 1f/31 - cbrl */
)brace
suffix:semicolon
DECL|function|__cs4231_readb
r_static
id|u8
id|__cs4231_readb
c_func
(paren
id|cs4231_t
op_star
id|cp
comma
r_void
id|__iomem
op_star
id|reg_addr
)paren
(brace
macro_line|#ifdef EBUS_SUPPORT
r_if
c_cond
(paren
id|cp-&gt;flags
op_amp
id|CS4231_FLAG_EBUS
)paren
(brace
r_return
id|readb
c_func
(paren
id|reg_addr
)paren
suffix:semicolon
)brace
r_else
(brace
macro_line|#endif
macro_line|#ifdef SBUS_SUPPORT
r_return
id|sbus_readb
c_func
(paren
id|reg_addr
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef EBUS_SUPPORT
)brace
macro_line|#endif
)brace
DECL|function|__cs4231_writeb
r_static
r_void
id|__cs4231_writeb
c_func
(paren
id|cs4231_t
op_star
id|cp
comma
id|u8
id|val
comma
r_void
id|__iomem
op_star
id|reg_addr
)paren
(brace
macro_line|#ifdef EBUS_SUPPORT
r_if
c_cond
(paren
id|cp-&gt;flags
op_amp
id|CS4231_FLAG_EBUS
)paren
(brace
r_return
id|writeb
c_func
(paren
id|val
comma
id|reg_addr
)paren
suffix:semicolon
)brace
r_else
(brace
macro_line|#endif
macro_line|#ifdef SBUS_SUPPORT
r_return
id|sbus_writeb
c_func
(paren
id|val
comma
id|reg_addr
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef EBUS_SUPPORT
)brace
macro_line|#endif
)brace
multiline_comment|/*&n; *  Basic I/O functions&n; */
DECL|function|snd_cs4231_outm
r_static
r_void
id|snd_cs4231_outm
c_func
(paren
id|cs4231_t
op_star
id|chip
comma
r_int
r_char
id|reg
comma
r_int
r_char
id|mask
comma
r_int
r_char
id|value
)paren
(brace
r_int
id|timeout
suffix:semicolon
r_int
r_char
id|tmp
suffix:semicolon
r_for
c_loop
(paren
id|timeout
op_assign
l_int|250
suffix:semicolon
id|timeout
OG
l_int|0
op_logical_and
(paren
id|__cs4231_readb
c_func
(paren
id|chip
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
op_amp
id|CS4231_INIT
)paren
suffix:semicolon
id|timeout
op_decrement
)paren
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SND_DEBUG
r_if
c_cond
(paren
id|__cs4231_readb
c_func
(paren
id|chip
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
op_amp
id|CS4231_INIT
)paren
id|snd_printk
c_func
(paren
l_string|&quot;outm: auto calibration time out - reg = 0x%x, value = 0x%x&bslash;n&quot;
comma
id|reg
comma
id|value
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|chip-&gt;calibrate_mute
)paren
(brace
id|chip-&gt;image
(braket
id|reg
)braket
op_and_assign
id|mask
suffix:semicolon
id|chip-&gt;image
(braket
id|reg
)braket
op_or_assign
id|value
suffix:semicolon
)brace
r_else
(brace
id|__cs4231_writeb
c_func
(paren
id|chip
comma
id|chip-&gt;mce_bit
op_or
id|reg
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|tmp
op_assign
(paren
id|chip-&gt;image
(braket
id|reg
)braket
op_amp
id|mask
)paren
op_or
id|value
suffix:semicolon
id|__cs4231_writeb
c_func
(paren
id|chip
comma
id|tmp
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REG
)paren
)paren
suffix:semicolon
id|chip-&gt;image
(braket
id|reg
)braket
op_assign
id|tmp
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_cs4231_dout
r_static
r_void
id|snd_cs4231_dout
c_func
(paren
id|cs4231_t
op_star
id|chip
comma
r_int
r_char
id|reg
comma
r_int
r_char
id|value
)paren
(brace
r_int
id|timeout
suffix:semicolon
r_for
c_loop
(paren
id|timeout
op_assign
l_int|250
suffix:semicolon
id|timeout
OG
l_int|0
op_logical_and
(paren
id|__cs4231_readb
c_func
(paren
id|chip
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
op_amp
id|CS4231_INIT
)paren
suffix:semicolon
id|timeout
op_decrement
)paren
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|__cs4231_writeb
c_func
(paren
id|chip
comma
id|chip-&gt;mce_bit
op_or
id|reg
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
suffix:semicolon
id|__cs4231_writeb
c_func
(paren
id|chip
comma
id|value
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REG
)paren
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4231_out
r_static
r_void
id|snd_cs4231_out
c_func
(paren
id|cs4231_t
op_star
id|chip
comma
r_int
r_char
id|reg
comma
r_int
r_char
id|value
)paren
(brace
r_int
id|timeout
suffix:semicolon
r_for
c_loop
(paren
id|timeout
op_assign
l_int|250
suffix:semicolon
id|timeout
OG
l_int|0
op_logical_and
(paren
id|__cs4231_readb
c_func
(paren
id|chip
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
op_amp
id|CS4231_INIT
)paren
suffix:semicolon
id|timeout
op_decrement
)paren
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SND_DEBUG
r_if
c_cond
(paren
id|__cs4231_readb
c_func
(paren
id|chip
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
op_amp
id|CS4231_INIT
)paren
id|snd_printk
c_func
(paren
l_string|&quot;out: auto calibration time out - reg = 0x%x, value = 0x%x&bslash;n&quot;
comma
id|reg
comma
id|value
)paren
suffix:semicolon
macro_line|#endif
id|__cs4231_writeb
c_func
(paren
id|chip
comma
id|chip-&gt;mce_bit
op_or
id|reg
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
suffix:semicolon
id|__cs4231_writeb
c_func
(paren
id|chip
comma
id|value
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REG
)paren
)paren
suffix:semicolon
id|chip-&gt;image
(braket
id|reg
)braket
op_assign
id|value
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;codec out - reg 0x%x = 0x%x&bslash;n&quot;
comma
id|chip-&gt;mce_bit
op_or
id|reg
comma
id|value
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|snd_cs4231_in
r_static
r_int
r_char
id|snd_cs4231_in
c_func
(paren
id|cs4231_t
op_star
id|chip
comma
r_int
r_char
id|reg
)paren
(brace
r_int
id|timeout
suffix:semicolon
r_int
r_char
id|ret
suffix:semicolon
r_for
c_loop
(paren
id|timeout
op_assign
l_int|250
suffix:semicolon
id|timeout
OG
l_int|0
op_logical_and
(paren
id|__cs4231_readb
c_func
(paren
id|chip
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
op_amp
id|CS4231_INIT
)paren
suffix:semicolon
id|timeout
op_decrement
)paren
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SND_DEBUG
r_if
c_cond
(paren
id|__cs4231_readb
c_func
(paren
id|chip
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
op_amp
id|CS4231_INIT
)paren
id|snd_printk
c_func
(paren
l_string|&quot;in: auto calibration time out - reg = 0x%x&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
macro_line|#endif
id|__cs4231_writeb
c_func
(paren
id|chip
comma
id|chip-&gt;mce_bit
op_or
id|reg
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|ret
op_assign
id|__cs4231_readb
c_func
(paren
id|chip
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REG
)paren
)paren
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;codec in - reg 0x%x = 0x%x&bslash;n&quot;
comma
id|chip-&gt;mce_bit
op_or
id|reg
comma
id|ret
)paren
suffix:semicolon
macro_line|#endif
r_return
id|ret
suffix:semicolon
)brace
macro_line|#if 0
r_static
r_void
id|snd_cs4231_debug
c_func
(paren
id|cs4231_t
op_star
id|chip
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;CS4231 REGS:      INDEX = 0x%02x  &quot;
comma
id|__cs4231_readb
c_func
(paren
id|chip
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;                 STATUS = 0x%02x&bslash;n&quot;
comma
id|__cs4231_readb
c_func
(paren
id|chip
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|STATUS
)paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x00: left input      = 0x%02x  &quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x00
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x10: alt 1 (CFIG 2)  = 0x%02x&bslash;n&quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x10
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x01: right input     = 0x%02x  &quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x01
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x11: alt 2 (CFIG 3)  = 0x%02x&bslash;n&quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x11
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x02: GF1 left input  = 0x%02x  &quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x02
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x12: left line in    = 0x%02x&bslash;n&quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x12
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x03: GF1 right input = 0x%02x  &quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x03
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x13: right line in   = 0x%02x&bslash;n&quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x13
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x04: CD left input   = 0x%02x  &quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x04
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x14: timer low       = 0x%02x&bslash;n&quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x14
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x05: CD right input  = 0x%02x  &quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x05
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x15: timer high      = 0x%02x&bslash;n&quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x15
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x06: left output     = 0x%02x  &quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x06
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x16: left MIC (PnP)  = 0x%02x&bslash;n&quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x16
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x07: right output    = 0x%02x  &quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x07
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x17: right MIC (PnP) = 0x%02x&bslash;n&quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x17
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x08: playback format = 0x%02x  &quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x08
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x18: IRQ status      = 0x%02x&bslash;n&quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x18
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x09: iface (CFIG 1)  = 0x%02x  &quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x09
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x19: left line out   = 0x%02x&bslash;n&quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x19
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x0a: pin control     = 0x%02x  &quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x0a
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x1a: mono control    = 0x%02x&bslash;n&quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x1a
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x0b: init &amp; status   = 0x%02x  &quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x0b
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x1b: right line out  = 0x%02x&bslash;n&quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x1b
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x0c: revision &amp; mode = 0x%02x  &quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x0c
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x1c: record format   = 0x%02x&bslash;n&quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x1c
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x0d: loopback        = 0x%02x  &quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x0d
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x1d: var freq (PnP)  = 0x%02x&bslash;n&quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x1d
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x0e: ply upr count   = 0x%02x  &quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x0e
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x1e: rec upr count   = 0x%02x&bslash;n&quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x1e
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x0f: ply lwr count   = 0x%02x  &quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x0f
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;  0x1f: rec lwr count   = 0x%02x&bslash;n&quot;
comma
id|snd_cs4231_in
c_func
(paren
id|chip
comma
l_int|0x1f
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; *  CS4231 detection / MCE routines&n; */
DECL|function|snd_cs4231_busy_wait
r_static
r_void
id|snd_cs4231_busy_wait
c_func
(paren
id|cs4231_t
op_star
id|chip
)paren
(brace
r_int
id|timeout
suffix:semicolon
multiline_comment|/* huh.. looks like this sequence is proper for CS4231A chip (GUS MAX) */
r_for
c_loop
(paren
id|timeout
op_assign
l_int|5
suffix:semicolon
id|timeout
OG
l_int|0
suffix:semicolon
id|timeout
op_decrement
)paren
id|__cs4231_readb
c_func
(paren
id|chip
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
suffix:semicolon
multiline_comment|/* end of cleanup sequence */
r_for
c_loop
(paren
id|timeout
op_assign
l_int|250
suffix:semicolon
id|timeout
OG
l_int|0
op_logical_and
(paren
id|__cs4231_readb
c_func
(paren
id|chip
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
op_amp
id|CS4231_INIT
)paren
suffix:semicolon
id|timeout
op_decrement
)paren
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4231_mce_up
r_static
r_void
id|snd_cs4231_mce_up
c_func
(paren
id|cs4231_t
op_star
id|chip
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|timeout
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|timeout
op_assign
l_int|250
suffix:semicolon
id|timeout
OG
l_int|0
op_logical_and
(paren
id|__cs4231_readb
c_func
(paren
id|chip
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
op_amp
id|CS4231_INIT
)paren
suffix:semicolon
id|timeout
op_decrement
)paren
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SND_DEBUG
r_if
c_cond
(paren
id|__cs4231_readb
c_func
(paren
id|chip
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
op_amp
id|CS4231_INIT
)paren
id|snd_printk
c_func
(paren
l_string|&quot;mce_up - auto calibration time out (0)&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|chip-&gt;mce_bit
op_or_assign
id|CS4231_MCE
suffix:semicolon
id|timeout
op_assign
id|__cs4231_readb
c_func
(paren
id|chip
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|timeout
op_eq
l_int|0x80
)paren
id|snd_printk
c_func
(paren
l_string|&quot;mce_up [%p]: serious init problem - codec still busy&bslash;n&quot;
comma
id|chip-&gt;port
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|timeout
op_amp
id|CS4231_MCE
)paren
)paren
id|__cs4231_writeb
c_func
(paren
id|chip
comma
id|chip-&gt;mce_bit
op_or
(paren
id|timeout
op_amp
l_int|0x1f
)paren
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4231_mce_down
r_static
r_void
id|snd_cs4231_mce_down
c_func
(paren
id|cs4231_t
op_star
id|chip
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|timeout
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_busy_wait
c_func
(paren
id|chip
)paren
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;(1) timeout = %i&bslash;n&quot;
comma
id|timeout
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SND_DEBUG
r_if
c_cond
(paren
id|__cs4231_readb
c_func
(paren
id|chip
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
op_amp
id|CS4231_INIT
)paren
id|snd_printk
c_func
(paren
l_string|&quot;mce_down [%p] - auto calibration time out (0)&bslash;n&quot;
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
suffix:semicolon
macro_line|#endif
id|chip-&gt;mce_bit
op_and_assign
op_complement
id|CS4231_MCE
suffix:semicolon
id|timeout
op_assign
id|__cs4231_readb
c_func
(paren
id|chip
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
suffix:semicolon
id|__cs4231_writeb
c_func
(paren
id|chip
comma
id|chip-&gt;mce_bit
op_or
(paren
id|timeout
op_amp
l_int|0x1f
)paren
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|timeout
op_eq
l_int|0x80
)paren
id|snd_printk
c_func
(paren
l_string|&quot;mce_down [%p]: serious init problem - codec still busy&bslash;n&quot;
comma
id|chip-&gt;port
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|timeout
op_amp
id|CS4231_MCE
)paren
op_eq
l_int|0
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|snd_cs4231_busy_wait
c_func
(paren
id|chip
)paren
suffix:semicolon
multiline_comment|/* calibration process */
r_for
c_loop
(paren
id|timeout
op_assign
l_int|500
suffix:semicolon
id|timeout
OG
l_int|0
op_logical_and
(paren
id|snd_cs4231_in
c_func
(paren
id|chip
comma
id|CS4231_TEST_INIT
)paren
op_amp
id|CS4231_CALIB_IN_PROGRESS
)paren
op_eq
l_int|0
suffix:semicolon
id|timeout
op_decrement
)paren
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|snd_cs4231_in
c_func
(paren
id|chip
comma
id|CS4231_TEST_INIT
)paren
op_amp
id|CS4231_CALIB_IN_PROGRESS
)paren
op_eq
l_int|0
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;cs4231_mce_down - auto calibration time out (1)&bslash;n&quot;
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;(2) timeout = %i, jiffies = %li&bslash;n&quot;
comma
id|timeout
comma
id|jiffies
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* in 10ms increments, check condition, up to 250ms */
id|timeout
op_assign
l_int|25
suffix:semicolon
r_while
c_loop
(paren
id|snd_cs4231_in
c_func
(paren
id|chip
comma
id|CS4231_TEST_INIT
)paren
op_amp
id|CS4231_CALIB_IN_PROGRESS
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|timeout
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;mce_down - auto calibration time out (2)&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|msleep
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;(3) jiffies = %li&bslash;n&quot;
comma
id|jiffies
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* in 10ms increments, check condition, up to 100ms */
id|timeout
op_assign
l_int|10
suffix:semicolon
r_while
c_loop
(paren
id|__cs4231_readb
c_func
(paren
id|chip
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
op_amp
id|CS4231_INIT
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_decrement
id|timeout
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;mce_down - auto calibration time out (3)&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|msleep
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;(4) jiffies = %li&bslash;n&quot;
comma
id|jiffies
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;mce_down - exit = 0x%x&bslash;n&quot;
comma
id|__cs4231_readb
c_func
(paren
id|chip
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#if 0 /* Unused for now... */
r_static
r_int
r_int
id|snd_cs4231_get_count
c_func
(paren
r_int
r_char
id|format
comma
r_int
r_int
id|size
)paren
(brace
r_switch
c_cond
(paren
id|format
op_amp
l_int|0xe0
)paren
(brace
r_case
id|CS4231_LINEAR_16
suffix:colon
r_case
id|CS4231_LINEAR_16_BIG
suffix:colon
id|size
op_rshift_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CS4231_ADPCM_16
suffix:colon
r_return
id|size
op_rshift
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|format
op_amp
id|CS4231_STEREO
)paren
id|size
op_rshift_assign
l_int|1
suffix:semicolon
r_return
id|size
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef EBUS_SUPPORT
DECL|function|snd_cs4231_ebus_advance_dma
r_static
r_void
id|snd_cs4231_ebus_advance_dma
c_func
(paren
r_struct
id|ebus_dma_info
op_star
id|p
comma
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
r_int
op_star
id|periods_sent
)paren
(brace
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_int
r_int
id|dma_size
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|offset
op_assign
id|dma_size
op_star
(paren
op_star
id|periods_sent
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dma_size
op_ge
(paren
l_int|1
op_lshift
l_int|24
)paren
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ebus_dma_request
c_func
(paren
id|p
comma
id|runtime-&gt;dma_addr
op_plus
id|offset
comma
id|dma_size
)paren
)paren
r_return
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;ebus_advance: Sent period %u (size[%x] offset[%x])&bslash;n&quot;
comma
(paren
op_star
id|periods_sent
)paren
comma
id|dma_size
comma
id|offset
)paren
suffix:semicolon
macro_line|#endif
(paren
op_star
id|periods_sent
)paren
op_assign
(paren
(paren
op_star
id|periods_sent
)paren
op_plus
l_int|1
)paren
op_mod
id|runtime-&gt;periods
suffix:semicolon
)brace
)brace
macro_line|#endif
DECL|function|cs4231_dma_trigger
r_static
r_void
id|cs4231_dma_trigger
c_func
(paren
id|cs4231_t
op_star
id|chip
comma
r_int
r_int
id|what
comma
r_int
id|on
)paren
(brace
macro_line|#ifdef EBUS_SUPPORT
r_if
c_cond
(paren
id|chip-&gt;flags
op_amp
id|CS4231_FLAG_EBUS
)paren
(brace
r_if
c_cond
(paren
id|what
op_amp
id|CS4231_PLAYBACK_ENABLE
)paren
(brace
r_if
c_cond
(paren
id|on
)paren
(brace
id|ebus_dma_prepare
c_func
(paren
op_amp
id|chip-&gt;eb2p
comma
l_int|0
)paren
suffix:semicolon
id|ebus_dma_enable
c_func
(paren
op_amp
id|chip-&gt;eb2p
comma
l_int|1
)paren
suffix:semicolon
id|snd_cs4231_ebus_advance_dma
c_func
(paren
op_amp
id|chip-&gt;eb2p
comma
id|chip-&gt;playback_substream
comma
op_amp
id|chip-&gt;p_periods_sent
)paren
suffix:semicolon
)brace
r_else
(brace
id|ebus_dma_enable
c_func
(paren
op_amp
id|chip-&gt;eb2p
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|what
op_amp
id|CS4231_RECORD_ENABLE
)paren
(brace
r_if
c_cond
(paren
id|on
)paren
(brace
id|ebus_dma_prepare
c_func
(paren
op_amp
id|chip-&gt;eb2c
comma
l_int|1
)paren
suffix:semicolon
id|ebus_dma_enable
c_func
(paren
op_amp
id|chip-&gt;eb2c
comma
l_int|1
)paren
suffix:semicolon
id|snd_cs4231_ebus_advance_dma
c_func
(paren
op_amp
id|chip-&gt;eb2c
comma
id|chip-&gt;capture_substream
comma
op_amp
id|chip-&gt;c_periods_sent
)paren
suffix:semicolon
)brace
r_else
(brace
id|ebus_dma_enable
c_func
(paren
op_amp
id|chip-&gt;eb2c
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
(brace
macro_line|#endif
macro_line|#ifdef SBUS_SUPPORT
macro_line|#endif
macro_line|#ifdef EBUS_SUPPORT
)brace
macro_line|#endif
)brace
DECL|function|snd_cs4231_trigger
r_static
r_int
id|snd_cs4231_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SNDRV_PCM_TRIGGER_START
suffix:colon
r_case
id|SNDRV_PCM_TRIGGER_STOP
suffix:colon
(brace
r_int
r_int
id|what
op_assign
l_int|0
suffix:semicolon
id|snd_pcm_substream_t
op_star
id|s
suffix:semicolon
r_struct
id|list_head
op_star
id|pos
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|snd_pcm_group_for_each
c_func
(paren
id|pos
comma
id|substream
)paren
(brace
id|s
op_assign
id|snd_pcm_group_substream_entry
c_func
(paren
id|pos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s
op_eq
id|chip-&gt;playback_substream
)paren
(brace
id|what
op_or_assign
id|CS4231_PLAYBACK_ENABLE
suffix:semicolon
id|snd_pcm_trigger_done
c_func
(paren
id|s
comma
id|substream
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|s
op_eq
id|chip-&gt;capture_substream
)paren
(brace
id|what
op_or_assign
id|CS4231_RECORD_ENABLE
suffix:semicolon
id|snd_pcm_trigger_done
c_func
(paren
id|s
comma
id|substream
)paren
suffix:semicolon
)brace
)brace
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;TRIGGER: what[%x] on(%d)&bslash;n&quot;
comma
id|what
comma
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_START
)paren
)paren
suffix:semicolon
macro_line|#endif
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_START
)paren
(brace
id|cs4231_dma_trigger
c_func
(paren
id|chip
comma
id|what
comma
l_int|1
)paren
suffix:semicolon
id|chip-&gt;image
(braket
id|CS4231_IFACE_CTRL
)braket
op_or_assign
id|what
suffix:semicolon
r_if
c_cond
(paren
id|what
op_amp
id|CS4231_PLAYBACK_ENABLE
)paren
(brace
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_PLY_LWR_CNT
comma
l_int|0xff
)paren
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_PLY_UPR_CNT
comma
l_int|0xff
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|what
op_amp
id|CS4231_RECORD_ENABLE
)paren
(brace
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_REC_LWR_CNT
comma
l_int|0xff
)paren
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_REC_UPR_CNT
comma
l_int|0xff
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|cs4231_dma_trigger
c_func
(paren
id|chip
comma
id|what
comma
l_int|0
)paren
suffix:semicolon
id|chip-&gt;image
(braket
id|CS4231_IFACE_CTRL
)braket
op_and_assign
op_complement
id|what
suffix:semicolon
)brace
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_IFACE_CTRL
comma
id|chip-&gt;image
(braket
id|CS4231_IFACE_CTRL
)braket
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#if 0
id|snd_cs4231_debug
c_func
(paren
id|chip
)paren
suffix:semicolon
macro_line|#endif
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/*&n; *  CODEC I/O&n; */
DECL|function|snd_cs4231_get_rate
r_static
r_int
r_char
id|snd_cs4231_get_rate
c_func
(paren
r_int
r_int
id|rate
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|14
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|rate
op_eq
id|rates
(braket
id|i
)braket
)paren
r_return
id|freq_bits
(braket
id|i
)braket
suffix:semicolon
singleline_comment|// snd_BUG();
r_return
id|freq_bits
(braket
l_int|13
)braket
suffix:semicolon
)brace
DECL|function|snd_cs4231_get_format
r_static
r_int
r_char
id|snd_cs4231_get_format
c_func
(paren
id|cs4231_t
op_star
id|chip
comma
r_int
id|format
comma
r_int
id|channels
)paren
(brace
r_int
r_char
id|rformat
suffix:semicolon
id|rformat
op_assign
id|CS4231_LINEAR_8
suffix:semicolon
r_switch
c_cond
(paren
id|format
)paren
(brace
r_case
id|SNDRV_PCM_FORMAT_MU_LAW
suffix:colon
id|rformat
op_assign
id|CS4231_ULAW_8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_FORMAT_A_LAW
suffix:colon
id|rformat
op_assign
id|CS4231_ALAW_8
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_FORMAT_S16_LE
suffix:colon
id|rformat
op_assign
id|CS4231_LINEAR_16
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_FORMAT_S16_BE
suffix:colon
id|rformat
op_assign
id|CS4231_LINEAR_16_BIG
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SNDRV_PCM_FORMAT_IMA_ADPCM
suffix:colon
id|rformat
op_assign
id|CS4231_ADPCM_16
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|channels
OG
l_int|1
)paren
id|rformat
op_or_assign
id|CS4231_STEREO
suffix:semicolon
macro_line|#if 0
id|snd_printk
c_func
(paren
l_string|&quot;get_format: 0x%x (mode=0x%x)&bslash;n&quot;
comma
id|format
comma
id|mode
)paren
suffix:semicolon
macro_line|#endif
r_return
id|rformat
suffix:semicolon
)brace
DECL|function|snd_cs4231_calibrate_mute
r_static
r_void
id|snd_cs4231_calibrate_mute
c_func
(paren
id|cs4231_t
op_star
id|chip
comma
r_int
id|mute
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|mute
op_assign
id|mute
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;calibrate_mute
op_eq
id|mute
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|mute
)paren
(brace
id|snd_cs4231_dout
c_func
(paren
id|chip
comma
id|CS4231_LEFT_INPUT
comma
id|chip-&gt;image
(braket
id|CS4231_LEFT_INPUT
)braket
)paren
suffix:semicolon
id|snd_cs4231_dout
c_func
(paren
id|chip
comma
id|CS4231_RIGHT_INPUT
comma
id|chip-&gt;image
(braket
id|CS4231_RIGHT_INPUT
)braket
)paren
suffix:semicolon
id|snd_cs4231_dout
c_func
(paren
id|chip
comma
id|CS4231_LOOPBACK
comma
id|chip-&gt;image
(braket
id|CS4231_LOOPBACK
)braket
)paren
suffix:semicolon
)brace
id|snd_cs4231_dout
c_func
(paren
id|chip
comma
id|CS4231_AUX1_LEFT_INPUT
comma
id|mute
ques
c_cond
l_int|0x80
suffix:colon
id|chip-&gt;image
(braket
id|CS4231_AUX1_LEFT_INPUT
)braket
)paren
suffix:semicolon
id|snd_cs4231_dout
c_func
(paren
id|chip
comma
id|CS4231_AUX1_RIGHT_INPUT
comma
id|mute
ques
c_cond
l_int|0x80
suffix:colon
id|chip-&gt;image
(braket
id|CS4231_AUX1_RIGHT_INPUT
)braket
)paren
suffix:semicolon
id|snd_cs4231_dout
c_func
(paren
id|chip
comma
id|CS4231_AUX2_LEFT_INPUT
comma
id|mute
ques
c_cond
l_int|0x80
suffix:colon
id|chip-&gt;image
(braket
id|CS4231_AUX2_LEFT_INPUT
)braket
)paren
suffix:semicolon
id|snd_cs4231_dout
c_func
(paren
id|chip
comma
id|CS4231_AUX2_RIGHT_INPUT
comma
id|mute
ques
c_cond
l_int|0x80
suffix:colon
id|chip-&gt;image
(braket
id|CS4231_AUX2_RIGHT_INPUT
)braket
)paren
suffix:semicolon
id|snd_cs4231_dout
c_func
(paren
id|chip
comma
id|CS4231_LEFT_OUTPUT
comma
id|mute
ques
c_cond
l_int|0x80
suffix:colon
id|chip-&gt;image
(braket
id|CS4231_LEFT_OUTPUT
)braket
)paren
suffix:semicolon
id|snd_cs4231_dout
c_func
(paren
id|chip
comma
id|CS4231_RIGHT_OUTPUT
comma
id|mute
ques
c_cond
l_int|0x80
suffix:colon
id|chip-&gt;image
(braket
id|CS4231_RIGHT_OUTPUT
)braket
)paren
suffix:semicolon
id|snd_cs4231_dout
c_func
(paren
id|chip
comma
id|CS4231_LEFT_LINE_IN
comma
id|mute
ques
c_cond
l_int|0x80
suffix:colon
id|chip-&gt;image
(braket
id|CS4231_LEFT_LINE_IN
)braket
)paren
suffix:semicolon
id|snd_cs4231_dout
c_func
(paren
id|chip
comma
id|CS4231_RIGHT_LINE_IN
comma
id|mute
ques
c_cond
l_int|0x80
suffix:colon
id|chip-&gt;image
(braket
id|CS4231_RIGHT_LINE_IN
)braket
)paren
suffix:semicolon
id|snd_cs4231_dout
c_func
(paren
id|chip
comma
id|CS4231_MONO_CTRL
comma
id|mute
ques
c_cond
l_int|0xc0
suffix:colon
id|chip-&gt;image
(braket
id|CS4231_MONO_CTRL
)braket
)paren
suffix:semicolon
id|chip-&gt;calibrate_mute
op_assign
id|mute
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4231_playback_format
r_static
r_void
id|snd_cs4231_playback_format
c_func
(paren
id|cs4231_t
op_star
id|chip
comma
id|snd_pcm_hw_params_t
op_star
id|params
comma
r_int
r_char
id|pdfr
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|down
c_func
(paren
op_amp
id|chip-&gt;mce_mutex
)paren
suffix:semicolon
id|snd_cs4231_calibrate_mute
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
id|snd_cs4231_mce_up
c_func
(paren
id|chip
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_PLAYBK_FORMAT
comma
(paren
id|chip-&gt;image
(braket
id|CS4231_IFACE_CTRL
)braket
op_amp
id|CS4231_RECORD_ENABLE
)paren
ques
c_cond
(paren
id|pdfr
op_amp
l_int|0xf0
)paren
op_or
(paren
id|chip-&gt;image
(braket
id|CS4231_REC_FORMAT
)braket
op_amp
l_int|0x0f
)paren
suffix:colon
id|pdfr
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_mce_down
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_cs4231_calibrate_mute
c_func
(paren
id|chip
comma
l_int|0
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|chip-&gt;mce_mutex
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4231_capture_format
r_static
r_void
id|snd_cs4231_capture_format
c_func
(paren
id|cs4231_t
op_star
id|chip
comma
id|snd_pcm_hw_params_t
op_star
id|params
comma
r_int
r_char
id|cdfr
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|down
c_func
(paren
op_amp
id|chip-&gt;mce_mutex
)paren
suffix:semicolon
id|snd_cs4231_calibrate_mute
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
id|snd_cs4231_mce_up
c_func
(paren
id|chip
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chip-&gt;image
(braket
id|CS4231_IFACE_CTRL
)braket
op_amp
id|CS4231_PLAYBACK_ENABLE
)paren
)paren
(brace
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_PLAYBK_FORMAT
comma
(paren
(paren
id|chip-&gt;image
(braket
id|CS4231_PLAYBK_FORMAT
)braket
)paren
op_amp
l_int|0xf0
)paren
op_or
(paren
id|cdfr
op_amp
l_int|0x0f
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_mce_down
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_cs4231_mce_up
c_func
(paren
id|chip
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_REC_FORMAT
comma
id|cdfr
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_mce_down
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_cs4231_calibrate_mute
c_func
(paren
id|chip
comma
l_int|0
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|chip-&gt;mce_mutex
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Timer interface&n; */
DECL|function|snd_cs4231_timer_resolution
r_static
r_int
r_int
id|snd_cs4231_timer_resolution
c_func
(paren
id|snd_timer_t
op_star
id|timer
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|snd_timer_chip
c_func
(paren
id|timer
)paren
suffix:semicolon
r_return
id|chip-&gt;image
(braket
id|CS4231_PLAYBK_FORMAT
)braket
op_amp
l_int|1
ques
c_cond
l_int|9969
suffix:colon
l_int|9920
suffix:semicolon
)brace
DECL|function|snd_cs4231_timer_start
r_static
r_int
id|snd_cs4231_timer_start
c_func
(paren
id|snd_timer_t
op_star
id|timer
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|ticks
suffix:semicolon
id|cs4231_t
op_star
id|chip
op_assign
id|snd_timer_chip
c_func
(paren
id|timer
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ticks
op_assign
id|timer-&gt;sticks
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chip-&gt;image
(braket
id|CS4231_ALT_FEATURE_1
)braket
op_amp
id|CS4231_TIMER_ENABLE
)paren
op_eq
l_int|0
op_logical_or
(paren
r_int
r_char
)paren
(paren
id|ticks
op_rshift
l_int|8
)paren
op_ne
id|chip-&gt;image
(braket
id|CS4231_TIMER_HIGH
)braket
op_logical_or
(paren
r_int
r_char
)paren
id|ticks
op_ne
id|chip-&gt;image
(braket
id|CS4231_TIMER_LOW
)braket
)paren
(brace
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_TIMER_HIGH
comma
id|chip-&gt;image
(braket
id|CS4231_TIMER_HIGH
)braket
op_assign
(paren
r_int
r_char
)paren
(paren
id|ticks
op_rshift
l_int|8
)paren
)paren
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_TIMER_LOW
comma
id|chip-&gt;image
(braket
id|CS4231_TIMER_LOW
)braket
op_assign
(paren
r_int
r_char
)paren
id|ticks
)paren
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_ALT_FEATURE_1
comma
id|chip-&gt;image
(braket
id|CS4231_ALT_FEATURE_1
)braket
op_or
id|CS4231_TIMER_ENABLE
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4231_timer_stop
r_static
r_int
id|snd_cs4231_timer_stop
c_func
(paren
id|snd_timer_t
op_star
id|timer
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|cs4231_t
op_star
id|chip
op_assign
id|snd_timer_chip
c_func
(paren
id|timer
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_ALT_FEATURE_1
comma
id|chip-&gt;image
(braket
id|CS4231_ALT_FEATURE_1
)braket
op_and_assign
op_complement
id|CS4231_TIMER_ENABLE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4231_init
r_static
r_void
id|snd_cs4231_init
c_func
(paren
id|cs4231_t
op_star
id|chip
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|snd_cs4231_mce_down
c_func
(paren
id|chip
)paren
suffix:semicolon
macro_line|#ifdef SNDRV_DEBUG_MCE
id|snd_printk
c_func
(paren
l_string|&quot;init: (1)&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|snd_cs4231_mce_up
c_func
(paren
id|chip
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|chip-&gt;image
(braket
id|CS4231_IFACE_CTRL
)braket
op_and_assign
op_complement
(paren
id|CS4231_PLAYBACK_ENABLE
op_or
id|CS4231_PLAYBACK_PIO
op_or
id|CS4231_RECORD_ENABLE
op_or
id|CS4231_RECORD_PIO
op_or
id|CS4231_CALIB_MODE
)paren
suffix:semicolon
id|chip-&gt;image
(braket
id|CS4231_IFACE_CTRL
)braket
op_or_assign
id|CS4231_AUTOCALIB
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_IFACE_CTRL
comma
id|chip-&gt;image
(braket
id|CS4231_IFACE_CTRL
)braket
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_mce_down
c_func
(paren
id|chip
)paren
suffix:semicolon
macro_line|#ifdef SNDRV_DEBUG_MCE
id|snd_printk
c_func
(paren
l_string|&quot;init: (2)&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|snd_cs4231_mce_up
c_func
(paren
id|chip
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_ALT_FEATURE_1
comma
id|chip-&gt;image
(braket
id|CS4231_ALT_FEATURE_1
)braket
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_mce_down
c_func
(paren
id|chip
)paren
suffix:semicolon
macro_line|#ifdef SNDRV_DEBUG_MCE
id|snd_printk
c_func
(paren
l_string|&quot;init: (3) - afei = 0x%x&bslash;n&quot;
comma
id|chip-&gt;image
(braket
id|CS4231_ALT_FEATURE_1
)braket
)paren
suffix:semicolon
macro_line|#endif
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_ALT_FEATURE_2
comma
id|chip-&gt;image
(braket
id|CS4231_ALT_FEATURE_2
)braket
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_mce_up
c_func
(paren
id|chip
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_PLAYBK_FORMAT
comma
id|chip-&gt;image
(braket
id|CS4231_PLAYBK_FORMAT
)braket
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_mce_down
c_func
(paren
id|chip
)paren
suffix:semicolon
macro_line|#ifdef SNDRV_DEBUG_MCE
id|snd_printk
c_func
(paren
l_string|&quot;init: (4)&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|snd_cs4231_mce_up
c_func
(paren
id|chip
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_REC_FORMAT
comma
id|chip-&gt;image
(braket
id|CS4231_REC_FORMAT
)braket
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_mce_down
c_func
(paren
id|chip
)paren
suffix:semicolon
macro_line|#ifdef SNDRV_DEBUG_MCE
id|snd_printk
c_func
(paren
l_string|&quot;init: (5)&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|snd_cs4231_open
r_static
r_int
id|snd_cs4231_open
c_func
(paren
id|cs4231_t
op_star
id|chip
comma
r_int
r_int
id|mode
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|down
c_func
(paren
op_amp
id|chip-&gt;open_mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|chip-&gt;mode
op_amp
id|mode
)paren
)paren
(brace
id|up
c_func
(paren
op_amp
id|chip-&gt;open_mutex
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chip-&gt;mode
op_amp
id|CS4231_MODE_OPEN
)paren
(brace
id|chip-&gt;mode
op_or_assign
id|mode
suffix:semicolon
id|up
c_func
(paren
op_amp
id|chip-&gt;open_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* ok. now enable and ack CODEC IRQ */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_IRQ_STATUS
comma
id|CS4231_PLAYBACK_IRQ
op_or
id|CS4231_RECORD_IRQ
op_or
id|CS4231_TIMER_IRQ
)paren
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_IRQ_STATUS
comma
l_int|0
)paren
suffix:semicolon
id|__cs4231_writeb
c_func
(paren
id|chip
comma
l_int|0
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* clear IRQ */
id|__cs4231_writeb
c_func
(paren
id|chip
comma
l_int|0
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* clear IRQ */
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_IRQ_STATUS
comma
id|CS4231_PLAYBACK_IRQ
op_or
id|CS4231_RECORD_IRQ
op_or
id|CS4231_TIMER_IRQ
)paren
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_IRQ_STATUS
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|chip-&gt;mode
op_assign
id|mode
suffix:semicolon
id|up
c_func
(paren
op_amp
id|chip-&gt;open_mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4231_close
r_static
r_void
id|snd_cs4231_close
c_func
(paren
id|cs4231_t
op_star
id|chip
comma
r_int
r_int
id|mode
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|down
c_func
(paren
op_amp
id|chip-&gt;open_mutex
)paren
suffix:semicolon
id|chip-&gt;mode
op_and_assign
op_complement
id|mode
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;mode
op_amp
id|CS4231_MODE_OPEN
)paren
(brace
id|up
c_func
(paren
op_amp
id|chip-&gt;open_mutex
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|snd_cs4231_calibrate_mute
c_func
(paren
id|chip
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* disable IRQ */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_IRQ_STATUS
comma
l_int|0
)paren
suffix:semicolon
id|__cs4231_writeb
c_func
(paren
id|chip
comma
l_int|0
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* clear IRQ */
id|__cs4231_writeb
c_func
(paren
id|chip
comma
l_int|0
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* clear IRQ */
multiline_comment|/* now disable record &amp; playback */
r_if
c_cond
(paren
id|chip-&gt;image
(braket
id|CS4231_IFACE_CTRL
)braket
op_amp
(paren
id|CS4231_PLAYBACK_ENABLE
op_or
id|CS4231_PLAYBACK_PIO
op_or
id|CS4231_RECORD_ENABLE
op_or
id|CS4231_RECORD_PIO
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_mce_up
c_func
(paren
id|chip
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|chip-&gt;image
(braket
id|CS4231_IFACE_CTRL
)braket
op_and_assign
op_complement
(paren
id|CS4231_PLAYBACK_ENABLE
op_or
id|CS4231_PLAYBACK_PIO
op_or
id|CS4231_RECORD_ENABLE
op_or
id|CS4231_RECORD_PIO
)paren
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_IFACE_CTRL
comma
id|chip-&gt;image
(braket
id|CS4231_IFACE_CTRL
)braket
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_mce_down
c_func
(paren
id|chip
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* clear IRQ again */
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_IRQ_STATUS
comma
l_int|0
)paren
suffix:semicolon
id|__cs4231_writeb
c_func
(paren
id|chip
comma
l_int|0
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* clear IRQ */
id|__cs4231_writeb
c_func
(paren
id|chip
comma
l_int|0
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* clear IRQ */
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_calibrate_mute
c_func
(paren
id|chip
comma
l_int|0
)paren
suffix:semicolon
id|chip-&gt;mode
op_assign
l_int|0
suffix:semicolon
id|up
c_func
(paren
op_amp
id|chip-&gt;open_mutex
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  timer open/close&n; */
DECL|function|snd_cs4231_timer_open
r_static
r_int
id|snd_cs4231_timer_open
c_func
(paren
id|snd_timer_t
op_star
id|timer
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|snd_timer_chip
c_func
(paren
id|timer
)paren
suffix:semicolon
id|snd_cs4231_open
c_func
(paren
id|chip
comma
id|CS4231_MODE_TIMER
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4231_timer_close
r_static
r_int
id|snd_cs4231_timer_close
c_func
(paren
id|snd_timer_t
op_star
id|timer
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|snd_timer_chip
c_func
(paren
id|timer
)paren
suffix:semicolon
id|snd_cs4231_close
c_func
(paren
id|chip
comma
id|CS4231_MODE_TIMER
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|snd_cs4231_timer_table
r_static
r_struct
id|_snd_timer_hardware
id|snd_cs4231_timer_table
op_assign
(brace
dot
id|flags
op_assign
id|SNDRV_TIMER_HW_AUTO
comma
dot
id|resolution
op_assign
l_int|9945
comma
dot
id|ticks
op_assign
l_int|65535
comma
dot
id|open
op_assign
id|snd_cs4231_timer_open
comma
dot
id|close
op_assign
id|snd_cs4231_timer_close
comma
dot
id|c_resolution
op_assign
id|snd_cs4231_timer_resolution
comma
dot
id|start
op_assign
id|snd_cs4231_timer_start
comma
dot
id|stop
op_assign
id|snd_cs4231_timer_stop
comma
)brace
suffix:semicolon
multiline_comment|/*&n; *  ok.. exported functions..&n; */
DECL|function|snd_cs4231_playback_hw_params
r_static
r_int
id|snd_cs4231_playback_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_char
id|new_pdfr
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|new_pdfr
op_assign
id|snd_cs4231_get_format
c_func
(paren
id|chip
comma
id|params_format
c_func
(paren
id|hw_params
)paren
comma
id|params_channels
c_func
(paren
id|hw_params
)paren
)paren
op_or
id|snd_cs4231_get_rate
c_func
(paren
id|params_rate
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
id|snd_cs4231_playback_format
c_func
(paren
id|chip
comma
id|hw_params
comma
id|new_pdfr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4231_playback_hw_free
r_static
r_int
id|snd_cs4231_playback_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4231_playback_prepare
r_static
r_int
id|snd_cs4231_playback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|chip-&gt;image
(braket
id|CS4231_IFACE_CTRL
)braket
op_and_assign
op_complement
(paren
id|CS4231_PLAYBACK_ENABLE
op_or
id|CS4231_PLAYBACK_PIO
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4231_capture_hw_params
r_static
r_int
id|snd_cs4231_capture_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_char
id|new_cdfr
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|new_cdfr
op_assign
id|snd_cs4231_get_format
c_func
(paren
id|chip
comma
id|params_format
c_func
(paren
id|hw_params
)paren
comma
id|params_channels
c_func
(paren
id|hw_params
)paren
)paren
op_or
id|snd_cs4231_get_rate
c_func
(paren
id|params_rate
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
id|snd_cs4231_capture_format
c_func
(paren
id|chip
comma
id|hw_params
comma
id|new_cdfr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4231_capture_hw_free
r_static
r_int
id|snd_cs4231_capture_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4231_capture_prepare
r_static
r_int
id|snd_cs4231_capture_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|chip-&gt;image
(braket
id|CS4231_IFACE_CTRL
)braket
op_and_assign
op_complement
(paren
id|CS4231_RECORD_ENABLE
op_or
id|CS4231_RECORD_PIO
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4231_overrange
r_static
r_void
id|snd_cs4231_overrange
c_func
(paren
id|cs4231_t
op_star
id|chip
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|res
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|res
op_assign
id|snd_cs4231_in
c_func
(paren
id|chip
comma
id|CS4231_TEST_INIT
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
op_amp
(paren
l_int|0x08
op_or
l_int|0x02
)paren
)paren
multiline_comment|/* detect overrange only above 0dB; may be user selectable? */
id|chip-&gt;capture_substream-&gt;runtime-&gt;overrange
op_increment
suffix:semicolon
)brace
DECL|function|snd_cs4231_generic_interrupt
r_static
r_void
id|snd_cs4231_generic_interrupt
c_func
(paren
id|cs4231_t
op_star
id|chip
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|status
suffix:semicolon
id|status
op_assign
id|snd_cs4231_in
c_func
(paren
id|chip
comma
id|CS4231_IRQ_STATUS
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|status
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|CS4231_TIMER_IRQ
)paren
(brace
r_if
c_cond
(paren
id|chip-&gt;timer
)paren
id|snd_timer_interrupt
c_func
(paren
id|chip-&gt;timer
comma
id|chip-&gt;timer-&gt;sticks
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|CS4231_PLAYBACK_IRQ
)paren
id|snd_pcm_period_elapsed
c_func
(paren
id|chip-&gt;playback_substream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|CS4231_RECORD_IRQ
)paren
(brace
id|snd_cs4231_overrange
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_pcm_period_elapsed
c_func
(paren
id|chip-&gt;capture_substream
)paren
suffix:semicolon
)brace
multiline_comment|/* ACK the CS4231 interrupt. */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_outm
c_func
(paren
id|chip
comma
id|CS4231_IRQ_STATUS
comma
op_complement
id|CS4231_ALL_IRQS
op_or
op_complement
id|status
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
macro_line|#ifdef SBUS_SUPPORT
DECL|function|snd_cs4231_sbus_interrupt
r_static
id|irqreturn_t
id|snd_cs4231_sbus_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|dev_id
suffix:semicolon
id|u32
id|csr
suffix:semicolon
id|csr
op_assign
id|sbus_readl
c_func
(paren
id|chip-&gt;port
op_plus
id|APCCSR
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|csr
op_amp
(paren
id|APC_INT_PENDING
op_or
id|APC_PLAY_INT
op_or
id|APC_CAPT_INT
op_or
id|APC_GENL_INT
op_or
id|APC_XINT_PEMP
op_or
id|APC_XINT_CEMP
)paren
)paren
)paren
r_return
id|IRQ_NONE
suffix:semicolon
multiline_comment|/* ACK the APC interrupt. */
id|sbus_writel
c_func
(paren
id|csr
comma
id|chip-&gt;port
op_plus
id|APCCSR
)paren
suffix:semicolon
id|snd_cs4231_generic_interrupt
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef EBUS_SUPPORT
DECL|function|snd_cs4231_ebus_play_callback
r_static
r_void
id|snd_cs4231_ebus_play_callback
c_func
(paren
r_struct
id|ebus_dma_info
op_star
id|p
comma
r_int
id|event
comma
r_void
op_star
id|cookie
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|cookie
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;image
(braket
id|CS4231_IFACE_CTRL
)braket
op_amp
id|CS4231_PLAYBACK_ENABLE
)paren
(brace
id|snd_pcm_period_elapsed
c_func
(paren
id|chip-&gt;playback_substream
)paren
suffix:semicolon
id|snd_cs4231_ebus_advance_dma
c_func
(paren
id|p
comma
id|chip-&gt;playback_substream
comma
op_amp
id|chip-&gt;p_periods_sent
)paren
suffix:semicolon
)brace
)brace
DECL|function|snd_cs4231_ebus_capture_callback
r_static
r_void
id|snd_cs4231_ebus_capture_callback
c_func
(paren
r_struct
id|ebus_dma_info
op_star
id|p
comma
r_int
id|event
comma
r_void
op_star
id|cookie
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|cookie
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;image
(braket
id|CS4231_IFACE_CTRL
)braket
op_amp
id|CS4231_RECORD_ENABLE
)paren
(brace
id|snd_pcm_period_elapsed
c_func
(paren
id|chip-&gt;capture_substream
)paren
suffix:semicolon
id|snd_cs4231_ebus_advance_dma
c_func
(paren
id|p
comma
id|chip-&gt;capture_substream
comma
op_amp
id|chip-&gt;c_periods_sent
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
DECL|function|snd_cs4231_playback_pointer
r_static
id|snd_pcm_uframes_t
id|snd_cs4231_playback_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
comma
id|residue
comma
id|period_bytes
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chip-&gt;image
(braket
id|CS4231_IFACE_CTRL
)braket
op_amp
id|CS4231_PLAYBACK_ENABLE
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|period_bytes
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|ptr
op_assign
id|period_bytes
op_star
id|chip-&gt;p_periods_sent
suffix:semicolon
macro_line|#ifdef EBUS_SUPPORT
r_if
c_cond
(paren
id|chip-&gt;flags
op_amp
id|CS4231_FLAG_EBUS
)paren
(brace
id|residue
op_assign
id|ebus_dma_residue
c_func
(paren
op_amp
id|chip-&gt;eb2p
)paren
suffix:semicolon
)brace
r_else
(brace
macro_line|#endif
macro_line|#ifdef SBUS_SUPPORT
id|residue
op_assign
id|sbus_readl
c_func
(paren
id|chip-&gt;port
op_plus
id|APCPC
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef EBUS_SUPPORT
)brace
macro_line|#endif
id|ptr
op_add_assign
(paren
id|period_bytes
op_minus
id|residue
)paren
suffix:semicolon
r_return
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|ptr
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4231_capture_pointer
r_static
id|snd_pcm_uframes_t
id|snd_cs4231_capture_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
comma
id|residue
comma
id|period_bytes
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|chip-&gt;image
(braket
id|CS4231_IFACE_CTRL
)braket
op_amp
id|CS4231_RECORD_ENABLE
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|period_bytes
op_assign
id|snd_pcm_lib_period_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
id|ptr
op_assign
id|period_bytes
op_star
id|chip-&gt;c_periods_sent
suffix:semicolon
macro_line|#ifdef EBUS_SUPPORT
r_if
c_cond
(paren
id|chip-&gt;flags
op_amp
id|CS4231_FLAG_EBUS
)paren
(brace
id|residue
op_assign
id|ebus_dma_residue
c_func
(paren
op_amp
id|chip-&gt;eb2c
)paren
suffix:semicolon
)brace
r_else
(brace
macro_line|#endif
macro_line|#ifdef SBUS_SUPPORT
id|residue
op_assign
id|sbus_readl
c_func
(paren
id|chip-&gt;port
op_plus
id|APCCC
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef EBUS_SUPPORT
)brace
macro_line|#endif
id|ptr
op_add_assign
(paren
id|period_bytes
op_minus
id|residue
)paren
suffix:semicolon
r_return
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|ptr
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&n; */
DECL|function|snd_cs4231_probe
r_static
r_int
id|snd_cs4231_probe
c_func
(paren
id|cs4231_t
op_star
id|chip
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
comma
id|id
comma
id|vers
suffix:semicolon
r_int
r_char
op_star
id|ptr
suffix:semicolon
macro_line|#if 0
id|snd_cs4231_debug
c_func
(paren
id|chip
)paren
suffix:semicolon
macro_line|#endif
id|id
op_assign
id|vers
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|50
suffix:semicolon
id|i
op_increment
)paren
(brace
id|mb
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|__cs4231_readb
c_func
(paren
id|chip
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|REGSEL
)paren
)paren
op_amp
id|CS4231_INIT
)paren
id|udelay
c_func
(paren
l_int|2000
)paren
suffix:semicolon
r_else
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_MISC_INFO
comma
id|CS4231_MODE2
)paren
suffix:semicolon
id|id
op_assign
id|snd_cs4231_in
c_func
(paren
id|chip
comma
id|CS4231_MISC_INFO
)paren
op_amp
l_int|0x0f
suffix:semicolon
id|vers
op_assign
id|snd_cs4231_in
c_func
(paren
id|chip
comma
id|CS4231_VERSION
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
op_eq
l_int|0x0a
)paren
r_break
suffix:semicolon
multiline_comment|/* this is valid value */
)brace
)brace
id|snd_printdd
c_func
(paren
l_string|&quot;cs4231: port = %p, id = 0x%x&bslash;n&quot;
comma
id|chip-&gt;port
comma
id|id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
op_ne
l_int|0x0a
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/* no valid device found */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* Reset DMA engine.  */
macro_line|#ifdef EBUS_SUPPORT
r_if
c_cond
(paren
id|chip-&gt;flags
op_amp
id|CS4231_FLAG_EBUS
)paren
(brace
multiline_comment|/* Done by ebus_dma_register */
)brace
r_else
(brace
macro_line|#endif
macro_line|#ifdef SBUS_SUPPORT
id|sbus_writel
c_func
(paren
id|APC_CHIP_RESET
comma
id|chip-&gt;port
op_plus
id|APCCSR
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
l_int|0x00
comma
id|chip-&gt;port
op_plus
id|APCCSR
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|sbus_readl
c_func
(paren
id|chip-&gt;port
op_plus
id|APCCSR
)paren
op_or
id|APC_CDC_RESET
comma
id|chip-&gt;port
op_plus
id|APCCSR
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|20
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|sbus_readl
c_func
(paren
id|chip-&gt;port
op_plus
id|APCCSR
)paren
op_amp
op_complement
id|APC_CDC_RESET
comma
id|chip-&gt;port
op_plus
id|APCCSR
)paren
suffix:semicolon
id|sbus_writel
c_func
(paren
id|sbus_readl
c_func
(paren
id|chip-&gt;port
op_plus
id|APCCSR
)paren
op_or
(paren
id|APC_XINT_ENA
op_or
id|APC_XINT_PENA
op_or
id|APC_XINT_CENA
)paren
comma
id|chip-&gt;port
op_plus
id|APCCSR
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef EBUS_SUPPORT
)brace
macro_line|#endif
id|__cs4231_readb
c_func
(paren
id|chip
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|STATUS
)paren
)paren
suffix:semicolon
multiline_comment|/* clear any pendings IRQ */
id|__cs4231_writeb
c_func
(paren
id|chip
comma
l_int|0
comma
id|CS4231P
c_func
(paren
id|chip
comma
id|STATUS
)paren
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|chip-&gt;image
(braket
id|CS4231_MISC_INFO
)braket
op_assign
id|CS4231_MODE2
suffix:semicolon
id|chip-&gt;image
(braket
id|CS4231_IFACE_CTRL
)braket
op_assign
id|chip-&gt;image
(braket
id|CS4231_IFACE_CTRL
)braket
op_amp
op_complement
id|CS4231_SINGLE_DMA
suffix:semicolon
id|chip-&gt;image
(braket
id|CS4231_ALT_FEATURE_1
)braket
op_assign
l_int|0x80
suffix:semicolon
id|chip-&gt;image
(braket
id|CS4231_ALT_FEATURE_2
)braket
op_assign
l_int|0x01
suffix:semicolon
r_if
c_cond
(paren
id|vers
op_amp
l_int|0x20
)paren
id|chip-&gt;image
(braket
id|CS4231_ALT_FEATURE_2
)braket
op_or_assign
l_int|0x02
suffix:semicolon
id|ptr
op_assign
(paren
r_int
r_char
op_star
)paren
op_amp
id|chip-&gt;image
suffix:semicolon
id|snd_cs4231_mce_down
c_func
(paren
id|chip
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
multiline_comment|/* ok.. fill all CS4231 registers */
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|i
comma
op_star
id|ptr
op_increment
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|snd_cs4231_mce_up
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_cs4231_mce_down
c_func
(paren
id|chip
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|2
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* all things are ok.. */
)brace
DECL|variable|snd_cs4231_playback
r_static
id|snd_pcm_hardware_t
id|snd_cs4231_playback
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_SYNC_START
)paren
comma
dot
id|formats
op_assign
(paren
id|SNDRV_PCM_FMTBIT_MU_LAW
op_or
id|SNDRV_PCM_FMTBIT_A_LAW
op_or
id|SNDRV_PCM_FMTBIT_IMA_ADPCM
op_or
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
op_or
id|SNDRV_PCM_FMTBIT_S16_BE
)paren
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_KNOT
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
dot
id|rate_min
op_assign
l_int|5510
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|32
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|4096
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|32
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|1024
comma
)brace
suffix:semicolon
DECL|variable|snd_cs4231_capture
r_static
id|snd_pcm_hardware_t
id|snd_cs4231_capture
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_SYNC_START
)paren
comma
dot
id|formats
op_assign
(paren
id|SNDRV_PCM_FMTBIT_MU_LAW
op_or
id|SNDRV_PCM_FMTBIT_A_LAW
op_or
id|SNDRV_PCM_FMTBIT_IMA_ADPCM
op_or
id|SNDRV_PCM_FMTBIT_U8
op_or
id|SNDRV_PCM_FMTBIT_S16_LE
op_or
id|SNDRV_PCM_FMTBIT_S16_BE
)paren
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_KNOT
op_or
id|SNDRV_PCM_RATE_8000_48000
comma
dot
id|rate_min
op_assign
l_int|5510
comma
dot
id|rate_max
op_assign
l_int|48000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|2
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|32
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|4096
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|32
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|1024
comma
)brace
suffix:semicolon
DECL|function|snd_cs4231_playback_open
r_static
r_int
id|snd_cs4231_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_cs4231_playback
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_cs4231_open
c_func
(paren
id|chip
comma
id|CS4231_MODE_PLAY
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_free_pages
c_func
(paren
id|runtime-&gt;dma_area
comma
id|runtime-&gt;dma_bytes
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|chip-&gt;playback_substream
op_assign
id|substream
suffix:semicolon
id|chip-&gt;p_periods_sent
op_assign
l_int|0
suffix:semicolon
id|snd_pcm_set_sync
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_cs4231_xrate
c_func
(paren
id|runtime
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4231_capture_open
r_static
r_int
id|snd_cs4231_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
id|err
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_cs4231_capture
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_cs4231_open
c_func
(paren
id|chip
comma
id|CS4231_MODE_RECORD
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_free_pages
c_func
(paren
id|runtime-&gt;dma_area
comma
id|runtime-&gt;dma_bytes
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|chip-&gt;capture_substream
op_assign
id|substream
suffix:semicolon
id|chip-&gt;c_periods_sent
op_assign
l_int|0
suffix:semicolon
id|snd_pcm_set_sync
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_cs4231_xrate
c_func
(paren
id|runtime
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4231_playback_close
r_static
r_int
id|snd_cs4231_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;playback_substream
op_assign
l_int|NULL
suffix:semicolon
id|snd_cs4231_close
c_func
(paren
id|chip
comma
id|CS4231_MODE_PLAY
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4231_capture_close
r_static
r_int
id|snd_cs4231_capture_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|chip-&gt;capture_substream
op_assign
l_int|NULL
suffix:semicolon
id|snd_cs4231_close
c_func
(paren
id|chip
comma
id|CS4231_MODE_RECORD
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* XXX We can do some power-management, in particular on EBUS using&n; * XXX the audio AUXIO register...&n; */
DECL|variable|snd_cs4231_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_cs4231_playback_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_cs4231_playback_open
comma
dot
id|close
op_assign
id|snd_cs4231_playback_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_cs4231_playback_hw_params
comma
dot
id|hw_free
op_assign
id|snd_cs4231_playback_hw_free
comma
dot
id|prepare
op_assign
id|snd_cs4231_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_cs4231_trigger
comma
dot
id|pointer
op_assign
id|snd_cs4231_playback_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_cs4231_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_cs4231_capture_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_cs4231_capture_open
comma
dot
id|close
op_assign
id|snd_cs4231_capture_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_cs4231_capture_hw_params
comma
dot
id|hw_free
op_assign
id|snd_cs4231_capture_hw_free
comma
dot
id|prepare
op_assign
id|snd_cs4231_capture_prepare
comma
dot
id|trigger
op_assign
id|snd_cs4231_trigger
comma
dot
id|pointer
op_assign
id|snd_cs4231_capture_pointer
comma
)brace
suffix:semicolon
DECL|function|snd_cs4231_pcm_free
r_static
r_void
id|snd_cs4231_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|pcm-&gt;private_data
suffix:semicolon
id|chip-&gt;pcm
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_cs4231_pcm
r_int
id|snd_cs4231_pcm
c_func
(paren
id|cs4231_t
op_star
id|chip
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;CS4231&quot;
comma
l_int|0
comma
l_int|1
comma
l_int|1
comma
op_amp
id|pcm
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_cs4231_playback_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_cs4231_capture_ops
)paren
suffix:semicolon
multiline_comment|/* global setup */
id|pcm-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_cs4231_pcm_free
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
id|SNDRV_PCM_INFO_JOINT_DUPLEX
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
l_string|&quot;CS4231&quot;
)paren
suffix:semicolon
macro_line|#ifdef EBUS_SUPPORT
r_if
c_cond
(paren
id|chip-&gt;flags
op_amp
id|CS4231_FLAG_EBUS
)paren
(brace
id|snd_pcm_lib_preallocate_pages_for_all
c_func
(paren
id|pcm
comma
id|SNDRV_DMA_TYPE_DEV
comma
id|snd_dma_pci_data
c_func
(paren
id|chip-&gt;dev_u.pdev
)paren
comma
l_int|64
op_star
l_int|1024
comma
l_int|128
op_star
l_int|1024
)paren
suffix:semicolon
)brace
r_else
(brace
macro_line|#endif
macro_line|#ifdef SBUS_SUPPORT
id|snd_pcm_lib_preallocate_pages_for_all
c_func
(paren
id|pcm
comma
id|SNDRV_DMA_TYPE_SBUS
comma
id|snd_dma_sbus_data
c_func
(paren
id|chip-&gt;dev_u.sdev
)paren
comma
l_int|64
op_star
l_int|1024
comma
l_int|128
op_star
l_int|1024
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef EBUS_SUPPORT
)brace
macro_line|#endif
id|chip-&gt;pcm
op_assign
id|pcm
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4231_timer_free
r_static
r_void
id|snd_cs4231_timer_free
c_func
(paren
id|snd_timer_t
op_star
id|timer
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|timer-&gt;private_data
suffix:semicolon
id|chip-&gt;timer
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|function|snd_cs4231_timer
r_int
id|snd_cs4231_timer
c_func
(paren
id|cs4231_t
op_star
id|chip
)paren
(brace
id|snd_timer_t
op_star
id|timer
suffix:semicolon
id|snd_timer_id_t
id|tid
suffix:semicolon
r_int
id|err
suffix:semicolon
multiline_comment|/* Timer initialization */
id|tid.dev_class
op_assign
id|SNDRV_TIMER_CLASS_CARD
suffix:semicolon
id|tid.dev_sclass
op_assign
id|SNDRV_TIMER_SCLASS_NONE
suffix:semicolon
id|tid.card
op_assign
id|chip-&gt;card-&gt;number
suffix:semicolon
id|tid.device
op_assign
l_int|0
suffix:semicolon
id|tid.subdevice
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_timer_new
c_func
(paren
id|chip-&gt;card
comma
l_string|&quot;CS4231&quot;
comma
op_amp
id|tid
comma
op_amp
id|timer
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|strcpy
c_func
(paren
id|timer-&gt;name
comma
l_string|&quot;CS4231&quot;
)paren
suffix:semicolon
id|timer-&gt;private_data
op_assign
id|chip
suffix:semicolon
id|timer-&gt;private_free
op_assign
id|snd_cs4231_timer_free
suffix:semicolon
id|timer-&gt;hw
op_assign
id|snd_cs4231_timer_table
suffix:semicolon
id|chip-&gt;timer
op_assign
id|timer
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  MIXER part&n; */
DECL|function|snd_cs4231_info_mux
r_static
r_int
id|snd_cs4231_info_mux
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_static
r_char
op_star
id|texts
(braket
l_int|4
)braket
op_assign
(brace
l_string|&quot;Line&quot;
comma
l_string|&quot;CD&quot;
comma
l_string|&quot;Mic&quot;
comma
l_string|&quot;Mix&quot;
)brace
suffix:semicolon
id|cs4231_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|chip-&gt;card
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_ENUMERATED
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.enumerated.items
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|uinfo-&gt;value.enumerated.item
OG
l_int|3
)paren
id|uinfo-&gt;value.enumerated.item
op_assign
l_int|3
suffix:semicolon
id|strcpy
c_func
(paren
id|uinfo-&gt;value.enumerated.name
comma
id|texts
(braket
id|uinfo-&gt;value.enumerated.item
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4231_get_mux
r_static
r_int
id|snd_cs4231_get_mux
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
op_assign
(paren
id|chip-&gt;image
(braket
id|CS4231_LEFT_INPUT
)braket
op_amp
id|CS4231_MIXS_ALL
)paren
op_rshift
l_int|6
suffix:semicolon
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|1
)braket
op_assign
(paren
id|chip-&gt;image
(braket
id|CS4231_RIGHT_INPUT
)braket
op_amp
id|CS4231_MIXS_ALL
)paren
op_rshift
l_int|6
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4231_put_mux
r_static
r_int
id|snd_cs4231_put_mux
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|left
comma
id|right
suffix:semicolon
r_int
id|change
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
OG
l_int|3
op_logical_or
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|1
)braket
OG
l_int|3
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|left
op_assign
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|0
)braket
op_lshift
l_int|6
suffix:semicolon
id|right
op_assign
id|ucontrol-&gt;value.enumerated.item
(braket
l_int|1
)braket
op_lshift
l_int|6
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|left
op_assign
(paren
id|chip-&gt;image
(braket
id|CS4231_LEFT_INPUT
)braket
op_amp
op_complement
id|CS4231_MIXS_ALL
)paren
op_or
id|left
suffix:semicolon
id|right
op_assign
(paren
id|chip-&gt;image
(braket
id|CS4231_RIGHT_INPUT
)braket
op_amp
op_complement
id|CS4231_MIXS_ALL
)paren
op_or
id|right
suffix:semicolon
id|change
op_assign
id|left
op_ne
id|chip-&gt;image
(braket
id|CS4231_LEFT_INPUT
)braket
op_logical_or
id|right
op_ne
id|chip-&gt;image
(braket
id|CS4231_RIGHT_INPUT
)braket
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_LEFT_INPUT
comma
id|left
)paren
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|CS4231_RIGHT_INPUT
comma
id|right
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|function|snd_cs4231_info_single
r_int
id|snd_cs4231_info_single
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|uinfo-&gt;type
op_assign
(paren
id|mask
op_eq
l_int|1
)paren
ques
c_cond
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:colon
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
id|mask
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4231_get_single
r_int
id|snd_cs4231_get_single
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|chip-&gt;image
(braket
id|reg
)braket
op_rshift
id|shift
)paren
op_amp
id|mask
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|mask
op_minus
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4231_put_single
r_int
id|snd_cs4231_put_single
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|change
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
id|mask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
id|val
op_assign
id|mask
op_minus
id|val
suffix:semicolon
id|val
op_lshift_assign
id|shift
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|val
op_assign
(paren
id|chip-&gt;image
(braket
id|reg
)braket
op_amp
op_complement
(paren
id|mask
op_lshift
id|shift
)paren
)paren
op_or
id|val
suffix:semicolon
id|change
op_assign
id|val
op_ne
id|chip-&gt;image
(braket
id|reg
)braket
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|reg
comma
id|val
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|function|snd_cs4231_info_double
r_int
id|snd_cs4231_info_double
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|mask
op_eq
l_int|1
ques
c_cond
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:colon
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
id|mask
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4231_get_double
r_int
id|snd_cs4231_get_double
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|left_reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|right_reg
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift_left
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0x07
suffix:semicolon
r_int
id|shift_right
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|19
)paren
op_amp
l_int|0x07
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|22
)paren
op_amp
l_int|1
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|chip-&gt;image
(braket
id|left_reg
)braket
op_rshift
id|shift_left
)paren
op_amp
id|mask
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
(paren
id|chip-&gt;image
(braket
id|right_reg
)braket
op_rshift
id|shift_right
)paren
op_amp
id|mask
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
(brace
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|mask
op_minus
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
(paren
id|mask
op_minus
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4231_put_double
r_int
id|snd_cs4231_put_double
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|cs4231_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|left_reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|right_reg
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift_left
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|0x07
suffix:semicolon
r_int
id|shift_right
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|19
)paren
op_amp
l_int|0x07
suffix:semicolon
r_int
id|mask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|22
)paren
op_amp
l_int|1
suffix:semicolon
r_int
id|change
suffix:semicolon
r_int
r_int
id|val1
comma
id|val2
suffix:semicolon
id|val1
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
id|mask
suffix:semicolon
id|val2
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_amp
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
(brace
id|val1
op_assign
id|mask
op_minus
id|val1
suffix:semicolon
id|val2
op_assign
id|mask
op_minus
id|val2
suffix:semicolon
)brace
id|val1
op_lshift_assign
id|shift_left
suffix:semicolon
id|val2
op_lshift_assign
id|shift_right
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|val1
op_assign
(paren
id|chip-&gt;image
(braket
id|left_reg
)braket
op_amp
op_complement
(paren
id|mask
op_lshift
id|shift_left
)paren
)paren
op_or
id|val1
suffix:semicolon
id|val2
op_assign
(paren
id|chip-&gt;image
(braket
id|right_reg
)braket
op_amp
op_complement
(paren
id|mask
op_lshift
id|shift_right
)paren
)paren
op_or
id|val2
suffix:semicolon
id|change
op_assign
id|val1
op_ne
id|chip-&gt;image
(braket
id|left_reg
)braket
op_logical_or
id|val2
op_ne
id|chip-&gt;image
(braket
id|right_reg
)braket
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|left_reg
comma
id|val1
)paren
suffix:semicolon
id|snd_cs4231_out
c_func
(paren
id|chip
comma
id|right_reg
comma
id|val2
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|macro|CS4231_SINGLE
mdefine_line|#define CS4231_SINGLE(xname, xindex, reg, shift, mask, invert) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, .index = xindex, &bslash;&n;  .info = snd_cs4231_info_single, &bslash;&n;  .get = snd_cs4231_get_single, .put = snd_cs4231_put_single, &bslash;&n;  .private_value = reg | (shift &lt;&lt; 8) | (mask &lt;&lt; 16) | (invert &lt;&lt; 24) }
DECL|macro|CS4231_DOUBLE
mdefine_line|#define CS4231_DOUBLE(xname, xindex, left_reg, right_reg, shift_left, shift_right, mask, invert) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, .index = xindex, &bslash;&n;  .info = snd_cs4231_info_double, &bslash;&n;  .get = snd_cs4231_get_double, .put = snd_cs4231_put_double, &bslash;&n;  .private_value = left_reg | (right_reg &lt;&lt; 8) | (shift_left &lt;&lt; 16) | (shift_right &lt;&lt; 19) | (mask &lt;&lt; 24) | (invert &lt;&lt; 22) }
DECL|variable|snd_cs4231_controls
r_static
id|snd_kcontrol_new_t
id|snd_cs4231_controls
(braket
)braket
op_assign
(brace
id|CS4231_DOUBLE
c_func
(paren
l_string|&quot;PCM Playback Switch&quot;
comma
l_int|0
comma
id|CS4231_LEFT_OUTPUT
comma
id|CS4231_RIGHT_OUTPUT
comma
l_int|7
comma
l_int|7
comma
l_int|1
comma
l_int|1
)paren
comma
id|CS4231_DOUBLE
c_func
(paren
l_string|&quot;PCM Playback Volume&quot;
comma
l_int|0
comma
id|CS4231_LEFT_OUTPUT
comma
id|CS4231_RIGHT_OUTPUT
comma
l_int|0
comma
l_int|0
comma
l_int|63
comma
l_int|1
)paren
comma
id|CS4231_DOUBLE
c_func
(paren
l_string|&quot;Line Playback Switch&quot;
comma
l_int|0
comma
id|CS4231_LEFT_LINE_IN
comma
id|CS4231_RIGHT_LINE_IN
comma
l_int|7
comma
l_int|7
comma
l_int|1
comma
l_int|1
)paren
comma
id|CS4231_DOUBLE
c_func
(paren
l_string|&quot;Line Playback Volume&quot;
comma
l_int|0
comma
id|CS4231_LEFT_LINE_IN
comma
id|CS4231_RIGHT_LINE_IN
comma
l_int|0
comma
l_int|0
comma
l_int|31
comma
l_int|1
)paren
comma
id|CS4231_DOUBLE
c_func
(paren
l_string|&quot;Aux Playback Switch&quot;
comma
l_int|0
comma
id|CS4231_AUX1_LEFT_INPUT
comma
id|CS4231_AUX1_RIGHT_INPUT
comma
l_int|7
comma
l_int|7
comma
l_int|1
comma
l_int|1
)paren
comma
id|CS4231_DOUBLE
c_func
(paren
l_string|&quot;Aux Playback Volume&quot;
comma
l_int|0
comma
id|CS4231_AUX1_LEFT_INPUT
comma
id|CS4231_AUX1_RIGHT_INPUT
comma
l_int|0
comma
l_int|0
comma
l_int|31
comma
l_int|1
)paren
comma
id|CS4231_DOUBLE
c_func
(paren
l_string|&quot;Aux Playback Switch&quot;
comma
l_int|1
comma
id|CS4231_AUX2_LEFT_INPUT
comma
id|CS4231_AUX2_RIGHT_INPUT
comma
l_int|7
comma
l_int|7
comma
l_int|1
comma
l_int|1
)paren
comma
id|CS4231_DOUBLE
c_func
(paren
l_string|&quot;Aux Playback Volume&quot;
comma
l_int|1
comma
id|CS4231_AUX2_LEFT_INPUT
comma
id|CS4231_AUX2_RIGHT_INPUT
comma
l_int|0
comma
l_int|0
comma
l_int|31
comma
l_int|1
)paren
comma
id|CS4231_SINGLE
c_func
(paren
l_string|&quot;Mono Playback Switch&quot;
comma
l_int|0
comma
id|CS4231_MONO_CTRL
comma
l_int|7
comma
l_int|1
comma
l_int|1
)paren
comma
id|CS4231_SINGLE
c_func
(paren
l_string|&quot;Mono Playback Volume&quot;
comma
l_int|0
comma
id|CS4231_MONO_CTRL
comma
l_int|0
comma
l_int|15
comma
l_int|1
)paren
comma
id|CS4231_SINGLE
c_func
(paren
l_string|&quot;Mono Output Playback Switch&quot;
comma
l_int|0
comma
id|CS4231_MONO_CTRL
comma
l_int|6
comma
l_int|1
comma
l_int|1
)paren
comma
id|CS4231_SINGLE
c_func
(paren
l_string|&quot;Mono Output Playback Bypass&quot;
comma
l_int|0
comma
id|CS4231_MONO_CTRL
comma
l_int|5
comma
l_int|1
comma
l_int|0
)paren
comma
id|CS4231_DOUBLE
c_func
(paren
l_string|&quot;Capture Volume&quot;
comma
l_int|0
comma
id|CS4231_LEFT_INPUT
comma
id|CS4231_RIGHT_INPUT
comma
l_int|0
comma
l_int|0
comma
l_int|15
comma
l_int|0
)paren
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Capture Source&quot;
comma
dot
id|info
op_assign
id|snd_cs4231_info_mux
comma
dot
id|get
op_assign
id|snd_cs4231_get_mux
comma
dot
id|put
op_assign
id|snd_cs4231_put_mux
comma
)brace
comma
id|CS4231_DOUBLE
c_func
(paren
l_string|&quot;Mic Boost&quot;
comma
l_int|0
comma
id|CS4231_LEFT_INPUT
comma
id|CS4231_RIGHT_INPUT
comma
l_int|5
comma
l_int|5
comma
l_int|1
comma
l_int|0
)paren
comma
id|CS4231_SINGLE
c_func
(paren
l_string|&quot;Loopback Capture Switch&quot;
comma
l_int|0
comma
id|CS4231_LOOPBACK
comma
l_int|0
comma
l_int|1
comma
l_int|0
)paren
comma
id|CS4231_SINGLE
c_func
(paren
l_string|&quot;Loopback Capture Volume&quot;
comma
l_int|0
comma
id|CS4231_LOOPBACK
comma
l_int|2
comma
l_int|63
comma
l_int|1
)paren
comma
multiline_comment|/* SPARC specific uses of XCTL{0,1} general purpose outputs.  */
id|CS4231_SINGLE
c_func
(paren
l_string|&quot;Line Out Switch&quot;
comma
l_int|0
comma
id|CS4231_PIN_CTRL
comma
l_int|6
comma
l_int|1
comma
l_int|1
)paren
comma
id|CS4231_SINGLE
c_func
(paren
l_string|&quot;Headphone Out Switch&quot;
comma
l_int|0
comma
id|CS4231_PIN_CTRL
comma
l_int|7
comma
l_int|1
comma
l_int|1
)paren
)brace
suffix:semicolon
DECL|function|snd_cs4231_mixer
r_int
id|snd_cs4231_mixer
c_func
(paren
id|cs4231_t
op_star
id|chip
)paren
(brace
id|snd_card_t
op_star
id|card
suffix:semicolon
r_int
id|err
comma
id|idx
suffix:semicolon
id|snd_assert
c_func
(paren
id|chip
op_ne
l_int|NULL
op_logical_and
id|chip-&gt;pcm
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|card
op_assign
id|chip-&gt;card
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;mixername
comma
id|chip-&gt;pcm-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|ARRAY_SIZE
c_func
(paren
id|snd_cs4231_controls
)paren
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_cs4231_controls
(braket
id|idx
)braket
comma
id|chip
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|dev
r_static
r_int
id|dev
suffix:semicolon
DECL|function|cs4231_attach_begin
r_static
r_int
id|cs4231_attach_begin
c_func
(paren
id|snd_card_t
op_star
op_star
id|rcard
)paren
(brace
id|snd_card_t
op_star
id|card
suffix:semicolon
op_star
id|rcard
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_ge
id|SNDRV_CARDS
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|enable
(braket
id|dev
)braket
)paren
(brace
id|dev
op_increment
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|card
op_assign
id|snd_card_new
c_func
(paren
id|index
(braket
id|dev
)braket
comma
id|id
(braket
id|dev
)braket
comma
id|THIS_MODULE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;CS4231&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;shortname
comma
l_string|&quot;Sun CS4231&quot;
)paren
suffix:semicolon
op_star
id|rcard
op_assign
id|card
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs4231_attach_finish
r_static
r_int
id|cs4231_attach_finish
c_func
(paren
id|snd_card_t
op_star
id|card
comma
id|cs4231_t
op_star
id|chip
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_cs4231_pcm
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
r_goto
id|out_err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_cs4231_mixer
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
r_goto
id|out_err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_cs4231_timer
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
r_goto
id|out_err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_card_register
c_func
(paren
id|card
)paren
)paren
OL
l_int|0
)paren
r_goto
id|out_err
suffix:semicolon
id|chip-&gt;next
op_assign
id|cs4231_list
suffix:semicolon
id|cs4231_list
op_assign
id|chip
suffix:semicolon
id|dev
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_err
suffix:colon
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
macro_line|#ifdef SBUS_SUPPORT
DECL|function|snd_cs4231_sbus_free
r_static
r_int
id|snd_cs4231_sbus_free
c_func
(paren
id|cs4231_t
op_star
id|chip
)paren
(brace
r_if
c_cond
(paren
id|chip-&gt;irq
(braket
l_int|0
)braket
)paren
id|free_irq
c_func
(paren
id|chip-&gt;irq
(braket
l_int|0
)braket
comma
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;port
)paren
id|sbus_iounmap
c_func
(paren
id|chip-&gt;port
comma
id|chip-&gt;regs_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;timer
)paren
id|snd_device_free
c_func
(paren
id|chip-&gt;card
comma
id|chip-&gt;timer
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4231_sbus_dev_free
r_static
r_int
id|snd_cs4231_sbus_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|cs4231_t
op_star
id|cp
op_assign
id|device-&gt;device_data
suffix:semicolon
r_return
id|snd_cs4231_sbus_free
c_func
(paren
id|cp
)paren
suffix:semicolon
)brace
DECL|variable|snd_cs4231_sbus_dev_ops
r_static
id|snd_device_ops_t
id|snd_cs4231_sbus_dev_ops
op_assign
(brace
dot
id|dev_free
op_assign
id|snd_cs4231_sbus_dev_free
comma
)brace
suffix:semicolon
DECL|function|snd_cs4231_sbus_create
r_static
r_int
id|__init
id|snd_cs4231_sbus_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_struct
id|sbus_dev
op_star
id|sdev
comma
r_int
id|dev
comma
id|cs4231_t
op_star
op_star
id|rchip
)paren
(brace
id|cs4231_t
op_star
id|chip
suffix:semicolon
r_int
id|err
suffix:semicolon
op_star
id|rchip
op_assign
l_int|NULL
suffix:semicolon
id|chip
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|chip
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|chip-&gt;lock
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|chip-&gt;mce_mutex
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|chip-&gt;open_mutex
)paren
suffix:semicolon
id|chip-&gt;card
op_assign
id|card
suffix:semicolon
id|chip-&gt;dev_u.sdev
op_assign
id|sdev
suffix:semicolon
id|chip-&gt;regs_size
op_assign
id|sdev-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|reg_size
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|chip-&gt;image
comma
op_amp
id|snd_cs4231_original_image
comma
r_sizeof
(paren
id|snd_cs4231_original_image
)paren
)paren
suffix:semicolon
id|chip-&gt;port
op_assign
id|sbus_ioremap
c_func
(paren
op_amp
id|sdev-&gt;resource
(braket
l_int|0
)braket
comma
l_int|0
comma
id|chip-&gt;regs_size
comma
l_string|&quot;cs4231&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chip-&gt;port
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;cs4231-%d: Unable to map chip registers.&bslash;n&quot;
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|sdev-&gt;irqs
(braket
l_int|0
)braket
comma
id|snd_cs4231_sbus_interrupt
comma
id|SA_SHIRQ
comma
l_string|&quot;cs4231&quot;
comma
id|chip
)paren
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;cs4231-%d: Unable to grab SBUS IRQ %s&bslash;n&quot;
comma
id|dev
comma
id|__irq_itoa
c_func
(paren
id|sdev-&gt;irqs
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|snd_cs4231_sbus_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|chip-&gt;irq
(braket
l_int|0
)braket
op_assign
id|sdev-&gt;irqs
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|snd_cs4231_probe
c_func
(paren
id|chip
)paren
OL
l_int|0
)paren
(brace
id|snd_cs4231_sbus_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|snd_cs4231_init
c_func
(paren
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|chip
comma
op_amp
id|snd_cs4231_sbus_dev_ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_cs4231_sbus_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
op_star
id|rchip
op_assign
id|chip
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs4231_sbus_attach
r_static
r_int
id|cs4231_sbus_attach
c_func
(paren
r_struct
id|sbus_dev
op_star
id|sdev
)paren
(brace
r_struct
id|resource
op_star
id|rp
op_assign
op_amp
id|sdev-&gt;resource
(braket
l_int|0
)braket
suffix:semicolon
id|cs4231_t
op_star
id|cp
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|cs4231_attach_begin
c_func
(paren
op_amp
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;%s at 0x%02lx:0x%08lx, irq %s&quot;
comma
id|card-&gt;shortname
comma
id|rp-&gt;flags
op_amp
l_int|0xffL
comma
id|rp-&gt;start
comma
id|__irq_itoa
c_func
(paren
id|sdev-&gt;irqs
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_cs4231_sbus_create
c_func
(paren
id|card
comma
id|sdev
comma
id|dev
comma
op_amp
id|cp
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_return
id|cs4231_attach_finish
c_func
(paren
id|card
comma
id|cp
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef EBUS_SUPPORT
DECL|function|snd_cs4231_ebus_free
r_static
r_int
id|snd_cs4231_ebus_free
c_func
(paren
id|cs4231_t
op_star
id|chip
)paren
(brace
r_if
c_cond
(paren
id|chip-&gt;eb2c.regs
)paren
(brace
id|ebus_dma_unregister
c_func
(paren
op_amp
id|chip-&gt;eb2c
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|chip-&gt;eb2c.regs
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chip-&gt;eb2p.regs
)paren
(brace
id|ebus_dma_unregister
c_func
(paren
op_amp
id|chip-&gt;eb2p
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|chip-&gt;eb2p.regs
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chip-&gt;port
)paren
id|iounmap
c_func
(paren
id|chip-&gt;port
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;timer
)paren
id|snd_device_free
c_func
(paren
id|chip-&gt;card
comma
id|chip-&gt;timer
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_cs4231_ebus_dev_free
r_static
r_int
id|snd_cs4231_ebus_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|cs4231_t
op_star
id|cp
op_assign
id|device-&gt;device_data
suffix:semicolon
r_return
id|snd_cs4231_ebus_free
c_func
(paren
id|cp
)paren
suffix:semicolon
)brace
DECL|variable|snd_cs4231_ebus_dev_ops
r_static
id|snd_device_ops_t
id|snd_cs4231_ebus_dev_ops
op_assign
(brace
dot
id|dev_free
op_assign
id|snd_cs4231_ebus_dev_free
comma
)brace
suffix:semicolon
DECL|function|snd_cs4231_ebus_create
r_static
r_int
id|__init
id|snd_cs4231_ebus_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_struct
id|linux_ebus_device
op_star
id|edev
comma
r_int
id|dev
comma
id|cs4231_t
op_star
op_star
id|rchip
)paren
(brace
id|cs4231_t
op_star
id|chip
suffix:semicolon
r_int
id|err
suffix:semicolon
op_star
id|rchip
op_assign
l_int|NULL
suffix:semicolon
id|chip
op_assign
id|kcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|chip
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|chip-&gt;lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|chip-&gt;eb2c.lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|chip-&gt;eb2p.lock
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|chip-&gt;mce_mutex
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|chip-&gt;open_mutex
)paren
suffix:semicolon
id|chip-&gt;flags
op_or_assign
id|CS4231_FLAG_EBUS
suffix:semicolon
id|chip-&gt;card
op_assign
id|card
suffix:semicolon
id|chip-&gt;dev_u.pdev
op_assign
id|edev-&gt;bus-&gt;self
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|chip-&gt;image
comma
op_amp
id|snd_cs4231_original_image
comma
r_sizeof
(paren
id|snd_cs4231_original_image
)paren
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|chip-&gt;eb2c.name
comma
l_string|&quot;cs4231(capture)&quot;
)paren
suffix:semicolon
id|chip-&gt;eb2c.flags
op_assign
id|EBUS_DMA_FLAG_USE_EBDMA_HANDLER
suffix:semicolon
id|chip-&gt;eb2c.callback
op_assign
id|snd_cs4231_ebus_capture_callback
suffix:semicolon
id|chip-&gt;eb2c.client_cookie
op_assign
id|chip
suffix:semicolon
id|chip-&gt;eb2c.irq
op_assign
id|edev-&gt;irqs
(braket
l_int|0
)braket
suffix:semicolon
id|strcpy
c_func
(paren
id|chip-&gt;eb2p.name
comma
l_string|&quot;cs4231(play)&quot;
)paren
suffix:semicolon
id|chip-&gt;eb2p.flags
op_assign
id|EBUS_DMA_FLAG_USE_EBDMA_HANDLER
suffix:semicolon
id|chip-&gt;eb2p.callback
op_assign
id|snd_cs4231_ebus_play_callback
suffix:semicolon
id|chip-&gt;eb2p.client_cookie
op_assign
id|chip
suffix:semicolon
id|chip-&gt;eb2p.irq
op_assign
id|edev-&gt;irqs
(braket
l_int|1
)braket
suffix:semicolon
id|chip-&gt;port
op_assign
id|ioremap
c_func
(paren
id|edev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
comma
l_int|0x10
)paren
suffix:semicolon
id|chip-&gt;eb2p.regs
op_assign
id|ioremap
c_func
(paren
id|edev-&gt;resource
(braket
l_int|1
)braket
dot
id|start
comma
l_int|0x10
)paren
suffix:semicolon
id|chip-&gt;eb2c.regs
op_assign
id|ioremap
c_func
(paren
id|edev-&gt;resource
(braket
l_int|2
)braket
dot
id|start
comma
l_int|0x10
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chip-&gt;port
op_logical_or
op_logical_neg
id|chip-&gt;eb2p.regs
op_logical_or
op_logical_neg
id|chip-&gt;eb2c.regs
)paren
(brace
id|snd_cs4231_ebus_free
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;cs4231-%d: Unable to map chip registers.&bslash;n&quot;
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ebus_dma_register
c_func
(paren
op_amp
id|chip-&gt;eb2c
)paren
)paren
(brace
id|snd_cs4231_ebus_free
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;cs4231-%d: Unable to register EBUS capture DMA&bslash;n&quot;
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ebus_dma_irq_enable
c_func
(paren
op_amp
id|chip-&gt;eb2c
comma
l_int|1
)paren
)paren
(brace
id|snd_cs4231_ebus_free
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;cs4231-%d: Unable to enable EBUS capture IRQ&bslash;n&quot;
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ebus_dma_register
c_func
(paren
op_amp
id|chip-&gt;eb2p
)paren
)paren
(brace
id|snd_cs4231_ebus_free
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;cs4231-%d: Unable to register EBUS play DMA&bslash;n&quot;
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ebus_dma_irq_enable
c_func
(paren
op_amp
id|chip-&gt;eb2p
comma
l_int|1
)paren
)paren
(brace
id|snd_cs4231_ebus_free
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_printk
c_func
(paren
l_string|&quot;cs4231-%d: Unable to enable EBUS play IRQ&bslash;n&quot;
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|snd_cs4231_probe
c_func
(paren
id|chip
)paren
OL
l_int|0
)paren
(brace
id|snd_cs4231_ebus_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|snd_cs4231_init
c_func
(paren
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|chip
comma
op_amp
id|snd_cs4231_ebus_dev_ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_cs4231_ebus_free
c_func
(paren
id|chip
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
op_star
id|rchip
op_assign
id|chip
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cs4231_ebus_attach
r_static
r_int
id|cs4231_ebus_attach
c_func
(paren
r_struct
id|linux_ebus_device
op_star
id|edev
)paren
(brace
id|snd_card_t
op_star
id|card
suffix:semicolon
id|cs4231_t
op_star
id|chip
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|cs4231_attach_begin
c_func
(paren
op_amp
id|card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;%s at 0x%lx, irq %s&quot;
comma
id|card-&gt;shortname
comma
id|edev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
comma
id|__irq_itoa
c_func
(paren
id|edev-&gt;irqs
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_cs4231_ebus_create
c_func
(paren
id|card
comma
id|edev
comma
id|dev
comma
op_amp
id|chip
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_return
id|cs4231_attach_finish
c_func
(paren
id|card
comma
id|chip
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|cs4231_init
r_static
r_int
id|__init
id|cs4231_init
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef SBUS_SUPPORT
r_struct
id|sbus_bus
op_star
id|sbus
suffix:semicolon
r_struct
id|sbus_dev
op_star
id|sdev
suffix:semicolon
macro_line|#endif
macro_line|#ifdef EBUS_SUPPORT
r_struct
id|linux_ebus
op_star
id|ebus
suffix:semicolon
r_struct
id|linux_ebus_device
op_star
id|edev
suffix:semicolon
macro_line|#endif
r_int
id|found
suffix:semicolon
id|found
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef SBUS_SUPPORT
id|for_all_sbusdev
c_func
(paren
id|sdev
comma
id|sbus
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|sdev-&gt;prom_name
comma
l_string|&quot;SUNW,CS4231&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
id|cs4231_sbus_attach
c_func
(paren
id|sdev
)paren
op_eq
l_int|0
)paren
id|found
op_increment
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#ifdef EBUS_SUPPORT
id|for_each_ebus
c_func
(paren
id|ebus
)paren
(brace
id|for_each_ebusdev
c_func
(paren
id|edev
comma
id|ebus
)paren
(brace
r_int
id|match
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|edev-&gt;prom_name
comma
l_string|&quot;SUNW,CS4231&quot;
)paren
)paren
(brace
id|match
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|edev-&gt;prom_name
comma
l_string|&quot;audio&quot;
)paren
)paren
(brace
r_char
id|compat
(braket
l_int|16
)braket
suffix:semicolon
id|prom_getstring
c_func
(paren
id|edev-&gt;prom_node
comma
l_string|&quot;compatible&quot;
comma
id|compat
comma
r_sizeof
(paren
id|compat
)paren
)paren
suffix:semicolon
id|compat
(braket
l_int|15
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|compat
comma
l_string|&quot;SUNW,CS4231&quot;
)paren
)paren
id|match
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|match
op_logical_and
id|cs4231_ebus_attach
c_func
(paren
id|edev
)paren
op_eq
l_int|0
)paren
id|found
op_increment
suffix:semicolon
)brace
)brace
macro_line|#endif
r_return
(paren
id|found
OG
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|cs4231_exit
r_static
r_void
id|__exit
id|cs4231_exit
c_func
(paren
r_void
)paren
(brace
id|cs4231_t
op_star
id|p
op_assign
id|cs4231_list
suffix:semicolon
r_while
c_loop
(paren
id|p
op_ne
l_int|NULL
)paren
(brace
id|cs4231_t
op_star
id|next
op_assign
id|p-&gt;next
suffix:semicolon
id|snd_card_free
c_func
(paren
id|p-&gt;card
)paren
suffix:semicolon
id|p
op_assign
id|next
suffix:semicolon
)brace
id|cs4231_list
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|variable|cs4231_init
id|module_init
c_func
(paren
id|cs4231_init
)paren
suffix:semicolon
DECL|variable|cs4231_exit
id|module_exit
c_func
(paren
id|cs4231_exit
)paren
suffix:semicolon
eof
