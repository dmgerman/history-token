multiline_comment|/*&n; * Driver for AMD7930 sound chips found on Sparcs.&n; * Copyright (C) 2002 David S. Miller &lt;davem@redhat.com&gt;&n; *&n; * Based entirely upon drivers/sbus/audio/amd7930.c which is:&n; * Copyright (C) 1996,1997 Thomas K. Dyas (tdyas@eden.rutgers.edu)&n; *&n; * --- Notes from Thomas&squot;s original driver ---&n; * This is the lowlevel driver for the AMD7930 audio chip found on all&n; * sun4c machines and some sun4m machines.&n; *&n; * The amd7930 is actually an ISDN chip which has a very simple&n; * integrated audio encoder/decoder. When Sun decided on what chip to&n; * use for audio, they had the brilliant idea of using the amd7930 and&n; * only connecting the audio encoder/decoder pins.&n; *&n; * Thanks to the AMD engineer who was able to get us the AMD79C30&n; * databook which has all the programming information and gain tables.&n; *&n; * Advanced Micro Devices&squot; Am79C30A is an ISDN/audio chip used in the&n; * SparcStation 1+.  The chip provides microphone and speaker interfaces&n; * which provide mono-channel audio at 8K samples per second via either&n; * 8-bit A-law or 8-bit mu-law encoding.  Also, the chip features an&n; * ISDN BRI Line Interface Unit (LIU), I.430 S/T physical interface,&n; * which performs basic D channel LAPD processing and provides raw&n; * B channel data.  The digital audio channel, the two ISDN B channels,&n; * and two 64 Kbps channels to the microprocessor are all interconnected&n; * via a multiplexer.&n; * --- End of notes from Thoamas&squot;s original driver ---&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &lt;sound/pcm.h&gt;
macro_line|#include &lt;sound/info.h&gt;
macro_line|#include &lt;sound/control.h&gt;
DECL|macro|SNDRV_GET_ID
mdefine_line|#define SNDRV_GET_ID
macro_line|#include &lt;sound/initval.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/sbus.h&gt;
DECL|variable|index
r_static
r_int
id|index
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_IDX
suffix:semicolon
multiline_comment|/* Index 0-MAX */
DECL|variable|id
r_static
r_char
op_star
id|id
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_STR
suffix:semicolon
multiline_comment|/* ID for this card */
DECL|variable|enable
r_static
r_int
id|enable
(braket
id|SNDRV_CARDS
)braket
op_assign
id|SNDRV_DEFAULT_ENABLE_PNP
suffix:semicolon
multiline_comment|/* Enable this card */
id|MODULE_PARM
c_func
(paren
id|index
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|index
comma
l_string|&quot;Index value for Sun AMD7930 soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|index
comma
id|SNDRV_INDEX_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|id
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;s&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|id
comma
l_string|&quot;ID string for Sun AMD7930 soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|id
comma
id|SNDRV_ID_DESC
)paren
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|enable
comma
l_string|&quot;1-&quot;
id|__MODULE_STRING
c_func
(paren
id|SNDRV_CARDS
)paren
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|enable
comma
l_string|&quot;Enable Sun AMD7930 soundcard.&quot;
)paren
suffix:semicolon
id|MODULE_PARM_SYNTAX
c_func
(paren
id|enable
comma
id|SNDRV_ENABLE_DESC
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Thomas K. Dyas and David S. Miller&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Sun AMD7930&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_CLASSES
c_func
(paren
l_string|&quot;{sound}&quot;
)paren
suffix:semicolon
id|MODULE_DEVICES
c_func
(paren
l_string|&quot;{{Sun,AMD7930}}&quot;
)paren
suffix:semicolon
multiline_comment|/* Device register layout.  */
multiline_comment|/* Register interface presented to the CPU by the amd7930. */
DECL|macro|AMD7930_CR
mdefine_line|#define AMD7930_CR&t;0x00UL&t;&t;/* Command Register (W) */
DECL|macro|AMD7930_IR
mdefine_line|#define AMD7930_IR&t;AMD7930_CR&t;/* Interrupt Register (R) */
DECL|macro|AMD7930_DR
mdefine_line|#define AMD7930_DR&t;0x01UL&t;&t;/* Data Register (R/W) */
DECL|macro|AMD7930_DSR1
mdefine_line|#define AMD7930_DSR1&t;0x02UL&t;&t;/* D-channel Status Register 1 (R) */
DECL|macro|AMD7930_DER
mdefine_line|#define AMD7930_DER&t;0x03UL&t;&t;/* D-channel Error Register (R) */
DECL|macro|AMD7930_DCTB
mdefine_line|#define AMD7930_DCTB&t;0x04UL&t;&t;/* D-channel Transmit Buffer (W) */
DECL|macro|AMD7930_DCRB
mdefine_line|#define AMD7930_DCRB&t;AMD7930_DCTB&t;/* D-channel Receive Buffer (R) */
DECL|macro|AMD7930_BBTB
mdefine_line|#define AMD7930_BBTB&t;0x05UL&t;&t;/* Bb-channel Transmit Buffer (W) */
DECL|macro|AMD7930_BBRB
mdefine_line|#define AMD7930_BBRB&t;AMD7930_BBTB&t;/* Bb-channel Receive Buffer (R) */
DECL|macro|AMD7930_BCTB
mdefine_line|#define AMD7930_BCTB&t;0x06UL&t;&t;/* Bc-channel Transmit Buffer (W) */
DECL|macro|AMD7930_BCRB
mdefine_line|#define AMD7930_BCRB&t;AMD7930_BCTB&t;/* Bc-channel Receive Buffer (R) */
DECL|macro|AMD7930_DSR2
mdefine_line|#define AMD7930_DSR2&t;0x07UL&t;&t;/* D-channel Status Register 2 (R) */
multiline_comment|/* Indirect registers in the Main Audio Processor. */
DECL|struct|amd7930_map
r_struct
id|amd7930_map
(brace
DECL|member|x
id|__u16
id|x
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|r
id|__u16
id|r
(braket
l_int|8
)braket
suffix:semicolon
DECL|member|gx
id|__u16
id|gx
suffix:semicolon
DECL|member|gr
id|__u16
id|gr
suffix:semicolon
DECL|member|ger
id|__u16
id|ger
suffix:semicolon
DECL|member|stgr
id|__u16
id|stgr
suffix:semicolon
DECL|member|ftgr
id|__u16
id|ftgr
suffix:semicolon
DECL|member|atgr
id|__u16
id|atgr
suffix:semicolon
DECL|member|mmr1
id|__u8
id|mmr1
suffix:semicolon
DECL|member|mmr2
id|__u8
id|mmr2
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* After an amd7930 interrupt, reading the Interrupt Register (ir)&n; * clears the interrupt and returns a bitmask indicating which&n; * interrupt source(s) require service.&n; */
DECL|macro|AMR_IR_DTTHRSH
mdefine_line|#define AMR_IR_DTTHRSH&t;&t;&t;0x01 /* D-channel xmit threshold */
DECL|macro|AMR_IR_DRTHRSH
mdefine_line|#define AMR_IR_DRTHRSH&t;&t;&t;0x02 /* D-channel recv threshold */
DECL|macro|AMR_IR_DSRI
mdefine_line|#define AMR_IR_DSRI&t;&t;&t;0x04 /* D-channel packet status */
DECL|macro|AMR_IR_DERI
mdefine_line|#define AMR_IR_DERI&t;&t;&t;0x08 /* D-channel error */
DECL|macro|AMR_IR_BBUF
mdefine_line|#define AMR_IR_BBUF&t;&t;&t;0x10 /* B-channel data xfer */
DECL|macro|AMR_IR_LSRI
mdefine_line|#define AMR_IR_LSRI&t;&t;&t;0x20 /* LIU status */
DECL|macro|AMR_IR_DSR2I
mdefine_line|#define AMR_IR_DSR2I&t;&t;&t;0x40 /* D-channel buffer status */
DECL|macro|AMR_IR_MLTFRMI
mdefine_line|#define AMR_IR_MLTFRMI&t;&t;&t;0x80 /* multiframe or PP */
multiline_comment|/* The amd7930 has &quot;indirect registers&quot; which are accessed by writing&n; * the register number into the Command Register and then reading or&n; * writing values from the Data Register as appropriate. We define the&n; * AMR_* macros to be the indirect register numbers and AM_* macros to&n; * be bits in whatever register is referred to.&n; */
multiline_comment|/* Initialization */
DECL|macro|AMR_INIT
mdefine_line|#define&t;AMR_INIT&t;&t;&t;0x21
DECL|macro|AM_INIT_ACTIVE
mdefine_line|#define&t;&t;AM_INIT_ACTIVE&t;&t;&t;0x01
DECL|macro|AM_INIT_DATAONLY
mdefine_line|#define&t;&t;AM_INIT_DATAONLY&t;&t;0x02
DECL|macro|AM_INIT_POWERDOWN
mdefine_line|#define&t;&t;AM_INIT_POWERDOWN&t;&t;0x03
DECL|macro|AM_INIT_DISABLE_INTS
mdefine_line|#define&t;&t;AM_INIT_DISABLE_INTS&t;&t;0x04
DECL|macro|AMR_INIT2
mdefine_line|#define AMR_INIT2&t;&t;&t;0x20
DECL|macro|AM_INIT2_ENABLE_POWERDOWN
mdefine_line|#define&t;&t;AM_INIT2_ENABLE_POWERDOWN&t;0x20
DECL|macro|AM_INIT2_ENABLE_MULTIFRAME
mdefine_line|#define&t;&t;AM_INIT2_ENABLE_MULTIFRAME&t;0x10
multiline_comment|/* Line Interface Unit */
DECL|macro|AMR_LIU_LSR
mdefine_line|#define&t;AMR_LIU_LSR&t;&t;&t;0xA1
DECL|macro|AM_LIU_LSR_STATE
mdefine_line|#define&t;&t;AM_LIU_LSR_STATE&t;&t;0x07
DECL|macro|AM_LIU_LSR_F3
mdefine_line|#define&t;&t;AM_LIU_LSR_F3&t;&t;&t;0x08
DECL|macro|AM_LIU_LSR_F7
mdefine_line|#define&t;&t;AM_LIU_LSR_F7&t;&t;&t;0x10
DECL|macro|AM_LIU_LSR_F8
mdefine_line|#define&t;&t;AM_LIU_LSR_F8&t;&t;&t;0x20
DECL|macro|AM_LIU_LSR_HSW
mdefine_line|#define&t;&t;AM_LIU_LSR_HSW&t;&t;&t;0x40
DECL|macro|AM_LIU_LSR_HSW_CHG
mdefine_line|#define&t;&t;AM_LIU_LSR_HSW_CHG&t;&t;0x80
DECL|macro|AMR_LIU_LPR
mdefine_line|#define&t;AMR_LIU_LPR&t;&t;&t;0xA2
DECL|macro|AMR_LIU_LMR1
mdefine_line|#define&t;AMR_LIU_LMR1&t;&t;&t;0xA3
DECL|macro|AM_LIU_LMR1_B1_ENABL
mdefine_line|#define&t;&t;AM_LIU_LMR1_B1_ENABL&t;&t;0x01
DECL|macro|AM_LIU_LMR1_B2_ENABL
mdefine_line|#define&t;&t;AM_LIU_LMR1_B2_ENABL&t;&t;0x02
DECL|macro|AM_LIU_LMR1_F_DISABL
mdefine_line|#define&t;&t;AM_LIU_LMR1_F_DISABL&t;&t;0x04
DECL|macro|AM_LIU_LMR1_FA_DISABL
mdefine_line|#define&t;&t;AM_LIU_LMR1_FA_DISABL&t;&t;0x08
DECL|macro|AM_LIU_LMR1_REQ_ACTIV
mdefine_line|#define&t;&t;AM_LIU_LMR1_REQ_ACTIV&t;&t;0x10
DECL|macro|AM_LIU_LMR1_F8_F3
mdefine_line|#define&t;&t;AM_LIU_LMR1_F8_F3&t;&t;0x20
DECL|macro|AM_LIU_LMR1_LIU_ENABL
mdefine_line|#define&t;&t;AM_LIU_LMR1_LIU_ENABL&t;&t;0x40
DECL|macro|AMR_LIU_LMR2
mdefine_line|#define&t;AMR_LIU_LMR2&t;&t;&t;0xA4
DECL|macro|AM_LIU_LMR2_DECHO
mdefine_line|#define&t;&t;AM_LIU_LMR2_DECHO&t;&t;0x01
DECL|macro|AM_LIU_LMR2_DLOOP
mdefine_line|#define&t;&t;AM_LIU_LMR2_DLOOP&t;&t;0x02
DECL|macro|AM_LIU_LMR2_DBACKOFF
mdefine_line|#define&t;&t;AM_LIU_LMR2_DBACKOFF&t;&t;0x04
DECL|macro|AM_LIU_LMR2_EN_F3_INT
mdefine_line|#define&t;&t;AM_LIU_LMR2_EN_F3_INT&t;&t;0x08
DECL|macro|AM_LIU_LMR2_EN_F8_INT
mdefine_line|#define&t;&t;AM_LIU_LMR2_EN_F8_INT&t;&t;0x10
DECL|macro|AM_LIU_LMR2_EN_HSW_INT
mdefine_line|#define&t;&t;AM_LIU_LMR2_EN_HSW_INT&t;&t;0x20
DECL|macro|AM_LIU_LMR2_EN_F7_INT
mdefine_line|#define&t;&t;AM_LIU_LMR2_EN_F7_INT&t;&t;0x40
DECL|macro|AMR_LIU_2_4
mdefine_line|#define&t;AMR_LIU_2_4&t;&t;&t;0xA5
DECL|macro|AMR_LIU_MF
mdefine_line|#define&t;AMR_LIU_MF&t;&t;&t;0xA6
DECL|macro|AMR_LIU_MFSB
mdefine_line|#define&t;AMR_LIU_MFSB&t;&t;&t;0xA7
DECL|macro|AMR_LIU_MFQB
mdefine_line|#define&t;AMR_LIU_MFQB&t;&t;&t;0xA8
multiline_comment|/* Multiplexor */
DECL|macro|AMR_MUX_MCR1
mdefine_line|#define&t;AMR_MUX_MCR1&t;&t;&t;0x41
DECL|macro|AMR_MUX_MCR2
mdefine_line|#define&t;AMR_MUX_MCR2&t;&t;&t;0x42
DECL|macro|AMR_MUX_MCR3
mdefine_line|#define&t;AMR_MUX_MCR3&t;&t;&t;0x43
DECL|macro|AM_MUX_CHANNEL_B1
mdefine_line|#define&t;&t;AM_MUX_CHANNEL_B1&t;&t;0x01
DECL|macro|AM_MUX_CHANNEL_B2
mdefine_line|#define&t;&t;AM_MUX_CHANNEL_B2&t;&t;0x02
DECL|macro|AM_MUX_CHANNEL_Ba
mdefine_line|#define&t;&t;AM_MUX_CHANNEL_Ba&t;&t;0x03
DECL|macro|AM_MUX_CHANNEL_Bb
mdefine_line|#define&t;&t;AM_MUX_CHANNEL_Bb&t;&t;0x04
DECL|macro|AM_MUX_CHANNEL_Bc
mdefine_line|#define&t;&t;AM_MUX_CHANNEL_Bc&t;&t;0x05
DECL|macro|AM_MUX_CHANNEL_Bd
mdefine_line|#define&t;&t;AM_MUX_CHANNEL_Bd&t;&t;0x06
DECL|macro|AM_MUX_CHANNEL_Be
mdefine_line|#define&t;&t;AM_MUX_CHANNEL_Be&t;&t;0x07
DECL|macro|AM_MUX_CHANNEL_Bf
mdefine_line|#define&t;&t;AM_MUX_CHANNEL_Bf&t;&t;0x08
DECL|macro|AMR_MUX_MCR4
mdefine_line|#define&t;AMR_MUX_MCR4&t;&t;&t;0x44
DECL|macro|AM_MUX_MCR4_ENABLE_INTS
mdefine_line|#define&t;&t;AM_MUX_MCR4_ENABLE_INTS&t;&t;0x08
DECL|macro|AM_MUX_MCR4_REVERSE_Bb
mdefine_line|#define&t;&t;AM_MUX_MCR4_REVERSE_Bb&t;&t;0x10
DECL|macro|AM_MUX_MCR4_REVERSE_Bc
mdefine_line|#define&t;&t;AM_MUX_MCR4_REVERSE_Bc&t;&t;0x20
DECL|macro|AMR_MUX_1_4
mdefine_line|#define&t;AMR_MUX_1_4&t;&t;&t;0x45
multiline_comment|/* Main Audio Processor */
DECL|macro|AMR_MAP_X
mdefine_line|#define&t;AMR_MAP_X&t;&t;&t;0x61
DECL|macro|AMR_MAP_R
mdefine_line|#define&t;AMR_MAP_R&t;&t;&t;0x62
DECL|macro|AMR_MAP_GX
mdefine_line|#define&t;AMR_MAP_GX&t;&t;&t;0x63
DECL|macro|AMR_MAP_GR
mdefine_line|#define&t;AMR_MAP_GR&t;&t;&t;0x64
DECL|macro|AMR_MAP_GER
mdefine_line|#define&t;AMR_MAP_GER&t;&t;&t;0x65
DECL|macro|AMR_MAP_STGR
mdefine_line|#define&t;AMR_MAP_STGR&t;&t;&t;0x66
DECL|macro|AMR_MAP_FTGR_1_2
mdefine_line|#define&t;AMR_MAP_FTGR_1_2&t;&t;0x67
DECL|macro|AMR_MAP_ATGR_1_2
mdefine_line|#define&t;AMR_MAP_ATGR_1_2&t;&t;0x68
DECL|macro|AMR_MAP_MMR1
mdefine_line|#define&t;AMR_MAP_MMR1&t;&t;&t;0x69
DECL|macro|AM_MAP_MMR1_ALAW
mdefine_line|#define&t;&t;AM_MAP_MMR1_ALAW&t;&t;0x01
DECL|macro|AM_MAP_MMR1_GX
mdefine_line|#define&t;&t;AM_MAP_MMR1_GX&t;&t;&t;0x02
DECL|macro|AM_MAP_MMR1_GR
mdefine_line|#define&t;&t;AM_MAP_MMR1_GR&t;&t;&t;0x04
DECL|macro|AM_MAP_MMR1_GER
mdefine_line|#define&t;&t;AM_MAP_MMR1_GER&t;&t;&t;0x08
DECL|macro|AM_MAP_MMR1_X
mdefine_line|#define&t;&t;AM_MAP_MMR1_X&t;&t;&t;0x10
DECL|macro|AM_MAP_MMR1_R
mdefine_line|#define&t;&t;AM_MAP_MMR1_R&t;&t;&t;0x20
DECL|macro|AM_MAP_MMR1_STG
mdefine_line|#define&t;&t;AM_MAP_MMR1_STG&t;&t;&t;0x40
DECL|macro|AM_MAP_MMR1_LOOPBACK
mdefine_line|#define&t;&t;AM_MAP_MMR1_LOOPBACK&t;&t;0x80
DECL|macro|AMR_MAP_MMR2
mdefine_line|#define&t;AMR_MAP_MMR2&t;&t;&t;0x6A
DECL|macro|AM_MAP_MMR2_AINB
mdefine_line|#define&t;&t;AM_MAP_MMR2_AINB&t;&t;0x01
DECL|macro|AM_MAP_MMR2_LS
mdefine_line|#define&t;&t;AM_MAP_MMR2_LS&t;&t;&t;0x02
DECL|macro|AM_MAP_MMR2_ENABLE_DTMF
mdefine_line|#define&t;&t;AM_MAP_MMR2_ENABLE_DTMF&t;&t;0x04
DECL|macro|AM_MAP_MMR2_ENABLE_TONEGEN
mdefine_line|#define&t;&t;AM_MAP_MMR2_ENABLE_TONEGEN&t;0x08
DECL|macro|AM_MAP_MMR2_ENABLE_TONERING
mdefine_line|#define&t;&t;AM_MAP_MMR2_ENABLE_TONERING&t;0x10
DECL|macro|AM_MAP_MMR2_DISABLE_HIGHPASS
mdefine_line|#define&t;&t;AM_MAP_MMR2_DISABLE_HIGHPASS&t;0x20
DECL|macro|AM_MAP_MMR2_DISABLE_AUTOZERO
mdefine_line|#define&t;&t;AM_MAP_MMR2_DISABLE_AUTOZERO&t;0x40
DECL|macro|AMR_MAP_1_10
mdefine_line|#define&t;AMR_MAP_1_10&t;&t;&t;0x6B
DECL|macro|AMR_MAP_MMR3
mdefine_line|#define&t;AMR_MAP_MMR3&t;&t;&t;0x6C
DECL|macro|AMR_MAP_STRA
mdefine_line|#define&t;AMR_MAP_STRA&t;&t;&t;0x6D
DECL|macro|AMR_MAP_STRF
mdefine_line|#define&t;AMR_MAP_STRF&t;&t;&t;0x6E
DECL|macro|AMR_MAP_PEAKX
mdefine_line|#define&t;AMR_MAP_PEAKX&t;&t;&t;0x70
DECL|macro|AMR_MAP_PEAKR
mdefine_line|#define&t;AMR_MAP_PEAKR&t;&t;&t;0x71
DECL|macro|AMR_MAP_15_16
mdefine_line|#define&t;AMR_MAP_15_16&t;&t;&t;0x72
multiline_comment|/* Data Link Controller */
DECL|macro|AMR_DLC_FRAR_1_2_3
mdefine_line|#define&t;AMR_DLC_FRAR_1_2_3&t;&t;0x81
DECL|macro|AMR_DLC_SRAR_1_2_3
mdefine_line|#define&t;AMR_DLC_SRAR_1_2_3&t;&t;0x82
DECL|macro|AMR_DLC_TAR
mdefine_line|#define&t;AMR_DLC_TAR&t;&t;&t;0x83
DECL|macro|AMR_DLC_DRLR
mdefine_line|#define&t;AMR_DLC_DRLR&t;&t;&t;0x84
DECL|macro|AMR_DLC_DTCR
mdefine_line|#define&t;AMR_DLC_DTCR&t;&t;&t;0x85
DECL|macro|AMR_DLC_DMR1
mdefine_line|#define&t;AMR_DLC_DMR1&t;&t;&t;0x86
DECL|macro|AMR_DLC_DMR1_DTTHRSH_INT
mdefine_line|#define&t;&t;AMR_DLC_DMR1_DTTHRSH_INT&t;0x01
DECL|macro|AMR_DLC_DMR1_DRTHRSH_INT
mdefine_line|#define&t;&t;AMR_DLC_DMR1_DRTHRSH_INT&t;0x02
DECL|macro|AMR_DLC_DMR1_TAR_ENABL
mdefine_line|#define&t;&t;AMR_DLC_DMR1_TAR_ENABL&t;&t;0x04
DECL|macro|AMR_DLC_DMR1_EORP_INT
mdefine_line|#define&t;&t;AMR_DLC_DMR1_EORP_INT&t;&t;0x08
DECL|macro|AMR_DLC_DMR1_EN_ADDR1
mdefine_line|#define&t;&t;AMR_DLC_DMR1_EN_ADDR1&t;&t;0x10
DECL|macro|AMR_DLC_DMR1_EN_ADDR2
mdefine_line|#define&t;&t;AMR_DLC_DMR1_EN_ADDR2&t;&t;0x20
DECL|macro|AMR_DLC_DMR1_EN_ADDR3
mdefine_line|#define&t;&t;AMR_DLC_DMR1_EN_ADDR3&t;&t;0x40
DECL|macro|AMR_DLC_DMR1_EN_ADDR4
mdefine_line|#define&t;&t;AMR_DLC_DMR1_EN_ADDR4&t;&t;0x80
DECL|macro|AMR_DLC_DMR1_EN_ADDRS
mdefine_line|#define&t;&t;AMR_DLC_DMR1_EN_ADDRS&t;&t;0xf0
DECL|macro|AMR_DLC_DMR2
mdefine_line|#define&t;AMR_DLC_DMR2&t;&t;&t;0x87
DECL|macro|AMR_DLC_DMR2_RABRT_INT
mdefine_line|#define&t;&t;AMR_DLC_DMR2_RABRT_INT&t;&t;0x01
DECL|macro|AMR_DLC_DMR2_RESID_INT
mdefine_line|#define&t;&t;AMR_DLC_DMR2_RESID_INT&t;&t;0x02
DECL|macro|AMR_DLC_DMR2_COLL_INT
mdefine_line|#define&t;&t;AMR_DLC_DMR2_COLL_INT&t;&t;0x04
DECL|macro|AMR_DLC_DMR2_FCS_INT
mdefine_line|#define&t;&t;AMR_DLC_DMR2_FCS_INT&t;&t;0x08
DECL|macro|AMR_DLC_DMR2_OVFL_INT
mdefine_line|#define&t;&t;AMR_DLC_DMR2_OVFL_INT&t;&t;0x10
DECL|macro|AMR_DLC_DMR2_UNFL_INT
mdefine_line|#define&t;&t;AMR_DLC_DMR2_UNFL_INT&t;&t;0x20
DECL|macro|AMR_DLC_DMR2_OVRN_INT
mdefine_line|#define&t;&t;AMR_DLC_DMR2_OVRN_INT&t;&t;0x40
DECL|macro|AMR_DLC_DMR2_UNRN_INT
mdefine_line|#define&t;&t;AMR_DLC_DMR2_UNRN_INT&t;&t;0x80
DECL|macro|AMR_DLC_1_7
mdefine_line|#define&t;AMR_DLC_1_7&t;&t;&t;0x88
DECL|macro|AMR_DLC_DRCR
mdefine_line|#define&t;AMR_DLC_DRCR&t;&t;&t;0x89
DECL|macro|AMR_DLC_RNGR1
mdefine_line|#define&t;AMR_DLC_RNGR1&t;&t;&t;0x8A
DECL|macro|AMR_DLC_RNGR2
mdefine_line|#define&t;AMR_DLC_RNGR2&t;&t;&t;0x8B
DECL|macro|AMR_DLC_FRAR4
mdefine_line|#define&t;AMR_DLC_FRAR4&t;&t;&t;0x8C
DECL|macro|AMR_DLC_SRAR4
mdefine_line|#define&t;AMR_DLC_SRAR4&t;&t;&t;0x8D
DECL|macro|AMR_DLC_DMR3
mdefine_line|#define&t;AMR_DLC_DMR3&t;&t;&t;0x8E
DECL|macro|AMR_DLC_DMR3_VA_INT
mdefine_line|#define&t;&t;AMR_DLC_DMR3_VA_INT&t;&t;0x01
DECL|macro|AMR_DLC_DMR3_EOTP_INT
mdefine_line|#define&t;&t;AMR_DLC_DMR3_EOTP_INT&t;&t;0x02
DECL|macro|AMR_DLC_DMR3_LBRP_INT
mdefine_line|#define&t;&t;AMR_DLC_DMR3_LBRP_INT&t;&t;0x04
DECL|macro|AMR_DLC_DMR3_RBA_INT
mdefine_line|#define&t;&t;AMR_DLC_DMR3_RBA_INT&t;&t;0x08
DECL|macro|AMR_DLC_DMR3_LBT_INT
mdefine_line|#define&t;&t;AMR_DLC_DMR3_LBT_INT&t;&t;0x10
DECL|macro|AMR_DLC_DMR3_TBE_INT
mdefine_line|#define&t;&t;AMR_DLC_DMR3_TBE_INT&t;&t;0x20
DECL|macro|AMR_DLC_DMR3_RPLOST_INT
mdefine_line|#define&t;&t;AMR_DLC_DMR3_RPLOST_INT&t;&t;0x40
DECL|macro|AMR_DLC_DMR3_KEEP_FCS
mdefine_line|#define&t;&t;AMR_DLC_DMR3_KEEP_FCS&t;&t;0x80
DECL|macro|AMR_DLC_DMR4
mdefine_line|#define&t;AMR_DLC_DMR4&t;&t;&t;0x8F
DECL|macro|AMR_DLC_DMR4_RCV_1
mdefine_line|#define&t;&t;AMR_DLC_DMR4_RCV_1&t;&t;0x00
DECL|macro|AMR_DLC_DMR4_RCV_2
mdefine_line|#define&t;&t;AMR_DLC_DMR4_RCV_2&t;&t;0x01
DECL|macro|AMR_DLC_DMR4_RCV_4
mdefine_line|#define&t;&t;AMR_DLC_DMR4_RCV_4&t;&t;0x02
DECL|macro|AMR_DLC_DMR4_RCV_8
mdefine_line|#define&t;&t;AMR_DLC_DMR4_RCV_8&t;&t;0x03
DECL|macro|AMR_DLC_DMR4_RCV_16
mdefine_line|#define&t;&t;AMR_DLC_DMR4_RCV_16&t;&t;0x01
DECL|macro|AMR_DLC_DMR4_RCV_24
mdefine_line|#define&t;&t;AMR_DLC_DMR4_RCV_24&t;&t;0x02
DECL|macro|AMR_DLC_DMR4_RCV_30
mdefine_line|#define&t;&t;AMR_DLC_DMR4_RCV_30&t;&t;0x03
DECL|macro|AMR_DLC_DMR4_XMT_1
mdefine_line|#define&t;&t;AMR_DLC_DMR4_XMT_1&t;&t;0x00
DECL|macro|AMR_DLC_DMR4_XMT_2
mdefine_line|#define&t;&t;AMR_DLC_DMR4_XMT_2&t;&t;0x04
DECL|macro|AMR_DLC_DMR4_XMT_4
mdefine_line|#define&t;&t;AMR_DLC_DMR4_XMT_4&t;&t;0x08
DECL|macro|AMR_DLC_DMR4_XMT_8
mdefine_line|#define&t;&t;AMR_DLC_DMR4_XMT_8&t;&t;0x0c
DECL|macro|AMR_DLC_DMR4_XMT_10
mdefine_line|#define&t;&t;AMR_DLC_DMR4_XMT_10&t;&t;0x08
DECL|macro|AMR_DLC_DMR4_XMT_14
mdefine_line|#define&t;&t;AMR_DLC_DMR4_XMT_14&t;&t;0x0c
DECL|macro|AMR_DLC_DMR4_IDLE_MARK
mdefine_line|#define&t;&t;AMR_DLC_DMR4_IDLE_MARK&t;&t;0x00
DECL|macro|AMR_DLC_DMR4_IDLE_FLAG
mdefine_line|#define&t;&t;AMR_DLC_DMR4_IDLE_FLAG&t;&t;0x10
DECL|macro|AMR_DLC_DMR4_ADDR_BOTH
mdefine_line|#define&t;&t;AMR_DLC_DMR4_ADDR_BOTH&t;&t;0x00
DECL|macro|AMR_DLC_DMR4_ADDR_1ST
mdefine_line|#define&t;&t;AMR_DLC_DMR4_ADDR_1ST&t;&t;0x20
DECL|macro|AMR_DLC_DMR4_ADDR_2ND
mdefine_line|#define&t;&t;AMR_DLC_DMR4_ADDR_2ND&t;&t;0xa0
DECL|macro|AMR_DLC_DMR4_CR_ENABLE
mdefine_line|#define&t;&t;AMR_DLC_DMR4_CR_ENABLE&t;&t;0x40
DECL|macro|AMR_DLC_12_15
mdefine_line|#define&t;AMR_DLC_12_15&t;&t;&t;0x90
DECL|macro|AMR_DLC_ASR
mdefine_line|#define&t;AMR_DLC_ASR&t;&t;&t;0x91
DECL|macro|AMR_DLC_EFCR
mdefine_line|#define&t;AMR_DLC_EFCR&t;&t;&t;0x92
DECL|macro|AMR_DLC_EFCR_EXTEND_FIFO
mdefine_line|#define&t;&t;AMR_DLC_EFCR_EXTEND_FIFO&t;0x01
DECL|macro|AMR_DLC_EFCR_SEC_PKT_INT
mdefine_line|#define&t;&t;AMR_DLC_EFCR_SEC_PKT_INT&t;0x02
DECL|macro|AMR_DSR1_VADDR
mdefine_line|#define AMR_DSR1_VADDR&t;&t;&t;0x01
DECL|macro|AMR_DSR1_EORP
mdefine_line|#define AMR_DSR1_EORP&t;&t;&t;0x02
DECL|macro|AMR_DSR1_PKT_IP
mdefine_line|#define AMR_DSR1_PKT_IP&t;&t;&t;0x04
DECL|macro|AMR_DSR1_DECHO_ON
mdefine_line|#define AMR_DSR1_DECHO_ON&t;&t;0x08
DECL|macro|AMR_DSR1_DLOOP_ON
mdefine_line|#define AMR_DSR1_DLOOP_ON&t;&t;0x10
DECL|macro|AMR_DSR1_DBACK_OFF
mdefine_line|#define AMR_DSR1_DBACK_OFF&t;&t;0x20
DECL|macro|AMR_DSR1_EOTP
mdefine_line|#define AMR_DSR1_EOTP&t;&t;&t;0x40
DECL|macro|AMR_DSR1_CXMT_ABRT
mdefine_line|#define AMR_DSR1_CXMT_ABRT&t;&t;0x80
DECL|macro|AMR_DSR2_LBRP
mdefine_line|#define AMR_DSR2_LBRP&t;&t;&t;0x01
DECL|macro|AMR_DSR2_RBA
mdefine_line|#define AMR_DSR2_RBA&t;&t;&t;0x02
DECL|macro|AMR_DSR2_RPLOST
mdefine_line|#define AMR_DSR2_RPLOST&t;&t;&t;0x04
DECL|macro|AMR_DSR2_LAST_BYTE
mdefine_line|#define AMR_DSR2_LAST_BYTE&t;&t;0x08
DECL|macro|AMR_DSR2_TBE
mdefine_line|#define AMR_DSR2_TBE&t;&t;&t;0x10
DECL|macro|AMR_DSR2_MARK_IDLE
mdefine_line|#define AMR_DSR2_MARK_IDLE&t;&t;0x20
DECL|macro|AMR_DSR2_FLAG_IDLE
mdefine_line|#define AMR_DSR2_FLAG_IDLE&t;&t;0x40
DECL|macro|AMR_DSR2_SECOND_PKT
mdefine_line|#define AMR_DSR2_SECOND_PKT&t;&t;0x80
DECL|macro|AMR_DER_RABRT
mdefine_line|#define AMR_DER_RABRT&t;&t;&t;0x01
DECL|macro|AMR_DER_RFRAME
mdefine_line|#define AMR_DER_RFRAME&t;&t;&t;0x02
DECL|macro|AMR_DER_COLLISION
mdefine_line|#define AMR_DER_COLLISION&t;&t;0x04
DECL|macro|AMR_DER_FCS
mdefine_line|#define AMR_DER_FCS&t;&t;&t;0x08
DECL|macro|AMR_DER_OVFL
mdefine_line|#define AMR_DER_OVFL&t;&t;&t;0x10
DECL|macro|AMR_DER_UNFL
mdefine_line|#define AMR_DER_UNFL&t;&t;&t;0x20
DECL|macro|AMR_DER_OVRN
mdefine_line|#define AMR_DER_OVRN&t;&t;&t;0x40
DECL|macro|AMR_DER_UNRN
mdefine_line|#define AMR_DER_UNRN&t;&t;&t;0x80
multiline_comment|/* Peripheral Port */
DECL|macro|AMR_PP_PPCR1
mdefine_line|#define&t;AMR_PP_PPCR1&t;&t;&t;0xC0
DECL|macro|AMR_PP_PPSR
mdefine_line|#define&t;AMR_PP_PPSR&t;&t;&t;0xC1
DECL|macro|AMR_PP_PPIER
mdefine_line|#define&t;AMR_PP_PPIER&t;&t;&t;0xC2
DECL|macro|AMR_PP_MTDR
mdefine_line|#define&t;AMR_PP_MTDR&t;&t;&t;0xC3
DECL|macro|AMR_PP_MRDR
mdefine_line|#define&t;AMR_PP_MRDR&t;&t;&t;0xC3
DECL|macro|AMR_PP_CITDR0
mdefine_line|#define&t;AMR_PP_CITDR0&t;&t;&t;0xC4
DECL|macro|AMR_PP_CIRDR0
mdefine_line|#define&t;AMR_PP_CIRDR0&t;&t;&t;0xC4
DECL|macro|AMR_PP_CITDR1
mdefine_line|#define&t;AMR_PP_CITDR1&t;&t;&t;0xC5
DECL|macro|AMR_PP_CIRDR1
mdefine_line|#define&t;AMR_PP_CIRDR1&t;&t;&t;0xC5
DECL|macro|AMR_PP_PPCR2
mdefine_line|#define&t;AMR_PP_PPCR2&t;&t;&t;0xC8
DECL|macro|AMR_PP_PPCR3
mdefine_line|#define&t;AMR_PP_PPCR3&t;&t;&t;0xC9
DECL|struct|snd_amd7930
r_typedef
r_struct
id|snd_amd7930
(brace
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|regs
r_int
r_int
id|regs
suffix:semicolon
DECL|member|flags
id|u32
id|flags
suffix:semicolon
DECL|macro|AMD7930_FLAG_PLAYBACK
mdefine_line|#define AMD7930_FLAG_PLAYBACK&t;0x00000001
DECL|macro|AMD7930_FLAG_CAPTURE
mdefine_line|#define AMD7930_FLAG_CAPTURE&t;0x00000002
DECL|member|map
r_struct
id|amd7930_map
id|map
suffix:semicolon
DECL|member|card
id|snd_card_t
op_star
id|card
suffix:semicolon
DECL|member|pcm
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
DECL|member|playback_substream
id|snd_pcm_substream_t
op_star
id|playback_substream
suffix:semicolon
DECL|member|capture_substream
id|snd_pcm_substream_t
op_star
id|capture_substream
suffix:semicolon
multiline_comment|/* Playback/Capture buffer state. */
DECL|member|p_orig
DECL|member|p_cur
r_int
r_char
op_star
id|p_orig
comma
op_star
id|p_cur
suffix:semicolon
DECL|member|p_left
r_int
id|p_left
suffix:semicolon
DECL|member|c_orig
DECL|member|c_cur
r_int
r_char
op_star
id|c_orig
comma
op_star
id|c_cur
suffix:semicolon
DECL|member|c_left
r_int
id|c_left
suffix:semicolon
DECL|member|rgain
r_int
id|rgain
suffix:semicolon
DECL|member|pgain
r_int
id|pgain
suffix:semicolon
DECL|member|mgain
r_int
id|mgain
suffix:semicolon
DECL|member|sdev
r_struct
id|sbus_dev
op_star
id|sdev
suffix:semicolon
DECL|member|irq
r_int
r_int
id|irq
suffix:semicolon
DECL|member|regs_size
r_int
r_int
id|regs_size
suffix:semicolon
DECL|member|next
r_struct
id|snd_amd7930
op_star
id|next
suffix:semicolon
DECL|typedef|amd7930_t
)brace
id|amd7930_t
suffix:semicolon
DECL|macro|chip_t
mdefine_line|#define chip_t amd7930_t
DECL|variable|amd7930_list
r_static
id|amd7930_t
op_star
id|amd7930_list
suffix:semicolon
multiline_comment|/* Idle the AMD7930 chip.  The amd-&gt;lock is not held.  */
DECL|function|amd7930_idle
r_static
id|__inline__
r_void
id|amd7930_idle
c_func
(paren
id|amd7930_t
op_star
id|amd
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|amd-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|AMR_INIT
comma
id|amd-&gt;regs
op_plus
id|AMD7930_CR
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
l_int|0
comma
id|amd-&gt;regs
op_plus
id|AMD7930_DR
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|amd-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* Enable chip interrupts.  The amd-&gt;lock is not held.  */
DECL|function|amd7930_enable_ints
r_static
id|__inline__
r_void
id|amd7930_enable_ints
c_func
(paren
id|amd7930_t
op_star
id|amd
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|amd-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|AMR_INIT
comma
id|amd-&gt;regs
op_plus
id|AMD7930_CR
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|AM_INIT_ACTIVE
comma
id|amd-&gt;regs
op_plus
id|AMD7930_DR
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|amd-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* Disable chip interrupts.  The amd-&gt;lock is not held.  */
DECL|function|amd7930_disable_ints
r_static
id|__inline__
r_void
id|amd7930_disable_ints
c_func
(paren
id|amd7930_t
op_star
id|amd
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|amd-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|AMR_INIT
comma
id|amd-&gt;regs
op_plus
id|AMD7930_CR
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|AM_INIT_ACTIVE
op_or
id|AM_INIT_DISABLE_INTS
comma
id|amd-&gt;regs
op_plus
id|AMD7930_DR
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|amd-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/* Commit amd7930_map settings to the hardware.&n; * The amd-&gt;lock is held and local interrupts are disabled.&n; */
DECL|function|__amd7930_write_map
r_static
r_void
id|__amd7930_write_map
c_func
(paren
id|amd7930_t
op_star
id|amd
)paren
(brace
r_struct
id|amd7930_map
op_star
id|map
op_assign
op_amp
id|amd-&gt;map
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|AMR_MAP_GX
comma
id|amd-&gt;regs
op_plus
id|AMD7930_CR
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
(paren
(paren
id|map-&gt;gx
op_rshift
l_int|0
)paren
op_amp
l_int|0xff
)paren
comma
id|amd-&gt;regs
op_plus
id|AMD7930_DR
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
(paren
(paren
id|map-&gt;gx
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
comma
id|amd-&gt;regs
op_plus
id|AMD7930_DR
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|AMR_MAP_GR
comma
id|amd-&gt;regs
op_plus
id|AMD7930_CR
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
(paren
(paren
id|map-&gt;gr
op_rshift
l_int|0
)paren
op_amp
l_int|0xff
)paren
comma
id|amd-&gt;regs
op_plus
id|AMD7930_DR
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
(paren
(paren
id|map-&gt;gr
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
comma
id|amd-&gt;regs
op_plus
id|AMD7930_DR
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|AMR_MAP_STGR
comma
id|amd-&gt;regs
op_plus
id|AMD7930_CR
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
(paren
(paren
id|map-&gt;stgr
op_rshift
l_int|0
)paren
op_amp
l_int|0xff
)paren
comma
id|amd-&gt;regs
op_plus
id|AMD7930_DR
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
(paren
(paren
id|map-&gt;stgr
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
comma
id|amd-&gt;regs
op_plus
id|AMD7930_DR
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|AMR_MAP_GER
comma
id|amd-&gt;regs
op_plus
id|AMD7930_CR
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
(paren
(paren
id|map-&gt;ger
op_rshift
l_int|0
)paren
op_amp
l_int|0xff
)paren
comma
id|amd-&gt;regs
op_plus
id|AMD7930_DR
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
(paren
(paren
id|map-&gt;ger
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
comma
id|amd-&gt;regs
op_plus
id|AMD7930_DR
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|AMR_MAP_MMR1
comma
id|amd-&gt;regs
op_plus
id|AMD7930_CR
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|map-&gt;mmr1
comma
id|amd-&gt;regs
op_plus
id|AMD7930_DR
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|AMR_MAP_MMR2
comma
id|amd-&gt;regs
op_plus
id|AMD7930_CR
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|map-&gt;mmr2
comma
id|amd-&gt;regs
op_plus
id|AMD7930_DR
)paren
suffix:semicolon
)brace
multiline_comment|/* gx, gr &amp; stg gains.  this table must contain 256 elements with&n; * the 0th being &quot;infinity&quot; (the magic value 9008).  The remaining&n; * elements match sun&squot;s gain curve (but with higher resolution):&n; * -18 to 0dB in .16dB steps then 0 to 12dB in .08dB steps.&n; */
DECL|variable|gx_coeff
r_static
id|__const__
id|__u16
id|gx_coeff
(braket
l_int|256
)braket
op_assign
(brace
l_int|0x9008
comma
l_int|0x8b7c
comma
l_int|0x8b51
comma
l_int|0x8b45
comma
l_int|0x8b42
comma
l_int|0x8b3b
comma
l_int|0x8b36
comma
l_int|0x8b33
comma
l_int|0x8b32
comma
l_int|0x8b2a
comma
l_int|0x8b2b
comma
l_int|0x8b2c
comma
l_int|0x8b25
comma
l_int|0x8b23
comma
l_int|0x8b22
comma
l_int|0x8b22
comma
l_int|0x9122
comma
l_int|0x8b1a
comma
l_int|0x8aa3
comma
l_int|0x8aa3
comma
l_int|0x8b1c
comma
l_int|0x8aa6
comma
l_int|0x912d
comma
l_int|0x912b
comma
l_int|0x8aab
comma
l_int|0x8b12
comma
l_int|0x8aaa
comma
l_int|0x8ab2
comma
l_int|0x9132
comma
l_int|0x8ab4
comma
l_int|0x913c
comma
l_int|0x8abb
comma
l_int|0x9142
comma
l_int|0x9144
comma
l_int|0x9151
comma
l_int|0x8ad5
comma
l_int|0x8aeb
comma
l_int|0x8a79
comma
l_int|0x8a5a
comma
l_int|0x8a4a
comma
l_int|0x8b03
comma
l_int|0x91c2
comma
l_int|0x91bb
comma
l_int|0x8a3f
comma
l_int|0x8a33
comma
l_int|0x91b2
comma
l_int|0x9212
comma
l_int|0x9213
comma
l_int|0x8a2c
comma
l_int|0x921d
comma
l_int|0x8a23
comma
l_int|0x921a
comma
l_int|0x9222
comma
l_int|0x9223
comma
l_int|0x922d
comma
l_int|0x9231
comma
l_int|0x9234
comma
l_int|0x9242
comma
l_int|0x925b
comma
l_int|0x92dd
comma
l_int|0x92c1
comma
l_int|0x92b3
comma
l_int|0x92ab
comma
l_int|0x92a4
comma
l_int|0x92a2
comma
l_int|0x932b
comma
l_int|0x9341
comma
l_int|0x93d3
comma
l_int|0x93b2
comma
l_int|0x93a2
comma
l_int|0x943c
comma
l_int|0x94b2
comma
l_int|0x953a
comma
l_int|0x9653
comma
l_int|0x9782
comma
l_int|0x9e21
comma
l_int|0x9d23
comma
l_int|0x9cd2
comma
l_int|0x9c23
comma
l_int|0x9baa
comma
l_int|0x9bde
comma
l_int|0x9b33
comma
l_int|0x9b22
comma
l_int|0x9b1d
comma
l_int|0x9ab2
comma
l_int|0xa142
comma
l_int|0xa1e5
comma
l_int|0x9a3b
comma
l_int|0xa213
comma
l_int|0xa1a2
comma
l_int|0xa231
comma
l_int|0xa2eb
comma
l_int|0xa313
comma
l_int|0xa334
comma
l_int|0xa421
comma
l_int|0xa54b
comma
l_int|0xada4
comma
l_int|0xac23
comma
l_int|0xab3b
comma
l_int|0xaaab
comma
l_int|0xaa5c
comma
l_int|0xb1a3
comma
l_int|0xb2ca
comma
l_int|0xb3bd
comma
l_int|0xbe24
comma
l_int|0xbb2b
comma
l_int|0xba33
comma
l_int|0xc32b
comma
l_int|0xcb5a
comma
l_int|0xd2a2
comma
l_int|0xe31d
comma
l_int|0x0808
comma
l_int|0x72ba
comma
l_int|0x62c2
comma
l_int|0x5c32
comma
l_int|0x52db
comma
l_int|0x513e
comma
l_int|0x4cce
comma
l_int|0x43b2
comma
l_int|0x4243
comma
l_int|0x41b4
comma
l_int|0x3b12
comma
l_int|0x3bc3
comma
l_int|0x3df2
comma
l_int|0x34bd
comma
l_int|0x3334
comma
l_int|0x32c2
comma
l_int|0x3224
comma
l_int|0x31aa
comma
l_int|0x2a7b
comma
l_int|0x2aaa
comma
l_int|0x2b23
comma
l_int|0x2bba
comma
l_int|0x2c42
comma
l_int|0x2e23
comma
l_int|0x25bb
comma
l_int|0x242b
comma
l_int|0x240f
comma
l_int|0x231a
comma
l_int|0x22bb
comma
l_int|0x2241
comma
l_int|0x2223
comma
l_int|0x221f
comma
l_int|0x1a33
comma
l_int|0x1a4a
comma
l_int|0x1acd
comma
l_int|0x2132
comma
l_int|0x1b1b
comma
l_int|0x1b2c
comma
l_int|0x1b62
comma
l_int|0x1c12
comma
l_int|0x1c32
comma
l_int|0x1d1b
comma
l_int|0x1e71
comma
l_int|0x16b1
comma
l_int|0x1522
comma
l_int|0x1434
comma
l_int|0x1412
comma
l_int|0x1352
comma
l_int|0x1323
comma
l_int|0x1315
comma
l_int|0x12bc
comma
l_int|0x127a
comma
l_int|0x1235
comma
l_int|0x1226
comma
l_int|0x11a2
comma
l_int|0x1216
comma
l_int|0x0a2a
comma
l_int|0x11bc
comma
l_int|0x11d1
comma
l_int|0x1163
comma
l_int|0x0ac2
comma
l_int|0x0ab2
comma
l_int|0x0aab
comma
l_int|0x0b1b
comma
l_int|0x0b23
comma
l_int|0x0b33
comma
l_int|0x0c0f
comma
l_int|0x0bb3
comma
l_int|0x0c1b
comma
l_int|0x0c3e
comma
l_int|0x0cb1
comma
l_int|0x0d4c
comma
l_int|0x0ec1
comma
l_int|0x079a
comma
l_int|0x0614
comma
l_int|0x0521
comma
l_int|0x047c
comma
l_int|0x0422
comma
l_int|0x03b1
comma
l_int|0x03e3
comma
l_int|0x0333
comma
l_int|0x0322
comma
l_int|0x031c
comma
l_int|0x02aa
comma
l_int|0x02ba
comma
l_int|0x02f2
comma
l_int|0x0242
comma
l_int|0x0232
comma
l_int|0x0227
comma
l_int|0x0222
comma
l_int|0x021b
comma
l_int|0x01ad
comma
l_int|0x0212
comma
l_int|0x01b2
comma
l_int|0x01bb
comma
l_int|0x01cb
comma
l_int|0x01f6
comma
l_int|0x0152
comma
l_int|0x013a
comma
l_int|0x0133
comma
l_int|0x0131
comma
l_int|0x012c
comma
l_int|0x0123
comma
l_int|0x0122
comma
l_int|0x00a2
comma
l_int|0x011b
comma
l_int|0x011e
comma
l_int|0x0114
comma
l_int|0x00b1
comma
l_int|0x00aa
comma
l_int|0x00b3
comma
l_int|0x00bd
comma
l_int|0x00ba
comma
l_int|0x00c5
comma
l_int|0x00d3
comma
l_int|0x00f3
comma
l_int|0x0062
comma
l_int|0x0051
comma
l_int|0x0042
comma
l_int|0x003b
comma
l_int|0x0033
comma
l_int|0x0032
comma
l_int|0x002a
comma
l_int|0x002c
comma
l_int|0x0025
comma
l_int|0x0023
comma
l_int|0x0022
comma
l_int|0x001a
comma
l_int|0x0021
comma
l_int|0x001b
comma
l_int|0x001b
comma
l_int|0x001d
comma
l_int|0x0015
comma
l_int|0x0013
comma
l_int|0x0013
comma
l_int|0x0012
comma
l_int|0x0012
comma
l_int|0x000a
comma
l_int|0x000a
comma
l_int|0x0011
comma
l_int|0x0011
comma
l_int|0x000b
comma
l_int|0x000b
comma
l_int|0x000c
comma
l_int|0x000e
comma
)brace
suffix:semicolon
DECL|variable|ger_coeff
r_static
id|__const__
id|__u16
id|ger_coeff
(braket
)braket
op_assign
(brace
l_int|0x431f
comma
multiline_comment|/* 5. dB */
l_int|0x331f
comma
multiline_comment|/* 5.5 dB */
l_int|0x40dd
comma
multiline_comment|/* 6. dB */
l_int|0x11dd
comma
multiline_comment|/* 6.5 dB */
l_int|0x440f
comma
multiline_comment|/* 7. dB */
l_int|0x411f
comma
multiline_comment|/* 7.5 dB */
l_int|0x311f
comma
multiline_comment|/* 8. dB */
l_int|0x5520
comma
multiline_comment|/* 8.5 dB */
l_int|0x10dd
comma
multiline_comment|/* 9. dB */
l_int|0x4211
comma
multiline_comment|/* 9.5 dB */
l_int|0x410f
comma
multiline_comment|/* 10. dB */
l_int|0x111f
comma
multiline_comment|/* 10.5 dB */
l_int|0x600b
comma
multiline_comment|/* 11. dB */
l_int|0x00dd
comma
multiline_comment|/* 11.5 dB */
l_int|0x4210
comma
multiline_comment|/* 12. dB */
l_int|0x110f
comma
multiline_comment|/* 13. dB */
l_int|0x7200
comma
multiline_comment|/* 14. dB */
l_int|0x2110
comma
multiline_comment|/* 15. dB */
l_int|0x2200
comma
multiline_comment|/* 15.9 dB */
l_int|0x000b
comma
multiline_comment|/* 16.9 dB */
l_int|0x000f
multiline_comment|/* 18. dB */
)brace
suffix:semicolon
DECL|macro|NR_GER_COEFFS
mdefine_line|#define NR_GER_COEFFS (sizeof(ger_coeff) / sizeof(ger_coeff[0]))
multiline_comment|/* Update amd7930_map settings and program them into the hardware.&n; * The amd-&gt;lock is held and local interrupts are disabled.&n; */
DECL|function|__amd7930_update_map
r_static
r_void
id|__amd7930_update_map
c_func
(paren
id|amd7930_t
op_star
id|amd
)paren
(brace
r_struct
id|amd7930_map
op_star
id|map
op_assign
op_amp
id|amd-&gt;map
suffix:semicolon
r_int
id|level
suffix:semicolon
id|map-&gt;gx
op_assign
id|gx_coeff
(braket
id|amd-&gt;rgain
)braket
suffix:semicolon
id|map-&gt;stgr
op_assign
id|gx_coeff
(braket
id|amd-&gt;mgain
)braket
suffix:semicolon
id|level
op_assign
(paren
id|amd-&gt;pgain
op_star
(paren
l_int|256
op_plus
id|NR_GER_COEFFS
)paren
)paren
op_rshift
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|level
op_ge
l_int|256
)paren
(brace
id|map-&gt;ger
op_assign
id|ger_coeff
(braket
id|level
op_minus
l_int|256
)braket
suffix:semicolon
id|map-&gt;gr
op_assign
id|gx_coeff
(braket
l_int|255
)braket
suffix:semicolon
)brace
r_else
(brace
id|map-&gt;ger
op_assign
id|ger_coeff
(braket
l_int|0
)braket
suffix:semicolon
id|map-&gt;gr
op_assign
id|gx_coeff
(braket
id|level
)braket
suffix:semicolon
)brace
id|__amd7930_write_map
c_func
(paren
id|amd
)paren
suffix:semicolon
)brace
DECL|function|snd_amd7930_interrupt
r_static
id|irqreturn_t
id|snd_amd7930_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|amd7930_t
op_star
id|amd
op_assign
id|dev_id
suffix:semicolon
r_int
r_int
id|elapsed
suffix:semicolon
id|u8
id|ir
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|amd-&gt;lock
)paren
suffix:semicolon
id|elapsed
op_assign
l_int|0
suffix:semicolon
id|ir
op_assign
id|sbus_readb
c_func
(paren
id|amd-&gt;regs
op_plus
id|AMD7930_IR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ir
op_amp
id|AMR_IR_BBUF
)paren
(brace
id|u8
id|byte
suffix:semicolon
r_if
c_cond
(paren
id|amd-&gt;flags
op_amp
id|AMD7930_FLAG_PLAYBACK
)paren
(brace
r_if
c_cond
(paren
id|amd-&gt;p_left
OG
l_int|0
)paren
(brace
id|byte
op_assign
op_star
(paren
id|amd-&gt;p_cur
op_increment
)paren
suffix:semicolon
id|amd-&gt;p_left
op_decrement
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|byte
comma
id|amd-&gt;regs
op_plus
id|AMD7930_BBTB
)paren
suffix:semicolon
r_if
c_cond
(paren
id|amd-&gt;p_left
op_eq
l_int|0
)paren
id|elapsed
op_or_assign
id|AMD7930_FLAG_PLAYBACK
suffix:semicolon
)brace
r_else
id|sbus_writeb
c_func
(paren
l_int|0
comma
id|amd-&gt;regs
op_plus
id|AMD7930_BBTB
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|amd-&gt;flags
op_amp
id|AMD7930_FLAG_CAPTURE
)paren
(brace
id|byte
op_assign
id|sbus_readb
c_func
(paren
id|amd-&gt;regs
op_plus
id|AMD7930_BBRB
)paren
suffix:semicolon
r_if
c_cond
(paren
id|amd-&gt;c_left
OG
l_int|0
)paren
(brace
op_star
(paren
id|amd-&gt;c_cur
op_increment
)paren
op_assign
id|byte
suffix:semicolon
id|amd-&gt;c_left
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|amd-&gt;c_left
op_eq
l_int|0
)paren
id|elapsed
op_or_assign
id|AMD7930_FLAG_CAPTURE
suffix:semicolon
)brace
)brace
)brace
id|spin_unlock
c_func
(paren
op_amp
id|amd-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|elapsed
op_amp
id|AMD7930_FLAG_PLAYBACK
)paren
id|snd_pcm_period_elapsed
c_func
(paren
id|amd-&gt;playback_substream
)paren
suffix:semicolon
r_else
id|snd_pcm_period_elapsed
c_func
(paren
id|amd-&gt;capture_substream
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|snd_amd7930_trigger
r_static
r_int
id|snd_amd7930_trigger
c_func
(paren
id|amd7930_t
op_star
id|amd
comma
r_int
r_int
id|flag
comma
r_int
id|cmd
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|result
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|amd-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_START
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|amd-&gt;flags
op_amp
id|flag
)paren
)paren
(brace
id|amd-&gt;flags
op_or_assign
id|flag
suffix:semicolon
multiline_comment|/* Enable B channel interrupts.  */
id|sbus_writeb
c_func
(paren
id|AMR_MUX_MCR4
comma
id|amd-&gt;regs
op_plus
id|AMD7930_CR
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|AM_MUX_MCR4_ENABLE_INTS
comma
id|amd-&gt;regs
op_plus
id|AMD7930_DR
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|cmd
op_eq
id|SNDRV_PCM_TRIGGER_STOP
)paren
(brace
r_if
c_cond
(paren
id|amd-&gt;flags
op_amp
id|flag
)paren
(brace
id|amd-&gt;flags
op_and_assign
op_complement
id|flag
suffix:semicolon
multiline_comment|/* Disable B channel interrupts.  */
id|sbus_writeb
c_func
(paren
id|AMR_MUX_MCR4
comma
id|amd-&gt;regs
op_plus
id|AMD7930_CR
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
l_int|0
comma
id|amd-&gt;regs
op_plus
id|AMD7930_DR
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|result
op_assign
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|amd-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|snd_amd7930_playback_trigger
r_static
r_int
id|snd_amd7930_playback_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|amd7930_t
op_star
id|amd
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|snd_amd7930_trigger
c_func
(paren
id|amd
comma
id|AMD7930_FLAG_PLAYBACK
comma
id|cmd
)paren
suffix:semicolon
)brace
DECL|function|snd_amd7930_capture_trigger
r_static
r_int
id|snd_amd7930_capture_trigger
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
r_int
id|cmd
)paren
(brace
id|amd7930_t
op_star
id|amd
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_return
id|snd_amd7930_trigger
c_func
(paren
id|amd
comma
id|AMD7930_FLAG_CAPTURE
comma
id|cmd
)paren
suffix:semicolon
)brace
DECL|function|snd_amd7930_playback_prepare
r_static
r_int
id|snd_amd7930_playback_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|amd7930_t
op_star
id|amd
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
r_int
id|size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u8
id|new_mmr1
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|amd-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|amd-&gt;flags
op_or_assign
id|AMD7930_FLAG_PLAYBACK
suffix:semicolon
multiline_comment|/* Setup the pseudo-dma transfer pointers.  */
id|amd-&gt;p_orig
op_assign
id|amd-&gt;p_cur
op_assign
id|runtime-&gt;dma_area
suffix:semicolon
id|amd-&gt;p_left
op_assign
id|size
suffix:semicolon
multiline_comment|/* Put the chip into the correct encoding format.  */
id|new_mmr1
op_assign
id|amd-&gt;map.mmr1
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;format
op_eq
id|SNDRV_PCM_FORMAT_A_LAW
)paren
id|new_mmr1
op_or_assign
id|AM_MAP_MMR1_ALAW
suffix:semicolon
r_else
id|new_mmr1
op_and_assign
op_complement
id|AM_MAP_MMR1_ALAW
suffix:semicolon
r_if
c_cond
(paren
id|new_mmr1
op_ne
id|amd-&gt;map.mmr1
)paren
(brace
id|amd-&gt;map.mmr1
op_assign
id|new_mmr1
suffix:semicolon
id|__amd7930_update_map
c_func
(paren
id|amd
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|amd-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_amd7930_capture_prepare
r_static
r_int
id|snd_amd7930_capture_prepare
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|amd7930_t
op_star
id|amd
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
r_int
r_int
id|size
op_assign
id|snd_pcm_lib_buffer_bytes
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u8
id|new_mmr1
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|amd-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|amd-&gt;flags
op_or_assign
id|AMD7930_FLAG_CAPTURE
suffix:semicolon
multiline_comment|/* Setup the pseudo-dma transfer pointers.  */
id|amd-&gt;c_orig
op_assign
id|amd-&gt;c_cur
op_assign
id|runtime-&gt;dma_area
suffix:semicolon
id|amd-&gt;c_left
op_assign
id|size
suffix:semicolon
multiline_comment|/* Put the chip into the correct encoding format.  */
id|new_mmr1
op_assign
id|amd-&gt;map.mmr1
suffix:semicolon
r_if
c_cond
(paren
id|runtime-&gt;format
op_eq
id|SNDRV_PCM_FORMAT_A_LAW
)paren
id|new_mmr1
op_or_assign
id|AM_MAP_MMR1_ALAW
suffix:semicolon
r_else
id|new_mmr1
op_and_assign
op_complement
id|AM_MAP_MMR1_ALAW
suffix:semicolon
r_if
c_cond
(paren
id|new_mmr1
op_ne
id|amd-&gt;map.mmr1
)paren
(brace
id|amd-&gt;map.mmr1
op_assign
id|new_mmr1
suffix:semicolon
id|__amd7930_update_map
c_func
(paren
id|amd
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|amd-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_amd7930_playback_pointer
r_static
id|snd_pcm_uframes_t
id|snd_amd7930_playback_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|amd7930_t
op_star
id|amd
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|amd-&gt;flags
op_amp
id|AMD7930_FLAG_PLAYBACK
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|ptr
op_assign
id|amd-&gt;p_cur
op_minus
id|amd-&gt;p_orig
suffix:semicolon
r_return
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|ptr
)paren
suffix:semicolon
)brace
DECL|function|snd_amd7930_capture_pointer
r_static
id|snd_pcm_uframes_t
id|snd_amd7930_capture_pointer
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|amd7930_t
op_star
id|amd
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
r_int
id|ptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|amd-&gt;flags
op_amp
id|AMD7930_FLAG_CAPTURE
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|ptr
op_assign
id|amd-&gt;c_cur
op_minus
id|amd-&gt;c_orig
suffix:semicolon
r_return
id|bytes_to_frames
c_func
(paren
id|substream-&gt;runtime
comma
id|ptr
)paren
suffix:semicolon
)brace
multiline_comment|/* Playback and capture have identical properties.  */
DECL|variable|snd_amd7930_pcm_hw
r_static
id|snd_pcm_hardware_t
id|snd_amd7930_pcm_hw
op_assign
(brace
dot
id|info
op_assign
(paren
id|SNDRV_PCM_INFO_MMAP
op_or
id|SNDRV_PCM_INFO_MMAP_VALID
op_or
id|SNDRV_PCM_INFO_INTERLEAVED
op_or
id|SNDRV_PCM_INFO_BLOCK_TRANSFER
op_or
id|SNDRV_PCM_INFO_HALF_DUPLEX
)paren
comma
dot
id|formats
op_assign
id|SNDRV_PCM_FMTBIT_MU_LAW
op_or
id|SNDRV_PCM_FMTBIT_A_LAW
comma
dot
id|rates
op_assign
id|SNDRV_PCM_RATE_8000
comma
dot
id|rate_min
op_assign
l_int|8000
comma
dot
id|rate_max
op_assign
l_int|8000
comma
dot
id|channels_min
op_assign
l_int|1
comma
dot
id|channels_max
op_assign
l_int|1
comma
dot
id|buffer_bytes_max
op_assign
(paren
l_int|64
op_star
l_int|1024
)paren
comma
dot
id|period_bytes_min
op_assign
l_int|1
comma
dot
id|period_bytes_max
op_assign
(paren
l_int|64
op_star
l_int|1024
)paren
comma
dot
id|periods_min
op_assign
l_int|1
comma
dot
id|periods_max
op_assign
l_int|1024
comma
)brace
suffix:semicolon
DECL|function|snd_amd7930_playback_open
r_static
r_int
id|snd_amd7930_playback_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|amd7930_t
op_star
id|amd
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|amd-&gt;playback_substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_amd7930_pcm_hw
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_amd7930_capture_open
r_static
r_int
id|snd_amd7930_capture_open
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|amd7930_t
op_star
id|amd
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|snd_pcm_runtime_t
op_star
id|runtime
op_assign
id|substream-&gt;runtime
suffix:semicolon
id|amd-&gt;capture_substream
op_assign
id|substream
suffix:semicolon
id|runtime-&gt;hw
op_assign
id|snd_amd7930_pcm_hw
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_amd7930_playback_close
r_static
r_int
id|snd_amd7930_playback_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|amd7930_t
op_star
id|amd
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|amd-&gt;playback_substream
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_amd7930_capture_close
r_static
r_int
id|snd_amd7930_capture_close
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
id|amd7930_t
op_star
id|amd
op_assign
id|snd_pcm_substream_chip
c_func
(paren
id|substream
)paren
suffix:semicolon
id|amd-&gt;capture_substream
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_amd7930_hw_params
r_static
r_int
id|snd_amd7930_hw_params
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
comma
id|snd_pcm_hw_params_t
op_star
id|hw_params
)paren
(brace
r_return
id|snd_pcm_lib_malloc_pages
c_func
(paren
id|substream
comma
id|params_buffer_bytes
c_func
(paren
id|hw_params
)paren
)paren
suffix:semicolon
)brace
DECL|function|snd_amd7930_hw_free
r_static
r_int
id|snd_amd7930_hw_free
c_func
(paren
id|snd_pcm_substream_t
op_star
id|substream
)paren
(brace
r_return
id|snd_pcm_lib_free_pages
c_func
(paren
id|substream
)paren
suffix:semicolon
)brace
DECL|variable|snd_amd7930_playback_ops
r_static
id|snd_pcm_ops_t
id|snd_amd7930_playback_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_amd7930_playback_open
comma
dot
id|close
op_assign
id|snd_amd7930_playback_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_amd7930_hw_params
comma
dot
id|hw_free
op_assign
id|snd_amd7930_hw_free
comma
dot
id|prepare
op_assign
id|snd_amd7930_playback_prepare
comma
dot
id|trigger
op_assign
id|snd_amd7930_playback_trigger
comma
dot
id|pointer
op_assign
id|snd_amd7930_playback_pointer
comma
)brace
suffix:semicolon
DECL|variable|snd_amd7930_capture_ops
r_static
id|snd_pcm_ops_t
id|snd_amd7930_capture_ops
op_assign
(brace
dot
id|open
op_assign
id|snd_amd7930_capture_open
comma
dot
id|close
op_assign
id|snd_amd7930_capture_close
comma
dot
id|ioctl
op_assign
id|snd_pcm_lib_ioctl
comma
dot
id|hw_params
op_assign
id|snd_amd7930_hw_params
comma
dot
id|hw_free
op_assign
id|snd_amd7930_hw_free
comma
dot
id|prepare
op_assign
id|snd_amd7930_capture_prepare
comma
dot
id|trigger
op_assign
id|snd_amd7930_capture_trigger
comma
dot
id|pointer
op_assign
id|snd_amd7930_capture_pointer
comma
)brace
suffix:semicolon
DECL|function|snd_amd7930_pcm_free
r_static
r_void
id|snd_amd7930_pcm_free
c_func
(paren
id|snd_pcm_t
op_star
id|pcm
)paren
(brace
id|amd7930_t
op_star
id|amd
op_assign
id|snd_magic_cast
c_func
(paren
id|amd7930_t
comma
id|pcm-&gt;private_data
comma
r_return
)paren
suffix:semicolon
id|amd-&gt;pcm
op_assign
l_int|NULL
suffix:semicolon
id|snd_pcm_lib_preallocate_free_for_all
c_func
(paren
id|pcm
)paren
suffix:semicolon
)brace
DECL|function|snd_amd7930_pcm
r_static
r_int
id|__init
id|snd_amd7930_pcm
c_func
(paren
id|amd7930_t
op_star
id|amd
)paren
(brace
id|snd_pcm_t
op_star
id|pcm
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pcm_new
c_func
(paren
id|amd-&gt;card
comma
multiline_comment|/* ID */
l_string|&quot;sun_amd7930&quot;
comma
multiline_comment|/* device */
l_int|0
comma
multiline_comment|/* playback count */
l_int|1
comma
multiline_comment|/* capture count */
l_int|1
comma
op_amp
id|pcm
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|snd_assert
c_func
(paren
id|pcm
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_PLAYBACK
comma
op_amp
id|snd_amd7930_playback_ops
)paren
suffix:semicolon
id|snd_pcm_set_ops
c_func
(paren
id|pcm
comma
id|SNDRV_PCM_STREAM_CAPTURE
comma
op_amp
id|snd_amd7930_capture_ops
)paren
suffix:semicolon
id|pcm-&gt;private_data
op_assign
id|amd
suffix:semicolon
id|pcm-&gt;private_free
op_assign
id|snd_amd7930_pcm_free
suffix:semicolon
id|pcm-&gt;info_flags
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|pcm-&gt;name
comma
id|amd-&gt;card-&gt;shortname
)paren
suffix:semicolon
id|amd-&gt;pcm
op_assign
id|pcm
suffix:semicolon
id|snd_pcm_lib_preallocate_pages_for_all
c_func
(paren
id|pcm
comma
l_int|64
op_star
l_int|1024
comma
l_int|64
op_star
l_int|1024
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|VOLUME_MONITOR
mdefine_line|#define VOLUME_MONITOR&t;0
DECL|macro|VOLUME_CAPTURE
mdefine_line|#define VOLUME_CAPTURE&t;1
DECL|macro|VOLUME_PLAYBACK
mdefine_line|#define VOLUME_PLAYBACK&t;2
DECL|function|snd_amd7930_info_volume
r_static
r_int
id|snd_amd7930_info_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kctl
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_int
id|type
op_assign
id|kctl-&gt;private_value
suffix:semicolon
id|snd_assert
c_func
(paren
id|type
op_eq
id|VOLUME_MONITOR
op_logical_or
id|type
op_eq
id|VOLUME_CAPTURE
op_logical_or
id|type
op_eq
id|VOLUME_PLAYBACK
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
(paren
r_void
)paren
id|type
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|255
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_amd7930_get_volume
r_static
r_int
id|snd_amd7930_get_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kctl
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|amd7930_t
op_star
id|amd
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kctl
)paren
suffix:semicolon
r_int
id|type
op_assign
id|kctl-&gt;private_value
suffix:semicolon
r_int
op_star
id|swval
suffix:semicolon
id|snd_assert
c_func
(paren
id|type
op_eq
id|VOLUME_MONITOR
op_logical_or
id|type
op_eq
id|VOLUME_CAPTURE
op_logical_or
id|type
op_eq
id|VOLUME_PLAYBACK
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|VOLUME_MONITOR
suffix:colon
id|swval
op_assign
op_amp
id|amd-&gt;mgain
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VOLUME_CAPTURE
suffix:colon
id|swval
op_assign
op_amp
id|amd-&gt;rgain
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VOLUME_PLAYBACK
suffix:colon
r_default
suffix:colon
id|swval
op_assign
op_amp
id|amd-&gt;pgain
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
op_star
id|swval
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_amd7930_put_volume
r_static
r_int
id|snd_amd7930_put_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kctl
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|amd7930_t
op_star
id|amd
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kctl
)paren
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|type
op_assign
id|kctl-&gt;private_value
suffix:semicolon
r_int
op_star
id|swval
comma
id|change
suffix:semicolon
id|snd_assert
c_func
(paren
id|type
op_eq
id|VOLUME_MONITOR
op_logical_or
id|type
op_eq
id|VOLUME_CAPTURE
op_logical_or
id|type
op_eq
id|VOLUME_PLAYBACK
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|VOLUME_MONITOR
suffix:colon
id|swval
op_assign
op_amp
id|amd-&gt;mgain
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VOLUME_CAPTURE
suffix:colon
id|swval
op_assign
op_amp
id|amd-&gt;rgain
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VOLUME_PLAYBACK
suffix:colon
r_default
suffix:colon
id|swval
op_assign
op_amp
id|amd-&gt;pgain
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|amd-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|swval
op_ne
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
(brace
op_star
id|swval
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
suffix:semicolon
id|__amd7930_update_map
c_func
(paren
id|amd
)paren
suffix:semicolon
id|change
op_assign
l_int|1
suffix:semicolon
)brace
r_else
id|change
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|amd-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|change
suffix:semicolon
)brace
DECL|variable|__initdata
r_static
id|snd_kcontrol_new_t
id|amd7930_controls
(braket
)braket
id|__initdata
op_assign
(brace
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Monitor Volume&quot;
comma
dot
id|index
op_assign
l_int|0
comma
dot
id|info
op_assign
id|snd_amd7930_info_volume
comma
dot
id|get
op_assign
id|snd_amd7930_get_volume
comma
dot
id|put
op_assign
id|snd_amd7930_put_volume
comma
dot
id|private_value
op_assign
id|VOLUME_MONITOR
comma
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Capture Volume&quot;
comma
dot
id|index
op_assign
l_int|0
comma
dot
id|info
op_assign
id|snd_amd7930_info_volume
comma
dot
id|get
op_assign
id|snd_amd7930_get_volume
comma
dot
id|put
op_assign
id|snd_amd7930_put_volume
comma
dot
id|private_value
op_assign
id|VOLUME_CAPTURE
comma
)brace
comma
(brace
dot
id|iface
op_assign
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
dot
id|name
op_assign
l_string|&quot;Playback Volume&quot;
comma
dot
id|index
op_assign
l_int|0
comma
dot
id|info
op_assign
id|snd_amd7930_info_volume
comma
dot
id|get
op_assign
id|snd_amd7930_get_volume
comma
dot
id|put
op_assign
id|snd_amd7930_put_volume
comma
dot
id|private_value
op_assign
id|VOLUME_PLAYBACK
comma
)brace
comma
)brace
suffix:semicolon
DECL|macro|NUM_AMD7930_CONTROLS
mdefine_line|#define NUM_AMD7930_CONTROLS (sizeof(amd7930_controls)/sizeof(snd_kcontrol_new_t))
DECL|function|snd_amd7930_mixer
r_static
r_int
id|__init
id|snd_amd7930_mixer
c_func
(paren
id|amd7930_t
op_star
id|amd
)paren
(brace
id|snd_card_t
op_star
id|card
suffix:semicolon
r_int
id|idx
comma
id|err
suffix:semicolon
id|snd_assert
c_func
(paren
id|amd
op_ne
l_int|NULL
op_logical_and
id|amd-&gt;card
op_ne
l_int|NULL
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|card
op_assign
id|amd-&gt;card
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;mixername
comma
id|card-&gt;shortname
)paren
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|NUM_AMD7930_CONTROLS
suffix:semicolon
id|idx
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|amd7930_controls
(braket
id|idx
)braket
comma
id|amd
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_amd7930_free
r_static
r_int
id|snd_amd7930_free
c_func
(paren
id|amd7930_t
op_star
id|amd
)paren
(brace
id|amd7930_idle
c_func
(paren
id|amd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|amd-&gt;irq
)paren
id|free_irq
c_func
(paren
id|amd-&gt;irq
comma
id|amd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|amd-&gt;regs
)paren
id|sbus_iounmap
c_func
(paren
id|amd-&gt;regs
comma
id|amd-&gt;regs_size
)paren
suffix:semicolon
id|snd_magic_kfree
c_func
(paren
id|amd
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_amd7930_dev_free
r_static
r_int
id|snd_amd7930_dev_free
c_func
(paren
id|snd_device_t
op_star
id|device
)paren
(brace
id|amd7930_t
op_star
id|amd
op_assign
id|snd_magic_cast
c_func
(paren
id|amd7930_t
comma
id|device-&gt;device_data
comma
r_return
op_minus
id|ENXIO
)paren
suffix:semicolon
r_return
id|snd_amd7930_free
c_func
(paren
id|amd
)paren
suffix:semicolon
)brace
DECL|variable|snd_amd7930_dev_ops
r_static
id|snd_device_ops_t
id|snd_amd7930_dev_ops
op_assign
(brace
dot
id|dev_free
op_assign
id|snd_amd7930_dev_free
comma
)brace
suffix:semicolon
DECL|function|snd_amd7930_create
r_static
r_int
id|__init
id|snd_amd7930_create
c_func
(paren
id|snd_card_t
op_star
id|card
comma
r_struct
id|sbus_dev
op_star
id|sdev
comma
r_struct
id|resource
op_star
id|rp
comma
r_int
r_int
id|reg_size
comma
r_struct
id|linux_prom_irqs
op_star
id|irq_prop
comma
r_int
id|dev
comma
id|amd7930_t
op_star
op_star
id|ramd
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|amd7930_t
op_star
id|amd
suffix:semicolon
r_int
id|err
suffix:semicolon
op_star
id|ramd
op_assign
l_int|NULL
suffix:semicolon
id|amd
op_assign
id|snd_magic_kcalloc
c_func
(paren
id|amd7930_t
comma
l_int|0
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|amd
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|amd-&gt;lock
)paren
suffix:semicolon
id|amd-&gt;card
op_assign
id|card
suffix:semicolon
id|amd-&gt;sdev
op_assign
id|sdev
suffix:semicolon
id|amd-&gt;regs_size
op_assign
id|reg_size
suffix:semicolon
id|amd-&gt;regs
op_assign
id|sbus_ioremap
c_func
(paren
id|rp
comma
l_int|0
comma
id|amd-&gt;regs_size
comma
l_string|&quot;amd7930&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|amd-&gt;regs
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;amd7930-%d: Unable to map chip registers.&bslash;n&quot;
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|amd7930_idle
c_func
(paren
id|amd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|irq_prop-&gt;pri
comma
id|snd_amd7930_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
l_string|&quot;amd7930&quot;
comma
id|amd
)paren
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;amd7930-%d: Unable to grab IRQ %s&bslash;n&quot;
comma
id|dev
comma
id|__irq_itoa
c_func
(paren
id|irq_prop-&gt;pri
)paren
)paren
suffix:semicolon
id|snd_amd7930_free
c_func
(paren
id|amd
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|amd-&gt;irq
op_assign
id|irq_prop-&gt;pri
suffix:semicolon
id|amd7930_enable_ints
c_func
(paren
id|amd
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|amd-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|amd-&gt;rgain
op_assign
l_int|128
suffix:semicolon
id|amd-&gt;pgain
op_assign
l_int|200
suffix:semicolon
id|amd-&gt;mgain
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|amd-&gt;map
comma
l_int|0
comma
r_sizeof
(paren
id|amd-&gt;map
)paren
)paren
suffix:semicolon
id|amd-&gt;map.mmr1
op_assign
(paren
id|AM_MAP_MMR1_GX
op_or
id|AM_MAP_MMR1_GER
op_or
id|AM_MAP_MMR1_GR
op_or
id|AM_MAP_MMR1_STG
)paren
suffix:semicolon
id|amd-&gt;map.mmr2
op_assign
(paren
id|AM_MAP_MMR2_LS
op_or
id|AM_MAP_MMR2_AINB
)paren
suffix:semicolon
id|__amd7930_update_map
c_func
(paren
id|amd
)paren
suffix:semicolon
multiline_comment|/* Always MUX audio (Ba) to channel Bb. */
id|sbus_writeb
c_func
(paren
id|AMR_MUX_MCR1
comma
id|amd-&gt;regs
op_plus
id|AMD7930_CR
)paren
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|AM_MUX_CHANNEL_Ba
op_or
(paren
id|AM_MUX_CHANNEL_Bb
op_lshift
l_int|4
)paren
comma
id|amd-&gt;regs
op_plus
id|AMD7930_DR
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|amd-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_device_new
c_func
(paren
id|card
comma
id|SNDRV_DEV_LOWLEVEL
comma
id|amd
comma
op_amp
id|snd_amd7930_dev_ops
)paren
)paren
OL
l_int|0
)paren
(brace
id|snd_amd7930_free
c_func
(paren
id|amd
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
op_star
id|ramd
op_assign
id|amd
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|amd7930_attach
r_static
r_int
id|__init
id|amd7930_attach
c_func
(paren
r_int
id|prom_node
comma
r_struct
id|sbus_dev
op_star
id|sdev
)paren
(brace
r_static
r_int
id|dev
suffix:semicolon
r_struct
id|linux_prom_registers
id|reg_prop
suffix:semicolon
r_struct
id|linux_prom_irqs
id|irq_prop
suffix:semicolon
r_struct
id|resource
id|res
comma
op_star
id|rp
suffix:semicolon
id|snd_card_t
op_star
id|card
suffix:semicolon
id|amd7930_t
op_star
id|amd
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_ge
id|SNDRV_CARDS
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|enable
(braket
id|dev
)braket
)paren
(brace
id|dev
op_increment
suffix:semicolon
r_return
op_minus
id|ENOENT
suffix:semicolon
)brace
id|err
op_assign
id|prom_getproperty
c_func
(paren
id|prom_node
comma
l_string|&quot;intr&quot;
comma
(paren
r_char
op_star
)paren
op_amp
id|irq_prop
comma
r_sizeof
(paren
id|irq_prop
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;amd7930-%d: Firmware node lacks IRQ property.&bslash;n&quot;
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|err
op_assign
id|prom_getproperty
c_func
(paren
id|prom_node
comma
l_string|&quot;reg&quot;
comma
(paren
r_char
op_star
)paren
op_amp
id|reg_prop
comma
r_sizeof
(paren
id|reg_prop
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|snd_printk
c_func
(paren
l_string|&quot;amd7930-%d: Firmware node lacks register property.&bslash;n&quot;
comma
id|dev
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sdev
)paren
(brace
id|rp
op_assign
op_amp
id|sdev-&gt;resource
(braket
l_int|0
)braket
suffix:semicolon
)brace
r_else
(brace
id|rp
op_assign
op_amp
id|res
suffix:semicolon
id|rp-&gt;start
op_assign
id|reg_prop.phys_addr
suffix:semicolon
id|rp-&gt;end
op_assign
id|rp-&gt;start
op_plus
id|reg_prop.reg_size
op_minus
l_int|1
suffix:semicolon
id|rp-&gt;flags
op_assign
id|IORESOURCE_IO
op_or
(paren
id|reg_prop.which_io
op_amp
l_int|0xff
)paren
suffix:semicolon
)brace
id|card
op_assign
id|snd_card_new
c_func
(paren
id|index
(braket
id|dev
)braket
comma
id|id
(braket
id|dev
)braket
comma
id|THIS_MODULE
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;driver
comma
l_string|&quot;AMD7930&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|card-&gt;shortname
comma
l_string|&quot;Sun AMD7930&quot;
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;longname
comma
l_string|&quot;%s at 0x%02lx:0x%08lx, irq %s&quot;
comma
id|card-&gt;shortname
comma
id|rp-&gt;flags
op_amp
l_int|0xffL
comma
id|rp-&gt;start
comma
id|__irq_itoa
c_func
(paren
id|irq_prop.pri
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_amd7930_create
c_func
(paren
id|card
comma
id|sdev
comma
id|rp
comma
id|reg_prop.reg_size
comma
op_amp
id|irq_prop
comma
id|dev
comma
op_amp
id|amd
)paren
)paren
OL
l_int|0
)paren
r_goto
id|out_err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_amd7930_pcm
c_func
(paren
id|amd
)paren
)paren
OL
l_int|0
)paren
r_goto
id|out_err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_amd7930_mixer
c_func
(paren
id|amd
)paren
)paren
OL
l_int|0
)paren
r_goto
id|out_err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_card_register
c_func
(paren
id|card
)paren
)paren
OL
l_int|0
)paren
r_goto
id|out_err
suffix:semicolon
id|amd-&gt;next
op_assign
id|amd7930_list
suffix:semicolon
id|amd7930_list
op_assign
id|amd
suffix:semicolon
id|dev
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out_err
suffix:colon
id|snd_card_free
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|amd7930_init
r_static
r_int
id|__init
id|amd7930_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|sbus_bus
op_star
id|sbus
suffix:semicolon
r_struct
id|sbus_dev
op_star
id|sdev
suffix:semicolon
r_int
id|node
comma
id|found
suffix:semicolon
id|found
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Try to find the sun4c &quot;audio&quot; node first. */
id|node
op_assign
id|prom_getchild
c_func
(paren
id|prom_root_node
)paren
suffix:semicolon
id|node
op_assign
id|prom_searchsiblings
c_func
(paren
id|node
comma
l_string|&quot;audio&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|node
op_logical_and
id|amd7930_attach
c_func
(paren
id|node
comma
l_int|NULL
)paren
op_eq
l_int|0
)paren
id|found
op_increment
suffix:semicolon
multiline_comment|/* Probe each SBUS for amd7930 chips. */
id|for_all_sbusdev
c_func
(paren
id|sdev
comma
id|sbus
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|sdev-&gt;prom_name
comma
l_string|&quot;audio&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
id|amd7930_attach
c_func
(paren
id|sdev-&gt;prom_node
comma
id|sdev
)paren
op_eq
l_int|0
)paren
id|found
op_increment
suffix:semicolon
)brace
)brace
r_return
(paren
id|found
OG
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
op_minus
id|EIO
suffix:semicolon
)brace
DECL|function|amd7930_exit
r_static
r_void
id|__exit
id|amd7930_exit
c_func
(paren
r_void
)paren
(brace
id|amd7930_t
op_star
id|p
op_assign
id|amd7930_list
suffix:semicolon
r_while
c_loop
(paren
id|p
op_ne
l_int|NULL
)paren
(brace
id|amd7930_t
op_star
id|next
op_assign
id|p-&gt;next
suffix:semicolon
id|snd_card_free
c_func
(paren
id|p-&gt;card
)paren
suffix:semicolon
id|p
op_assign
id|next
suffix:semicolon
)brace
id|amd7930_list
op_assign
l_int|NULL
suffix:semicolon
)brace
DECL|variable|amd7930_init
id|module_init
c_func
(paren
id|amd7930_init
)paren
suffix:semicolon
DECL|variable|amd7930_exit
id|module_exit
c_func
(paren
id|amd7930_exit
)paren
suffix:semicolon
macro_line|#ifndef MODULE
multiline_comment|/* format is: snd-sun-amd7930=index,id,enable */
DECL|function|alsa_card_sun_amd7930_setup
r_static
r_int
id|__init
id|alsa_card_sun_amd7930_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_static
r_int
id|__initdata
id|nr_dev
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|nr_dev
op_ge
id|SNDRV_CARDS
)paren
r_return
l_int|0
suffix:semicolon
(paren
r_void
)paren
(paren
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|index
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|id
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
op_logical_and
id|get_id
c_func
(paren
op_amp
id|str
comma
op_amp
id|enable
(braket
id|nr_dev
)braket
)paren
op_eq
l_int|2
)paren
suffix:semicolon
id|nr_dev
op_increment
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;snd-sun-amd7930=&quot;
comma
id|alsa_card_sun_amd7930_setup
)paren
suffix:semicolon
macro_line|#endif /* ifndef MODULE */
eof
