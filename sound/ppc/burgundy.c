multiline_comment|/*&n; * PMac Burgundy lowlevel functions&n; *&n; * Copyright (c) by Takashi Iwai &lt;tiwai@suse.de&gt;&n; * code based on dmasound.c.&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; */
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &quot;pmac.h&quot;
macro_line|#include &quot;burgundy.h&quot;
DECL|macro|chip_t
mdefine_line|#define chip_t pmac_t
multiline_comment|/* Waits for busy flag to clear */
r_inline
r_static
r_void
DECL|function|snd_pmac_burgundy_busy_wait
id|snd_pmac_burgundy_busy_wait
c_func
(paren
id|pmac_t
op_star
id|chip
)paren
(brace
r_while
c_loop
(paren
id|in_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_ctrl
)paren
op_amp
id|MASK_NEWECMD
)paren
suffix:semicolon
)brace
r_inline
r_static
r_void
DECL|function|snd_pmac_burgundy_extend_wait
id|snd_pmac_burgundy_extend_wait
c_func
(paren
id|pmac_t
op_star
id|chip
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|in_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_stat
)paren
op_amp
id|MASK_EXTEND
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|in_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_stat
)paren
op_amp
id|MASK_EXTEND
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|snd_pmac_burgundy_wcw
id|snd_pmac_burgundy_wcw
c_func
(paren
id|pmac_t
op_star
id|chip
comma
r_int
id|addr
comma
r_int
id|val
)paren
(brace
id|out_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_ctrl
comma
id|addr
op_plus
l_int|0x200c00
op_plus
(paren
id|val
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|snd_pmac_burgundy_busy_wait
c_func
(paren
id|chip
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_ctrl
comma
id|addr
op_plus
l_int|0x200d00
op_plus
(paren
(paren
id|val
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|snd_pmac_burgundy_busy_wait
c_func
(paren
id|chip
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_ctrl
comma
id|addr
op_plus
l_int|0x200e00
op_plus
(paren
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|snd_pmac_burgundy_busy_wait
c_func
(paren
id|chip
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_ctrl
comma
id|addr
op_plus
l_int|0x200f00
op_plus
(paren
(paren
id|val
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|snd_pmac_burgundy_busy_wait
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|snd_pmac_burgundy_rcw
id|snd_pmac_burgundy_rcw
c_func
(paren
id|pmac_t
op_star
id|chip
comma
r_int
id|addr
)paren
(brace
r_int
id|val
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* should have timeouts here */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_ctrl
comma
id|addr
op_plus
l_int|0x100000
)paren
suffix:semicolon
id|snd_pmac_burgundy_busy_wait
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_pmac_burgundy_extend_wait
c_func
(paren
id|chip
)paren
suffix:semicolon
id|val
op_add_assign
(paren
id|in_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_stat
)paren
op_rshift
l_int|4
)paren
op_amp
l_int|0xff
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_ctrl
comma
id|addr
op_plus
l_int|0x100100
)paren
suffix:semicolon
id|snd_pmac_burgundy_busy_wait
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_pmac_burgundy_extend_wait
c_func
(paren
id|chip
)paren
suffix:semicolon
id|val
op_add_assign
(paren
(paren
id|in_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_stat
)paren
op_rshift
l_int|4
)paren
op_amp
l_int|0xff
)paren
op_lshift
l_int|8
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_ctrl
comma
id|addr
op_plus
l_int|0x100200
)paren
suffix:semicolon
id|snd_pmac_burgundy_busy_wait
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_pmac_burgundy_extend_wait
c_func
(paren
id|chip
)paren
suffix:semicolon
id|val
op_add_assign
(paren
(paren
id|in_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_stat
)paren
op_rshift
l_int|4
)paren
op_amp
l_int|0xff
)paren
op_lshift
l_int|16
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_ctrl
comma
id|addr
op_plus
l_int|0x100300
)paren
suffix:semicolon
id|snd_pmac_burgundy_busy_wait
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_pmac_burgundy_extend_wait
c_func
(paren
id|chip
)paren
suffix:semicolon
id|val
op_add_assign
(paren
(paren
id|in_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_stat
)paren
op_rshift
l_int|4
)paren
op_amp
l_int|0xff
)paren
op_lshift
l_int|24
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
r_static
r_void
DECL|function|snd_pmac_burgundy_wcb
id|snd_pmac_burgundy_wcb
c_func
(paren
id|pmac_t
op_star
id|chip
comma
r_int
r_int
id|addr
comma
r_int
r_int
id|val
)paren
(brace
id|out_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_ctrl
comma
id|addr
op_plus
l_int|0x300000
op_plus
(paren
id|val
op_amp
l_int|0xff
)paren
)paren
suffix:semicolon
id|snd_pmac_burgundy_busy_wait
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|snd_pmac_burgundy_rcb
id|snd_pmac_burgundy_rcb
c_func
(paren
id|pmac_t
op_star
id|chip
comma
r_int
r_int
id|addr
)paren
(brace
r_int
id|val
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
multiline_comment|/* should have timeouts here */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|out_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_ctrl
comma
id|addr
op_plus
l_int|0x100000
)paren
suffix:semicolon
id|snd_pmac_burgundy_busy_wait
c_func
(paren
id|chip
)paren
suffix:semicolon
id|snd_pmac_burgundy_extend_wait
c_func
(paren
id|chip
)paren
suffix:semicolon
id|val
op_add_assign
(paren
id|in_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_stat
)paren
op_rshift
l_int|4
)paren
op_amp
l_int|0xff
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
multiline_comment|/*&n; * Burgundy volume: 0 - 100, stereo&n; */
r_static
r_void
DECL|function|snd_pmac_burgundy_write_volume
id|snd_pmac_burgundy_write_volume
c_func
(paren
id|pmac_t
op_star
id|chip
comma
r_int
r_int
id|address
comma
r_int
op_star
id|volume
comma
r_int
id|shift
)paren
(brace
r_int
id|hardvolume
comma
id|lvolume
comma
id|rvolume
suffix:semicolon
id|lvolume
op_assign
id|volume
(braket
l_int|0
)braket
ques
c_cond
id|volume
(braket
l_int|0
)braket
op_plus
id|BURGUNDY_VOLUME_OFFSET
suffix:colon
l_int|0
suffix:semicolon
id|rvolume
op_assign
id|volume
(braket
l_int|1
)braket
ques
c_cond
id|volume
(braket
l_int|1
)braket
op_plus
id|BURGUNDY_VOLUME_OFFSET
suffix:colon
l_int|0
suffix:semicolon
id|hardvolume
op_assign
id|lvolume
op_plus
(paren
id|rvolume
op_lshift
id|shift
)paren
suffix:semicolon
r_if
c_cond
(paren
id|shift
op_eq
l_int|8
)paren
id|hardvolume
op_or_assign
id|hardvolume
op_lshift
l_int|16
suffix:semicolon
id|snd_pmac_burgundy_wcw
c_func
(paren
id|chip
comma
id|address
comma
id|hardvolume
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|snd_pmac_burgundy_read_volume
id|snd_pmac_burgundy_read_volume
c_func
(paren
id|pmac_t
op_star
id|chip
comma
r_int
r_int
id|address
comma
r_int
op_star
id|volume
comma
r_int
id|shift
)paren
(brace
r_int
id|wvolume
suffix:semicolon
id|wvolume
op_assign
id|snd_pmac_burgundy_rcw
c_func
(paren
id|chip
comma
id|address
)paren
suffix:semicolon
id|volume
(braket
l_int|0
)braket
op_assign
id|wvolume
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|volume
(braket
l_int|0
)braket
op_ge
id|BURGUNDY_VOLUME_OFFSET
)paren
id|volume
(braket
l_int|0
)braket
op_sub_assign
id|BURGUNDY_VOLUME_OFFSET
suffix:semicolon
r_else
id|volume
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|volume
(braket
l_int|1
)braket
op_assign
(paren
id|wvolume
op_rshift
id|shift
)paren
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|volume
(braket
l_int|1
)braket
op_ge
id|BURGUNDY_VOLUME_OFFSET
)paren
id|volume
(braket
l_int|1
)braket
op_sub_assign
id|BURGUNDY_VOLUME_OFFSET
suffix:semicolon
r_else
id|volume
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; */
DECL|macro|BASE2ADDR
mdefine_line|#define BASE2ADDR(base)&t;((base) &lt;&lt; 12)
DECL|macro|ADDR2BASE
mdefine_line|#define ADDR2BASE(addr)&t;((addr) &gt;&gt; 12)
DECL|function|snd_pmac_burgundy_info_volume
r_static
r_int
id|snd_pmac_burgundy_info_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|100
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_burgundy_get_volume
r_static
r_int
id|snd_pmac_burgundy_get_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|addr
op_assign
id|BASE2ADDR
c_func
(paren
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
)paren
suffix:semicolon
r_int
id|shift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|snd_pmac_burgundy_read_volume
c_func
(paren
id|chip
comma
id|addr
comma
id|ucontrol-&gt;value.integer.value
comma
id|shift
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_burgundy_put_volume
r_static
r_int
id|snd_pmac_burgundy_put_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|addr
op_assign
id|BASE2ADDR
c_func
(paren
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
)paren
suffix:semicolon
r_int
id|shift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|nvoices
(braket
l_int|2
)braket
suffix:semicolon
id|snd_pmac_burgundy_write_volume
c_func
(paren
id|chip
comma
id|addr
comma
id|ucontrol-&gt;value.integer.value
comma
id|shift
)paren
suffix:semicolon
id|snd_pmac_burgundy_read_volume
c_func
(paren
id|chip
comma
id|addr
comma
id|nvoices
comma
id|shift
)paren
suffix:semicolon
r_return
(paren
id|nvoices
(braket
l_int|0
)braket
op_ne
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_logical_or
id|nvoices
(braket
l_int|1
)braket
op_ne
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
DECL|macro|BURGUNDY_VOLUME
mdefine_line|#define BURGUNDY_VOLUME(xname, xindex, addr, shift) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, name: xname, index: xindex,&bslash;&n;  .info = snd_pmac_burgundy_info_volume,&bslash;&n;  .get = snd_pmac_burgundy_get_volume,&bslash;&n;  .put = snd_pmac_burgundy_put_volume,&bslash;&n;  private_value: ((ADDR2BASE(addr) &amp; 0xff) | ((shift) &lt;&lt; 8)) }
multiline_comment|/* lineout/speaker */
DECL|function|snd_pmac_burgundy_info_switch_out
r_static
r_int
id|snd_pmac_burgundy_info_switch_out
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_int
id|stereo
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|1
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:semicolon
id|uinfo-&gt;count
op_assign
id|stereo
op_plus
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_burgundy_get_switch_out
r_static
r_int
id|snd_pmac_burgundy_get_switch_out
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|lmask
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|rmask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|stereo
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|1
suffix:semicolon
r_int
id|val
op_assign
id|snd_pmac_burgundy_rcb
c_func
(paren
id|chip
comma
id|MASK_ADDR_BURGUNDY_MORE_OUTPUTENABLES
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|val
op_amp
id|lmask
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
(paren
id|val
op_amp
id|rmask
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_burgundy_put_switch_out
r_static
r_int
id|snd_pmac_burgundy_put_switch_out
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|lmask
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|rmask
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|stereo
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|1
suffix:semicolon
r_int
id|val
comma
id|oval
suffix:semicolon
id|oval
op_assign
id|snd_pmac_burgundy_rcb
c_func
(paren
id|chip
comma
id|MASK_ADDR_BURGUNDY_MORE_OUTPUTENABLES
)paren
suffix:semicolon
id|val
op_assign
id|oval
op_amp
op_complement
(paren
id|lmask
op_or
id|rmask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
id|val
op_or_assign
id|lmask
suffix:semicolon
r_if
c_cond
(paren
id|stereo
op_logical_and
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
)paren
id|val
op_or_assign
id|rmask
suffix:semicolon
id|snd_pmac_burgundy_wcb
c_func
(paren
id|chip
comma
id|MASK_ADDR_BURGUNDY_MORE_OUTPUTENABLES
comma
id|val
)paren
suffix:semicolon
r_return
id|val
op_ne
id|oval
suffix:semicolon
)brace
DECL|macro|BURGUNDY_OUTPUT_SWITCH
mdefine_line|#define BURGUNDY_OUTPUT_SWITCH(xname, xindex, lmask, rmask, stereo) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, name: xname, index: xindex,&bslash;&n;  .info = snd_pmac_burgundy_info_switch_out,&bslash;&n;  .get = snd_pmac_burgundy_get_switch_out,&bslash;&n;  .put = snd_pmac_burgundy_put_switch_out,&bslash;&n;  private_value: ((lmask) | ((rmask) &lt;&lt; 8) | ((stereo) &lt;&lt; 24)) }
multiline_comment|/* line/speaker output volume */
DECL|function|snd_pmac_burgundy_info_volume_out
r_static
r_int
id|snd_pmac_burgundy_info_volume_out
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
r_int
id|stereo
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|1
suffix:semicolon
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
id|stereo
op_plus
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|15
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_burgundy_get_volume_out
r_static
r_int
id|snd_pmac_burgundy_get_volume_out
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|addr
op_assign
id|BASE2ADDR
c_func
(paren
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
)paren
suffix:semicolon
r_int
id|stereo
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|1
suffix:semicolon
r_int
id|oval
suffix:semicolon
id|oval
op_assign
op_complement
id|snd_pmac_burgundy_rcb
c_func
(paren
id|chip
comma
id|addr
)paren
op_amp
l_int|0xff
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|oval
op_amp
l_int|0xf
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
(paren
id|oval
op_rshift
l_int|4
)paren
op_amp
l_int|0xf
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_burgundy_put_volume_out
r_static
r_int
id|snd_pmac_burgundy_put_volume_out
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
r_int
id|addr
op_assign
id|BASE2ADDR
c_func
(paren
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
)paren
suffix:semicolon
r_int
id|stereo
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|24
)paren
op_amp
l_int|1
suffix:semicolon
r_int
id|oval
comma
id|val
suffix:semicolon
id|oval
op_assign
op_complement
id|snd_pmac_burgundy_rcb
c_func
(paren
id|chip
comma
id|addr
)paren
op_amp
l_int|0xff
suffix:semicolon
id|val
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|stereo
)paren
id|val
op_or_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_lshift
l_int|4
suffix:semicolon
r_else
id|val
op_or_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_lshift
l_int|4
suffix:semicolon
id|val
op_assign
op_complement
id|val
op_amp
l_int|0xff
suffix:semicolon
id|snd_pmac_burgundy_wcb
c_func
(paren
id|chip
comma
id|addr
comma
id|val
)paren
suffix:semicolon
r_return
id|val
op_ne
id|oval
suffix:semicolon
)brace
DECL|macro|BURGUNDY_OUTPUT_VOLUME
mdefine_line|#define BURGUNDY_OUTPUT_VOLUME(xname, xindex, addr, stereo) &bslash;&n;{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, name: xname, index: xindex,&bslash;&n;  .info = snd_pmac_burgundy_info_volume_out,&bslash;&n;  .get = snd_pmac_burgundy_get_volume_out,&bslash;&n;  .put = snd_pmac_burgundy_put_volume_out,&bslash;&n;  private_value: (ADDR2BASE(addr) | ((stereo) &lt;&lt; 24)) }
DECL|variable|__initdata
r_static
id|snd_kcontrol_new_t
id|snd_pmac_burgundy_mixers
(braket
)braket
id|__initdata
op_assign
(brace
id|BURGUNDY_VOLUME
c_func
(paren
l_string|&quot;Master Playback Volume&quot;
comma
l_int|0
comma
id|MASK_ADDR_BURGUNDY_MASTER_VOLUME
comma
l_int|8
)paren
comma
id|BURGUNDY_VOLUME
c_func
(paren
l_string|&quot;Line Playback Volume&quot;
comma
l_int|0
comma
id|MASK_ADDR_BURGUNDY_VOLLINE
comma
l_int|16
)paren
comma
id|BURGUNDY_VOLUME
c_func
(paren
l_string|&quot;CD Playback Volume&quot;
comma
l_int|0
comma
id|MASK_ADDR_BURGUNDY_VOLCD
comma
l_int|16
)paren
comma
id|BURGUNDY_VOLUME
c_func
(paren
l_string|&quot;Mic Playback Volume&quot;
comma
l_int|0
comma
id|MASK_ADDR_BURGUNDY_VOLMIC
comma
l_int|16
)paren
comma
id|BURGUNDY_OUTPUT_VOLUME
c_func
(paren
l_string|&quot;PC Speaker Playback Volume&quot;
comma
l_int|0
comma
id|MASK_ADDR_BURGUNDY_ATTENHP
comma
l_int|0
)paren
comma
multiline_comment|/*BURGUNDY_OUTPUT_VOLUME(&quot;PCM Playback Volume&quot;, 0, MASK_ADDR_BURGUNDY_ATTENLINEOUT, 1),*/
id|BURGUNDY_OUTPUT_VOLUME
c_func
(paren
l_string|&quot;Headphone Playback Volume&quot;
comma
l_int|0
comma
id|MASK_ADDR_BURGUNDY_ATTENSPEAKER
comma
l_int|1
)paren
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|snd_kcontrol_new_t
id|snd_pmac_burgundy_master_sw
id|__initdata
op_assign
id|BURGUNDY_OUTPUT_SWITCH
c_func
(paren
l_string|&quot;Headphone Playback Switch&quot;
comma
l_int|0
comma
id|BURGUNDY_OUTPUT_LEFT
comma
id|BURGUNDY_OUTPUT_RIGHT
comma
l_int|1
)paren
suffix:semicolon
DECL|variable|__initdata
r_static
id|snd_kcontrol_new_t
id|snd_pmac_burgundy_speaker_sw
id|__initdata
op_assign
id|BURGUNDY_OUTPUT_SWITCH
c_func
(paren
l_string|&quot;PC Speaker Playback Switch&quot;
comma
l_int|0
comma
id|BURGUNDY_OUTPUT_INTERN
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
DECL|macro|num_controls
mdefine_line|#define num_controls(ary) (sizeof(ary) / sizeof(snd_kcontrol_new_t))
macro_line|#ifdef PMAC_SUPPORT_AUTOMUTE
multiline_comment|/*&n; * auto-mute stuffs&n; */
DECL|function|snd_pmac_burgundy_detect_headphone
r_static
r_int
id|snd_pmac_burgundy_detect_headphone
c_func
(paren
id|pmac_t
op_star
id|chip
)paren
(brace
r_return
(paren
id|in_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_stat
)paren
op_amp
id|chip-&gt;hp_stat_mask
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_burgundy_update_automute
r_static
r_void
id|snd_pmac_burgundy_update_automute
c_func
(paren
id|pmac_t
op_star
id|chip
comma
r_int
id|do_notify
)paren
(brace
r_if
c_cond
(paren
id|chip-&gt;auto_mute
)paren
(brace
r_int
id|reg
comma
id|oreg
suffix:semicolon
id|reg
op_assign
id|oreg
op_assign
id|snd_pmac_burgundy_rcb
c_func
(paren
id|chip
comma
id|MASK_ADDR_BURGUNDY_MORE_OUTPUTENABLES
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
(paren
id|BURGUNDY_OUTPUT_LEFT
op_or
id|BURGUNDY_OUTPUT_RIGHT
op_or
id|BURGUNDY_OUTPUT_INTERN
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_pmac_burgundy_detect_headphone
c_func
(paren
id|chip
)paren
)paren
id|reg
op_or_assign
id|BURGUNDY_OUTPUT_LEFT
op_or
id|BURGUNDY_OUTPUT_RIGHT
suffix:semicolon
r_else
id|reg
op_or_assign
id|BURGUNDY_OUTPUT_INTERN
suffix:semicolon
r_if
c_cond
(paren
id|do_notify
op_logical_and
id|reg
op_eq
id|oreg
)paren
r_return
suffix:semicolon
id|snd_pmac_burgundy_wcb
c_func
(paren
id|chip
comma
id|MASK_ADDR_BURGUNDY_MORE_OUTPUTENABLES
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|do_notify
)paren
(brace
id|snd_ctl_notify
c_func
(paren
id|chip-&gt;card
comma
id|SNDRV_CTL_EVENT_MASK_VALUE
comma
op_amp
id|chip-&gt;master_sw_ctl-&gt;id
)paren
suffix:semicolon
id|snd_ctl_notify
c_func
(paren
id|chip-&gt;card
comma
id|SNDRV_CTL_EVENT_MASK_VALUE
comma
op_amp
id|chip-&gt;speaker_sw_ctl-&gt;id
)paren
suffix:semicolon
id|snd_ctl_notify
c_func
(paren
id|chip-&gt;card
comma
id|SNDRV_CTL_EVENT_MASK_VALUE
comma
op_amp
id|chip-&gt;hp_detect_ctl-&gt;id
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif /* PMAC_SUPPORT_AUTOMUTE */
multiline_comment|/*&n; * initialize burgundy&n; */
DECL|function|snd_pmac_burgundy_init
r_int
id|__init
id|snd_pmac_burgundy_init
c_func
(paren
id|pmac_t
op_star
id|chip
)paren
(brace
r_int
id|i
comma
id|err
suffix:semicolon
multiline_comment|/* Checks to see the chip is alive and kicking */
r_if
c_cond
(paren
(paren
id|in_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_ctrl
)paren
op_amp
id|MASK_ERRCODE
)paren
op_eq
l_int|0xf0000
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;pmac burgundy: disabled by MacOS :-(&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|snd_pmac_burgundy_wcb
c_func
(paren
id|chip
comma
id|MASK_ADDR_BURGUNDY_OUTPUTENABLES
comma
id|DEF_BURGUNDY_OUTPUTENABLES
)paren
suffix:semicolon
id|snd_pmac_burgundy_wcb
c_func
(paren
id|chip
comma
id|MASK_ADDR_BURGUNDY_MORE_OUTPUTENABLES
comma
id|DEF_BURGUNDY_MORE_OUTPUTENABLES
)paren
suffix:semicolon
id|snd_pmac_burgundy_wcw
c_func
(paren
id|chip
comma
id|MASK_ADDR_BURGUNDY_OUTPUTSELECTS
comma
id|DEF_BURGUNDY_OUTPUTSELECTS
)paren
suffix:semicolon
id|snd_pmac_burgundy_wcb
c_func
(paren
id|chip
comma
id|MASK_ADDR_BURGUNDY_INPSEL21
comma
id|DEF_BURGUNDY_INPSEL21
)paren
suffix:semicolon
id|snd_pmac_burgundy_wcb
c_func
(paren
id|chip
comma
id|MASK_ADDR_BURGUNDY_INPSEL3
comma
id|DEF_BURGUNDY_INPSEL3
)paren
suffix:semicolon
id|snd_pmac_burgundy_wcb
c_func
(paren
id|chip
comma
id|MASK_ADDR_BURGUNDY_GAINCD
comma
id|DEF_BURGUNDY_GAINCD
)paren
suffix:semicolon
id|snd_pmac_burgundy_wcb
c_func
(paren
id|chip
comma
id|MASK_ADDR_BURGUNDY_GAINLINE
comma
id|DEF_BURGUNDY_GAINLINE
)paren
suffix:semicolon
id|snd_pmac_burgundy_wcb
c_func
(paren
id|chip
comma
id|MASK_ADDR_BURGUNDY_GAINMIC
comma
id|DEF_BURGUNDY_GAINMIC
)paren
suffix:semicolon
id|snd_pmac_burgundy_wcb
c_func
(paren
id|chip
comma
id|MASK_ADDR_BURGUNDY_GAINMODEM
comma
id|DEF_BURGUNDY_GAINMODEM
)paren
suffix:semicolon
id|snd_pmac_burgundy_wcb
c_func
(paren
id|chip
comma
id|MASK_ADDR_BURGUNDY_ATTENSPEAKER
comma
id|DEF_BURGUNDY_ATTENSPEAKER
)paren
suffix:semicolon
id|snd_pmac_burgundy_wcb
c_func
(paren
id|chip
comma
id|MASK_ADDR_BURGUNDY_ATTENLINEOUT
comma
id|DEF_BURGUNDY_ATTENLINEOUT
)paren
suffix:semicolon
id|snd_pmac_burgundy_wcb
c_func
(paren
id|chip
comma
id|MASK_ADDR_BURGUNDY_ATTENHP
comma
id|DEF_BURGUNDY_ATTENHP
)paren
suffix:semicolon
id|snd_pmac_burgundy_wcw
c_func
(paren
id|chip
comma
id|MASK_ADDR_BURGUNDY_MASTER_VOLUME
comma
id|DEF_BURGUNDY_MASTER_VOLUME
)paren
suffix:semicolon
id|snd_pmac_burgundy_wcw
c_func
(paren
id|chip
comma
id|MASK_ADDR_BURGUNDY_VOLCD
comma
id|DEF_BURGUNDY_VOLCD
)paren
suffix:semicolon
id|snd_pmac_burgundy_wcw
c_func
(paren
id|chip
comma
id|MASK_ADDR_BURGUNDY_VOLLINE
comma
id|DEF_BURGUNDY_VOLLINE
)paren
suffix:semicolon
id|snd_pmac_burgundy_wcw
c_func
(paren
id|chip
comma
id|MASK_ADDR_BURGUNDY_VOLMIC
comma
id|DEF_BURGUNDY_VOLMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;hp_stat_mask
op_eq
l_int|0
)paren
multiline_comment|/* set headphone-jack detection bit */
id|chip-&gt;hp_stat_mask
op_assign
l_int|0x04
suffix:semicolon
multiline_comment|/*&n;&t; * build burgundy mixers&n;&t; */
id|strcpy
c_func
(paren
id|chip-&gt;card-&gt;mixername
comma
l_string|&quot;PowerMac Burgundy&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_controls
c_func
(paren
id|snd_pmac_burgundy_mixers
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|chip-&gt;card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_pmac_burgundy_mixers
(braket
id|i
)braket
comma
id|chip
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
id|chip-&gt;master_sw_ctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_pmac_burgundy_master_sw
comma
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|chip-&gt;card
comma
id|chip-&gt;master_sw_ctl
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|chip-&gt;speaker_sw_ctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_pmac_burgundy_speaker_sw
comma
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|chip-&gt;card
comma
id|chip-&gt;speaker_sw_ctl
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
macro_line|#ifdef PMAC_SUPPORT_AUTOMUTE
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pmac_add_automute
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|chip-&gt;detect_headphone
op_assign
id|snd_pmac_burgundy_detect_headphone
suffix:semicolon
id|chip-&gt;update_automute
op_assign
id|snd_pmac_burgundy_update_automute
suffix:semicolon
id|snd_pmac_burgundy_update_automute
c_func
(paren
id|chip
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* update the status only */
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
eof
