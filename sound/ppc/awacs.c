multiline_comment|/*&n; * PMac AWACS lowlevel functions&n; *&n; * Copyright (c) by Takashi Iwai &lt;tiwai@suse.de&gt;&n; * code based on dmasound.c.&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/nvram.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &quot;pmac.h&quot;
DECL|macro|chip_t
mdefine_line|#define chip_t pmac_t
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,0) || defined(CONFIG_ADB_CUDA)
DECL|macro|PMAC_AMP_AVAIL
mdefine_line|#define PMAC_AMP_AVAIL
macro_line|#endif
macro_line|#ifdef PMAC_AMP_AVAIL
DECL|struct|awacs_amp
r_typedef
r_struct
id|awacs_amp
(brace
DECL|member|amp_master
r_int
r_char
id|amp_master
suffix:semicolon
DECL|member|amp_vol
r_int
r_char
id|amp_vol
(braket
l_int|2
)braket
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|amp_tone
r_int
r_char
id|amp_tone
(braket
l_int|2
)braket
suffix:semicolon
DECL|typedef|awacs_amp_t
)brace
id|awacs_amp_t
suffix:semicolon
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,0)
DECL|macro|CHECK_CUDA_AMP
mdefine_line|#define CHECK_CUDA_AMP() (adb_hardware == ADB_VIACUDA)
macro_line|#else
DECL|macro|CHECK_CUDA_AMP
mdefine_line|#define CHECK_CUDA_AMP() (sys_ctrler == SYS_CTRLER_CUDA)
macro_line|#endif
macro_line|#endif /* PMAC_AMP_AVAIL */
multiline_comment|/*&n; * write AWACS register&n; */
r_static
r_void
DECL|function|snd_pmac_awacs_write
id|snd_pmac_awacs_write
c_func
(paren
id|pmac_t
op_star
id|chip
comma
r_int
id|val
)paren
(brace
r_int
id|timeout
op_assign
l_int|5000000
suffix:semicolon
r_while
c_loop
(paren
id|in_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_ctrl
)paren
op_amp
id|MASK_NEWECMD
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
op_decrement
id|timeout
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;snd_pmac_awacs_write timeout&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|out_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_ctrl
comma
id|val
op_or
(paren
id|chip-&gt;subframe
op_lshift
l_int|22
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|snd_pmac_awacs_write_reg
id|snd_pmac_awacs_write_reg
c_func
(paren
id|pmac_t
op_star
id|chip
comma
r_int
id|reg
comma
r_int
id|val
)paren
(brace
id|snd_pmac_awacs_write
c_func
(paren
id|chip
comma
id|val
op_or
(paren
id|reg
op_lshift
l_int|12
)paren
)paren
suffix:semicolon
id|chip-&gt;awacs_reg
(braket
id|reg
)braket
op_assign
id|val
suffix:semicolon
)brace
r_static
r_void
DECL|function|snd_pmac_awacs_write_noreg
id|snd_pmac_awacs_write_noreg
c_func
(paren
id|pmac_t
op_star
id|chip
comma
r_int
id|reg
comma
r_int
id|val
)paren
(brace
id|snd_pmac_awacs_write
c_func
(paren
id|chip
comma
id|val
op_or
(paren
id|reg
op_lshift
l_int|12
)paren
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PMAC_PBOOK
multiline_comment|/* Recalibrate chip */
DECL|function|screamer_recalibrate
r_static
r_void
id|screamer_recalibrate
c_func
(paren
id|pmac_t
op_star
id|chip
)paren
(brace
r_if
c_cond
(paren
id|chip-&gt;model
op_ne
id|PMAC_SCREAMER
)paren
r_return
suffix:semicolon
multiline_comment|/* Sorry for the horrible delays... I hope to get that improved&n;&t; * by making the whole PM process asynchronous in a future version&n;&t; */
id|mdelay
c_func
(paren
l_int|750
)paren
suffix:semicolon
id|snd_pmac_awacs_write_noreg
c_func
(paren
id|chip
comma
l_int|1
comma
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
op_or
id|MASK_RECALIBRATE
op_or
id|MASK_CMUTE
op_or
id|MASK_AMUTE
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|snd_pmac_awacs_write_noreg
c_func
(paren
id|chip
comma
l_int|1
comma
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|macro|screamer_recalibrate
mdefine_line|#define screamer_recalibrate(chip) /* NOP */
macro_line|#endif
multiline_comment|/*&n; * additional callback to set the pcm format&n; */
DECL|function|snd_pmac_awacs_set_format
r_static
r_void
id|snd_pmac_awacs_set_format
c_func
(paren
id|pmac_t
op_star
id|chip
)paren
(brace
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
op_and_assign
op_complement
id|MASK_SAMPLERATE
suffix:semicolon
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
op_or_assign
id|chip-&gt;rate_index
op_lshift
l_int|3
suffix:semicolon
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
l_int|1
comma
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * AWACS volume callbacks&n; */
multiline_comment|/*&n; * volumes: 0-15 stereo&n; */
DECL|function|snd_pmac_awacs_info_volume
r_static
r_int
id|snd_pmac_awacs_info_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|15
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_awacs_get_volume
r_static
r_int
id|snd_pmac_awacs_get_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|lshift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
l_int|0x0f
op_minus
(paren
(paren
id|chip-&gt;awacs_reg
(braket
id|reg
)braket
op_rshift
id|lshift
)paren
op_amp
l_int|0xf
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
l_int|0x0f
op_minus
(paren
id|chip-&gt;awacs_reg
(braket
id|reg
)braket
op_amp
l_int|0xf
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_awacs_put_volume
r_static
r_int
id|snd_pmac_awacs_put_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|lshift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|val
comma
id|oldval
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|oldval
op_assign
id|chip-&gt;awacs_reg
(braket
id|reg
)braket
suffix:semicolon
id|val
op_assign
id|oldval
op_amp
op_complement
(paren
l_int|0xf
op_or
(paren
l_int|0xf
op_lshift
id|lshift
)paren
)paren
suffix:semicolon
id|val
op_or_assign
(paren
(paren
l_int|0x0f
op_minus
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|0xf
)paren
)paren
op_lshift
id|lshift
)paren
suffix:semicolon
id|val
op_or_assign
l_int|0x0f
op_minus
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_amp
l_int|0xf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|oldval
op_ne
id|val
)paren
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
id|reg
comma
id|val
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|oldval
op_ne
id|reg
suffix:semicolon
)brace
DECL|macro|AWACS_VOLUME
mdefine_line|#define AWACS_VOLUME(xname, xreg, xshift) &bslash;&n;{ iface: SNDRV_CTL_ELEM_IFACE_MIXER, name: xname, index: 0, &bslash;&n;  info: snd_pmac_awacs_info_volume, &bslash;&n;  get: snd_pmac_awacs_get_volume, &bslash;&n;  put: snd_pmac_awacs_put_volume, &bslash;&n;  private_value: (xreg) | ((xshift) &lt;&lt; 8) }
multiline_comment|/*&n; * mute master/ogain for AWACS: mono&n; */
DECL|function|snd_pmac_awacs_get_switch
r_static
r_int
id|snd_pmac_awacs_get_switch
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|1
suffix:semicolon
r_int
id|val
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|val
op_assign
(paren
id|chip-&gt;awacs_reg
(braket
id|reg
)braket
op_rshift
id|shift
)paren
op_amp
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|invert
)paren
id|val
op_assign
l_int|1
op_minus
id|val
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|val
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_awacs_put_switch
r_static
r_int
id|snd_pmac_awacs_put_switch
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|reg
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|shift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|invert
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|16
)paren
op_amp
l_int|1
suffix:semicolon
r_int
id|mask
op_assign
l_int|1
op_lshift
id|shift
suffix:semicolon
r_int
id|val
comma
id|changed
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|val
op_assign
id|chip-&gt;awacs_reg
(braket
id|reg
)braket
op_amp
op_complement
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_ne
id|invert
)paren
id|val
op_or_assign
id|mask
suffix:semicolon
id|changed
op_assign
id|chip-&gt;awacs_reg
(braket
id|reg
)braket
op_ne
id|val
suffix:semicolon
r_if
c_cond
(paren
id|changed
)paren
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
id|reg
comma
id|val
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|changed
suffix:semicolon
)brace
DECL|macro|AWACS_SWITCH
mdefine_line|#define AWACS_SWITCH(xname, xreg, xshift, xinvert) &bslash;&n;{ iface: SNDRV_CTL_ELEM_IFACE_MIXER, name: xname, index: 0, &bslash;&n;  info: snd_pmac_boolean_mono_info, &bslash;&n;  get: snd_pmac_awacs_get_switch, &bslash;&n;  put: snd_pmac_awacs_put_switch, &bslash;&n;  private_value: (xreg) | ((xshift) &lt;&lt; 8) | ((xinvert) &lt;&lt; 16) }
macro_line|#ifdef PMAC_AMP_AVAIL
multiline_comment|/*&n; * controls for perch/whisper extension cards, e.g. G3 desktop&n; *&n; * TDA7433 connected via i2c address 0x45 (= 0x8a),&n; * accessed through cuda&n; */
DECL|function|awacs_set_cuda
r_static
r_void
id|awacs_set_cuda
c_func
(paren
r_int
id|reg
comma
r_int
id|val
)paren
(brace
r_struct
id|adb_request
id|req
suffix:semicolon
id|cuda_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
l_int|5
comma
id|CUDA_PACKET
comma
id|CUDA_GET_SET_IIC
comma
l_int|0x8a
comma
id|reg
comma
id|val
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|req.complete
)paren
id|cuda_poll
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * level = 0 - 14, 7 = 0 dB&n; */
DECL|function|awacs_amp_set_tone
r_static
r_void
id|awacs_amp_set_tone
c_func
(paren
id|awacs_amp_t
op_star
id|amp
comma
r_int
id|bass
comma
r_int
id|treble
)paren
(brace
id|amp-&gt;amp_tone
(braket
l_int|0
)braket
op_assign
id|bass
suffix:semicolon
id|amp-&gt;amp_tone
(braket
l_int|1
)braket
op_assign
id|treble
suffix:semicolon
r_if
c_cond
(paren
id|bass
OG
l_int|7
)paren
id|bass
op_assign
(paren
l_int|14
op_minus
id|bass
)paren
op_plus
l_int|8
suffix:semicolon
r_if
c_cond
(paren
id|treble
OG
l_int|7
)paren
id|treble
op_assign
(paren
l_int|14
op_minus
id|treble
)paren
op_plus
l_int|8
suffix:semicolon
id|awacs_set_cuda
c_func
(paren
l_int|2
comma
(paren
id|bass
op_lshift
l_int|4
)paren
op_or
id|treble
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * vol = 0 - 31 (attenuation), 32 = mute bit, stereo&n; */
DECL|function|awacs_amp_set_vol
r_static
r_int
id|awacs_amp_set_vol
c_func
(paren
id|awacs_amp_t
op_star
id|amp
comma
r_int
id|index
comma
r_int
id|lvol
comma
r_int
id|rvol
comma
r_int
id|do_check
)paren
(brace
r_if
c_cond
(paren
id|do_check
op_logical_and
id|amp-&gt;amp_vol
(braket
id|index
)braket
(braket
l_int|0
)braket
op_eq
id|lvol
op_logical_and
id|amp-&gt;amp_vol
(braket
id|index
)braket
(braket
l_int|1
)braket
op_eq
id|rvol
)paren
r_return
l_int|0
suffix:semicolon
id|awacs_set_cuda
c_func
(paren
l_int|3
op_plus
id|index
comma
id|lvol
)paren
suffix:semicolon
id|awacs_set_cuda
c_func
(paren
l_int|5
op_plus
id|index
comma
id|rvol
)paren
suffix:semicolon
id|amp-&gt;amp_vol
(braket
id|index
)braket
(braket
l_int|0
)braket
op_assign
id|lvol
suffix:semicolon
id|amp-&gt;amp_vol
(braket
id|index
)braket
(braket
l_int|1
)braket
op_assign
id|rvol
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * 0 = -79 dB, 79 = 0 dB, 99 = +20 dB&n; */
DECL|function|awacs_amp_set_master
r_static
r_void
id|awacs_amp_set_master
c_func
(paren
id|awacs_amp_t
op_star
id|amp
comma
r_int
id|vol
)paren
(brace
id|amp-&gt;amp_master
op_assign
id|vol
suffix:semicolon
r_if
c_cond
(paren
id|vol
op_le
l_int|79
)paren
id|vol
op_assign
l_int|32
op_plus
(paren
l_int|79
op_minus
id|vol
)paren
suffix:semicolon
r_else
id|vol
op_assign
l_int|32
op_minus
(paren
id|vol
op_minus
l_int|79
)paren
suffix:semicolon
id|awacs_set_cuda
c_func
(paren
l_int|1
comma
id|vol
)paren
suffix:semicolon
)brace
DECL|function|awacs_amp_free
r_static
r_void
id|awacs_amp_free
c_func
(paren
id|pmac_t
op_star
id|chip
)paren
(brace
id|awacs_amp_t
op_star
id|amp
op_assign
id|chip-&gt;mixer_data
suffix:semicolon
id|snd_assert
c_func
(paren
id|amp
comma
r_return
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|amp
)paren
suffix:semicolon
id|chip-&gt;mixer_data
op_assign
l_int|NULL
suffix:semicolon
id|chip-&gt;mixer_free
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * mixer controls&n; */
DECL|function|snd_pmac_awacs_info_volume_amp
r_static
r_int
id|snd_pmac_awacs_info_volume_amp
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|31
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_awacs_get_volume_amp
r_static
r_int
id|snd_pmac_awacs_get_volume_amp
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|index
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
id|awacs_amp_t
op_star
id|amp
op_assign
id|chip-&gt;mixer_data
suffix:semicolon
id|snd_assert
c_func
(paren
id|amp
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|index
op_ge
l_int|0
op_logical_and
id|index
op_le
l_int|1
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
l_int|31
op_minus
(paren
id|amp-&gt;amp_vol
(braket
id|index
)braket
(braket
l_int|0
)braket
op_amp
l_int|31
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
l_int|31
op_minus
(paren
id|amp-&gt;amp_vol
(braket
id|index
)braket
(braket
l_int|1
)braket
op_amp
l_int|31
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_awacs_put_volume_amp
r_static
r_int
id|snd_pmac_awacs_put_volume_amp
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|index
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
r_int
id|vol
(braket
l_int|2
)braket
suffix:semicolon
id|awacs_amp_t
op_star
id|amp
op_assign
id|chip-&gt;mixer_data
suffix:semicolon
id|snd_assert
c_func
(paren
id|amp
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|index
op_ge
l_int|0
op_logical_and
id|index
op_le
l_int|1
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|vol
(braket
l_int|0
)braket
op_assign
(paren
l_int|31
op_minus
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|31
)paren
)paren
op_or
(paren
id|amp-&gt;amp_vol
(braket
id|index
)braket
(braket
l_int|0
)braket
op_amp
l_int|32
)paren
suffix:semicolon
id|vol
(braket
l_int|1
)braket
op_assign
(paren
l_int|31
op_minus
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_amp
l_int|31
)paren
)paren
op_or
(paren
id|amp-&gt;amp_vol
(braket
id|index
)braket
(braket
l_int|1
)braket
op_amp
l_int|32
)paren
suffix:semicolon
r_return
id|awacs_amp_set_vol
c_func
(paren
id|amp
comma
id|index
comma
id|vol
(braket
l_int|0
)braket
comma
id|vol
(braket
l_int|1
)braket
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|snd_pmac_awacs_get_switch_amp
r_static
r_int
id|snd_pmac_awacs_get_switch_amp
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|index
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
id|awacs_amp_t
op_star
id|amp
op_assign
id|chip-&gt;mixer_data
suffix:semicolon
id|snd_assert
c_func
(paren
id|amp
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|index
op_ge
l_int|0
op_logical_and
id|index
op_le
l_int|1
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|amp-&gt;amp_vol
(braket
id|index
)braket
(braket
l_int|0
)braket
op_amp
l_int|32
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
(paren
id|amp-&gt;amp_vol
(braket
id|index
)braket
(braket
l_int|1
)braket
op_amp
l_int|32
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_awacs_put_switch_amp
r_static
r_int
id|snd_pmac_awacs_put_switch_amp
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|index
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
r_int
id|vol
(braket
l_int|2
)braket
suffix:semicolon
id|awacs_amp_t
op_star
id|amp
op_assign
id|chip-&gt;mixer_data
suffix:semicolon
id|snd_assert
c_func
(paren
id|amp
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|index
op_ge
l_int|0
op_logical_and
id|index
op_le
l_int|1
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|vol
(braket
l_int|0
)braket
op_assign
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
ques
c_cond
l_int|0
suffix:colon
l_int|32
)paren
op_or
(paren
id|amp-&gt;amp_vol
(braket
id|index
)braket
(braket
l_int|0
)braket
op_amp
l_int|31
)paren
suffix:semicolon
id|vol
(braket
l_int|1
)braket
op_assign
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
ques
c_cond
l_int|0
suffix:colon
l_int|32
)paren
op_or
(paren
id|amp-&gt;amp_vol
(braket
id|index
)braket
(braket
l_int|1
)braket
op_amp
l_int|31
)paren
suffix:semicolon
r_return
id|awacs_amp_set_vol
c_func
(paren
id|amp
comma
id|index
comma
id|vol
(braket
l_int|0
)braket
comma
id|vol
(braket
l_int|1
)braket
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|snd_pmac_awacs_info_tone_amp
r_static
r_int
id|snd_pmac_awacs_info_tone_amp
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|14
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_awacs_get_tone_amp
r_static
r_int
id|snd_pmac_awacs_get_tone_amp
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|index
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
id|awacs_amp_t
op_star
id|amp
op_assign
id|chip-&gt;mixer_data
suffix:semicolon
id|snd_assert
c_func
(paren
id|amp
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|index
op_ge
l_int|0
op_logical_and
id|index
op_le
l_int|1
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|amp-&gt;amp_tone
(braket
id|index
)braket
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_awacs_put_tone_amp
r_static
r_int
id|snd_pmac_awacs_put_tone_amp
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|index
op_assign
id|kcontrol-&gt;private_value
suffix:semicolon
id|awacs_amp_t
op_star
id|amp
op_assign
id|chip-&gt;mixer_data
suffix:semicolon
id|snd_assert
c_func
(paren
id|amp
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|snd_assert
c_func
(paren
id|index
op_ge
l_int|0
op_logical_and
id|index
op_le
l_int|1
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_ne
id|amp-&gt;amp_tone
(braket
id|index
)braket
)paren
(brace
id|amp-&gt;amp_tone
(braket
id|index
)braket
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
suffix:semicolon
id|awacs_amp_set_tone
c_func
(paren
id|amp
comma
id|amp-&gt;amp_tone
(braket
l_int|0
)braket
comma
id|amp-&gt;amp_tone
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_awacs_info_master_amp
r_static
r_int
id|snd_pmac_awacs_info_master_amp
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|99
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_awacs_get_master_amp
r_static
r_int
id|snd_pmac_awacs_get_master_amp
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|awacs_amp_t
op_star
id|amp
op_assign
id|chip-&gt;mixer_data
suffix:semicolon
id|snd_assert
c_func
(paren
id|amp
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|amp-&gt;amp_master
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_awacs_put_master_amp
r_static
r_int
id|snd_pmac_awacs_put_master_amp
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|awacs_amp_t
op_star
id|amp
op_assign
id|chip-&gt;mixer_data
suffix:semicolon
id|snd_assert
c_func
(paren
id|amp
comma
r_return
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_ne
id|amp-&gt;amp_master
)paren
(brace
id|amp-&gt;amp_master
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
suffix:semicolon
id|awacs_amp_set_master
c_func
(paren
id|amp
comma
id|amp-&gt;amp_master
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|AMP_CH_SPK
mdefine_line|#define AMP_CH_SPK&t;0
DECL|macro|AMP_CH_HD
mdefine_line|#define AMP_CH_HD&t;1
DECL|variable|__initdata
r_static
id|snd_kcontrol_new_t
id|snd_pmac_awacs_amp_vol
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|iface
suffix:colon
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
id|name
suffix:colon
l_string|&quot;PC Speaker Playback Volume&quot;
comma
id|info
suffix:colon
id|snd_pmac_awacs_info_volume_amp
comma
id|get
suffix:colon
id|snd_pmac_awacs_get_volume_amp
comma
id|put
suffix:colon
id|snd_pmac_awacs_put_volume_amp
comma
id|private_value
suffix:colon
id|AMP_CH_SPK
comma
)brace
comma
(brace
id|iface
suffix:colon
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
id|name
suffix:colon
l_string|&quot;Headphone Playback Volume&quot;
comma
id|info
suffix:colon
id|snd_pmac_awacs_info_volume_amp
comma
id|get
suffix:colon
id|snd_pmac_awacs_get_volume_amp
comma
id|put
suffix:colon
id|snd_pmac_awacs_put_volume_amp
comma
id|private_value
suffix:colon
id|AMP_CH_HD
comma
)brace
comma
(brace
id|iface
suffix:colon
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
id|name
suffix:colon
l_string|&quot;Tone Control - Bass&quot;
comma
id|info
suffix:colon
id|snd_pmac_awacs_info_tone_amp
comma
id|get
suffix:colon
id|snd_pmac_awacs_get_tone_amp
comma
id|put
suffix:colon
id|snd_pmac_awacs_put_tone_amp
comma
id|private_value
suffix:colon
l_int|0
comma
)brace
comma
(brace
id|iface
suffix:colon
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
id|name
suffix:colon
l_string|&quot;Tone Control - Treble&quot;
comma
id|info
suffix:colon
id|snd_pmac_awacs_info_tone_amp
comma
id|get
suffix:colon
id|snd_pmac_awacs_get_tone_amp
comma
id|put
suffix:colon
id|snd_pmac_awacs_put_tone_amp
comma
id|private_value
suffix:colon
l_int|1
comma
)brace
comma
(brace
id|iface
suffix:colon
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
id|name
suffix:colon
l_string|&quot;Amp Master Playback Volume&quot;
comma
id|info
suffix:colon
id|snd_pmac_awacs_info_master_amp
comma
id|get
suffix:colon
id|snd_pmac_awacs_get_master_amp
comma
id|put
suffix:colon
id|snd_pmac_awacs_put_master_amp
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|snd_kcontrol_new_t
id|snd_pmac_awacs_amp_hp_sw
id|__initdata
op_assign
(brace
id|iface
suffix:colon
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
id|name
suffix:colon
l_string|&quot;Headphone Playback Switch&quot;
comma
id|info
suffix:colon
id|snd_pmac_boolean_stereo_info
comma
id|get
suffix:colon
id|snd_pmac_awacs_get_switch_amp
comma
id|put
suffix:colon
id|snd_pmac_awacs_put_switch_amp
comma
id|private_value
suffix:colon
id|AMP_CH_HD
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|snd_kcontrol_new_t
id|snd_pmac_awacs_amp_spk_sw
id|__initdata
op_assign
(brace
id|iface
suffix:colon
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
id|name
suffix:colon
l_string|&quot;PC Speaker Playback Switch&quot;
comma
id|info
suffix:colon
id|snd_pmac_boolean_stereo_info
comma
id|get
suffix:colon
id|snd_pmac_awacs_get_switch_amp
comma
id|put
suffix:colon
id|snd_pmac_awacs_put_switch_amp
comma
id|private_value
suffix:colon
id|AMP_CH_SPK
comma
)brace
suffix:semicolon
macro_line|#endif /* PMAC_AMP_AVAIL */
multiline_comment|/*&n; * mic boost for screamer&n; */
DECL|function|snd_pmac_screamer_mic_boost_info
r_static
r_int
id|snd_pmac_screamer_mic_boost_info
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|2
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_screamer_mic_boost_get
r_static
r_int
id|snd_pmac_screamer_mic_boost_get
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;awacs_reg
(braket
l_int|6
)braket
op_amp
id|MASK_MIC_BOOST
)paren
id|val
op_assign
l_int|2
suffix:semicolon
r_else
r_if
c_cond
(paren
id|chip-&gt;awacs_reg
(braket
l_int|0
)braket
op_amp
id|MASK_GAINLINE
)paren
id|val
op_assign
l_int|1
suffix:semicolon
r_else
id|val
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|val
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_screamer_mic_boost_put
r_static
r_int
id|snd_pmac_screamer_mic_boost_put
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|changed
op_assign
l_int|0
suffix:semicolon
r_int
id|val0
comma
id|val6
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|val0
op_assign
id|chip-&gt;awacs_reg
(braket
l_int|0
)braket
op_amp
op_complement
id|MASK_GAINLINE
suffix:semicolon
id|val6
op_assign
id|chip-&gt;awacs_reg
(braket
l_int|6
)braket
op_amp
op_complement
id|MASK_MIC_BOOST
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
OG
l_int|0
)paren
(brace
id|val0
op_or_assign
id|MASK_GAINLINE
suffix:semicolon
r_if
c_cond
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
OG
l_int|1
)paren
id|val6
op_or_assign
id|MASK_MIC_BOOST
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val0
op_ne
id|chip-&gt;awacs_reg
(braket
l_int|0
)braket
)paren
(brace
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
l_int|0
comma
id|val0
)paren
suffix:semicolon
id|changed
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val6
op_ne
id|chip-&gt;awacs_reg
(braket
l_int|6
)braket
)paren
(brace
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
l_int|6
comma
id|val6
)paren
suffix:semicolon
id|changed
op_assign
l_int|1
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|changed
suffix:semicolon
)brace
multiline_comment|/*&n; * lists of mixer elements&n; */
DECL|variable|__initdata
r_static
id|snd_kcontrol_new_t
id|snd_pmac_awacs_mixers
(braket
)braket
id|__initdata
op_assign
(brace
id|AWACS_VOLUME
c_func
(paren
l_string|&quot;Master Playback Volume&quot;
comma
l_int|2
comma
l_int|6
)paren
comma
id|AWACS_SWITCH
c_func
(paren
l_string|&quot;Master Capture Switch&quot;
comma
l_int|1
comma
id|SHIFT_LOOPTHRU
comma
l_int|0
)paren
comma
id|AWACS_VOLUME
c_func
(paren
l_string|&quot;Capture Volume&quot;
comma
l_int|0
comma
l_int|4
)paren
comma
id|AWACS_SWITCH
c_func
(paren
l_string|&quot;Line Capture Switch&quot;
comma
l_int|0
comma
id|SHIFT_MUX_LINE
comma
l_int|0
)paren
comma
id|AWACS_SWITCH
c_func
(paren
l_string|&quot;CD Capture Switch&quot;
comma
l_int|0
comma
id|SHIFT_MUX_CD
comma
l_int|0
)paren
comma
id|AWACS_SWITCH
c_func
(paren
l_string|&quot;Mic Capture Switch&quot;
comma
l_int|0
comma
id|SHIFT_MUX_MIC
comma
l_int|0
)paren
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|snd_kcontrol_new_t
id|snd_pmac_awacs_master_sw
id|__initdata
op_assign
id|AWACS_SWITCH
c_func
(paren
l_string|&quot;Master Playback Switch&quot;
comma
l_int|1
comma
id|SHIFT_HDMUTE
comma
l_int|1
)paren
suffix:semicolon
DECL|variable|__initdata
r_static
id|snd_kcontrol_new_t
id|snd_pmac_awacs_mic_boost
(braket
)braket
id|__initdata
op_assign
(brace
id|AWACS_SWITCH
c_func
(paren
l_string|&quot;Mic Boost&quot;
comma
l_int|0
comma
id|SHIFT_GAINLINE
comma
l_int|0
)paren
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|snd_kcontrol_new_t
id|snd_pmac_screamer_mic_boost
(braket
)braket
id|__initdata
op_assign
(brace
(brace
id|iface
suffix:colon
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
id|name
suffix:colon
l_string|&quot;Mic Boost&quot;
comma
id|info
suffix:colon
id|snd_pmac_screamer_mic_boost_info
comma
id|get
suffix:colon
id|snd_pmac_screamer_mic_boost_get
comma
id|put
suffix:colon
id|snd_pmac_screamer_mic_boost_put
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|snd_kcontrol_new_t
id|snd_pmac_awacs_speaker_vol
(braket
)braket
id|__initdata
op_assign
(brace
id|AWACS_VOLUME
c_func
(paren
l_string|&quot;PC Speaker Playback Volume&quot;
comma
l_int|4
comma
l_int|6
)paren
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|snd_kcontrol_new_t
id|snd_pmac_awacs_speaker_sw
id|__initdata
op_assign
id|AWACS_SWITCH
c_func
(paren
l_string|&quot;PC Speaker Playback Switch&quot;
comma
l_int|1
comma
id|SHIFT_SPKMUTE
comma
l_int|1
)paren
suffix:semicolon
DECL|macro|num_controls
mdefine_line|#define num_controls(ary) (sizeof(ary) / sizeof(snd_kcontrol_new_t))
multiline_comment|/*&n; * add new mixer elements to the card&n; */
DECL|function|build_mixers
r_static
r_int
id|build_mixers
c_func
(paren
id|pmac_t
op_star
id|chip
comma
r_int
id|nums
comma
id|snd_kcontrol_new_t
op_star
id|mixers
)paren
(brace
r_int
id|i
comma
id|err
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nums
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|chip-&gt;card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|mixers
(braket
id|i
)braket
comma
id|chip
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * restore all registers&n; */
DECL|function|awacs_restore_all_regs
r_static
r_void
id|awacs_restore_all_regs
c_func
(paren
id|pmac_t
op_star
id|chip
)paren
(brace
id|snd_pmac_awacs_write_noreg
c_func
(paren
id|chip
comma
l_int|0
comma
id|chip-&gt;awacs_reg
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|snd_pmac_awacs_write_noreg
c_func
(paren
id|chip
comma
l_int|1
comma
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|snd_pmac_awacs_write_noreg
c_func
(paren
id|chip
comma
l_int|2
comma
id|chip-&gt;awacs_reg
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|snd_pmac_awacs_write_noreg
c_func
(paren
id|chip
comma
l_int|4
comma
id|chip-&gt;awacs_reg
(braket
l_int|4
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;model
op_eq
id|PMAC_SCREAMER
)paren
(brace
id|snd_pmac_awacs_write_noreg
c_func
(paren
id|chip
comma
l_int|5
comma
id|chip-&gt;awacs_reg
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|snd_pmac_awacs_write_noreg
c_func
(paren
id|chip
comma
l_int|6
comma
id|chip-&gt;awacs_reg
(braket
l_int|6
)braket
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|snd_pmac_awacs_write_noreg
c_func
(paren
id|chip
comma
l_int|1
comma
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|snd_pmac_awacs_write_noreg
c_func
(paren
id|chip
comma
l_int|7
comma
id|chip-&gt;awacs_reg
(braket
l_int|7
)braket
)paren
suffix:semicolon
id|snd_pmac_awacs_write_noreg
c_func
(paren
id|chip
comma
l_int|0
comma
id|chip-&gt;awacs_reg
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_PMAC_PBOOK
DECL|function|snd_pmac_awacs_resume
r_static
r_void
id|snd_pmac_awacs_resume
c_func
(paren
id|pmac_t
op_star
id|chip
)paren
(brace
id|awacs_restore_all_regs
c_func
(paren
id|chip
)paren
suffix:semicolon
id|screamer_recalibrate
c_func
(paren
id|chip
)paren
suffix:semicolon
macro_line|#ifdef PMAC_AMP_AVAIL
r_if
c_cond
(paren
id|chip-&gt;mixer_data
)paren
(brace
id|awacs_amp_t
op_star
id|amp
op_assign
id|chip-&gt;mixer_data
suffix:semicolon
id|awacs_amp_set_vol
c_func
(paren
id|amp
comma
l_int|0
comma
id|amp-&gt;amp_vol
(braket
l_int|0
)braket
(braket
l_int|0
)braket
comma
id|amp-&gt;amp_vol
(braket
l_int|0
)braket
(braket
l_int|1
)braket
comma
l_int|0
)paren
suffix:semicolon
id|awacs_amp_set_vol
c_func
(paren
id|amp
comma
l_int|1
comma
id|amp-&gt;amp_vol
(braket
l_int|1
)braket
(braket
l_int|0
)braket
comma
id|amp-&gt;amp_vol
(braket
l_int|1
)braket
(braket
l_int|1
)braket
comma
l_int|0
)paren
suffix:semicolon
id|awacs_amp_set_tone
c_func
(paren
id|amp
comma
id|amp-&gt;amp_tone
(braket
l_int|0
)braket
comma
id|amp-&gt;amp_tone
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|awacs_amp_set_master
c_func
(paren
id|amp
comma
id|amp-&gt;amp_master
)paren
suffix:semicolon
)brace
macro_line|#endif
)brace
macro_line|#endif /* CONFIG_PMAC_PBOOK */
macro_line|#ifdef PMAC_SUPPORT_AUTOMUTE
multiline_comment|/*&n; * auto-mute stuffs&n; */
DECL|function|snd_pmac_awacs_detect_headphone
r_static
r_int
id|snd_pmac_awacs_detect_headphone
c_func
(paren
id|pmac_t
op_star
id|chip
)paren
(brace
r_return
(paren
id|in_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_stat
)paren
op_amp
id|chip-&gt;hp_stat_mask
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef PMAC_AMP_AVAIL
DECL|function|toggle_amp_mute
r_static
r_int
id|toggle_amp_mute
c_func
(paren
id|awacs_amp_t
op_star
id|amp
comma
r_int
id|index
comma
r_int
id|mute
)paren
(brace
r_int
id|vol
(braket
l_int|2
)braket
suffix:semicolon
id|vol
(braket
l_int|0
)braket
op_assign
id|amp-&gt;amp_vol
(braket
id|index
)braket
(braket
l_int|0
)braket
op_amp
l_int|31
suffix:semicolon
id|vol
(braket
l_int|1
)braket
op_assign
id|amp-&gt;amp_vol
(braket
id|index
)braket
(braket
l_int|1
)braket
op_amp
l_int|31
suffix:semicolon
r_if
c_cond
(paren
id|mute
)paren
(brace
id|vol
(braket
l_int|0
)braket
op_or_assign
l_int|32
suffix:semicolon
id|vol
(braket
l_int|1
)braket
op_or_assign
l_int|32
suffix:semicolon
)brace
r_return
id|awacs_amp_set_vol
c_func
(paren
id|amp
comma
id|index
comma
id|vol
(braket
l_int|0
)braket
comma
id|vol
(braket
l_int|1
)braket
comma
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|snd_pmac_awacs_update_automute
r_static
r_void
id|snd_pmac_awacs_update_automute
c_func
(paren
id|pmac_t
op_star
id|chip
comma
r_int
id|do_notify
)paren
(brace
r_if
c_cond
(paren
id|chip-&gt;auto_mute
)paren
(brace
macro_line|#ifdef PMAC_AMP_AVAIL
r_if
c_cond
(paren
id|chip-&gt;mixer_data
)paren
(brace
id|awacs_amp_t
op_star
id|amp
op_assign
id|chip-&gt;mixer_data
suffix:semicolon
r_int
id|changed
suffix:semicolon
r_if
c_cond
(paren
id|snd_pmac_awacs_detect_headphone
c_func
(paren
id|chip
)paren
)paren
(brace
id|changed
op_assign
id|toggle_amp_mute
c_func
(paren
id|amp
comma
id|AMP_CH_HD
comma
l_int|0
)paren
suffix:semicolon
id|changed
op_or_assign
id|toggle_amp_mute
c_func
(paren
id|amp
comma
id|AMP_CH_SPK
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|changed
op_assign
id|toggle_amp_mute
c_func
(paren
id|amp
comma
id|AMP_CH_HD
comma
l_int|1
)paren
suffix:semicolon
id|changed
op_or_assign
id|toggle_amp_mute
c_func
(paren
id|amp
comma
id|AMP_CH_SPK
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|do_notify
op_logical_and
op_logical_neg
id|changed
)paren
r_return
suffix:semicolon
)brace
r_else
macro_line|#endif
(brace
r_int
id|reg
op_assign
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
op_or
(paren
id|MASK_HDMUTE
op_or
id|MASK_SPKMUTE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|snd_pmac_awacs_detect_headphone
c_func
(paren
id|chip
)paren
)paren
id|reg
op_and_assign
op_complement
id|MASK_HDMUTE
suffix:semicolon
r_else
id|reg
op_and_assign
op_complement
id|MASK_SPKMUTE
suffix:semicolon
r_if
c_cond
(paren
id|do_notify
op_logical_and
id|reg
op_eq
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
)paren
r_return
suffix:semicolon
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
l_int|1
comma
id|reg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|do_notify
)paren
(brace
id|snd_ctl_notify
c_func
(paren
id|chip-&gt;card
comma
id|SNDRV_CTL_EVENT_MASK_VALUE
comma
op_amp
id|chip-&gt;master_sw_ctl-&gt;id
)paren
suffix:semicolon
id|snd_ctl_notify
c_func
(paren
id|chip-&gt;card
comma
id|SNDRV_CTL_EVENT_MASK_VALUE
comma
op_amp
id|chip-&gt;speaker_sw_ctl-&gt;id
)paren
suffix:semicolon
id|snd_ctl_notify
c_func
(paren
id|chip-&gt;card
comma
id|SNDRV_CTL_EVENT_MASK_VALUE
comma
op_amp
id|chip-&gt;hp_detect_ctl-&gt;id
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif /* PMAC_SUPPORT_AUTOMUTE */
multiline_comment|/*&n; * initialize chip&n; */
r_int
id|__init
DECL|function|snd_pmac_awacs_init
id|snd_pmac_awacs_init
c_func
(paren
id|pmac_t
op_star
id|chip
)paren
(brace
r_int
id|err
comma
id|vol
suffix:semicolon
multiline_comment|/* looks like MASK_GAINLINE triggers something, so we set here&n;&t; * as start-up&n;&t; */
id|chip-&gt;awacs_reg
(braket
l_int|0
)braket
op_assign
id|MASK_MUX_CD
op_or
l_int|0xff
op_or
id|MASK_GAINLINE
suffix:semicolon
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
op_assign
id|MASK_CMUTE
op_or
id|MASK_AMUTE
suffix:semicolon
multiline_comment|/* FIXME: Only machines with external SRS module need MASK_PAROUT */
r_if
c_cond
(paren
id|chip-&gt;has_iic
op_logical_or
id|chip-&gt;device_id
op_eq
l_int|0x5
op_logical_or
multiline_comment|/*chip-&gt;_device_id == 0x8 || */
id|chip-&gt;device_id
op_eq
l_int|0xb
)paren
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
op_or_assign
id|MASK_PAROUT
suffix:semicolon
multiline_comment|/* get default volume from nvram */
singleline_comment|// vol = (~nvram_read_byte(0x1308) &amp; 7) &lt;&lt; 1;
singleline_comment|// vol = ((pmac_xpram_read( 8 ) &amp; 7 ) &lt;&lt; 1 );
id|vol
op_assign
l_int|0x0f
suffix:semicolon
multiline_comment|/* no, on alsa, muted as default */
id|vol
op_assign
id|vol
op_plus
(paren
id|vol
op_lshift
l_int|6
)paren
suffix:semicolon
id|chip-&gt;awacs_reg
(braket
l_int|2
)braket
op_assign
id|vol
suffix:semicolon
id|chip-&gt;awacs_reg
(braket
l_int|4
)braket
op_assign
id|vol
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;model
op_eq
id|PMAC_SCREAMER
)paren
(brace
id|chip-&gt;awacs_reg
(braket
l_int|5
)braket
op_assign
id|vol
suffix:semicolon
multiline_comment|/* FIXME: screamer has loopthru vol control */
id|chip-&gt;awacs_reg
(braket
l_int|6
)braket
op_assign
id|MASK_MIC_BOOST
suffix:semicolon
multiline_comment|/* FIXME: maybe should be vol &lt;&lt; 3 for PCMCIA speaker */
id|chip-&gt;awacs_reg
(braket
l_int|7
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|awacs_restore_all_regs
c_func
(paren
id|chip
)paren
suffix:semicolon
id|screamer_recalibrate
c_func
(paren
id|chip
)paren
suffix:semicolon
id|chip-&gt;revision
op_assign
(paren
id|in_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_stat
)paren
op_rshift
l_int|12
)paren
op_amp
l_int|0xf
suffix:semicolon
macro_line|#ifdef PMAC_AMP_AVAIL
r_if
c_cond
(paren
id|chip-&gt;revision
op_eq
l_int|3
op_logical_and
id|chip-&gt;has_iic
op_logical_and
id|CHECK_CUDA_AMP
c_func
(paren
)paren
)paren
(brace
id|awacs_amp_t
op_star
id|amp
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|amp
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|amp
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|chip-&gt;mixer_data
op_assign
id|amp
suffix:semicolon
id|memset
c_func
(paren
id|amp
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|amp
)paren
)paren
suffix:semicolon
id|chip-&gt;mixer_free
op_assign
id|awacs_amp_free
suffix:semicolon
id|awacs_amp_set_vol
c_func
(paren
id|amp
comma
l_int|0
comma
l_int|63
comma
l_int|63
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* mute and zero vol */
id|awacs_amp_set_vol
c_func
(paren
id|amp
comma
l_int|1
comma
l_int|63
comma
l_int|63
comma
l_int|0
)paren
suffix:semicolon
id|awacs_amp_set_tone
c_func
(paren
id|amp
comma
l_int|7
comma
l_int|7
)paren
suffix:semicolon
multiline_comment|/* 0 dB */
id|awacs_amp_set_master
c_func
(paren
id|amp
comma
l_int|79
)paren
suffix:semicolon
multiline_comment|/* 0 dB */
)brace
macro_line|#endif /* PMAC_AMP_AVAIL */
r_if
c_cond
(paren
id|chip-&gt;hp_stat_mask
op_eq
l_int|0
)paren
(brace
multiline_comment|/* set headphone-jack detection bit */
r_switch
c_cond
(paren
id|chip-&gt;model
)paren
(brace
r_case
id|PMAC_AWACS
suffix:colon
id|chip-&gt;hp_stat_mask
op_assign
l_int|0x04
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PMAC_SCREAMER
suffix:colon
r_switch
c_cond
(paren
id|chip-&gt;device_id
)paren
(brace
r_case
l_int|0x08
suffix:colon
multiline_comment|/* 1 = side jack, 2 = front jack */
id|chip-&gt;hp_stat_mask
op_assign
l_int|0x03
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x00
suffix:colon
r_case
l_int|0x05
suffix:colon
id|chip-&gt;hp_stat_mask
op_assign
l_int|0x04
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|chip-&gt;hp_stat_mask
op_assign
l_int|0x08
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|snd_BUG
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; * build mixers&n;&t; */
id|strcpy
c_func
(paren
id|chip-&gt;card-&gt;mixername
comma
l_string|&quot;PowerMac AWACS&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|build_mixers
c_func
(paren
id|chip
comma
id|num_controls
c_func
(paren
id|snd_pmac_awacs_mixers
)paren
comma
id|snd_pmac_awacs_mixers
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|chip-&gt;master_sw_ctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_pmac_awacs_master_sw
comma
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|chip-&gt;card
comma
id|chip-&gt;master_sw_ctl
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
macro_line|#ifdef PMAC_AMP_AVAIL
r_if
c_cond
(paren
id|chip-&gt;mixer_data
)paren
(brace
multiline_comment|/* use amplifier.  the signal is connected from route A&n;&t;&t; * to the amp.  the amp has its headphone and speaker&n;&t;&t; * volumes and mute switches, so we use them instead of&n;&t;&t; * screamer registers.&n;&t;&t; * in this case, it seems the route C is not used.&n;&t;&t; */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|build_mixers
c_func
(paren
id|chip
comma
id|num_controls
c_func
(paren
id|snd_pmac_awacs_amp_vol
)paren
comma
id|snd_pmac_awacs_amp_vol
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/* overwrite */
id|chip-&gt;master_sw_ctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_pmac_awacs_amp_hp_sw
comma
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|chip-&gt;card
comma
id|chip-&gt;master_sw_ctl
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|chip-&gt;speaker_sw_ctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_pmac_awacs_amp_spk_sw
comma
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|chip-&gt;card
comma
id|chip-&gt;speaker_sw_ctl
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_else
macro_line|#endif /* PMAC_AMP_AVAIL */
(brace
multiline_comment|/* route A = headphone, route C = speaker */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|build_mixers
c_func
(paren
id|chip
comma
id|num_controls
c_func
(paren
id|snd_pmac_awacs_speaker_vol
)paren
comma
id|snd_pmac_awacs_speaker_vol
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|chip-&gt;speaker_sw_ctl
op_assign
id|snd_ctl_new1
c_func
(paren
op_amp
id|snd_pmac_awacs_speaker_sw
comma
id|chip
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|chip-&gt;card
comma
id|chip-&gt;speaker_sw_ctl
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chip-&gt;model
op_eq
id|PMAC_SCREAMER
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|build_mixers
c_func
(paren
id|chip
comma
id|num_controls
c_func
(paren
id|snd_pmac_screamer_mic_boost
)paren
comma
id|snd_pmac_screamer_mic_boost
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|build_mixers
c_func
(paren
id|chip
comma
id|num_controls
c_func
(paren
id|snd_pmac_awacs_mic_boost
)paren
comma
id|snd_pmac_awacs_mic_boost
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * set lowlevel callbacks&n;&t; */
id|chip-&gt;set_format
op_assign
id|snd_pmac_awacs_set_format
suffix:semicolon
macro_line|#ifdef CONFIG_PMAC_PBOOK
id|chip-&gt;resume
op_assign
id|snd_pmac_awacs_resume
suffix:semicolon
macro_line|#endif
macro_line|#ifdef PMAC_SUPPORT_AUTOMUTE
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_pmac_add_automute
c_func
(paren
id|chip
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
id|chip-&gt;detect_headphone
op_assign
id|snd_pmac_awacs_detect_headphone
suffix:semicolon
id|chip-&gt;update_automute
op_assign
id|snd_pmac_awacs_update_automute
suffix:semicolon
id|snd_pmac_awacs_update_automute
c_func
(paren
id|chip
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* update the status only */
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
eof
