multiline_comment|/*&n; * PMac AWACS lowlevel functions&n; *&n; * Copyright (c) by Takashi Iwai &lt;tiwai@suse.de&gt;&n; * code based on dmasound.c.&n; *&n; *   This program is free software; you can redistribute it and/or modify&n; *   it under the terms of the GNU General Public License as published by&n; *   the Free Software Foundation; either version 2 of the License, or&n; *   (at your option) any later version.&n; *&n; *   This program is distributed in the hope that it will be useful,&n; *   but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *   GNU General Public License for more details.&n; *&n; *   You should have received a copy of the GNU General Public License&n; *   along with this program; if not, write to the Free Software&n; *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA&n; */
DECL|macro|__NO_VERSION__
mdefine_line|#define __NO_VERSION__
macro_line|#include &lt;sound/driver.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;sound/core.h&gt;
macro_line|#include &quot;pmac.h&quot;
DECL|macro|chip_t
mdefine_line|#define chip_t pmac_t
multiline_comment|/*&n; * write AWACS register&n; */
r_static
r_void
DECL|function|snd_pmac_awacs_write
id|snd_pmac_awacs_write
c_func
(paren
id|pmac_t
op_star
id|chip
comma
r_int
id|val
)paren
(brace
r_int
id|timeout
op_assign
l_int|5000000
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;model
op_le
id|PMAC_SCREAMER
)paren
r_return
suffix:semicolon
r_while
c_loop
(paren
id|in_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_ctrl
)paren
op_amp
id|MASK_NEWECMD
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
op_decrement
id|timeout
)paren
(brace
id|snd_printd
c_func
(paren
l_string|&quot;snd_pmac_awacs_write timeout&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|out_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_ctrl
comma
id|val
op_or
(paren
id|chip-&gt;subframe
op_lshift
l_int|22
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|snd_pmac_awacs_write_reg
id|snd_pmac_awacs_write_reg
c_func
(paren
id|pmac_t
op_star
id|chip
comma
r_int
id|reg
comma
r_int
id|val
)paren
(brace
id|snd_pmac_awacs_write
c_func
(paren
id|chip
comma
id|val
op_or
(paren
id|reg
op_lshift
l_int|12
)paren
)paren
suffix:semicolon
id|chip-&gt;awacs_reg
(braket
id|reg
)braket
op_assign
id|val
suffix:semicolon
)brace
r_static
r_void
DECL|function|snd_pmac_awacs_write_noreg
id|snd_pmac_awacs_write_noreg
c_func
(paren
id|pmac_t
op_star
id|chip
comma
r_int
id|reg
comma
r_int
id|val
)paren
(brace
id|snd_pmac_awacs_write
c_func
(paren
id|chip
comma
id|val
op_or
(paren
id|reg
op_lshift
l_int|12
)paren
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PMAC_PBOOK
r_static
r_void
DECL|function|screamer_recalibrate
id|screamer_recalibrate
c_func
(paren
id|pmac_t
op_star
id|chip
)paren
(brace
multiline_comment|/* Sorry for the horrible delays... I hope to get that improved&n;&t; * by making the whole PM process asynchronous in a future version&n;&t; */
id|mdelay
c_func
(paren
l_int|750
)paren
suffix:semicolon
id|snd_pmac_awacs_write_noreg
c_func
(paren
id|chip
comma
l_int|1
comma
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
op_or
id|MASK_RECALIBRATE
op_or
id|MASK_CMUTE
op_or
id|MASK_AMUTE
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1000
)paren
suffix:semicolon
id|snd_pmac_awacs_write_noreg
c_func
(paren
id|chip
comma
l_int|1
comma
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * additional callback to set the pcm format&n; */
DECL|function|snd_pmac_awacs_set_format
r_static
r_void
id|snd_pmac_awacs_set_format
c_func
(paren
id|pmac_t
op_star
id|chip
)paren
(brace
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
op_and_assign
op_complement
id|MASK_SAMPLERATE
suffix:semicolon
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
op_or_assign
id|chip-&gt;rate_index
op_lshift
l_int|3
suffix:semicolon
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
l_int|1
comma
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
macro_line|#ifdef PMAC_AMP_AVAIL
multiline_comment|/* Turn on sound output, needed on G3 desktop powermacs */
multiline_comment|/* vol = 0 - 31, stereo */
r_static
r_void
DECL|function|snd_pmac_awacs_enable_amp
id|snd_pmac_awacs_enable_amp
c_func
(paren
id|pmac_t
op_star
id|chip
comma
r_int
id|lvol
comma
r_int
id|rvol
)paren
(brace
r_struct
id|adb_request
id|req
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|chip-&gt;amp_only
)paren
r_return
suffix:semicolon
multiline_comment|/* turn on headphones */
id|cuda_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
l_int|5
comma
id|CUDA_PACKET
comma
id|CUDA_GET_SET_IIC
comma
l_int|0x8a
comma
l_int|4
comma
l_int|0
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|req.complete
)paren
id|cuda_poll
c_func
(paren
)paren
suffix:semicolon
id|cuda_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
l_int|5
comma
id|CUDA_PACKET
comma
id|CUDA_GET_SET_IIC
comma
l_int|0x8a
comma
l_int|6
comma
l_int|0
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|req.complete
)paren
id|cuda_poll
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* turn on speaker */
id|cuda_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
l_int|5
comma
id|CUDA_PACKET
comma
id|CUDA_GET_SET_IIC
comma
l_int|0x8a
comma
l_int|3
comma
id|lvol
op_amp
l_int|0xff
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|req.complete
)paren
id|cuda_poll
c_func
(paren
)paren
suffix:semicolon
id|cuda_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
l_int|5
comma
id|CUDA_PACKET
comma
id|CUDA_GET_SET_IIC
comma
l_int|0x8a
comma
l_int|5
comma
id|rvol
op_amp
l_int|0xff
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|req.complete
)paren
id|cuda_poll
c_func
(paren
)paren
suffix:semicolon
id|cuda_request
c_func
(paren
op_amp
id|req
comma
l_int|NULL
comma
l_int|5
comma
id|CUDA_PACKET
comma
id|CUDA_GET_SET_IIC
comma
l_int|0x8a
comma
l_int|1
comma
l_int|0x29
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|req.complete
)paren
id|cuda_poll
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* update */
id|chip-&gt;amp_vol
(braket
l_int|0
)braket
op_assign
id|lvol
suffix:semicolon
id|chip-&gt;amp_vol
(braket
l_int|1
)braket
op_assign
id|rvol
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * AWACS volume callbacks&n; */
multiline_comment|/*&n; * volumes: 0-15 stereo&n; */
DECL|function|snd_pmac_awacs_info_volume
r_static
r_int
id|snd_pmac_awacs_info_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|15
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_awacs_get_volume
r_static
r_int
id|snd_pmac_awacs_get_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|n
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|lshift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
l_int|0x0f
op_minus
(paren
(paren
id|chip-&gt;awacs_reg
(braket
id|n
)braket
op_rshift
id|lshift
)paren
op_amp
l_int|0xf
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
l_int|0x0f
op_minus
(paren
id|chip-&gt;awacs_reg
(braket
id|n
)braket
op_amp
l_int|0xf
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_awacs_put_volume
r_static
r_int
id|snd_pmac_awacs_put_volume
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|n
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|lshift
op_assign
(paren
id|kcontrol-&gt;private_value
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|rn
comma
id|oldval
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|oldval
op_assign
id|chip-&gt;awacs_reg
(braket
id|n
)braket
suffix:semicolon
id|rn
op_assign
id|oldval
op_amp
op_complement
(paren
l_int|0xf
op_or
(paren
l_int|0xf
op_lshift
id|lshift
)paren
)paren
suffix:semicolon
id|rn
op_or_assign
(paren
(paren
l_int|0x0f
op_minus
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_amp
l_int|0xf
)paren
)paren
op_lshift
id|lshift
)paren
suffix:semicolon
id|rn
op_or_assign
l_int|0x0f
op_minus
(paren
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_amp
l_int|0xf
)paren
suffix:semicolon
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
id|n
comma
id|rn
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|oldval
op_ne
id|rn
suffix:semicolon
)brace
DECL|macro|AWACS_VOLUME
mdefine_line|#define AWACS_VOLUME(xname, xreg, xshift) &bslash;&n;{ iface: SNDRV_CTL_ELEM_IFACE_MIXER, name: xname, index: 0, &bslash;&n;  info: snd_pmac_awacs_info_volume, &bslash;&n;  get: snd_pmac_awacs_get_volume, &bslash;&n;  put: snd_pmac_awacs_put_volume, &bslash;&n;  private_value: (xreg) | (xshift &lt;&lt; 8) }
multiline_comment|/*&n; * mute master/ogain for AWACS: mono&n; */
DECL|function|snd_pmac_awacs_info_switch
r_static
r_int
id|snd_pmac_awacs_info_switch
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_BOOLEAN
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|1
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_awacs_get_switch
r_static
r_int
id|snd_pmac_awacs_get_switch
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|mask
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
(paren
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
op_amp
id|mask
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_awacs_put_switch
r_static
r_int
id|snd_pmac_awacs_put_switch
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|mask
op_assign
id|kcontrol-&gt;private_value
op_amp
l_int|0xff
suffix:semicolon
r_int
id|val
comma
id|changed
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
id|val
op_assign
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
op_amp
op_complement
id|mask
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
)paren
id|val
op_or_assign
id|mask
suffix:semicolon
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
l_int|1
comma
id|val
)paren
suffix:semicolon
id|changed
op_assign
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
op_ne
id|val
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|chip-&gt;reg_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|changed
suffix:semicolon
)brace
DECL|macro|AWACS_SWITCH
mdefine_line|#define AWACS_SWITCH(xname, xreg, xmask) &bslash;&n;{ iface: SNDRV_CTL_ELEM_IFACE_MIXER, name: xname, index: 0, &bslash;&n;  info: snd_pmac_awacs_info_switch, &bslash;&n;  get: snd_pmac_awacs_get_switch, &bslash;&n;  put: snd_pmac_awacs_put_switch, &bslash;&n;  private_value: (xreg) | ((xmask) &lt;&lt; 8) }
macro_line|#ifdef PMAC_AMP_AVAIL
multiline_comment|/*&n; * Master volume for awacs revision 3&n; */
DECL|function|snd_pmac_awacs_info_volume_amp
r_static
r_int
id|snd_pmac_awacs_info_volume_amp
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_info_t
op_star
id|uinfo
)paren
(brace
id|uinfo-&gt;type
op_assign
id|SNDRV_CTL_ELEM_TYPE_INTEGER
suffix:semicolon
id|uinfo-&gt;count
op_assign
l_int|2
suffix:semicolon
id|uinfo-&gt;value.integer.min
op_assign
l_int|0
suffix:semicolon
id|uinfo-&gt;value.integer.max
op_assign
l_int|31
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_awacs_get_volume_amp
r_static
r_int
id|snd_pmac_awacs_get_volume_amp
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_assign
id|chip-&gt;amp_vol
(braket
l_int|0
)braket
suffix:semicolon
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_assign
id|chip-&gt;amp_vol
(braket
l_int|1
)braket
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|snd_pmac_awacs_put_volume_amp
r_static
r_int
id|snd_pmac_awacs_put_volume_amp
c_func
(paren
id|snd_kcontrol_t
op_star
id|kcontrol
comma
id|snd_ctl_elem_value_t
op_star
id|ucontrol
)paren
(brace
id|pmac_t
op_star
id|chip
op_assign
id|snd_kcontrol_chip
c_func
(paren
id|kcontrol
)paren
suffix:semicolon
r_int
id|changed
op_assign
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
op_ne
id|chip-&gt;amp_vol
(braket
l_int|0
)braket
op_logical_or
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
op_ne
id|chip-&gt;amp_vol
(braket
l_int|1
)braket
suffix:semicolon
id|snd_pmac_awacs_enable_amp
c_func
(paren
id|chip
comma
id|ucontrol-&gt;value.integer.value
(braket
l_int|0
)braket
comma
id|ucontrol-&gt;value.integer.value
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
id|changed
suffix:semicolon
)brace
macro_line|#endif /* PMAC_AMP_AVAIL */
multiline_comment|/*&n; * lists of mixer elements&n; */
DECL|variable|snd_pmac_awacs_mixers1
r_static
id|snd_kcontrol_new_t
id|snd_pmac_awacs_mixers1
(braket
)braket
op_assign
(brace
id|AWACS_VOLUME
c_func
(paren
l_string|&quot;Master Playback Volume&quot;
comma
l_int|2
comma
l_int|6
)paren
comma
id|AWACS_SWITCH
c_func
(paren
l_string|&quot;Master Playback Switch&quot;
comma
l_int|1
comma
id|MASK_AMUTE
)paren
comma
id|AWACS_SWITCH
c_func
(paren
l_string|&quot;Master Capture Switch&quot;
comma
l_int|1
comma
id|MASK_LOOPTHRU
)paren
comma
)brace
suffix:semicolon
DECL|variable|snd_pmac_awacs_mixers2
r_static
id|snd_kcontrol_new_t
id|snd_pmac_awacs_mixers2
(braket
)braket
op_assign
(brace
id|AWACS_VOLUME
c_func
(paren
l_string|&quot;Capture Volume&quot;
comma
l_int|0
comma
l_int|4
)paren
comma
id|AWACS_SWITCH
c_func
(paren
l_string|&quot;Line Capture Switch&quot;
comma
l_int|0
comma
id|MASK_MUX_AUDIN
)paren
comma
id|AWACS_SWITCH
c_func
(paren
l_string|&quot;CD Capture Switch&quot;
comma
l_int|0
comma
id|MASK_MUX_CD
)paren
comma
id|AWACS_SWITCH
c_func
(paren
l_string|&quot;Mic Capture Switch&quot;
comma
l_int|0
comma
id|MASK_MUX_MIC
)paren
comma
id|AWACS_SWITCH
c_func
(paren
l_string|&quot;Mic Boost&quot;
comma
l_int|0
comma
id|MASK_GAINLINE
)paren
comma
)brace
suffix:semicolon
DECL|variable|snd_pmac_awacs_speaker_mixers
r_static
id|snd_kcontrol_new_t
id|snd_pmac_awacs_speaker_mixers
(braket
)braket
op_assign
(brace
id|AWACS_VOLUME
c_func
(paren
l_string|&quot;PC Speaker Playback Volume&quot;
comma
l_int|4
comma
l_int|6
)paren
comma
id|AWACS_SWITCH
c_func
(paren
l_string|&quot;PC Speaker Playback Switch&quot;
comma
l_int|1
comma
id|MASK_CMUTE
)paren
comma
)brace
suffix:semicolon
macro_line|#ifdef PMAC_AMP_AVAIL
DECL|variable|snd_pmac_awacs_amp_mixers
r_static
id|snd_kcontrol_new_t
id|snd_pmac_awacs_amp_mixers
(braket
)braket
op_assign
(brace
(brace
id|iface
suffix:colon
id|SNDRV_CTL_ELEM_IFACE_MIXER
comma
id|name
suffix:colon
l_string|&quot;PC Speaker Playback Volume&quot;
comma
id|index
suffix:colon
l_int|0
comma
id|info
suffix:colon
id|snd_pmac_awacs_info_volume_amp
comma
"&bslash;"
id|get
suffix:colon
id|snd_pmac_awacs_get_volume_amp
comma
id|put
suffix:colon
id|snd_pmac_awacs_put_volume_amp
comma
)brace
comma
)brace
suffix:semicolon
macro_line|#endif
DECL|macro|num_controls
mdefine_line|#define num_controls(ary) (sizeof(ary) / sizeof(snd_kcontrol_new_t))
multiline_comment|/*&n; * add new mixer elements to the card&n; */
DECL|function|build_mixers
r_static
r_int
id|build_mixers
c_func
(paren
id|pmac_t
op_star
id|chip
comma
r_int
id|nums
comma
id|snd_kcontrol_new_t
op_star
id|mixers
)paren
(brace
r_int
id|i
comma
id|err
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nums
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|snd_ctl_add
c_func
(paren
id|chip-&gt;card
comma
id|snd_ctl_new1
c_func
(paren
op_amp
id|mixers
(braket
id|i
)braket
comma
id|chip
)paren
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PMAC_PBOOK
DECL|function|snd_pmac_awacs_resume
r_static
r_void
id|snd_pmac_awacs_resume
c_func
(paren
id|pmac_t
op_star
id|chip
)paren
(brace
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
l_int|0
comma
id|chip-&gt;awacs_reg
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
l_int|1
comma
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
l_int|2
comma
id|chip-&gt;awacs_reg
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
l_int|4
comma
id|chip-&gt;awacs_reg
(braket
l_int|4
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;model
op_eq
id|PMAC_SCREAMER
)paren
(brace
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
l_int|5
comma
id|chip-&gt;awacs_reg
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
l_int|6
comma
id|chip-&gt;awacs_reg
(braket
l_int|6
)braket
)paren
suffix:semicolon
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
l_int|7
comma
id|chip-&gt;awacs_reg
(braket
l_int|7
)braket
)paren
suffix:semicolon
id|screamer_recalibrate
c_func
(paren
id|chip
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_PMAC_PBOOK */
multiline_comment|/*&n; * initialize chip&n; */
r_int
id|__init
DECL|function|snd_pmac_awacs_init
id|snd_pmac_awacs_init
c_func
(paren
id|pmac_t
op_star
id|chip
)paren
(brace
r_int
id|err
comma
id|vol
suffix:semicolon
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
l_int|0
comma
id|MASK_MUX_CD
)paren
suffix:semicolon
multiline_comment|/* FIXME: Only machines with external SRS module need MASK_PAROUT */
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
op_assign
id|MASK_LOOPTHRU
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;has_iic
op_logical_or
id|chip-&gt;device_id
op_eq
l_int|0x5
op_logical_or
multiline_comment|/*chip-&gt;_device_id == 0x8 || */
id|chip-&gt;device_id
op_eq
l_int|0xb
)paren
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
op_or_assign
id|MASK_PAROUT
suffix:semicolon
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
l_int|1
comma
id|chip-&gt;awacs_reg
(braket
l_int|1
)braket
)paren
suffix:semicolon
multiline_comment|/* get default volume from nvram */
id|vol
op_assign
(paren
op_complement
id|nvram_read_byte
c_func
(paren
l_int|0x1308
)paren
op_amp
l_int|7
)paren
op_lshift
l_int|1
suffix:semicolon
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
l_int|2
comma
id|vol
op_plus
(paren
id|vol
op_lshift
l_int|6
)paren
)paren
suffix:semicolon
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
l_int|4
comma
id|vol
op_plus
(paren
id|vol
op_lshift
l_int|6
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;model
op_eq
id|PMAC_SCREAMER
)paren
(brace
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
l_int|5
comma
l_int|0
)paren
suffix:semicolon
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
l_int|6
comma
l_int|0
)paren
suffix:semicolon
id|snd_pmac_awacs_write_reg
c_func
(paren
id|chip
comma
l_int|7
comma
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PMAC_PBOOK
multiline_comment|/* Recalibrate chip */
r_if
c_cond
(paren
id|chip-&gt;model
op_eq
id|PMAC_SCREAMER
)paren
id|screamer_recalibrate
c_func
(paren
id|chip
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|chip-&gt;model
op_le
id|PMAC_SCREAMER
op_logical_and
id|chip-&gt;revision
op_eq
l_int|0
)paren
(brace
id|chip-&gt;revision
op_assign
(paren
id|in_le32
c_func
(paren
op_amp
id|chip-&gt;awacs-&gt;codec_stat
)paren
op_rshift
l_int|12
)paren
op_amp
l_int|0xf
suffix:semicolon
r_if
c_cond
(paren
id|chip-&gt;revision
op_eq
l_int|3
)paren
(brace
macro_line|#ifdef PMAC_AMP_AVAIL
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,3,0)
r_if
c_cond
(paren
id|adb_hardware
op_eq
id|ADB_VIACUDA
)paren
id|chip-&gt;amp_only
op_assign
l_int|1
suffix:semicolon
macro_line|#elif defined(CONFIG_ADB_CUDA)
r_if
c_cond
(paren
id|sys_ctrler
op_eq
id|SYS_CTRLER_CUDA
)paren
id|chip-&gt;amp_only
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|chip-&gt;amp_only
)paren
(brace
multiline_comment|/*chip-&gt;amp_vol[0] = chip-&gt;amp_vol[1] = 31;*/
id|snd_pmac_awacs_enable_amp
c_func
(paren
id|chip
comma
id|chip-&gt;amp_vol
(braket
l_int|0
)braket
comma
id|chip-&gt;amp_vol
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
macro_line|#endif /* PMAC_AMP_AVAIL */
)brace
)brace
multiline_comment|/*&n;&t; * build mixers&n;&t; */
id|strcpy
c_func
(paren
id|chip-&gt;card-&gt;mixername
comma
l_string|&quot;PowerMac AWACS&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|build_mixers
c_func
(paren
id|chip
comma
id|num_controls
c_func
(paren
id|snd_pmac_awacs_mixers1
)paren
comma
id|snd_pmac_awacs_mixers1
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
macro_line|#ifdef PMAC_AMP_AVAIL
r_if
c_cond
(paren
id|chip-&gt;amp_only
)paren
(brace
r_if
c_cond
(paren
(paren
id|err
op_assign
id|build_mixers
c_func
(paren
id|chip
comma
id|num_controls
c_func
(paren
id|snd_pmac_awacs_amp_mixers
)paren
comma
id|snd_pmac_awacs_amp_mixers
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
)brace
r_else
(brace
macro_line|#endif /* PMAC_AMP_AVAIL */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|build_mixers
c_func
(paren
id|chip
comma
id|num_controls
c_func
(paren
id|snd_pmac_awacs_speaker_mixers
)paren
comma
id|snd_pmac_awacs_speaker_mixers
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
macro_line|#ifdef PMAC_AMP_AVAIL
)brace
macro_line|#endif /* PMAC_AMP_AVAIL */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|build_mixers
c_func
(paren
id|chip
comma
id|num_controls
c_func
(paren
id|snd_pmac_awacs_mixers2
)paren
comma
id|snd_pmac_awacs_mixers2
)paren
)paren
OL
l_int|0
)paren
r_return
id|err
suffix:semicolon
multiline_comment|/*&n;&t; * set lowlevel callbacks&n;&t; */
id|chip-&gt;set_format
op_assign
id|snd_pmac_awacs_set_format
suffix:semicolon
macro_line|#ifdef CONFIG_PMAC_PBOOK
id|chip-&gt;resume
op_assign
id|snd_pmac_awacs_resume
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
eof
