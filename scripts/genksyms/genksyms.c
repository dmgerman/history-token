multiline_comment|/* Generate kernel symbol version hashes.&n;   Copyright 1996, 1997 Linux International.&n;&n;   New implementation contributed by Richard Henderson &lt;rth@tamu.edu&gt;&n;   Based on original work by Bjorn Ekwall &lt;bj0rn@blox.se&gt;&n;&n;   This file is part of the Linux modutils.&n;&n;   This program is free software; you can redistribute it and/or modify it&n;   under the terms of the GNU General Public License as published by the&n;   Free Software Foundation; either version 2 of the License, or (at your&n;   option) any later version.&n;&n;   This program is distributed in the hope that it will be useful, but&n;   WITHOUT ANY WARRANTY; without even the implied warranty of&n;   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU&n;   General Public License for more details.&n;&n;   You should have received a copy of the GNU General Public License&n;   along with this program; if not, write to the Free Software Foundation,&n;   Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
macro_line|#include &lt;stdio.h&gt;
macro_line|#include &lt;string.h&gt;
macro_line|#include &lt;stdlib.h&gt;
macro_line|#include &lt;unistd.h&gt;
macro_line|#include &lt;assert.h&gt;
macro_line|#include &lt;stdarg.h&gt;
macro_line|#include &lt;getopt.h&gt;
macro_line|#include &quot;genksyms.h&quot;
multiline_comment|/*----------------------------------------------------------------------*/
DECL|macro|HASH_BUCKETS
mdefine_line|#define HASH_BUCKETS  4099
DECL|variable|symtab
r_static
r_struct
id|symbol
op_star
id|symtab
(braket
id|HASH_BUCKETS
)braket
suffix:semicolon
DECL|variable|outfile
DECL|variable|debugfile
id|FILE
op_star
id|outfile
comma
op_star
id|debugfile
suffix:semicolon
DECL|variable|cur_line
r_int
id|cur_line
op_assign
l_int|1
suffix:semicolon
DECL|variable|cur_filename
DECL|variable|output_directory
r_char
op_star
id|cur_filename
comma
op_star
id|output_directory
suffix:semicolon
DECL|variable|flag_debug
DECL|variable|flag_dump_defs
DECL|variable|flag_warnings
r_int
id|flag_debug
comma
id|flag_dump_defs
comma
id|flag_warnings
suffix:semicolon
DECL|variable|checksum_version
DECL|variable|kernel_version
r_int
id|checksum_version
op_assign
l_int|1
comma
id|kernel_version
op_assign
id|version
c_func
(paren
l_int|2
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
DECL|variable|errors
r_static
r_int
id|errors
suffix:semicolon
DECL|variable|nsyms
r_static
r_int
id|nsyms
suffix:semicolon
DECL|variable|expansion_trail
r_static
r_struct
id|symbol
op_star
id|expansion_trail
suffix:semicolon
DECL|variable|crc_prefix
r_static
r_const
r_char
op_star
id|crc_prefix
op_assign
l_string|&quot;&quot;
suffix:semicolon
DECL|variable|symbol_type_name
r_static
r_const
r_char
op_star
r_const
id|symbol_type_name
(braket
)braket
op_assign
(brace
l_string|&quot;normal&quot;
comma
l_string|&quot;typedef&quot;
comma
l_string|&quot;enum&quot;
comma
l_string|&quot;struct&quot;
comma
l_string|&quot;union&quot;
)brace
suffix:semicolon
multiline_comment|/*----------------------------------------------------------------------*/
DECL|variable|crctab32
r_static
r_const
r_int
r_int
id|crctab32
(braket
)braket
op_assign
(brace
l_int|0x00000000U
comma
l_int|0x77073096U
comma
l_int|0xee0e612cU
comma
l_int|0x990951baU
comma
l_int|0x076dc419U
comma
l_int|0x706af48fU
comma
l_int|0xe963a535U
comma
l_int|0x9e6495a3U
comma
l_int|0x0edb8832U
comma
l_int|0x79dcb8a4U
comma
l_int|0xe0d5e91eU
comma
l_int|0x97d2d988U
comma
l_int|0x09b64c2bU
comma
l_int|0x7eb17cbdU
comma
l_int|0xe7b82d07U
comma
l_int|0x90bf1d91U
comma
l_int|0x1db71064U
comma
l_int|0x6ab020f2U
comma
l_int|0xf3b97148U
comma
l_int|0x84be41deU
comma
l_int|0x1adad47dU
comma
l_int|0x6ddde4ebU
comma
l_int|0xf4d4b551U
comma
l_int|0x83d385c7U
comma
l_int|0x136c9856U
comma
l_int|0x646ba8c0U
comma
l_int|0xfd62f97aU
comma
l_int|0x8a65c9ecU
comma
l_int|0x14015c4fU
comma
l_int|0x63066cd9U
comma
l_int|0xfa0f3d63U
comma
l_int|0x8d080df5U
comma
l_int|0x3b6e20c8U
comma
l_int|0x4c69105eU
comma
l_int|0xd56041e4U
comma
l_int|0xa2677172U
comma
l_int|0x3c03e4d1U
comma
l_int|0x4b04d447U
comma
l_int|0xd20d85fdU
comma
l_int|0xa50ab56bU
comma
l_int|0x35b5a8faU
comma
l_int|0x42b2986cU
comma
l_int|0xdbbbc9d6U
comma
l_int|0xacbcf940U
comma
l_int|0x32d86ce3U
comma
l_int|0x45df5c75U
comma
l_int|0xdcd60dcfU
comma
l_int|0xabd13d59U
comma
l_int|0x26d930acU
comma
l_int|0x51de003aU
comma
l_int|0xc8d75180U
comma
l_int|0xbfd06116U
comma
l_int|0x21b4f4b5U
comma
l_int|0x56b3c423U
comma
l_int|0xcfba9599U
comma
l_int|0xb8bda50fU
comma
l_int|0x2802b89eU
comma
l_int|0x5f058808U
comma
l_int|0xc60cd9b2U
comma
l_int|0xb10be924U
comma
l_int|0x2f6f7c87U
comma
l_int|0x58684c11U
comma
l_int|0xc1611dabU
comma
l_int|0xb6662d3dU
comma
l_int|0x76dc4190U
comma
l_int|0x01db7106U
comma
l_int|0x98d220bcU
comma
l_int|0xefd5102aU
comma
l_int|0x71b18589U
comma
l_int|0x06b6b51fU
comma
l_int|0x9fbfe4a5U
comma
l_int|0xe8b8d433U
comma
l_int|0x7807c9a2U
comma
l_int|0x0f00f934U
comma
l_int|0x9609a88eU
comma
l_int|0xe10e9818U
comma
l_int|0x7f6a0dbbU
comma
l_int|0x086d3d2dU
comma
l_int|0x91646c97U
comma
l_int|0xe6635c01U
comma
l_int|0x6b6b51f4U
comma
l_int|0x1c6c6162U
comma
l_int|0x856530d8U
comma
l_int|0xf262004eU
comma
l_int|0x6c0695edU
comma
l_int|0x1b01a57bU
comma
l_int|0x8208f4c1U
comma
l_int|0xf50fc457U
comma
l_int|0x65b0d9c6U
comma
l_int|0x12b7e950U
comma
l_int|0x8bbeb8eaU
comma
l_int|0xfcb9887cU
comma
l_int|0x62dd1ddfU
comma
l_int|0x15da2d49U
comma
l_int|0x8cd37cf3U
comma
l_int|0xfbd44c65U
comma
l_int|0x4db26158U
comma
l_int|0x3ab551ceU
comma
l_int|0xa3bc0074U
comma
l_int|0xd4bb30e2U
comma
l_int|0x4adfa541U
comma
l_int|0x3dd895d7U
comma
l_int|0xa4d1c46dU
comma
l_int|0xd3d6f4fbU
comma
l_int|0x4369e96aU
comma
l_int|0x346ed9fcU
comma
l_int|0xad678846U
comma
l_int|0xda60b8d0U
comma
l_int|0x44042d73U
comma
l_int|0x33031de5U
comma
l_int|0xaa0a4c5fU
comma
l_int|0xdd0d7cc9U
comma
l_int|0x5005713cU
comma
l_int|0x270241aaU
comma
l_int|0xbe0b1010U
comma
l_int|0xc90c2086U
comma
l_int|0x5768b525U
comma
l_int|0x206f85b3U
comma
l_int|0xb966d409U
comma
l_int|0xce61e49fU
comma
l_int|0x5edef90eU
comma
l_int|0x29d9c998U
comma
l_int|0xb0d09822U
comma
l_int|0xc7d7a8b4U
comma
l_int|0x59b33d17U
comma
l_int|0x2eb40d81U
comma
l_int|0xb7bd5c3bU
comma
l_int|0xc0ba6cadU
comma
l_int|0xedb88320U
comma
l_int|0x9abfb3b6U
comma
l_int|0x03b6e20cU
comma
l_int|0x74b1d29aU
comma
l_int|0xead54739U
comma
l_int|0x9dd277afU
comma
l_int|0x04db2615U
comma
l_int|0x73dc1683U
comma
l_int|0xe3630b12U
comma
l_int|0x94643b84U
comma
l_int|0x0d6d6a3eU
comma
l_int|0x7a6a5aa8U
comma
l_int|0xe40ecf0bU
comma
l_int|0x9309ff9dU
comma
l_int|0x0a00ae27U
comma
l_int|0x7d079eb1U
comma
l_int|0xf00f9344U
comma
l_int|0x8708a3d2U
comma
l_int|0x1e01f268U
comma
l_int|0x6906c2feU
comma
l_int|0xf762575dU
comma
l_int|0x806567cbU
comma
l_int|0x196c3671U
comma
l_int|0x6e6b06e7U
comma
l_int|0xfed41b76U
comma
l_int|0x89d32be0U
comma
l_int|0x10da7a5aU
comma
l_int|0x67dd4accU
comma
l_int|0xf9b9df6fU
comma
l_int|0x8ebeeff9U
comma
l_int|0x17b7be43U
comma
l_int|0x60b08ed5U
comma
l_int|0xd6d6a3e8U
comma
l_int|0xa1d1937eU
comma
l_int|0x38d8c2c4U
comma
l_int|0x4fdff252U
comma
l_int|0xd1bb67f1U
comma
l_int|0xa6bc5767U
comma
l_int|0x3fb506ddU
comma
l_int|0x48b2364bU
comma
l_int|0xd80d2bdaU
comma
l_int|0xaf0a1b4cU
comma
l_int|0x36034af6U
comma
l_int|0x41047a60U
comma
l_int|0xdf60efc3U
comma
l_int|0xa867df55U
comma
l_int|0x316e8eefU
comma
l_int|0x4669be79U
comma
l_int|0xcb61b38cU
comma
l_int|0xbc66831aU
comma
l_int|0x256fd2a0U
comma
l_int|0x5268e236U
comma
l_int|0xcc0c7795U
comma
l_int|0xbb0b4703U
comma
l_int|0x220216b9U
comma
l_int|0x5505262fU
comma
l_int|0xc5ba3bbeU
comma
l_int|0xb2bd0b28U
comma
l_int|0x2bb45a92U
comma
l_int|0x5cb36a04U
comma
l_int|0xc2d7ffa7U
comma
l_int|0xb5d0cf31U
comma
l_int|0x2cd99e8bU
comma
l_int|0x5bdeae1dU
comma
l_int|0x9b64c2b0U
comma
l_int|0xec63f226U
comma
l_int|0x756aa39cU
comma
l_int|0x026d930aU
comma
l_int|0x9c0906a9U
comma
l_int|0xeb0e363fU
comma
l_int|0x72076785U
comma
l_int|0x05005713U
comma
l_int|0x95bf4a82U
comma
l_int|0xe2b87a14U
comma
l_int|0x7bb12baeU
comma
l_int|0x0cb61b38U
comma
l_int|0x92d28e9bU
comma
l_int|0xe5d5be0dU
comma
l_int|0x7cdcefb7U
comma
l_int|0x0bdbdf21U
comma
l_int|0x86d3d2d4U
comma
l_int|0xf1d4e242U
comma
l_int|0x68ddb3f8U
comma
l_int|0x1fda836eU
comma
l_int|0x81be16cdU
comma
l_int|0xf6b9265bU
comma
l_int|0x6fb077e1U
comma
l_int|0x18b74777U
comma
l_int|0x88085ae6U
comma
l_int|0xff0f6a70U
comma
l_int|0x66063bcaU
comma
l_int|0x11010b5cU
comma
l_int|0x8f659effU
comma
l_int|0xf862ae69U
comma
l_int|0x616bffd3U
comma
l_int|0x166ccf45U
comma
l_int|0xa00ae278U
comma
l_int|0xd70dd2eeU
comma
l_int|0x4e048354U
comma
l_int|0x3903b3c2U
comma
l_int|0xa7672661U
comma
l_int|0xd06016f7U
comma
l_int|0x4969474dU
comma
l_int|0x3e6e77dbU
comma
l_int|0xaed16a4aU
comma
l_int|0xd9d65adcU
comma
l_int|0x40df0b66U
comma
l_int|0x37d83bf0U
comma
l_int|0xa9bcae53U
comma
l_int|0xdebb9ec5U
comma
l_int|0x47b2cf7fU
comma
l_int|0x30b5ffe9U
comma
l_int|0xbdbdf21cU
comma
l_int|0xcabac28aU
comma
l_int|0x53b39330U
comma
l_int|0x24b4a3a6U
comma
l_int|0xbad03605U
comma
l_int|0xcdd70693U
comma
l_int|0x54de5729U
comma
l_int|0x23d967bfU
comma
l_int|0xb3667a2eU
comma
l_int|0xc4614ab8U
comma
l_int|0x5d681b02U
comma
l_int|0x2a6f2b94U
comma
l_int|0xb40bbe37U
comma
l_int|0xc30c8ea1U
comma
l_int|0x5a05df1bU
comma
l_int|0x2d02ef8dU
)brace
suffix:semicolon
r_static
r_inline
r_int
r_int
DECL|function|partial_crc32_one
id|partial_crc32_one
c_func
(paren
r_int
r_char
id|c
comma
r_int
r_int
id|crc
)paren
(brace
r_return
id|crctab32
(braket
(paren
id|crc
op_xor
id|c
)paren
op_amp
l_int|0xff
)braket
op_xor
(paren
id|crc
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
r_static
r_inline
r_int
r_int
DECL|function|partial_crc32
id|partial_crc32
c_func
(paren
r_const
r_char
op_star
id|s
comma
r_int
r_int
id|crc
)paren
(brace
r_while
c_loop
(paren
op_star
id|s
)paren
id|crc
op_assign
id|partial_crc32_one
c_func
(paren
op_star
id|s
op_increment
comma
id|crc
)paren
suffix:semicolon
r_return
id|crc
suffix:semicolon
)brace
r_static
r_inline
r_int
r_int
DECL|function|crc32
id|crc32
c_func
(paren
r_const
r_char
op_star
id|s
)paren
(brace
r_return
id|partial_crc32
c_func
(paren
id|s
comma
l_int|0xffffffff
)paren
op_xor
l_int|0xffffffff
suffix:semicolon
)brace
multiline_comment|/*----------------------------------------------------------------------*/
r_static
r_inline
r_enum
id|symbol_type
DECL|function|map_to_ns
id|map_to_ns
c_func
(paren
r_enum
id|symbol_type
id|t
)paren
(brace
r_if
c_cond
(paren
id|t
op_eq
id|SYM_TYPEDEF
)paren
id|t
op_assign
id|SYM_NORMAL
suffix:semicolon
r_else
r_if
c_cond
(paren
id|t
op_eq
id|SYM_UNION
)paren
id|t
op_assign
id|SYM_STRUCT
suffix:semicolon
r_return
id|t
suffix:semicolon
)brace
r_struct
id|symbol
op_star
DECL|function|find_symbol
id|find_symbol
c_func
(paren
r_const
r_char
op_star
id|name
comma
r_enum
id|symbol_type
id|ns
)paren
(brace
r_int
r_int
id|h
op_assign
id|crc32
c_func
(paren
id|name
)paren
op_mod
id|HASH_BUCKETS
suffix:semicolon
r_struct
id|symbol
op_star
id|sym
suffix:semicolon
r_for
c_loop
(paren
id|sym
op_assign
id|symtab
(braket
id|h
)braket
suffix:semicolon
id|sym
suffix:semicolon
id|sym
op_assign
id|sym-&gt;hash_next
)paren
r_if
c_cond
(paren
id|map_to_ns
c_func
(paren
id|sym-&gt;type
)paren
op_eq
id|map_to_ns
c_func
(paren
id|ns
)paren
op_logical_and
id|strcmp
c_func
(paren
id|name
comma
id|sym-&gt;name
)paren
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_return
id|sym
suffix:semicolon
)brace
r_struct
id|symbol
op_star
DECL|function|add_symbol
id|add_symbol
c_func
(paren
r_const
r_char
op_star
id|name
comma
r_enum
id|symbol_type
id|type
comma
r_struct
id|string_list
op_star
id|defn
comma
r_int
id|is_extern
)paren
(brace
r_int
r_int
id|h
op_assign
id|crc32
c_func
(paren
id|name
)paren
op_mod
id|HASH_BUCKETS
suffix:semicolon
r_struct
id|symbol
op_star
id|sym
suffix:semicolon
r_for
c_loop
(paren
id|sym
op_assign
id|symtab
(braket
id|h
)braket
suffix:semicolon
id|sym
suffix:semicolon
id|sym
op_assign
id|sym-&gt;hash_next
)paren
r_if
c_cond
(paren
id|map_to_ns
c_func
(paren
id|sym-&gt;type
)paren
op_eq
id|map_to_ns
c_func
(paren
id|type
)paren
op_logical_and
id|strcmp
c_func
(paren
id|name
comma
id|sym-&gt;name
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|equal_list
c_func
(paren
id|sym-&gt;defn
comma
id|defn
)paren
)paren
id|error_with_pos
c_func
(paren
l_string|&quot;redefinition of %s&quot;
comma
id|name
)paren
suffix:semicolon
r_return
id|sym
suffix:semicolon
)brace
id|sym
op_assign
id|xmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|sym
)paren
)paren
suffix:semicolon
id|sym-&gt;name
op_assign
id|name
suffix:semicolon
id|sym-&gt;type
op_assign
id|type
suffix:semicolon
id|sym-&gt;defn
op_assign
id|defn
suffix:semicolon
id|sym-&gt;expansion_trail
op_assign
l_int|NULL
suffix:semicolon
id|sym-&gt;is_extern
op_assign
id|is_extern
suffix:semicolon
id|sym-&gt;hash_next
op_assign
id|symtab
(braket
id|h
)braket
suffix:semicolon
id|symtab
(braket
id|h
)braket
op_assign
id|sym
suffix:semicolon
r_if
c_cond
(paren
id|flag_debug
)paren
(brace
id|fprintf
c_func
(paren
id|debugfile
comma
l_string|&quot;Defn for %s %s == &lt;&quot;
comma
id|symbol_type_name
(braket
id|type
)braket
comma
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is_extern
)paren
id|fputs
c_func
(paren
l_string|&quot;extern &quot;
comma
id|debugfile
)paren
suffix:semicolon
id|print_list
c_func
(paren
id|debugfile
comma
id|defn
)paren
suffix:semicolon
id|fputs
c_func
(paren
l_string|&quot;&gt;&bslash;n&quot;
comma
id|debugfile
)paren
suffix:semicolon
)brace
op_increment
id|nsyms
suffix:semicolon
r_return
id|sym
suffix:semicolon
)brace
multiline_comment|/*----------------------------------------------------------------------*/
r_inline
r_void
DECL|function|free_node
id|free_node
c_func
(paren
r_struct
id|string_list
op_star
id|node
)paren
(brace
id|free
c_func
(paren
id|node-&gt;string
)paren
suffix:semicolon
id|free
c_func
(paren
id|node
)paren
suffix:semicolon
)brace
r_void
DECL|function|free_list
id|free_list
c_func
(paren
r_struct
id|string_list
op_star
id|s
comma
r_struct
id|string_list
op_star
id|e
)paren
(brace
r_while
c_loop
(paren
id|s
op_ne
id|e
)paren
(brace
r_struct
id|string_list
op_star
id|next
op_assign
id|s-&gt;next
suffix:semicolon
id|free_node
c_func
(paren
id|s
)paren
suffix:semicolon
id|s
op_assign
id|next
suffix:semicolon
)brace
)brace
r_inline
r_struct
id|string_list
op_star
DECL|function|copy_node
id|copy_node
c_func
(paren
r_struct
id|string_list
op_star
id|node
)paren
(brace
r_struct
id|string_list
op_star
id|newnode
suffix:semicolon
id|newnode
op_assign
id|xmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|newnode
)paren
)paren
suffix:semicolon
id|newnode-&gt;string
op_assign
id|xstrdup
c_func
(paren
id|node-&gt;string
)paren
suffix:semicolon
id|newnode-&gt;tag
op_assign
id|node-&gt;tag
suffix:semicolon
r_return
id|newnode
suffix:semicolon
)brace
r_struct
id|string_list
op_star
DECL|function|copy_list
id|copy_list
c_func
(paren
r_struct
id|string_list
op_star
id|s
comma
r_struct
id|string_list
op_star
id|e
)paren
(brace
r_struct
id|string_list
op_star
id|h
comma
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
id|s
op_eq
id|e
)paren
r_return
l_int|NULL
suffix:semicolon
id|p
op_assign
id|h
op_assign
id|copy_node
c_func
(paren
id|s
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|s
op_assign
id|s-&gt;next
)paren
op_ne
id|e
)paren
id|p
op_assign
id|p-&gt;next
op_assign
id|copy_node
c_func
(paren
id|s
)paren
suffix:semicolon
id|p-&gt;next
op_assign
l_int|NULL
suffix:semicolon
r_return
id|h
suffix:semicolon
)brace
r_int
DECL|function|equal_list
id|equal_list
c_func
(paren
r_struct
id|string_list
op_star
id|a
comma
r_struct
id|string_list
op_star
id|b
)paren
(brace
r_while
c_loop
(paren
id|a
op_logical_and
id|b
)paren
(brace
r_if
c_cond
(paren
id|a-&gt;tag
op_ne
id|b-&gt;tag
op_logical_or
id|strcmp
c_func
(paren
id|a-&gt;string
comma
id|b-&gt;string
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|a
op_assign
id|a-&gt;next
suffix:semicolon
id|b
op_assign
id|b-&gt;next
suffix:semicolon
)brace
r_return
op_logical_neg
id|a
op_logical_and
op_logical_neg
id|b
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|print_node
id|print_node
c_func
(paren
id|FILE
op_star
id|f
comma
r_struct
id|string_list
op_star
id|list
)paren
(brace
r_switch
c_cond
(paren
id|list-&gt;tag
)paren
(brace
r_case
id|SYM_STRUCT
suffix:colon
id|putc
c_func
(paren
l_char|&squot;s&squot;
comma
id|f
)paren
suffix:semicolon
r_goto
id|printit
suffix:semicolon
r_case
id|SYM_UNION
suffix:colon
id|putc
c_func
(paren
l_char|&squot;u&squot;
comma
id|f
)paren
suffix:semicolon
r_goto
id|printit
suffix:semicolon
r_case
id|SYM_ENUM
suffix:colon
id|putc
c_func
(paren
l_char|&squot;e&squot;
comma
id|f
)paren
suffix:semicolon
r_goto
id|printit
suffix:semicolon
r_case
id|SYM_TYPEDEF
suffix:colon
id|putc
c_func
(paren
l_char|&squot;t&squot;
comma
id|f
)paren
suffix:semicolon
r_goto
id|printit
suffix:semicolon
id|printit
suffix:colon
id|putc
c_func
(paren
l_char|&squot;#&squot;
comma
id|f
)paren
suffix:semicolon
r_case
id|SYM_NORMAL
suffix:colon
id|fputs
c_func
(paren
id|list-&gt;string
comma
id|f
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_void
DECL|function|print_list
id|print_list
c_func
(paren
id|FILE
op_star
id|f
comma
r_struct
id|string_list
op_star
id|list
)paren
(brace
r_struct
id|string_list
op_star
op_star
id|e
comma
op_star
op_star
id|b
suffix:semicolon
r_struct
id|string_list
op_star
id|tmp
comma
op_star
op_star
id|tmp2
suffix:semicolon
r_int
id|elem
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|list
op_eq
l_int|NULL
)paren
(brace
id|fputs
c_func
(paren
l_string|&quot;(nil)&quot;
comma
id|f
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|tmp
op_assign
id|list
suffix:semicolon
r_while
c_loop
(paren
(paren
id|tmp
op_assign
id|tmp-&gt;next
)paren
op_ne
l_int|NULL
)paren
(brace
id|elem
op_increment
suffix:semicolon
)brace
id|b
op_assign
id|alloca
c_func
(paren
id|elem
op_star
r_sizeof
(paren
op_star
id|e
)paren
)paren
suffix:semicolon
id|e
op_assign
id|b
op_plus
id|elem
suffix:semicolon
id|tmp2
op_assign
id|e
op_minus
l_int|1
suffix:semicolon
(paren
op_star
id|tmp2
op_decrement
)paren
op_assign
id|list
suffix:semicolon
r_while
c_loop
(paren
(paren
id|list
op_assign
id|list-&gt;next
)paren
op_ne
l_int|NULL
)paren
(brace
op_star
(paren
id|tmp2
op_decrement
)paren
op_assign
id|list
suffix:semicolon
)brace
r_while
c_loop
(paren
id|b
op_ne
id|e
)paren
(brace
id|print_node
c_func
(paren
id|f
comma
op_star
id|b
op_increment
)paren
suffix:semicolon
id|putc
c_func
(paren
l_char|&squot; &squot;
comma
id|f
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
r_int
DECL|function|expand_and_crc_list
id|expand_and_crc_list
c_func
(paren
r_struct
id|string_list
op_star
id|list
comma
r_int
r_int
id|crc
)paren
(brace
r_struct
id|string_list
op_star
op_star
id|e
comma
op_star
op_star
id|b
suffix:semicolon
r_struct
id|string_list
op_star
id|tmp
comma
op_star
op_star
id|tmp2
suffix:semicolon
r_int
id|elem
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|list
)paren
r_return
id|crc
suffix:semicolon
id|tmp
op_assign
id|list
suffix:semicolon
r_while
c_loop
(paren
(paren
id|tmp
op_assign
id|tmp-&gt;next
)paren
op_ne
l_int|NULL
)paren
(brace
id|elem
op_increment
suffix:semicolon
)brace
id|b
op_assign
id|alloca
c_func
(paren
id|elem
op_star
r_sizeof
(paren
op_star
id|e
)paren
)paren
suffix:semicolon
id|e
op_assign
id|b
op_plus
id|elem
suffix:semicolon
id|tmp2
op_assign
id|e
op_minus
l_int|1
suffix:semicolon
op_star
(paren
id|tmp2
op_decrement
)paren
op_assign
id|list
suffix:semicolon
r_while
c_loop
(paren
(paren
id|list
op_assign
id|list-&gt;next
)paren
op_ne
l_int|NULL
)paren
op_star
(paren
id|tmp2
op_decrement
)paren
op_assign
id|list
suffix:semicolon
r_while
c_loop
(paren
id|b
op_ne
id|e
)paren
(brace
r_struct
id|string_list
op_star
id|cur
suffix:semicolon
r_struct
id|symbol
op_star
id|subsym
suffix:semicolon
id|cur
op_assign
op_star
(paren
id|b
op_increment
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cur-&gt;tag
)paren
(brace
r_case
id|SYM_NORMAL
suffix:colon
r_if
c_cond
(paren
id|flag_dump_defs
)paren
id|fprintf
c_func
(paren
id|debugfile
comma
l_string|&quot;%s &quot;
comma
id|cur-&gt;string
)paren
suffix:semicolon
id|crc
op_assign
id|partial_crc32
c_func
(paren
id|cur-&gt;string
comma
id|crc
)paren
suffix:semicolon
id|crc
op_assign
id|partial_crc32_one
c_func
(paren
l_char|&squot; &squot;
comma
id|crc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SYM_TYPEDEF
suffix:colon
id|subsym
op_assign
id|find_symbol
c_func
(paren
id|cur-&gt;string
comma
id|cur-&gt;tag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|checksum_version
op_eq
l_int|1
)paren
id|crc
op_assign
id|expand_and_crc_list
c_func
(paren
id|subsym-&gt;defn
comma
id|crc
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|subsym-&gt;expansion_trail
)paren
(brace
r_if
c_cond
(paren
id|flag_dump_defs
)paren
id|fprintf
c_func
(paren
id|debugfile
comma
l_string|&quot;%s &quot;
comma
id|cur-&gt;string
)paren
suffix:semicolon
id|crc
op_assign
id|partial_crc32
c_func
(paren
id|cur-&gt;string
comma
id|crc
)paren
suffix:semicolon
id|crc
op_assign
id|partial_crc32_one
c_func
(paren
l_char|&squot; &squot;
comma
id|crc
)paren
suffix:semicolon
)brace
r_else
(brace
id|subsym-&gt;expansion_trail
op_assign
id|expansion_trail
suffix:semicolon
id|expansion_trail
op_assign
id|subsym
suffix:semicolon
id|crc
op_assign
id|expand_and_crc_list
c_func
(paren
id|subsym-&gt;defn
comma
id|crc
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|SYM_STRUCT
suffix:colon
r_case
id|SYM_UNION
suffix:colon
r_case
id|SYM_ENUM
suffix:colon
id|subsym
op_assign
id|find_symbol
c_func
(paren
id|cur-&gt;string
comma
id|cur-&gt;tag
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|subsym
)paren
(brace
r_struct
id|string_list
op_star
id|n
comma
op_star
id|t
op_assign
l_int|NULL
suffix:semicolon
id|error_with_pos
c_func
(paren
l_string|&quot;expand undefined %s %s&quot;
comma
id|symbol_type_name
(braket
id|cur-&gt;tag
)braket
comma
id|cur-&gt;string
)paren
suffix:semicolon
id|n
op_assign
id|xmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|n
)paren
)paren
suffix:semicolon
id|n-&gt;string
op_assign
id|xstrdup
c_func
(paren
id|symbol_type_name
(braket
id|cur-&gt;tag
)braket
)paren
suffix:semicolon
id|n-&gt;tag
op_assign
id|SYM_NORMAL
suffix:semicolon
id|n-&gt;next
op_assign
id|t
suffix:semicolon
id|t
op_assign
id|n
suffix:semicolon
id|n
op_assign
id|xmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|n
)paren
)paren
suffix:semicolon
id|n-&gt;string
op_assign
id|xstrdup
c_func
(paren
id|cur-&gt;string
)paren
suffix:semicolon
id|n-&gt;tag
op_assign
id|SYM_NORMAL
suffix:semicolon
id|n-&gt;next
op_assign
id|t
suffix:semicolon
id|t
op_assign
id|n
suffix:semicolon
id|n
op_assign
id|xmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|n
)paren
)paren
suffix:semicolon
id|n-&gt;string
op_assign
id|xstrdup
c_func
(paren
l_string|&quot;{ UNKNOWN }&quot;
)paren
suffix:semicolon
id|n-&gt;tag
op_assign
id|SYM_NORMAL
suffix:semicolon
id|n-&gt;next
op_assign
id|t
suffix:semicolon
id|subsym
op_assign
id|add_symbol
c_func
(paren
id|cur-&gt;string
comma
id|cur-&gt;tag
comma
id|n
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|subsym-&gt;expansion_trail
)paren
(brace
r_if
c_cond
(paren
id|flag_dump_defs
)paren
(brace
id|fprintf
c_func
(paren
id|debugfile
comma
l_string|&quot;%s %s &quot;
comma
id|symbol_type_name
(braket
id|cur-&gt;tag
)braket
comma
id|cur-&gt;string
)paren
suffix:semicolon
)brace
id|crc
op_assign
id|partial_crc32
c_func
(paren
id|symbol_type_name
(braket
id|cur-&gt;tag
)braket
comma
id|crc
)paren
suffix:semicolon
id|crc
op_assign
id|partial_crc32_one
c_func
(paren
l_char|&squot; &squot;
comma
id|crc
)paren
suffix:semicolon
id|crc
op_assign
id|partial_crc32
c_func
(paren
id|cur-&gt;string
comma
id|crc
)paren
suffix:semicolon
id|crc
op_assign
id|partial_crc32_one
c_func
(paren
l_char|&squot; &squot;
comma
id|crc
)paren
suffix:semicolon
)brace
r_else
(brace
id|subsym-&gt;expansion_trail
op_assign
id|expansion_trail
suffix:semicolon
id|expansion_trail
op_assign
id|subsym
suffix:semicolon
id|crc
op_assign
id|expand_and_crc_list
c_func
(paren
id|subsym-&gt;defn
comma
id|crc
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
r_return
id|crc
suffix:semicolon
)brace
r_void
DECL|function|export_symbol
id|export_symbol
c_func
(paren
r_const
r_char
op_star
id|name
)paren
(brace
r_struct
id|symbol
op_star
id|sym
suffix:semicolon
id|sym
op_assign
id|find_symbol
c_func
(paren
id|name
comma
id|SYM_NORMAL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sym
)paren
id|error_with_pos
c_func
(paren
l_string|&quot;export undefined symbol %s&quot;
comma
id|name
)paren
suffix:semicolon
r_else
(brace
r_int
r_int
id|crc
suffix:semicolon
r_if
c_cond
(paren
id|flag_dump_defs
)paren
id|fprintf
c_func
(paren
id|debugfile
comma
l_string|&quot;Export %s == &lt;&quot;
comma
id|name
)paren
suffix:semicolon
id|expansion_trail
op_assign
(paren
r_struct
id|symbol
op_star
)paren
op_minus
l_int|1L
suffix:semicolon
id|crc
op_assign
id|expand_and_crc_list
c_func
(paren
id|sym-&gt;defn
comma
l_int|0xffffffff
)paren
op_xor
l_int|0xffffffff
suffix:semicolon
id|sym
op_assign
id|expansion_trail
suffix:semicolon
r_while
c_loop
(paren
id|sym
op_ne
(paren
r_struct
id|symbol
op_star
)paren
op_minus
l_int|1L
)paren
(brace
r_struct
id|symbol
op_star
id|n
op_assign
id|sym-&gt;expansion_trail
suffix:semicolon
id|sym-&gt;expansion_trail
op_assign
l_int|0
suffix:semicolon
id|sym
op_assign
id|n
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flag_dump_defs
)paren
id|fputs
c_func
(paren
l_string|&quot;&gt;&bslash;n&quot;
comma
id|debugfile
)paren
suffix:semicolon
r_if
c_cond
(paren
id|checksum_version
OG
l_int|1
)paren
(brace
id|fprintf
c_func
(paren
id|outfile
comma
l_string|&quot;#define __ver_%s&bslash;t%s%08lx&bslash;n&quot;
comma
id|name
comma
id|crc_prefix
comma
id|crc
)paren
suffix:semicolon
id|fprintf
c_func
(paren
id|outfile
comma
l_string|&quot;#define %s&bslash;t_set_ver(%s)&bslash;n&quot;
comma
id|name
comma
id|name
)paren
suffix:semicolon
)brace
r_else
(brace
id|fprintf
c_func
(paren
id|outfile
comma
l_string|&quot;#define %s&bslash;t_set_ver(%s, %s%08lx)&bslash;n&quot;
comma
id|name
comma
id|name
comma
id|crc_prefix
comma
id|crc
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*----------------------------------------------------------------------*/
r_static
r_int
DECL|function|parse_kernel_version
id|parse_kernel_version
c_func
(paren
r_char
op_star
id|p
)paren
(brace
r_int
id|a
comma
id|b
comma
id|c
suffix:semicolon
id|a
op_assign
id|strtoul
c_func
(paren
id|p
comma
op_amp
id|p
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|p
op_ne
l_char|&squot;.&squot;
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|b
op_assign
id|strtoul
c_func
(paren
id|p
op_plus
l_int|1
comma
op_amp
id|p
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|p
op_ne
l_char|&squot;.&squot;
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|c
op_assign
id|strtoul
c_func
(paren
id|p
op_plus
l_int|1
comma
op_amp
id|p
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|p
op_ne
l_char|&squot;&bslash;0&squot;
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|kernel_version
op_assign
id|a
op_lshift
l_int|16
op_or
id|b
op_lshift
l_int|8
op_or
id|c
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|error
id|error
c_func
(paren
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
r_if
c_cond
(paren
id|flag_warnings
)paren
(brace
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|vfprintf
c_func
(paren
id|stderr
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
id|putc
c_func
(paren
l_char|&squot;&bslash;n&squot;
comma
id|stderr
)paren
suffix:semicolon
id|errors
op_increment
suffix:semicolon
)brace
)brace
r_void
DECL|function|error_with_pos
id|error_with_pos
c_func
(paren
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
r_if
c_cond
(paren
id|flag_warnings
)paren
(brace
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;%s:%d: &quot;
comma
id|cur_filename
ques
c_cond
suffix:colon
l_string|&quot;&lt;stdin&gt;&quot;
comma
id|cur_line
)paren
suffix:semicolon
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|vfprintf
c_func
(paren
id|stderr
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
id|putc
c_func
(paren
l_char|&squot;&bslash;n&squot;
comma
id|stderr
)paren
suffix:semicolon
id|errors
op_increment
suffix:semicolon
)brace
)brace
DECL|function|genksyms_usage
r_void
id|genksyms_usage
c_func
(paren
r_void
)paren
(brace
id|fputs
c_func
(paren
l_string|&quot;Usage:&bslash;n&quot;
l_string|&quot;genksyms [-dDwqhV] [-k kernel_version] [-p prefix] &gt; .../linux/module/*.ver&bslash;n&quot;
l_string|&quot;&bslash;n&quot;
l_string|&quot;  -d, --debug           Increment the debug level (repeatable)&bslash;n&quot;
l_string|&quot;  -D, --dump            Dump expanded symbol defs (for debugging only)&bslash;n&quot;
l_string|&quot;  -w, --warnings        Enable warnings&bslash;n&quot;
l_string|&quot;  -q, --quiet           Disable warnings (default)&bslash;n&quot;
l_string|&quot;  -h, --help            Print this message&bslash;n&quot;
l_string|&quot;  -V, --version         Print the release version&bslash;n&quot;
l_string|&quot;  -k ver&bslash;n&quot;
l_string|&quot;       --kernel ver     Set the kernel version for which we are compiling&bslash;n&quot;
l_string|&quot;  -p string&bslash;n&quot;
l_string|&quot;       --prefix string  Set a mangling prefix for all symbols&bslash;n&quot;
comma
id|stderr
)paren
suffix:semicolon
)brace
r_int
DECL|function|main
id|main
c_func
(paren
r_int
id|argc
comma
r_char
op_star
op_star
id|argv
)paren
(brace
r_int
id|o
suffix:semicolon
r_struct
id|option
id|long_opts
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;debug&quot;
comma
l_int|0
comma
l_int|0
comma
l_char|&squot;d&squot;
)brace
comma
(brace
l_string|&quot;warnings&quot;
comma
l_int|0
comma
l_int|0
comma
l_char|&squot;w&squot;
)brace
comma
(brace
l_string|&quot;quiet&quot;
comma
l_int|0
comma
l_int|0
comma
l_char|&squot;q&squot;
)brace
comma
(brace
l_string|&quot;dump&quot;
comma
l_int|0
comma
l_int|0
comma
l_char|&squot;D&squot;
)brace
comma
(brace
l_string|&quot;kernel&quot;
comma
l_int|1
comma
l_int|0
comma
l_char|&squot;k&squot;
)brace
comma
(brace
l_string|&quot;prefix&quot;
comma
l_int|1
comma
l_int|0
comma
l_char|&squot;p&squot;
)brace
comma
(brace
l_string|&quot;version&quot;
comma
l_int|0
comma
l_int|0
comma
l_char|&squot;V&squot;
)brace
comma
(brace
l_string|&quot;help&quot;
comma
l_int|0
comma
l_int|0
comma
l_char|&squot;h&squot;
)brace
comma
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
)brace
suffix:semicolon
r_while
c_loop
(paren
(paren
id|o
op_assign
id|getopt_long
c_func
(paren
id|argc
comma
id|argv
comma
l_string|&quot;dwqVDk:p:&quot;
comma
op_amp
id|long_opts
(braket
l_int|0
)braket
comma
l_int|NULL
)paren
)paren
op_ne
id|EOF
)paren
r_switch
c_cond
(paren
id|o
)paren
(brace
r_case
l_char|&squot;d&squot;
suffix:colon
id|flag_debug
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;w&squot;
suffix:colon
id|flag_warnings
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;q&squot;
suffix:colon
id|flag_warnings
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;V&squot;
suffix:colon
id|fputs
c_func
(paren
l_string|&quot;genksyms version &quot;
id|MODUTILS_VERSION
l_string|&quot;&bslash;n&quot;
comma
id|stderr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;D&squot;
suffix:colon
id|flag_dump_defs
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;k&squot;
suffix:colon
r_if
c_cond
(paren
id|parse_kernel_version
c_func
(paren
id|optarg
)paren
)paren
(brace
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;unrecognised kernel version : %s&bslash;n&quot;
comma
id|optarg
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_char|&squot;p&squot;
suffix:colon
id|crc_prefix
op_assign
id|optarg
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;h&squot;
suffix:colon
id|genksyms_usage
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
id|genksyms_usage
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|kernel_version
op_ge
id|version
c_func
(paren
l_int|2
comma
l_int|1
comma
l_int|18
)paren
)paren
(brace
r_if
c_cond
(paren
id|optind
op_ne
id|argc
)paren
(brace
id|genksyms_usage
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* For newer kernels, eliminate some irrelevant constructs.  */
id|checksum_version
op_assign
l_int|2
suffix:semicolon
id|outfile
op_assign
id|stdout
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|optind
op_plus
l_int|1
op_ne
id|argc
)paren
(brace
id|genksyms_usage
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|output_directory
op_assign
id|argv
(braket
id|optind
)braket
suffix:semicolon
)brace
(brace
r_extern
r_int
id|yydebug
suffix:semicolon
r_extern
r_int
id|yy_flex_debug
suffix:semicolon
id|yydebug
op_assign
(paren
id|flag_debug
OG
l_int|1
)paren
suffix:semicolon
id|yy_flex_debug
op_assign
(paren
id|flag_debug
OG
l_int|2
)paren
suffix:semicolon
id|debugfile
op_assign
id|stderr
suffix:semicolon
multiline_comment|/* setlinebuf(debugfile); */
)brace
id|yyparse
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|checksum_version
op_eq
l_int|1
)paren
(brace
id|fputs
c_func
(paren
l_string|&quot;#endif&bslash;n#endif&bslash;n&quot;
comma
id|outfile
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flag_debug
)paren
(brace
id|fprintf
c_func
(paren
id|debugfile
comma
l_string|&quot;Hash table occupancy %d/%d = %g&bslash;n&quot;
comma
id|nsyms
comma
id|HASH_BUCKETS
comma
(paren
r_float
)paren
id|nsyms
op_div
(paren
r_float
)paren
id|HASH_BUCKETS
)paren
suffix:semicolon
)brace
r_return
id|errors
op_ne
l_int|0
suffix:semicolon
)brace
eof
