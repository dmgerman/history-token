multiline_comment|/* &n; * CRC32C&n; *@Article{castagnoli-crc,&n; * author =       { Guy Castagnoli and Stefan Braeuer and Martin Herrman},&n; * title =        {{Optimization of Cyclic Redundancy-Check Codes with 24&n; *                 and 32 Parity Bits}},&n; * journal =      IEEE Transactions on Communication,&n; * year =         {1993},&n; * volume =       {41},&n; * number =       {6},&n; * pages =        {},&n; * month =        {June},&n; *}&n; * Used by the iSCSI driver, possibly others, and derived from the&n; * the iscsi-crc.c module of the linux-iscsi driver at&n; * http://linux-iscsi.sourceforge.net.&n; *&n; * Following the example of lib/crc32, this function is intended to be&n; * flexible and useful for all users.  Modules that currently have their&n; * own crc32c, but hopefully may be able to use this one are:&n; *  net/sctp (please add all your doco to here if you change to&n; *            use this one!)&n; *  &lt;endoflist&gt;&n; *&n; * Copyright (c) 2004 Cisco Systems, Inc.&n; * &n; * This program is free software; you can redistribute it and/or modify it&n; * under the terms of the GNU General Public License as published by the Free&n; * Software Foundation; either version 2 of the License, or (at your option) &n; * any later version.&n; *&n; */
macro_line|#include &lt;linux/crc32c.h&gt;
macro_line|#include &lt;linux/compiler.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Clay Haapala &lt;chaapala@cisco.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;CRC32c (Castagnoli) calculations&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|macro|CRC32C_POLY_BE
mdefine_line|#define CRC32C_POLY_BE 0x1EDC6F41
DECL|macro|CRC32C_POLY_LE
mdefine_line|#define CRC32C_POLY_LE 0x82F63B78
macro_line|#ifndef CRC_LE_BITS 
DECL|macro|CRC_LE_BITS
macro_line|# define CRC_LE_BITS 8
macro_line|#endif
multiline_comment|/*&n; * Haven&squot;t generated a big-endian table yet, but the bit-wise version&n; * should at least work.&n; */
macro_line|#if defined CRC_BE_BITS &amp;&amp; CRC_BE_BITS != 1
DECL|macro|CRC_BE_BITS
macro_line|#undef CRC_BE_BITS
macro_line|#endif
macro_line|#ifndef CRC_BE_BITS
DECL|macro|CRC_BE_BITS
macro_line|# define CRC_BE_BITS 1
macro_line|#endif
DECL|variable|crc32c_le
id|EXPORT_SYMBOL
c_func
(paren
id|crc32c_le
)paren
suffix:semicolon
macro_line|#if CRC_LE_BITS == 1
multiline_comment|/*&n; * Compute things bit-wise, as done in crc32.c.  We could share the tight &n; * loop below with crc32 and vary the POLY if we don&squot;t find value in terms&n; * of space and maintainability in keeping the two modules separate.&n; */
id|u32
id|__attribute_pure__
DECL|function|crc32c_le
id|crc32c_le
c_func
(paren
id|u32
id|crc
comma
r_int
r_char
r_const
op_star
id|p
comma
r_int
id|len
)paren
(brace
r_int
id|i
suffix:semicolon
r_while
c_loop
(paren
id|len
op_decrement
)paren
(brace
id|crc
op_xor_assign
op_star
id|p
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
id|crc
op_assign
(paren
id|crc
op_rshift
l_int|1
)paren
op_xor
(paren
(paren
id|crc
op_amp
l_int|1
)paren
ques
c_cond
id|CRC32C_POLY_LE
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
r_return
id|crc
suffix:semicolon
)brace
macro_line|#else
multiline_comment|/*&n; * This is the CRC-32C table&n; * Generated with:&n; * width = 32 bits&n; * poly = 0x1EDC6F41&n; * reflect input bytes = true&n; * reflect output bytes = true&n; */
DECL|variable|crc32c_table
r_static
id|u32
id|crc32c_table
(braket
l_int|256
)braket
op_assign
(brace
l_int|0x00000000L
comma
l_int|0xF26B8303L
comma
l_int|0xE13B70F7L
comma
l_int|0x1350F3F4L
comma
l_int|0xC79A971FL
comma
l_int|0x35F1141CL
comma
l_int|0x26A1E7E8L
comma
l_int|0xD4CA64EBL
comma
l_int|0x8AD958CFL
comma
l_int|0x78B2DBCCL
comma
l_int|0x6BE22838L
comma
l_int|0x9989AB3BL
comma
l_int|0x4D43CFD0L
comma
l_int|0xBF284CD3L
comma
l_int|0xAC78BF27L
comma
l_int|0x5E133C24L
comma
l_int|0x105EC76FL
comma
l_int|0xE235446CL
comma
l_int|0xF165B798L
comma
l_int|0x030E349BL
comma
l_int|0xD7C45070L
comma
l_int|0x25AFD373L
comma
l_int|0x36FF2087L
comma
l_int|0xC494A384L
comma
l_int|0x9A879FA0L
comma
l_int|0x68EC1CA3L
comma
l_int|0x7BBCEF57L
comma
l_int|0x89D76C54L
comma
l_int|0x5D1D08BFL
comma
l_int|0xAF768BBCL
comma
l_int|0xBC267848L
comma
l_int|0x4E4DFB4BL
comma
l_int|0x20BD8EDEL
comma
l_int|0xD2D60DDDL
comma
l_int|0xC186FE29L
comma
l_int|0x33ED7D2AL
comma
l_int|0xE72719C1L
comma
l_int|0x154C9AC2L
comma
l_int|0x061C6936L
comma
l_int|0xF477EA35L
comma
l_int|0xAA64D611L
comma
l_int|0x580F5512L
comma
l_int|0x4B5FA6E6L
comma
l_int|0xB93425E5L
comma
l_int|0x6DFE410EL
comma
l_int|0x9F95C20DL
comma
l_int|0x8CC531F9L
comma
l_int|0x7EAEB2FAL
comma
l_int|0x30E349B1L
comma
l_int|0xC288CAB2L
comma
l_int|0xD1D83946L
comma
l_int|0x23B3BA45L
comma
l_int|0xF779DEAEL
comma
l_int|0x05125DADL
comma
l_int|0x1642AE59L
comma
l_int|0xE4292D5AL
comma
l_int|0xBA3A117EL
comma
l_int|0x4851927DL
comma
l_int|0x5B016189L
comma
l_int|0xA96AE28AL
comma
l_int|0x7DA08661L
comma
l_int|0x8FCB0562L
comma
l_int|0x9C9BF696L
comma
l_int|0x6EF07595L
comma
l_int|0x417B1DBCL
comma
l_int|0xB3109EBFL
comma
l_int|0xA0406D4BL
comma
l_int|0x522BEE48L
comma
l_int|0x86E18AA3L
comma
l_int|0x748A09A0L
comma
l_int|0x67DAFA54L
comma
l_int|0x95B17957L
comma
l_int|0xCBA24573L
comma
l_int|0x39C9C670L
comma
l_int|0x2A993584L
comma
l_int|0xD8F2B687L
comma
l_int|0x0C38D26CL
comma
l_int|0xFE53516FL
comma
l_int|0xED03A29BL
comma
l_int|0x1F682198L
comma
l_int|0x5125DAD3L
comma
l_int|0xA34E59D0L
comma
l_int|0xB01EAA24L
comma
l_int|0x42752927L
comma
l_int|0x96BF4DCCL
comma
l_int|0x64D4CECFL
comma
l_int|0x77843D3BL
comma
l_int|0x85EFBE38L
comma
l_int|0xDBFC821CL
comma
l_int|0x2997011FL
comma
l_int|0x3AC7F2EBL
comma
l_int|0xC8AC71E8L
comma
l_int|0x1C661503L
comma
l_int|0xEE0D9600L
comma
l_int|0xFD5D65F4L
comma
l_int|0x0F36E6F7L
comma
l_int|0x61C69362L
comma
l_int|0x93AD1061L
comma
l_int|0x80FDE395L
comma
l_int|0x72966096L
comma
l_int|0xA65C047DL
comma
l_int|0x5437877EL
comma
l_int|0x4767748AL
comma
l_int|0xB50CF789L
comma
l_int|0xEB1FCBADL
comma
l_int|0x197448AEL
comma
l_int|0x0A24BB5AL
comma
l_int|0xF84F3859L
comma
l_int|0x2C855CB2L
comma
l_int|0xDEEEDFB1L
comma
l_int|0xCDBE2C45L
comma
l_int|0x3FD5AF46L
comma
l_int|0x7198540DL
comma
l_int|0x83F3D70EL
comma
l_int|0x90A324FAL
comma
l_int|0x62C8A7F9L
comma
l_int|0xB602C312L
comma
l_int|0x44694011L
comma
l_int|0x5739B3E5L
comma
l_int|0xA55230E6L
comma
l_int|0xFB410CC2L
comma
l_int|0x092A8FC1L
comma
l_int|0x1A7A7C35L
comma
l_int|0xE811FF36L
comma
l_int|0x3CDB9BDDL
comma
l_int|0xCEB018DEL
comma
l_int|0xDDE0EB2AL
comma
l_int|0x2F8B6829L
comma
l_int|0x82F63B78L
comma
l_int|0x709DB87BL
comma
l_int|0x63CD4B8FL
comma
l_int|0x91A6C88CL
comma
l_int|0x456CAC67L
comma
l_int|0xB7072F64L
comma
l_int|0xA457DC90L
comma
l_int|0x563C5F93L
comma
l_int|0x082F63B7L
comma
l_int|0xFA44E0B4L
comma
l_int|0xE9141340L
comma
l_int|0x1B7F9043L
comma
l_int|0xCFB5F4A8L
comma
l_int|0x3DDE77ABL
comma
l_int|0x2E8E845FL
comma
l_int|0xDCE5075CL
comma
l_int|0x92A8FC17L
comma
l_int|0x60C37F14L
comma
l_int|0x73938CE0L
comma
l_int|0x81F80FE3L
comma
l_int|0x55326B08L
comma
l_int|0xA759E80BL
comma
l_int|0xB4091BFFL
comma
l_int|0x466298FCL
comma
l_int|0x1871A4D8L
comma
l_int|0xEA1A27DBL
comma
l_int|0xF94AD42FL
comma
l_int|0x0B21572CL
comma
l_int|0xDFEB33C7L
comma
l_int|0x2D80B0C4L
comma
l_int|0x3ED04330L
comma
l_int|0xCCBBC033L
comma
l_int|0xA24BB5A6L
comma
l_int|0x502036A5L
comma
l_int|0x4370C551L
comma
l_int|0xB11B4652L
comma
l_int|0x65D122B9L
comma
l_int|0x97BAA1BAL
comma
l_int|0x84EA524EL
comma
l_int|0x7681D14DL
comma
l_int|0x2892ED69L
comma
l_int|0xDAF96E6AL
comma
l_int|0xC9A99D9EL
comma
l_int|0x3BC21E9DL
comma
l_int|0xEF087A76L
comma
l_int|0x1D63F975L
comma
l_int|0x0E330A81L
comma
l_int|0xFC588982L
comma
l_int|0xB21572C9L
comma
l_int|0x407EF1CAL
comma
l_int|0x532E023EL
comma
l_int|0xA145813DL
comma
l_int|0x758FE5D6L
comma
l_int|0x87E466D5L
comma
l_int|0x94B49521L
comma
l_int|0x66DF1622L
comma
l_int|0x38CC2A06L
comma
l_int|0xCAA7A905L
comma
l_int|0xD9F75AF1L
comma
l_int|0x2B9CD9F2L
comma
l_int|0xFF56BD19L
comma
l_int|0x0D3D3E1AL
comma
l_int|0x1E6DCDEEL
comma
l_int|0xEC064EEDL
comma
l_int|0xC38D26C4L
comma
l_int|0x31E6A5C7L
comma
l_int|0x22B65633L
comma
l_int|0xD0DDD530L
comma
l_int|0x0417B1DBL
comma
l_int|0xF67C32D8L
comma
l_int|0xE52CC12CL
comma
l_int|0x1747422FL
comma
l_int|0x49547E0BL
comma
l_int|0xBB3FFD08L
comma
l_int|0xA86F0EFCL
comma
l_int|0x5A048DFFL
comma
l_int|0x8ECEE914L
comma
l_int|0x7CA56A17L
comma
l_int|0x6FF599E3L
comma
l_int|0x9D9E1AE0L
comma
l_int|0xD3D3E1ABL
comma
l_int|0x21B862A8L
comma
l_int|0x32E8915CL
comma
l_int|0xC083125FL
comma
l_int|0x144976B4L
comma
l_int|0xE622F5B7L
comma
l_int|0xF5720643L
comma
l_int|0x07198540L
comma
l_int|0x590AB964L
comma
l_int|0xAB613A67L
comma
l_int|0xB831C993L
comma
l_int|0x4A5A4A90L
comma
l_int|0x9E902E7BL
comma
l_int|0x6CFBAD78L
comma
l_int|0x7FAB5E8CL
comma
l_int|0x8DC0DD8FL
comma
l_int|0xE330A81AL
comma
l_int|0x115B2B19L
comma
l_int|0x020BD8EDL
comma
l_int|0xF0605BEEL
comma
l_int|0x24AA3F05L
comma
l_int|0xD6C1BC06L
comma
l_int|0xC5914FF2L
comma
l_int|0x37FACCF1L
comma
l_int|0x69E9F0D5L
comma
l_int|0x9B8273D6L
comma
l_int|0x88D28022L
comma
l_int|0x7AB90321L
comma
l_int|0xAE7367CAL
comma
l_int|0x5C18E4C9L
comma
l_int|0x4F48173DL
comma
l_int|0xBD23943EL
comma
l_int|0xF36E6F75L
comma
l_int|0x0105EC76L
comma
l_int|0x12551F82L
comma
l_int|0xE03E9C81L
comma
l_int|0x34F4F86AL
comma
l_int|0xC69F7B69L
comma
l_int|0xD5CF889DL
comma
l_int|0x27A40B9EL
comma
l_int|0x79B737BAL
comma
l_int|0x8BDCB4B9L
comma
l_int|0x988C474DL
comma
l_int|0x6AE7C44EL
comma
l_int|0xBE2DA0A5L
comma
l_int|0x4C4623A6L
comma
l_int|0x5F16D052L
comma
l_int|0xAD7D5351L
)brace
suffix:semicolon
multiline_comment|/*&n; * Steps through buffer one byte at at time, calculates reflected &n; * crc using table.&n; */
id|u32
id|__attribute_pure__
DECL|function|crc32c_le
id|crc32c_le
c_func
(paren
id|u32
id|seed
comma
r_int
r_char
r_const
op_star
id|data
comma
r_int
id|length
)paren
(brace
id|u32
id|crc
op_assign
id|__cpu_to_le32
c_func
(paren
id|seed
)paren
suffix:semicolon
r_while
c_loop
(paren
id|length
op_decrement
)paren
id|crc
op_assign
id|crc32c_table
(braket
(paren
id|crc
op_xor
op_star
id|data
op_increment
)paren
op_amp
l_int|0xFFL
)braket
op_xor
(paren
id|crc
op_rshift
l_int|8
)paren
suffix:semicolon
r_return
id|__le32_to_cpu
c_func
(paren
id|crc
)paren
suffix:semicolon
)brace
macro_line|#endif&t;/* CRC_LE_BITS == 8 */
DECL|variable|crc32c_be
id|EXPORT_SYMBOL
c_func
(paren
id|crc32c_be
)paren
suffix:semicolon
macro_line|#if CRC_BE_BITS == 1
id|u32
id|__attribute_pure__
DECL|function|crc32c_be
id|crc32c_be
c_func
(paren
id|u32
id|crc
comma
r_int
r_char
r_const
op_star
id|p
comma
r_int
id|len
)paren
(brace
r_int
id|i
suffix:semicolon
r_while
c_loop
(paren
id|len
op_decrement
)paren
(brace
id|crc
op_xor_assign
op_star
id|p
op_increment
op_lshift
l_int|24
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
id|crc
op_assign
(paren
id|crc
op_lshift
l_int|1
)paren
op_xor
(paren
(paren
id|crc
op_amp
l_int|0x80000000
)paren
ques
c_cond
id|CRC32C_POLY_BE
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
r_return
id|crc
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*&n; * Unit test&n; *&n; * A small unit test suite is implemented as part of the crypto suite.&n; * Select CRYPTO_CRC32C and use the tcrypt module to run the tests.&n; */
eof
