multiline_comment|/* find_next_bit.c: fallback find next bit implementation&n; *&n; * Copyright (C) 2004 Red Hat, Inc. All Rights Reserved.&n; * Written by David Howells (dhowells@redhat.com)&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version&n; * 2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/bitops.h&gt;
DECL|function|find_next_bit
r_int
id|find_next_bit
c_func
(paren
r_const
r_int
r_int
op_star
id|addr
comma
r_int
id|size
comma
r_int
id|offset
)paren
(brace
r_const
r_int
r_int
op_star
id|base
suffix:semicolon
r_const
r_int
id|NBITS
op_assign
r_sizeof
(paren
op_star
id|addr
)paren
op_star
l_int|8
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
id|base
op_assign
id|addr
suffix:semicolon
r_if
c_cond
(paren
id|offset
)paren
(brace
r_int
id|suboffset
suffix:semicolon
id|addr
op_add_assign
id|offset
op_div
id|NBITS
suffix:semicolon
id|suboffset
op_assign
id|offset
op_mod
id|NBITS
suffix:semicolon
r_if
c_cond
(paren
id|suboffset
)paren
(brace
id|tmp
op_assign
op_star
id|addr
suffix:semicolon
id|tmp
op_rshift_assign
id|suboffset
suffix:semicolon
r_if
c_cond
(paren
id|tmp
)paren
r_goto
id|finish
suffix:semicolon
)brace
id|addr
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|tmp
op_assign
op_star
id|addr
)paren
op_eq
l_int|0
)paren
id|addr
op_increment
suffix:semicolon
id|offset
op_assign
(paren
id|addr
op_minus
id|base
)paren
op_star
id|NBITS
suffix:semicolon
id|finish
suffix:colon
multiline_comment|/* count the remaining bits without using __ffs() since that takes a 32-bit arg */
r_while
c_loop
(paren
op_logical_neg
(paren
id|tmp
op_amp
l_int|0xff
)paren
)paren
(brace
id|offset
op_add_assign
l_int|8
suffix:semicolon
id|tmp
op_rshift_assign
l_int|8
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|tmp
op_amp
l_int|1
)paren
)paren
(brace
id|offset
op_increment
suffix:semicolon
id|tmp
op_rshift_assign
l_int|1
suffix:semicolon
)brace
r_return
id|offset
suffix:semicolon
)brace
eof
