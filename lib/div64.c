multiline_comment|/*&n; * Copyright (C) 2003 Bernardo Innocenti &lt;bernie@develer.com&gt;&n; *&n; * Based on former do_div() implementation from asm-parisc/div64.h:&n; *&t;Copyright (C) 1999 Hewlett-Packard Co&n; *&t;Copyright (C) 1999 David Mosberger-Tang &lt;davidm@hpl.hp.com&gt;&n; *&n; *&n; * Generic C version of 64bit/32bit division and modulo, with&n; * 64bit result and 32bit remainder.&n; *&n; * The fast case for (n&gt;&gt;32 == 0) is handled inline by do_div(). &n; *&n; * Code generated for this function might be very inefficient&n; * for some CPUs. __div64_32() can be overridden by linking arch-specific&n; * assembly versions such as arch/ppc/lib/div64.S and arch/sh/lib/div64.S.&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;asm/div64.h&gt;
multiline_comment|/* Not needed on 64bit architectures */
macro_line|#if BITS_PER_LONG == 32
DECL|function|__div64_32
r_uint32
id|__div64_32
c_func
(paren
r_uint64
op_star
id|n
comma
r_uint32
id|base
)paren
(brace
r_uint64
id|rem
op_assign
op_star
id|n
suffix:semicolon
r_uint64
id|b
op_assign
id|base
suffix:semicolon
r_uint64
id|res
comma
id|d
op_assign
l_int|1
suffix:semicolon
r_uint32
id|high
op_assign
id|rem
op_rshift
l_int|32
suffix:semicolon
multiline_comment|/* Reduce the thing a bit first */
id|res
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|high
op_ge
id|base
)paren
(brace
id|high
op_div_assign
id|base
suffix:semicolon
id|res
op_assign
(paren
r_uint64
)paren
id|high
op_lshift
l_int|32
suffix:semicolon
id|rem
op_sub_assign
(paren
r_uint64
)paren
(paren
id|high
op_star
id|base
)paren
op_lshift
l_int|32
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
r_int64
)paren
id|b
OG
l_int|0
op_logical_and
id|b
OL
id|rem
)paren
(brace
id|b
op_assign
id|b
op_plus
id|b
suffix:semicolon
id|d
op_assign
id|d
op_plus
id|d
suffix:semicolon
)brace
r_do
(brace
r_if
c_cond
(paren
id|rem
op_ge
id|b
)paren
(brace
id|rem
op_sub_assign
id|b
suffix:semicolon
id|res
op_add_assign
id|d
suffix:semicolon
)brace
id|b
op_rshift_assign
l_int|1
suffix:semicolon
id|d
op_rshift_assign
l_int|1
suffix:semicolon
)brace
r_while
c_loop
(paren
id|d
)paren
suffix:semicolon
op_star
id|n
op_assign
id|res
suffix:semicolon
r_return
id|rem
suffix:semicolon
)brace
DECL|variable|__div64_32
id|EXPORT_SYMBOL
c_func
(paren
id|__div64_32
)paren
suffix:semicolon
macro_line|#endif /* BITS_PER_LONG == 32 */
eof
