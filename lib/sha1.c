multiline_comment|/*&n; * SHA transform algorithm, taken from code written by Peter Gutmann,&n; * and placed in the public domain.&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/cryptohash.h&gt;
multiline_comment|/* The SHA f()-functions.  */
DECL|macro|f1
mdefine_line|#define f1(x,y,z)   (z ^ (x &amp; (y ^ z)))&t;&t;/* Rounds  0-19: x ? y : z */
DECL|macro|f2
mdefine_line|#define f2(x,y,z)   (x ^ y ^ z)&t;&t;&t;/* Rounds 20-39: XOR */
DECL|macro|f3
mdefine_line|#define f3(x,y,z)   ((x &amp; y) + (z &amp; (x ^ y)))&t;/* Rounds 40-59: majority */
DECL|macro|f4
mdefine_line|#define f4(x,y,z)   (x ^ y ^ z)&t;&t;&t;/* Rounds 60-79: XOR */
multiline_comment|/* The SHA Mysterious Constants */
DECL|macro|K1
mdefine_line|#define K1  0x5A827999L&t;&t;&t;/* Rounds  0-19: sqrt(2) * 2^30 */
DECL|macro|K2
mdefine_line|#define K2  0x6ED9EBA1L&t;&t;&t;/* Rounds 20-39: sqrt(3) * 2^30 */
DECL|macro|K3
mdefine_line|#define K3  0x8F1BBCDCL&t;&t;&t;/* Rounds 40-59: sqrt(5) * 2^30 */
DECL|macro|K4
mdefine_line|#define K4  0xCA62C1D6L&t;&t;&t;/* Rounds 60-79: sqrt(10) * 2^30 */
multiline_comment|/*&n; * sha_transform: single block SHA1 transform&n; *&n; * @digest: 160 bit digest to update&n; * @data:   512 bits of data to hash&n; * @W:      80 words of workspace&n; *&n; * This function generates a SHA1 digest for a single. Be warned, it&n; * does not handle padding and message digest, do not confuse it with&n; * the full FIPS 180-1 digest algorithm for variable length messages.&n; */
DECL|function|sha_transform
r_void
id|sha_transform
c_func
(paren
id|__u32
op_star
id|digest
comma
r_const
r_char
op_star
id|data
comma
id|__u32
op_star
id|W
)paren
(brace
id|__u32
id|A
comma
id|B
comma
id|C
comma
id|D
comma
id|E
suffix:semicolon
id|__u32
id|TEMP
suffix:semicolon
r_int
id|i
suffix:semicolon
id|memset
c_func
(paren
id|W
comma
l_int|0
comma
r_sizeof
(paren
id|W
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
id|W
(braket
id|i
)braket
op_assign
id|be32_to_cpu
c_func
(paren
(paren
(paren
r_const
id|__u32
op_star
)paren
id|data
)paren
(braket
id|i
)braket
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Do the preliminary expansion of 16 to 80 words.  Doing it&n;&t; * out-of-line line this is faster than doing it in-line on&n;&t; * register-starved machines like the x86, and not really any&n;&t; * slower on real processors.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|64
suffix:semicolon
id|i
op_increment
)paren
(brace
id|TEMP
op_assign
id|W
(braket
id|i
)braket
op_xor
id|W
(braket
id|i
op_plus
l_int|2
)braket
op_xor
id|W
(braket
id|i
op_plus
l_int|8
)braket
op_xor
id|W
(braket
id|i
op_plus
l_int|13
)braket
suffix:semicolon
id|W
(braket
id|i
op_plus
l_int|16
)braket
op_assign
id|rol32
c_func
(paren
id|TEMP
comma
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* Set up first buffer and local data buffer */
id|A
op_assign
id|digest
(braket
l_int|0
)braket
suffix:semicolon
id|B
op_assign
id|digest
(braket
l_int|1
)braket
suffix:semicolon
id|C
op_assign
id|digest
(braket
l_int|2
)braket
suffix:semicolon
id|D
op_assign
id|digest
(braket
l_int|3
)braket
suffix:semicolon
id|E
op_assign
id|digest
(braket
l_int|4
)braket
suffix:semicolon
multiline_comment|/* Heavy mangling, in 4 sub-rounds of 20 iterations each. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|80
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
OL
l_int|40
)paren
(brace
r_if
c_cond
(paren
id|i
OL
l_int|20
)paren
id|TEMP
op_assign
id|f1
c_func
(paren
id|B
comma
id|C
comma
id|D
)paren
op_plus
id|K1
suffix:semicolon
r_else
id|TEMP
op_assign
id|f2
c_func
(paren
id|B
comma
id|C
comma
id|D
)paren
op_plus
id|K2
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|i
OL
l_int|60
)paren
id|TEMP
op_assign
id|f3
c_func
(paren
id|B
comma
id|C
comma
id|D
)paren
op_plus
id|K3
suffix:semicolon
r_else
id|TEMP
op_assign
id|f4
c_func
(paren
id|B
comma
id|C
comma
id|D
)paren
op_plus
id|K4
suffix:semicolon
)brace
id|TEMP
op_add_assign
id|rol32
c_func
(paren
id|A
comma
l_int|5
)paren
op_plus
id|E
op_plus
id|W
(braket
id|i
)braket
suffix:semicolon
id|E
op_assign
id|D
suffix:semicolon
id|D
op_assign
id|C
suffix:semicolon
id|C
op_assign
id|rol32
c_func
(paren
id|B
comma
l_int|30
)paren
suffix:semicolon
id|B
op_assign
id|A
suffix:semicolon
id|A
op_assign
id|TEMP
suffix:semicolon
)brace
multiline_comment|/* Build message digest */
id|digest
(braket
l_int|0
)braket
op_add_assign
id|A
suffix:semicolon
id|digest
(braket
l_int|1
)braket
op_add_assign
id|B
suffix:semicolon
id|digest
(braket
l_int|2
)braket
op_add_assign
id|C
suffix:semicolon
id|digest
(braket
l_int|3
)braket
op_add_assign
id|D
suffix:semicolon
id|digest
(braket
l_int|4
)braket
op_add_assign
id|E
suffix:semicolon
multiline_comment|/* W is wiped by the caller */
)brace
multiline_comment|/*&n; * sha_init: initialize the vectors for a SHA1 digest&n; *&n; * @buf: vector to initialize&n; */
DECL|function|sha_init
r_void
id|sha_init
c_func
(paren
id|__u32
op_star
id|buf
)paren
(brace
id|buf
(braket
l_int|0
)braket
op_assign
l_int|0x67452301
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
l_int|0xefcdab89
suffix:semicolon
id|buf
(braket
l_int|2
)braket
op_assign
l_int|0x98badcfe
suffix:semicolon
id|buf
(braket
l_int|3
)braket
op_assign
l_int|0x10325476
suffix:semicolon
id|buf
(braket
l_int|4
)braket
op_assign
l_int|0xc3d2e1f0
suffix:semicolon
)brace
eof
