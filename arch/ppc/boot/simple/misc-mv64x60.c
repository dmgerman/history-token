multiline_comment|/*&n; * arch/ppc/boot/simple/misc-mv64x60.c&n; *&n; * Relocate bridge&squot;s register base and call board specific routine.&n; *&n; * Author: Mark A. Greer &lt;source@mvista.com&gt;&n; *&n; * 2005 (c) MontaVista Software, Inc. This file is licensed under&n; * the terms of the GNU General Public License version 2. This program&n; * is licensed &quot;as is&quot; without any warranty of any kind, whether express&n; * or implied.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/mv64x60_defs.h&gt;
r_extern
r_struct
id|bi_record
op_star
id|decompress_kernel
c_func
(paren
r_int
r_int
id|load_addr
comma
r_int
id|num_words
comma
r_int
r_int
id|cksum
)paren
suffix:semicolon
r_void
DECL|function|mv64x60_move_base
id|mv64x60_move_base
c_func
(paren
r_void
id|__iomem
op_star
id|old_base
comma
r_void
id|__iomem
op_star
id|new_base
)paren
(brace
id|u32
id|bits
comma
id|mask
comma
id|b
suffix:semicolon
r_if
c_cond
(paren
id|old_base
op_ne
id|new_base
)paren
(brace
macro_line|#ifdef CONFIG_GT64260
id|bits
op_assign
l_int|12
suffix:semicolon
id|mask
op_assign
l_int|0x07000000
suffix:semicolon
macro_line|#else /* Must be mv64[34]60 */
id|bits
op_assign
l_int|16
suffix:semicolon
id|mask
op_assign
l_int|0x03000000
suffix:semicolon
macro_line|#endif
id|b
op_assign
id|in_le32
c_func
(paren
id|old_base
op_plus
id|MV64x60_INTERNAL_SPACE_DECODE
)paren
suffix:semicolon
id|b
op_and_assign
id|mask
suffix:semicolon
id|b
op_or_assign
(paren
(paren
id|u32
)paren
id|new_base
op_rshift
(paren
l_int|32
op_minus
id|bits
)paren
)paren
suffix:semicolon
id|out_le32
c_func
(paren
id|old_base
op_plus
id|MV64x60_INTERNAL_SPACE_DECODE
comma
id|b
)paren
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;sync&quot;
)paren
suffix:semicolon
multiline_comment|/* Wait for change to happen (in accordance with the manual) */
r_while
c_loop
(paren
id|in_le32
c_func
(paren
id|new_base
op_plus
id|MV64x60_INTERNAL_SPACE_DECODE
)paren
op_ne
id|b
)paren
suffix:semicolon
)brace
)brace
r_void
id|__attribute__
(paren
(paren
id|weak
)paren
)paren
DECL|function|mv64x60_board_init
id|mv64x60_board_init
c_func
(paren
r_void
id|__iomem
op_star
id|old_base
comma
r_void
id|__iomem
op_star
id|new_base
)paren
(brace
)brace
r_void
op_star
DECL|function|load_kernel
id|load_kernel
c_func
(paren
r_int
r_int
id|load_addr
comma
r_int
id|num_words
comma
r_int
r_int
id|cksum
comma
r_void
op_star
id|ign1
comma
r_void
op_star
id|ign2
)paren
(brace
id|mv64x60_move_base
c_func
(paren
(paren
r_void
id|__iomem
op_star
)paren
id|CONFIG_MV64X60_BASE
comma
(paren
r_void
id|__iomem
op_star
)paren
id|CONFIG_MV64X60_NEW_BASE
)paren
suffix:semicolon
id|mv64x60_board_init
c_func
(paren
(paren
r_void
id|__iomem
op_star
)paren
id|CONFIG_MV64X60_BASE
comma
(paren
r_void
id|__iomem
op_star
)paren
id|CONFIG_MV64X60_NEW_BASE
)paren
suffix:semicolon
r_return
id|decompress_kernel
c_func
(paren
id|load_addr
comma
id|num_words
comma
id|cksum
)paren
suffix:semicolon
)brace
eof
