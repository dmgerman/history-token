macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;asm/machdep.h&gt;
macro_line|#include &lt;asm/gemini.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/pci-bridge.h&gt;
macro_line|#include &quot;pci.h&quot;
DECL|macro|pci_config_addr
mdefine_line|#define pci_config_addr(bus,dev,offset) &bslash;&n;        (0x80000000 | (bus&lt;&lt;16) | (dev&lt;&lt;8) | offset)
r_int
DECL|function|gemini_pcibios_read_config_byte
id|gemini_pcibios_read_config_byte
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|offset
comma
id|u8
op_star
id|val
)paren
(brace
r_int
r_int
id|reg
suffix:semicolon
id|reg
op_assign
id|grackle_read
c_func
(paren
id|pci_config_addr
c_func
(paren
id|dev-&gt;bus-&gt;number
comma
id|dev-&gt;devfn
comma
(paren
id|offset
op_amp
op_complement
(paren
l_int|0x3
)paren
)paren
)paren
)paren
suffix:semicolon
op_star
id|val
op_assign
(paren
(paren
id|reg
op_rshift
(paren
(paren
id|offset
op_amp
l_int|0x3
)paren
op_lshift
l_int|3
)paren
)paren
op_amp
l_int|0xff
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_int
DECL|function|gemini_pcibios_read_config_word
id|gemini_pcibios_read_config_word
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|offset
comma
id|u16
op_star
id|val
)paren
(brace
r_int
r_int
id|reg
suffix:semicolon
id|reg
op_assign
id|grackle_read
c_func
(paren
id|pci_config_addr
c_func
(paren
id|dev-&gt;bus-&gt;number
comma
id|dev-&gt;devfn
comma
(paren
id|offset
op_amp
op_complement
(paren
l_int|0x3
)paren
)paren
)paren
)paren
suffix:semicolon
op_star
id|val
op_assign
(paren
(paren
id|reg
op_rshift
(paren
(paren
id|offset
op_amp
l_int|0x3
)paren
op_lshift
l_int|3
)paren
)paren
op_amp
l_int|0xffff
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_int
DECL|function|gemini_pcibios_read_config_dword
id|gemini_pcibios_read_config_dword
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|offset
comma
id|u32
op_star
id|val
)paren
(brace
op_star
id|val
op_assign
id|grackle_read
c_func
(paren
id|pci_config_addr
c_func
(paren
id|dev-&gt;bus-&gt;number
comma
id|dev-&gt;devfn
comma
(paren
id|offset
op_amp
op_complement
(paren
l_int|0x3
)paren
)paren
)paren
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_int
DECL|function|gemini_pcibios_write_config_byte
id|gemini_pcibios_write_config_byte
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|offset
comma
id|u8
id|val
)paren
(brace
r_int
r_int
id|reg
suffix:semicolon
r_int
id|shifts
op_assign
id|offset
op_amp
l_int|0x3
suffix:semicolon
r_int
r_int
id|addr
op_assign
id|pci_config_addr
c_func
(paren
id|dev-&gt;bus-&gt;number
comma
id|dev-&gt;devfn
comma
(paren
id|offset
op_amp
op_complement
(paren
l_int|0x3
)paren
)paren
)paren
suffix:semicolon
id|reg
op_assign
id|grackle_read
c_func
(paren
id|addr
)paren
suffix:semicolon
id|reg
op_assign
(paren
id|reg
op_amp
op_complement
(paren
l_int|0xff
op_lshift
(paren
id|shifts
op_lshift
l_int|3
)paren
)paren
)paren
op_or
(paren
id|val
op_lshift
(paren
id|shifts
op_lshift
l_int|3
)paren
)paren
suffix:semicolon
id|grackle_write
c_func
(paren
id|addr
comma
id|reg
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_int
DECL|function|gemini_pcibios_write_config_word
id|gemini_pcibios_write_config_word
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|offset
comma
id|u16
id|val
)paren
(brace
r_int
r_int
id|reg
suffix:semicolon
r_int
id|shifts
op_assign
id|offset
op_amp
l_int|0x3
suffix:semicolon
r_int
r_int
id|addr
op_assign
id|pci_config_addr
c_func
(paren
id|dev-&gt;bus-&gt;number
comma
id|dev-&gt;devfn
comma
(paren
id|offset
op_amp
op_complement
(paren
l_int|0x3
)paren
)paren
)paren
suffix:semicolon
id|reg
op_assign
id|grackle_read
c_func
(paren
id|addr
)paren
suffix:semicolon
id|reg
op_assign
(paren
id|reg
op_amp
op_complement
(paren
l_int|0xffff
op_lshift
(paren
id|shifts
op_lshift
l_int|3
)paren
)paren
)paren
op_or
(paren
id|val
op_lshift
(paren
id|shifts
op_lshift
l_int|3
)paren
)paren
suffix:semicolon
id|grackle_write
c_func
(paren
id|addr
comma
id|reg
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_int
DECL|function|gemini_pcibios_write_config_dword
id|gemini_pcibios_write_config_dword
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|offset
comma
id|u32
id|val
)paren
(brace
id|grackle_write
c_func
(paren
id|pci_config_addr
c_func
(paren
id|dev-&gt;bus-&gt;number
comma
id|dev-&gt;devfn
comma
(paren
id|offset
op_amp
op_complement
(paren
l_int|0x3
)paren
)paren
)paren
comma
id|val
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|variable|gemini_pci_ops
r_static
r_struct
id|pci_ops
id|gemini_pci_ops
op_assign
(brace
id|gemini_pcibios_read_config_byte
comma
id|gemini_pcibios_read_config_word
comma
id|gemini_pcibios_read_config_dword
comma
id|gemini_pcibios_write_config_byte
comma
id|gemini_pcibios_write_config_word
comma
id|gemini_pcibios_write_config_dword
)brace
suffix:semicolon
DECL|function|gemini_pcibios_fixup
r_void
id|__init
id|gemini_pcibios_fixup
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
id|pci_for_each_dev
c_func
(paren
id|dev
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;resource
(braket
id|i
)braket
dot
id|flags
op_amp
id|IORESOURCE_IO
)paren
(brace
id|dev-&gt;resource
(braket
id|i
)braket
dot
id|start
op_or_assign
(paren
l_int|0xfe
op_lshift
l_int|24
)paren
suffix:semicolon
id|dev-&gt;resource
(braket
id|i
)braket
dot
id|end
op_or_assign
(paren
l_int|0xfe
op_lshift
l_int|24
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
multiline_comment|/* The &quot;bootloader&quot; for Synergy boards does none of this for us, so we need to&n;   lay it all out ourselves... --Dan */
DECL|function|gemini_find_bridges
r_void
id|__init
id|gemini_find_bridges
c_func
(paren
r_void
)paren
(brace
r_struct
id|pci_controller
op_star
id|hose
suffix:semicolon
id|ppc_md.pcibios_fixup
op_assign
id|gemini_pcibios_fixup
suffix:semicolon
id|hose
op_assign
id|pcibios_alloc_controller
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hose
)paren
r_return
suffix:semicolon
id|hose-&gt;ops
op_assign
op_amp
id|gemini_pci_ops
suffix:semicolon
)brace
eof
