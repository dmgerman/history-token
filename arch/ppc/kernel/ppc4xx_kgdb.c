macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;asm/ibm4xx.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
DECL|macro|LSR_DR
mdefine_line|#define LSR_DR&t;&t;0x01 /* Data ready */
DECL|macro|LSR_OE
mdefine_line|#define LSR_OE&t;&t;0x02 /* Overrun */
DECL|macro|LSR_PE
mdefine_line|#define LSR_PE&t;&t;0x04 /* Parity error */
DECL|macro|LSR_FE
mdefine_line|#define LSR_FE&t;&t;0x08 /* Framing error */
DECL|macro|LSR_BI
mdefine_line|#define LSR_BI&t;&t;0x10 /* Break */
DECL|macro|LSR_THRE
mdefine_line|#define LSR_THRE&t;0x20 /* Xmit holding register empty */
DECL|macro|LSR_TEMT
mdefine_line|#define LSR_TEMT&t;0x40 /* Xmitter empty */
DECL|macro|LSR_ERR
mdefine_line|#define LSR_ERR&t;&t;0x80 /* Error */
macro_line|#include &lt;platforms/ibm_ocp.h&gt;
r_extern
r_struct
id|NS16550
op_star
id|COM_PORTS
(braket
)braket
suffix:semicolon
macro_line|#ifndef NULL
DECL|macro|NULL
mdefine_line|#define NULL 0x00
macro_line|#endif
DECL|variable|kgdb_debugport
r_static
r_volatile
r_struct
id|NS16550
op_star
id|kgdb_debugport
op_assign
l_int|NULL
suffix:semicolon
r_volatile
r_struct
id|NS16550
op_star
DECL|function|NS16550_init
id|NS16550_init
c_func
(paren
r_int
id|chan
)paren
(brace
r_volatile
r_struct
id|NS16550
op_star
id|com_port
suffix:semicolon
r_int
id|quot
suffix:semicolon
macro_line|#ifdef BASE_BAUD
id|quot
op_assign
id|BASE_BAUD
op_div
l_int|9600
suffix:semicolon
macro_line|#else
id|quot
op_assign
l_int|0x000c
suffix:semicolon
multiline_comment|/* 0xc = 9600 baud (on a pc) */
macro_line|#endif
id|com_port
op_assign
(paren
r_struct
id|NS16550
op_star
)paren
id|COM_PORTS
(braket
id|chan
)braket
suffix:semicolon
id|com_port-&gt;lcr
op_assign
l_int|0x00
suffix:semicolon
id|com_port-&gt;ier
op_assign
l_int|0xFF
suffix:semicolon
id|com_port-&gt;ier
op_assign
l_int|0x00
suffix:semicolon
id|com_port-&gt;lcr
op_assign
id|com_port-&gt;lcr
op_or
l_int|0x80
suffix:semicolon
multiline_comment|/* Access baud rate */
id|com_port-&gt;dll
op_assign
(paren
id|quot
op_amp
l_int|0x00ff
)paren
suffix:semicolon
multiline_comment|/* 0xc = 9600 baud */
id|com_port-&gt;dlm
op_assign
(paren
id|quot
op_amp
l_int|0xff00
)paren
op_rshift
l_int|8
suffix:semicolon
id|com_port-&gt;lcr
op_assign
l_int|0x03
suffix:semicolon
multiline_comment|/* 8 data, 1 stop, no parity */
id|com_port-&gt;mcr
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* RTS/DTR */
id|com_port-&gt;fcr
op_assign
l_int|0x07
suffix:semicolon
multiline_comment|/* Clear &amp; enable FIFOs */
r_return
id|com_port
suffix:semicolon
)brace
r_void
DECL|function|NS16550_putc
id|NS16550_putc
c_func
(paren
r_volatile
r_struct
id|NS16550
op_star
id|com_port
comma
r_int
r_char
id|c
)paren
(brace
r_while
c_loop
(paren
(paren
id|com_port-&gt;lsr
op_amp
id|LSR_THRE
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|com_port-&gt;thr
op_assign
id|c
suffix:semicolon
r_return
suffix:semicolon
)brace
r_int
r_char
DECL|function|NS16550_getc
id|NS16550_getc
c_func
(paren
r_volatile
r_struct
id|NS16550
op_star
id|com_port
)paren
(brace
r_while
c_loop
(paren
(paren
id|com_port-&gt;lsr
op_amp
id|LSR_DR
)paren
op_eq
l_int|0
)paren
suffix:semicolon
r_return
(paren
id|com_port-&gt;rbr
)paren
suffix:semicolon
)brace
r_int
r_char
DECL|function|NS16550_tstc
id|NS16550_tstc
c_func
(paren
r_volatile
r_struct
id|NS16550
op_star
id|com_port
)paren
(brace
r_return
(paren
(paren
id|com_port-&gt;lsr
op_amp
id|LSR_DR
)paren
op_ne
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_KGDB_TTYS0)
DECL|macro|KGDB_PORT
mdefine_line|#define KGDB_PORT 0
macro_line|#elif defined(CONFIG_KGDB_TTYS1)
DECL|macro|KGDB_PORT
mdefine_line|#define KGDB_PORT 1
macro_line|#elif defined(CONFIG_KGDB_TTYS2)
DECL|macro|KGDB_PORT
mdefine_line|#define KGDB_PORT 2
macro_line|#elif defined(CONFIG_KGDB_TTYS3)
DECL|macro|KGDB_PORT
mdefine_line|#define KGDB_PORT 3
macro_line|#else
macro_line|#error &quot;invalid kgdb_tty port&quot;
macro_line|#endif
DECL|function|putDebugChar
r_void
id|putDebugChar
c_func
(paren
r_int
r_char
id|c
)paren
(brace
r_if
c_cond
(paren
id|kgdb_debugport
op_eq
l_int|NULL
)paren
id|kgdb_debugport
op_assign
id|NS16550_init
c_func
(paren
id|KGDB_PORT
)paren
suffix:semicolon
id|NS16550_putc
c_func
(paren
id|kgdb_debugport
comma
id|c
)paren
suffix:semicolon
)brace
DECL|function|getDebugChar
r_int
id|getDebugChar
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|kgdb_debugport
op_eq
l_int|NULL
)paren
id|kgdb_debugport
op_assign
id|NS16550_init
c_func
(paren
id|KGDB_PORT
)paren
suffix:semicolon
r_return
id|NS16550_getc
c_func
(paren
id|kgdb_debugport
)paren
suffix:semicolon
)brace
DECL|function|kgdb_interruptible
r_void
id|kgdb_interruptible
c_func
(paren
r_int
id|enable
)paren
(brace
r_return
suffix:semicolon
)brace
DECL|function|putDebugString
r_void
id|putDebugString
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_while
c_loop
(paren
op_star
id|str
op_ne
l_char|&squot;&bslash;0&squot;
)paren
(brace
id|putDebugChar
c_func
(paren
op_star
id|str
)paren
suffix:semicolon
id|str
op_increment
suffix:semicolon
)brace
id|putDebugChar
c_func
(paren
l_char|&squot;&bslash;r&squot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_void
DECL|function|kgdb_map_scc
id|kgdb_map_scc
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;kgdb init &bslash;n&quot;
)paren
suffix:semicolon
id|kgdb_debugport
op_assign
id|NS16550_init
c_func
(paren
id|KGDB_PORT
)paren
suffix:semicolon
)brace
eof
