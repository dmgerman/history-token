multiline_comment|/* kernel/perfmon_fsl_booke.c&n; * Freescale Book-E Performance Monitor code&n; *&n; * Author: Andy Fleming&n; * Copyright (c) 2004 Freescale Semiconductor, Inc&n; *&n; *  This program is free software; you can redistribute it and/or&n; *  modify it under the terms of the GNU General Public License&n; *  as published by the Free Software Foundation; either version&n; *  2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/stddef.h&gt;
macro_line|#include &lt;linux/unistd.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/user.h&gt;
macro_line|#include &lt;linux/a.out.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/prctl.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/reg.h&gt;
macro_line|#include &lt;asm/xmon.h&gt;
macro_line|#include &lt;asm/perfmon.h&gt;
r_static
r_inline
id|u32
id|get_pmlca
c_func
(paren
r_int
id|ctr
)paren
suffix:semicolon
r_static
r_inline
r_void
id|set_pmlca
c_func
(paren
r_int
id|ctr
comma
id|u32
id|pmlca
)paren
suffix:semicolon
DECL|function|get_pmlca
r_static
r_inline
id|u32
id|get_pmlca
c_func
(paren
r_int
id|ctr
)paren
(brace
id|u32
id|pmlca
suffix:semicolon
r_switch
c_cond
(paren
id|ctr
)paren
(brace
r_case
l_int|0
suffix:colon
id|pmlca
op_assign
id|mfpmr
c_func
(paren
id|PMRN_PMLCA0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|pmlca
op_assign
id|mfpmr
c_func
(paren
id|PMRN_PMLCA1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|pmlca
op_assign
id|mfpmr
c_func
(paren
id|PMRN_PMLCA2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|pmlca
op_assign
id|mfpmr
c_func
(paren
id|PMRN_PMLCA3
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|panic
c_func
(paren
l_string|&quot;Bad ctr number&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|pmlca
suffix:semicolon
)brace
DECL|function|set_pmlca
r_static
r_inline
r_void
id|set_pmlca
c_func
(paren
r_int
id|ctr
comma
id|u32
id|pmlca
)paren
(brace
r_switch
c_cond
(paren
id|ctr
)paren
(brace
r_case
l_int|0
suffix:colon
id|mtpmr
c_func
(paren
id|PMRN_PMLCA0
comma
id|pmlca
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|mtpmr
c_func
(paren
id|PMRN_PMLCA1
comma
id|pmlca
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|mtpmr
c_func
(paren
id|PMRN_PMLCA2
comma
id|pmlca
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|mtpmr
c_func
(paren
id|PMRN_PMLCA3
comma
id|pmlca
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|panic
c_func
(paren
l_string|&quot;Bad ctr number&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|init_pmc_stop
r_void
id|init_pmc_stop
c_func
(paren
r_int
id|ctr
)paren
(brace
id|u32
id|pmlca
op_assign
(paren
id|PMLCA_FC
op_or
id|PMLCA_FCS
op_or
id|PMLCA_FCU
op_or
id|PMLCA_FCM1
op_or
id|PMLCA_FCM0
)paren
suffix:semicolon
id|u32
id|pmlcb
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|ctr
)paren
(brace
r_case
l_int|0
suffix:colon
id|mtpmr
c_func
(paren
id|PMRN_PMLCA0
comma
id|pmlca
)paren
suffix:semicolon
id|mtpmr
c_func
(paren
id|PMRN_PMLCB0
comma
id|pmlcb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|mtpmr
c_func
(paren
id|PMRN_PMLCA1
comma
id|pmlca
)paren
suffix:semicolon
id|mtpmr
c_func
(paren
id|PMRN_PMLCB1
comma
id|pmlcb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|mtpmr
c_func
(paren
id|PMRN_PMLCA2
comma
id|pmlca
)paren
suffix:semicolon
id|mtpmr
c_func
(paren
id|PMRN_PMLCB2
comma
id|pmlcb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|mtpmr
c_func
(paren
id|PMRN_PMLCA3
comma
id|pmlca
)paren
suffix:semicolon
id|mtpmr
c_func
(paren
id|PMRN_PMLCB3
comma
id|pmlcb
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|panic
c_func
(paren
l_string|&quot;Bad ctr number!&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|set_pmc_event
r_void
id|set_pmc_event
c_func
(paren
r_int
id|ctr
comma
r_int
id|event
)paren
(brace
id|u32
id|pmlca
suffix:semicolon
id|pmlca
op_assign
id|get_pmlca
c_func
(paren
id|ctr
)paren
suffix:semicolon
id|pmlca
op_assign
(paren
id|pmlca
op_amp
op_complement
id|PMLCA_EVENT_MASK
)paren
op_or
(paren
(paren
id|event
op_lshift
id|PMLCA_EVENT_SHIFT
)paren
op_amp
id|PMLCA_EVENT_MASK
)paren
suffix:semicolon
id|set_pmlca
c_func
(paren
id|ctr
comma
id|pmlca
)paren
suffix:semicolon
)brace
DECL|function|set_pmc_user_kernel
r_void
id|set_pmc_user_kernel
c_func
(paren
r_int
id|ctr
comma
r_int
id|user
comma
r_int
id|kernel
)paren
(brace
id|u32
id|pmlca
suffix:semicolon
id|pmlca
op_assign
id|get_pmlca
c_func
(paren
id|ctr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|user
)paren
(brace
id|pmlca
op_and_assign
op_complement
id|PMLCA_FCU
suffix:semicolon
)brace
r_else
id|pmlca
op_or_assign
id|PMLCA_FCU
suffix:semicolon
r_if
c_cond
(paren
id|kernel
)paren
(brace
id|pmlca
op_and_assign
op_complement
id|PMLCA_FCS
suffix:semicolon
)brace
r_else
id|pmlca
op_or_assign
id|PMLCA_FCS
suffix:semicolon
id|set_pmlca
c_func
(paren
id|ctr
comma
id|pmlca
)paren
suffix:semicolon
)brace
DECL|function|set_pmc_marked
r_void
id|set_pmc_marked
c_func
(paren
r_int
id|ctr
comma
r_int
id|mark0
comma
r_int
id|mark1
)paren
(brace
id|u32
id|pmlca
op_assign
id|get_pmlca
c_func
(paren
id|ctr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mark0
)paren
(brace
id|pmlca
op_and_assign
op_complement
id|PMLCA_FCM0
suffix:semicolon
)brace
r_else
id|pmlca
op_or_assign
id|PMLCA_FCM0
suffix:semicolon
r_if
c_cond
(paren
id|mark1
)paren
(brace
id|pmlca
op_and_assign
op_complement
id|PMLCA_FCM1
suffix:semicolon
)brace
r_else
id|pmlca
op_or_assign
id|PMLCA_FCM1
suffix:semicolon
id|set_pmlca
c_func
(paren
id|ctr
comma
id|pmlca
)paren
suffix:semicolon
)brace
DECL|function|pmc_start_ctr
r_void
id|pmc_start_ctr
c_func
(paren
r_int
id|ctr
comma
r_int
id|enable
)paren
(brace
id|u32
id|pmlca
op_assign
id|get_pmlca
c_func
(paren
id|ctr
)paren
suffix:semicolon
id|pmlca
op_and_assign
op_complement
id|PMLCA_FC
suffix:semicolon
r_if
c_cond
(paren
id|enable
)paren
id|pmlca
op_or_assign
id|PMLCA_CE
suffix:semicolon
r_else
id|pmlca
op_and_assign
op_complement
id|PMLCA_CE
suffix:semicolon
id|set_pmlca
c_func
(paren
id|ctr
comma
id|pmlca
)paren
suffix:semicolon
)brace
DECL|function|pmc_start_ctrs
r_void
id|pmc_start_ctrs
c_func
(paren
r_int
id|enable
)paren
(brace
id|u32
id|pmgc0
op_assign
id|mfpmr
c_func
(paren
id|PMRN_PMGC0
)paren
suffix:semicolon
id|pmgc0
op_and_assign
op_complement
id|PMGC0_FAC
suffix:semicolon
id|pmgc0
op_or_assign
id|PMGC0_FCECE
suffix:semicolon
r_if
c_cond
(paren
id|enable
)paren
id|pmgc0
op_or_assign
id|PMGC0_PMIE
suffix:semicolon
r_else
id|pmgc0
op_and_assign
op_complement
id|PMGC0_PMIE
suffix:semicolon
id|mtpmr
c_func
(paren
id|PMRN_PMGC0
comma
id|pmgc0
)paren
suffix:semicolon
)brace
DECL|function|pmc_stop_ctrs
r_void
id|pmc_stop_ctrs
c_func
(paren
r_void
)paren
(brace
id|u32
id|pmgc0
op_assign
id|mfpmr
c_func
(paren
id|PMRN_PMGC0
)paren
suffix:semicolon
id|pmgc0
op_or_assign
id|PMGC0_FAC
suffix:semicolon
id|pmgc0
op_and_assign
op_complement
(paren
id|PMGC0_PMIE
op_or
id|PMGC0_FCECE
)paren
suffix:semicolon
id|mtpmr
c_func
(paren
id|PMRN_PMGC0
comma
id|pmgc0
)paren
suffix:semicolon
)brace
DECL|function|dump_pmcs
r_void
id|dump_pmcs
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pmgc0: %x&bslash;n&quot;
comma
id|mfpmr
c_func
(paren
id|PMRN_PMGC0
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;pmc&bslash;t&bslash;tpmlca&bslash;t&bslash;tpmlcb&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%8x&bslash;t%8x&bslash;t%8x&bslash;n&quot;
comma
id|mfpmr
c_func
(paren
id|PMRN_PMC0
)paren
comma
id|mfpmr
c_func
(paren
id|PMRN_PMLCA0
)paren
comma
id|mfpmr
c_func
(paren
id|PMRN_PMLCB0
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%8x&bslash;t%8x&bslash;t%8x&bslash;n&quot;
comma
id|mfpmr
c_func
(paren
id|PMRN_PMC1
)paren
comma
id|mfpmr
c_func
(paren
id|PMRN_PMLCA1
)paren
comma
id|mfpmr
c_func
(paren
id|PMRN_PMLCB1
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%8x&bslash;t%8x&bslash;t%8x&bslash;n&quot;
comma
id|mfpmr
c_func
(paren
id|PMRN_PMC2
)paren
comma
id|mfpmr
c_func
(paren
id|PMRN_PMLCA2
)paren
comma
id|mfpmr
c_func
(paren
id|PMRN_PMLCB2
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%8x&bslash;t%8x&bslash;t%8x&bslash;n&quot;
comma
id|mfpmr
c_func
(paren
id|PMRN_PMC3
)paren
comma
id|mfpmr
c_func
(paren
id|PMRN_PMLCA3
)paren
comma
id|mfpmr
c_func
(paren
id|PMRN_PMLCB3
)paren
)paren
suffix:semicolon
)brace
DECL|variable|init_pmc_stop
id|EXPORT_SYMBOL
c_func
(paren
id|init_pmc_stop
)paren
suffix:semicolon
DECL|variable|set_pmc_event
id|EXPORT_SYMBOL
c_func
(paren
id|set_pmc_event
)paren
suffix:semicolon
DECL|variable|set_pmc_user_kernel
id|EXPORT_SYMBOL
c_func
(paren
id|set_pmc_user_kernel
)paren
suffix:semicolon
DECL|variable|set_pmc_marked
id|EXPORT_SYMBOL
c_func
(paren
id|set_pmc_marked
)paren
suffix:semicolon
DECL|variable|pmc_start_ctr
id|EXPORT_SYMBOL
c_func
(paren
id|pmc_start_ctr
)paren
suffix:semicolon
DECL|variable|pmc_start_ctrs
id|EXPORT_SYMBOL
c_func
(paren
id|pmc_start_ctrs
)paren
suffix:semicolon
DECL|variable|pmc_stop_ctrs
id|EXPORT_SYMBOL
c_func
(paren
id|pmc_stop_ctrs
)paren
suffix:semicolon
DECL|variable|dump_pmcs
id|EXPORT_SYMBOL
c_func
(paren
id|dump_pmcs
)paren
suffix:semicolon
eof
