multiline_comment|/*&n; * arch/ppc/syslib/ppc_sys.c&n; *&n; * PPC System library functions&n; *&n; * Maintainer: Kumar Gala &lt;kumar.gala@freescale.com&gt;&n; *&n; * Copyright 2005 Freescale Semiconductor Inc.&n; *&n; * This program is free software; you can redistribute  it and/or modify it&n; * under  the terms of  the GNU General  Public License as published by the&n; * Free Software Foundation;  either version 2 of the  License, or (at your&n; * option) any later version.&n; */
macro_line|#include &lt;asm/ppc_sys.h&gt;
DECL|variable|ppc_sys_device_fixup
r_int
(paren
op_star
id|ppc_sys_device_fixup
)paren
(paren
r_struct
id|platform_device
op_star
id|pdev
)paren
suffix:semicolon
DECL|variable|ppc_sys_inited
r_static
r_int
id|ppc_sys_inited
suffix:semicolon
DECL|function|identify_ppc_sys_by_id
r_void
id|__init
id|identify_ppc_sys_by_id
c_func
(paren
id|u32
id|id
)paren
(brace
r_int
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
r_if
c_cond
(paren
(paren
id|ppc_sys_specs
(braket
id|i
)braket
dot
id|mask
op_amp
id|id
)paren
op_eq
id|ppc_sys_specs
(braket
id|i
)braket
dot
id|value
)paren
r_break
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
id|cur_ppc_sys_spec
op_assign
op_amp
id|ppc_sys_specs
(braket
id|i
)braket
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|identify_ppc_sys_by_name
r_void
id|__init
id|identify_ppc_sys_by_name
c_func
(paren
r_char
op_star
id|name
)paren
(brace
multiline_comment|/* TODO */
r_return
suffix:semicolon
)brace
multiline_comment|/* Update all memory resources by paddr, call before platform_device_register */
r_void
id|__init
DECL|function|ppc_sys_fixup_mem_resource
id|ppc_sys_fixup_mem_resource
c_func
(paren
r_struct
id|platform_device
op_star
id|pdev
comma
id|phys_addr_t
id|paddr
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pdev-&gt;num_resources
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|resource
op_star
id|r
op_assign
op_amp
id|pdev-&gt;resource
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r-&gt;flags
op_amp
id|IORESOURCE_MEM
)paren
op_eq
id|IORESOURCE_MEM
)paren
(brace
id|r-&gt;start
op_add_assign
id|paddr
suffix:semicolon
id|r-&gt;end
op_add_assign
id|paddr
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Get platform_data pointer out of platform device, call before platform_device_register */
DECL|function|ppc_sys_get_pdata
r_void
op_star
id|__init
id|ppc_sys_get_pdata
c_func
(paren
r_enum
id|ppc_sys_devices
id|dev
)paren
(brace
r_return
id|ppc_sys_platform_devices
(braket
id|dev
)braket
dot
id|dev.platform_data
suffix:semicolon
)brace
DECL|function|ppc_sys_device_remove
r_void
id|ppc_sys_device_remove
c_func
(paren
r_enum
id|ppc_sys_devices
id|dev
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|ppc_sys_inited
)paren
(brace
id|platform_device_unregister
c_func
(paren
op_amp
id|ppc_sys_platform_devices
(braket
id|dev
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|cur_ppc_sys_spec
op_eq
l_int|NULL
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cur_ppc_sys_spec-&gt;num_devices
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|cur_ppc_sys_spec-&gt;device_list
(braket
id|i
)braket
op_eq
id|dev
)paren
id|cur_ppc_sys_spec-&gt;device_list
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|ppc_sys_init
r_static
r_int
id|__init
id|ppc_sys_init
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|i
comma
id|dev_id
comma
id|ret
op_assign
l_int|0
suffix:semicolon
id|BUG_ON
c_func
(paren
id|cur_ppc_sys_spec
op_eq
l_int|NULL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|cur_ppc_sys_spec-&gt;num_devices
suffix:semicolon
id|i
op_increment
)paren
(brace
id|dev_id
op_assign
id|cur_ppc_sys_spec-&gt;device_list
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|dev_id
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|ppc_sys_device_fixup
op_ne
l_int|NULL
)paren
id|ppc_sys_device_fixup
c_func
(paren
op_amp
id|ppc_sys_platform_devices
(braket
id|dev_id
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|platform_device_register
(paren
op_amp
id|ppc_sys_platform_devices
(braket
id|dev_id
)braket
)paren
)paren
(brace
id|ret
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;unable to register device %d&bslash;n&quot;
comma
id|dev_id
)paren
suffix:semicolon
)brace
)brace
)brace
id|ppc_sys_inited
op_assign
l_int|1
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|ppc_sys_init
id|subsys_initcall
c_func
(paren
id|ppc_sys_init
)paren
suffix:semicolon
eof
