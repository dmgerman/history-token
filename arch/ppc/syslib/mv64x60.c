multiline_comment|/*&n; * arch/ppc/syslib/mv64x60.c&n; *&n; * Common routines for the Marvell/Galileo Discovery line of host bridges&n; * (gt64260, mv64360, mv64460, ...).&n; *&n; * Author: Mark A. Greer &lt;mgreer@mvista.com&gt;&n; *&n; * 2004 (c) MontaVista, Software, Inc.  This file is licensed under&n; * the terms of the GNU General Public License version 2.  This program&n; * is licensed &quot;as is&quot; without any warranty of any kind, whether express&n; * or implied.&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/bootmem.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/mv643xx.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/machdep.h&gt;
macro_line|#include &lt;asm/pci-bridge.h&gt;
macro_line|#include &lt;asm/delay.h&gt;
macro_line|#include &lt;asm/mv64x60.h&gt;
DECL|variable|mv64x60_pci_exclude_bridge
id|u8
id|mv64x60_pci_exclude_bridge
op_assign
l_int|1
suffix:semicolon
DECL|variable|mv64x60_lock
id|spinlock_t
id|mv64x60_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|mv64x60_bridge_pbase
r_static
id|phys_addr_t
id|mv64x60_bridge_pbase
op_assign
l_int|0
suffix:semicolon
DECL|variable|mv64x60_bridge_vbase
r_static
r_void
op_star
id|mv64x60_bridge_vbase
op_assign
l_int|0
suffix:semicolon
DECL|variable|mv64x60_bridge_type
r_static
id|u32
id|mv64x60_bridge_type
op_assign
id|MV64x60_TYPE_INVALID
suffix:semicolon
DECL|variable|mv64x60_bridge_rev
r_static
id|u32
id|mv64x60_bridge_rev
op_assign
l_int|0
suffix:semicolon
r_static
id|u32
id|gt64260_translate_size
c_func
(paren
id|u32
id|base
comma
id|u32
id|size
comma
id|u32
id|num_bits
)paren
suffix:semicolon
r_static
id|u32
id|gt64260_untranslate_size
c_func
(paren
id|u32
id|base
comma
id|u32
id|size
comma
id|u32
id|num_bits
)paren
suffix:semicolon
r_static
r_void
id|gt64260_set_pci2mem_window
c_func
(paren
r_struct
id|pci_controller
op_star
id|hose
comma
id|u32
id|bus
comma
id|u32
id|window
comma
id|u32
id|base
)paren
suffix:semicolon
r_static
r_void
id|gt64260_set_pci2regs_window
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|pci_controller
op_star
id|hose
comma
id|u32
id|bus
comma
id|u32
id|base
)paren
suffix:semicolon
r_static
id|u32
id|gt64260_is_enabled_32bit
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
)paren
suffix:semicolon
r_static
r_void
id|gt64260_enable_window_32bit
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
)paren
suffix:semicolon
r_static
r_void
id|gt64260_disable_window_32bit
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
)paren
suffix:semicolon
r_static
r_void
id|gt64260_enable_window_64bit
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
)paren
suffix:semicolon
r_static
r_void
id|gt64260_disable_window_64bit
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
)paren
suffix:semicolon
r_static
r_void
id|gt64260_disable_all_windows
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|mv64x60_setup_info
op_star
id|si
)paren
suffix:semicolon
r_static
r_void
id|gt64260a_chip_specific_init
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|mv64x60_setup_info
op_star
id|si
)paren
suffix:semicolon
r_static
r_void
id|gt64260b_chip_specific_init
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|mv64x60_setup_info
op_star
id|si
)paren
suffix:semicolon
r_static
id|u32
id|mv64360_translate_size
c_func
(paren
id|u32
id|base
comma
id|u32
id|size
comma
id|u32
id|num_bits
)paren
suffix:semicolon
r_static
id|u32
id|mv64360_untranslate_size
c_func
(paren
id|u32
id|base
comma
id|u32
id|size
comma
id|u32
id|num_bits
)paren
suffix:semicolon
r_static
r_void
id|mv64360_set_pci2mem_window
c_func
(paren
r_struct
id|pci_controller
op_star
id|hose
comma
id|u32
id|bus
comma
id|u32
id|window
comma
id|u32
id|base
)paren
suffix:semicolon
r_static
r_void
id|mv64360_set_pci2regs_window
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|pci_controller
op_star
id|hose
comma
id|u32
id|bus
comma
id|u32
id|base
)paren
suffix:semicolon
r_static
id|u32
id|mv64360_is_enabled_32bit
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
)paren
suffix:semicolon
r_static
r_void
id|mv64360_enable_window_32bit
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
)paren
suffix:semicolon
r_static
r_void
id|mv64360_disable_window_32bit
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
)paren
suffix:semicolon
r_static
r_void
id|mv64360_enable_window_64bit
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
)paren
suffix:semicolon
r_static
r_void
id|mv64360_disable_window_64bit
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
)paren
suffix:semicolon
r_static
r_void
id|mv64360_disable_all_windows
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|mv64x60_setup_info
op_star
id|si
)paren
suffix:semicolon
r_static
r_void
id|mv64360_config_io2mem_windows
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|mv64x60_setup_info
op_star
id|si
comma
id|u32
id|mem_windows
(braket
id|MV64x60_CPU2MEM_WINDOWS
)braket
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_static
r_void
id|mv64360_set_mpsc2regs_window
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|base
)paren
suffix:semicolon
r_static
r_void
id|mv64360_chip_specific_init
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|mv64x60_setup_info
op_star
id|si
)paren
suffix:semicolon
r_static
r_void
id|mv64460_chip_specific_init
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|mv64x60_setup_info
op_star
id|si
)paren
suffix:semicolon
multiline_comment|/*&n; * Define tables that have the chip-specific info for each type of&n; * Marvell bridge chip.&n; */
DECL|variable|__initdata
r_static
r_struct
id|mv64x60_chip_info
id|gt64260a_ci
id|__initdata
op_assign
(brace
multiline_comment|/* GT64260A */
dot
id|translate_size
op_assign
id|gt64260_translate_size
comma
dot
id|untranslate_size
op_assign
id|gt64260_untranslate_size
comma
dot
id|set_pci2mem_window
op_assign
id|gt64260_set_pci2mem_window
comma
dot
id|set_pci2regs_window
op_assign
id|gt64260_set_pci2regs_window
comma
dot
id|is_enabled_32bit
op_assign
id|gt64260_is_enabled_32bit
comma
dot
id|enable_window_32bit
op_assign
id|gt64260_enable_window_32bit
comma
dot
id|disable_window_32bit
op_assign
id|gt64260_disable_window_32bit
comma
dot
id|enable_window_64bit
op_assign
id|gt64260_enable_window_64bit
comma
dot
id|disable_window_64bit
op_assign
id|gt64260_disable_window_64bit
comma
dot
id|disable_all_windows
op_assign
id|gt64260_disable_all_windows
comma
dot
id|chip_specific_init
op_assign
id|gt64260a_chip_specific_init
comma
dot
id|window_tab_32bit
op_assign
id|gt64260_32bit_windows
comma
dot
id|window_tab_64bit
op_assign
id|gt64260_64bit_windows
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|mv64x60_chip_info
id|gt64260b_ci
id|__initdata
op_assign
(brace
multiline_comment|/* GT64260B */
dot
id|translate_size
op_assign
id|gt64260_translate_size
comma
dot
id|untranslate_size
op_assign
id|gt64260_untranslate_size
comma
dot
id|set_pci2mem_window
op_assign
id|gt64260_set_pci2mem_window
comma
dot
id|set_pci2regs_window
op_assign
id|gt64260_set_pci2regs_window
comma
dot
id|is_enabled_32bit
op_assign
id|gt64260_is_enabled_32bit
comma
dot
id|enable_window_32bit
op_assign
id|gt64260_enable_window_32bit
comma
dot
id|disable_window_32bit
op_assign
id|gt64260_disable_window_32bit
comma
dot
id|enable_window_64bit
op_assign
id|gt64260_enable_window_64bit
comma
dot
id|disable_window_64bit
op_assign
id|gt64260_disable_window_64bit
comma
dot
id|disable_all_windows
op_assign
id|gt64260_disable_all_windows
comma
dot
id|chip_specific_init
op_assign
id|gt64260b_chip_specific_init
comma
dot
id|window_tab_32bit
op_assign
id|gt64260_32bit_windows
comma
dot
id|window_tab_64bit
op_assign
id|gt64260_64bit_windows
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|mv64x60_chip_info
id|mv64360_ci
id|__initdata
op_assign
(brace
multiline_comment|/* MV64360 */
dot
id|translate_size
op_assign
id|mv64360_translate_size
comma
dot
id|untranslate_size
op_assign
id|mv64360_untranslate_size
comma
dot
id|set_pci2mem_window
op_assign
id|mv64360_set_pci2mem_window
comma
dot
id|set_pci2regs_window
op_assign
id|mv64360_set_pci2regs_window
comma
dot
id|is_enabled_32bit
op_assign
id|mv64360_is_enabled_32bit
comma
dot
id|enable_window_32bit
op_assign
id|mv64360_enable_window_32bit
comma
dot
id|disable_window_32bit
op_assign
id|mv64360_disable_window_32bit
comma
dot
id|enable_window_64bit
op_assign
id|mv64360_enable_window_64bit
comma
dot
id|disable_window_64bit
op_assign
id|mv64360_disable_window_64bit
comma
dot
id|disable_all_windows
op_assign
id|mv64360_disable_all_windows
comma
dot
id|config_io2mem_windows
op_assign
id|mv64360_config_io2mem_windows
comma
dot
id|set_mpsc2regs_window
op_assign
id|mv64360_set_mpsc2regs_window
comma
dot
id|chip_specific_init
op_assign
id|mv64360_chip_specific_init
comma
dot
id|window_tab_32bit
op_assign
id|mv64360_32bit_windows
comma
dot
id|window_tab_64bit
op_assign
id|mv64360_64bit_windows
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|mv64x60_chip_info
id|mv64460_ci
id|__initdata
op_assign
(brace
multiline_comment|/* MV64460 */
dot
id|translate_size
op_assign
id|mv64360_translate_size
comma
dot
id|untranslate_size
op_assign
id|mv64360_untranslate_size
comma
dot
id|set_pci2mem_window
op_assign
id|mv64360_set_pci2mem_window
comma
dot
id|set_pci2regs_window
op_assign
id|mv64360_set_pci2regs_window
comma
dot
id|is_enabled_32bit
op_assign
id|mv64360_is_enabled_32bit
comma
dot
id|enable_window_32bit
op_assign
id|mv64360_enable_window_32bit
comma
dot
id|disable_window_32bit
op_assign
id|mv64360_disable_window_32bit
comma
dot
id|enable_window_64bit
op_assign
id|mv64360_enable_window_64bit
comma
dot
id|disable_window_64bit
op_assign
id|mv64360_disable_window_64bit
comma
dot
id|disable_all_windows
op_assign
id|mv64360_disable_all_windows
comma
dot
id|config_io2mem_windows
op_assign
id|mv64360_config_io2mem_windows
comma
dot
id|set_mpsc2regs_window
op_assign
id|mv64360_set_mpsc2regs_window
comma
dot
id|chip_specific_init
op_assign
id|mv64460_chip_specific_init
comma
dot
id|window_tab_32bit
op_assign
id|mv64360_32bit_windows
comma
dot
id|window_tab_64bit
op_assign
id|mv64360_64bit_windows
comma
)brace
suffix:semicolon
multiline_comment|/*&n; *****************************************************************************&n; *&n; *&t;Platform Device Definitions&n; *&n; *****************************************************************************&n; */
macro_line|#ifdef CONFIG_SERIAL_MPSC
DECL|variable|mv64x60_mpsc_shared_pdata
r_static
r_struct
id|mpsc_shared_pdata
id|mv64x60_mpsc_shared_pdata
op_assign
(brace
dot
id|mrr_val
op_assign
l_int|0x3ffffe38
comma
dot
id|rcrr_val
op_assign
l_int|0
comma
dot
id|tcrr_val
op_assign
l_int|0
comma
dot
id|intr_cause_val
op_assign
l_int|0
comma
dot
id|intr_mask_val
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|mv64x60_mpsc_shared_resources
r_static
r_struct
id|resource
id|mv64x60_mpsc_shared_resources
(braket
)braket
op_assign
(brace
multiline_comment|/* Do not change the order of the IORESOURCE_MEM resources */
(braket
l_int|0
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;mpsc routing base&quot;
comma
dot
id|start
op_assign
id|MV64x60_MPSC_ROUTING_OFFSET
comma
dot
id|end
op_assign
id|MV64x60_MPSC_ROUTING_OFFSET
op_plus
id|MPSC_ROUTING_REG_BLOCK_SIZE
op_minus
l_int|1
comma
dot
id|flags
op_assign
id|IORESOURCE_MEM
comma
)brace
comma
(braket
l_int|1
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;sdma intr base&quot;
comma
dot
id|start
op_assign
id|MV64x60_SDMA_INTR_OFFSET
comma
dot
id|end
op_assign
id|MV64x60_SDMA_INTR_OFFSET
op_plus
id|MPSC_SDMA_INTR_REG_BLOCK_SIZE
op_minus
l_int|1
comma
dot
id|flags
op_assign
id|IORESOURCE_MEM
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|mpsc_shared_device
r_static
r_struct
id|platform_device
id|mpsc_shared_device
op_assign
(brace
multiline_comment|/* Shared device */
dot
id|name
op_assign
id|MPSC_SHARED_NAME
comma
dot
id|id
op_assign
l_int|0
comma
dot
id|num_resources
op_assign
id|ARRAY_SIZE
c_func
(paren
id|mv64x60_mpsc_shared_resources
)paren
comma
dot
id|resource
op_assign
id|mv64x60_mpsc_shared_resources
comma
dot
id|dev
op_assign
(brace
dot
id|platform_data
op_assign
op_amp
id|mv64x60_mpsc_shared_pdata
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|mv64x60_mpsc0_pdata
r_static
r_struct
id|mpsc_pdata
id|mv64x60_mpsc0_pdata
op_assign
(brace
dot
id|mirror_regs
op_assign
l_int|0
comma
dot
id|cache_mgmt
op_assign
l_int|0
comma
dot
id|max_idle
op_assign
l_int|0
comma
dot
id|default_baud
op_assign
l_int|9600
comma
dot
id|default_bits
op_assign
l_int|8
comma
dot
id|default_parity
op_assign
l_char|&squot;n&squot;
comma
dot
id|default_flow
op_assign
l_char|&squot;n&squot;
comma
dot
id|chr_1_val
op_assign
l_int|0x00000000
comma
dot
id|chr_2_val
op_assign
l_int|0x00000000
comma
dot
id|chr_10_val
op_assign
l_int|0x00000003
comma
dot
id|mpcr_val
op_assign
l_int|0
comma
dot
id|bcr_val
op_assign
l_int|0
comma
dot
id|brg_can_tune
op_assign
l_int|0
comma
dot
id|brg_clk_src
op_assign
l_int|8
comma
multiline_comment|/* Default to TCLK */
dot
id|brg_clk_freq
op_assign
l_int|100000000
comma
multiline_comment|/* Default to 100 MHz */
)brace
suffix:semicolon
DECL|variable|mv64x60_mpsc0_resources
r_static
r_struct
id|resource
id|mv64x60_mpsc0_resources
(braket
)braket
op_assign
(brace
multiline_comment|/* Do not change the order of the IORESOURCE_MEM resources */
(braket
l_int|0
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;mpsc 0 base&quot;
comma
dot
id|start
op_assign
id|MV64x60_MPSC_0_OFFSET
comma
dot
id|end
op_assign
id|MV64x60_MPSC_0_OFFSET
op_plus
id|MPSC_REG_BLOCK_SIZE
op_minus
l_int|1
comma
dot
id|flags
op_assign
id|IORESOURCE_MEM
comma
)brace
comma
(braket
l_int|1
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;sdma 0 base&quot;
comma
dot
id|start
op_assign
id|MV64x60_SDMA_0_OFFSET
comma
dot
id|end
op_assign
id|MV64x60_SDMA_0_OFFSET
op_plus
id|MPSC_SDMA_REG_BLOCK_SIZE
op_minus
l_int|1
comma
dot
id|flags
op_assign
id|IORESOURCE_MEM
comma
)brace
comma
(braket
l_int|2
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;brg 0 base&quot;
comma
dot
id|start
op_assign
id|MV64x60_BRG_0_OFFSET
comma
dot
id|end
op_assign
id|MV64x60_BRG_0_OFFSET
op_plus
id|MPSC_BRG_REG_BLOCK_SIZE
op_minus
l_int|1
comma
dot
id|flags
op_assign
id|IORESOURCE_MEM
comma
)brace
comma
(braket
l_int|3
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;sdma 0 irq&quot;
comma
dot
id|start
op_assign
id|MV64x60_IRQ_SDMA_0
comma
dot
id|end
op_assign
id|MV64x60_IRQ_SDMA_0
comma
dot
id|flags
op_assign
id|IORESOURCE_IRQ
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|mpsc0_device
r_static
r_struct
id|platform_device
id|mpsc0_device
op_assign
(brace
dot
id|name
op_assign
id|MPSC_CTLR_NAME
comma
dot
id|id
op_assign
l_int|0
comma
dot
id|num_resources
op_assign
id|ARRAY_SIZE
c_func
(paren
id|mv64x60_mpsc0_resources
)paren
comma
dot
id|resource
op_assign
id|mv64x60_mpsc0_resources
comma
dot
id|dev
op_assign
(brace
dot
id|platform_data
op_assign
op_amp
id|mv64x60_mpsc0_pdata
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|mv64x60_mpsc1_pdata
r_static
r_struct
id|mpsc_pdata
id|mv64x60_mpsc1_pdata
op_assign
(brace
dot
id|mirror_regs
op_assign
l_int|0
comma
dot
id|cache_mgmt
op_assign
l_int|0
comma
dot
id|max_idle
op_assign
l_int|0
comma
dot
id|default_baud
op_assign
l_int|9600
comma
dot
id|default_bits
op_assign
l_int|8
comma
dot
id|default_parity
op_assign
l_char|&squot;n&squot;
comma
dot
id|default_flow
op_assign
l_char|&squot;n&squot;
comma
dot
id|chr_1_val
op_assign
l_int|0x00000000
comma
dot
id|chr_1_val
op_assign
l_int|0x00000000
comma
dot
id|chr_2_val
op_assign
l_int|0x00000000
comma
dot
id|chr_10_val
op_assign
l_int|0x00000003
comma
dot
id|mpcr_val
op_assign
l_int|0
comma
dot
id|bcr_val
op_assign
l_int|0
comma
dot
id|brg_can_tune
op_assign
l_int|0
comma
dot
id|brg_clk_src
op_assign
l_int|8
comma
multiline_comment|/* Default to TCLK */
dot
id|brg_clk_freq
op_assign
l_int|100000000
comma
multiline_comment|/* Default to 100 MHz */
)brace
suffix:semicolon
DECL|variable|mv64x60_mpsc1_resources
r_static
r_struct
id|resource
id|mv64x60_mpsc1_resources
(braket
)braket
op_assign
(brace
multiline_comment|/* Do not change the order of the IORESOURCE_MEM resources */
(braket
l_int|0
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;mpsc 1 base&quot;
comma
dot
id|start
op_assign
id|MV64x60_MPSC_1_OFFSET
comma
dot
id|end
op_assign
id|MV64x60_MPSC_1_OFFSET
op_plus
id|MPSC_REG_BLOCK_SIZE
op_minus
l_int|1
comma
dot
id|flags
op_assign
id|IORESOURCE_MEM
comma
)brace
comma
(braket
l_int|1
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;sdma 1 base&quot;
comma
dot
id|start
op_assign
id|MV64x60_SDMA_1_OFFSET
comma
dot
id|end
op_assign
id|MV64x60_SDMA_1_OFFSET
op_plus
id|MPSC_SDMA_REG_BLOCK_SIZE
op_minus
l_int|1
comma
dot
id|flags
op_assign
id|IORESOURCE_MEM
comma
)brace
comma
(braket
l_int|2
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;brg 1 base&quot;
comma
dot
id|start
op_assign
id|MV64x60_BRG_1_OFFSET
comma
dot
id|end
op_assign
id|MV64x60_BRG_1_OFFSET
op_plus
id|MPSC_BRG_REG_BLOCK_SIZE
op_minus
l_int|1
comma
dot
id|flags
op_assign
id|IORESOURCE_MEM
comma
)brace
comma
(braket
l_int|3
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;sdma 1 irq&quot;
comma
dot
id|start
op_assign
id|MV64360_IRQ_SDMA_1
comma
dot
id|end
op_assign
id|MV64360_IRQ_SDMA_1
comma
dot
id|flags
op_assign
id|IORESOURCE_IRQ
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|mpsc1_device
r_static
r_struct
id|platform_device
id|mpsc1_device
op_assign
(brace
dot
id|name
op_assign
id|MPSC_CTLR_NAME
comma
dot
id|id
op_assign
l_int|1
comma
dot
id|num_resources
op_assign
id|ARRAY_SIZE
c_func
(paren
id|mv64x60_mpsc1_resources
)paren
comma
dot
id|resource
op_assign
id|mv64x60_mpsc1_resources
comma
dot
id|dev
op_assign
(brace
dot
id|platform_data
op_assign
op_amp
id|mv64x60_mpsc1_pdata
comma
)brace
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_MV643XX_ETH
DECL|variable|mv64x60_eth_shared_resources
r_static
r_struct
id|resource
id|mv64x60_eth_shared_resources
(braket
)braket
op_assign
(brace
(braket
l_int|0
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;ethernet shared base&quot;
comma
dot
id|start
op_assign
id|MV643XX_ETH_SHARED_REGS
comma
dot
id|end
op_assign
id|MV643XX_ETH_SHARED_REGS
op_plus
id|MV643XX_ETH_SHARED_REGS_SIZE
op_minus
l_int|1
comma
dot
id|flags
op_assign
id|IORESOURCE_MEM
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|mv64x60_eth_shared_device
r_static
r_struct
id|platform_device
id|mv64x60_eth_shared_device
op_assign
(brace
dot
id|name
op_assign
id|MV643XX_ETH_SHARED_NAME
comma
dot
id|id
op_assign
l_int|0
comma
dot
id|num_resources
op_assign
id|ARRAY_SIZE
c_func
(paren
id|mv64x60_eth_shared_resources
)paren
comma
dot
id|resource
op_assign
id|mv64x60_eth_shared_resources
comma
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_MV643XX_ETH_0
DECL|variable|mv64x60_eth0_resources
r_static
r_struct
id|resource
id|mv64x60_eth0_resources
(braket
)braket
op_assign
(brace
(braket
l_int|0
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;eth0 irq&quot;
comma
dot
id|start
op_assign
id|MV64x60_IRQ_ETH_0
comma
dot
id|end
op_assign
id|MV64x60_IRQ_ETH_0
comma
dot
id|flags
op_assign
id|IORESOURCE_IRQ
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|eth0_pd
r_static
r_struct
id|mv643xx_eth_platform_data
id|eth0_pd
suffix:semicolon
DECL|variable|eth0_device
r_static
r_struct
id|platform_device
id|eth0_device
op_assign
(brace
dot
id|name
op_assign
id|MV643XX_ETH_NAME
comma
dot
id|id
op_assign
l_int|0
comma
dot
id|num_resources
op_assign
id|ARRAY_SIZE
c_func
(paren
id|mv64x60_eth0_resources
)paren
comma
dot
id|resource
op_assign
id|mv64x60_eth0_resources
comma
dot
id|dev
op_assign
(brace
dot
id|platform_data
op_assign
op_amp
id|eth0_pd
comma
)brace
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_MV643XX_ETH_1
DECL|variable|mv64x60_eth1_resources
r_static
r_struct
id|resource
id|mv64x60_eth1_resources
(braket
)braket
op_assign
(brace
(braket
l_int|0
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;eth1 irq&quot;
comma
dot
id|start
op_assign
id|MV64x60_IRQ_ETH_1
comma
dot
id|end
op_assign
id|MV64x60_IRQ_ETH_1
comma
dot
id|flags
op_assign
id|IORESOURCE_IRQ
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|eth1_pd
r_static
r_struct
id|mv643xx_eth_platform_data
id|eth1_pd
suffix:semicolon
DECL|variable|eth1_device
r_static
r_struct
id|platform_device
id|eth1_device
op_assign
(brace
dot
id|name
op_assign
id|MV643XX_ETH_NAME
comma
dot
id|id
op_assign
l_int|1
comma
dot
id|num_resources
op_assign
id|ARRAY_SIZE
c_func
(paren
id|mv64x60_eth1_resources
)paren
comma
dot
id|resource
op_assign
id|mv64x60_eth1_resources
comma
dot
id|dev
op_assign
(brace
dot
id|platform_data
op_assign
op_amp
id|eth1_pd
comma
)brace
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_MV643XX_ETH_2
DECL|variable|mv64x60_eth2_resources
r_static
r_struct
id|resource
id|mv64x60_eth2_resources
(braket
)braket
op_assign
(brace
(braket
l_int|0
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;eth2 irq&quot;
comma
dot
id|start
op_assign
id|MV64x60_IRQ_ETH_2
comma
dot
id|end
op_assign
id|MV64x60_IRQ_ETH_2
comma
dot
id|flags
op_assign
id|IORESOURCE_IRQ
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|eth2_pd
r_static
r_struct
id|mv643xx_eth_platform_data
id|eth2_pd
suffix:semicolon
DECL|variable|eth2_device
r_static
r_struct
id|platform_device
id|eth2_device
op_assign
(brace
dot
id|name
op_assign
id|MV643XX_ETH_NAME
comma
dot
id|id
op_assign
l_int|2
comma
dot
id|num_resources
op_assign
id|ARRAY_SIZE
c_func
(paren
id|mv64x60_eth2_resources
)paren
comma
dot
id|resource
op_assign
id|mv64x60_eth2_resources
comma
dot
id|dev
op_assign
(brace
dot
id|platform_data
op_assign
op_amp
id|eth2_pd
comma
)brace
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#ifdef&t;CONFIG_I2C_MV64XXX
DECL|variable|mv64xxx_i2c_pdata
r_static
r_struct
id|mv64xxx_i2c_pdata
id|mv64xxx_i2c_pdata
op_assign
(brace
dot
id|freq_m
op_assign
l_int|8
comma
dot
id|freq_n
op_assign
l_int|3
comma
dot
id|timeout
op_assign
l_int|1000
comma
multiline_comment|/* Default timeout of 1 second */
dot
id|retries
op_assign
l_int|1
comma
)brace
suffix:semicolon
DECL|variable|mv64xxx_i2c_resources
r_static
r_struct
id|resource
id|mv64xxx_i2c_resources
(braket
)braket
op_assign
(brace
multiline_comment|/* Do not change the order of the IORESOURCE_MEM resources */
(braket
l_int|0
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;mv64xxx i2c base&quot;
comma
dot
id|start
op_assign
id|MV64XXX_I2C_OFFSET
comma
dot
id|end
op_assign
id|MV64XXX_I2C_OFFSET
op_plus
id|MV64XXX_I2C_REG_BLOCK_SIZE
op_minus
l_int|1
comma
dot
id|flags
op_assign
id|IORESOURCE_MEM
comma
)brace
comma
(braket
l_int|1
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;mv64xxx i2c irq&quot;
comma
dot
id|start
op_assign
id|MV64x60_IRQ_I2C
comma
dot
id|end
op_assign
id|MV64x60_IRQ_I2C
comma
dot
id|flags
op_assign
id|IORESOURCE_IRQ
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|i2c_device
r_static
r_struct
id|platform_device
id|i2c_device
op_assign
(brace
dot
id|name
op_assign
id|MV64XXX_I2C_CTLR_NAME
comma
dot
id|id
op_assign
l_int|0
comma
dot
id|num_resources
op_assign
id|ARRAY_SIZE
c_func
(paren
id|mv64xxx_i2c_resources
)paren
comma
dot
id|resource
op_assign
id|mv64xxx_i2c_resources
comma
dot
id|dev
op_assign
(brace
dot
id|platform_data
op_assign
op_amp
id|mv64xxx_i2c_pdata
comma
)brace
comma
)brace
suffix:semicolon
macro_line|#endif
DECL|variable|__initdata
r_static
r_struct
id|platform_device
op_star
id|mv64x60_pd_devs
(braket
)braket
id|__initdata
op_assign
(brace
macro_line|#ifdef CONFIG_SERIAL_MPSC
op_amp
id|mpsc_shared_device
comma
op_amp
id|mpsc0_device
comma
op_amp
id|mpsc1_device
comma
macro_line|#endif
macro_line|#ifdef CONFIG_MV643XX_ETH
op_amp
id|mv64x60_eth_shared_device
comma
macro_line|#endif
macro_line|#ifdef CONFIG_MV643XX_ETH_0
op_amp
id|eth0_device
comma
macro_line|#endif
macro_line|#ifdef CONFIG_MV643XX_ETH_1
op_amp
id|eth1_device
comma
macro_line|#endif
macro_line|#ifdef CONFIG_MV643XX_ETH_2
op_amp
id|eth2_device
comma
macro_line|#endif
macro_line|#ifdef&t;CONFIG_I2C_MV64XXX
op_amp
id|i2c_device
comma
macro_line|#endif
)brace
suffix:semicolon
multiline_comment|/*&n; *****************************************************************************&n; *&n; *&t;Bridge Initialization Routines&n; *&n; *****************************************************************************&n; */
multiline_comment|/*&n; * mv64x60_init()&n; *&n; * Initialze the bridge based on setting passed in via &squot;si&squot;.  The bridge&n; * handle, &squot;bh&squot;, will be set so that it can be used to make subsequent&n; * calls to routines in this file.&n; */
r_int
id|__init
DECL|function|mv64x60_init
id|mv64x60_init
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|mv64x60_setup_info
op_star
id|si
)paren
(brace
id|u32
id|mem_windows
(braket
id|MV64x60_CPU2MEM_WINDOWS
)braket
(braket
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;mv64x60 initialization&quot;
comma
l_int|0x0
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|mv64x60_lock
)paren
suffix:semicolon
id|mv64x60_early_init
c_func
(paren
id|bh
comma
id|si
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mv64x60_get_type
c_func
(paren
id|bh
)paren
op_logical_or
id|mv64x60_setup_for_chip
c_func
(paren
id|bh
)paren
)paren
(brace
id|iounmap
c_func
(paren
id|bh-&gt;v_base
)paren
suffix:semicolon
id|bh-&gt;v_base
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;mv64x60_init: Can&squot;t determine chip&quot;
comma
l_int|0
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|bh-&gt;ci
op_member_access_from_pointer
id|disable_all_windows
c_func
(paren
id|bh
comma
id|si
)paren
suffix:semicolon
id|mv64x60_get_mem_windows
c_func
(paren
id|bh
comma
id|mem_windows
)paren
suffix:semicolon
id|mv64x60_config_cpu2mem_windows
c_func
(paren
id|bh
comma
id|si
comma
id|mem_windows
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bh-&gt;ci-&gt;config_io2mem_windows
)paren
id|bh-&gt;ci
op_member_access_from_pointer
id|config_io2mem_windows
c_func
(paren
id|bh
comma
id|si
comma
id|mem_windows
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bh-&gt;ci-&gt;set_mpsc2regs_window
)paren
id|bh-&gt;ci
op_member_access_from_pointer
id|set_mpsc2regs_window
c_func
(paren
id|bh
comma
id|si-&gt;phys_reg_base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|si-&gt;pci_1.enable_bus
)paren
(brace
id|bh-&gt;io_base_b
op_assign
(paren
id|u32
)paren
id|ioremap
c_func
(paren
id|si-&gt;pci_1.pci_io.cpu_base
comma
id|si-&gt;pci_1.pci_io.size
)paren
suffix:semicolon
id|isa_io_base
op_assign
id|bh-&gt;io_base_b
suffix:semicolon
)brace
r_if
c_cond
(paren
id|si-&gt;pci_0.enable_bus
)paren
(brace
id|bh-&gt;io_base_a
op_assign
(paren
id|u32
)paren
id|ioremap
c_func
(paren
id|si-&gt;pci_0.pci_io.cpu_base
comma
id|si-&gt;pci_0.pci_io.size
)paren
suffix:semicolon
id|isa_io_base
op_assign
id|bh-&gt;io_base_a
suffix:semicolon
id|mv64x60_alloc_hose
c_func
(paren
id|bh
comma
id|MV64x60_PCI0_CONFIG_ADDR
comma
id|MV64x60_PCI0_CONFIG_DATA
comma
op_amp
id|bh-&gt;hose_a
)paren
suffix:semicolon
id|mv64x60_config_resources
c_func
(paren
id|bh-&gt;hose_a
comma
op_amp
id|si-&gt;pci_0
comma
id|bh-&gt;io_base_a
)paren
suffix:semicolon
id|mv64x60_config_pci_params
c_func
(paren
id|bh-&gt;hose_a
comma
op_amp
id|si-&gt;pci_0
)paren
suffix:semicolon
id|mv64x60_config_cpu2pci_windows
c_func
(paren
id|bh
comma
op_amp
id|si-&gt;pci_0
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_config_pci2mem_windows
c_func
(paren
id|bh
comma
id|bh-&gt;hose_a
comma
op_amp
id|si-&gt;pci_0
comma
l_int|0
comma
id|mem_windows
)paren
suffix:semicolon
id|bh-&gt;ci
op_member_access_from_pointer
id|set_pci2regs_window
c_func
(paren
id|bh
comma
id|bh-&gt;hose_a
comma
l_int|0
comma
id|si-&gt;phys_reg_base
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|si-&gt;pci_1.enable_bus
)paren
(brace
id|mv64x60_alloc_hose
c_func
(paren
id|bh
comma
id|MV64x60_PCI1_CONFIG_ADDR
comma
id|MV64x60_PCI1_CONFIG_DATA
comma
op_amp
id|bh-&gt;hose_b
)paren
suffix:semicolon
id|mv64x60_config_resources
c_func
(paren
id|bh-&gt;hose_b
comma
op_amp
id|si-&gt;pci_1
comma
id|bh-&gt;io_base_b
)paren
suffix:semicolon
id|mv64x60_config_pci_params
c_func
(paren
id|bh-&gt;hose_b
comma
op_amp
id|si-&gt;pci_1
)paren
suffix:semicolon
id|mv64x60_config_cpu2pci_windows
c_func
(paren
id|bh
comma
op_amp
id|si-&gt;pci_1
comma
l_int|1
)paren
suffix:semicolon
id|mv64x60_config_pci2mem_windows
c_func
(paren
id|bh
comma
id|bh-&gt;hose_b
comma
op_amp
id|si-&gt;pci_1
comma
l_int|1
comma
id|mem_windows
)paren
suffix:semicolon
id|bh-&gt;ci
op_member_access_from_pointer
id|set_pci2regs_window
c_func
(paren
id|bh
comma
id|bh-&gt;hose_b
comma
l_int|1
comma
id|si-&gt;phys_reg_base
)paren
suffix:semicolon
)brace
id|bh-&gt;ci
op_member_access_from_pointer
id|chip_specific_init
c_func
(paren
id|bh
comma
id|si
)paren
suffix:semicolon
id|mv64x60_pd_fixup
c_func
(paren
id|bh
comma
id|mv64x60_pd_devs
comma
id|ARRAY_SIZE
c_func
(paren
id|mv64x60_pd_devs
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64x60_early_init()&n; *&n; * Do some bridge work that must take place before we start messing with&n; * the bridge for real.&n; */
r_void
id|__init
DECL|function|mv64x60_early_init
id|mv64x60_early_init
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|mv64x60_setup_info
op_star
id|si
)paren
(brace
r_struct
id|pci_controller
id|hose_a
comma
id|hose_b
suffix:semicolon
id|memset
c_func
(paren
id|bh
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|bh
)paren
)paren
suffix:semicolon
id|bh-&gt;p_base
op_assign
id|si-&gt;phys_reg_base
suffix:semicolon
id|bh-&gt;v_base
op_assign
id|ioremap
c_func
(paren
id|bh-&gt;p_base
comma
id|MV64x60_INTERNAL_SPACE_SIZE
)paren
suffix:semicolon
id|mv64x60_bridge_pbase
op_assign
id|bh-&gt;p_base
suffix:semicolon
id|mv64x60_bridge_vbase
op_assign
id|bh-&gt;v_base
suffix:semicolon
multiline_comment|/* Assuming pci mode [reserved] bits 4:5 on 64260 are 0 */
id|bh-&gt;pci_mode_a
op_assign
id|mv64x60_read
c_func
(paren
id|bh
comma
id|MV64x60_PCI0_MODE
)paren
op_amp
id|MV64x60_PCIMODE_MASK
suffix:semicolon
id|bh-&gt;pci_mode_b
op_assign
id|mv64x60_read
c_func
(paren
id|bh
comma
id|MV64x60_PCI1_MODE
)paren
op_amp
id|MV64x60_PCIMODE_MASK
suffix:semicolon
multiline_comment|/* Need temporary hose structs to call mv64x60_set_bus() */
id|memset
c_func
(paren
op_amp
id|hose_a
comma
l_int|0
comma
r_sizeof
(paren
id|hose_a
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|hose_b
comma
l_int|0
comma
r_sizeof
(paren
id|hose_b
)paren
)paren
suffix:semicolon
id|setup_indirect_pci_nomap
c_func
(paren
op_amp
id|hose_a
comma
id|bh-&gt;v_base
op_plus
id|MV64x60_PCI0_CONFIG_ADDR
comma
id|bh-&gt;v_base
op_plus
id|MV64x60_PCI0_CONFIG_DATA
)paren
suffix:semicolon
id|setup_indirect_pci_nomap
c_func
(paren
op_amp
id|hose_b
comma
id|bh-&gt;v_base
op_plus
id|MV64x60_PCI1_CONFIG_ADDR
comma
id|bh-&gt;v_base
op_plus
id|MV64x60_PCI1_CONFIG_DATA
)paren
suffix:semicolon
id|bh-&gt;hose_a
op_assign
op_amp
id|hose_a
suffix:semicolon
id|bh-&gt;hose_b
op_assign
op_amp
id|hose_b
suffix:semicolon
id|mv64x60_set_bus
c_func
(paren
id|bh
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_set_bus
c_func
(paren
id|bh
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|bh-&gt;hose_a
op_assign
l_int|NULL
suffix:semicolon
id|bh-&gt;hose_b
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Clear bit 0 of PCI addr decode control so PCI-&gt;CPU remap 1:1 */
id|mv64x60_clr_bits
c_func
(paren
id|bh
comma
id|MV64x60_PCI0_PCI_DECODE_CNTL
comma
l_int|0x00000001
)paren
suffix:semicolon
id|mv64x60_clr_bits
c_func
(paren
id|bh
comma
id|MV64x60_PCI1_PCI_DECODE_CNTL
comma
l_int|0x00000001
)paren
suffix:semicolon
multiline_comment|/* Bit 12 MUST be 0; set bit 27--don&squot;t auto-update cpu remap regs */
id|mv64x60_clr_bits
c_func
(paren
id|bh
comma
id|MV64x60_CPU_CONFIG
comma
(paren
l_int|1
op_lshift
l_int|12
)paren
)paren
suffix:semicolon
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64x60_CPU_CONFIG
comma
(paren
l_int|1
op_lshift
l_int|27
)paren
)paren
suffix:semicolon
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64x60_PCI0_TO_RETRY
comma
l_int|0xffff
)paren
suffix:semicolon
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64x60_PCI1_TO_RETRY
comma
l_int|0xffff
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; *****************************************************************************&n; *&n; *&t;Window Config Routines&n; *&n; *****************************************************************************&n; */
multiline_comment|/*&n; * mv64x60_get_32bit_window()&n; *&n; * Determine the base address and size of a 32-bit window on the bridge.&n; */
r_void
id|__init
DECL|function|mv64x60_get_32bit_window
id|mv64x60_get_32bit_window
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
comma
id|u32
op_star
id|base
comma
id|u32
op_star
id|size
)paren
(brace
id|u32
id|val
comma
id|base_reg
comma
id|size_reg
comma
id|base_bits
comma
id|size_bits
suffix:semicolon
id|u32
(paren
op_star
id|get_from_field
)paren
(paren
id|u32
id|val
comma
id|u32
id|num_bits
)paren
suffix:semicolon
id|base_reg
op_assign
id|bh-&gt;ci-&gt;window_tab_32bit
(braket
id|window
)braket
dot
id|base_reg
suffix:semicolon
r_if
c_cond
(paren
id|base_reg
op_ne
l_int|0
)paren
(brace
id|size_reg
op_assign
id|bh-&gt;ci-&gt;window_tab_32bit
(braket
id|window
)braket
dot
id|size_reg
suffix:semicolon
id|base_bits
op_assign
id|bh-&gt;ci-&gt;window_tab_32bit
(braket
id|window
)braket
dot
id|base_bits
suffix:semicolon
id|size_bits
op_assign
id|bh-&gt;ci-&gt;window_tab_32bit
(braket
id|window
)braket
dot
id|size_bits
suffix:semicolon
id|get_from_field
op_assign
id|bh-&gt;ci-&gt;window_tab_32bit
(braket
id|window
)braket
dot
id|get_from_field
suffix:semicolon
id|val
op_assign
id|mv64x60_read
c_func
(paren
id|bh
comma
id|base_reg
)paren
suffix:semicolon
op_star
id|base
op_assign
id|get_from_field
c_func
(paren
id|val
comma
id|base_bits
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size_reg
op_ne
l_int|0
)paren
(brace
id|val
op_assign
id|mv64x60_read
c_func
(paren
id|bh
comma
id|size_reg
)paren
suffix:semicolon
id|val
op_assign
id|get_from_field
c_func
(paren
id|val
comma
id|size_bits
)paren
suffix:semicolon
op_star
id|size
op_assign
id|bh-&gt;ci
op_member_access_from_pointer
id|untranslate_size
c_func
(paren
op_star
id|base
comma
id|val
comma
id|size_bits
)paren
suffix:semicolon
)brace
r_else
op_star
id|size
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
op_star
id|base
op_assign
l_int|0
suffix:semicolon
op_star
id|size
op_assign
l_int|0
suffix:semicolon
)brace
id|pr_debug
c_func
(paren
l_string|&quot;get 32bit window: %d, base: 0x%x, size: 0x%x&bslash;n&quot;
comma
id|window
comma
op_star
id|base
comma
op_star
id|size
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64x60_set_32bit_window()&n; *&n; * Set the base address and size of a 32-bit window on the bridge.&n; */
r_void
id|__init
DECL|function|mv64x60_set_32bit_window
id|mv64x60_set_32bit_window
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
comma
id|u32
id|base
comma
id|u32
id|size
comma
id|u32
id|other_bits
)paren
(brace
id|u32
id|val
comma
id|base_reg
comma
id|size_reg
comma
id|base_bits
comma
id|size_bits
suffix:semicolon
id|u32
(paren
op_star
id|map_to_field
)paren
(paren
id|u32
id|val
comma
id|u32
id|num_bits
)paren
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;set 32bit window: %d, base: 0x%x, size: 0x%x, other: 0x%x&bslash;n&quot;
comma
id|window
comma
id|base
comma
id|size
comma
id|other_bits
)paren
suffix:semicolon
id|base_reg
op_assign
id|bh-&gt;ci-&gt;window_tab_32bit
(braket
id|window
)braket
dot
id|base_reg
suffix:semicolon
r_if
c_cond
(paren
id|base_reg
op_ne
l_int|0
)paren
(brace
id|size_reg
op_assign
id|bh-&gt;ci-&gt;window_tab_32bit
(braket
id|window
)braket
dot
id|size_reg
suffix:semicolon
id|base_bits
op_assign
id|bh-&gt;ci-&gt;window_tab_32bit
(braket
id|window
)braket
dot
id|base_bits
suffix:semicolon
id|size_bits
op_assign
id|bh-&gt;ci-&gt;window_tab_32bit
(braket
id|window
)braket
dot
id|size_bits
suffix:semicolon
id|map_to_field
op_assign
id|bh-&gt;ci-&gt;window_tab_32bit
(braket
id|window
)braket
dot
id|map_to_field
suffix:semicolon
id|val
op_assign
id|map_to_field
c_func
(paren
id|base
comma
id|base_bits
)paren
op_or
id|other_bits
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|base_reg
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size_reg
op_ne
l_int|0
)paren
(brace
id|val
op_assign
id|bh-&gt;ci
op_member_access_from_pointer
id|translate_size
c_func
(paren
id|base
comma
id|size
comma
id|size_bits
)paren
suffix:semicolon
id|val
op_assign
id|map_to_field
c_func
(paren
id|val
comma
id|size_bits
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|size_reg
comma
id|val
)paren
suffix:semicolon
)brace
(paren
r_void
)paren
id|mv64x60_read
c_func
(paren
id|bh
comma
id|base_reg
)paren
suffix:semicolon
multiline_comment|/* Flush FIFO */
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64x60_get_64bit_window()&n; *&n; * Determine the base address and size of a 64-bit window on the bridge.&n; */
r_void
id|__init
DECL|function|mv64x60_get_64bit_window
id|mv64x60_get_64bit_window
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
comma
id|u32
op_star
id|base_hi
comma
id|u32
op_star
id|base_lo
comma
id|u32
op_star
id|size
)paren
(brace
id|u32
id|val
comma
id|base_lo_reg
comma
id|size_reg
comma
id|base_lo_bits
comma
id|size_bits
suffix:semicolon
id|u32
(paren
op_star
id|get_from_field
)paren
(paren
id|u32
id|val
comma
id|u32
id|num_bits
)paren
suffix:semicolon
id|base_lo_reg
op_assign
id|bh-&gt;ci-&gt;window_tab_64bit
(braket
id|window
)braket
dot
id|base_lo_reg
suffix:semicolon
r_if
c_cond
(paren
id|base_lo_reg
op_ne
l_int|0
)paren
(brace
id|size_reg
op_assign
id|bh-&gt;ci-&gt;window_tab_64bit
(braket
id|window
)braket
dot
id|size_reg
suffix:semicolon
id|base_lo_bits
op_assign
id|bh-&gt;ci-&gt;window_tab_64bit
(braket
id|window
)braket
dot
id|base_lo_bits
suffix:semicolon
id|size_bits
op_assign
id|bh-&gt;ci-&gt;window_tab_64bit
(braket
id|window
)braket
dot
id|size_bits
suffix:semicolon
id|get_from_field
op_assign
id|bh-&gt;ci-&gt;window_tab_64bit
(braket
id|window
)braket
dot
id|get_from_field
suffix:semicolon
op_star
id|base_hi
op_assign
id|mv64x60_read
c_func
(paren
id|bh
comma
id|bh-&gt;ci-&gt;window_tab_64bit
(braket
id|window
)braket
dot
id|base_hi_reg
)paren
suffix:semicolon
id|val
op_assign
id|mv64x60_read
c_func
(paren
id|bh
comma
id|base_lo_reg
)paren
suffix:semicolon
op_star
id|base_lo
op_assign
id|get_from_field
c_func
(paren
id|val
comma
id|base_lo_bits
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size_reg
op_ne
l_int|0
)paren
(brace
id|val
op_assign
id|mv64x60_read
c_func
(paren
id|bh
comma
id|size_reg
)paren
suffix:semicolon
id|val
op_assign
id|get_from_field
c_func
(paren
id|val
comma
id|size_bits
)paren
suffix:semicolon
op_star
id|size
op_assign
id|bh-&gt;ci
op_member_access_from_pointer
id|untranslate_size
c_func
(paren
op_star
id|base_lo
comma
id|val
comma
id|size_bits
)paren
suffix:semicolon
)brace
r_else
op_star
id|size
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
op_star
id|base_hi
op_assign
l_int|0
suffix:semicolon
op_star
id|base_lo
op_assign
l_int|0
suffix:semicolon
op_star
id|size
op_assign
l_int|0
suffix:semicolon
)brace
id|pr_debug
c_func
(paren
l_string|&quot;get 64bit window: %d, base hi: 0x%x, base lo: 0x%x, &quot;
l_string|&quot;size: 0x%x&bslash;n&quot;
comma
id|window
comma
op_star
id|base_hi
comma
op_star
id|base_lo
comma
op_star
id|size
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64x60_set_64bit_window()&n; *&n; * Set the base address and size of a 64-bit window on the bridge.&n; */
r_void
id|__init
DECL|function|mv64x60_set_64bit_window
id|mv64x60_set_64bit_window
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
comma
id|u32
id|base_hi
comma
id|u32
id|base_lo
comma
id|u32
id|size
comma
id|u32
id|other_bits
)paren
(brace
id|u32
id|val
comma
id|base_lo_reg
comma
id|size_reg
comma
id|base_lo_bits
comma
id|size_bits
suffix:semicolon
id|u32
(paren
op_star
id|map_to_field
)paren
(paren
id|u32
id|val
comma
id|u32
id|num_bits
)paren
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;set 64bit window: %d, base hi: 0x%x, base lo: 0x%x, &quot;
l_string|&quot;size: 0x%x, other: 0x%x&bslash;n&quot;
comma
id|window
comma
id|base_hi
comma
id|base_lo
comma
id|size
comma
id|other_bits
)paren
suffix:semicolon
id|base_lo_reg
op_assign
id|bh-&gt;ci-&gt;window_tab_64bit
(braket
id|window
)braket
dot
id|base_lo_reg
suffix:semicolon
r_if
c_cond
(paren
id|base_lo_reg
op_ne
l_int|0
)paren
(brace
id|size_reg
op_assign
id|bh-&gt;ci-&gt;window_tab_64bit
(braket
id|window
)braket
dot
id|size_reg
suffix:semicolon
id|base_lo_bits
op_assign
id|bh-&gt;ci-&gt;window_tab_64bit
(braket
id|window
)braket
dot
id|base_lo_bits
suffix:semicolon
id|size_bits
op_assign
id|bh-&gt;ci-&gt;window_tab_64bit
(braket
id|window
)braket
dot
id|size_bits
suffix:semicolon
id|map_to_field
op_assign
id|bh-&gt;ci-&gt;window_tab_64bit
(braket
id|window
)braket
dot
id|map_to_field
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|bh-&gt;ci-&gt;window_tab_64bit
(braket
id|window
)braket
dot
id|base_hi_reg
comma
id|base_hi
)paren
suffix:semicolon
id|val
op_assign
id|map_to_field
c_func
(paren
id|base_lo
comma
id|base_lo_bits
)paren
op_or
id|other_bits
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|base_lo_reg
comma
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size_reg
op_ne
l_int|0
)paren
(brace
id|val
op_assign
id|bh-&gt;ci
op_member_access_from_pointer
id|translate_size
c_func
(paren
id|base_lo
comma
id|size
comma
id|size_bits
)paren
suffix:semicolon
id|val
op_assign
id|map_to_field
c_func
(paren
id|val
comma
id|size_bits
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|size_reg
comma
id|val
)paren
suffix:semicolon
)brace
(paren
r_void
)paren
id|mv64x60_read
c_func
(paren
id|bh
comma
id|base_lo_reg
)paren
suffix:semicolon
multiline_comment|/* Flush FIFO */
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64x60_mask()&n; *&n; * Take the high-order &squot;num_bits&squot; of &squot;val&squot; &amp; mask off low bits.&n; */
id|u32
id|__init
DECL|function|mv64x60_mask
id|mv64x60_mask
c_func
(paren
id|u32
id|val
comma
id|u32
id|num_bits
)paren
(brace
r_return
id|val
op_amp
(paren
l_int|0xffffffff
op_lshift
(paren
l_int|32
op_minus
id|num_bits
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64x60_shift_left()&n; *&n; * Take the low-order &squot;num_bits&squot; of &squot;val&squot;, shift left to align at bit 31 (MSB).&n; */
id|u32
id|__init
DECL|function|mv64x60_shift_left
id|mv64x60_shift_left
c_func
(paren
id|u32
id|val
comma
id|u32
id|num_bits
)paren
(brace
r_return
id|val
op_lshift
(paren
l_int|32
op_minus
id|num_bits
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64x60_shift_right()&n; *&n; * Take the high-order &squot;num_bits&squot; of &squot;val&squot;, shift right to align at bit 0 (LSB).&n; */
id|u32
id|__init
DECL|function|mv64x60_shift_right
id|mv64x60_shift_right
c_func
(paren
id|u32
id|val
comma
id|u32
id|num_bits
)paren
(brace
r_return
id|val
op_rshift
(paren
l_int|32
op_minus
id|num_bits
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *****************************************************************************&n; *&n; *&t;Chip Identification Routines&n; *&n; *****************************************************************************&n; */
multiline_comment|/*&n; * mv64x60_get_type()&n; *&n; * Determine the type of bridge chip we have.&n; */
r_int
id|__init
DECL|function|mv64x60_get_type
id|mv64x60_get_type
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
)paren
(brace
r_struct
id|pci_controller
id|hose
suffix:semicolon
id|u16
id|val
suffix:semicolon
id|u8
id|save_exclude
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|hose
comma
l_int|0
comma
r_sizeof
(paren
id|hose
)paren
)paren
suffix:semicolon
id|setup_indirect_pci_nomap
c_func
(paren
op_amp
id|hose
comma
id|bh-&gt;v_base
op_plus
id|MV64x60_PCI0_CONFIG_ADDR
comma
id|bh-&gt;v_base
op_plus
id|MV64x60_PCI0_CONFIG_DATA
)paren
suffix:semicolon
id|save_exclude
op_assign
id|mv64x60_pci_exclude_bridge
suffix:semicolon
id|mv64x60_pci_exclude_bridge
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Sanity check of bridge&squot;s Vendor ID */
id|early_read_config_word
c_func
(paren
op_amp
id|hose
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_VENDOR_ID
comma
op_amp
id|val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
op_ne
id|PCI_VENDOR_ID_MARVELL
)paren
(brace
id|mv64x60_pci_exclude_bridge
op_assign
id|save_exclude
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Get the revision of the chip */
id|early_read_config_word
c_func
(paren
op_amp
id|hose
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|val
)paren
suffix:semicolon
id|bh-&gt;rev
op_assign
(paren
id|u32
)paren
(paren
id|val
op_amp
l_int|0xff
)paren
suffix:semicolon
multiline_comment|/* Figure out the type of Marvell bridge it is */
id|early_read_config_word
c_func
(paren
op_amp
id|hose
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_DEVICE_ID
comma
op_amp
id|val
)paren
suffix:semicolon
id|mv64x60_pci_exclude_bridge
op_assign
id|save_exclude
suffix:semicolon
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
id|PCI_DEVICE_ID_MARVELL_GT64260
suffix:colon
r_switch
c_cond
(paren
id|bh-&gt;rev
)paren
(brace
r_case
id|GT64260_REV_A
suffix:colon
id|bh-&gt;type
op_assign
id|MV64x60_TYPE_GT64260A
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Unsupported GT64260 rev %04x&bslash;n&quot;
comma
id|bh-&gt;rev
)paren
suffix:semicolon
multiline_comment|/* Assume its similar to a &squot;B&squot; rev and fallthru */
r_case
id|GT64260_REV_B
suffix:colon
id|bh-&gt;type
op_assign
id|MV64x60_TYPE_GT64260B
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_MARVELL_MV64360
suffix:colon
multiline_comment|/* Marvell won&squot;t tell me how to distinguish a 64361 &amp; 64362 */
id|bh-&gt;type
op_assign
id|MV64x60_TYPE_MV64360
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_MARVELL_MV64460
suffix:colon
id|bh-&gt;type
op_assign
id|MV64x60_TYPE_MV64460
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Unknown Marvell bridge type %04x&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Hang onto bridge type &amp; rev for PIC code */
id|mv64x60_bridge_type
op_assign
id|bh-&gt;type
suffix:semicolon
id|mv64x60_bridge_rev
op_assign
id|bh-&gt;rev
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64x60_setup_for_chip()&n; *&n; * Set &squot;bh&squot; to use the proper set of routine for the bridge chip that we have.&n; */
r_int
id|__init
DECL|function|mv64x60_setup_for_chip
id|mv64x60_setup_for_chip
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Set up chip-specific info based on the chip/bridge type */
r_switch
c_cond
(paren
id|bh-&gt;type
)paren
(brace
r_case
id|MV64x60_TYPE_GT64260A
suffix:colon
id|bh-&gt;ci
op_assign
op_amp
id|gt64260a_ci
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MV64x60_TYPE_GT64260B
suffix:colon
id|bh-&gt;ci
op_assign
op_amp
id|gt64260b_ci
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MV64x60_TYPE_MV64360
suffix:colon
id|bh-&gt;ci
op_assign
op_amp
id|mv64360_ci
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MV64x60_TYPE_MV64460
suffix:colon
id|bh-&gt;ci
op_assign
op_amp
id|mv64460_ci
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MV64x60_TYPE_INVALID
suffix:colon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;mv64x60: Unsupported bridge&quot;
comma
l_int|0x0
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;mv64x60: Unsupported bridge&bslash;n&quot;
)paren
suffix:semicolon
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64x60_get_bridge_vbase()&n; *&n; * Return the virtual address of the bridge&squot;s registers.&n; */
r_void
op_star
DECL|function|mv64x60_get_bridge_vbase
id|mv64x60_get_bridge_vbase
c_func
(paren
r_void
)paren
(brace
r_return
id|mv64x60_bridge_vbase
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64x60_get_bridge_type()&n; *&n; * Return the type of bridge on the platform.&n; */
id|u32
DECL|function|mv64x60_get_bridge_type
id|mv64x60_get_bridge_type
c_func
(paren
r_void
)paren
(brace
r_return
id|mv64x60_bridge_type
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64x60_get_bridge_rev()&n; *&n; * Return the revision of the bridge on the platform.&n; */
id|u32
DECL|function|mv64x60_get_bridge_rev
id|mv64x60_get_bridge_rev
c_func
(paren
r_void
)paren
(brace
r_return
id|mv64x60_bridge_rev
suffix:semicolon
)brace
multiline_comment|/*&n; *****************************************************************************&n; *&n; *&t;System Memory Window Related Routines&n; *&n; *****************************************************************************&n; */
multiline_comment|/*&n; * mv64x60_get_mem_size()&n; *&n; * Calculate the amount of memory that the memory controller is set up for.&n; * This should only be used by board-specific code if there is no other&n; * way to determine the amount of memory in the system.&n; */
id|u32
id|__init
DECL|function|mv64x60_get_mem_size
id|mv64x60_get_mem_size
c_func
(paren
id|u32
id|bridge_base
comma
id|u32
id|chip_type
)paren
(brace
r_struct
id|mv64x60_handle
id|bh
suffix:semicolon
id|u32
id|mem_windows
(braket
id|MV64x60_CPU2MEM_WINDOWS
)braket
(braket
l_int|2
)braket
suffix:semicolon
id|u32
id|rc
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|bh
comma
l_int|0
comma
r_sizeof
(paren
id|bh
)paren
)paren
suffix:semicolon
id|bh.type
op_assign
id|chip_type
suffix:semicolon
id|bh.v_base
op_assign
(paren
r_void
op_star
)paren
id|bridge_base
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mv64x60_setup_for_chip
c_func
(paren
op_amp
id|bh
)paren
)paren
(brace
id|mv64x60_get_mem_windows
c_func
(paren
op_amp
id|bh
comma
id|mem_windows
)paren
suffix:semicolon
id|rc
op_assign
id|mv64x60_calc_mem_size
c_func
(paren
op_amp
id|bh
comma
id|mem_windows
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64x60_get_mem_windows()&n; *&n; * Get the values in the memory controller &amp; return in the &squot;mem_windows&squot; array.&n; */
r_void
id|__init
DECL|function|mv64x60_get_mem_windows
id|mv64x60_get_mem_windows
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|mem_windows
(braket
id|MV64x60_CPU2MEM_WINDOWS
)braket
(braket
l_int|2
)braket
)paren
(brace
id|u32
id|i
comma
id|win
suffix:semicolon
r_for
c_loop
(paren
id|win
op_assign
id|MV64x60_CPU2MEM_0_WIN
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|win
op_le
id|MV64x60_CPU2MEM_3_WIN
suffix:semicolon
id|win
op_increment
comma
id|i
op_increment
)paren
r_if
c_cond
(paren
id|bh-&gt;ci
op_member_access_from_pointer
id|is_enabled_32bit
c_func
(paren
id|bh
comma
id|win
)paren
)paren
id|mv64x60_get_32bit_window
c_func
(paren
id|bh
comma
id|win
comma
op_amp
id|mem_windows
(braket
id|i
)braket
(braket
l_int|0
)braket
comma
op_amp
id|mem_windows
(braket
id|i
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_else
(brace
id|mem_windows
(braket
id|i
)braket
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|mem_windows
(braket
id|i
)braket
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64x60_calc_mem_size()&n; *&n; * Using the memory controller register values in &squot;mem_windows&squot;, determine&n; * how much memory it is set up for.&n; */
id|u32
id|__init
DECL|function|mv64x60_calc_mem_size
id|mv64x60_calc_mem_size
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|mem_windows
(braket
id|MV64x60_CPU2MEM_WINDOWS
)braket
(braket
l_int|2
)braket
)paren
(brace
id|u32
id|i
comma
id|total
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MV64x60_CPU2MEM_WINDOWS
suffix:semicolon
id|i
op_increment
)paren
id|total
op_add_assign
id|mem_windows
(braket
id|i
)braket
(braket
l_int|1
)braket
suffix:semicolon
r_return
id|total
suffix:semicolon
)brace
multiline_comment|/*&n; *****************************************************************************&n; *&n; *&t;CPU-&gt;System MEM, PCI Config Routines&n; *&n; *****************************************************************************&n; */
multiline_comment|/*&n; * mv64x60_config_cpu2mem_windows()&n; *&n; * Configure CPU-&gt;Memory windows on the bridge.&n; */
DECL|variable|__initdata
r_static
id|u32
id|prot_tab
(braket
)braket
id|__initdata
op_assign
(brace
id|MV64x60_CPU_PROT_0_WIN
comma
id|MV64x60_CPU_PROT_1_WIN
comma
id|MV64x60_CPU_PROT_2_WIN
comma
id|MV64x60_CPU_PROT_3_WIN
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|u32
id|cpu_snoop_tab
(braket
)braket
id|__initdata
op_assign
(brace
id|MV64x60_CPU_SNOOP_0_WIN
comma
id|MV64x60_CPU_SNOOP_1_WIN
comma
id|MV64x60_CPU_SNOOP_2_WIN
comma
id|MV64x60_CPU_SNOOP_3_WIN
)brace
suffix:semicolon
r_void
id|__init
DECL|function|mv64x60_config_cpu2mem_windows
id|mv64x60_config_cpu2mem_windows
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|mv64x60_setup_info
op_star
id|si
comma
id|u32
id|mem_windows
(braket
id|MV64x60_CPU2MEM_WINDOWS
)braket
(braket
l_int|2
)braket
)paren
(brace
id|u32
id|i
comma
id|win
suffix:semicolon
multiline_comment|/* Set CPU protection &amp; snoop windows */
r_for
c_loop
(paren
id|win
op_assign
id|MV64x60_CPU2MEM_0_WIN
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|win
op_le
id|MV64x60_CPU2MEM_3_WIN
suffix:semicolon
id|win
op_increment
comma
id|i
op_increment
)paren
r_if
c_cond
(paren
id|bh-&gt;ci
op_member_access_from_pointer
id|is_enabled_32bit
c_func
(paren
id|bh
comma
id|win
)paren
)paren
(brace
id|mv64x60_set_32bit_window
c_func
(paren
id|bh
comma
id|prot_tab
(braket
id|i
)braket
comma
id|mem_windows
(braket
id|i
)braket
(braket
l_int|0
)braket
comma
id|mem_windows
(braket
id|i
)braket
(braket
l_int|1
)braket
comma
id|si-&gt;cpu_prot_options
(braket
id|i
)braket
)paren
suffix:semicolon
id|bh-&gt;ci
op_member_access_from_pointer
id|enable_window_32bit
c_func
(paren
id|bh
comma
id|prot_tab
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bh-&gt;ci-&gt;window_tab_32bit
(braket
id|cpu_snoop_tab
(braket
id|i
)braket
)braket
dot
id|base_reg
op_ne
l_int|0
)paren
(brace
id|mv64x60_set_32bit_window
c_func
(paren
id|bh
comma
id|cpu_snoop_tab
(braket
id|i
)braket
comma
id|mem_windows
(braket
id|i
)braket
(braket
l_int|0
)braket
comma
id|mem_windows
(braket
id|i
)braket
(braket
l_int|1
)braket
comma
id|si-&gt;cpu_snoop_options
(braket
id|i
)braket
)paren
suffix:semicolon
id|bh-&gt;ci
op_member_access_from_pointer
id|enable_window_32bit
c_func
(paren
id|bh
comma
id|cpu_snoop_tab
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64x60_config_cpu2pci_windows()&n; *&n; * Configure the CPU-&gt;PCI windows for one of the PCI buses.&n; */
DECL|variable|__initdata
r_static
id|u32
id|win_tab
(braket
l_int|2
)braket
(braket
l_int|4
)braket
id|__initdata
op_assign
(brace
(brace
id|MV64x60_CPU2PCI0_IO_WIN
comma
id|MV64x60_CPU2PCI0_MEM_0_WIN
comma
id|MV64x60_CPU2PCI0_MEM_1_WIN
comma
id|MV64x60_CPU2PCI0_MEM_2_WIN
)brace
comma
(brace
id|MV64x60_CPU2PCI1_IO_WIN
comma
id|MV64x60_CPU2PCI1_MEM_0_WIN
comma
id|MV64x60_CPU2PCI1_MEM_1_WIN
comma
id|MV64x60_CPU2PCI1_MEM_2_WIN
)brace
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|u32
id|remap_tab
(braket
l_int|2
)braket
(braket
l_int|4
)braket
id|__initdata
op_assign
(brace
(brace
id|MV64x60_CPU2PCI0_IO_REMAP_WIN
comma
id|MV64x60_CPU2PCI0_MEM_0_REMAP_WIN
comma
id|MV64x60_CPU2PCI0_MEM_1_REMAP_WIN
comma
id|MV64x60_CPU2PCI0_MEM_2_REMAP_WIN
)brace
comma
(brace
id|MV64x60_CPU2PCI1_IO_REMAP_WIN
comma
id|MV64x60_CPU2PCI1_MEM_0_REMAP_WIN
comma
id|MV64x60_CPU2PCI1_MEM_1_REMAP_WIN
comma
id|MV64x60_CPU2PCI1_MEM_2_REMAP_WIN
)brace
)brace
suffix:semicolon
r_void
id|__init
DECL|function|mv64x60_config_cpu2pci_windows
id|mv64x60_config_cpu2pci_windows
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|mv64x60_pci_info
op_star
id|pi
comma
id|u32
id|bus
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|pi-&gt;pci_io.size
OG
l_int|0
)paren
(brace
id|mv64x60_set_32bit_window
c_func
(paren
id|bh
comma
id|win_tab
(braket
id|bus
)braket
(braket
l_int|0
)braket
comma
id|pi-&gt;pci_io.cpu_base
comma
id|pi-&gt;pci_io.size
comma
id|pi-&gt;pci_io.swap
)paren
suffix:semicolon
id|mv64x60_set_32bit_window
c_func
(paren
id|bh
comma
id|remap_tab
(braket
id|bus
)braket
(braket
l_int|0
)braket
comma
id|pi-&gt;pci_io.pci_base_lo
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|bh-&gt;ci
op_member_access_from_pointer
id|enable_window_32bit
c_func
(paren
id|bh
comma
id|win_tab
(braket
id|bus
)braket
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
r_else
multiline_comment|/* Actually, the window should already be disabled */
id|bh-&gt;ci
op_member_access_from_pointer
id|disable_window_32bit
c_func
(paren
id|bh
comma
id|win_tab
(braket
id|bus
)braket
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|pi-&gt;pci_mem
(braket
id|i
)braket
dot
id|size
OG
l_int|0
)paren
(brace
id|mv64x60_set_32bit_window
c_func
(paren
id|bh
comma
id|win_tab
(braket
id|bus
)braket
(braket
id|i
op_plus
l_int|1
)braket
comma
id|pi-&gt;pci_mem
(braket
id|i
)braket
dot
id|cpu_base
comma
id|pi-&gt;pci_mem
(braket
id|i
)braket
dot
id|size
comma
id|pi-&gt;pci_mem
(braket
id|i
)braket
dot
id|swap
)paren
suffix:semicolon
id|mv64x60_set_64bit_window
c_func
(paren
id|bh
comma
id|remap_tab
(braket
id|bus
)braket
(braket
id|i
op_plus
l_int|1
)braket
comma
id|pi-&gt;pci_mem
(braket
id|i
)braket
dot
id|pci_base_hi
comma
id|pi-&gt;pci_mem
(braket
id|i
)braket
dot
id|pci_base_lo
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|bh-&gt;ci
op_member_access_from_pointer
id|enable_window_32bit
c_func
(paren
id|bh
comma
id|win_tab
(braket
id|bus
)braket
(braket
id|i
op_plus
l_int|1
)braket
)paren
suffix:semicolon
)brace
r_else
multiline_comment|/* Actually, the window should already be disabled */
id|bh-&gt;ci
op_member_access_from_pointer
id|disable_window_32bit
c_func
(paren
id|bh
comma
id|win_tab
(braket
id|bus
)braket
(braket
id|i
op_plus
l_int|1
)braket
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; *****************************************************************************&n; *&n; *&t;PCI-&gt;System MEM Config Routines&n; *&n; *****************************************************************************&n; */
multiline_comment|/*&n; * mv64x60_config_pci2mem_windows()&n; *&n; * Configure the PCI-&gt;Memory windows on the bridge.&n; */
DECL|variable|__initdata
r_static
id|u32
id|pci_acc_tab
(braket
l_int|2
)braket
(braket
l_int|4
)braket
id|__initdata
op_assign
(brace
(brace
id|MV64x60_PCI02MEM_ACC_CNTL_0_WIN
comma
id|MV64x60_PCI02MEM_ACC_CNTL_1_WIN
comma
id|MV64x60_PCI02MEM_ACC_CNTL_2_WIN
comma
id|MV64x60_PCI02MEM_ACC_CNTL_3_WIN
)brace
comma
(brace
id|MV64x60_PCI12MEM_ACC_CNTL_0_WIN
comma
id|MV64x60_PCI12MEM_ACC_CNTL_1_WIN
comma
id|MV64x60_PCI12MEM_ACC_CNTL_2_WIN
comma
id|MV64x60_PCI12MEM_ACC_CNTL_3_WIN
)brace
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|u32
id|pci_snoop_tab
(braket
l_int|2
)braket
(braket
l_int|4
)braket
id|__initdata
op_assign
(brace
(brace
id|MV64x60_PCI02MEM_SNOOP_0_WIN
comma
id|MV64x60_PCI02MEM_SNOOP_1_WIN
comma
id|MV64x60_PCI02MEM_SNOOP_2_WIN
comma
id|MV64x60_PCI02MEM_SNOOP_3_WIN
)brace
comma
(brace
id|MV64x60_PCI12MEM_SNOOP_0_WIN
comma
id|MV64x60_PCI12MEM_SNOOP_1_WIN
comma
id|MV64x60_PCI12MEM_SNOOP_2_WIN
comma
id|MV64x60_PCI12MEM_SNOOP_3_WIN
)brace
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|u32
id|pci_size_tab
(braket
l_int|2
)braket
(braket
l_int|4
)braket
id|__initdata
op_assign
(brace
(brace
id|MV64x60_PCI0_MEM_0_SIZE
comma
id|MV64x60_PCI0_MEM_1_SIZE
comma
id|MV64x60_PCI0_MEM_2_SIZE
comma
id|MV64x60_PCI0_MEM_3_SIZE
)brace
comma
(brace
id|MV64x60_PCI1_MEM_0_SIZE
comma
id|MV64x60_PCI1_MEM_1_SIZE
comma
id|MV64x60_PCI1_MEM_2_SIZE
comma
id|MV64x60_PCI1_MEM_3_SIZE
)brace
)brace
suffix:semicolon
r_void
id|__init
DECL|function|mv64x60_config_pci2mem_windows
id|mv64x60_config_pci2mem_windows
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|pci_controller
op_star
id|hose
comma
r_struct
id|mv64x60_pci_info
op_star
id|pi
comma
id|u32
id|bus
comma
id|u32
id|mem_windows
(braket
id|MV64x60_CPU2MEM_WINDOWS
)braket
(braket
l_int|2
)braket
)paren
(brace
id|u32
id|i
comma
id|win
suffix:semicolon
multiline_comment|/*&n;&t; * Set the access control, snoop, BAR size, and window base addresses.&n;&t; * PCI-&gt;MEM windows base addresses will match exactly what the&n;&t; * CPU-&gt;MEM windows are.&n;&t; */
r_for
c_loop
(paren
id|win
op_assign
id|MV64x60_CPU2MEM_0_WIN
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|win
op_le
id|MV64x60_CPU2MEM_3_WIN
suffix:semicolon
id|win
op_increment
comma
id|i
op_increment
)paren
r_if
c_cond
(paren
id|bh-&gt;ci
op_member_access_from_pointer
id|is_enabled_32bit
c_func
(paren
id|bh
comma
id|win
)paren
)paren
(brace
id|mv64x60_set_64bit_window
c_func
(paren
id|bh
comma
id|pci_acc_tab
(braket
id|bus
)braket
(braket
id|i
)braket
comma
l_int|0
comma
id|mem_windows
(braket
id|i
)braket
(braket
l_int|0
)braket
comma
id|mem_windows
(braket
id|i
)braket
(braket
l_int|1
)braket
comma
id|pi-&gt;acc_cntl_options
(braket
id|i
)braket
)paren
suffix:semicolon
id|bh-&gt;ci
op_member_access_from_pointer
id|enable_window_64bit
c_func
(paren
id|bh
comma
id|pci_acc_tab
(braket
id|bus
)braket
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bh-&gt;ci-&gt;window_tab_64bit
(braket
id|pci_snoop_tab
(braket
id|bus
)braket
(braket
id|i
)braket
)braket
dot
id|base_lo_reg
op_ne
l_int|0
)paren
(brace
id|mv64x60_set_64bit_window
c_func
(paren
id|bh
comma
id|pci_snoop_tab
(braket
id|bus
)braket
(braket
id|i
)braket
comma
l_int|0
comma
id|mem_windows
(braket
id|i
)braket
(braket
l_int|0
)braket
comma
id|mem_windows
(braket
id|i
)braket
(braket
l_int|1
)braket
comma
id|pi-&gt;snoop_options
(braket
id|i
)braket
)paren
suffix:semicolon
id|bh-&gt;ci
op_member_access_from_pointer
id|enable_window_64bit
c_func
(paren
id|bh
comma
id|pci_snoop_tab
(braket
id|bus
)braket
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|bh-&gt;ci
op_member_access_from_pointer
id|set_pci2mem_window
c_func
(paren
id|hose
comma
id|bus
comma
id|i
comma
id|mem_windows
(braket
id|i
)braket
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|pci_size_tab
(braket
id|bus
)braket
(braket
id|i
)braket
comma
id|mv64x60_mask
c_func
(paren
id|mem_windows
(braket
id|i
)braket
(braket
l_int|1
)braket
op_minus
l_int|1
comma
l_int|20
)paren
)paren
suffix:semicolon
multiline_comment|/* Enable the window */
id|mv64x60_clr_bits
c_func
(paren
id|bh
comma
(paren
(paren
id|bus
op_eq
l_int|0
)paren
ques
c_cond
id|MV64x60_PCI0_BAR_ENABLE
suffix:colon
id|MV64x60_PCI1_BAR_ENABLE
)paren
comma
(paren
l_int|1
op_lshift
id|i
)paren
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; *****************************************************************************&n; *&n; *&t;Hose &amp; Resource Alloc/Init Routines&n; *&n; *****************************************************************************&n; */
multiline_comment|/*&n; * mv64x60_alloc_hoses()&n; *&n; * Allocate the PCI hose structures for the bridge&squot;s PCI buses.&n; */
r_void
id|__init
DECL|function|mv64x60_alloc_hose
id|mv64x60_alloc_hose
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|cfg_addr
comma
id|u32
id|cfg_data
comma
r_struct
id|pci_controller
op_star
op_star
id|hose
)paren
(brace
op_star
id|hose
op_assign
id|pcibios_alloc_controller
c_func
(paren
)paren
suffix:semicolon
id|setup_indirect_pci_nomap
c_func
(paren
op_star
id|hose
comma
id|bh-&gt;v_base
op_plus
id|cfg_addr
comma
id|bh-&gt;v_base
op_plus
id|cfg_data
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64x60_config_resources()&n; *&n; * Calculate the offsets, etc. for the hose structures to reflect all of&n; * the address remapping that happens as you go from CPU-&gt;PCI and PCI-&gt;MEM.&n; */
r_void
id|__init
DECL|function|mv64x60_config_resources
id|mv64x60_config_resources
c_func
(paren
r_struct
id|pci_controller
op_star
id|hose
comma
r_struct
id|mv64x60_pci_info
op_star
id|pi
comma
id|u32
id|io_base
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* 2 hoses; 4 resources/hose; string &lt;= 64 bytes */
r_static
r_char
id|s
(braket
l_int|2
)braket
(braket
l_int|4
)braket
(braket
l_int|64
)braket
suffix:semicolon
r_if
c_cond
(paren
id|pi-&gt;pci_io.size
op_ne
l_int|0
)paren
(brace
id|sprintf
c_func
(paren
id|s
(braket
id|hose-&gt;index
)braket
(braket
l_int|0
)braket
comma
l_string|&quot;PCI hose %d I/O Space&quot;
comma
id|hose-&gt;index
)paren
suffix:semicolon
id|pci_init_resource
c_func
(paren
op_amp
id|hose-&gt;io_resource
comma
id|io_base
op_minus
id|isa_io_base
comma
id|io_base
op_minus
id|isa_io_base
op_plus
id|pi-&gt;pci_io.size
op_minus
l_int|1
comma
id|IORESOURCE_IO
comma
id|s
(braket
id|hose-&gt;index
)braket
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|hose-&gt;io_space.start
op_assign
id|pi-&gt;pci_io.pci_base_lo
suffix:semicolon
id|hose-&gt;io_space.end
op_assign
id|pi-&gt;pci_io.pci_base_lo
op_plus
id|pi-&gt;pci_io.size
op_minus
l_int|1
suffix:semicolon
id|hose-&gt;io_base_phys
op_assign
id|pi-&gt;pci_io.cpu_base
suffix:semicolon
id|hose-&gt;io_base_virt
op_assign
(paren
r_void
op_star
)paren
id|isa_io_base
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|3
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|pi-&gt;pci_mem
(braket
id|i
)braket
dot
id|size
op_ne
l_int|0
)paren
(brace
id|sprintf
c_func
(paren
id|s
(braket
id|hose-&gt;index
)braket
(braket
id|i
op_plus
l_int|1
)braket
comma
l_string|&quot;PCI hose %d MEM Space %d&quot;
comma
id|hose-&gt;index
comma
id|i
)paren
suffix:semicolon
id|pci_init_resource
c_func
(paren
op_amp
id|hose-&gt;mem_resources
(braket
id|i
)braket
comma
id|pi-&gt;pci_mem
(braket
id|i
)braket
dot
id|cpu_base
comma
id|pi-&gt;pci_mem
(braket
id|i
)braket
dot
id|cpu_base
op_plus
id|pi-&gt;pci_mem
(braket
id|i
)braket
dot
id|size
op_minus
l_int|1
comma
id|IORESOURCE_MEM
comma
id|s
(braket
id|hose-&gt;index
)braket
(braket
id|i
op_plus
l_int|1
)braket
)paren
suffix:semicolon
)brace
id|hose-&gt;mem_space.end
op_assign
id|pi-&gt;pci_mem
(braket
l_int|0
)braket
dot
id|pci_base_lo
op_plus
id|pi-&gt;pci_mem
(braket
l_int|0
)braket
dot
id|size
op_minus
l_int|1
suffix:semicolon
id|hose-&gt;pci_mem_offset
op_assign
id|pi-&gt;pci_mem
(braket
l_int|0
)braket
dot
id|cpu_base
op_minus
id|pi-&gt;pci_mem
(braket
l_int|0
)braket
dot
id|pci_base_lo
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64x60_config_pci_params()&n; *&n; * Configure a hose&squot;s PCI config space parameters.&n; */
r_void
id|__init
DECL|function|mv64x60_config_pci_params
id|mv64x60_config_pci_params
c_func
(paren
r_struct
id|pci_controller
op_star
id|hose
comma
r_struct
id|mv64x60_pci_info
op_star
id|pi
)paren
(brace
id|u32
id|devfn
suffix:semicolon
id|u16
id|u16_val
suffix:semicolon
id|u8
id|save_exclude
suffix:semicolon
id|devfn
op_assign
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|save_exclude
op_assign
id|mv64x60_pci_exclude_bridge
suffix:semicolon
id|mv64x60_pci_exclude_bridge
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Set class code to indicate host bridge */
id|u16_val
op_assign
id|PCI_CLASS_BRIDGE_HOST
suffix:semicolon
multiline_comment|/* 0x0600 (host bridge) */
id|early_write_config_word
c_func
(paren
id|hose
comma
l_int|0
comma
id|devfn
comma
id|PCI_CLASS_DEVICE
comma
id|u16_val
)paren
suffix:semicolon
multiline_comment|/* Enable bridge to be PCI master &amp; respond to PCI MEM cycles */
id|early_read_config_word
c_func
(paren
id|hose
comma
l_int|0
comma
id|devfn
comma
id|PCI_COMMAND
comma
op_amp
id|u16_val
)paren
suffix:semicolon
id|u16_val
op_and_assign
op_complement
(paren
id|PCI_COMMAND_IO
op_or
id|PCI_COMMAND_INVALIDATE
op_or
id|PCI_COMMAND_PARITY
op_or
id|PCI_COMMAND_SERR
op_or
id|PCI_COMMAND_FAST_BACK
)paren
suffix:semicolon
id|u16_val
op_or_assign
id|pi-&gt;pci_cmd_bits
op_or
id|PCI_COMMAND_MASTER
op_or
id|PCI_COMMAND_MEMORY
suffix:semicolon
id|early_write_config_word
c_func
(paren
id|hose
comma
l_int|0
comma
id|devfn
comma
id|PCI_COMMAND
comma
id|u16_val
)paren
suffix:semicolon
multiline_comment|/* Set latency timer, cache line size, clear BIST */
id|u16_val
op_assign
(paren
id|pi-&gt;latency_timer
op_lshift
l_int|8
)paren
op_or
(paren
id|L1_CACHE_LINE_SIZE
op_rshift
l_int|2
)paren
suffix:semicolon
id|early_write_config_word
c_func
(paren
id|hose
comma
l_int|0
comma
id|devfn
comma
id|PCI_CACHE_LINE_SIZE
comma
id|u16_val
)paren
suffix:semicolon
id|mv64x60_pci_exclude_bridge
op_assign
id|save_exclude
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; *****************************************************************************&n; *&n; *&t;PCI Related Routine&n; *&n; *****************************************************************************&n; */
multiline_comment|/*&n; * mv64x60_set_bus()&n; *&n; * Set the bus number for the hose directly under the bridge.&n; */
r_void
id|__init
DECL|function|mv64x60_set_bus
id|mv64x60_set_bus
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|bus
comma
id|u32
id|child_bus
)paren
(brace
r_struct
id|pci_controller
op_star
id|hose
suffix:semicolon
id|u32
id|pci_mode
comma
id|p2p_cfg
comma
id|pci_cfg_offset
comma
id|val
suffix:semicolon
id|u8
id|save_exclude
suffix:semicolon
r_if
c_cond
(paren
id|bus
op_eq
l_int|0
)paren
(brace
id|pci_mode
op_assign
id|bh-&gt;pci_mode_a
suffix:semicolon
id|p2p_cfg
op_assign
id|MV64x60_PCI0_P2P_CONFIG
suffix:semicolon
id|pci_cfg_offset
op_assign
l_int|0x64
suffix:semicolon
id|hose
op_assign
id|bh-&gt;hose_a
suffix:semicolon
)brace
r_else
(brace
id|pci_mode
op_assign
id|bh-&gt;pci_mode_b
suffix:semicolon
id|p2p_cfg
op_assign
id|MV64x60_PCI1_P2P_CONFIG
suffix:semicolon
id|pci_cfg_offset
op_assign
l_int|0xe4
suffix:semicolon
id|hose
op_assign
id|bh-&gt;hose_b
suffix:semicolon
)brace
id|child_bus
op_and_assign
l_int|0xff
suffix:semicolon
id|val
op_assign
id|mv64x60_read
c_func
(paren
id|bh
comma
id|p2p_cfg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_mode
op_eq
id|MV64x60_PCIMODE_CONVENTIONAL
)paren
(brace
id|val
op_and_assign
l_int|0xe0000000
suffix:semicolon
multiline_comment|/* Force dev num to 0, turn off P2P bridge */
id|val
op_or_assign
(paren
id|child_bus
op_lshift
l_int|16
)paren
op_or
l_int|0xff
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|p2p_cfg
comma
id|val
)paren
suffix:semicolon
(paren
r_void
)paren
id|mv64x60_read
c_func
(paren
id|bh
comma
id|p2p_cfg
)paren
suffix:semicolon
multiline_comment|/* Flush FIFO */
)brace
r_else
(brace
multiline_comment|/* PCI-X */
multiline_comment|/*&n;&t;&t; * Need to use the current bus/dev number (that&squot;s in the&n;&t;&t; * P2P CONFIG reg) to access the bridge&squot;s pci config space.&n;&t;&t; */
id|save_exclude
op_assign
id|mv64x60_pci_exclude_bridge
suffix:semicolon
id|mv64x60_pci_exclude_bridge
op_assign
l_int|0
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|hose
comma
(paren
id|val
op_amp
l_int|0x00ff0000
)paren
op_rshift
l_int|16
comma
id|PCI_DEVFN
c_func
(paren
(paren
(paren
id|val
op_amp
l_int|0x1f000000
)paren
op_rshift
l_int|24
)paren
comma
l_int|0
)paren
comma
id|pci_cfg_offset
comma
id|child_bus
op_lshift
l_int|8
)paren
suffix:semicolon
id|mv64x60_pci_exclude_bridge
op_assign
id|save_exclude
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64x60_pci_exclude_device()&n; *&n; * This routine is used to make the bridge not appear when the&n; * PCI subsystem is accessing PCI devices (in PCI config space).&n; */
r_int
DECL|function|mv64x60_pci_exclude_device
id|mv64x60_pci_exclude_device
c_func
(paren
id|u8
id|bus
comma
id|u8
id|devfn
)paren
(brace
r_struct
id|pci_controller
op_star
id|hose
suffix:semicolon
id|hose
op_assign
id|pci_bus_to_hose
c_func
(paren
id|bus
)paren
suffix:semicolon
multiline_comment|/* Skip slot 0 on both hoses */
r_if
c_cond
(paren
(paren
id|mv64x60_pci_exclude_bridge
op_eq
l_int|1
)paren
op_logical_and
(paren
id|PCI_SLOT
c_func
(paren
id|devfn
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
id|hose-&gt;first_busno
op_eq
id|bus
)paren
)paren
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
r_else
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
multiline_comment|/* mv64x60_pci_exclude_device() */
multiline_comment|/*&n; *****************************************************************************&n; *&n; *&t;Platform Device Routines&n; *&n; *****************************************************************************&n; */
multiline_comment|/*&n; * mv64x60_pd_fixup()&n; *&n; * Need to add the base addr of where the bridge&squot;s regs are mapped in the&n; * physical addr space so drivers can ioremap() them.&n; */
r_void
id|__init
DECL|function|mv64x60_pd_fixup
id|mv64x60_pd_fixup
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|platform_device
op_star
id|pd_devs
(braket
)braket
comma
id|u32
id|entries
)paren
(brace
r_struct
id|resource
op_star
id|r
suffix:semicolon
id|u32
id|i
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|entries
suffix:semicolon
id|i
op_increment
)paren
(brace
id|j
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|r
op_assign
id|platform_get_resource
c_func
(paren
id|pd_devs
(braket
id|i
)braket
comma
id|IORESOURCE_MEM
comma
id|j
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|r-&gt;start
op_add_assign
id|bh-&gt;p_base
suffix:semicolon
id|r-&gt;end
op_add_assign
id|bh-&gt;p_base
suffix:semicolon
id|j
op_increment
suffix:semicolon
)brace
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64x60_add_pds()&n; *&n; * Add the mv64x60 platform devices to the list of platform devices.&n; */
r_static
r_int
id|__init
DECL|function|mv64x60_add_pds
id|mv64x60_add_pds
c_func
(paren
r_void
)paren
(brace
r_return
id|platform_add_devices
c_func
(paren
id|mv64x60_pd_devs
comma
id|ARRAY_SIZE
c_func
(paren
id|mv64x60_pd_devs
)paren
)paren
suffix:semicolon
)brace
DECL|variable|mv64x60_add_pds
id|arch_initcall
c_func
(paren
id|mv64x60_add_pds
)paren
suffix:semicolon
multiline_comment|/*&n; *****************************************************************************&n; *&n; *&t;GT64260-Specific Routines&n; *&n; *****************************************************************************&n; */
multiline_comment|/*&n; * gt64260_translate_size()&n; *&n; * On the GT64260, the size register is really the &quot;top&quot; address of the window.&n; */
r_static
id|u32
id|__init
DECL|function|gt64260_translate_size
id|gt64260_translate_size
c_func
(paren
id|u32
id|base
comma
id|u32
id|size
comma
id|u32
id|num_bits
)paren
(brace
r_return
id|base
op_plus
id|mv64x60_mask
c_func
(paren
id|size
op_minus
l_int|1
comma
id|num_bits
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * gt64260_untranslate_size()&n; *&n; * Translate the top address of a window into a window size.&n; */
r_static
id|u32
id|__init
DECL|function|gt64260_untranslate_size
id|gt64260_untranslate_size
c_func
(paren
id|u32
id|base
comma
id|u32
id|size
comma
id|u32
id|num_bits
)paren
(brace
r_if
c_cond
(paren
id|size
op_ge
id|base
)paren
id|size
op_assign
id|size
op_minus
id|base
op_plus
(paren
l_int|1
op_lshift
(paren
l_int|32
op_minus
id|num_bits
)paren
)paren
suffix:semicolon
r_else
id|size
op_assign
l_int|0
suffix:semicolon
r_return
id|size
suffix:semicolon
)brace
multiline_comment|/*&n; * gt64260_set_pci2mem_window()&n; *&n; * The PCI-&gt;MEM window registers are actually in PCI config space so need&n; * to set them by setting the correct config space BARs.&n; */
DECL|variable|__initdata
r_static
id|u32
id|gt64260_reg_addrs
(braket
l_int|2
)braket
(braket
l_int|4
)braket
id|__initdata
op_assign
(brace
(brace
l_int|0x10
comma
l_int|0x14
comma
l_int|0x18
comma
l_int|0x1c
)brace
comma
(brace
l_int|0x90
comma
l_int|0x94
comma
l_int|0x98
comma
l_int|0x9c
)brace
)brace
suffix:semicolon
r_static
r_void
id|__init
DECL|function|gt64260_set_pci2mem_window
id|gt64260_set_pci2mem_window
c_func
(paren
r_struct
id|pci_controller
op_star
id|hose
comma
id|u32
id|bus
comma
id|u32
id|window
comma
id|u32
id|base
)paren
(brace
id|u8
id|save_exclude
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;set pci-&gt;mem window: %d, hose: %d, base: 0x%x&bslash;n&quot;
comma
id|window
comma
id|hose-&gt;index
comma
id|base
)paren
suffix:semicolon
id|save_exclude
op_assign
id|mv64x60_pci_exclude_bridge
suffix:semicolon
id|mv64x60_pci_exclude_bridge
op_assign
l_int|0
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|hose
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|gt64260_reg_addrs
(braket
id|bus
)braket
(braket
id|window
)braket
comma
id|mv64x60_mask
c_func
(paren
id|base
comma
l_int|20
)paren
op_or
l_int|0x8
)paren
suffix:semicolon
id|mv64x60_pci_exclude_bridge
op_assign
id|save_exclude
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * gt64260_set_pci2regs_window()&n; *&n; * Set where the bridge&squot;s registers appear in PCI MEM space.&n; */
DECL|variable|__initdata
r_static
id|u32
id|gt64260_offset
(braket
l_int|2
)braket
id|__initdata
op_assign
(brace
l_int|0x20
comma
l_int|0xa0
)brace
suffix:semicolon
r_static
r_void
id|__init
DECL|function|gt64260_set_pci2regs_window
id|gt64260_set_pci2regs_window
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|pci_controller
op_star
id|hose
comma
id|u32
id|bus
comma
id|u32
id|base
)paren
(brace
id|u8
id|save_exclude
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;set pci-&gt;internal regs hose: %d, base: 0x%x&bslash;n&quot;
comma
id|hose-&gt;index
comma
id|base
)paren
suffix:semicolon
id|save_exclude
op_assign
id|mv64x60_pci_exclude_bridge
suffix:semicolon
id|mv64x60_pci_exclude_bridge
op_assign
l_int|0
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|hose
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|gt64260_offset
(braket
id|bus
)braket
comma
(paren
id|base
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|mv64x60_pci_exclude_bridge
op_assign
id|save_exclude
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * gt64260_is_enabled_32bit()&n; *&n; * On a GT64260, a window is enabled iff its top address is &gt;= to its base&n; * address.&n; */
r_static
id|u32
id|__init
DECL|function|gt64260_is_enabled_32bit
id|gt64260_is_enabled_32bit
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
)paren
(brace
id|u32
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|gt64260_32bit_windows
(braket
id|window
)braket
dot
id|base_reg
op_ne
l_int|0
)paren
op_logical_and
(paren
id|gt64260_32bit_windows
(braket
id|window
)braket
dot
id|size_reg
op_ne
l_int|0
)paren
op_logical_and
(paren
(paren
id|mv64x60_read
c_func
(paren
id|bh
comma
id|gt64260_32bit_windows
(braket
id|window
)braket
dot
id|size_reg
)paren
op_amp
(paren
(paren
l_int|1
op_lshift
id|gt64260_32bit_windows
(braket
id|window
)braket
dot
id|size_bits
)paren
op_minus
l_int|1
)paren
)paren
op_ge
(paren
id|mv64x60_read
c_func
(paren
id|bh
comma
id|gt64260_32bit_windows
(braket
id|window
)braket
dot
id|base_reg
)paren
op_amp
(paren
(paren
l_int|1
op_lshift
id|gt64260_32bit_windows
(braket
id|window
)braket
dot
id|base_bits
)paren
op_minus
l_int|1
)paren
)paren
)paren
)paren
id|rc
op_assign
l_int|1
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * gt64260_enable_window_32bit()&n; *&n; * On the GT64260, a window is enabled iff the top address is &gt;= to the base&n; * address of the window.  Since the window has already been configured by&n; * the time this routine is called, we have nothing to do here.&n; */
r_static
r_void
id|__init
DECL|function|gt64260_enable_window_32bit
id|gt64260_enable_window_32bit
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;enable 32bit window: %d&bslash;n&quot;
comma
id|window
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * gt64260_disable_window_32bit()&n; *&n; * On a GT64260, you disable a window by setting its top address to be less&n; * than its base address.&n; */
r_static
r_void
id|__init
DECL|function|gt64260_disable_window_32bit
id|gt64260_disable_window_32bit
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;disable 32bit window: %d, base_reg: 0x%x, size_reg: 0x%x&bslash;n&quot;
comma
id|window
comma
id|gt64260_32bit_windows
(braket
id|window
)braket
dot
id|base_reg
comma
id|gt64260_32bit_windows
(braket
id|window
)braket
dot
id|size_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|gt64260_32bit_windows
(braket
id|window
)braket
dot
id|base_reg
op_ne
l_int|0
)paren
op_logical_and
(paren
id|gt64260_32bit_windows
(braket
id|window
)braket
dot
id|size_reg
op_ne
l_int|0
)paren
)paren
(brace
multiline_comment|/* To disable, make bottom reg higher than top reg */
id|mv64x60_write
c_func
(paren
id|bh
comma
id|gt64260_32bit_windows
(braket
id|window
)braket
dot
id|base_reg
comma
l_int|0xfff
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|gt64260_32bit_windows
(braket
id|window
)braket
dot
id|size_reg
comma
l_int|0
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * gt64260_enable_window_64bit()&n; *&n; * On the GT64260, a window is enabled iff the top address is &gt;= to the base&n; * address of the window.  Since the window has already been configured by&n; * the time this routine is called, we have nothing to do here.&n; */
r_static
r_void
id|__init
DECL|function|gt64260_enable_window_64bit
id|gt64260_enable_window_64bit
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;enable 64bit window: %d&bslash;n&quot;
comma
id|window
)paren
suffix:semicolon
r_return
suffix:semicolon
multiline_comment|/* Enabled when window configured (i.e., when top &gt;= base) */
)brace
multiline_comment|/*&n; * gt64260_disable_window_64bit()&n; *&n; * On a GT64260, you disable a window by setting its top address to be less&n; * than its base address.&n; */
r_static
r_void
id|__init
DECL|function|gt64260_disable_window_64bit
id|gt64260_disable_window_64bit
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;disable 64bit window: %d, base_reg: 0x%x, size_reg: 0x%x&bslash;n&quot;
comma
id|window
comma
id|gt64260_64bit_windows
(braket
id|window
)braket
dot
id|base_lo_reg
comma
id|gt64260_64bit_windows
(braket
id|window
)braket
dot
id|size_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|gt64260_64bit_windows
(braket
id|window
)braket
dot
id|base_lo_reg
op_ne
l_int|0
)paren
op_logical_and
(paren
id|gt64260_64bit_windows
(braket
id|window
)braket
dot
id|size_reg
op_ne
l_int|0
)paren
)paren
(brace
multiline_comment|/* To disable, make bottom reg higher than top reg */
id|mv64x60_write
c_func
(paren
id|bh
comma
id|gt64260_64bit_windows
(braket
id|window
)braket
dot
id|base_lo_reg
comma
l_int|0xfff
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|gt64260_64bit_windows
(braket
id|window
)braket
dot
id|base_hi_reg
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|gt64260_64bit_windows
(braket
id|window
)braket
dot
id|size_reg
comma
l_int|0
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * gt64260_disable_all_windows()&n; *&n; * The GT64260 has several windows that aren&squot;t represented in the table of&n; * windows at the top of this file.  This routine turns all of them off&n; * except for the memory controller windows, of course.&n; */
r_static
r_void
id|__init
DECL|function|gt64260_disable_all_windows
id|gt64260_disable_all_windows
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|mv64x60_setup_info
op_star
id|si
)paren
(brace
id|u32
id|i
comma
id|preserve
suffix:semicolon
multiline_comment|/* Disable 32bit windows (don&squot;t disable cpu-&gt;mem windows) */
r_for
c_loop
(paren
id|i
op_assign
id|MV64x60_CPU2DEV_0_WIN
suffix:semicolon
id|i
OL
id|MV64x60_32BIT_WIN_COUNT
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
OL
l_int|32
)paren
id|preserve
op_assign
id|si-&gt;window_preserve_mask_32_lo
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
suffix:semicolon
r_else
id|preserve
op_assign
id|si-&gt;window_preserve_mask_32_hi
op_amp
(paren
l_int|1
op_lshift
(paren
id|i
op_minus
l_int|32
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|preserve
)paren
id|gt64260_disable_window_32bit
c_func
(paren
id|bh
comma
id|i
)paren
suffix:semicolon
)brace
multiline_comment|/* Disable 64bit windows */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MV64x60_64BIT_WIN_COUNT
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|si-&gt;window_preserve_mask_64
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
)paren
id|gt64260_disable_window_64bit
c_func
(paren
id|bh
comma
id|i
)paren
suffix:semicolon
multiline_comment|/* Turn off cpu protection windows not in gt64260_32bit_windows[] */
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_CPU_PROT_BASE_4
comma
l_int|0xfff
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_CPU_PROT_SIZE_4
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_CPU_PROT_BASE_5
comma
l_int|0xfff
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_CPU_PROT_SIZE_5
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_CPU_PROT_BASE_6
comma
l_int|0xfff
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_CPU_PROT_SIZE_6
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_CPU_PROT_BASE_7
comma
l_int|0xfff
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_CPU_PROT_SIZE_7
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Turn off PCI-&gt;MEM access cntl wins not in gt64260_64bit_windows[] */
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64x60_PCI0_ACC_CNTL_4_BASE_LO
comma
l_int|0xfff
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64x60_PCI0_ACC_CNTL_4_BASE_HI
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64x60_PCI0_ACC_CNTL_4_SIZE
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64x60_PCI0_ACC_CNTL_5_BASE_LO
comma
l_int|0xfff
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64x60_PCI0_ACC_CNTL_5_BASE_HI
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64x60_PCI0_ACC_CNTL_5_SIZE
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_PCI0_ACC_CNTL_6_BASE_LO
comma
l_int|0xfff
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_PCI0_ACC_CNTL_6_BASE_HI
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_PCI0_ACC_CNTL_6_SIZE
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_PCI0_ACC_CNTL_7_BASE_LO
comma
l_int|0xfff
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_PCI0_ACC_CNTL_7_BASE_HI
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_PCI0_ACC_CNTL_7_SIZE
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64x60_PCI1_ACC_CNTL_4_BASE_LO
comma
l_int|0xfff
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64x60_PCI1_ACC_CNTL_4_BASE_HI
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64x60_PCI1_ACC_CNTL_4_SIZE
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64x60_PCI1_ACC_CNTL_5_BASE_LO
comma
l_int|0xfff
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64x60_PCI1_ACC_CNTL_5_BASE_HI
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64x60_PCI1_ACC_CNTL_5_SIZE
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_PCI1_ACC_CNTL_6_BASE_LO
comma
l_int|0xfff
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_PCI1_ACC_CNTL_6_BASE_HI
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_PCI1_ACC_CNTL_6_SIZE
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_PCI1_ACC_CNTL_7_BASE_LO
comma
l_int|0xfff
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_PCI1_ACC_CNTL_7_BASE_HI
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_PCI1_ACC_CNTL_7_SIZE
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Disable all PCI-&gt;&lt;whatever&gt; windows */
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64x60_PCI0_BAR_ENABLE
comma
l_int|0x07fffdff
)paren
suffix:semicolon
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64x60_PCI1_BAR_ENABLE
comma
l_int|0x07fffdff
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Some firmwares enable a bunch of intr sources&n;&t; * for the PCI INT output pins.&n;&t; */
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_IC_CPU_INTR_MASK_LO
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_IC_CPU_INTR_MASK_HI
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_IC_PCI0_INTR_MASK_LO
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_IC_PCI0_INTR_MASK_HI
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_IC_PCI1_INTR_MASK_LO
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_IC_PCI1_INTR_MASK_HI
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_IC_CPU_INT_0_MASK
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_IC_CPU_INT_1_MASK
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_IC_CPU_INT_2_MASK
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|GT64260_IC_CPU_INT_3_MASK
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * gt64260a_chip_specific_init()&n; *&n; * Implement errata work arounds for the GT64260A.&n; */
r_static
r_void
id|__init
DECL|function|gt64260a_chip_specific_init
id|gt64260a_chip_specific_init
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|mv64x60_setup_info
op_star
id|si
)paren
(brace
macro_line|#ifdef CONFIG_SERIAL_MPSC
r_struct
id|resource
op_star
id|r
suffix:semicolon
macro_line|#endif
macro_line|#if !defined(CONFIG_NOT_COHERENT_CACHE)
id|u32
id|val
suffix:semicolon
id|u8
id|save_exclude
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|si-&gt;pci_0.enable_bus
)paren
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64x60_PCI0_CMD
comma
(paren
(paren
l_int|1
op_lshift
l_int|4
)paren
op_or
(paren
l_int|1
op_lshift
l_int|5
)paren
op_or
(paren
l_int|1
op_lshift
l_int|9
)paren
op_or
(paren
l_int|1
op_lshift
l_int|13
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|si-&gt;pci_1.enable_bus
)paren
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64x60_PCI1_CMD
comma
(paren
(paren
l_int|1
op_lshift
l_int|4
)paren
op_or
(paren
l_int|1
op_lshift
l_int|5
)paren
op_or
(paren
l_int|1
op_lshift
l_int|9
)paren
op_or
(paren
l_int|1
op_lshift
l_int|13
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Dave Wilhardt found that bit 4 in the PCI Command registers must&n;&t; * be set if you are using cache coherency.&n;&t; */
macro_line|#if !defined(CONFIG_NOT_COHERENT_CACHE)
multiline_comment|/* Res #MEM-4 -- cpu read buffer to buffer 1 */
r_if
c_cond
(paren
(paren
id|mv64x60_read
c_func
(paren
id|bh
comma
id|MV64x60_CPU_MODE
)paren
op_amp
l_int|0xf0
)paren
op_eq
l_int|0x40
)paren
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|GT64260_SDRAM_CONFIG
comma
(paren
l_int|1
op_lshift
l_int|26
)paren
)paren
suffix:semicolon
id|save_exclude
op_assign
id|mv64x60_pci_exclude_bridge
suffix:semicolon
id|mv64x60_pci_exclude_bridge
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|si-&gt;pci_0.enable_bus
)paren
(brace
id|early_read_config_dword
c_func
(paren
id|bh-&gt;hose_a
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_COMMAND
comma
op_amp
id|val
)paren
suffix:semicolon
id|val
op_or_assign
id|PCI_COMMAND_INVALIDATE
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|bh-&gt;hose_a
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_COMMAND
comma
id|val
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|si-&gt;pci_1.enable_bus
)paren
(brace
id|early_read_config_dword
c_func
(paren
id|bh-&gt;hose_b
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_COMMAND
comma
op_amp
id|val
)paren
suffix:semicolon
id|val
op_or_assign
id|PCI_COMMAND_INVALIDATE
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|bh-&gt;hose_b
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_COMMAND
comma
id|val
)paren
suffix:semicolon
)brace
id|mv64x60_pci_exclude_bridge
op_assign
id|save_exclude
suffix:semicolon
macro_line|#endif
multiline_comment|/* Disable buffer/descriptor snooping */
id|mv64x60_clr_bits
c_func
(paren
id|bh
comma
l_int|0xf280
comma
(paren
l_int|1
op_lshift
l_int|6
)paren
op_or
(paren
l_int|1
op_lshift
l_int|14
)paren
op_or
(paren
l_int|1
op_lshift
l_int|22
)paren
op_or
(paren
l_int|1
op_lshift
l_int|30
)paren
)paren
suffix:semicolon
id|mv64x60_clr_bits
c_func
(paren
id|bh
comma
l_int|0xf2c0
comma
(paren
l_int|1
op_lshift
l_int|6
)paren
op_or
(paren
l_int|1
op_lshift
l_int|14
)paren
op_or
(paren
l_int|1
op_lshift
l_int|22
)paren
op_or
(paren
l_int|1
op_lshift
l_int|30
)paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SERIAL_MPSC
id|mv64x60_mpsc0_pdata.mirror_regs
op_assign
l_int|1
suffix:semicolon
id|mv64x60_mpsc0_pdata.cache_mgmt
op_assign
l_int|1
suffix:semicolon
id|mv64x60_mpsc1_pdata.mirror_regs
op_assign
l_int|1
suffix:semicolon
id|mv64x60_mpsc1_pdata.cache_mgmt
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|platform_get_resource
c_func
(paren
op_amp
id|mpsc1_device
comma
id|IORESOURCE_IRQ
comma
l_int|0
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|r-&gt;start
op_assign
id|MV64x60_IRQ_SDMA_0
suffix:semicolon
id|r-&gt;end
op_assign
id|MV64x60_IRQ_SDMA_0
suffix:semicolon
)brace
macro_line|#endif
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * gt64260b_chip_specific_init()&n; *&n; * Implement errata work arounds for the GT64260B.&n; */
r_static
r_void
id|__init
DECL|function|gt64260b_chip_specific_init
id|gt64260b_chip_specific_init
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|mv64x60_setup_info
op_star
id|si
)paren
(brace
macro_line|#ifdef CONFIG_SERIAL_MPSC
r_struct
id|resource
op_star
id|r
suffix:semicolon
macro_line|#endif
macro_line|#if !defined(CONFIG_NOT_COHERENT_CACHE)
id|u32
id|val
suffix:semicolon
id|u8
id|save_exclude
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|si-&gt;pci_0.enable_bus
)paren
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64x60_PCI0_CMD
comma
(paren
(paren
l_int|1
op_lshift
l_int|4
)paren
op_or
(paren
l_int|1
op_lshift
l_int|5
)paren
op_or
(paren
l_int|1
op_lshift
l_int|9
)paren
op_or
(paren
l_int|1
op_lshift
l_int|13
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|si-&gt;pci_1.enable_bus
)paren
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64x60_PCI1_CMD
comma
(paren
(paren
l_int|1
op_lshift
l_int|4
)paren
op_or
(paren
l_int|1
op_lshift
l_int|5
)paren
op_or
(paren
l_int|1
op_lshift
l_int|9
)paren
op_or
(paren
l_int|1
op_lshift
l_int|13
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Dave Wilhardt found that bit 4 in the PCI Command registers must&n;&t; * be set if you are using cache coherency.&n;&t; */
macro_line|#if !defined(CONFIG_NOT_COHERENT_CACHE)
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|GT64260_CPU_WB_PRIORITY_BUFFER_DEPTH
comma
l_int|0xf
)paren
suffix:semicolon
multiline_comment|/* Res #MEM-4 -- cpu read buffer to buffer 1 */
r_if
c_cond
(paren
(paren
id|mv64x60_read
c_func
(paren
id|bh
comma
id|MV64x60_CPU_MODE
)paren
op_amp
l_int|0xf0
)paren
op_eq
l_int|0x40
)paren
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|GT64260_SDRAM_CONFIG
comma
(paren
l_int|1
op_lshift
l_int|26
)paren
)paren
suffix:semicolon
id|save_exclude
op_assign
id|mv64x60_pci_exclude_bridge
suffix:semicolon
id|mv64x60_pci_exclude_bridge
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|si-&gt;pci_0.enable_bus
)paren
(brace
id|early_read_config_dword
c_func
(paren
id|bh-&gt;hose_a
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_COMMAND
comma
op_amp
id|val
)paren
suffix:semicolon
id|val
op_or_assign
id|PCI_COMMAND_INVALIDATE
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|bh-&gt;hose_a
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_COMMAND
comma
id|val
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|si-&gt;pci_1.enable_bus
)paren
(brace
id|early_read_config_dword
c_func
(paren
id|bh-&gt;hose_b
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_COMMAND
comma
op_amp
id|val
)paren
suffix:semicolon
id|val
op_or_assign
id|PCI_COMMAND_INVALIDATE
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|bh-&gt;hose_b
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_COMMAND
comma
id|val
)paren
suffix:semicolon
)brace
id|mv64x60_pci_exclude_bridge
op_assign
id|save_exclude
suffix:semicolon
macro_line|#endif
multiline_comment|/* Disable buffer/descriptor snooping */
id|mv64x60_clr_bits
c_func
(paren
id|bh
comma
l_int|0xf280
comma
(paren
l_int|1
op_lshift
l_int|6
)paren
op_or
(paren
l_int|1
op_lshift
l_int|14
)paren
op_or
(paren
l_int|1
op_lshift
l_int|22
)paren
op_or
(paren
l_int|1
op_lshift
l_int|30
)paren
)paren
suffix:semicolon
id|mv64x60_clr_bits
c_func
(paren
id|bh
comma
l_int|0xf2c0
comma
(paren
l_int|1
op_lshift
l_int|6
)paren
op_or
(paren
l_int|1
op_lshift
l_int|14
)paren
op_or
(paren
l_int|1
op_lshift
l_int|22
)paren
op_or
(paren
l_int|1
op_lshift
l_int|30
)paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SERIAL_MPSC
multiline_comment|/*&n;&t; * The 64260B is not supposed to have the bug where the MPSC &amp; ENET&n;&t; * can&squot;t access cache coherent regions.  However, testing has shown&n;&t; * that the MPSC, at least, still has this bug.&n;&t; */
id|mv64x60_mpsc0_pdata.cache_mgmt
op_assign
l_int|1
suffix:semicolon
id|mv64x60_mpsc1_pdata.cache_mgmt
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r
op_assign
id|platform_get_resource
c_func
(paren
op_amp
id|mpsc1_device
comma
id|IORESOURCE_IRQ
comma
l_int|0
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
id|r-&gt;start
op_assign
id|MV64x60_IRQ_SDMA_0
suffix:semicolon
id|r-&gt;end
op_assign
id|MV64x60_IRQ_SDMA_0
suffix:semicolon
)brace
macro_line|#endif
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; *****************************************************************************&n; *&n; *&t;MV64360-Specific Routines&n; *&n; *****************************************************************************&n; */
multiline_comment|/*&n; * mv64360_translate_size()&n; *&n; * On the MV64360, the size register is set similar to the size you get&n; * from a pci config space BAR register.  That is, programmed from LSB to MSB&n; * as a sequence of 1&squot;s followed by a sequence of 0&squot;s. IOW, &quot;size -1&quot; with the&n; * assumption that the size is a power of 2.&n; */
r_static
id|u32
id|__init
DECL|function|mv64360_translate_size
id|mv64360_translate_size
c_func
(paren
id|u32
id|base_addr
comma
id|u32
id|size
comma
id|u32
id|num_bits
)paren
(brace
r_return
id|mv64x60_mask
c_func
(paren
id|size
op_minus
l_int|1
comma
id|num_bits
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64360_untranslate_size()&n; *&n; * Translate the size register value of a window into a window size.&n; */
r_static
id|u32
id|__init
DECL|function|mv64360_untranslate_size
id|mv64360_untranslate_size
c_func
(paren
id|u32
id|base_addr
comma
id|u32
id|size
comma
id|u32
id|num_bits
)paren
(brace
r_if
c_cond
(paren
id|size
OG
l_int|0
)paren
(brace
id|size
op_rshift_assign
(paren
l_int|32
op_minus
id|num_bits
)paren
suffix:semicolon
id|size
op_increment
suffix:semicolon
id|size
op_lshift_assign
(paren
l_int|32
op_minus
id|num_bits
)paren
suffix:semicolon
)brace
r_return
id|size
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64360_set_pci2mem_window()&n; *&n; * The PCI-&gt;MEM window registers are actually in PCI config space so need&n; * to set them by setting the correct config space BARs.&n; */
r_struct
(brace
DECL|member|fcn
id|u32
id|fcn
suffix:semicolon
DECL|member|base_hi_bar
id|u32
id|base_hi_bar
suffix:semicolon
DECL|member|base_lo_bar
id|u32
id|base_lo_bar
suffix:semicolon
DECL|variable|__initdata
)brace
r_static
id|mv64360_reg_addrs
(braket
l_int|2
)braket
(braket
l_int|4
)braket
id|__initdata
op_assign
(brace
(brace
(brace
l_int|0
comma
l_int|0x14
comma
l_int|0x10
)brace
comma
(brace
l_int|0
comma
l_int|0x1c
comma
l_int|0x18
)brace
comma
(brace
l_int|1
comma
l_int|0x14
comma
l_int|0x10
)brace
comma
(brace
l_int|1
comma
l_int|0x1c
comma
l_int|0x18
)brace
)brace
comma
(brace
(brace
l_int|0
comma
l_int|0x94
comma
l_int|0x90
)brace
comma
(brace
l_int|0
comma
l_int|0x9c
comma
l_int|0x98
)brace
comma
(brace
l_int|1
comma
l_int|0x94
comma
l_int|0x90
)brace
comma
(brace
l_int|1
comma
l_int|0x9c
comma
l_int|0x98
)brace
)brace
)brace
suffix:semicolon
r_static
r_void
id|__init
DECL|function|mv64360_set_pci2mem_window
id|mv64360_set_pci2mem_window
c_func
(paren
r_struct
id|pci_controller
op_star
id|hose
comma
id|u32
id|bus
comma
id|u32
id|window
comma
id|u32
id|base
)paren
(brace
id|u8
id|save_exclude
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;set pci-&gt;mem window: %d, hose: %d, base: 0x%x&bslash;n&quot;
comma
id|window
comma
id|hose-&gt;index
comma
id|base
)paren
suffix:semicolon
id|save_exclude
op_assign
id|mv64x60_pci_exclude_bridge
suffix:semicolon
id|mv64x60_pci_exclude_bridge
op_assign
l_int|0
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|hose
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
id|mv64360_reg_addrs
(braket
id|bus
)braket
(braket
id|window
)braket
dot
id|fcn
)paren
comma
id|mv64360_reg_addrs
(braket
id|bus
)braket
(braket
id|window
)braket
dot
id|base_hi_bar
comma
l_int|0
)paren
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|hose
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
id|mv64360_reg_addrs
(braket
id|bus
)braket
(braket
id|window
)braket
dot
id|fcn
)paren
comma
id|mv64360_reg_addrs
(braket
id|bus
)braket
(braket
id|window
)braket
dot
id|base_lo_bar
comma
id|mv64x60_mask
c_func
(paren
id|base
comma
l_int|20
)paren
op_or
l_int|0xc
)paren
suffix:semicolon
id|mv64x60_pci_exclude_bridge
op_assign
id|save_exclude
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64360_set_pci2regs_window()&n; *&n; * Set where the bridge&squot;s registers appear in PCI MEM space.&n; */
DECL|variable|__initdata
r_static
id|u32
id|mv64360_offset
(braket
l_int|2
)braket
(braket
l_int|2
)braket
id|__initdata
op_assign
(brace
(brace
l_int|0x20
comma
l_int|0x24
)brace
comma
(brace
l_int|0xa0
comma
l_int|0xa4
)brace
)brace
suffix:semicolon
r_static
r_void
id|__init
DECL|function|mv64360_set_pci2regs_window
id|mv64360_set_pci2regs_window
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|pci_controller
op_star
id|hose
comma
id|u32
id|bus
comma
id|u32
id|base
)paren
(brace
id|u8
id|save_exclude
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;set pci-&gt;internal regs hose: %d, base: 0x%x&bslash;n&quot;
comma
id|hose-&gt;index
comma
id|base
)paren
suffix:semicolon
id|save_exclude
op_assign
id|mv64x60_pci_exclude_bridge
suffix:semicolon
id|mv64x60_pci_exclude_bridge
op_assign
l_int|0
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|hose
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|mv64360_offset
(braket
id|bus
)braket
(braket
l_int|0
)braket
comma
(paren
id|base
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|hose
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|mv64360_offset
(braket
id|bus
)braket
(braket
l_int|1
)braket
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_pci_exclude_bridge
op_assign
id|save_exclude
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64360_is_enabled_32bit()&n; *&n; * On a MV64360, a window is enabled by either clearing a bit in the&n; * CPU BAR Enable reg or setting a bit in the window&squot;s base reg.&n; * Note that this doesn&squot;t work for windows on the PCI slave side but we don&squot;t&n; * check those so its okay.&n; */
r_static
id|u32
id|__init
DECL|function|mv64360_is_enabled_32bit
id|mv64360_is_enabled_32bit
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
)paren
(brace
id|u32
id|extra
comma
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|mv64360_32bit_windows
(braket
id|window
)braket
dot
id|base_reg
op_ne
l_int|0
)paren
op_logical_and
(paren
id|mv64360_32bit_windows
(braket
id|window
)braket
dot
id|size_reg
op_ne
l_int|0
)paren
)paren
op_logical_or
(paren
id|window
op_eq
id|MV64x60_CPU2SRAM_WIN
)paren
)paren
(brace
id|extra
op_assign
id|mv64360_32bit_windows
(braket
id|window
)braket
dot
id|extra
suffix:semicolon
r_switch
c_cond
(paren
id|extra
op_amp
id|MV64x60_EXTRA_MASK
)paren
(brace
r_case
id|MV64x60_EXTRA_CPUWIN_ENAB
suffix:colon
id|rc
op_assign
(paren
id|mv64x60_read
c_func
(paren
id|bh
comma
id|MV64360_CPU_BAR_ENABLE
)paren
op_amp
(paren
l_int|1
op_lshift
(paren
id|extra
op_amp
l_int|0x1f
)paren
)paren
)paren
op_eq
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MV64x60_EXTRA_CPUPROT_ENAB
suffix:colon
id|rc
op_assign
(paren
id|mv64x60_read
c_func
(paren
id|bh
comma
id|mv64360_32bit_windows
(braket
id|window
)braket
dot
id|base_reg
)paren
op_amp
(paren
l_int|1
op_lshift
(paren
id|extra
op_amp
l_int|0x1f
)paren
)paren
)paren
op_ne
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MV64x60_EXTRA_ENET_ENAB
suffix:colon
id|rc
op_assign
(paren
id|mv64x60_read
c_func
(paren
id|bh
comma
id|MV64360_ENET2MEM_BAR_ENABLE
)paren
op_amp
(paren
l_int|1
op_lshift
(paren
id|extra
op_amp
l_int|0x7
)paren
)paren
)paren
op_eq
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MV64x60_EXTRA_MPSC_ENAB
suffix:colon
id|rc
op_assign
(paren
id|mv64x60_read
c_func
(paren
id|bh
comma
id|MV64360_MPSC2MEM_BAR_ENABLE
)paren
op_amp
(paren
l_int|1
op_lshift
(paren
id|extra
op_amp
l_int|0x3
)paren
)paren
)paren
op_eq
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MV64x60_EXTRA_IDMA_ENAB
suffix:colon
id|rc
op_assign
(paren
id|mv64x60_read
c_func
(paren
id|bh
comma
id|MV64360_IDMA2MEM_BAR_ENABLE
)paren
op_amp
(paren
l_int|1
op_lshift
(paren
id|extra
op_amp
l_int|0x7
)paren
)paren
)paren
op_eq
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;mv64360_is_enabled: %s&bslash;n&quot;
comma
l_string|&quot;32bit table corrupted&quot;
)paren
suffix:semicolon
)brace
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64360_enable_window_32bit()&n; *&n; * On a MV64360, a window is enabled by either clearing a bit in the&n; * CPU BAR Enable reg or setting a bit in the window&squot;s base reg.&n; */
r_static
r_void
id|__init
DECL|function|mv64360_enable_window_32bit
id|mv64360_enable_window_32bit
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
)paren
(brace
id|u32
id|extra
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;enable 32bit window: %d&bslash;n&quot;
comma
id|window
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|mv64360_32bit_windows
(braket
id|window
)braket
dot
id|base_reg
op_ne
l_int|0
)paren
op_logical_and
(paren
id|mv64360_32bit_windows
(braket
id|window
)braket
dot
id|size_reg
op_ne
l_int|0
)paren
)paren
op_logical_or
(paren
id|window
op_eq
id|MV64x60_CPU2SRAM_WIN
)paren
)paren
(brace
id|extra
op_assign
id|mv64360_32bit_windows
(braket
id|window
)braket
dot
id|extra
suffix:semicolon
r_switch
c_cond
(paren
id|extra
op_amp
id|MV64x60_EXTRA_MASK
)paren
(brace
r_case
id|MV64x60_EXTRA_CPUWIN_ENAB
suffix:colon
id|mv64x60_clr_bits
c_func
(paren
id|bh
comma
id|MV64360_CPU_BAR_ENABLE
comma
(paren
l_int|1
op_lshift
(paren
id|extra
op_amp
l_int|0x1f
)paren
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MV64x60_EXTRA_CPUPROT_ENAB
suffix:colon
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|mv64360_32bit_windows
(braket
id|window
)braket
dot
id|base_reg
comma
(paren
l_int|1
op_lshift
(paren
id|extra
op_amp
l_int|0x1f
)paren
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MV64x60_EXTRA_ENET_ENAB
suffix:colon
id|mv64x60_clr_bits
c_func
(paren
id|bh
comma
id|MV64360_ENET2MEM_BAR_ENABLE
comma
(paren
l_int|1
op_lshift
(paren
id|extra
op_amp
l_int|0x7
)paren
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MV64x60_EXTRA_MPSC_ENAB
suffix:colon
id|mv64x60_clr_bits
c_func
(paren
id|bh
comma
id|MV64360_MPSC2MEM_BAR_ENABLE
comma
(paren
l_int|1
op_lshift
(paren
id|extra
op_amp
l_int|0x3
)paren
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MV64x60_EXTRA_IDMA_ENAB
suffix:colon
id|mv64x60_clr_bits
c_func
(paren
id|bh
comma
id|MV64360_IDMA2MEM_BAR_ENABLE
comma
(paren
l_int|1
op_lshift
(paren
id|extra
op_amp
l_int|0x7
)paren
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;mv64360_enable: %s&bslash;n&quot;
comma
l_string|&quot;32bit table corrupted&quot;
)paren
suffix:semicolon
)brace
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64360_disable_window_32bit()&n; *&n; * On a MV64360, a window is disabled by either setting a bit in the&n; * CPU BAR Enable reg or clearing a bit in the window&squot;s base reg.&n; */
r_static
r_void
id|__init
DECL|function|mv64360_disable_window_32bit
id|mv64360_disable_window_32bit
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
)paren
(brace
id|u32
id|extra
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;disable 32bit window: %d, base_reg: 0x%x, size_reg: 0x%x&bslash;n&quot;
comma
id|window
comma
id|mv64360_32bit_windows
(braket
id|window
)braket
dot
id|base_reg
comma
id|mv64360_32bit_windows
(braket
id|window
)braket
dot
id|size_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|mv64360_32bit_windows
(braket
id|window
)braket
dot
id|base_reg
op_ne
l_int|0
)paren
op_logical_and
(paren
id|mv64360_32bit_windows
(braket
id|window
)braket
dot
id|size_reg
op_ne
l_int|0
)paren
)paren
op_logical_or
(paren
id|window
op_eq
id|MV64x60_CPU2SRAM_WIN
)paren
)paren
(brace
id|extra
op_assign
id|mv64360_32bit_windows
(braket
id|window
)braket
dot
id|extra
suffix:semicolon
r_switch
c_cond
(paren
id|extra
op_amp
id|MV64x60_EXTRA_MASK
)paren
(brace
r_case
id|MV64x60_EXTRA_CPUWIN_ENAB
suffix:colon
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64360_CPU_BAR_ENABLE
comma
(paren
l_int|1
op_lshift
(paren
id|extra
op_amp
l_int|0x1f
)paren
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MV64x60_EXTRA_CPUPROT_ENAB
suffix:colon
id|mv64x60_clr_bits
c_func
(paren
id|bh
comma
id|mv64360_32bit_windows
(braket
id|window
)braket
dot
id|base_reg
comma
(paren
l_int|1
op_lshift
(paren
id|extra
op_amp
l_int|0x1f
)paren
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MV64x60_EXTRA_ENET_ENAB
suffix:colon
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64360_ENET2MEM_BAR_ENABLE
comma
(paren
l_int|1
op_lshift
(paren
id|extra
op_amp
l_int|0x7
)paren
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MV64x60_EXTRA_MPSC_ENAB
suffix:colon
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64360_MPSC2MEM_BAR_ENABLE
comma
(paren
l_int|1
op_lshift
(paren
id|extra
op_amp
l_int|0x3
)paren
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MV64x60_EXTRA_IDMA_ENAB
suffix:colon
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64360_IDMA2MEM_BAR_ENABLE
comma
(paren
l_int|1
op_lshift
(paren
id|extra
op_amp
l_int|0x7
)paren
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;mv64360_disable: %s&bslash;n&quot;
comma
l_string|&quot;32bit table corrupted&quot;
)paren
suffix:semicolon
)brace
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64360_enable_window_64bit()&n; *&n; * On the MV64360, a 64-bit window is enabled by setting a bit in the window&squot;s&n; * base reg.&n; */
r_static
r_void
id|__init
DECL|function|mv64360_enable_window_64bit
id|mv64360_enable_window_64bit
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;enable 64bit window: %d&bslash;n&quot;
comma
id|window
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mv64360_64bit_windows
(braket
id|window
)braket
dot
id|base_lo_reg
op_ne
l_int|0
)paren
op_logical_and
(paren
id|mv64360_64bit_windows
(braket
id|window
)braket
dot
id|size_reg
op_ne
l_int|0
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|mv64360_64bit_windows
(braket
id|window
)braket
dot
id|extra
op_amp
id|MV64x60_EXTRA_MASK
)paren
op_eq
id|MV64x60_EXTRA_PCIACC_ENAB
)paren
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|mv64360_64bit_windows
(braket
id|window
)braket
dot
id|base_lo_reg
comma
(paren
l_int|1
op_lshift
(paren
id|mv64360_64bit_windows
(braket
id|window
)braket
dot
id|extra
op_amp
l_int|0x1f
)paren
)paren
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;mv64360_enable: %s&bslash;n&quot;
comma
l_string|&quot;64bit table corrupted&quot;
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64360_disable_window_64bit()&n; *&n; * On a MV64360, a 64-bit window is disabled by clearing a bit in the window&squot;s&n; * base reg.&n; */
r_static
r_void
id|__init
DECL|function|mv64360_disable_window_64bit
id|mv64360_disable_window_64bit
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|window
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;disable 64bit window: %d, base_reg: 0x%x, size_reg: 0x%x&bslash;n&quot;
comma
id|window
comma
id|mv64360_64bit_windows
(braket
id|window
)braket
dot
id|base_lo_reg
comma
id|mv64360_64bit_windows
(braket
id|window
)braket
dot
id|size_reg
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mv64360_64bit_windows
(braket
id|window
)braket
dot
id|base_lo_reg
op_ne
l_int|0
)paren
op_logical_and
(paren
id|mv64360_64bit_windows
(braket
id|window
)braket
dot
id|size_reg
op_ne
l_int|0
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|mv64360_64bit_windows
(braket
id|window
)braket
dot
id|extra
op_amp
id|MV64x60_EXTRA_MASK
)paren
op_eq
id|MV64x60_EXTRA_PCIACC_ENAB
)paren
id|mv64x60_clr_bits
c_func
(paren
id|bh
comma
id|mv64360_64bit_windows
(braket
id|window
)braket
dot
id|base_lo_reg
comma
(paren
l_int|1
op_lshift
(paren
id|mv64360_64bit_windows
(braket
id|window
)braket
dot
id|extra
op_amp
l_int|0x1f
)paren
)paren
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;mv64360_disable: %s&bslash;n&quot;
comma
l_string|&quot;64bit table corrupted&quot;
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64360_disable_all_windows()&n; *&n; * The MV64360 has a few windows that aren&squot;t represented in the table of&n; * windows at the top of this file.  This routine turns all of them off&n; * except for the memory controller windows, of course.&n; */
r_static
r_void
id|__init
DECL|function|mv64360_disable_all_windows
id|mv64360_disable_all_windows
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|mv64x60_setup_info
op_star
id|si
)paren
(brace
id|u32
id|preserve
comma
id|i
suffix:semicolon
multiline_comment|/* Disable 32bit windows (don&squot;t disable cpu-&gt;mem windows) */
r_for
c_loop
(paren
id|i
op_assign
id|MV64x60_CPU2DEV_0_WIN
suffix:semicolon
id|i
OL
id|MV64x60_32BIT_WIN_COUNT
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
OL
l_int|32
)paren
id|preserve
op_assign
id|si-&gt;window_preserve_mask_32_lo
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
suffix:semicolon
r_else
id|preserve
op_assign
id|si-&gt;window_preserve_mask_32_hi
op_amp
(paren
l_int|1
op_lshift
(paren
id|i
op_minus
l_int|32
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|preserve
)paren
id|mv64360_disable_window_32bit
c_func
(paren
id|bh
comma
id|i
)paren
suffix:semicolon
)brace
multiline_comment|/* Disable 64bit windows */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MV64x60_64BIT_WIN_COUNT
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|si-&gt;window_preserve_mask_64
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
)paren
id|mv64360_disable_window_64bit
c_func
(paren
id|bh
comma
id|i
)paren
suffix:semicolon
multiline_comment|/* Turn off PCI-&gt;MEM access cntl wins not in mv64360_64bit_windows[] */
id|mv64x60_clr_bits
c_func
(paren
id|bh
comma
id|MV64x60_PCI0_ACC_CNTL_4_BASE_LO
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_clr_bits
c_func
(paren
id|bh
comma
id|MV64x60_PCI0_ACC_CNTL_5_BASE_LO
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_clr_bits
c_func
(paren
id|bh
comma
id|MV64x60_PCI1_ACC_CNTL_4_BASE_LO
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_clr_bits
c_func
(paren
id|bh
comma
id|MV64x60_PCI1_ACC_CNTL_5_BASE_LO
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Disable all PCI-&gt;&lt;whatever&gt; windows */
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64x60_PCI0_BAR_ENABLE
comma
l_int|0x0000f9ff
)paren
suffix:semicolon
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64x60_PCI1_BAR_ENABLE
comma
l_int|0x0000f9ff
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64360_config_io2mem_windows()&n; *&n; * ENET, MPSC, and IDMA ctlrs on the MV64[34]60 have separate windows that&n; * must be set up so that the respective ctlr can access system memory.&n; */
DECL|variable|__initdata
r_static
id|u32
id|enet_tab
(braket
id|MV64x60_CPU2MEM_WINDOWS
)braket
id|__initdata
op_assign
(brace
id|MV64x60_ENET2MEM_0_WIN
comma
id|MV64x60_ENET2MEM_1_WIN
comma
id|MV64x60_ENET2MEM_2_WIN
comma
id|MV64x60_ENET2MEM_3_WIN
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|u32
id|mpsc_tab
(braket
id|MV64x60_CPU2MEM_WINDOWS
)braket
id|__initdata
op_assign
(brace
id|MV64x60_MPSC2MEM_0_WIN
comma
id|MV64x60_MPSC2MEM_1_WIN
comma
id|MV64x60_MPSC2MEM_2_WIN
comma
id|MV64x60_MPSC2MEM_3_WIN
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|u32
id|idma_tab
(braket
id|MV64x60_CPU2MEM_WINDOWS
)braket
id|__initdata
op_assign
(brace
id|MV64x60_IDMA2MEM_0_WIN
comma
id|MV64x60_IDMA2MEM_1_WIN
comma
id|MV64x60_IDMA2MEM_2_WIN
comma
id|MV64x60_IDMA2MEM_3_WIN
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
id|u32
id|dram_selects
(braket
id|MV64x60_CPU2MEM_WINDOWS
)braket
id|__initdata
op_assign
(brace
l_int|0xe
comma
l_int|0xd
comma
l_int|0xb
comma
l_int|0x7
)brace
suffix:semicolon
r_static
r_void
id|__init
DECL|function|mv64360_config_io2mem_windows
id|mv64360_config_io2mem_windows
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|mv64x60_setup_info
op_star
id|si
comma
id|u32
id|mem_windows
(braket
id|MV64x60_CPU2MEM_WINDOWS
)braket
(braket
l_int|2
)braket
)paren
(brace
id|u32
id|i
comma
id|win
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;config_io2regs_windows: enet, mpsc, idma -&gt; bridge regs&bslash;n&quot;
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64360_ENET2MEM_ACC_PROT_0
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64360_ENET2MEM_ACC_PROT_1
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64360_ENET2MEM_ACC_PROT_2
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64360_MPSC2MEM_ACC_PROT_0
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64360_MPSC2MEM_ACC_PROT_1
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64360_IDMA2MEM_ACC_PROT_0
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64360_IDMA2MEM_ACC_PROT_1
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64360_IDMA2MEM_ACC_PROT_2
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64360_IDMA2MEM_ACC_PROT_3
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Assume that mem ctlr has no more windows than embedded I/O ctlr */
r_for
c_loop
(paren
id|win
op_assign
id|MV64x60_CPU2MEM_0_WIN
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|win
op_le
id|MV64x60_CPU2MEM_3_WIN
suffix:semicolon
id|win
op_increment
comma
id|i
op_increment
)paren
r_if
c_cond
(paren
id|bh-&gt;ci
op_member_access_from_pointer
id|is_enabled_32bit
c_func
(paren
id|bh
comma
id|win
)paren
)paren
(brace
id|mv64x60_set_32bit_window
c_func
(paren
id|bh
comma
id|enet_tab
(braket
id|i
)braket
comma
id|mem_windows
(braket
id|i
)braket
(braket
l_int|0
)braket
comma
id|mem_windows
(braket
id|i
)braket
(braket
l_int|1
)braket
comma
(paren
id|dram_selects
(braket
id|i
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|si-&gt;enet_options
(braket
id|i
)braket
op_amp
l_int|0x3000
)paren
)paren
suffix:semicolon
id|bh-&gt;ci
op_member_access_from_pointer
id|enable_window_32bit
c_func
(paren
id|bh
comma
id|enet_tab
(braket
id|i
)braket
)paren
suffix:semicolon
multiline_comment|/* Give enet r/w access to memory region */
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64360_ENET2MEM_ACC_PROT_0
comma
(paren
l_int|0x3
op_lshift
(paren
id|i
op_lshift
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64360_ENET2MEM_ACC_PROT_1
comma
(paren
l_int|0x3
op_lshift
(paren
id|i
op_lshift
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64360_ENET2MEM_ACC_PROT_2
comma
(paren
l_int|0x3
op_lshift
(paren
id|i
op_lshift
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|mv64x60_set_32bit_window
c_func
(paren
id|bh
comma
id|mpsc_tab
(braket
id|i
)braket
comma
id|mem_windows
(braket
id|i
)braket
(braket
l_int|0
)braket
comma
id|mem_windows
(braket
id|i
)braket
(braket
l_int|1
)braket
comma
(paren
id|dram_selects
(braket
id|i
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|si-&gt;mpsc_options
(braket
id|i
)braket
op_amp
l_int|0x3000
)paren
)paren
suffix:semicolon
id|bh-&gt;ci
op_member_access_from_pointer
id|enable_window_32bit
c_func
(paren
id|bh
comma
id|mpsc_tab
(braket
id|i
)braket
)paren
suffix:semicolon
multiline_comment|/* Give mpsc r/w access to memory region */
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64360_MPSC2MEM_ACC_PROT_0
comma
(paren
l_int|0x3
op_lshift
(paren
id|i
op_lshift
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64360_MPSC2MEM_ACC_PROT_1
comma
(paren
l_int|0x3
op_lshift
(paren
id|i
op_lshift
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|mv64x60_set_32bit_window
c_func
(paren
id|bh
comma
id|idma_tab
(braket
id|i
)braket
comma
id|mem_windows
(braket
id|i
)braket
(braket
l_int|0
)braket
comma
id|mem_windows
(braket
id|i
)braket
(braket
l_int|1
)braket
comma
(paren
id|dram_selects
(braket
id|i
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|si-&gt;idma_options
(braket
id|i
)braket
op_amp
l_int|0x3000
)paren
)paren
suffix:semicolon
id|bh-&gt;ci
op_member_access_from_pointer
id|enable_window_32bit
c_func
(paren
id|bh
comma
id|idma_tab
(braket
id|i
)braket
)paren
suffix:semicolon
multiline_comment|/* Give idma r/w access to memory region */
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64360_IDMA2MEM_ACC_PROT_0
comma
(paren
l_int|0x3
op_lshift
(paren
id|i
op_lshift
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64360_IDMA2MEM_ACC_PROT_1
comma
(paren
l_int|0x3
op_lshift
(paren
id|i
op_lshift
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64360_IDMA2MEM_ACC_PROT_2
comma
(paren
l_int|0x3
op_lshift
(paren
id|i
op_lshift
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|mv64x60_set_bits
c_func
(paren
id|bh
comma
id|MV64360_IDMA2MEM_ACC_PROT_3
comma
(paren
l_int|0x3
op_lshift
(paren
id|i
op_lshift
l_int|1
)paren
)paren
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64360_set_mpsc2regs_window()&n; *&n; * MPSC has a window to the bridge&squot;s internal registers.  Call this routine&n; * to change that window so it doesn&squot;t conflict with the windows mapping the&n; * mpsc to system memory.&n; */
r_static
r_void
id|__init
DECL|function|mv64360_set_mpsc2regs_window
id|mv64360_set_mpsc2regs_window
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
id|u32
id|base
)paren
(brace
id|pr_debug
c_func
(paren
l_string|&quot;set mpsc-&gt;internal regs, base: 0x%x&bslash;n&quot;
comma
id|base
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
id|bh
comma
id|MV64360_MPSC2REGS_BASE
comma
id|base
op_amp
l_int|0xffff0000
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64360_chip_specific_init()&n; *&n; * No errata work arounds for the MV64360 implemented at this point.&n; */
r_static
r_void
id|__init
DECL|function|mv64360_chip_specific_init
id|mv64360_chip_specific_init
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|mv64x60_setup_info
op_star
id|si
)paren
(brace
macro_line|#ifdef CONFIG_SERIAL_MPSC
id|mv64x60_mpsc0_pdata.brg_can_tune
op_assign
l_int|1
suffix:semicolon
id|mv64x60_mpsc0_pdata.cache_mgmt
op_assign
l_int|1
suffix:semicolon
id|mv64x60_mpsc1_pdata.brg_can_tune
op_assign
l_int|1
suffix:semicolon
id|mv64x60_mpsc1_pdata.cache_mgmt
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * mv64460_chip_specific_init()&n; *&n; * No errata work arounds for the MV64460 implemented at this point.&n; */
r_static
r_void
id|__init
DECL|function|mv64460_chip_specific_init
id|mv64460_chip_specific_init
c_func
(paren
r_struct
id|mv64x60_handle
op_star
id|bh
comma
r_struct
id|mv64x60_setup_info
op_star
id|si
)paren
(brace
macro_line|#ifdef CONFIG_SERIAL_MPSC
id|mv64x60_mpsc0_pdata.brg_can_tune
op_assign
l_int|1
suffix:semicolon
id|mv64x60_mpsc1_pdata.brg_can_tune
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
eof
