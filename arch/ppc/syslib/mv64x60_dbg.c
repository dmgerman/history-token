multiline_comment|/*&n; * arch/ppc/syslib/mv64x60_dbg.c&n; *&n; * KGDB and progress routines for the Marvell/Galileo MV64x60 (Discovery).&n; *&n; * Author: Mark A. Greer &lt;mgreer@mvista.com&gt;&n; *&n; * 2003 (c) MontaVista Software, Inc.  This file is licensed under&n; * the terms of the GNU General Public License version 2.  This program&n; * is licensed &quot;as is&quot; without any warranty of any kind, whether express&n; * or implied.&n; */
multiline_comment|/*&n; *****************************************************************************&n; *&n; *&t;Low-level MPSC/UART I/O routines&n; *&n; *****************************************************************************&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/irq.h&gt;
macro_line|#include &lt;asm/delay.h&gt;
macro_line|#include &lt;asm/mv64x60.h&gt;
macro_line|#if defined(CONFIG_SERIAL_TEXT_DEBUG)
DECL|macro|MPSC_CHR_1
mdefine_line|#define&t;MPSC_CHR_1&t;0x000c
DECL|macro|MPSC_CHR_2
mdefine_line|#define&t;MPSC_CHR_2&t;0x0010
DECL|variable|mv64x60_dbg_bh
r_static
r_struct
id|mv64x60_handle
id|mv64x60_dbg_bh
suffix:semicolon
r_void
DECL|function|mv64x60_progress_init
id|mv64x60_progress_init
c_func
(paren
id|u32
id|base
)paren
(brace
id|mv64x60_dbg_bh.v_base
op_assign
id|base
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
DECL|function|mv64x60_polled_putc
id|mv64x60_polled_putc
c_func
(paren
r_int
id|chan
comma
r_char
id|c
)paren
(brace
id|u32
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|chan
op_eq
l_int|0
)paren
id|offset
op_assign
l_int|0x8000
suffix:semicolon
r_else
id|offset
op_assign
l_int|0x9000
suffix:semicolon
id|mv64x60_write
c_func
(paren
op_amp
id|mv64x60_dbg_bh
comma
id|offset
op_plus
id|MPSC_CHR_1
comma
(paren
id|u32
)paren
id|c
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
op_amp
id|mv64x60_dbg_bh
comma
id|offset
op_plus
id|MPSC_CHR_2
comma
l_int|0x200
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|2000
)paren
suffix:semicolon
)brace
r_void
DECL|function|mv64x60_mpsc_progress
id|mv64x60_mpsc_progress
c_func
(paren
r_char
op_star
id|s
comma
r_int
r_int
id|hex
)paren
(brace
r_volatile
r_char
id|c
suffix:semicolon
id|mv64x60_polled_putc
c_func
(paren
l_int|0
comma
l_char|&squot;&bslash;r&squot;
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|c
op_assign
op_star
id|s
op_increment
)paren
op_ne
l_int|0
)paren
id|mv64x60_polled_putc
c_func
(paren
l_int|0
comma
id|c
)paren
suffix:semicolon
id|mv64x60_polled_putc
c_func
(paren
l_int|0
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
id|mv64x60_polled_putc
c_func
(paren
l_int|0
comma
l_char|&squot;&bslash;r&squot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif&t;/* CONFIG_SERIAL_TEXT_DEBUG */
macro_line|#if defined(CONFIG_KGDB)
macro_line|#if defined(CONFIG_KGDB_TTYS0)
DECL|macro|KGDB_PORT
mdefine_line|#define KGDB_PORT 0
macro_line|#elif defined(CONFIG_KGDB_TTYS1)
DECL|macro|KGDB_PORT
mdefine_line|#define KGDB_PORT 1
macro_line|#else
macro_line|#error &quot;Invalid kgdb_tty port&quot;
macro_line|#endif
r_void
DECL|function|putDebugChar
id|putDebugChar
c_func
(paren
r_int
r_char
id|c
)paren
(brace
id|mv64x60_polled_putc
c_func
(paren
id|KGDB_PORT
comma
(paren
r_char
)paren
id|c
)paren
suffix:semicolon
)brace
r_int
DECL|function|getDebugChar
id|getDebugChar
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|c
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|mv64x60_polled_getc
c_func
(paren
id|KGDB_PORT
comma
op_amp
id|c
)paren
)paren
suffix:semicolon
r_return
(paren
r_int
)paren
id|c
suffix:semicolon
)brace
r_void
DECL|function|putDebugString
id|putDebugString
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_while
c_loop
(paren
op_star
id|str
op_ne
l_char|&squot;&bslash;0&squot;
)paren
(brace
id|putDebugChar
c_func
(paren
op_star
id|str
)paren
suffix:semicolon
id|str
op_increment
suffix:semicolon
)brace
id|putDebugChar
c_func
(paren
l_char|&squot;&bslash;r&squot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_void
DECL|function|kgdb_interruptible
id|kgdb_interruptible
c_func
(paren
r_int
id|enable
)paren
(brace
)brace
r_void
DECL|function|kgdb_map_scc
id|kgdb_map_scc
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|ppc_md.early_serial_map
)paren
id|ppc_md
dot
id|early_serial_map
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif&t;/* CONFIG_KGDB */
eof
