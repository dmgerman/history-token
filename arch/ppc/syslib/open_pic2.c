multiline_comment|/*&n; *  arch/ppc/kernel/open_pic.c -- OpenPIC Interrupt Handling&n; *&n; *  Copyright (C) 1997 Geert Uytterhoeven&n; *&n; *  This file is subject to the terms and conditions of the GNU General Public&n; *  License.  See the file COPYING in the main directory of this archive&n; *  for more details.&n; *&n; *  This is a duplicate of open_pic.c that deals with U3s MPIC on&n; *  G5 PowerMacs. It&squot;s the same file except it&squot;s using big endian&n; *  register accesses&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/irq.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/sysdev.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/signal.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/prom.h&gt;
macro_line|#include &lt;asm/sections.h&gt;
macro_line|#include &lt;asm/open_pic.h&gt;
macro_line|#include &lt;asm/i8259.h&gt;
macro_line|#include &quot;open_pic_defs.h&quot;
DECL|variable|OpenPIC2_Addr
r_void
op_star
id|OpenPIC2_Addr
suffix:semicolon
DECL|variable|OpenPIC2
r_static
r_volatile
r_struct
id|OpenPIC
op_star
id|OpenPIC2
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n; * We define OpenPIC_InitSenses table thusly:&n; * bit 0x1: sense, 0 for edge and 1 for level.&n; * bit 0x2: polarity, 0 for negative, 1 for positive.&n; */
r_extern
id|u_int
id|OpenPIC_NumInitSenses
suffix:semicolon
r_extern
id|u_char
op_star
id|OpenPIC_InitSenses
suffix:semicolon
r_extern
r_int
id|use_of_interrupt_tree
suffix:semicolon
DECL|variable|NumProcessors
r_static
id|u_int
id|NumProcessors
suffix:semicolon
DECL|variable|NumSources
r_static
id|u_int
id|NumSources
suffix:semicolon
DECL|variable|open_pic2_irq_offset
r_static
r_int
id|open_pic2_irq_offset
suffix:semicolon
DECL|variable|ISR
r_static
r_volatile
id|OpenPIC_Source
op_star
id|ISR
(braket
id|NR_IRQS
)braket
suffix:semicolon
multiline_comment|/* Global Operations */
r_static
r_void
id|openpic2_disable_8259_pass_through
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|openpic2_set_priority
c_func
(paren
id|u_int
id|pri
)paren
suffix:semicolon
r_static
r_void
id|openpic2_set_spurious
c_func
(paren
id|u_int
id|vector
)paren
suffix:semicolon
multiline_comment|/* Timer Interrupts */
r_static
r_void
id|openpic2_inittimer
c_func
(paren
id|u_int
id|timer
comma
id|u_int
id|pri
comma
id|u_int
id|vector
)paren
suffix:semicolon
r_static
r_void
id|openpic2_maptimer
c_func
(paren
id|u_int
id|timer
comma
id|u_int
id|cpumask
)paren
suffix:semicolon
multiline_comment|/* Interrupt Sources */
r_static
r_void
id|openpic2_enable_irq
c_func
(paren
id|u_int
id|irq
)paren
suffix:semicolon
r_static
r_void
id|openpic2_disable_irq
c_func
(paren
id|u_int
id|irq
)paren
suffix:semicolon
r_static
r_void
id|openpic2_initirq
c_func
(paren
id|u_int
id|irq
comma
id|u_int
id|pri
comma
id|u_int
id|vector
comma
r_int
id|polarity
comma
r_int
id|is_level
)paren
suffix:semicolon
r_static
r_void
id|openpic2_mapirq
c_func
(paren
id|u_int
id|irq
comma
id|u_int
id|cpumask
comma
id|u_int
id|keepmask
)paren
suffix:semicolon
multiline_comment|/*&n; * These functions are not used but the code is kept here&n; * for completeness and future reference.&n; */
r_static
r_void
id|openpic2_reset
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#ifdef notused
r_static
r_void
id|openpic2_enable_8259_pass_through
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
id|u_int
id|openpic2_get_priority
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
id|u_int
id|openpic2_get_spurious
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|openpic2_set_sense
c_func
(paren
id|u_int
id|irq
comma
r_int
id|sense
)paren
suffix:semicolon
macro_line|#endif /* notused */
multiline_comment|/*&n; * Description of the openpic for the higher-level irq code&n; */
r_static
r_void
id|openpic2_end_irq
c_func
(paren
r_int
r_int
id|irq_nr
)paren
suffix:semicolon
r_static
r_void
id|openpic2_ack_irq
c_func
(paren
r_int
r_int
id|irq_nr
)paren
suffix:semicolon
DECL|variable|open_pic2
r_struct
id|hw_interrupt_type
id|open_pic2
op_assign
(brace
l_string|&quot; OpenPIC2 &quot;
comma
l_int|NULL
comma
l_int|NULL
comma
id|openpic2_enable_irq
comma
id|openpic2_disable_irq
comma
id|openpic2_ack_irq
comma
id|openpic2_end_irq
comma
)brace
suffix:semicolon
multiline_comment|/*&n; *  Accesses to the current processor&squot;s openpic registers&n; *  On cascaded controller, this is only CPU 0&n; */
DECL|macro|THIS_CPU
mdefine_line|#define THIS_CPU&t;&t;Processor[0]
DECL|macro|DECL_THIS_CPU
mdefine_line|#define DECL_THIS_CPU
DECL|macro|CHECK_THIS_CPU
mdefine_line|#define CHECK_THIS_CPU
macro_line|#if 1
DECL|macro|check_arg_ipi
mdefine_line|#define check_arg_ipi(ipi) &bslash;&n;    if (ipi &lt; 0 || ipi &gt;= OPENPIC_NUM_IPI) &bslash;&n;&t;printk(&quot;open_pic.c:%d: illegal ipi %d&bslash;n&quot;, __LINE__, ipi);
DECL|macro|check_arg_timer
mdefine_line|#define check_arg_timer(timer) &bslash;&n;    if (timer &lt; 0 || timer &gt;= OPENPIC_NUM_TIMERS) &bslash;&n;&t;printk(&quot;open_pic.c:%d: illegal timer %d&bslash;n&quot;, __LINE__, timer);
DECL|macro|check_arg_vec
mdefine_line|#define check_arg_vec(vec) &bslash;&n;    if (vec &lt; 0 || vec &gt;= OPENPIC_NUM_VECTORS) &bslash;&n;&t;printk(&quot;open_pic.c:%d: illegal vector %d&bslash;n&quot;, __LINE__, vec);
DECL|macro|check_arg_pri
mdefine_line|#define check_arg_pri(pri) &bslash;&n;    if (pri &lt; 0 || pri &gt;= OPENPIC_NUM_PRI) &bslash;&n;&t;printk(&quot;open_pic.c:%d: illegal priority %d&bslash;n&quot;, __LINE__, pri);
multiline_comment|/*&n; * Print out a backtrace if it&squot;s out of range, since if it&squot;s larger than NR_IRQ&squot;s&n; * data has probably been corrupted and we&squot;re going to panic or deadlock later&n; * anyway --Troy&n; */
r_extern
r_int
r_int
op_star
id|_get_SP
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|macro|check_arg_irq
mdefine_line|#define check_arg_irq(irq) &bslash;&n;    if (irq &lt; open_pic2_irq_offset || irq &gt;= NumSources+open_pic2_irq_offset &bslash;&n;&t;|| ISR[irq - open_pic2_irq_offset] == 0) { &bslash;&n;      printk(&quot;open_pic.c:%d: illegal irq %d&bslash;n&quot;, __LINE__, irq); &bslash;&n;      /*print_backtrace(_get_SP());*/ }
DECL|macro|check_arg_cpu
mdefine_line|#define check_arg_cpu(cpu) &bslash;&n;    if (cpu &lt; 0 || cpu &gt;= NumProcessors){ &bslash;&n;&t;printk(&quot;open_pic2.c:%d: illegal cpu %d&bslash;n&quot;, __LINE__, cpu); &bslash;&n;&t;/*print_backtrace(_get_SP());*/ }
macro_line|#else
DECL|macro|check_arg_ipi
mdefine_line|#define check_arg_ipi(ipi)&t;do {} while (0)
DECL|macro|check_arg_timer
mdefine_line|#define check_arg_timer(timer)&t;do {} while (0)
DECL|macro|check_arg_vec
mdefine_line|#define check_arg_vec(vec)&t;do {} while (0)
DECL|macro|check_arg_pri
mdefine_line|#define check_arg_pri(pri)&t;do {} while (0)
DECL|macro|check_arg_irq
mdefine_line|#define check_arg_irq(irq)&t;do {} while (0)
DECL|macro|check_arg_cpu
mdefine_line|#define check_arg_cpu(cpu)&t;do {} while (0)
macro_line|#endif
DECL|function|openpic2_read
r_static
id|u_int
id|openpic2_read
c_func
(paren
r_volatile
id|u_int
op_star
id|addr
)paren
(brace
id|u_int
id|val
suffix:semicolon
id|val
op_assign
id|in_be32
c_func
(paren
id|addr
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
DECL|function|openpic2_write
r_static
r_inline
r_void
id|openpic2_write
c_func
(paren
r_volatile
id|u_int
op_star
id|addr
comma
id|u_int
id|val
)paren
(brace
id|out_be32
c_func
(paren
id|addr
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|openpic2_readfield
r_static
r_inline
id|u_int
id|openpic2_readfield
c_func
(paren
r_volatile
id|u_int
op_star
id|addr
comma
id|u_int
id|mask
)paren
(brace
id|u_int
id|val
op_assign
id|openpic2_read
c_func
(paren
id|addr
)paren
suffix:semicolon
r_return
id|val
op_amp
id|mask
suffix:semicolon
)brace
DECL|function|openpic2_writefield
r_inline
r_void
id|openpic2_writefield
c_func
(paren
r_volatile
id|u_int
op_star
id|addr
comma
id|u_int
id|mask
comma
id|u_int
id|field
)paren
(brace
id|u_int
id|val
op_assign
id|openpic2_read
c_func
(paren
id|addr
)paren
suffix:semicolon
id|openpic2_write
c_func
(paren
id|addr
comma
(paren
id|val
op_amp
op_complement
id|mask
)paren
op_or
(paren
id|field
op_amp
id|mask
)paren
)paren
suffix:semicolon
)brace
DECL|function|openpic2_clearfield
r_static
r_inline
r_void
id|openpic2_clearfield
c_func
(paren
r_volatile
id|u_int
op_star
id|addr
comma
id|u_int
id|mask
)paren
(brace
id|openpic2_writefield
c_func
(paren
id|addr
comma
id|mask
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|openpic2_setfield
r_static
r_inline
r_void
id|openpic2_setfield
c_func
(paren
r_volatile
id|u_int
op_star
id|addr
comma
id|u_int
id|mask
)paren
(brace
id|openpic2_writefield
c_func
(paren
id|addr
comma
id|mask
comma
id|mask
)paren
suffix:semicolon
)brace
DECL|function|openpic2_safe_writefield
r_static
r_void
id|openpic2_safe_writefield
c_func
(paren
r_volatile
id|u_int
op_star
id|addr
comma
id|u_int
id|mask
comma
id|u_int
id|field
)paren
(brace
id|openpic2_setfield
c_func
(paren
id|addr
comma
id|OPENPIC_MASK
)paren
suffix:semicolon
r_while
c_loop
(paren
id|openpic2_read
c_func
(paren
id|addr
)paren
op_amp
id|OPENPIC_ACTIVITY
)paren
suffix:semicolon
id|openpic2_writefield
c_func
(paren
id|addr
comma
id|mask
op_or
id|OPENPIC_MASK
comma
id|field
op_or
id|OPENPIC_MASK
)paren
suffix:semicolon
)brace
DECL|function|openpic2_reset
r_static
r_void
id|openpic2_reset
c_func
(paren
r_void
)paren
(brace
id|openpic2_setfield
c_func
(paren
op_amp
id|OpenPIC2-&gt;Global.Global_Configuration0
comma
id|OPENPIC_CONFIG_RESET
)paren
suffix:semicolon
r_while
c_loop
(paren
id|openpic2_readfield
c_func
(paren
op_amp
id|OpenPIC2-&gt;Global.Global_Configuration0
comma
id|OPENPIC_CONFIG_RESET
)paren
)paren
id|mb
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|openpic2_set_sources
r_void
id|__init
id|openpic2_set_sources
c_func
(paren
r_int
id|first_irq
comma
r_int
id|num_irqs
comma
r_void
op_star
id|first_ISR
)paren
(brace
r_volatile
id|OpenPIC_Source
op_star
id|src
op_assign
id|first_ISR
suffix:semicolon
r_int
id|i
comma
id|last_irq
suffix:semicolon
id|last_irq
op_assign
id|first_irq
op_plus
id|num_irqs
suffix:semicolon
r_if
c_cond
(paren
id|last_irq
OG
id|NumSources
)paren
id|NumSources
op_assign
id|last_irq
suffix:semicolon
r_if
c_cond
(paren
id|src
op_eq
l_int|0
)paren
id|src
op_assign
op_amp
(paren
(paren
r_struct
id|OpenPIC
op_star
)paren
id|OpenPIC2_Addr
)paren
op_member_access_from_pointer
id|Source
(braket
id|first_irq
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|first_irq
suffix:semicolon
id|i
OL
id|last_irq
suffix:semicolon
op_increment
id|i
comma
op_increment
id|src
)paren
id|ISR
(braket
id|i
)braket
op_assign
id|src
suffix:semicolon
)brace
multiline_comment|/*&n; * The `offset&squot; parameter defines where the interrupts handled by the&n; * OpenPIC start in the space of interrupt numbers that the kernel knows&n; * about.  In other words, the OpenPIC&squot;s IRQ0 is numbered `offset&squot; in the&n; * kernel&squot;s interrupt numbering scheme.&n; * We assume there is only one OpenPIC.&n; */
DECL|function|openpic2_init
r_void
id|__init
id|openpic2_init
c_func
(paren
r_int
id|offset
)paren
(brace
id|u_int
id|t
comma
id|i
suffix:semicolon
id|u_int
id|timerfreq
suffix:semicolon
r_const
r_char
op_star
id|version
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|OpenPIC2_Addr
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;No OpenPIC2 found !&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|OpenPIC2
op_assign
(paren
r_volatile
r_struct
id|OpenPIC
op_star
)paren
id|OpenPIC2_Addr
suffix:semicolon
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;openpic: enter&quot;
comma
l_int|0x122
)paren
suffix:semicolon
id|t
op_assign
id|openpic2_read
c_func
(paren
op_amp
id|OpenPIC2-&gt;Global.Feature_Reporting0
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|t
op_amp
id|OPENPIC_FEATURE_VERSION_MASK
)paren
(brace
r_case
l_int|1
suffix:colon
id|version
op_assign
l_string|&quot;1.0&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|version
op_assign
l_string|&quot;1.2&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|version
op_assign
l_string|&quot;1.3&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|version
op_assign
l_string|&quot;?&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
id|NumProcessors
op_assign
(paren
(paren
id|t
op_amp
id|OPENPIC_FEATURE_LAST_PROCESSOR_MASK
)paren
op_rshift
id|OPENPIC_FEATURE_LAST_PROCESSOR_SHIFT
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|NumSources
op_eq
l_int|0
)paren
id|openpic2_set_sources
c_func
(paren
l_int|0
comma
(paren
(paren
id|t
op_amp
id|OPENPIC_FEATURE_LAST_SOURCE_MASK
)paren
op_rshift
id|OPENPIC_FEATURE_LAST_SOURCE_SHIFT
)paren
op_plus
l_int|1
comma
l_int|NULL
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;OpenPIC (2) Version %s (%d CPUs and %d IRQ sources) at %p&bslash;n&quot;
comma
id|version
comma
id|NumProcessors
comma
id|NumSources
comma
id|OpenPIC2
)paren
suffix:semicolon
id|timerfreq
op_assign
id|openpic2_read
c_func
(paren
op_amp
id|OpenPIC2-&gt;Global.Timer_Frequency
)paren
suffix:semicolon
r_if
c_cond
(paren
id|timerfreq
)paren
id|printk
c_func
(paren
l_string|&quot;OpenPIC timer frequency is %d.%06d MHz&bslash;n&quot;
comma
id|timerfreq
op_div
l_int|1000000
comma
id|timerfreq
op_mod
l_int|1000000
)paren
suffix:semicolon
id|open_pic2_irq_offset
op_assign
id|offset
suffix:semicolon
multiline_comment|/* Initialize timer interrupts */
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;openpic2: timer&quot;
comma
l_int|0x3ba
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|OPENPIC_NUM_TIMERS
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Disabled, Priority 0 */
id|openpic2_inittimer
c_func
(paren
id|i
comma
l_int|0
comma
id|OPENPIC2_VEC_TIMER
op_plus
id|i
op_plus
id|offset
)paren
suffix:semicolon
multiline_comment|/* No processor */
id|openpic2_maptimer
c_func
(paren
id|i
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Initialize external interrupts */
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;openpic2: external&quot;
comma
l_int|0x3bc
)paren
suffix:semicolon
id|openpic2_set_priority
c_func
(paren
l_int|0xf
)paren
suffix:semicolon
multiline_comment|/* Init all external sources, including possibly the cascade. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NumSources
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|sense
suffix:semicolon
r_if
c_cond
(paren
id|ISR
(braket
id|i
)braket
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
multiline_comment|/* the bootloader may have left it enabled (bad !) */
id|openpic2_disable_irq
c_func
(paren
id|i
op_plus
id|offset
)paren
suffix:semicolon
id|sense
op_assign
(paren
id|i
OL
id|OpenPIC_NumInitSenses
)paren
ques
c_cond
id|OpenPIC_InitSenses
(braket
id|i
)braket
suffix:colon
"&bslash;"
(paren
id|IRQ_SENSE_LEVEL
op_or
id|IRQ_POLARITY_NEGATIVE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sense
op_amp
id|IRQ_SENSE_MASK
)paren
id|irq_desc
(braket
id|i
op_plus
id|offset
)braket
dot
id|status
op_assign
id|IRQ_LEVEL
suffix:semicolon
multiline_comment|/* Enabled, Priority 8 */
id|openpic2_initirq
c_func
(paren
id|i
comma
l_int|8
comma
id|i
op_plus
id|offset
comma
(paren
id|sense
op_amp
id|IRQ_POLARITY_MASK
)paren
comma
(paren
id|sense
op_amp
id|IRQ_SENSE_MASK
)paren
)paren
suffix:semicolon
multiline_comment|/* Processor 0 */
id|openpic2_mapirq
c_func
(paren
id|i
comma
l_int|1
op_lshift
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Init descriptors */
r_for
c_loop
(paren
id|i
op_assign
id|offset
suffix:semicolon
id|i
OL
id|NumSources
op_plus
id|offset
suffix:semicolon
id|i
op_increment
)paren
id|irq_desc
(braket
id|i
)braket
dot
id|handler
op_assign
op_amp
id|open_pic2
suffix:semicolon
multiline_comment|/* Initialize the spurious interrupt */
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;openpic2: spurious&quot;
comma
l_int|0x3bd
)paren
suffix:semicolon
id|openpic2_set_spurious
c_func
(paren
id|OPENPIC2_VEC_SPURIOUS
op_plus
id|offset
)paren
suffix:semicolon
id|openpic2_disable_8259_pass_through
c_func
(paren
)paren
suffix:semicolon
id|openpic2_set_priority
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;openpic2: exit&quot;
comma
l_int|0x222
)paren
suffix:semicolon
)brace
macro_line|#ifdef notused
DECL|function|openpic2_enable_8259_pass_through
r_static
r_void
id|openpic2_enable_8259_pass_through
c_func
(paren
r_void
)paren
(brace
id|openpic2_clearfield
c_func
(paren
op_amp
id|OpenPIC2-&gt;Global.Global_Configuration0
comma
id|OPENPIC_CONFIG_8259_PASSTHROUGH_DISABLE
)paren
suffix:semicolon
)brace
macro_line|#endif /* notused */
multiline_comment|/* This can&squot;t be __init, it is used in openpic_sleep_restore_intrs */
DECL|function|openpic2_disable_8259_pass_through
r_static
r_void
id|openpic2_disable_8259_pass_through
c_func
(paren
r_void
)paren
(brace
id|openpic2_setfield
c_func
(paren
op_amp
id|OpenPIC2-&gt;Global.Global_Configuration0
comma
id|OPENPIC_CONFIG_8259_PASSTHROUGH_DISABLE
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Find out the current interrupt&n; */
DECL|function|openpic2_irq
id|u_int
id|openpic2_irq
c_func
(paren
r_void
)paren
(brace
id|u_int
id|vec
suffix:semicolon
id|DECL_THIS_CPU
suffix:semicolon
id|CHECK_THIS_CPU
suffix:semicolon
id|vec
op_assign
id|openpic2_readfield
c_func
(paren
op_amp
id|OpenPIC2-&gt;THIS_CPU.Interrupt_Acknowledge
comma
id|OPENPIC_VECTOR_MASK
)paren
suffix:semicolon
r_return
id|vec
suffix:semicolon
)brace
DECL|function|openpic2_eoi
r_void
id|openpic2_eoi
c_func
(paren
r_void
)paren
(brace
id|DECL_THIS_CPU
suffix:semicolon
id|CHECK_THIS_CPU
suffix:semicolon
id|openpic2_write
c_func
(paren
op_amp
id|OpenPIC2-&gt;THIS_CPU.EOI
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Handle PCI write posting */
(paren
r_void
)paren
id|openpic2_read
c_func
(paren
op_amp
id|OpenPIC2-&gt;THIS_CPU.EOI
)paren
suffix:semicolon
)brace
macro_line|#ifdef notused
DECL|function|openpic2_get_priority
r_static
id|u_int
id|openpic2_get_priority
c_func
(paren
r_void
)paren
(brace
id|DECL_THIS_CPU
suffix:semicolon
id|CHECK_THIS_CPU
suffix:semicolon
r_return
id|openpic2_readfield
c_func
(paren
op_amp
id|OpenPIC2-&gt;THIS_CPU.Current_Task_Priority
comma
id|OPENPIC_CURRENT_TASK_PRIORITY_MASK
)paren
suffix:semicolon
)brace
macro_line|#endif /* notused */
DECL|function|openpic2_set_priority
r_static
r_void
id|__init
id|openpic2_set_priority
c_func
(paren
id|u_int
id|pri
)paren
(brace
id|DECL_THIS_CPU
suffix:semicolon
id|CHECK_THIS_CPU
suffix:semicolon
id|check_arg_pri
c_func
(paren
id|pri
)paren
suffix:semicolon
id|openpic2_writefield
c_func
(paren
op_amp
id|OpenPIC2-&gt;THIS_CPU.Current_Task_Priority
comma
id|OPENPIC_CURRENT_TASK_PRIORITY_MASK
comma
id|pri
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Get/set the spurious vector&n; */
macro_line|#ifdef notused
DECL|function|openpic2_get_spurious
r_static
id|u_int
id|openpic2_get_spurious
c_func
(paren
r_void
)paren
(brace
r_return
id|openpic2_readfield
c_func
(paren
op_amp
id|OpenPIC2-&gt;Global.Spurious_Vector
comma
id|OPENPIC_VECTOR_MASK
)paren
suffix:semicolon
)brace
macro_line|#endif /* notused */
multiline_comment|/* This can&squot;t be __init, it is used in openpic_sleep_restore_intrs */
DECL|function|openpic2_set_spurious
r_static
r_void
id|openpic2_set_spurious
c_func
(paren
id|u_int
id|vec
)paren
(brace
id|check_arg_vec
c_func
(paren
id|vec
)paren
suffix:semicolon
id|openpic2_writefield
c_func
(paren
op_amp
id|OpenPIC2-&gt;Global.Spurious_Vector
comma
id|OPENPIC_VECTOR_MASK
comma
id|vec
)paren
suffix:semicolon
)brace
r_static
id|DEFINE_SPINLOCK
c_func
(paren
id|openpic2_setup_lock
)paren
suffix:semicolon
multiline_comment|/*&n; *  Initialize a timer interrupt (and disable it)&n; *&n; *  timer: OpenPIC timer number&n; *  pri: interrupt source priority&n; *  vec: the vector it will produce&n; */
DECL|function|openpic2_inittimer
r_static
r_void
id|__init
id|openpic2_inittimer
c_func
(paren
id|u_int
id|timer
comma
id|u_int
id|pri
comma
id|u_int
id|vec
)paren
(brace
id|check_arg_timer
c_func
(paren
id|timer
)paren
suffix:semicolon
id|check_arg_pri
c_func
(paren
id|pri
)paren
suffix:semicolon
id|check_arg_vec
c_func
(paren
id|vec
)paren
suffix:semicolon
id|openpic2_safe_writefield
c_func
(paren
op_amp
id|OpenPIC2-&gt;Global.Timer
(braket
id|timer
)braket
dot
id|Vector_Priority
comma
id|OPENPIC_PRIORITY_MASK
op_or
id|OPENPIC_VECTOR_MASK
comma
(paren
id|pri
op_lshift
id|OPENPIC_PRIORITY_SHIFT
)paren
op_or
id|vec
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Map a timer interrupt to one or more CPUs&n; */
DECL|function|openpic2_maptimer
r_static
r_void
id|__init
id|openpic2_maptimer
c_func
(paren
id|u_int
id|timer
comma
id|u_int
id|cpumask
)paren
(brace
id|check_arg_timer
c_func
(paren
id|timer
)paren
suffix:semicolon
id|openpic2_write
c_func
(paren
op_amp
id|OpenPIC2-&gt;Global.Timer
(braket
id|timer
)braket
dot
id|Destination
comma
id|cpumask
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Initalize the interrupt source which will generate an NMI.&n; * This raises the interrupt&squot;s priority from 8 to 9.&n; *&n; * irq: The logical IRQ which generates an NMI.&n; */
r_void
id|__init
DECL|function|openpic2_init_nmi_irq
id|openpic2_init_nmi_irq
c_func
(paren
id|u_int
id|irq
)paren
(brace
id|check_arg_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
id|openpic2_safe_writefield
c_func
(paren
op_amp
id|ISR
(braket
id|irq
op_minus
id|open_pic2_irq_offset
)braket
op_member_access_from_pointer
id|Vector_Priority
comma
id|OPENPIC_PRIORITY_MASK
comma
l_int|9
op_lshift
id|OPENPIC_PRIORITY_SHIFT
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *&n; * All functions below take an offset&squot;ed irq argument&n; *&n; */
multiline_comment|/*&n; *  Enable/disable an external interrupt source&n; *&n; *  Externally called, irq is an offseted system-wide interrupt number&n; */
DECL|function|openpic2_enable_irq
r_static
r_void
id|openpic2_enable_irq
c_func
(paren
id|u_int
id|irq
)paren
(brace
r_volatile
id|u_int
op_star
id|vpp
suffix:semicolon
id|check_arg_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
id|vpp
op_assign
op_amp
id|ISR
(braket
id|irq
op_minus
id|open_pic2_irq_offset
)braket
op_member_access_from_pointer
id|Vector_Priority
suffix:semicolon
id|openpic2_clearfield
c_func
(paren
id|vpp
comma
id|OPENPIC_MASK
)paren
suffix:semicolon
multiline_comment|/* make sure mask gets to controller before we return to user */
r_do
(brace
id|mb
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* sync is probably useless here */
)brace
r_while
c_loop
(paren
id|openpic2_readfield
c_func
(paren
id|vpp
comma
id|OPENPIC_MASK
)paren
)paren
suffix:semicolon
)brace
DECL|function|openpic2_disable_irq
r_static
r_void
id|openpic2_disable_irq
c_func
(paren
id|u_int
id|irq
)paren
(brace
r_volatile
id|u_int
op_star
id|vpp
suffix:semicolon
id|u32
id|vp
suffix:semicolon
id|check_arg_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
id|vpp
op_assign
op_amp
id|ISR
(braket
id|irq
op_minus
id|open_pic2_irq_offset
)braket
op_member_access_from_pointer
id|Vector_Priority
suffix:semicolon
id|openpic2_setfield
c_func
(paren
id|vpp
comma
id|OPENPIC_MASK
)paren
suffix:semicolon
multiline_comment|/* make sure mask gets to controller before we return to user */
r_do
(brace
id|mb
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* sync is probably useless here */
id|vp
op_assign
id|openpic2_readfield
c_func
(paren
id|vpp
comma
id|OPENPIC_MASK
op_or
id|OPENPIC_ACTIVITY
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|vp
op_amp
id|OPENPIC_ACTIVITY
)paren
op_logical_and
op_logical_neg
(paren
id|vp
op_amp
id|OPENPIC_MASK
)paren
)paren
(brace
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *  Initialize an interrupt source (and disable it!)&n; *&n; *  irq: OpenPIC interrupt number&n; *  pri: interrupt source priority&n; *  vec: the vector it will produce&n; *  pol: polarity (1 for positive, 0 for negative)&n; *  sense: 1 for level, 0 for edge&n; */
r_static
r_void
id|__init
DECL|function|openpic2_initirq
id|openpic2_initirq
c_func
(paren
id|u_int
id|irq
comma
id|u_int
id|pri
comma
id|u_int
id|vec
comma
r_int
id|pol
comma
r_int
id|sense
)paren
(brace
id|openpic2_safe_writefield
c_func
(paren
op_amp
id|ISR
(braket
id|irq
)braket
op_member_access_from_pointer
id|Vector_Priority
comma
id|OPENPIC_PRIORITY_MASK
op_or
id|OPENPIC_VECTOR_MASK
op_or
id|OPENPIC_SENSE_MASK
op_or
id|OPENPIC_POLARITY_MASK
comma
(paren
id|pri
op_lshift
id|OPENPIC_PRIORITY_SHIFT
)paren
op_or
id|vec
op_or
(paren
id|pol
ques
c_cond
id|OPENPIC_POLARITY_POSITIVE
suffix:colon
id|OPENPIC_POLARITY_NEGATIVE
)paren
op_or
(paren
id|sense
ques
c_cond
id|OPENPIC_SENSE_LEVEL
suffix:colon
id|OPENPIC_SENSE_EDGE
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  Map an interrupt source to one or more CPUs&n; */
DECL|function|openpic2_mapirq
r_static
r_void
id|openpic2_mapirq
c_func
(paren
id|u_int
id|irq
comma
id|u_int
id|physmask
comma
id|u_int
id|keepmask
)paren
(brace
r_if
c_cond
(paren
id|ISR
(braket
id|irq
)braket
op_eq
l_int|0
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|keepmask
op_ne
l_int|0
)paren
id|physmask
op_or_assign
id|openpic2_read
c_func
(paren
op_amp
id|ISR
(braket
id|irq
)braket
op_member_access_from_pointer
id|Destination
)paren
op_amp
id|keepmask
suffix:semicolon
id|openpic2_write
c_func
(paren
op_amp
id|ISR
(braket
id|irq
)braket
op_member_access_from_pointer
id|Destination
comma
id|physmask
)paren
suffix:semicolon
)brace
macro_line|#ifdef notused
multiline_comment|/*&n; *  Set the sense for an interrupt source (and disable it!)&n; *&n; *  sense: 1 for level, 0 for edge&n; */
DECL|function|openpic2_set_sense
r_static
r_void
id|openpic2_set_sense
c_func
(paren
id|u_int
id|irq
comma
r_int
id|sense
)paren
(brace
r_if
c_cond
(paren
id|ISR
(braket
id|irq
)braket
op_ne
l_int|0
)paren
id|openpic2_safe_writefield
c_func
(paren
op_amp
id|ISR
(braket
id|irq
)braket
op_member_access_from_pointer
id|Vector_Priority
comma
id|OPENPIC_SENSE_LEVEL
comma
(paren
id|sense
ques
c_cond
id|OPENPIC_SENSE_LEVEL
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif /* notused */
multiline_comment|/* No spinlocks, should not be necessary with the OpenPIC&n; * (1 register = 1 interrupt and we have the desc lock).&n; */
DECL|function|openpic2_ack_irq
r_static
r_void
id|openpic2_ack_irq
c_func
(paren
r_int
r_int
id|irq_nr
)paren
(brace
id|openpic2_disable_irq
c_func
(paren
id|irq_nr
)paren
suffix:semicolon
id|openpic2_eoi
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|openpic2_end_irq
r_static
r_void
id|openpic2_end_irq
c_func
(paren
r_int
r_int
id|irq_nr
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|irq_desc
(braket
id|irq_nr
)braket
dot
id|status
op_amp
(paren
id|IRQ_DISABLED
op_or
id|IRQ_INPROGRESS
)paren
)paren
)paren
id|openpic2_enable_irq
c_func
(paren
id|irq_nr
)paren
suffix:semicolon
)brace
r_int
DECL|function|openpic2_get_irq
id|openpic2_get_irq
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|irq
op_assign
id|openpic2_irq
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_eq
(paren
id|OPENPIC2_VEC_SPURIOUS
op_plus
id|open_pic2_irq_offset
)paren
)paren
id|irq
op_assign
op_minus
l_int|1
suffix:semicolon
r_return
id|irq
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PM
multiline_comment|/*&n; * We implement the IRQ controller as a sysdev and put it&n; * to sleep at powerdown stage (the callback is named suspend,&n; * but it&squot;s old semantics, for the Device Model, it&squot;s really&n; * powerdown). The possible problem is that another sysdev that&n; * happens to be suspend after this one will have interrupts off,&n; * that may be an issue... For now, this isn&squot;t an issue on pmac&n; * though...&n; */
DECL|variable|save_ipi_vp
r_static
id|u32
id|save_ipi_vp
(braket
id|OPENPIC_NUM_IPI
)braket
suffix:semicolon
DECL|variable|save_irq_src_vp
r_static
id|u32
id|save_irq_src_vp
(braket
id|OPENPIC_MAX_SOURCES
)braket
suffix:semicolon
DECL|variable|save_irq_src_dest
r_static
id|u32
id|save_irq_src_dest
(braket
id|OPENPIC_MAX_SOURCES
)braket
suffix:semicolon
DECL|variable|save_cpu_task_pri
r_static
id|u32
id|save_cpu_task_pri
(braket
id|OPENPIC_MAX_PROCESSORS
)braket
suffix:semicolon
DECL|variable|openpic_suspend_count
r_static
r_int
id|openpic_suspend_count
suffix:semicolon
DECL|function|openpic2_cached_enable_irq
r_static
r_void
id|openpic2_cached_enable_irq
c_func
(paren
id|u_int
id|irq
)paren
(brace
id|check_arg_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
id|save_irq_src_vp
(braket
id|irq
op_minus
id|open_pic2_irq_offset
)braket
op_and_assign
op_complement
id|OPENPIC_MASK
suffix:semicolon
)brace
DECL|function|openpic2_cached_disable_irq
r_static
r_void
id|openpic2_cached_disable_irq
c_func
(paren
id|u_int
id|irq
)paren
(brace
id|check_arg_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
id|save_irq_src_vp
(braket
id|irq
op_minus
id|open_pic2_irq_offset
)braket
op_or_assign
id|OPENPIC_MASK
suffix:semicolon
)brace
multiline_comment|/* WARNING: Can be called directly by the cpufreq code with NULL parameter,&n; * we need something better to deal with that... Maybe switch to S1 for&n; * cpufreq changes&n; */
DECL|function|openpic2_suspend
r_int
id|openpic2_suspend
c_func
(paren
r_struct
id|sys_device
op_star
id|sysdev
comma
id|u32
id|state
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|openpic2_setup_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|openpic_suspend_count
op_increment
OG
l_int|0
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|openpic2_setup_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|open_pic2.enable
op_assign
id|openpic2_cached_enable_irq
suffix:semicolon
id|open_pic2.disable
op_assign
id|openpic2_cached_disable_irq
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NumProcessors
suffix:semicolon
id|i
op_increment
)paren
(brace
id|save_cpu_task_pri
(braket
id|i
)braket
op_assign
id|openpic2_read
c_func
(paren
op_amp
id|OpenPIC2-&gt;Processor
(braket
id|i
)braket
dot
id|Current_Task_Priority
)paren
suffix:semicolon
id|openpic2_writefield
c_func
(paren
op_amp
id|OpenPIC2-&gt;Processor
(braket
id|i
)braket
dot
id|Current_Task_Priority
comma
id|OPENPIC_CURRENT_TASK_PRIORITY_MASK
comma
l_int|0xf
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|OPENPIC_NUM_IPI
suffix:semicolon
id|i
op_increment
)paren
id|save_ipi_vp
(braket
id|i
)braket
op_assign
id|openpic2_read
c_func
(paren
op_amp
id|OpenPIC2-&gt;Global
dot
id|IPI_Vector_Priority
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NumSources
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ISR
(braket
id|i
)braket
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
id|save_irq_src_vp
(braket
id|i
)braket
op_assign
id|openpic2_read
c_func
(paren
op_amp
id|ISR
(braket
id|i
)braket
op_member_access_from_pointer
id|Vector_Priority
)paren
op_amp
op_complement
id|OPENPIC_ACTIVITY
suffix:semicolon
id|save_irq_src_dest
(braket
id|i
)braket
op_assign
id|openpic2_read
c_func
(paren
op_amp
id|ISR
(braket
id|i
)braket
op_member_access_from_pointer
id|Destination
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|openpic2_setup_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* WARNING: Can be called directly by the cpufreq code with NULL parameter,&n; * we need something better to deal with that... Maybe switch to S1 for&n; * cpufreq changes&n; */
DECL|function|openpic2_resume
r_int
id|openpic2_resume
c_func
(paren
r_struct
id|sys_device
op_star
id|sysdev
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u32
id|vppmask
op_assign
id|OPENPIC_PRIORITY_MASK
op_or
id|OPENPIC_VECTOR_MASK
op_or
id|OPENPIC_SENSE_MASK
op_or
id|OPENPIC_POLARITY_MASK
op_or
id|OPENPIC_MASK
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|openpic2_setup_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_decrement
id|openpic_suspend_count
)paren
OG
l_int|0
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|openpic2_setup_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|openpic2_reset
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* OpenPIC sometimes seem to need some time to be fully back up... */
r_do
(brace
id|openpic2_set_spurious
c_func
(paren
id|OPENPIC2_VEC_SPURIOUS
op_plus
id|open_pic2_irq_offset
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|openpic2_readfield
c_func
(paren
op_amp
id|OpenPIC2-&gt;Global.Spurious_Vector
comma
id|OPENPIC_VECTOR_MASK
)paren
op_ne
(paren
id|OPENPIC2_VEC_SPURIOUS
op_plus
id|open_pic2_irq_offset
)paren
)paren
(brace
suffix:semicolon
)brace
id|openpic2_disable_8259_pass_through
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|OPENPIC_NUM_IPI
suffix:semicolon
id|i
op_increment
)paren
id|openpic2_write
c_func
(paren
op_amp
id|OpenPIC2-&gt;Global
dot
id|IPI_Vector_Priority
c_func
(paren
id|i
)paren
comma
id|save_ipi_vp
(braket
id|i
)braket
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NumSources
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ISR
(braket
id|i
)braket
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
id|openpic2_write
c_func
(paren
op_amp
id|ISR
(braket
id|i
)braket
op_member_access_from_pointer
id|Destination
comma
id|save_irq_src_dest
(braket
id|i
)braket
)paren
suffix:semicolon
id|openpic2_write
c_func
(paren
op_amp
id|ISR
(braket
id|i
)braket
op_member_access_from_pointer
id|Vector_Priority
comma
id|save_irq_src_vp
(braket
id|i
)braket
)paren
suffix:semicolon
multiline_comment|/* make sure mask gets to controller before we return to user */
r_do
(brace
id|openpic2_write
c_func
(paren
op_amp
id|ISR
(braket
id|i
)braket
op_member_access_from_pointer
id|Vector_Priority
comma
id|save_irq_src_vp
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|openpic2_readfield
c_func
(paren
op_amp
id|ISR
(braket
id|i
)braket
op_member_access_from_pointer
id|Vector_Priority
comma
id|vppmask
)paren
op_ne
(paren
id|save_irq_src_vp
(braket
id|i
)braket
op_amp
id|vppmask
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NumProcessors
suffix:semicolon
id|i
op_increment
)paren
id|openpic2_write
c_func
(paren
op_amp
id|OpenPIC2-&gt;Processor
(braket
id|i
)braket
dot
id|Current_Task_Priority
comma
id|save_cpu_task_pri
(braket
id|i
)braket
)paren
suffix:semicolon
id|open_pic2.enable
op_assign
id|openpic2_enable_irq
suffix:semicolon
id|open_pic2.disable
op_assign
id|openpic2_disable_irq
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|openpic2_setup_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PM */
multiline_comment|/* HACK ALERT */
DECL|variable|openpic2_sysclass
r_static
r_struct
id|sysdev_class
id|openpic2_sysclass
op_assign
(brace
id|set_kset_name
c_func
(paren
l_string|&quot;openpic2&quot;
)paren
comma
)brace
suffix:semicolon
DECL|variable|device_openpic2
r_static
r_struct
id|sys_device
id|device_openpic2
op_assign
(brace
dot
id|id
op_assign
l_int|0
comma
dot
id|cls
op_assign
op_amp
id|openpic2_sysclass
comma
)brace
suffix:semicolon
DECL|variable|driver_openpic2
r_static
r_struct
id|sysdev_driver
id|driver_openpic2
op_assign
(brace
macro_line|#ifdef CONFIG_PM
dot
id|suspend
op_assign
op_amp
id|openpic2_suspend
comma
dot
id|resume
op_assign
op_amp
id|openpic2_resume
comma
macro_line|#endif /* CONFIG_PM */
)brace
suffix:semicolon
DECL|function|init_openpic2_sysfs
r_static
r_int
id|__init
id|init_openpic2_sysfs
c_func
(paren
r_void
)paren
(brace
r_int
id|rc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|OpenPIC2_Addr
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Registering openpic2 with sysfs...&bslash;n&quot;
)paren
suffix:semicolon
id|rc
op_assign
id|sysdev_class_register
c_func
(paren
op_amp
id|openpic2_sysclass
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Failed registering openpic sys class&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|rc
op_assign
id|sysdev_register
c_func
(paren
op_amp
id|device_openpic2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Failed registering openpic sys device&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|rc
op_assign
id|sysdev_driver_register
c_func
(paren
op_amp
id|openpic2_sysclass
comma
op_amp
id|driver_openpic2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Failed registering openpic sys driver&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|init_openpic2_sysfs
id|subsys_initcall
c_func
(paren
id|init_openpic2_sysfs
)paren
suffix:semicolon
eof
