multiline_comment|/*&n; * arch/ppc/kernel/gt64260_common.c&n; * &n; * Common routines for the Marvell/Galileo GT64260 (Discovery) host bridge,&n; * interrupt controller, memory controller, serial controller, enet controller,&n; * etc.&n; *&n; * Author: Mark A. Greer &lt;mgreer@mvista.com&gt;&n; *&n; * Copyright 2001 MontaVista Software Inc.&n; *&n; * This program is free software; you can redistribute  it and/or modify it&n; * under  the terms of  the GNU General  Public License as published by the&n; * Free Software Foundation;  either version 2 of the  License, or (at your&n; * option) any later version.&n; */
multiline_comment|/*&n; * The GT64260 port is the result of hard work from many people from&n; * many companies.  In particular, employees of Marvell/Galileo, Mission&n; * Critical Linux, Xyterra, and MontaVista Software were heavily involved.&n; */
multiline_comment|/*&n; * At last count, the 64260-B-0 has 65 errata and 24 restrictions.  The odds of&n; * you getting it to work well, under stress, for a long period of time are&n; * low.  If nothing else, you will likely run into an interrupt controller&n; * bug.&n; *&n; * The newer 64260A-B-0 is much improved but has its own problems.&n; * Dave Wilhardt &lt;dwilhardt@zyterra.com&gt; has discovered that you must set&n; * up your PCI snoop regions to be prefetchable with 4-word bursts AND set the&n; * &quot;Memory Write and Invalidate bit&quot; (bit 4) in the cmd reg of each PCI device&n; * before coherency works between PCI and other devices.  Many thanks to Dave.&n; *&n; * So far this code has been tested on Marvell/Galileo EV-64260-BP and&n; * an EV-64260A-BP uni-processor boards with 750 and 7400 processors.&n; * It has not yet been tested with a 7410 or 7450, or on an smp system.&n; *&n; * Note: I have not had any luck moving the base register address of the bridge&n; * &t; with the gt64260_set_base() routine.  I move it in the bootloader&n; * &t; before starting the kernel.  I haven&squot;t really looked into it so it&n; * &t; may be an easy fix. -- MAG&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/machdep.h&gt;
macro_line|#include &lt;asm/pci-bridge.h&gt;
macro_line|#include &lt;asm/gt64260.h&gt;
macro_line|#include &lt;asm/delay.h&gt;
DECL|variable|gt64260_base
id|u32
id|gt64260_base
suffix:semicolon
multiline_comment|/* Virtual base address of 64260&squot;s regs */
DECL|variable|gt64260_revision
id|u32
id|gt64260_revision
suffix:semicolon
multiline_comment|/* Revision of the chip */
DECL|variable|gt64260_pci_exclude_bridge
id|u8
id|gt64260_pci_exclude_bridge
op_assign
id|TRUE
suffix:semicolon
multiline_comment|/*&n; *****************************************************************************&n; *&n; *&t;Bridge Initialization Routines&n; *&n; *****************************************************************************&n; */
r_static
r_void
id|gt64260_check_errata
c_func
(paren
r_struct
id|pci_controller
op_star
id|hose_a
comma
r_struct
id|pci_controller
op_star
id|hose_b
)paren
suffix:semicolon
multiline_comment|/*&n; * Typical &squot;_find_bridges()&squot; routine for boards with a GT64260 bridge.&n; */
r_int
id|__init
DECL|function|gt64260_find_bridges
id|gt64260_find_bridges
c_func
(paren
id|u32
id|phys_base_addr
comma
id|gt64260_bridge_info_t
op_star
id|info
comma
r_int
(paren
(paren
op_star
id|map_irq
)paren
(paren
r_struct
id|pci_dev
op_star
comma
r_int
r_char
comma
r_int
r_char
)paren
)paren
)paren
(brace
r_struct
id|pci_controller
op_star
id|hose_a
comma
op_star
id|hose_b
suffix:semicolon
id|u32
id|io_base_a
comma
id|io_base_b
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|gt64260_base
op_assign
(paren
id|u32
)paren
id|ioremap
c_func
(paren
id|phys_base_addr
comma
id|GT64260_INTERNAL_SPACE_SIZE
)paren
suffix:semicolon
id|hose_a
op_assign
id|pcibios_alloc_controller
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hose_a
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|hose_b
op_assign
id|pcibios_alloc_controller
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hose_b
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|info-&gt;hose_a
op_assign
id|hose_a
suffix:semicolon
id|info-&gt;hose_b
op_assign
id|hose_b
suffix:semicolon
multiline_comment|/* Ends up mapping PCI Config addr/data pairs twice */
id|setup_indirect_pci
c_func
(paren
id|hose_a
comma
id|phys_base_addr
op_plus
id|GT64260_PCI_0_CONFIG_ADDR
comma
id|phys_base_addr
op_plus
id|GT64260_PCI_0_CONFIG_DATA
)paren
suffix:semicolon
id|setup_indirect_pci
c_func
(paren
id|hose_b
comma
id|phys_base_addr
op_plus
id|GT64260_PCI_1_CONFIG_ADDR
comma
id|phys_base_addr
op_plus
id|GT64260_PCI_1_CONFIG_DATA
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|gt64260_bridge_init
c_func
(paren
id|info
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|hose_a-&gt;cfg_addr
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|hose_a-&gt;cfg_data
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|hose_b-&gt;cfg_addr
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|hose_b-&gt;cfg_data
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|gt64260_base
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* ioremap PCI I/O regions */
id|io_base_b
op_assign
(paren
id|u32
)paren
id|ioremap
c_func
(paren
id|info-&gt;pci_1_io_start_proc
comma
id|info-&gt;pci_1_io_size
)paren
suffix:semicolon
id|io_base_a
op_assign
(paren
id|u32
)paren
id|ioremap
c_func
(paren
id|info-&gt;pci_0_io_start_proc
comma
id|info-&gt;pci_0_io_size
)paren
suffix:semicolon
id|isa_io_base
op_assign
id|io_base_a
suffix:semicolon
id|hose_a-&gt;first_busno
op_assign
l_int|0
suffix:semicolon
id|hose_a-&gt;last_busno
op_assign
l_int|0xff
suffix:semicolon
id|pci_init_resource
c_func
(paren
op_amp
id|hose_a-&gt;io_resource
comma
l_int|0
comma
multiline_comment|/* really: io_base_a - isa_io_base */
id|info-&gt;pci_0_io_size
op_minus
l_int|1
comma
id|IORESOURCE_IO
comma
l_string|&quot;host bridge PCI bus 0&quot;
)paren
suffix:semicolon
id|hose_a-&gt;io_space.start
op_assign
id|info-&gt;pci_0_io_start_pci
suffix:semicolon
id|hose_a-&gt;io_space.end
op_assign
id|info-&gt;pci_0_io_start_pci
op_plus
id|info-&gt;pci_0_io_size
op_minus
l_int|1
suffix:semicolon
id|hose_a-&gt;io_base_virt
op_assign
(paren
r_void
op_star
)paren
id|isa_io_base
suffix:semicolon
id|pci_init_resource
c_func
(paren
op_amp
id|hose_a-&gt;mem_resources
(braket
l_int|0
)braket
comma
id|info-&gt;pci_0_mem_start_proc
comma
id|info-&gt;pci_0_mem_start_proc
op_plus
id|info-&gt;pci_0_mem_size
op_minus
l_int|1
comma
id|IORESOURCE_MEM
comma
l_string|&quot;host bridge PCI bus 0&quot;
)paren
suffix:semicolon
id|hose_a-&gt;mem_space.start
op_assign
id|info-&gt;pci_0_mem_start_pci_lo
suffix:semicolon
id|hose_a-&gt;mem_space.end
op_assign
id|info-&gt;pci_0_mem_start_pci_lo
op_plus
id|info-&gt;pci_0_mem_size
op_minus
l_int|1
suffix:semicolon
id|hose_a-&gt;pci_mem_offset
op_assign
(paren
id|info-&gt;pci_0_mem_start_proc
op_minus
id|info-&gt;pci_0_mem_start_pci_lo
)paren
suffix:semicolon
id|hose_a-&gt;last_busno
op_assign
id|pciauto_bus_scan
c_func
(paren
id|hose_a
comma
id|hose_a-&gt;first_busno
)paren
suffix:semicolon
id|hose_b-&gt;first_busno
op_assign
id|hose_a-&gt;last_busno
op_plus
l_int|1
suffix:semicolon
id|hose_b-&gt;bus_offset
op_assign
id|hose_b-&gt;first_busno
suffix:semicolon
id|hose_b-&gt;last_busno
op_assign
l_int|0xff
suffix:semicolon
id|pci_init_resource
c_func
(paren
op_amp
id|hose_b-&gt;io_resource
comma
id|io_base_b
op_minus
id|isa_io_base
comma
id|io_base_b
op_minus
id|isa_io_base
op_plus
id|info-&gt;pci_1_io_size
op_minus
l_int|1
comma
id|IORESOURCE_IO
comma
l_string|&quot;host bridge PCI bus 1&quot;
)paren
suffix:semicolon
id|hose_b-&gt;io_space.start
op_assign
id|info-&gt;pci_1_io_start_pci
suffix:semicolon
id|hose_b-&gt;io_space.end
op_assign
id|info-&gt;pci_1_io_start_pci
op_plus
id|info-&gt;pci_1_io_size
op_minus
l_int|1
suffix:semicolon
id|hose_b-&gt;io_base_virt
op_assign
(paren
r_void
op_star
)paren
id|isa_io_base
suffix:semicolon
id|pci_init_resource
c_func
(paren
op_amp
id|hose_b-&gt;mem_resources
(braket
l_int|0
)braket
comma
id|info-&gt;pci_1_mem_start_proc
comma
id|info-&gt;pci_1_mem_start_proc
op_plus
id|info-&gt;pci_1_mem_size
op_minus
l_int|1
comma
id|IORESOURCE_MEM
comma
l_string|&quot;host bridge PCI bus 1&quot;
)paren
suffix:semicolon
id|hose_b-&gt;mem_space.start
op_assign
id|info-&gt;pci_1_mem_start_pci_lo
suffix:semicolon
id|hose_b-&gt;mem_space.end
op_assign
id|info-&gt;pci_1_mem_start_pci_lo
op_plus
id|info-&gt;pci_1_mem_size
op_minus
l_int|1
suffix:semicolon
id|hose_b-&gt;pci_mem_offset
op_assign
(paren
id|info-&gt;pci_1_mem_start_proc
op_minus
id|info-&gt;pci_1_mem_start_pci_lo
)paren
suffix:semicolon
id|hose_b-&gt;last_busno
op_assign
id|pciauto_bus_scan
c_func
(paren
id|hose_b
comma
id|hose_b-&gt;first_busno
)paren
suffix:semicolon
id|ppc_md.pci_exclude_device
op_assign
id|gt64260_pci_exclude_device
suffix:semicolon
id|ppc_md.pci_swizzle
op_assign
id|common_swizzle
suffix:semicolon
id|ppc_md.pci_map_irq
op_assign
id|map_irq
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* gt64260_find_bridges() */
multiline_comment|/*&n; * gt64260_bridge_init()&n; *&n; * Perform bridge initialization for a &quot;typical&quot; setup for a PPC system.&n; */
r_int
id|__init
DECL|function|gt64260_bridge_init
id|gt64260_bridge_init
c_func
(paren
id|gt64260_bridge_info_t
op_star
id|info
)paren
(brace
r_int
id|window
suffix:semicolon
id|u16
id|u16_val
suffix:semicolon
id|u32
id|u32_val
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|u8
id|save_exclude
suffix:semicolon
multiline_comment|/*&n;&t; * Count on firmware to set/clear other bits in this register.&n;&t; *&n;&t; * Set CPU CONFIG Reg bit:&n;&t; *&t;bit 13 - Pipeline&n;&t; *&t;bit 16 - RdOOO&n;&t; *&n;&t; * Clear CPU Config Reg bit:&n;&t; * &t;bit 12 - endianess&n;&t; *&t;bit 27 - RemapWrDis&n;&t; */
id|u32_val
op_assign
id|gt_read
c_func
(paren
id|GT64260_CPU_CONFIG
)paren
suffix:semicolon
id|u32_val
op_or_assign
(paren
(paren
l_int|1
op_lshift
l_int|13
)paren
op_or
(paren
l_int|1
op_lshift
l_int|16
)paren
)paren
suffix:semicolon
id|u32_val
op_and_assign
op_complement
(paren
(paren
l_int|1
op_lshift
l_int|8
)paren
op_or
(paren
l_int|1
op_lshift
l_int|12
)paren
op_or
(paren
l_int|1
op_lshift
l_int|27
)paren
)paren
suffix:semicolon
id|gt_write
c_func
(paren
id|GT64260_CPU_CONFIG
comma
id|u32_val
)paren
suffix:semicolon
multiline_comment|/* PCI 0/1 Timeout and Retry limits */
id|u32_val
op_assign
id|gt_read
c_func
(paren
id|GT64260_PCI_0_TO_RETRY
)paren
suffix:semicolon
id|u32_val
op_or_assign
l_int|0x0000ffff
suffix:semicolon
id|gt_write
c_func
(paren
id|GT64260_PCI_0_TO_RETRY
comma
id|u32_val
)paren
suffix:semicolon
id|u32_val
op_assign
id|gt_read
c_func
(paren
id|GT64260_PCI_1_TO_RETRY
)paren
suffix:semicolon
id|u32_val
op_or_assign
l_int|0x0000ffff
suffix:semicolon
id|gt_write
c_func
(paren
id|GT64260_PCI_1_TO_RETRY
comma
id|u32_val
)paren
suffix:semicolon
id|save_exclude
op_assign
id|gt64260_pci_exclude_bridge
suffix:semicolon
id|gt64260_pci_exclude_bridge
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/* Set class code to indicate host bridge */
id|early_read_config_dword
c_func
(paren
id|info-&gt;hose_a
comma
id|info-&gt;hose_a-&gt;first_busno
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|u32_val
)paren
suffix:semicolon
id|u32_val
op_and_assign
l_int|0x000000ff
suffix:semicolon
id|gt64260_revision
op_assign
id|u32_val
suffix:semicolon
multiline_comment|/* a 64260 or 64260A? */
id|u32_val
op_or_assign
(paren
id|PCI_CLASS_BRIDGE_HOST
op_lshift
l_int|16
)paren
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|info-&gt;hose_a
comma
id|info-&gt;hose_a-&gt;first_busno
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_CLASS_REVISION
comma
id|u32_val
)paren
suffix:semicolon
id|early_read_config_dword
c_func
(paren
id|info-&gt;hose_b
comma
id|info-&gt;hose_b-&gt;first_busno
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|u32_val
)paren
suffix:semicolon
id|u32_val
op_and_assign
l_int|0x000000ff
suffix:semicolon
id|u32_val
op_or_assign
(paren
id|PCI_CLASS_BRIDGE_HOST
op_lshift
l_int|16
)paren
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|info-&gt;hose_b
comma
id|info-&gt;hose_b-&gt;first_busno
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_CLASS_REVISION
comma
id|u32_val
)paren
suffix:semicolon
multiline_comment|/* Enable 64260 to be PCI master &amp; respond to PCI MEM cycles */
id|early_read_config_word
c_func
(paren
id|info-&gt;hose_a
comma
id|info-&gt;hose_a-&gt;first_busno
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_COMMAND
comma
op_amp
id|u16_val
)paren
suffix:semicolon
id|u16_val
op_or_assign
(paren
id|PCI_COMMAND_MASTER
op_or
id|PCI_COMMAND_MEMORY
)paren
suffix:semicolon
id|early_write_config_word
c_func
(paren
id|info-&gt;hose_a
comma
id|info-&gt;hose_a-&gt;first_busno
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_COMMAND
comma
id|u16_val
)paren
suffix:semicolon
id|early_read_config_word
c_func
(paren
id|info-&gt;hose_b
comma
id|info-&gt;hose_b-&gt;first_busno
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_COMMAND
comma
op_amp
id|u16_val
)paren
suffix:semicolon
id|u16_val
op_or_assign
(paren
id|PCI_COMMAND_MASTER
op_or
id|PCI_COMMAND_MEMORY
)paren
suffix:semicolon
id|early_write_config_word
c_func
(paren
id|info-&gt;hose_b
comma
id|info-&gt;hose_b-&gt;first_busno
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_COMMAND
comma
id|u16_val
)paren
suffix:semicolon
id|gt64260_pci_exclude_bridge
op_assign
id|save_exclude
suffix:semicolon
multiline_comment|/*&n;&t; * Disable all CPU windows on the bridge except for SCS 0 which&n;&t; * is covering all of system memory.:&n;&t; */
id|gt64260_cpu_disable_all_windows
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Set CPU snoop window to indicate all of system memory&n;&t; * is covered with wirte-back cache.&n;&t; */
id|gt64260_cpu_snoop_set_window
c_func
(paren
l_int|0
comma
l_int|0x00000000
comma
id|info-&gt;mem_size
comma
id|GT64260_CPU_SNOOP_WB
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Set up CPU-&gt;PCI mappings (so CPU can get at PCI dev regs/mem).&n;&t; * Will only use one of the four CPU-&gt;PCI MEM windows on each bus.&n;&t; */
id|gt64260_cpu_set_pci_io_window
c_func
(paren
l_int|0
comma
id|info-&gt;pci_0_io_start_proc
comma
id|info-&gt;pci_0_io_start_pci
comma
id|info-&gt;pci_0_io_size
comma
id|info-&gt;pci_0_io_swap
)paren
suffix:semicolon
id|gt64260_cpu_set_pci_mem_window
c_func
(paren
l_int|0
comma
l_int|0
comma
id|info-&gt;pci_0_mem_start_proc
comma
id|info-&gt;pci_0_mem_start_pci_hi
comma
id|info-&gt;pci_0_mem_start_pci_lo
comma
id|info-&gt;pci_0_mem_size
comma
id|info-&gt;pci_0_mem_swap
)paren
suffix:semicolon
id|gt64260_cpu_set_pci_io_window
c_func
(paren
l_int|1
comma
id|info-&gt;pci_1_io_start_proc
comma
id|info-&gt;pci_1_io_start_pci
comma
id|info-&gt;pci_1_io_size
comma
id|info-&gt;pci_1_io_swap
)paren
suffix:semicolon
id|gt64260_cpu_set_pci_mem_window
c_func
(paren
l_int|1
comma
l_int|0
comma
id|info-&gt;pci_1_mem_start_proc
comma
id|info-&gt;pci_1_mem_start_pci_hi
comma
id|info-&gt;pci_1_mem_start_pci_lo
comma
id|info-&gt;pci_1_mem_size
comma
id|info-&gt;pci_1_mem_swap
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Set up PCI MEM-&gt;system memory mapping (bridge slave PCI window).&n;&t; *&n;&t; * Set BAR enables to allow only the SCS0 slave window to respond&n;&t; * to PCI read/write cycles.&n;&t; */
id|gt64260_pci_bar_enable
c_func
(paren
l_int|0
comma
id|GT64260_PCI_SLAVE_BAR_REG_ENABLES_SCS_0
)paren
suffix:semicolon
id|gt64260_pci_bar_enable
c_func
(paren
l_int|1
comma
id|GT64260_PCI_SLAVE_BAR_REG_ENABLES_SCS_0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * For virt_to_bus &amp; bus_to_virt to work correctly, this mapping&n;&t; * must be the same on both PCI buses.&n;&t; */
id|gt64260_pci_slave_scs_set_window
c_func
(paren
id|info-&gt;hose_a
comma
l_int|0
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
id|info-&gt;mem_size
)paren
suffix:semicolon
id|gt64260_pci_slave_scs_set_window
c_func
(paren
id|info-&gt;hose_b
comma
l_int|0
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
id|info-&gt;mem_size
)paren
suffix:semicolon
id|pci_dram_offset
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* System mem at same addr on PCI &amp; cpu bus */
multiline_comment|/* Disable all the access control windows */
r_for
c_loop
(paren
id|window
op_assign
l_int|0
suffix:semicolon
id|window
OL
id|GT64260_PCI_ACC_CNTL_WINDOWS
suffix:semicolon
id|window
op_increment
)paren
(brace
id|gt64260_pci_acc_cntl_set_window
c_func
(paren
l_int|0
comma
id|window
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|gt64260_pci_acc_cntl_set_window
c_func
(paren
l_int|1
comma
id|window
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Disable all the PCI snoop regions */
r_for
c_loop
(paren
id|window
op_assign
l_int|0
suffix:semicolon
id|window
OL
id|GT64260_PCI_SNOOP_WINDOWS
suffix:semicolon
id|window
op_increment
)paren
(brace
id|gt64260_pci_snoop_set_window
c_func
(paren
l_int|0
comma
id|window
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|gt64260_pci_snoop_set_window
c_func
(paren
l_int|1
comma
id|window
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
id|gt64260_pci_acc_cntl_set_window
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
id|info-&gt;mem_size
comma
(paren
id|GT64260_PCI_ACC_CNTL_PREFETCHEN
op_or
id|GT64260_PCI_ACC_CNTL_MBURST_4_WORDS
op_or
id|GT64260_PCI_ACC_CNTL_SWAP_BYTE
)paren
)paren
suffix:semicolon
id|gt64260_pci_acc_cntl_set_window
c_func
(paren
l_int|1
comma
l_int|0
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
id|info-&gt;mem_size
comma
(paren
id|GT64260_PCI_ACC_CNTL_PREFETCHEN
op_or
id|GT64260_PCI_ACC_CNTL_MBURST_4_WORDS
op_or
id|GT64260_PCI_ACC_CNTL_SWAP_BYTE
)paren
)paren
suffix:semicolon
id|gt64260_pci_snoop_set_window
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
id|info-&gt;mem_size
comma
id|GT64260_PCI_SNOOP_WB
)paren
suffix:semicolon
id|gt64260_pci_snoop_set_window
c_func
(paren
l_int|1
comma
l_int|0
comma
l_int|0x00000000
comma
l_int|0x00000000
comma
id|info-&gt;mem_size
comma
id|GT64260_PCI_SNOOP_WB
)paren
suffix:semicolon
id|gt64260_check_errata
c_func
(paren
id|info-&gt;hose_a
comma
id|info-&gt;hose_b
)paren
suffix:semicolon
multiline_comment|/* Set latency timer (to 64) &amp; cacheline size; clear BIST */
id|gt64260_pci_exclude_bridge
op_assign
id|FALSE
suffix:semicolon
id|u32_val
op_assign
(paren
(paren
l_int|0x04
op_lshift
l_int|8
)paren
op_or
(paren
id|L1_CACHE_LINE_SIZE
op_div
l_int|4
)paren
)paren
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|info-&gt;hose_a
comma
id|info-&gt;hose_a-&gt;first_busno
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_CACHE_LINE_SIZE
comma
id|u32_val
)paren
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|info-&gt;hose_b
comma
id|info-&gt;hose_b-&gt;first_busno
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_CACHE_LINE_SIZE
comma
id|u32_val
)paren
suffix:semicolon
id|gt64260_pci_exclude_bridge
op_assign
id|TRUE
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_bridge_init() */
multiline_comment|/*&n; * gt64260_check_errata()&n; *&n; * Apply applicable errata and restrictions from 0.5 of the&n; * Errata and Restrictions document from Marvell/Galileo.&n; */
r_static
r_void
id|__init
DECL|function|gt64260_check_errata
id|gt64260_check_errata
c_func
(paren
r_struct
id|pci_controller
op_star
id|hose_a
comma
r_struct
id|pci_controller
op_star
id|hose_b
)paren
(brace
id|u32
id|val
suffix:semicolon
id|u8
id|save_exclude
suffix:semicolon
multiline_comment|/* Currently 2 versions, 64260 and 64260A */
r_if
c_cond
(paren
id|gt64260_revision
op_eq
id|GT64260
)paren
(brace
id|save_exclude
op_assign
id|gt64260_pci_exclude_bridge
suffix:semicolon
id|gt64260_pci_exclude_bridge
op_assign
id|FALSE
suffix:semicolon
multiline_comment|/* FEr#5, FEr#12 */
id|early_read_config_dword
c_func
(paren
id|hose_a
comma
id|hose_a-&gt;first_busno
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_COMMAND
comma
op_amp
id|val
)paren
suffix:semicolon
id|val
op_and_assign
op_complement
(paren
id|PCI_COMMAND_INVALIDATE
op_or
id|PCI_COMMAND_PARITY
)paren
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|hose_a
comma
id|hose_a-&gt;first_busno
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_COMMAND
comma
id|val
)paren
suffix:semicolon
id|early_read_config_dword
c_func
(paren
id|hose_b
comma
id|hose_b-&gt;first_busno
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_COMMAND
comma
op_amp
id|val
)paren
suffix:semicolon
id|val
op_and_assign
op_complement
(paren
id|PCI_COMMAND_INVALIDATE
op_or
id|PCI_COMMAND_PARITY
)paren
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|hose_b
comma
id|hose_b-&gt;first_busno
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_COMMAND
comma
id|val
)paren
suffix:semicolon
id|gt64260_pci_exclude_bridge
op_assign
id|save_exclude
suffix:semicolon
multiline_comment|/* FEr#12, FEr#13 */
id|gt_clr_bits
c_func
(paren
id|GT64260_PCI_0_CMD
comma
(paren
(paren
l_int|1
op_lshift
l_int|4
)paren
op_or
(paren
l_int|1
op_lshift
l_int|5
)paren
op_or
(paren
l_int|1
op_lshift
l_int|9
)paren
)paren
)paren
suffix:semicolon
id|gt_clr_bits
c_func
(paren
id|GT64260_PCI_1_CMD
comma
(paren
(paren
l_int|1
op_lshift
l_int|4
)paren
op_or
(paren
l_int|1
op_lshift
l_int|5
)paren
op_or
(paren
l_int|1
op_lshift
l_int|9
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/* FEr#54 */
id|gt_clr_bits
c_func
(paren
id|GT64260_CPU_SNOOP_BASE_0
comma
l_int|0xfffcf000
)paren
suffix:semicolon
id|gt_clr_bits
c_func
(paren
id|GT64260_CPU_SNOOP_BASE_1
comma
l_int|0xfffcf000
)paren
suffix:semicolon
id|gt_clr_bits
c_func
(paren
id|GT64260_CPU_SNOOP_BASE_2
comma
l_int|0xfffcf000
)paren
suffix:semicolon
id|gt_clr_bits
c_func
(paren
id|GT64260_CPU_SNOOP_BASE_3
comma
l_int|0xfffcf000
)paren
suffix:semicolon
multiline_comment|/* R#18 */
id|gt_set_bits
c_func
(paren
id|GT64260_SDRAM_CONFIG
comma
(paren
l_int|1
op_lshift
l_int|26
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|gt64260_revision
op_eq
id|GT64260A
)paren
(brace
multiline_comment|/* R#18 */
id|gt_set_bits
c_func
(paren
id|GT64260_SDRAM_CONFIG
comma
(paren
l_int|1
op_lshift
l_int|26
)paren
)paren
suffix:semicolon
multiline_comment|/* No longer errata so turn on */
id|gt_set_bits
c_func
(paren
id|GT64260_PCI_0_CMD
comma
(paren
(paren
l_int|1
op_lshift
l_int|4
)paren
op_or
(paren
l_int|1
op_lshift
l_int|5
)paren
op_or
(paren
l_int|1
op_lshift
l_int|9
)paren
)paren
)paren
suffix:semicolon
id|gt_set_bits
c_func
(paren
id|GT64260_PCI_1_CMD
comma
(paren
(paren
l_int|1
op_lshift
l_int|4
)paren
op_or
(paren
l_int|1
op_lshift
l_int|5
)paren
op_or
(paren
l_int|1
op_lshift
l_int|9
)paren
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* gt64260_check_errata() */
multiline_comment|/*&n; *****************************************************************************&n; *&n; *&t;General Window Setting Routines&n; *&n; *****************************************************************************&n; */
r_static
r_int
DECL|function|gt64260_set_32bit_window
id|gt64260_set_32bit_window
c_func
(paren
id|u32
id|base_addr
comma
id|u32
id|size
comma
id|u32
id|other_bits
comma
id|u32
id|bot_reg
comma
id|u32
id|top_reg
)paren
(brace
id|u32
id|val
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
l_int|0
)paren
(brace
multiline_comment|/* Set up the window on the CPU side */
id|gt_write
c_func
(paren
id|bot_reg
comma
(paren
id|base_addr
op_rshift
l_int|20
)paren
op_or
id|other_bits
)paren
suffix:semicolon
id|gt_write
c_func
(paren
id|top_reg
comma
(paren
id|base_addr
op_plus
id|size
op_minus
l_int|1
)paren
op_rshift
l_int|20
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Disable window */
id|gt_write
c_func
(paren
id|top_reg
comma
l_int|0x00000000
)paren
suffix:semicolon
id|gt_write
c_func
(paren
id|bot_reg
comma
l_int|0x00000fff
op_or
id|other_bits
)paren
suffix:semicolon
)brace
id|val
op_assign
id|gt_read
c_func
(paren
id|bot_reg
)paren
suffix:semicolon
multiline_comment|/* Flush FIFO */
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* gt64260_set_32bit_window() */
r_static
r_int
DECL|function|gt64260_set_64bit_window
id|gt64260_set_64bit_window
c_func
(paren
id|u32
id|base_addr_hi
comma
id|u32
id|base_addr_lo
comma
id|u32
id|size
comma
id|u32
id|other_bits
comma
id|u32
id|bot_reg_hi
comma
id|u32
id|bot_reg_lo
comma
id|u32
id|top_reg
)paren
(brace
r_int
id|rc
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|gt64260_set_32bit_window
c_func
(paren
id|base_addr_lo
comma
id|size
comma
id|other_bits
comma
id|bot_reg_lo
comma
id|top_reg
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|gt_write
c_func
(paren
id|bot_reg_hi
comma
id|base_addr_hi
)paren
suffix:semicolon
id|base_addr_hi
op_assign
id|gt_read
c_func
(paren
id|bot_reg_hi
)paren
suffix:semicolon
multiline_comment|/* Flush FIFO */
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_set_64bit_window() */
multiline_comment|/*&n; *****************************************************************************&n; *&n; *&t;CPU Configuration Routines&n; *&n; *****************************************************************************&n; */
r_int
DECL|function|gt64260_cpu_scs_set_window
id|gt64260_cpu_scs_set_window
c_func
(paren
id|u32
id|window
comma
id|u32
id|base_addr
comma
id|u32
id|size
)paren
(brace
r_static
id|u32
id|cpu_scs_windows
(braket
id|GT64260_CPU_SCS_DECODE_WINDOWS
)braket
(braket
l_int|2
)braket
op_assign
(brace
(brace
id|GT64260_CPU_SCS_DECODE_0_BOT
comma
id|GT64260_CPU_SCS_DECODE_0_TOP
)brace
comma
(brace
id|GT64260_CPU_SCS_DECODE_1_BOT
comma
id|GT64260_CPU_SCS_DECODE_1_TOP
)brace
comma
(brace
id|GT64260_CPU_SCS_DECODE_2_BOT
comma
id|GT64260_CPU_SCS_DECODE_2_TOP
)brace
comma
(brace
id|GT64260_CPU_SCS_DECODE_3_BOT
comma
id|GT64260_CPU_SCS_DECODE_3_TOP
)brace
comma
)brace
suffix:semicolon
multiline_comment|/* cpu_scs_windows[][] */
r_int
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|window
OL
id|GT64260_CPU_SCS_DECODE_WINDOWS
)paren
(brace
id|rc
op_assign
id|gt64260_set_32bit_window
c_func
(paren
id|base_addr
comma
id|size
comma
l_int|0
comma
id|cpu_scs_windows
(braket
id|window
)braket
(braket
l_int|0
)braket
comma
id|cpu_scs_windows
(braket
id|window
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_cpu_scs_set_window() */
r_int
DECL|function|gt64260_cpu_cs_set_window
id|gt64260_cpu_cs_set_window
c_func
(paren
id|u32
id|window
comma
id|u32
id|base_addr
comma
id|u32
id|size
)paren
(brace
r_static
id|u32
id|cpu_cs_windows
(braket
id|GT64260_CPU_CS_DECODE_WINDOWS
)braket
(braket
l_int|2
)braket
op_assign
(brace
(brace
id|GT64260_CPU_CS_DECODE_0_BOT
comma
id|GT64260_CPU_CS_DECODE_0_TOP
)brace
comma
(brace
id|GT64260_CPU_CS_DECODE_1_BOT
comma
id|GT64260_CPU_CS_DECODE_1_TOP
)brace
comma
(brace
id|GT64260_CPU_CS_DECODE_2_BOT
comma
id|GT64260_CPU_CS_DECODE_2_TOP
)brace
comma
(brace
id|GT64260_CPU_CS_DECODE_3_BOT
comma
id|GT64260_CPU_CS_DECODE_3_TOP
)brace
comma
)brace
suffix:semicolon
multiline_comment|/* cpu_cs_windows[][] */
r_int
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|window
OL
id|GT64260_CPU_CS_DECODE_WINDOWS
)paren
(brace
id|rc
op_assign
id|gt64260_set_32bit_window
c_func
(paren
id|base_addr
comma
id|size
comma
l_int|0
comma
id|cpu_cs_windows
(braket
id|window
)braket
(braket
l_int|0
)braket
comma
id|cpu_cs_windows
(braket
id|window
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_cpu_cs_set_window() */
r_int
DECL|function|gt64260_cpu_boot_set_window
id|gt64260_cpu_boot_set_window
c_func
(paren
id|u32
id|base_addr
comma
id|u32
id|size
)paren
(brace
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|gt64260_set_32bit_window
c_func
(paren
id|base_addr
comma
id|size
comma
l_int|0
comma
id|GT64260_CPU_BOOT_CS_DECODE_0_BOT
comma
id|GT64260_CPU_BOOT_CS_DECODE_0_TOP
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_cpu_boot_set_window() */
multiline_comment|/*&n; * gt64260_cpu_set_pci_io_window()&n; *&n; * Set up a CPU window into PCI I/O or MEM space.&n; * Always do Read/Modify/Write to window regs.&n; */
r_static
r_int
DECL|function|gt64260_cpu_pci_set_window
id|gt64260_cpu_pci_set_window
c_func
(paren
id|u32
id|cpu_base_addr
comma
id|u32
id|pci_base_addr
comma
id|u32
id|size
comma
id|u32
id|other_bits
comma
id|u32
id|bot_reg
comma
id|u32
id|top_reg
comma
id|u32
id|remap_reg
)paren
(brace
id|u32
id|val
suffix:semicolon
r_int
id|rc
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|gt64260_set_32bit_window
c_func
(paren
id|cpu_base_addr
comma
id|size
comma
id|other_bits
comma
id|bot_reg
comma
id|top_reg
)paren
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* Set up CPU-&gt;PCI remapping (on lower 32 bits) */
id|gt_write
c_func
(paren
id|remap_reg
comma
id|pci_base_addr
op_rshift
l_int|20
)paren
suffix:semicolon
id|val
op_assign
id|gt_read
c_func
(paren
id|bot_reg
)paren
suffix:semicolon
multiline_comment|/* Flush FIFO */
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_cpu_pci_set_window() */
multiline_comment|/*&n; * gt64260_cpu_set_pci_io_window()&n; *&n; * Set up a CPU window into PCI I/O space.&n; * Always do Read/Modify/Write to window regs.&n; */
r_int
DECL|function|gt64260_cpu_set_pci_io_window
id|gt64260_cpu_set_pci_io_window
c_func
(paren
id|u32
id|pci_bus
comma
id|u32
id|cpu_base_addr
comma
id|u32
id|pci_base_addr
comma
id|u32
id|size
comma
id|u32
id|swap
)paren
(brace
multiline_comment|/* 2 PCI buses with 1 I/O window each (from CPU point of view) */
r_static
id|u32
id|cpu_pci_io_windows
(braket
id|GT64260_PCI_BUSES
)braket
(braket
l_int|3
)braket
op_assign
(brace
(brace
id|GT64260_CPU_PCI_0_IO_DECODE_BOT
comma
id|GT64260_CPU_PCI_0_IO_DECODE_TOP
comma
id|GT64260_CPU_PCI_0_IO_REMAP
)brace
comma
(brace
id|GT64260_CPU_PCI_1_IO_DECODE_BOT
comma
id|GT64260_CPU_PCI_1_IO_DECODE_TOP
comma
id|GT64260_CPU_PCI_1_IO_REMAP
)brace
comma
)brace
suffix:semicolon
multiline_comment|/* cpu_pci_io_windows[][] */
r_int
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|pci_bus
OL
id|GT64260_PCI_BUSES
)paren
(brace
id|rc
op_assign
id|gt64260_cpu_pci_set_window
c_func
(paren
id|cpu_base_addr
comma
id|pci_base_addr
comma
id|size
comma
id|swap
comma
id|cpu_pci_io_windows
(braket
id|pci_bus
)braket
(braket
l_int|0
)braket
comma
id|cpu_pci_io_windows
(braket
id|pci_bus
)braket
(braket
l_int|1
)braket
comma
id|cpu_pci_io_windows
(braket
id|pci_bus
)braket
(braket
l_int|2
)braket
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_cpu_set_pci_io_window() */
multiline_comment|/*&n; * gt64260_cpu_set_pci_mem_window()&n; *&n; * Set up a CPU window into PCI MEM space (4 PCI MEM windows per PCI bus).&n; * Always do Read/Modify/Write to window regs.&n; */
r_int
DECL|function|gt64260_cpu_set_pci_mem_window
id|gt64260_cpu_set_pci_mem_window
c_func
(paren
id|u32
id|pci_bus
comma
id|u32
id|window
comma
id|u32
id|cpu_base_addr
comma
id|u32
id|pci_base_addr_hi
comma
id|u32
id|pci_base_addr_lo
comma
id|u32
id|size
comma
id|u32
id|swap_64bit
)paren
(brace
multiline_comment|/* 2 PCI buses with 4 memory windows each (from CPU point of view) */
r_static
id|u32
id|cpu_pci_mem_windows
(braket
id|GT64260_PCI_BUSES
)braket
(braket
id|GT64260_PCI_MEM_WINDOWS_PER_BUS
)braket
(braket
l_int|4
)braket
op_assign
(brace
(brace
multiline_comment|/* PCI 0 */
(brace
id|GT64260_CPU_PCI_0_MEM_0_DECODE_BOT
comma
id|GT64260_CPU_PCI_0_MEM_0_DECODE_TOP
comma
id|GT64260_CPU_PCI_0_MEM_0_REMAP_HI
comma
id|GT64260_CPU_PCI_0_MEM_0_REMAP_LO
)brace
comma
(brace
id|GT64260_CPU_PCI_0_MEM_1_DECODE_BOT
comma
id|GT64260_CPU_PCI_0_MEM_1_DECODE_TOP
comma
id|GT64260_CPU_PCI_0_MEM_1_REMAP_HI
comma
id|GT64260_CPU_PCI_0_MEM_1_REMAP_LO
)brace
comma
(brace
id|GT64260_CPU_PCI_0_MEM_2_DECODE_BOT
comma
id|GT64260_CPU_PCI_0_MEM_2_DECODE_TOP
comma
id|GT64260_CPU_PCI_0_MEM_2_REMAP_HI
comma
id|GT64260_CPU_PCI_0_MEM_2_REMAP_LO
)brace
comma
(brace
id|GT64260_CPU_PCI_0_MEM_3_DECODE_BOT
comma
id|GT64260_CPU_PCI_0_MEM_3_DECODE_TOP
comma
id|GT64260_CPU_PCI_0_MEM_3_REMAP_HI
comma
id|GT64260_CPU_PCI_0_MEM_3_REMAP_LO
)brace
)brace
comma
(brace
multiline_comment|/* PCI 1 */
(brace
id|GT64260_CPU_PCI_1_MEM_0_DECODE_BOT
comma
id|GT64260_CPU_PCI_1_MEM_0_DECODE_TOP
comma
id|GT64260_CPU_PCI_1_MEM_0_REMAP_HI
comma
id|GT64260_CPU_PCI_1_MEM_0_REMAP_LO
)brace
comma
(brace
id|GT64260_CPU_PCI_1_MEM_1_DECODE_BOT
comma
id|GT64260_CPU_PCI_1_MEM_1_DECODE_TOP
comma
id|GT64260_CPU_PCI_1_MEM_1_REMAP_HI
comma
id|GT64260_CPU_PCI_1_MEM_1_REMAP_LO
)brace
comma
(brace
id|GT64260_CPU_PCI_1_MEM_2_DECODE_BOT
comma
id|GT64260_CPU_PCI_1_MEM_2_DECODE_TOP
comma
id|GT64260_CPU_PCI_1_MEM_2_REMAP_HI
comma
id|GT64260_CPU_PCI_1_MEM_2_REMAP_LO
)brace
comma
(brace
id|GT64260_CPU_PCI_1_MEM_3_DECODE_BOT
comma
id|GT64260_CPU_PCI_1_MEM_3_DECODE_TOP
comma
id|GT64260_CPU_PCI_1_MEM_3_REMAP_HI
comma
id|GT64260_CPU_PCI_1_MEM_3_REMAP_LO
)brace
comma
)brace
)brace
suffix:semicolon
multiline_comment|/* cpu_pci_mem_windows[][][] */
id|u32
id|remap_reg
comma
id|remap
suffix:semicolon
r_int
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pci_bus
OL
id|GT64260_PCI_BUSES
)paren
op_logical_and
(paren
id|window
OL
id|GT64260_PCI_MEM_WINDOWS_PER_BUS
)paren
)paren
(brace
r_if
c_cond
(paren
id|gt64260_cpu_pci_set_window
c_func
(paren
id|cpu_base_addr
comma
id|pci_base_addr_lo
comma
id|size
comma
id|swap_64bit
comma
id|cpu_pci_mem_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|0
)braket
comma
id|cpu_pci_mem_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|1
)braket
comma
id|cpu_pci_mem_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|3
)braket
)paren
op_eq
l_int|0
)paren
(brace
id|remap_reg
op_assign
id|cpu_pci_mem_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|2
)braket
suffix:semicolon
id|gt_write
c_func
(paren
id|remap_reg
comma
id|pci_base_addr_hi
)paren
suffix:semicolon
id|remap
op_assign
id|gt_read
c_func
(paren
id|remap_reg
)paren
suffix:semicolon
multiline_comment|/* Flush FIFO */
id|rc
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_cpu_set_pci_mem_window() */
r_int
DECL|function|gt64260_cpu_prot_set_window
id|gt64260_cpu_prot_set_window
c_func
(paren
id|u32
id|window
comma
id|u32
id|base_addr
comma
id|u32
id|size
comma
id|u32
id|access_bits
)paren
(brace
r_static
id|u32
id|cpu_prot_windows
(braket
id|GT64260_CPU_PROT_WINDOWS
)braket
(braket
l_int|2
)braket
op_assign
(brace
(brace
id|GT64260_CPU_PROT_BASE_0
comma
id|GT64260_CPU_PROT_TOP_0
)brace
comma
(brace
id|GT64260_CPU_PROT_BASE_1
comma
id|GT64260_CPU_PROT_TOP_1
)brace
comma
(brace
id|GT64260_CPU_PROT_BASE_2
comma
id|GT64260_CPU_PROT_TOP_2
)brace
comma
(brace
id|GT64260_CPU_PROT_BASE_3
comma
id|GT64260_CPU_PROT_TOP_3
)brace
comma
(brace
id|GT64260_CPU_PROT_BASE_4
comma
id|GT64260_CPU_PROT_TOP_4
)brace
comma
(brace
id|GT64260_CPU_PROT_BASE_5
comma
id|GT64260_CPU_PROT_TOP_5
)brace
comma
(brace
id|GT64260_CPU_PROT_BASE_6
comma
id|GT64260_CPU_PROT_TOP_6
)brace
comma
(brace
id|GT64260_CPU_PROT_BASE_7
comma
id|GT64260_CPU_PROT_TOP_7
)brace
comma
)brace
suffix:semicolon
multiline_comment|/* cpu_prot_windows[][] */
r_int
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|window
OL
id|GT64260_CPU_PROT_WINDOWS
)paren
(brace
id|rc
op_assign
id|gt64260_set_32bit_window
c_func
(paren
id|base_addr
comma
id|size
comma
id|access_bits
comma
id|cpu_prot_windows
(braket
id|window
)braket
(braket
l_int|0
)braket
comma
id|cpu_prot_windows
(braket
id|window
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_cpu_prot_set_window() */
r_int
DECL|function|gt64260_cpu_snoop_set_window
id|gt64260_cpu_snoop_set_window
c_func
(paren
id|u32
id|window
comma
id|u32
id|base_addr
comma
id|u32
id|size
comma
id|u32
id|snoop_type
)paren
(brace
r_static
id|u32
id|cpu_snoop_windows
(braket
id|GT64260_CPU_SNOOP_WINDOWS
)braket
(braket
l_int|2
)braket
op_assign
(brace
(brace
id|GT64260_CPU_SNOOP_BASE_0
comma
id|GT64260_CPU_SNOOP_TOP_0
)brace
comma
(brace
id|GT64260_CPU_SNOOP_BASE_1
comma
id|GT64260_CPU_SNOOP_TOP_1
)brace
comma
(brace
id|GT64260_CPU_SNOOP_BASE_2
comma
id|GT64260_CPU_SNOOP_TOP_2
)brace
comma
(brace
id|GT64260_CPU_SNOOP_BASE_3
comma
id|GT64260_CPU_SNOOP_TOP_3
)brace
comma
)brace
suffix:semicolon
multiline_comment|/* cpu_snoop_windows[][] */
r_int
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|window
OL
id|GT64260_CPU_SNOOP_WINDOWS
)paren
op_logical_and
(paren
id|snoop_type
op_le
id|GT64260_CPU_SNOOP_WB
)paren
)paren
(brace
id|rc
op_assign
id|gt64260_set_32bit_window
c_func
(paren
id|base_addr
comma
id|size
comma
id|snoop_type
comma
id|cpu_snoop_windows
(braket
id|window
)braket
(braket
l_int|0
)braket
comma
id|cpu_snoop_windows
(braket
id|window
)braket
(braket
l_int|1
)braket
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_cpu_snoop_set_window() */
r_void
DECL|function|gt64260_cpu_disable_all_windows
id|gt64260_cpu_disable_all_windows
c_func
(paren
r_void
)paren
(brace
r_int
id|pci_bus
comma
id|window
suffix:semicolon
multiline_comment|/* Don&squot;t disable SCS windows b/c we need to access system memory */
r_for
c_loop
(paren
id|window
op_assign
l_int|0
suffix:semicolon
id|window
OL
id|GT64260_CPU_CS_DECODE_WINDOWS
suffix:semicolon
id|window
op_increment
)paren
(brace
id|gt64260_cpu_cs_set_window
c_func
(paren
id|window
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
id|gt64260_cpu_boot_set_window
c_func
(paren
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|pci_bus
op_assign
l_int|0
suffix:semicolon
id|pci_bus
OL
id|GT64260_PCI_BUSES
suffix:semicolon
id|pci_bus
op_increment
)paren
(brace
id|gt64260_cpu_set_pci_io_window
c_func
(paren
id|pci_bus
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|window
op_assign
l_int|0
suffix:semicolon
id|window
OL
id|GT64260_PCI_MEM_WINDOWS_PER_BUS
suffix:semicolon
id|window
op_increment
)paren
(brace
id|gt64260_cpu_set_pci_mem_window
c_func
(paren
id|pci_bus
comma
id|window
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|window
op_assign
l_int|0
suffix:semicolon
id|window
OL
id|GT64260_CPU_PROT_WINDOWS
suffix:semicolon
id|window
op_increment
)paren
(brace
id|gt64260_cpu_prot_set_window
c_func
(paren
id|window
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|window
op_assign
l_int|0
suffix:semicolon
id|window
OL
id|GT64260_CPU_SNOOP_WINDOWS
suffix:semicolon
id|window
op_increment
)paren
(brace
id|gt64260_cpu_snoop_set_window
c_func
(paren
id|window
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/* gt64260_cpu_disable_all_windows() */
multiline_comment|/*&n; *****************************************************************************&n; *&n; *&t;PCI Slave Window Configuration Routines&n; *&n; *****************************************************************************&n; */
r_int
DECL|function|gt64260_pci_bar_enable
id|gt64260_pci_bar_enable
c_func
(paren
id|u32
id|pci_bus
comma
id|u32
id|enable_bits
)paren
(brace
id|u32
id|reg
comma
id|val
suffix:semicolon
r_int
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|pci_bus
OL
id|GT64260_PCI_BUSES
)paren
(brace
id|reg
op_assign
(paren
id|pci_bus
op_eq
l_int|0
)paren
ques
c_cond
id|GT64260_PCI_0_SLAVE_BAR_REG_ENABLES
suffix:colon
id|GT64260_PCI_1_SLAVE_BAR_REG_ENABLES
suffix:semicolon
multiline_comment|/* Note: &squot;0&squot; enables, &squot;1&squot; disables */
id|val
op_assign
id|gt_read
c_func
(paren
id|reg
)paren
suffix:semicolon
id|val
op_or_assign
l_int|0xffffffff
suffix:semicolon
multiline_comment|/* Disable everything by default */
id|val
op_and_assign
op_complement
id|enable_bits
suffix:semicolon
id|gt_write
c_func
(paren
id|reg
comma
id|val
)paren
suffix:semicolon
id|gt_read
c_func
(paren
id|reg
)paren
suffix:semicolon
multiline_comment|/* Flush FIFO */
id|rc
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_pci_bar_enable() */
r_static
r_int
DECL|function|gt64260_pci_slave_set_window
id|gt64260_pci_slave_set_window
c_func
(paren
r_struct
id|pci_controller
op_star
id|hose
comma
id|u32
id|pci_base_addr
comma
id|u32
id|cpu_base_addr
comma
id|u32
id|bar_size
comma
id|u32
id|pci_cfg_fcn
comma
id|u32
id|pci_cfg_hdr_offset
comma
id|u32
id|bar_size_reg
comma
id|u32
id|remap_reg
)paren
(brace
id|u32
id|val
suffix:semicolon
r_int
id|devfn
suffix:semicolon
id|u8
id|save_exclude
suffix:semicolon
id|pci_base_addr
op_and_assign
l_int|0xfffff000
suffix:semicolon
id|cpu_base_addr
op_and_assign
l_int|0xfffff000
suffix:semicolon
id|bar_size
op_and_assign
l_int|0xfffff000
suffix:semicolon
id|devfn
op_assign
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
id|pci_cfg_fcn
)paren
suffix:semicolon
id|gt_write
c_func
(paren
id|bar_size_reg
comma
(paren
id|bar_size
op_minus
l_int|1
)paren
op_amp
l_int|0xfffff000
)paren
suffix:semicolon
id|gt_write
c_func
(paren
id|remap_reg
comma
id|cpu_base_addr
)paren
suffix:semicolon
id|gt_read
c_func
(paren
id|remap_reg
)paren
suffix:semicolon
multiline_comment|/* Flush FIFO */
id|save_exclude
op_assign
id|gt64260_pci_exclude_bridge
suffix:semicolon
id|gt64260_pci_exclude_bridge
op_assign
id|FALSE
suffix:semicolon
id|early_read_config_dword
c_func
(paren
id|hose
comma
id|hose-&gt;first_busno
comma
id|devfn
comma
id|pci_cfg_hdr_offset
comma
op_amp
id|val
)paren
suffix:semicolon
id|val
op_and_assign
l_int|0x0000000f
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|hose
comma
id|hose-&gt;first_busno
comma
id|devfn
comma
id|pci_cfg_hdr_offset
comma
id|pci_base_addr
op_or
id|val
)paren
suffix:semicolon
id|gt64260_pci_exclude_bridge
op_assign
id|save_exclude
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* gt64260_pci_slave_set_window() */
r_int
DECL|function|gt64260_pci_slave_scs_set_window
id|gt64260_pci_slave_scs_set_window
c_func
(paren
r_struct
id|pci_controller
op_star
id|hose
comma
id|u32
id|window
comma
id|u32
id|pci_base_addr
comma
id|u32
id|cpu_base_addr
comma
id|u32
id|size
)paren
(brace
r_static
id|u32
id|pci_scs_windows
(braket
id|GT64260_PCI_BUSES
)braket
(braket
id|GT64260_PCI_SCS_WINDOWS
)braket
(braket
l_int|4
)braket
op_assign
(brace
(brace
multiline_comment|/* PCI 0 */
(brace
l_int|0
comma
l_int|0x10
comma
id|GT64260_PCI_0_SLAVE_SCS_0_SIZE
comma
id|GT64260_PCI_0_SLAVE_SCS_0_REMAP
)brace
comma
(brace
l_int|0
comma
l_int|0x14
comma
id|GT64260_PCI_0_SLAVE_SCS_1_SIZE
comma
id|GT64260_PCI_0_SLAVE_SCS_1_REMAP
)brace
comma
(brace
l_int|0
comma
l_int|0x18
comma
id|GT64260_PCI_0_SLAVE_SCS_2_SIZE
comma
id|GT64260_PCI_0_SLAVE_SCS_2_REMAP
)brace
comma
(brace
l_int|0
comma
l_int|0x1c
comma
id|GT64260_PCI_0_SLAVE_SCS_3_SIZE
comma
id|GT64260_PCI_0_SLAVE_SCS_3_REMAP
)brace
comma
)brace
comma
(brace
multiline_comment|/* PCI 1 */
(brace
l_int|0
comma
l_int|0x10
comma
id|GT64260_PCI_1_SLAVE_SCS_0_SIZE
comma
id|GT64260_PCI_1_SLAVE_SCS_0_REMAP
)brace
comma
(brace
l_int|0
comma
l_int|0x14
comma
id|GT64260_PCI_1_SLAVE_SCS_1_SIZE
comma
id|GT64260_PCI_1_SLAVE_SCS_1_REMAP
)brace
comma
(brace
l_int|0
comma
l_int|0x18
comma
id|GT64260_PCI_1_SLAVE_SCS_2_SIZE
comma
id|GT64260_PCI_1_SLAVE_SCS_2_REMAP
)brace
comma
(brace
l_int|0
comma
l_int|0x1c
comma
id|GT64260_PCI_1_SLAVE_SCS_3_SIZE
comma
id|GT64260_PCI_1_SLAVE_SCS_3_REMAP
)brace
comma
)brace
)brace
suffix:semicolon
multiline_comment|/* pci_scs_windows[][][] */
r_int
id|pci_bus
suffix:semicolon
r_int
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|window
OL
id|GT64260_PCI_SCS_WINDOWS
)paren
(brace
id|pci_bus
op_assign
(paren
id|hose-&gt;first_busno
op_eq
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|rc
op_assign
id|gt64260_pci_slave_set_window
c_func
(paren
id|hose
comma
id|pci_base_addr
comma
id|cpu_base_addr
comma
id|size
comma
id|pci_scs_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|0
)braket
comma
id|pci_scs_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|1
)braket
comma
id|pci_scs_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|2
)braket
comma
id|pci_scs_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|3
)braket
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_pci_slave_scs_set_window() */
r_int
DECL|function|gt64260_pci_slave_cs_set_window
id|gt64260_pci_slave_cs_set_window
c_func
(paren
r_struct
id|pci_controller
op_star
id|hose
comma
id|u32
id|window
comma
id|u32
id|pci_base_addr
comma
id|u32
id|cpu_base_addr
comma
id|u32
id|size
)paren
(brace
r_static
id|u32
id|pci_cs_windows
(braket
id|GT64260_PCI_BUSES
)braket
(braket
id|GT64260_PCI_CS_WINDOWS
)braket
(braket
l_int|4
)braket
op_assign
(brace
(brace
multiline_comment|/* PCI 0 */
(brace
l_int|1
comma
l_int|0x10
comma
id|GT64260_PCI_0_SLAVE_CS_0_SIZE
comma
id|GT64260_PCI_0_SLAVE_CS_0_REMAP
)brace
comma
(brace
l_int|1
comma
l_int|0x14
comma
id|GT64260_PCI_0_SLAVE_CS_1_SIZE
comma
id|GT64260_PCI_0_SLAVE_CS_1_REMAP
)brace
comma
(brace
l_int|1
comma
l_int|0x18
comma
id|GT64260_PCI_0_SLAVE_CS_2_SIZE
comma
id|GT64260_PCI_0_SLAVE_CS_2_REMAP
)brace
comma
(brace
l_int|1
comma
l_int|0x1c
comma
id|GT64260_PCI_0_SLAVE_CS_3_SIZE
comma
id|GT64260_PCI_0_SLAVE_CS_3_REMAP
)brace
comma
)brace
comma
(brace
multiline_comment|/* PCI 1 */
(brace
l_int|1
comma
l_int|0x10
comma
id|GT64260_PCI_1_SLAVE_CS_0_SIZE
comma
id|GT64260_PCI_1_SLAVE_CS_0_REMAP
)brace
comma
(brace
l_int|1
comma
l_int|0x14
comma
id|GT64260_PCI_1_SLAVE_CS_1_SIZE
comma
id|GT64260_PCI_1_SLAVE_CS_1_REMAP
)brace
comma
(brace
l_int|1
comma
l_int|0x18
comma
id|GT64260_PCI_1_SLAVE_CS_2_SIZE
comma
id|GT64260_PCI_1_SLAVE_CS_2_REMAP
)brace
comma
(brace
l_int|1
comma
l_int|0x1c
comma
id|GT64260_PCI_1_SLAVE_CS_3_SIZE
comma
id|GT64260_PCI_1_SLAVE_CS_3_REMAP
)brace
comma
)brace
)brace
suffix:semicolon
multiline_comment|/* pci_cs_windows[][][] */
r_int
id|pci_bus
suffix:semicolon
r_int
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|window
OL
id|GT64260_PCI_CS_WINDOWS
)paren
(brace
id|pci_bus
op_assign
(paren
id|hose-&gt;first_busno
op_eq
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|rc
op_assign
id|gt64260_pci_slave_set_window
c_func
(paren
id|hose
comma
id|pci_base_addr
comma
id|cpu_base_addr
comma
id|size
comma
id|pci_cs_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|0
)braket
comma
id|pci_cs_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|1
)braket
comma
id|pci_cs_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|2
)braket
comma
id|pci_cs_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|3
)braket
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_pci_slave_cs_set_window() */
r_int
DECL|function|gt64260_pci_slave_boot_set_window
id|gt64260_pci_slave_boot_set_window
c_func
(paren
r_struct
id|pci_controller
op_star
id|hose
comma
id|u32
id|pci_base_addr
comma
id|u32
id|cpu_base_addr
comma
id|u32
id|size
)paren
(brace
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|gt64260_pci_slave_set_window
c_func
(paren
id|hose
comma
id|pci_base_addr
comma
id|cpu_base_addr
comma
id|size
comma
l_int|1
comma
l_int|0x20
comma
id|GT64260_PCI_1_SLAVE_BOOT_SIZE
comma
id|GT64260_PCI_1_SLAVE_BOOT_REMAP
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_pci_slave_boot_set_window() */
r_int
DECL|function|gt64260_pci_slave_p2p_mem_set_window
id|gt64260_pci_slave_p2p_mem_set_window
c_func
(paren
r_struct
id|pci_controller
op_star
id|hose
comma
id|u32
id|window
comma
id|u32
id|pci_base_addr
comma
id|u32
id|other_bus_base_addr
comma
id|u32
id|size
)paren
(brace
r_static
id|u32
id|pci_p2p_mem_windows
(braket
id|GT64260_PCI_BUSES
)braket
(braket
id|GT64260_PCI_P2P_MEM_WINDOWS
)braket
(braket
l_int|4
)braket
op_assign
initialization_block
suffix:semicolon
multiline_comment|/* pci_p2p_mem_windows[][][] */
r_int
id|pci_bus
suffix:semicolon
r_int
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|window
OL
id|GT64260_PCI_P2P_MEM_WINDOWS
)paren
(brace
id|pci_bus
op_assign
(paren
id|hose-&gt;first_busno
op_eq
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|rc
op_assign
id|gt64260_pci_slave_set_window
c_func
(paren
id|hose
comma
id|pci_base_addr
comma
id|other_bus_base_addr
comma
id|size
comma
id|pci_p2p_mem_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|0
)braket
comma
id|pci_p2p_mem_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|1
)braket
comma
id|pci_p2p_mem_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|2
)braket
comma
id|pci_p2p_mem_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|3
)braket
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_pci_slave_p2p_mem_set_window() */
r_int
DECL|function|gt64260_pci_slave_p2p_io_set_window
id|gt64260_pci_slave_p2p_io_set_window
c_func
(paren
r_struct
id|pci_controller
op_star
id|hose
comma
id|u32
id|pci_base_addr
comma
id|u32
id|other_bus_base_addr
comma
id|u32
id|size
)paren
(brace
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|gt64260_pci_slave_set_window
c_func
(paren
id|hose
comma
id|pci_base_addr
comma
id|other_bus_base_addr
comma
id|size
comma
l_int|2
comma
l_int|0x18
comma
id|GT64260_PCI_1_SLAVE_P2P_IO_SIZE
comma
id|GT64260_PCI_1_SLAVE_P2P_IO_REMAP
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_pci_slave_p2p_io_set_window() */
r_int
DECL|function|gt64260_pci_slave_dac_scs_set_window
id|gt64260_pci_slave_dac_scs_set_window
c_func
(paren
r_struct
id|pci_controller
op_star
id|hose
comma
id|u32
id|window
comma
id|u32
id|pci_base_addr_hi
comma
id|u32
id|pci_base_addr_lo
comma
id|u32
id|cpu_base_addr
comma
id|u32
id|size
)paren
(brace
r_static
id|u32
id|pci_dac_scs_windows
(braket
id|GT64260_PCI_BUSES
)braket
(braket
id|GT64260_PCI_DAC_SCS_WINDOWS
)braket
(braket
l_int|5
)braket
op_assign
initialization_block
suffix:semicolon
multiline_comment|/* pci_dac_scs_windows[][][] */
r_int
id|pci_bus
suffix:semicolon
r_int
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|window
OL
id|GT64260_PCI_DAC_SCS_WINDOWS
)paren
(brace
id|pci_bus
op_assign
(paren
id|hose-&gt;first_busno
op_eq
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|rc
op_assign
id|gt64260_pci_slave_set_window
c_func
(paren
id|hose
comma
id|pci_base_addr_lo
comma
id|cpu_base_addr
comma
id|size
comma
id|pci_dac_scs_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|0
)braket
comma
id|pci_dac_scs_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|1
)braket
comma
id|pci_dac_scs_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|3
)braket
comma
id|pci_dac_scs_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|hose
comma
id|hose-&gt;first_busno
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
id|pci_dac_scs_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|0
)braket
)paren
comma
id|pci_dac_scs_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|2
)braket
comma
id|pci_base_addr_hi
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_pci_slave_dac_scs_set_window() */
r_int
DECL|function|gt64260_pci_slave_dac_cs_set_window
id|gt64260_pci_slave_dac_cs_set_window
c_func
(paren
r_struct
id|pci_controller
op_star
id|hose
comma
id|u32
id|window
comma
id|u32
id|pci_base_addr_hi
comma
id|u32
id|pci_base_addr_lo
comma
id|u32
id|cpu_base_addr
comma
id|u32
id|size
)paren
(brace
r_static
id|u32
id|pci_dac_cs_windows
(braket
id|GT64260_PCI_BUSES
)braket
(braket
id|GT64260_PCI_DAC_CS_WINDOWS
)braket
(braket
l_int|5
)braket
op_assign
(brace
(brace
multiline_comment|/* PCI 0 */
(brace
l_int|6
comma
l_int|0x10
comma
l_int|0x14
comma
id|GT64260_PCI_0_SLAVE_DAC_CS_0_SIZE
comma
id|GT64260_PCI_0_SLAVE_DAC_CS_0_REMAP
)brace
comma
(brace
l_int|6
comma
l_int|0x18
comma
l_int|0x1c
comma
id|GT64260_PCI_0_SLAVE_DAC_CS_1_SIZE
comma
id|GT64260_PCI_0_SLAVE_DAC_CS_1_REMAP
)brace
comma
(brace
l_int|6
comma
l_int|0x20
comma
l_int|0x24
comma
id|GT64260_PCI_0_SLAVE_DAC_CS_2_SIZE
comma
id|GT64260_PCI_0_SLAVE_DAC_CS_2_REMAP
)brace
comma
(brace
l_int|7
comma
l_int|0x10
comma
l_int|0x14
comma
id|GT64260_PCI_0_SLAVE_DAC_CS_3_SIZE
comma
id|GT64260_PCI_0_SLAVE_DAC_CS_3_REMAP
)brace
comma
)brace
comma
(brace
multiline_comment|/* PCI 1 */
(brace
l_int|6
comma
l_int|0x10
comma
l_int|0x14
comma
id|GT64260_PCI_1_SLAVE_DAC_CS_0_SIZE
comma
id|GT64260_PCI_1_SLAVE_DAC_CS_0_REMAP
)brace
comma
(brace
l_int|6
comma
l_int|0x18
comma
l_int|0x1c
comma
id|GT64260_PCI_1_SLAVE_DAC_CS_1_SIZE
comma
id|GT64260_PCI_1_SLAVE_DAC_CS_1_REMAP
)brace
comma
(brace
l_int|6
comma
l_int|0x20
comma
l_int|0x24
comma
id|GT64260_PCI_1_SLAVE_DAC_CS_2_SIZE
comma
id|GT64260_PCI_1_SLAVE_DAC_CS_2_REMAP
)brace
comma
(brace
l_int|7
comma
l_int|0x10
comma
l_int|0x14
comma
id|GT64260_PCI_1_SLAVE_DAC_CS_3_SIZE
comma
id|GT64260_PCI_1_SLAVE_DAC_CS_3_REMAP
)brace
comma
)brace
)brace
suffix:semicolon
multiline_comment|/* pci_dac_cs_windows[][][] */
r_int
id|pci_bus
suffix:semicolon
r_int
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|window
OL
id|GT64260_PCI_CS_WINDOWS
)paren
(brace
id|pci_bus
op_assign
(paren
id|hose-&gt;first_busno
op_eq
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|rc
op_assign
id|gt64260_pci_slave_set_window
c_func
(paren
id|hose
comma
id|pci_base_addr_lo
comma
id|cpu_base_addr
comma
id|size
comma
id|pci_dac_cs_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|0
)braket
comma
id|pci_dac_cs_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|1
)braket
comma
id|pci_dac_cs_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|3
)braket
comma
id|pci_dac_cs_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|hose
comma
id|hose-&gt;first_busno
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
id|pci_dac_cs_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|0
)braket
)paren
comma
id|pci_dac_cs_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|2
)braket
comma
id|pci_base_addr_hi
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_pci_slave_dac_cs_set_window() */
r_int
DECL|function|gt64260_pci_slave_dac_boot_set_window
id|gt64260_pci_slave_dac_boot_set_window
c_func
(paren
r_struct
id|pci_controller
op_star
id|hose
comma
id|u32
id|pci_base_addr_hi
comma
id|u32
id|pci_base_addr_lo
comma
id|u32
id|cpu_base_addr
comma
id|u32
id|size
)paren
(brace
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|gt64260_pci_slave_set_window
c_func
(paren
id|hose
comma
id|pci_base_addr_lo
comma
id|cpu_base_addr
comma
id|size
comma
l_int|7
comma
l_int|0x18
comma
id|GT64260_PCI_1_SLAVE_BOOT_SIZE
comma
id|GT64260_PCI_1_SLAVE_BOOT_REMAP
)paren
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|hose
comma
id|hose-&gt;first_busno
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|7
)paren
comma
l_int|0x1c
comma
id|pci_base_addr_hi
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_pci_slave_dac_boot_set_window() */
r_int
DECL|function|gt64260_pci_slave_dac_p2p_mem_set_window
id|gt64260_pci_slave_dac_p2p_mem_set_window
c_func
(paren
r_struct
id|pci_controller
op_star
id|hose
comma
id|u32
id|window
comma
id|u32
id|pci_base_addr_hi
comma
id|u32
id|pci_base_addr_lo
comma
id|u32
id|other_bus_base_addr
comma
id|u32
id|size
)paren
(brace
r_static
id|u32
id|pci_dac_p2p_mem_windows
(braket
id|GT64260_PCI_BUSES
)braket
(braket
id|GT64260_PCI_DAC_P2P_MEM_WINDOWS
)braket
(braket
l_int|5
)braket
op_assign
(brace
(brace
multiline_comment|/* PCI 0 */
(brace
l_int|4
comma
l_int|0x20
comma
l_int|0x24
comma
id|GT64260_PCI_0_SLAVE_DAC_P2P_MEM_0_SIZE
comma
id|GT64260_PCI_0_SLAVE_DAC_P2P_MEM_0_REMAP_LO
)brace
comma
(brace
l_int|5
comma
l_int|0x20
comma
l_int|0x24
comma
id|GT64260_PCI_0_SLAVE_DAC_P2P_MEM_1_SIZE
comma
id|GT64260_PCI_0_SLAVE_DAC_P2P_MEM_1_REMAP_LO
)brace
comma
)brace
comma
(brace
multiline_comment|/* PCI 1 */
(brace
l_int|4
comma
l_int|0xa0
comma
l_int|0xa4
comma
id|GT64260_PCI_0_SLAVE_DAC_P2P_MEM_0_SIZE
comma
id|GT64260_PCI_0_SLAVE_DAC_P2P_MEM_0_REMAP_LO
)brace
comma
(brace
l_int|5
comma
l_int|0xa0
comma
l_int|0xa4
comma
id|GT64260_PCI_0_SLAVE_DAC_P2P_MEM_1_SIZE
comma
id|GT64260_PCI_0_SLAVE_DAC_P2P_MEM_1_REMAP_LO
)brace
comma
)brace
)brace
suffix:semicolon
multiline_comment|/* pci_dac_p2p_windows[][][] */
r_int
id|pci_bus
suffix:semicolon
r_int
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|window
OL
id|GT64260_PCI_P2P_MEM_WINDOWS
)paren
(brace
id|pci_bus
op_assign
(paren
id|hose-&gt;first_busno
op_eq
l_int|0
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
id|rc
op_assign
id|gt64260_pci_slave_set_window
c_func
(paren
id|hose
comma
id|pci_base_addr_lo
comma
id|other_bus_base_addr
comma
id|size
comma
id|pci_dac_p2p_mem_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|0
)braket
comma
id|pci_dac_p2p_mem_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|1
)braket
comma
id|pci_dac_p2p_mem_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|3
)braket
comma
id|pci_dac_p2p_mem_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|hose
comma
id|hose-&gt;first_busno
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
id|pci_dac_p2p_mem_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|0
)braket
)paren
comma
id|pci_dac_p2p_mem_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|2
)braket
comma
id|pci_base_addr_hi
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_pci_slave_dac_p2p_mem_set_window() */
multiline_comment|/*&n; *****************************************************************************&n; *&n; *&t;PCI Control Configuration Routines&n; *&n; *****************************************************************************&n; */
r_int
DECL|function|gt64260_pci_acc_cntl_set_window
id|gt64260_pci_acc_cntl_set_window
c_func
(paren
id|u32
id|pci_bus
comma
id|u32
id|window
comma
id|u32
id|base_addr_hi
comma
id|u32
id|base_addr_lo
comma
id|u32
id|size
comma
id|u32
id|features
)paren
(brace
r_static
id|u32
id|pci_acc_cntl_windows
(braket
id|GT64260_PCI_BUSES
)braket
(braket
id|GT64260_PCI_ACC_CNTL_WINDOWS
)braket
(braket
l_int|3
)braket
op_assign
(brace
(brace
multiline_comment|/* PCI 0 */
(brace
id|GT64260_PCI_0_ACC_CNTL_0_BASE_HI
comma
id|GT64260_PCI_0_ACC_CNTL_0_BASE_LO
comma
id|GT64260_PCI_0_ACC_CNTL_0_TOP
)brace
comma
(brace
id|GT64260_PCI_0_ACC_CNTL_1_BASE_HI
comma
id|GT64260_PCI_0_ACC_CNTL_1_BASE_LO
comma
id|GT64260_PCI_0_ACC_CNTL_1_TOP
)brace
comma
(brace
id|GT64260_PCI_0_ACC_CNTL_2_BASE_HI
comma
id|GT64260_PCI_0_ACC_CNTL_2_BASE_LO
comma
id|GT64260_PCI_0_ACC_CNTL_2_TOP
)brace
comma
(brace
id|GT64260_PCI_0_ACC_CNTL_3_BASE_HI
comma
id|GT64260_PCI_0_ACC_CNTL_3_BASE_LO
comma
id|GT64260_PCI_0_ACC_CNTL_3_TOP
)brace
comma
(brace
id|GT64260_PCI_0_ACC_CNTL_4_BASE_HI
comma
id|GT64260_PCI_0_ACC_CNTL_4_BASE_LO
comma
id|GT64260_PCI_0_ACC_CNTL_4_TOP
)brace
comma
(brace
id|GT64260_PCI_0_ACC_CNTL_5_BASE_HI
comma
id|GT64260_PCI_0_ACC_CNTL_5_BASE_LO
comma
id|GT64260_PCI_0_ACC_CNTL_5_TOP
)brace
comma
(brace
id|GT64260_PCI_0_ACC_CNTL_6_BASE_HI
comma
id|GT64260_PCI_0_ACC_CNTL_6_BASE_LO
comma
id|GT64260_PCI_0_ACC_CNTL_6_TOP
)brace
comma
(brace
id|GT64260_PCI_0_ACC_CNTL_7_BASE_HI
comma
id|GT64260_PCI_0_ACC_CNTL_7_BASE_LO
comma
id|GT64260_PCI_0_ACC_CNTL_7_TOP
)brace
comma
)brace
comma
(brace
multiline_comment|/* PCI 1 */
(brace
id|GT64260_PCI_1_ACC_CNTL_0_BASE_HI
comma
id|GT64260_PCI_1_ACC_CNTL_0_BASE_LO
comma
id|GT64260_PCI_1_ACC_CNTL_0_TOP
)brace
comma
(brace
id|GT64260_PCI_1_ACC_CNTL_1_BASE_HI
comma
id|GT64260_PCI_1_ACC_CNTL_1_BASE_LO
comma
id|GT64260_PCI_1_ACC_CNTL_1_TOP
)brace
comma
(brace
id|GT64260_PCI_1_ACC_CNTL_2_BASE_HI
comma
id|GT64260_PCI_1_ACC_CNTL_2_BASE_LO
comma
id|GT64260_PCI_1_ACC_CNTL_2_TOP
)brace
comma
(brace
id|GT64260_PCI_1_ACC_CNTL_3_BASE_HI
comma
id|GT64260_PCI_1_ACC_CNTL_3_BASE_LO
comma
id|GT64260_PCI_1_ACC_CNTL_3_TOP
)brace
comma
(brace
id|GT64260_PCI_1_ACC_CNTL_4_BASE_HI
comma
id|GT64260_PCI_1_ACC_CNTL_4_BASE_LO
comma
id|GT64260_PCI_1_ACC_CNTL_4_TOP
)brace
comma
(brace
id|GT64260_PCI_1_ACC_CNTL_5_BASE_HI
comma
id|GT64260_PCI_1_ACC_CNTL_5_BASE_LO
comma
id|GT64260_PCI_1_ACC_CNTL_5_TOP
)brace
comma
(brace
id|GT64260_PCI_1_ACC_CNTL_6_BASE_HI
comma
id|GT64260_PCI_1_ACC_CNTL_6_BASE_LO
comma
id|GT64260_PCI_1_ACC_CNTL_6_TOP
)brace
comma
(brace
id|GT64260_PCI_1_ACC_CNTL_7_BASE_HI
comma
id|GT64260_PCI_1_ACC_CNTL_7_BASE_LO
comma
id|GT64260_PCI_1_ACC_CNTL_7_TOP
)brace
comma
)brace
)brace
suffix:semicolon
multiline_comment|/* pci_acc_cntl_windows[][][] */
r_int
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pci_bus
OL
id|GT64260_PCI_BUSES
)paren
op_logical_and
(paren
id|window
OL
id|GT64260_PCI_ACC_CNTL_WINDOWS
)paren
)paren
(brace
id|rc
op_assign
id|gt64260_set_64bit_window
c_func
(paren
id|base_addr_hi
comma
id|base_addr_lo
comma
id|size
comma
id|features
comma
id|pci_acc_cntl_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|0
)braket
comma
id|pci_acc_cntl_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|1
)braket
comma
id|pci_acc_cntl_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|2
)braket
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_pci_acc_cntl_set_window() */
r_int
DECL|function|gt64260_pci_snoop_set_window
id|gt64260_pci_snoop_set_window
c_func
(paren
id|u32
id|pci_bus
comma
id|u32
id|window
comma
id|u32
id|base_addr_hi
comma
id|u32
id|base_addr_lo
comma
id|u32
id|size
comma
id|u32
id|snoop_type
)paren
(brace
r_static
id|u32
id|pci_snoop_windows
(braket
id|GT64260_PCI_BUSES
)braket
(braket
id|GT64260_PCI_SNOOP_WINDOWS
)braket
(braket
l_int|3
)braket
op_assign
(brace
(brace
multiline_comment|/* PCI 0 */
(brace
id|GT64260_PCI_0_SNOOP_0_BASE_HI
comma
id|GT64260_PCI_0_SNOOP_0_BASE_LO
comma
id|GT64260_PCI_0_SNOOP_0_TOP
)brace
comma
(brace
id|GT64260_PCI_0_SNOOP_1_BASE_HI
comma
id|GT64260_PCI_0_SNOOP_1_BASE_LO
comma
id|GT64260_PCI_0_SNOOP_1_TOP
)brace
comma
(brace
id|GT64260_PCI_0_SNOOP_2_BASE_HI
comma
id|GT64260_PCI_0_SNOOP_2_BASE_LO
comma
id|GT64260_PCI_0_SNOOP_2_TOP
)brace
comma
(brace
id|GT64260_PCI_0_SNOOP_3_BASE_HI
comma
id|GT64260_PCI_0_SNOOP_3_BASE_LO
comma
id|GT64260_PCI_0_SNOOP_3_TOP
)brace
comma
)brace
comma
(brace
multiline_comment|/* PCI 1 */
(brace
id|GT64260_PCI_1_SNOOP_0_BASE_HI
comma
id|GT64260_PCI_1_SNOOP_0_BASE_LO
comma
id|GT64260_PCI_1_SNOOP_0_TOP
)brace
comma
(brace
id|GT64260_PCI_1_SNOOP_1_BASE_HI
comma
id|GT64260_PCI_1_SNOOP_1_BASE_LO
comma
id|GT64260_PCI_1_SNOOP_1_TOP
)brace
comma
(brace
id|GT64260_PCI_1_SNOOP_2_BASE_HI
comma
id|GT64260_PCI_1_SNOOP_2_BASE_LO
comma
id|GT64260_PCI_1_SNOOP_2_TOP
)brace
comma
(brace
id|GT64260_PCI_1_SNOOP_3_BASE_HI
comma
id|GT64260_PCI_1_SNOOP_3_BASE_LO
comma
id|GT64260_PCI_1_SNOOP_3_TOP
)brace
comma
)brace
comma
)brace
suffix:semicolon
multiline_comment|/* pci_snoop_windows[][][] */
r_int
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pci_bus
OL
id|GT64260_PCI_BUSES
)paren
op_logical_and
(paren
id|window
OL
id|GT64260_PCI_SNOOP_WINDOWS
)paren
)paren
(brace
id|rc
op_assign
id|gt64260_set_64bit_window
c_func
(paren
id|base_addr_hi
comma
id|base_addr_lo
comma
id|size
comma
id|snoop_type
comma
id|pci_snoop_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|0
)braket
comma
id|pci_snoop_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|1
)braket
comma
id|pci_snoop_windows
(braket
id|pci_bus
)braket
(braket
id|window
)braket
(braket
l_int|2
)braket
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_pci_snoop_set_window() */
multiline_comment|/*&n; *****************************************************************************&n; *&n; *&t;64260&squot;s Register Base Address Routines&n; *&n; *****************************************************************************&n; */
multiline_comment|/*&n; * gt64260_remap_bridge_regs()&n; *&n; * Move the bridge&squot;s register to the specified base address.&n; * Assume that there are no other windows overlapping this area and that&n; * all but the highest 3 nibbles are 0.&n; */
r_int
DECL|function|gt64260_set_base
id|gt64260_set_base
c_func
(paren
id|u32
id|new_base
)paren
(brace
id|u32
id|val
suffix:semicolon
r_int
id|limit
op_assign
l_int|100000
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|val
op_assign
id|gt_read
c_func
(paren
id|GT64260_INTERNAL_SPACE_DECODE
)paren
suffix:semicolon
id|val
op_assign
(paren
id|new_base
op_rshift
l_int|20
)paren
op_or
(paren
id|val
op_amp
l_int|0xffff0000
)paren
suffix:semicolon
id|gt_write
c_func
(paren
id|GT64260_INTERNAL_SPACE_DECODE
comma
id|val
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|gt64260_base
)paren
suffix:semicolon
id|gt64260_base
op_assign
(paren
id|u32
)paren
id|ioremap
c_func
(paren
(paren
id|new_base
op_amp
l_int|0xfff00000
)paren
comma
id|GT64260_INTERNAL_SPACE_SIZE
)paren
suffix:semicolon
r_do
(brace
multiline_comment|/* Wait for bridge to move its regs */
id|val
op_assign
id|gt_read
c_func
(paren
id|GT64260_INTERNAL_SPACE_DECODE
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|val
op_ne
l_int|0xffffffff
)paren
op_logical_and
(paren
id|limit
op_decrement
OG
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|limit
op_le
l_int|0
)paren
(brace
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/* gt64260_remap_bridge_regs() */
multiline_comment|/*&n; * gt64260_get_base()&n; *&n; * Return the current virtual base address of the 64260&squot;s registers.&n; */
r_int
DECL|function|gt64260_get_base
id|gt64260_get_base
c_func
(paren
id|u32
op_star
id|base
)paren
(brace
op_star
id|base
op_assign
id|gt64260_base
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* gt64260_remap_bridge_regs() */
multiline_comment|/*&n; *****************************************************************************&n; *&n; *&t;Exclude PCI config space access to bridge itself&n; *&n; *****************************************************************************&n; */
multiline_comment|/*&n; * gt64260_exclude_pci_device()&n; *&n; * This routine causes the PCI subsystem to skip the PCI device in slot 0&n; * (which is the 64260 itself) unless explicitly allowed.&n; */
r_int
DECL|function|gt64260_pci_exclude_device
id|gt64260_pci_exclude_device
c_func
(paren
id|u8
id|bus
comma
id|u8
id|devfn
)paren
(brace
r_struct
id|pci_controller
op_star
id|hose
suffix:semicolon
id|hose
op_assign
id|pci_bus_to_hose
c_func
(paren
id|bus
)paren
suffix:semicolon
multiline_comment|/* Skip slot 0 and 1 on both hoses */
r_if
c_cond
(paren
(paren
id|gt64260_pci_exclude_bridge
op_eq
id|TRUE
)paren
op_logical_and
(paren
id|PCI_SLOT
c_func
(paren
id|devfn
)paren
op_eq
l_int|0
)paren
op_logical_and
(paren
id|hose-&gt;first_busno
op_eq
id|bus
)paren
)paren
(brace
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
)brace
r_else
(brace
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
)brace
multiline_comment|/* gt64260_pci_exclude_device() */
macro_line|#if defined(CONFIG_SERIAL_TEXT_DEBUG)
multiline_comment|/*&n; * gt64260_putc()&n; *&n; * Dump a character out the MPSC port for gt64260_mpsc_progress&n; * this assumes the baud rate has already been set up and the &n; * MPSC initialized by the bootloader or firmware.&n; */
r_static
r_inline
r_void
DECL|function|gt_putc
(def_block
id|gt_putc
c_func
(paren
r_char
id|c
)paren
(brace
id|mb
c_func
(paren
)paren
suffix:semicolon
id|gt_write
c_func
(paren
id|GT64260_MPSC_0_CHR_1
comma
id|c
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|gt_write
c_func
(paren
id|GT64260_MPSC_0_CHR_2
comma
l_int|0x200
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10000
)paren
suffix:semicolon
)brace
)def_block
r_void
DECL|function|puthex
(def_block
id|puthex
c_func
(paren
r_int
r_int
id|val
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|7
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|gt_putc
c_func
(paren
l_string|&quot;0123456789ABCDEF&quot;
(braket
(paren
id|val
op_rshift
l_int|28
)paren
op_amp
l_int|0x0f
)braket
)paren
suffix:semicolon
id|val
op_lshift_assign
l_int|4
suffix:semicolon
)brace
id|gt_putc
c_func
(paren
l_char|&squot;&bslash;r&squot;
)paren
suffix:semicolon
id|gt_putc
c_func
(paren
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
)brace
)def_block
r_void
DECL|function|gt64260_mpsc_progress
(def_block
id|gt64260_mpsc_progress
c_func
(paren
r_char
op_star
id|s
comma
r_int
r_int
id|hex
)paren
(brace
multiline_comment|/* spit stuff out the 64260 mpsc */
r_volatile
r_char
id|c
suffix:semicolon
r_while
c_loop
(paren
(paren
id|c
op_assign
op_star
id|s
op_increment
)paren
op_ne
l_int|0
)paren
(brace
id|gt_putc
c_func
(paren
id|c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;&bslash;n&squot;
)paren
id|gt_putc
c_func
(paren
l_char|&squot;&bslash;r&squot;
)paren
suffix:semicolon
)brace
id|gt_putc
c_func
(paren
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
id|gt_putc
c_func
(paren
l_char|&squot;&bslash;r&squot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)def_block
macro_line|#endif /* CONFIG_DEBUG_TEXT */
eof
