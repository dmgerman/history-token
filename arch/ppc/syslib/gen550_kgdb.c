multiline_comment|/*&n; * arch/ppc/syslib/gen550_kgdb.c&n; *&n; * Generic 16550 kgdb support intended to be useful on a variety&n; * of platforms.  To enable this support, it is necessary to set&n; * the CONFIG_GEN550 option.  Any virtual mapping of the serial&n; * port(s) to be used can be accomplished by setting&n; * ppc_md.early_serial_map to a platform-specific mapping function.&n; *&n; * Adapted from ppc4xx_kgdb.c. &n; *&n; * Author: Matt Porter &lt;mporter@mvista.com&gt;&n; *&n; * 2002-2003 (c) MontaVista Software, Inc.  This file is licensed under&n; * the terms of the GNU General Public License version 2.  This program&n; * is licensed &quot;as is&quot; without any warranty of any kind, whether express&n; * or implied.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;asm/machdep.h&gt;
r_extern
r_int
r_int
id|serial_init
c_func
(paren
r_int
comma
r_void
op_star
)paren
suffix:semicolon
r_extern
r_int
r_int
id|serial_getc
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
r_extern
r_int
r_int
id|serial_putc
c_func
(paren
r_int
r_int
comma
r_int
r_char
)paren
suffix:semicolon
macro_line|#if defined(CONFIG_KGDB_TTYS0)
DECL|macro|KGDB_PORT
mdefine_line|#define KGDB_PORT 0
macro_line|#elif defined(CONFIG_KGDB_TTYS1)
DECL|macro|KGDB_PORT
mdefine_line|#define KGDB_PORT 1
macro_line|#elif defined(CONFIG_KGDB_TTYS2)
DECL|macro|KGDB_PORT
mdefine_line|#define KGDB_PORT 2
macro_line|#elif defined(CONFIG_KGDB_TTYS3)
DECL|macro|KGDB_PORT
mdefine_line|#define KGDB_PORT 3
macro_line|#else
macro_line|#error &quot;invalid kgdb_tty port&quot;
macro_line|#endif
DECL|variable|kgdb_debugport
r_static
r_volatile
r_int
r_int
id|kgdb_debugport
suffix:semicolon
DECL|function|putDebugChar
r_void
id|putDebugChar
c_func
(paren
r_int
r_char
id|c
)paren
(brace
r_if
c_cond
(paren
id|kgdb_debugport
op_eq
l_int|0
)paren
id|kgdb_debugport
op_assign
id|serial_init
c_func
(paren
id|KGDB_PORT
comma
l_int|NULL
)paren
suffix:semicolon
id|serial_putc
c_func
(paren
id|kgdb_debugport
comma
id|c
)paren
suffix:semicolon
)brace
DECL|function|getDebugChar
r_int
id|getDebugChar
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|kgdb_debugport
op_eq
l_int|0
)paren
id|kgdb_debugport
op_assign
id|serial_init
c_func
(paren
id|KGDB_PORT
comma
l_int|NULL
)paren
suffix:semicolon
r_return
id|serial_getc
c_func
(paren
id|kgdb_debugport
)paren
suffix:semicolon
)brace
DECL|function|kgdb_interruptible
r_void
id|kgdb_interruptible
c_func
(paren
r_int
id|enable
)paren
(brace
r_return
suffix:semicolon
)brace
DECL|function|putDebugString
r_void
id|putDebugString
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_while
c_loop
(paren
op_star
id|str
op_ne
l_char|&squot;&bslash;0&squot;
)paren
(brace
id|putDebugChar
c_func
(paren
op_star
id|str
)paren
suffix:semicolon
id|str
op_increment
suffix:semicolon
)brace
id|putDebugChar
c_func
(paren
l_char|&squot;&bslash;r&squot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * Note: gen550_init() must be called already on the port we are going&n; * to use.&n; */
r_void
DECL|function|kgdb_map_scc
id|kgdb_map_scc
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;kgdb init&bslash;n&quot;
)paren
suffix:semicolon
id|kgdb_debugport
op_assign
id|serial_init
c_func
(paren
id|KGDB_PORT
comma
l_int|NULL
)paren
suffix:semicolon
)brace
eof
