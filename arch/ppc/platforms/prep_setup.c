multiline_comment|/*&n; *  arch/ppc/platforms/setup.c&n; *&n; *  Copyright (C) 1995  Linus Torvalds&n; *  Adapted from &squot;alpha&squot; version by Gary Thomas&n; *  Modified by Cort Dougan (cort@cs.nmt.edu)&n; *&n; * Support for PReP (Motorola MTX/MVME)&n; * by Troy Benjegerdes (hozer@drgw.net)&n; */
multiline_comment|/*&n; * bootup setup stuff..&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/stddef.h&gt;
macro_line|#include &lt;linux/unistd.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/user.h&gt;
macro_line|#include &lt;linux/a.out.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/reboot.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/initrd.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/timex.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/ide.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &lt;linux/root_dev.h&gt;
macro_line|#include &lt;asm/sections.h&gt;
macro_line|#include &lt;asm/mmu.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/residual.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/cache.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;asm/machdep.h&gt;
macro_line|#include &lt;asm/mc146818rtc.h&gt;
macro_line|#include &lt;asm/mk48t59.h&gt;
macro_line|#include &lt;asm/prep_nvram.h&gt;
macro_line|#include &lt;asm/raven.h&gt;
macro_line|#include &lt;asm/vga.h&gt;
macro_line|#include &lt;asm/time.h&gt;
macro_line|#include &lt;asm/mpc10x.h&gt;
macro_line|#include &lt;asm/i8259.h&gt;
macro_line|#include &lt;asm/open_pic.h&gt;
macro_line|#include &lt;asm/pci-bridge.h&gt;
macro_line|#include &lt;asm/todc.h&gt;
id|TODC_ALLOC
c_func
(paren
)paren
suffix:semicolon
DECL|variable|ucSystemType
r_int
r_char
id|ucSystemType
suffix:semicolon
DECL|variable|ucBoardRev
r_int
r_char
id|ucBoardRev
suffix:semicolon
DECL|variable|ucBoardRevMaj
DECL|variable|ucBoardRevMin
r_int
r_char
id|ucBoardRevMaj
comma
id|ucBoardRevMin
suffix:semicolon
r_extern
r_int
r_char
id|prep_nvram_read_val
c_func
(paren
r_int
id|addr
)paren
suffix:semicolon
r_extern
r_void
id|prep_nvram_write_val
c_func
(paren
r_int
id|addr
comma
r_int
r_char
id|val
)paren
suffix:semicolon
r_extern
r_int
r_char
id|rs_nvram_read_val
c_func
(paren
r_int
id|addr
)paren
suffix:semicolon
r_extern
r_void
id|rs_nvram_write_val
c_func
(paren
r_int
id|addr
comma
r_int
r_char
id|val
)paren
suffix:semicolon
r_extern
r_void
id|ibm_prep_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|prep_find_bridges
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|variable|_prep_type
r_int
id|_prep_type
suffix:semicolon
r_extern
r_void
id|prep_residual_setup_pci
c_func
(paren
r_char
op_star
id|irq_edge_mask_lo
comma
r_char
op_star
id|irq_edge_mask_hi
)paren
suffix:semicolon
r_extern
r_void
id|prep_sandalfoot_setup_pci
c_func
(paren
r_char
op_star
id|irq_edge_mask_lo
comma
r_char
op_star
id|irq_edge_mask_hi
)paren
suffix:semicolon
r_extern
r_void
id|prep_thinkpad_setup_pci
c_func
(paren
r_char
op_star
id|irq_edge_mask_lo
comma
r_char
op_star
id|irq_edge_mask_hi
)paren
suffix:semicolon
r_extern
r_void
id|prep_carolina_setup_pci
c_func
(paren
r_char
op_star
id|irq_edge_mask_lo
comma
r_char
op_star
id|irq_edge_mask_hi
)paren
suffix:semicolon
r_extern
r_void
id|prep_tiger1_setup_pci
c_func
(paren
r_char
op_star
id|irq_edge_mask_lo
comma
r_char
op_star
id|irq_edge_mask_hi
)paren
suffix:semicolon
DECL|macro|cached_21
mdefine_line|#define cached_21&t;(((char *)(ppc_cached_irq_mask))[3])
DECL|macro|cached_A1
mdefine_line|#define cached_A1&t;(((char *)(ppc_cached_irq_mask))[2])
multiline_comment|/* for the mac fs */
DECL|variable|boot_dev
id|dev_t
id|boot_dev
suffix:semicolon
macro_line|#ifdef CONFIG_SOUND_CS4232
DECL|variable|ppc_cs4232_dma
DECL|variable|ppc_cs4232_dma2
r_int
id|ppc_cs4232_dma
comma
id|ppc_cs4232_dma2
suffix:semicolon
macro_line|#endif
r_extern
id|PTE
op_star
id|Hash
comma
op_star
id|Hash_end
suffix:semicolon
r_extern
r_int
r_int
id|Hash_size
comma
id|Hash_mask
suffix:semicolon
r_extern
r_int
id|probingmem
suffix:semicolon
r_extern
r_int
r_int
id|loops_per_jiffy
suffix:semicolon
macro_line|#ifdef CONFIG_SOUND_CS4232
DECL|variable|ppc_cs4232_dma
id|EXPORT_SYMBOL
c_func
(paren
id|ppc_cs4232_dma
)paren
suffix:semicolon
DECL|variable|ppc_cs4232_dma2
id|EXPORT_SYMBOL
c_func
(paren
id|ppc_cs4232_dma2
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* useful ISA ports */
DECL|macro|PREP_SYSCTL
mdefine_line|#define PREP_SYSCTL&t;0x81c
multiline_comment|/* present in the IBM reference design; possibly identical in Mot boxes: */
DECL|macro|PREP_IBM_SIMM_ID
mdefine_line|#define PREP_IBM_SIMM_ID&t;0x803&t;/* SIMM size: 32 or 8 MiB */
DECL|macro|PREP_IBM_SIMM_PRESENCE
mdefine_line|#define PREP_IBM_SIMM_PRESENCE&t;0x804
DECL|macro|PREP_IBM_EQUIPMENT
mdefine_line|#define PREP_IBM_EQUIPMENT&t;0x80c
DECL|macro|PREP_IBM_L2INFO
mdefine_line|#define PREP_IBM_L2INFO&t;0x80d
DECL|macro|PREP_IBM_PM1
mdefine_line|#define PREP_IBM_PM1&t;0x82a&t;/* power management register 1 */
DECL|macro|PREP_IBM_PLANAR
mdefine_line|#define PREP_IBM_PLANAR&t;0x852&t;/* planar ID - identifies the motherboard */
DECL|macro|PREP_IBM_DISP
mdefine_line|#define PREP_IBM_DISP&t;0x8c0&t;/* 4-digit LED display */
multiline_comment|/* Equipment Present Register masks: */
DECL|macro|PREP_IBM_EQUIPMENT_RESERVED
mdefine_line|#define PREP_IBM_EQUIPMENT_RESERVED&t;0x80
DECL|macro|PREP_IBM_EQUIPMENT_SCSIFUSE
mdefine_line|#define PREP_IBM_EQUIPMENT_SCSIFUSE&t;0x40
DECL|macro|PREP_IBM_EQUIPMENT_L2_COPYBACK
mdefine_line|#define PREP_IBM_EQUIPMENT_L2_COPYBACK&t;0x08
DECL|macro|PREP_IBM_EQUIPMENT_L2_256
mdefine_line|#define PREP_IBM_EQUIPMENT_L2_256&t;0x04
DECL|macro|PREP_IBM_EQUIPMENT_CPU
mdefine_line|#define PREP_IBM_EQUIPMENT_CPU&t;0x02
DECL|macro|PREP_IBM_EQUIPMENT_L2
mdefine_line|#define PREP_IBM_EQUIPMENT_L2&t;0x01
multiline_comment|/* planar ID values: */
multiline_comment|/* Sandalfoot/Sandalbow (6015/7020) */
DECL|macro|PREP_IBM_SANDALFOOT
mdefine_line|#define PREP_IBM_SANDALFOOT&t;0xfc
multiline_comment|/* Woodfield, Thinkpad 850/860 (6042/7249) */
DECL|macro|PREP_IBM_THINKPAD
mdefine_line|#define PREP_IBM_THINKPAD&t;0xff /* planar ID unimplemented */
multiline_comment|/* PowerSeries 830/850 (6050/6070) */
DECL|macro|PREP_IBM_CAROLINA_IDE_0
mdefine_line|#define PREP_IBM_CAROLINA_IDE_0&t;0xf0
DECL|macro|PREP_IBM_CAROLINA_IDE_1
mdefine_line|#define PREP_IBM_CAROLINA_IDE_1&t;0xf1
DECL|macro|PREP_IBM_CAROLINA_IDE_2
mdefine_line|#define PREP_IBM_CAROLINA_IDE_2&t;0xf2
DECL|macro|PREP_IBM_CAROLINA_IDE_3
mdefine_line|#define PREP_IBM_CAROLINA_IDE_3&t;0xf3
multiline_comment|/* 7248-43P */
DECL|macro|PREP_IBM_CAROLINA_SCSI_0
mdefine_line|#define PREP_IBM_CAROLINA_SCSI_0&t;0xf4
DECL|macro|PREP_IBM_CAROLINA_SCSI_1
mdefine_line|#define PREP_IBM_CAROLINA_SCSI_1&t;0xf5
DECL|macro|PREP_IBM_CAROLINA_SCSI_2
mdefine_line|#define PREP_IBM_CAROLINA_SCSI_2&t;0xf6
DECL|macro|PREP_IBM_CAROLINA_SCSI_3
mdefine_line|#define PREP_IBM_CAROLINA_SCSI_3&t;0xf7 /* missing from Carolina Tech Spec */
multiline_comment|/* Tiger1 (7043-140) */
DECL|macro|PREP_IBM_TIGER1_133
mdefine_line|#define PREP_IBM_TIGER1_133&t;&t;0xd1
DECL|macro|PREP_IBM_TIGER1_166
mdefine_line|#define PREP_IBM_TIGER1_166&t;&t;0xd2
DECL|macro|PREP_IBM_TIGER1_180
mdefine_line|#define PREP_IBM_TIGER1_180&t;&t;0xd3
DECL|macro|PREP_IBM_TIGER1_xxx
mdefine_line|#define PREP_IBM_TIGER1_xxx&t;&t;0xd4 /* unknown, but probably exists */
DECL|macro|PREP_IBM_TIGER1_333
mdefine_line|#define PREP_IBM_TIGER1_333&t;&t;0xd5 /* missing from Tiger Tech Spec */
multiline_comment|/* setup_ibm_pci:&n; * &t;set Motherboard_map_name, Motherboard_map, Motherboard_routes.&n; * &t;return 8259 edge/level masks.&n; */
DECL|variable|setup_ibm_pci
r_void
(paren
op_star
id|setup_ibm_pci
)paren
(paren
r_char
op_star
id|irq_lo
comma
r_char
op_star
id|irq_hi
)paren
suffix:semicolon
r_extern
r_char
op_star
id|Motherboard_map_name
suffix:semicolon
multiline_comment|/* for use in *_cpuinfo */
multiline_comment|/*&n; * As found in the PReP reference implementation.&n; * Used by Thinkpad, Sandalfoot (6015/7020), and all Motorola PReP.&n; */
r_static
r_void
id|__init
DECL|function|prep_gen_enable_l2
id|prep_gen_enable_l2
c_func
(paren
r_void
)paren
(brace
id|outb
c_func
(paren
id|inb
c_func
(paren
id|PREP_SYSCTL
)paren
op_or
l_int|0x3
comma
id|PREP_SYSCTL
)paren
suffix:semicolon
)brace
multiline_comment|/* Used by Carolina and Tiger1 */
r_static
r_void
id|__init
DECL|function|prep_carolina_enable_l2
id|prep_carolina_enable_l2
c_func
(paren
r_void
)paren
(brace
id|outb
c_func
(paren
id|inb
c_func
(paren
id|PREP_SYSCTL
)paren
op_or
l_int|0xc0
comma
id|PREP_SYSCTL
)paren
suffix:semicolon
)brace
multiline_comment|/* cpuinfo code common to all IBM PReP */
r_static
r_void
id|__prep
DECL|function|prep_ibm_cpuinfo
id|prep_ibm_cpuinfo
c_func
(paren
r_struct
id|seq_file
op_star
id|m
)paren
(brace
r_int
r_int
id|equip_reg
op_assign
id|inb
c_func
(paren
id|PREP_IBM_EQUIPMENT
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;machine&bslash;t&bslash;t: PReP %s&bslash;n&quot;
comma
id|Motherboard_map_name
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;upgrade cpu&bslash;t: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|equip_reg
op_amp
id|PREP_IBM_EQUIPMENT_CPU
)paren
(brace
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;not &quot;
)paren
suffix:semicolon
)brace
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;present&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* print info about the SCSI fuse */
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;scsi fuse&bslash;t: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|equip_reg
op_amp
id|PREP_IBM_EQUIPMENT_SCSIFUSE
)paren
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;ok&quot;
)paren
suffix:semicolon
r_else
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;bad&quot;
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* print info about SIMMs */
r_if
c_cond
(paren
id|have_residual_data
)paren
(brace
r_int
id|i
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;simms&bslash;t&bslash;t: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|res-&gt;ActualNumMemories
)paren
op_logical_and
(paren
id|i
OL
id|MAX_MEMS
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|res-&gt;Memories
(braket
id|i
)braket
dot
id|SIMMSize
op_ne
l_int|0
)paren
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;%d:%ldMiB &quot;
comma
id|i
comma
(paren
id|res-&gt;Memories
(braket
id|i
)braket
dot
id|SIMMSize
OG
l_int|1024
)paren
ques
c_cond
id|res-&gt;Memories
(braket
id|i
)braket
dot
id|SIMMSize
op_rshift
l_int|20
suffix:colon
id|res-&gt;Memories
(braket
id|i
)braket
dot
id|SIMMSize
)paren
suffix:semicolon
)brace
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_static
r_int
id|__prep
DECL|function|prep_gen_cpuinfo
id|prep_gen_cpuinfo
c_func
(paren
r_struct
id|seq_file
op_star
id|m
)paren
(brace
id|prep_ibm_cpuinfo
c_func
(paren
id|m
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|__prep
DECL|function|prep_sandalfoot_cpuinfo
id|prep_sandalfoot_cpuinfo
c_func
(paren
r_struct
id|seq_file
op_star
id|m
)paren
(brace
r_int
r_int
id|equip_reg
op_assign
id|inb
c_func
(paren
id|PREP_IBM_EQUIPMENT
)paren
suffix:semicolon
id|prep_ibm_cpuinfo
c_func
(paren
id|m
)paren
suffix:semicolon
multiline_comment|/* report amount and type of L2 cache present */
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;L2 cache&bslash;t: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|equip_reg
op_amp
id|PREP_IBM_EQUIPMENT_L2
)paren
(brace
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;not present&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|equip_reg
op_amp
id|PREP_IBM_EQUIPMENT_L2_256
)paren
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;256KiB&quot;
)paren
suffix:semicolon
r_else
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;unknown size&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|equip_reg
op_amp
id|PREP_IBM_EQUIPMENT_L2_COPYBACK
)paren
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;, copy-back&quot;
)paren
suffix:semicolon
r_else
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;, write-through&quot;
)paren
suffix:semicolon
)brace
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|__prep
DECL|function|prep_thinkpad_cpuinfo
id|prep_thinkpad_cpuinfo
c_func
(paren
r_struct
id|seq_file
op_star
id|m
)paren
(brace
r_int
r_int
id|equip_reg
op_assign
id|inb
c_func
(paren
id|PREP_IBM_EQUIPMENT
)paren
suffix:semicolon
r_char
op_star
id|cpubus_speed
comma
op_star
id|pci_speed
suffix:semicolon
id|prep_ibm_cpuinfo
c_func
(paren
id|m
)paren
suffix:semicolon
multiline_comment|/* report amount and type of L2 cache present */
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;l2 cache&bslash;t: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|equip_reg
op_amp
l_int|0x1
)paren
op_eq
l_int|0
)paren
(brace
r_switch
c_cond
(paren
(paren
id|equip_reg
op_amp
l_int|0xc
)paren
op_rshift
l_int|2
)paren
(brace
r_case
l_int|0x0
suffix:colon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;128KiB look-aside 2-way write-through&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x1
suffix:colon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;512KiB look-aside direct-mapped write-back&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x2
suffix:colon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;256KiB look-aside 2-way write-through&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3
suffix:colon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;256KiB look-aside direct-mapped write-back&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;not present&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* report bus speeds because we can */
r_if
c_cond
(paren
(paren
id|equip_reg
op_amp
l_int|0x80
)paren
op_eq
l_int|0
)paren
(brace
r_switch
c_cond
(paren
(paren
id|equip_reg
op_amp
l_int|0x30
)paren
op_rshift
l_int|4
)paren
(brace
r_case
l_int|0x1
suffix:colon
id|cpubus_speed
op_assign
l_string|&quot;50&quot;
suffix:semicolon
id|pci_speed
op_assign
l_string|&quot;25&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3
suffix:colon
id|cpubus_speed
op_assign
l_string|&quot;66&quot;
suffix:semicolon
id|pci_speed
op_assign
l_string|&quot;33&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|cpubus_speed
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
id|pci_speed
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
(brace
r_switch
c_cond
(paren
(paren
id|equip_reg
op_amp
l_int|0x30
)paren
op_rshift
l_int|4
)paren
(brace
r_case
l_int|0x1
suffix:colon
id|cpubus_speed
op_assign
l_string|&quot;25&quot;
suffix:semicolon
id|pci_speed
op_assign
l_string|&quot;25&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x2
suffix:colon
id|cpubus_speed
op_assign
l_string|&quot;60&quot;
suffix:semicolon
id|pci_speed
op_assign
l_string|&quot;30&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x3
suffix:colon
id|cpubus_speed
op_assign
l_string|&quot;33&quot;
suffix:semicolon
id|pci_speed
op_assign
l_string|&quot;33&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|cpubus_speed
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
id|pci_speed
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;60x bus&bslash;t&bslash;t: %sMHz&bslash;n&quot;
comma
id|cpubus_speed
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;pci bus&bslash;t&bslash;t: %sMHz&bslash;n&quot;
comma
id|pci_speed
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|__prep
DECL|function|prep_carolina_cpuinfo
id|prep_carolina_cpuinfo
c_func
(paren
r_struct
id|seq_file
op_star
id|m
)paren
(brace
r_int
r_int
id|equip_reg
op_assign
id|inb
c_func
(paren
id|PREP_IBM_EQUIPMENT
)paren
suffix:semicolon
id|prep_ibm_cpuinfo
c_func
(paren
id|m
)paren
suffix:semicolon
multiline_comment|/* report amount and type of L2 cache present */
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;l2 cache&bslash;t: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|equip_reg
op_amp
l_int|0x1
)paren
op_eq
l_int|0
)paren
(brace
r_int
r_int
id|l2_reg
op_assign
id|inb
c_func
(paren
id|PREP_IBM_L2INFO
)paren
suffix:semicolon
multiline_comment|/* L2 size */
r_if
c_cond
(paren
(paren
id|l2_reg
op_amp
l_int|0x60
)paren
op_eq
l_int|0
)paren
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;256KiB&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|l2_reg
op_amp
l_int|0x60
)paren
op_eq
l_int|0x20
)paren
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;512KiB&quot;
)paren
suffix:semicolon
r_else
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;unknown size&quot;
)paren
suffix:semicolon
multiline_comment|/* L2 type */
r_if
c_cond
(paren
(paren
id|l2_reg
op_amp
l_int|0x3
)paren
op_eq
l_int|0
)paren
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;, async&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
(paren
id|l2_reg
op_amp
l_int|0x3
)paren
op_eq
l_int|1
)paren
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;, sync&quot;
)paren
suffix:semicolon
r_else
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;, unknown type&quot;
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;not present&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|__prep
DECL|function|prep_tiger1_cpuinfo
id|prep_tiger1_cpuinfo
c_func
(paren
r_struct
id|seq_file
op_star
id|m
)paren
(brace
r_int
r_int
id|l2_reg
op_assign
id|inb
c_func
(paren
id|PREP_IBM_L2INFO
)paren
suffix:semicolon
id|prep_ibm_cpuinfo
c_func
(paren
id|m
)paren
suffix:semicolon
multiline_comment|/* report amount and type of L2 cache present */
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;l2 cache&bslash;t: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|l2_reg
op_amp
l_int|0xf
)paren
op_eq
l_int|0xf
)paren
(brace
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;not present&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|l2_reg
op_amp
l_int|0x8
)paren
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;async, &quot;
)paren
suffix:semicolon
r_else
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;sync burst, &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|l2_reg
op_amp
l_int|0x4
)paren
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;parity, &quot;
)paren
suffix:semicolon
r_else
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;no parity, &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|l2_reg
op_amp
l_int|0x3
)paren
(brace
r_case
l_int|0x0
suffix:colon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;256KiB&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x1
suffix:colon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;512KiB&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x2
suffix:colon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;1MiB&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;unknown size&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Used by all Motorola PReP */
r_static
r_int
id|__prep
DECL|function|prep_mot_cpuinfo
id|prep_mot_cpuinfo
c_func
(paren
r_struct
id|seq_file
op_star
id|m
)paren
(brace
r_int
r_int
id|cachew
op_assign
op_star
(paren
(paren
r_int
r_char
op_star
)paren
id|CACHECRBA
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;machine&bslash;t&bslash;t: PReP %s&bslash;n&quot;
comma
id|Motherboard_map_name
)paren
suffix:semicolon
multiline_comment|/* report amount and type of L2 cache present */
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;l2 cache&bslash;t: &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|cachew
op_amp
id|L2CACHE_MASK
)paren
(brace
r_case
id|L2CACHE_512KB
suffix:colon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;512KiB&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L2CACHE_256KB
suffix:colon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;256KiB&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L2CACHE_1MB
suffix:colon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;1MiB&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L2CACHE_NONE
suffix:colon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;none&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|no_l2
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;%x&bslash;n&quot;
comma
id|cachew
)paren
suffix:semicolon
)brace
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;, parity %s&quot;
comma
(paren
id|cachew
op_amp
id|L2CACHE_PARITY
)paren
ques
c_cond
l_string|&quot;enabled&quot;
suffix:colon
l_string|&quot;disabled&quot;
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot; SRAM:&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
(paren
id|cachew
op_amp
l_int|0xf0
)paren
op_rshift
l_int|4
)paren
op_amp
op_complement
(paren
l_int|0x3
)paren
)paren
(brace
r_case
l_int|1
suffix:colon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;synchronous, parity, flow-through&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;asynchronous, no parity&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;asynchronous, parity&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;synchronous, pipelined, no parity&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|no_l2
suffix:colon
multiline_comment|/* print info about SIMMs */
r_if
c_cond
(paren
id|have_residual_data
)paren
(brace
r_int
id|i
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;simms&bslash;t&bslash;t: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|res-&gt;ActualNumMemories
)paren
op_logical_and
(paren
id|i
OL
id|MAX_MEMS
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|res-&gt;Memories
(braket
id|i
)braket
dot
id|SIMMSize
op_ne
l_int|0
)paren
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;%d:%ldM &quot;
comma
id|i
comma
(paren
id|res-&gt;Memories
(braket
id|i
)braket
dot
id|SIMMSize
OG
l_int|1024
)paren
ques
c_cond
id|res-&gt;Memories
(braket
id|i
)braket
dot
id|SIMMSize
op_rshift
l_int|20
suffix:colon
id|res-&gt;Memories
(braket
id|i
)braket
dot
id|SIMMSize
)paren
suffix:semicolon
)brace
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
id|__prep
DECL|function|prep_restart
id|prep_restart
c_func
(paren
r_char
op_star
id|cmd
)paren
(brace
DECL|macro|PREP_SP92
mdefine_line|#define PREP_SP92&t;0x92&t;/* Special Port 92 */
id|local_irq_disable
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* no interrupts */
multiline_comment|/* set exception prefix high - to the prom */
id|_nmask_and_or_msr
c_func
(paren
l_int|0
comma
id|MSR_IP
)paren
suffix:semicolon
multiline_comment|/* make sure bit 0 (reset) is a 0 */
id|outb
c_func
(paren
id|inb
c_func
(paren
id|PREP_SP92
)paren
op_amp
op_complement
l_int|1L
comma
id|PREP_SP92
)paren
suffix:semicolon
multiline_comment|/* signal a reset to system control port A - soft reset */
id|outb
c_func
(paren
id|inb
c_func
(paren
id|PREP_SP92
)paren
op_or
l_int|1
comma
id|PREP_SP92
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* not reached */
DECL|macro|PREP_SP92
macro_line|#undef PREP_SP92
)brace
r_static
r_void
id|__prep
DECL|function|prep_halt
id|prep_halt
c_func
(paren
r_void
)paren
(brace
id|local_irq_disable
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* no interrupts */
multiline_comment|/* set exception prefix high - to the prom */
id|_nmask_and_or_msr
c_func
(paren
l_int|0
comma
id|MSR_IP
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* not reached */
)brace
multiline_comment|/* Carrera is the power manager in the Thinkpads. Unfortunately not much is&n; * known about it, so we can&squot;t power down.&n; */
r_static
r_void
id|__prep
DECL|function|prep_carrera_poweroff
id|prep_carrera_poweroff
c_func
(paren
r_void
)paren
(brace
id|prep_halt
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * On most IBM PReP&squot;s, power management is handled by a Signetics 87c750&n; * behind the Utah component on the ISA bus. To access the 750 you must write&n; * a series of nibbles to port 0x82a (decoded by the Utah). This is described&n; * somewhat in the IBM Carolina Technical Specification.&n; * -Hollis&n; */
r_static
r_void
id|__prep
DECL|function|utah_sig87c750_setbit
id|utah_sig87c750_setbit
c_func
(paren
r_int
r_int
id|bytenum
comma
r_int
r_int
id|bitnum
comma
r_int
id|value
)paren
(brace
multiline_comment|/*&n;&t; * byte1: 0 0 0 1 0  d  a5 a4&n;&t; * byte2: 0 0 0 1 a3 a2 a1 a0&n;&t; *&n;&t; * d = the bit&squot;s value, enabled or disabled&n;&t; * (a5 a4 a3) = the byte number, minus 20&n;&t; * (a2 a1 a0) = the bit number&n;&t; *&n;&t; * example: set the 5th bit of byte 21 (21.5)&n;&t; *     a5 a4 a3 = 001 (byte 1)&n;&t; *     a2 a1 a0 = 101 (bit 5)&n;&t; *&n;&t; *     byte1 = 0001 0100 (0x14)&n;&t; *     byte2 = 0001 1101 (0x1d)&n;&t; */
r_int
r_char
id|byte1
op_assign
l_int|0x10
comma
id|byte2
op_assign
l_int|0x10
suffix:semicolon
multiline_comment|/* the 750&squot;s &squot;20.0&squot; is accessed as &squot;0.0&squot; through Utah (which adds 20) */
id|bytenum
op_sub_assign
l_int|20
suffix:semicolon
id|byte1
op_or_assign
(paren
op_logical_neg
op_logical_neg
id|value
)paren
op_lshift
l_int|2
suffix:semicolon
multiline_comment|/* set d */
id|byte1
op_or_assign
(paren
id|bytenum
op_rshift
l_int|1
)paren
op_amp
l_int|0x3
suffix:semicolon
multiline_comment|/* set a5, a4 */
id|byte2
op_or_assign
(paren
id|bytenum
op_amp
l_int|0x1
)paren
op_lshift
l_int|3
suffix:semicolon
multiline_comment|/* set a3 */
id|byte2
op_or_assign
id|bitnum
op_amp
l_int|0x7
suffix:semicolon
multiline_comment|/* set a2, a1, a0 */
id|outb
c_func
(paren
id|byte1
comma
id|PREP_IBM_PM1
)paren
suffix:semicolon
multiline_comment|/* first nibble */
id|mb
c_func
(paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* important: let controller recover */
id|outb
c_func
(paren
id|byte2
comma
id|PREP_IBM_PM1
)paren
suffix:semicolon
multiline_comment|/* second nibble */
id|mb
c_func
(paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
multiline_comment|/* important: let controller recover */
)brace
r_static
r_void
id|__prep
DECL|function|prep_sig750_poweroff
id|prep_sig750_poweroff
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* tweak the power manager found in most IBM PRePs (except Thinkpads) */
id|local_irq_disable
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* set exception prefix high - to the prom */
id|_nmask_and_or_msr
c_func
(paren
l_int|0
comma
id|MSR_IP
)paren
suffix:semicolon
id|utah_sig87c750_setbit
c_func
(paren
l_int|21
comma
l_int|5
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* set bit 21.5, &quot;PMEXEC_OFF&quot; */
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* not reached */
)brace
r_static
r_int
id|__prep
DECL|function|prep_show_percpuinfo
id|prep_show_percpuinfo
c_func
(paren
r_struct
id|seq_file
op_star
id|m
comma
r_int
id|i
)paren
(brace
multiline_comment|/* PREP&squot;s without residual data will give incorrect values here */
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;clock&bslash;t&bslash;t: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|have_residual_data
)paren
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;%ldMHz&bslash;n&quot;
comma
(paren
id|res-&gt;VitalProductData.ProcessorHz
OG
l_int|1024
)paren
ques
c_cond
id|res-&gt;VitalProductData.ProcessorHz
op_div
l_int|1000000
suffix:colon
id|res-&gt;VitalProductData.ProcessorHz
)paren
suffix:semicolon
r_else
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;???&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SOUND_CS4232
DECL|function|masktoint
r_static
r_int
id|__init
id|masktoint
c_func
(paren
r_int
r_int
id|i
)paren
(brace
r_int
id|t
op_assign
op_minus
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|i
op_rshift
op_increment
id|t
)paren
suffix:semicolon
r_return
(paren
id|t
op_minus
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ppc_cs4232_dma and ppc_cs4232_dma2 are used in include/asm/dma.h&n; * to distinguish sound dma-channels from others. This is because&n; * blocksize on 16 bit dma-channels 5,6,7 is 128k, but&n; * the cs4232.c uses 64k like on 8 bit dma-channels 0,1,2,3&n; */
DECL|function|prep_init_sound
r_static
r_void
id|__init
id|prep_init_sound
c_func
(paren
r_void
)paren
(brace
id|PPC_DEVICE
op_star
id|audiodevice
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;&t; * Get the needed resource informations from residual data.&n;&t; *&n;&t; */
r_if
c_cond
(paren
id|have_residual_data
)paren
id|audiodevice
op_assign
id|residual_find_device
c_func
(paren
op_complement
l_int|0
comma
l_int|NULL
comma
id|MultimediaController
comma
id|AudioController
comma
op_minus
l_int|1
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|audiodevice
op_ne
l_int|NULL
)paren
(brace
id|PnP_TAG_PACKET
op_star
id|pkt
suffix:semicolon
id|pkt
op_assign
id|PnP_find_packet
c_func
(paren
(paren
r_int
r_char
op_star
)paren
op_amp
id|res-&gt;DevicePnPHeap
(braket
id|audiodevice-&gt;AllocatedOffset
)braket
comma
id|S5_Packet
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pkt
op_ne
l_int|NULL
)paren
id|ppc_cs4232_dma
op_assign
id|masktoint
c_func
(paren
id|pkt-&gt;S5_Pack.DMAMask
)paren
suffix:semicolon
id|pkt
op_assign
id|PnP_find_packet
c_func
(paren
(paren
r_int
r_char
op_star
)paren
op_amp
id|res-&gt;DevicePnPHeap
(braket
id|audiodevice-&gt;AllocatedOffset
)braket
comma
id|S5_Packet
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pkt
op_ne
l_int|NULL
)paren
id|ppc_cs4232_dma2
op_assign
id|masktoint
c_func
(paren
id|pkt-&gt;S5_Pack.DMAMask
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * These are the PReP specs&squot; defaults for the cs4231.  We use these&n;&t; * as fallback incase we don&squot;t have residual data.&n;&t; * At least the IBM Thinkpad 850 with IDE DMA Channels at 6 and 7&n;&t; * will use the other values.&n;&t; */
r_if
c_cond
(paren
id|audiodevice
op_eq
l_int|NULL
)paren
(brace
r_switch
c_cond
(paren
id|_prep_type
)paren
(brace
r_case
id|_PREP_IBM
suffix:colon
id|ppc_cs4232_dma
op_assign
l_int|1
suffix:semicolon
id|ppc_cs4232_dma2
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ppc_cs4232_dma
op_assign
l_int|6
suffix:semicolon
id|ppc_cs4232_dma2
op_assign
l_int|7
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; * Find a way to push these informations to the cs4232 driver&n;&t; * Give it out with printk, when not in cmd_line?&n;&t; * Append it to  cmd_line and saved_command_line?&n;&t; * Format is cs4232=io,irq,dma,dma2&n;&t; */
)brace
macro_line|#endif /* CONFIG_SOUND_CS4232 */
multiline_comment|/*&n; * Fill out screen_info according to the residual data. This allows us to use&n; * at least vesafb.&n; */
r_static
r_void
id|__init
DECL|function|prep_init_vesa
id|prep_init_vesa
c_func
(paren
r_void
)paren
(brace
macro_line|#if     (defined(CONFIG_FB_VGA16) || defined(CONFIG_FB_VGA16_MODULE) || &bslash;&n;&t; defined(CONFIG_FB_VESA))
id|PPC_DEVICE
op_star
id|vgadev
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|have_residual_data
)paren
id|vgadev
op_assign
id|residual_find_device
c_func
(paren
op_complement
l_int|0
comma
l_int|NULL
comma
id|DisplayController
comma
id|SVGAController
comma
op_minus
l_int|1
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vgadev
op_ne
l_int|NULL
)paren
(brace
id|PnP_TAG_PACKET
op_star
id|pkt
suffix:semicolon
id|pkt
op_assign
id|PnP_find_large_vendor_packet
c_func
(paren
(paren
r_int
r_char
op_star
)paren
op_amp
id|res-&gt;DevicePnPHeap
(braket
id|vgadev-&gt;AllocatedOffset
)braket
comma
l_int|0x04
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* 0x04 = Display Tag */
r_if
c_cond
(paren
id|pkt
op_ne
l_int|NULL
)paren
(brace
r_int
r_char
op_star
id|ptr
op_assign
(paren
r_int
r_char
op_star
)paren
id|pkt
suffix:semicolon
r_if
c_cond
(paren
id|ptr
(braket
l_int|4
)braket
)paren
(brace
multiline_comment|/* graphics mode */
id|screen_info.orig_video_isVGA
op_assign
id|VIDEO_TYPE_VLFB
suffix:semicolon
id|screen_info.lfb_depth
op_assign
id|ptr
(braket
l_int|4
)braket
op_star
l_int|8
suffix:semicolon
id|screen_info.lfb_width
op_assign
id|swab16
c_func
(paren
op_star
(paren
r_int
op_star
)paren
(paren
id|ptr
op_plus
l_int|6
)paren
)paren
suffix:semicolon
id|screen_info.lfb_height
op_assign
id|swab16
c_func
(paren
op_star
(paren
r_int
op_star
)paren
(paren
id|ptr
op_plus
l_int|8
)paren
)paren
suffix:semicolon
id|screen_info.lfb_linelength
op_assign
id|swab16
c_func
(paren
op_star
(paren
r_int
op_star
)paren
(paren
id|ptr
op_plus
l_int|10
)paren
)paren
suffix:semicolon
id|screen_info.lfb_base
op_assign
id|swab32
c_func
(paren
op_star
(paren
r_int
op_star
)paren
(paren
id|ptr
op_plus
l_int|12
)paren
)paren
suffix:semicolon
id|screen_info.lfb_size
op_assign
id|swab32
c_func
(paren
op_star
(paren
r_int
op_star
)paren
(paren
id|ptr
op_plus
l_int|20
)paren
)paren
op_div
l_int|65536
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
)brace
multiline_comment|/*&n; * Set DBAT 2 to access 0x80000000 so early progress messages will work&n; */
r_static
id|__inline__
r_void
DECL|function|prep_set_bat
id|prep_set_bat
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* wait for all outstanding memory access to complete */
id|mb
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* setup DBATs */
id|mtspr
c_func
(paren
id|SPRN_DBAT2U
comma
l_int|0x80001ffe
)paren
suffix:semicolon
id|mtspr
c_func
(paren
id|SPRN_DBAT2L
comma
l_int|0x8000002a
)paren
suffix:semicolon
multiline_comment|/* wait for updates */
id|mb
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * IBM 3-digit status LED&n; */
DECL|variable|__prepdata
r_static
r_int
r_int
id|ibm_statusled_base
id|__prepdata
suffix:semicolon
r_static
r_void
id|__prep
id|ibm_statusled_progress
c_func
(paren
r_char
op_star
id|s
comma
r_int
r_int
id|hex
)paren
suffix:semicolon
r_static
r_int
id|__prep
DECL|function|ibm_statusled_panic
id|ibm_statusled_panic
c_func
(paren
r_struct
id|notifier_block
op_star
id|dummy1
comma
r_int
r_int
id|dummy2
comma
r_void
op_star
id|dummy3
)paren
(brace
id|ibm_statusled_progress
c_func
(paren
l_int|NULL
comma
l_int|0x505
)paren
suffix:semicolon
multiline_comment|/* SOS */
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
DECL|variable|__prepdata
r_static
r_struct
id|notifier_block
id|ibm_statusled_block
id|__prepdata
op_assign
(brace
id|ibm_statusled_panic
comma
l_int|NULL
comma
id|INT_MAX
multiline_comment|/* try to do it first */
)brace
suffix:semicolon
r_static
r_void
id|__prep
DECL|function|ibm_statusled_progress
id|ibm_statusled_progress
c_func
(paren
r_char
op_star
id|s
comma
r_int
r_int
id|hex
)paren
(brace
r_static
r_int
id|notifier_installed
suffix:semicolon
multiline_comment|/*&n;&t; * Progress uses 4 digits and we have only 3.  So, we map 0xffff to&n;&t; * 0xfff for display switch off.  Out of range values are mapped to&n;&t; * 0xeff, as I&squot;m told 0xf00 and above are reserved for hardware codes.&n;&t; * Install the panic notifier when the display is first switched off.&n;&t; */
r_if
c_cond
(paren
id|hex
op_eq
l_int|0xffff
)paren
(brace
id|hex
op_assign
l_int|0xfff
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|notifier_installed
)paren
(brace
op_increment
id|notifier_installed
suffix:semicolon
id|notifier_chain_register
c_func
(paren
op_amp
id|panic_notifier_list
comma
op_amp
id|ibm_statusled_block
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|hex
OG
l_int|0xfff
)paren
id|hex
op_assign
l_int|0xeff
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|outw
c_func
(paren
id|hex
comma
id|ibm_statusled_base
)paren
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|ibm_statusled_init
id|ibm_statusled_init
c_func
(paren
r_void
)paren
(brace
multiline_comment|/*&n;&t; * The IBM 3-digit LED display is specified in the residual data&n;&t; * as an operator panel device, type &quot;System Status LED&quot;.  Find&n;&t; * that device and determine its address.  We validate all the&n;&t; * other parameters on the off-chance another, similar device&n;&t; * exists.&n;&t; */
r_if
c_cond
(paren
id|have_residual_data
)paren
(brace
id|PPC_DEVICE
op_star
id|led
suffix:semicolon
id|PnP_TAG_PACKET
op_star
id|pkt
suffix:semicolon
id|led
op_assign
id|residual_find_device
c_func
(paren
op_complement
l_int|0
comma
l_int|NULL
comma
id|SystemPeripheral
comma
id|OperatorPanel
comma
id|SystemStatusLED
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|led
)paren
r_return
suffix:semicolon
id|pkt
op_assign
id|PnP_find_packet
c_func
(paren
(paren
r_int
r_char
op_star
)paren
op_amp
id|res-&gt;DevicePnPHeap
(braket
id|led-&gt;AllocatedOffset
)braket
comma
id|S8_Packet
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pkt
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|pkt-&gt;S8_Pack.IOInfo
op_ne
id|ISAAddr16bit
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_star
(paren
r_int
r_int
op_star
)paren
id|pkt-&gt;S8_Pack.RangeMin
op_ne
op_star
(paren
r_int
r_int
op_star
)paren
id|pkt-&gt;S8_Pack.RangeMax
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|pkt-&gt;S8_Pack.IOAlign
op_ne
l_int|2
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|pkt-&gt;S8_Pack.IONum
op_ne
l_int|2
)paren
r_return
suffix:semicolon
id|ibm_statusled_base
op_assign
id|ld_le16
c_func
(paren
(paren
r_int
r_int
op_star
)paren
(paren
id|pkt-&gt;S8_Pack.RangeMin
)paren
)paren
suffix:semicolon
id|ppc_md.progress
op_assign
id|ibm_statusled_progress
suffix:semicolon
)brace
)brace
r_static
r_void
id|__init
DECL|function|prep_setup_arch
id|prep_setup_arch
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|reg
suffix:semicolon
r_int
id|is_ide
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* init to some ~sane value until calibrate_delay() runs */
id|loops_per_jiffy
op_assign
l_int|50000000
suffix:semicolon
multiline_comment|/* Lookup PCI host bridges */
id|prep_find_bridges
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Set up floppy in PS/2 mode */
id|outb
c_func
(paren
l_int|0x09
comma
id|SIO_CONFIG_RA
)paren
suffix:semicolon
id|reg
op_assign
id|inb
c_func
(paren
id|SIO_CONFIG_RD
)paren
suffix:semicolon
id|reg
op_assign
(paren
id|reg
op_amp
l_int|0x3F
)paren
op_or
l_int|0x40
suffix:semicolon
id|outb
c_func
(paren
id|reg
comma
id|SIO_CONFIG_RD
)paren
suffix:semicolon
id|outb
c_func
(paren
id|reg
comma
id|SIO_CONFIG_RD
)paren
suffix:semicolon
multiline_comment|/* Have to write twice to change! */
r_switch
c_cond
(paren
id|_prep_type
)paren
(brace
r_case
id|_PREP_IBM
suffix:colon
id|reg
op_assign
id|inb
c_func
(paren
id|PREP_IBM_PLANAR
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;IBM planar ID: %02x&quot;
comma
id|reg
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|reg
)paren
(brace
r_case
id|PREP_IBM_SANDALFOOT
suffix:colon
id|prep_gen_enable_l2
c_func
(paren
)paren
suffix:semicolon
id|setup_ibm_pci
op_assign
id|prep_sandalfoot_setup_pci
suffix:semicolon
id|ppc_md.power_off
op_assign
id|prep_sig750_poweroff
suffix:semicolon
id|ppc_md.show_cpuinfo
op_assign
id|prep_sandalfoot_cpuinfo
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PREP_IBM_THINKPAD
suffix:colon
id|prep_gen_enable_l2
c_func
(paren
)paren
suffix:semicolon
id|setup_ibm_pci
op_assign
id|prep_thinkpad_setup_pci
suffix:semicolon
id|ppc_md.power_off
op_assign
id|prep_carrera_poweroff
suffix:semicolon
id|ppc_md.show_cpuinfo
op_assign
id|prep_thinkpad_cpuinfo
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|have_residual_data
)paren
(brace
id|prep_gen_enable_l2
c_func
(paren
)paren
suffix:semicolon
id|setup_ibm_pci
op_assign
id|prep_residual_setup_pci
suffix:semicolon
id|ppc_md.power_off
op_assign
id|prep_halt
suffix:semicolon
id|ppc_md.show_cpuinfo
op_assign
id|prep_gen_cpuinfo
suffix:semicolon
r_break
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot; - unknown! Assuming Carolina&quot;
)paren
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|PREP_IBM_CAROLINA_IDE_0
suffix:colon
r_case
id|PREP_IBM_CAROLINA_IDE_1
suffix:colon
r_case
id|PREP_IBM_CAROLINA_IDE_2
suffix:colon
r_case
id|PREP_IBM_CAROLINA_IDE_3
suffix:colon
id|is_ide
op_assign
l_int|1
suffix:semicolon
r_case
id|PREP_IBM_CAROLINA_SCSI_0
suffix:colon
r_case
id|PREP_IBM_CAROLINA_SCSI_1
suffix:colon
r_case
id|PREP_IBM_CAROLINA_SCSI_2
suffix:colon
r_case
id|PREP_IBM_CAROLINA_SCSI_3
suffix:colon
id|prep_carolina_enable_l2
c_func
(paren
)paren
suffix:semicolon
id|setup_ibm_pci
op_assign
id|prep_carolina_setup_pci
suffix:semicolon
id|ppc_md.power_off
op_assign
id|prep_sig750_poweroff
suffix:semicolon
id|ppc_md.show_cpuinfo
op_assign
id|prep_carolina_cpuinfo
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PREP_IBM_TIGER1_133
suffix:colon
r_case
id|PREP_IBM_TIGER1_166
suffix:colon
r_case
id|PREP_IBM_TIGER1_180
suffix:colon
r_case
id|PREP_IBM_TIGER1_xxx
suffix:colon
r_case
id|PREP_IBM_TIGER1_333
suffix:colon
id|prep_carolina_enable_l2
c_func
(paren
)paren
suffix:semicolon
id|setup_ibm_pci
op_assign
id|prep_tiger1_setup_pci
suffix:semicolon
id|ppc_md.power_off
op_assign
id|prep_sig750_poweroff
suffix:semicolon
id|ppc_md.show_cpuinfo
op_assign
id|prep_tiger1_cpuinfo
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* default root device */
r_if
c_cond
(paren
id|is_ide
)paren
id|ROOT_DEV
op_assign
id|MKDEV
c_func
(paren
id|IDE0_MAJOR
comma
l_int|3
)paren
suffix:semicolon
r_else
id|ROOT_DEV
op_assign
id|MKDEV
c_func
(paren
id|SCSI_DISK0_MAJOR
comma
l_int|3
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_PREP_Motorola
suffix:colon
id|prep_gen_enable_l2
c_func
(paren
)paren
suffix:semicolon
id|ppc_md.power_off
op_assign
id|prep_halt
suffix:semicolon
id|ppc_md.show_cpuinfo
op_assign
id|prep_mot_cpuinfo
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_INITRD
r_if
c_cond
(paren
id|initrd_start
)paren
id|ROOT_DEV
op_assign
id|Root_RAM0
suffix:semicolon
r_else
macro_line|#endif
macro_line|#ifdef CONFIG_ROOT_NFS
id|ROOT_DEV
op_assign
id|Root_NFS
suffix:semicolon
macro_line|#else
id|ROOT_DEV
op_assign
id|Root_SDA2
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
)brace
multiline_comment|/* Read in NVRAM data */
id|init_prep_nvram
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* if no bootargs, look in NVRAM */
r_if
c_cond
(paren
id|cmd_line
(braket
l_int|0
)braket
op_eq
l_char|&squot;&bslash;0&squot;
)paren
(brace
r_char
op_star
id|bootargs
suffix:semicolon
id|bootargs
op_assign
id|prep_nvram_get_var
c_func
(paren
l_string|&quot;bootargs&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bootargs
op_ne
l_int|NULL
)paren
(brace
id|strcpy
c_func
(paren
id|cmd_line
comma
id|bootargs
)paren
suffix:semicolon
multiline_comment|/* again.. */
id|strcpy
c_func
(paren
id|saved_command_line
comma
id|cmd_line
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_SOUND_CS4232
id|prep_init_sound
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_SOUND_CS4232 */
id|prep_init_vesa
c_func
(paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|_prep_type
)paren
(brace
r_case
id|_PREP_Motorola
suffix:colon
id|raven_init
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|_PREP_IBM
suffix:colon
id|ibm_prep_init
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_VGA_CONSOLE
multiline_comment|/* vgacon.c needs to know where we mapped IO memory in io_block_mapping() */
id|vgacon_remap_base
op_assign
l_int|0xf0000000
suffix:semicolon
id|conswitchp
op_assign
op_amp
id|vga_con
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n; * First, see if we can get this information from the residual data.&n; * This is important on some IBM PReP systems.  If we cannot, we let the&n; * TODC code handle doing this.&n; */
r_static
r_void
id|__init
DECL|function|prep_calibrate_decr
id|prep_calibrate_decr
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|have_residual_data
)paren
(brace
r_int
r_int
id|freq
comma
id|divisor
op_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
id|res-&gt;VitalProductData.ProcessorBusHz
)paren
(brace
id|freq
op_assign
id|res-&gt;VitalProductData.ProcessorBusHz
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;time_init: decrementer frequency = %lu.%.6lu MHz&bslash;n&quot;
comma
(paren
id|freq
op_div
id|divisor
)paren
op_div
l_int|1000000
comma
(paren
id|freq
op_div
id|divisor
)paren
op_mod
l_int|1000000
)paren
suffix:semicolon
id|tb_to_us
op_assign
id|mulhwu_scale_factor
c_func
(paren
id|freq
op_div
id|divisor
comma
l_int|1000000
)paren
suffix:semicolon
id|tb_ticks_per_jiffy
op_assign
id|freq
op_div
id|HZ
op_div
id|divisor
suffix:semicolon
)brace
)brace
r_else
id|todc_calibrate_decr
c_func
(paren
)paren
suffix:semicolon
)brace
r_static
r_int
r_int
id|__prep
DECL|function|prep_irq_canonicalize
id|prep_irq_canonicalize
c_func
(paren
id|u_int
id|irq
)paren
(brace
r_if
c_cond
(paren
id|irq
op_eq
l_int|2
)paren
(brace
r_return
l_int|9
suffix:semicolon
)brace
r_else
(brace
r_return
id|irq
suffix:semicolon
)brace
)brace
r_static
r_void
id|__init
DECL|function|prep_init_IRQ
id|prep_init_IRQ
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|pci_viddid
comma
id|pci_did
suffix:semicolon
r_if
c_cond
(paren
id|OpenPIC_Addr
op_ne
l_int|NULL
)paren
(brace
id|openpic_init
c_func
(paren
id|NUM_8259_INTERRUPTS
)paren
suffix:semicolon
multiline_comment|/* We have a cascade on OpenPIC IRQ 0, Linux IRQ 16 */
id|openpic_hookup_cascade
c_func
(paren
id|NUM_8259_INTERRUPTS
comma
l_string|&quot;82c59 cascade&quot;
comma
id|i8259_irq
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_8259_INTERRUPTS
suffix:semicolon
id|i
op_increment
)paren
id|irq_desc
(braket
id|i
)braket
dot
id|handler
op_assign
op_amp
id|i8259_pic
suffix:semicolon
r_if
c_cond
(paren
id|have_residual_data
)paren
(brace
id|i8259_init
c_func
(paren
id|residual_isapic_addr
c_func
(paren
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* If we have a Raven PCI bridge or a Hawk PCI bridge / Memory&n;&t; * controller, we poll (as they have a different int-ack address). */
id|early_read_config_dword
c_func
(paren
l_int|NULL
comma
l_int|0
comma
l_int|0
comma
id|PCI_VENDOR_ID
comma
op_amp
id|pci_viddid
)paren
suffix:semicolon
id|pci_did
op_assign
(paren
id|pci_viddid
op_amp
l_int|0xffff0000
)paren
op_rshift
l_int|16
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|pci_viddid
op_amp
l_int|0xffff
)paren
op_eq
id|PCI_VENDOR_ID_MOTOROLA
)paren
op_logical_and
(paren
(paren
id|pci_did
op_eq
id|PCI_DEVICE_ID_MOTOROLA_RAVEN
)paren
op_logical_or
(paren
id|pci_did
op_eq
id|PCI_DEVICE_ID_MOTOROLA_HAWK
)paren
)paren
)paren
id|i8259_init
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_else
multiline_comment|/* PCI interrupt ack address given in section 6.1.8 of the&n;&t;&t; * PReP specification. */
id|i8259_init
c_func
(paren
id|MPC10X_MAPA_PCI_INTACK_ADDR
)paren
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_BLK_DEV_IDE) || defined(CONFIG_BLK_DEV_IDE_MODULE)
multiline_comment|/*&n; * IDE stuff.&n; */
r_static
r_int
id|__prep
DECL|function|prep_ide_default_irq
id|prep_ide_default_irq
c_func
(paren
r_int
r_int
id|base
)paren
(brace
r_switch
c_cond
(paren
id|base
)paren
(brace
r_case
l_int|0x1f0
suffix:colon
r_return
l_int|13
suffix:semicolon
r_case
l_int|0x170
suffix:colon
r_return
l_int|13
suffix:semicolon
r_case
l_int|0x1e8
suffix:colon
r_return
l_int|11
suffix:semicolon
r_case
l_int|0x168
suffix:colon
r_return
l_int|10
suffix:semicolon
r_case
l_int|0xfff0
suffix:colon
r_return
l_int|14
suffix:semicolon
multiline_comment|/* MCP(N)750 ide0 */
r_case
l_int|0xffe0
suffix:colon
r_return
l_int|15
suffix:semicolon
multiline_comment|/* MCP(N)750 ide1 */
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_static
r_int
r_int
id|__prep
DECL|function|prep_ide_default_io_base
id|prep_ide_default_io_base
c_func
(paren
r_int
id|index
)paren
(brace
r_switch
c_cond
(paren
id|index
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
l_int|0x1f0
suffix:semicolon
r_case
l_int|1
suffix:colon
r_return
l_int|0x170
suffix:semicolon
r_case
l_int|2
suffix:colon
r_return
l_int|0x1e8
suffix:semicolon
r_case
l_int|3
suffix:colon
r_return
l_int|0x168
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SMP
multiline_comment|/* PReP (MTX) support */
r_static
r_int
id|__init
DECL|function|smp_prep_probe
id|smp_prep_probe
c_func
(paren
r_void
)paren
(brace
r_extern
r_int
id|mot_multi
suffix:semicolon
r_if
c_cond
(paren
id|mot_multi
)paren
(brace
id|openpic_request_IPIs
c_func
(paren
)paren
suffix:semicolon
id|smp_hw_index
(braket
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
r_return
l_int|2
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|smp_prep_kick_cpu
id|smp_prep_kick_cpu
c_func
(paren
r_int
id|nr
)paren
(brace
op_star
(paren
r_int
r_int
op_star
)paren
id|KERNELBASE
op_assign
id|nr
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;dcbf 0,%0&quot;
op_scope_resolution
l_string|&quot;r&quot;
(paren
id|KERNELBASE
)paren
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;CPU1 released, waiting&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|smp_prep_setup_cpu
id|smp_prep_setup_cpu
c_func
(paren
r_int
id|cpu_nr
)paren
(brace
r_if
c_cond
(paren
id|OpenPIC_Addr
)paren
id|do_openpic_setup_cpu
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|__prepdata
r_static
r_struct
id|smp_ops_t
id|prep_smp_ops
id|__prepdata
op_assign
(brace
id|smp_openpic_message_pass
comma
id|smp_prep_probe
comma
id|smp_prep_kick_cpu
comma
id|smp_prep_setup_cpu
comma
dot
id|give_timebase
op_assign
id|smp_generic_give_timebase
comma
dot
id|take_timebase
op_assign
id|smp_generic_take_timebase
comma
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_SMP */
multiline_comment|/*&n; * Setup the bat mappings we&squot;re going to load that cover&n; * the io areas.  RAM was mapped by mapin_ram().&n; * -- Cort&n; */
r_static
r_void
id|__init
DECL|function|prep_map_io
id|prep_map_io
c_func
(paren
r_void
)paren
(brace
id|io_block_mapping
c_func
(paren
l_int|0x80000000
comma
id|PREP_ISA_IO_BASE
comma
l_int|0x10000000
comma
id|_PAGE_IO
)paren
suffix:semicolon
id|io_block_mapping
c_func
(paren
l_int|0xf0000000
comma
id|PREP_ISA_MEM_BASE
comma
l_int|0x08000000
comma
id|_PAGE_IO
)paren
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|prep_request_io
id|prep_request_io
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|_machine
op_eq
id|_MACH_prep
)paren
(brace
macro_line|#ifdef CONFIG_NVRAM
id|request_region
c_func
(paren
id|PREP_NVRAM_AS0
comma
l_int|0x8
comma
l_string|&quot;nvram&quot;
)paren
suffix:semicolon
macro_line|#endif
id|request_region
c_func
(paren
l_int|0x00
comma
l_int|0x20
comma
l_string|&quot;dma1&quot;
)paren
suffix:semicolon
id|request_region
c_func
(paren
l_int|0x40
comma
l_int|0x20
comma
l_string|&quot;timer&quot;
)paren
suffix:semicolon
id|request_region
c_func
(paren
l_int|0x80
comma
l_int|0x10
comma
l_string|&quot;dma page reg&quot;
)paren
suffix:semicolon
id|request_region
c_func
(paren
l_int|0xc0
comma
l_int|0x20
comma
l_string|&quot;dma2&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|prep_request_io
id|device_initcall
c_func
(paren
id|prep_request_io
)paren
suffix:semicolon
r_void
id|__init
DECL|function|prep_init
id|prep_init
c_func
(paren
r_int
r_int
id|r3
comma
r_int
r_int
id|r4
comma
r_int
r_int
id|r5
comma
r_int
r_int
id|r6
comma
r_int
r_int
id|r7
)paren
(brace
macro_line|#ifdef CONFIG_PREP_RESIDUAL
multiline_comment|/* make a copy of residual data */
r_if
c_cond
(paren
id|r3
)paren
(brace
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|res
comma
(paren
r_void
op_star
)paren
(paren
id|r3
op_plus
id|KERNELBASE
)paren
comma
r_sizeof
(paren
id|RESIDUAL
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
id|isa_io_base
op_assign
id|PREP_ISA_IO_BASE
suffix:semicolon
id|isa_mem_base
op_assign
id|PREP_ISA_MEM_BASE
suffix:semicolon
id|pci_dram_offset
op_assign
id|PREP_PCI_DRAM_OFFSET
suffix:semicolon
id|ISA_DMA_THRESHOLD
op_assign
l_int|0x00ffffff
suffix:semicolon
id|DMA_MODE_READ
op_assign
l_int|0x44
suffix:semicolon
id|DMA_MODE_WRITE
op_assign
l_int|0x48
suffix:semicolon
multiline_comment|/* figure out what kind of prep workstation we are */
r_if
c_cond
(paren
id|have_residual_data
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|res-&gt;VitalProductData.PrintableModel
comma
l_string|&quot;IBM&quot;
comma
l_int|3
)paren
)paren
id|_prep_type
op_assign
id|_PREP_IBM
suffix:semicolon
r_else
id|_prep_type
op_assign
id|_PREP_Motorola
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* assume motorola if no residual (netboot?) */
id|_prep_type
op_assign
id|_PREP_Motorola
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PREP_RESIDUAL
multiline_comment|/* Switch off all residual data processing if the user requests it */
r_if
c_cond
(paren
id|strstr
c_func
(paren
id|cmd_line
comma
l_string|&quot;noresidual&quot;
)paren
op_ne
l_int|NULL
)paren
id|res
op_assign
l_int|NULL
suffix:semicolon
macro_line|#endif
multiline_comment|/* Initialise progress early to get maximum benefit */
id|prep_set_bat
c_func
(paren
)paren
suffix:semicolon
id|ibm_statusled_init
c_func
(paren
)paren
suffix:semicolon
id|ppc_md.setup_arch
op_assign
id|prep_setup_arch
suffix:semicolon
id|ppc_md.show_percpuinfo
op_assign
id|prep_show_percpuinfo
suffix:semicolon
id|ppc_md.show_cpuinfo
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* set in prep_setup_arch() */
id|ppc_md.irq_canonicalize
op_assign
id|prep_irq_canonicalize
suffix:semicolon
id|ppc_md.init_IRQ
op_assign
id|prep_init_IRQ
suffix:semicolon
multiline_comment|/* this gets changed later on if we have an OpenPIC -- Cort */
id|ppc_md.get_irq
op_assign
id|i8259_irq
suffix:semicolon
id|ppc_md.phys_mem_access_prot
op_assign
id|pci_phys_mem_access_prot
suffix:semicolon
id|ppc_md.restart
op_assign
id|prep_restart
suffix:semicolon
id|ppc_md.power_off
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* set in prep_setup_arch() */
id|ppc_md.halt
op_assign
id|prep_halt
suffix:semicolon
id|ppc_md.nvram_read_val
op_assign
id|prep_nvram_read_val
suffix:semicolon
id|ppc_md.nvram_write_val
op_assign
id|prep_nvram_write_val
suffix:semicolon
id|ppc_md.time_init
op_assign
id|todc_time_init
suffix:semicolon
r_if
c_cond
(paren
id|_prep_type
op_eq
id|_PREP_IBM
)paren
(brace
id|ppc_md.rtc_read_val
op_assign
id|todc_mc146818_read_val
suffix:semicolon
id|ppc_md.rtc_write_val
op_assign
id|todc_mc146818_write_val
suffix:semicolon
id|TODC_INIT
c_func
(paren
id|TODC_TYPE_MC146818
comma
id|RTC_PORT
c_func
(paren
l_int|0
)paren
comma
l_int|NULL
comma
id|RTC_PORT
c_func
(paren
l_int|1
)paren
comma
l_int|8
)paren
suffix:semicolon
)brace
r_else
(brace
id|TODC_INIT
c_func
(paren
id|TODC_TYPE_MK48T59
comma
id|PREP_NVRAM_AS0
comma
id|PREP_NVRAM_AS1
comma
id|PREP_NVRAM_DATA
comma
l_int|8
)paren
suffix:semicolon
)brace
id|ppc_md.calibrate_decr
op_assign
id|prep_calibrate_decr
suffix:semicolon
id|ppc_md.set_rtc_time
op_assign
id|todc_set_rtc_time
suffix:semicolon
id|ppc_md.get_rtc_time
op_assign
id|todc_get_rtc_time
suffix:semicolon
id|ppc_md.setup_io_mappings
op_assign
id|prep_map_io
suffix:semicolon
macro_line|#if defined(CONFIG_BLK_DEV_IDE) || defined(CONFIG_BLK_DEV_IDE_MODULE)
id|ppc_ide_md.default_irq
op_assign
id|prep_ide_default_irq
suffix:semicolon
id|ppc_ide_md.default_io_base
op_assign
id|prep_ide_default_io_base
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SMP
id|ppc_md.smp_ops
op_assign
op_amp
id|prep_smp_ops
suffix:semicolon
macro_line|#endif /* CONFIG_SMP */
)brace
eof
