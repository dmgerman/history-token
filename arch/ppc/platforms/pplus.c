multiline_comment|/*&n; * arch/ppc/platforms/pplus.c&n; *&n; * Board and PCI setup routines for MCG PowerPlus&n; *&n; * Author: Randy Vinson &lt;rvinson@mvista.com&gt;&n; *&n; * Derived from original PowerPlus PReP work by&n; * Cort Dougan, Johnnie Peters, Matt Porter, and&n; * Troy Benjegerdes.&n; *&n; * 2001-2004 (c) MontaVista, Software, Inc.  This file is licensed under&n; * the terms of the GNU General Public License version 2.  This program&n; * is licensed &quot;as is&quot; without any warranty of any kind, whether express&n; * or implied.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/irq.h&gt;
macro_line|#include &lt;linux/ide.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &lt;linux/root_dev.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;asm/machdep.h&gt;
macro_line|#include &lt;asm/prep_nvram.h&gt;
macro_line|#include &lt;asm/vga.h&gt;
macro_line|#include &lt;asm/i8259.h&gt;
macro_line|#include &lt;asm/open_pic.h&gt;
macro_line|#include &lt;asm/hawk.h&gt;
macro_line|#include &lt;asm/todc.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#include &lt;asm/kgdb.h&gt;
macro_line|#include &lt;asm/reg.h&gt;
macro_line|#include &quot;pplus.h&quot;
DECL|macro|DUMP_DBATS
macro_line|#undef DUMP_DBATS
id|TODC_ALLOC
c_func
(paren
)paren
suffix:semicolon
r_extern
r_void
id|pplus_setup_hose
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|pplus_set_VIA_IDE_native
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
r_int
id|loops_per_jiffy
suffix:semicolon
DECL|variable|Motherboard_map_name
r_int
r_char
op_star
id|Motherboard_map_name
suffix:semicolon
multiline_comment|/* Tables for known hardware */
multiline_comment|/* Motorola Mesquite */
r_static
r_inline
r_int
DECL|function|mesquite_map_irq
id|mesquite_map_irq
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
r_char
id|idsel
comma
r_int
r_char
id|pin
)paren
(brace
r_static
r_char
id|pci_irq_table
(braket
)braket
(braket
l_int|4
)braket
op_assign
multiline_comment|/*&n;&t;     *      MPIC interrupts for various IDSEL values (MPIC IRQ0 =&n;&t;     *      Linux IRQ16 (to leave room for ISA IRQs at 0-15).&n;&t;     *      PCI IDSEL/INTPIN-&gt;INTLINE&n;&t;     *         A   B   C   D&n;&t;     */
(brace
(brace
l_int|18
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 14 - Enet 0 */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 15 - unused */
(brace
l_int|19
comma
l_int|19
comma
l_int|19
comma
l_int|19
)brace
comma
multiline_comment|/* IDSEL 16 - PMC Slot 1 */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 17 - unused */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 18 - unused */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 19 - unused */
(brace
l_int|24
comma
l_int|25
comma
l_int|26
comma
l_int|27
)brace
comma
multiline_comment|/* IDSEL 20 - P2P bridge (to cPCI 1) */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 21 - unused */
(brace
l_int|28
comma
l_int|29
comma
l_int|30
comma
l_int|31
)brace
multiline_comment|/* IDSEL 22 - P2P bridge (to cPCI 2) */
)brace
suffix:semicolon
r_const
r_int
id|min_idsel
op_assign
l_int|14
comma
id|max_idsel
op_assign
l_int|22
comma
id|irqs_per_slot
op_assign
l_int|4
suffix:semicolon
r_return
id|PCI_IRQ_TABLE_LOOKUP
suffix:semicolon
)brace
multiline_comment|/* Motorola Sitka */
r_static
r_inline
r_int
DECL|function|sitka_map_irq
id|sitka_map_irq
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
r_char
id|idsel
comma
r_int
r_char
id|pin
)paren
(brace
r_static
r_char
id|pci_irq_table
(braket
)braket
(braket
l_int|4
)braket
op_assign
multiline_comment|/*&n;&t;     *      MPIC interrupts for various IDSEL values (MPIC IRQ0 =&n;&t;     *      Linux IRQ16 (to leave room for ISA IRQs at 0-15).&n;&t;     *      PCI IDSEL/INTPIN-&gt;INTLINE&n;&t;     *         A   B   C   D&n;&t;     */
(brace
(brace
l_int|18
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 14 - Enet 0 */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 15 - unused */
(brace
l_int|25
comma
l_int|26
comma
l_int|27
comma
l_int|28
)brace
comma
multiline_comment|/* IDSEL 16 - PMC Slot 1 */
(brace
l_int|28
comma
l_int|25
comma
l_int|26
comma
l_int|27
)brace
comma
multiline_comment|/* IDSEL 17 - PMC Slot 2 */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 18 - unused */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 19 - unused */
(brace
l_int|20
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
multiline_comment|/* IDSEL 20 - P2P bridge (to cPCI) */
)brace
suffix:semicolon
r_const
r_int
id|min_idsel
op_assign
l_int|14
comma
id|max_idsel
op_assign
l_int|20
comma
id|irqs_per_slot
op_assign
l_int|4
suffix:semicolon
r_return
id|PCI_IRQ_TABLE_LOOKUP
suffix:semicolon
)brace
multiline_comment|/* Motorola MTX */
r_static
r_inline
r_int
DECL|function|MTX_map_irq
id|MTX_map_irq
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
r_char
id|idsel
comma
r_int
r_char
id|pin
)paren
(brace
r_static
r_char
id|pci_irq_table
(braket
)braket
(braket
l_int|4
)braket
op_assign
multiline_comment|/*&n;&t;     *      MPIC interrupts for various IDSEL values (MPIC IRQ0 =&n;&t;     *      Linux IRQ16 (to leave room for ISA IRQs at 0-15).&n;&t;     *      PCI IDSEL/INTPIN-&gt;INTLINE&n;&t;     *         A   B   C   D&n;&t;     */
(brace
(brace
l_int|19
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 12 - SCSI   */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 13 - unused */
(brace
l_int|18
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 14 - Enet   */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 15 - unused */
(brace
l_int|25
comma
l_int|26
comma
l_int|27
comma
l_int|28
)brace
comma
multiline_comment|/* IDSEL 16 - PMC Slot 1 */
(brace
l_int|26
comma
l_int|27
comma
l_int|28
comma
l_int|25
)brace
comma
multiline_comment|/* IDSEL 17 - PMC Slot 2 */
(brace
l_int|27
comma
l_int|28
comma
l_int|25
comma
l_int|26
)brace
multiline_comment|/* IDSEL 18 - PCI Slot 3 */
)brace
suffix:semicolon
r_const
r_int
id|min_idsel
op_assign
l_int|12
comma
id|max_idsel
op_assign
l_int|18
comma
id|irqs_per_slot
op_assign
l_int|4
suffix:semicolon
r_return
id|PCI_IRQ_TABLE_LOOKUP
suffix:semicolon
)brace
multiline_comment|/* Motorola MTX Plus */
multiline_comment|/* Secondary bus interrupt routing is not supported yet */
r_static
r_inline
r_int
DECL|function|MTXplus_map_irq
id|MTXplus_map_irq
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
r_char
id|idsel
comma
r_int
r_char
id|pin
)paren
(brace
r_static
r_char
id|pci_irq_table
(braket
)braket
(braket
l_int|4
)braket
op_assign
multiline_comment|/*&n;&t;     *      MPIC interrupts for various IDSEL values (MPIC IRQ0 =&n;&t;     *      Linux IRQ16 (to leave room for ISA IRQs at 0-15).&n;&t;     *      PCI IDSEL/INTPIN-&gt;INTLINE&n;&t;     *         A   B   C   D&n;&t;     */
(brace
(brace
l_int|19
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 12 - SCSI   */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 13 - unused */
(brace
l_int|18
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 14 - Enet 1 */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 15 - unused */
(brace
l_int|25
comma
l_int|26
comma
l_int|27
comma
l_int|28
)brace
comma
multiline_comment|/* IDSEL 16 - PCI Slot 1P */
(brace
l_int|26
comma
l_int|27
comma
l_int|28
comma
l_int|25
)brace
comma
multiline_comment|/* IDSEL 17 - PCI Slot 2P */
(brace
l_int|27
comma
l_int|28
comma
l_int|25
comma
l_int|26
)brace
comma
multiline_comment|/* IDSEL 18 - PCI Slot 3P */
(brace
l_int|26
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 19 - Enet 2 */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
multiline_comment|/* IDSEL 20 - P2P Bridge */
)brace
suffix:semicolon
r_const
r_int
id|min_idsel
op_assign
l_int|12
comma
id|max_idsel
op_assign
l_int|20
comma
id|irqs_per_slot
op_assign
l_int|4
suffix:semicolon
r_return
id|PCI_IRQ_TABLE_LOOKUP
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|Genesis2_map_irq
id|Genesis2_map_irq
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
r_char
id|idsel
comma
r_int
r_char
id|pin
)paren
(brace
multiline_comment|/* 2600&n;&t; * Raven 31&n;&t; * ISA   11&n;&t; * SCSI  12 - IRQ3&n;&t; * Univ  13&n;&t; * eth   14 - IRQ2&n;&t; * VGA   15 - IRQ4&n;&t; * PMC1  16 - IRQ9,10,11,12 = PMC1 A-D&n;&t; * PMC2  17 - IRQ12,9,10,11 = A-D&n;&t; * SCSI2 18 - IRQ11&n;&t; * eth2  19 - IRQ10&n;&t; * PCIX  20 - IRQ9,10,11,12 = PCI A-D&n;&t; */
multiline_comment|/* 2400&n;&t; * Hawk 31&n;&t; * ISA  11&n;&t; * Univ 13&n;&t; * eth  14 - IRQ2&n;&t; * PMC1 16 - IRQ9,10,11,12 = PMC A-D&n;&t; * PMC2 17 - IRQ12,9,10,11 = PMC A-D&n;&t; * PCIX 20 - IRQ9,10,11,12 = PMC A-D&n;&t; */
multiline_comment|/* 2300&n;&t; * Raven 31&n;&t; * ISA   11&n;&t; * Univ  13&n;&t; * eth   14 - IRQ2&n;&t; * PMC1  16 - 9,10,11,12 = A-D&n;&t; * PMC2  17 - 9,10,11,12 = B,C,D,A&n;&t; */
r_static
r_char
id|pci_irq_table
(braket
)braket
(braket
l_int|4
)braket
op_assign
multiline_comment|/*&n;&t;     *      MPIC interrupts for various IDSEL values (MPIC IRQ0 =&n;&t;     *      Linux IRQ16 (to leave room for ISA IRQs at 0-15).&n;&t;     *      PCI IDSEL/INTPIN-&gt;INTLINE&n;&t;     *         A   B   C   D&n;&t;     */
(brace
(brace
l_int|19
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 12 - SCSI   */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 13 - Universe PCI - VME */
(brace
l_int|18
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 14 - Enet 1 */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 15 - unused */
(brace
l_int|25
comma
l_int|26
comma
l_int|27
comma
l_int|28
)brace
comma
multiline_comment|/* IDSEL 16 - PCI/PMC Slot 1P */
(brace
l_int|28
comma
l_int|25
comma
l_int|26
comma
l_int|27
)brace
comma
multiline_comment|/* IDSEL 17 - PCI/PMC Slot 2P */
(brace
l_int|27
comma
l_int|28
comma
l_int|25
comma
l_int|26
)brace
comma
multiline_comment|/* IDSEL 18 - PCI Slot 3P */
(brace
l_int|26
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 19 - Enet 2 */
(brace
l_int|25
comma
l_int|26
comma
l_int|27
comma
l_int|28
)brace
multiline_comment|/* IDSEL 20 - P2P Bridge */
)brace
suffix:semicolon
r_const
r_int
id|min_idsel
op_assign
l_int|12
comma
id|max_idsel
op_assign
l_int|20
comma
id|irqs_per_slot
op_assign
l_int|4
suffix:semicolon
r_return
id|PCI_IRQ_TABLE_LOOKUP
suffix:semicolon
)brace
DECL|macro|MOTOROLA_CPUTYPE_REG
mdefine_line|#define MOTOROLA_CPUTYPE_REG&t;0x800
DECL|macro|MOTOROLA_BASETYPE_REG
mdefine_line|#define MOTOROLA_BASETYPE_REG&t;0x803
DECL|macro|MPIC_RAVEN_ID
mdefine_line|#define MPIC_RAVEN_ID&t;&t;0x48010000
DECL|macro|MPIC_HAWK_ID
mdefine_line|#define&t;MPIC_HAWK_ID&t;&t;0x48030000
DECL|macro|MOT_PROC2_BIT
mdefine_line|#define&t;MOT_PROC2_BIT&t;&t;0x800
DECL|variable|__initdata
r_static
id|u_char
id|pplus_openpic_initsenses
(braket
)braket
id|__initdata
op_assign
(brace
(paren
id|IRQ_SENSE_LEVEL
op_or
id|IRQ_POLARITY_POSITIVE
)paren
comma
multiline_comment|/* MVME2600_INT_SIO */
(paren
id|IRQ_SENSE_EDGE
op_or
id|IRQ_POLARITY_NEGATIVE
)paren
comma
multiline_comment|/*MVME2600_INT_FALCN_ECC_ERR */
(paren
id|IRQ_SENSE_LEVEL
op_or
id|IRQ_POLARITY_NEGATIVE
)paren
comma
multiline_comment|/*MVME2600_INT_PCI_ETHERNET */
(paren
id|IRQ_SENSE_LEVEL
op_or
id|IRQ_POLARITY_NEGATIVE
)paren
comma
multiline_comment|/* MVME2600_INT_PCI_SCSI */
(paren
id|IRQ_SENSE_LEVEL
op_or
id|IRQ_POLARITY_NEGATIVE
)paren
comma
multiline_comment|/*MVME2600_INT_PCI_GRAPHICS */
(paren
id|IRQ_SENSE_LEVEL
op_or
id|IRQ_POLARITY_NEGATIVE
)paren
comma
multiline_comment|/* MVME2600_INT_PCI_VME0 */
(paren
id|IRQ_SENSE_LEVEL
op_or
id|IRQ_POLARITY_NEGATIVE
)paren
comma
multiline_comment|/* MVME2600_INT_PCI_VME1 */
(paren
id|IRQ_SENSE_LEVEL
op_or
id|IRQ_POLARITY_NEGATIVE
)paren
comma
multiline_comment|/* MVME2600_INT_PCI_VME2 */
(paren
id|IRQ_SENSE_LEVEL
op_or
id|IRQ_POLARITY_NEGATIVE
)paren
comma
multiline_comment|/* MVME2600_INT_PCI_VME3 */
(paren
id|IRQ_SENSE_LEVEL
op_or
id|IRQ_POLARITY_NEGATIVE
)paren
comma
multiline_comment|/* MVME2600_INT_PCI_INTA */
(paren
id|IRQ_SENSE_LEVEL
op_or
id|IRQ_POLARITY_NEGATIVE
)paren
comma
multiline_comment|/* MVME2600_INT_PCI_INTB */
(paren
id|IRQ_SENSE_LEVEL
op_or
id|IRQ_POLARITY_NEGATIVE
)paren
comma
multiline_comment|/* MVME2600_INT_PCI_INTC */
(paren
id|IRQ_SENSE_LEVEL
op_or
id|IRQ_POLARITY_NEGATIVE
)paren
comma
multiline_comment|/* MVME2600_INT_PCI_INTD */
(paren
id|IRQ_SENSE_LEVEL
op_or
id|IRQ_POLARITY_NEGATIVE
)paren
comma
multiline_comment|/* MVME2600_INT_LM_SIG0 */
(paren
id|IRQ_SENSE_LEVEL
op_or
id|IRQ_POLARITY_NEGATIVE
)paren
comma
multiline_comment|/* MVME2600_INT_LM_SIG1 */
(paren
id|IRQ_SENSE_LEVEL
op_or
id|IRQ_POLARITY_NEGATIVE
)paren
comma
)brace
suffix:semicolon
DECL|variable|mot_entry
r_int
id|mot_entry
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|prep_keybd_present
r_int
id|prep_keybd_present
op_assign
l_int|1
suffix:semicolon
DECL|variable|mot_multi
r_int
id|mot_multi
op_assign
l_int|0
suffix:semicolon
DECL|struct|brd_info
r_struct
id|brd_info
(brace
multiline_comment|/* 0x100 mask assumes for Raven and Hawk boards that the level/edge&n;&t; * are set */
DECL|member|cpu_type
r_int
id|cpu_type
suffix:semicolon
multiline_comment|/* 0x200 if this board has a Hawk chip. */
DECL|member|base_type
r_int
id|base_type
suffix:semicolon
multiline_comment|/* or&squot;ed with 0x80 if this board should be checked for multi CPU */
DECL|member|max_cpu
r_int
id|max_cpu
suffix:semicolon
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|map_irq
r_int
(paren
op_star
id|map_irq
)paren
(paren
r_struct
id|pci_dev
op_star
comma
r_int
r_char
comma
r_int
r_char
)paren
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|mot_info
r_struct
id|brd_info
id|mot_info
(braket
)braket
op_assign
(brace
(brace
l_int|0x300
comma
l_int|0x00
comma
l_int|0x00
comma
l_string|&quot;MVME 2400&quot;
comma
id|Genesis2_map_irq
)brace
comma
(brace
l_int|0x1E0
comma
l_int|0xE0
comma
l_int|0x00
comma
l_string|&quot;Mesquite cPCI (MCP750)&quot;
comma
id|mesquite_map_irq
)brace
comma
(brace
l_int|0x1E0
comma
l_int|0xE1
comma
l_int|0x00
comma
l_string|&quot;Sitka cPCI (MCPN750)&quot;
comma
id|sitka_map_irq
)brace
comma
(brace
l_int|0x1E0
comma
l_int|0xE2
comma
l_int|0x00
comma
l_string|&quot;Mesquite cPCI (MCP750) w/ HAC&quot;
comma
id|mesquite_map_irq
)brace
comma
(brace
l_int|0x1E0
comma
l_int|0xF6
comma
l_int|0x80
comma
l_string|&quot;MTX Plus&quot;
comma
id|MTXplus_map_irq
)brace
comma
(brace
l_int|0x1E0
comma
l_int|0xF6
comma
l_int|0x81
comma
l_string|&quot;Dual MTX Plus&quot;
comma
id|MTXplus_map_irq
)brace
comma
(brace
l_int|0x1E0
comma
l_int|0xF7
comma
l_int|0x80
comma
l_string|&quot;MTX wo/ Parallel Port&quot;
comma
id|MTX_map_irq
)brace
comma
(brace
l_int|0x1E0
comma
l_int|0xF7
comma
l_int|0x81
comma
l_string|&quot;Dual MTX wo/ Parallel Port&quot;
comma
id|MTX_map_irq
)brace
comma
(brace
l_int|0x1E0
comma
l_int|0xF8
comma
l_int|0x80
comma
l_string|&quot;MTX w/ Parallel Port&quot;
comma
id|MTX_map_irq
)brace
comma
(brace
l_int|0x1E0
comma
l_int|0xF8
comma
l_int|0x81
comma
l_string|&quot;Dual MTX w/ Parallel Port&quot;
comma
id|MTX_map_irq
)brace
comma
(brace
l_int|0x1E0
comma
l_int|0xF9
comma
l_int|0x00
comma
l_string|&quot;MVME 2300&quot;
comma
id|Genesis2_map_irq
)brace
comma
(brace
l_int|0x1E0
comma
l_int|0xFA
comma
l_int|0x00
comma
l_string|&quot;MVME 2300SC/2600&quot;
comma
id|Genesis2_map_irq
)brace
comma
(brace
l_int|0x1E0
comma
l_int|0xFB
comma
l_int|0x00
comma
l_string|&quot;MVME 2600 with MVME712M&quot;
comma
id|Genesis2_map_irq
)brace
comma
(brace
l_int|0x1E0
comma
l_int|0xFC
comma
l_int|0x00
comma
l_string|&quot;MVME 2600/2700 with MVME761&quot;
comma
id|Genesis2_map_irq
)brace
comma
(brace
l_int|0x1E0
comma
l_int|0xFD
comma
l_int|0x80
comma
l_string|&quot;MVME 3600 with MVME712M&quot;
comma
id|Genesis2_map_irq
)brace
comma
(brace
l_int|0x1E0
comma
l_int|0xFD
comma
l_int|0x81
comma
l_string|&quot;MVME 4600 with MVME712M&quot;
comma
id|Genesis2_map_irq
)brace
comma
(brace
l_int|0x1E0
comma
l_int|0xFE
comma
l_int|0x80
comma
l_string|&quot;MVME 3600 with MVME761&quot;
comma
id|Genesis2_map_irq
)brace
comma
(brace
l_int|0x1E0
comma
l_int|0xFE
comma
l_int|0x81
comma
l_string|&quot;MVME 4600 with MVME761&quot;
comma
id|Genesis2_map_irq
)brace
comma
(brace
l_int|0x000
comma
l_int|0x00
comma
l_int|0x00
comma
l_string|&quot;&quot;
comma
l_int|NULL
)brace
)brace
suffix:semicolon
DECL|function|pplus_set_board_type
r_void
id|__init
id|pplus_set_board_type
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|cpu_type
suffix:semicolon
r_int
r_char
id|base_mod
suffix:semicolon
r_int
id|entry
suffix:semicolon
r_int
r_int
id|devid
suffix:semicolon
r_int
r_int
op_star
id|ProcInfo
op_assign
l_int|NULL
suffix:semicolon
id|cpu_type
op_assign
id|inb
c_func
(paren
id|MOTOROLA_CPUTYPE_REG
)paren
op_amp
l_int|0xF0
suffix:semicolon
id|base_mod
op_assign
id|inb
c_func
(paren
id|MOTOROLA_BASETYPE_REG
)paren
suffix:semicolon
id|early_read_config_word
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|PCI_VENDOR_ID
comma
op_amp
id|devid
)paren
suffix:semicolon
r_for
c_loop
(paren
id|entry
op_assign
l_int|0
suffix:semicolon
id|mot_info
(braket
id|entry
)braket
dot
id|cpu_type
op_ne
l_int|0
suffix:semicolon
id|entry
op_increment
)paren
(brace
multiline_comment|/* Check for Hawk chip */
r_if
c_cond
(paren
id|mot_info
(braket
id|entry
)braket
dot
id|cpu_type
op_amp
l_int|0x200
)paren
(brace
r_if
c_cond
(paren
id|devid
op_ne
id|PCI_DEVICE_ID_MOTOROLA_HAWK
)paren
r_continue
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* store the system config register for later use. */
id|ProcInfo
op_assign
(paren
r_int
r_int
op_star
)paren
id|ioremap
c_func
(paren
id|PPLUS_SYS_CONFIG_REG
comma
l_int|4
)paren
suffix:semicolon
multiline_comment|/* Check non hawk boards */
r_if
c_cond
(paren
(paren
id|mot_info
(braket
id|entry
)braket
dot
id|cpu_type
op_amp
l_int|0xff
)paren
op_ne
id|cpu_type
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|mot_info
(braket
id|entry
)braket
dot
id|base_type
op_eq
l_int|0
)paren
(brace
id|mot_entry
op_assign
id|entry
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mot_info
(braket
id|entry
)braket
dot
id|base_type
op_ne
id|base_mod
)paren
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|mot_info
(braket
id|entry
)braket
dot
id|max_cpu
op_amp
l_int|0x80
)paren
)paren
(brace
id|mot_entry
op_assign
id|entry
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* processor 1 not present and max processor zero indicated */
r_if
c_cond
(paren
(paren
op_star
id|ProcInfo
op_amp
id|MOT_PROC2_BIT
)paren
op_logical_and
op_logical_neg
(paren
id|mot_info
(braket
id|entry
)braket
dot
id|max_cpu
op_amp
l_int|0x7f
)paren
)paren
(brace
id|mot_entry
op_assign
id|entry
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* processor 1 present and max processor zero indicated */
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|ProcInfo
op_amp
id|MOT_PROC2_BIT
)paren
op_logical_and
(paren
id|mot_info
(braket
id|entry
)braket
dot
id|max_cpu
op_amp
l_int|0x7f
)paren
)paren
(brace
id|mot_entry
op_assign
id|entry
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Indicate to system if this is a multiprocessor board */
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|ProcInfo
op_amp
id|MOT_PROC2_BIT
)paren
)paren
id|mot_multi
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mot_entry
op_eq
op_minus
l_int|1
)paren
multiline_comment|/* No particular cpu type found - assume Mesquite (MCP750) */
id|mot_entry
op_assign
l_int|1
suffix:semicolon
id|Motherboard_map_name
op_assign
(paren
r_int
r_char
op_star
)paren
id|mot_info
(braket
id|mot_entry
)braket
dot
id|name
suffix:semicolon
id|ppc_md.pci_map_irq
op_assign
id|mot_info
(braket
id|mot_entry
)braket
dot
id|map_irq
suffix:semicolon
)brace
DECL|function|pplus_pib_init
r_void
id|__init
id|pplus_pib_init
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|reg
suffix:semicolon
r_int
r_int
id|short_reg
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;&t; * Perform specific configuration for the Via Tech or&n;&t; * or Winbond PCI-ISA-Bridge part.&n;&t; */
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_VIA
comma
id|PCI_DEVICE_ID_VIA_82C586_1
comma
id|dev
)paren
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * PPCBUG does not set the enable bits&n;&t;&t; * for the IDE device. Force them on here.&n;&t;&t; */
id|pci_read_config_byte
c_func
(paren
id|dev
comma
l_int|0x40
comma
op_amp
id|reg
)paren
suffix:semicolon
id|reg
op_or_assign
l_int|0x03
suffix:semicolon
multiline_comment|/* IDE: Chip Enable Bits */
id|pci_write_config_byte
c_func
(paren
id|dev
comma
l_int|0x40
comma
id|reg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_VIA
comma
id|PCI_DEVICE_ID_VIA_82C586_2
comma
id|dev
)paren
)paren
op_logical_and
(paren
id|dev-&gt;devfn
op_assign
l_int|0x5a
)paren
)paren
(brace
multiline_comment|/* Force correct USB interrupt */
id|dev-&gt;irq
op_assign
l_int|11
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|dev
comma
id|PCI_INTERRUPT_LINE
comma
id|dev-&gt;irq
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_WINBOND
comma
id|PCI_DEVICE_ID_WINBOND_83C553
comma
id|dev
)paren
)paren
)paren
(brace
multiline_comment|/* Clear PCI Interrupt Routing Control Register. */
id|short_reg
op_assign
l_int|0x0000
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|dev
comma
l_int|0x44
comma
id|short_reg
)paren
suffix:semicolon
multiline_comment|/* Route IDE interrupts to IRQ 14 */
id|reg
op_assign
l_int|0xEE
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|dev
comma
l_int|0x43
comma
id|reg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_WINBOND
comma
id|PCI_DEVICE_ID_WINBOND_82C105
comma
id|dev
)paren
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * Disable LEGIRQ mode so PCI INTS are routed&n;&t;&t; * directly to the 8259 and enable both channels&n;&t;&t; */
id|pci_write_config_dword
c_func
(paren
id|dev
comma
l_int|0x40
comma
l_int|0x10ff0033
)paren
suffix:semicolon
multiline_comment|/* Force correct IDE interrupt */
id|dev-&gt;irq
op_assign
l_int|14
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|dev
comma
id|PCI_INTERRUPT_LINE
comma
id|dev-&gt;irq
)paren
suffix:semicolon
)brace
)brace
DECL|function|pplus_set_VIA_IDE_legacy
r_void
id|__init
id|pplus_set_VIA_IDE_legacy
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|vend
comma
id|dev
suffix:semicolon
id|early_read_config_word
c_func
(paren
l_int|0
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0xb
comma
l_int|1
)paren
comma
id|PCI_VENDOR_ID
comma
op_amp
id|vend
)paren
suffix:semicolon
id|early_read_config_word
c_func
(paren
l_int|0
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0xb
comma
l_int|1
)paren
comma
id|PCI_DEVICE_ID
comma
op_amp
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vend
op_eq
id|PCI_VENDOR_ID_VIA
)paren
op_logical_and
(paren
id|dev
op_eq
id|PCI_DEVICE_ID_VIA_82C586_1
)paren
)paren
(brace
r_int
r_char
id|temp
suffix:semicolon
multiline_comment|/* put back original &quot;standard&quot; port base addresses */
id|early_write_config_dword
c_func
(paren
l_int|0
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0xb
comma
l_int|1
)paren
comma
id|PCI_BASE_ADDRESS_0
comma
l_int|0x1f1
)paren
suffix:semicolon
id|early_write_config_dword
c_func
(paren
l_int|0
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0xb
comma
l_int|1
)paren
comma
id|PCI_BASE_ADDRESS_1
comma
l_int|0x3f5
)paren
suffix:semicolon
id|early_write_config_dword
c_func
(paren
l_int|0
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0xb
comma
l_int|1
)paren
comma
id|PCI_BASE_ADDRESS_2
comma
l_int|0x171
)paren
suffix:semicolon
id|early_write_config_dword
c_func
(paren
l_int|0
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0xb
comma
l_int|1
)paren
comma
id|PCI_BASE_ADDRESS_3
comma
l_int|0x375
)paren
suffix:semicolon
id|early_write_config_dword
c_func
(paren
l_int|0
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0xb
comma
l_int|1
)paren
comma
id|PCI_BASE_ADDRESS_4
comma
l_int|0xcc01
)paren
suffix:semicolon
multiline_comment|/* put into legacy mode */
id|early_read_config_byte
c_func
(paren
l_int|0
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0xb
comma
l_int|1
)paren
comma
id|PCI_CLASS_PROG
comma
op_amp
id|temp
)paren
suffix:semicolon
id|temp
op_and_assign
op_complement
l_int|0x05
suffix:semicolon
id|early_write_config_byte
c_func
(paren
l_int|0
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0xb
comma
l_int|1
)paren
comma
id|PCI_CLASS_PROG
comma
id|temp
)paren
suffix:semicolon
)brace
)brace
DECL|function|pplus_set_VIA_IDE_native
r_void
id|pplus_set_VIA_IDE_native
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|vend
comma
id|dev
suffix:semicolon
id|early_read_config_word
c_func
(paren
l_int|0
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0xb
comma
l_int|1
)paren
comma
id|PCI_VENDOR_ID
comma
op_amp
id|vend
)paren
suffix:semicolon
id|early_read_config_word
c_func
(paren
l_int|0
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0xb
comma
l_int|1
)paren
comma
id|PCI_DEVICE_ID
comma
op_amp
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vend
op_eq
id|PCI_VENDOR_ID_VIA
)paren
op_logical_and
(paren
id|dev
op_eq
id|PCI_DEVICE_ID_VIA_82C586_1
)paren
)paren
(brace
r_int
r_char
id|temp
suffix:semicolon
multiline_comment|/* put into native mode */
id|early_read_config_byte
c_func
(paren
l_int|0
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0xb
comma
l_int|1
)paren
comma
id|PCI_CLASS_PROG
comma
op_amp
id|temp
)paren
suffix:semicolon
id|temp
op_or_assign
l_int|0x05
suffix:semicolon
id|early_write_config_byte
c_func
(paren
l_int|0
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0xb
comma
l_int|1
)paren
comma
id|PCI_CLASS_PROG
comma
id|temp
)paren
suffix:semicolon
)brace
)brace
DECL|function|pplus_pcibios_fixup
r_void
id|__init
id|pplus_pcibios_fixup
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|reg
suffix:semicolon
r_int
r_int
id|devid
suffix:semicolon
r_int
r_char
id|base_mod
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Setting PCI interrupts for a &bslash;&quot;%s&bslash;&quot;&bslash;n&quot;
comma
id|Motherboard_map_name
)paren
suffix:semicolon
multiline_comment|/* Setup the Winbond or Via PIB */
id|pplus_pib_init
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Set up floppy in PS/2 mode */
id|outb
c_func
(paren
l_int|0x09
comma
id|SIO_CONFIG_RA
)paren
suffix:semicolon
id|reg
op_assign
id|inb
c_func
(paren
id|SIO_CONFIG_RD
)paren
suffix:semicolon
id|reg
op_assign
(paren
id|reg
op_amp
l_int|0x3F
)paren
op_or
l_int|0x40
suffix:semicolon
id|outb
c_func
(paren
id|reg
comma
id|SIO_CONFIG_RD
)paren
suffix:semicolon
id|outb
c_func
(paren
id|reg
comma
id|SIO_CONFIG_RD
)paren
suffix:semicolon
multiline_comment|/* Have to write twice to change! */
multiline_comment|/* This is a hack.  If this is a 2300 or 2400 mot board then there is&n;&t; * no keyboard controller and we have to indicate that.&n;&t; */
id|early_read_config_word
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|PCI_VENDOR_ID
comma
op_amp
id|devid
)paren
suffix:semicolon
id|base_mod
op_assign
id|inb
c_func
(paren
id|MOTOROLA_BASETYPE_REG
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|devid
op_eq
id|PCI_DEVICE_ID_MOTOROLA_HAWK
)paren
op_logical_or
(paren
id|base_mod
op_eq
l_int|0xF9
)paren
op_logical_or
(paren
id|base_mod
op_eq
l_int|0xFA
)paren
op_logical_or
(paren
id|base_mod
op_eq
l_int|0xE1
)paren
)paren
id|prep_keybd_present
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|pplus_find_bridges
r_void
id|__init
id|pplus_find_bridges
c_func
(paren
r_void
)paren
(brace
r_struct
id|pci_controller
op_star
id|hose
suffix:semicolon
id|hose
op_assign
id|pcibios_alloc_controller
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hose
)paren
r_return
suffix:semicolon
id|hose-&gt;first_busno
op_assign
l_int|0
suffix:semicolon
id|hose-&gt;last_busno
op_assign
l_int|0xff
suffix:semicolon
id|hose-&gt;pci_mem_offset
op_assign
id|PREP_ISA_MEM_BASE
suffix:semicolon
id|hose-&gt;io_base_virt
op_assign
(paren
r_void
op_star
)paren
id|PREP_ISA_IO_BASE
suffix:semicolon
id|pci_init_resource
c_func
(paren
op_amp
id|hose-&gt;io_resource
comma
id|PPLUS_PCI_IO_START
comma
id|PPLUS_PCI_IO_END
comma
id|IORESOURCE_IO
comma
l_string|&quot;PCI host bridge&quot;
)paren
suffix:semicolon
id|pci_init_resource
c_func
(paren
op_amp
id|hose-&gt;mem_resources
(braket
l_int|0
)braket
comma
id|PPLUS_PROC_PCI_MEM_START
comma
id|PPLUS_PROC_PCI_MEM_END
comma
id|IORESOURCE_MEM
comma
l_string|&quot;PCI host bridge&quot;
)paren
suffix:semicolon
id|hose-&gt;io_space.start
op_assign
id|PPLUS_PCI_IO_START
suffix:semicolon
id|hose-&gt;io_space.end
op_assign
id|PPLUS_PCI_IO_END
suffix:semicolon
id|hose-&gt;mem_space.start
op_assign
id|PPLUS_PCI_MEM_START
suffix:semicolon
id|hose-&gt;mem_space.end
op_assign
id|PPLUS_PCI_MEM_END
op_minus
id|HAWK_MPIC_SIZE
suffix:semicolon
r_if
c_cond
(paren
id|hawk_init
c_func
(paren
id|hose
comma
id|PPLUS_HAWK_PPC_REG_BASE
comma
id|PPLUS_PROC_PCI_MEM_START
comma
id|PPLUS_PROC_PCI_MEM_END
op_minus
id|HAWK_MPIC_SIZE
comma
id|PPLUS_PROC_PCI_IO_START
comma
id|PPLUS_PROC_PCI_IO_END
comma
id|PPLUS_PROC_PCI_MEM_END
op_minus
id|HAWK_MPIC_SIZE
op_plus
l_int|1
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;Could not initialize host bridge&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|pplus_set_VIA_IDE_legacy
c_func
(paren
)paren
suffix:semicolon
id|hose-&gt;last_busno
op_assign
id|pciauto_bus_scan
c_func
(paren
id|hose
comma
id|hose-&gt;first_busno
)paren
suffix:semicolon
id|ppc_md.pcibios_fixup
op_assign
id|pplus_pcibios_fixup
suffix:semicolon
id|ppc_md.pci_swizzle
op_assign
id|common_swizzle
suffix:semicolon
)brace
DECL|function|pplus_show_cpuinfo
r_static
r_int
id|pplus_show_cpuinfo
c_func
(paren
r_struct
id|seq_file
op_star
id|m
)paren
(brace
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;vendor&bslash;t&bslash;t: Motorola MCG&bslash;n&quot;
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;machine&bslash;t&bslash;t: %s&bslash;n&quot;
comma
id|Motherboard_map_name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pplus_setup_arch
r_static
r_void
id|__init
id|pplus_setup_arch
c_func
(paren
r_void
)paren
(brace
r_struct
id|pci_controller
op_star
id|hose
suffix:semicolon
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;pplus_setup_arch: enter&quot;
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* init to some ~sane value until calibrate_delay() runs */
id|loops_per_jiffy
op_assign
l_int|50000000
suffix:semicolon
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;pplus_setup_arch: find_bridges&quot;
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Setup PCI host bridge */
id|pplus_find_bridges
c_func
(paren
)paren
suffix:semicolon
id|hose
op_assign
id|pci_bus_to_hose
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|isa_io_base
op_assign
(paren
id|ulong
)paren
id|hose-&gt;io_base_virt
suffix:semicolon
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;pplus_setup_arch: set_board_type&quot;
comma
l_int|0
)paren
suffix:semicolon
id|pplus_set_board_type
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Enable L2.  Assume we don&squot;t need to flush -- Cort */
op_star
(paren
r_int
r_char
op_star
)paren
(paren
id|PPLUS_L2_CONTROL_REG
)paren
op_or_assign
l_int|3
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_INITRD
r_if
c_cond
(paren
id|initrd_start
)paren
id|ROOT_DEV
op_assign
id|Root_RAM0
suffix:semicolon
r_else
macro_line|#endif
macro_line|#ifdef CONFIG_ROOT_NFS
id|ROOT_DEV
op_assign
id|Root_NFS
suffix:semicolon
macro_line|#else
id|ROOT_DEV
op_assign
id|Root_SDA2
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Motorola PowerPlus Platform&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Port by MontaVista Software, Inc. (source@mvista.com)&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_VGA_CONSOLE
multiline_comment|/* remap the VGA memory */
id|vgacon_remap_base
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|PPLUS_ISA_MEM_BASE
comma
l_int|0x08000000
)paren
suffix:semicolon
id|conswitchp
op_assign
op_amp
id|vga_con
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_PPCBUG_NVRAM
multiline_comment|/* Read in NVRAM data */
id|init_prep_nvram
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* if no bootargs, look in NVRAM */
r_if
c_cond
(paren
id|cmd_line
(braket
l_int|0
)braket
op_eq
l_char|&squot;&bslash;0&squot;
)paren
(brace
r_char
op_star
id|bootargs
suffix:semicolon
id|bootargs
op_assign
id|prep_nvram_get_var
c_func
(paren
l_string|&quot;bootargs&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bootargs
op_ne
l_int|NULL
)paren
(brace
id|strcpy
c_func
(paren
id|cmd_line
comma
id|bootargs
)paren
suffix:semicolon
multiline_comment|/* again.. */
id|strcpy
c_func
(paren
id|saved_command_line
comma
id|cmd_line
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;pplus_setup_arch: exit&quot;
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|pplus_restart
r_static
r_void
id|pplus_restart
c_func
(paren
r_char
op_star
id|cmd
)paren
(brace
r_int
r_int
id|i
op_assign
l_int|10000
suffix:semicolon
id|local_irq_disable
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* set VIA IDE controller into native mode */
id|pplus_set_VIA_IDE_native
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* set exception prefix high - to the prom */
id|_nmask_and_or_msr
c_func
(paren
l_int|0
comma
id|MSR_IP
)paren
suffix:semicolon
multiline_comment|/* make sure bit 0 (reset) is a 0 */
id|outb
c_func
(paren
id|inb
c_func
(paren
l_int|0x92
)paren
op_amp
op_complement
l_int|1L
comma
l_int|0x92
)paren
suffix:semicolon
multiline_comment|/* signal a reset to system control port A - soft reset */
id|outb
c_func
(paren
id|inb
c_func
(paren
l_int|0x92
)paren
op_or
l_int|1
comma
l_int|0x92
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
op_ne
l_int|0
)paren
id|i
op_increment
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;restart failed&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|pplus_halt
r_static
r_void
id|pplus_halt
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* set exception prefix high - to the prom */
id|_nmask_and_or_msr
c_func
(paren
id|MSR_EE
comma
id|MSR_IP
)paren
suffix:semicolon
multiline_comment|/* make sure bit 0 (reset) is a 0 */
id|outb
c_func
(paren
id|inb
c_func
(paren
l_int|0x92
)paren
op_amp
op_complement
l_int|1L
comma
l_int|0x92
)paren
suffix:semicolon
multiline_comment|/* signal a reset to system control port A - soft reset */
id|outb
c_func
(paren
id|inb
c_func
(paren
l_int|0x92
)paren
op_or
l_int|1
comma
l_int|0x92
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Not reached&n;&t; */
)brace
DECL|function|pplus_power_off
r_static
r_void
id|pplus_power_off
c_func
(paren
r_void
)paren
(brace
id|pplus_halt
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|pplus_irq_canonicalize
r_static
r_int
r_int
id|pplus_irq_canonicalize
c_func
(paren
id|u_int
id|irq
)paren
(brace
r_if
c_cond
(paren
id|irq
op_eq
l_int|2
)paren
r_return
l_int|9
suffix:semicolon
r_else
r_return
id|irq
suffix:semicolon
)brace
DECL|function|pplus_init_IRQ
r_static
r_void
id|__init
id|pplus_init_IRQ
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;init_irq: enter&quot;
comma
l_int|0
)paren
suffix:semicolon
id|OpenPIC_InitSenses
op_assign
id|pplus_openpic_initsenses
suffix:semicolon
id|OpenPIC_NumInitSenses
op_assign
r_sizeof
(paren
id|pplus_openpic_initsenses
)paren
suffix:semicolon
r_if
c_cond
(paren
id|OpenPIC_Addr
op_ne
l_int|NULL
)paren
(brace
id|openpic_set_sources
c_func
(paren
l_int|0
comma
l_int|16
comma
id|OpenPIC_Addr
op_plus
l_int|0x10000
)paren
suffix:semicolon
id|openpic_init
c_func
(paren
id|NUM_8259_INTERRUPTS
)paren
suffix:semicolon
id|openpic_hookup_cascade
c_func
(paren
id|NUM_8259_INTERRUPTS
comma
l_string|&quot;82c59 cascade&quot;
comma
id|i8259_irq
)paren
suffix:semicolon
id|ppc_md.get_irq
op_assign
id|openpic_get_irq
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_8259_INTERRUPTS
suffix:semicolon
id|i
op_increment
)paren
id|irq_desc
(braket
id|i
)braket
dot
id|handler
op_assign
op_amp
id|i8259_pic
suffix:semicolon
id|i8259_init
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;init_irq: exit&quot;
comma
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_BLK_DEV_IDE) || defined(CONFIG_BLK_DEV_IDE_MODULE)
multiline_comment|/*&n; * IDE stuff.&n; */
DECL|function|pplus_ide_default_irq
r_static
r_int
id|pplus_ide_default_irq
c_func
(paren
r_int
r_int
id|base
)paren
(brace
r_switch
c_cond
(paren
id|base
)paren
(brace
r_case
l_int|0x1f0
suffix:colon
r_return
l_int|14
suffix:semicolon
r_case
l_int|0x170
suffix:colon
r_return
l_int|15
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|pplus_ide_default_io_base
r_static
r_int
r_int
id|pplus_ide_default_io_base
c_func
(paren
r_int
id|index
)paren
(brace
r_switch
c_cond
(paren
id|index
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
l_int|0x1f0
suffix:semicolon
r_case
l_int|1
suffix:colon
r_return
l_int|0x170
suffix:semicolon
r_default
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_static
r_void
id|__init
DECL|function|pplus_ide_init_hwif_ports
id|pplus_ide_init_hwif_ports
c_func
(paren
id|hw_regs_t
op_star
id|hw
comma
r_int
r_int
id|data_port
comma
r_int
r_int
id|ctrl_port
comma
r_int
op_star
id|irq
)paren
(brace
r_int
r_int
id|reg
op_assign
id|data_port
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|IDE_DATA_OFFSET
suffix:semicolon
id|i
op_le
id|IDE_STATUS_OFFSET
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hw-&gt;io_ports
(braket
id|i
)braket
op_assign
id|reg
suffix:semicolon
id|reg
op_add_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ctrl_port
)paren
id|hw-&gt;io_ports
(braket
id|IDE_CONTROL_OFFSET
)braket
op_assign
id|ctrl_port
suffix:semicolon
r_else
id|hw-&gt;io_ports
(braket
id|IDE_CONTROL_OFFSET
)braket
op_assign
id|hw-&gt;io_ports
(braket
id|IDE_DATA_OFFSET
)braket
op_plus
l_int|0x206
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_ne
l_int|NULL
)paren
op_star
id|irq
op_assign
id|pplus_ide_default_irq
c_func
(paren
id|data_port
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_SMP
multiline_comment|/* PowerPlus (MTX) support */
DECL|function|smp_pplus_probe
r_static
r_int
id|__init
id|smp_pplus_probe
c_func
(paren
r_void
)paren
(brace
r_extern
r_int
id|mot_multi
suffix:semicolon
r_if
c_cond
(paren
id|mot_multi
)paren
(brace
id|openpic_request_IPIs
c_func
(paren
)paren
suffix:semicolon
id|smp_hw_index
(braket
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
r_return
l_int|2
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|smp_pplus_kick_cpu
r_static
r_void
id|__init
id|smp_pplus_kick_cpu
c_func
(paren
r_int
id|nr
)paren
(brace
op_star
(paren
r_int
r_int
op_star
)paren
id|KERNELBASE
op_assign
id|nr
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;dcbf 0,%0&quot;
op_scope_resolution
l_string|&quot;r&quot;
(paren
id|KERNELBASE
)paren
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;CPU1 reset, waiting&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|smp_pplus_setup_cpu
r_static
r_void
id|__init
id|smp_pplus_setup_cpu
c_func
(paren
r_int
id|cpu_nr
)paren
(brace
r_if
c_cond
(paren
id|OpenPIC_Addr
)paren
id|do_openpic_setup_cpu
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|pplus_smp_ops
r_static
r_struct
id|smp_ops_t
id|pplus_smp_ops
op_assign
(brace
id|smp_openpic_message_pass
comma
id|smp_pplus_probe
comma
id|smp_pplus_kick_cpu
comma
id|smp_pplus_setup_cpu
comma
dot
id|give_timebase
op_assign
id|smp_generic_give_timebase
comma
dot
id|take_timebase
op_assign
id|smp_generic_take_timebase
comma
)brace
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;/* CONFIG_SMP */
macro_line|#ifdef DUMP_DBATS
DECL|function|print_dbat
r_static
r_void
id|print_dbat
c_func
(paren
r_int
id|idx
comma
id|u32
id|bat
)paren
(brace
r_char
id|str
(braket
l_int|64
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|str
comma
l_string|&quot;DBAT%c%c = 0x%08x&bslash;n&quot;
comma
(paren
r_char
)paren
(paren
(paren
id|idx
op_minus
id|DBAT0U
)paren
op_div
l_int|2
)paren
op_plus
l_char|&squot;0&squot;
comma
(paren
id|idx
op_amp
l_int|1
)paren
ques
c_cond
l_char|&squot;L&squot;
suffix:colon
l_char|&squot;U&squot;
comma
id|bat
)paren
suffix:semicolon
id|ppc_md
dot
id|progress
c_func
(paren
id|str
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|macro|DUMP_DBAT
mdefine_line|#define DUMP_DBAT(x) &bslash;&n;&t;do { &bslash;&n;&t;u32 __temp = mfspr(x);&bslash;&n;&t;print_dbat(x, __temp); &bslash;&n;&t;} while (0)
DECL|function|dump_dbats
r_static
r_void
id|dump_dbats
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|ppc_md.progress
)paren
(brace
id|DUMP_DBAT
c_func
(paren
id|DBAT0U
)paren
suffix:semicolon
id|DUMP_DBAT
c_func
(paren
id|DBAT0L
)paren
suffix:semicolon
id|DUMP_DBAT
c_func
(paren
id|DBAT1U
)paren
suffix:semicolon
id|DUMP_DBAT
c_func
(paren
id|DBAT1L
)paren
suffix:semicolon
id|DUMP_DBAT
c_func
(paren
id|DBAT2U
)paren
suffix:semicolon
id|DUMP_DBAT
c_func
(paren
id|DBAT2L
)paren
suffix:semicolon
id|DUMP_DBAT
c_func
(paren
id|DBAT3U
)paren
suffix:semicolon
id|DUMP_DBAT
c_func
(paren
id|DBAT3L
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
DECL|function|pplus_find_end_of_memory
r_static
r_int
r_int
id|__init
id|pplus_find_end_of_memory
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|total
suffix:semicolon
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;pplus_find_end_of_memory&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef DUMP_DBATS
id|dump_dbats
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|total
op_assign
id|hawk_get_mem_size
c_func
(paren
id|PPLUS_HAWK_SMC_BASE
)paren
suffix:semicolon
r_return
(paren
id|total
)paren
suffix:semicolon
)brace
DECL|function|pplus_map_io
r_static
r_void
id|__init
id|pplus_map_io
c_func
(paren
r_void
)paren
(brace
id|io_block_mapping
c_func
(paren
id|PPLUS_ISA_IO_BASE
comma
id|PPLUS_ISA_IO_BASE
comma
l_int|0x10000000
comma
id|_PAGE_IO
)paren
suffix:semicolon
id|io_block_mapping
c_func
(paren
l_int|0xfef80000
comma
l_int|0xfef80000
comma
l_int|0x00080000
comma
id|_PAGE_IO
)paren
suffix:semicolon
)brace
DECL|function|pplus_init2
r_static
r_void
id|__init
id|pplus_init2
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_NVRAM
id|request_region
c_func
(paren
id|PREP_NVRAM_AS0
comma
l_int|0x8
comma
l_string|&quot;nvram&quot;
)paren
suffix:semicolon
macro_line|#endif
id|request_region
c_func
(paren
l_int|0x20
comma
l_int|0x20
comma
l_string|&quot;pic1&quot;
)paren
suffix:semicolon
id|request_region
c_func
(paren
l_int|0xa0
comma
l_int|0x20
comma
l_string|&quot;pic2&quot;
)paren
suffix:semicolon
id|request_region
c_func
(paren
l_int|0x00
comma
l_int|0x20
comma
l_string|&quot;dma1&quot;
)paren
suffix:semicolon
id|request_region
c_func
(paren
l_int|0x40
comma
l_int|0x20
comma
l_string|&quot;timer&quot;
)paren
suffix:semicolon
id|request_region
c_func
(paren
l_int|0x80
comma
l_int|0x10
comma
l_string|&quot;dma page reg&quot;
)paren
suffix:semicolon
id|request_region
c_func
(paren
l_int|0xc0
comma
l_int|0x20
comma
l_string|&quot;dma2&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Set BAT 2 to access 0x8000000 so progress messages will work and set BAT 3&n; * to 0xf0000000 to access Falcon/Raven or Hawk registers&n; */
DECL|function|pplus_set_bat
r_static
id|__inline__
r_void
id|pplus_set_bat
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* wait for all outstanding memory accesses to complete */
id|mb
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* setup DBATs */
id|mtspr
c_func
(paren
id|DBAT2U
comma
l_int|0x80001ffe
)paren
suffix:semicolon
id|mtspr
c_func
(paren
id|DBAT2L
comma
l_int|0x8000002a
)paren
suffix:semicolon
id|mtspr
c_func
(paren
id|DBAT3U
comma
l_int|0xf0001ffe
)paren
suffix:semicolon
id|mtspr
c_func
(paren
id|DBAT3L
comma
l_int|0xf000002a
)paren
suffix:semicolon
multiline_comment|/* wait for updates */
id|mb
c_func
(paren
)paren
suffix:semicolon
)brace
r_void
id|__init
DECL|function|platform_init
id|platform_init
c_func
(paren
r_int
r_int
id|r3
comma
r_int
r_int
id|r4
comma
r_int
r_int
id|r5
comma
r_int
r_int
id|r6
comma
r_int
r_int
id|r7
)paren
(brace
id|parse_bootinfo
c_func
(paren
id|find_bootinfo
c_func
(paren
)paren
)paren
suffix:semicolon
multiline_comment|/* Map in board regs, etc. */
id|pplus_set_bat
c_func
(paren
)paren
suffix:semicolon
id|isa_io_base
op_assign
id|PREP_ISA_IO_BASE
suffix:semicolon
id|isa_mem_base
op_assign
id|PREP_ISA_MEM_BASE
suffix:semicolon
id|pci_dram_offset
op_assign
id|PREP_PCI_DRAM_OFFSET
suffix:semicolon
id|ISA_DMA_THRESHOLD
op_assign
l_int|0x00ffffff
suffix:semicolon
id|DMA_MODE_READ
op_assign
l_int|0x44
suffix:semicolon
id|DMA_MODE_WRITE
op_assign
l_int|0x48
suffix:semicolon
id|ppc_md.setup_arch
op_assign
id|pplus_setup_arch
suffix:semicolon
id|ppc_md.show_cpuinfo
op_assign
id|pplus_show_cpuinfo
suffix:semicolon
id|ppc_md.irq_canonicalize
op_assign
id|pplus_irq_canonicalize
suffix:semicolon
id|ppc_md.init_IRQ
op_assign
id|pplus_init_IRQ
suffix:semicolon
multiline_comment|/* this gets changed later on if we have an OpenPIC -- Cort */
id|ppc_md.get_irq
op_assign
id|i8259_irq
suffix:semicolon
id|ppc_md.init
op_assign
id|pplus_init2
suffix:semicolon
id|ppc_md.restart
op_assign
id|pplus_restart
suffix:semicolon
id|ppc_md.power_off
op_assign
id|pplus_power_off
suffix:semicolon
id|ppc_md.halt
op_assign
id|pplus_halt
suffix:semicolon
id|TODC_INIT
c_func
(paren
id|TODC_TYPE_MK48T59
comma
id|PREP_NVRAM_AS0
comma
id|PREP_NVRAM_AS1
comma
id|PREP_NVRAM_DATA
comma
l_int|8
)paren
suffix:semicolon
id|ppc_md.time_init
op_assign
id|todc_time_init
suffix:semicolon
id|ppc_md.set_rtc_time
op_assign
id|todc_set_rtc_time
suffix:semicolon
id|ppc_md.get_rtc_time
op_assign
id|todc_get_rtc_time
suffix:semicolon
id|ppc_md.calibrate_decr
op_assign
id|todc_calibrate_decr
suffix:semicolon
id|ppc_md.nvram_read_val
op_assign
id|todc_m48txx_read_val
suffix:semicolon
id|ppc_md.nvram_write_val
op_assign
id|todc_m48txx_write_val
suffix:semicolon
id|ppc_md.find_end_of_memory
op_assign
id|pplus_find_end_of_memory
suffix:semicolon
id|ppc_md.setup_io_mappings
op_assign
id|pplus_map_io
suffix:semicolon
macro_line|#if defined(CONFIG_BLK_DEV_IDE) || defined(CONFIG_BLK_DEV_IDE_MODULE)
id|ppc_ide_md.default_irq
op_assign
id|pplus_ide_default_irq
suffix:semicolon
id|ppc_ide_md.default_io_base
op_assign
id|pplus_ide_default_io_base
suffix:semicolon
id|ppc_ide_md.ide_init_hwif
op_assign
id|pplus_ide_init_hwif_ports
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SERIAL_TEXT_DEBUG
id|ppc_md.progress
op_assign
id|gen550_progress
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;/* CONFIG_SERIAL_TEXT_DEBUG */
macro_line|#ifdef CONFIG_KGDB
id|ppc_md.kgdb_map_scc
op_assign
id|gen550_kgdb_map_scc
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_SMP
id|ppc_md.smp_ops
op_assign
op_amp
id|pplus_smp_ops
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;/* CONFIG_SMP */
)brace
eof
