multiline_comment|/*&n; * arch/ppc/platforms/hdpu_setup.c&n; *&n; * Board setup routines for the Sky Computers HDPU Compute Blade.&n; *&n; * Written by Brian Waite &lt;waite@skycomputers.com&gt;&n; *&n; * Based on code done by - Mark A. Greer &lt;mgreer@mvista.com&gt;&n; *                         Rabeeh Khoury - rabeeh@galileo.co.il&n; *&n; * This program is free software; you can redistribute  it and/or modify it&n; * under  the terms of  the GNU General  Public License as published by the&n; * Free Software Foundation;  either version 2 of the  License, or (at your&n; * option) any later version.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/irq.h&gt;
macro_line|#include &lt;linux/ide.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &lt;linux/initrd.h&gt;
macro_line|#include &lt;linux/root_dev.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;asm/time.h&gt;
macro_line|#include &lt;asm/machdep.h&gt;
macro_line|#include &lt;asm/todc.h&gt;
macro_line|#include &lt;asm/mv64x60.h&gt;
macro_line|#include &lt;asm/ppcboot.h&gt;
macro_line|#include &lt;platforms/hdpu.h&gt;
macro_line|#include &lt;linux/mv643xx.h&gt;
macro_line|#include &lt;linux/hdpu_features.h&gt;
macro_line|#include &lt;linux/device.h&gt;
macro_line|#include &lt;linux/mtd/physmap.h&gt;
DECL|macro|BOARD_VENDOR
mdefine_line|#define BOARD_VENDOR&t;&quot;Sky Computers&quot;
DECL|macro|BOARD_MACHINE
mdefine_line|#define BOARD_MACHINE&t;&quot;HDPU-CB-A&quot;
DECL|variable|ppcboot_bd
id|bd_t
id|ppcboot_bd
suffix:semicolon
DECL|variable|ppcboot_bd_valid
r_int
id|ppcboot_bd_valid
op_assign
l_int|0
suffix:semicolon
DECL|variable|bh
r_static
id|mv64x60_handle_t
id|bh
suffix:semicolon
r_extern
r_char
id|cmd_line
(braket
)braket
suffix:semicolon
r_int
r_int
id|hdpu_find_end_of_memory
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|hdpu_mpsc_progress
c_func
(paren
r_char
op_star
id|s
comma
r_int
r_int
id|hex
)paren
suffix:semicolon
r_void
id|hdpu_heartbeat
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|parse_bootinfo
c_func
(paren
r_int
r_int
id|r3
comma
r_int
r_int
id|r4
comma
r_int
r_int
id|r5
comma
r_int
r_int
id|r6
comma
r_int
r_int
id|r7
)paren
suffix:semicolon
r_static
r_void
id|hdpu_set_l1pe
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|hdpu_cpustate_set
c_func
(paren
r_int
r_char
id|new_state
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SMP
DECL|variable|timebase_lock
r_static
id|spinlock_t
id|timebase_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|timebase_upper
DECL|variable|timebase_lower
r_static
r_int
r_int
id|timebase_upper
op_assign
l_int|0
comma
id|timebase_lower
op_assign
l_int|0
suffix:semicolon
r_extern
r_int
id|smp_tb_synchronized
suffix:semicolon
r_void
id|__devinit
id|hdpu_tben_give
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|__devinit
id|hdpu_tben_take
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
r_static
r_int
id|__init
DECL|function|hdpu_map_irq
id|hdpu_map_irq
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
r_char
id|idsel
comma
r_int
r_char
id|pin
)paren
(brace
r_struct
id|pci_controller
op_star
id|hose
op_assign
id|pci_bus_to_hose
c_func
(paren
id|dev-&gt;bus-&gt;number
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hose-&gt;index
op_eq
l_int|0
)paren
(brace
r_static
r_char
id|pci_irq_table
(braket
)braket
(braket
l_int|4
)braket
op_assign
(brace
(brace
id|HDPU_PCI_0_IRQ
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
id|HDPU_PCI_0_IRQ
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
)brace
suffix:semicolon
r_const
r_int
id|min_idsel
op_assign
l_int|1
comma
id|max_idsel
op_assign
l_int|2
comma
id|irqs_per_slot
op_assign
l_int|4
suffix:semicolon
r_return
id|PCI_IRQ_TABLE_LOOKUP
suffix:semicolon
)brace
r_else
(brace
r_static
r_char
id|pci_irq_table
(braket
)braket
(braket
l_int|4
)braket
op_assign
(brace
(brace
id|HDPU_PCI_1_IRQ
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
)brace
suffix:semicolon
r_const
r_int
id|min_idsel
op_assign
l_int|1
comma
id|max_idsel
op_assign
l_int|1
comma
id|irqs_per_slot
op_assign
l_int|4
suffix:semicolon
r_return
id|PCI_IRQ_TABLE_LOOKUP
suffix:semicolon
)brace
)brace
DECL|function|hdpu_intr_setup
r_static
r_void
id|__init
id|hdpu_intr_setup
c_func
(paren
r_void
)paren
(brace
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_GPP_IO_CNTL
comma
(paren
l_int|1
op_or
(paren
l_int|1
op_lshift
l_int|2
)paren
op_or
(paren
l_int|1
op_lshift
l_int|3
)paren
op_or
(paren
l_int|1
op_lshift
l_int|4
)paren
op_or
(paren
l_int|1
op_lshift
l_int|5
)paren
op_or
(paren
l_int|1
op_lshift
l_int|6
)paren
op_or
(paren
l_int|1
op_lshift
l_int|7
)paren
op_or
(paren
l_int|1
op_lshift
l_int|12
)paren
op_or
(paren
l_int|1
op_lshift
l_int|16
)paren
op_or
(paren
l_int|1
op_lshift
l_int|18
)paren
op_or
(paren
l_int|1
op_lshift
l_int|19
)paren
op_or
(paren
l_int|1
op_lshift
l_int|20
)paren
op_or
(paren
l_int|1
op_lshift
l_int|21
)paren
op_or
(paren
l_int|1
op_lshift
l_int|22
)paren
op_or
(paren
l_int|1
op_lshift
l_int|23
)paren
op_or
(paren
l_int|1
op_lshift
l_int|24
)paren
op_or
(paren
l_int|1
op_lshift
l_int|25
)paren
op_or
(paren
l_int|1
op_lshift
l_int|26
)paren
op_or
(paren
l_int|1
op_lshift
l_int|27
)paren
op_or
(paren
l_int|1
op_lshift
l_int|28
)paren
op_or
(paren
l_int|1
op_lshift
l_int|29
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/* XXXX Erranum FEr PCI-#8 */
id|mv64x60_clr_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_PCI0_CMD
comma
(paren
l_int|1
op_lshift
l_int|5
)paren
op_or
(paren
l_int|1
op_lshift
l_int|9
)paren
)paren
suffix:semicolon
id|mv64x60_clr_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_PCI1_CMD
comma
(paren
l_int|1
op_lshift
l_int|5
)paren
op_or
(paren
l_int|1
op_lshift
l_int|9
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Dismiss and then enable interrupt on GPP interrupt cause&n;&t; * for CPU #0&n;&t; */
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_GPP_INTR_CAUSE
comma
op_complement
(paren
(paren
l_int|1
op_lshift
l_int|8
)paren
op_or
(paren
l_int|1
op_lshift
l_int|13
)paren
)paren
)paren
suffix:semicolon
id|mv64x60_set_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_GPP_INTR_MASK
comma
(paren
l_int|1
op_lshift
l_int|8
)paren
op_or
(paren
l_int|1
op_lshift
l_int|13
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Dismiss and then enable interrupt on CPU #0 high cause reg&n;&t; * BIT25 summarizes GPP interrupts 8-15&n;&t; */
id|mv64x60_set_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64360_IC_CPU0_INTR_MASK_HI
comma
(paren
l_int|1
op_lshift
l_int|25
)paren
)paren
suffix:semicolon
)brace
DECL|function|hdpu_setup_peripherals
r_static
r_void
id|__init
id|hdpu_setup_peripherals
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|val
suffix:semicolon
id|mv64x60_set_32bit_window
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2BOOT_WIN
comma
id|HDPU_EMB_FLASH_BASE
comma
id|HDPU_EMB_FLASH_SIZE
comma
l_int|0
)paren
suffix:semicolon
id|bh.ci
op_member_access_from_pointer
id|enable_window_32bit
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2BOOT_WIN
)paren
suffix:semicolon
id|mv64x60_set_32bit_window
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2DEV_0_WIN
comma
id|HDPU_TBEN_BASE
comma
id|HDPU_TBEN_SIZE
comma
l_int|0
)paren
suffix:semicolon
id|bh.ci
op_member_access_from_pointer
id|enable_window_32bit
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2DEV_0_WIN
)paren
suffix:semicolon
id|mv64x60_set_32bit_window
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2DEV_1_WIN
comma
id|HDPU_NEXUS_ID_BASE
comma
id|HDPU_NEXUS_ID_SIZE
comma
l_int|0
)paren
suffix:semicolon
id|bh.ci
op_member_access_from_pointer
id|enable_window_32bit
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2DEV_1_WIN
)paren
suffix:semicolon
id|mv64x60_set_32bit_window
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2SRAM_WIN
comma
id|HDPU_INTERNAL_SRAM_BASE
comma
id|HDPU_INTERNAL_SRAM_SIZE
comma
l_int|0
)paren
suffix:semicolon
id|bh.ci
op_member_access_from_pointer
id|enable_window_32bit
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2SRAM_WIN
)paren
suffix:semicolon
id|bh.ci
op_member_access_from_pointer
id|disable_window_32bit
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_ENET2MEM_4_WIN
)paren
suffix:semicolon
id|mv64x60_set_32bit_window
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_ENET2MEM_4_WIN
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_clr_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_PCI0_PCI_DECODE_CNTL
comma
(paren
l_int|1
op_lshift
l_int|3
)paren
)paren
suffix:semicolon
id|mv64x60_clr_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_PCI1_PCI_DECODE_CNTL
comma
(paren
l_int|1
op_lshift
l_int|3
)paren
)paren
suffix:semicolon
id|mv64x60_clr_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_TIMR_CNTR_0_3_CNTL
comma
(paren
(paren
l_int|1
op_lshift
l_int|0
)paren
op_or
(paren
l_int|1
op_lshift
l_int|8
)paren
op_or
(paren
l_int|1
op_lshift
l_int|16
)paren
op_or
(paren
l_int|1
op_lshift
l_int|24
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/* Enable pipelining */
id|mv64x60_set_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU_CONFIG
comma
(paren
l_int|1
op_lshift
l_int|13
)paren
)paren
suffix:semicolon
multiline_comment|/* Enable Snoop Pipelineing */
id|mv64x60_set_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64360_D_UNIT_CONTROL_HIGH
comma
(paren
l_int|1
op_lshift
l_int|24
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Change DRAM read buffer assignment.&n;&t; * Assign read buffer 0 dedicated only for CPU,&n;&t; * and the rest read buffer 1.&n;&t; */
id|val
op_assign
id|mv64x60_read
c_func
(paren
op_amp
id|bh
comma
id|MV64360_SDRAM_CONFIG
)paren
suffix:semicolon
id|val
op_assign
id|val
op_amp
l_int|0x03ffffff
suffix:semicolon
id|val
op_assign
id|val
op_or
l_int|0xf8000000
suffix:semicolon
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64360_SDRAM_CONFIG
comma
id|val
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Configure internal SRAM -&n;&t; * Cache coherent write back, if CONFIG_MV64360_SRAM_CACHE_COHERENT set&n;&t; * Parity enabled.&n;&t; * Parity error propagation&n;&t; * Arbitration not parked for CPU only&n;&t; * Other bits are reserved.&n;&t; */
macro_line|#ifdef CONFIG_MV64360_SRAM_CACHE_COHERENT
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64360_SRAM_CONFIG
comma
l_int|0x001600b2
)paren
suffix:semicolon
macro_line|#else
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64360_SRAM_CONFIG
comma
l_int|0x001600b0
)paren
suffix:semicolon
macro_line|#endif
id|hdpu_intr_setup
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|hdpu_setup_bridge
r_static
r_void
id|__init
id|hdpu_setup_bridge
c_func
(paren
r_void
)paren
(brace
r_struct
id|mv64x60_setup_info
id|si
suffix:semicolon
r_int
id|i
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|si
comma
l_int|0
comma
r_sizeof
(paren
id|si
)paren
)paren
suffix:semicolon
id|si.phys_reg_base
op_assign
id|HDPU_BRIDGE_REG_BASE
suffix:semicolon
id|si.pci_0.enable_bus
op_assign
l_int|1
suffix:semicolon
id|si.pci_0.pci_io.cpu_base
op_assign
id|HDPU_PCI0_IO_START_PROC_ADDR
suffix:semicolon
id|si.pci_0.pci_io.pci_base_hi
op_assign
l_int|0
suffix:semicolon
id|si.pci_0.pci_io.pci_base_lo
op_assign
id|HDPU_PCI0_IO_START_PCI_ADDR
suffix:semicolon
id|si.pci_0.pci_io.size
op_assign
id|HDPU_PCI0_IO_SIZE
suffix:semicolon
id|si.pci_0.pci_io.swap
op_assign
id|MV64x60_CPU2PCI_SWAP_NONE
suffix:semicolon
id|si.pci_0.pci_mem
(braket
l_int|0
)braket
dot
id|cpu_base
op_assign
id|HDPU_PCI0_MEM_START_PROC_ADDR
suffix:semicolon
id|si.pci_0.pci_mem
(braket
l_int|0
)braket
dot
id|pci_base_hi
op_assign
id|HDPU_PCI0_MEM_START_PCI_HI_ADDR
suffix:semicolon
id|si.pci_0.pci_mem
(braket
l_int|0
)braket
dot
id|pci_base_lo
op_assign
id|HDPU_PCI0_MEM_START_PCI_LO_ADDR
suffix:semicolon
id|si.pci_0.pci_mem
(braket
l_int|0
)braket
dot
id|size
op_assign
id|HDPU_PCI0_MEM_SIZE
suffix:semicolon
id|si.pci_0.pci_mem
(braket
l_int|0
)braket
dot
id|swap
op_assign
id|MV64x60_CPU2PCI_SWAP_NONE
suffix:semicolon
id|si.pci_0.pci_cmd_bits
op_assign
l_int|0
suffix:semicolon
id|si.pci_0.latency_timer
op_assign
l_int|0x80
suffix:semicolon
id|si.pci_1.enable_bus
op_assign
l_int|1
suffix:semicolon
id|si.pci_1.pci_io.cpu_base
op_assign
id|HDPU_PCI1_IO_START_PROC_ADDR
suffix:semicolon
id|si.pci_1.pci_io.pci_base_hi
op_assign
l_int|0
suffix:semicolon
id|si.pci_1.pci_io.pci_base_lo
op_assign
id|HDPU_PCI1_IO_START_PCI_ADDR
suffix:semicolon
id|si.pci_1.pci_io.size
op_assign
id|HDPU_PCI1_IO_SIZE
suffix:semicolon
id|si.pci_1.pci_io.swap
op_assign
id|MV64x60_CPU2PCI_SWAP_NONE
suffix:semicolon
id|si.pci_1.pci_mem
(braket
l_int|0
)braket
dot
id|cpu_base
op_assign
id|HDPU_PCI1_MEM_START_PROC_ADDR
suffix:semicolon
id|si.pci_1.pci_mem
(braket
l_int|0
)braket
dot
id|pci_base_hi
op_assign
id|HDPU_PCI1_MEM_START_PCI_HI_ADDR
suffix:semicolon
id|si.pci_1.pci_mem
(braket
l_int|0
)braket
dot
id|pci_base_lo
op_assign
id|HDPU_PCI1_MEM_START_PCI_LO_ADDR
suffix:semicolon
id|si.pci_1.pci_mem
(braket
l_int|0
)braket
dot
id|size
op_assign
id|HDPU_PCI1_MEM_SIZE
suffix:semicolon
id|si.pci_1.pci_mem
(braket
l_int|0
)braket
dot
id|swap
op_assign
id|MV64x60_CPU2PCI_SWAP_NONE
suffix:semicolon
id|si.pci_1.pci_cmd_bits
op_assign
l_int|0
suffix:semicolon
id|si.pci_1.latency_timer
op_assign
l_int|0x80
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MV64x60_CPU2MEM_WINDOWS
suffix:semicolon
id|i
op_increment
)paren
(brace
macro_line|#if defined(CONFIG_NOT_COHERENT_CACHE)
id|si.cpu_prot_options
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|si.enet_options
(braket
id|i
)braket
op_assign
id|MV64360_ENET2MEM_SNOOP_NONE
suffix:semicolon
id|si.mpsc_options
(braket
id|i
)braket
op_assign
id|MV64360_MPSC2MEM_SNOOP_NONE
suffix:semicolon
id|si.idma_options
(braket
id|i
)braket
op_assign
id|MV64360_IDMA2MEM_SNOOP_NONE
suffix:semicolon
id|si.pci_1.acc_cntl_options
(braket
id|i
)braket
op_assign
id|MV64360_PCI_ACC_CNTL_SNOOP_NONE
op_or
id|MV64360_PCI_ACC_CNTL_SWAP_NONE
op_or
id|MV64360_PCI_ACC_CNTL_MBURST_128_BYTES
op_or
id|MV64360_PCI_ACC_CNTL_RDSIZE_256_BYTES
suffix:semicolon
id|si.pci_0.acc_cntl_options
(braket
id|i
)braket
op_assign
id|MV64360_PCI_ACC_CNTL_SNOOP_NONE
op_or
id|MV64360_PCI_ACC_CNTL_SWAP_NONE
op_or
id|MV64360_PCI_ACC_CNTL_MBURST_128_BYTES
op_or
id|MV64360_PCI_ACC_CNTL_RDSIZE_256_BYTES
suffix:semicolon
macro_line|#else
id|si.cpu_prot_options
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|si.enet_options
(braket
id|i
)braket
op_assign
id|MV64360_ENET2MEM_SNOOP_WB
suffix:semicolon
multiline_comment|/* errata */
id|si.mpsc_options
(braket
id|i
)braket
op_assign
id|MV64360_MPSC2MEM_SNOOP_WB
suffix:semicolon
multiline_comment|/* errata */
id|si.idma_options
(braket
id|i
)braket
op_assign
id|MV64360_IDMA2MEM_SNOOP_WB
suffix:semicolon
multiline_comment|/* errata */
id|si.pci_0.acc_cntl_options
(braket
id|i
)braket
op_assign
id|MV64360_PCI_ACC_CNTL_SNOOP_WB
op_or
id|MV64360_PCI_ACC_CNTL_SWAP_NONE
op_or
id|MV64360_PCI_ACC_CNTL_MBURST_32_BYTES
op_or
id|MV64360_PCI_ACC_CNTL_RDSIZE_256_BYTES
suffix:semicolon
id|si.pci_1.acc_cntl_options
(braket
id|i
)braket
op_assign
id|MV64360_PCI_ACC_CNTL_SNOOP_WB
op_or
id|MV64360_PCI_ACC_CNTL_SWAP_NONE
op_or
id|MV64360_PCI_ACC_CNTL_MBURST_32_BYTES
op_or
id|MV64360_PCI_ACC_CNTL_RDSIZE_256_BYTES
suffix:semicolon
macro_line|#endif
)brace
id|hdpu_cpustate_set
c_func
(paren
id|CPUSTATE_KERNEL_MAJOR
op_or
id|CPUSTATE_KERNEL_INIT_PCI
)paren
suffix:semicolon
multiline_comment|/* Lookup PCI host bridges */
id|mv64x60_init
c_func
(paren
op_amp
id|bh
comma
op_amp
id|si
)paren
suffix:semicolon
id|pci_dram_offset
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* System mem at same addr on PCI &amp; cpu bus */
id|ppc_md.pci_swizzle
op_assign
id|common_swizzle
suffix:semicolon
id|ppc_md.pci_map_irq
op_assign
id|hdpu_map_irq
suffix:semicolon
id|mv64x60_set_bus
c_func
(paren
op_amp
id|bh
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|bh.hose_a-&gt;first_busno
op_assign
l_int|0
suffix:semicolon
id|bh.hose_a-&gt;last_busno
op_assign
l_int|0xff
suffix:semicolon
id|bh.hose_a-&gt;last_busno
op_assign
id|pciauto_bus_scan
c_func
(paren
id|bh.hose_a
comma
l_int|0
)paren
suffix:semicolon
id|bh.hose_b-&gt;first_busno
op_assign
id|bh.hose_a-&gt;last_busno
op_plus
l_int|1
suffix:semicolon
id|mv64x60_set_bus
c_func
(paren
op_amp
id|bh
comma
l_int|1
comma
id|bh.hose_b-&gt;first_busno
)paren
suffix:semicolon
id|bh.hose_b-&gt;last_busno
op_assign
l_int|0xff
suffix:semicolon
id|bh.hose_b-&gt;last_busno
op_assign
id|pciauto_bus_scan
c_func
(paren
id|bh.hose_b
comma
id|bh.hose_b-&gt;first_busno
)paren
suffix:semicolon
id|ppc_md.pci_exclude_device
op_assign
id|mv64x60_pci_exclude_device
suffix:semicolon
id|hdpu_cpustate_set
c_func
(paren
id|CPUSTATE_KERNEL_MAJOR
op_or
id|CPUSTATE_KERNEL_INIT_REG
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Enabling of PCI internal-vs-external arbitration&n;&t; * is a platform- and errata-dependent decision.&n;&t; */
r_return
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_SERIAL_MPSC_CONSOLE)
DECL|function|hdpu_early_serial_map
r_static
r_void
id|__init
id|hdpu_early_serial_map
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef&t;CONFIG_KGDB
r_static
r_char
id|first_time
op_assign
l_int|1
suffix:semicolon
macro_line|#if defined(CONFIG_KGDB_TTYS0)
DECL|macro|KGDB_PORT
mdefine_line|#define KGDB_PORT 0
macro_line|#elif defined(CONFIG_KGDB_TTYS1)
mdefine_line|#define KGDB_PORT 1
macro_line|#else
macro_line|#error &quot;Invalid kgdb_tty port&quot;
macro_line|#endif
r_if
c_cond
(paren
id|first_time
)paren
(brace
id|gt_early_mpsc_init
c_func
(paren
id|KGDB_PORT
comma
id|B9600
op_or
id|CS8
op_or
id|CREAD
op_or
id|HUPCL
op_or
id|CLOCAL
)paren
suffix:semicolon
id|first_time
op_assign
l_int|0
suffix:semicolon
)brace
r_return
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif
DECL|function|hdpu_init2
r_static
r_void
id|hdpu_init2
c_func
(paren
r_void
)paren
(brace
r_return
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_MV643XX_ETH)
DECL|function|hdpu_fixup_eth_pdata
r_static
r_void
id|__init
id|hdpu_fixup_eth_pdata
c_func
(paren
r_struct
id|platform_device
op_star
id|pd
)paren
(brace
r_struct
id|mv643xx_eth_platform_data
op_star
id|eth_pd
suffix:semicolon
id|eth_pd
op_assign
id|pd-&gt;dev.platform_data
suffix:semicolon
id|eth_pd-&gt;port_serial_control
op_assign
id|mv64x60_read
c_func
(paren
op_amp
id|bh
comma
id|MV643XX_ETH_PORT_SERIAL_CONTROL_REG
c_func
(paren
id|pd-&gt;id
)paren
op_amp
op_complement
l_int|1
)paren
suffix:semicolon
id|eth_pd-&gt;force_phy_addr
op_assign
l_int|1
suffix:semicolon
id|eth_pd-&gt;phy_addr
op_assign
id|pd-&gt;id
suffix:semicolon
id|eth_pd-&gt;tx_queue_size
op_assign
l_int|400
suffix:semicolon
id|eth_pd-&gt;rx_queue_size
op_assign
l_int|800
suffix:semicolon
)brace
macro_line|#endif
DECL|function|hdpu_fixup_mpsc_pdata
r_static
r_void
id|__init
id|hdpu_fixup_mpsc_pdata
c_func
(paren
r_struct
id|platform_device
op_star
id|pd
)paren
(brace
r_struct
id|mpsc_pdata
op_star
id|pdata
suffix:semicolon
id|pdata
op_assign
(paren
r_struct
id|mpsc_pdata
op_star
)paren
id|pd-&gt;dev.platform_data
suffix:semicolon
id|pdata-&gt;max_idle
op_assign
l_int|40
suffix:semicolon
r_if
c_cond
(paren
id|ppcboot_bd_valid
)paren
id|pdata-&gt;default_baud
op_assign
id|ppcboot_bd.bi_baudrate
suffix:semicolon
r_else
id|pdata-&gt;default_baud
op_assign
id|HDPU_DEFAULT_BAUD
suffix:semicolon
id|pdata-&gt;brg_clk_src
op_assign
id|HDPU_MPSC_CLK_SRC
suffix:semicolon
id|pdata-&gt;brg_clk_freq
op_assign
id|HDPU_MPSC_CLK_FREQ
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_HDPU_FEATURES)
DECL|function|hdpu_fixup_cpustate_pdata
r_static
r_void
id|__init
id|hdpu_fixup_cpustate_pdata
c_func
(paren
r_struct
id|platform_device
op_star
id|pd
)paren
(brace
r_struct
id|platform_device
op_star
id|pds
(braket
l_int|1
)braket
suffix:semicolon
id|pds
(braket
l_int|0
)braket
op_assign
id|pd
suffix:semicolon
id|mv64x60_pd_fixup
c_func
(paren
op_amp
id|bh
comma
id|pds
comma
l_int|1
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|hdpu_platform_notify
r_static
r_int
id|__init
id|hdpu_platform_notify
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_static
r_struct
(brace
r_char
op_star
id|bus_id
suffix:semicolon
r_void
(paren
(paren
op_star
id|rtn
)paren
(paren
r_struct
id|platform_device
op_star
id|pdev
)paren
)paren
suffix:semicolon
)brace
id|dev_map
(braket
)braket
op_assign
(brace
(brace
id|MPSC_CTLR_NAME
l_string|&quot;.0&quot;
comma
id|hdpu_fixup_mpsc_pdata
)brace
comma
macro_line|#if defined(CONFIG_MV643XX_ETH)
(brace
id|MV643XX_ETH_NAME
l_string|&quot;.0&quot;
comma
id|hdpu_fixup_eth_pdata
)brace
comma
macro_line|#endif
macro_line|#if defined(CONFIG_HDPU_FEATURES)
(brace
id|HDPU_CPUSTATE_NAME
l_string|&quot;.0&quot;
comma
id|hdpu_fixup_cpustate_pdata
)brace
comma
macro_line|#endif
)brace
suffix:semicolon
r_struct
id|platform_device
op_star
id|pdev
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_logical_and
id|dev-&gt;bus_id
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|dev_map
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|dev-&gt;bus_id
comma
id|dev_map
(braket
id|i
)braket
dot
id|bus_id
comma
id|BUS_ID_SIZE
)paren
)paren
(brace
id|pdev
op_assign
id|container_of
c_func
(paren
id|dev
comma
r_struct
id|platform_device
comma
id|dev
)paren
suffix:semicolon
id|dev_map
(braket
id|i
)braket
dot
id|rtn
c_func
(paren
id|pdev
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hdpu_setup_arch
r_static
r_void
id|__init
id|hdpu_setup_arch
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;hdpu_setup_arch: enter&quot;
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_INITRD
r_if
c_cond
(paren
id|initrd_start
)paren
id|ROOT_DEV
op_assign
id|Root_RAM0
suffix:semicolon
r_else
macro_line|#endif
macro_line|#ifdef&t;CONFIG_ROOT_NFS
id|ROOT_DEV
op_assign
id|Root_NFS
suffix:semicolon
macro_line|#else
id|ROOT_DEV
op_assign
id|Root_SDA2
suffix:semicolon
macro_line|#endif
id|ppc_md.heartbeat
op_assign
id|hdpu_heartbeat
suffix:semicolon
id|ppc_md.heartbeat_reset
op_assign
id|HZ
suffix:semicolon
id|ppc_md.heartbeat_count
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;hdpu_setup_arch: Enabling L2 cache&quot;
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* Enable L1 Parity Bits */
id|hdpu_set_l1pe
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Enable L2 and L3 caches (if 745x) */
id|_set_L2CR
c_func
(paren
l_int|0x80080000
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;hdpu_setup_arch: enter&quot;
comma
l_int|0
)paren
suffix:semicolon
id|hdpu_setup_bridge
c_func
(paren
)paren
suffix:semicolon
id|hdpu_setup_peripherals
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SERIAL_MPSC_CONSOLE
id|hdpu_early_serial_map
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
l_string|&quot;SKY HDPU Compute Blade &bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;hdpu_setup_arch: exit&quot;
comma
l_int|0
)paren
suffix:semicolon
id|hdpu_cpustate_set
c_func
(paren
id|CPUSTATE_KERNEL_MAJOR
op_or
id|CPUSTATE_KERNEL_OK
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|hdpu_init_irq
r_static
r_void
id|__init
id|hdpu_init_irq
c_func
(paren
r_void
)paren
(brace
id|mv64360_init_irq
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|hdpu_set_l1pe
r_static
r_void
id|__init
id|hdpu_set_l1pe
c_func
(paren
)paren
(brace
r_int
r_int
id|ictrl
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;mfspr %0, 1011&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|ictrl
)paren
suffix:colon
)paren
suffix:semicolon
id|ictrl
op_or_assign
id|ICTRL_EICE
op_or
id|ICTRL_EDC
op_or
id|ICTRL_EICP
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;mtspr 1011, %0&quot;
op_scope_resolution
l_string|&quot;r&quot;
(paren
id|ictrl
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Set BAT 1 to map 0xf1000000 to end of physical memory space.&n; */
DECL|function|hdpu_set_bat
r_static
id|__inline__
r_void
id|hdpu_set_bat
c_func
(paren
r_void
)paren
(brace
id|mb
c_func
(paren
)paren
suffix:semicolon
id|mtspr
c_func
(paren
id|SPRN_DBAT1U
comma
l_int|0xf10001fe
)paren
suffix:semicolon
id|mtspr
c_func
(paren
id|SPRN_DBAT1L
comma
l_int|0xf100002a
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|hdpu_find_end_of_memory
r_int
r_int
id|__init
id|hdpu_find_end_of_memory
c_func
(paren
r_void
)paren
(brace
r_return
id|mv64x60_get_mem_size
c_func
(paren
id|CONFIG_MV64X60_NEW_BASE
comma
id|MV64x60_TYPE_MV64360
)paren
suffix:semicolon
)brace
DECL|function|hdpu_reset_board
r_static
r_void
id|hdpu_reset_board
c_func
(paren
r_void
)paren
(brace
r_volatile
r_int
id|infinite
op_assign
l_int|1
suffix:semicolon
id|hdpu_cpustate_set
c_func
(paren
id|CPUSTATE_KERNEL_MAJOR
op_or
id|CPUSTATE_KERNEL_RESET
)paren
suffix:semicolon
id|local_irq_disable
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Clear all the LEDs */
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_GPP_VALUE_CLR
comma
(paren
(paren
l_int|1
op_lshift
l_int|4
)paren
op_or
(paren
l_int|1
op_lshift
l_int|5
)paren
op_or
(paren
l_int|1
op_lshift
l_int|6
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/* disable and invalidate the L2 cache */
id|_set_L2CR
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|_set_L2CR
c_func
(paren
l_int|0x200000
)paren
suffix:semicolon
multiline_comment|/* flush and disable L1 I/D cache */
id|__asm__
id|__volatile__
(paren
l_string|&quot;&bslash;n&quot;
l_string|&quot;mfspr   3,1008&bslash;n&quot;
l_string|&quot;ori&t;5,5,0xcc00&bslash;n&quot;
l_string|&quot;ori&t;4,3,0xc00&bslash;n&quot;
l_string|&quot;andc&t;5,3,5&bslash;n&quot;
l_string|&quot;sync&bslash;n&quot;
l_string|&quot;mtspr&t;1008,4&bslash;n&quot;
l_string|&quot;isync&bslash;n&quot;
l_string|&quot;sync&bslash;n&quot;
l_string|&quot;mtspr&t;1008,5&bslash;n&quot;
l_string|&quot;isync&bslash;n&quot;
l_string|&quot;sync&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Hit the reset bit */
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_GPP_VALUE_CLR
comma
(paren
l_int|1
op_lshift
l_int|3
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|infinite
)paren
id|infinite
op_assign
id|infinite
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|hdpu_restart
r_static
r_void
id|hdpu_restart
c_func
(paren
r_char
op_star
id|cmd
)paren
(brace
r_volatile
id|ulong
id|i
op_assign
l_int|10000000
suffix:semicolon
id|hdpu_reset_board
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
op_decrement
OG
l_int|0
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;restart failed&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|hdpu_halt
r_static
r_void
id|hdpu_halt
c_func
(paren
r_void
)paren
(brace
id|local_irq_disable
c_func
(paren
)paren
suffix:semicolon
id|hdpu_cpustate_set
c_func
(paren
id|CPUSTATE_KERNEL_MAJOR
op_or
id|CPUSTATE_KERNEL_HALT
)paren
suffix:semicolon
multiline_comment|/* Clear all the LEDs */
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_GPP_VALUE_CLR
comma
(paren
(paren
l_int|1
op_lshift
l_int|4
)paren
op_or
(paren
l_int|1
op_lshift
l_int|5
)paren
op_or
(paren
l_int|1
op_lshift
l_int|6
)paren
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* NOTREACHED */
)brace
DECL|function|hdpu_power_off
r_static
r_void
id|hdpu_power_off
c_func
(paren
r_void
)paren
(brace
id|hdpu_halt
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* NOTREACHED */
)brace
DECL|function|hdpu_show_cpuinfo
r_static
r_int
id|hdpu_show_cpuinfo
c_func
(paren
r_struct
id|seq_file
op_star
id|m
)paren
(brace
id|uint
id|pvid
suffix:semicolon
id|pvid
op_assign
id|mfspr
c_func
(paren
id|SPRN_PVR
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;vendor&bslash;t&bslash;t: Sky Computers&bslash;n&quot;
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;machine&bslash;t&bslash;t: HDPU Compute Blade&bslash;n&quot;
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;PVID&bslash;t&bslash;t: 0x%x, vendor: %s&bslash;n&quot;
comma
id|pvid
comma
(paren
id|pvid
op_amp
(paren
l_int|1
op_lshift
l_int|15
)paren
ques
c_cond
l_string|&quot;IBM&quot;
suffix:colon
l_string|&quot;Motorola&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hdpu_calibrate_decr
r_static
r_void
id|__init
id|hdpu_calibrate_decr
c_func
(paren
r_void
)paren
(brace
id|ulong
id|freq
suffix:semicolon
r_if
c_cond
(paren
id|ppcboot_bd_valid
)paren
id|freq
op_assign
id|ppcboot_bd.bi_busfreq
op_div
l_int|4
suffix:semicolon
r_else
id|freq
op_assign
l_int|133000000
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;time_init: decrementer frequency = %lu.%.6lu MHz&bslash;n&quot;
comma
id|freq
op_div
l_int|1000000
comma
id|freq
op_mod
l_int|1000000
)paren
suffix:semicolon
id|tb_ticks_per_jiffy
op_assign
id|freq
op_div
id|HZ
suffix:semicolon
id|tb_to_us
op_assign
id|mulhwu_scale_factor
c_func
(paren
id|freq
comma
l_int|1000000
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|parse_bootinfo
r_static
r_void
id|parse_bootinfo
c_func
(paren
r_int
r_int
id|r3
comma
r_int
r_int
id|r4
comma
r_int
r_int
id|r5
comma
r_int
r_int
id|r6
comma
r_int
r_int
id|r7
)paren
(brace
id|bd_t
op_star
id|bd
op_assign
l_int|NULL
suffix:semicolon
r_char
op_star
id|cmdline_start
op_assign
l_int|NULL
suffix:semicolon
r_int
id|cmdline_len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|r3
)paren
(brace
r_if
c_cond
(paren
(paren
id|r3
op_amp
l_int|0xf0000000
)paren
op_eq
l_int|0
)paren
id|r3
op_add_assign
id|KERNELBASE
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r3
op_amp
l_int|0xf0000000
)paren
op_eq
id|KERNELBASE
)paren
(brace
id|bd
op_assign
(paren
r_void
op_star
)paren
id|r3
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ppcboot_bd
comma
id|bd
comma
r_sizeof
(paren
id|ppcboot_bd
)paren
)paren
suffix:semicolon
id|ppcboot_bd_valid
op_assign
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_BLK_DEV_INITRD
r_if
c_cond
(paren
id|r4
op_logical_and
id|r5
op_logical_and
id|r5
OG
id|r4
)paren
(brace
r_if
c_cond
(paren
(paren
id|r4
op_amp
l_int|0xf0000000
)paren
op_eq
l_int|0
)paren
id|r4
op_add_assign
id|KERNELBASE
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r5
op_amp
l_int|0xf0000000
)paren
op_eq
l_int|0
)paren
id|r5
op_add_assign
id|KERNELBASE
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r4
op_amp
l_int|0xf0000000
)paren
op_eq
id|KERNELBASE
)paren
(brace
id|initrd_start
op_assign
id|r4
suffix:semicolon
id|initrd_end
op_assign
id|r5
suffix:semicolon
id|initrd_below_start_ok
op_assign
l_int|1
suffix:semicolon
)brace
)brace
macro_line|#endif&t;&t;&t;&t;/* CONFIG_BLK_DEV_INITRD */
r_if
c_cond
(paren
id|r6
op_logical_and
id|r7
op_logical_and
id|r7
OG
id|r6
)paren
(brace
r_if
c_cond
(paren
(paren
id|r6
op_amp
l_int|0xf0000000
)paren
op_eq
l_int|0
)paren
id|r6
op_add_assign
id|KERNELBASE
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r7
op_amp
l_int|0xf0000000
)paren
op_eq
l_int|0
)paren
id|r7
op_add_assign
id|KERNELBASE
suffix:semicolon
r_if
c_cond
(paren
(paren
id|r6
op_amp
l_int|0xf0000000
)paren
op_eq
id|KERNELBASE
)paren
(brace
id|cmdline_start
op_assign
(paren
r_void
op_star
)paren
id|r6
suffix:semicolon
id|cmdline_len
op_assign
(paren
id|r7
op_minus
id|r6
)paren
suffix:semicolon
id|strncpy
c_func
(paren
id|cmd_line
comma
id|cmdline_start
comma
id|cmdline_len
)paren
suffix:semicolon
)brace
)brace
)brace
macro_line|#if defined(CONFIG_BLK_DEV_IDE) || defined(CONFIG_BLK_DEV_IDE_MODULE)
DECL|function|hdpu_ide_check_region
r_static
r_int
id|hdpu_ide_check_region
c_func
(paren
id|ide_ioreg_t
id|from
comma
r_int
r_int
id|extent
)paren
(brace
r_return
id|check_region
c_func
(paren
id|from
comma
id|extent
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|hdpu_ide_request_region
id|hdpu_ide_request_region
c_func
(paren
id|ide_ioreg_t
id|from
comma
r_int
r_int
id|extent
comma
r_const
r_char
op_star
id|name
)paren
(brace
id|request_region
c_func
(paren
id|from
comma
id|extent
comma
id|name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|hdpu_ide_release_region
r_static
r_void
id|hdpu_ide_release_region
c_func
(paren
id|ide_ioreg_t
id|from
comma
r_int
r_int
id|extent
)paren
(brace
id|release_region
c_func
(paren
id|from
comma
id|extent
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|hdpu_ide_pci_init_hwif_ports
id|hdpu_ide_pci_init_hwif_ports
c_func
(paren
id|hw_regs_t
op_star
id|hw
comma
id|ide_ioreg_t
id|data_port
comma
id|ide_ioreg_t
id|ctrl_port
comma
r_int
op_star
id|irq
)paren
(brace
r_struct
id|pci_dev
op_star
id|dev
suffix:semicolon
id|pci_for_each_dev
c_func
(paren
id|dev
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
id|dev
op_member_access_from_pointer
r_class
op_rshift
l_int|8
)paren
op_eq
id|PCI_CLASS_STORAGE_IDE
)paren
op_logical_or
(paren
(paren
id|dev
op_member_access_from_pointer
r_class
op_rshift
l_int|8
)paren
op_eq
id|PCI_CLASS_STORAGE_RAID
)paren
)paren
(brace
id|hw-&gt;irq
op_assign
id|dev-&gt;irq
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_ne
l_int|NULL
)paren
(brace
op_star
id|irq
op_assign
id|dev-&gt;irq
suffix:semicolon
)brace
)brace
)brace
r_return
suffix:semicolon
)brace
macro_line|#endif
DECL|function|hdpu_heartbeat
r_void
id|hdpu_heartbeat
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|mv64x60_read
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_GPP_VALUE
)paren
op_amp
(paren
l_int|1
op_lshift
l_int|5
)paren
)paren
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_GPP_VALUE_CLR
comma
(paren
l_int|1
op_lshift
l_int|5
)paren
)paren
suffix:semicolon
r_else
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_GPP_VALUE_SET
comma
(paren
l_int|1
op_lshift
l_int|5
)paren
)paren
suffix:semicolon
id|ppc_md.heartbeat_count
op_assign
id|ppc_md.heartbeat_reset
suffix:semicolon
)brace
DECL|function|hdpu_map_io
r_static
r_void
id|__init
id|hdpu_map_io
c_func
(paren
r_void
)paren
(brace
id|io_block_mapping
c_func
(paren
l_int|0xf1000000
comma
l_int|0xf1000000
comma
l_int|0x20000
comma
id|_PAGE_IO
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SMP
DECL|variable|hdpu_smp0
r_char
id|hdpu_smp0
(braket
)braket
op_assign
l_string|&quot;SMP Cpu #0&quot;
suffix:semicolon
DECL|variable|hdpu_smp1
r_char
id|hdpu_smp1
(braket
)braket
op_assign
l_string|&quot;SMP Cpu #1&quot;
suffix:semicolon
DECL|function|hdpu_smp_cpu0_int_handler
r_static
id|irqreturn_t
id|hdpu_smp_cpu0_int_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_volatile
r_int
r_int
id|doorbell
suffix:semicolon
id|doorbell
op_assign
id|mv64x60_read
c_func
(paren
op_amp
id|bh
comma
id|MV64360_CPU0_DOORBELL
)paren
suffix:semicolon
multiline_comment|/* Ack the doorbell interrupts */
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64360_CPU0_DOORBELL_CLR
comma
id|doorbell
)paren
suffix:semicolon
r_if
c_cond
(paren
id|doorbell
op_amp
l_int|1
)paren
(brace
id|smp_message_recv
c_func
(paren
l_int|0
comma
id|regs
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|doorbell
op_amp
l_int|2
)paren
(brace
id|smp_message_recv
c_func
(paren
l_int|1
comma
id|regs
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|doorbell
op_amp
l_int|4
)paren
(brace
id|smp_message_recv
c_func
(paren
l_int|2
comma
id|regs
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|doorbell
op_amp
l_int|8
)paren
(brace
id|smp_message_recv
c_func
(paren
l_int|3
comma
id|regs
)paren
suffix:semicolon
)brace
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|hdpu_smp_cpu1_int_handler
r_static
id|irqreturn_t
id|hdpu_smp_cpu1_int_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_volatile
r_int
r_int
id|doorbell
suffix:semicolon
id|doorbell
op_assign
id|mv64x60_read
c_func
(paren
op_amp
id|bh
comma
id|MV64360_CPU1_DOORBELL
)paren
suffix:semicolon
multiline_comment|/* Ack the doorbell interrupts */
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64360_CPU1_DOORBELL_CLR
comma
id|doorbell
)paren
suffix:semicolon
r_if
c_cond
(paren
id|doorbell
op_amp
l_int|1
)paren
(brace
id|smp_message_recv
c_func
(paren
l_int|0
comma
id|regs
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|doorbell
op_amp
l_int|2
)paren
(brace
id|smp_message_recv
c_func
(paren
l_int|1
comma
id|regs
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|doorbell
op_amp
l_int|4
)paren
(brace
id|smp_message_recv
c_func
(paren
l_int|2
comma
id|regs
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|doorbell
op_amp
l_int|8
)paren
(brace
id|smp_message_recv
c_func
(paren
l_int|3
comma
id|regs
)paren
suffix:semicolon
)brace
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|smp_hdpu_CPU_two
r_static
r_void
id|smp_hdpu_CPU_two
c_func
(paren
r_void
)paren
(brace
id|__asm__
id|__volatile__
(paren
l_string|&quot;&bslash;n&quot;
l_string|&quot;lis     3,0x0000&bslash;n&quot;
l_string|&quot;ori     3,3,0x00c0&bslash;n&quot;
l_string|&quot;mtspr   26, 3&bslash;n&quot;
l_string|&quot;li      4,0&bslash;n&quot;
l_string|&quot;mtspr   27,4&bslash;n&quot;
l_string|&quot;rfi&quot;
)paren
suffix:semicolon
)brace
DECL|function|smp_hdpu_probe
r_static
r_int
id|smp_hdpu_probe
c_func
(paren
r_void
)paren
(brace
r_int
op_star
id|cpu_count_reg
suffix:semicolon
r_int
id|num_cpus
op_assign
l_int|0
suffix:semicolon
id|cpu_count_reg
op_assign
id|ioremap
c_func
(paren
id|HDPU_NEXUS_ID_BASE
comma
id|HDPU_NEXUS_ID_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpu_count_reg
)paren
(brace
id|num_cpus
op_assign
(paren
op_star
id|cpu_count_reg
op_rshift
l_int|20
)paren
op_amp
l_int|0x3
suffix:semicolon
id|iounmap
c_func
(paren
id|cpu_count_reg
)paren
suffix:semicolon
)brace
multiline_comment|/* Validate the bits in the CPLD. If we could not map the reg, return 2.&n;&t; * If the register reported 0 or 3, return 2.&n;&t; * Older CPLD revisions set these bits to all ones (val = 3).&n;&t; */
r_if
c_cond
(paren
(paren
id|num_cpus
OL
l_int|1
)paren
op_logical_or
(paren
id|num_cpus
OG
l_int|2
)paren
)paren
(brace
id|printk
(paren
l_string|&quot;Unable to determine the number of processors %d . deafulting to 2.&bslash;n&quot;
comma
id|num_cpus
)paren
suffix:semicolon
id|num_cpus
op_assign
l_int|2
suffix:semicolon
)brace
r_return
id|num_cpus
suffix:semicolon
)brace
r_static
r_void
DECL|function|smp_hdpu_message_pass
id|smp_hdpu_message_pass
c_func
(paren
r_int
id|target
comma
r_int
id|msg
comma
r_int
r_int
id|data
comma
r_int
id|wait
)paren
(brace
r_if
c_cond
(paren
id|msg
OG
l_int|0x3
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;SMP %d: smp_message_pass: unknown msg %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|msg
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|target
)paren
(brace
r_case
id|MSG_ALL
suffix:colon
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64360_CPU0_DOORBELL
comma
l_int|1
op_lshift
id|msg
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64360_CPU1_DOORBELL
comma
l_int|1
op_lshift
id|msg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MSG_ALL_BUT_SELF
suffix:colon
r_if
c_cond
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64360_CPU0_DOORBELL
comma
l_int|1
op_lshift
id|msg
)paren
suffix:semicolon
r_else
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64360_CPU1_DOORBELL
comma
l_int|1
op_lshift
id|msg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|target
op_eq
l_int|0
)paren
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64360_CPU0_DOORBELL
comma
l_int|1
op_lshift
id|msg
)paren
suffix:semicolon
r_else
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64360_CPU1_DOORBELL
comma
l_int|1
op_lshift
id|msg
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|smp_hdpu_kick_cpu
r_static
r_void
id|smp_hdpu_kick_cpu
c_func
(paren
r_int
id|nr
)paren
(brace
r_volatile
r_int
r_int
op_star
id|bootaddr
suffix:semicolon
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;smp_hdpu_kick_cpu&quot;
comma
l_int|0
)paren
suffix:semicolon
id|hdpu_cpustate_set
c_func
(paren
id|CPUSTATE_KERNEL_MAJOR
op_or
id|CPUSTATE_KERNEL_CPU1_KICK
)paren
suffix:semicolon
multiline_comment|/* Disable BootCS. Must also reduce the windows size to zero. */
id|bh.ci
op_member_access_from_pointer
id|disable_window_32bit
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2BOOT_WIN
)paren
suffix:semicolon
id|mv64x60_set_32bit_window
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2BOOT_WIN
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|bootaddr
op_assign
id|ioremap
c_func
(paren
id|HDPU_INTERNAL_SRAM_BASE
comma
id|HDPU_INTERNAL_SRAM_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bootaddr
)paren
(brace
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;smp_hdpu_kick_cpu: ioremap failed&quot;
comma
l_int|0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
(paren
id|bootaddr
op_plus
l_int|0x40
)paren
comma
(paren
r_void
op_star
)paren
op_amp
id|smp_hdpu_CPU_two
comma
l_int|0x20
)paren
suffix:semicolon
multiline_comment|/* map SRAM to 0xfff00000 */
id|bh.ci
op_member_access_from_pointer
id|disable_window_32bit
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2SRAM_WIN
)paren
suffix:semicolon
id|mv64x60_set_32bit_window
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2SRAM_WIN
comma
l_int|0xfff00000
comma
id|HDPU_INTERNAL_SRAM_SIZE
comma
l_int|0
)paren
suffix:semicolon
id|bh.ci
op_member_access_from_pointer
id|enable_window_32bit
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2SRAM_WIN
)paren
suffix:semicolon
multiline_comment|/* Enable CPU1 arbitration */
id|mv64x60_clr_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU_MASTER_CNTL
comma
(paren
l_int|1
op_lshift
l_int|9
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Wait 100mSecond until other CPU has reached __secondary_start.&n;&t; * When it reaches, it is permittable to rever the SRAM mapping etc...&n;&t; */
id|mdelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
op_star
(paren
r_int
r_int
op_star
)paren
id|KERNELBASE
op_assign
id|nr
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;dcbf 0,%0&quot;
op_scope_resolution
l_string|&quot;r&quot;
(paren
id|KERNELBASE
)paren
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|bootaddr
)paren
suffix:semicolon
multiline_comment|/* Set up window for internal sram (256KByte insize) */
id|bh.ci
op_member_access_from_pointer
id|disable_window_32bit
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2SRAM_WIN
)paren
suffix:semicolon
id|mv64x60_set_32bit_window
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2SRAM_WIN
comma
id|HDPU_INTERNAL_SRAM_BASE
comma
id|HDPU_INTERNAL_SRAM_SIZE
comma
l_int|0
)paren
suffix:semicolon
id|bh.ci
op_member_access_from_pointer
id|enable_window_32bit
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2SRAM_WIN
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Set up windows for embedded FLASH (using boot CS window).&n;&t; */
id|bh.ci
op_member_access_from_pointer
id|disable_window_32bit
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2BOOT_WIN
)paren
suffix:semicolon
id|mv64x60_set_32bit_window
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2BOOT_WIN
comma
id|HDPU_EMB_FLASH_BASE
comma
id|HDPU_EMB_FLASH_SIZE
comma
l_int|0
)paren
suffix:semicolon
id|bh.ci
op_member_access_from_pointer
id|enable_window_32bit
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2BOOT_WIN
)paren
suffix:semicolon
)brace
DECL|function|smp_hdpu_setup_cpu
r_static
r_void
id|smp_hdpu_setup_cpu
c_func
(paren
r_int
id|cpu_nr
)paren
(brace
r_if
c_cond
(paren
id|cpu_nr
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;smp_hdpu_setup_cpu 0&quot;
comma
l_int|0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64360_CPU0_DOORBELL_CLR
comma
l_int|0xff
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64360_CPU0_DOORBELL_MASK
comma
l_int|0xff
)paren
suffix:semicolon
id|request_irq
c_func
(paren
l_int|60
comma
id|hdpu_smp_cpu0_int_handler
comma
id|SA_INTERRUPT
comma
id|hdpu_smp0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cpu_nr
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;smp_hdpu_setup_cpu 1&quot;
comma
l_int|0
)paren
suffix:semicolon
id|hdpu_cpustate_set
c_func
(paren
id|CPUSTATE_KERNEL_MAJOR
op_or
id|CPUSTATE_KERNEL_CPU1_OK
)paren
suffix:semicolon
multiline_comment|/* Enable L1 Parity Bits */
id|hdpu_set_l1pe
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Enable L2 cache */
id|_set_L2CR
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|_set_L2CR
c_func
(paren
l_int|0x80080000
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64360_CPU1_DOORBELL_CLR
comma
l_int|0x0
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64360_CPU1_DOORBELL_MASK
comma
l_int|0xff
)paren
suffix:semicolon
id|request_irq
c_func
(paren
l_int|28
comma
id|hdpu_smp_cpu1_int_handler
comma
id|SA_INTERRUPT
comma
id|hdpu_smp1
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
DECL|function|hdpu_tben_give
r_void
id|__devinit
id|hdpu_tben_give
c_func
(paren
)paren
(brace
r_volatile
r_int
r_int
op_star
id|val
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* By writing 0 to the TBEN_BASE, the timebases is frozen */
id|val
op_assign
id|ioremap
c_func
(paren
id|HDPU_TBEN_BASE
comma
l_int|4
)paren
suffix:semicolon
op_star
id|val
op_assign
l_int|0
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|timebase_lock
)paren
suffix:semicolon
id|timebase_upper
op_assign
id|get_tbu
c_func
(paren
)paren
suffix:semicolon
id|timebase_lower
op_assign
id|get_tbl
c_func
(paren
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|timebase_lock
)paren
suffix:semicolon
r_while
c_loop
(paren
id|timebase_upper
op_logical_or
id|timebase_lower
)paren
id|barrier
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* By writing 1 to the TBEN_BASE, the timebases is thawed */
op_star
id|val
op_assign
l_int|1
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|val
)paren
suffix:semicolon
)brace
DECL|function|hdpu_tben_take
r_void
id|__devinit
id|hdpu_tben_take
c_func
(paren
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|timebase_upper
op_logical_or
id|timebase_lower
)paren
)paren
id|barrier
c_func
(paren
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|timebase_lock
)paren
suffix:semicolon
id|set_tb
c_func
(paren
id|timebase_upper
comma
id|timebase_lower
)paren
suffix:semicolon
id|timebase_upper
op_assign
l_int|0
suffix:semicolon
id|timebase_lower
op_assign
l_int|0
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|timebase_lock
)paren
suffix:semicolon
)brace
DECL|variable|hdpu_smp_ops
r_static
r_struct
id|smp_ops_t
id|hdpu_smp_ops
op_assign
(brace
dot
id|message_pass
op_assign
id|smp_hdpu_message_pass
comma
dot
id|probe
op_assign
id|smp_hdpu_probe
comma
dot
id|kick_cpu
op_assign
id|smp_hdpu_kick_cpu
comma
dot
id|setup_cpu
op_assign
id|smp_hdpu_setup_cpu
comma
dot
id|give_timebase
op_assign
id|hdpu_tben_give
comma
dot
id|take_timebase
op_assign
id|hdpu_tben_take
comma
)brace
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;/* CONFIG_SMP */
r_void
id|__init
DECL|function|platform_init
id|platform_init
c_func
(paren
r_int
r_int
id|r3
comma
r_int
r_int
id|r4
comma
r_int
r_int
id|r5
comma
r_int
r_int
id|r6
comma
r_int
r_int
id|r7
)paren
(brace
id|parse_bootinfo
c_func
(paren
id|r3
comma
id|r4
comma
id|r5
comma
id|r6
comma
id|r7
)paren
suffix:semicolon
id|isa_mem_base
op_assign
l_int|0
suffix:semicolon
id|ppc_md.setup_arch
op_assign
id|hdpu_setup_arch
suffix:semicolon
id|ppc_md.init
op_assign
id|hdpu_init2
suffix:semicolon
id|ppc_md.show_cpuinfo
op_assign
id|hdpu_show_cpuinfo
suffix:semicolon
id|ppc_md.init_IRQ
op_assign
id|hdpu_init_irq
suffix:semicolon
id|ppc_md.get_irq
op_assign
id|mv64360_get_irq
suffix:semicolon
id|ppc_md.restart
op_assign
id|hdpu_restart
suffix:semicolon
id|ppc_md.power_off
op_assign
id|hdpu_power_off
suffix:semicolon
id|ppc_md.halt
op_assign
id|hdpu_halt
suffix:semicolon
id|ppc_md.find_end_of_memory
op_assign
id|hdpu_find_end_of_memory
suffix:semicolon
id|ppc_md.calibrate_decr
op_assign
id|hdpu_calibrate_decr
suffix:semicolon
id|ppc_md.setup_io_mappings
op_assign
id|hdpu_map_io
suffix:semicolon
id|bh.p_base
op_assign
id|CONFIG_MV64X60_NEW_BASE
suffix:semicolon
id|bh.v_base
op_assign
(paren
r_int
r_int
op_star
)paren
id|bh.p_base
suffix:semicolon
id|hdpu_set_bat
c_func
(paren
)paren
suffix:semicolon
macro_line|#if defined(CONFIG_SERIAL_TEXT_DEBUG)
id|ppc_md.progress
op_assign
id|hdpu_mpsc_progress
suffix:semicolon
multiline_comment|/* embedded UART */
id|mv64x60_progress_init
c_func
(paren
id|bh.p_base
)paren
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;/* CONFIG_SERIAL_TEXT_DEBUG */
macro_line|#ifdef CONFIG_SMP
id|ppc_md.smp_ops
op_assign
op_amp
id|hdpu_smp_ops
suffix:semicolon
macro_line|#endif&t;&t;&t;&t;/* CONFIG_SMP */
macro_line|#if defined(CONFIG_SERIAL_MPSC) || defined(CONFIG_MV643XX_ETH)
id|platform_notify
op_assign
id|hdpu_platform_notify
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_SERIAL_TEXT_DEBUG) &amp;&amp; defined(CONFIG_SERIAL_MPSC_CONSOLE)
multiline_comment|/* SMP safe version of the serial text debug routine. Uses Semaphore 0 */
DECL|function|hdpu_mpsc_progress
r_void
id|hdpu_mpsc_progress
c_func
(paren
r_char
op_star
id|s
comma
r_int
r_int
id|hex
)paren
(brace
r_while
c_loop
(paren
id|mv64x60_read
c_func
(paren
op_amp
id|bh
comma
id|MV64360_WHO_AM_I
)paren
op_ne
id|mv64x60_read
c_func
(paren
op_amp
id|bh
comma
id|MV64360_SEMAPHORE_0
)paren
)paren
(brace
)brace
id|mv64x60_mpsc_progress
c_func
(paren
id|s
comma
id|hex
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64360_SEMAPHORE_0
comma
l_int|0xff
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|hdpu_cpustate_set
r_static
r_void
id|hdpu_cpustate_set
c_func
(paren
r_int
r_char
id|new_state
)paren
(brace
r_int
r_int
id|state
op_assign
(paren
id|new_state
op_lshift
l_int|21
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_GPP_VALUE_CLR
comma
(paren
l_int|0xff
op_lshift
l_int|21
)paren
)paren
suffix:semicolon
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_GPP_VALUE_CLR
comma
id|state
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_MTD_PHYSMAP
DECL|variable|hdpu_partitions
r_static
r_struct
id|mtd_partition
id|hdpu_partitions
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;Root FS&quot;
comma
dot
id|size
op_assign
l_int|0x03400000
comma
dot
id|offset
op_assign
l_int|0
comma
dot
id|mask_flags
op_assign
l_int|0
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;User FS&quot;
comma
dot
id|size
op_assign
l_int|0x00800000
comma
dot
id|offset
op_assign
l_int|0x03400000
comma
dot
id|mask_flags
op_assign
l_int|0
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;Kernel Image&quot;
comma
dot
id|size
op_assign
l_int|0x002C0000
comma
dot
id|offset
op_assign
l_int|0x03C00000
comma
dot
id|mask_flags
op_assign
l_int|0
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;bootEnv&quot;
comma
dot
id|size
op_assign
l_int|0x00040000
comma
dot
id|offset
op_assign
l_int|0x03EC0000
comma
dot
id|mask_flags
op_assign
l_int|0
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;bootROM&quot;
comma
dot
id|size
op_assign
l_int|0x00100000
comma
dot
id|offset
op_assign
l_int|0x03F00000
comma
dot
id|mask_flags
op_assign
l_int|0
comma
)brace
)brace
suffix:semicolon
DECL|function|hdpu_setup_mtd
r_static
r_int
id|__init
id|hdpu_setup_mtd
c_func
(paren
r_void
)paren
(brace
id|physmap_set_partitions
c_func
(paren
id|hdpu_partitions
comma
l_int|5
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|hdpu_setup_mtd
id|arch_initcall
c_func
(paren
id|hdpu_setup_mtd
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_HDPU_FEATURES
DECL|variable|hdpu_cpustate_resources
r_static
r_struct
id|resource
id|hdpu_cpustate_resources
(braket
)braket
op_assign
(brace
(braket
l_int|0
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;addr base&quot;
comma
dot
id|start
op_assign
id|MV64x60_GPP_VALUE_SET
comma
dot
id|end
op_assign
id|MV64x60_GPP_VALUE_CLR
op_plus
l_int|1
comma
dot
id|flags
op_assign
id|IORESOURCE_MEM
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|hdpu_nexus_resources
r_static
r_struct
id|resource
id|hdpu_nexus_resources
(braket
)braket
op_assign
(brace
(braket
l_int|0
)braket
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;nexus register&quot;
comma
dot
id|start
op_assign
id|HDPU_NEXUS_ID_BASE
comma
dot
id|end
op_assign
id|HDPU_NEXUS_ID_BASE
op_plus
id|HDPU_NEXUS_ID_SIZE
comma
dot
id|flags
op_assign
id|IORESOURCE_MEM
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|hdpu_cpustate_device
r_static
r_struct
id|platform_device
id|hdpu_cpustate_device
op_assign
(brace
dot
id|name
op_assign
id|HDPU_CPUSTATE_NAME
comma
dot
id|id
op_assign
l_int|0
comma
dot
id|num_resources
op_assign
id|ARRAY_SIZE
c_func
(paren
id|hdpu_cpustate_resources
)paren
comma
dot
id|resource
op_assign
id|hdpu_cpustate_resources
comma
)brace
suffix:semicolon
DECL|variable|hdpu_nexus_device
r_static
r_struct
id|platform_device
id|hdpu_nexus_device
op_assign
(brace
dot
id|name
op_assign
id|HDPU_NEXUS_NAME
comma
dot
id|id
op_assign
l_int|0
comma
dot
id|num_resources
op_assign
id|ARRAY_SIZE
c_func
(paren
id|hdpu_nexus_resources
)paren
comma
dot
id|resource
op_assign
id|hdpu_nexus_resources
comma
)brace
suffix:semicolon
DECL|function|hdpu_add_pds
r_static
r_int
id|__init
id|hdpu_add_pds
c_func
(paren
r_void
)paren
(brace
id|platform_device_register
c_func
(paren
op_amp
id|hdpu_cpustate_device
)paren
suffix:semicolon
id|platform_device_register
c_func
(paren
op_amp
id|hdpu_nexus_device
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|hdpu_add_pds
id|arch_initcall
c_func
(paren
id|hdpu_add_pds
)paren
suffix:semicolon
macro_line|#endif
eof
