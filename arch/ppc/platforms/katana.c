multiline_comment|/*&n; * arch/ppc/platforms/katana.c&n; *&n; * Board setup routines for the Artesyn Katana cPCI boards.&n; *&n; * Athor: Tim Montgomery &lt;timm@artesyncp.com&gt;&n; * Maintained by: Mark A. Greer &lt;mgreer@mvista.com&gt;&n; *&n; * Based on code done by Rabeeh Khoury - rabeeh@galileo.co.il&n; * Based on code done by - Mark A. Greer &lt;mgreer@mvista.com&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify it&n; * under the terms of the GNU General Public License as published by the&n; * Free Software Foundation; either version 2 of the License, or (at your&n; * option) any later version.&n; */
multiline_comment|/*&n; * Supports the Artesyn 750i, 752i, and 3750.  The 752i is virtually identical&n; * to the 750i except that it has an mv64460 bridge.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/kdev_t.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/initrd.h&gt;
macro_line|#include &lt;linux/root_dev.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &lt;linux/bootmem.h&gt;
macro_line|#include &lt;linux/mtd/physmap.h&gt;
macro_line|#include &lt;linux/mv643xx.h&gt;
macro_line|#ifdef CONFIG_BOOTIMG
macro_line|#include &lt;linux/bootimg.h&gt;
macro_line|#endif
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/time.h&gt;
macro_line|#include &lt;asm/smp.h&gt;
macro_line|#include &lt;asm/todc.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#include &lt;asm/ppcboot.h&gt;
macro_line|#include &lt;asm/mv64x60.h&gt;
macro_line|#include &lt;platforms/katana.h&gt;
DECL|variable|bh
r_static
r_struct
id|mv64x60_handle
id|bh
suffix:semicolon
DECL|variable|katana_id
r_static
id|katana_id_t
id|katana_id
suffix:semicolon
DECL|variable|cpld_base
r_static
r_void
id|__iomem
op_star
id|cpld_base
suffix:semicolon
DECL|variable|sram_base
r_static
r_void
id|__iomem
op_star
id|sram_base
suffix:semicolon
DECL|variable|katana_flash_size_0
r_static
id|u32
id|katana_flash_size_0
suffix:semicolon
DECL|variable|katana_flash_size_1
r_static
id|u32
id|katana_flash_size_1
suffix:semicolon
DECL|variable|__res
r_int
r_char
id|__res
(braket
r_sizeof
(paren
id|bd_t
)paren
)braket
suffix:semicolon
multiline_comment|/* PCI Interrupt routing */
r_static
r_int
id|__init
DECL|function|katana_irq_lookup_750i
id|katana_irq_lookup_750i
c_func
(paren
r_int
r_char
id|idsel
comma
r_int
r_char
id|pin
)paren
(brace
r_static
r_char
id|pci_irq_table
(braket
)braket
(braket
l_int|4
)braket
op_assign
(brace
multiline_comment|/*&n;&t;&t; * PCI IDSEL/INTPIN-&gt;INTLINE&n;&t;&t; *       A   B   C   D&n;&t;&t; */
multiline_comment|/* IDSEL 4  (PMC 1) */
(brace
id|KATANA_PCI_INTB_IRQ_750i
comma
id|KATANA_PCI_INTC_IRQ_750i
comma
id|KATANA_PCI_INTD_IRQ_750i
comma
id|KATANA_PCI_INTA_IRQ_750i
)brace
comma
multiline_comment|/* IDSEL 5  (PMC 2) */
(brace
id|KATANA_PCI_INTC_IRQ_750i
comma
id|KATANA_PCI_INTD_IRQ_750i
comma
id|KATANA_PCI_INTA_IRQ_750i
comma
id|KATANA_PCI_INTB_IRQ_750i
)brace
comma
multiline_comment|/* IDSEL 6 (T8110) */
(brace
id|KATANA_PCI_INTD_IRQ_750i
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
)brace
suffix:semicolon
r_const
r_int
id|min_idsel
op_assign
l_int|4
comma
id|max_idsel
op_assign
l_int|6
comma
id|irqs_per_slot
op_assign
l_int|4
suffix:semicolon
r_return
id|PCI_IRQ_TABLE_LOOKUP
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|katana_irq_lookup_3750
id|katana_irq_lookup_3750
c_func
(paren
r_int
r_char
id|idsel
comma
r_int
r_char
id|pin
)paren
(brace
r_static
r_char
id|pci_irq_table
(braket
)braket
(braket
l_int|4
)braket
op_assign
(brace
multiline_comment|/*&n;&t;&t; * PCI IDSEL/INTPIN-&gt;INTLINE&n;&t;&t; *       A   B   C   D&n;&t;&t; */
(brace
id|KATANA_PCI_INTA_IRQ_3750
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 3 (BCM5691) */
(brace
id|KATANA_PCI_INTB_IRQ_3750
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 4 (MV64360 #2)*/
(brace
id|KATANA_PCI_INTC_IRQ_3750
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* IDSEL 5 (MV64360 #3)*/
)brace
suffix:semicolon
r_const
r_int
id|min_idsel
op_assign
l_int|3
comma
id|max_idsel
op_assign
l_int|5
comma
id|irqs_per_slot
op_assign
l_int|4
suffix:semicolon
r_return
id|PCI_IRQ_TABLE_LOOKUP
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|katana_map_irq
id|katana_map_irq
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
r_char
id|idsel
comma
r_int
r_char
id|pin
)paren
(brace
r_switch
c_cond
(paren
id|katana_id
)paren
(brace
r_case
id|KATANA_ID_750I
suffix:colon
r_case
id|KATANA_ID_752I
suffix:colon
r_return
id|katana_irq_lookup_750i
c_func
(paren
id|idsel
comma
id|pin
)paren
suffix:semicolon
r_case
id|KATANA_ID_3750
suffix:colon
r_return
id|katana_irq_lookup_3750
c_func
(paren
id|idsel
comma
id|pin
)paren
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Bogus board ID&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* Board info retrieval routines */
r_void
id|__init
DECL|function|katana_get_board_id
id|katana_get_board_id
c_func
(paren
r_void
)paren
(brace
r_switch
c_cond
(paren
id|in_8
c_func
(paren
id|cpld_base
op_plus
id|KATANA_CPLD_PRODUCT_ID
)paren
)paren
(brace
r_case
id|KATANA_PRODUCT_ID_3750
suffix:colon
id|katana_id
op_assign
id|KATANA_ID_3750
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KATANA_PRODUCT_ID_750i
suffix:colon
id|katana_id
op_assign
id|KATANA_ID_750I
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KATANA_PRODUCT_ID_752i
suffix:colon
id|katana_id
op_assign
id|KATANA_ID_752I
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Unsupported board&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_int
id|__init
DECL|function|katana_get_proc_num
id|katana_get_proc_num
c_func
(paren
r_void
)paren
(brace
id|u16
id|val
suffix:semicolon
id|u8
id|save_exclude
suffix:semicolon
r_static
r_int
id|proc
op_assign
op_minus
l_int|1
suffix:semicolon
r_static
id|u8
id|first_time
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|first_time
)paren
(brace
r_if
c_cond
(paren
id|katana_id
op_ne
id|KATANA_ID_3750
)paren
id|proc
op_assign
l_int|0
suffix:semicolon
r_else
(brace
id|save_exclude
op_assign
id|mv64x60_pci_exclude_bridge
suffix:semicolon
id|mv64x60_pci_exclude_bridge
op_assign
l_int|0
suffix:semicolon
id|early_read_config_word
c_func
(paren
id|bh.hose_a
comma
l_int|0
comma
id|PCI_DEVFN
c_func
(paren
l_int|0
comma
l_int|0
)paren
comma
id|PCI_DEVICE_ID
comma
op_amp
id|val
)paren
suffix:semicolon
id|mv64x60_pci_exclude_bridge
op_assign
id|save_exclude
suffix:semicolon
r_switch
c_cond
(paren
id|val
)paren
(brace
r_case
id|PCI_DEVICE_ID_KATANA_3750_PROC0
suffix:colon
id|proc
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_KATANA_3750_PROC1
suffix:colon
id|proc
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PCI_DEVICE_ID_KATANA_3750_PROC2
suffix:colon
id|proc
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Bogus Device ID&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
id|first_time
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|proc
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|katana_is_monarch
id|katana_is_monarch
c_func
(paren
r_void
)paren
(brace
r_return
id|in_8
c_func
(paren
id|cpld_base
op_plus
id|KATANA_CPLD_BD_CFG_3
)paren
op_amp
id|KATANA_CPLD_BD_CFG_3_MONARCH
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|katana_enable_ipmi
id|katana_enable_ipmi
c_func
(paren
r_void
)paren
(brace
id|u8
id|reset_out
suffix:semicolon
multiline_comment|/* Enable access to IPMI ctlr by clearing IPMI PORTSEL bit in CPLD */
id|reset_out
op_assign
id|in_8
c_func
(paren
id|cpld_base
op_plus
id|KATANA_CPLD_RESET_OUT
)paren
suffix:semicolon
id|reset_out
op_and_assign
op_complement
id|KATANA_CPLD_RESET_OUT_PORTSEL
suffix:semicolon
id|out_8
c_func
(paren
id|cpld_base
op_plus
id|KATANA_CPLD_RESET_OUT
comma
id|reset_out
)paren
suffix:semicolon
)brace
r_static
id|u32
DECL|function|katana_bus_freq
id|katana_bus_freq
c_func
(paren
r_void
)paren
(brace
id|u8
id|bd_cfg_0
suffix:semicolon
id|bd_cfg_0
op_assign
id|in_8
c_func
(paren
id|cpld_base
op_plus
id|KATANA_CPLD_BD_CFG_0
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|bd_cfg_0
op_amp
id|KATANA_CPLD_BD_CFG_0_SYSCLK_MASK
)paren
(brace
r_case
id|KATANA_CPLD_BD_CFG_0_SYSCLK_200
suffix:colon
r_return
l_int|200000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KATANA_CPLD_BD_CFG_0_SYSCLK_166
suffix:colon
r_return
l_int|166666666
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KATANA_CPLD_BD_CFG_0_SYSCLK_133
suffix:colon
r_return
l_int|133333333
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KATANA_CPLD_BD_CFG_0_SYSCLK_100
suffix:colon
r_return
l_int|100000000
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_return
l_int|133333333
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Bridge &amp; platform setup routines */
r_void
id|__init
DECL|function|katana_intr_setup
id|katana_intr_setup
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* MPP 8, 9, and 10 */
id|mv64x60_clr_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_MPP_CNTL_1
comma
l_int|0xfff
)paren
suffix:semicolon
multiline_comment|/* MPP 14 */
r_if
c_cond
(paren
(paren
id|katana_id
op_eq
id|KATANA_ID_750I
)paren
op_logical_or
(paren
id|katana_id
op_eq
id|KATANA_ID_752I
)paren
)paren
id|mv64x60_clr_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_MPP_CNTL_1
comma
l_int|0x0f000000
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Define GPP 8,9,and 10 interrupt polarity as active low&n;&t; * input signal and level triggered&n;&t; */
id|mv64x60_set_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_GPP_LEVEL_CNTL
comma
l_int|0x700
)paren
suffix:semicolon
id|mv64x60_clr_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_GPP_IO_CNTL
comma
l_int|0x700
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|katana_id
op_eq
id|KATANA_ID_750I
)paren
op_logical_or
(paren
id|katana_id
op_eq
id|KATANA_ID_752I
)paren
)paren
(brace
id|mv64x60_set_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_GPP_LEVEL_CNTL
comma
(paren
l_int|1
op_lshift
l_int|14
)paren
)paren
suffix:semicolon
id|mv64x60_clr_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_GPP_IO_CNTL
comma
(paren
l_int|1
op_lshift
l_int|14
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Config GPP intr ctlr to respond to level trigger */
id|mv64x60_set_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_COMM_ARBITER_CNTL
comma
(paren
l_int|1
op_lshift
l_int|10
)paren
)paren
suffix:semicolon
multiline_comment|/* Erranum FEr PCI-#8 */
id|mv64x60_clr_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_PCI0_CMD
comma
(paren
l_int|1
op_lshift
l_int|5
)paren
op_or
(paren
l_int|1
op_lshift
l_int|9
)paren
)paren
suffix:semicolon
id|mv64x60_clr_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_PCI1_CMD
comma
(paren
l_int|1
op_lshift
l_int|5
)paren
op_or
(paren
l_int|1
op_lshift
l_int|9
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Dismiss and then enable interrupt on GPP interrupt cause&n;&t; * for CPU #0&n;&t; */
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_GPP_INTR_CAUSE
comma
op_complement
l_int|0x700
)paren
suffix:semicolon
id|mv64x60_set_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_GPP_INTR_MASK
comma
l_int|0x700
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|katana_id
op_eq
id|KATANA_ID_750I
)paren
op_logical_or
(paren
id|katana_id
op_eq
id|KATANA_ID_752I
)paren
)paren
(brace
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_GPP_INTR_CAUSE
comma
op_complement
(paren
l_int|1
op_lshift
l_int|14
)paren
)paren
suffix:semicolon
id|mv64x60_set_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_GPP_INTR_MASK
comma
(paren
l_int|1
op_lshift
l_int|14
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Dismiss and then enable interrupt on CPU #0 high cause reg&n;&t; * BIT25 summarizes GPP interrupts 8-15&n;&t; */
id|mv64x60_set_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64360_IC_CPU0_INTR_MASK_HI
comma
(paren
l_int|1
op_lshift
l_int|25
)paren
)paren
suffix:semicolon
)brace
r_void
id|__init
DECL|function|katana_setup_peripherals
id|katana_setup_peripherals
c_func
(paren
r_void
)paren
(brace
id|u32
id|base
suffix:semicolon
multiline_comment|/* Set up windows for boot CS, soldered &amp; socketed flash, and CPLD */
id|mv64x60_set_32bit_window
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2BOOT_WIN
comma
id|KATANA_BOOT_WINDOW_BASE
comma
id|KATANA_BOOT_WINDOW_SIZE
comma
l_int|0
)paren
suffix:semicolon
id|bh.ci
op_member_access_from_pointer
id|enable_window_32bit
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2BOOT_WIN
)paren
suffix:semicolon
multiline_comment|/* Assume firmware set up window sizes correctly for dev 0 &amp; 1 */
id|mv64x60_get_32bit_window
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2DEV_0_WIN
comma
op_amp
id|base
comma
op_amp
id|katana_flash_size_0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|katana_flash_size_0
OG
l_int|0
)paren
(brace
id|mv64x60_set_32bit_window
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2DEV_0_WIN
comma
id|KATANA_SOLDERED_FLASH_BASE
comma
id|katana_flash_size_0
comma
l_int|0
)paren
suffix:semicolon
id|bh.ci
op_member_access_from_pointer
id|enable_window_32bit
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2DEV_0_WIN
)paren
suffix:semicolon
)brace
id|mv64x60_get_32bit_window
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2DEV_1_WIN
comma
op_amp
id|base
comma
op_amp
id|katana_flash_size_1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|katana_flash_size_1
OG
l_int|0
)paren
(brace
id|mv64x60_set_32bit_window
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2DEV_1_WIN
comma
(paren
id|KATANA_SOLDERED_FLASH_BASE
op_plus
id|katana_flash_size_0
)paren
comma
id|katana_flash_size_1
comma
l_int|0
)paren
suffix:semicolon
id|bh.ci
op_member_access_from_pointer
id|enable_window_32bit
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2DEV_1_WIN
)paren
suffix:semicolon
)brace
id|mv64x60_set_32bit_window
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2DEV_2_WIN
comma
id|KATANA_SOCKET_BASE
comma
id|KATANA_SOCKETED_FLASH_SIZE
comma
l_int|0
)paren
suffix:semicolon
id|bh.ci
op_member_access_from_pointer
id|enable_window_32bit
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2DEV_2_WIN
)paren
suffix:semicolon
id|mv64x60_set_32bit_window
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2DEV_3_WIN
comma
id|KATANA_CPLD_BASE
comma
id|KATANA_CPLD_SIZE
comma
l_int|0
)paren
suffix:semicolon
id|bh.ci
op_member_access_from_pointer
id|enable_window_32bit
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2DEV_3_WIN
)paren
suffix:semicolon
id|cpld_base
op_assign
id|ioremap
c_func
(paren
id|KATANA_CPLD_BASE
comma
id|KATANA_CPLD_SIZE
)paren
suffix:semicolon
id|mv64x60_set_32bit_window
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2SRAM_WIN
comma
id|KATANA_INTERNAL_SRAM_BASE
comma
id|MV64360_SRAM_SIZE
comma
l_int|0
)paren
suffix:semicolon
id|bh.ci
op_member_access_from_pointer
id|enable_window_32bit
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_CPU2SRAM_WIN
)paren
suffix:semicolon
id|sram_base
op_assign
id|ioremap
c_func
(paren
id|KATANA_INTERNAL_SRAM_BASE
comma
id|MV64360_SRAM_SIZE
)paren
suffix:semicolon
multiline_comment|/* Set up Enet-&gt;SRAM window */
id|mv64x60_set_32bit_window
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_ENET2MEM_4_WIN
comma
id|KATANA_INTERNAL_SRAM_BASE
comma
id|MV64360_SRAM_SIZE
comma
l_int|0x2
)paren
suffix:semicolon
id|bh.ci
op_member_access_from_pointer
id|enable_window_32bit
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_ENET2MEM_4_WIN
)paren
suffix:semicolon
multiline_comment|/* Give enet r/w access to memory region */
id|mv64x60_set_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64360_ENET2MEM_ACC_PROT_0
comma
(paren
l_int|0x3
op_lshift
(paren
l_int|4
op_lshift
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|mv64x60_set_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64360_ENET2MEM_ACC_PROT_1
comma
(paren
l_int|0x3
op_lshift
(paren
l_int|4
op_lshift
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|mv64x60_set_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64360_ENET2MEM_ACC_PROT_2
comma
(paren
l_int|0x3
op_lshift
(paren
l_int|4
op_lshift
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|mv64x60_clr_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_PCI1_PCI_DECODE_CNTL
comma
(paren
l_int|1
op_lshift
l_int|3
)paren
)paren
suffix:semicolon
id|mv64x60_clr_bits
c_func
(paren
op_amp
id|bh
comma
id|MV64x60_TIMR_CNTR_0_3_CNTL
comma
(paren
(paren
l_int|1
op_lshift
l_int|0
)paren
op_or
(paren
l_int|1
op_lshift
l_int|8
)paren
op_or
(paren
l_int|1
op_lshift
l_int|16
)paren
op_or
(paren
l_int|1
op_lshift
l_int|24
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/* Must wait until window set up before retrieving board id */
id|katana_get_board_id
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Enumerate pci bus (must know board id before getting proc number) */
r_if
c_cond
(paren
id|katana_get_proc_num
c_func
(paren
)paren
op_eq
l_int|0
)paren
id|bh.hose_b-&gt;last_busno
op_assign
id|pciauto_bus_scan
c_func
(paren
id|bh.hose_b
comma
l_int|0
)paren
suffix:semicolon
macro_line|#if defined(CONFIG_NOT_COHERENT_CACHE)
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64360_SRAM_CONFIG
comma
l_int|0x00160000
)paren
suffix:semicolon
macro_line|#else
id|mv64x60_write
c_func
(paren
op_amp
id|bh
comma
id|MV64360_SRAM_CONFIG
comma
l_int|0x001600b2
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; * Setting the SRAM to 0. Note that this generates parity errors on&n;&t; * internal data path in SRAM since it&squot;s first time accessing it&n;&t; * while after reset it&squot;s not configured.&n;&t; */
id|memset
c_func
(paren
id|sram_base
comma
l_int|0
comma
id|MV64360_SRAM_SIZE
)paren
suffix:semicolon
multiline_comment|/* Only processor zero [on 3750] is an PCI interrupt controller */
r_if
c_cond
(paren
id|katana_get_proc_num
c_func
(paren
)paren
op_eq
l_int|0
)paren
id|katana_intr_setup
c_func
(paren
)paren
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|katana_setup_bridge
id|katana_setup_bridge
c_func
(paren
r_void
)paren
(brace
r_struct
id|mv64x60_setup_info
id|si
suffix:semicolon
r_int
id|i
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|si
comma
l_int|0
comma
r_sizeof
(paren
id|si
)paren
)paren
suffix:semicolon
id|si.phys_reg_base
op_assign
id|CONFIG_MV64X60_NEW_BASE
suffix:semicolon
id|si.pci_1.enable_bus
op_assign
l_int|1
suffix:semicolon
id|si.pci_1.pci_io.cpu_base
op_assign
id|KATANA_PCI1_IO_START_PROC_ADDR
suffix:semicolon
id|si.pci_1.pci_io.pci_base_hi
op_assign
l_int|0
suffix:semicolon
id|si.pci_1.pci_io.pci_base_lo
op_assign
id|KATANA_PCI1_IO_START_PCI_ADDR
suffix:semicolon
id|si.pci_1.pci_io.size
op_assign
id|KATANA_PCI1_IO_SIZE
suffix:semicolon
id|si.pci_1.pci_io.swap
op_assign
id|MV64x60_CPU2PCI_SWAP_NONE
suffix:semicolon
id|si.pci_1.pci_mem
(braket
l_int|0
)braket
dot
id|cpu_base
op_assign
id|KATANA_PCI1_MEM_START_PROC_ADDR
suffix:semicolon
id|si.pci_1.pci_mem
(braket
l_int|0
)braket
dot
id|pci_base_hi
op_assign
id|KATANA_PCI1_MEM_START_PCI_HI_ADDR
suffix:semicolon
id|si.pci_1.pci_mem
(braket
l_int|0
)braket
dot
id|pci_base_lo
op_assign
id|KATANA_PCI1_MEM_START_PCI_LO_ADDR
suffix:semicolon
id|si.pci_1.pci_mem
(braket
l_int|0
)braket
dot
id|size
op_assign
id|KATANA_PCI1_MEM_SIZE
suffix:semicolon
id|si.pci_1.pci_mem
(braket
l_int|0
)braket
dot
id|swap
op_assign
id|MV64x60_CPU2PCI_SWAP_NONE
suffix:semicolon
id|si.pci_1.pci_cmd_bits
op_assign
l_int|0
suffix:semicolon
id|si.pci_1.latency_timer
op_assign
l_int|0x80
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MV64x60_CPU2MEM_WINDOWS
suffix:semicolon
id|i
op_increment
)paren
(brace
macro_line|#if defined(CONFIG_NOT_COHERENT_CACHE)
id|si.cpu_prot_options
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|si.enet_options
(braket
id|i
)braket
op_assign
id|MV64360_ENET2MEM_SNOOP_NONE
suffix:semicolon
id|si.mpsc_options
(braket
id|i
)braket
op_assign
id|MV64360_MPSC2MEM_SNOOP_NONE
suffix:semicolon
id|si.idma_options
(braket
id|i
)braket
op_assign
id|MV64360_IDMA2MEM_SNOOP_NONE
suffix:semicolon
id|si.pci_1.acc_cntl_options
(braket
id|i
)braket
op_assign
id|MV64360_PCI_ACC_CNTL_SNOOP_NONE
op_or
id|MV64360_PCI_ACC_CNTL_SWAP_NONE
op_or
id|MV64360_PCI_ACC_CNTL_MBURST_128_BYTES
op_or
id|MV64360_PCI_ACC_CNTL_RDSIZE_256_BYTES
suffix:semicolon
macro_line|#else
id|si.cpu_prot_options
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|si.enet_options
(braket
id|i
)braket
op_assign
id|MV64360_ENET2MEM_SNOOP_NONE
suffix:semicolon
multiline_comment|/* errata */
id|si.mpsc_options
(braket
id|i
)braket
op_assign
id|MV64360_MPSC2MEM_SNOOP_NONE
suffix:semicolon
multiline_comment|/* errata */
id|si.idma_options
(braket
id|i
)braket
op_assign
id|MV64360_IDMA2MEM_SNOOP_NONE
suffix:semicolon
multiline_comment|/* errata */
id|si.pci_1.acc_cntl_options
(braket
id|i
)braket
op_assign
id|MV64360_PCI_ACC_CNTL_SNOOP_WB
op_or
id|MV64360_PCI_ACC_CNTL_SWAP_NONE
op_or
id|MV64360_PCI_ACC_CNTL_MBURST_32_BYTES
op_or
id|MV64360_PCI_ACC_CNTL_RDSIZE_32_BYTES
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* Lookup PCI host bridges */
r_if
c_cond
(paren
id|mv64x60_init
c_func
(paren
op_amp
id|bh
comma
op_amp
id|si
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Bridge initialization failed.&bslash;n&quot;
)paren
suffix:semicolon
id|pci_dram_offset
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* sys mem at same addr on PCI &amp; cpu bus */
id|ppc_md.pci_swizzle
op_assign
id|common_swizzle
suffix:semicolon
id|ppc_md.pci_map_irq
op_assign
id|katana_map_irq
suffix:semicolon
id|ppc_md.pci_exclude_device
op_assign
id|mv64x60_pci_exclude_device
suffix:semicolon
id|mv64x60_set_bus
c_func
(paren
op_amp
id|bh
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|bh.hose_b-&gt;first_busno
op_assign
l_int|0
suffix:semicolon
id|bh.hose_b-&gt;last_busno
op_assign
l_int|0xff
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_MTD_PHYSMAP
macro_line|#ifndef MB
DECL|macro|MB
mdefine_line|#define MB&t;(1 &lt;&lt; 20)
macro_line|#endif
multiline_comment|/*&n; * MTD Layout depends on amount of soldered FLASH in system. Sizes in MB.&n; *&n; * FLASH Amount:&t;128&t;64&t;32&t;16&n; * -------------&t;---&t;--&t;--&t;--&n; * Monitor:&t;&t;1&t;1&t;1&t;1&n; * Primary Kernel:&t;1.5&t;1.5&t;1.5&t;1.5&n; * Primary fs:&t;&t;30&t;30&t;&lt;end&gt;&t;&lt;end&gt;&n; * Secondary Kernel:&t;1.5&t;1.5&t;N/A&t;N/A&n; * Secondary fs:&t;&lt;end&gt;&t;&lt;end&gt;&t;N/A&t;N/A&n; * User: &t;&t;&lt;overlays entire FLASH except for &quot;Monitor&quot; section&gt;&n; */
r_static
r_int
id|__init
DECL|function|katana_setup_mtd
id|katana_setup_mtd
c_func
(paren
r_void
)paren
(brace
id|u32
id|size
suffix:semicolon
r_int
id|ptbl_entries
suffix:semicolon
r_static
r_struct
id|mtd_partition
op_star
id|ptbl
suffix:semicolon
id|size
op_assign
id|katana_flash_size_0
op_plus
id|katana_flash_size_1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|size
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|ptbl_entries
op_assign
(paren
id|size
op_ge
(paren
l_int|64
op_star
id|MB
)paren
)paren
ques
c_cond
l_int|6
suffix:colon
l_int|4
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ptbl
op_assign
id|kmalloc
c_func
(paren
id|ptbl_entries
op_star
r_sizeof
(paren
r_struct
id|mtd_partition
)paren
comma
id|GFP_KERNEL
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Can&squot;t alloc MTD partition table&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|ptbl
comma
l_int|0
comma
id|ptbl_entries
op_star
r_sizeof
(paren
r_struct
id|mtd_partition
)paren
)paren
suffix:semicolon
id|ptbl
(braket
l_int|0
)braket
dot
id|name
op_assign
l_string|&quot;Monitor&quot;
suffix:semicolon
id|ptbl
(braket
l_int|0
)braket
dot
id|size
op_assign
id|KATANA_MTD_MONITOR_SIZE
suffix:semicolon
id|ptbl
(braket
l_int|1
)braket
dot
id|name
op_assign
l_string|&quot;Primary Kernel&quot;
suffix:semicolon
id|ptbl
(braket
l_int|1
)braket
dot
id|offset
op_assign
id|MTDPART_OFS_NXTBLK
suffix:semicolon
id|ptbl
(braket
l_int|1
)braket
dot
id|size
op_assign
l_int|0x00180000
suffix:semicolon
multiline_comment|/* 1.5 MB */
id|ptbl
(braket
l_int|2
)braket
dot
id|name
op_assign
l_string|&quot;Primary Filesystem&quot;
suffix:semicolon
id|ptbl
(braket
l_int|2
)braket
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
suffix:semicolon
id|ptbl
(braket
l_int|2
)braket
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
suffix:semicolon
multiline_comment|/* Correct for 16 &amp; 32 MB */
id|ptbl
(braket
id|ptbl_entries
op_minus
l_int|1
)braket
dot
id|name
op_assign
l_string|&quot;User FLASH&quot;
suffix:semicolon
id|ptbl
(braket
id|ptbl_entries
op_minus
l_int|1
)braket
dot
id|offset
op_assign
id|KATANA_MTD_MONITOR_SIZE
suffix:semicolon
id|ptbl
(braket
id|ptbl_entries
op_minus
l_int|1
)braket
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
suffix:semicolon
r_if
c_cond
(paren
id|size
op_ge
(paren
l_int|64
op_star
id|MB
)paren
)paren
(brace
id|ptbl
(braket
l_int|2
)braket
dot
id|size
op_assign
l_int|30
op_star
id|MB
suffix:semicolon
id|ptbl
(braket
l_int|3
)braket
dot
id|name
op_assign
l_string|&quot;Secondary Kernel&quot;
suffix:semicolon
id|ptbl
(braket
l_int|3
)braket
dot
id|offset
op_assign
id|MTDPART_OFS_NXTBLK
suffix:semicolon
id|ptbl
(braket
l_int|3
)braket
dot
id|size
op_assign
l_int|0x00180000
suffix:semicolon
multiline_comment|/* 1.5 MB */
id|ptbl
(braket
l_int|4
)braket
dot
id|name
op_assign
l_string|&quot;Secondary Filesystem&quot;
suffix:semicolon
id|ptbl
(braket
l_int|4
)braket
dot
id|offset
op_assign
id|MTDPART_OFS_APPEND
suffix:semicolon
id|ptbl
(braket
l_int|4
)braket
dot
id|size
op_assign
id|MTDPART_SIZ_FULL
suffix:semicolon
)brace
id|physmap_map.size
op_assign
id|size
suffix:semicolon
id|physmap_set_partitions
c_func
(paren
id|ptbl
comma
id|ptbl_entries
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|katana_setup_mtd
id|arch_initcall
c_func
(paren
id|katana_setup_mtd
)paren
suffix:semicolon
macro_line|#endif
r_static
r_void
id|__init
DECL|function|katana_setup_arch
id|katana_setup_arch
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;katana_setup_arch: enter&quot;
comma
l_int|0
)paren
suffix:semicolon
id|set_tb
c_func
(paren
l_int|0
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_INITRD
r_if
c_cond
(paren
id|initrd_start
)paren
id|ROOT_DEV
op_assign
id|Root_RAM0
suffix:semicolon
r_else
macro_line|#endif
macro_line|#ifdef   CONFIG_ROOT_NFS
id|ROOT_DEV
op_assign
id|Root_NFS
suffix:semicolon
macro_line|#else
id|ROOT_DEV
op_assign
id|Root_SDA2
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; * Set up the L2CR register.&n;&t; *&n;&t; * 750FX has only L2E, L2PE (bits 2-8 are reserved)&n;&t; * DD2.0 has bug that requires the L2 to be in WRT mode&n;&t; * avoid dirty data in cache&n;&t; */
r_if
c_cond
(paren
id|PVR_REV
c_func
(paren
id|mfspr
c_func
(paren
id|PVR
)paren
)paren
op_eq
l_int|0x0200
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;DD2.0 detected. Setting L2 cache&quot;
l_string|&quot;to Writethrough mode&bslash;n&quot;
)paren
suffix:semicolon
id|_set_L2CR
c_func
(paren
id|L2CR_L2E
op_or
id|L2CR_L2PE
op_or
id|L2CR_L2WT
)paren
suffix:semicolon
)brace
r_else
id|_set_L2CR
c_func
(paren
id|L2CR_L2E
op_or
id|L2CR_L2PE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;katana_setup_arch: calling setup_bridge&quot;
comma
l_int|0
)paren
suffix:semicolon
id|katana_setup_bridge
c_func
(paren
)paren
suffix:semicolon
id|katana_setup_peripherals
c_func
(paren
)paren
suffix:semicolon
id|katana_enable_ipmi
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Artesyn Communication Products, LLC - Katana(TM)&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ppc_md.progress
)paren
id|ppc_md
dot
id|progress
c_func
(paren
l_string|&quot;katana_setup_arch: exit&quot;
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Platform device data fixup routines. */
macro_line|#if defined(CONFIG_SERIAL_MPSC)
r_static
r_void
id|__init
DECL|function|katana_fixup_mpsc_pdata
id|katana_fixup_mpsc_pdata
c_func
(paren
r_struct
id|platform_device
op_star
id|pdev
)paren
(brace
r_struct
id|mpsc_pdata
op_star
id|pdata
suffix:semicolon
id|pdata
op_assign
(paren
r_struct
id|mpsc_pdata
op_star
)paren
id|pdev-&gt;dev.platform_data
suffix:semicolon
id|pdata-&gt;max_idle
op_assign
l_int|40
suffix:semicolon
id|pdata-&gt;default_baud
op_assign
id|KATANA_DEFAULT_BAUD
suffix:semicolon
id|pdata-&gt;brg_clk_src
op_assign
id|KATANA_MPSC_CLK_SRC
suffix:semicolon
multiline_comment|/*&n;&t; * TCLK (not SysCLk) is routed to BRG, then to the MPSC.  On most parts,&n;&t; * TCLK == SysCLK but on 64460, they are separate pins.&n;&t; * SysCLK can go up to 200 MHz but TCLK can only go up to 133 MHz.&n;&t; */
id|pdata-&gt;brg_clk_freq
op_assign
id|min
c_func
(paren
id|katana_bus_freq
c_func
(paren
)paren
comma
id|MV64x60_TCLK_FREQ_MAX
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if defined(CONFIG_MV643XX_ETH)
r_static
r_void
id|__init
DECL|function|katana_fixup_eth_pdata
id|katana_fixup_eth_pdata
c_func
(paren
r_struct
id|platform_device
op_star
id|pdev
)paren
(brace
r_struct
id|mv643xx_eth_platform_data
op_star
id|eth_pd
suffix:semicolon
r_static
id|u16
id|phy_addr
(braket
)braket
op_assign
(brace
id|KATANA_ETH0_PHY_ADDR
comma
id|KATANA_ETH1_PHY_ADDR
comma
id|KATANA_ETH2_PHY_ADDR
comma
)brace
suffix:semicolon
id|eth_pd
op_assign
id|pdev-&gt;dev.platform_data
suffix:semicolon
id|eth_pd-&gt;force_phy_addr
op_assign
l_int|1
suffix:semicolon
id|eth_pd-&gt;phy_addr
op_assign
id|phy_addr
(braket
id|pdev-&gt;id
)braket
suffix:semicolon
id|eth_pd-&gt;tx_queue_size
op_assign
id|KATANA_ETH_TX_QUEUE_SIZE
suffix:semicolon
id|eth_pd-&gt;rx_queue_size
op_assign
id|KATANA_ETH_RX_QUEUE_SIZE
suffix:semicolon
)brace
macro_line|#endif
r_static
r_int
id|__init
DECL|function|katana_platform_notify
id|katana_platform_notify
c_func
(paren
r_struct
id|device
op_star
id|dev
)paren
(brace
r_static
r_struct
(brace
r_char
op_star
id|bus_id
suffix:semicolon
r_void
(paren
(paren
op_star
id|rtn
)paren
(paren
r_struct
id|platform_device
op_star
id|pdev
)paren
)paren
suffix:semicolon
)brace
id|dev_map
(braket
)braket
op_assign
(brace
macro_line|#if defined(CONFIG_SERIAL_MPSC)
(brace
id|MPSC_CTLR_NAME
l_string|&quot;0&quot;
comma
id|katana_fixup_mpsc_pdata
)brace
comma
(brace
id|MPSC_CTLR_NAME
l_string|&quot;1&quot;
comma
id|katana_fixup_mpsc_pdata
)brace
comma
macro_line|#endif
macro_line|#if defined(CONFIG_MV643XX_ETH)
(brace
id|MV643XX_ETH_NAME
l_string|&quot;0&quot;
comma
id|katana_fixup_eth_pdata
)brace
comma
(brace
id|MV643XX_ETH_NAME
l_string|&quot;1&quot;
comma
id|katana_fixup_eth_pdata
)brace
comma
(brace
id|MV643XX_ETH_NAME
l_string|&quot;2&quot;
comma
id|katana_fixup_eth_pdata
)brace
comma
macro_line|#endif
)brace
suffix:semicolon
r_struct
id|platform_device
op_star
id|pdev
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_logical_and
id|dev-&gt;bus_id
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|dev_map
)paren
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|dev-&gt;bus_id
comma
id|dev_map
(braket
id|i
)braket
dot
id|bus_id
comma
id|BUS_ID_SIZE
)paren
)paren
(brace
id|pdev
op_assign
id|container_of
c_func
(paren
id|dev
comma
r_struct
id|platform_device
comma
id|dev
)paren
suffix:semicolon
id|dev_map
(braket
id|i
)braket
dot
id|rtn
c_func
(paren
id|pdev
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|katana_restart
id|katana_restart
c_func
(paren
r_char
op_star
id|cmd
)paren
(brace
id|ulong
id|i
op_assign
l_int|10000000
suffix:semicolon
multiline_comment|/* issue hard reset to the reset command register */
id|out_8
c_func
(paren
id|cpld_base
op_plus
id|KATANA_CPLD_RST_CMD
comma
id|KATANA_CPLD_RST_CMD_HR
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
op_decrement
OG
l_int|0
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;restart failed&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|katana_halt
id|katana_halt
c_func
(paren
r_void
)paren
(brace
id|u8
id|v
suffix:semicolon
r_if
c_cond
(paren
id|katana_id
op_eq
id|KATANA_ID_752I
)paren
(brace
id|v
op_assign
id|in_8
c_func
(paren
id|cpld_base
op_plus
id|HSL_PLD_BASE
op_plus
id|HSL_PLD_HOT_SWAP_OFF
)paren
suffix:semicolon
id|v
op_or_assign
id|HSL_PLD_HOT_SWAP_LED_BIT
suffix:semicolon
id|out_8
c_func
(paren
id|cpld_base
op_plus
id|HSL_PLD_BASE
op_plus
id|HSL_PLD_HOT_SWAP_OFF
comma
id|v
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* NOTREACHED */
)brace
r_static
r_void
DECL|function|katana_power_off
id|katana_power_off
c_func
(paren
r_void
)paren
(brace
id|katana_halt
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* NOTREACHED */
)brace
r_static
r_int
DECL|function|katana_show_cpuinfo
id|katana_show_cpuinfo
c_func
(paren
r_struct
id|seq_file
op_star
id|m
)paren
(brace
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;vendor&bslash;t&bslash;t: Artesyn Communication Products, LLC&bslash;n&quot;
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;board&bslash;t&bslash;t: &quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|katana_id
)paren
(brace
r_case
id|KATANA_ID_3750
suffix:colon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;Katana 3750&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KATANA_ID_750I
suffix:colon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;Katana 750i&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|KATANA_ID_752I
suffix:colon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;Katana 752i&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;Unknown&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;product ID&bslash;t: 0x%x&bslash;n&quot;
comma
id|in_8
c_func
(paren
id|cpld_base
op_plus
id|KATANA_CPLD_PRODUCT_ID
)paren
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;hardware rev&bslash;t: 0x%x&bslash;n&quot;
comma
id|in_8
c_func
(paren
id|cpld_base
op_plus
id|KATANA_CPLD_HARDWARE_VER
)paren
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;PLD rev&bslash;t&bslash;t: 0x%x&bslash;n&quot;
comma
id|in_8
c_func
(paren
id|cpld_base
op_plus
id|KATANA_CPLD_PLD_VER
)paren
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;PLB freq&bslash;t: %ldMhz&bslash;n&quot;
comma
(paren
r_int
)paren
id|katana_bus_freq
c_func
(paren
)paren
op_div
l_int|1000000
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;PCI&bslash;t&bslash;t: %sMonarch&bslash;n&quot;
comma
id|katana_is_monarch
c_func
(paren
)paren
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;Non-&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|katana_calibrate_decr
id|katana_calibrate_decr
c_func
(paren
r_void
)paren
(brace
id|u32
id|freq
suffix:semicolon
id|freq
op_assign
id|katana_bus_freq
c_func
(paren
)paren
op_div
l_int|4
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;time_init: decrementer frequency = %lu.%.6lu MHz&bslash;n&quot;
comma
(paren
r_int
)paren
id|freq
op_div
l_int|1000000
comma
(paren
r_int
)paren
id|freq
op_mod
l_int|1000000
)paren
suffix:semicolon
id|tb_ticks_per_jiffy
op_assign
id|freq
op_div
id|HZ
suffix:semicolon
id|tb_to_us
op_assign
id|mulhwu_scale_factor
c_func
(paren
id|freq
comma
l_int|1000000
)paren
suffix:semicolon
)brace
r_int
r_int
id|__init
DECL|function|katana_find_end_of_memory
id|katana_find_end_of_memory
c_func
(paren
r_void
)paren
(brace
r_return
id|mv64x60_get_mem_size
c_func
(paren
id|CONFIG_MV64X60_NEW_BASE
comma
id|MV64x60_TYPE_MV64360
)paren
suffix:semicolon
)brace
r_static
r_inline
r_void
DECL|function|katana_set_bat
id|katana_set_bat
c_func
(paren
r_void
)paren
(brace
id|mb
c_func
(paren
)paren
suffix:semicolon
id|mtspr
c_func
(paren
id|DBAT2U
comma
l_int|0xf0001ffe
)paren
suffix:semicolon
id|mtspr
c_func
(paren
id|DBAT2L
comma
l_int|0xf000002a
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_SERIAL_TEXT_DEBUG) &amp;&amp; defined(CONFIG_SERIAL_MPSC_CONSOLE)
r_static
r_void
id|__init
DECL|function|katana_map_io
id|katana_map_io
c_func
(paren
r_void
)paren
(brace
id|io_block_mapping
c_func
(paren
l_int|0xf8100000
comma
l_int|0xf8100000
comma
l_int|0x00020000
comma
id|_PAGE_IO
)paren
suffix:semicolon
)brace
macro_line|#endif
r_void
id|__init
DECL|function|platform_init
id|platform_init
c_func
(paren
r_int
r_int
id|r3
comma
r_int
r_int
id|r4
comma
r_int
r_int
id|r5
comma
r_int
r_int
id|r6
comma
r_int
r_int
id|r7
)paren
(brace
id|parse_bootinfo
c_func
(paren
id|find_bootinfo
c_func
(paren
)paren
)paren
suffix:semicolon
multiline_comment|/* ASSUMPTION:  If both r3 (bd_t pointer) and r6 (cmdline pointer)&n;&t; * are non-zero, then we should use the board info from the bd_t&n;&t; * structure and the cmdline pointed to by r6 instead of the&n;&t; * information from birecs, if any.  Otherwise, use the information&n;&t; * from birecs as discovered by the preceeding call to&n;&t; * parse_bootinfo().  This rule should work with both PPCBoot, which&n;&t; * uses a bd_t board info structure, and the kernel boot wrapper,&n;&t; * which uses birecs.&n;&t; */
r_if
c_cond
(paren
id|r3
op_logical_and
id|r6
)paren
(brace
multiline_comment|/* copy board info structure */
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|__res
comma
(paren
r_void
op_star
)paren
(paren
id|r3
op_plus
id|KERNELBASE
)paren
comma
r_sizeof
(paren
id|bd_t
)paren
)paren
suffix:semicolon
multiline_comment|/* copy command line */
op_star
(paren
r_char
op_star
)paren
(paren
id|r7
op_plus
id|KERNELBASE
)paren
op_assign
l_int|0
suffix:semicolon
id|strcpy
c_func
(paren
id|cmd_line
comma
(paren
r_char
op_star
)paren
(paren
id|r6
op_plus
id|KERNELBASE
)paren
)paren
suffix:semicolon
)brace
id|isa_mem_base
op_assign
l_int|0
suffix:semicolon
id|ppc_md.setup_arch
op_assign
id|katana_setup_arch
suffix:semicolon
id|ppc_md.show_cpuinfo
op_assign
id|katana_show_cpuinfo
suffix:semicolon
id|ppc_md.init_IRQ
op_assign
id|mv64360_init_irq
suffix:semicolon
id|ppc_md.get_irq
op_assign
id|mv64360_get_irq
suffix:semicolon
id|ppc_md.restart
op_assign
id|katana_restart
suffix:semicolon
id|ppc_md.power_off
op_assign
id|katana_power_off
suffix:semicolon
id|ppc_md.halt
op_assign
id|katana_halt
suffix:semicolon
id|ppc_md.find_end_of_memory
op_assign
id|katana_find_end_of_memory
suffix:semicolon
id|ppc_md.calibrate_decr
op_assign
id|katana_calibrate_decr
suffix:semicolon
macro_line|#if defined(CONFIG_SERIAL_TEXT_DEBUG) &amp;&amp; defined(CONFIG_SERIAL_MPSC_CONSOLE)
id|ppc_md.setup_io_mappings
op_assign
id|katana_map_io
suffix:semicolon
id|ppc_md.progress
op_assign
id|mv64x60_mpsc_progress
suffix:semicolon
id|mv64x60_progress_init
c_func
(paren
id|CONFIG_MV64X60_NEW_BASE
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_SERIAL_MPSC) || defined(CONFIG_MV643XX_ETH)
id|platform_notify
op_assign
id|katana_platform_notify
suffix:semicolon
macro_line|#endif
id|katana_set_bat
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Need for katana_find_end_of_memory and progress */
)brace
eof
