multiline_comment|/* $Id: dmacopy.c,v 1.1 2000/07/10 16:25:21 bjornw Exp $ &n; *&n; * memcpy for large blocks, using memory-memory DMA channels 6 and 7 in Etrax&n; */
macro_line|#include &lt;asm/svinto.h&gt;
macro_line|#include &lt;asm/io.h&gt;
DECL|macro|D
mdefine_line|#define D(x)
DECL|function|dma_memcpy
r_void
op_star
id|dma_memcpy
c_func
(paren
r_void
op_star
id|pdst
comma
r_const
r_void
op_star
id|psrc
comma
r_int
r_int
id|pn
)paren
(brace
r_static
id|etrax_dma_descr
id|indma
comma
id|outdma
suffix:semicolon
id|D
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;dma_memcpy %d bytes... &quot;
comma
id|pn
)paren
)paren
suffix:semicolon
macro_line|#if 0
op_star
id|R_GEN_CONFIG
op_assign
id|genconfig_shadow
op_assign
(paren
id|genconfig_shadow
op_amp
op_complement
l_int|0x3c0000
)paren
op_or
id|IO_STATE
c_func
(paren
id|R_GEN_CONFIG
comma
id|dma6
comma
id|intdma7
)paren
op_or
id|IO_STATE
c_func
(paren
id|R_GEN_CONFIG
comma
id|dma7
comma
id|intdma6
)paren
suffix:semicolon
macro_line|#endif
id|indma.sw_len
op_assign
id|outdma.sw_len
op_assign
id|pn
suffix:semicolon
id|indma.ctrl
op_assign
id|d_eol
op_or
id|d_eop
suffix:semicolon
id|outdma.ctrl
op_assign
id|d_eol
suffix:semicolon
id|indma.buf
op_assign
id|psrc
suffix:semicolon
id|outdma.buf
op_assign
id|pdst
suffix:semicolon
op_star
id|R_DMA_CH6_FIRST
op_assign
op_amp
id|indma
suffix:semicolon
op_star
id|R_DMA_CH7_FIRST
op_assign
op_amp
id|outdma
suffix:semicolon
op_star
id|R_DMA_CH6_CMD
op_assign
id|IO_STATE
c_func
(paren
id|R_DMA_CH6_CMD
comma
id|cmd
comma
id|start
)paren
suffix:semicolon
op_star
id|R_DMA_CH7_CMD
op_assign
id|IO_STATE
c_func
(paren
id|R_DMA_CH7_CMD
comma
id|cmd
comma
id|start
)paren
suffix:semicolon
r_while
c_loop
(paren
op_star
id|R_DMA_CH7_CMD
op_eq
l_int|1
)paren
(brace
multiline_comment|/* wait for completion */
suffix:semicolon
)brace
id|D
c_func
(paren
id|printk
c_func
(paren
l_string|&quot;done&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
eof
