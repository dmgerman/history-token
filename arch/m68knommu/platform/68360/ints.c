multiline_comment|/*&n; * linux/arch/$(ARCH)/platform/$(PLATFORM)/ints.c&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file COPYING in the main directory of this archive&n; * for more details.&n; *&n; * Copyright (c) 2000  Michael Leslie &lt;mleslie@lineo.com&gt;&n; * Copyright (c) 1996 Roman Zippel&n; * Copyright (c) 1999 D. Jeff Dionne &lt;jeff@uclinux.org&gt;&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/kernel_stat.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/traps.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/machdep.h&gt;
macro_line|#include &lt;asm/setup.h&gt;
macro_line|#include &lt;asm/m68360.h&gt;
multiline_comment|/* from quicc/commproc.c: */
r_extern
id|QUICC
op_star
id|pquicc
suffix:semicolon
r_extern
r_void
id|cpm_interrupt_init
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|macro|INTERNAL_IRQS
mdefine_line|#define INTERNAL_IRQS (96)
multiline_comment|/* assembler routines */
id|asmlinkage
r_void
id|system_call
c_func
(paren
r_void
)paren
suffix:semicolon
id|asmlinkage
r_void
id|buserr
c_func
(paren
r_void
)paren
suffix:semicolon
id|asmlinkage
r_void
id|trap
c_func
(paren
r_void
)paren
suffix:semicolon
id|asmlinkage
r_void
id|bad_interrupt
c_func
(paren
r_void
)paren
suffix:semicolon
id|asmlinkage
r_void
id|inthandler
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
op_star
id|_ramvec
(braket
)braket
suffix:semicolon
multiline_comment|/* The number of spurious interrupts */
DECL|variable|num_spurious
r_volatile
r_int
r_int
id|num_spurious
suffix:semicolon
DECL|variable|local_irq_count
r_int
r_int
id|local_irq_count
(braket
id|NR_CPUS
)braket
suffix:semicolon
multiline_comment|/* irq node variables for the 32 (potential) on chip sources */
DECL|variable|int_irq_list
r_static
id|irq_node_t
id|int_irq_list
(braket
id|INTERNAL_IRQS
)braket
suffix:semicolon
DECL|variable|int_irq_ablecount
r_static
r_int
id|int_irq_ablecount
(braket
id|INTERNAL_IRQS
)braket
suffix:semicolon
multiline_comment|/*&n; * This function should be called during kernel startup to initialize&n; * IRQ handling routines.&n; */
DECL|function|init_IRQ
r_void
id|init_IRQ
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|vba
op_assign
(paren
id|CPM_VECTOR_BASE
op_lshift
l_int|4
)paren
suffix:semicolon
multiline_comment|/* set up the vectors */
id|_ramvec
(braket
l_int|2
)braket
op_assign
id|buserr
suffix:semicolon
id|_ramvec
(braket
l_int|3
)braket
op_assign
id|trap
suffix:semicolon
id|_ramvec
(braket
l_int|4
)braket
op_assign
id|trap
suffix:semicolon
id|_ramvec
(braket
l_int|5
)braket
op_assign
id|trap
suffix:semicolon
id|_ramvec
(braket
l_int|6
)braket
op_assign
id|trap
suffix:semicolon
id|_ramvec
(braket
l_int|7
)braket
op_assign
id|trap
suffix:semicolon
id|_ramvec
(braket
l_int|8
)braket
op_assign
id|trap
suffix:semicolon
id|_ramvec
(braket
l_int|9
)braket
op_assign
id|trap
suffix:semicolon
id|_ramvec
(braket
l_int|10
)braket
op_assign
id|trap
suffix:semicolon
id|_ramvec
(braket
l_int|11
)braket
op_assign
id|trap
suffix:semicolon
id|_ramvec
(braket
l_int|12
)braket
op_assign
id|trap
suffix:semicolon
id|_ramvec
(braket
l_int|13
)braket
op_assign
id|trap
suffix:semicolon
id|_ramvec
(braket
l_int|14
)braket
op_assign
id|trap
suffix:semicolon
id|_ramvec
(braket
l_int|15
)braket
op_assign
id|trap
suffix:semicolon
id|_ramvec
(braket
l_int|32
)braket
op_assign
id|system_call
suffix:semicolon
id|_ramvec
(braket
l_int|33
)braket
op_assign
id|trap
suffix:semicolon
id|cpm_interrupt_init
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* set up CICR for vector base address and irq level */
multiline_comment|/* irl = 4, hp = 1f - see MC68360UM p 7-377 */
id|pquicc-&gt;intr_cicr
op_assign
l_int|0x00e49f00
op_or
id|vba
suffix:semicolon
multiline_comment|/* CPM interrupt vectors: (p 7-376) */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_ERROR
)braket
op_assign
id|bad_interrupt
suffix:semicolon
multiline_comment|/* Error */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_PIO_PC11
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* pio - pc11 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_PIO_PC10
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* pio - pc10 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_SMC2
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* smc2/pip */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_SMC1
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* smc1 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_SPI
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* spi */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_PIO_PC9
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* pio - pc9 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_TIMER4
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* timer 4 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_RESERVED1
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* reserved */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_PIO_PC8
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* pio - pc8 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_PIO_PC7
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* pio - pc7 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_PIO_PC6
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* pio - pc6 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_TIMER3
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* timer 3 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_RISCTIMER
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* reserved */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_PIO_PC5
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* pio - pc5 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_PIO_PC4
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* pio - pc4 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_RESERVED2
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* reserved */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_RISCTIMER
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* timer table */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_TIMER2
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* timer 2 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_RESERVED3
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* reserved */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_IDMA2
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* idma 2 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_IDMA1
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* idma 1 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_SDMA_CB_ERR
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* sdma channel bus error */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_PIO_PC3
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* pio - pc3 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_PIO_PC2
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* pio - pc2 */
multiline_comment|/* _ramvec[vba+CPMVEC_TIMER1]      = cpm_isr_timer1; */
multiline_comment|/* timer 1 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_TIMER1
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* timer 1 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_PIO_PC1
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* pio - pc1 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_SCC4
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* scc 4 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_SCC3
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* scc 3 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_SCC2
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* scc 2 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_SCC1
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* scc 1 */
id|_ramvec
(braket
id|vba
op_plus
id|CPMVEC_PIO_PC0
)braket
op_assign
id|inthandler
suffix:semicolon
multiline_comment|/* pio - pc0 */
multiline_comment|/* turn off all CPM interrupts */
id|pquicc-&gt;intr_cimr
op_assign
l_int|0x00000000
suffix:semicolon
multiline_comment|/* initialize handlers */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|INTERNAL_IRQS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|int_irq_list
(braket
id|i
)braket
dot
id|handler
op_assign
l_int|NULL
suffix:semicolon
id|int_irq_list
(braket
id|i
)braket
dot
id|flags
op_assign
id|IRQ_FLG_STD
suffix:semicolon
id|int_irq_list
(braket
id|i
)braket
dot
id|dev_id
op_assign
l_int|NULL
suffix:semicolon
id|int_irq_list
(braket
id|i
)braket
dot
id|devname
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
macro_line|#if 0
r_void
id|M68360_insert_irq
c_func
(paren
id|irq_node_t
op_star
op_star
id|list
comma
id|irq_node_t
op_star
id|node
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|irq_node_t
op_star
id|cur
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|node-&gt;dev_id
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Warning: dev_id of %s is zero&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|node-&gt;devname
)paren
suffix:semicolon
id|local_irq_save
c_func
(paren
id|flags
)paren
suffix:semicolon
id|cur
op_assign
op_star
id|list
suffix:semicolon
r_while
c_loop
(paren
id|cur
)paren
(brace
id|list
op_assign
op_amp
id|cur-&gt;next
suffix:semicolon
id|cur
op_assign
id|cur-&gt;next
suffix:semicolon
)brace
id|node-&gt;next
op_assign
id|cur
suffix:semicolon
op_star
id|list
op_assign
id|node
suffix:semicolon
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
r_void
id|M68360_delete_irq
c_func
(paren
id|irq_node_t
op_star
op_star
id|list
comma
r_void
op_star
id|dev_id
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|irq_node_t
op_star
id|node
suffix:semicolon
id|local_irq_save
c_func
(paren
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|node
op_assign
op_star
id|list
suffix:semicolon
id|node
suffix:semicolon
id|list
op_assign
op_amp
id|node-&gt;next
comma
id|node
op_assign
op_star
id|list
)paren
(brace
r_if
c_cond
(paren
id|node-&gt;dev_id
op_eq
id|dev_id
)paren
(brace
op_star
id|list
op_assign
id|node-&gt;next
suffix:semicolon
multiline_comment|/* Mark it as free. */
id|node-&gt;handler
op_assign
l_int|NULL
suffix:semicolon
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot;%s: tried to remove invalid irq&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|request_irq
r_int
id|request_irq
c_func
(paren
r_int
r_int
id|irq
comma
r_void
(paren
op_star
id|handler
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
comma
r_int
r_int
id|flags
comma
r_const
r_char
op_star
id|devname
comma
r_void
op_star
id|dev_id
)paren
(brace
r_int
id|mask
op_assign
(paren
l_int|1
op_lshift
id|irq
)paren
suffix:semicolon
id|irq
op_add_assign
(paren
id|CPM_VECTOR_BASE
op_lshift
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_ge
id|INTERNAL_IRQS
)paren
(brace
id|printk
(paren
l_string|&quot;%s: Unknown IRQ %d from %s&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|irq
comma
id|devname
)paren
suffix:semicolon
r_return
op_minus
id|ENXIO
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|int_irq_list
(braket
id|irq
)braket
dot
id|flags
op_amp
id|IRQ_FLG_STD
)paren
)paren
(brace
r_if
c_cond
(paren
id|int_irq_list
(braket
id|irq
)braket
dot
id|flags
op_amp
id|IRQ_FLG_LOCK
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: IRQ %d from %s is not replaceable&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|irq
comma
id|int_irq_list
(braket
id|irq
)braket
dot
id|devname
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|IRQ_FLG_REPLACE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: %s can&squot;t replace IRQ %d from %s&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|devname
comma
id|irq
comma
id|int_irq_list
(braket
id|irq
)braket
dot
id|devname
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
)brace
id|int_irq_list
(braket
id|irq
)braket
dot
id|handler
op_assign
id|handler
suffix:semicolon
id|int_irq_list
(braket
id|irq
)braket
dot
id|flags
op_assign
id|flags
suffix:semicolon
id|int_irq_list
(braket
id|irq
)braket
dot
id|dev_id
op_assign
id|dev_id
suffix:semicolon
id|int_irq_list
(braket
id|irq
)braket
dot
id|devname
op_assign
id|devname
suffix:semicolon
multiline_comment|/* enable in the CIMR */
r_if
c_cond
(paren
op_logical_neg
id|int_irq_ablecount
(braket
id|irq
)braket
)paren
id|pquicc-&gt;intr_cimr
op_or_assign
id|mask
suffix:semicolon
multiline_comment|/*      *(volatile unsigned long *)0xfffff304 &amp;= ~(1&lt;&lt;irq); */
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|request_irq
id|EXPORT_SYMBOL
c_func
(paren
id|request_irq
)paren
suffix:semicolon
DECL|function|free_irq
r_void
id|free_irq
c_func
(paren
r_int
r_int
id|irq
comma
r_void
op_star
id|dev_id
)paren
(brace
r_if
c_cond
(paren
id|irq
op_ge
id|INTERNAL_IRQS
)paren
(brace
id|printk
(paren
l_string|&quot;%s: Unknown IRQ %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|int_irq_list
(braket
id|irq
)braket
dot
id|dev_id
op_ne
id|dev_id
)paren
id|printk
c_func
(paren
l_string|&quot;%s: removing probably wrong IRQ %d from %s&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|irq
comma
id|int_irq_list
(braket
id|irq
)braket
dot
id|devname
)paren
suffix:semicolon
id|int_irq_list
(braket
id|irq
)braket
dot
id|handler
op_assign
l_int|NULL
suffix:semicolon
id|int_irq_list
(braket
id|irq
)braket
dot
id|flags
op_assign
id|IRQ_FLG_STD
suffix:semicolon
id|int_irq_list
(braket
id|irq
)braket
dot
id|dev_id
op_assign
l_int|NULL
suffix:semicolon
id|int_irq_list
(braket
id|irq
)braket
dot
id|devname
op_assign
l_int|NULL
suffix:semicolon
op_star
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xfffff304
op_or_assign
l_int|1
op_lshift
id|irq
suffix:semicolon
)brace
DECL|variable|free_irq
id|EXPORT_SYMBOL
c_func
(paren
id|free_irq
)paren
suffix:semicolon
macro_line|#if 0
multiline_comment|/*&n; * Enable/disable a particular machine specific interrupt source.&n; * Note that this may affect other interrupts in case of a shared interrupt.&n; * This function should only be called for a _very_ short time to change some&n; * internal data, that may not be changed by the interrupt at the same time.&n; * int_(enable|disable)_irq calls may also be nested.&n; */
r_void
id|M68360_enable_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_if
c_cond
(paren
id|irq
op_ge
id|INTERNAL_IRQS
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Unknown IRQ %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_decrement
id|int_irq_ablecount
(braket
id|irq
)braket
)paren
r_return
suffix:semicolon
multiline_comment|/* enable the interrupt */
op_star
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xfffff304
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|irq
)paren
suffix:semicolon
)brace
r_void
id|M68360_disable_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_if
c_cond
(paren
id|irq
op_ge
id|INTERNAL_IRQS
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Unknown IRQ %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|int_irq_ablecount
(braket
id|irq
)braket
op_increment
)paren
r_return
suffix:semicolon
multiline_comment|/* disable the interrupt */
op_star
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xfffff304
op_or_assign
l_int|1
op_lshift
id|irq
suffix:semicolon
)brace
macro_line|#endif
DECL|function|show_interrupts
r_int
id|show_interrupts
c_func
(paren
r_struct
id|seq_file
op_star
id|p
comma
r_void
op_star
id|v
)paren
(brace
r_int
id|i
op_assign
op_star
(paren
id|loff_t
op_star
)paren
id|v
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|NR_IRQS
)paren
(brace
r_if
c_cond
(paren
id|int_irq_list
(braket
id|i
)braket
dot
id|flags
op_amp
id|IRQ_FLG_STD
)paren
r_continue
suffix:semicolon
id|seq_printf
c_func
(paren
id|p
comma
l_string|&quot;%3d: %10u &quot;
comma
id|i
comma
id|kstat_cpu
c_func
(paren
l_int|0
)paren
dot
id|irqs
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|int_irq_list
(braket
id|i
)braket
dot
id|flags
op_amp
id|IRQ_FLG_LOCK
)paren
id|seq_printf
c_func
(paren
id|p
comma
l_string|&quot;L &quot;
)paren
suffix:semicolon
r_else
id|seq_printf
c_func
(paren
id|p
comma
l_string|&quot;  &quot;
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|p
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|int_irq_list
(braket
id|i
)braket
dot
id|devname
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
id|NR_IRQS
)paren
id|seq_printf
c_func
(paren
id|p
comma
l_string|&quot;   : %10u   spurious&bslash;n&quot;
comma
id|num_spurious
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* The 68k family did not have a good way to determine the source&n; * of interrupts until later in the family.  The EC000 core does&n; * not provide the vector number on the stack, we vector everything&n; * into one vector and look in the blasted mask register...&n; * This code is designed to be fast, almost constant time, not clean!&n; */
DECL|function|process_int
r_void
id|process_int
c_func
(paren
r_int
id|vec
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
(brace
r_int
id|irq
suffix:semicolon
r_int
id|mask
suffix:semicolon
multiline_comment|/* unsigned long pend = *(volatile unsigned long *)0xfffff30c; */
multiline_comment|/* irq = vec + (CPM_VECTOR_BASE&lt;&lt;4); */
id|irq
op_assign
id|vec
suffix:semicolon
multiline_comment|/* unsigned long pend = *(volatile unsigned long *)pquicc-&gt;intr_cipr; */
multiline_comment|/* Bugger all that weirdness. For the moment, I seem to know where I came from;&n;&t; * vec is passed from a specific ISR, so I&squot;ll use it. */
r_if
c_cond
(paren
id|int_irq_list
(braket
id|irq
)braket
dot
id|handler
)paren
(brace
id|int_irq_list
(braket
id|irq
)braket
dot
id|handler
c_func
(paren
id|irq
comma
id|int_irq_list
(braket
id|irq
)braket
dot
id|dev_id
comma
id|fp
)paren
suffix:semicolon
id|kstat_cpu
c_func
(paren
l_int|0
)paren
dot
id|irqs
(braket
id|irq
)braket
op_increment
suffix:semicolon
id|pquicc-&gt;intr_cisr
op_assign
(paren
l_int|1
op_lshift
id|vec
)paren
suffix:semicolon
multiline_comment|/* indicate that irq has been serviced */
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;unregistered interrupt %d!&bslash;nTurning it off in the CIMR...&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
multiline_comment|/* *(volatile unsigned long *)0xfffff304 |= mask; */
id|pquicc-&gt;intr_cimr
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|vec
)paren
suffix:semicolon
id|num_spurious
op_add_assign
l_int|1
suffix:semicolon
)brace
)brace
eof
