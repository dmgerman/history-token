multiline_comment|/*&n; *  linux/arch/m68knommu/platform/68VZ328/ucdimm/config.c&n; *&n; *  Copyright (C) 1993 Hamish Macdonald&n; *  Copyright (C) 1999 D. Jeff Dionne&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file COPYING in the main directory of this archive&n; * for more details.&n; */
macro_line|#include &lt;stdarg.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;asm/setup.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/machdep.h&gt;
macro_line|#include &lt;asm/MC68VZ328.h&gt;
macro_line|#include &lt;asm/bootstd.h&gt;
DECL|function|BSP_sched_init
r_void
id|BSP_sched_init
c_func
(paren
r_void
(paren
op_star
id|timer_routine
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
)paren
(brace
multiline_comment|/* Restart mode, Enable int, 32KHz, Enable timer */
id|TCTL
op_assign
id|TCTL_OM
op_or
id|TCTL_IRQEN
op_or
id|TCTL_CLKSOURCE_32KHZ
op_or
id|TCTL_TEN
suffix:semicolon
multiline_comment|/* Set prescaler (Divide 32KHz by 32)*/
id|TPRER
op_assign
l_int|31
suffix:semicolon
multiline_comment|/* Set compare register  32Khz / 32 / 10 = 100 */
id|TCMP
op_assign
l_int|10
suffix:semicolon
id|request_irq
c_func
(paren
id|TMR_IRQ_NUM
comma
id|timer_routine
comma
id|IRQ_FLG_LOCK
comma
l_string|&quot;timer&quot;
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|BSP_tick
r_void
id|BSP_tick
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Reset Timer1 */
id|TSTAT
op_and_assign
l_int|0
suffix:semicolon
)brace
DECL|function|BSP_gettimeoffset
r_int
r_int
id|BSP_gettimeoffset
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|BSP_gettod
r_void
id|BSP_gettod
(paren
r_int
op_star
id|yearp
comma
r_int
op_star
id|monp
comma
r_int
op_star
id|dayp
comma
r_int
op_star
id|hourp
comma
r_int
op_star
id|minp
comma
r_int
op_star
id|secp
)paren
(brace
)brace
DECL|function|BSP_hwclk
r_int
id|BSP_hwclk
c_func
(paren
r_int
id|op
comma
r_struct
id|hwclk_time
op_star
id|t
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|op
)paren
(brace
multiline_comment|/* read */
)brace
r_else
(brace
multiline_comment|/* write */
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|BSP_set_clock_mmss
r_int
id|BSP_set_clock_mmss
(paren
r_int
r_int
id|nowtime
)paren
(brace
macro_line|#if 0
r_int
id|real_seconds
op_assign
id|nowtime
op_mod
l_int|60
comma
id|real_minutes
op_assign
(paren
id|nowtime
op_div
l_int|60
)paren
op_mod
l_int|60
suffix:semicolon
id|tod-&gt;second1
op_assign
id|real_seconds
op_div
l_int|10
suffix:semicolon
id|tod-&gt;second2
op_assign
id|real_seconds
op_mod
l_int|10
suffix:semicolon
id|tod-&gt;minute1
op_assign
id|real_minutes
op_div
l_int|10
suffix:semicolon
id|tod-&gt;minute2
op_assign
id|real_minutes
op_mod
l_int|10
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|BSP_reset
r_void
id|BSP_reset
(paren
r_void
)paren
(brace
id|local_irq_disable
c_func
(paren
)paren
suffix:semicolon
id|asm
r_volatile
(paren
"&quot;"
id|moveal
macro_line|#0x10c00000, %a0;
id|moveb
macro_line|#0, 0xFFFFF300;
id|moveal
l_int|0
(paren
op_mod
id|a0
)paren
comma
op_mod
id|sp
suffix:semicolon
id|moveal
l_int|4
(paren
op_mod
id|a0
)paren
comma
op_mod
id|a0
suffix:semicolon
id|jmp
(paren
op_mod
id|a0
)paren
suffix:semicolon
"&quot;"
)paren
suffix:semicolon
)brace
DECL|variable|cs8900a_hwaddr
r_int
r_char
op_star
id|cs8900a_hwaddr
suffix:semicolon
DECL|variable|errno
r_static
r_int
id|errno
suffix:semicolon
id|_bsc0
c_func
(paren
r_char
op_star
comma
id|getserialnum
)paren
id|_bsc1
c_func
(paren
r_int
r_char
op_star
comma
id|gethwaddr
comma
r_int
comma
id|a
)paren
id|_bsc1
c_func
(paren
r_char
op_star
comma
id|getbenv
comma
r_char
op_star
comma
id|a
)paren
DECL|function|config_BSP
r_void
id|config_BSP
c_func
(paren
r_char
op_star
id|command
comma
r_int
id|len
)paren
(brace
r_int
r_char
op_star
id|p
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n68VZ328 DragonBallVZ support (c) 2001 Lineo, Inc.&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;uCdimm serial string [%s]&bslash;n&quot;
comma
id|getserialnum
c_func
(paren
)paren
)paren
suffix:semicolon
id|p
op_assign
id|cs8900a_hwaddr
op_assign
id|gethwaddr
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;uCdimm hwaddr %.2x:%.2x:%.2x:%.2x:%.2x:%.2x&bslash;n&quot;
comma
id|p
(braket
l_int|0
)braket
comma
id|p
(braket
l_int|1
)braket
comma
id|p
(braket
l_int|2
)braket
comma
id|p
(braket
l_int|3
)braket
comma
id|p
(braket
l_int|4
)braket
comma
id|p
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|p
op_assign
id|getbenv
c_func
(paren
l_string|&quot;APPEND&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
)paren
id|strcpy
c_func
(paren
id|p
comma
id|command
)paren
suffix:semicolon
r_else
id|command
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|mach_sched_init
op_assign
id|BSP_sched_init
suffix:semicolon
id|mach_tick
op_assign
id|BSP_tick
suffix:semicolon
id|mach_gettimeoffset
op_assign
id|BSP_gettimeoffset
suffix:semicolon
id|mach_gettod
op_assign
id|BSP_gettod
suffix:semicolon
id|mach_reset
op_assign
id|BSP_reset
suffix:semicolon
)brace
eof
