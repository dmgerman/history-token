multiline_comment|/*&n; * arch/sh/mm/pg-sh4.c&n; *&n; * Copyright (C) 1999, 2000, 2002  Niibe Yutaka&n; * Copyright (C) 2002  Paul Mundt&n; *&n; * Released under the terms of the GNU GPL v2.0.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/mman.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/threads.h&gt;
macro_line|#include &lt;asm/addrspace.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/cache.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/pgalloc.h&gt;
macro_line|#include &lt;asm/mmu_context.h&gt;
macro_line|#include &lt;asm/cacheflush.h&gt;
r_extern
r_struct
id|semaphore
id|p3map_sem
(braket
)braket
suffix:semicolon
multiline_comment|/*&n; * clear_user_page&n; * @to: P1 address&n; * @address: U0 address to be mapped&n; * @page: page (virt_to_page(to))&n; */
DECL|function|clear_user_page
r_void
id|clear_user_page
c_func
(paren
r_void
op_star
id|to
comma
r_int
r_int
id|address
comma
r_struct
id|page
op_star
id|page
)paren
(brace
id|__set_bit
c_func
(paren
id|PG_mapped
comma
op_amp
id|page-&gt;flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|address
op_xor
(paren
r_int
r_int
)paren
id|to
)paren
op_amp
id|CACHE_ALIAS
)paren
op_eq
l_int|0
)paren
id|clear_page
c_func
(paren
id|to
)paren
suffix:semicolon
r_else
(brace
id|pgprot_t
id|pgprot
op_assign
id|__pgprot
c_func
(paren
id|_PAGE_PRESENT
op_or
id|_PAGE_RW
op_or
id|_PAGE_CACHABLE
op_or
id|_PAGE_DIRTY
op_or
id|_PAGE_ACCESSED
op_or
id|_PAGE_HW_SHARED
op_or
id|_PAGE_FLAGS_HARD
)paren
suffix:semicolon
r_int
r_int
id|phys_addr
op_assign
id|PHYSADDR
c_func
(paren
id|to
)paren
suffix:semicolon
r_int
r_int
id|p3_addr
op_assign
id|P3SEG
op_plus
(paren
id|address
op_amp
id|CACHE_ALIAS
)paren
suffix:semicolon
id|pgd_t
op_star
id|dir
op_assign
id|pgd_offset_k
c_func
(paren
id|p3_addr
)paren
suffix:semicolon
id|pmd_t
op_star
id|pmd
op_assign
id|pmd_offset
c_func
(paren
id|dir
comma
id|p3_addr
)paren
suffix:semicolon
id|pte_t
op_star
id|pte
op_assign
id|pte_offset_kernel
c_func
(paren
id|pmd
comma
id|p3_addr
)paren
suffix:semicolon
id|pte_t
id|entry
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|entry
op_assign
id|pfn_pte
c_func
(paren
id|phys_addr
op_rshift
id|PAGE_SHIFT
comma
id|pgprot
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|p3map_sem
(braket
(paren
id|address
op_amp
id|CACHE_ALIAS
)paren
op_rshift
l_int|12
)braket
)paren
suffix:semicolon
id|set_pte
c_func
(paren
id|pte
comma
id|entry
)paren
suffix:semicolon
id|local_irq_save
c_func
(paren
id|flags
)paren
suffix:semicolon
id|__flush_tlb_page
c_func
(paren
id|get_asid
c_func
(paren
)paren
comma
id|p3_addr
)paren
suffix:semicolon
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
id|update_mmu_cache
c_func
(paren
l_int|NULL
comma
id|p3_addr
comma
id|entry
)paren
suffix:semicolon
id|__clear_user_page
c_func
(paren
(paren
r_void
op_star
)paren
id|p3_addr
comma
id|to
)paren
suffix:semicolon
id|pte_clear
c_func
(paren
op_amp
id|init_mm
comma
id|p3_addr
comma
id|pte
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|p3map_sem
(braket
(paren
id|address
op_amp
id|CACHE_ALIAS
)paren
op_rshift
l_int|12
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * copy_user_page&n; * @to: P1 address&n; * @from: P1 address&n; * @address: U0 address to be mapped&n; * @page: page (virt_to_page(to))&n; */
DECL|function|copy_user_page
r_void
id|copy_user_page
c_func
(paren
r_void
op_star
id|to
comma
r_void
op_star
id|from
comma
r_int
r_int
id|address
comma
r_struct
id|page
op_star
id|page
)paren
(brace
id|__set_bit
c_func
(paren
id|PG_mapped
comma
op_amp
id|page-&gt;flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|address
op_xor
(paren
r_int
r_int
)paren
id|to
)paren
op_amp
id|CACHE_ALIAS
)paren
op_eq
l_int|0
)paren
id|copy_page
c_func
(paren
id|to
comma
id|from
)paren
suffix:semicolon
r_else
(brace
id|pgprot_t
id|pgprot
op_assign
id|__pgprot
c_func
(paren
id|_PAGE_PRESENT
op_or
id|_PAGE_RW
op_or
id|_PAGE_CACHABLE
op_or
id|_PAGE_DIRTY
op_or
id|_PAGE_ACCESSED
op_or
id|_PAGE_HW_SHARED
op_or
id|_PAGE_FLAGS_HARD
)paren
suffix:semicolon
r_int
r_int
id|phys_addr
op_assign
id|PHYSADDR
c_func
(paren
id|to
)paren
suffix:semicolon
r_int
r_int
id|p3_addr
op_assign
id|P3SEG
op_plus
(paren
id|address
op_amp
id|CACHE_ALIAS
)paren
suffix:semicolon
id|pgd_t
op_star
id|dir
op_assign
id|pgd_offset_k
c_func
(paren
id|p3_addr
)paren
suffix:semicolon
id|pmd_t
op_star
id|pmd
op_assign
id|pmd_offset
c_func
(paren
id|dir
comma
id|p3_addr
)paren
suffix:semicolon
id|pte_t
op_star
id|pte
op_assign
id|pte_offset_kernel
c_func
(paren
id|pmd
comma
id|p3_addr
)paren
suffix:semicolon
id|pte_t
id|entry
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|entry
op_assign
id|pfn_pte
c_func
(paren
id|phys_addr
op_rshift
id|PAGE_SHIFT
comma
id|pgprot
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|p3map_sem
(braket
(paren
id|address
op_amp
id|CACHE_ALIAS
)paren
op_rshift
l_int|12
)braket
)paren
suffix:semicolon
id|set_pte
c_func
(paren
id|pte
comma
id|entry
)paren
suffix:semicolon
id|local_irq_save
c_func
(paren
id|flags
)paren
suffix:semicolon
id|__flush_tlb_page
c_func
(paren
id|get_asid
c_func
(paren
)paren
comma
id|p3_addr
)paren
suffix:semicolon
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
id|update_mmu_cache
c_func
(paren
l_int|NULL
comma
id|p3_addr
comma
id|entry
)paren
suffix:semicolon
id|__copy_user_page
c_func
(paren
(paren
r_void
op_star
)paren
id|p3_addr
comma
id|from
comma
id|to
)paren
suffix:semicolon
id|pte_clear
c_func
(paren
op_amp
id|init_mm
comma
id|p3_addr
comma
id|pte
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|p3map_sem
(braket
(paren
id|address
op_amp
id|CACHE_ALIAS
)paren
op_rshift
l_int|12
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * For SH-4, we have our own implementation for ptep_get_and_clear&n; */
DECL|function|ptep_get_and_clear
r_inline
id|pte_t
id|ptep_get_and_clear
c_func
(paren
r_struct
id|mm_struct
op_star
id|mm
comma
r_int
r_int
id|addr
comma
id|pte_t
op_star
id|ptep
)paren
(brace
id|pte_t
id|pte
op_assign
op_star
id|ptep
suffix:semicolon
id|pte_clear
c_func
(paren
id|mm
comma
id|addr
comma
id|ptep
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pte_not_present
c_func
(paren
id|pte
)paren
)paren
(brace
r_int
r_int
id|pfn
op_assign
id|pte_pfn
c_func
(paren
id|pte
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pfn_valid
c_func
(paren
id|pfn
)paren
)paren
(brace
r_struct
id|page
op_star
id|page
op_assign
id|pfn_to_page
c_func
(paren
id|pfn
)paren
suffix:semicolon
r_struct
id|address_space
op_star
id|mapping
op_assign
id|page_mapping
c_func
(paren
id|page
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mapping
op_logical_or
op_logical_neg
id|mapping_writably_mapped
c_func
(paren
id|mapping
)paren
)paren
id|__clear_bit
c_func
(paren
id|PG_mapped
comma
op_amp
id|page-&gt;flags
)paren
suffix:semicolon
)brace
)brace
r_return
id|pte
suffix:semicolon
)brace
eof
