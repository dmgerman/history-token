multiline_comment|/*&n; * arch/sh/mm/consistent.c&n; *&n; * Copyright (C) 2004  Paul Mundt&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; */
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/dma-mapping.h&gt;
macro_line|#include &lt;asm/io.h&gt;
DECL|function|consistent_alloc
r_void
op_star
id|consistent_alloc
c_func
(paren
r_int
id|gfp
comma
r_int
id|size
comma
id|dma_addr_t
op_star
id|handle
)paren
(brace
r_struct
id|page
op_star
id|page
comma
op_star
id|end
comma
op_star
id|free
suffix:semicolon
r_void
op_star
id|ret
suffix:semicolon
r_int
id|order
suffix:semicolon
id|size
op_assign
id|PAGE_ALIGN
c_func
(paren
id|size
)paren
suffix:semicolon
id|order
op_assign
id|get_order
c_func
(paren
id|size
)paren
suffix:semicolon
id|page
op_assign
id|alloc_pages
c_func
(paren
id|gfp
comma
id|order
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|page
)paren
r_return
l_int|NULL
suffix:semicolon
id|ret
op_assign
id|page_address
c_func
(paren
id|page
)paren
suffix:semicolon
op_star
id|handle
op_assign
id|virt_to_phys
c_func
(paren
id|ret
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * We must flush the cache before we pass it on to the device&n;&t; */
id|dma_cache_wback_inv
c_func
(paren
id|ret
comma
id|size
)paren
suffix:semicolon
id|page
op_assign
id|virt_to_page
c_func
(paren
id|ret
)paren
suffix:semicolon
id|free
op_assign
id|page
op_plus
(paren
id|size
op_rshift
id|PAGE_SHIFT
)paren
suffix:semicolon
id|end
op_assign
id|page
op_plus
(paren
l_int|1
op_lshift
id|order
)paren
suffix:semicolon
r_while
c_loop
(paren
op_increment
id|page
OL
id|end
)paren
(brace
id|set_page_count
c_func
(paren
id|page
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* Free any unused pages */
r_if
c_cond
(paren
id|page
op_ge
id|free
)paren
(brace
id|__free_page
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
)brace
r_return
id|P2SEGADDR
c_func
(paren
id|ret
)paren
suffix:semicolon
)brace
DECL|function|consistent_free
r_void
id|consistent_free
c_func
(paren
r_void
op_star
id|vaddr
comma
r_int
id|size
)paren
(brace
r_int
r_int
id|addr
op_assign
id|P1SEGADDR
c_func
(paren
(paren
r_int
r_int
)paren
id|vaddr
)paren
suffix:semicolon
r_struct
id|page
op_star
id|page
op_assign
id|virt_to_page
c_func
(paren
id|addr
)paren
suffix:semicolon
r_int
id|num_pages
op_assign
(paren
id|size
op_plus
id|PAGE_SIZE
op_minus
l_int|1
)paren
op_rshift
id|PAGE_SHIFT
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_pages
suffix:semicolon
id|i
op_increment
)paren
(brace
id|__free_page
c_func
(paren
(paren
id|page
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|consistent_sync
r_void
id|consistent_sync
c_func
(paren
r_void
op_star
id|vaddr
comma
r_int
id|size
comma
r_int
id|direction
)paren
(brace
r_void
op_star
id|p1addr
op_assign
(paren
r_void
op_star
)paren
id|P1SEGADDR
c_func
(paren
(paren
r_int
r_int
)paren
id|vaddr
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|direction
)paren
(brace
r_case
id|DMA_FROM_DEVICE
suffix:colon
multiline_comment|/* invalidate only */
id|dma_cache_inv
c_func
(paren
id|p1addr
comma
id|size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMA_TO_DEVICE
suffix:colon
multiline_comment|/* writeback only */
id|dma_cache_wback
c_func
(paren
id|p1addr
comma
id|size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|DMA_BIDIRECTIONAL
suffix:colon
multiline_comment|/* writeback and invalidate */
id|dma_cache_wback_inv
c_func
(paren
id|p1addr
comma
id|size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
DECL|variable|consistent_alloc
id|EXPORT_SYMBOL
c_func
(paren
id|consistent_alloc
)paren
suffix:semicolon
DECL|variable|consistent_free
id|EXPORT_SYMBOL
c_func
(paren
id|consistent_free
)paren
suffix:semicolon
DECL|variable|consistent_sync
id|EXPORT_SYMBOL
c_func
(paren
id|consistent_sync
)paren
suffix:semicolon
eof
