multiline_comment|/*&n; * arch/sh/drivers/dma/dma-isa.c&n; *&n; * Generic ISA DMA wrapper for SH DMA API&n; *&n; * Copyright (C) 2003  Paul Mundt&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
multiline_comment|/*&n; * This implements a small wrapper set to make code using the old ISA DMA API&n; * work with the SH DMA API. Since most of the work in the new API happens&n; * at ops-&gt;xfer() time, we simply use the various set_dma_xxx() routines to&n; * fill in per-channel info, and then hand hand this off to ops-&gt;xfer() at&n; * enable_dma() time.&n; *&n; * For channels that are doing on-demand data transfer via cascading, the&n; * channel itself will still need to be configured through the new API. As&n; * such, this code is meant for only the simplest of tasks (and shouldn&squot;t be&n; * used in any new drivers at all).&n; *&n; * It should also be noted that various functions here are labelled as&n; * being deprecated. This is due to the fact that the ops-&gt;xfer() method is&n; * the preferred way of doing things (as well as just grabbing the spinlock&n; * directly). As such, any users of this interface will be warned rather&n; * loudly.&n; */
DECL|function|claim_dma_lock
r_int
r_int
id|__deprecated
id|claim_dma_lock
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|dma_spin_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|flags
suffix:semicolon
)brace
DECL|function|release_dma_lock
r_void
id|__deprecated
id|release_dma_lock
c_func
(paren
r_int
r_int
id|flags
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dma_spin_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|function|disable_dma
r_void
id|__deprecated
id|disable_dma
c_func
(paren
r_int
r_int
id|chan
)paren
(brace
multiline_comment|/* Nothing */
)brace
DECL|function|enable_dma
r_void
id|__deprecated
id|enable_dma
c_func
(paren
r_int
r_int
id|chan
)paren
(brace
r_struct
id|dma_info
op_star
id|info
op_assign
id|get_dma_info
c_func
(paren
id|chan
)paren
suffix:semicolon
id|info-&gt;ops
op_member_access_from_pointer
id|xfer
c_func
(paren
id|info
)paren
suffix:semicolon
)brace
DECL|function|clear_dma_ff
r_void
id|clear_dma_ff
c_func
(paren
r_int
r_int
id|chan
)paren
(brace
multiline_comment|/* Nothing */
)brace
DECL|function|set_dma_mode
r_void
id|set_dma_mode
c_func
(paren
r_int
r_int
id|chan
comma
r_char
id|mode
)paren
(brace
r_struct
id|dma_info
op_star
id|info
op_assign
id|get_dma_info
c_func
(paren
id|chan
)paren
suffix:semicolon
id|info-&gt;mode
op_assign
id|mode
suffix:semicolon
)brace
DECL|function|set_dma_addr
r_void
id|set_dma_addr
c_func
(paren
r_int
r_int
id|chan
comma
r_int
r_int
id|addr
)paren
(brace
r_struct
id|dma_info
op_star
id|info
op_assign
id|get_dma_info
c_func
(paren
id|chan
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Single address mode is the only thing supported through&n;&t; * this interface.&n;&t; */
r_if
c_cond
(paren
(paren
id|info-&gt;mode
op_amp
id|DMA_MODE_MASK
)paren
op_eq
id|DMA_MODE_READ
)paren
(brace
id|info-&gt;sar
op_assign
id|addr
suffix:semicolon
)brace
r_else
(brace
id|info-&gt;dar
op_assign
id|addr
suffix:semicolon
)brace
)brace
DECL|function|set_dma_count
r_void
id|set_dma_count
c_func
(paren
r_int
r_int
id|chan
comma
r_int
r_int
id|count
)paren
(brace
r_struct
id|dma_info
op_star
id|info
op_assign
id|get_dma_info
c_func
(paren
id|chan
)paren
suffix:semicolon
id|info-&gt;count
op_assign
id|count
suffix:semicolon
)brace
eof
