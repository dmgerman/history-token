multiline_comment|/*&n; * arch/sh/drivers/dma/dma-sysfs.c&n; *&n; * sysfs interface for SH DMA API&n; *&n; * Copyright (C) 2004  Paul Mundt&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/sysdev.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
DECL|variable|dma_sysclass
r_static
r_struct
id|sysdev_class
id|dma_sysclass
op_assign
(brace
id|set_kset_name
c_func
(paren
l_string|&quot;dma&quot;
)paren
comma
)brace
suffix:semicolon
DECL|variable|dma_sysclass
id|EXPORT_SYMBOL
c_func
(paren
id|dma_sysclass
)paren
suffix:semicolon
DECL|function|dma_show_devices
r_static
id|ssize_t
id|dma_show_devices
c_func
(paren
r_struct
id|sys_device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
id|ssize_t
id|len
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_DMA_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|dma_info
op_star
id|info
op_assign
id|get_dma_info
c_func
(paren
id|i
)paren
suffix:semicolon
r_struct
id|dma_channel
op_star
id|channel
op_assign
op_amp
id|info-&gt;channels
(braket
id|i
)braket
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|buf
op_plus
id|len
comma
l_string|&quot;%2d: %14s    %s&bslash;n&quot;
comma
id|channel-&gt;chan
comma
id|info-&gt;name
comma
id|channel-&gt;dev_id
)paren
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
r_static
id|SYSDEV_ATTR
c_func
(paren
id|devices
comma
id|S_IRUGO
comma
id|dma_show_devices
comma
l_int|NULL
)paren
suffix:semicolon
DECL|function|dma_sysclass_init
r_static
r_int
id|__init
id|dma_sysclass_init
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
suffix:semicolon
id|ret
op_assign
id|sysdev_class_register
c_func
(paren
op_amp
id|dma_sysclass
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
l_int|0
)paren
id|sysfs_create_file
c_func
(paren
op_amp
id|dma_sysclass.kset.kobj
comma
op_amp
id|attr_devices.attr
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|dma_sysclass_init
id|postcore_initcall
c_func
(paren
id|dma_sysclass_init
)paren
suffix:semicolon
DECL|function|dma_show_dev_id
r_static
id|ssize_t
id|dma_show_dev_id
c_func
(paren
r_struct
id|sys_device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|dma_channel
op_star
id|channel
op_assign
id|to_dma_channel
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|channel-&gt;dev_id
)paren
suffix:semicolon
)brace
DECL|function|dma_store_dev_id
r_static
id|ssize_t
id|dma_store_dev_id
c_func
(paren
r_struct
id|sys_device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|dma_channel
op_star
id|channel
op_assign
id|to_dma_channel
c_func
(paren
id|dev
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|channel-&gt;dev_id
comma
id|buf
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|SYSDEV_ATTR
c_func
(paren
id|dev_id
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|dma_show_dev_id
comma
id|dma_store_dev_id
)paren
suffix:semicolon
DECL|function|dma_store_config
r_static
id|ssize_t
id|dma_store_config
c_func
(paren
r_struct
id|sys_device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|dma_channel
op_star
id|channel
op_assign
id|to_dma_channel
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
r_int
id|config
suffix:semicolon
id|config
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|dma_configure_channel
c_func
(paren
id|channel-&gt;chan
comma
id|config
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|SYSDEV_ATTR
c_func
(paren
id|config
comma
id|S_IWUSR
comma
l_int|NULL
comma
id|dma_store_config
)paren
suffix:semicolon
DECL|function|dma_show_mode
r_static
id|ssize_t
id|dma_show_mode
c_func
(paren
r_struct
id|sys_device
op_star
id|dev
comma
r_char
op_star
id|buf
)paren
(brace
r_struct
id|dma_channel
op_star
id|channel
op_assign
id|to_dma_channel
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;0x%08x&bslash;n&quot;
comma
id|channel-&gt;mode
)paren
suffix:semicolon
)brace
DECL|function|dma_store_mode
r_static
id|ssize_t
id|dma_store_mode
c_func
(paren
r_struct
id|sys_device
op_star
id|dev
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_struct
id|dma_channel
op_star
id|channel
op_assign
id|to_dma_channel
c_func
(paren
id|dev
)paren
suffix:semicolon
id|channel-&gt;mode
op_assign
id|simple_strtoul
c_func
(paren
id|buf
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
r_static
id|SYSDEV_ATTR
c_func
(paren
id|mode
comma
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|dma_show_mode
comma
id|dma_store_mode
)paren
suffix:semicolon
DECL|macro|dma_ro_attr
mdefine_line|#define dma_ro_attr(field, fmt)&t;&t;&t;&t;&t;&t;&bslash;&n;static ssize_t dma_show_##field(struct sys_device *dev, char *buf)&t;&bslash;&n;{&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;struct dma_channel *channel = to_dma_channel(dev);&t;&t;&bslash;&n;&t;return sprintf(buf, fmt, channel-&gt;field);&t;&t;&t;&bslash;&n;}&t;&t;&t;&t;&t;&t;&t;&t;&t;&bslash;&n;static SYSDEV_ATTR(field, S_IRUGO, dma_show_##field, NULL);
id|dma_ro_attr
c_func
(paren
id|count
comma
l_string|&quot;0x%08x&bslash;n&quot;
)paren
suffix:semicolon
id|dma_ro_attr
c_func
(paren
id|flags
comma
l_string|&quot;0x%08lx&bslash;n&quot;
)paren
suffix:semicolon
DECL|function|dma_create_sysfs_files
r_int
id|__init
id|dma_create_sysfs_files
c_func
(paren
r_struct
id|dma_channel
op_star
id|chan
)paren
(brace
r_struct
id|sys_device
op_star
id|dev
op_assign
op_amp
id|chan-&gt;dev
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|dev-&gt;id
op_assign
id|chan-&gt;chan
suffix:semicolon
id|dev-&gt;cls
op_assign
op_amp
id|dma_sysclass
suffix:semicolon
id|ret
op_assign
id|sysdev_register
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
id|sysdev_create_file
c_func
(paren
id|dev
comma
op_amp
id|attr_dev_id
)paren
suffix:semicolon
id|sysdev_create_file
c_func
(paren
id|dev
comma
op_amp
id|attr_count
)paren
suffix:semicolon
id|sysdev_create_file
c_func
(paren
id|dev
comma
op_amp
id|attr_mode
)paren
suffix:semicolon
id|sysdev_create_file
c_func
(paren
id|dev
comma
op_amp
id|attr_flags
)paren
suffix:semicolon
id|sysdev_create_file
c_func
(paren
id|dev
comma
op_amp
id|attr_config
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
