multiline_comment|/*&n; * arch/sh/drivers/pci/ops-snapgear.c&n; *&n; * Author:  David McCullough &lt;davidm@snapgear.com&gt;&n; * &n; * Ported to new API by Paul Mundt &lt;lethal@linux-sh.org&gt;&n; *&n; * Highly leveraged from pci-bigsur.c, written by Dustin McIntire.&n; *&n; * May be copied or modified under the terms of the GNU General Public&n; * License.  See linux/COPYING for more information.&n; *&n; * PCI initialization for the SnapGear boards&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;pci-sh7751.h&quot;
DECL|macro|SNAPGEAR_PCI_IO
mdefine_line|#define SNAPGEAR_PCI_IO&t;&t;0x4000
DECL|macro|SNAPGEAR_PCI_MEM
mdefine_line|#define SNAPGEAR_PCI_MEM&t;0xfd000000
multiline_comment|/* PCI: default LOCAL memory window sizes (seen from PCI bus) */
DECL|macro|SNAPGEAR_LSR0_SIZE
mdefine_line|#define SNAPGEAR_LSR0_SIZE    (64*(1&lt;&lt;20)) 
singleline_comment|//64MB
DECL|macro|SNAPGEAR_LSR1_SIZE
mdefine_line|#define SNAPGEAR_LSR1_SIZE    (64*(1&lt;&lt;20)) 
singleline_comment|//64MB
DECL|variable|sh7751_io_resource
r_static
r_struct
id|resource
id|sh7751_io_resource
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;SH7751 IO&quot;
comma
dot
id|start
op_assign
id|SNAPGEAR_PCI_IO
comma
dot
id|end
op_assign
id|SNAPGEAR_PCI_IO
op_plus
(paren
l_int|64
op_star
l_int|1024
)paren
op_minus
l_int|1
comma
multiline_comment|/* 64KiB I/O */
dot
id|flags
op_assign
id|IORESOURCE_IO
comma
)brace
suffix:semicolon
DECL|variable|sh7751_mem_resource
r_static
r_struct
id|resource
id|sh7751_mem_resource
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;SH7751 mem&quot;
comma
dot
id|start
op_assign
id|SNAPGEAR_PCI_MEM
comma
dot
id|end
op_assign
id|SNAPGEAR_PCI_MEM
op_plus
(paren
l_int|64
op_star
l_int|1024
op_star
l_int|1024
)paren
op_minus
l_int|1
comma
multiline_comment|/* 64MiB mem */
dot
id|flags
op_assign
id|IORESOURCE_MEM
comma
)brace
suffix:semicolon
r_extern
r_struct
id|pci_ops
id|sh7751_pci_ops
suffix:semicolon
DECL|variable|board_pci_channels
r_struct
id|pci_channel
id|board_pci_channels
(braket
)braket
op_assign
(brace
(brace
op_amp
id|sh7751_pci_ops
comma
op_amp
id|sh7751_io_resource
comma
op_amp
id|sh7751_mem_resource
comma
l_int|0
comma
l_int|0xff
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
DECL|variable|sh7751_pci_map
r_static
r_struct
id|sh7751_pci_address_map
id|sh7751_pci_map
op_assign
(brace
dot
id|window0
op_assign
(brace
dot
id|base
op_assign
id|SH7751_CS2_BASE_ADDR
comma
dot
id|size
op_assign
id|SNAPGEAR_LSR0_SIZE
comma
)brace
comma
dot
id|window1
op_assign
(brace
dot
id|base
op_assign
id|SH7751_CS2_BASE_ADDR
comma
dot
id|size
op_assign
id|SNAPGEAR_LSR1_SIZE
comma
)brace
comma
dot
id|flags
op_assign
id|SH7751_PCIC_NO_RESET
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Initialize the SnapGear PCI interface &n; * Setup hardware to be Central Funtion&n; * Copy the BSR regs to the PCI interface&n; * Setup PCI windows into local RAM&n; */
DECL|function|pcibios_init_platform
r_int
id|__init
id|pcibios_init_platform
c_func
(paren
r_void
)paren
(brace
r_return
id|sh7751_pcic_init
c_func
(paren
op_amp
id|sh7751_pci_map
)paren
suffix:semicolon
)brace
DECL|function|pcibios_map_platform_irq
r_int
id|__init
id|pcibios_map_platform_irq
c_func
(paren
id|u8
id|slot
comma
id|u8
id|pin
)paren
(brace
r_int
id|irq
op_assign
op_minus
l_int|1
suffix:semicolon
r_switch
c_cond
(paren
id|slot
)paren
(brace
r_case
l_int|8
suffix:colon
multiline_comment|/* the PCI bridge */
r_break
suffix:semicolon
r_case
l_int|11
suffix:colon
id|irq
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* USB    */
r_case
l_int|12
suffix:colon
id|irq
op_assign
l_int|11
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* PCMCIA */
r_case
l_int|13
suffix:colon
id|irq
op_assign
l_int|5
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* eth0   */
r_case
l_int|14
suffix:colon
id|irq
op_assign
l_int|8
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* eth1   */
r_case
l_int|15
suffix:colon
id|irq
op_assign
l_int|11
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* safenet (unused) */
)brace
id|printk
c_func
(paren
l_string|&quot;PCI: Mapping SnapGear IRQ for slot %d, pin %c to irq %d&bslash;n&quot;
comma
id|slot
comma
id|pin
op_minus
l_int|1
op_plus
l_char|&squot;A&squot;
comma
id|irq
)paren
suffix:semicolon
r_return
id|irq
suffix:semicolon
)brace
DECL|function|pcibios_fixup
r_void
id|__init
id|pcibios_fixup
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Nothing to fixup .. */
)brace
eof
