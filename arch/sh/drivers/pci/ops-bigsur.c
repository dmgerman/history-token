multiline_comment|/*&n; * linux/arch/sh/kernel/pci-bigsur.c&n; *&n; * By Dustin McIntire (dustin@sensoria.com) (c)2001&n; *&n; * Ported to new API by Paul Mundt &lt;lethal@linux-sh.org&gt;.&n; *&n; * May be copied or modified under the terms of the GNU General Public&n; * License.  See linux/COPYING for more information.&n; *&n; * PCI initialization for the Hitachi Big Sur Evaluation Board&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;pci-sh7751.h&quot;
macro_line|#include &lt;asm/bigsur/bigsur.h&gt;
DECL|macro|BIGSUR_PCI_IO
mdefine_line|#define BIGSUR_PCI_IO&t;0x4000
DECL|macro|BIGSUR_PCI_MEM
mdefine_line|#define BIGSUR_PCI_MEM&t;0xfd000000
DECL|variable|sh7751_io_resource
r_static
r_struct
id|resource
id|sh7751_io_resource
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;SH7751 IO&quot;
comma
dot
id|start
op_assign
id|BIGSUR_PCI_IO
comma
dot
id|end
op_assign
id|BIGSUR_PCI_IO
op_plus
(paren
l_int|64
op_star
l_int|1024
)paren
op_minus
l_int|1
comma
dot
id|flags
op_assign
id|IORESOURCE_IO
comma
)brace
suffix:semicolon
DECL|variable|sh7751_mem_resource
r_static
r_struct
id|resource
id|sh7751_mem_resource
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;SH7751 mem&quot;
comma
dot
id|start
op_assign
id|BIGSUR_PCI_MEM
comma
dot
id|end
op_assign
id|BIGSUR_PCI_MEM
op_plus
(paren
l_int|64
op_star
l_int|1024
op_star
l_int|1024
)paren
op_minus
l_int|1
comma
dot
id|flags
op_assign
id|IORESOURCE_MEM
comma
)brace
suffix:semicolon
r_extern
r_struct
id|pci_ops
id|sh7751_pci_ops
suffix:semicolon
DECL|variable|board_pci_channels
r_struct
id|pci_channel
id|board_pci_channels
(braket
)braket
op_assign
(brace
(brace
op_amp
id|sh7751_pci_ops
comma
op_amp
id|sh7751_io_resource
comma
op_amp
id|sh7751_mem_resource
comma
l_int|0
comma
l_int|0xff
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
DECL|variable|sh7751_pci_map
r_static
r_struct
id|sh7751_pci_address_map
id|sh7751_pci_map
op_assign
(brace
dot
id|window0
op_assign
(brace
dot
id|base
op_assign
id|SH7751_CS3_BASE_ADDR
comma
dot
id|size
op_assign
id|BIGSUR_LSR0_SIZE
comma
)brace
comma
dot
id|window1
op_assign
(brace
dot
id|base
op_assign
id|SH7751_CS3_BASE_ADDR
comma
dot
id|size
op_assign
id|BIGSUR_LSR1_SIZE
comma
)brace
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Initialize the Big Sur PCI interface &n; * Setup hardware to be Central Funtion&n; * Copy the BSR regs to the PCI interface&n; * Setup PCI windows into local RAM&n; */
DECL|function|pcibios_init_platform
r_int
id|__init
id|pcibios_init_platform
c_func
(paren
r_void
)paren
(brace
r_return
id|sh7751_pcic_init
c_func
(paren
op_amp
id|sh7751_pci_map
)paren
suffix:semicolon
)brace
DECL|function|pcibios_map_platform_irq
r_int
id|pcibios_map_platform_irq
c_func
(paren
id|u8
id|slot
comma
id|u8
id|pin
)paren
(brace
multiline_comment|/* &n;&t; * The Big Sur can be used in a CPCI chassis, but the SH7751 PCI&n;&t; * interface is on the wrong end of the board so that it can also&n;&t; * support a V320 CPI interface chip...  Therefor the IRQ mapping is&n;&t; * somewhat use dependent... I&squot;l assume a linear map for now, i.e.&n;&t; * INTA=slot0,pin0... INTD=slot3,pin0...&n;&t; */
r_int
id|irq
op_assign
(paren
id|slot
op_plus
id|pin
op_minus
l_int|1
)paren
op_mod
l_int|4
op_plus
id|BIGSUR_SH7751_PCI_IRQ_BASE
suffix:semicolon
id|PCIDBG
c_func
(paren
l_int|2
comma
l_string|&quot;PCI: Mapping Big Sur IRQ for slot %d, pin %c to irq %d&bslash;n&quot;
comma
id|slot
comma
id|pin
op_minus
l_int|1
op_plus
l_char|&squot;A&squot;
comma
id|irq
)paren
suffix:semicolon
r_return
id|irq
suffix:semicolon
)brace
eof
