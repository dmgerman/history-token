multiline_comment|/* -------------------------------------------------------------------- */
multiline_comment|/* setup_voyagergx.c:                                                     */
multiline_comment|/* -------------------------------------------------------------------- */
multiline_comment|/*  This program is free software; you can redistribute it and/or modify&n;    it under the terms of the GNU General Public License as published by&n;    the Free Software Foundation; either version 2 of the License, or&n;    (at your option) any later version.&n;&n;    This program is distributed in the hope that it will be useful,&n;    but WITHOUT ANY WARRANTY; without even the implied warranty of&n;    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n;    GNU General Public License for more details.&n;&n;    You should have received a copy of the GNU General Public License&n;    along with this program; if not, write to the Free Software&n;    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.&n;&n;    Copyright 2003 (c) Lineo uSolutions,Inc.&n;*/
multiline_comment|/* -------------------------------------------------------------------- */
DECL|macro|DEBUG
macro_line|#undef DEBUG
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/param.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/irq.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/rts7751r2d/rts7751r2d.h&gt;
macro_line|#include &lt;asm/rts7751r2d/voyagergx_reg.h&gt;
DECL|function|disable_voyagergx_irq
r_static
r_void
id|disable_voyagergx_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|flags
comma
id|val
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|1
op_lshift
(paren
id|irq
op_minus
id|VOYAGER_IRQ_BASE
)paren
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;disable_voyagergx_irq(%d): mask=%x&bslash;n&quot;
comma
id|irq
comma
id|mask
)paren
suffix:semicolon
id|local_irq_save
c_func
(paren
id|flags
)paren
suffix:semicolon
id|val
op_assign
id|inl
c_func
(paren
id|VOYAGER_INT_MASK
)paren
suffix:semicolon
id|val
op_and_assign
op_complement
id|mask
suffix:semicolon
id|outl
c_func
(paren
id|val
comma
id|VOYAGER_INT_MASK
)paren
suffix:semicolon
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|enable_voyagergx_irq
r_static
r_void
id|enable_voyagergx_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|flags
comma
id|val
suffix:semicolon
r_int
r_int
id|mask
op_assign
l_int|1
op_lshift
(paren
id|irq
op_minus
id|VOYAGER_IRQ_BASE
)paren
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;disable_voyagergx_irq(%d): mask=%x&bslash;n&quot;
comma
id|irq
comma
id|mask
)paren
suffix:semicolon
id|local_irq_save
c_func
(paren
id|flags
)paren
suffix:semicolon
id|val
op_assign
id|inl
c_func
(paren
id|VOYAGER_INT_MASK
)paren
suffix:semicolon
id|val
op_or_assign
id|mask
suffix:semicolon
id|outl
c_func
(paren
id|val
comma
id|VOYAGER_INT_MASK
)paren
suffix:semicolon
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|mask_and_ack_voyagergx
r_static
r_void
id|mask_and_ack_voyagergx
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|disable_voyagergx_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
)brace
DECL|function|end_voyagergx_irq
r_static
r_void
id|end_voyagergx_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|irq_desc
(braket
id|irq
)braket
dot
id|status
op_amp
(paren
id|IRQ_DISABLED
op_or
id|IRQ_INPROGRESS
)paren
)paren
)paren
id|enable_voyagergx_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
)brace
DECL|function|startup_voyagergx_irq
r_static
r_int
r_int
id|startup_voyagergx_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|enable_voyagergx_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|shutdown_voyagergx_irq
r_static
r_void
id|shutdown_voyagergx_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|disable_voyagergx_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
)brace
DECL|variable|voyagergx_irq_type
r_static
r_struct
id|hw_interrupt_type
id|voyagergx_irq_type
op_assign
(brace
l_string|&quot;VOYAGERGX-IRQ&quot;
comma
id|startup_voyagergx_irq
comma
id|shutdown_voyagergx_irq
comma
id|enable_voyagergx_irq
comma
id|disable_voyagergx_irq
comma
id|mask_and_ack_voyagergx
comma
id|end_voyagergx_irq
comma
)brace
suffix:semicolon
DECL|function|voyagergx_interrupt
r_static
id|irqreturn_t
id|voyagergx_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;VoyagerGX: spurious interrupt, status: 0x%x&bslash;n&quot;
comma
id|inl
c_func
(paren
id|INT_STATUS
)paren
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
multiline_comment|/*====================================================*/
r_static
r_struct
(brace
DECL|member|func
r_int
(paren
op_star
id|func
)paren
(paren
r_int
comma
r_void
op_star
)paren
suffix:semicolon
DECL|member|dev
r_void
op_star
id|dev
suffix:semicolon
DECL|variable|voyagergx_demux
)brace
id|voyagergx_demux
(braket
id|VOYAGER_IRQ_NUM
)braket
suffix:semicolon
DECL|function|voyagergx_register_irq_demux
r_void
id|voyagergx_register_irq_demux
c_func
(paren
r_int
id|irq
comma
r_int
(paren
op_star
id|demux
)paren
(paren
r_int
id|irq
comma
r_void
op_star
id|dev
)paren
comma
r_void
op_star
id|dev
)paren
(brace
id|voyagergx_demux
(braket
id|irq
op_minus
id|VOYAGER_IRQ_BASE
)braket
dot
id|func
op_assign
id|demux
suffix:semicolon
id|voyagergx_demux
(braket
id|irq
op_minus
id|VOYAGER_IRQ_BASE
)braket
dot
id|dev
op_assign
id|dev
suffix:semicolon
)brace
DECL|function|voyagergx_unregister_irq_demux
r_void
id|voyagergx_unregister_irq_demux
c_func
(paren
r_int
id|irq
)paren
(brace
id|voyagergx_demux
(braket
id|irq
op_minus
id|VOYAGER_IRQ_BASE
)braket
dot
id|func
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|voyagergx_irq_demux
r_int
id|voyagergx_irq_demux
c_func
(paren
r_int
id|irq
)paren
(brace
r_if
c_cond
(paren
id|irq
op_eq
id|IRQ_VOYAGER
)paren
(brace
r_int
r_int
id|i
op_assign
l_int|0
comma
id|bit
id|__attribute__
(paren
(paren
id|unused
)paren
)paren
suffix:semicolon
r_int
r_int
id|val
op_assign
id|inl
c_func
(paren
id|INT_STATUS
)paren
suffix:semicolon
macro_line|#if 1
r_if
c_cond
(paren
id|val
op_amp
(paren
l_int|1
op_lshift
l_int|1
)paren
)paren
(brace
id|i
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|val
op_amp
(paren
l_int|1
op_lshift
l_int|2
)paren
)paren
(brace
id|i
op_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|val
op_amp
(paren
l_int|1
op_lshift
l_int|6
)paren
)paren
(brace
id|i
op_assign
l_int|6
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|val
op_amp
(paren
l_int|1
op_lshift
l_int|10
)paren
)paren
(brace
id|i
op_assign
l_int|10
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|val
op_amp
(paren
l_int|1
op_lshift
l_int|11
)paren
)paren
(brace
id|i
op_assign
l_int|11
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|val
op_amp
(paren
l_int|1
op_lshift
l_int|12
)paren
)paren
(brace
id|i
op_assign
l_int|12
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|val
op_amp
(paren
l_int|1
op_lshift
l_int|17
)paren
)paren
(brace
id|i
op_assign
l_int|17
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;Unexpected IRQ irq = %d status = 0x%08lx&bslash;n&quot;
comma
id|irq
comma
id|val
)paren
suffix:semicolon
)brace
id|pr_debug
c_func
(paren
l_string|&quot;voyagergx_irq_demux %d &bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
macro_line|#else
r_for
c_loop
(paren
id|bit
op_assign
l_int|1
comma
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|VOYAGER_IRQ_NUM
suffix:semicolon
id|bit
op_lshift_assign
l_int|1
comma
id|i
op_increment
)paren
r_if
c_cond
(paren
id|val
op_amp
id|bit
)paren
r_break
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|i
OL
id|VOYAGER_IRQ_NUM
)paren
(brace
id|irq
op_assign
id|VOYAGER_IRQ_BASE
op_plus
id|i
suffix:semicolon
r_if
c_cond
(paren
id|voyagergx_demux
(braket
id|i
)braket
dot
id|func
op_ne
l_int|0
)paren
id|irq
op_assign
id|voyagergx_demux
(braket
id|i
)braket
dot
id|func
c_func
(paren
id|irq
comma
id|voyagergx_demux
(braket
id|i
)braket
dot
id|dev
)paren
suffix:semicolon
)brace
)brace
r_return
id|irq
suffix:semicolon
)brace
DECL|variable|irq0
r_static
r_struct
id|irqaction
id|irq0
op_assign
(brace
id|voyagergx_interrupt
comma
id|SA_INTERRUPT
comma
l_int|0
comma
l_string|&quot;VOYAGERGX&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|function|setup_voyagergx_irq
r_void
id|__init
id|setup_voyagergx_irq
c_func
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|flag
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;VoyagerGX configured at 0x%x on irq %d(mapped into %d to %d)&bslash;n&quot;
comma
id|VOYAGER_BASE
comma
id|IRQ_VOYAGER
comma
id|VOYAGER_IRQ_BASE
comma
id|VOYAGER_IRQ_BASE
op_plus
id|VOYAGER_IRQ_NUM
op_minus
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|VOYAGER_IRQ_NUM
suffix:semicolon
id|i
op_increment
)paren
(brace
id|flag
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|VOYAGER_IRQ_BASE
op_plus
id|i
)paren
(brace
r_case
id|VOYAGER_USBH_IRQ
suffix:colon
r_case
id|VOYAGER_8051_IRQ
suffix:colon
r_case
id|VOYAGER_UART0_IRQ
suffix:colon
r_case
id|VOYAGER_UART1_IRQ
suffix:colon
r_case
id|VOYAGER_AC97_IRQ
suffix:colon
id|flag
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flag
op_eq
l_int|1
)paren
id|irq_desc
(braket
id|VOYAGER_IRQ_BASE
op_plus
id|i
)braket
dot
id|handler
op_assign
op_amp
id|voyagergx_irq_type
suffix:semicolon
)brace
id|setup_irq
c_func
(paren
id|IRQ_VOYAGER
comma
op_amp
id|irq0
)paren
suffix:semicolon
)brace
eof
