multiline_comment|/* &n; * Copyright (C) 2000 David J. Mckay (david.mckay@st.com)&n; *&n; * May be copied or modified under the terms of the GNU General Public&n; * License.  See linux/COPYING for more information.                            &n; *&n; * This file contains the I/O routines for use on the overdrive board&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/addrspace.h&gt;
macro_line|#include &lt;asm/overdrive/overdrive.h&gt;
multiline_comment|/*&n; * readX/writeX() are used to access memory mapped devices. On some&n; * architectures the memory mapped IO stuff needs to be accessed&n; * differently. On the SuperH architecture, we just read/write the&n; * memory location directly.&n; */
DECL|macro|dprintk
mdefine_line|#define dprintk(x...)
multiline_comment|/* Translates an IO address to where it is mapped in memory */
DECL|macro|io_addr
mdefine_line|#define io_addr(x) (((unsigned)(x))|PCI_GTIO_BASE)
DECL|function|od_inb
r_int
r_char
id|od_inb
c_func
(paren
r_int
r_int
id|port
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;od_inb(%x)&bslash;n&quot;
comma
id|port
)paren
suffix:semicolon
r_return
id|readb
c_func
(paren
id|io_addr
c_func
(paren
id|port
)paren
)paren
op_amp
l_int|0xff
suffix:semicolon
)brace
DECL|function|od_inw
r_int
r_int
id|od_inw
c_func
(paren
r_int
r_int
id|port
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;od_inw(%x)&bslash;n&quot;
comma
id|port
)paren
suffix:semicolon
r_return
id|readw
c_func
(paren
id|io_addr
c_func
(paren
id|port
)paren
)paren
op_amp
l_int|0xffff
suffix:semicolon
)brace
DECL|function|od_inl
r_int
r_int
id|od_inl
c_func
(paren
r_int
r_int
id|port
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;od_inl(%x)&bslash;n&quot;
comma
id|port
)paren
suffix:semicolon
r_return
id|readl
c_func
(paren
id|io_addr
c_func
(paren
id|port
)paren
)paren
suffix:semicolon
)brace
DECL|function|od_outb
r_void
id|od_outb
c_func
(paren
r_int
r_char
id|value
comma
r_int
r_int
id|port
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;od_outb(%x, %x)&bslash;n&quot;
comma
id|value
comma
id|port
)paren
suffix:semicolon
id|writeb
c_func
(paren
id|value
comma
id|io_addr
c_func
(paren
id|port
)paren
)paren
suffix:semicolon
)brace
DECL|function|od_outw
r_void
id|od_outw
c_func
(paren
r_int
r_int
id|value
comma
r_int
r_int
id|port
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;od_outw(%x, %x)&bslash;n&quot;
comma
id|value
comma
id|port
)paren
suffix:semicolon
id|writew
c_func
(paren
id|value
comma
id|io_addr
c_func
(paren
id|port
)paren
)paren
suffix:semicolon
)brace
DECL|function|od_outl
r_void
id|od_outl
c_func
(paren
r_int
r_int
id|value
comma
r_int
r_int
id|port
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;od_outl(%x, %x)&bslash;n&quot;
comma
id|value
comma
id|port
)paren
suffix:semicolon
id|writel
c_func
(paren
id|value
comma
id|io_addr
c_func
(paren
id|port
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* This is horrible at the moment - needs more work to do something sensible */
DECL|macro|IO_DELAY
mdefine_line|#define IO_DELAY() udelay(10)
DECL|macro|OUT_DELAY
mdefine_line|#define OUT_DELAY(x,type) &bslash;&n;void od_out##x##_p(unsigned type value,unsigned long port){out##x(value,port);IO_DELAY();}
DECL|macro|IN_DELAY
mdefine_line|#define IN_DELAY(x,type) &bslash;&n;unsigned type od_in##x##_p(unsigned long port) {unsigned type tmp=in##x(port);IO_DELAY();return tmp;}
id|OUT_DELAY
c_func
(paren
id|b
comma
r_char
)paren
id|OUT_DELAY
c_func
(paren
id|w
comma
r_int
)paren
id|OUT_DELAY
c_func
(paren
id|l
comma
r_int
)paren
id|IN_DELAY
c_func
(paren
id|b
comma
r_char
)paren
id|IN_DELAY
c_func
(paren
id|w
comma
r_int
)paren
id|IN_DELAY
c_func
(paren
id|l
comma
r_int
)paren
multiline_comment|/*  Now for the string version of these functions */
DECL|function|od_outsb
r_void
id|od_outsb
c_func
(paren
r_int
r_int
id|port
comma
r_const
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_char
op_star
id|p
op_assign
(paren
r_int
r_char
op_star
)paren
id|addr
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
comma
id|p
op_increment
)paren
(brace
id|outb
c_func
(paren
op_star
id|p
comma
id|port
)paren
suffix:semicolon
)brace
)brace
DECL|function|od_insb
r_void
id|od_insb
c_func
(paren
r_int
r_int
id|port
comma
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_char
op_star
id|p
op_assign
(paren
r_int
r_char
op_star
)paren
id|addr
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
comma
id|p
op_increment
)paren
(brace
op_star
id|p
op_assign
id|inb
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* For the 16 and 32 bit string functions, we have to worry about alignment.&n; * The SH does not do unaligned accesses, so we have to read as bytes and&n; * then write as a word or dword. &n; * This can be optimised a lot more, especially in the case where the data&n; * is aligned&n; */
DECL|function|od_outsw
r_void
id|od_outsw
c_func
(paren
r_int
r_int
id|port
comma
r_const
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
r_int
r_char
op_star
id|p
op_assign
(paren
r_int
r_char
op_star
)paren
id|addr
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
comma
id|p
op_add_assign
l_int|2
)paren
(brace
id|tmp
op_assign
(paren
op_star
id|p
)paren
op_or
(paren
(paren
op_star
(paren
id|p
op_plus
l_int|1
)paren
)paren
op_lshift
l_int|8
)paren
suffix:semicolon
id|outw
c_func
(paren
id|tmp
comma
id|port
)paren
suffix:semicolon
)brace
)brace
DECL|function|od_insw
r_void
id|od_insw
c_func
(paren
r_int
r_int
id|port
comma
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
r_int
r_char
op_star
id|p
op_assign
(paren
r_int
r_char
op_star
)paren
id|addr
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
comma
id|p
op_add_assign
l_int|2
)paren
(brace
id|tmp
op_assign
id|inw
c_func
(paren
id|port
)paren
suffix:semicolon
id|p
(braket
l_int|0
)braket
op_assign
id|tmp
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|1
)braket
op_assign
(paren
id|tmp
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
)brace
)brace
DECL|function|od_outsl
r_void
id|od_outsl
c_func
(paren
r_int
r_int
id|port
comma
r_const
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|tmp
suffix:semicolon
r_int
r_char
op_star
id|p
op_assign
(paren
r_int
r_char
op_star
)paren
id|addr
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
comma
id|p
op_add_assign
l_int|4
)paren
(brace
id|tmp
op_assign
(paren
op_star
id|p
)paren
op_or
(paren
(paren
op_star
(paren
id|p
op_plus
l_int|1
)paren
)paren
op_lshift
l_int|8
)paren
op_or
(paren
(paren
op_star
(paren
id|p
op_plus
l_int|2
)paren
)paren
op_lshift
l_int|16
)paren
op_or
(paren
(paren
op_star
(paren
id|p
op_plus
l_int|3
)paren
)paren
op_lshift
l_int|24
)paren
suffix:semicolon
id|outl
c_func
(paren
id|tmp
comma
id|port
)paren
suffix:semicolon
)brace
)brace
DECL|function|od_insl
r_void
id|od_insl
c_func
(paren
r_int
r_int
id|port
comma
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|tmp
suffix:semicolon
r_int
r_char
op_star
id|p
op_assign
(paren
r_int
r_char
op_star
)paren
id|addr
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
comma
id|p
op_add_assign
l_int|4
)paren
(brace
id|tmp
op_assign
id|inl
c_func
(paren
id|port
)paren
suffix:semicolon
id|p
(braket
l_int|0
)braket
op_assign
id|tmp
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|1
)braket
op_assign
(paren
id|tmp
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|2
)braket
op_assign
(paren
id|tmp
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|p
(braket
l_int|3
)braket
op_assign
(paren
id|tmp
op_rshift
l_int|24
)paren
op_amp
l_int|0xff
suffix:semicolon
)brace
)brace
eof
