multiline_comment|/*&n; * arch/sh/boards/overdrive/time.c&n; *&n; * Copyright (C) 2000 Stuart Menefy (stuart.menefy@st.com)&n; * Copyright (C) 2002 Paul Mundt (lethal@chaoticdreams.org)&n; *&n; * May be copied or modified under the terms of the GNU General Public&n; * License.  See linux/COPYING for more information.&n; *&n; * STMicroelectronics Overdrive Support.&n; */
DECL|function|od_time_init
r_void
id|od_time_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|frqcr_data
(brace
r_int
r_int
id|frqcr
suffix:semicolon
r_struct
(brace
r_int
r_char
id|multiplier
suffix:semicolon
r_int
r_char
id|divisor
suffix:semicolon
)brace
id|factor
(braket
l_int|3
)braket
suffix:semicolon
)brace
suffix:semicolon
r_static
r_struct
id|frqcr_data
id|st40_frqcr_table
(braket
)braket
op_assign
(brace
(brace
l_int|0x000
comma
(brace
(brace
l_int|1
comma
l_int|1
)brace
comma
(brace
l_int|1
comma
l_int|1
)brace
comma
(brace
l_int|1
comma
l_int|2
)brace
)brace
)brace
comma
(brace
l_int|0x002
comma
(brace
(brace
l_int|1
comma
l_int|1
)brace
comma
(brace
l_int|1
comma
l_int|1
)brace
comma
(brace
l_int|1
comma
l_int|4
)brace
)brace
)brace
comma
(brace
l_int|0x004
comma
(brace
(brace
l_int|1
comma
l_int|1
)brace
comma
(brace
l_int|1
comma
l_int|1
)brace
comma
(brace
l_int|1
comma
l_int|8
)brace
)brace
)brace
comma
(brace
l_int|0x008
comma
(brace
(brace
l_int|1
comma
l_int|1
)brace
comma
(brace
l_int|1
comma
l_int|2
)brace
comma
(brace
l_int|1
comma
l_int|2
)brace
)brace
)brace
comma
(brace
l_int|0x00A
comma
(brace
(brace
l_int|1
comma
l_int|1
)brace
comma
(brace
l_int|1
comma
l_int|2
)brace
comma
(brace
l_int|1
comma
l_int|4
)brace
)brace
)brace
comma
(brace
l_int|0x00C
comma
(brace
(brace
l_int|1
comma
l_int|1
)brace
comma
(brace
l_int|1
comma
l_int|2
)brace
comma
(brace
l_int|1
comma
l_int|8
)brace
)brace
)brace
comma
(brace
l_int|0x011
comma
(brace
(brace
l_int|1
comma
l_int|1
)brace
comma
(brace
l_int|2
comma
l_int|3
)brace
comma
(brace
l_int|1
comma
l_int|6
)brace
)brace
)brace
comma
(brace
l_int|0x013
comma
(brace
(brace
l_int|1
comma
l_int|1
)brace
comma
(brace
l_int|2
comma
l_int|3
)brace
comma
(brace
l_int|1
comma
l_int|3
)brace
)brace
)brace
comma
(brace
l_int|0x01A
comma
(brace
(brace
l_int|1
comma
l_int|1
)brace
comma
(brace
l_int|1
comma
l_int|2
)brace
comma
(brace
l_int|1
comma
l_int|4
)brace
)brace
)brace
comma
(brace
l_int|0x01C
comma
(brace
(brace
l_int|1
comma
l_int|1
)brace
comma
(brace
l_int|1
comma
l_int|2
)brace
comma
(brace
l_int|1
comma
l_int|8
)brace
)brace
)brace
comma
(brace
l_int|0x023
comma
(brace
(brace
l_int|1
comma
l_int|1
)brace
comma
(brace
l_int|2
comma
l_int|3
)brace
comma
(brace
l_int|1
comma
l_int|3
)brace
)brace
)brace
comma
(brace
l_int|0x02C
comma
(brace
(brace
l_int|1
comma
l_int|1
)brace
comma
(brace
l_int|1
comma
l_int|2
)brace
comma
(brace
l_int|1
comma
l_int|8
)brace
)brace
)brace
comma
(brace
l_int|0x048
comma
(brace
(brace
l_int|1
comma
l_int|2
)brace
comma
(brace
l_int|1
comma
l_int|2
)brace
comma
(brace
l_int|1
comma
l_int|4
)brace
)brace
)brace
comma
(brace
l_int|0x04A
comma
(brace
(brace
l_int|1
comma
l_int|2
)brace
comma
(brace
l_int|1
comma
l_int|2
)brace
comma
(brace
l_int|1
comma
l_int|6
)brace
)brace
)brace
comma
(brace
l_int|0x04C
comma
(brace
(brace
l_int|1
comma
l_int|2
)brace
comma
(brace
l_int|1
comma
l_int|2
)brace
comma
(brace
l_int|1
comma
l_int|8
)brace
)brace
)brace
comma
(brace
l_int|0x05A
comma
(brace
(brace
l_int|1
comma
l_int|2
)brace
comma
(brace
l_int|1
comma
l_int|3
)brace
comma
(brace
l_int|1
comma
l_int|6
)brace
)brace
)brace
comma
(brace
l_int|0x05C
comma
(brace
(brace
l_int|1
comma
l_int|2
)brace
comma
(brace
l_int|1
comma
l_int|3
)brace
comma
(brace
l_int|1
comma
l_int|6
)brace
)brace
)brace
comma
(brace
l_int|0x063
comma
(brace
(brace
l_int|1
comma
l_int|2
)brace
comma
(brace
l_int|1
comma
l_int|4
)brace
comma
(brace
l_int|1
comma
l_int|4
)brace
)brace
)brace
comma
(brace
l_int|0x06C
comma
(brace
(brace
l_int|1
comma
l_int|2
)brace
comma
(brace
l_int|1
comma
l_int|4
)brace
comma
(brace
l_int|1
comma
l_int|8
)brace
)brace
)brace
comma
(brace
l_int|0x091
comma
(brace
(brace
l_int|1
comma
l_int|3
)brace
comma
(brace
l_int|1
comma
l_int|3
)brace
comma
(brace
l_int|1
comma
l_int|6
)brace
)brace
)brace
comma
(brace
l_int|0x093
comma
(brace
(brace
l_int|1
comma
l_int|3
)brace
comma
(brace
l_int|1
comma
l_int|3
)brace
comma
(brace
l_int|1
comma
l_int|6
)brace
)brace
)brace
comma
(brace
l_int|0x0A3
comma
(brace
(brace
l_int|1
comma
l_int|3
)brace
comma
(brace
l_int|1
comma
l_int|6
)brace
comma
(brace
l_int|1
comma
l_int|6
)brace
)brace
)brace
comma
(brace
l_int|0x0DA
comma
(brace
(brace
l_int|1
comma
l_int|4
)brace
comma
(brace
l_int|1
comma
l_int|4
)brace
comma
(brace
l_int|1
comma
l_int|8
)brace
)brace
)brace
comma
(brace
l_int|0x0DC
comma
(brace
(brace
l_int|1
comma
l_int|4
)brace
comma
(brace
l_int|1
comma
l_int|4
)brace
comma
(brace
l_int|1
comma
l_int|8
)brace
)brace
)brace
comma
(brace
l_int|0x0EC
comma
(brace
(brace
l_int|1
comma
l_int|4
)brace
comma
(brace
l_int|1
comma
l_int|8
)brace
comma
(brace
l_int|1
comma
l_int|8
)brace
)brace
)brace
comma
(brace
l_int|0x123
comma
(brace
(brace
l_int|1
comma
l_int|4
)brace
comma
(brace
l_int|1
comma
l_int|4
)brace
comma
(brace
l_int|1
comma
l_int|8
)brace
)brace
)brace
comma
(brace
l_int|0x16C
comma
(brace
(brace
l_int|1
comma
l_int|4
)brace
comma
(brace
l_int|1
comma
l_int|8
)brace
comma
(brace
l_int|1
comma
l_int|8
)brace
)brace
)brace
comma
)brace
suffix:semicolon
r_struct
id|memclk_data
(brace
r_int
r_char
id|multiplier
suffix:semicolon
r_int
r_char
id|divisor
suffix:semicolon
)brace
suffix:semicolon
r_static
r_struct
id|memclk_data
id|st40_memclk_table
(braket
l_int|8
)braket
op_assign
(brace
(brace
l_int|1
comma
l_int|1
)brace
comma
singleline_comment|// 000
(brace
l_int|1
comma
l_int|2
)brace
comma
singleline_comment|// 001
(brace
l_int|1
comma
l_int|3
)brace
comma
singleline_comment|// 010
(brace
l_int|2
comma
l_int|3
)brace
comma
singleline_comment|// 011
(brace
l_int|1
comma
l_int|4
)brace
comma
singleline_comment|// 100
(brace
l_int|1
comma
l_int|6
)brace
comma
singleline_comment|// 101
(brace
l_int|1
comma
l_int|8
)brace
comma
singleline_comment|// 110
(brace
l_int|1
comma
l_int|8
)brace
singleline_comment|// 111
)brace
suffix:semicolon
r_int
r_int
id|pvr
suffix:semicolon
multiline_comment|/* &n;&t; * This should probably be moved into the SH3 probing code, and then&n;&t; * use the processor structure to determine which CPU we are running&n;&t; * on.&n;&t; */
id|pvr
op_assign
id|ctrl_inl
c_func
(paren
id|CCN_PVR
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;PVR %08x&bslash;n&quot;
comma
id|pvr
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|pvr
op_rshift
id|CCN_PVR_CHIP_SHIFT
)paren
op_amp
id|CCN_PVR_CHIP_MASK
)paren
op_eq
id|CCN_PVR_CHIP_ST40STB1
)paren
(brace
multiline_comment|/* &n;&t;&t; * Unfortunatly the STB1 FRQCR values are different from the&n;&t;&t; * 7750 ones.&n;&t;&t; */
r_struct
id|frqcr_data
op_star
id|d
suffix:semicolon
r_int
id|a
suffix:semicolon
r_int
r_int
id|memclkcr
suffix:semicolon
r_struct
id|memclk_data
op_star
id|e
suffix:semicolon
r_for
c_loop
(paren
id|a
op_assign
l_int|0
suffix:semicolon
id|a
OL
id|ARRAY_SIZE
c_func
(paren
id|st40_frqcr_table
)paren
suffix:semicolon
id|a
op_increment
)paren
(brace
id|d
op_assign
op_amp
id|st40_frqcr_table
(braket
id|a
)braket
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;frqcr
op_eq
(paren
id|frqcr
op_amp
l_int|0x1ff
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|a
op_eq
id|ARRAY_SIZE
c_func
(paren
id|st40_frqcr_table
)paren
)paren
(brace
id|d
op_assign
id|st40_frqcr_table
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;ERROR: Unrecognised FRQCR value, using default multipliers&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|memclkcr
op_assign
id|ctrl_inl
c_func
(paren
id|CLOCKGEN_MEMCLKCR
)paren
suffix:semicolon
id|e
op_assign
op_amp
id|st40_memclk_table
(braket
id|memclkcr
op_amp
id|MEMCLKCR_RATIO_MASK
)braket
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Clock multipliers: CPU: %d/%d Bus: %d/%d Mem: %d/%d Periph: %d/%d&bslash;n&quot;
comma
id|d-&gt;factor
(braket
l_int|0
)braket
dot
id|multiplier
comma
id|d-&gt;factor
(braket
l_int|0
)braket
dot
id|divisor
comma
id|d-&gt;factor
(braket
l_int|1
)braket
dot
id|multiplier
comma
id|d-&gt;factor
(braket
l_int|1
)braket
dot
id|divisor
comma
id|e-&gt;multiplier
comma
id|e-&gt;divisor
comma
id|d-&gt;factor
(braket
l_int|2
)braket
dot
id|multiplier
comma
id|d-&gt;factor
(braket
l_int|2
)braket
dot
id|divisor
)paren
suffix:semicolon
id|current_cpu_data.master_clock
op_assign
id|current_cpu_data.module_clock
op_star
id|d-&gt;factor
(braket
l_int|2
)braket
dot
id|divisor
op_div
id|d-&gt;factor
(braket
l_int|2
)braket
dot
id|multiplier
suffix:semicolon
id|current_cpu_data.bus_clock
op_assign
id|current_cpu_data.master_clock
op_star
id|d-&gt;factor
(braket
l_int|1
)braket
dot
id|multiplier
op_div
id|d-&gt;factor
(braket
l_int|1
)braket
dot
id|divisor
suffix:semicolon
id|current_cpu_data.memory_clock
op_assign
id|current_cpu_data.master_clock
op_star
id|e-&gt;multiplier
op_div
id|e-&gt;divisor
suffix:semicolon
id|current_cpu_data.cpu_clock
op_assign
id|current_cpu_data.master_clock
op_star
id|d-&gt;factor
(braket
l_int|0
)braket
dot
id|multiplier
op_div
id|d-&gt;factor
(braket
l_int|0
)braket
dot
id|divisor
suffix:semicolon
)brace
eof
