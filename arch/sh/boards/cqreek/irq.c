multiline_comment|/* $Id: irq.c,v 1.1.2.4 2002/11/04 20:33:56 lethal Exp $&n; *&n; * arch/sh/boards/cqreek/irq.c&n; *&n; * Copyright (C) 2000  Niibe Yutaka&n; *&n; * CqREEK IDE/ISA Bridge Support.&n; *&n; */
macro_line|#include &lt;linux/irq.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/cqreek/cqreek.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/io_generic.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/machvec.h&gt;
macro_line|#include &lt;asm/machvec_init.h&gt;
macro_line|#include &lt;asm/rtc.h&gt;
DECL|struct|cqreek_irq_data
r_struct
id|cqreek_irq_data
(brace
DECL|member|mask_port
r_int
r_int
id|mask_port
suffix:semicolon
multiline_comment|/* Port of Interrupt Mask Register */
DECL|member|stat_port
r_int
r_int
id|stat_port
suffix:semicolon
multiline_comment|/* Port of Interrupt Status Register */
DECL|member|bit
r_int
r_int
id|bit
suffix:semicolon
multiline_comment|/* Value of the bit */
)brace
suffix:semicolon
DECL|variable|cqreek_irq_data
r_static
r_struct
id|cqreek_irq_data
id|cqreek_irq_data
(braket
id|NR_IRQS
)braket
suffix:semicolon
DECL|function|disable_cqreek_irq
r_static
r_void
id|disable_cqreek_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|mask
suffix:semicolon
r_int
r_int
id|mask_port
op_assign
id|cqreek_irq_data
(braket
id|irq
)braket
dot
id|mask_port
suffix:semicolon
r_int
r_int
id|bit
op_assign
id|cqreek_irq_data
(braket
id|irq
)braket
dot
id|bit
suffix:semicolon
id|local_irq_save
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/* Disable IRQ */
id|mask
op_assign
id|inw
c_func
(paren
id|mask_port
)paren
op_amp
op_complement
id|bit
suffix:semicolon
id|outw_p
c_func
(paren
id|mask
comma
id|mask_port
)paren
suffix:semicolon
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|enable_cqreek_irq
r_static
r_void
id|enable_cqreek_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|mask
suffix:semicolon
r_int
r_int
id|mask_port
op_assign
id|cqreek_irq_data
(braket
id|irq
)braket
dot
id|mask_port
suffix:semicolon
r_int
r_int
id|bit
op_assign
id|cqreek_irq_data
(braket
id|irq
)braket
dot
id|bit
suffix:semicolon
id|local_irq_save
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/* Enable IRQ */
id|mask
op_assign
id|inw
c_func
(paren
id|mask_port
)paren
op_or
id|bit
suffix:semicolon
id|outw_p
c_func
(paren
id|mask
comma
id|mask_port
)paren
suffix:semicolon
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|mask_and_ack_cqreek
r_static
r_void
id|mask_and_ack_cqreek
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|stat_port
op_assign
id|cqreek_irq_data
(braket
id|irq
)braket
dot
id|stat_port
suffix:semicolon
r_int
r_int
id|bit
op_assign
id|cqreek_irq_data
(braket
id|irq
)braket
dot
id|bit
suffix:semicolon
id|disable_cqreek_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
multiline_comment|/* Clear IRQ (it might be edge IRQ) */
id|inw
c_func
(paren
id|stat_port
)paren
suffix:semicolon
id|outw_p
c_func
(paren
id|bit
comma
id|stat_port
)paren
suffix:semicolon
)brace
DECL|function|end_cqreek_irq
r_static
r_void
id|end_cqreek_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|irq_desc
(braket
id|irq
)braket
dot
id|status
op_amp
(paren
id|IRQ_DISABLED
op_or
id|IRQ_INPROGRESS
)paren
)paren
)paren
id|enable_cqreek_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
)brace
DECL|function|startup_cqreek_irq
r_static
r_int
r_int
id|startup_cqreek_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|enable_cqreek_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|shutdown_cqreek_irq
r_static
r_void
id|shutdown_cqreek_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|disable_cqreek_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
)brace
DECL|variable|cqreek_irq_type
r_static
r_struct
id|hw_interrupt_type
id|cqreek_irq_type
op_assign
(brace
l_string|&quot;CqREEK-IRQ&quot;
comma
id|startup_cqreek_irq
comma
id|shutdown_cqreek_irq
comma
id|enable_cqreek_irq
comma
id|disable_cqreek_irq
comma
id|mask_and_ack_cqreek
comma
id|end_cqreek_irq
)brace
suffix:semicolon
DECL|variable|cqreek_has_ide
DECL|variable|cqreek_has_isa
r_int
id|cqreek_has_ide
comma
id|cqreek_has_isa
suffix:semicolon
multiline_comment|/* XXX: This is just for test for my NE2000 ISA board&n;   What we really need is virtualized IRQ and demultiplexer like HP600 port */
DECL|function|init_cqreek_IRQ
r_void
id|__init
id|init_cqreek_IRQ
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|cqreek_has_ide
)paren
(brace
id|cqreek_irq_data
(braket
l_int|14
)braket
dot
id|mask_port
op_assign
id|BRIDGE_IDE_INTR_MASK
suffix:semicolon
id|cqreek_irq_data
(braket
l_int|14
)braket
dot
id|stat_port
op_assign
id|BRIDGE_IDE_INTR_STAT
suffix:semicolon
id|cqreek_irq_data
(braket
l_int|14
)braket
dot
id|bit
op_assign
l_int|1
suffix:semicolon
id|irq_desc
(braket
l_int|14
)braket
dot
id|handler
op_assign
op_amp
id|cqreek_irq_type
suffix:semicolon
id|irq_desc
(braket
l_int|14
)braket
dot
id|status
op_assign
id|IRQ_DISABLED
suffix:semicolon
id|irq_desc
(braket
l_int|14
)braket
dot
id|action
op_assign
l_int|0
suffix:semicolon
id|irq_desc
(braket
l_int|14
)braket
dot
id|depth
op_assign
l_int|1
suffix:semicolon
id|disable_cqreek_irq
c_func
(paren
l_int|14
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cqreek_has_isa
)paren
(brace
id|cqreek_irq_data
(braket
l_int|10
)braket
dot
id|mask_port
op_assign
id|BRIDGE_ISA_INTR_MASK
suffix:semicolon
id|cqreek_irq_data
(braket
l_int|10
)braket
dot
id|stat_port
op_assign
id|BRIDGE_ISA_INTR_STAT
suffix:semicolon
id|cqreek_irq_data
(braket
l_int|10
)braket
dot
id|bit
op_assign
(paren
l_int|1
op_lshift
l_int|10
)paren
suffix:semicolon
multiline_comment|/* XXX: Err... we may need demultiplexer for ISA irq... */
id|irq_desc
(braket
l_int|10
)braket
dot
id|handler
op_assign
op_amp
id|cqreek_irq_type
suffix:semicolon
id|irq_desc
(braket
l_int|10
)braket
dot
id|status
op_assign
id|IRQ_DISABLED
suffix:semicolon
id|irq_desc
(braket
l_int|10
)braket
dot
id|action
op_assign
l_int|0
suffix:semicolon
id|irq_desc
(braket
l_int|10
)braket
dot
id|depth
op_assign
l_int|1
suffix:semicolon
id|disable_cqreek_irq
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
)brace
eof
