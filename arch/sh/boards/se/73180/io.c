multiline_comment|/*&n; * arch/sh/boards/se/73180/io.c&n; *&n; * Copyright (C) 2003 YOSHII Takashi &lt;yoshii-takashi@hitachi-ul.co.jp&gt;&n; * Based on arch/sh/boards/se/7300/io.c&n; *&n; * I/O routine for SH-Mobile3 73180 SolutionEngine.&n; *&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;asm/mach/se73180.h&gt;
macro_line|#include &lt;asm/io.h&gt;
DECL|macro|badio
mdefine_line|#define badio(fn, a) panic(&quot;bad i/o operation %s for %08lx.&quot;, #fn, a)
DECL|struct|iop
r_struct
id|iop
(brace
DECL|member|start
DECL|member|end
r_int
r_int
id|start
comma
id|end
suffix:semicolon
DECL|member|base
r_int
r_int
id|base
suffix:semicolon
DECL|member|check
r_struct
id|iop
op_star
(paren
op_star
id|check
)paren
(paren
r_struct
id|iop
op_star
id|p
comma
r_int
r_int
id|port
)paren
suffix:semicolon
DECL|member|inb
r_int
r_char
(paren
op_star
id|inb
)paren
(paren
r_struct
id|iop
op_star
id|p
comma
r_int
r_int
id|port
)paren
suffix:semicolon
DECL|member|inw
r_int
r_int
(paren
op_star
id|inw
)paren
(paren
r_struct
id|iop
op_star
id|p
comma
r_int
r_int
id|port
)paren
suffix:semicolon
DECL|member|outb
r_void
(paren
op_star
id|outb
)paren
(paren
r_struct
id|iop
op_star
id|p
comma
r_int
r_char
id|value
comma
r_int
r_int
id|port
)paren
suffix:semicolon
DECL|member|outw
r_void
(paren
op_star
id|outw
)paren
(paren
r_struct
id|iop
op_star
id|p
comma
r_int
r_int
id|value
comma
r_int
r_int
id|port
)paren
suffix:semicolon
)brace
suffix:semicolon
r_struct
id|iop
op_star
DECL|function|simple_check
id|simple_check
c_func
(paren
r_struct
id|iop
op_star
id|p
comma
r_int
r_int
id|port
)paren
(brace
r_if
c_cond
(paren
(paren
id|p-&gt;start
op_le
id|port
)paren
op_logical_and
(paren
id|port
op_le
id|p-&gt;end
)paren
)paren
r_return
id|p
suffix:semicolon
r_else
id|badio
c_func
(paren
id|check
comma
id|port
)paren
suffix:semicolon
)brace
r_struct
id|iop
op_star
DECL|function|ide_check
id|ide_check
c_func
(paren
r_struct
id|iop
op_star
id|p
comma
r_int
r_int
id|port
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
l_int|0x1f0
op_le
id|port
)paren
op_logical_and
(paren
id|port
op_le
l_int|0x1f7
)paren
)paren
op_logical_or
(paren
id|port
op_eq
l_int|0x3f7
)paren
)paren
r_return
id|p
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_int
r_char
DECL|function|simple_inb
id|simple_inb
c_func
(paren
r_struct
id|iop
op_star
id|p
comma
r_int
r_int
id|port
)paren
(brace
r_return
op_star
(paren
r_int
r_char
op_star
)paren
(paren
id|p-&gt;base
op_plus
id|port
)paren
suffix:semicolon
)brace
r_int
r_int
DECL|function|simple_inw
id|simple_inw
c_func
(paren
r_struct
id|iop
op_star
id|p
comma
r_int
r_int
id|port
)paren
(brace
r_return
op_star
(paren
r_int
r_int
op_star
)paren
(paren
id|p-&gt;base
op_plus
id|port
)paren
suffix:semicolon
)brace
r_void
DECL|function|simple_outb
id|simple_outb
c_func
(paren
r_struct
id|iop
op_star
id|p
comma
r_int
r_char
id|value
comma
r_int
r_int
id|port
)paren
(brace
op_star
(paren
r_int
r_char
op_star
)paren
(paren
id|p-&gt;base
op_plus
id|port
)paren
op_assign
id|value
suffix:semicolon
)brace
r_void
DECL|function|simple_outw
id|simple_outw
c_func
(paren
r_struct
id|iop
op_star
id|p
comma
r_int
r_int
id|value
comma
r_int
r_int
id|port
)paren
(brace
op_star
(paren
r_int
r_int
op_star
)paren
(paren
id|p-&gt;base
op_plus
id|port
)paren
op_assign
id|value
suffix:semicolon
)brace
r_int
r_char
DECL|function|pcc_inb
id|pcc_inb
c_func
(paren
r_struct
id|iop
op_star
id|p
comma
r_int
r_int
id|port
)paren
(brace
r_int
r_int
id|addr
op_assign
id|p-&gt;base
op_plus
id|port
op_plus
l_int|0x40000
suffix:semicolon
r_int
r_int
id|v
suffix:semicolon
r_if
c_cond
(paren
id|port
op_amp
l_int|1
)paren
id|addr
op_add_assign
l_int|0x00400000
suffix:semicolon
id|v
op_assign
op_star
(paren
r_volatile
r_int
r_char
op_star
)paren
id|addr
suffix:semicolon
r_return
id|v
suffix:semicolon
)brace
r_void
DECL|function|pcc_outb
id|pcc_outb
c_func
(paren
r_struct
id|iop
op_star
id|p
comma
r_int
r_char
id|value
comma
r_int
r_int
id|port
)paren
(brace
r_int
r_int
id|addr
op_assign
id|p-&gt;base
op_plus
id|port
op_plus
l_int|0x40000
suffix:semicolon
r_if
c_cond
(paren
id|port
op_amp
l_int|1
)paren
id|addr
op_add_assign
l_int|0x00400000
suffix:semicolon
op_star
(paren
r_volatile
r_int
r_char
op_star
)paren
id|addr
op_assign
id|value
suffix:semicolon
)brace
r_int
r_char
DECL|function|bad_inb
id|bad_inb
c_func
(paren
r_struct
id|iop
op_star
id|p
comma
r_int
r_int
id|port
)paren
(brace
id|badio
c_func
(paren
id|inb
comma
id|port
)paren
suffix:semicolon
)brace
r_void
DECL|function|bad_outb
id|bad_outb
c_func
(paren
r_struct
id|iop
op_star
id|p
comma
r_int
r_char
id|value
comma
r_int
r_int
id|port
)paren
(brace
id|badio
c_func
(paren
id|inw
comma
id|port
)paren
suffix:semicolon
)brace
multiline_comment|/* MSTLANEX01 LAN at 0xb400:0000 */
DECL|variable|laniop
r_static
r_struct
id|iop
id|laniop
op_assign
(brace
dot
id|start
op_assign
l_int|0x300
comma
dot
id|end
op_assign
l_int|0x30f
comma
dot
id|base
op_assign
l_int|0xb4000000
comma
dot
id|check
op_assign
id|simple_check
comma
dot
id|inb
op_assign
id|simple_inb
comma
dot
id|inw
op_assign
id|simple_inw
comma
dot
id|outb
op_assign
id|simple_outb
comma
dot
id|outw
op_assign
id|simple_outw
comma
)brace
suffix:semicolon
multiline_comment|/* NE2000 pc card NIC */
DECL|variable|neiop
r_static
r_struct
id|iop
id|neiop
op_assign
(brace
dot
id|start
op_assign
l_int|0x280
comma
dot
id|end
op_assign
l_int|0x29f
comma
dot
id|base
op_assign
l_int|0xb0600000
op_plus
l_int|0x80
comma
multiline_comment|/* soft 0x280 -&gt; hard 0x300 */
dot
id|check
op_assign
id|simple_check
comma
dot
id|inb
op_assign
id|pcc_inb
comma
dot
id|inw
op_assign
id|simple_inw
comma
dot
id|outb
op_assign
id|pcc_outb
comma
dot
id|outw
op_assign
id|simple_outw
comma
)brace
suffix:semicolon
multiline_comment|/* CF in CF slot */
DECL|variable|cfiop
r_static
r_struct
id|iop
id|cfiop
op_assign
(brace
dot
id|base
op_assign
l_int|0xb0600000
comma
dot
id|check
op_assign
id|ide_check
comma
dot
id|inb
op_assign
id|pcc_inb
comma
dot
id|inw
op_assign
id|simple_inw
comma
dot
id|outb
op_assign
id|pcc_outb
comma
dot
id|outw
op_assign
id|simple_outw
comma
)brace
suffix:semicolon
r_static
id|__inline__
r_struct
id|iop
op_star
DECL|function|port2iop
id|port2iop
c_func
(paren
r_int
r_int
id|port
)paren
(brace
r_if
c_cond
(paren
l_int|0
)paren
suffix:semicolon
macro_line|#if defined(CONFIG_SMC91111)
r_else
r_if
c_cond
(paren
id|laniop
dot
id|check
c_func
(paren
op_amp
id|laniop
comma
id|port
)paren
)paren
r_return
op_amp
id|laniop
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_NE2000)
r_else
r_if
c_cond
(paren
id|neiop
dot
id|check
c_func
(paren
op_amp
id|neiop
comma
id|port
)paren
)paren
r_return
op_amp
id|neiop
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_IDE)
r_else
r_if
c_cond
(paren
id|cfiop
dot
id|check
c_func
(paren
op_amp
id|cfiop
comma
id|port
)paren
)paren
r_return
op_amp
id|cfiop
suffix:semicolon
macro_line|#endif
r_else
r_return
op_amp
id|neiop
suffix:semicolon
multiline_comment|/* fallback */
)brace
r_static
r_inline
r_void
DECL|function|delay
id|delay
c_func
(paren
r_void
)paren
(brace
id|ctrl_inw
c_func
(paren
l_int|0xac000000
)paren
suffix:semicolon
id|ctrl_inw
c_func
(paren
l_int|0xac000000
)paren
suffix:semicolon
)brace
r_int
r_char
DECL|function|sh73180se_inb
id|sh73180se_inb
c_func
(paren
r_int
r_int
id|port
)paren
(brace
r_struct
id|iop
op_star
id|p
op_assign
id|port2iop
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
(paren
id|p-&gt;inb
)paren
(paren
id|p
comma
id|port
)paren
suffix:semicolon
)brace
r_int
r_char
DECL|function|sh73180se_inb_p
id|sh73180se_inb_p
c_func
(paren
r_int
r_int
id|port
)paren
(brace
r_int
r_char
id|v
op_assign
id|sh73180se_inb
c_func
(paren
id|port
)paren
suffix:semicolon
id|delay
c_func
(paren
)paren
suffix:semicolon
r_return
id|v
suffix:semicolon
)brace
r_int
r_int
DECL|function|sh73180se_inw
id|sh73180se_inw
c_func
(paren
r_int
r_int
id|port
)paren
(brace
r_struct
id|iop
op_star
id|p
op_assign
id|port2iop
c_func
(paren
id|port
)paren
suffix:semicolon
r_return
(paren
id|p-&gt;inw
)paren
(paren
id|p
comma
id|port
)paren
suffix:semicolon
)brace
r_int
r_int
DECL|function|sh73180se_inl
id|sh73180se_inl
c_func
(paren
r_int
r_int
id|port
)paren
(brace
id|badio
c_func
(paren
id|inl
comma
id|port
)paren
suffix:semicolon
)brace
r_void
DECL|function|sh73180se_outb
id|sh73180se_outb
c_func
(paren
r_int
r_char
id|value
comma
r_int
r_int
id|port
)paren
(brace
r_struct
id|iop
op_star
id|p
op_assign
id|port2iop
c_func
(paren
id|port
)paren
suffix:semicolon
(paren
id|p-&gt;outb
)paren
(paren
id|p
comma
id|value
comma
id|port
)paren
suffix:semicolon
)brace
r_void
DECL|function|sh73180se_outb_p
id|sh73180se_outb_p
c_func
(paren
r_int
r_char
id|value
comma
r_int
r_int
id|port
)paren
(brace
id|sh73180se_outb
c_func
(paren
id|value
comma
id|port
)paren
suffix:semicolon
id|delay
c_func
(paren
)paren
suffix:semicolon
)brace
r_void
DECL|function|sh73180se_outw
id|sh73180se_outw
c_func
(paren
r_int
r_int
id|value
comma
r_int
r_int
id|port
)paren
(brace
r_struct
id|iop
op_star
id|p
op_assign
id|port2iop
c_func
(paren
id|port
)paren
suffix:semicolon
(paren
id|p-&gt;outw
)paren
(paren
id|p
comma
id|value
comma
id|port
)paren
suffix:semicolon
)brace
r_void
DECL|function|sh73180se_outl
id|sh73180se_outl
c_func
(paren
r_int
r_int
id|value
comma
r_int
r_int
id|port
)paren
(brace
id|badio
c_func
(paren
id|outl
comma
id|port
)paren
suffix:semicolon
)brace
r_void
DECL|function|sh73180se_insb
id|sh73180se_insb
c_func
(paren
r_int
r_int
id|port
comma
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
r_int
r_char
op_star
id|a
op_assign
id|addr
suffix:semicolon
r_struct
id|iop
op_star
id|p
op_assign
id|port2iop
c_func
(paren
id|port
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
op_star
id|a
op_increment
op_assign
(paren
id|p-&gt;inb
)paren
(paren
id|p
comma
id|port
)paren
suffix:semicolon
)brace
r_void
DECL|function|sh73180se_insw
id|sh73180se_insw
c_func
(paren
r_int
r_int
id|port
comma
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
r_int
r_int
op_star
id|a
op_assign
id|addr
suffix:semicolon
r_struct
id|iop
op_star
id|p
op_assign
id|port2iop
c_func
(paren
id|port
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
op_star
id|a
op_increment
op_assign
(paren
id|p-&gt;inw
)paren
(paren
id|p
comma
id|port
)paren
suffix:semicolon
)brace
r_void
DECL|function|sh73180se_insl
id|sh73180se_insl
c_func
(paren
r_int
r_int
id|port
comma
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
id|badio
c_func
(paren
id|insl
comma
id|port
)paren
suffix:semicolon
)brace
r_void
DECL|function|sh73180se_outsb
id|sh73180se_outsb
c_func
(paren
r_int
r_int
id|port
comma
r_const
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
r_int
r_char
op_star
id|a
op_assign
(paren
r_int
r_char
op_star
)paren
id|addr
suffix:semicolon
r_struct
id|iop
op_star
id|p
op_assign
id|port2iop
c_func
(paren
id|port
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(paren
id|p-&gt;outb
)paren
(paren
id|p
comma
op_star
id|a
op_increment
comma
id|port
)paren
suffix:semicolon
)brace
r_void
DECL|function|sh73180se_outsw
id|sh73180se_outsw
c_func
(paren
r_int
r_int
id|port
comma
r_const
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
r_int
r_int
op_star
id|a
op_assign
(paren
r_int
r_int
op_star
)paren
id|addr
suffix:semicolon
r_struct
id|iop
op_star
id|p
op_assign
id|port2iop
c_func
(paren
id|port
)paren
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(paren
id|p-&gt;outw
)paren
(paren
id|p
comma
op_star
id|a
op_increment
comma
id|port
)paren
suffix:semicolon
)brace
r_void
DECL|function|sh73180se_outsl
id|sh73180se_outsl
c_func
(paren
r_int
r_int
id|port
comma
r_const
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
id|badio
c_func
(paren
id|outsw
comma
id|port
)paren
suffix:semicolon
)brace
eof
