multiline_comment|/*&n; * arch/sh/boards/renesas/edosk7705/io.c&n; *&n; * Copyright (C) 2001  Ian da Silva, Jeremy Siegel&n; * Based largely on io_se.c.&n; *&n; * I/O routines for Hitachi EDOSK7705 board.&n; *&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/edosk7705/io.h&gt;
macro_line|#include &lt;asm/addrspace.h&gt;
DECL|macro|SMC_IOADDR
mdefine_line|#define SMC_IOADDR&t;0xA2000000
DECL|macro|maybebadio
mdefine_line|#define maybebadio(name,port) &bslash;&n;  printk(&quot;bad PC-like io %s for port 0x%lx at 0x%08x&bslash;n&quot;, &bslash;&n;&t; #name, (port), (__u32) __builtin_return_address(0))
multiline_comment|/* Map the Ethernet addresses as if it is at 0x300 - 0x320 */
DECL|function|sh_edosk7705_isa_port2addr
r_int
r_int
id|sh_edosk7705_isa_port2addr
c_func
(paren
r_int
r_int
id|port
)paren
(brace
r_if
c_cond
(paren
id|port
op_ge
l_int|0x300
op_logical_and
id|port
OL
l_int|0x320
)paren
(brace
multiline_comment|/* SMC91C96 registers are 4 byte aligned rather than the&n;&t;   * usual 2 byte!&n;&t;   */
r_return
id|SMC_IOADDR
op_plus
(paren
(paren
id|port
op_minus
l_int|0x300
)paren
op_star
l_int|2
)paren
suffix:semicolon
)brace
id|maybebadio
c_func
(paren
id|sh_edosk7705_isa_port2addr
comma
id|port
)paren
suffix:semicolon
r_return
id|port
suffix:semicolon
)brace
multiline_comment|/* Trying to read / write bytes on odd-byte boundaries to the Ethernet&n; * registers causes problems. So we bit-shift the value and read / write&n; * in 2 byte chunks. Setting the low byte to 0 does not cause problems&n; * now as odd byte writes are only made on the bit mask / interrupt&n; * register. This may not be the case in future Mar-2003 SJD&n; */
DECL|function|sh_edosk7705_inb
r_int
r_char
id|sh_edosk7705_inb
c_func
(paren
r_int
r_int
id|port
)paren
(brace
r_if
c_cond
(paren
id|port
op_ge
l_int|0x300
op_logical_and
id|port
OL
l_int|0x320
op_logical_and
id|port
op_amp
l_int|0x01
)paren
(brace
r_return
(paren
r_volatile
r_int
r_char
)paren
(paren
id|generic_inw
c_func
(paren
id|port
op_minus
l_int|1
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
)brace
r_return
op_star
(paren
r_volatile
r_int
r_char
op_star
)paren
id|sh_edosk7705_isa_port2addr
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
DECL|function|sh_edosk7705_inl
r_int
r_int
id|sh_edosk7705_inl
c_func
(paren
r_int
r_int
id|port
)paren
(brace
r_return
op_star
(paren
r_volatile
r_int
r_int
op_star
)paren
id|port
suffix:semicolon
)brace
DECL|function|sh_edosk7705_outb
r_void
id|sh_edosk7705_outb
c_func
(paren
r_int
r_char
id|value
comma
r_int
r_int
id|port
)paren
(brace
r_if
c_cond
(paren
id|port
op_ge
l_int|0x300
op_logical_and
id|port
OL
l_int|0x320
op_logical_and
id|port
op_amp
l_int|0x01
)paren
(brace
id|generic_outw
c_func
(paren
(paren
(paren
r_int
r_int
)paren
id|value
op_lshift
l_int|8
)paren
comma
id|port
op_minus
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
op_star
(paren
r_volatile
r_int
r_char
op_star
)paren
id|sh_edosk7705_isa_port2addr
c_func
(paren
id|port
)paren
op_assign
id|value
suffix:semicolon
)brace
DECL|function|sh_edosk7705_outl
r_void
id|sh_edosk7705_outl
c_func
(paren
r_int
r_int
id|value
comma
r_int
r_int
id|port
)paren
(brace
op_star
(paren
r_volatile
r_int
r_int
op_star
)paren
id|port
op_assign
id|value
suffix:semicolon
)brace
DECL|function|sh_edosk7705_insb
r_void
id|sh_edosk7705_insb
c_func
(paren
r_int
r_int
id|port
comma
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
r_int
r_char
op_star
id|p
op_assign
id|addr
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
op_star
id|p
op_increment
op_assign
id|sh_edosk7705_inb
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
DECL|function|sh_edosk7705_insl
r_void
id|sh_edosk7705_insl
c_func
(paren
r_int
r_int
id|port
comma
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
id|addr
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
op_star
id|p
op_increment
op_assign
op_star
(paren
r_volatile
r_int
r_int
op_star
)paren
id|port
suffix:semicolon
)brace
DECL|function|sh_edosk7705_outsb
r_void
id|sh_edosk7705_outsb
c_func
(paren
r_int
r_int
id|port
comma
r_const
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
r_int
r_char
op_star
id|p
op_assign
(paren
r_int
r_char
op_star
)paren
id|addr
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
id|sh_edosk7705_outb
c_func
(paren
op_star
id|p
op_increment
comma
id|port
)paren
suffix:semicolon
)brace
DECL|function|sh_edosk7705_outsl
r_void
id|sh_edosk7705_outsl
c_func
(paren
r_int
r_int
id|port
comma
r_const
r_void
op_star
id|addr
comma
r_int
r_int
id|count
)paren
(brace
r_int
r_int
op_star
id|p
op_assign
(paren
r_int
r_int
op_star
)paren
id|addr
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
id|sh_edosk7705_outl
c_func
(paren
op_star
id|p
op_increment
comma
id|port
)paren
suffix:semicolon
)brace
eof
