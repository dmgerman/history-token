macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/fs.h&gt; 
macro_line|#include &lt;linux/file.h&gt; 
macro_line|#include &lt;linux/sem.h&gt;
macro_line|#include &lt;linux/msg.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/shm.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/ipc.h&gt;
macro_line|#include &lt;linux/compat.h&gt;
macro_line|#include &lt;asm/mman.h&gt;
macro_line|#include &lt;asm/types.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/semaphore.h&gt;
macro_line|#include &lt;asm/ipc.h&gt;
macro_line|#include &lt;asm/ia32.h&gt;
multiline_comment|/*&n; * sys32_ipc() is the de-multiplexer for the SysV IPC calls in 32bit emulation..&n; *&n; * This is really horribly ugly.&n; */
DECL|struct|msgbuf32
r_struct
id|msgbuf32
(brace
DECL|member|mtype
id|s32
id|mtype
suffix:semicolon
DECL|member|mtext
r_char
id|mtext
(braket
l_int|1
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|ipc_perm32
r_struct
id|ipc_perm32
(brace
DECL|member|key
r_int
id|key
suffix:semicolon
DECL|member|uid
id|compat_uid_t
id|uid
suffix:semicolon
DECL|member|gid
id|compat_gid_t
id|gid
suffix:semicolon
DECL|member|cuid
id|compat_uid_t
id|cuid
suffix:semicolon
DECL|member|cgid
id|compat_gid_t
id|cgid
suffix:semicolon
DECL|member|mode
r_int
r_int
id|mode
suffix:semicolon
DECL|member|seq
r_int
r_int
id|seq
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|ipc64_perm32
r_struct
id|ipc64_perm32
(brace
DECL|member|key
r_int
id|key
suffix:semicolon
DECL|member|uid
id|compat_uid32_t
id|uid
suffix:semicolon
DECL|member|gid
id|compat_gid32_t
id|gid
suffix:semicolon
DECL|member|cuid
id|compat_uid32_t
id|cuid
suffix:semicolon
DECL|member|cgid
id|compat_gid32_t
id|cgid
suffix:semicolon
DECL|member|mode
r_int
r_int
id|mode
suffix:semicolon
DECL|member|__pad1
r_int
r_int
id|__pad1
suffix:semicolon
DECL|member|seq
r_int
r_int
id|seq
suffix:semicolon
DECL|member|__pad2
r_int
r_int
id|__pad2
suffix:semicolon
DECL|member|unused1
r_int
r_int
id|unused1
suffix:semicolon
DECL|member|unused2
r_int
r_int
id|unused2
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|semid_ds32
r_struct
id|semid_ds32
(brace
DECL|member|sem_perm
r_struct
id|ipc_perm32
id|sem_perm
suffix:semicolon
multiline_comment|/* permissions .. see ipc.h */
DECL|member|sem_otime
id|compat_time_t
id|sem_otime
suffix:semicolon
multiline_comment|/* last semop time */
DECL|member|sem_ctime
id|compat_time_t
id|sem_ctime
suffix:semicolon
multiline_comment|/* last change time */
DECL|member|sem_base
id|u32
id|sem_base
suffix:semicolon
multiline_comment|/* ptr to first semaphore in array */
DECL|member|sem_pending
id|u32
id|sem_pending
suffix:semicolon
multiline_comment|/* pending operations to be processed */
DECL|member|sem_pending_last
id|u32
id|sem_pending_last
suffix:semicolon
multiline_comment|/* last pending operation */
DECL|member|undo
id|u32
id|undo
suffix:semicolon
multiline_comment|/* undo requests on this array */
DECL|member|sem_nsems
r_int
r_int
id|sem_nsems
suffix:semicolon
multiline_comment|/* no. of semaphores in array */
)brace
suffix:semicolon
DECL|struct|semid64_ds32
r_struct
id|semid64_ds32
(brace
DECL|member|sem_perm
r_struct
id|ipc64_perm32
id|sem_perm
suffix:semicolon
DECL|member|sem_otime
id|compat_time_t
id|sem_otime
suffix:semicolon
DECL|member|__unused1
r_int
r_int
id|__unused1
suffix:semicolon
DECL|member|sem_ctime
id|compat_time_t
id|sem_ctime
suffix:semicolon
DECL|member|__unused2
r_int
r_int
id|__unused2
suffix:semicolon
DECL|member|sem_nsems
r_int
r_int
id|sem_nsems
suffix:semicolon
DECL|member|__unused3
r_int
r_int
id|__unused3
suffix:semicolon
DECL|member|__unused4
r_int
r_int
id|__unused4
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|msqid_ds32
r_struct
id|msqid_ds32
(brace
DECL|member|msg_perm
r_struct
id|ipc_perm32
id|msg_perm
suffix:semicolon
DECL|member|msg_first
id|u32
id|msg_first
suffix:semicolon
DECL|member|msg_last
id|u32
id|msg_last
suffix:semicolon
DECL|member|msg_stime
id|compat_time_t
id|msg_stime
suffix:semicolon
DECL|member|msg_rtime
id|compat_time_t
id|msg_rtime
suffix:semicolon
DECL|member|msg_ctime
id|compat_time_t
id|msg_ctime
suffix:semicolon
DECL|member|wwait
id|u32
id|wwait
suffix:semicolon
DECL|member|rwait
id|u32
id|rwait
suffix:semicolon
DECL|member|msg_cbytes
r_int
r_int
id|msg_cbytes
suffix:semicolon
DECL|member|msg_qnum
r_int
r_int
id|msg_qnum
suffix:semicolon
DECL|member|msg_qbytes
r_int
r_int
id|msg_qbytes
suffix:semicolon
DECL|member|msg_lspid
id|compat_ipc_pid_t
id|msg_lspid
suffix:semicolon
DECL|member|msg_lrpid
id|compat_ipc_pid_t
id|msg_lrpid
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|msqid64_ds32
r_struct
id|msqid64_ds32
(brace
DECL|member|msg_perm
r_struct
id|ipc64_perm32
id|msg_perm
suffix:semicolon
DECL|member|msg_stime
id|compat_time_t
id|msg_stime
suffix:semicolon
DECL|member|__unused1
r_int
r_int
id|__unused1
suffix:semicolon
DECL|member|msg_rtime
id|compat_time_t
id|msg_rtime
suffix:semicolon
DECL|member|__unused2
r_int
r_int
id|__unused2
suffix:semicolon
DECL|member|msg_ctime
id|compat_time_t
id|msg_ctime
suffix:semicolon
DECL|member|__unused3
r_int
r_int
id|__unused3
suffix:semicolon
DECL|member|msg_cbytes
r_int
r_int
id|msg_cbytes
suffix:semicolon
DECL|member|msg_qnum
r_int
r_int
id|msg_qnum
suffix:semicolon
DECL|member|msg_qbytes
r_int
r_int
id|msg_qbytes
suffix:semicolon
DECL|member|msg_lspid
id|compat_pid_t
id|msg_lspid
suffix:semicolon
DECL|member|msg_lrpid
id|compat_pid_t
id|msg_lrpid
suffix:semicolon
DECL|member|__unused4
r_int
r_int
id|__unused4
suffix:semicolon
DECL|member|__unused5
r_int
r_int
id|__unused5
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|shmid_ds32
r_struct
id|shmid_ds32
(brace
DECL|member|shm_perm
r_struct
id|ipc_perm32
id|shm_perm
suffix:semicolon
DECL|member|shm_segsz
r_int
id|shm_segsz
suffix:semicolon
DECL|member|shm_atime
id|compat_time_t
id|shm_atime
suffix:semicolon
DECL|member|shm_dtime
id|compat_time_t
id|shm_dtime
suffix:semicolon
DECL|member|shm_ctime
id|compat_time_t
id|shm_ctime
suffix:semicolon
DECL|member|shm_cpid
id|compat_ipc_pid_t
id|shm_cpid
suffix:semicolon
DECL|member|shm_lpid
id|compat_ipc_pid_t
id|shm_lpid
suffix:semicolon
DECL|member|shm_nattch
r_int
r_int
id|shm_nattch
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|shmid64_ds32
r_struct
id|shmid64_ds32
(brace
DECL|member|shm_perm
r_struct
id|ipc64_perm32
id|shm_perm
suffix:semicolon
DECL|member|shm_segsz
id|compat_size_t
id|shm_segsz
suffix:semicolon
DECL|member|shm_atime
id|compat_time_t
id|shm_atime
suffix:semicolon
DECL|member|__unused1
r_int
r_int
id|__unused1
suffix:semicolon
DECL|member|shm_dtime
id|compat_time_t
id|shm_dtime
suffix:semicolon
DECL|member|__unused2
r_int
r_int
id|__unused2
suffix:semicolon
DECL|member|shm_ctime
id|compat_time_t
id|shm_ctime
suffix:semicolon
DECL|member|__unused3
r_int
r_int
id|__unused3
suffix:semicolon
DECL|member|shm_cpid
id|compat_pid_t
id|shm_cpid
suffix:semicolon
DECL|member|shm_lpid
id|compat_pid_t
id|shm_lpid
suffix:semicolon
DECL|member|shm_nattch
r_int
r_int
id|shm_nattch
suffix:semicolon
DECL|member|__unused4
r_int
r_int
id|__unused4
suffix:semicolon
DECL|member|__unused5
r_int
r_int
id|__unused5
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|shminfo64_32
r_struct
id|shminfo64_32
(brace
DECL|member|shmmax
r_int
r_int
id|shmmax
suffix:semicolon
DECL|member|shmmin
r_int
r_int
id|shmmin
suffix:semicolon
DECL|member|shmmni
r_int
r_int
id|shmmni
suffix:semicolon
DECL|member|shmseg
r_int
r_int
id|shmseg
suffix:semicolon
DECL|member|shmall
r_int
r_int
id|shmall
suffix:semicolon
DECL|member|__unused1
r_int
r_int
id|__unused1
suffix:semicolon
DECL|member|__unused2
r_int
r_int
id|__unused2
suffix:semicolon
DECL|member|__unused3
r_int
r_int
id|__unused3
suffix:semicolon
DECL|member|__unused4
r_int
r_int
id|__unused4
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|shm_info32
r_struct
id|shm_info32
(brace
DECL|member|used_ids
r_int
id|used_ids
suffix:semicolon
DECL|member|shm_tot
DECL|member|shm_rss
DECL|member|shm_swp
id|u32
id|shm_tot
comma
id|shm_rss
comma
id|shm_swp
suffix:semicolon
DECL|member|swap_attempts
DECL|member|swap_successes
id|u32
id|swap_attempts
comma
id|swap_successes
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|ipc_kludge
r_struct
id|ipc_kludge
(brace
DECL|member|msgp
id|u32
id|msgp
suffix:semicolon
DECL|member|msgtyp
id|s32
id|msgtyp
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|A
mdefine_line|#define A(__x)&t;&t;((unsigned long)(__x))
DECL|macro|AA
mdefine_line|#define AA(__x)&t;&t;((unsigned long)(__x))
DECL|macro|SEMOP
mdefine_line|#define SEMOP&t;&t; 1
DECL|macro|SEMGET
mdefine_line|#define SEMGET&t;&t; 2
DECL|macro|SEMCTL
mdefine_line|#define SEMCTL&t;&t; 3
DECL|macro|TIMEDSEMOP
mdefine_line|#define TIMEDSEMOP&t; 4
DECL|macro|MSGSND
mdefine_line|#define MSGSND&t;&t;11
DECL|macro|MSGRCV
mdefine_line|#define MSGRCV&t;&t;12
DECL|macro|MSGGET
mdefine_line|#define MSGGET&t;&t;13
DECL|macro|MSGCTL
mdefine_line|#define MSGCTL&t;&t;14
DECL|macro|SHMAT
mdefine_line|#define SHMAT&t;&t;21
DECL|macro|SHMDT
mdefine_line|#define SHMDT&t;&t;22
DECL|macro|SHMGET
mdefine_line|#define SHMGET&t;&t;23
DECL|macro|SHMCTL
mdefine_line|#define SHMCTL&t;&t;24
DECL|macro|IPCOP_MASK
mdefine_line|#define IPCOP_MASK(__x)&t;(1UL &lt;&lt; (__x))
r_static
r_int
DECL|function|ipc_parse_version32
id|ipc_parse_version32
(paren
r_int
op_star
id|cmd
)paren
(brace
r_if
c_cond
(paren
op_star
id|cmd
op_amp
id|IPC_64
)paren
(brace
op_star
id|cmd
op_xor_assign
id|IPC_64
suffix:semicolon
r_return
id|IPC_64
suffix:semicolon
)brace
r_else
(brace
r_return
id|IPC_OLD
suffix:semicolon
)brace
)brace
DECL|function|put_semid
r_static
r_int
id|put_semid
c_func
(paren
r_void
op_star
id|user_semid
comma
r_struct
id|semid64_ds
op_star
id|s
comma
r_int
id|version
)paren
(brace
r_int
id|err2
suffix:semicolon
r_switch
c_cond
(paren
id|version
)paren
(brace
r_case
id|IPC_64
suffix:colon
(brace
r_struct
id|semid64_ds32
op_star
id|usp64
op_assign
(paren
r_struct
id|semid64_ds32
op_star
)paren
id|user_semid
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|usp64
comma
r_sizeof
(paren
op_star
id|usp64
)paren
)paren
)paren
(brace
id|err2
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err2
op_assign
id|__put_user
c_func
(paren
id|s-&gt;sem_perm.key
comma
op_amp
id|usp64-&gt;sem_perm.key
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s-&gt;sem_perm.uid
comma
op_amp
id|usp64-&gt;sem_perm.uid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s-&gt;sem_perm.gid
comma
op_amp
id|usp64-&gt;sem_perm.gid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s-&gt;sem_perm.cuid
comma
op_amp
id|usp64-&gt;sem_perm.cuid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s-&gt;sem_perm.cgid
comma
op_amp
id|usp64-&gt;sem_perm.cgid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s-&gt;sem_perm.mode
comma
op_amp
id|usp64-&gt;sem_perm.mode
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s-&gt;sem_perm.seq
comma
op_amp
id|usp64-&gt;sem_perm.seq
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s-&gt;sem_otime
comma
op_amp
id|usp64-&gt;sem_otime
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s-&gt;sem_ctime
comma
op_amp
id|usp64-&gt;sem_ctime
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s-&gt;sem_nsems
comma
op_amp
id|usp64-&gt;sem_nsems
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_default
suffix:colon
(brace
)brace
(brace
r_struct
id|semid_ds32
op_star
id|usp32
op_assign
(paren
r_struct
id|semid_ds32
op_star
)paren
id|user_semid
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|usp32
comma
r_sizeof
(paren
op_star
id|usp32
)paren
)paren
)paren
(brace
id|err2
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err2
op_assign
id|__put_user
c_func
(paren
id|s-&gt;sem_perm.key
comma
op_amp
id|usp32-&gt;sem_perm.key
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s-&gt;sem_perm.uid
comma
op_amp
id|usp32-&gt;sem_perm.uid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s-&gt;sem_perm.gid
comma
op_amp
id|usp32-&gt;sem_perm.gid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s-&gt;sem_perm.cuid
comma
op_amp
id|usp32-&gt;sem_perm.cuid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s-&gt;sem_perm.cgid
comma
op_amp
id|usp32-&gt;sem_perm.cgid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s-&gt;sem_perm.mode
comma
op_amp
id|usp32-&gt;sem_perm.mode
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s-&gt;sem_perm.seq
comma
op_amp
id|usp32-&gt;sem_perm.seq
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s-&gt;sem_otime
comma
op_amp
id|usp32-&gt;sem_otime
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s-&gt;sem_ctime
comma
op_amp
id|usp32-&gt;sem_ctime
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s-&gt;sem_nsems
comma
op_amp
id|usp32-&gt;sem_nsems
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
id|err2
suffix:semicolon
)brace
r_static
r_int
DECL|function|semctl32
id|semctl32
(paren
r_int
id|first
comma
r_int
id|second
comma
r_int
id|third
comma
r_void
op_star
id|uptr
)paren
(brace
r_union
id|semun
id|fourth
suffix:semicolon
id|u32
id|pad
suffix:semicolon
r_int
id|err
suffix:semicolon
r_struct
id|semid64_ds
id|s
suffix:semicolon
id|mm_segment_t
id|old_fs
suffix:semicolon
r_int
id|version
op_assign
id|ipc_parse_version32
c_func
(paren
op_amp
id|third
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|uptr
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|pad
comma
(paren
id|u32
op_star
)paren
id|uptr
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|third
op_eq
id|SETVAL
)paren
id|fourth.val
op_assign
(paren
r_int
)paren
id|pad
suffix:semicolon
r_else
id|fourth.__pad
op_assign
(paren
r_void
op_star
)paren
id|A
c_func
(paren
id|pad
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|third
)paren
(brace
r_case
id|IPC_INFO
suffix:colon
r_case
id|IPC_RMID
suffix:colon
r_case
id|IPC_SET
suffix:colon
r_case
id|SEM_INFO
suffix:colon
r_case
id|GETVAL
suffix:colon
r_case
id|GETPID
suffix:colon
r_case
id|GETNCNT
suffix:colon
r_case
id|GETZCNT
suffix:colon
r_case
id|GETALL
suffix:colon
r_case
id|SETVAL
suffix:colon
r_case
id|SETALL
suffix:colon
id|err
op_assign
id|sys_semctl
c_func
(paren
id|first
comma
id|second
comma
id|third
comma
id|fourth
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPC_STAT
suffix:colon
r_case
id|SEM_STAT
suffix:colon
id|fourth.__pad
op_assign
op_amp
id|s
suffix:semicolon
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|err
op_assign
id|sys_semctl
c_func
(paren
id|first
comma
id|second
comma
id|third
comma
id|fourth
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
id|err
op_assign
id|put_semid
c_func
(paren
(paren
r_void
op_star
)paren
id|A
c_func
(paren
id|pad
)paren
comma
op_amp
id|s
comma
id|version
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|macro|MAXBUF
mdefine_line|#define MAXBUF (64*1024)
r_static
r_int
DECL|function|do_sys32_msgsnd
id|do_sys32_msgsnd
(paren
r_int
id|first
comma
r_int
id|second
comma
r_int
id|third
comma
r_void
op_star
id|uptr
)paren
(brace
r_struct
id|msgbuf
op_star
id|p
suffix:semicolon
r_struct
id|msgbuf32
op_star
id|up
op_assign
(paren
r_struct
id|msgbuf32
op_star
)paren
id|uptr
suffix:semicolon
id|mm_segment_t
id|old_fs
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|second
op_ge
id|MAXBUF
op_minus
r_sizeof
(paren
r_struct
id|msgbuf
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|p
op_assign
id|kmalloc
c_func
(paren
id|second
op_plus
r_sizeof
(paren
r_struct
id|msgbuf
)paren
comma
id|GFP_USER
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|err
op_assign
id|get_user
c_func
(paren
id|p-&gt;mtype
comma
op_amp
id|up-&gt;mtype
)paren
suffix:semicolon
id|err
op_or_assign
(paren
id|copy_from_user
c_func
(paren
id|p-&gt;mtext
comma
op_amp
id|up-&gt;mtext
comma
id|second
)paren
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_goto
id|out
suffix:semicolon
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|err
op_assign
id|sys_msgsnd
c_func
(paren
id|first
comma
id|p
comma
id|second
comma
id|third
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
id|out
suffix:colon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_static
r_int
DECL|function|do_sys32_msgrcv
id|do_sys32_msgrcv
(paren
r_int
id|first
comma
r_int
id|second
comma
r_int
id|msgtyp
comma
r_int
id|third
comma
r_int
id|version
comma
r_void
op_star
id|uptr
)paren
(brace
r_struct
id|msgbuf32
op_star
id|up
suffix:semicolon
r_struct
id|msgbuf
op_star
id|p
suffix:semicolon
id|mm_segment_t
id|old_fs
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|version
)paren
(brace
r_struct
id|ipc_kludge
op_star
id|uipck
op_assign
(paren
r_struct
id|ipc_kludge
op_star
)paren
id|uptr
suffix:semicolon
r_struct
id|ipc_kludge
id|ipck
suffix:semicolon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|uptr
)paren
r_goto
id|out
suffix:semicolon
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ipck
comma
id|uipck
comma
r_sizeof
(paren
r_struct
id|ipc_kludge
)paren
)paren
)paren
r_goto
id|out
suffix:semicolon
id|uptr
op_assign
(paren
r_void
op_star
)paren
id|A
c_func
(paren
id|ipck.msgp
)paren
suffix:semicolon
id|msgtyp
op_assign
id|ipck.msgtyp
suffix:semicolon
)brace
r_if
c_cond
(paren
id|second
op_ge
id|MAXBUF
op_minus
r_sizeof
(paren
r_struct
id|msgbuf
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
id|p
op_assign
id|kmalloc
c_func
(paren
id|second
op_plus
r_sizeof
(paren
r_struct
id|msgbuf
)paren
comma
id|GFP_USER
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_goto
id|out
suffix:semicolon
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|err
op_assign
id|sys_msgrcv
c_func
(paren
id|first
comma
id|p
comma
id|second
comma
id|msgtyp
comma
id|third
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_goto
id|free_then_out
suffix:semicolon
id|up
op_assign
(paren
r_struct
id|msgbuf32
op_star
)paren
id|uptr
suffix:semicolon
r_if
c_cond
(paren
id|put_user
c_func
(paren
id|p-&gt;mtype
comma
op_amp
id|up-&gt;mtype
)paren
op_logical_or
id|copy_to_user
c_func
(paren
op_amp
id|up-&gt;mtext
comma
id|p-&gt;mtext
comma
id|err
)paren
)paren
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
id|free_then_out
suffix:colon
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|err
suffix:semicolon
)brace
r_static
r_int
DECL|function|msgctl32
id|msgctl32
(paren
r_int
id|first
comma
r_int
id|second
comma
r_void
op_star
id|uptr
)paren
(brace
r_int
id|err
op_assign
op_minus
id|EINVAL
comma
id|err2
suffix:semicolon
r_struct
id|msqid_ds
id|m
suffix:semicolon
r_struct
id|msqid64_ds
id|m64
suffix:semicolon
r_struct
id|msqid_ds32
op_star
id|up32
op_assign
(paren
r_struct
id|msqid_ds32
op_star
)paren
id|uptr
suffix:semicolon
r_struct
id|msqid64_ds32
op_star
id|up64
op_assign
(paren
r_struct
id|msqid64_ds32
op_star
)paren
id|uptr
suffix:semicolon
id|mm_segment_t
id|old_fs
suffix:semicolon
r_int
id|version
op_assign
id|ipc_parse_version32
c_func
(paren
op_amp
id|second
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|second
)paren
(brace
r_case
id|IPC_INFO
suffix:colon
r_case
id|IPC_RMID
suffix:colon
r_case
id|MSG_INFO
suffix:colon
id|err
op_assign
id|sys_msgctl
c_func
(paren
id|first
comma
id|second
comma
(paren
r_struct
id|msqid_ds
op_star
)paren
id|uptr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPC_SET
suffix:colon
r_if
c_cond
(paren
id|version
op_eq
id|IPC_64
)paren
(brace
id|err
op_assign
id|get_user
c_func
(paren
id|m.msg_perm.uid
comma
op_amp
id|up64-&gt;msg_perm.uid
)paren
suffix:semicolon
id|err
op_or_assign
id|get_user
c_func
(paren
id|m.msg_perm.gid
comma
op_amp
id|up64-&gt;msg_perm.gid
)paren
suffix:semicolon
id|err
op_or_assign
id|get_user
c_func
(paren
id|m.msg_perm.mode
comma
op_amp
id|up64-&gt;msg_perm.mode
)paren
suffix:semicolon
id|err
op_or_assign
id|get_user
c_func
(paren
id|m.msg_qbytes
comma
op_amp
id|up64-&gt;msg_qbytes
)paren
suffix:semicolon
)brace
r_else
(brace
id|err
op_assign
id|get_user
c_func
(paren
id|m.msg_perm.uid
comma
op_amp
id|up32-&gt;msg_perm.uid
)paren
suffix:semicolon
id|err
op_or_assign
id|get_user
c_func
(paren
id|m.msg_perm.gid
comma
op_amp
id|up32-&gt;msg_perm.gid
)paren
suffix:semicolon
id|err
op_or_assign
id|get_user
c_func
(paren
id|m.msg_perm.mode
comma
op_amp
id|up32-&gt;msg_perm.mode
)paren
suffix:semicolon
id|err
op_or_assign
id|get_user
c_func
(paren
id|m.msg_qbytes
comma
op_amp
id|up32-&gt;msg_qbytes
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
)paren
r_break
suffix:semicolon
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|err
op_assign
id|sys_msgctl
c_func
(paren
id|first
comma
id|second
comma
op_amp
id|m
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPC_STAT
suffix:colon
r_case
id|MSG_STAT
suffix:colon
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|err
op_assign
id|sys_msgctl
c_func
(paren
id|first
comma
id|second
comma
(paren
r_void
op_star
)paren
op_amp
id|m64
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|version
op_eq
id|IPC_64
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|up64
comma
r_sizeof
(paren
op_star
id|up64
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err2
op_assign
id|__put_user
c_func
(paren
id|m64.msg_perm.key
comma
op_amp
id|up64-&gt;msg_perm.key
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_perm.uid
comma
op_amp
id|up64-&gt;msg_perm.uid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_perm.gid
comma
op_amp
id|up64-&gt;msg_perm.gid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_perm.cuid
comma
op_amp
id|up64-&gt;msg_perm.cuid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_perm.cgid
comma
op_amp
id|up64-&gt;msg_perm.cgid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_perm.mode
comma
op_amp
id|up64-&gt;msg_perm.mode
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_perm.seq
comma
op_amp
id|up64-&gt;msg_perm.seq
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_stime
comma
op_amp
id|up64-&gt;msg_stime
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_rtime
comma
op_amp
id|up64-&gt;msg_rtime
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_ctime
comma
op_amp
id|up64-&gt;msg_ctime
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_cbytes
comma
op_amp
id|up64-&gt;msg_cbytes
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_qnum
comma
op_amp
id|up64-&gt;msg_qnum
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_qbytes
comma
op_amp
id|up64-&gt;msg_qbytes
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_lspid
comma
op_amp
id|up64-&gt;msg_lspid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_lrpid
comma
op_amp
id|up64-&gt;msg_lrpid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err2
)paren
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|up32
comma
r_sizeof
(paren
op_star
id|up32
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err2
op_assign
id|__put_user
c_func
(paren
id|m64.msg_perm.key
comma
op_amp
id|up32-&gt;msg_perm.key
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_perm.uid
comma
op_amp
id|up32-&gt;msg_perm.uid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_perm.gid
comma
op_amp
id|up32-&gt;msg_perm.gid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_perm.cuid
comma
op_amp
id|up32-&gt;msg_perm.cuid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_perm.cgid
comma
op_amp
id|up32-&gt;msg_perm.cgid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_perm.mode
comma
op_amp
id|up32-&gt;msg_perm.mode
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_perm.seq
comma
op_amp
id|up32-&gt;msg_perm.seq
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_stime
comma
op_amp
id|up32-&gt;msg_stime
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_rtime
comma
op_amp
id|up32-&gt;msg_rtime
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_ctime
comma
op_amp
id|up32-&gt;msg_ctime
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_cbytes
comma
op_amp
id|up32-&gt;msg_cbytes
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_qnum
comma
op_amp
id|up32-&gt;msg_qnum
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_qbytes
comma
op_amp
id|up32-&gt;msg_qbytes
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_lspid
comma
op_amp
id|up32-&gt;msg_lspid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|m64.msg_lrpid
comma
op_amp
id|up32-&gt;msg_lrpid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err2
)paren
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
r_static
r_int
DECL|function|shmat32
id|shmat32
(paren
r_int
id|first
comma
r_int
id|second
comma
r_int
id|third
comma
r_int
id|version
comma
r_void
op_star
id|uptr
)paren
(brace
r_int
r_int
id|raddr
suffix:semicolon
id|u32
op_star
id|uaddr
op_assign
(paren
id|u32
op_star
)paren
id|A
c_func
(paren
(paren
id|u32
)paren
id|third
)paren
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|version
op_eq
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* iBCS2 emulator entry point: unsupported */
id|err
op_assign
id|do_shmat
c_func
(paren
id|first
comma
id|uptr
comma
id|second
comma
op_amp
id|raddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
r_return
id|err
suffix:semicolon
r_return
id|put_user
c_func
(paren
id|raddr
comma
id|uaddr
)paren
suffix:semicolon
)brace
DECL|function|put_shmid64
r_static
r_int
id|put_shmid64
c_func
(paren
r_struct
id|shmid64_ds
op_star
id|s64p
comma
r_void
op_star
id|uptr
comma
r_int
id|version
)paren
(brace
r_int
id|err2
suffix:semicolon
DECL|macro|s64
mdefine_line|#define s64 (*s64p)
r_if
c_cond
(paren
id|version
op_eq
id|IPC_64
)paren
(brace
r_struct
id|shmid64_ds32
op_star
id|up64
op_assign
(paren
r_struct
id|shmid64_ds32
op_star
)paren
id|uptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|up64
comma
r_sizeof
(paren
op_star
id|up64
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|err2
op_assign
id|__put_user
c_func
(paren
id|s64.shm_perm.key
comma
op_amp
id|up64-&gt;shm_perm.key
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_perm.uid
comma
op_amp
id|up64-&gt;shm_perm.uid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_perm.gid
comma
op_amp
id|up64-&gt;shm_perm.gid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_perm.cuid
comma
op_amp
id|up64-&gt;shm_perm.cuid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_perm.cgid
comma
op_amp
id|up64-&gt;shm_perm.cgid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_perm.mode
comma
op_amp
id|up64-&gt;shm_perm.mode
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_perm.seq
comma
op_amp
id|up64-&gt;shm_perm.seq
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_atime
comma
op_amp
id|up64-&gt;shm_atime
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_dtime
comma
op_amp
id|up64-&gt;shm_dtime
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_ctime
comma
op_amp
id|up64-&gt;shm_ctime
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_segsz
comma
op_amp
id|up64-&gt;shm_segsz
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_nattch
comma
op_amp
id|up64-&gt;shm_nattch
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_cpid
comma
op_amp
id|up64-&gt;shm_cpid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_lpid
comma
op_amp
id|up64-&gt;shm_lpid
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|shmid_ds32
op_star
id|up32
op_assign
(paren
r_struct
id|shmid_ds32
op_star
)paren
id|uptr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|up32
comma
r_sizeof
(paren
op_star
id|up32
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|err2
op_assign
id|__put_user
c_func
(paren
id|s64.shm_perm.key
comma
op_amp
id|up32-&gt;shm_perm.key
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_perm.uid
comma
op_amp
id|up32-&gt;shm_perm.uid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_perm.gid
comma
op_amp
id|up32-&gt;shm_perm.gid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_perm.cuid
comma
op_amp
id|up32-&gt;shm_perm.cuid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_perm.cgid
comma
op_amp
id|up32-&gt;shm_perm.cgid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_perm.mode
comma
op_amp
id|up32-&gt;shm_perm.mode
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_perm.seq
comma
op_amp
id|up32-&gt;shm_perm.seq
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_atime
comma
op_amp
id|up32-&gt;shm_atime
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_dtime
comma
op_amp
id|up32-&gt;shm_dtime
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_ctime
comma
op_amp
id|up32-&gt;shm_ctime
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_segsz
comma
op_amp
id|up32-&gt;shm_segsz
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_nattch
comma
op_amp
id|up32-&gt;shm_nattch
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_cpid
comma
op_amp
id|up32-&gt;shm_cpid
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|s64.shm_lpid
comma
op_amp
id|up32-&gt;shm_lpid
)paren
suffix:semicolon
)brace
DECL|macro|s64
macro_line|#undef s64
r_return
id|err2
ques
c_cond
op_minus
id|EFAULT
suffix:colon
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|shmctl32
id|shmctl32
(paren
r_int
id|first
comma
r_int
id|second
comma
r_void
op_star
id|uptr
)paren
(brace
r_int
id|err
op_assign
op_minus
id|EFAULT
comma
id|err2
suffix:semicolon
r_struct
id|shmid_ds
id|s
suffix:semicolon
r_struct
id|shmid64_ds
id|s64
suffix:semicolon
id|mm_segment_t
id|old_fs
suffix:semicolon
r_struct
id|shm_info32
op_star
id|uip
op_assign
(paren
r_struct
id|shm_info32
op_star
)paren
id|uptr
suffix:semicolon
r_struct
id|shm_info
id|si
suffix:semicolon
r_int
id|version
op_assign
id|ipc_parse_version32
c_func
(paren
op_amp
id|second
)paren
suffix:semicolon
r_struct
id|shminfo64
id|smi
suffix:semicolon
r_struct
id|shminfo
op_star
id|usi32
op_assign
(paren
r_struct
id|shminfo
op_star
)paren
id|uptr
suffix:semicolon
r_struct
id|shminfo64_32
op_star
id|usi64
op_assign
(paren
r_struct
id|shminfo64_32
op_star
)paren
id|uptr
suffix:semicolon
r_switch
c_cond
(paren
id|second
)paren
(brace
r_case
id|IPC_INFO
suffix:colon
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|err
op_assign
id|sys_shmctl
c_func
(paren
id|first
comma
id|second
comma
(paren
r_struct
id|shmid_ds
op_star
)paren
op_amp
id|smi
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|version
op_eq
id|IPC_64
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|usi64
comma
r_sizeof
(paren
op_star
id|usi64
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err2
op_assign
id|__put_user
c_func
(paren
id|smi.shmmax
comma
op_amp
id|usi64-&gt;shmmax
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|smi.shmmin
comma
op_amp
id|usi64-&gt;shmmin
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|smi.shmmni
comma
op_amp
id|usi64-&gt;shmmni
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|smi.shmseg
comma
op_amp
id|usi64-&gt;shmseg
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|smi.shmall
comma
op_amp
id|usi64-&gt;shmall
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|usi32
comma
r_sizeof
(paren
op_star
id|usi32
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err2
op_assign
id|__put_user
c_func
(paren
id|smi.shmmax
comma
op_amp
id|usi32-&gt;shmmax
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|smi.shmmin
comma
op_amp
id|usi32-&gt;shmmin
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|smi.shmmni
comma
op_amp
id|usi32-&gt;shmmni
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|smi.shmseg
comma
op_amp
id|usi32-&gt;shmseg
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|smi.shmall
comma
op_amp
id|usi32-&gt;shmall
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err2
)paren
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPC_RMID
suffix:colon
r_case
id|SHM_LOCK
suffix:colon
r_case
id|SHM_UNLOCK
suffix:colon
id|err
op_assign
id|sys_shmctl
c_func
(paren
id|first
comma
id|second
comma
(paren
r_struct
id|shmid_ds
op_star
)paren
id|uptr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPC_SET
suffix:colon
r_if
c_cond
(paren
id|version
op_eq
id|IPC_64
)paren
(brace
r_struct
id|shmid64_ds32
op_star
id|up64
op_assign
(paren
r_struct
id|shmid64_ds32
op_star
)paren
id|uptr
suffix:semicolon
id|err
op_assign
id|get_user
c_func
(paren
id|s.shm_perm.uid
comma
op_amp
id|up64-&gt;shm_perm.uid
)paren
suffix:semicolon
id|err
op_or_assign
id|get_user
c_func
(paren
id|s.shm_perm.gid
comma
op_amp
id|up64-&gt;shm_perm.gid
)paren
suffix:semicolon
id|err
op_or_assign
id|get_user
c_func
(paren
id|s.shm_perm.mode
comma
op_amp
id|up64-&gt;shm_perm.mode
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|shmid_ds32
op_star
id|up32
op_assign
(paren
r_struct
id|shmid_ds32
op_star
)paren
id|uptr
suffix:semicolon
id|err
op_assign
id|get_user
c_func
(paren
id|s.shm_perm.uid
comma
op_amp
id|up32-&gt;shm_perm.uid
)paren
suffix:semicolon
id|err
op_or_assign
id|get_user
c_func
(paren
id|s.shm_perm.gid
comma
op_amp
id|up32-&gt;shm_perm.gid
)paren
suffix:semicolon
id|err
op_or_assign
id|get_user
c_func
(paren
id|s.shm_perm.mode
comma
op_amp
id|up32-&gt;shm_perm.mode
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
)paren
r_break
suffix:semicolon
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|err
op_assign
id|sys_shmctl
c_func
(paren
id|first
comma
id|second
comma
op_amp
id|s
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IPC_STAT
suffix:colon
r_case
id|SHM_STAT
suffix:colon
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|err
op_assign
id|sys_shmctl
c_func
(paren
id|first
comma
id|second
comma
(paren
r_void
op_star
)paren
op_amp
id|s64
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_break
suffix:semicolon
id|err2
op_assign
id|put_shmid64
c_func
(paren
op_amp
id|s64
comma
id|uptr
comma
id|version
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err2
)paren
id|err
op_assign
id|err2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SHM_INFO
suffix:colon
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|err
op_assign
id|sys_shmctl
c_func
(paren
id|first
comma
id|second
comma
(paren
r_void
op_star
)paren
op_amp
id|si
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_WRITE
comma
id|uip
comma
r_sizeof
(paren
op_star
id|uip
)paren
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err2
op_assign
id|__put_user
c_func
(paren
id|si.used_ids
comma
op_amp
id|uip-&gt;used_ids
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|si.shm_tot
comma
op_amp
id|uip-&gt;shm_tot
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|si.shm_rss
comma
op_amp
id|uip-&gt;shm_rss
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|si.shm_swp
comma
op_amp
id|uip-&gt;shm_swp
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|si.swap_attempts
comma
op_amp
id|uip-&gt;swap_attempts
)paren
suffix:semicolon
id|err2
op_or_assign
id|__put_user
c_func
(paren
id|si.swap_successes
comma
op_amp
id|uip-&gt;swap_successes
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err2
)paren
id|err
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
r_extern
r_int
id|sem_ctls
(braket
)braket
suffix:semicolon
DECL|function|semtimedop32
r_static
r_int
id|semtimedop32
c_func
(paren
r_int
id|semid
comma
r_struct
id|sembuf
op_star
id|sb
comma
r_int
id|nsops
comma
r_struct
id|compat_timespec
op_star
id|ts32
)paren
(brace
r_struct
id|timespec
id|ts
suffix:semicolon
id|mm_segment_t
id|oldfs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|nsops
OG
id|sem_ctls
(braket
l_int|2
)braket
)paren
r_return
op_minus
id|E2BIG
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_READ
comma
id|sb
comma
id|nsops
op_star
r_sizeof
(paren
r_struct
id|sembuf
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|ts32
op_logical_and
id|get_compat_timespec
c_func
(paren
op_amp
id|ts
comma
id|ts32
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
id|ret
op_assign
id|sys_semtimedop
c_func
(paren
id|semid
comma
id|sb
comma
id|nsops
comma
id|ts32
ques
c_cond
op_amp
id|ts
suffix:colon
l_int|NULL
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|oldfs
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|asmlinkage
r_int
DECL|function|sys32_ipc
id|sys32_ipc
(paren
id|u32
id|call
comma
r_int
id|first
comma
r_int
id|second
comma
r_int
id|third
comma
id|u32
id|ptr
comma
id|u32
id|fifth
)paren
(brace
r_int
id|version
suffix:semicolon
id|version
op_assign
id|call
op_rshift
l_int|16
suffix:semicolon
multiline_comment|/* hack for backward compatibility */
id|call
op_and_assign
l_int|0xffff
suffix:semicolon
r_switch
c_cond
(paren
id|call
)paren
(brace
r_case
id|SEMOP
suffix:colon
multiline_comment|/* struct sembuf is the same on 32 and 64bit :)) */
r_return
id|sys_semtimedop
c_func
(paren
id|first
comma
(paren
r_struct
id|sembuf
op_star
)paren
id|AA
c_func
(paren
id|ptr
)paren
comma
id|second
comma
l_int|NULL
)paren
suffix:semicolon
r_case
id|TIMEDSEMOP
suffix:colon
r_return
id|semtimedop32
c_func
(paren
id|first
comma
(paren
r_struct
id|sembuf
op_star
)paren
id|AA
c_func
(paren
id|ptr
)paren
comma
id|second
comma
(paren
r_struct
id|compat_timespec
op_star
)paren
id|AA
c_func
(paren
id|fifth
)paren
)paren
suffix:semicolon
r_case
id|SEMGET
suffix:colon
r_return
id|sys_semget
c_func
(paren
id|first
comma
id|second
comma
id|third
)paren
suffix:semicolon
r_case
id|SEMCTL
suffix:colon
r_return
id|semctl32
c_func
(paren
id|first
comma
id|second
comma
id|third
comma
(paren
r_void
op_star
)paren
id|AA
c_func
(paren
id|ptr
)paren
)paren
suffix:semicolon
r_case
id|MSGSND
suffix:colon
r_return
id|do_sys32_msgsnd
c_func
(paren
id|first
comma
id|second
comma
id|third
comma
(paren
r_void
op_star
)paren
id|AA
c_func
(paren
id|ptr
)paren
)paren
suffix:semicolon
r_case
id|MSGRCV
suffix:colon
r_return
id|do_sys32_msgrcv
c_func
(paren
id|first
comma
id|second
comma
id|fifth
comma
id|third
comma
id|version
comma
(paren
r_void
op_star
)paren
id|AA
c_func
(paren
id|ptr
)paren
)paren
suffix:semicolon
r_case
id|MSGGET
suffix:colon
r_return
id|sys_msgget
c_func
(paren
(paren
id|key_t
)paren
id|first
comma
id|second
)paren
suffix:semicolon
r_case
id|MSGCTL
suffix:colon
r_return
id|msgctl32
c_func
(paren
id|first
comma
id|second
comma
(paren
r_void
op_star
)paren
id|AA
c_func
(paren
id|ptr
)paren
)paren
suffix:semicolon
r_case
id|SHMAT
suffix:colon
r_return
id|shmat32
c_func
(paren
id|first
comma
id|second
comma
id|third
comma
id|version
comma
(paren
r_void
op_star
)paren
id|AA
c_func
(paren
id|ptr
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SHMDT
suffix:colon
r_return
id|sys_shmdt
c_func
(paren
(paren
r_char
op_star
)paren
id|AA
c_func
(paren
id|ptr
)paren
)paren
suffix:semicolon
r_case
id|SHMGET
suffix:colon
r_return
id|sys_shmget
c_func
(paren
id|first
comma
id|second
comma
id|third
)paren
suffix:semicolon
r_case
id|SHMCTL
suffix:colon
r_return
id|shmctl32
c_func
(paren
id|first
comma
id|second
comma
(paren
r_void
op_star
)paren
id|AA
c_func
(paren
id|ptr
)paren
)paren
suffix:semicolon
)brace
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
eof
