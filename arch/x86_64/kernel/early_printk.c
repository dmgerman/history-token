macro_line|#include &lt;asm/io.h&gt;
multiline_comment|/* This is &quot;wrong&quot; address to access it, we should access it using&n;   0xffff8000000b8000ul; but 0xffff8000000b8000ul is not available&n;   early at boot. */
DECL|macro|VGABASE
mdefine_line|#define VGABASE&t;&t;0xffffffff800b8000ul&t;
DECL|macro|MAX_YPOS
mdefine_line|#define MAX_YPOS&t;25
DECL|macro|MAX_XPOS
mdefine_line|#define MAX_XPOS&t;80
DECL|variable|current_ypos
DECL|variable|current_xpos
r_static
r_int
id|current_ypos
op_assign
l_int|1
comma
id|current_xpos
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* We want to print before clearing BSS */
r_void
DECL|function|early_clear
id|early_clear
(paren
r_void
)paren
(brace
r_int
id|k
comma
id|i
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|MAX_YPOS
suffix:semicolon
id|k
op_increment
)paren
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_XPOS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|writew
c_func
(paren
l_int|0
comma
id|VGABASE
op_plus
l_int|2
op_star
(paren
id|MAX_XPOS
op_star
id|k
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
id|current_ypos
op_assign
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|early_puts
id|early_puts
(paren
r_const
r_char
op_star
id|str
)paren
(brace
r_char
id|c
suffix:semicolon
r_int
id|i
comma
id|k
comma
id|j
suffix:semicolon
r_while
c_loop
(paren
(paren
id|c
op_assign
op_star
id|str
op_increment
)paren
op_ne
l_char|&squot;&bslash;0&squot;
)paren
(brace
r_if
c_cond
(paren
id|current_ypos
op_ge
id|MAX_YPOS
)paren
(brace
macro_line|#if 1
multiline_comment|/* scroll 1 line up */
r_for
c_loop
(paren
id|k
op_assign
l_int|1
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|k
OL
id|MAX_YPOS
suffix:semicolon
id|k
op_increment
comma
id|j
op_increment
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_XPOS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|writew
c_func
(paren
id|readw
c_func
(paren
id|VGABASE
op_plus
l_int|2
op_star
(paren
id|MAX_XPOS
op_star
id|k
op_plus
id|i
)paren
)paren
comma
id|VGABASE
op_plus
l_int|2
op_star
(paren
id|MAX_XPOS
op_star
id|j
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_XPOS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|writew
c_func
(paren
l_int|0x720
comma
id|VGABASE
op_plus
l_int|2
op_star
(paren
id|MAX_XPOS
op_star
id|j
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
id|current_ypos
op_assign
id|MAX_YPOS
op_minus
l_int|1
suffix:semicolon
macro_line|#else
multiline_comment|/* MUCH faster */
id|early_clear
c_func
(paren
)paren
suffix:semicolon
id|current_ypos
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;&bslash;n&squot;
)paren
(brace
id|current_xpos
op_assign
l_int|0
suffix:semicolon
id|current_ypos
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|c
op_ne
l_char|&squot;&bslash;r&squot;
)paren
(brace
id|writew
c_func
(paren
(paren
(paren
l_int|0x7
op_lshift
l_int|8
)paren
op_or
(paren
r_int
r_int
)paren
id|c
)paren
comma
id|VGABASE
op_plus
l_int|2
op_star
(paren
id|MAX_XPOS
op_star
id|current_ypos
op_plus
id|current_xpos
op_increment
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current_xpos
op_ge
id|MAX_XPOS
)paren
(brace
id|current_xpos
op_assign
l_int|0
suffix:semicolon
id|current_ypos
op_increment
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|variable|buf
r_static
r_char
id|buf
(braket
l_int|1024
)braket
suffix:semicolon
DECL|function|early_printk
r_int
id|early_printk
c_func
(paren
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|args
suffix:semicolon
r_int
id|i
suffix:semicolon
id|va_start
c_func
(paren
id|args
comma
id|fmt
)paren
suffix:semicolon
id|i
op_assign
id|vsprintf
c_func
(paren
id|buf
comma
id|fmt
comma
id|args
)paren
suffix:semicolon
multiline_comment|/* hopefully i &lt; sizeof(buf)-4 */
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
id|early_puts
c_func
(paren
id|buf
)paren
suffix:semicolon
r_return
id|i
suffix:semicolon
)brace
eof
