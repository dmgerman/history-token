multiline_comment|/*&n; * arch/v850/lib/memcpy.c -- Memory copying&n; *&n; *  Copyright (C) 2001,02  NEC Corporation&n; *  Copyright (C) 2001,02  Miles Bader &lt;miles@gnu.org&gt;&n; *&n; * This file is subject to the terms and conditions of the GNU General&n; * Public License.  See the file COPYING in the main directory of this&n; * archive for more details.&n; *&n; * Written by Miles Bader &lt;miles@gnu.org&gt;&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;asm/string.h&gt;
DECL|macro|CHUNK_SIZE
mdefine_line|#define CHUNK_SIZE&t;&t;32 /* bytes */
DECL|macro|CHUNK_ALIGNED
mdefine_line|#define CHUNK_ALIGNED(addr)&t;(((unsigned long)addr &amp; 0x3) == 0)
multiline_comment|/* Note that this macro uses 8 call-clobbered registers (not including&n;   R1), which are few enough so that the following functions don&squot;t need&n;   to spill anything to memory.  It also uses R1, which is nominally&n;   reserved for the assembler, but here it should be OK.  */
DECL|macro|COPY_CHUNK
mdefine_line|#define COPY_CHUNK(src, dst)&t;&t;&t;&bslash;&n;   asm (&quot;mov %0, ep;&quot;&t;&t;&t;&t;&bslash;&n;&t;&quot;sld.w 0[ep], r1; sld.w 4[ep], r12;&quot;&t;&bslash;&n;&t;&quot;sld.w 8[ep], r13; sld.w 12[ep], r14;&quot;&t;&bslash;&n;&t;&quot;sld.w 16[ep], r15; sld.w 20[ep], r17;&quot;&t;&bslash;&n;&t;&quot;sld.w 24[ep], r18; sld.w 28[ep], r19;&quot;&t;&bslash;&n;&t;&quot;mov %1, ep;&quot;&t;&t;&t;&t;&bslash;&n;&t;&quot;sst.w r1, 0[ep]; sst.w r12, 4[ep];&quot;&t;&bslash;&n;&t;&quot;sst.w r13, 8[ep]; sst.w r14, 12[ep];&quot;&t;&bslash;&n;&t;&quot;sst.w r15, 16[ep]; sst.w r17, 20[ep];&quot;&t;&bslash;&n;&t;&quot;sst.w r18, 24[ep]; sst.w r19, 28[ep]&quot;&t;&bslash;&n;&t;:: &quot;r&quot; (src), &quot;r&quot; (dst)&t;&t;&t;&bslash;&n;&t;: &quot;r1&quot;, &quot;r12&quot;, &quot;r13&quot;, &quot;r14&quot;, &quot;r15&quot;,&t;&bslash;&n;&t;  &quot;r17&quot;, &quot;r18&quot;, &quot;r19&quot;, &quot;ep&quot;, &quot;memory&quot;);
DECL|function|memcpy
r_void
op_star
id|memcpy
(paren
r_void
op_star
id|dst
comma
r_const
r_void
op_star
id|src
comma
id|__kernel_size_t
id|size
)paren
(brace
r_char
op_star
id|_dst
op_assign
id|dst
suffix:semicolon
r_const
r_char
op_star
id|_src
op_assign
id|src
suffix:semicolon
r_if
c_cond
(paren
id|size
op_ge
id|CHUNK_SIZE
op_logical_and
id|CHUNK_ALIGNED
c_func
(paren
id|_src
)paren
op_logical_and
id|CHUNK_ALIGNED
c_func
(paren
id|_dst
)paren
)paren
(brace
multiline_comment|/* Copy large blocks efficiently.  */
r_int
id|count
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
id|size
op_div
id|CHUNK_SIZE
suffix:semicolon
id|count
suffix:semicolon
id|count
op_decrement
)paren
(brace
id|COPY_CHUNK
(paren
id|_src
comma
id|_dst
)paren
suffix:semicolon
id|_src
op_add_assign
id|CHUNK_SIZE
suffix:semicolon
id|_dst
op_add_assign
id|CHUNK_SIZE
suffix:semicolon
)brace
id|size
op_mod_assign
id|CHUNK_SIZE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
OG
l_int|0
)paren
r_do
op_star
id|_dst
op_increment
op_assign
op_star
id|_src
op_increment
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|size
)paren
suffix:semicolon
r_return
id|dst
suffix:semicolon
)brace
DECL|function|memmove
r_void
op_star
id|memmove
(paren
r_void
op_star
id|dst
comma
r_const
r_void
op_star
id|src
comma
id|__kernel_size_t
id|size
)paren
(brace
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
id|dst
OL
(paren
r_int
r_int
)paren
id|src
op_logical_or
(paren
r_int
r_int
)paren
id|src
op_plus
id|size
OL
(paren
r_int
r_int
)paren
id|dst
)paren
r_return
id|memcpy
(paren
id|dst
comma
id|src
comma
id|size
)paren
suffix:semicolon
r_else
(brace
r_char
op_star
id|_dst
op_assign
id|dst
op_plus
id|size
suffix:semicolon
r_const
r_char
op_star
id|_src
op_assign
id|src
op_plus
id|size
suffix:semicolon
r_if
c_cond
(paren
id|size
op_ge
id|CHUNK_SIZE
op_logical_and
id|CHUNK_ALIGNED
(paren
id|_src
)paren
op_logical_and
id|CHUNK_ALIGNED
(paren
id|_dst
)paren
)paren
(brace
multiline_comment|/* Copy large blocks efficiently.  */
r_int
id|count
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
id|size
op_div
id|CHUNK_SIZE
suffix:semicolon
id|count
suffix:semicolon
id|count
op_decrement
)paren
(brace
id|_src
op_sub_assign
id|CHUNK_SIZE
suffix:semicolon
id|_dst
op_sub_assign
id|CHUNK_SIZE
suffix:semicolon
id|COPY_CHUNK
(paren
id|_src
comma
id|_dst
)paren
suffix:semicolon
)brace
id|size
op_mod_assign
id|CHUNK_SIZE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
OG
l_int|0
)paren
r_do
op_star
op_decrement
id|_dst
op_assign
op_star
op_decrement
id|_src
suffix:semicolon
r_while
c_loop
(paren
op_decrement
id|size
)paren
suffix:semicolon
r_return
id|_dst
suffix:semicolon
)brace
)brace
eof
