multiline_comment|/*&n; * include/asm-v850/rte_cb.c -- Midas lab RTE-CB series of evaluation boards&n; *&n; *  Copyright (C) 2001,02,03  NEC Electronics Corporation&n; *  Copyright (C) 2001,02,03  Miles Bader &lt;miles@gnu.org&gt;&n; *&n; * This file is subject to the terms and conditions of the GNU General&n; * Public License.  See the file COPYING in the main directory of this&n; * archive for more details.&n; *&n; * Written by Miles Bader &lt;miles@gnu.org&gt;&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/irq.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;asm/machdep.h&gt;
macro_line|#include &lt;asm/v850e_uart.h&gt;
macro_line|#include &quot;mach.h&quot;
r_static
r_void
id|led_tick
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/* LED access routines.  */
r_extern
r_int
id|read_leds
(paren
r_int
id|pos
comma
r_char
op_star
id|buf
comma
r_int
id|len
)paren
suffix:semicolon
r_extern
r_int
id|write_leds
(paren
r_int
id|pos
comma
r_const
r_char
op_star
id|buf
comma
r_int
id|len
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_RTE_CB_MULTI
r_extern
r_void
id|multi_init
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
"&f;"
DECL|function|rte_cb_early_init
r_void
id|__init
id|rte_cb_early_init
(paren
r_void
)paren
(brace
id|v850e_intc_disable_irqs
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_RTE_CB_MULTI
id|multi_init
(paren
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|mach_setup
r_void
id|__init
id|mach_setup
(paren
r_char
op_star
op_star
id|cmdline
)paren
(brace
macro_line|#ifdef CONFIG_RTE_MB_A_PCI
multiline_comment|/* Probe for Mother-A, and print a message if we find it.  */
op_star
(paren
r_volatile
r_int
r_int
op_star
)paren
id|MB_A_SRAM_ADDR
op_assign
l_int|0xDEADBEEF
suffix:semicolon
r_if
c_cond
(paren
op_star
(paren
r_volatile
r_int
r_int
op_star
)paren
id|MB_A_SRAM_ADDR
op_eq
l_int|0xDEADBEEF
)paren
(brace
op_star
(paren
r_volatile
r_int
r_int
op_star
)paren
id|MB_A_SRAM_ADDR
op_assign
l_int|0x12345678
suffix:semicolon
r_if
c_cond
(paren
op_star
(paren
r_volatile
r_int
r_int
op_star
)paren
id|MB_A_SRAM_ADDR
op_eq
l_int|0x12345678
)paren
id|printk
(paren
id|KERN_INFO
l_string|&quot;          NEC SolutionGear/Midas lab&quot;
l_string|&quot; RTE-MOTHER-A motherboard&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#if defined (CONFIG_V850E_NB85E_UART_CONSOLE) &amp;&amp; !defined (CONFIG_TIME_BOOTUP)
id|nb85e_uart_cons_init
(paren
l_int|0
)paren
suffix:semicolon
macro_line|#endif
id|mach_tick
op_assign
id|led_tick
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_TIME_BOOTUP
DECL|function|initial_boot_done
r_void
id|initial_boot_done
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_V850E_NB85E_UART_CONSOLE
id|nb85e_uart_cons_init
(paren
l_int|0
)paren
suffix:semicolon
macro_line|#endif
)brace
macro_line|#endif
DECL|function|machine_restart
r_void
id|machine_restart
(paren
r_char
op_star
id|__unused
)paren
(brace
macro_line|#ifdef CONFIG_RESET_GUARD
id|disable_reset_guard
(paren
)paren
suffix:semicolon
macro_line|#endif
id|asm
(paren
l_string|&quot;jmp r0&quot;
)paren
suffix:semicolon
multiline_comment|/* Jump to the reset vector.  */
)brace
multiline_comment|/* This says `HALt.&squot; in LEDese.  */
DECL|variable|halt_leds_msg
r_static
r_int
r_char
id|halt_leds_msg
(braket
)braket
op_assign
(brace
l_int|0x76
comma
l_int|0x77
comma
l_int|0x38
comma
l_int|0xF8
)brace
suffix:semicolon
DECL|function|machine_halt
r_void
id|machine_halt
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_RESET_GUARD
id|disable_reset_guard
(paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Ignore all interrupts.  */
id|local_irq_disable
(paren
)paren
suffix:semicolon
multiline_comment|/* Write a little message.  */
id|write_leds
(paren
l_int|0
comma
id|halt_leds_msg
comma
r_sizeof
id|halt_leds_msg
)paren
suffix:semicolon
multiline_comment|/* Really halt.  */
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
id|asm
(paren
l_string|&quot;halt; nop; nop; nop; nop; nop&quot;
)paren
suffix:semicolon
)brace
DECL|function|machine_power_off
r_void
id|machine_power_off
(paren
r_void
)paren
(brace
id|machine_halt
(paren
)paren
suffix:semicolon
)brace
"&f;"
multiline_comment|/* Animated LED display for timer tick.  */
DECL|macro|TICK_UPD_FREQ
mdefine_line|#define TICK_UPD_FREQ&t;6
DECL|variable|tick_frames
r_static
r_int
id|tick_frames
(braket
)braket
(braket
l_int|10
)braket
op_assign
(brace
(brace
l_int|0x01
comma
l_int|0x02
comma
l_int|0x04
comma
l_int|0x08
comma
l_int|0x10
comma
l_int|0x20
comma
op_minus
l_int|1
)brace
comma
(brace
l_int|0x63
comma
l_int|0x5c
comma
op_minus
l_int|1
)brace
comma
(brace
l_int|0x5c
comma
l_int|0x00
comma
op_minus
l_int|1
)brace
comma
(brace
l_int|0x63
comma
l_int|0x00
comma
op_minus
l_int|1
)brace
comma
(brace
op_minus
l_int|1
)brace
)brace
suffix:semicolon
DECL|function|led_tick
r_static
r_void
id|led_tick
(paren
)paren
(brace
r_static
r_int
id|counter
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|counter
op_eq
(paren
id|HZ
op_div
id|TICK_UPD_FREQ
)paren
)paren
(brace
multiline_comment|/* Which frame we&squot;re currently displaying for each digit.  */
r_static
r_int
id|frame_nums
(braket
id|LED_NUM_DIGITS
)braket
op_assign
(brace
l_int|0
)brace
suffix:semicolon
multiline_comment|/* Display image.  */
r_static
r_int
r_char
id|image
(braket
id|LED_NUM_DIGITS
)braket
op_assign
(brace
l_int|0
)brace
suffix:semicolon
r_int
r_char
id|prev_image
(braket
id|LED_NUM_DIGITS
)braket
suffix:semicolon
r_int
id|write_to_leds
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* true if we should actually display */
r_int
id|digit
suffix:semicolon
multiline_comment|/* We check to see if the physical LEDs contains what we last&n;&t;&t;   wrote to them; if not, we suppress display (this is so that&n;&t;&t;   users can write to the LEDs, and not have their output&n;&t;&t;   overwritten).  As a special case, we start writing again if&n;&t;&t;   all the LEDs are blank, or our display image is all zeros&n;&t;&t;   (indicating that this is the initial update, when the actual&n;&t;&t;   LEDs might contain random data).  */
id|read_leds
(paren
l_int|0
comma
id|prev_image
comma
id|LED_NUM_DIGITS
)paren
suffix:semicolon
r_for
c_loop
(paren
id|digit
op_assign
l_int|0
suffix:semicolon
id|digit
OL
id|LED_NUM_DIGITS
suffix:semicolon
id|digit
op_increment
)paren
r_if
c_cond
(paren
id|image
(braket
id|digit
)braket
op_ne
id|prev_image
(braket
id|digit
)braket
op_logical_and
id|image
(braket
id|digit
)braket
op_logical_and
id|prev_image
(braket
id|digit
)braket
)paren
(brace
id|write_to_leds
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Update display image.  */
r_for
c_loop
(paren
id|digit
op_assign
l_int|0
suffix:semicolon
id|digit
OL
id|LED_NUM_DIGITS
op_logical_and
id|tick_frames
(braket
id|digit
)braket
(braket
l_int|0
)braket
op_ge
l_int|0
suffix:semicolon
id|digit
op_increment
)paren
(brace
r_int
id|frame
op_assign
id|tick_frames
(braket
id|digit
)braket
(braket
id|frame_nums
(braket
id|digit
)braket
)braket
suffix:semicolon
r_if
c_cond
(paren
id|frame
OL
l_int|0
)paren
(brace
id|image
(braket
id|digit
)braket
op_assign
id|tick_frames
(braket
id|digit
)braket
(braket
l_int|0
)braket
suffix:semicolon
id|frame_nums
(braket
id|digit
)braket
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|image
(braket
id|digit
)braket
op_assign
id|frame
suffix:semicolon
id|frame_nums
(braket
id|digit
)braket
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|write_to_leds
)paren
multiline_comment|/* Write the display image to the physical LEDs.  */
id|write_leds
(paren
l_int|0
comma
id|image
comma
id|LED_NUM_DIGITS
)paren
suffix:semicolon
id|counter
op_assign
l_int|0
suffix:semicolon
)brace
)brace
"&f;"
multiline_comment|/* Mother-A interrupts.  */
macro_line|#ifdef CONFIG_RTE_GBUS_INT
DECL|macro|L
mdefine_line|#define L GBUS_INT_PRIORITY_LOW
DECL|macro|M
mdefine_line|#define M GBUS_INT_PRIORITY_MEDIUM
DECL|macro|H
mdefine_line|#define H GBUS_INT_PRIORITY_HIGH
DECL|variable|gbus_irq_inits
r_static
r_struct
id|gbus_int_irq_init
id|gbus_irq_inits
(braket
)braket
op_assign
(brace
macro_line|#ifdef CONFIG_RTE_MB_A_PCI
(brace
l_string|&quot;MB_A_LAN&quot;
comma
id|IRQ_MB_A_LAN
comma
l_int|1
comma
l_int|1
comma
id|L
)brace
comma
(brace
l_string|&quot;MB_A_PCI1&quot;
comma
id|IRQ_MB_A_PCI1
c_func
(paren
l_int|0
)paren
comma
id|IRQ_MB_A_PCI1_NUM
comma
l_int|1
comma
id|L
)brace
comma
(brace
l_string|&quot;MB_A_PCI2&quot;
comma
id|IRQ_MB_A_PCI2
c_func
(paren
l_int|0
)paren
comma
id|IRQ_MB_A_PCI2_NUM
comma
l_int|1
comma
id|L
)brace
comma
(brace
l_string|&quot;MB_A_EXT&quot;
comma
id|IRQ_MB_A_EXT
c_func
(paren
l_int|0
)paren
comma
id|IRQ_MB_A_EXT_NUM
comma
l_int|1
comma
id|L
)brace
comma
(brace
l_string|&quot;MB_A_USB_OC&quot;
comma
id|IRQ_MB_A_USB_OC
(paren
l_int|0
)paren
comma
id|IRQ_MB_A_USB_OC_NUM
comma
l_int|1
comma
id|L
)brace
comma
(brace
l_string|&quot;MB_A_PCMCIA_OC&quot;
comma
id|IRQ_MB_A_PCMCIA_OC
comma
l_int|1
comma
l_int|1
comma
id|L
)brace
comma
macro_line|#endif
(brace
l_int|0
)brace
)brace
suffix:semicolon
DECL|macro|NUM_GBUS_IRQ_INITS
mdefine_line|#define NUM_GBUS_IRQ_INITS  &bslash;&n;   ((sizeof gbus_irq_inits / sizeof gbus_irq_inits[0]) - 1)
DECL|variable|gbus_hw_itypes
r_static
r_struct
id|hw_interrupt_type
id|gbus_hw_itypes
(braket
id|NUM_GBUS_IRQ_INITS
)braket
suffix:semicolon
macro_line|#endif /* CONFIG_RTE_GBUS_INT */
DECL|function|rte_cb_init_irqs
r_void
id|__init
id|rte_cb_init_irqs
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_RTE_GBUS_INT
id|gbus_int_init_irqs
(paren
)paren
suffix:semicolon
id|gbus_int_init_irq_types
(paren
id|gbus_irq_inits
comma
id|gbus_hw_itypes
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_RTE_GBUS_INT */
)brace
eof
