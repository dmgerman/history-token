multiline_comment|/*&n; * HvCall.c&n; * Copyright (C) 2001  Mike Corrigan IBM Corporation&n; * &n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; */
macro_line|#include &lt;linux/stddef.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/iSeries/HvCall.h&gt;
macro_line|#ifndef  _HVCALLSC_H
macro_line|#include &lt;asm/iSeries/HvCallSc.h&gt;
macro_line|#endif
macro_line|#include &lt;asm/iSeries/LparData.h&gt;
macro_line|#ifndef  _HVTYPES_H
macro_line|#include &lt;asm/iSeries/HvTypes.h&gt;
macro_line|#endif
multiline_comment|/*=====================================================================&n; * Note that this call takes at MOST one page worth of data&n; */
DECL|function|HvCall_readLogBuffer
r_int
id|HvCall_readLogBuffer
c_func
(paren
id|HvLpIndex
id|lpIndex
comma
r_void
op_star
id|buffer
comma
id|u64
id|bufLen
)paren
(brace
r_struct
id|HvLpBufferList
op_star
id|bufList
suffix:semicolon
id|u64
id|bytesLeft
op_assign
id|bufLen
suffix:semicolon
id|u64
id|leftThisPage
suffix:semicolon
id|u64
id|curPtr
op_assign
id|virt_to_absolute
c_func
(paren
(paren
r_int
r_int
)paren
id|buffer
)paren
suffix:semicolon
id|u64
id|retVal
suffix:semicolon
r_int
id|npages
suffix:semicolon
r_int
id|i
suffix:semicolon
id|npages
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|bytesLeft
)paren
(brace
id|npages
op_increment
suffix:semicolon
id|leftThisPage
op_assign
(paren
(paren
id|curPtr
op_amp
id|PAGE_MASK
)paren
op_plus
id|PAGE_SIZE
)paren
op_minus
id|curPtr
suffix:semicolon
r_if
c_cond
(paren
id|leftThisPage
OG
id|bytesLeft
)paren
id|bytesLeft
op_assign
l_int|0
suffix:semicolon
r_else
id|bytesLeft
op_sub_assign
id|leftThisPage
suffix:semicolon
id|curPtr
op_assign
(paren
id|curPtr
op_amp
id|PAGE_MASK
)paren
op_plus
id|PAGE_SIZE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|npages
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|bufList
op_assign
(paren
r_struct
id|HvLpBufferList
op_star
)paren
id|kmalloc
c_func
(paren
id|npages
op_star
r_sizeof
(paren
r_struct
id|HvLpBufferList
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|bytesLeft
op_assign
id|bufLen
suffix:semicolon
id|curPtr
op_assign
id|virt_to_absolute
c_func
(paren
(paren
r_int
r_int
)paren
id|buffer
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|npages
suffix:semicolon
id|i
op_increment
)paren
(brace
id|bufList
(braket
id|i
)braket
dot
id|addr
op_assign
id|curPtr
suffix:semicolon
id|leftThisPage
op_assign
(paren
(paren
id|curPtr
op_amp
id|PAGE_MASK
)paren
op_plus
id|PAGE_SIZE
)paren
op_minus
id|curPtr
suffix:semicolon
r_if
c_cond
(paren
id|leftThisPage
OG
id|bytesLeft
)paren
(brace
id|bufList
(braket
id|i
)braket
dot
id|len
op_assign
id|bytesLeft
suffix:semicolon
id|bytesLeft
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|bufList
(braket
id|i
)braket
dot
id|len
op_assign
id|leftThisPage
suffix:semicolon
id|bytesLeft
op_sub_assign
id|leftThisPage
suffix:semicolon
)brace
id|curPtr
op_assign
(paren
id|curPtr
op_amp
id|PAGE_MASK
)paren
op_plus
id|PAGE_SIZE
suffix:semicolon
)brace
id|retVal
op_assign
id|HvCall3
c_func
(paren
id|HvCallBaseReadLogBuffer
comma
id|lpIndex
comma
id|virt_to_absolute
c_func
(paren
(paren
r_int
r_int
)paren
id|bufList
)paren
comma
id|bufLen
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|bufList
)paren
suffix:semicolon
r_return
(paren
r_int
)paren
id|retVal
suffix:semicolon
)brace
multiline_comment|/*=====================================================================&n; */
DECL|function|HvCall_writeLogBuffer
r_void
id|HvCall_writeLogBuffer
c_func
(paren
r_const
r_void
op_star
id|buffer
comma
id|u64
id|bufLen
)paren
(brace
r_struct
id|HvLpBufferList
id|bufList
suffix:semicolon
id|u64
id|bytesLeft
op_assign
id|bufLen
suffix:semicolon
id|u64
id|leftThisPage
suffix:semicolon
id|u64
id|curPtr
op_assign
id|virt_to_absolute
c_func
(paren
(paren
r_int
r_int
)paren
id|buffer
)paren
suffix:semicolon
r_while
c_loop
(paren
id|bytesLeft
)paren
(brace
id|bufList.addr
op_assign
id|curPtr
suffix:semicolon
id|leftThisPage
op_assign
(paren
(paren
id|curPtr
op_amp
id|PAGE_MASK
)paren
op_plus
id|PAGE_SIZE
)paren
op_minus
id|curPtr
suffix:semicolon
r_if
c_cond
(paren
id|leftThisPage
OG
id|bytesLeft
)paren
(brace
id|bufList.len
op_assign
id|bytesLeft
suffix:semicolon
id|bytesLeft
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|bufList.len
op_assign
id|leftThisPage
suffix:semicolon
id|bytesLeft
op_sub_assign
id|leftThisPage
suffix:semicolon
)brace
id|HvCall2
c_func
(paren
id|HvCallBaseWriteLogBuffer
comma
id|virt_to_absolute
c_func
(paren
(paren
r_int
r_int
)paren
op_amp
id|bufList
)paren
comma
id|bufList.len
)paren
suffix:semicolon
id|curPtr
op_assign
(paren
id|curPtr
op_amp
id|PAGE_MASK
)paren
op_plus
id|PAGE_SIZE
suffix:semicolon
)brace
)brace
eof
