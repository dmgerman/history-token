multiline_comment|/*&n; *  arch/s390/kernel/s390_ext.c&n; *&n; *  S390 version&n; *    Copyright (C) 1999,2000 IBM Deutschland Entwicklung GmbH, IBM Corporation&n; *    Author(s): Holger Smolinski (Holger.Smolinski@de.ibm.com),&n; *               Martin Schwidefsky (schwidefsky@de.ibm.com)&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/malloc.h&gt;
macro_line|#include &lt;asm/lowcore.h&gt;
macro_line|#include &lt;asm/s390_ext.h&gt;
multiline_comment|/*&n; * Simple hash strategy: index = code &amp; 0xff;&n; * ext_int_hash[index] is the start of the list for all external interrupts&n; * that hash to this index. With the current set of external interrupts &n; * (0x1202 external call, 0x1004 cpu timer, 0x2401 hwc console and 0x4000&n; * iucv) this is always the first element. &n; */
DECL|variable|ext_int_hash
id|ext_int_info_t
op_star
id|ext_int_hash
(braket
l_int|256
)braket
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|ext_int_info_timer
id|ext_int_info_t
id|ext_int_info_timer
suffix:semicolon
DECL|variable|ext_int_info_hwc
id|ext_int_info_t
id|ext_int_info_hwc
suffix:semicolon
DECL|function|register_external_interrupt
r_int
id|register_external_interrupt
c_func
(paren
id|__u16
id|code
comma
id|ext_int_handler_t
id|handler
)paren
(brace
id|ext_int_info_t
op_star
id|p
suffix:semicolon
r_int
id|index
suffix:semicolon
id|index
op_assign
id|code
op_amp
l_int|0xff
suffix:semicolon
id|p
op_assign
id|ext_int_hash
(braket
id|index
)braket
suffix:semicolon
r_while
c_loop
(paren
id|p
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;code
op_eq
id|code
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|code
op_eq
l_int|0x1004
)paren
multiline_comment|/* time_init is done before kmalloc works :-/ */
id|p
op_assign
op_amp
id|ext_int_info_timer
suffix:semicolon
r_else
r_if
c_cond
(paren
id|code
op_eq
l_int|0x2401
)paren
multiline_comment|/* hwc_init is done too early too */
id|p
op_assign
op_amp
id|ext_int_info_hwc
suffix:semicolon
r_else
id|p
op_assign
(paren
id|ext_int_info_t
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|ext_int_info_t
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|p-&gt;code
op_assign
id|code
suffix:semicolon
id|p-&gt;handler
op_assign
id|handler
suffix:semicolon
id|p-&gt;next
op_assign
id|ext_int_hash
(braket
id|index
)braket
suffix:semicolon
id|ext_int_hash
(braket
id|index
)braket
op_assign
id|p
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|unregister_external_interrupt
r_int
id|unregister_external_interrupt
c_func
(paren
id|__u16
id|code
comma
id|ext_int_handler_t
id|handler
)paren
(brace
id|ext_int_info_t
op_star
id|p
comma
op_star
id|q
suffix:semicolon
r_int
id|index
suffix:semicolon
id|index
op_assign
id|code
op_amp
l_int|0xff
suffix:semicolon
id|q
op_assign
l_int|NULL
suffix:semicolon
id|p
op_assign
id|ext_int_hash
(braket
id|index
)braket
suffix:semicolon
r_while
c_loop
(paren
id|p
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;code
op_eq
id|code
op_logical_and
id|p-&gt;handler
op_eq
id|handler
)paren
r_break
suffix:semicolon
id|q
op_assign
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|p
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOENT
suffix:semicolon
r_if
c_cond
(paren
id|q
op_ne
l_int|NULL
)paren
id|q-&gt;next
op_assign
id|p-&gt;next
suffix:semicolon
r_else
id|ext_int_hash
(braket
id|index
)braket
op_assign
id|p-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|code
op_ne
l_int|0x1004
op_logical_and
id|code
op_ne
l_int|0x2401
)paren
id|kfree
c_func
(paren
id|p
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|register_external_interrupt
id|EXPORT_SYMBOL
c_func
(paren
id|register_external_interrupt
)paren
suffix:semicolon
DECL|variable|unregister_external_interrupt
id|EXPORT_SYMBOL
c_func
(paren
id|unregister_external_interrupt
)paren
suffix:semicolon
eof
