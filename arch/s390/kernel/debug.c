multiline_comment|/*&n; *  arch/s390/kernel/debug.c&n; *   S/390 debug facility&n; *&n; *    Copyright (C) 1999, 2000 IBM Deutschland Entwicklung GmbH,&n; *                             IBM Corporation&n; *    Author(s): Michael Holzheu (holzheu@de.ibm.com),&n; *               Holger Smolinski (Holger.Smolinski@de.ibm.com)&n; *&n; *    Bugreports to: &lt;Linux390@de.ibm.com&gt;&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/stddef.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/semaphore.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;asm/debug.h&gt;
DECL|macro|MIN
mdefine_line|#define MIN(a,b) (((a)&lt;(b))?(a):(b))
DECL|macro|DEBUG_PROLOG_ENTRY
mdefine_line|#define DEBUG_PROLOG_ENTRY -1
multiline_comment|/* typedefs */
DECL|struct|file_private_info
r_typedef
r_struct
id|file_private_info
(brace
DECL|member|offset
id|loff_t
id|offset
suffix:semicolon
multiline_comment|/* offset of last read in file */
DECL|member|act_area
r_int
id|act_area
suffix:semicolon
multiline_comment|/* number of last formated area */
DECL|member|act_entry
r_int
id|act_entry
suffix:semicolon
multiline_comment|/* last formated entry (offset */
multiline_comment|/* relative to beginning of last */
multiline_comment|/* formated area) */
DECL|member|act_entry_offset
r_int
id|act_entry_offset
suffix:semicolon
multiline_comment|/* up to this offset we copied */
multiline_comment|/* in last read the last formated */
multiline_comment|/* entry to userland */
DECL|member|temp_buf
r_char
id|temp_buf
(braket
l_int|2048
)braket
suffix:semicolon
multiline_comment|/* buffer for output */
DECL|member|debug_info_org
id|debug_info_t
op_star
id|debug_info_org
suffix:semicolon
multiline_comment|/* original debug information */
DECL|member|debug_info_snap
id|debug_info_t
op_star
id|debug_info_snap
suffix:semicolon
multiline_comment|/* snapshot of debug information */
DECL|member|view
r_struct
id|debug_view
op_star
id|view
suffix:semicolon
multiline_comment|/* used view of debug info */
DECL|typedef|file_private_info_t
)brace
id|file_private_info_t
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|string
r_char
op_star
id|string
suffix:semicolon
multiline_comment|/* &n;&t; * This assumes that all args are converted into longs &n;&t; * on L/390 this is the case for all types of parameter &n;&t; * except of floats, and long long (32 bit) &n;         *&n;         */
DECL|member|args
r_int
id|args
(braket
l_int|0
)braket
suffix:semicolon
DECL|typedef|debug_sprintf_entry
)brace
id|debug_sprintf_entry
suffix:semicolon
r_extern
r_void
id|tod_to_timeval
c_func
(paren
r_uint64
id|todval
comma
r_struct
id|timeval
op_star
id|xtime
)paren
suffix:semicolon
multiline_comment|/* internal function prototyes */
r_static
r_int
id|debug_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
id|ssize_t
id|debug_output
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_char
op_star
id|user_buf
comma
r_int
id|user_len
comma
id|loff_t
op_star
id|offset
)paren
suffix:semicolon
r_static
id|ssize_t
id|debug_input
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|user_buf
comma
r_int
id|user_len
comma
id|loff_t
op_star
id|offset
)paren
suffix:semicolon
r_static
r_int
id|debug_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
suffix:semicolon
r_static
r_int
id|debug_close
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
suffix:semicolon
r_static
r_struct
id|proc_dir_entry
op_star
id|debug_create_proc_dir_entry
c_func
(paren
r_struct
id|proc_dir_entry
op_star
id|root
comma
r_const
r_char
op_star
id|name
comma
id|mode_t
id|mode
comma
r_struct
id|file_operations
op_star
id|fops
)paren
suffix:semicolon
r_static
r_void
id|debug_delete_proc_dir_entry
c_func
(paren
r_struct
id|proc_dir_entry
op_star
id|root
comma
r_struct
id|proc_dir_entry
op_star
id|entry
)paren
suffix:semicolon
r_static
id|debug_info_t
op_star
id|debug_info_create
c_func
(paren
r_char
op_star
id|name
comma
r_int
id|page_order
comma
r_int
id|nr_areas
comma
r_int
id|buf_size
)paren
suffix:semicolon
r_static
r_void
id|debug_info_get
c_func
(paren
id|debug_info_t
op_star
)paren
suffix:semicolon
r_static
r_void
id|debug_info_put
c_func
(paren
id|debug_info_t
op_star
)paren
suffix:semicolon
r_static
r_int
id|debug_prolog_level_fn
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_struct
id|debug_view
op_star
id|view
comma
r_char
op_star
id|out_buf
)paren
suffix:semicolon
r_static
r_int
id|debug_input_level_fn
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_struct
id|debug_view
op_star
id|view
comma
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|user_buf
comma
r_int
id|user_buf_size
comma
id|loff_t
op_star
id|offset
)paren
suffix:semicolon
r_static
r_int
id|debug_input_flush_fn
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_struct
id|debug_view
op_star
id|view
comma
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|user_buf
comma
r_int
id|user_buf_size
comma
id|loff_t
op_star
id|offset
)paren
suffix:semicolon
r_static
r_int
id|debug_hex_ascii_format_fn
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_struct
id|debug_view
op_star
id|view
comma
r_char
op_star
id|out_buf
comma
r_const
r_char
op_star
id|in_buf
)paren
suffix:semicolon
r_static
r_int
id|debug_raw_format_fn
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_struct
id|debug_view
op_star
id|view
comma
r_char
op_star
id|out_buf
comma
r_const
r_char
op_star
id|in_buf
)paren
suffix:semicolon
r_static
r_int
id|debug_raw_header_fn
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_struct
id|debug_view
op_star
id|view
comma
r_int
id|area
comma
id|debug_entry_t
op_star
id|entry
comma
r_char
op_star
id|out_buf
)paren
suffix:semicolon
r_static
r_int
id|debug_sprintf_format_fn
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_struct
id|debug_view
op_star
id|view
comma
r_char
op_star
id|out_buf
comma
id|debug_sprintf_entry
op_star
id|curr_event
)paren
suffix:semicolon
multiline_comment|/* globals */
DECL|variable|debug_raw_view
r_struct
id|debug_view
id|debug_raw_view
op_assign
(brace
l_string|&quot;raw&quot;
comma
l_int|NULL
comma
op_amp
id|debug_raw_header_fn
comma
op_amp
id|debug_raw_format_fn
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|debug_hex_ascii_view
r_struct
id|debug_view
id|debug_hex_ascii_view
op_assign
(brace
l_string|&quot;hex_ascii&quot;
comma
l_int|NULL
comma
op_amp
id|debug_dflt_header_fn
comma
op_amp
id|debug_hex_ascii_format_fn
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|debug_level_view
r_struct
id|debug_view
id|debug_level_view
op_assign
(brace
l_string|&quot;level&quot;
comma
op_amp
id|debug_prolog_level_fn
comma
l_int|NULL
comma
l_int|NULL
comma
op_amp
id|debug_input_level_fn
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|debug_flush_view
r_struct
id|debug_view
id|debug_flush_view
op_assign
(brace
l_string|&quot;flush&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
op_amp
id|debug_input_flush_fn
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|debug_sprintf_view
r_struct
id|debug_view
id|debug_sprintf_view
op_assign
(brace
l_string|&quot;sprintf&quot;
comma
l_int|NULL
comma
op_amp
id|debug_dflt_header_fn
comma
(paren
id|debug_format_proc_t
op_star
)paren
op_amp
id|debug_sprintf_format_fn
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|debug_feature_version
r_int
r_int
id|debug_feature_version
op_assign
id|__DEBUG_FEATURE_VERSION
suffix:semicolon
multiline_comment|/* static globals */
DECL|variable|debug_area_first
r_static
id|debug_info_t
op_star
id|debug_area_first
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|debug_area_last
r_static
id|debug_info_t
op_star
id|debug_area_last
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|debug_lock
id|DECLARE_MUTEX
c_func
(paren
id|debug_lock
)paren
suffix:semicolon
DECL|variable|initialized
r_static
r_int
id|initialized
op_assign
l_int|0
suffix:semicolon
DECL|variable|debug_file_ops
r_static
r_struct
id|file_operations
id|debug_file_ops
op_assign
(brace
id|owner
suffix:colon
id|THIS_MODULE
comma
id|read
suffix:colon
id|debug_output
comma
id|write
suffix:colon
id|debug_input
comma
id|open
suffix:colon
id|debug_open
comma
id|release
suffix:colon
id|debug_close
comma
)brace
suffix:semicolon
DECL|variable|debug_proc_root_entry
r_static
r_struct
id|proc_dir_entry
op_star
id|debug_proc_root_entry
suffix:semicolon
multiline_comment|/* functions */
multiline_comment|/*&n; * debug_info_alloc&n; * - alloc new debug-info&n; */
DECL|function|debug_info_alloc
r_static
id|debug_info_t
op_star
id|debug_info_alloc
c_func
(paren
r_char
op_star
id|name
comma
r_int
id|page_order
comma
r_int
id|nr_areas
comma
r_int
id|buf_size
)paren
(brace
id|debug_info_t
op_star
id|rc
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* alloc everything */
id|rc
op_assign
(paren
id|debug_info_t
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|debug_info_t
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
(brace
r_goto
id|fail_malloc_rc
suffix:semicolon
)brace
id|rc-&gt;active_entry
op_assign
(paren
r_int
op_star
)paren
id|kmalloc
c_func
(paren
id|nr_areas
op_star
r_sizeof
(paren
r_int
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc-&gt;active_entry
)paren
(brace
r_goto
id|fail_malloc_active_entry
suffix:semicolon
)brace
id|memset
c_func
(paren
id|rc-&gt;active_entry
comma
l_int|0
comma
id|nr_areas
op_star
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|rc-&gt;areas
op_assign
(paren
id|debug_entry_t
op_star
op_star
)paren
id|kmalloc
c_func
(paren
id|nr_areas
op_star
r_sizeof
(paren
id|debug_entry_t
op_star
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc-&gt;areas
)paren
r_goto
id|fail_malloc_areas
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nr_areas
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rc-&gt;areas
(braket
id|i
)braket
op_assign
(paren
id|debug_entry_t
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_ATOMIC
comma
id|page_order
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc-&gt;areas
(braket
id|i
)braket
)paren
(brace
r_for
c_loop
(paren
id|i
op_decrement
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|free_pages
c_func
(paren
(paren
r_int
r_int
)paren
id|rc-&gt;areas
(braket
id|i
)braket
comma
id|page_order
)paren
suffix:semicolon
)brace
r_goto
id|fail_malloc_areas2
suffix:semicolon
)brace
r_else
(brace
id|memset
c_func
(paren
id|rc-&gt;areas
(braket
id|i
)braket
comma
l_int|0
comma
id|PAGE_SIZE
op_lshift
id|page_order
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* initialize members */
id|spin_lock_init
c_func
(paren
op_amp
id|rc-&gt;lock
)paren
suffix:semicolon
id|rc-&gt;page_order
op_assign
id|page_order
suffix:semicolon
id|rc-&gt;nr_areas
op_assign
id|nr_areas
suffix:semicolon
id|rc-&gt;active_area
op_assign
l_int|0
suffix:semicolon
id|rc-&gt;level
op_assign
id|DEBUG_DEFAULT_LEVEL
suffix:semicolon
id|rc-&gt;buf_size
op_assign
id|buf_size
suffix:semicolon
id|rc-&gt;entry_size
op_assign
r_sizeof
(paren
id|debug_entry_t
)paren
op_plus
id|buf_size
suffix:semicolon
id|strncpy
c_func
(paren
id|rc-&gt;name
comma
id|name
comma
id|MIN
c_func
(paren
id|strlen
c_func
(paren
id|name
)paren
comma
(paren
id|DEBUG_MAX_PROCF_LEN
op_minus
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|rc-&gt;name
(braket
id|MIN
c_func
(paren
id|strlen
c_func
(paren
id|name
)paren
comma
(paren
id|DEBUG_MAX_PROCF_LEN
op_minus
l_int|1
)paren
)paren
)braket
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|rc-&gt;views
comma
l_int|0
comma
id|DEBUG_MAX_VIEWS
op_star
r_sizeof
(paren
r_struct
id|debug_view
op_star
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|rc-&gt;proc_entries
comma
l_int|0
comma
id|DEBUG_MAX_VIEWS
op_star
r_sizeof
(paren
r_struct
id|proc_dir_entry
op_star
)paren
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
(paren
id|rc-&gt;ref_count
)paren
comma
l_int|0
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
id|fail_malloc_areas2
suffix:colon
id|kfree
c_func
(paren
id|rc-&gt;areas
)paren
suffix:semicolon
id|fail_malloc_areas
suffix:colon
id|kfree
c_func
(paren
id|rc-&gt;active_entry
)paren
suffix:semicolon
id|fail_malloc_active_entry
suffix:colon
id|kfree
c_func
(paren
id|rc
)paren
suffix:semicolon
id|fail_malloc_rc
suffix:colon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * debug_info_free&n; * - free memory debug-info&n; */
DECL|function|debug_info_free
r_static
r_void
(def_block
id|debug_info_free
c_func
(paren
id|debug_info_t
op_star
id|db_info
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|db_info-&gt;nr_areas
suffix:semicolon
id|i
op_increment
)paren
(brace
id|free_pages
c_func
(paren
(paren
r_int
r_int
)paren
id|db_info-&gt;areas
(braket
id|i
)braket
comma
id|db_info-&gt;page_order
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|db_info-&gt;areas
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|db_info-&gt;active_entry
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|db_info
)paren
suffix:semicolon
)brace
)def_block
multiline_comment|/*&n; * debug_info_create&n; * - create new debug-info&n; */
DECL|function|debug_info_create
r_static
id|debug_info_t
op_star
id|debug_info_create
c_func
(paren
r_char
op_star
id|name
comma
r_int
id|page_order
comma
r_int
id|nr_areas
comma
r_int
id|buf_size
)paren
(brace
id|debug_info_t
op_star
id|rc
suffix:semicolon
id|rc
op_assign
id|debug_info_alloc
c_func
(paren
id|name
comma
id|page_order
comma
id|nr_areas
comma
id|buf_size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* create proc rood directory */
id|rc-&gt;proc_root_entry
op_assign
id|proc_mkdir
c_func
(paren
id|rc-&gt;name
comma
id|debug_proc_root_entry
)paren
suffix:semicolon
multiline_comment|/* append new element to linked list */
r_if
c_cond
(paren
id|debug_area_first
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* first element in list */
id|debug_area_first
op_assign
id|rc
suffix:semicolon
id|rc-&gt;prev
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* append element to end of list */
id|debug_area_last-&gt;next
op_assign
id|rc
suffix:semicolon
id|rc-&gt;prev
op_assign
id|debug_area_last
suffix:semicolon
)brace
id|debug_area_last
op_assign
id|rc
suffix:semicolon
id|rc-&gt;next
op_assign
l_int|NULL
suffix:semicolon
id|debug_info_get
c_func
(paren
id|rc
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * debug_info_copy&n; * - copy debug-info&n; */
DECL|function|debug_info_copy
r_static
id|debug_info_t
op_star
id|debug_info_copy
c_func
(paren
id|debug_info_t
op_star
id|in
)paren
(brace
r_int
id|i
suffix:semicolon
id|debug_info_t
op_star
id|rc
suffix:semicolon
id|rc
op_assign
id|debug_info_alloc
c_func
(paren
id|in-&gt;name
comma
id|in-&gt;page_order
comma
id|in-&gt;nr_areas
comma
id|in-&gt;buf_size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|in-&gt;nr_areas
suffix:semicolon
id|i
op_increment
)paren
(brace
id|memcpy
c_func
(paren
id|rc-&gt;areas
(braket
id|i
)braket
comma
id|in-&gt;areas
(braket
id|i
)braket
comma
id|PAGE_SIZE
op_lshift
id|in-&gt;page_order
)paren
suffix:semicolon
)brace
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * debug_info_get&n; * - increments reference count for debug-info&n; */
DECL|function|debug_info_get
r_static
r_void
id|debug_info_get
c_func
(paren
id|debug_info_t
op_star
id|db_info
)paren
(brace
r_if
c_cond
(paren
id|db_info
)paren
id|atomic_inc
c_func
(paren
op_amp
id|db_info-&gt;ref_count
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * debug_info_put:&n; * - decreases reference count for debug-info and frees it if necessary&n; */
DECL|function|debug_info_put
r_static
r_void
id|debug_info_put
c_func
(paren
id|debug_info_t
op_star
id|db_info
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|db_info
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|atomic_dec_and_test
c_func
(paren
op_amp
id|db_info-&gt;ref_count
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;debug: freeing debug area %p (%s)&bslash;n&quot;
comma
id|db_info
comma
id|db_info-&gt;name
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DEBUG_MAX_VIEWS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|db_info-&gt;views
(braket
id|i
)braket
op_ne
l_int|NULL
)paren
id|debug_delete_proc_dir_entry
(paren
id|db_info-&gt;proc_root_entry
comma
id|db_info-&gt;proc_entries
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|debug_delete_proc_dir_entry
c_func
(paren
id|debug_proc_root_entry
comma
id|db_info-&gt;proc_root_entry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|db_info
op_eq
id|debug_area_first
)paren
(brace
id|debug_area_first
op_assign
id|db_info-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|db_info
op_eq
id|debug_area_last
)paren
(brace
id|debug_area_last
op_assign
id|db_info-&gt;prev
suffix:semicolon
)brace
r_if
c_cond
(paren
id|db_info-&gt;prev
)paren
(brace
id|db_info-&gt;prev-&gt;next
op_assign
id|db_info-&gt;next
suffix:semicolon
)brace
r_if
c_cond
(paren
id|db_info-&gt;next
)paren
(brace
id|db_info-&gt;next-&gt;prev
op_assign
id|db_info-&gt;prev
suffix:semicolon
)brace
id|debug_info_free
c_func
(paren
id|db_info
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * debug_format_entry:&n; * - format one debug entry and return size of formated data&n; */
DECL|function|debug_format_entry
r_static
r_int
id|debug_format_entry
c_func
(paren
id|file_private_info_t
op_star
id|p_info
)paren
(brace
id|debug_info_t
op_star
id|id_org
op_assign
id|p_info-&gt;debug_info_org
suffix:semicolon
id|debug_info_t
op_star
id|id_snap
op_assign
id|p_info-&gt;debug_info_snap
suffix:semicolon
r_struct
id|debug_view
op_star
id|view
op_assign
id|p_info-&gt;view
suffix:semicolon
id|debug_entry_t
op_star
id|act_entry
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|p_info-&gt;act_entry
op_eq
id|DEBUG_PROLOG_ENTRY
)paren
(brace
multiline_comment|/* print prolog */
r_if
c_cond
(paren
id|view-&gt;prolog_proc
)paren
id|len
op_add_assign
id|view
op_member_access_from_pointer
id|prolog_proc
c_func
(paren
id|id_org
comma
id|view
comma
id|p_info-&gt;temp_buf
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|act_entry
op_assign
(paren
id|debug_entry_t
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|id_snap-&gt;areas
(braket
id|p_info-&gt;act_area
)braket
op_plus
id|p_info-&gt;act_entry
)paren
suffix:semicolon
r_if
c_cond
(paren
id|act_entry-&gt;id.stck
op_eq
l_int|0LL
)paren
r_goto
id|out
suffix:semicolon
multiline_comment|/* empty entry */
r_if
c_cond
(paren
id|view-&gt;header_proc
)paren
id|len
op_add_assign
id|view
op_member_access_from_pointer
id|header_proc
c_func
(paren
id|id_org
comma
id|view
comma
id|p_info-&gt;act_area
comma
id|act_entry
comma
id|p_info-&gt;temp_buf
op_plus
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|view-&gt;format_proc
)paren
id|len
op_add_assign
id|view
op_member_access_from_pointer
id|format_proc
c_func
(paren
id|id_org
comma
id|view
comma
id|p_info-&gt;temp_buf
op_plus
id|len
comma
id|DEBUG_DATA
c_func
(paren
id|act_entry
)paren
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|len
suffix:semicolon
)brace
multiline_comment|/*&n; * debug_next_entry:&n; * - goto next entry in p_info&n; */
DECL|function|debug_next_entry
r_extern
r_inline
r_int
id|debug_next_entry
c_func
(paren
id|file_private_info_t
op_star
id|p_info
)paren
(brace
id|debug_info_t
op_star
id|id
op_assign
id|p_info-&gt;debug_info_snap
suffix:semicolon
r_if
c_cond
(paren
id|p_info-&gt;act_entry
op_eq
id|DEBUG_PROLOG_ENTRY
)paren
(brace
id|p_info-&gt;act_entry
op_assign
l_int|0
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|p_info-&gt;act_entry
op_add_assign
id|id-&gt;entry_size
)paren
OG
(paren
(paren
id|PAGE_SIZE
op_lshift
(paren
id|id-&gt;page_order
)paren
)paren
op_minus
id|id-&gt;entry_size
)paren
)paren
(brace
multiline_comment|/* next area */
id|p_info-&gt;act_entry
op_assign
l_int|0
suffix:semicolon
id|p_info-&gt;act_area
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|p_info-&gt;act_area
op_ge
id|id-&gt;nr_areas
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
)brace
id|out
suffix:colon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * debug_output:&n; * - called for user read()&n; * - copies formated debug entries to the user buffer&n; */
DECL|function|debug_output
r_static
id|ssize_t
id|debug_output
c_func
(paren
r_struct
id|file
op_star
id|file
comma
multiline_comment|/* file descriptor */
r_char
op_star
id|user_buf
comma
multiline_comment|/* user buffer */
r_int
id|len
comma
multiline_comment|/* length of buffer */
id|loff_t
op_star
id|offset
multiline_comment|/* offset in the file */
)paren
(brace
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_int
id|entry_offset
comma
id|size
op_assign
l_int|0
suffix:semicolon
id|file_private_info_t
op_star
id|p_info
suffix:semicolon
id|p_info
op_assign
(paren
(paren
id|file_private_info_t
op_star
)paren
id|file-&gt;private_data
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|offset
op_ne
id|p_info-&gt;offset
)paren
r_return
op_minus
id|EPIPE
suffix:semicolon
r_if
c_cond
(paren
id|p_info-&gt;act_area
op_ge
id|p_info-&gt;debug_info_snap-&gt;nr_areas
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|entry_offset
op_assign
id|p_info-&gt;act_entry_offset
suffix:semicolon
r_while
c_loop
(paren
id|count
OL
id|len
)paren
(brace
id|size
op_assign
id|debug_format_entry
c_func
(paren
id|p_info
)paren
suffix:semicolon
id|size
op_assign
id|MIN
c_func
(paren
(paren
id|len
op_minus
id|count
)paren
comma
(paren
id|size
op_minus
id|entry_offset
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
)paren
(brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|user_buf
op_plus
id|count
comma
id|p_info-&gt;temp_buf
op_plus
id|entry_offset
comma
id|size
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|count
op_add_assign
id|size
suffix:semicolon
id|entry_offset
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|count
op_ne
id|len
)paren
r_if
c_cond
(paren
id|debug_next_entry
c_func
(paren
id|p_info
)paren
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
)brace
id|out
suffix:colon
id|p_info-&gt;offset
op_assign
op_star
id|offset
op_plus
id|count
suffix:semicolon
id|p_info-&gt;act_entry_offset
op_assign
id|size
suffix:semicolon
op_star
id|offset
op_assign
id|p_info-&gt;offset
suffix:semicolon
r_return
id|count
suffix:semicolon
)brace
multiline_comment|/*&n; * debug_input:&n; * - called for user write()&n; * - calls input function of view&n; */
DECL|function|debug_input
r_static
id|ssize_t
id|debug_input
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|user_buf
comma
r_int
id|length
comma
id|loff_t
op_star
id|offset
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|file_private_info_t
op_star
id|p_info
suffix:semicolon
id|down
c_func
(paren
op_amp
id|debug_lock
)paren
suffix:semicolon
id|p_info
op_assign
(paren
(paren
id|file_private_info_t
op_star
)paren
id|file-&gt;private_data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p_info-&gt;view-&gt;input_proc
)paren
id|rc
op_assign
id|p_info-&gt;view
op_member_access_from_pointer
id|input_proc
c_func
(paren
id|p_info-&gt;debug_info_org
comma
id|p_info-&gt;view
comma
id|file
comma
id|user_buf
comma
id|length
comma
id|offset
)paren
suffix:semicolon
r_else
id|rc
op_assign
op_minus
id|EPERM
suffix:semicolon
id|up
c_func
(paren
op_amp
id|debug_lock
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
multiline_comment|/* number of input characters */
)brace
multiline_comment|/*&n; * debug_open:&n; * - called for user open()&n; * - copies formated output to private_data area of the file&n; *   handle&n; */
DECL|function|debug_open
r_static
r_int
id|debug_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|i
op_assign
l_int|0
comma
id|rc
op_assign
l_int|0
suffix:semicolon
id|file_private_info_t
op_star
id|p_info
suffix:semicolon
id|debug_info_t
op_star
id|debug_info
comma
op_star
id|debug_info_snapshot
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
l_string|&quot;debug_open&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|down
c_func
(paren
op_amp
id|debug_lock
)paren
suffix:semicolon
multiline_comment|/* find debug log and view */
id|debug_info
op_assign
id|debug_area_first
suffix:semicolon
r_while
c_loop
(paren
id|debug_info
op_ne
l_int|NULL
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DEBUG_MAX_VIEWS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|debug_info-&gt;views
(braket
id|i
)braket
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
r_else
r_if
c_cond
(paren
id|debug_info-&gt;proc_entries
(braket
id|i
)braket
op_eq
id|PDE
c_func
(paren
id|file-&gt;f_dentry-&gt;d_inode
)paren
)paren
(brace
r_goto
id|found
suffix:semicolon
multiline_comment|/* found view ! */
)brace
)brace
id|debug_info
op_assign
id|debug_info-&gt;next
suffix:semicolon
)brace
multiline_comment|/* no entry found */
id|rc
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|out
suffix:semicolon
id|found
suffix:colon
multiline_comment|/* make snapshot of current debug areas to get it consistent */
id|debug_info_snapshot
op_assign
id|debug_info_copy
c_func
(paren
id|debug_info
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|debug_info_snapshot
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;debug_open: debug_info_copy failed (out of mem)&bslash;n&quot;
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|file-&gt;private_data
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
id|file_private_info_t
)paren
comma
id|GFP_ATOMIC
)paren
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;debug_open: kmalloc failed&bslash;n&quot;
)paren
suffix:semicolon
id|debug_info_free
c_func
(paren
id|debug_info_snapshot
)paren
suffix:semicolon
id|rc
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|p_info
op_assign
(paren
id|file_private_info_t
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|p_info-&gt;offset
op_assign
l_int|0
suffix:semicolon
id|p_info-&gt;debug_info_snap
op_assign
id|debug_info_snapshot
suffix:semicolon
id|p_info-&gt;debug_info_org
op_assign
id|debug_info
suffix:semicolon
id|p_info-&gt;view
op_assign
id|debug_info-&gt;views
(braket
id|i
)braket
suffix:semicolon
id|p_info-&gt;act_area
op_assign
l_int|0
suffix:semicolon
id|p_info-&gt;act_entry
op_assign
id|DEBUG_PROLOG_ENTRY
suffix:semicolon
id|p_info-&gt;act_entry_offset
op_assign
l_int|0
suffix:semicolon
id|debug_info_get
c_func
(paren
id|debug_info
)paren
suffix:semicolon
id|out
suffix:colon
id|up
c_func
(paren
op_amp
id|debug_lock
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * debug_close:&n; * - called for user close()&n; * - deletes  private_data area of the file handle&n; */
DECL|function|debug_close
r_static
r_int
id|debug_close
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
id|file_private_info_t
op_star
id|p_info
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
l_string|&quot;debug_close&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|p_info
op_assign
(paren
id|file_private_info_t
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
id|debug_info_free
c_func
(paren
id|p_info-&gt;debug_info_snap
)paren
suffix:semicolon
id|debug_info_put
c_func
(paren
id|p_info-&gt;debug_info_org
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|file-&gt;private_data
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* success */
)brace
multiline_comment|/*&n; * debug_create_proc_dir_entry:&n; * - initializes proc-dir-entry and registers it&n; */
DECL|function|debug_create_proc_dir_entry
r_static
r_struct
id|proc_dir_entry
op_star
id|debug_create_proc_dir_entry
(paren
r_struct
id|proc_dir_entry
op_star
id|root
comma
r_const
r_char
op_star
id|name
comma
id|mode_t
id|mode
comma
r_struct
id|file_operations
op_star
id|fops
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|rc
op_assign
id|create_proc_entry
c_func
(paren
id|name
comma
id|mode
comma
id|root
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_logical_and
id|fops
)paren
id|rc-&gt;proc_fops
op_assign
id|fops
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * delete_proc_dir_entry:&n; */
DECL|function|debug_delete_proc_dir_entry
r_static
r_void
id|debug_delete_proc_dir_entry
(paren
r_struct
id|proc_dir_entry
op_star
id|root
comma
r_struct
id|proc_dir_entry
op_star
id|proc_entry
)paren
(brace
id|remove_proc_entry
c_func
(paren
id|proc_entry-&gt;name
comma
id|root
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * debug_register:&n; * - creates and initializes debug area for the caller&n; * - returns handle for debug area&n; */
DECL|function|debug_register
id|debug_info_t
op_star
id|debug_register
(paren
r_char
op_star
id|name
comma
r_int
id|page_order
comma
r_int
id|nr_areas
comma
r_int
id|buf_size
)paren
(brace
id|debug_info_t
op_star
id|rc
op_assign
l_int|NULL
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|initialized
)paren
id|debug_init
c_func
(paren
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|debug_lock
)paren
suffix:semicolon
multiline_comment|/* create new debug_info */
id|rc
op_assign
id|debug_info_create
c_func
(paren
id|name
comma
id|page_order
comma
id|nr_areas
comma
id|buf_size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rc
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
id|debug_register_view
c_func
(paren
id|rc
comma
op_amp
id|debug_level_view
)paren
suffix:semicolon
id|debug_register_view
c_func
(paren
id|rc
comma
op_amp
id|debug_flush_view
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;debug: reserved %d areas of %d pages for debugging %s&bslash;n&quot;
comma
id|nr_areas
comma
l_int|1
op_lshift
id|page_order
comma
id|rc-&gt;name
)paren
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
id|rc
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;debug: debug_register failed for %s&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|debug_lock
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * debug_unregister:&n; * - give back debug area&n; */
DECL|function|debug_unregister
r_void
id|debug_unregister
c_func
(paren
id|debug_info_t
op_star
id|id
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|id
)paren
r_goto
id|out
suffix:semicolon
id|down
c_func
(paren
op_amp
id|debug_lock
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;debug: unregistering %s&bslash;n&quot;
comma
id|id-&gt;name
)paren
suffix:semicolon
id|debug_info_put
c_func
(paren
id|id
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|debug_lock
)paren
suffix:semicolon
id|MOD_DEC_USE_COUNT
suffix:semicolon
id|out
suffix:colon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * debug_set_level:&n; * - set actual debug level&n; */
DECL|function|debug_set_level
r_void
id|debug_set_level
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_int
id|new_level
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|id
)paren
(brace
r_return
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|id-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_level
op_eq
id|DEBUG_OFF_LEVEL
)paren
(brace
id|id-&gt;level
op_assign
id|DEBUG_OFF_LEVEL
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;debug: %s: switched off&bslash;n&quot;
comma
id|id-&gt;name
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|new_level
OG
id|DEBUG_MAX_LEVEL
)paren
op_logical_or
(paren
id|new_level
OL
l_int|0
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;debug: %s: level %i is out of range (%i - %i)&bslash;n&quot;
comma
id|id-&gt;name
comma
id|new_level
comma
l_int|0
comma
id|DEBUG_MAX_LEVEL
)paren
suffix:semicolon
)brace
r_else
(brace
id|id-&gt;level
op_assign
id|new_level
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;debug: %s: new level %i&bslash;n&quot;
comma
id|id-&gt;name
comma
id|id-&gt;level
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|id-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * proceed_active_entry:&n; * - set active entry to next in the ring buffer&n; */
DECL|function|proceed_active_entry
r_extern
r_inline
r_void
id|proceed_active_entry
c_func
(paren
id|debug_info_t
op_star
id|id
)paren
(brace
r_if
c_cond
(paren
(paren
id|id-&gt;active_entry
(braket
id|id-&gt;active_area
)braket
op_add_assign
id|id-&gt;entry_size
)paren
OG
(paren
(paren
id|PAGE_SIZE
op_lshift
(paren
id|id-&gt;page_order
)paren
)paren
op_minus
id|id-&gt;entry_size
)paren
)paren
id|id-&gt;active_entry
(braket
id|id-&gt;active_area
)braket
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * proceed_active_area:&n; * - set active area to next in the ring buffer&n; */
DECL|function|proceed_active_area
r_extern
r_inline
r_void
id|proceed_active_area
c_func
(paren
id|debug_info_t
op_star
id|id
)paren
(brace
id|id-&gt;active_area
op_increment
suffix:semicolon
id|id-&gt;active_area
op_assign
id|id-&gt;active_area
op_mod
id|id-&gt;nr_areas
suffix:semicolon
)brace
multiline_comment|/*&n; * get_active_entry:&n; */
DECL|function|get_active_entry
r_extern
r_inline
id|debug_entry_t
op_star
id|get_active_entry
c_func
(paren
id|debug_info_t
op_star
id|id
)paren
(brace
r_return
(paren
id|debug_entry_t
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|id-&gt;areas
(braket
id|id-&gt;active_area
)braket
op_plus
id|id-&gt;active_entry
(braket
id|id-&gt;active_area
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * debug_common:&n; * - set timestamp, caller address, cpu number etc.&n; */
DECL|function|debug_common
r_extern
r_inline
id|debug_entry_t
op_star
id|debug_common
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_int
id|level
comma
r_const
r_void
op_star
id|buf
comma
r_int
id|len
comma
r_int
id|exception
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|debug_entry_t
op_star
id|active
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|id-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|active
op_assign
id|get_active_entry
c_func
(paren
id|id
)paren
suffix:semicolon
id|STCK
c_func
(paren
id|active-&gt;id.stck
)paren
suffix:semicolon
id|active-&gt;id.fields.cpuid
op_assign
id|smp_processor_id
c_func
(paren
)paren
suffix:semicolon
id|active-&gt;caller
op_assign
id|__builtin_return_address
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|active-&gt;id.fields.exception
op_assign
id|exception
suffix:semicolon
id|active-&gt;id.fields.level
op_assign
id|level
suffix:semicolon
id|memset
c_func
(paren
id|DEBUG_DATA
c_func
(paren
id|active
)paren
comma
l_int|0
comma
id|id-&gt;buf_size
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|DEBUG_DATA
c_func
(paren
id|active
)paren
comma
id|buf
comma
id|MIN
c_func
(paren
id|len
comma
id|id-&gt;buf_size
)paren
)paren
suffix:semicolon
id|proceed_active_entry
c_func
(paren
id|id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|exception
)paren
(brace
id|proceed_active_area
c_func
(paren
id|id
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|id-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|active
suffix:semicolon
)brace
multiline_comment|/*&n; * debug_event_common:&n; * - write debug entry with given size&n; */
DECL|function|debug_event_common
id|debug_entry_t
op_star
id|debug_event_common
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_int
id|level
comma
r_const
r_void
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_return
id|debug_common
c_func
(paren
id|id
comma
id|level
comma
id|buf
comma
id|len
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * debug_exception_common:&n; * - write debug entry with given size and switch to next debug area&n; */
DECL|function|debug_exception_common
id|debug_entry_t
op_star
id|debug_exception_common
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_int
id|level
comma
r_const
r_void
op_star
id|buf
comma
r_int
id|len
)paren
(brace
r_return
id|debug_common
c_func
(paren
id|id
comma
id|level
comma
id|buf
comma
id|len
comma
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * counts arguments in format string for sprintf view&n; */
DECL|function|debug_count_numargs
r_extern
r_inline
r_int
id|debug_count_numargs
c_func
(paren
r_char
op_star
id|string
)paren
(brace
r_int
id|numargs
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_star
id|string
)paren
(brace
r_if
c_cond
(paren
op_star
id|string
op_increment
op_eq
l_char|&squot;%&squot;
)paren
(brace
id|numargs
op_increment
suffix:semicolon
)brace
)brace
r_return
id|numargs
suffix:semicolon
)brace
multiline_comment|/*&n; * debug_sprintf_event:&n; */
DECL|function|debug_sprintf_event
id|debug_entry_t
op_star
id|debug_sprintf_event
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_int
id|level
comma
r_char
op_star
id|string
comma
dot
dot
dot
)paren
(brace
id|va_list
id|ap
suffix:semicolon
r_int
id|numargs
comma
id|alloc_size
comma
id|idx
suffix:semicolon
id|debug_sprintf_entry
op_star
id|curr_event
suffix:semicolon
id|debug_entry_t
op_star
id|retval
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|id
)paren
op_logical_or
(paren
id|level
OG
id|id-&gt;level
)paren
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|numargs
op_assign
id|debug_count_numargs
c_func
(paren
id|string
)paren
suffix:semicolon
id|alloc_size
op_assign
m_offsetof
(paren
id|debug_sprintf_entry
comma
id|args
(braket
id|numargs
)braket
)paren
suffix:semicolon
id|curr_event
op_assign
id|alloca
c_func
(paren
id|alloc_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|curr_event
)paren
(brace
id|va_start
c_func
(paren
id|ap
comma
id|string
)paren
suffix:semicolon
id|curr_event-&gt;string
op_assign
id|string
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|numargs
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|curr_event-&gt;args
(braket
id|idx
)braket
op_assign
id|va_arg
c_func
(paren
id|ap
comma
r_int
)paren
suffix:semicolon
)brace
id|retval
op_assign
id|debug_common
c_func
(paren
id|id
comma
id|level
comma
id|curr_event
comma
id|alloc_size
comma
l_int|0
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|ap
)paren
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * debug_sprintf_exception:&n; */
DECL|function|debug_sprintf_exception
id|debug_entry_t
op_star
id|debug_sprintf_exception
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_int
id|level
comma
r_char
op_star
id|string
comma
dot
dot
dot
)paren
(brace
id|va_list
id|ap
suffix:semicolon
r_int
id|numargs
comma
id|alloc_size
comma
id|idx
suffix:semicolon
id|debug_sprintf_entry
op_star
id|curr_event
suffix:semicolon
id|debug_entry_t
op_star
id|retval
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|id
)paren
op_logical_or
(paren
id|level
OG
id|id-&gt;level
)paren
)paren
(brace
r_return
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|numargs
op_assign
id|debug_count_numargs
c_func
(paren
id|string
)paren
suffix:semicolon
id|alloc_size
op_assign
m_offsetof
(paren
id|debug_sprintf_entry
comma
id|args
(braket
id|numargs
)braket
)paren
suffix:semicolon
id|curr_event
op_assign
id|alloca
c_func
(paren
id|alloc_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|curr_event
)paren
(brace
id|va_start
c_func
(paren
id|ap
comma
id|string
)paren
suffix:semicolon
id|curr_event-&gt;string
op_assign
id|string
suffix:semicolon
r_for
c_loop
(paren
id|idx
op_assign
l_int|0
suffix:semicolon
id|idx
OL
id|numargs
suffix:semicolon
id|idx
op_increment
)paren
(brace
id|curr_event-&gt;args
(braket
id|idx
)braket
op_assign
id|va_arg
c_func
(paren
id|ap
comma
r_int
)paren
suffix:semicolon
)brace
id|retval
op_assign
id|debug_common
c_func
(paren
id|id
comma
id|level
comma
id|curr_event
comma
id|alloc_size
comma
l_int|1
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|ap
)paren
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * debug_init:&n; * - is called exactly once to initialize the debug feature&n; */
DECL|function|debug_init
r_int
id|debug_init
c_func
(paren
r_void
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|debug_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|initialized
)paren
(brace
id|debug_proc_root_entry
op_assign
id|proc_mkdir
c_func
(paren
id|DEBUG_DIR_ROOT
comma
l_int|NULL
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;debug: Initialization complete&bslash;n&quot;
)paren
suffix:semicolon
id|initialized
op_assign
l_int|1
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|debug_lock
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * debug_register_view:&n; */
DECL|function|debug_register_view
r_int
id|debug_register_view
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_struct
id|debug_view
op_star
id|view
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|mode_t
id|mode
op_assign
id|S_IFREG
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|id
)paren
r_goto
id|out
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|id-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DEBUG_MAX_VIEWS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|id-&gt;views
(braket
id|i
)braket
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
id|DEBUG_MAX_VIEWS
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;debug: cannot register view %s/%s&bslash;n&quot;
comma
id|id-&gt;name
comma
id|view-&gt;name
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;debug: maximum number of views reached (%i)!&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|id-&gt;views
(braket
id|i
)braket
op_assign
id|view
suffix:semicolon
r_if
c_cond
(paren
id|view-&gt;prolog_proc
op_logical_or
id|view-&gt;format_proc
op_logical_or
id|view-&gt;header_proc
)paren
id|mode
op_or_assign
id|S_IRUSR
suffix:semicolon
r_if
c_cond
(paren
id|view-&gt;input_proc
)paren
id|mode
op_or_assign
id|S_IWUSR
suffix:semicolon
id|id-&gt;proc_entries
(braket
id|i
)braket
op_assign
id|debug_create_proc_dir_entry
c_func
(paren
id|id-&gt;proc_root_entry
comma
id|view-&gt;name
comma
id|mode
comma
op_amp
id|debug_file_ops
)paren
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|id-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * debug_unregister_view:&n; */
DECL|function|debug_unregister_view
r_int
id|debug_unregister_view
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_struct
id|debug_view
op_star
id|view
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|id
)paren
r_goto
id|out
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|id-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DEBUG_MAX_VIEWS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|id-&gt;views
(braket
id|i
)braket
op_eq
id|view
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
id|DEBUG_MAX_VIEWS
)paren
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
r_else
(brace
id|debug_delete_proc_dir_entry
c_func
(paren
id|id-&gt;proc_root_entry
comma
id|id-&gt;proc_entries
(braket
id|i
)braket
)paren
suffix:semicolon
id|id-&gt;views
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|id-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * functions for debug-views&n; ***********************************&n;*/
multiline_comment|/*&n; * prints out actual debug level&n; */
DECL|function|debug_prolog_level_fn
r_static
r_int
id|debug_prolog_level_fn
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_struct
id|debug_view
op_star
id|view
comma
r_char
op_star
id|out_buf
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|id-&gt;level
op_eq
op_minus
l_int|1
)paren
(brace
id|rc
op_assign
id|sprintf
c_func
(paren
id|out_buf
comma
l_string|&quot;-&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
id|rc
op_assign
id|sprintf
c_func
(paren
id|out_buf
comma
l_string|&quot;%i&bslash;n&quot;
comma
id|id-&gt;level
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * reads new debug level&n; */
DECL|function|debug_input_level_fn
r_static
r_int
id|debug_input_level_fn
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_struct
id|debug_view
op_star
id|view
comma
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|user_buf
comma
r_int
id|in_buf_size
comma
id|loff_t
op_star
id|offset
)paren
(brace
r_char
id|input_buf
(braket
l_int|1
)braket
suffix:semicolon
r_int
id|rc
op_assign
id|in_buf_size
suffix:semicolon
r_if
c_cond
(paren
op_star
id|offset
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|input_buf
comma
id|user_buf
comma
l_int|1
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|isdigit
c_func
(paren
id|input_buf
(braket
l_int|0
)braket
)paren
)paren
(brace
r_int
id|new_level
op_assign
(paren
(paren
r_int
)paren
id|input_buf
(braket
l_int|0
)braket
op_minus
(paren
r_int
)paren
l_char|&squot;0&squot;
)paren
suffix:semicolon
id|debug_set_level
c_func
(paren
id|id
comma
id|new_level
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|input_buf
(braket
l_int|0
)braket
op_eq
l_char|&squot;-&squot;
)paren
(brace
id|debug_set_level
c_func
(paren
id|id
comma
id|DEBUG_OFF_LEVEL
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;debug: level `%c` is not valid&bslash;n&quot;
comma
id|input_buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
id|out
suffix:colon
op_star
id|offset
op_add_assign
id|in_buf_size
suffix:semicolon
r_return
id|rc
suffix:semicolon
multiline_comment|/* number of input characters */
)brace
multiline_comment|/*&n; * flushes debug areas&n; */
DECL|function|debug_flush
r_void
id|debug_flush
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_int
id|area
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|id
)paren
(brace
r_return
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|id-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|area
op_eq
id|DEBUG_FLUSH_ALL
)paren
(brace
id|id-&gt;active_area
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|id-&gt;active_entry
comma
l_int|0
comma
id|id-&gt;nr_areas
op_star
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|id-&gt;nr_areas
suffix:semicolon
id|i
op_increment
)paren
id|memset
c_func
(paren
id|id-&gt;areas
(braket
id|i
)braket
comma
l_int|0
comma
id|PAGE_SIZE
op_lshift
id|id-&gt;page_order
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;debug: %s: all areas flushed&bslash;n&quot;
comma
id|id-&gt;name
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|area
op_ge
l_int|0
op_logical_and
id|area
OL
id|id-&gt;nr_areas
)paren
(brace
id|id-&gt;active_entry
(braket
id|area
)braket
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
id|id-&gt;areas
(braket
id|area
)braket
comma
l_int|0
comma
id|PAGE_SIZE
op_lshift
id|id-&gt;page_order
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;debug: %s: area %i has been flushed&bslash;n&quot;
comma
id|id-&gt;name
comma
id|area
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;debug: %s: area %i cannot be flushed (range: %i - %i)&bslash;n&quot;
comma
id|id-&gt;name
comma
id|area
comma
l_int|0
comma
id|id-&gt;nr_areas
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|id-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * view function: flushes debug areas &n; */
DECL|function|debug_input_flush_fn
r_static
r_int
id|debug_input_flush_fn
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_struct
id|debug_view
op_star
id|view
comma
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|user_buf
comma
r_int
id|in_buf_size
comma
id|loff_t
op_star
id|offset
)paren
(brace
r_char
id|input_buf
(braket
l_int|1
)braket
suffix:semicolon
r_int
id|rc
op_assign
id|in_buf_size
suffix:semicolon
r_if
c_cond
(paren
op_star
id|offset
op_ne
l_int|0
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|input_buf
comma
id|user_buf
comma
l_int|1
)paren
)paren
(brace
id|rc
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|input_buf
(braket
l_int|0
)braket
op_eq
l_char|&squot;-&squot;
)paren
(brace
id|debug_flush
c_func
(paren
id|id
comma
id|DEBUG_FLUSH_ALL
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|isdigit
c_func
(paren
id|input_buf
(braket
l_int|0
)braket
)paren
)paren
(brace
r_int
id|area
op_assign
(paren
(paren
r_int
)paren
id|input_buf
(braket
l_int|0
)braket
op_minus
(paren
r_int
)paren
l_char|&squot;0&squot;
)paren
suffix:semicolon
id|debug_flush
c_func
(paren
id|id
comma
id|area
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;debug: area `%c` is not valid&bslash;n&quot;
comma
id|input_buf
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|out
suffix:colon
op_star
id|offset
op_add_assign
id|in_buf_size
suffix:semicolon
r_return
id|rc
suffix:semicolon
multiline_comment|/* number of input characters */
)brace
multiline_comment|/*&n; * prints debug header in raw format&n; */
DECL|function|debug_raw_header_fn
r_int
id|debug_raw_header_fn
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_struct
id|debug_view
op_star
id|view
comma
r_int
id|area
comma
id|debug_entry_t
op_star
id|entry
comma
r_char
op_star
id|out_buf
)paren
(brace
r_int
id|rc
suffix:semicolon
id|rc
op_assign
r_sizeof
(paren
id|debug_entry_t
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|out_buf
comma
id|entry
comma
r_sizeof
(paren
id|debug_entry_t
)paren
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * prints debug data in raw format&n; */
DECL|function|debug_raw_format_fn
r_static
r_int
id|debug_raw_format_fn
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_struct
id|debug_view
op_star
id|view
comma
r_char
op_star
id|out_buf
comma
r_const
r_char
op_star
id|in_buf
)paren
(brace
r_int
id|rc
suffix:semicolon
id|rc
op_assign
id|id-&gt;buf_size
suffix:semicolon
id|memcpy
c_func
(paren
id|out_buf
comma
id|in_buf
comma
id|id-&gt;buf_size
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * prints debug data in hex/ascii format&n; */
DECL|function|debug_hex_ascii_format_fn
r_static
r_int
id|debug_hex_ascii_format_fn
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_struct
id|debug_view
op_star
id|view
comma
r_char
op_star
id|out_buf
comma
r_const
r_char
op_star
id|in_buf
)paren
(brace
r_int
id|i
comma
id|rc
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|id-&gt;buf_size
suffix:semicolon
id|i
op_increment
)paren
(brace
id|rc
op_add_assign
id|sprintf
c_func
(paren
id|out_buf
op_plus
id|rc
comma
l_string|&quot;%02x &quot;
comma
(paren
(paren
r_int
r_char
op_star
)paren
id|in_buf
)paren
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|rc
op_add_assign
id|sprintf
c_func
(paren
id|out_buf
op_plus
id|rc
comma
l_string|&quot;| &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|id-&gt;buf_size
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_char
id|c
op_assign
id|in_buf
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isprint
c_func
(paren
id|c
)paren
)paren
id|rc
op_add_assign
id|sprintf
c_func
(paren
id|out_buf
op_plus
id|rc
comma
l_string|&quot;.&quot;
)paren
suffix:semicolon
r_else
id|rc
op_add_assign
id|sprintf
c_func
(paren
id|out_buf
op_plus
id|rc
comma
l_string|&quot;%c&quot;
comma
id|c
)paren
suffix:semicolon
)brace
id|rc
op_add_assign
id|sprintf
c_func
(paren
id|out_buf
op_plus
id|rc
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * prints header for debug entry&n; */
DECL|function|debug_dflt_header_fn
r_int
id|debug_dflt_header_fn
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_struct
id|debug_view
op_star
id|view
comma
r_int
id|area
comma
id|debug_entry_t
op_star
id|entry
comma
r_char
op_star
id|out_buf
)paren
(brace
r_struct
id|timeval
id|time_val
suffix:semicolon
r_int
r_int
r_int
id|time
suffix:semicolon
r_char
op_star
id|except_str
suffix:semicolon
r_int
r_int
id|caller
suffix:semicolon
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|level
suffix:semicolon
id|level
op_assign
id|entry-&gt;id.fields.level
suffix:semicolon
id|time
op_assign
id|entry-&gt;id.stck
suffix:semicolon
multiline_comment|/* adjust todclock to 1970 */
id|time
op_sub_assign
l_int|0x8126d60e46000000LL
op_minus
(paren
l_int|0x3c26700LL
op_star
l_int|1000000
op_star
l_int|4096
)paren
suffix:semicolon
id|tod_to_timeval
c_func
(paren
id|time
comma
op_amp
id|time_val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry-&gt;id.fields.exception
)paren
id|except_str
op_assign
l_string|&quot;*&quot;
suffix:semicolon
r_else
id|except_str
op_assign
l_string|&quot;-&quot;
suffix:semicolon
id|caller
op_assign
(paren
r_int
r_int
)paren
id|entry-&gt;caller
suffix:semicolon
macro_line|#if defined(CONFIG_ARCH_S390X)
id|rc
op_add_assign
id|sprintf
c_func
(paren
id|out_buf
comma
l_string|&quot;%02i %011lu:%06lu %1u %1s %02i %016lx  &quot;
comma
id|area
comma
id|time_val.tv_sec
comma
id|time_val.tv_usec
comma
id|level
comma
id|except_str
comma
id|entry-&gt;id.fields.cpuid
comma
id|caller
)paren
suffix:semicolon
macro_line|#else
id|caller
op_and_assign
l_int|0x7fffffff
suffix:semicolon
id|rc
op_add_assign
id|sprintf
c_func
(paren
id|out_buf
comma
l_string|&quot;%02i %011lu:%06lu %1u %1s %02i %08lx  &quot;
comma
id|area
comma
id|time_val.tv_sec
comma
id|time_val.tv_usec
comma
id|level
comma
id|except_str
comma
id|entry-&gt;id.fields.cpuid
comma
id|caller
)paren
suffix:semicolon
macro_line|#endif
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * prints debug data sprintf-formated:&n; * debug_sprinf_event/exception calls must be used together with this view&n; */
DECL|macro|DEBUG_SPRINTF_MAX_ARGS
mdefine_line|#define DEBUG_SPRINTF_MAX_ARGS 10
DECL|function|debug_sprintf_format_fn
r_int
id|debug_sprintf_format_fn
c_func
(paren
id|debug_info_t
op_star
id|id
comma
r_struct
id|debug_view
op_star
id|view
comma
r_char
op_star
id|out_buf
comma
id|debug_sprintf_entry
op_star
id|curr_event
)paren
(brace
r_int
id|num_longs
comma
id|num_used_args
op_assign
l_int|0
comma
id|i
comma
id|rc
op_assign
l_int|0
suffix:semicolon
r_int
id|index
(braket
id|DEBUG_SPRINTF_MAX_ARGS
)braket
suffix:semicolon
multiline_comment|/* count of longs fit into one entry */
id|num_longs
op_assign
id|id-&gt;buf_size
op_div
r_sizeof
(paren
r_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|num_longs
OL
l_int|1
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* bufsize of entry too small */
r_if
c_cond
(paren
id|num_longs
op_eq
l_int|1
)paren
(brace
multiline_comment|/* no args, we use only the string */
id|strcpy
c_func
(paren
id|out_buf
comma
id|curr_event-&gt;string
)paren
suffix:semicolon
id|rc
op_assign
id|strlen
c_func
(paren
id|curr_event-&gt;string
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* number of arguments used for sprintf (without the format string) */
id|num_used_args
op_assign
id|MIN
c_func
(paren
id|DEBUG_SPRINTF_MAX_ARGS
comma
(paren
id|num_longs
op_minus
l_int|1
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|index
comma
l_int|0
comma
id|DEBUG_SPRINTF_MAX_ARGS
op_star
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_used_args
suffix:semicolon
id|i
op_increment
)paren
(brace
id|index
(braket
id|i
)braket
op_assign
id|i
suffix:semicolon
)brace
id|rc
op_assign
id|sprintf
c_func
(paren
id|out_buf
comma
id|curr_event-&gt;string
comma
id|curr_event-&gt;args
(braket
id|index
(braket
l_int|0
)braket
)braket
comma
id|curr_event-&gt;args
(braket
id|index
(braket
l_int|1
)braket
)braket
comma
id|curr_event-&gt;args
(braket
id|index
(braket
l_int|2
)braket
)braket
comma
id|curr_event-&gt;args
(braket
id|index
(braket
l_int|3
)braket
)braket
comma
id|curr_event-&gt;args
(braket
id|index
(braket
l_int|4
)braket
)braket
comma
id|curr_event-&gt;args
(braket
id|index
(braket
l_int|5
)braket
)braket
comma
id|curr_event-&gt;args
(braket
id|index
(braket
l_int|6
)braket
)braket
comma
id|curr_event-&gt;args
(braket
id|index
(braket
l_int|7
)braket
)braket
comma
id|curr_event-&gt;args
(braket
id|index
(braket
l_int|8
)braket
)braket
comma
id|curr_event-&gt;args
(braket
id|index
(braket
l_int|9
)braket
)braket
)paren
suffix:semicolon
id|out
suffix:colon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * init_module:&n; */
macro_line|#ifdef MODULE
DECL|function|init_module
r_int
id|init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|rc
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
l_string|&quot;debug_module_init: &bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|rc
op_assign
id|debug_init
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;debug: an error occurred with debug_init&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * cleanup_module:&n; */
DECL|function|cleanup_module
r_void
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
l_string|&quot;debug_cleanup_module: &bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|debug_delete_proc_dir_entry
c_func
(paren
l_int|NULL
comma
id|debug_proc_root_entry
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif&t;&t;&t;/* MODULE */
DECL|variable|debug_register
id|EXPORT_SYMBOL
c_func
(paren
id|debug_register
)paren
suffix:semicolon
DECL|variable|debug_unregister
id|EXPORT_SYMBOL
c_func
(paren
id|debug_unregister
)paren
suffix:semicolon
DECL|variable|debug_set_level
id|EXPORT_SYMBOL
c_func
(paren
id|debug_set_level
)paren
suffix:semicolon
DECL|variable|debug_register_view
id|EXPORT_SYMBOL
c_func
(paren
id|debug_register_view
)paren
suffix:semicolon
DECL|variable|debug_unregister_view
id|EXPORT_SYMBOL
c_func
(paren
id|debug_unregister_view
)paren
suffix:semicolon
DECL|variable|debug_event_common
id|EXPORT_SYMBOL
c_func
(paren
id|debug_event_common
)paren
suffix:semicolon
DECL|variable|debug_exception_common
id|EXPORT_SYMBOL
c_func
(paren
id|debug_exception_common
)paren
suffix:semicolon
DECL|variable|debug_hex_ascii_view
id|EXPORT_SYMBOL
c_func
(paren
id|debug_hex_ascii_view
)paren
suffix:semicolon
DECL|variable|debug_raw_view
id|EXPORT_SYMBOL
c_func
(paren
id|debug_raw_view
)paren
suffix:semicolon
DECL|variable|debug_dflt_header_fn
id|EXPORT_SYMBOL
c_func
(paren
id|debug_dflt_header_fn
)paren
suffix:semicolon
DECL|variable|debug_sprintf_view
id|EXPORT_SYMBOL
c_func
(paren
id|debug_sprintf_view
)paren
suffix:semicolon
DECL|variable|debug_sprintf_exception
id|EXPORT_SYMBOL
c_func
(paren
id|debug_sprintf_exception
)paren
suffix:semicolon
DECL|variable|debug_sprintf_event
id|EXPORT_SYMBOL
c_func
(paren
id|debug_sprintf_event
)paren
suffix:semicolon
eof
