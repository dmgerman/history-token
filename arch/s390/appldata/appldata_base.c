multiline_comment|/*&n; * arch/s390/appldata/appldata_base.c&n; *&n; * Base infrastructure for Linux-z/VM Monitor Stream, Stage 1.&n; * Exports appldata_register_ops() and appldata_unregister_ops() for the&n; * data gathering modules.&n; *&n; * Copyright (C) 2003 IBM Corporation, IBM Deutschland Entwicklung GmbH.&n; *&n; * Author: Gerald Schaefer &lt;geraldsc@de.ibm.com&gt;&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/smp.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/page-flags.h&gt;
macro_line|#include &lt;linux/swap.h&gt;
macro_line|#include &lt;linux/pagemap.h&gt;
macro_line|#include &lt;linux/sysctl.h&gt;
macro_line|#include &lt;asm/timer.h&gt;
singleline_comment|//#include &lt;linux/kernel_stat.h&gt;
macro_line|#include &lt;linux/notifier.h&gt;
macro_line|#include &lt;linux/cpu.h&gt;
macro_line|#include &quot;appldata.h&quot;
DECL|macro|MY_PRINT_NAME
mdefine_line|#define MY_PRINT_NAME&t;&quot;appldata&quot;&t;&t;/* for debug messages, etc. */
DECL|macro|APPLDATA_CPU_INTERVAL
mdefine_line|#define APPLDATA_CPU_INTERVAL&t;10000&t;&t;/* default (CPU) time for&n;&t;&t;&t;&t;&t;&t;   sampling interval in&n;&t;&t;&t;&t;&t;&t;   milliseconds */
DECL|macro|TOD_MICRO
mdefine_line|#define TOD_MICRO&t;0x01000&t;&t;&t;/* nr. of TOD clock units&n;&t;&t;&t;&t;&t;&t;   for 1 microsecond */
macro_line|#ifndef CONFIG_ARCH_S390X
DECL|macro|APPLDATA_START_INTERVAL_REC
mdefine_line|#define APPLDATA_START_INTERVAL_REC 0x00   &t;/* Function codes for */
DECL|macro|APPLDATA_STOP_REC
mdefine_line|#define APPLDATA_STOP_REC&t;    0x01&t;/* DIAG 0xDC&t;  */
DECL|macro|APPLDATA_GEN_EVENT_RECORD
mdefine_line|#define APPLDATA_GEN_EVENT_RECORD   0x02
DECL|macro|APPLDATA_START_CONFIG_REC
mdefine_line|#define APPLDATA_START_CONFIG_REC   0x03
macro_line|#else
DECL|macro|APPLDATA_START_INTERVAL_REC
mdefine_line|#define APPLDATA_START_INTERVAL_REC 0x80
DECL|macro|APPLDATA_STOP_REC
mdefine_line|#define APPLDATA_STOP_REC   &t;    0x81
DECL|macro|APPLDATA_GEN_EVENT_RECORD
mdefine_line|#define APPLDATA_GEN_EVENT_RECORD   0x82
DECL|macro|APPLDATA_START_CONFIG_REC
mdefine_line|#define APPLDATA_START_CONFIG_REC   0x83
macro_line|#endif /* CONFIG_ARCH_S390X */
multiline_comment|/*&n; * Parameter list for DIAGNOSE X&squot;DC&squot;&n; */
macro_line|#ifndef CONFIG_ARCH_S390X
DECL|struct|appldata_parameter_list
r_struct
id|appldata_parameter_list
(brace
DECL|member|diag
id|u16
id|diag
suffix:semicolon
multiline_comment|/* The DIAGNOSE code X&squot;00DC&squot;          */
DECL|member|function
id|u8
id|function
suffix:semicolon
multiline_comment|/* The function code for the DIAGNOSE */
DECL|member|parlist_length
id|u8
id|parlist_length
suffix:semicolon
multiline_comment|/* Length of the parameter list       */
DECL|member|product_id_addr
id|u32
id|product_id_addr
suffix:semicolon
multiline_comment|/* Address of the 16-byte product ID  */
DECL|member|reserved
id|u16
id|reserved
suffix:semicolon
DECL|member|buffer_length
id|u16
id|buffer_length
suffix:semicolon
multiline_comment|/* Length of the application data buffer  */
DECL|member|buffer_addr
id|u32
id|buffer_addr
suffix:semicolon
multiline_comment|/* Address of the application data buffer */
)brace
suffix:semicolon
macro_line|#else
DECL|struct|appldata_parameter_list
r_struct
id|appldata_parameter_list
(brace
DECL|member|diag
id|u16
id|diag
suffix:semicolon
DECL|member|function
id|u8
id|function
suffix:semicolon
DECL|member|parlist_length
id|u8
id|parlist_length
suffix:semicolon
DECL|member|unused01
id|u32
id|unused01
suffix:semicolon
DECL|member|reserved
id|u16
id|reserved
suffix:semicolon
DECL|member|buffer_length
id|u16
id|buffer_length
suffix:semicolon
DECL|member|unused02
id|u32
id|unused02
suffix:semicolon
DECL|member|product_id_addr
id|u64
id|product_id_addr
suffix:semicolon
DECL|member|buffer_addr
id|u64
id|buffer_addr
suffix:semicolon
)brace
suffix:semicolon
macro_line|#endif /* CONFIG_ARCH_S390X */
multiline_comment|/*&n; * /proc entries (sysctl)&n; */
DECL|variable|appldata_proc_name
r_static
r_const
r_char
id|appldata_proc_name
(braket
id|APPLDATA_PROC_NAME_LENGTH
)braket
op_assign
l_string|&quot;appldata&quot;
suffix:semicolon
r_static
r_int
id|appldata_timer_handler
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|filp
comma
r_void
id|__user
op_star
id|buffer
comma
r_int
op_star
id|lenp
comma
id|loff_t
op_star
id|ppos
)paren
suffix:semicolon
r_static
r_int
id|appldata_interval_handler
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|filp
comma
r_void
id|__user
op_star
id|buffer
comma
r_int
op_star
id|lenp
comma
id|loff_t
op_star
id|ppos
)paren
suffix:semicolon
DECL|variable|appldata_sysctl_header
r_static
r_struct
id|ctl_table_header
op_star
id|appldata_sysctl_header
suffix:semicolon
DECL|variable|appldata_table
r_static
r_struct
id|ctl_table
id|appldata_table
(braket
)braket
op_assign
(brace
(brace
dot
id|ctl_name
op_assign
id|CTL_APPLDATA_TIMER
comma
dot
id|procname
op_assign
l_string|&quot;timer&quot;
comma
dot
id|mode
op_assign
id|S_IRUGO
op_or
id|S_IWUSR
comma
dot
id|proc_handler
op_assign
op_amp
id|appldata_timer_handler
comma
)brace
comma
(brace
dot
id|ctl_name
op_assign
id|CTL_APPLDATA_INTERVAL
comma
dot
id|procname
op_assign
l_string|&quot;interval&quot;
comma
dot
id|mode
op_assign
id|S_IRUGO
op_or
id|S_IWUSR
comma
dot
id|proc_handler
op_assign
op_amp
id|appldata_interval_handler
comma
)brace
comma
(brace
dot
id|ctl_name
op_assign
l_int|0
)brace
)brace
suffix:semicolon
DECL|variable|appldata_dir_table
r_static
r_struct
id|ctl_table
id|appldata_dir_table
(braket
)braket
op_assign
(brace
(brace
dot
id|ctl_name
op_assign
id|CTL_APPLDATA
comma
dot
id|procname
op_assign
id|appldata_proc_name
comma
dot
id|maxlen
op_assign
l_int|0
comma
dot
id|mode
op_assign
id|S_IRUGO
op_or
id|S_IXUGO
comma
dot
id|child
op_assign
id|appldata_table
comma
)brace
comma
(brace
dot
id|ctl_name
op_assign
l_int|0
)brace
)brace
suffix:semicolon
multiline_comment|/*&n; * Timer&n; */
id|DEFINE_PER_CPU
c_func
(paren
r_struct
id|vtimer_list
comma
id|appldata_timer
)paren
suffix:semicolon
DECL|variable|appldata_expire_count
r_static
id|atomic_t
id|appldata_expire_count
op_assign
id|ATOMIC_INIT
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_static
id|DEFINE_SPINLOCK
c_func
(paren
id|appldata_timer_lock
)paren
suffix:semicolon
DECL|variable|appldata_interval
r_static
r_int
id|appldata_interval
op_assign
id|APPLDATA_CPU_INTERVAL
suffix:semicolon
DECL|variable|appldata_timer_active
r_static
r_int
id|appldata_timer_active
suffix:semicolon
multiline_comment|/*&n; * Tasklet&n; */
DECL|variable|appldata_tasklet_struct
r_static
r_struct
id|tasklet_struct
id|appldata_tasklet_struct
suffix:semicolon
multiline_comment|/*&n; * Ops list&n; */
r_static
id|DEFINE_SPINLOCK
c_func
(paren
id|appldata_ops_lock
)paren
suffix:semicolon
r_static
id|LIST_HEAD
c_func
(paren
id|appldata_ops_list
)paren
suffix:semicolon
multiline_comment|/************************* timer, tasklet, DIAG ******************************/
multiline_comment|/*&n; * appldata_timer_function()&n; *&n; * schedule tasklet and reschedule timer&n; */
DECL|function|appldata_timer_function
r_static
r_void
id|appldata_timer_function
c_func
(paren
r_int
r_int
id|data
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|P_DEBUG
c_func
(paren
l_string|&quot;   -= Timer =-&bslash;n&quot;
)paren
suffix:semicolon
id|P_DEBUG
c_func
(paren
l_string|&quot;CPU: %i, expire_count: %i&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|atomic_read
c_func
(paren
op_amp
id|appldata_expire_count
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_dec_and_test
c_func
(paren
op_amp
id|appldata_expire_count
)paren
)paren
(brace
id|atomic_set
c_func
(paren
op_amp
id|appldata_expire_count
comma
id|num_online_cpus
c_func
(paren
)paren
)paren
suffix:semicolon
id|tasklet_schedule
c_func
(paren
(paren
r_struct
id|tasklet_struct
op_star
)paren
id|data
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * appldata_tasklet_function()&n; *&n; * call data gathering function for each (active) module&n; */
DECL|function|appldata_tasklet_function
r_static
r_void
id|appldata_tasklet_function
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|list_head
op_star
id|lh
suffix:semicolon
r_struct
id|appldata_ops
op_star
id|ops
suffix:semicolon
r_int
id|i
suffix:semicolon
id|P_DEBUG
c_func
(paren
l_string|&quot;  -= Tasklet =-&bslash;n&quot;
)paren
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|appldata_ops_lock
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|lh
comma
op_amp
id|appldata_ops_list
)paren
(brace
id|ops
op_assign
id|list_entry
c_func
(paren
id|lh
comma
r_struct
id|appldata_ops
comma
id|list
)paren
suffix:semicolon
id|P_DEBUG
c_func
(paren
l_string|&quot;list_for_each loop: %i) active = %u, name = %s&bslash;n&quot;
comma
op_increment
id|i
comma
id|ops-&gt;active
comma
id|ops-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ops-&gt;active
op_eq
l_int|1
)paren
(brace
id|ops
op_member_access_from_pointer
id|callback
c_func
(paren
id|ops-&gt;data
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock
c_func
(paren
op_amp
id|appldata_ops_lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * appldata_diag()&n; *&n; * prepare parameter list, issue DIAG 0xDC&n; */
DECL|function|appldata_diag
r_static
r_int
id|appldata_diag
c_func
(paren
r_char
id|record_nr
comma
id|u16
id|function
comma
r_int
r_int
id|buffer
comma
id|u16
id|length
)paren
(brace
r_int
r_int
id|ry
suffix:semicolon
r_struct
id|appldata_product_id
(brace
r_char
id|prod_nr
(braket
l_int|7
)braket
suffix:semicolon
multiline_comment|/* product nr. */
r_char
id|prod_fn
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* product function */
r_char
id|record_nr
suffix:semicolon
multiline_comment|/* record nr. */
r_char
id|version_nr
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* version */
r_char
id|release_nr
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* release */
r_char
id|mod_lvl
(braket
l_int|2
)braket
suffix:semicolon
multiline_comment|/* modification lvl. */
)brace
id|appldata_product_id
op_assign
(brace
multiline_comment|/* all strings are EBCDIC, record_nr is byte */
dot
id|prod_nr
op_assign
(brace
l_int|0xD3
comma
l_int|0xC9
comma
l_int|0xD5
comma
l_int|0xE4
comma
l_int|0xE7
comma
l_int|0xD2
comma
l_int|0xD9
)brace
comma
multiline_comment|/* &quot;LINUXKR&quot; */
dot
id|prod_fn
op_assign
(brace
l_int|0xD5
comma
l_int|0xD3
)brace
comma
multiline_comment|/* &quot;NL&quot; */
dot
id|record_nr
op_assign
id|record_nr
comma
dot
id|version_nr
op_assign
(brace
l_int|0xF2
comma
l_int|0xF6
)brace
comma
multiline_comment|/* &quot;26&quot; */
dot
id|release_nr
op_assign
(brace
l_int|0xF0
comma
l_int|0xF1
)brace
comma
multiline_comment|/* &quot;01&quot; */
dot
id|mod_lvl
op_assign
(brace
l_int|0xF0
comma
l_int|0xF0
)brace
comma
multiline_comment|/* &quot;00&quot; */
)brace
suffix:semicolon
r_struct
id|appldata_parameter_list
id|appldata_parameter_list
op_assign
(brace
dot
id|diag
op_assign
l_int|0xDC
comma
dot
id|function
op_assign
id|function
comma
dot
id|parlist_length
op_assign
r_sizeof
(paren
id|appldata_parameter_list
)paren
comma
dot
id|buffer_length
op_assign
id|length
comma
dot
id|product_id_addr
op_assign
(paren
r_int
r_int
)paren
op_amp
id|appldata_product_id
comma
dot
id|buffer_addr
op_assign
id|virt_to_phys
c_func
(paren
(paren
r_void
op_star
)paren
id|buffer
)paren
)brace
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|MACHINE_IS_VM
)paren
r_return
op_minus
id|ENOSYS
suffix:semicolon
id|ry
op_assign
op_minus
l_int|1
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;diag %1,%0,0xDC&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=d&quot;
(paren
id|ry
)paren
suffix:colon
l_string|&quot;d&quot;
(paren
op_amp
(paren
id|appldata_parameter_list
)paren
)paren
suffix:colon
l_string|&quot;cc&quot;
)paren
suffix:semicolon
r_return
(paren
r_int
)paren
id|ry
suffix:semicolon
)brace
multiline_comment|/********************** timer, tasklet, DIAG &lt;END&gt; ***************************/
multiline_comment|/****************************** /proc stuff **********************************/
multiline_comment|/*&n; * appldata_mod_vtimer_wrap()&n; *&n; * wrapper function for mod_virt_timer(), because smp_call_function_on()&n; * accepts only one parameter.&n; */
DECL|function|__appldata_mod_vtimer_wrap
r_static
r_void
id|__appldata_mod_vtimer_wrap
c_func
(paren
r_void
op_star
id|p
)paren
(brace
r_struct
(brace
r_struct
id|vtimer_list
op_star
id|timer
suffix:semicolon
id|u64
id|expires
suffix:semicolon
)brace
op_star
id|args
op_assign
id|p
suffix:semicolon
id|mod_virt_timer
c_func
(paren
id|args-&gt;timer
comma
id|args-&gt;expires
)paren
suffix:semicolon
)brace
DECL|macro|APPLDATA_ADD_TIMER
mdefine_line|#define APPLDATA_ADD_TIMER&t;0
DECL|macro|APPLDATA_DEL_TIMER
mdefine_line|#define APPLDATA_DEL_TIMER&t;1
DECL|macro|APPLDATA_MOD_TIMER
mdefine_line|#define APPLDATA_MOD_TIMER&t;2
multiline_comment|/*&n; * __appldata_vtimer_setup()&n; *&n; * Add, delete or modify virtual timers on all online cpus.&n; * The caller needs to get the appldata_timer_lock spinlock.&n; */
r_static
r_void
DECL|function|__appldata_vtimer_setup
id|__appldata_vtimer_setup
c_func
(paren
r_int
id|cmd
)paren
(brace
id|u64
id|per_cpu_interval
suffix:semicolon
r_int
id|i
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|APPLDATA_ADD_TIMER
suffix:colon
r_if
c_cond
(paren
id|appldata_timer_active
)paren
r_break
suffix:semicolon
id|per_cpu_interval
op_assign
(paren
id|u64
)paren
(paren
id|appldata_interval
op_star
l_int|1000
op_div
id|num_online_cpus
c_func
(paren
)paren
)paren
op_star
id|TOD_MICRO
suffix:semicolon
id|for_each_online_cpu
c_func
(paren
id|i
)paren
(brace
id|per_cpu
c_func
(paren
id|appldata_timer
comma
id|i
)paren
dot
id|expires
op_assign
id|per_cpu_interval
suffix:semicolon
id|smp_call_function_on
c_func
(paren
id|add_virt_timer_periodic
comma
op_amp
id|per_cpu
c_func
(paren
id|appldata_timer
comma
id|i
)paren
comma
l_int|0
comma
l_int|1
comma
id|i
)paren
suffix:semicolon
)brace
id|appldata_timer_active
op_assign
l_int|1
suffix:semicolon
id|P_INFO
c_func
(paren
l_string|&quot;Monitoring timer started.&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|APPLDATA_DEL_TIMER
suffix:colon
id|for_each_online_cpu
c_func
(paren
id|i
)paren
id|del_virt_timer
c_func
(paren
op_amp
id|per_cpu
c_func
(paren
id|appldata_timer
comma
id|i
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|appldata_timer_active
)paren
r_break
suffix:semicolon
id|appldata_timer_active
op_assign
l_int|0
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|appldata_expire_count
comma
id|num_online_cpus
c_func
(paren
)paren
)paren
suffix:semicolon
id|P_INFO
c_func
(paren
l_string|&quot;Monitoring timer stopped.&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|APPLDATA_MOD_TIMER
suffix:colon
id|per_cpu_interval
op_assign
(paren
id|u64
)paren
(paren
id|appldata_interval
op_star
l_int|1000
op_div
id|num_online_cpus
c_func
(paren
)paren
)paren
op_star
id|TOD_MICRO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|appldata_timer_active
)paren
r_break
suffix:semicolon
id|for_each_online_cpu
c_func
(paren
id|i
)paren
(brace
r_struct
(brace
r_struct
id|vtimer_list
op_star
id|timer
suffix:semicolon
id|u64
id|expires
suffix:semicolon
)brace
id|args
suffix:semicolon
id|args.timer
op_assign
op_amp
id|per_cpu
c_func
(paren
id|appldata_timer
comma
id|i
)paren
suffix:semicolon
id|args.expires
op_assign
id|per_cpu_interval
suffix:semicolon
id|smp_call_function_on
c_func
(paren
id|__appldata_mod_vtimer_wrap
comma
op_amp
id|args
comma
l_int|0
comma
l_int|1
comma
id|i
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; * appldata_timer_handler()&n; *&n; * Start/Stop timer, show status of timer (0 = not active, 1 = active)&n; */
r_static
r_int
DECL|function|appldata_timer_handler
id|appldata_timer_handler
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|filp
comma
r_void
id|__user
op_star
id|buffer
comma
r_int
op_star
id|lenp
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_int
id|len
suffix:semicolon
r_char
id|buf
(braket
l_int|2
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|lenp
op_logical_or
op_star
id|ppos
)paren
(brace
op_star
id|lenp
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|write
)paren
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|buf
comma
id|appldata_timer_active
ques
c_cond
l_string|&quot;1&bslash;n&quot;
suffix:colon
l_string|&quot;0&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
op_star
id|lenp
)paren
id|len
op_assign
op_star
id|lenp
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buffer
comma
id|buf
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|len
op_assign
op_star
id|lenp
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|buf
comma
id|buffer
comma
id|len
OG
r_sizeof
(paren
id|buf
)paren
ques
c_cond
r_sizeof
(paren
id|buf
)paren
suffix:colon
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|appldata_timer_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf
(braket
l_int|0
)braket
op_eq
l_char|&squot;1&squot;
)paren
id|__appldata_vtimer_setup
c_func
(paren
id|APPLDATA_ADD_TIMER
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|buf
(braket
l_int|0
)braket
op_eq
l_char|&squot;0&squot;
)paren
id|__appldata_vtimer_setup
c_func
(paren
id|APPLDATA_DEL_TIMER
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|appldata_timer_lock
)paren
suffix:semicolon
id|out
suffix:colon
op_star
id|lenp
op_assign
id|len
suffix:semicolon
op_star
id|ppos
op_add_assign
id|len
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * appldata_interval_handler()&n; *&n; * Set (CPU) timer interval for collection of data (in milliseconds), show&n; * current timer interval.&n; */
r_static
r_int
DECL|function|appldata_interval_handler
id|appldata_interval_handler
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|filp
comma
r_void
id|__user
op_star
id|buffer
comma
r_int
op_star
id|lenp
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_int
id|len
comma
id|interval
suffix:semicolon
r_char
id|buf
(braket
l_int|16
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|lenp
op_logical_or
op_star
id|ppos
)paren
(brace
op_star
id|lenp
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|write
)paren
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%i&bslash;n&quot;
comma
id|appldata_interval
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
op_star
id|lenp
)paren
id|len
op_assign
op_star
id|lenp
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buffer
comma
id|buf
comma
id|len
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|len
op_assign
op_star
id|lenp
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|buf
comma
id|buffer
comma
id|len
OG
r_sizeof
(paren
id|buf
)paren
ques
c_cond
r_sizeof
(paren
id|buf
)paren
suffix:colon
id|len
)paren
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|sscanf
c_func
(paren
id|buf
comma
l_string|&quot;%i&quot;
comma
op_amp
id|interval
)paren
suffix:semicolon
r_if
c_cond
(paren
id|interval
op_le
l_int|0
)paren
(brace
id|P_ERROR
c_func
(paren
l_string|&quot;Timer CPU interval has to be &gt; 0!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_lock
c_func
(paren
op_amp
id|appldata_timer_lock
)paren
suffix:semicolon
id|appldata_interval
op_assign
id|interval
suffix:semicolon
id|__appldata_vtimer_setup
c_func
(paren
id|APPLDATA_MOD_TIMER
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|appldata_timer_lock
)paren
suffix:semicolon
id|P_INFO
c_func
(paren
l_string|&quot;Monitoring CPU interval set to %u milliseconds.&bslash;n&quot;
comma
id|interval
)paren
suffix:semicolon
id|out
suffix:colon
op_star
id|lenp
op_assign
id|len
suffix:semicolon
op_star
id|ppos
op_add_assign
id|len
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * appldata_generic_handler()&n; *&n; * Generic start/stop monitoring and DIAG, show status of&n; * monitoring (0 = not in process, 1 = in process)&n; */
r_static
r_int
DECL|function|appldata_generic_handler
id|appldata_generic_handler
c_func
(paren
id|ctl_table
op_star
id|ctl
comma
r_int
id|write
comma
r_struct
id|file
op_star
id|filp
comma
r_void
id|__user
op_star
id|buffer
comma
r_int
op_star
id|lenp
comma
id|loff_t
op_star
id|ppos
)paren
(brace
r_struct
id|appldata_ops
op_star
id|ops
op_assign
l_int|NULL
comma
op_star
id|tmp_ops
suffix:semicolon
r_int
id|rc
comma
id|len
comma
id|found
suffix:semicolon
r_char
id|buf
(braket
l_int|2
)braket
suffix:semicolon
r_struct
id|list_head
op_star
id|lh
suffix:semicolon
id|found
op_assign
l_int|0
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|appldata_ops_lock
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|lh
comma
op_amp
id|appldata_ops_list
)paren
(brace
id|tmp_ops
op_assign
id|list_entry
c_func
(paren
id|lh
comma
r_struct
id|appldata_ops
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
op_amp
id|tmp_ops-&gt;ctl_table
(braket
l_int|2
)braket
op_eq
id|ctl
)paren
(brace
id|found
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|found
)paren
(brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|appldata_ops_lock
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|ops
op_assign
id|ctl-&gt;data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|try_module_get
c_func
(paren
id|ops-&gt;owner
)paren
)paren
(brace
singleline_comment|// protect this function
id|spin_unlock_bh
c_func
(paren
op_amp
id|appldata_ops_lock
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|appldata_ops_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|lenp
op_logical_or
op_star
id|ppos
)paren
(brace
op_star
id|lenp
op_assign
l_int|0
suffix:semicolon
id|module_put
c_func
(paren
id|ops-&gt;owner
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|write
)paren
(brace
id|len
op_assign
id|sprintf
c_func
(paren
id|buf
comma
id|ops-&gt;active
ques
c_cond
l_string|&quot;1&bslash;n&quot;
suffix:colon
l_string|&quot;0&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
op_star
id|lenp
)paren
id|len
op_assign
op_star
id|lenp
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|buffer
comma
id|buf
comma
id|len
)paren
)paren
(brace
id|module_put
c_func
(paren
id|ops-&gt;owner
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_goto
id|out
suffix:semicolon
)brace
id|len
op_assign
op_star
id|lenp
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|buf
comma
id|buffer
comma
id|len
OG
r_sizeof
(paren
id|buf
)paren
ques
c_cond
r_sizeof
(paren
id|buf
)paren
suffix:colon
id|len
)paren
)paren
(brace
id|module_put
c_func
(paren
id|ops-&gt;owner
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|spin_lock_bh
c_func
(paren
op_amp
id|appldata_ops_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|buf
(braket
l_int|0
)braket
op_eq
l_char|&squot;1&squot;
)paren
op_logical_and
(paren
id|ops-&gt;active
op_eq
l_int|0
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|try_module_get
c_func
(paren
id|ops-&gt;owner
)paren
)paren
(brace
singleline_comment|// protect tasklet
id|spin_unlock_bh
c_func
(paren
op_amp
id|appldata_ops_lock
)paren
suffix:semicolon
id|module_put
c_func
(paren
id|ops-&gt;owner
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|ops-&gt;active
op_assign
l_int|1
suffix:semicolon
id|ops
op_member_access_from_pointer
id|callback
c_func
(paren
id|ops-&gt;data
)paren
suffix:semicolon
singleline_comment|// init record
id|rc
op_assign
id|appldata_diag
c_func
(paren
id|ops-&gt;record_nr
comma
id|APPLDATA_START_INTERVAL_REC
comma
(paren
r_int
r_int
)paren
id|ops-&gt;data
comma
id|ops-&gt;size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
)paren
(brace
id|P_ERROR
c_func
(paren
l_string|&quot;START DIAG 0xDC for %s failed, &quot;
l_string|&quot;return code: %d&bslash;n&quot;
comma
id|ops-&gt;name
comma
id|rc
)paren
suffix:semicolon
id|module_put
c_func
(paren
id|ops-&gt;owner
)paren
suffix:semicolon
id|ops-&gt;active
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|P_INFO
c_func
(paren
l_string|&quot;Monitoring %s data enabled, &quot;
l_string|&quot;DIAG 0xDC started.&bslash;n&quot;
comma
id|ops-&gt;name
)paren
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
(paren
id|buf
(braket
l_int|0
)braket
op_eq
l_char|&squot;0&squot;
)paren
op_logical_and
(paren
id|ops-&gt;active
op_eq
l_int|1
)paren
)paren
(brace
id|ops-&gt;active
op_assign
l_int|0
suffix:semicolon
id|rc
op_assign
id|appldata_diag
c_func
(paren
id|ops-&gt;record_nr
comma
id|APPLDATA_STOP_REC
comma
(paren
r_int
r_int
)paren
id|ops-&gt;data
comma
id|ops-&gt;size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
)paren
(brace
id|P_ERROR
c_func
(paren
l_string|&quot;STOP DIAG 0xDC for %s failed, &quot;
l_string|&quot;return code: %d&bslash;n&quot;
comma
id|ops-&gt;name
comma
id|rc
)paren
suffix:semicolon
)brace
r_else
(brace
id|P_INFO
c_func
(paren
l_string|&quot;Monitoring %s data disabled, &quot;
l_string|&quot;DIAG 0xDC stopped.&bslash;n&quot;
comma
id|ops-&gt;name
)paren
suffix:semicolon
)brace
id|module_put
c_func
(paren
id|ops-&gt;owner
)paren
suffix:semicolon
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|appldata_ops_lock
)paren
suffix:semicolon
id|out
suffix:colon
op_star
id|lenp
op_assign
id|len
suffix:semicolon
op_star
id|ppos
op_add_assign
id|len
suffix:semicolon
id|module_put
c_func
(paren
id|ops-&gt;owner
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*************************** /proc stuff &lt;END&gt; *******************************/
multiline_comment|/************************* module-ops management *****************************/
multiline_comment|/*&n; * appldata_register_ops()&n; *&n; * update ops list, register /proc/sys entries&n; */
DECL|function|appldata_register_ops
r_int
id|appldata_register_ops
c_func
(paren
r_struct
id|appldata_ops
op_star
id|ops
)paren
(brace
r_struct
id|list_head
op_star
id|lh
suffix:semicolon
r_struct
id|appldata_ops
op_star
id|tmp_ops
suffix:semicolon
r_int
id|i
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ops-&gt;size
OG
id|APPLDATA_MAX_REC_SIZE
)paren
op_logical_or
(paren
id|ops-&gt;size
OL
l_int|0
)paren
)paren
(brace
id|P_ERROR
c_func
(paren
l_string|&quot;Invalid size of %s record = %i, maximum = %i!&bslash;n&quot;
comma
id|ops-&gt;name
comma
id|ops-&gt;size
comma
id|APPLDATA_MAX_REC_SIZE
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|ops-&gt;ctl_nr
op_eq
id|CTL_APPLDATA
)paren
op_logical_or
(paren
id|ops-&gt;ctl_nr
op_eq
id|CTL_APPLDATA_TIMER
)paren
op_logical_or
(paren
id|ops-&gt;ctl_nr
op_eq
id|CTL_APPLDATA_INTERVAL
)paren
)paren
(brace
id|P_ERROR
c_func
(paren
l_string|&quot;ctl_nr %i already in use!&bslash;n&quot;
comma
id|ops-&gt;ctl_nr
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|ops-&gt;ctl_table
op_assign
id|kmalloc
c_func
(paren
l_int|4
op_star
r_sizeof
(paren
r_struct
id|ctl_table
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ops-&gt;ctl_table
op_eq
l_int|NULL
)paren
(brace
id|P_ERROR
c_func
(paren
l_string|&quot;Not enough memory for %s ctl_table!&bslash;n&quot;
comma
id|ops-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|ops-&gt;ctl_table
comma
l_int|0
comma
l_int|4
op_star
r_sizeof
(paren
r_struct
id|ctl_table
)paren
)paren
suffix:semicolon
id|spin_lock_bh
c_func
(paren
op_amp
id|appldata_ops_lock
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|lh
comma
op_amp
id|appldata_ops_list
)paren
(brace
id|tmp_ops
op_assign
id|list_entry
c_func
(paren
id|lh
comma
r_struct
id|appldata_ops
comma
id|list
)paren
suffix:semicolon
id|P_DEBUG
c_func
(paren
l_string|&quot;register_ops loop: %i) name = %s, ctl = %i&bslash;n&quot;
comma
op_increment
id|i
comma
id|tmp_ops-&gt;name
comma
id|tmp_ops-&gt;ctl_nr
)paren
suffix:semicolon
id|P_DEBUG
c_func
(paren
l_string|&quot;Comparing %s (ctl %i) with %s (ctl %i)&bslash;n&quot;
comma
id|tmp_ops-&gt;name
comma
id|tmp_ops-&gt;ctl_nr
comma
id|ops-&gt;name
comma
id|ops-&gt;ctl_nr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|tmp_ops-&gt;name
comma
id|ops-&gt;name
comma
id|APPLDATA_PROC_NAME_LENGTH
)paren
op_eq
l_int|0
)paren
(brace
id|P_ERROR
c_func
(paren
l_string|&quot;Name &bslash;&quot;%s&bslash;&quot; already registered!&bslash;n&quot;
comma
id|ops-&gt;name
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ops-&gt;ctl_table
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|appldata_ops_lock
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tmp_ops-&gt;ctl_nr
op_eq
id|ops-&gt;ctl_nr
)paren
(brace
id|P_ERROR
c_func
(paren
l_string|&quot;ctl_nr %i already registered!&bslash;n&quot;
comma
id|ops-&gt;ctl_nr
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ops-&gt;ctl_table
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|appldata_ops_lock
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
)brace
id|list_add
c_func
(paren
op_amp
id|ops-&gt;list
comma
op_amp
id|appldata_ops_list
)paren
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|appldata_ops_lock
)paren
suffix:semicolon
id|ops-&gt;ctl_table
(braket
l_int|0
)braket
dot
id|ctl_name
op_assign
id|CTL_APPLDATA
suffix:semicolon
id|ops-&gt;ctl_table
(braket
l_int|0
)braket
dot
id|procname
op_assign
id|appldata_proc_name
suffix:semicolon
id|ops-&gt;ctl_table
(braket
l_int|0
)braket
dot
id|maxlen
op_assign
l_int|0
suffix:semicolon
id|ops-&gt;ctl_table
(braket
l_int|0
)braket
dot
id|mode
op_assign
id|S_IRUGO
op_or
id|S_IXUGO
suffix:semicolon
id|ops-&gt;ctl_table
(braket
l_int|0
)braket
dot
id|child
op_assign
op_amp
id|ops-&gt;ctl_table
(braket
l_int|2
)braket
suffix:semicolon
id|ops-&gt;ctl_table
(braket
l_int|1
)braket
dot
id|ctl_name
op_assign
l_int|0
suffix:semicolon
id|ops-&gt;ctl_table
(braket
l_int|2
)braket
dot
id|ctl_name
op_assign
id|ops-&gt;ctl_nr
suffix:semicolon
id|ops-&gt;ctl_table
(braket
l_int|2
)braket
dot
id|procname
op_assign
id|ops-&gt;name
suffix:semicolon
id|ops-&gt;ctl_table
(braket
l_int|2
)braket
dot
id|mode
op_assign
id|S_IRUGO
op_or
id|S_IWUSR
suffix:semicolon
id|ops-&gt;ctl_table
(braket
l_int|2
)braket
dot
id|proc_handler
op_assign
id|appldata_generic_handler
suffix:semicolon
id|ops-&gt;ctl_table
(braket
l_int|2
)braket
dot
id|data
op_assign
id|ops
suffix:semicolon
id|ops-&gt;ctl_table
(braket
l_int|3
)braket
dot
id|ctl_name
op_assign
l_int|0
suffix:semicolon
id|ops-&gt;sysctl_header
op_assign
id|register_sysctl_table
c_func
(paren
id|ops-&gt;ctl_table
comma
l_int|1
)paren
suffix:semicolon
id|P_INFO
c_func
(paren
l_string|&quot;%s-ops registered!&bslash;n&quot;
comma
id|ops-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * appldata_unregister_ops()&n; *&n; * update ops list, unregister /proc entries, stop DIAG if necessary&n; */
DECL|function|appldata_unregister_ops
r_void
id|appldata_unregister_ops
c_func
(paren
r_struct
id|appldata_ops
op_star
id|ops
)paren
(brace
id|spin_lock_bh
c_func
(paren
op_amp
id|appldata_ops_lock
)paren
suffix:semicolon
id|unregister_sysctl_table
c_func
(paren
id|ops-&gt;sysctl_header
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|ops-&gt;list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ops-&gt;ctl_table
)paren
suffix:semicolon
id|ops-&gt;ctl_table
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_bh
c_func
(paren
op_amp
id|appldata_ops_lock
)paren
suffix:semicolon
id|P_INFO
c_func
(paren
l_string|&quot;%s-ops unregistered!&bslash;n&quot;
comma
id|ops-&gt;name
)paren
suffix:semicolon
)brace
multiline_comment|/********************** module-ops management &lt;END&gt; **************************/
multiline_comment|/******************************* init / exit *********************************/
r_static
r_void
DECL|function|appldata_online_cpu
id|appldata_online_cpu
c_func
(paren
r_int
id|cpu
)paren
(brace
id|init_virt_timer
c_func
(paren
op_amp
id|per_cpu
c_func
(paren
id|appldata_timer
comma
id|cpu
)paren
)paren
suffix:semicolon
id|per_cpu
c_func
(paren
id|appldata_timer
comma
id|cpu
)paren
dot
id|function
op_assign
id|appldata_timer_function
suffix:semicolon
id|per_cpu
c_func
(paren
id|appldata_timer
comma
id|cpu
)paren
dot
id|data
op_assign
(paren
r_int
r_int
)paren
op_amp
id|appldata_tasklet_struct
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|appldata_expire_count
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|appldata_timer_lock
)paren
suffix:semicolon
id|__appldata_vtimer_setup
c_func
(paren
id|APPLDATA_MOD_TIMER
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|appldata_timer_lock
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|appldata_offline_cpu
id|appldata_offline_cpu
c_func
(paren
r_int
id|cpu
)paren
(brace
id|del_virt_timer
c_func
(paren
op_amp
id|per_cpu
c_func
(paren
id|appldata_timer
comma
id|cpu
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|atomic_dec_and_test
c_func
(paren
op_amp
id|appldata_expire_count
)paren
)paren
(brace
id|atomic_set
c_func
(paren
op_amp
id|appldata_expire_count
comma
id|num_online_cpus
c_func
(paren
)paren
)paren
suffix:semicolon
id|tasklet_schedule
c_func
(paren
op_amp
id|appldata_tasklet_struct
)paren
suffix:semicolon
)brace
id|spin_lock
c_func
(paren
op_amp
id|appldata_timer_lock
)paren
suffix:semicolon
id|__appldata_vtimer_setup
c_func
(paren
id|APPLDATA_MOD_TIMER
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|appldata_timer_lock
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|appldata_cpu_notify
id|appldata_cpu_notify
c_func
(paren
r_struct
id|notifier_block
op_star
id|self
comma
r_int
r_int
id|action
comma
r_void
op_star
id|hcpu
)paren
(brace
r_switch
c_cond
(paren
id|action
)paren
(brace
r_case
id|CPU_ONLINE
suffix:colon
id|appldata_online_cpu
c_func
(paren
(paren
r_int
)paren
id|hcpu
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_HOTPLUG_CPU
r_case
id|CPU_DEAD
suffix:colon
id|appldata_offline_cpu
c_func
(paren
(paren
r_int
)paren
id|hcpu
)paren
suffix:semicolon
r_break
suffix:semicolon
macro_line|#endif
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
id|NOTIFY_OK
suffix:semicolon
)brace
DECL|variable|appldata_nb
r_static
r_struct
id|notifier_block
id|__devinitdata
id|appldata_nb
op_assign
(brace
dot
id|notifier_call
op_assign
id|appldata_cpu_notify
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * appldata_init()&n; *&n; * init timer and tasklet, register /proc entries&n; */
DECL|function|appldata_init
r_static
r_int
id|__init
id|appldata_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|P_DEBUG
c_func
(paren
l_string|&quot;sizeof(parameter_list) = %lu&bslash;n&quot;
comma
r_sizeof
(paren
r_struct
id|appldata_parameter_list
)paren
)paren
suffix:semicolon
id|for_each_online_cpu
c_func
(paren
id|i
)paren
id|appldata_online_cpu
c_func
(paren
id|i
)paren
suffix:semicolon
multiline_comment|/* Register cpu hotplug notifier */
id|register_cpu_notifier
c_func
(paren
op_amp
id|appldata_nb
)paren
suffix:semicolon
id|appldata_sysctl_header
op_assign
id|register_sysctl_table
c_func
(paren
id|appldata_dir_table
comma
l_int|1
)paren
suffix:semicolon
macro_line|#ifdef MODULE
id|appldata_dir_table
(braket
l_int|0
)braket
dot
id|de-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
id|appldata_table
(braket
l_int|0
)braket
dot
id|de-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
id|appldata_table
(braket
l_int|1
)braket
dot
id|de-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
macro_line|#endif
id|tasklet_init
c_func
(paren
op_amp
id|appldata_tasklet_struct
comma
id|appldata_tasklet_function
comma
l_int|0
)paren
suffix:semicolon
id|P_DEBUG
c_func
(paren
l_string|&quot;Base interface initialized.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * appldata_exit()&n; *&n; * stop timer and tasklet, unregister /proc entries&n; */
DECL|function|appldata_exit
r_static
r_void
id|__exit
id|appldata_exit
c_func
(paren
r_void
)paren
(brace
r_struct
id|list_head
op_star
id|lh
suffix:semicolon
r_struct
id|appldata_ops
op_star
id|ops
suffix:semicolon
r_int
id|rc
comma
id|i
suffix:semicolon
id|P_DEBUG
c_func
(paren
l_string|&quot;Unloading module ...&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * ops list should be empty, but just in case something went wrong...&n;&t; */
id|spin_lock_bh
c_func
(paren
op_amp
id|appldata_ops_lock
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|lh
comma
op_amp
id|appldata_ops_list
)paren
(brace
id|ops
op_assign
id|list_entry
c_func
(paren
id|lh
comma
r_struct
id|appldata_ops
comma
id|list
)paren
suffix:semicolon
id|rc
op_assign
id|appldata_diag
c_func
(paren
id|ops-&gt;record_nr
comma
id|APPLDATA_STOP_REC
comma
(paren
r_int
r_int
)paren
id|ops-&gt;data
comma
id|ops-&gt;size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_ne
l_int|0
)paren
(brace
id|P_ERROR
c_func
(paren
l_string|&quot;STOP DIAG 0xDC for %s failed, &quot;
l_string|&quot;return code: %d&bslash;n&quot;
comma
id|ops-&gt;name
comma
id|rc
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock_bh
c_func
(paren
op_amp
id|appldata_ops_lock
)paren
suffix:semicolon
id|for_each_online_cpu
c_func
(paren
id|i
)paren
id|appldata_offline_cpu
c_func
(paren
id|i
)paren
suffix:semicolon
id|appldata_timer_active
op_assign
l_int|0
suffix:semicolon
id|unregister_sysctl_table
c_func
(paren
id|appldata_sysctl_header
)paren
suffix:semicolon
id|tasklet_kill
c_func
(paren
op_amp
id|appldata_tasklet_struct
)paren
suffix:semicolon
id|P_DEBUG
c_func
(paren
l_string|&quot;... module unloaded!&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/**************************** init / exit &lt;END&gt; ******************************/
DECL|variable|appldata_init
id|module_init
c_func
(paren
id|appldata_init
)paren
suffix:semicolon
DECL|variable|appldata_exit
id|module_exit
c_func
(paren
id|appldata_exit
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Gerald Schaefer&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Linux-VM Monitor Stream, base infrastructure&quot;
)paren
suffix:semicolon
DECL|variable|appldata_register_ops
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|appldata_register_ops
)paren
suffix:semicolon
DECL|variable|appldata_unregister_ops
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|appldata_unregister_ops
)paren
suffix:semicolon
macro_line|#ifdef MODULE
multiline_comment|/*&n; * Kernel symbols needed by appldata_mem and appldata_os modules.&n; * However, if this file is compiled as a module (for testing only), these&n; * symbols are not exported. In this case, we define them locally and export&n; * those.&n; */
DECL|function|si_swapinfo
r_void
id|si_swapinfo
c_func
(paren
r_struct
id|sysinfo
op_star
id|val
)paren
(brace
id|val-&gt;freeswap
op_assign
op_minus
l_int|1ul
suffix:semicolon
id|val-&gt;totalswap
op_assign
op_minus
l_int|1ul
suffix:semicolon
)brace
DECL|variable|avenrun
r_int
r_int
id|avenrun
(braket
l_int|3
)braket
op_assign
(brace
op_minus
l_int|1
op_minus
id|FIXED_1
op_div
l_int|200
comma
op_minus
l_int|1
op_minus
id|FIXED_1
op_div
l_int|200
comma
op_minus
l_int|1
op_minus
id|FIXED_1
op_div
l_int|200
)brace
suffix:semicolon
DECL|variable|nr_threads
r_int
id|nr_threads
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|function|get_full_page_state
r_void
id|get_full_page_state
c_func
(paren
r_struct
id|page_state
op_star
id|ps
)paren
(brace
id|memset
c_func
(paren
id|ps
comma
op_minus
l_int|1
comma
r_sizeof
(paren
r_struct
id|page_state
)paren
)paren
suffix:semicolon
)brace
DECL|function|nr_running
r_int
r_int
id|nr_running
c_func
(paren
r_void
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|nr_iowait
r_int
r_int
id|nr_iowait
c_func
(paren
r_void
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*unsigned long nr_context_switches(void)&n;{&n;&t;return -1;&n;}*/
macro_line|#endif /* MODULE */
DECL|variable|si_swapinfo
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|si_swapinfo
)paren
suffix:semicolon
DECL|variable|nr_threads
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|nr_threads
)paren
suffix:semicolon
DECL|variable|avenrun
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|avenrun
)paren
suffix:semicolon
DECL|variable|get_full_page_state
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|get_full_page_state
)paren
suffix:semicolon
DECL|variable|nr_running
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|nr_running
)paren
suffix:semicolon
DECL|variable|nr_iowait
id|EXPORT_SYMBOL_GPL
c_func
(paren
id|nr_iowait
)paren
suffix:semicolon
singleline_comment|//EXPORT_SYMBOL_GPL(nr_context_switches);
eof
