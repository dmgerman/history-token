multiline_comment|/*&n; * Linux/PA-RISC Project (http://www.parisc-linux.org/)&n; *&n; * Floating-point emulation code&n; *  Copyright (C) 2001 Hewlett-Packard (Paul Bame) &lt;bame@debian.org&gt;&n; *&n; *    This program is free software; you can redistribute it and/or modify&n; *    it under the terms of the GNU General Public License as published by&n; *    the Free Software Foundation; either version 2, or (at your option)&n; *    any later version.&n; *&n; *    This program is distributed in the hope that it will be useful,&n; *    but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *    GNU General Public License for more details.&n; *&n; *    You should have received a copy of the GNU General Public License&n; *    along with this program; if not, write to the Free Software&n; *    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; */
multiline_comment|/*&n; * BEGIN_DESC&n; *&n; *  File:&n; *&t;@(#)&t;pa/fp/fpudispatch.c&t;&t;$Revision: 1.1 $&n; *&n; *  Purpose:&n; *&t;&lt;&lt;please update with a synopsis of the functionality provided by this file&gt;&gt;&n; *&n; *  External Interfaces:&n; *&t;&lt;&lt;the following list was autogenerated, please review&gt;&gt;&n; *&t;emfpudispatch(ir, dummy1, dummy2, fpregs)&n; *&t;fpudispatch(ir, excp_code, holder, fpregs)&n; *&n; *  Internal Interfaces:&n; *&t;&lt;&lt;the following list was autogenerated, please review&gt;&gt;&n; *&t;static u_int decode_06(u_int, u_int *)&n; *&t;static u_int decode_0c(u_int, u_int, u_int, u_int *)&n; *&t;static u_int decode_0e(u_int, u_int, u_int, u_int *)&n; *&t;static u_int decode_26(u_int, u_int *)&n; *&t;static u_int decode_2e(u_int, u_int *)&n; *&t;static void update_status_cbit(u_int *, u_int, u_int, u_int)&n; *&n; *  Theory:&n; *&t;&lt;&lt;please update with a overview of the operation of this file&gt;&gt;&n; *&n; * END_DESC&n;*/
DECL|macro|FPUDEBUG
mdefine_line|#define FPUDEBUG 0
macro_line|#include &quot;float.h&quot;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
multiline_comment|/* #include &lt;sys/debug.h&gt; */
multiline_comment|/* #include &lt;machine/sys/mdep_private.h&gt; */
DECL|macro|COPR_INST
mdefine_line|#define COPR_INST 0x30000000
multiline_comment|/*&n; * definition of extru macro.  If pos and len are constants, the compiler&n; * will generate an extru instruction when optimized&n; */
DECL|macro|extru
mdefine_line|#define extru(r,pos,len)&t;(((r) &gt;&gt; (31-(pos))) &amp; (( 1 &lt;&lt; (len)) - 1))
multiline_comment|/* definitions of bit field locations in the instruction */
DECL|macro|fpmajorpos
mdefine_line|#define fpmajorpos 5
DECL|macro|fpr1pos
mdefine_line|#define fpr1pos&t;10
DECL|macro|fpr2pos
mdefine_line|#define fpr2pos 15
DECL|macro|fptpos
mdefine_line|#define fptpos&t;31
DECL|macro|fpsubpos
mdefine_line|#define fpsubpos 18
DECL|macro|fpclass1subpos
mdefine_line|#define fpclass1subpos 16
DECL|macro|fpclasspos
mdefine_line|#define fpclasspos 22
DECL|macro|fpfmtpos
mdefine_line|#define fpfmtpos 20
DECL|macro|fpdfpos
mdefine_line|#define fpdfpos 18
DECL|macro|fpnulpos
mdefine_line|#define fpnulpos 26
multiline_comment|/*&n; * the following are the extra bits for the 0E major op&n; */
DECL|macro|fpxr1pos
mdefine_line|#define fpxr1pos 24
DECL|macro|fpxr2pos
mdefine_line|#define fpxr2pos 19
DECL|macro|fpxtpos
mdefine_line|#define fpxtpos 25
DECL|macro|fpxpos
mdefine_line|#define fpxpos 23
DECL|macro|fp0efmtpos
mdefine_line|#define fp0efmtpos 20
multiline_comment|/*&n; * the following are for the multi-ops&n; */
DECL|macro|fprm1pos
mdefine_line|#define fprm1pos 10
DECL|macro|fprm2pos
mdefine_line|#define fprm2pos 15
DECL|macro|fptmpos
mdefine_line|#define fptmpos 31
DECL|macro|fprapos
mdefine_line|#define fprapos 25
DECL|macro|fptapos
mdefine_line|#define fptapos 20
DECL|macro|fpmultifmt
mdefine_line|#define fpmultifmt 26
multiline_comment|/*&n; * the following are for the fused FP instructions&n; */
multiline_comment|/* fprm1pos 10 */
multiline_comment|/* fprm2pos 15 */
DECL|macro|fpraupos
mdefine_line|#define fpraupos 18
DECL|macro|fpxrm2pos
mdefine_line|#define fpxrm2pos 19
multiline_comment|/* fpfmtpos 20 */
DECL|macro|fpralpos
mdefine_line|#define fpralpos 23
DECL|macro|fpxrm1pos
mdefine_line|#define fpxrm1pos 24
multiline_comment|/* fpxtpos 25 */
DECL|macro|fpfusedsubop
mdefine_line|#define fpfusedsubop 26
multiline_comment|/* fptpos&t;31 */
multiline_comment|/*&n; * offset to constant zero in the FP emulation registers&n; */
DECL|macro|fpzeroreg
mdefine_line|#define fpzeroreg (32*sizeof(double)/sizeof(u_int))
multiline_comment|/*&n; * extract the major opcode from the instruction&n; */
DECL|macro|get_major
mdefine_line|#define get_major(op) extru(op,fpmajorpos,6)
multiline_comment|/*&n; * extract the two bit class field from the FP instruction. The class is at bit&n; * positions 21-22&n; */
DECL|macro|get_class
mdefine_line|#define get_class(op) extru(op,fpclasspos,2)
multiline_comment|/*&n; * extract the 3 bit subop field.  For all but class 1 instructions, it is&n; * located at bit positions 16-18&n; */
DECL|macro|get_subop
mdefine_line|#define get_subop(op) extru(op,fpsubpos,3)
multiline_comment|/*&n; * extract the 2 or 3 bit subop field from class 1 instructions.  It is located&n; * at bit positions 15-16 (PA1.1) or 14-16 (PA2.0)&n; */
DECL|macro|get_subop1_PA1_1
mdefine_line|#define get_subop1_PA1_1(op) extru(op,fpclass1subpos,2)&t;/* PA89 (1.1) fmt */
DECL|macro|get_subop1_PA2_0
mdefine_line|#define get_subop1_PA2_0(op) extru(op,fpclass1subpos,3)&t;/* PA 2.0 fmt */
multiline_comment|/* definitions of unimplemented exceptions */
DECL|macro|MAJOR_0C_EXCP
mdefine_line|#define MAJOR_0C_EXCP&t;0x09
DECL|macro|MAJOR_0E_EXCP
mdefine_line|#define MAJOR_0E_EXCP&t;0x0b
DECL|macro|MAJOR_06_EXCP
mdefine_line|#define MAJOR_06_EXCP&t;0x03
DECL|macro|MAJOR_26_EXCP
mdefine_line|#define MAJOR_26_EXCP&t;0x23
DECL|macro|MAJOR_2E_EXCP
mdefine_line|#define MAJOR_2E_EXCP&t;0x2b
DECL|macro|PA83_UNIMP_EXCP
mdefine_line|#define PA83_UNIMP_EXCP&t;0x01
multiline_comment|/*&n; * Special Defines for TIMEX specific code&n; */
DECL|macro|FPU_TYPE_FLAG_POS
mdefine_line|#define FPU_TYPE_FLAG_POS (EM_FPU_TYPE_OFFSET&gt;&gt;2)
DECL|macro|TIMEX_ROLEX_FPU_MASK
mdefine_line|#define TIMEX_ROLEX_FPU_MASK (TIMEX_EXTEN_FLAG|ROLEX_EXTEN_FLAG)
multiline_comment|/*&n; * Static function definitions&n; */
DECL|macro|_PROTOTYPES
mdefine_line|#define _PROTOTYPES
macro_line|#if defined(_PROTOTYPES) || defined(_lint)
r_static
id|u_int
id|decode_0c
c_func
(paren
id|u_int
comma
id|u_int
comma
id|u_int
comma
id|u_int
op_star
)paren
suffix:semicolon
r_static
id|u_int
id|decode_0e
c_func
(paren
id|u_int
comma
id|u_int
comma
id|u_int
comma
id|u_int
op_star
)paren
suffix:semicolon
r_static
id|u_int
id|decode_06
c_func
(paren
id|u_int
comma
id|u_int
op_star
)paren
suffix:semicolon
r_static
id|u_int
id|decode_26
c_func
(paren
id|u_int
comma
id|u_int
op_star
)paren
suffix:semicolon
r_static
id|u_int
id|decode_2e
c_func
(paren
id|u_int
comma
id|u_int
op_star
)paren
suffix:semicolon
r_static
r_void
id|update_status_cbit
c_func
(paren
id|u_int
op_star
comma
id|u_int
comma
id|u_int
comma
id|u_int
)paren
suffix:semicolon
macro_line|#else /* !_PROTOTYPES&amp;&amp;!_lint */
r_static
id|u_int
id|decode_0c
c_func
(paren
)paren
suffix:semicolon
r_static
id|u_int
id|decode_0e
c_func
(paren
)paren
suffix:semicolon
r_static
id|u_int
id|decode_06
c_func
(paren
)paren
suffix:semicolon
r_static
id|u_int
id|decode_26
c_func
(paren
)paren
suffix:semicolon
r_static
id|u_int
id|decode_2e
c_func
(paren
)paren
suffix:semicolon
r_static
r_void
id|update_status_cbit
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif /* _PROTOTYPES&amp;&amp;!_lint */
DECL|macro|VASSERT
mdefine_line|#define VASSERT(x)
DECL|function|parisc_linux_get_fpu_type
r_static
r_void
id|parisc_linux_get_fpu_type
c_func
(paren
id|u_int
id|fpregs
(braket
)braket
)paren
(brace
multiline_comment|/* on pa-linux the fpu type is not filled in by the&n;&t; * caller; it is constructed here  &n;&t; */
r_if
c_cond
(paren
id|boot_cpu_data.cpu_type
op_eq
id|pcxs
)paren
id|fpregs
(braket
id|FPU_TYPE_FLAG_POS
)braket
op_assign
id|TIMEX_EXTEN_FLAG
suffix:semicolon
r_else
r_if
c_cond
(paren
id|boot_cpu_data.cpu_type
op_eq
id|pcxt
op_logical_or
id|boot_cpu_data.cpu_type
op_eq
id|pcxt_
)paren
id|fpregs
(braket
id|FPU_TYPE_FLAG_POS
)braket
op_assign
id|ROLEX_EXTEN_FLAG
suffix:semicolon
r_else
r_if
c_cond
(paren
id|boot_cpu_data.cpu_type
op_ge
id|pcxu
)paren
id|fpregs
(braket
id|FPU_TYPE_FLAG_POS
)braket
op_assign
id|PA2_0_FPU_FLAG
suffix:semicolon
)brace
multiline_comment|/*&n; * this routine will decode the excepting floating point instruction and&n; * call the approiate emulation routine.&n; * It is called by decode_fpu with the following parameters:&n; * fpudispatch(current_ir, unimplemented_code, 0, &amp;Fpu_register)&n; * where current_ir is the instruction to be emulated,&n; * unimplemented_code is the exception_code that the hardware generated&n; * and &amp;Fpu_register is the address of emulated FP reg 0.&n; */
id|u_int
DECL|function|fpudispatch
id|fpudispatch
c_func
(paren
id|u_int
id|ir
comma
id|u_int
id|excp_code
comma
id|u_int
id|holder
comma
id|u_int
id|fpregs
(braket
)braket
)paren
(brace
id|u_int
r_class
comma
id|subop
suffix:semicolon
id|u_int
id|fpu_type_flags
suffix:semicolon
multiline_comment|/* All FP emulation code assumes that ints are 4-bytes in length */
id|VASSERT
c_func
(paren
r_sizeof
(paren
r_int
)paren
op_eq
l_int|4
)paren
suffix:semicolon
id|parisc_linux_get_fpu_type
c_func
(paren
id|fpregs
)paren
suffix:semicolon
id|fpu_type_flags
op_assign
id|fpregs
(braket
id|FPU_TYPE_FLAG_POS
)braket
suffix:semicolon
multiline_comment|/* get fpu type flags */
r_class
op_assign
id|get_class
c_func
(paren
id|ir
)paren
suffix:semicolon
r_if
c_cond
(paren
r_class
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|fpu_type_flags
op_amp
id|PA2_0_FPU_FLAG
)paren
id|subop
op_assign
id|get_subop1_PA2_0
c_func
(paren
id|ir
)paren
suffix:semicolon
r_else
id|subop
op_assign
id|get_subop1_PA1_1
c_func
(paren
id|ir
)paren
suffix:semicolon
)brace
r_else
id|subop
op_assign
id|get_subop
c_func
(paren
id|ir
)paren
suffix:semicolon
r_if
c_cond
(paren
id|FPUDEBUG
)paren
id|printk
c_func
(paren
l_string|&quot;class %d subop %d&bslash;n&quot;
comma
r_class
comma
id|subop
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|excp_code
)paren
(brace
r_case
id|MAJOR_0C_EXCP
suffix:colon
r_case
id|PA83_UNIMP_EXCP
suffix:colon
r_return
id|decode_0c
c_func
(paren
id|ir
comma
r_class
comma
id|subop
comma
id|fpregs
)paren
suffix:semicolon
r_case
id|MAJOR_0E_EXCP
suffix:colon
r_return
id|decode_0e
c_func
(paren
id|ir
comma
r_class
comma
id|subop
comma
id|fpregs
)paren
suffix:semicolon
r_case
id|MAJOR_06_EXCP
suffix:colon
r_return
id|decode_06
c_func
(paren
id|ir
comma
id|fpregs
)paren
suffix:semicolon
r_case
id|MAJOR_26_EXCP
suffix:colon
r_return
id|decode_26
c_func
(paren
id|ir
comma
id|fpregs
)paren
suffix:semicolon
r_case
id|MAJOR_2E_EXCP
suffix:colon
r_return
id|decode_2e
c_func
(paren
id|ir
comma
id|fpregs
)paren
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* &quot;crashme Night Gallery painting nr 2. (asm_crash.s).&n;&t;&t;&t; * This was fixed for multi-user kernels, but&n;&t;&t;&t; * workstation kernels had a panic here.  This allowed&n;&t;&t;&t; * any arbitrary user to panic the kernel by executing&n;&t;&t;&t; * setting the FP exception registers to strange values&n;&t;&t;&t; * and generating an emulation trap.  The emulation and&n;&t;&t;&t; * exception code must never be able to panic the&n;&t;&t;&t; * kernel.&n;&t;&t;&t; */
r_return
id|UNIMPLEMENTEDEXCEPTION
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * this routine is called by $emulation_trap to emulate a coprocessor&n; * instruction if one doesn&squot;t exist&n; */
id|u_int
DECL|function|emfpudispatch
id|emfpudispatch
c_func
(paren
id|u_int
id|ir
comma
id|u_int
id|dummy1
comma
id|u_int
id|dummy2
comma
id|u_int
id|fpregs
(braket
)braket
)paren
(brace
id|u_int
r_class
comma
id|subop
comma
id|major
suffix:semicolon
id|u_int
id|fpu_type_flags
suffix:semicolon
multiline_comment|/* All FP emulation code assumes that ints are 4-bytes in length */
id|VASSERT
c_func
(paren
r_sizeof
(paren
r_int
)paren
op_eq
l_int|4
)paren
suffix:semicolon
id|fpu_type_flags
op_assign
id|fpregs
(braket
id|FPU_TYPE_FLAG_POS
)braket
suffix:semicolon
multiline_comment|/* get fpu type flags */
id|major
op_assign
id|get_major
c_func
(paren
id|ir
)paren
suffix:semicolon
r_class
op_assign
id|get_class
c_func
(paren
id|ir
)paren
suffix:semicolon
r_if
c_cond
(paren
r_class
op_eq
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|fpu_type_flags
op_amp
id|PA2_0_FPU_FLAG
)paren
id|subop
op_assign
id|get_subop1_PA2_0
c_func
(paren
id|ir
)paren
suffix:semicolon
r_else
id|subop
op_assign
id|get_subop1_PA1_1
c_func
(paren
id|ir
)paren
suffix:semicolon
)brace
r_else
id|subop
op_assign
id|get_subop
c_func
(paren
id|ir
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|major
)paren
(brace
r_case
l_int|0x0C
suffix:colon
r_return
id|decode_0c
c_func
(paren
id|ir
comma
r_class
comma
id|subop
comma
id|fpregs
)paren
suffix:semicolon
r_case
l_int|0x0E
suffix:colon
r_return
id|decode_0e
c_func
(paren
id|ir
comma
r_class
comma
id|subop
comma
id|fpregs
)paren
suffix:semicolon
r_case
l_int|0x06
suffix:colon
r_return
id|decode_06
c_func
(paren
id|ir
comma
id|fpregs
)paren
suffix:semicolon
r_case
l_int|0x26
suffix:colon
r_return
id|decode_26
c_func
(paren
id|ir
comma
id|fpregs
)paren
suffix:semicolon
r_case
l_int|0x2E
suffix:colon
r_return
id|decode_2e
c_func
(paren
id|ir
comma
id|fpregs
)paren
suffix:semicolon
r_default
suffix:colon
r_return
id|PA83_UNIMP_EXCP
suffix:semicolon
)brace
)brace
r_static
id|u_int
DECL|function|decode_0c
id|decode_0c
c_func
(paren
id|u_int
id|ir
comma
id|u_int
r_class
comma
id|u_int
id|subop
comma
id|u_int
id|fpregs
(braket
)braket
)paren
(brace
id|u_int
id|r1
comma
id|r2
comma
id|t
suffix:semicolon
multiline_comment|/* operand register offsets */
id|u_int
id|fmt
suffix:semicolon
multiline_comment|/* also sf for class 1 conversions */
id|u_int
id|df
suffix:semicolon
multiline_comment|/* for class 1 conversions */
id|u_int
op_star
id|status
suffix:semicolon
id|u_int
id|retval
comma
id|local_status
suffix:semicolon
id|u_int
id|fpu_type_flags
suffix:semicolon
r_if
c_cond
(paren
id|ir
op_eq
id|COPR_INST
)paren
(brace
id|fpregs
(braket
l_int|0
)braket
op_assign
id|EMULATION_VERSION
op_lshift
l_int|11
suffix:semicolon
r_return
id|NOEXCEPTION
suffix:semicolon
)brace
id|status
op_assign
op_amp
id|fpregs
(braket
l_int|0
)braket
suffix:semicolon
multiline_comment|/* fp status register */
id|local_status
op_assign
id|fpregs
(braket
l_int|0
)braket
suffix:semicolon
multiline_comment|/* and local copy */
id|r1
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fpr1pos
comma
l_int|5
)paren
op_star
r_sizeof
(paren
r_float
)paren
op_div
r_sizeof
(paren
id|u_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r1
op_eq
l_int|0
)paren
multiline_comment|/* map fr0 source to constant zero */
id|r1
op_assign
id|fpzeroreg
suffix:semicolon
id|t
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fptpos
comma
l_int|5
)paren
op_star
r_sizeof
(paren
r_float
)paren
op_div
r_sizeof
(paren
id|u_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t
op_eq
l_int|0
op_logical_and
r_class
op_ne
l_int|2
)paren
multiline_comment|/* don&squot;t allow fr0 as a dest */
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
id|fmt
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fpfmtpos
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* get fmt completer */
r_switch
c_cond
(paren
r_class
)paren
(brace
r_case
l_int|0
suffix:colon
r_switch
c_cond
(paren
id|subop
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* COPR 0,0 emulated above*/
r_case
l_int|1
suffix:colon
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* FCPY */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|2
suffix:colon
multiline_comment|/* illegal */
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* quad */
id|t
op_and_assign
op_complement
l_int|3
suffix:semicolon
multiline_comment|/* force to even reg #s */
id|r1
op_and_assign
op_complement
l_int|3
suffix:semicolon
id|fpregs
(braket
id|t
op_plus
l_int|3
)braket
op_assign
id|fpregs
(braket
id|r1
op_plus
l_int|3
)braket
suffix:semicolon
id|fpregs
(braket
id|t
op_plus
l_int|2
)braket
op_assign
id|fpregs
(braket
id|r1
op_plus
l_int|2
)braket
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* double */
id|fpregs
(braket
id|t
op_plus
l_int|1
)braket
op_assign
id|fpregs
(braket
id|r1
op_plus
l_int|1
)braket
suffix:semicolon
r_case
l_int|0
suffix:colon
multiline_comment|/* single */
id|fpregs
(braket
id|t
)braket
op_assign
id|fpregs
(braket
id|r1
)braket
suffix:semicolon
r_return
id|NOEXCEPTION
suffix:semicolon
)brace
r_case
l_int|3
suffix:colon
multiline_comment|/* FABS */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|2
suffix:colon
multiline_comment|/* illegal */
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* quad */
id|t
op_and_assign
op_complement
l_int|3
suffix:semicolon
multiline_comment|/* force to even reg #s */
id|r1
op_and_assign
op_complement
l_int|3
suffix:semicolon
id|fpregs
(braket
id|t
op_plus
l_int|3
)braket
op_assign
id|fpregs
(braket
id|r1
op_plus
l_int|3
)braket
suffix:semicolon
id|fpregs
(braket
id|t
op_plus
l_int|2
)braket
op_assign
id|fpregs
(braket
id|r1
op_plus
l_int|2
)braket
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* double */
id|fpregs
(braket
id|t
op_plus
l_int|1
)braket
op_assign
id|fpregs
(braket
id|r1
op_plus
l_int|1
)braket
suffix:semicolon
r_case
l_int|0
suffix:colon
multiline_comment|/* single */
multiline_comment|/* copy and clear sign bit */
id|fpregs
(braket
id|t
)braket
op_assign
id|fpregs
(braket
id|r1
)braket
op_amp
l_int|0x7fffffff
suffix:semicolon
r_return
id|NOEXCEPTION
suffix:semicolon
)brace
r_case
l_int|6
suffix:colon
multiline_comment|/* FNEG */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|2
suffix:colon
multiline_comment|/* illegal */
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* quad */
id|t
op_and_assign
op_complement
l_int|3
suffix:semicolon
multiline_comment|/* force to even reg #s */
id|r1
op_and_assign
op_complement
l_int|3
suffix:semicolon
id|fpregs
(braket
id|t
op_plus
l_int|3
)braket
op_assign
id|fpregs
(braket
id|r1
op_plus
l_int|3
)braket
suffix:semicolon
id|fpregs
(braket
id|t
op_plus
l_int|2
)braket
op_assign
id|fpregs
(braket
id|r1
op_plus
l_int|2
)braket
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* double */
id|fpregs
(braket
id|t
op_plus
l_int|1
)braket
op_assign
id|fpregs
(braket
id|r1
op_plus
l_int|1
)braket
suffix:semicolon
r_case
l_int|0
suffix:colon
multiline_comment|/* single */
multiline_comment|/* copy and invert sign bit */
id|fpregs
(braket
id|t
)braket
op_assign
id|fpregs
(braket
id|r1
)braket
op_xor
l_int|0x80000000
suffix:semicolon
r_return
id|NOEXCEPTION
suffix:semicolon
)brace
r_case
l_int|7
suffix:colon
multiline_comment|/* FNEGABS */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|2
suffix:colon
multiline_comment|/* illegal */
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* quad */
id|t
op_and_assign
op_complement
l_int|3
suffix:semicolon
multiline_comment|/* force to even reg #s */
id|r1
op_and_assign
op_complement
l_int|3
suffix:semicolon
id|fpregs
(braket
id|t
op_plus
l_int|3
)braket
op_assign
id|fpregs
(braket
id|r1
op_plus
l_int|3
)braket
suffix:semicolon
id|fpregs
(braket
id|t
op_plus
l_int|2
)braket
op_assign
id|fpregs
(braket
id|r1
op_plus
l_int|2
)braket
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* double */
id|fpregs
(braket
id|t
op_plus
l_int|1
)braket
op_assign
id|fpregs
(braket
id|r1
op_plus
l_int|1
)braket
suffix:semicolon
r_case
l_int|0
suffix:colon
multiline_comment|/* single */
multiline_comment|/* copy and set sign bit */
id|fpregs
(braket
id|t
)braket
op_assign
id|fpregs
(braket
id|r1
)braket
op_or
l_int|0x80000000
suffix:semicolon
r_return
id|NOEXCEPTION
suffix:semicolon
)brace
r_case
l_int|4
suffix:colon
multiline_comment|/* FSQRT */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
id|sgl_fsqrt
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
r_return
id|dbl_fsqrt
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
r_case
l_int|3
suffix:colon
multiline_comment|/* quad not implemented */
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
)brace
r_case
l_int|5
suffix:colon
multiline_comment|/* FRND */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
id|sgl_frnd
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
r_return
id|dbl_frnd
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
r_case
l_int|3
suffix:colon
multiline_comment|/* quad not implemented */
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
)brace
)brace
multiline_comment|/* end of switch (subop) */
r_case
l_int|1
suffix:colon
multiline_comment|/* class 1 */
id|df
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fpdfpos
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* get dest format */
r_if
c_cond
(paren
(paren
id|df
op_amp
l_int|2
)paren
op_logical_or
(paren
id|fmt
op_amp
l_int|2
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * fmt&squot;s 2 and 3 are illegal of not implemented&n;&t;&t;&t; * quad conversions&n;&t;&t;&t; */
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * encode source and dest formats into 2 bits.&n;&t;&t; * high bit is source, low bit is dest.&n;&t;&t; * bit = 1 --&gt; double precision&n;&t;&t; */
id|fmt
op_assign
(paren
id|fmt
op_lshift
l_int|1
)paren
op_or
id|df
suffix:semicolon
r_switch
c_cond
(paren
id|subop
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* FCNVFF */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* sgl/sgl */
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* sgl/dbl */
r_return
id|sgl_to_dbl_fcnvff
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* dbl/sgl */
r_return
id|dbl_to_sgl_fcnvff
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* dbl/dbl */
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
)brace
r_case
l_int|1
suffix:colon
multiline_comment|/* FCNVXF */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* sgl/sgl */
r_return
id|sgl_to_sgl_fcnvxf
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* sgl/dbl */
r_return
id|sgl_to_dbl_fcnvxf
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* dbl/sgl */
r_return
id|dbl_to_sgl_fcnvxf
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* dbl/dbl */
r_return
id|dbl_to_dbl_fcnvxf
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
)brace
r_case
l_int|2
suffix:colon
multiline_comment|/* FCNVFX */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* sgl/sgl */
r_return
id|sgl_to_sgl_fcnvfx
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* sgl/dbl */
r_return
id|sgl_to_dbl_fcnvfx
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* dbl/sgl */
r_return
id|dbl_to_sgl_fcnvfx
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* dbl/dbl */
r_return
id|dbl_to_dbl_fcnvfx
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
)brace
r_case
l_int|3
suffix:colon
multiline_comment|/* FCNVFXT */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* sgl/sgl */
r_return
id|sgl_to_sgl_fcnvfxt
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* sgl/dbl */
r_return
id|sgl_to_dbl_fcnvfxt
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* dbl/sgl */
r_return
id|dbl_to_sgl_fcnvfxt
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* dbl/dbl */
r_return
id|dbl_to_dbl_fcnvfxt
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
)brace
r_case
l_int|5
suffix:colon
multiline_comment|/* FCNVUF (PA2.0 only) */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* sgl/sgl */
r_return
id|sgl_to_sgl_fcnvuf
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* sgl/dbl */
r_return
id|sgl_to_dbl_fcnvuf
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* dbl/sgl */
r_return
id|dbl_to_sgl_fcnvuf
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* dbl/dbl */
r_return
id|dbl_to_dbl_fcnvuf
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
)brace
r_case
l_int|6
suffix:colon
multiline_comment|/* FCNVFU (PA2.0 only) */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* sgl/sgl */
r_return
id|sgl_to_sgl_fcnvfu
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* sgl/dbl */
r_return
id|sgl_to_dbl_fcnvfu
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* dbl/sgl */
r_return
id|dbl_to_sgl_fcnvfu
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* dbl/dbl */
r_return
id|dbl_to_dbl_fcnvfu
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
)brace
r_case
l_int|7
suffix:colon
multiline_comment|/* FCNVFUT (PA2.0 only) */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* sgl/sgl */
r_return
id|sgl_to_sgl_fcnvfut
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* sgl/dbl */
r_return
id|sgl_to_dbl_fcnvfut
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* dbl/sgl */
r_return
id|dbl_to_sgl_fcnvfut
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* dbl/dbl */
r_return
id|dbl_to_dbl_fcnvfut
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
)brace
r_case
l_int|4
suffix:colon
multiline_comment|/* undefined */
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
)brace
multiline_comment|/* end of switch subop */
r_case
l_int|2
suffix:colon
multiline_comment|/* class 2 */
id|fpu_type_flags
op_assign
id|fpregs
(braket
id|FPU_TYPE_FLAG_POS
)braket
suffix:semicolon
id|r2
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fpr2pos
comma
l_int|5
)paren
op_star
r_sizeof
(paren
r_float
)paren
op_div
r_sizeof
(paren
id|u_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r2
op_eq
l_int|0
)paren
id|r2
op_assign
id|fpzeroreg
suffix:semicolon
r_if
c_cond
(paren
id|fpu_type_flags
op_amp
id|PA2_0_FPU_FLAG
)paren
(brace
multiline_comment|/* FTEST if nullify bit set, otherwise FCMP */
r_if
c_cond
(paren
id|extru
c_func
(paren
id|ir
comma
id|fpnulpos
comma
l_int|1
)paren
)paren
(brace
multiline_comment|/* FTEST */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t;&t; * arg0 is not used&n;&t;&t;&t;&t;&t; * second param is the t field used for&n;&t;&t;&t;&t;&t; * ftest,acc and ftest,rej&n;&t;&t;&t;&t;&t; * third param is the subop (y-field)&n;&t;&t;&t;&t;&t; */
id|BUG
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Unsupported&n;&t;&t;&t;&t;&t; * return(ftest(0L,extru(ir,fptpos,5),&n;&t;&t;&t;&t;&t; *&t; &amp;fpregs[0],subop));&n;&t;&t;&t;&t;&t; */
r_case
l_int|1
suffix:colon
r_case
l_int|2
suffix:colon
r_case
l_int|3
suffix:colon
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* FCMP */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
id|retval
op_assign
id|sgl_fcmp
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
id|extru
c_func
(paren
id|ir
comma
id|fptpos
comma
l_int|5
)paren
comma
op_amp
id|local_status
)paren
suffix:semicolon
id|update_status_cbit
c_func
(paren
id|status
comma
id|local_status
comma
id|fpu_type_flags
comma
id|subop
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
l_int|1
suffix:colon
id|retval
op_assign
id|dbl_fcmp
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
id|extru
c_func
(paren
id|ir
comma
id|fptpos
comma
l_int|5
)paren
comma
op_amp
id|local_status
)paren
suffix:semicolon
id|update_status_cbit
c_func
(paren
id|status
comma
id|local_status
comma
id|fpu_type_flags
comma
id|subop
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* illegal */
r_case
l_int|3
suffix:colon
multiline_comment|/* quad not implemented */
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* end of if for PA2.0 */
r_else
(brace
multiline_comment|/* PA1.0 &amp; PA1.1 */
r_switch
c_cond
(paren
id|subop
)paren
(brace
r_case
l_int|2
suffix:colon
r_case
l_int|3
suffix:colon
r_case
l_int|4
suffix:colon
r_case
l_int|5
suffix:colon
r_case
l_int|6
suffix:colon
r_case
l_int|7
suffix:colon
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
r_case
l_int|0
suffix:colon
multiline_comment|/* FCMP */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
id|retval
op_assign
id|sgl_fcmp
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
id|extru
c_func
(paren
id|ir
comma
id|fptpos
comma
l_int|5
)paren
comma
op_amp
id|local_status
)paren
suffix:semicolon
id|update_status_cbit
c_func
(paren
id|status
comma
id|local_status
comma
id|fpu_type_flags
comma
id|subop
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
l_int|1
suffix:colon
id|retval
op_assign
id|dbl_fcmp
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
id|extru
c_func
(paren
id|ir
comma
id|fptpos
comma
l_int|5
)paren
comma
op_amp
id|local_status
)paren
suffix:semicolon
id|update_status_cbit
c_func
(paren
id|status
comma
id|local_status
comma
id|fpu_type_flags
comma
id|subop
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* illegal */
r_case
l_int|3
suffix:colon
multiline_comment|/* quad not implemented */
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
)brace
r_case
l_int|1
suffix:colon
multiline_comment|/* FTEST */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t;&t; * arg0 is not used&n;&t;&t;&t;&t;&t; * second param is the t field used for&n;&t;&t;&t;&t;&t; * ftest,acc and ftest,rej&n;&t;&t;&t;&t;&t; * third param is the subop (y-field)&n;&t;&t;&t;&t;&t; */
id|BUG
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* unsupported&n;&t;&t;&t;&t;&t; * return(ftest(0L,extru(ir,fptpos,5),&n;&t;&t;&t;&t;&t; *     &amp;fpregs[0],subop));&n;&t;&t;&t;&t;&t; */
r_case
l_int|1
suffix:colon
r_case
l_int|2
suffix:colon
r_case
l_int|3
suffix:colon
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
)brace
)brace
multiline_comment|/* end of switch subop */
)brace
multiline_comment|/* end of else for PA1.0 &amp; PA1.1 */
r_case
l_int|3
suffix:colon
multiline_comment|/* class 3 */
id|r2
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fpr2pos
comma
l_int|5
)paren
op_star
r_sizeof
(paren
r_float
)paren
op_div
r_sizeof
(paren
id|u_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r2
op_eq
l_int|0
)paren
id|r2
op_assign
id|fpzeroreg
suffix:semicolon
r_switch
c_cond
(paren
id|subop
)paren
(brace
r_case
l_int|5
suffix:colon
r_case
l_int|6
suffix:colon
r_case
l_int|7
suffix:colon
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
r_case
l_int|0
suffix:colon
multiline_comment|/* FADD */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
id|sgl_fadd
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
r_return
id|dbl_fadd
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* illegal */
r_case
l_int|3
suffix:colon
multiline_comment|/* quad not implemented */
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
)brace
r_case
l_int|1
suffix:colon
multiline_comment|/* FSUB */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
id|sgl_fsub
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
r_return
id|dbl_fsub
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* illegal */
r_case
l_int|3
suffix:colon
multiline_comment|/* quad not implemented */
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
)brace
r_case
l_int|2
suffix:colon
multiline_comment|/* FMPY */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
id|sgl_fmpy
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
r_return
id|dbl_fmpy
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* illegal */
r_case
l_int|3
suffix:colon
multiline_comment|/* quad not implemented */
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
)brace
r_case
l_int|3
suffix:colon
multiline_comment|/* FDIV */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
id|sgl_fdiv
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
r_return
id|dbl_fdiv
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* illegal */
r_case
l_int|3
suffix:colon
multiline_comment|/* quad not implemented */
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
)brace
r_case
l_int|4
suffix:colon
multiline_comment|/* FREM */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
id|sgl_frem
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
r_return
id|dbl_frem
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* illegal */
r_case
l_int|3
suffix:colon
multiline_comment|/* quad not implemented */
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
)brace
)brace
multiline_comment|/* end of class 3 switch */
)brace
multiline_comment|/* end of switch(class) */
multiline_comment|/* If we get here, something is really wrong! */
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
)brace
r_static
id|u_int
DECL|function|decode_0e
id|decode_0e
c_func
(paren
id|ir
comma
r_class
comma
id|subop
comma
id|fpregs
)paren
id|u_int
id|ir
comma
r_class
comma
id|subop
suffix:semicolon
id|u_int
id|fpregs
(braket
)braket
suffix:semicolon
(brace
id|u_int
id|r1
comma
id|r2
comma
id|t
suffix:semicolon
multiline_comment|/* operand register offsets */
id|u_int
id|fmt
suffix:semicolon
multiline_comment|/* also sf for class 1 conversions */
id|u_int
id|df
suffix:semicolon
multiline_comment|/* dest format for class 1 conversions */
id|u_int
op_star
id|status
suffix:semicolon
id|u_int
id|retval
comma
id|local_status
suffix:semicolon
id|u_int
id|fpu_type_flags
suffix:semicolon
id|status
op_assign
op_amp
id|fpregs
(braket
l_int|0
)braket
suffix:semicolon
id|local_status
op_assign
id|fpregs
(braket
l_int|0
)braket
suffix:semicolon
id|r1
op_assign
(paren
(paren
id|extru
c_func
(paren
id|ir
comma
id|fpr1pos
comma
l_int|5
)paren
op_lshift
l_int|1
)paren
op_or
(paren
id|extru
c_func
(paren
id|ir
comma
id|fpxr1pos
comma
l_int|1
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r1
op_eq
l_int|0
)paren
id|r1
op_assign
id|fpzeroreg
suffix:semicolon
id|t
op_assign
(paren
(paren
id|extru
c_func
(paren
id|ir
comma
id|fptpos
comma
l_int|5
)paren
op_lshift
l_int|1
)paren
op_or
(paren
id|extru
c_func
(paren
id|ir
comma
id|fpxtpos
comma
l_int|1
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t
op_eq
l_int|0
op_logical_and
r_class
op_ne
l_int|2
)paren
r_return
id|MAJOR_0E_EXCP
suffix:semicolon
r_if
c_cond
(paren
r_class
OL
l_int|2
)paren
multiline_comment|/* class 0 or 1 has 2 bit fmt */
id|fmt
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fpfmtpos
comma
l_int|2
)paren
suffix:semicolon
r_else
multiline_comment|/* class 2 and 3 have 1 bit fmt */
id|fmt
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fp0efmtpos
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * An undefined combination, double precision accessing the&n;&t; * right half of a FPR, can get us into trouble.  &n;&t; * Let&squot;s just force proper alignment on it.&n;&t; */
r_if
c_cond
(paren
id|fmt
op_eq
id|DBL
)paren
(brace
id|r1
op_and_assign
op_complement
l_int|1
suffix:semicolon
r_if
c_cond
(paren
r_class
op_ne
l_int|1
)paren
id|t
op_and_assign
op_complement
l_int|1
suffix:semicolon
)brace
r_switch
c_cond
(paren
r_class
)paren
(brace
r_case
l_int|0
suffix:colon
r_switch
c_cond
(paren
id|subop
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* unimplemented */
r_case
l_int|1
suffix:colon
r_return
id|MAJOR_0E_EXCP
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* FCPY */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|2
suffix:colon
r_case
l_int|3
suffix:colon
r_return
id|MAJOR_0E_EXCP
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* double */
id|fpregs
(braket
id|t
op_plus
l_int|1
)braket
op_assign
id|fpregs
(braket
id|r1
op_plus
l_int|1
)braket
suffix:semicolon
r_case
l_int|0
suffix:colon
multiline_comment|/* single */
id|fpregs
(braket
id|t
)braket
op_assign
id|fpregs
(braket
id|r1
)braket
suffix:semicolon
r_return
id|NOEXCEPTION
suffix:semicolon
)brace
r_case
l_int|3
suffix:colon
multiline_comment|/* FABS */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|2
suffix:colon
r_case
l_int|3
suffix:colon
r_return
id|MAJOR_0E_EXCP
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* double */
id|fpregs
(braket
id|t
op_plus
l_int|1
)braket
op_assign
id|fpregs
(braket
id|r1
op_plus
l_int|1
)braket
suffix:semicolon
r_case
l_int|0
suffix:colon
multiline_comment|/* single */
id|fpregs
(braket
id|t
)braket
op_assign
id|fpregs
(braket
id|r1
)braket
op_amp
l_int|0x7fffffff
suffix:semicolon
r_return
id|NOEXCEPTION
suffix:semicolon
)brace
r_case
l_int|6
suffix:colon
multiline_comment|/* FNEG */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|2
suffix:colon
r_case
l_int|3
suffix:colon
r_return
id|MAJOR_0E_EXCP
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* double */
id|fpregs
(braket
id|t
op_plus
l_int|1
)braket
op_assign
id|fpregs
(braket
id|r1
op_plus
l_int|1
)braket
suffix:semicolon
r_case
l_int|0
suffix:colon
multiline_comment|/* single */
id|fpregs
(braket
id|t
)braket
op_assign
id|fpregs
(braket
id|r1
)braket
op_xor
l_int|0x80000000
suffix:semicolon
r_return
id|NOEXCEPTION
suffix:semicolon
)brace
r_case
l_int|7
suffix:colon
multiline_comment|/* FNEGABS */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|2
suffix:colon
r_case
l_int|3
suffix:colon
r_return
id|MAJOR_0E_EXCP
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* double */
id|fpregs
(braket
id|t
op_plus
l_int|1
)braket
op_assign
id|fpregs
(braket
id|r1
op_plus
l_int|1
)braket
suffix:semicolon
r_case
l_int|0
suffix:colon
multiline_comment|/* single */
id|fpregs
(braket
id|t
)braket
op_assign
id|fpregs
(braket
id|r1
)braket
op_or
l_int|0x80000000
suffix:semicolon
r_return
id|NOEXCEPTION
suffix:semicolon
)brace
r_case
l_int|4
suffix:colon
multiline_comment|/* FSQRT */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
id|sgl_fsqrt
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
r_return
id|dbl_fsqrt
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
r_case
l_int|3
suffix:colon
r_return
id|MAJOR_0E_EXCP
suffix:semicolon
)brace
r_case
l_int|5
suffix:colon
multiline_comment|/* FRMD */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
id|sgl_frnd
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
r_return
id|dbl_frnd
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
r_case
l_int|3
suffix:colon
r_return
id|MAJOR_0E_EXCP
suffix:semicolon
)brace
)brace
multiline_comment|/* end of switch (subop */
r_case
l_int|1
suffix:colon
multiline_comment|/* class 1 */
id|df
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fpdfpos
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* get dest format */
multiline_comment|/*&n;&t;&t; * Fix Crashme problem (writing to 31R in double precision)&n;&t;&t; * here too.&n;&t;&t; */
r_if
c_cond
(paren
id|df
op_eq
id|DBL
)paren
(brace
id|t
op_and_assign
op_complement
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|df
op_amp
l_int|2
)paren
op_logical_or
(paren
id|fmt
op_amp
l_int|2
)paren
)paren
r_return
id|MAJOR_0E_EXCP
suffix:semicolon
id|fmt
op_assign
(paren
id|fmt
op_lshift
l_int|1
)paren
op_or
id|df
suffix:semicolon
r_switch
c_cond
(paren
id|subop
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* FCNVFF */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* sgl/sgl */
r_return
id|MAJOR_0E_EXCP
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* sgl/dbl */
r_return
id|sgl_to_dbl_fcnvff
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* dbl/sgl */
r_return
id|dbl_to_sgl_fcnvff
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* dbl/dbl */
r_return
id|MAJOR_0E_EXCP
suffix:semicolon
)brace
r_case
l_int|1
suffix:colon
multiline_comment|/* FCNVXF */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* sgl/sgl */
r_return
id|sgl_to_sgl_fcnvxf
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* sgl/dbl */
r_return
id|sgl_to_dbl_fcnvxf
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* dbl/sgl */
r_return
id|dbl_to_sgl_fcnvxf
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* dbl/dbl */
r_return
id|dbl_to_dbl_fcnvxf
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
)brace
r_case
l_int|2
suffix:colon
multiline_comment|/* FCNVFX */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* sgl/sgl */
r_return
id|sgl_to_sgl_fcnvfx
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* sgl/dbl */
r_return
id|sgl_to_dbl_fcnvfx
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* dbl/sgl */
r_return
id|dbl_to_sgl_fcnvfx
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* dbl/dbl */
r_return
id|dbl_to_dbl_fcnvfx
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
)brace
r_case
l_int|3
suffix:colon
multiline_comment|/* FCNVFXT */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* sgl/sgl */
r_return
id|sgl_to_sgl_fcnvfxt
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* sgl/dbl */
r_return
id|sgl_to_dbl_fcnvfxt
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* dbl/sgl */
r_return
id|dbl_to_sgl_fcnvfxt
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* dbl/dbl */
r_return
id|dbl_to_dbl_fcnvfxt
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
)brace
r_case
l_int|5
suffix:colon
multiline_comment|/* FCNVUF (PA2.0 only) */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* sgl/sgl */
r_return
id|sgl_to_sgl_fcnvuf
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* sgl/dbl */
r_return
id|sgl_to_dbl_fcnvuf
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* dbl/sgl */
r_return
id|dbl_to_sgl_fcnvuf
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* dbl/dbl */
r_return
id|dbl_to_dbl_fcnvuf
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
)brace
r_case
l_int|6
suffix:colon
multiline_comment|/* FCNVFU (PA2.0 only) */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* sgl/sgl */
r_return
id|sgl_to_sgl_fcnvfu
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* sgl/dbl */
r_return
id|sgl_to_dbl_fcnvfu
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* dbl/sgl */
r_return
id|dbl_to_sgl_fcnvfu
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* dbl/dbl */
r_return
id|dbl_to_dbl_fcnvfu
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
)brace
r_case
l_int|7
suffix:colon
multiline_comment|/* FCNVFUT (PA2.0 only) */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* sgl/sgl */
r_return
id|sgl_to_sgl_fcnvfut
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* sgl/dbl */
r_return
id|sgl_to_dbl_fcnvfut
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* dbl/sgl */
r_return
id|dbl_to_sgl_fcnvfut
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|3
suffix:colon
multiline_comment|/* dbl/dbl */
r_return
id|dbl_to_dbl_fcnvfut
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
l_int|0
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
)brace
r_case
l_int|4
suffix:colon
multiline_comment|/* undefined */
r_return
id|MAJOR_0C_EXCP
suffix:semicolon
)brace
multiline_comment|/* end of switch subop */
r_case
l_int|2
suffix:colon
multiline_comment|/* class 2 */
multiline_comment|/*&n;&t;&t; * Be careful out there.&n;&t;&t; * Crashme can generate cases where FR31R is specified&n;&t;&t; * as the source or target of a double precision operation.&n;&t;&t; * Since we just pass the address of the floating-point&n;&t;&t; * register to the emulation routines, this can cause&n;&t;&t; * corruption of fpzeroreg.&n;&t;&t; */
r_if
c_cond
(paren
id|fmt
op_eq
id|DBL
)paren
id|r2
op_assign
(paren
id|extru
c_func
(paren
id|ir
comma
id|fpr2pos
comma
l_int|5
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
r_else
id|r2
op_assign
(paren
(paren
id|extru
c_func
(paren
id|ir
comma
id|fpr2pos
comma
l_int|5
)paren
op_lshift
l_int|1
)paren
op_or
(paren
id|extru
c_func
(paren
id|ir
comma
id|fpxr2pos
comma
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|fpu_type_flags
op_assign
id|fpregs
(braket
id|FPU_TYPE_FLAG_POS
)braket
suffix:semicolon
r_if
c_cond
(paren
id|r2
op_eq
l_int|0
)paren
id|r2
op_assign
id|fpzeroreg
suffix:semicolon
r_if
c_cond
(paren
id|fpu_type_flags
op_amp
id|PA2_0_FPU_FLAG
)paren
(brace
multiline_comment|/* FTEST if nullify bit set, otherwise FCMP */
r_if
c_cond
(paren
id|extru
c_func
(paren
id|ir
comma
id|fpnulpos
comma
l_int|1
)paren
)paren
(brace
multiline_comment|/* FTEST */
multiline_comment|/* not legal */
r_return
id|MAJOR_0E_EXCP
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* FCMP */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t;     * fmt is only 1 bit long&n;&t;&t;&t;&t;     */
r_case
l_int|0
suffix:colon
id|retval
op_assign
id|sgl_fcmp
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
id|extru
c_func
(paren
id|ir
comma
id|fptpos
comma
l_int|5
)paren
comma
op_amp
id|local_status
)paren
suffix:semicolon
id|update_status_cbit
c_func
(paren
id|status
comma
id|local_status
comma
id|fpu_type_flags
comma
id|subop
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
l_int|1
suffix:colon
id|retval
op_assign
id|dbl_fcmp
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
id|extru
c_func
(paren
id|ir
comma
id|fptpos
comma
l_int|5
)paren
comma
op_amp
id|local_status
)paren
suffix:semicolon
id|update_status_cbit
c_func
(paren
id|status
comma
id|local_status
comma
id|fpu_type_flags
comma
id|subop
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* end of if for PA2.0 */
r_else
(brace
multiline_comment|/* PA1.0 &amp; PA1.1 */
r_switch
c_cond
(paren
id|subop
)paren
(brace
r_case
l_int|1
suffix:colon
r_case
l_int|2
suffix:colon
r_case
l_int|3
suffix:colon
r_case
l_int|4
suffix:colon
r_case
l_int|5
suffix:colon
r_case
l_int|6
suffix:colon
r_case
l_int|7
suffix:colon
r_return
id|MAJOR_0E_EXCP
suffix:semicolon
r_case
l_int|0
suffix:colon
multiline_comment|/* FCMP */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t;     * fmt is only 1 bit long&n;&t;&t;&t;&t;     */
r_case
l_int|0
suffix:colon
id|retval
op_assign
id|sgl_fcmp
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
id|extru
c_func
(paren
id|ir
comma
id|fptpos
comma
l_int|5
)paren
comma
op_amp
id|local_status
)paren
suffix:semicolon
id|update_status_cbit
c_func
(paren
id|status
comma
id|local_status
comma
id|fpu_type_flags
comma
id|subop
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
r_case
l_int|1
suffix:colon
id|retval
op_assign
id|dbl_fcmp
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
id|extru
c_func
(paren
id|ir
comma
id|fptpos
comma
l_int|5
)paren
comma
op_amp
id|local_status
)paren
suffix:semicolon
id|update_status_cbit
c_func
(paren
id|status
comma
id|local_status
comma
id|fpu_type_flags
comma
id|subop
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
)brace
multiline_comment|/* end of switch subop */
)brace
multiline_comment|/* end of else for PA1.0 &amp; PA1.1 */
r_case
l_int|3
suffix:colon
multiline_comment|/* class 3 */
multiline_comment|/*&n;&t;&t; * Be careful out there.&n;&t;&t; * Crashme can generate cases where FR31R is specified&n;&t;&t; * as the source or target of a double precision operation.&n;&t;&t; * Since we just pass the address of the floating-point&n;&t;&t; * register to the emulation routines, this can cause&n;&t;&t; * corruption of fpzeroreg.&n;&t;&t; */
r_if
c_cond
(paren
id|fmt
op_eq
id|DBL
)paren
id|r2
op_assign
(paren
id|extru
c_func
(paren
id|ir
comma
id|fpr2pos
comma
l_int|5
)paren
op_lshift
l_int|1
)paren
suffix:semicolon
r_else
id|r2
op_assign
(paren
(paren
id|extru
c_func
(paren
id|ir
comma
id|fpr2pos
comma
l_int|5
)paren
op_lshift
l_int|1
)paren
op_or
(paren
id|extru
c_func
(paren
id|ir
comma
id|fpxr2pos
comma
l_int|1
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r2
op_eq
l_int|0
)paren
id|r2
op_assign
id|fpzeroreg
suffix:semicolon
r_switch
c_cond
(paren
id|subop
)paren
(brace
r_case
l_int|5
suffix:colon
r_case
l_int|6
suffix:colon
r_case
l_int|7
suffix:colon
r_return
id|MAJOR_0E_EXCP
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Note that fmt is only 1 bit for class 3 */
r_case
l_int|0
suffix:colon
multiline_comment|/* FADD */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
id|sgl_fadd
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
r_return
id|dbl_fadd
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
)brace
r_case
l_int|1
suffix:colon
multiline_comment|/* FSUB */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
id|sgl_fsub
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
r_return
id|dbl_fsub
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
)brace
r_case
l_int|2
suffix:colon
multiline_comment|/* FMPY or XMPYU */
multiline_comment|/*&n;&t;&t;&t;&t; * check for integer multiply (x bit set)&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|extru
c_func
(paren
id|ir
comma
id|fpxpos
comma
l_int|1
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t;     * emulate XMPYU&n;&t;&t;&t;&t;     */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t;&t;     * bad instruction if t specifies&n;&t;&t;&t;&t;&t;     * the right half of a register&n;&t;&t;&t;&t;&t;     */
r_if
c_cond
(paren
id|t
op_amp
l_int|1
)paren
r_return
id|MAJOR_0E_EXCP
suffix:semicolon
id|BUG
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* unsupported&n;&t;&t;&t;&t;&t;     * impyu(&amp;fpregs[r1],&amp;fpregs[r2],&n;&t;&t;&t;&t;&t;&t; * &amp;fpregs[t]);&n;&t;&t;&t;&t;&t;     */
r_return
id|NOEXCEPTION
suffix:semicolon
r_case
l_int|1
suffix:colon
r_return
id|MAJOR_0E_EXCP
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* FMPY */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
id|sgl_fmpy
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
r_return
id|dbl_fmpy
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
)brace
)brace
r_case
l_int|3
suffix:colon
multiline_comment|/* FDIV */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
id|sgl_fdiv
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
r_return
id|dbl_fdiv
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
)brace
r_case
l_int|4
suffix:colon
multiline_comment|/* FREM */
r_switch
c_cond
(paren
id|fmt
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
id|sgl_frem
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
r_case
l_int|1
suffix:colon
r_return
id|dbl_frem
c_func
(paren
op_amp
id|fpregs
(braket
id|r1
)braket
comma
op_amp
id|fpregs
(braket
id|r2
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
comma
id|status
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* end of class 3 switch */
)brace
multiline_comment|/* end of switch(class) */
multiline_comment|/* If we get here, something is really wrong! */
r_return
id|MAJOR_0E_EXCP
suffix:semicolon
)brace
multiline_comment|/*&n; * routine to decode the 06 (FMPYADD and FMPYCFXT) instruction&n; */
r_static
id|u_int
DECL|function|decode_06
id|decode_06
c_func
(paren
id|ir
comma
id|fpregs
)paren
id|u_int
id|ir
suffix:semicolon
id|u_int
id|fpregs
(braket
)braket
suffix:semicolon
(brace
id|u_int
id|rm1
comma
id|rm2
comma
id|tm
comma
id|ra
comma
id|ta
suffix:semicolon
multiline_comment|/* operands */
id|u_int
id|fmt
suffix:semicolon
id|u_int
id|error
op_assign
l_int|0
suffix:semicolon
id|u_int
id|status
suffix:semicolon
id|u_int
id|fpu_type_flags
suffix:semicolon
r_union
(brace
r_float
id|dbl
suffix:semicolon
r_float
id|flt
suffix:semicolon
r_struct
(brace
id|u_int
id|i1
suffix:semicolon
id|u_int
id|i2
suffix:semicolon
)brace
id|ints
suffix:semicolon
)brace
id|mtmp
comma
id|atmp
suffix:semicolon
id|status
op_assign
id|fpregs
(braket
l_int|0
)braket
suffix:semicolon
multiline_comment|/* use a local copy of status reg */
id|fpu_type_flags
op_assign
id|fpregs
(braket
id|FPU_TYPE_FLAG_POS
)braket
suffix:semicolon
multiline_comment|/* get fpu type flags */
id|fmt
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fpmultifmt
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* get sgl/dbl flag */
r_if
c_cond
(paren
id|fmt
op_eq
l_int|0
)paren
(brace
multiline_comment|/* DBL */
id|rm1
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fprm1pos
comma
l_int|5
)paren
op_star
r_sizeof
(paren
r_float
)paren
op_div
r_sizeof
(paren
id|u_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rm1
op_eq
l_int|0
)paren
id|rm1
op_assign
id|fpzeroreg
suffix:semicolon
id|rm2
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fprm2pos
comma
l_int|5
)paren
op_star
r_sizeof
(paren
r_float
)paren
op_div
r_sizeof
(paren
id|u_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rm2
op_eq
l_int|0
)paren
id|rm2
op_assign
id|fpzeroreg
suffix:semicolon
id|tm
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fptmpos
comma
l_int|5
)paren
op_star
r_sizeof
(paren
r_float
)paren
op_div
r_sizeof
(paren
id|u_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tm
op_eq
l_int|0
)paren
r_return
id|MAJOR_06_EXCP
suffix:semicolon
id|ra
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fprapos
comma
l_int|5
)paren
op_star
r_sizeof
(paren
r_float
)paren
op_div
r_sizeof
(paren
id|u_int
)paren
suffix:semicolon
id|ta
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fptapos
comma
l_int|5
)paren
op_star
r_sizeof
(paren
r_float
)paren
op_div
r_sizeof
(paren
id|u_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ta
op_eq
l_int|0
)paren
r_return
id|MAJOR_06_EXCP
suffix:semicolon
r_if
c_cond
(paren
id|fpu_type_flags
op_amp
id|TIMEX_ROLEX_FPU_MASK
)paren
(brace
r_if
c_cond
(paren
id|ra
op_eq
l_int|0
)paren
(brace
multiline_comment|/* special case FMPYCFXT, see sgl case below */
r_if
c_cond
(paren
id|dbl_fmpy
c_func
(paren
op_amp
id|fpregs
(braket
id|rm1
)braket
comma
op_amp
id|fpregs
(braket
id|rm2
)braket
comma
op_amp
id|mtmp.ints.i1
comma
op_amp
id|status
)paren
)paren
id|error
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|dbl_to_sgl_fcnvfxt
c_func
(paren
op_amp
id|fpregs
(braket
id|ta
)braket
comma
op_amp
id|atmp.ints.i1
comma
op_amp
id|atmp.ints.i1
comma
op_amp
id|status
)paren
)paren
id|error
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|dbl_fmpy
c_func
(paren
op_amp
id|fpregs
(braket
id|rm1
)braket
comma
op_amp
id|fpregs
(braket
id|rm2
)braket
comma
op_amp
id|mtmp.ints.i1
comma
op_amp
id|status
)paren
)paren
id|error
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|dbl_fadd
c_func
(paren
op_amp
id|fpregs
(braket
id|ta
)braket
comma
op_amp
id|fpregs
(braket
id|ra
)braket
comma
op_amp
id|atmp.ints.i1
comma
op_amp
id|status
)paren
)paren
id|error
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
id|ra
op_eq
l_int|0
)paren
id|ra
op_assign
id|fpzeroreg
suffix:semicolon
r_if
c_cond
(paren
id|dbl_fmpy
c_func
(paren
op_amp
id|fpregs
(braket
id|rm1
)braket
comma
op_amp
id|fpregs
(braket
id|rm2
)braket
comma
op_amp
id|mtmp.ints.i1
comma
op_amp
id|status
)paren
)paren
id|error
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|dbl_fadd
c_func
(paren
op_amp
id|fpregs
(braket
id|ta
)braket
comma
op_amp
id|fpregs
(braket
id|ra
)braket
comma
op_amp
id|atmp.ints.i1
comma
op_amp
id|status
)paren
)paren
id|error
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|error
)paren
r_return
id|MAJOR_06_EXCP
suffix:semicolon
r_else
(brace
multiline_comment|/* copy results */
id|fpregs
(braket
id|tm
)braket
op_assign
id|mtmp.ints.i1
suffix:semicolon
id|fpregs
(braket
id|tm
op_plus
l_int|1
)braket
op_assign
id|mtmp.ints.i2
suffix:semicolon
id|fpregs
(braket
id|ta
)braket
op_assign
id|atmp.ints.i1
suffix:semicolon
id|fpregs
(braket
id|ta
op_plus
l_int|1
)braket
op_assign
id|atmp.ints.i2
suffix:semicolon
id|fpregs
(braket
l_int|0
)braket
op_assign
id|status
suffix:semicolon
r_return
id|NOEXCEPTION
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* SGL */
multiline_comment|/*&n;&t;&t; * calculate offsets for single precision numbers&n;&t;&t; * See table 6-14 in PA-89 architecture for mapping&n;&t;&t; */
id|rm1
op_assign
(paren
id|extru
c_func
(paren
id|ir
comma
id|fprm1pos
comma
l_int|4
)paren
op_or
l_int|0x10
)paren
op_lshift
l_int|1
suffix:semicolon
multiline_comment|/* get offset */
id|rm1
op_or_assign
id|extru
c_func
(paren
id|ir
comma
id|fprm1pos
op_minus
l_int|4
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* add right word offset */
id|rm2
op_assign
(paren
id|extru
c_func
(paren
id|ir
comma
id|fprm2pos
comma
l_int|4
)paren
op_or
l_int|0x10
)paren
op_lshift
l_int|1
suffix:semicolon
multiline_comment|/* get offset */
id|rm2
op_or_assign
id|extru
c_func
(paren
id|ir
comma
id|fprm2pos
op_minus
l_int|4
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* add right word offset */
id|tm
op_assign
(paren
id|extru
c_func
(paren
id|ir
comma
id|fptmpos
comma
l_int|4
)paren
op_or
l_int|0x10
)paren
op_lshift
l_int|1
suffix:semicolon
multiline_comment|/* get offset */
id|tm
op_or_assign
id|extru
c_func
(paren
id|ir
comma
id|fptmpos
op_minus
l_int|4
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* add right word offset */
id|ra
op_assign
(paren
id|extru
c_func
(paren
id|ir
comma
id|fprapos
comma
l_int|4
)paren
op_or
l_int|0x10
)paren
op_lshift
l_int|1
suffix:semicolon
multiline_comment|/* get offset */
id|ra
op_or_assign
id|extru
c_func
(paren
id|ir
comma
id|fprapos
op_minus
l_int|4
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* add right word offset */
id|ta
op_assign
(paren
id|extru
c_func
(paren
id|ir
comma
id|fptapos
comma
l_int|4
)paren
op_or
l_int|0x10
)paren
op_lshift
l_int|1
suffix:semicolon
multiline_comment|/* get offset */
id|ta
op_or_assign
id|extru
c_func
(paren
id|ir
comma
id|fptapos
op_minus
l_int|4
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* add right word offset */
r_if
c_cond
(paren
id|ra
op_eq
l_int|0x20
op_logical_and
(paren
id|fpu_type_flags
op_amp
id|TIMEX_ROLEX_FPU_MASK
)paren
)paren
(brace
multiline_comment|/* special case FMPYCFXT (really 0)&n;&t;&t;&t;  * This instruction is only present on the Timex and&n;&t;&t;&t;  * Rolex fpu&squot;s in so if it is the special case and&n;&t;&t;&t;  * one of these fpu&squot;s we run the FMPYCFXT instruction&n;&t;&t;&t;  */
r_if
c_cond
(paren
id|sgl_fmpy
c_func
(paren
op_amp
id|fpregs
(braket
id|rm1
)braket
comma
op_amp
id|fpregs
(braket
id|rm2
)braket
comma
op_amp
id|mtmp.ints.i1
comma
op_amp
id|status
)paren
)paren
id|error
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|sgl_to_sgl_fcnvfxt
c_func
(paren
op_amp
id|fpregs
(braket
id|ta
)braket
comma
op_amp
id|atmp.ints.i1
comma
op_amp
id|atmp.ints.i1
comma
op_amp
id|status
)paren
)paren
id|error
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|sgl_fmpy
c_func
(paren
op_amp
id|fpregs
(braket
id|rm1
)braket
comma
op_amp
id|fpregs
(braket
id|rm2
)braket
comma
op_amp
id|mtmp.ints.i1
comma
op_amp
id|status
)paren
)paren
id|error
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|sgl_fadd
c_func
(paren
op_amp
id|fpregs
(braket
id|ta
)braket
comma
op_amp
id|fpregs
(braket
id|ra
)braket
comma
op_amp
id|atmp.ints.i1
comma
op_amp
id|status
)paren
)paren
id|error
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|error
)paren
r_return
id|MAJOR_06_EXCP
suffix:semicolon
r_else
(brace
multiline_comment|/* copy results */
id|fpregs
(braket
id|tm
)braket
op_assign
id|mtmp.ints.i1
suffix:semicolon
id|fpregs
(braket
id|ta
)braket
op_assign
id|atmp.ints.i1
suffix:semicolon
id|fpregs
(braket
l_int|0
)braket
op_assign
id|status
suffix:semicolon
r_return
id|NOEXCEPTION
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; * routine to decode the 26 (FMPYSUB) instruction&n; */
r_static
id|u_int
DECL|function|decode_26
id|decode_26
c_func
(paren
id|ir
comma
id|fpregs
)paren
id|u_int
id|ir
suffix:semicolon
id|u_int
id|fpregs
(braket
)braket
suffix:semicolon
(brace
id|u_int
id|rm1
comma
id|rm2
comma
id|tm
comma
id|ra
comma
id|ta
suffix:semicolon
multiline_comment|/* operands */
id|u_int
id|fmt
suffix:semicolon
id|u_int
id|error
op_assign
l_int|0
suffix:semicolon
id|u_int
id|status
suffix:semicolon
r_union
(brace
r_float
id|dbl
suffix:semicolon
r_float
id|flt
suffix:semicolon
r_struct
(brace
id|u_int
id|i1
suffix:semicolon
id|u_int
id|i2
suffix:semicolon
)brace
id|ints
suffix:semicolon
)brace
id|mtmp
comma
id|atmp
suffix:semicolon
id|status
op_assign
id|fpregs
(braket
l_int|0
)braket
suffix:semicolon
id|fmt
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fpmultifmt
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* get sgl/dbl flag */
r_if
c_cond
(paren
id|fmt
op_eq
l_int|0
)paren
(brace
multiline_comment|/* DBL */
id|rm1
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fprm1pos
comma
l_int|5
)paren
op_star
r_sizeof
(paren
r_float
)paren
op_div
r_sizeof
(paren
id|u_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rm1
op_eq
l_int|0
)paren
id|rm1
op_assign
id|fpzeroreg
suffix:semicolon
id|rm2
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fprm2pos
comma
l_int|5
)paren
op_star
r_sizeof
(paren
r_float
)paren
op_div
r_sizeof
(paren
id|u_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rm2
op_eq
l_int|0
)paren
id|rm2
op_assign
id|fpzeroreg
suffix:semicolon
id|tm
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fptmpos
comma
l_int|5
)paren
op_star
r_sizeof
(paren
r_float
)paren
op_div
r_sizeof
(paren
id|u_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tm
op_eq
l_int|0
)paren
r_return
id|MAJOR_26_EXCP
suffix:semicolon
id|ra
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fprapos
comma
l_int|5
)paren
op_star
r_sizeof
(paren
r_float
)paren
op_div
r_sizeof
(paren
id|u_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ra
op_eq
l_int|0
)paren
r_return
id|MAJOR_26_EXCP
suffix:semicolon
id|ta
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fptapos
comma
l_int|5
)paren
op_star
r_sizeof
(paren
r_float
)paren
op_div
r_sizeof
(paren
id|u_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ta
op_eq
l_int|0
)paren
r_return
id|MAJOR_26_EXCP
suffix:semicolon
r_if
c_cond
(paren
id|dbl_fmpy
c_func
(paren
op_amp
id|fpregs
(braket
id|rm1
)braket
comma
op_amp
id|fpregs
(braket
id|rm2
)braket
comma
op_amp
id|mtmp.ints.i1
comma
op_amp
id|status
)paren
)paren
id|error
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|dbl_fsub
c_func
(paren
op_amp
id|fpregs
(braket
id|ta
)braket
comma
op_amp
id|fpregs
(braket
id|ra
)braket
comma
op_amp
id|atmp.ints.i1
comma
op_amp
id|status
)paren
)paren
id|error
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|MAJOR_26_EXCP
suffix:semicolon
r_else
(brace
multiline_comment|/* copy results */
id|fpregs
(braket
id|tm
)braket
op_assign
id|mtmp.ints.i1
suffix:semicolon
id|fpregs
(braket
id|tm
op_plus
l_int|1
)braket
op_assign
id|mtmp.ints.i2
suffix:semicolon
id|fpregs
(braket
id|ta
)braket
op_assign
id|atmp.ints.i1
suffix:semicolon
id|fpregs
(braket
id|ta
op_plus
l_int|1
)braket
op_assign
id|atmp.ints.i2
suffix:semicolon
id|fpregs
(braket
l_int|0
)braket
op_assign
id|status
suffix:semicolon
r_return
id|NOEXCEPTION
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* SGL */
multiline_comment|/*&n;&t;&t; * calculate offsets for single precision numbers&n;&t;&t; * See table 6-14 in PA-89 architecture for mapping&n;&t;&t; */
id|rm1
op_assign
(paren
id|extru
c_func
(paren
id|ir
comma
id|fprm1pos
comma
l_int|4
)paren
op_or
l_int|0x10
)paren
op_lshift
l_int|1
suffix:semicolon
multiline_comment|/* get offset */
id|rm1
op_or_assign
id|extru
c_func
(paren
id|ir
comma
id|fprm1pos
op_minus
l_int|4
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* add right word offset */
id|rm2
op_assign
(paren
id|extru
c_func
(paren
id|ir
comma
id|fprm2pos
comma
l_int|4
)paren
op_or
l_int|0x10
)paren
op_lshift
l_int|1
suffix:semicolon
multiline_comment|/* get offset */
id|rm2
op_or_assign
id|extru
c_func
(paren
id|ir
comma
id|fprm2pos
op_minus
l_int|4
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* add right word offset */
id|tm
op_assign
(paren
id|extru
c_func
(paren
id|ir
comma
id|fptmpos
comma
l_int|4
)paren
op_or
l_int|0x10
)paren
op_lshift
l_int|1
suffix:semicolon
multiline_comment|/* get offset */
id|tm
op_or_assign
id|extru
c_func
(paren
id|ir
comma
id|fptmpos
op_minus
l_int|4
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* add right word offset */
id|ra
op_assign
(paren
id|extru
c_func
(paren
id|ir
comma
id|fprapos
comma
l_int|4
)paren
op_or
l_int|0x10
)paren
op_lshift
l_int|1
suffix:semicolon
multiline_comment|/* get offset */
id|ra
op_or_assign
id|extru
c_func
(paren
id|ir
comma
id|fprapos
op_minus
l_int|4
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* add right word offset */
id|ta
op_assign
(paren
id|extru
c_func
(paren
id|ir
comma
id|fptapos
comma
l_int|4
)paren
op_or
l_int|0x10
)paren
op_lshift
l_int|1
suffix:semicolon
multiline_comment|/* get offset */
id|ta
op_or_assign
id|extru
c_func
(paren
id|ir
comma
id|fptapos
op_minus
l_int|4
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* add right word offset */
r_if
c_cond
(paren
id|sgl_fmpy
c_func
(paren
op_amp
id|fpregs
(braket
id|rm1
)braket
comma
op_amp
id|fpregs
(braket
id|rm2
)braket
comma
op_amp
id|mtmp.ints.i1
comma
op_amp
id|status
)paren
)paren
id|error
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|sgl_fsub
c_func
(paren
op_amp
id|fpregs
(braket
id|ta
)braket
comma
op_amp
id|fpregs
(braket
id|ra
)braket
comma
op_amp
id|atmp.ints.i1
comma
op_amp
id|status
)paren
)paren
id|error
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_return
id|MAJOR_26_EXCP
suffix:semicolon
r_else
(brace
multiline_comment|/* copy results */
id|fpregs
(braket
id|tm
)braket
op_assign
id|mtmp.ints.i1
suffix:semicolon
id|fpregs
(braket
id|ta
)braket
op_assign
id|atmp.ints.i1
suffix:semicolon
id|fpregs
(braket
l_int|0
)braket
op_assign
id|status
suffix:semicolon
r_return
id|NOEXCEPTION
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/*&n; * routine to decode the 2E (FMPYFADD,FMPYNFADD) instructions&n; */
r_static
id|u_int
DECL|function|decode_2e
id|decode_2e
c_func
(paren
id|ir
comma
id|fpregs
)paren
id|u_int
id|ir
suffix:semicolon
id|u_int
id|fpregs
(braket
)braket
suffix:semicolon
(brace
id|u_int
id|rm1
comma
id|rm2
comma
id|ra
comma
id|t
suffix:semicolon
multiline_comment|/* operands */
id|u_int
id|fmt
suffix:semicolon
id|fmt
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fpfmtpos
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* get fmt completer */
r_if
c_cond
(paren
id|fmt
op_eq
id|DBL
)paren
(brace
multiline_comment|/* DBL */
id|rm1
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fprm1pos
comma
l_int|5
)paren
op_star
r_sizeof
(paren
r_float
)paren
op_div
r_sizeof
(paren
id|u_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rm1
op_eq
l_int|0
)paren
id|rm1
op_assign
id|fpzeroreg
suffix:semicolon
id|rm2
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fprm2pos
comma
l_int|5
)paren
op_star
r_sizeof
(paren
r_float
)paren
op_div
r_sizeof
(paren
id|u_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rm2
op_eq
l_int|0
)paren
id|rm2
op_assign
id|fpzeroreg
suffix:semicolon
id|ra
op_assign
(paren
(paren
id|extru
c_func
(paren
id|ir
comma
id|fpraupos
comma
l_int|3
)paren
op_lshift
l_int|2
)paren
op_or
(paren
id|extru
c_func
(paren
id|ir
comma
id|fpralpos
comma
l_int|3
)paren
op_rshift
l_int|1
)paren
)paren
op_star
r_sizeof
(paren
r_float
)paren
op_div
r_sizeof
(paren
id|u_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ra
op_eq
l_int|0
)paren
id|ra
op_assign
id|fpzeroreg
suffix:semicolon
id|t
op_assign
id|extru
c_func
(paren
id|ir
comma
id|fptpos
comma
l_int|5
)paren
op_star
r_sizeof
(paren
r_float
)paren
op_div
r_sizeof
(paren
id|u_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t
op_eq
l_int|0
)paren
r_return
id|MAJOR_2E_EXCP
suffix:semicolon
r_if
c_cond
(paren
id|extru
c_func
(paren
id|ir
comma
id|fpfusedsubop
comma
l_int|1
)paren
)paren
(brace
multiline_comment|/* fmpyfadd or fmpynfadd? */
r_return
id|dbl_fmpynfadd
c_func
(paren
op_amp
id|fpregs
(braket
id|rm1
)braket
comma
op_amp
id|fpregs
(braket
id|rm2
)braket
comma
op_amp
id|fpregs
(braket
id|ra
)braket
comma
op_amp
id|fpregs
(braket
l_int|0
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
id|dbl_fmpyfadd
c_func
(paren
op_amp
id|fpregs
(braket
id|rm1
)braket
comma
op_amp
id|fpregs
(braket
id|rm2
)braket
comma
op_amp
id|fpregs
(braket
id|ra
)braket
comma
op_amp
id|fpregs
(braket
l_int|0
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* end DBL */
r_else
(brace
multiline_comment|/* SGL */
id|rm1
op_assign
(paren
id|extru
c_func
(paren
id|ir
comma
id|fprm1pos
comma
l_int|5
)paren
op_lshift
l_int|1
)paren
op_or
(paren
id|extru
c_func
(paren
id|ir
comma
id|fpxrm1pos
comma
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rm1
op_eq
l_int|0
)paren
id|rm1
op_assign
id|fpzeroreg
suffix:semicolon
id|rm2
op_assign
(paren
id|extru
c_func
(paren
id|ir
comma
id|fprm2pos
comma
l_int|5
)paren
op_lshift
l_int|1
)paren
op_or
(paren
id|extru
c_func
(paren
id|ir
comma
id|fpxrm2pos
comma
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rm2
op_eq
l_int|0
)paren
id|rm2
op_assign
id|fpzeroreg
suffix:semicolon
id|ra
op_assign
(paren
id|extru
c_func
(paren
id|ir
comma
id|fpraupos
comma
l_int|3
)paren
op_lshift
l_int|3
)paren
op_or
id|extru
c_func
(paren
id|ir
comma
id|fpralpos
comma
l_int|3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ra
op_eq
l_int|0
)paren
id|ra
op_assign
id|fpzeroreg
suffix:semicolon
id|t
op_assign
(paren
(paren
id|extru
c_func
(paren
id|ir
comma
id|fptpos
comma
l_int|5
)paren
op_lshift
l_int|1
)paren
op_or
(paren
id|extru
c_func
(paren
id|ir
comma
id|fpxtpos
comma
l_int|1
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|t
op_eq
l_int|0
)paren
r_return
id|MAJOR_2E_EXCP
suffix:semicolon
r_if
c_cond
(paren
id|extru
c_func
(paren
id|ir
comma
id|fpfusedsubop
comma
l_int|1
)paren
)paren
(brace
multiline_comment|/* fmpyfadd or fmpynfadd? */
r_return
id|sgl_fmpynfadd
c_func
(paren
op_amp
id|fpregs
(braket
id|rm1
)braket
comma
op_amp
id|fpregs
(braket
id|rm2
)braket
comma
op_amp
id|fpregs
(braket
id|ra
)braket
comma
op_amp
id|fpregs
(braket
l_int|0
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
id|sgl_fmpyfadd
c_func
(paren
op_amp
id|fpregs
(braket
id|rm1
)braket
comma
op_amp
id|fpregs
(braket
id|rm2
)braket
comma
op_amp
id|fpregs
(braket
id|ra
)braket
comma
op_amp
id|fpregs
(braket
l_int|0
)braket
comma
op_amp
id|fpregs
(braket
id|t
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* end SGL */
)brace
multiline_comment|/*&n; * update_status_cbit&n; *&n; *&t;This routine returns the correct FP status register value in&n; *&t;*status, based on the C-bit &amp; V-bit returned by the FCMP&n; *&t;emulation routine in new_status.  The architecture type&n; *&t;(PA83, PA89 or PA2.0) is available in fpu_type.  The y_field&n; *&t;and the architecture type are used to determine what flavor&n; *&t;of FCMP is being emulated.&n; */
r_static
r_void
DECL|function|update_status_cbit
id|update_status_cbit
c_func
(paren
id|status
comma
id|new_status
comma
id|fpu_type
comma
id|y_field
)paren
id|u_int
op_star
id|status
comma
id|new_status
suffix:semicolon
id|u_int
id|fpu_type
suffix:semicolon
id|u_int
id|y_field
suffix:semicolon
(brace
multiline_comment|/*&n;&t; * For PA89 FPU&squot;s which implement the Compare Queue and&n;&t; * for PA2.0 FPU&squot;s, update the Compare Queue if the y-field = 0,&n;&t; * otherwise update the specified bit in the Compare Array.&n;&t; * Note that the y-field will always be 0 for non-PA2.0 FPU&squot;s.&n;&t; */
r_if
c_cond
(paren
(paren
id|fpu_type
op_amp
id|TIMEX_EXTEN_FLAG
)paren
op_logical_or
(paren
id|fpu_type
op_amp
id|ROLEX_EXTEN_FLAG
)paren
op_logical_or
(paren
id|fpu_type
op_amp
id|PA2_0_FPU_FLAG
)paren
)paren
(brace
r_if
c_cond
(paren
id|y_field
op_eq
l_int|0
)paren
(brace
op_star
id|status
op_assign
(paren
(paren
op_star
id|status
op_amp
l_int|0x04000000
)paren
op_rshift
l_int|5
)paren
op_or
multiline_comment|/* old Cbit */
(paren
(paren
op_star
id|status
op_amp
l_int|0x003ff000
)paren
op_rshift
l_int|1
)paren
op_or
multiline_comment|/* old CQ   */
(paren
id|new_status
op_amp
l_int|0xffc007ff
)paren
suffix:semicolon
multiline_comment|/* all other bits*/
)brace
r_else
(brace
op_star
id|status
op_assign
(paren
op_star
id|status
op_amp
l_int|0x04000000
)paren
op_or
multiline_comment|/* old Cbit */
(paren
(paren
id|new_status
op_amp
l_int|0x04000000
)paren
op_rshift
(paren
id|y_field
op_plus
l_int|4
)paren
)paren
op_or
(paren
id|new_status
op_amp
op_complement
l_int|0x04000000
op_amp
multiline_comment|/* other bits */
op_complement
(paren
l_int|0x04000000
op_rshift
(paren
id|y_field
op_plus
l_int|4
)paren
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* if PA83, just update the C-bit */
r_else
(brace
op_star
id|status
op_assign
id|new_status
suffix:semicolon
)brace
)brace
eof
