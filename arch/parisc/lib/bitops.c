multiline_comment|/*&n; * bitops.c: atomic operations which got too long to be inlined all over&n; *      the place.&n; * &n; * Copyright 1999 Philipp Rumpf (prumpf@tux.org)&n; * Copyright 2000 Grant Grundler (grundler@cup.hp.com)&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/atomic.h&gt;
macro_line|#ifdef CONFIG_SMP
DECL|variable|__lock_aligned
id|spinlock_t
id|__atomic_hash
(braket
id|ATOMIC_HASH_SIZE
)braket
id|__lock_aligned
op_assign
(brace
(braket
l_int|0
dot
dot
dot
(paren
id|ATOMIC_HASH_SIZE
op_minus
l_int|1
)paren
)braket
op_assign
id|SPIN_LOCK_UNLOCKED
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef __LP64__
DECL|function|__xchg64
r_int
r_int
id|__xchg64
c_func
(paren
r_int
r_int
id|x
comma
r_int
r_int
op_star
id|ptr
)paren
(brace
r_int
r_int
id|temp
comma
id|flags
suffix:semicolon
id|_atomic_spin_lock_irqsave
c_func
(paren
id|ptr
comma
id|flags
)paren
suffix:semicolon
id|temp
op_assign
op_star
id|ptr
suffix:semicolon
op_star
id|ptr
op_assign
id|x
suffix:semicolon
id|_atomic_spin_unlock_irqrestore
c_func
(paren
id|ptr
comma
id|flags
)paren
suffix:semicolon
r_return
id|temp
suffix:semicolon
)brace
macro_line|#endif
DECL|function|__xchg32
r_int
r_int
id|__xchg32
c_func
(paren
r_int
id|x
comma
r_int
op_star
id|ptr
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|temp
suffix:semicolon
id|_atomic_spin_lock_irqsave
c_func
(paren
id|ptr
comma
id|flags
)paren
suffix:semicolon
id|temp
op_assign
(paren
r_int
)paren
op_star
id|ptr
suffix:semicolon
multiline_comment|/* XXX - sign extension wanted? */
op_star
id|ptr
op_assign
id|x
suffix:semicolon
id|_atomic_spin_unlock_irqrestore
c_func
(paren
id|ptr
comma
id|flags
)paren
suffix:semicolon
r_return
(paren
r_int
r_int
)paren
id|temp
suffix:semicolon
)brace
DECL|function|__xchg8
r_int
r_int
id|__xchg8
c_func
(paren
r_char
id|x
comma
r_char
op_star
id|ptr
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|temp
suffix:semicolon
id|_atomic_spin_lock_irqsave
c_func
(paren
id|ptr
comma
id|flags
)paren
suffix:semicolon
id|temp
op_assign
(paren
r_int
)paren
op_star
id|ptr
suffix:semicolon
multiline_comment|/* XXX - sign extension wanted? */
op_star
id|ptr
op_assign
id|x
suffix:semicolon
id|_atomic_spin_unlock_irqrestore
c_func
(paren
id|ptr
comma
id|flags
)paren
suffix:semicolon
r_return
(paren
r_int
r_int
)paren
id|temp
suffix:semicolon
)brace
macro_line|#ifdef __LP64__
DECL|function|__cmpxchg_u64
r_int
r_int
id|__cmpxchg_u64
c_func
(paren
r_volatile
r_int
r_int
op_star
id|ptr
comma
r_int
r_int
id|old
comma
r_int
r_int
r_new
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|prev
suffix:semicolon
id|_atomic_spin_lock_irqsave
c_func
(paren
id|ptr
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|prev
op_assign
op_star
id|ptr
)paren
op_eq
id|old
)paren
op_star
id|ptr
op_assign
r_new
suffix:semicolon
id|_atomic_spin_unlock_irqrestore
c_func
(paren
id|ptr
comma
id|flags
)paren
suffix:semicolon
r_return
id|prev
suffix:semicolon
)brace
macro_line|#endif
DECL|function|__cmpxchg_u32
r_int
r_int
id|__cmpxchg_u32
c_func
(paren
r_volatile
r_int
r_int
op_star
id|ptr
comma
r_int
r_int
id|old
comma
r_int
r_int
r_new
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|prev
suffix:semicolon
id|_atomic_spin_lock_irqsave
c_func
(paren
id|ptr
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|prev
op_assign
op_star
id|ptr
)paren
op_eq
id|old
)paren
op_star
id|ptr
op_assign
r_new
suffix:semicolon
id|_atomic_spin_unlock_irqrestore
c_func
(paren
id|ptr
comma
id|flags
)paren
suffix:semicolon
r_return
(paren
r_int
r_int
)paren
id|prev
suffix:semicolon
)brace
eof
