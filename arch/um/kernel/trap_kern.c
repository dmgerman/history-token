multiline_comment|/* &n; * Copyright (C) 2000, 2001 Jeff Dike (jdike@karaya.com)&n; * Licensed under the GPL&n; */
macro_line|#include &quot;linux/kernel.h&quot;
macro_line|#include &quot;linux/sched.h&quot;
macro_line|#include &quot;linux/mm.h&quot;
macro_line|#include &quot;linux/spinlock.h&quot;
macro_line|#include &quot;linux/config.h&quot;
macro_line|#include &quot;linux/init.h&quot;
macro_line|#include &quot;linux/ptrace.h&quot;
macro_line|#include &quot;asm/semaphore.h&quot;
macro_line|#include &quot;asm/pgtable.h&quot;
macro_line|#include &quot;asm/tlbflush.h&quot;
macro_line|#include &quot;asm/a.out.h&quot;
macro_line|#include &quot;asm/current.h&quot;
macro_line|#include &quot;user_util.h&quot;
macro_line|#include &quot;kern_util.h&quot;
macro_line|#include &quot;kern.h&quot;
macro_line|#include &quot;chan_kern.h&quot;
macro_line|#include &quot;debug.h&quot;
macro_line|#include &quot;mconsole_kern.h&quot;
macro_line|#include &quot;2_5compat.h&quot;
r_extern
r_int
id|nsyscalls
suffix:semicolon
DECL|function|segv
r_int
r_int
id|segv
c_func
(paren
r_int
r_int
id|address
comma
r_int
r_int
id|ip
comma
r_int
id|is_write
comma
r_int
id|is_user
comma
r_void
op_star
id|sc
)paren
(brace
r_struct
id|mm_struct
op_star
id|mm
op_assign
id|current-&gt;mm
suffix:semicolon
r_struct
id|vm_area_struct
op_star
id|vma
suffix:semicolon
r_struct
id|siginfo
id|si
suffix:semicolon
r_void
op_star
id|catcher
suffix:semicolon
id|pgd_t
op_star
id|pgd
suffix:semicolon
id|pmd_t
op_star
id|pmd
suffix:semicolon
id|pte_t
op_star
id|pte
suffix:semicolon
r_int
r_int
id|page
suffix:semicolon
r_if
c_cond
(paren
(paren
id|address
op_ge
id|start_vm
)paren
op_logical_and
(paren
id|address
OL
id|end_vm
)paren
)paren
(brace
id|flush_tlb_kernel_vm
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mm
op_eq
l_int|NULL
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;Segfault with no mm&quot;
)paren
suffix:semicolon
)brace
id|catcher
op_assign
id|current-&gt;thread.fault_catcher
suffix:semicolon
id|si.si_code
op_assign
id|SEGV_MAPERR
suffix:semicolon
id|down_read
c_func
(paren
op_amp
id|mm-&gt;mmap_sem
)paren
suffix:semicolon
id|vma
op_assign
id|find_vma
c_func
(paren
id|mm
comma
id|address
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vma
)paren
(brace
r_goto
id|bad
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|vma-&gt;vm_start
op_le
id|address
)paren
(brace
r_goto
id|good_area
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|vma-&gt;vm_flags
op_amp
id|VM_GROWSDOWN
)paren
)paren
(brace
r_goto
id|bad
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|expand_stack
c_func
(paren
id|vma
comma
id|address
)paren
)paren
(brace
r_goto
id|bad
suffix:semicolon
)brace
id|good_area
suffix:colon
id|si.si_code
op_assign
id|SEGV_ACCERR
suffix:semicolon
r_if
c_cond
(paren
id|is_write
op_logical_and
op_logical_neg
(paren
id|vma-&gt;vm_flags
op_amp
id|VM_WRITE
)paren
)paren
(brace
r_goto
id|bad
suffix:semicolon
)brace
id|page
op_assign
id|address
op_amp
id|PAGE_MASK
suffix:semicolon
r_if
c_cond
(paren
id|page
op_eq
(paren
r_int
r_int
)paren
id|current-&gt;thread_info
op_plus
id|PAGE_SIZE
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;Kernel stack overflow&quot;
)paren
suffix:semicolon
)brace
id|pgd
op_assign
id|pgd_offset
c_func
(paren
id|mm
comma
id|page
)paren
suffix:semicolon
id|pmd
op_assign
id|pmd_offset
c_func
(paren
id|pgd
comma
id|page
)paren
suffix:semicolon
id|survive
suffix:colon
r_do
(brace
r_switch
c_cond
(paren
id|handle_mm_fault
c_func
(paren
id|mm
comma
id|vma
comma
id|address
comma
id|is_write
)paren
)paren
(brace
r_case
id|VM_FAULT_MINOR
suffix:colon
id|current-&gt;min_flt
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VM_FAULT_MAJOR
suffix:colon
id|current-&gt;maj_flt
op_increment
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VM_FAULT_SIGBUS
suffix:colon
r_goto
id|do_sigbus
suffix:semicolon
r_case
id|VM_FAULT_OOM
suffix:colon
r_goto
id|out_of_memory
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
id|pte
op_assign
id|pte_offset_kernel
c_func
(paren
id|pmd
comma
id|page
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
id|pte_present
c_func
(paren
op_star
id|pte
)paren
)paren
(brace
suffix:semicolon
)brace
op_star
id|pte
op_assign
id|pte_mkyoung
c_func
(paren
op_star
id|pte
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pte_write
c_func
(paren
op_star
id|pte
)paren
)paren
(brace
op_star
id|pte
op_assign
id|pte_mkdirty
c_func
(paren
op_star
id|pte
)paren
suffix:semicolon
)brace
id|flush_tlb_page
c_func
(paren
id|vma
comma
id|page
)paren
suffix:semicolon
id|up_read
c_func
(paren
op_amp
id|mm-&gt;mmap_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|do_sigbus
suffix:colon
id|up_read
c_func
(paren
op_amp
id|mm-&gt;mmap_sem
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Send a sigbus, regardless of whether we were in kernel&n;&t; * or user mode.&n;&t; */
id|si.si_signo
op_assign
id|SIGBUS
suffix:semicolon
id|si.si_errno
op_assign
l_int|0
suffix:semicolon
id|si.si_code
op_assign
id|BUS_ADRERR
suffix:semicolon
id|si.si_addr
op_assign
(paren
r_void
op_star
)paren
id|address
suffix:semicolon
id|force_sig_info
c_func
(paren
id|SIGBUS
comma
op_amp
id|si
comma
id|current
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_user
)paren
(brace
r_goto
id|bad
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
multiline_comment|/*&n; * We ran out of memory, or some other thing happened to us that made&n; * us unable to handle the page fault gracefully.&n; */
id|out_of_memory
suffix:colon
id|up_read
c_func
(paren
op_amp
id|mm-&gt;mmap_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;pid
op_eq
l_int|1
)paren
(brace
id|yield
c_func
(paren
)paren
suffix:semicolon
id|down_read
c_func
(paren
op_amp
id|mm-&gt;mmap_sem
)paren
suffix:semicolon
r_goto
id|survive
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;VM: killing process %s&bslash;n&quot;
comma
id|current-&gt;comm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is_user
)paren
(brace
id|do_exit
c_func
(paren
id|SIGKILL
)paren
suffix:semicolon
)brace
multiline_comment|/* Fall through to bad */
id|bad
suffix:colon
r_if
c_cond
(paren
id|catcher
op_ne
l_int|NULL
)paren
(brace
id|current-&gt;thread.fault_addr
op_assign
(paren
r_void
op_star
)paren
id|address
suffix:semicolon
id|up_read
c_func
(paren
op_amp
id|mm-&gt;mmap_sem
)paren
suffix:semicolon
id|do_longjmp
c_func
(paren
id|catcher
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|current-&gt;thread.fault_addr
op_ne
l_int|NULL
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;fault_addr set but no fault catcher&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|arch_fixup
c_func
(paren
id|ip
comma
id|sc
)paren
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|is_user
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;Kernel mode fault at addr 0x%lx, ip 0x%lx&quot;
comma
id|address
comma
id|ip
)paren
suffix:semicolon
)brace
id|si.si_signo
op_assign
id|SIGSEGV
suffix:semicolon
id|si.si_addr
op_assign
(paren
r_void
op_star
)paren
id|address
suffix:semicolon
id|current-&gt;thread.cr2
op_assign
id|address
suffix:semicolon
id|current-&gt;thread.err
op_assign
id|is_write
suffix:semicolon
id|force_sig_info
c_func
(paren
id|SIGSEGV
comma
op_amp
id|si
comma
id|current
)paren
suffix:semicolon
id|up_read
c_func
(paren
op_amp
id|mm-&gt;mmap_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bad_segv
r_void
id|bad_segv
c_func
(paren
r_int
r_int
id|address
comma
r_int
r_int
id|ip
comma
r_int
id|is_write
)paren
(brace
r_struct
id|siginfo
id|si
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Unfixable SEGV in &squot;%s&squot; (pid %d) at 0x%lx &quot;
l_string|&quot;(ip 0x%lx)&bslash;n&quot;
comma
id|current-&gt;comm
comma
id|current-&gt;pid
comma
id|address
comma
id|ip
)paren
suffix:semicolon
id|si.si_signo
op_assign
id|SIGSEGV
suffix:semicolon
id|si.si_code
op_assign
id|SEGV_ACCERR
suffix:semicolon
id|si.si_addr
op_assign
(paren
r_void
op_star
)paren
id|address
suffix:semicolon
id|current-&gt;thread.cr2
op_assign
id|address
suffix:semicolon
id|current-&gt;thread.err
op_assign
id|is_write
suffix:semicolon
id|force_sig_info
c_func
(paren
id|SIGSEGV
comma
op_amp
id|si
comma
id|current
)paren
suffix:semicolon
)brace
DECL|function|relay_signal
r_void
id|relay_signal
c_func
(paren
r_int
id|sig
comma
r_struct
id|uml_pt_regs
op_star
id|regs
)paren
(brace
r_if
c_cond
(paren
id|arch_handle_signal
c_func
(paren
id|sig
comma
id|regs
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|regs-&gt;is_user
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;Kernel mode signal %d&quot;
comma
id|sig
)paren
suffix:semicolon
)brace
id|force_sig
c_func
(paren
id|sig
comma
id|current
)paren
suffix:semicolon
)brace
DECL|function|bus_handler
r_void
id|bus_handler
c_func
(paren
r_int
id|sig
comma
r_struct
id|uml_pt_regs
op_star
id|regs
)paren
(brace
r_if
c_cond
(paren
id|current-&gt;thread.fault_catcher
op_ne
l_int|NULL
)paren
(brace
id|do_longjmp
c_func
(paren
id|current-&gt;thread.fault_catcher
)paren
suffix:semicolon
)brace
r_else
id|relay_signal
c_func
(paren
id|sig
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|trap_init
r_void
id|trap_init
c_func
(paren
r_void
)paren
(brace
)brace
DECL|variable|trap_lock
id|spinlock_t
id|trap_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|function|lock_trap
r_void
id|lock_trap
c_func
(paren
r_void
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|trap_lock
)paren
suffix:semicolon
)brace
DECL|function|unlock_trap
r_void
id|unlock_trap
c_func
(paren
r_void
)paren
(brace
id|spin_unlock
c_func
(paren
op_amp
id|trap_lock
)paren
suffix:semicolon
)brace
r_extern
r_int
id|debugger_pid
suffix:semicolon
r_extern
r_int
id|debugger_fd
suffix:semicolon
r_extern
r_int
id|debugger_parent
suffix:semicolon
macro_line|#ifdef CONFIG_PT_PROXY
DECL|function|debugger_signal
r_int
id|debugger_signal
c_func
(paren
r_int
id|status
comma
id|pid_t
id|pid
)paren
(brace
r_return
id|debugger_proxy
c_func
(paren
id|status
comma
id|pid
)paren
suffix:semicolon
)brace
DECL|function|child_signal
r_void
id|child_signal
c_func
(paren
id|pid_t
id|pid
comma
r_int
id|status
)paren
(brace
id|child_proxy
c_func
(paren
id|pid
comma
id|status
)paren
suffix:semicolon
)brace
DECL|function|gdb_announce
r_static
r_void
id|gdb_announce
c_func
(paren
r_char
op_star
id|dev_name
comma
r_int
id|dev
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;gdb assigned device &squot;%s&squot;&bslash;n&quot;
comma
id|dev_name
)paren
suffix:semicolon
)brace
DECL|variable|opts
r_static
r_struct
id|chan_opts
id|opts
op_assign
(brace
id|announce
suffix:colon
id|gdb_announce
comma
id|xterm_title
suffix:colon
l_string|&quot;UML kernel debugger&quot;
comma
id|raw
suffix:colon
l_int|0
comma
id|tramp_stack
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|xterm_data
r_static
r_void
op_star
id|xterm_data
suffix:semicolon
DECL|variable|xterm_fd
r_static
r_int
id|xterm_fd
suffix:semicolon
r_extern
r_void
op_star
id|xterm_init
c_func
(paren
r_char
op_star
comma
r_int
comma
r_struct
id|chan_opts
op_star
)paren
suffix:semicolon
r_extern
r_int
id|xterm_open
c_func
(paren
r_int
comma
r_int
comma
r_int
comma
r_void
op_star
)paren
suffix:semicolon
r_extern
r_void
id|xterm_close
c_func
(paren
r_int
comma
r_void
op_star
)paren
suffix:semicolon
DECL|function|open_gdb_chan
r_int
id|open_gdb_chan
c_func
(paren
r_void
)paren
(brace
r_char
id|stack
(braket
id|PAGE_SIZE
)braket
suffix:semicolon
id|opts.tramp_stack
op_assign
(paren
r_int
r_int
)paren
id|stack
suffix:semicolon
id|xterm_data
op_assign
id|xterm_init
c_func
(paren
l_string|&quot;&quot;
comma
l_int|0
comma
op_amp
id|opts
)paren
suffix:semicolon
id|xterm_fd
op_assign
id|xterm_open
c_func
(paren
l_int|1
comma
l_int|1
comma
l_int|1
comma
id|xterm_data
)paren
suffix:semicolon
r_return
id|xterm_fd
suffix:semicolon
)brace
DECL|function|exit_debugger_cb
r_static
r_void
id|exit_debugger_cb
c_func
(paren
r_void
op_star
id|unused
)paren
(brace
r_if
c_cond
(paren
id|debugger_pid
op_ne
op_minus
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|gdb_pid
op_ne
op_minus
l_int|1
)paren
(brace
id|fake_child_exit
c_func
(paren
)paren
suffix:semicolon
id|gdb_pid
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
id|kill_child_dead
c_func
(paren
id|debugger_pid
)paren
suffix:semicolon
id|debugger_pid
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|debugger_parent
op_ne
op_minus
l_int|1
)paren
(brace
id|detach
c_func
(paren
id|debugger_parent
comma
id|SIGINT
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|xterm_data
op_ne
l_int|NULL
)paren
(brace
id|xterm_close
c_func
(paren
id|xterm_fd
comma
id|xterm_data
)paren
suffix:semicolon
)brace
)brace
DECL|function|exit_debugger
r_static
r_void
id|exit_debugger
c_func
(paren
r_void
)paren
(brace
id|tracing_cb
c_func
(paren
id|exit_debugger_cb
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|variable|exit_debugger
id|__uml_exitcall
c_func
(paren
id|exit_debugger
)paren
suffix:semicolon
DECL|struct|gdb_data
r_struct
id|gdb_data
(brace
DECL|member|str
r_char
op_star
id|str
suffix:semicolon
DECL|member|err
r_int
id|err
suffix:semicolon
)brace
suffix:semicolon
DECL|function|config_gdb_cb
r_static
r_void
id|config_gdb_cb
c_func
(paren
r_void
op_star
id|arg
)paren
(brace
r_struct
id|gdb_data
op_star
id|data
op_assign
id|arg
suffix:semicolon
r_struct
id|task_struct
op_star
id|task
suffix:semicolon
r_int
id|pid
suffix:semicolon
id|data-&gt;err
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|debugger_pid
op_ne
op_minus
l_int|1
)paren
(brace
id|exit_debugger_cb
c_func
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|data-&gt;str
comma
l_string|&quot;pid,&quot;
comma
id|strlen
c_func
(paren
l_string|&quot;pid,&quot;
)paren
)paren
)paren
(brace
id|data-&gt;str
op_add_assign
id|strlen
c_func
(paren
l_string|&quot;pid,&quot;
)paren
suffix:semicolon
id|pid
op_assign
id|simple_strtoul
c_func
(paren
id|data-&gt;str
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|task
op_assign
id|cpu_tasks
(braket
l_int|0
)braket
dot
id|task
suffix:semicolon
id|debugger_pid
op_assign
id|attach_debugger
c_func
(paren
id|task-&gt;thread.extern_pid
comma
id|pid
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|debugger_pid
op_ne
op_minus
l_int|1
)paren
(brace
id|data-&gt;err
op_assign
l_int|0
suffix:semicolon
id|gdb_pid
op_assign
id|pid
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
id|data-&gt;err
op_assign
l_int|0
suffix:semicolon
id|debugger_pid
op_assign
id|start_debugger
c_func
(paren
id|linux_prog
comma
l_int|0
comma
l_int|0
comma
op_amp
id|debugger_fd
)paren
suffix:semicolon
id|init_proxy
c_func
(paren
id|debugger_pid
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|gdb_config
r_int
id|gdb_config
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_struct
id|gdb_data
id|data
suffix:semicolon
r_if
c_cond
(paren
op_star
id|str
op_increment
op_ne
l_char|&squot;=&squot;
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|data.str
op_assign
id|str
suffix:semicolon
id|tracing_cb
c_func
(paren
id|config_gdb_cb
comma
op_amp
id|data
)paren
suffix:semicolon
r_return
id|data.err
suffix:semicolon
)brace
DECL|function|remove_gdb_cb
r_void
id|remove_gdb_cb
c_func
(paren
r_void
op_star
id|unused
)paren
(brace
id|exit_debugger_cb
c_func
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|gdb_remove
r_int
id|gdb_remove
c_func
(paren
r_char
op_star
id|unused
)paren
(brace
id|tracing_cb
c_func
(paren
id|remove_gdb_cb
comma
l_int|NULL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_MCONSOLE
DECL|variable|gdb_mc
r_static
r_struct
id|mc_device
id|gdb_mc
op_assign
(brace
id|name
suffix:colon
l_string|&quot;gdb&quot;
comma
id|config
suffix:colon
id|gdb_config
comma
id|remove
suffix:colon
id|gdb_remove
comma
)brace
suffix:semicolon
DECL|function|gdb_mc_init
r_int
id|gdb_mc_init
c_func
(paren
r_void
)paren
(brace
id|mconsole_register_dev
c_func
(paren
op_amp
id|gdb_mc
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|gdb_mc_init
id|__initcall
c_func
(paren
id|gdb_mc_init
)paren
suffix:semicolon
macro_line|#endif
DECL|function|signal_usr1
r_void
id|signal_usr1
c_func
(paren
r_int
id|sig
)paren
(brace
r_if
c_cond
(paren
id|debugger_pid
op_ne
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;The debugger is already running&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|debugger_pid
op_assign
id|start_debugger
c_func
(paren
id|linux_prog
comma
l_int|0
comma
l_int|0
comma
op_amp
id|debugger_fd
)paren
suffix:semicolon
id|init_proxy
c_func
(paren
id|debugger_pid
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|init_ptrace_proxy
r_int
id|init_ptrace_proxy
c_func
(paren
r_int
id|idle_pid
comma
r_int
id|startup
comma
r_int
id|stop
)paren
(brace
r_int
id|pid
comma
id|status
suffix:semicolon
id|pid
op_assign
id|start_debugger
c_func
(paren
id|linux_prog
comma
id|startup
comma
id|stop
comma
op_amp
id|debugger_fd
)paren
suffix:semicolon
id|status
op_assign
id|wait_for_stop
c_func
(paren
id|idle_pid
comma
id|SIGSTOP
comma
id|PTRACE_CONT
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pid
OL
l_int|0
)paren
(brace
id|cont
c_func
(paren
id|idle_pid
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|init_proxy
c_func
(paren
id|pid
comma
l_int|1
comma
id|status
)paren
suffix:semicolon
r_return
id|pid
suffix:semicolon
)brace
DECL|function|attach_debugger
r_int
id|attach_debugger
c_func
(paren
r_int
id|idle_pid
comma
r_int
id|pid
comma
r_int
id|stop
)paren
(brace
r_int
id|status
op_assign
l_int|0
comma
id|err
suffix:semicolon
id|err
op_assign
id|attach
c_func
(paren
id|pid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;Failed to attach pid %d, errno = %d&bslash;n&quot;
comma
id|pid
comma
op_minus
id|err
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stop
)paren
(brace
id|status
op_assign
id|wait_for_stop
c_func
(paren
id|idle_pid
comma
id|SIGSTOP
comma
id|PTRACE_CONT
comma
l_int|NULL
)paren
suffix:semicolon
)brace
id|init_proxy
c_func
(paren
id|pid
comma
l_int|1
comma
id|status
)paren
suffix:semicolon
r_return
id|pid
suffix:semicolon
)brace
macro_line|#ifdef notdef /* Put this back in when it does something useful */
DECL|function|uml_gdb_init_setup
r_static
r_int
id|__init
id|uml_gdb_init_setup
c_func
(paren
r_char
op_star
id|line
comma
r_int
op_star
id|add
)paren
(brace
id|gdb_init
op_assign
id|uml_strdup
c_func
(paren
id|line
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|__uml_setup
c_func
(paren
l_string|&quot;gdb=&quot;
comma
id|uml_gdb_init_setup
comma
l_string|&quot;gdb=&lt;channel description&gt;&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
DECL|function|uml_gdb_pid_setup
r_static
r_int
id|__init
id|uml_gdb_pid_setup
c_func
(paren
r_char
op_star
id|line
comma
r_int
op_star
id|add
)paren
(brace
id|gdb_pid
op_assign
id|simple_strtoul
c_func
(paren
id|line
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
op_star
id|add
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|__uml_setup
c_func
(paren
l_string|&quot;gdb-pid=&quot;
comma
id|uml_gdb_pid_setup
comma
l_string|&quot;gdb-pid=&lt;pid&gt;&bslash;n&quot;
l_string|&quot;    gdb-pid is used to attach an external debugger to UML.  This may be&bslash;n&quot;
l_string|&quot;    an already-running gdb or a debugger-like process like strace.&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#else
DECL|function|debugger_signal
r_int
(def_block
id|debugger_signal
c_func
(paren
r_int
id|status
comma
id|pid_t
id|pid
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
)def_block
DECL|function|child_signal
r_void
(def_block
id|child_signal
c_func
(paren
id|pid_t
id|pid
comma
r_int
id|status
)paren
(brace
)brace
)def_block
DECL|function|init_ptrace_proxy
r_int
id|init_ptrace_proxy
c_func
(paren
r_int
id|idle_pid
comma
r_int
id|startup
comma
r_int
id|stop
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;debug requested when CONFIG_PT_PROXY is off&bslash;n&quot;
)paren
suffix:semicolon
id|kill_child_dead
c_func
(paren
id|idle_pid
)paren
suffix:semicolon
m_exit
(paren
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|signal_usr1
r_void
id|signal_usr1
c_func
(paren
r_int
id|sig
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;debug requested when CONFIG_PT_PROXY is off&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|attach_debugger
r_int
id|attach_debugger
c_func
(paren
r_int
id|idle_pid
comma
r_int
id|pid
comma
r_int
id|stop
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;attach_debugger called when CONFIG_PT_PROXY &quot;
l_string|&quot;is off&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|config_gdb
r_int
id|config_gdb
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|remove_gdb
r_int
id|remove_gdb
c_func
(paren
r_void
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|init_parent_proxy
r_int
id|init_parent_proxy
c_func
(paren
r_int
id|pid
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|debugger_parent_signal
r_void
id|debugger_parent_signal
c_func
(paren
r_int
id|status
comma
r_int
id|pid
)paren
(brace
)brace
macro_line|#endif
multiline_comment|/*&n; * Overrides for Emacs so that we follow Linus&squot;s tabbing style.&n; * Emacs will notice this stuff at the end of the file and automatically&n; * adjust the settings for this buffer only.  This must remain at the end&n; * of the file.&n; * ---------------------------------------------------------------------------&n; * Local variables:&n; * c-file-style: &quot;linux&quot;&n; * End:&n; */
eof
