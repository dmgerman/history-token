multiline_comment|/* &n; * Copyright (C) 2002 Jeff Dike (jdike@karaya.com)&n; * Licensed under the GPL&n; */
macro_line|#include &quot;linux/sched.h&quot;
macro_line|#include &quot;linux/slab.h&quot;
macro_line|#include &quot;kern_util.h&quot;
macro_line|#include &quot;time_user.h&quot;
macro_line|#include &quot;signal_user.h&quot;
macro_line|#include &quot;skas.h&quot;
macro_line|#include &quot;os.h&quot;
macro_line|#include &quot;user_util.h&quot;
macro_line|#include &quot;tlb.h&quot;
macro_line|#include &quot;frame.h&quot;
macro_line|#include &quot;kern.h&quot;
macro_line|#include &quot;mode.h&quot;
DECL|function|singlestepping_skas
r_int
id|singlestepping_skas
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
op_assign
id|current-&gt;ptrace
op_amp
id|PT_DTRACE
suffix:semicolon
id|current-&gt;ptrace
op_and_assign
op_complement
id|PT_DTRACE
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|switch_to_skas
r_void
op_star
id|switch_to_skas
c_func
(paren
r_void
op_star
id|prev
comma
r_void
op_star
id|next
)paren
(brace
r_struct
id|task_struct
op_star
id|from
comma
op_star
id|to
suffix:semicolon
id|from
op_assign
id|prev
suffix:semicolon
id|to
op_assign
id|next
suffix:semicolon
multiline_comment|/* XXX need to check runqueues[cpu].idle */
r_if
c_cond
(paren
id|current-&gt;pid
op_eq
l_int|0
)paren
(brace
id|switch_timers
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|to-&gt;thread.prev_sched
op_assign
id|from
suffix:semicolon
id|set_current
c_func
(paren
id|to
)paren
suffix:semicolon
id|switch_threads
c_func
(paren
op_amp
id|from-&gt;thread.mode.skas.switch_buf
comma
id|to-&gt;thread.mode.skas.switch_buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;pid
op_eq
l_int|0
)paren
(brace
id|switch_timers
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_return
id|current-&gt;thread.prev_sched
suffix:semicolon
)brace
r_extern
r_void
id|schedule_tail
c_func
(paren
r_struct
id|task_struct
op_star
id|prev
)paren
suffix:semicolon
DECL|function|new_thread_handler
r_void
id|new_thread_handler
c_func
(paren
r_int
id|sig
)paren
(brace
r_int
(paren
op_star
id|fn
)paren
(paren
r_void
op_star
)paren
comma
id|n
suffix:semicolon
r_void
op_star
id|arg
suffix:semicolon
id|fn
op_assign
id|current-&gt;thread.request.u.thread.proc
suffix:semicolon
id|arg
op_assign
id|current-&gt;thread.request.u.thread.arg
suffix:semicolon
id|change_sig
c_func
(paren
id|SIGUSR1
comma
l_int|1
)paren
suffix:semicolon
id|thread_wait
c_func
(paren
op_amp
id|current-&gt;thread.mode.skas.switch_buf
comma
id|current-&gt;thread.mode.skas.fork_buf
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SMP
id|schedule_tail
c_func
(paren
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
id|current-&gt;thread.prev_sched
op_assign
l_int|NULL
suffix:semicolon
id|n
op_assign
id|run_kernel_thread
c_func
(paren
id|fn
comma
id|arg
comma
op_amp
id|current-&gt;thread.exec_buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|n
op_eq
l_int|1
)paren
(brace
id|userspace
c_func
(paren
op_amp
id|current-&gt;thread.regs.regs
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|n
op_eq
l_int|2
)paren
(brace
id|do_exit
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
)brace
DECL|function|new_thread_proc
r_void
id|new_thread_proc
c_func
(paren
r_void
op_star
id|stack
comma
r_void
(paren
op_star
id|handler
)paren
(paren
r_int
id|sig
)paren
)paren
(brace
id|init_new_thread_stack
c_func
(paren
id|stack
comma
id|handler
)paren
suffix:semicolon
id|os_usr1_process
c_func
(paren
id|os_getpid
c_func
(paren
)paren
)paren
suffix:semicolon
)brace
DECL|function|release_thread_skas
r_void
id|release_thread_skas
c_func
(paren
r_struct
id|task_struct
op_star
id|task
)paren
(brace
)brace
DECL|function|exit_thread_skas
r_void
id|exit_thread_skas
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|fork_handler
r_void
id|fork_handler
c_func
(paren
r_int
id|sig
)paren
(brace
id|change_sig
c_func
(paren
id|SIGUSR1
comma
l_int|1
)paren
suffix:semicolon
id|thread_wait
c_func
(paren
op_amp
id|current-&gt;thread.mode.skas.switch_buf
comma
id|current-&gt;thread.mode.skas.fork_buf
)paren
suffix:semicolon
id|force_flush_all
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SMP
id|schedule_tail
c_func
(paren
id|current-&gt;thread.prev_sched
)paren
suffix:semicolon
macro_line|#endif
id|current-&gt;thread.prev_sched
op_assign
l_int|NULL
suffix:semicolon
id|unblock_signals
c_func
(paren
)paren
suffix:semicolon
id|userspace
c_func
(paren
op_amp
id|current-&gt;thread.regs.regs
)paren
suffix:semicolon
)brace
DECL|function|copy_thread_skas
r_int
id|copy_thread_skas
c_func
(paren
r_int
id|nr
comma
r_int
r_int
id|clone_flags
comma
r_int
r_int
id|sp
comma
r_int
r_int
id|stack_top
comma
r_struct
id|task_struct
op_star
id|p
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_void
(paren
op_star
id|handler
)paren
(paren
r_int
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current-&gt;thread.forking
)paren
(brace
id|memcpy
c_func
(paren
op_amp
id|p-&gt;thread.regs.regs.mode.skas
comma
op_amp
id|current-&gt;thread.regs.regs.mode.skas
comma
r_sizeof
(paren
id|p-&gt;thread.regs.regs.mode.skas
)paren
)paren
suffix:semicolon
id|REGS_SET_SYSCALL_RETURN
c_func
(paren
id|p-&gt;thread.regs.regs.mode.skas.regs
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sp
op_ne
l_int|0
)paren
(brace
id|REGS_SP
c_func
(paren
id|p-&gt;thread.regs.regs.mode.skas.regs
)paren
op_assign
id|sp
suffix:semicolon
)brace
id|handler
op_assign
id|fork_handler
suffix:semicolon
)brace
r_else
(brace
id|memcpy
c_func
(paren
id|p-&gt;thread.regs.regs.mode.skas.regs
comma
id|exec_regs
comma
r_sizeof
(paren
id|p-&gt;thread.regs.regs.mode.skas.regs
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|p-&gt;thread.regs.regs.mode.skas.fp
comma
id|exec_fp_regs
comma
r_sizeof
(paren
id|p-&gt;thread.regs.regs.mode.skas.fp
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|p-&gt;thread.regs.regs.mode.skas.xfp
comma
id|exec_fpx_regs
comma
r_sizeof
(paren
id|p-&gt;thread.regs.regs.mode.skas.xfp
)paren
)paren
suffix:semicolon
id|p-&gt;thread.request.u.thread
op_assign
id|current-&gt;thread.request.u.thread
suffix:semicolon
id|handler
op_assign
id|new_thread_handler
suffix:semicolon
)brace
id|new_thread
c_func
(paren
(paren
r_void
op_star
)paren
id|p-&gt;thread.kernel_stack
comma
op_amp
id|p-&gt;thread.mode.skas.switch_buf
comma
op_amp
id|p-&gt;thread.mode.skas.fork_buf
comma
id|handler
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|init_idle_skas
r_void
id|init_idle_skas
c_func
(paren
r_void
)paren
(brace
id|cpu_tasks
(braket
id|current-&gt;thread_info-&gt;cpu
)braket
dot
id|pid
op_assign
id|os_getpid
c_func
(paren
)paren
suffix:semicolon
id|default_idle
c_func
(paren
)paren
suffix:semicolon
)brace
r_extern
r_void
id|start_kernel
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|function|start_kernel_proc
r_static
r_int
id|start_kernel_proc
c_func
(paren
r_void
op_star
id|unused
)paren
(brace
r_int
id|pid
suffix:semicolon
id|block_signals
c_func
(paren
)paren
suffix:semicolon
id|pid
op_assign
id|os_getpid
c_func
(paren
)paren
suffix:semicolon
id|cpu_tasks
(braket
l_int|0
)braket
dot
id|pid
op_assign
id|pid
suffix:semicolon
id|cpu_tasks
(braket
l_int|0
)braket
dot
id|task
op_assign
id|current
suffix:semicolon
macro_line|#ifdef CONFIG_SMP
id|cpu_online_map
op_assign
l_int|1
suffix:semicolon
macro_line|#endif
id|start_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|start_uml_skas
r_int
id|start_uml_skas
c_func
(paren
r_void
)paren
(brace
id|start_userspace
c_func
(paren
)paren
suffix:semicolon
id|capture_signal_stack
c_func
(paren
)paren
suffix:semicolon
id|init_new_thread_signals
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|idle_timer
c_func
(paren
)paren
suffix:semicolon
id|init_task.thread.request.u.thread.proc
op_assign
id|start_kernel_proc
suffix:semicolon
id|init_task.thread.request.u.thread.arg
op_assign
l_int|NULL
suffix:semicolon
r_return
id|start_idle_thread
c_func
(paren
(paren
r_void
op_star
)paren
id|init_task.thread.kernel_stack
comma
op_amp
id|init_task.thread.mode.skas.switch_buf
comma
op_amp
id|init_task.thread.mode.skas.fork_buf
)paren
suffix:semicolon
)brace
DECL|function|external_pid_skas
r_int
id|external_pid_skas
c_func
(paren
r_struct
id|task_struct
op_star
id|task
)paren
(brace
r_return
id|userspace_pid
suffix:semicolon
)brace
DECL|function|thread_pid_skas
r_int
id|thread_pid_skas
c_func
(paren
r_struct
id|task_struct
op_star
id|task
)paren
(brace
r_return
id|userspace_pid
suffix:semicolon
)brace
multiline_comment|/*&n; * Overrides for Emacs so that we follow Linus&squot;s tabbing style.&n; * Emacs will notice this stuff at the end of the file and automatically&n; * adjust the settings for this buffer only.  This must remain at the end&n; * of the file.&n; * ---------------------------------------------------------------------------&n; * Local variables:&n; * c-file-style: &quot;linux&quot;&n; * End:&n; */
eof
