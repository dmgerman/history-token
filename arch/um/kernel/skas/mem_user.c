multiline_comment|/* &n; * Copyright (C) 2002 Jeff Dike (jdike@karaya.com)&n; * Licensed under the GPL&n; */
macro_line|#include &lt;errno.h&gt;
macro_line|#include &lt;sys/mman.h&gt;
macro_line|#include &lt;sys/ptrace.h&gt;
macro_line|#include &quot;mem_user.h&quot;
macro_line|#include &quot;user.h&quot;
macro_line|#include &quot;os.h&quot;
macro_line|#include &quot;proc_mm.h&quot;
DECL|function|map
r_void
id|map
c_func
(paren
r_int
id|fd
comma
r_int
r_int
id|virt
comma
r_int
r_int
id|phys
comma
r_int
r_int
id|len
comma
r_int
id|r
comma
r_int
id|w
comma
r_int
id|x
)paren
(brace
r_struct
id|proc_mm_op
id|map
suffix:semicolon
r_struct
id|mem_region
op_star
id|region
suffix:semicolon
r_int
id|prot
comma
id|n
suffix:semicolon
id|prot
op_assign
(paren
id|r
ques
c_cond
id|PROT_READ
suffix:colon
l_int|0
)paren
op_or
(paren
id|w
ques
c_cond
id|PROT_WRITE
suffix:colon
l_int|0
)paren
op_or
(paren
id|x
ques
c_cond
id|PROT_EXEC
suffix:colon
l_int|0
)paren
suffix:semicolon
id|region
op_assign
id|phys_region
c_func
(paren
id|phys
)paren
suffix:semicolon
id|map
op_assign
(paren
(paren
r_struct
id|proc_mm_op
)paren
(brace
dot
id|op
op_assign
id|MM_MMAP
comma
dot
id|u
op_assign
(brace
dot
id|mmap
op_assign
(brace
dot
id|addr
op_assign
id|virt
comma
dot
id|len
op_assign
id|len
comma
dot
id|prot
op_assign
id|prot
comma
dot
id|flags
op_assign
id|MAP_SHARED
op_or
id|MAP_FIXED
comma
dot
id|fd
op_assign
id|region-&gt;fd
comma
dot
id|offset
op_assign
id|phys_offset
c_func
(paren
id|phys
)paren
)brace
)brace
)brace
)paren
suffix:semicolon
id|n
op_assign
id|os_write_file
c_func
(paren
id|fd
comma
(paren
r_char
op_star
)paren
op_amp
id|map
comma
r_sizeof
(paren
id|map
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|n
op_ne
r_sizeof
(paren
id|map
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;map : /proc/mm map failed, errno = %d&bslash;n&quot;
comma
id|errno
)paren
suffix:semicolon
)brace
)brace
DECL|function|unmap
r_int
id|unmap
c_func
(paren
r_int
id|fd
comma
r_void
op_star
id|addr
comma
r_int
id|len
)paren
(brace
r_struct
id|proc_mm_op
id|unmap
suffix:semicolon
r_int
id|n
suffix:semicolon
id|unmap
op_assign
(paren
(paren
r_struct
id|proc_mm_op
)paren
(brace
dot
id|op
op_assign
id|MM_MUNMAP
comma
dot
id|u
op_assign
(brace
dot
id|munmap
op_assign
(brace
dot
id|addr
op_assign
(paren
r_int
r_int
)paren
id|addr
comma
dot
id|len
op_assign
id|len
)brace
)brace
)brace
)paren
suffix:semicolon
id|n
op_assign
id|os_write_file
c_func
(paren
id|fd
comma
(paren
r_char
op_star
)paren
op_amp
id|unmap
comma
r_sizeof
(paren
id|unmap
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|n
op_ne
l_int|0
)paren
op_logical_and
(paren
id|n
op_ne
r_sizeof
(paren
id|unmap
)paren
)paren
)paren
(brace
r_return
op_minus
id|errno
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|protect
r_int
id|protect
c_func
(paren
r_int
id|fd
comma
r_int
r_int
id|addr
comma
r_int
r_int
id|len
comma
r_int
id|r
comma
r_int
id|w
comma
r_int
id|x
comma
r_int
id|must_succeed
)paren
(brace
r_struct
id|proc_mm_op
id|protect
suffix:semicolon
r_int
id|prot
comma
id|n
suffix:semicolon
id|prot
op_assign
(paren
id|r
ques
c_cond
id|PROT_READ
suffix:colon
l_int|0
)paren
op_or
(paren
id|w
ques
c_cond
id|PROT_WRITE
suffix:colon
l_int|0
)paren
op_or
(paren
id|x
ques
c_cond
id|PROT_EXEC
suffix:colon
l_int|0
)paren
suffix:semicolon
id|protect
op_assign
(paren
(paren
r_struct
id|proc_mm_op
)paren
(brace
dot
id|op
op_assign
id|MM_MPROTECT
comma
dot
id|u
op_assign
(brace
dot
id|mprotect
op_assign
(brace
dot
id|addr
op_assign
(paren
r_int
r_int
)paren
id|addr
comma
dot
id|len
op_assign
id|len
comma
dot
id|prot
op_assign
id|prot
)brace
)brace
)brace
)paren
suffix:semicolon
id|n
op_assign
id|os_write_file
c_func
(paren
id|fd
comma
(paren
r_char
op_star
)paren
op_amp
id|protect
comma
r_sizeof
(paren
id|protect
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|n
op_ne
l_int|0
)paren
op_logical_and
(paren
id|n
op_ne
r_sizeof
(paren
id|protect
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|must_succeed
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;protect failed, errno = %d&quot;
comma
id|errno
)paren
suffix:semicolon
)brace
r_return
op_minus
id|errno
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|before_mem_skas
r_void
id|before_mem_skas
c_func
(paren
r_int
r_int
id|unused
)paren
(brace
)brace
multiline_comment|/*&n; * Overrides for Emacs so that we follow Linus&squot;s tabbing style.&n; * Emacs will notice this stuff at the end of the file and automatically&n; * adjust the settings for this buffer only.  This must remain at the end&n; * of the file.&n; * ---------------------------------------------------------------------------&n; * Local variables:&n; * c-file-style: &quot;linux&quot;&n; * End:&n; */
eof
