multiline_comment|/* &n; * Copyright (C) 2002 Jeff Dike (jdike@karaya.com)&n; * Licensed under the GPL&n; */
macro_line|#include &quot;asm/ptrace.h&quot;
macro_line|#include &quot;asm/uaccess.h&quot;
macro_line|#include &quot;asm/signal.h&quot;
macro_line|#include &quot;asm/ucontext.h&quot;
macro_line|#include &quot;frame_kern.h&quot;
macro_line|#include &quot;sigcontext.h&quot;
macro_line|#include &quot;sysdep/ptrace.h&quot;
macro_line|#include &quot;choose-mode.h&quot;
macro_line|#include &quot;mode.h&quot;
DECL|function|copy_restorer
r_static
r_int
id|copy_restorer
c_func
(paren
r_void
(paren
op_star
id|restorer
)paren
(paren
r_void
)paren
comma
r_int
r_int
id|start
comma
r_int
r_int
id|sr_index
comma
r_int
id|sr_relative
)paren
(brace
r_int
r_int
id|sr
suffix:semicolon
r_if
c_cond
(paren
id|sr_relative
)paren
(brace
id|sr
op_assign
(paren
r_int
r_int
)paren
id|restorer
suffix:semicolon
id|sr
op_add_assign
id|start
op_plus
id|sr_index
suffix:semicolon
id|restorer
op_assign
(paren
r_void
(paren
op_star
)paren
(paren
r_void
)paren
)paren
id|sr
suffix:semicolon
)brace
r_return
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
(paren
id|start
op_plus
id|sr_index
)paren
comma
op_amp
id|restorer
comma
r_sizeof
(paren
id|restorer
)paren
)paren
suffix:semicolon
)brace
r_extern
r_int
id|userspace_pid
(braket
)braket
suffix:semicolon
DECL|function|copy_sc_to_user
r_static
r_int
id|copy_sc_to_user
c_func
(paren
r_void
op_star
id|to
comma
r_void
op_star
id|fp
comma
r_struct
id|pt_regs
op_star
id|from
comma
r_struct
id|arch_frame_data
op_star
id|arch
)paren
(brace
r_return
id|CHOOSE_MODE
c_func
(paren
id|copy_sc_to_user_tt
c_func
(paren
id|to
comma
id|fp
comma
id|UPT_SC
c_func
(paren
op_amp
id|from-&gt;regs
)paren
comma
id|arch
)paren
comma
id|copy_sc_to_user_skas
c_func
(paren
id|userspace_pid
(braket
l_int|0
)braket
comma
id|to
comma
id|fp
comma
op_amp
id|from-&gt;regs
comma
id|current-&gt;thread.cr2
comma
id|current-&gt;thread.err
)paren
)paren
suffix:semicolon
)brace
DECL|function|copy_ucontext_to_user
r_static
r_int
id|copy_ucontext_to_user
c_func
(paren
r_struct
id|ucontext
op_star
id|uc
comma
r_void
op_star
id|fp
comma
id|sigset_t
op_star
id|set
comma
r_int
r_int
id|sp
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|err
op_or_assign
id|put_user
c_func
(paren
id|current-&gt;sas_ss_sp
comma
op_amp
id|uc-&gt;uc_stack.ss_sp
)paren
suffix:semicolon
id|err
op_or_assign
id|put_user
c_func
(paren
id|sas_ss_flags
c_func
(paren
id|sp
)paren
comma
op_amp
id|uc-&gt;uc_stack.ss_flags
)paren
suffix:semicolon
id|err
op_or_assign
id|put_user
c_func
(paren
id|current-&gt;sas_ss_size
comma
op_amp
id|uc-&gt;uc_stack.ss_size
)paren
suffix:semicolon
id|err
op_or_assign
id|copy_sc_to_user
c_func
(paren
op_amp
id|uc-&gt;uc_mcontext
comma
id|fp
comma
op_amp
id|current-&gt;thread.regs
comma
op_amp
id|signal_frame_si.common.arch
)paren
suffix:semicolon
id|err
op_or_assign
id|copy_to_user
c_func
(paren
op_amp
id|uc-&gt;uc_sigmask
comma
id|set
comma
r_sizeof
(paren
op_star
id|set
)paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|setup_signal_stack_si
r_int
id|setup_signal_stack_si
c_func
(paren
r_int
r_int
id|stack_top
comma
r_int
id|sig
comma
r_struct
id|k_sigaction
op_star
id|ka
comma
r_struct
id|pt_regs
op_star
id|regs
comma
id|siginfo_t
op_star
id|info
comma
id|sigset_t
op_star
id|mask
)paren
(brace
r_int
r_int
id|start
suffix:semicolon
r_void
op_star
id|restorer
suffix:semicolon
r_void
op_star
id|sip
comma
op_star
id|ucp
comma
op_star
id|fp
suffix:semicolon
id|start
op_assign
id|stack_top
op_minus
id|signal_frame_si.common.len
suffix:semicolon
id|sip
op_assign
(paren
r_void
op_star
)paren
(paren
id|start
op_plus
id|signal_frame_si.si_index
)paren
suffix:semicolon
id|ucp
op_assign
(paren
r_void
op_star
)paren
(paren
id|start
op_plus
id|signal_frame_si.uc_index
)paren
suffix:semicolon
id|fp
op_assign
(paren
r_void
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|ucp
)paren
op_plus
r_sizeof
(paren
r_struct
id|ucontext
)paren
)paren
suffix:semicolon
id|restorer
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|ka-&gt;sa.sa_flags
op_amp
id|SA_RESTORER
)paren
(brace
id|restorer
op_assign
id|ka-&gt;sa.sa_restorer
suffix:semicolon
)brace
r_if
c_cond
(paren
id|restorer
op_eq
l_int|NULL
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;setup_signal_stack_si - no restorer&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|start
comma
id|signal_frame_si.common.data
comma
id|signal_frame_si.common.len
)paren
op_logical_or
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
(paren
id|start
op_plus
id|signal_frame_si.common.sig_index
)paren
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
op_logical_or
id|copy_siginfo_to_user
c_func
(paren
id|sip
comma
id|info
)paren
op_logical_or
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
(paren
id|start
op_plus
id|signal_frame_si.sip_index
)paren
comma
op_amp
id|sip
comma
r_sizeof
(paren
id|sip
)paren
)paren
op_logical_or
id|copy_ucontext_to_user
c_func
(paren
id|ucp
comma
id|fp
comma
id|mask
comma
id|PT_REGS_SP
c_func
(paren
id|regs
)paren
)paren
op_logical_or
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
(paren
id|start
op_plus
id|signal_frame_si.ucp_index
)paren
comma
op_amp
id|ucp
comma
r_sizeof
(paren
id|ucp
)paren
)paren
op_logical_or
id|copy_restorer
c_func
(paren
id|restorer
comma
id|start
comma
id|signal_frame_si.common.sr_index
comma
id|signal_frame_si.common.sr_relative
)paren
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
id|PT_REGS_IP
c_func
(paren
id|regs
)paren
op_assign
(paren
r_int
r_int
)paren
id|ka-&gt;sa.sa_handler
suffix:semicolon
id|PT_REGS_SP
c_func
(paren
id|regs
)paren
op_assign
id|start
op_plus
id|signal_frame_si.common.sp_index
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|setup_signal_stack_sc
r_int
id|setup_signal_stack_sc
c_func
(paren
r_int
r_int
id|stack_top
comma
r_int
id|sig
comma
r_struct
id|k_sigaction
op_star
id|ka
comma
r_struct
id|pt_regs
op_star
id|regs
comma
id|sigset_t
op_star
id|mask
)paren
(brace
r_struct
id|frame_common
op_star
id|frame
op_assign
op_amp
id|signal_frame_sc_sr.common
suffix:semicolon
r_void
op_star
id|restorer
suffix:semicolon
r_void
op_star
id|user_sc
suffix:semicolon
r_int
id|sig_size
op_assign
(paren
id|_NSIG_WORDS
op_minus
l_int|1
)paren
op_star
r_sizeof
(paren
r_int
r_int
)paren
suffix:semicolon
r_int
r_int
id|sigs
comma
id|sr
suffix:semicolon
r_int
r_int
id|start
op_assign
id|stack_top
op_minus
id|frame-&gt;len
op_minus
id|sig_size
suffix:semicolon
id|restorer
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|ka-&gt;sa.sa_flags
op_amp
id|SA_RESTORER
)paren
(brace
id|restorer
op_assign
id|ka-&gt;sa.sa_restorer
suffix:semicolon
)brace
id|user_sc
op_assign
(paren
r_void
op_star
)paren
(paren
id|start
op_plus
id|signal_frame_sc_sr.sc_index
)paren
suffix:semicolon
r_if
c_cond
(paren
id|restorer
op_eq
l_int|NULL
)paren
(brace
id|frame
op_assign
op_amp
id|signal_frame_sc.common
suffix:semicolon
id|user_sc
op_assign
(paren
r_void
op_star
)paren
(paren
id|start
op_plus
id|signal_frame_sc.sc_index
)paren
suffix:semicolon
id|sr
op_assign
(paren
r_int
r_int
)paren
id|frame-&gt;data
suffix:semicolon
id|sr
op_add_assign
id|frame-&gt;sr_index
suffix:semicolon
id|sr
op_assign
op_star
(paren
(paren
r_int
r_int
op_star
)paren
id|sr
)paren
suffix:semicolon
id|restorer
op_assign
(paren
(paren
r_void
(paren
op_star
)paren
(paren
r_void
)paren
)paren
id|sr
)paren
suffix:semicolon
)brace
id|sigs
op_assign
id|start
op_plus
id|frame-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|start
comma
id|frame-&gt;data
comma
id|frame-&gt;len
)paren
op_logical_or
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
(paren
id|start
op_plus
id|frame-&gt;sig_index
)paren
comma
op_amp
id|sig
comma
r_sizeof
(paren
id|sig
)paren
)paren
op_logical_or
id|copy_sc_to_user
c_func
(paren
id|user_sc
comma
l_int|NULL
comma
id|regs
comma
op_amp
id|signal_frame_sc.common.arch
)paren
op_logical_or
id|copy_to_user
c_func
(paren
id|sc_sigmask
c_func
(paren
id|user_sc
)paren
comma
id|mask
comma
r_sizeof
(paren
id|mask-&gt;sig
(braket
l_int|0
)braket
)paren
)paren
op_logical_or
id|copy_to_user
c_func
(paren
(paren
r_void
op_star
)paren
id|sigs
comma
op_amp
id|mask-&gt;sig
(braket
l_int|1
)braket
comma
id|sig_size
)paren
op_logical_or
id|copy_restorer
c_func
(paren
id|restorer
comma
id|start
comma
id|frame-&gt;sr_index
comma
id|frame-&gt;sr_relative
)paren
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
id|PT_REGS_IP
c_func
(paren
id|regs
)paren
op_assign
(paren
r_int
r_int
)paren
id|ka-&gt;sa.sa_handler
suffix:semicolon
id|PT_REGS_SP
c_func
(paren
id|regs
)paren
op_assign
id|start
op_plus
id|frame-&gt;sp_index
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Overrides for Emacs so that we follow Linus&squot;s tabbing style.&n; * Emacs will notice this stuff at the end of the file and automatically&n; * adjust the settings for this buffer only.  This must remain at the end&n; * of the file.&n; * ---------------------------------------------------------------------------&n; * Local variables:&n; * c-file-style: &quot;linux&quot;&n; * End:&n; */
eof
