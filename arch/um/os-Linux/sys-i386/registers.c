multiline_comment|/*&n; * Copyright (C) 2004 PathScale, Inc&n; * Licensed under the GPL&n; */
macro_line|#include &lt;errno.h&gt;
macro_line|#include &lt;string.h&gt;
macro_line|#include &lt;sys/ptrace.h&gt;
macro_line|#include &quot;sysdep/ptrace.h&quot;
macro_line|#include &quot;uml-config.h&quot;
macro_line|#include &quot;skas_ptregs.h&quot;
macro_line|#include &quot;registers.h&quot;
macro_line|#include &quot;user.h&quot;
multiline_comment|/* These are set once at boot time and not changed thereafter */
DECL|variable|exec_regs
r_static
r_int
r_int
id|exec_regs
(braket
id|HOST_FRAME_SIZE
)braket
suffix:semicolon
DECL|variable|exec_fp_regs
r_static
r_int
r_int
id|exec_fp_regs
(braket
id|HOST_FP_SIZE
)braket
suffix:semicolon
DECL|variable|exec_fpx_regs
r_static
r_int
r_int
id|exec_fpx_regs
(braket
id|HOST_XFP_SIZE
)braket
suffix:semicolon
DECL|variable|have_fpx_regs
r_static
r_int
id|have_fpx_regs
op_assign
l_int|1
suffix:semicolon
DECL|function|init_thread_registers
r_void
id|init_thread_registers
c_func
(paren
r_union
id|uml_pt_regs
op_star
id|to
)paren
(brace
id|memcpy
c_func
(paren
id|to-&gt;skas.regs
comma
id|exec_regs
comma
r_sizeof
(paren
id|to-&gt;skas.regs
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|to-&gt;skas.fp
comma
id|exec_fp_regs
comma
r_sizeof
(paren
id|to-&gt;skas.fp
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|have_fpx_regs
)paren
(brace
id|memcpy
c_func
(paren
id|to-&gt;skas.xfp
comma
id|exec_fpx_regs
comma
r_sizeof
(paren
id|to-&gt;skas.xfp
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|move_registers
r_static
r_int
id|move_registers
c_func
(paren
r_int
id|pid
comma
r_int
id|int_op
comma
r_union
id|uml_pt_regs
op_star
id|regs
comma
r_int
id|fp_op
comma
r_int
r_int
op_star
id|fp_regs
)paren
(brace
r_if
c_cond
(paren
id|ptrace
c_func
(paren
id|int_op
comma
id|pid
comma
l_int|0
comma
id|regs-&gt;skas.regs
)paren
OL
l_int|0
)paren
(brace
r_return
op_minus
id|errno
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ptrace
c_func
(paren
id|fp_op
comma
id|pid
comma
l_int|0
comma
id|fp_regs
)paren
OL
l_int|0
)paren
(brace
r_return
op_minus
id|errno
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|save_registers
r_void
id|save_registers
c_func
(paren
r_int
id|pid
comma
r_union
id|uml_pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
op_star
id|fp_regs
suffix:semicolon
r_int
id|err
comma
id|fp_op
suffix:semicolon
r_if
c_cond
(paren
id|have_fpx_regs
)paren
(brace
id|fp_op
op_assign
id|PTRACE_GETFPXREGS
suffix:semicolon
id|fp_regs
op_assign
id|regs-&gt;skas.xfp
suffix:semicolon
)brace
r_else
(brace
id|fp_op
op_assign
id|PTRACE_GETFPREGS
suffix:semicolon
id|fp_regs
op_assign
id|regs-&gt;skas.fp
suffix:semicolon
)brace
id|err
op_assign
id|move_registers
c_func
(paren
id|pid
comma
id|PTRACE_GETREGS
comma
id|regs
comma
id|fp_op
comma
id|fp_regs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;save_registers - saving registers failed, errno = %d&bslash;n&quot;
comma
op_minus
id|err
)paren
suffix:semicolon
)brace
)brace
DECL|function|restore_registers
r_void
id|restore_registers
c_func
(paren
r_int
id|pid
comma
r_union
id|uml_pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
op_star
id|fp_regs
suffix:semicolon
r_int
id|err
comma
id|fp_op
suffix:semicolon
r_if
c_cond
(paren
id|have_fpx_regs
)paren
(brace
id|fp_op
op_assign
id|PTRACE_SETFPXREGS
suffix:semicolon
id|fp_regs
op_assign
id|regs-&gt;skas.xfp
suffix:semicolon
)brace
r_else
(brace
id|fp_op
op_assign
id|PTRACE_SETFPREGS
suffix:semicolon
id|fp_regs
op_assign
id|regs-&gt;skas.fp
suffix:semicolon
)brace
id|err
op_assign
id|move_registers
c_func
(paren
id|pid
comma
id|PTRACE_SETREGS
comma
id|regs
comma
id|fp_op
comma
id|fp_regs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;restore_registers - saving registers failed, &quot;
l_string|&quot;errno = %d&bslash;n&quot;
comma
op_minus
id|err
)paren
suffix:semicolon
)brace
)brace
DECL|function|init_registers
r_void
id|init_registers
c_func
(paren
r_int
id|pid
)paren
(brace
r_int
id|err
suffix:semicolon
id|err
op_assign
id|ptrace
c_func
(paren
id|PTRACE_GETREGS
comma
id|pid
comma
l_int|0
comma
id|exec_regs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;check_ptrace : PTRACE_GETREGS failed, errno = %d&quot;
comma
id|err
)paren
suffix:semicolon
)brace
id|err
op_assign
id|ptrace
c_func
(paren
id|PTRACE_GETFPXREGS
comma
id|pid
comma
l_int|0
comma
id|exec_fpx_regs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|err
)paren
(brace
r_return
suffix:semicolon
)brace
id|have_fpx_regs
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
id|EIO
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;check_ptrace : PTRACE_GETFPXREGS failed, errno = %d&quot;
comma
id|err
)paren
suffix:semicolon
)brace
id|err
op_assign
id|ptrace
c_func
(paren
id|PTRACE_GETFPREGS
comma
id|pid
comma
l_int|0
comma
id|exec_fp_regs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;check_ptrace : PTRACE_GETFPREGS failed, errno = %d&quot;
comma
id|err
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Overrides for Emacs so that we follow Linus&squot;s tabbing style.&n; * Emacs will notice this stuff at the end of the file and automatically&n; * adjust the settings for this buffer only.  This must remain at the end&n; * of the file.&n; * ---------------------------------------------------------------------------&n; * Local variables:&n; * c-file-style: &quot;linux&quot;&n; * End:&n; */
eof
