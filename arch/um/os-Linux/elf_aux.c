multiline_comment|/*&n; *  arch/um/kernel/elf_aux.c&n; *&n; *  Scan the Elf auxiliary vector provided by the host to extract&n; *  information about vsyscall-page, etc.&n; *&n; *  Copyright (C) 2004 Fujitsu Siemens Computers GmbH&n; *  Author: Bodo Stroesser (bodo.stroesser@fujitsu-siemens.com)&n; */
macro_line|#include &lt;elf.h&gt;
macro_line|#include &lt;stddef.h&gt;
macro_line|#include &quot;init.h&quot;
macro_line|#if ELF_CLASS == ELFCLASS32
DECL|typedef|elf_auxv_t
r_typedef
id|Elf32_auxv_t
id|elf_auxv_t
suffix:semicolon
macro_line|#else
DECL|typedef|elf_auxv_t
r_typedef
id|Elf64_auxv_t
id|elf_auxv_t
suffix:semicolon
macro_line|#endif
DECL|variable|elf_aux_platform
r_char
op_star
id|elf_aux_platform
suffix:semicolon
DECL|variable|elf_aux_hwcap
r_int
id|elf_aux_hwcap
suffix:semicolon
DECL|variable|vsyscall_ehdr
r_int
r_int
id|vsyscall_ehdr
suffix:semicolon
DECL|variable|vsyscall_end
r_int
r_int
id|vsyscall_end
suffix:semicolon
DECL|variable|__kernel_vsyscall
r_int
r_int
id|__kernel_vsyscall
suffix:semicolon
DECL|function|scan_elf_aux
id|__init
r_void
id|scan_elf_aux
c_func
(paren
r_char
op_star
op_star
id|envp
)paren
(brace
r_int
id|page_size
op_assign
l_int|0
suffix:semicolon
id|elf_auxv_t
op_star
id|auxv
suffix:semicolon
r_while
c_loop
(paren
op_star
id|envp
op_increment
op_ne
l_int|NULL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|auxv
op_assign
(paren
id|elf_auxv_t
op_star
)paren
id|envp
suffix:semicolon
id|auxv-&gt;a_type
op_ne
id|AT_NULL
suffix:semicolon
id|auxv
op_increment
)paren
(brace
r_switch
c_cond
(paren
id|auxv-&gt;a_type
)paren
(brace
r_case
id|AT_SYSINFO
suffix:colon
id|__kernel_vsyscall
op_assign
id|auxv-&gt;a_un.a_val
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AT_SYSINFO_EHDR
suffix:colon
id|vsyscall_ehdr
op_assign
id|auxv-&gt;a_un.a_val
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AT_HWCAP
suffix:colon
id|elf_aux_hwcap
op_assign
id|auxv-&gt;a_un.a_val
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AT_PLATFORM
suffix:colon
id|elf_aux_platform
op_assign
id|auxv-&gt;a_un.a_ptr
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AT_PAGESZ
suffix:colon
id|page_size
op_assign
id|auxv-&gt;a_un.a_val
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|__kernel_vsyscall
op_logical_or
op_logical_neg
id|vsyscall_ehdr
op_logical_or
op_logical_neg
id|elf_aux_hwcap
op_logical_or
op_logical_neg
id|elf_aux_platform
op_logical_or
op_logical_neg
id|page_size
op_logical_or
(paren
id|vsyscall_ehdr
op_mod
id|page_size
)paren
)paren
(brace
id|__kernel_vsyscall
op_assign
l_int|0
suffix:semicolon
id|vsyscall_ehdr
op_assign
l_int|0
suffix:semicolon
id|elf_aux_hwcap
op_assign
l_int|0
suffix:semicolon
id|elf_aux_platform
op_assign
l_string|&quot;i586&quot;
suffix:semicolon
)brace
r_else
(brace
id|vsyscall_end
op_assign
id|vsyscall_ehdr
op_plus
id|page_size
suffix:semicolon
)brace
)brace
eof
