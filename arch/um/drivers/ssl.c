multiline_comment|/* &n; * Copyright (C) 2000, 2002 Jeff Dike (jdike@karaya.com)&n; * Licensed under the GPL&n; */
macro_line|#include &quot;linux/config.h&quot;
macro_line|#include &quot;linux/fs.h&quot;
macro_line|#include &quot;linux/tty.h&quot;
macro_line|#include &quot;linux/tty_driver.h&quot;
macro_line|#include &quot;linux/major.h&quot;
macro_line|#include &quot;linux/mm.h&quot;
macro_line|#include &quot;linux/init.h&quot;
macro_line|#include &quot;asm/termbits.h&quot;
macro_line|#include &quot;asm/irq.h&quot;
macro_line|#include &quot;line.h&quot;
macro_line|#include &quot;ssl.h&quot;
macro_line|#include &quot;chan_kern.h&quot;
macro_line|#include &quot;user_util.h&quot;
macro_line|#include &quot;kern_util.h&quot;
macro_line|#include &quot;kern.h&quot;
macro_line|#include &quot;init.h&quot;
macro_line|#include &quot;irq_user.h&quot;
macro_line|#include &quot;2_5compat.h&quot;
DECL|variable|ssl_version
r_static
r_int
id|ssl_version
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Referenced only by tty_driver below - presumably it&squot;s locked correctly&n; * by the tty driver.&n; */
DECL|variable|ssl_refcount
r_static
r_int
id|ssl_refcount
op_assign
l_int|0
suffix:semicolon
DECL|variable|ssl_driver
r_static
r_struct
id|tty_driver
id|ssl_driver
suffix:semicolon
DECL|macro|NR_PORTS
mdefine_line|#define NR_PORTS 64
DECL|function|ssl_announce
r_void
id|ssl_announce
c_func
(paren
r_char
op_star
id|dev_name
comma
r_int
id|dev
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Serial line %d assigned device &squot;%s&squot;&bslash;n&quot;
comma
id|dev
comma
id|dev_name
)paren
suffix:semicolon
)brace
DECL|variable|opts
r_static
r_struct
id|chan_opts
id|opts
op_assign
(brace
id|announce
suffix:colon
id|ssl_announce
comma
id|xterm_title
suffix:colon
l_string|&quot;Serial Line #%d&quot;
comma
id|raw
suffix:colon
l_int|1
comma
id|tramp_stack
suffix:colon
l_int|0
comma
id|in_kernel
suffix:colon
l_int|1
comma
)brace
suffix:semicolon
DECL|variable|driver
r_static
r_struct
id|line_driver
id|driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;UML serial line&quot;
comma
id|devfs_name
suffix:colon
l_string|&quot;tts/%d&quot;
comma
id|major
suffix:colon
id|TTYAUX_MAJOR
comma
id|minor_start
suffix:colon
l_int|64
comma
id|type
suffix:colon
id|TTY_DRIVER_TYPE_SERIAL
comma
id|subtype
suffix:colon
l_int|0
comma
id|read_irq
suffix:colon
id|SSL_IRQ
comma
id|read_irq_name
suffix:colon
l_string|&quot;ssl&quot;
comma
id|write_irq
suffix:colon
id|SSL_WRITE_IRQ
comma
id|write_irq_name
suffix:colon
l_string|&quot;ssl-write&quot;
comma
id|symlink_from
suffix:colon
l_string|&quot;serial&quot;
comma
id|symlink_to
suffix:colon
l_string|&quot;tts&quot;
comma
)brace
suffix:semicolon
multiline_comment|/* The array is initialized by line_init, which is an initcall.  The &n; * individual elements are protected by individual semaphores.&n; */
DECL|variable|serial_lines
r_static
r_struct
id|line
id|serial_lines
(braket
id|NR_PORTS
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|NR_PORTS
op_minus
l_int|1
)braket
op_assign
id|LINE_INIT
c_func
(paren
id|CONFIG_SSL_CHAN
comma
op_amp
id|driver
)paren
)brace
suffix:semicolon
DECL|variable|lines
r_static
r_struct
id|lines
id|lines
op_assign
id|LINES_INIT
c_func
(paren
id|NR_PORTS
)paren
suffix:semicolon
DECL|function|ssl_open
r_int
id|ssl_open
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_return
id|line_open
c_func
(paren
id|serial_lines
comma
id|tty
comma
op_amp
id|opts
)paren
suffix:semicolon
)brace
DECL|function|ssl_close
r_static
r_void
id|ssl_close
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
id|line_close
c_func
(paren
id|serial_lines
comma
id|tty
)paren
suffix:semicolon
)brace
DECL|function|ssl_write
r_static
r_int
id|ssl_write
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_int
id|from_user
comma
r_const
r_int
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_return
id|line_write
c_func
(paren
id|serial_lines
comma
id|tty
comma
id|buf
comma
id|count
)paren
suffix:semicolon
)brace
DECL|function|ssl_put_char
r_static
r_void
id|ssl_put_char
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_int
r_char
id|ch
)paren
(brace
id|line_write
c_func
(paren
id|serial_lines
comma
id|tty
comma
op_amp
id|ch
comma
r_sizeof
(paren
id|ch
)paren
)paren
suffix:semicolon
)brace
DECL|function|ssl_flush_chars
r_static
r_void
id|ssl_flush_chars
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_return
suffix:semicolon
)brace
DECL|function|ssl_chars_in_buffer
r_static
r_int
id|ssl_chars_in_buffer
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ssl_flush_buffer
r_static
r_void
id|ssl_flush_buffer
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_return
suffix:semicolon
)brace
DECL|function|ssl_ioctl
r_static
r_int
id|ssl_ioctl
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
id|ret
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|TCGETS
suffix:colon
r_case
id|TCSETS
suffix:colon
r_case
id|TCFLSH
suffix:colon
r_case
id|TCSETSF
suffix:colon
r_case
id|TCSETSW
suffix:colon
r_case
id|TCGETA
suffix:colon
r_case
id|TIOCMGET
suffix:colon
id|ret
op_assign
op_minus
id|ENOIOCTLCMD
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Unimplemented ioctl in ssl_ioctl : 0x%x&bslash;n&quot;
comma
id|cmd
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENOIOCTLCMD
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|ssl_throttle
r_static
r_void
id|ssl_throttle
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Someone should implement ssl_throttle&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|ssl_unthrottle
r_static
r_void
id|ssl_unthrottle
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Someone should implement ssl_unthrottle&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|ssl_set_termios
r_static
r_void
id|ssl_set_termios
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|termios
op_star
id|old_termios
)paren
(brace
)brace
DECL|function|ssl_stop
r_static
r_void
id|ssl_stop
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Someone should implement ssl_stop&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|ssl_start
r_static
r_void
id|ssl_start
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Someone should implement ssl_start&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|ssl_hangup
r_void
id|ssl_hangup
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
)brace
DECL|variable|ssl_driver
r_static
r_struct
id|tty_driver
id|ssl_driver
op_assign
(brace
id|refcount
suffix:colon
op_amp
id|ssl_refcount
comma
id|open
suffix:colon
id|ssl_open
comma
id|close
suffix:colon
id|ssl_close
comma
id|write
suffix:colon
id|ssl_write
comma
id|put_char
suffix:colon
id|ssl_put_char
comma
id|flush_chars
suffix:colon
id|ssl_flush_chars
comma
id|chars_in_buffer
suffix:colon
id|ssl_chars_in_buffer
comma
id|flush_buffer
suffix:colon
id|ssl_flush_buffer
comma
id|ioctl
suffix:colon
id|ssl_ioctl
comma
id|throttle
suffix:colon
id|ssl_throttle
comma
id|unthrottle
suffix:colon
id|ssl_unthrottle
comma
id|set_termios
suffix:colon
id|ssl_set_termios
comma
id|stop
suffix:colon
id|ssl_stop
comma
id|start
suffix:colon
id|ssl_start
comma
id|hangup
suffix:colon
id|ssl_hangup
)brace
suffix:semicolon
multiline_comment|/* Changed by ssl_init and referenced by ssl_exit, which are both serialized&n; * by being an initcall and exitcall, respectively.&n; */
DECL|variable|ssl_init_done
r_static
r_int
id|ssl_init_done
op_assign
l_int|0
suffix:semicolon
DECL|function|ssl_init
r_int
id|ssl_init
c_func
(paren
r_void
)paren
(brace
r_char
op_star
id|new_title
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Initializing software serial port version %d&bslash;n&quot;
comma
id|ssl_version
)paren
suffix:semicolon
id|line_register_devfs
c_func
(paren
op_amp
id|lines
comma
op_amp
id|driver
comma
op_amp
id|ssl_driver
comma
id|serial_lines
comma
r_sizeof
(paren
id|serial_lines
)paren
op_div
r_sizeof
(paren
id|serial_lines
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|lines_init
c_func
(paren
id|serial_lines
comma
r_sizeof
(paren
id|serial_lines
)paren
op_div
r_sizeof
(paren
id|serial_lines
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|new_title
op_assign
id|add_xterm_umid
c_func
(paren
id|opts.xterm_title
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_title
op_ne
l_int|NULL
)paren
(brace
id|opts.xterm_title
op_assign
id|new_title
suffix:semicolon
)brace
id|ssl_init_done
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ssl_init
id|__initcall
c_func
(paren
id|ssl_init
)paren
suffix:semicolon
DECL|function|ssl_chan_setup
r_static
r_int
id|ssl_chan_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
id|line_setup
c_func
(paren
id|serial_lines
comma
r_sizeof
(paren
id|serial_lines
)paren
op_div
r_sizeof
(paren
id|serial_lines
(braket
l_int|0
)braket
)paren
comma
id|str
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;ssl&quot;
comma
id|ssl_chan_setup
)paren
suffix:semicolon
id|__channel_help
c_func
(paren
id|ssl_chan_setup
comma
l_string|&quot;ssl&quot;
)paren
suffix:semicolon
DECL|function|ssl_exit
r_static
r_void
id|ssl_exit
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ssl_init_done
)paren
(brace
r_return
suffix:semicolon
)brace
id|close_lines
c_func
(paren
id|serial_lines
comma
r_sizeof
(paren
id|serial_lines
)paren
op_div
r_sizeof
(paren
id|serial_lines
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|variable|ssl_exit
id|__uml_exitcall
c_func
(paren
id|ssl_exit
)paren
suffix:semicolon
multiline_comment|/*&n; * Overrides for Emacs so that we follow Linus&squot;s tabbing style.&n; * Emacs will notice this stuff at the end of the file and automatically&n; * adjust the settings for this buffer only.  This must remain at the end&n; * of the file.&n; * ---------------------------------------------------------------------------&n; * Local variables:&n; * c-file-style: &quot;linux&quot;&n; * End:&n; */
eof
