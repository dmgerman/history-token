multiline_comment|/* &n; * Copyright (C) 2000, 2001 Jeff Dike (jdike@karaya.com)&n; * Licensed under the GPL&n; */
macro_line|#include &quot;linux/config.h&quot;
macro_line|#include &quot;linux/posix_types.h&quot;
macro_line|#include &quot;linux/tty.h&quot;
macro_line|#include &quot;linux/tty_flip.h&quot;
macro_line|#include &quot;linux/types.h&quot;
macro_line|#include &quot;linux/major.h&quot;
macro_line|#include &quot;linux/kdev_t.h&quot;
macro_line|#include &quot;linux/console.h&quot;
macro_line|#include &quot;linux/string.h&quot;
macro_line|#include &quot;linux/sched.h&quot;
macro_line|#include &quot;linux/list.h&quot;
macro_line|#include &quot;linux/init.h&quot;
macro_line|#include &quot;linux/interrupt.h&quot;
macro_line|#include &quot;linux/slab.h&quot;
macro_line|#include &quot;asm/current.h&quot;
macro_line|#include &quot;asm/softirq.h&quot;
macro_line|#include &quot;asm/hardirq.h&quot;
macro_line|#include &quot;asm/irq.h&quot;
macro_line|#include &quot;stdio_console.h&quot;
macro_line|#include &quot;line.h&quot;
macro_line|#include &quot;chan_kern.h&quot;
macro_line|#include &quot;user_util.h&quot;
macro_line|#include &quot;kern_util.h&quot;
macro_line|#include &quot;irq_user.h&quot;
macro_line|#include &quot;init.h&quot;
macro_line|#include &quot;2_5compat.h&quot;
DECL|macro|MAX_TTYS
mdefine_line|#define MAX_TTYS (8)
multiline_comment|/* Referenced only by tty_driver below - presumably it&squot;s locked correctly&n; * by the tty driver.&n; */
DECL|variable|console_driver
r_static
r_struct
id|tty_driver
id|console_driver
suffix:semicolon
DECL|variable|console_refcount
r_static
r_int
id|console_refcount
op_assign
l_int|0
suffix:semicolon
DECL|variable|init_console_ops
r_static
r_struct
id|chan_ops
id|init_console_ops
op_assign
(brace
id|init
suffix:colon
l_int|NULL
comma
id|open
suffix:colon
l_int|NULL
comma
id|close
suffix:colon
l_int|NULL
comma
id|read
suffix:colon
l_int|NULL
comma
id|write
suffix:colon
l_int|NULL
comma
id|console_write
suffix:colon
id|generic_write
comma
id|window_size
suffix:colon
l_int|NULL
comma
id|free
suffix:colon
l_int|NULL
comma
id|winch
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|init_console_chan
r_static
r_struct
id|chan
id|init_console_chan
op_assign
(brace
id|list
suffix:colon
(brace
)brace
comma
id|primary
suffix:colon
l_int|1
comma
id|input
suffix:colon
l_int|0
comma
id|output
suffix:colon
l_int|1
comma
id|opened
suffix:colon
l_int|1
comma
id|fd
suffix:colon
l_int|1
comma
id|pri
suffix:colon
id|INIT_STATIC
comma
id|ops
suffix:colon
op_amp
id|init_console_ops
comma
id|data
suffix:colon
l_int|NULL
)brace
suffix:semicolon
DECL|function|stdio_announce
r_void
id|stdio_announce
c_func
(paren
r_char
op_star
id|dev_name
comma
r_int
id|dev
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Virtual console %d assigned device &squot;%s&squot;&bslash;n&quot;
comma
id|dev
comma
id|dev_name
)paren
suffix:semicolon
)brace
DECL|variable|opts
r_static
r_struct
id|chan_opts
id|opts
op_assign
(brace
id|announce
suffix:colon
id|stdio_announce
comma
id|xterm_title
suffix:colon
l_string|&quot;Virtual Console #%d&quot;
comma
id|raw
suffix:colon
l_int|1
comma
id|tramp_stack
suffix:colon
l_int|0
comma
)brace
suffix:semicolon
DECL|variable|driver
r_static
r_struct
id|line_driver
id|driver
op_assign
(brace
id|name
suffix:colon
l_string|&quot;UML console&quot;
comma
id|devfs_name
suffix:colon
l_string|&quot;vc/%d&quot;
comma
id|major
suffix:colon
id|TTY_MAJOR
comma
id|minor_start
suffix:colon
l_int|0
comma
id|type
suffix:colon
id|TTY_DRIVER_TYPE_CONSOLE
comma
id|subtype
suffix:colon
id|SYSTEM_TYPE_CONSOLE
comma
id|read_irq
suffix:colon
id|CONSOLE_IRQ
comma
id|read_irq_name
suffix:colon
l_string|&quot;console&quot;
comma
id|write_irq
suffix:colon
id|CONSOLE_WRITE_IRQ
comma
id|write_irq_name
suffix:colon
l_string|&quot;console-write&quot;
comma
id|symlink_from
suffix:colon
l_string|&quot;ttys&quot;
comma
id|symlink_to
suffix:colon
l_string|&quot;vc&quot;
comma
)brace
suffix:semicolon
DECL|variable|console_lines
r_static
r_struct
id|lines
id|console_lines
op_assign
id|LINES_INIT
c_func
(paren
id|MAX_TTYS
)paren
suffix:semicolon
multiline_comment|/* The array is initialized by line_init, which is an initcall.  The &n; * individual elements are protected by individual semaphores.&n; */
DECL|variable|vts
r_struct
id|line
id|vts
(braket
id|MAX_TTYS
)braket
op_assign
(brace
id|LINE_INIT
c_func
(paren
id|CONFIG_CON_ZERO_CHAN
comma
op_amp
id|driver
)paren
comma
(braket
l_int|1
dot
dot
dot
id|MAX_TTYS
op_minus
l_int|1
)braket
op_assign
id|LINE_INIT
c_func
(paren
id|CONFIG_CON_CHAN
comma
op_amp
id|driver
)paren
)brace
suffix:semicolon
DECL|function|open_console
r_static
r_int
id|open_console
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_return
id|line_open
c_func
(paren
id|vts
comma
id|tty
comma
op_amp
id|opts
)paren
suffix:semicolon
)brace
DECL|function|con_open
r_static
r_int
id|con_open
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
r_return
id|open_console
c_func
(paren
id|tty
)paren
suffix:semicolon
)brace
DECL|function|con_close
r_static
r_void
id|con_close
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|file
op_star
id|filp
)paren
(brace
id|line_close
c_func
(paren
id|vts
comma
id|tty
)paren
suffix:semicolon
)brace
DECL|function|con_write
r_static
r_int
id|con_write
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_int
id|from_user
comma
r_const
r_int
r_char
op_star
id|buf
comma
r_int
id|count
)paren
(brace
r_return
id|line_write
c_func
(paren
id|vts
comma
id|tty
comma
id|buf
comma
id|count
)paren
suffix:semicolon
)brace
DECL|function|set_termios
r_static
r_void
id|set_termios
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
comma
r_struct
id|termios
op_star
id|old
)paren
(brace
)brace
DECL|function|chars_in_buffer
r_static
r_int
id|chars_in_buffer
c_func
(paren
r_struct
id|tty_struct
op_star
id|tty
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|con_init_done
r_static
r_int
id|con_init_done
op_assign
l_int|0
suffix:semicolon
DECL|function|stdio_init
r_int
id|stdio_init
c_func
(paren
r_void
)paren
(brace
r_char
op_star
id|new_title
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Initializing stdio console driver&bslash;n&quot;
)paren
suffix:semicolon
id|line_register_devfs
c_func
(paren
op_amp
id|console_lines
comma
op_amp
id|driver
comma
op_amp
id|console_driver
comma
id|vts
comma
r_sizeof
(paren
id|vts
)paren
op_div
r_sizeof
(paren
id|vts
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|lines_init
c_func
(paren
id|vts
comma
r_sizeof
(paren
id|vts
)paren
op_div
r_sizeof
(paren
id|vts
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|new_title
op_assign
id|add_xterm_umid
c_func
(paren
id|opts.xterm_title
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_title
op_ne
l_int|NULL
)paren
(brace
id|opts.xterm_title
op_assign
id|new_title
suffix:semicolon
)brace
id|open_console
c_func
(paren
l_int|NULL
)paren
suffix:semicolon
id|con_init_done
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|stdio_init
id|__initcall
c_func
(paren
id|stdio_init
)paren
suffix:semicolon
DECL|function|console_write
r_static
r_void
id|console_write
c_func
(paren
r_struct
id|console
op_star
id|console
comma
r_const
r_char
op_star
id|string
comma
r_int
id|len
)paren
(brace
r_if
c_cond
(paren
id|con_init_done
)paren
(brace
id|down
c_func
(paren
op_amp
id|vts
(braket
id|console-&gt;index
)braket
dot
id|sem
)paren
suffix:semicolon
)brace
id|console_write_chan
c_func
(paren
op_amp
id|vts
(braket
id|console-&gt;index
)braket
dot
id|chan_list
comma
id|string
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|con_init_done
)paren
(brace
id|up
c_func
(paren
op_amp
id|vts
(braket
id|console-&gt;index
)braket
dot
id|sem
)paren
suffix:semicolon
)brace
)brace
DECL|variable|console_driver
r_static
r_struct
id|tty_driver
id|console_driver
op_assign
(brace
id|refcount
suffix:colon
op_amp
id|console_refcount
comma
id|open
suffix:colon
id|con_open
comma
id|close
suffix:colon
id|con_close
comma
id|write
suffix:colon
id|con_write
comma
id|chars_in_buffer
suffix:colon
id|chars_in_buffer
comma
id|set_termios
suffix:colon
id|set_termios
)brace
suffix:semicolon
DECL|function|console_device
r_static
id|kdev_t
id|console_device
c_func
(paren
r_struct
id|console
op_star
id|c
)paren
(brace
r_return
id|mk_kdev
c_func
(paren
id|TTY_MAJOR
comma
id|c-&gt;index
)paren
suffix:semicolon
)brace
DECL|function|console_setup
r_static
r_int
id|console_setup
c_func
(paren
r_struct
id|console
op_star
id|co
comma
r_char
op_star
id|options
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|stdiocons
r_static
r_struct
id|console
id|stdiocons
op_assign
id|INIT_CONSOLE
c_func
(paren
l_string|&quot;tty&quot;
comma
id|console_write
comma
id|console_device
comma
id|console_setup
comma
id|CON_PRINTBUFFER
)paren
suffix:semicolon
DECL|function|stdio_console_init
r_void
id|stdio_console_init
c_func
(paren
r_void
)paren
(brace
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|vts
(braket
l_int|0
)braket
dot
id|chan_list
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|init_console_chan.list
comma
op_amp
id|vts
(braket
l_int|0
)braket
dot
id|chan_list
)paren
suffix:semicolon
id|register_console
c_func
(paren
op_amp
id|stdiocons
)paren
suffix:semicolon
)brace
DECL|function|console_chan_setup
r_static
r_int
id|console_chan_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
id|line_setup
c_func
(paren
id|vts
comma
r_sizeof
(paren
id|vts
)paren
op_div
r_sizeof
(paren
id|vts
(braket
l_int|0
)braket
)paren
comma
id|str
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;con&quot;
comma
id|console_chan_setup
)paren
suffix:semicolon
id|__channel_help
c_func
(paren
id|console_chan_setup
comma
l_string|&quot;con&quot;
)paren
suffix:semicolon
DECL|function|console_exit
r_static
r_void
id|console_exit
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|con_init_done
)paren
(brace
r_return
suffix:semicolon
)brace
id|close_lines
c_func
(paren
id|vts
comma
r_sizeof
(paren
id|vts
)paren
op_div
r_sizeof
(paren
id|vts
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
)brace
DECL|variable|console_exit
id|__uml_exitcall
c_func
(paren
id|console_exit
)paren
suffix:semicolon
multiline_comment|/*&n; * Overrides for Emacs so that we follow Linus&squot;s tabbing style.&n; * Emacs will notice this stuff at the end of the file and automatically&n; * adjust the settings for this buffer only.  This must remain at the end&n; * of the file.&n; * ---------------------------------------------------------------------------&n; * Local variables:&n; * c-file-style: &quot;linux&quot;&n; * End:&n; */
eof
