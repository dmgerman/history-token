multiline_comment|/*&n; * Copyright (C) 2002 Jeff Dike &lt;jdike@karaya.com&gt;&n; * Licensed under the GPL.&n; */
macro_line|#include &lt;unistd.h&gt;
macro_line|#include &lt;stdlib.h&gt;
macro_line|#include &lt;string.h&gt;
macro_line|#include &lt;errno.h&gt;
macro_line|#include &lt;pcap.h&gt;
macro_line|#include &lt;asm/types.h&gt;
macro_line|#include &quot;net_user.h&quot;
macro_line|#include &quot;pcap_user.h&quot;
macro_line|#include &quot;user.h&quot;
DECL|macro|MAX_PACKET
mdefine_line|#define MAX_PACKET (ETH_MAX_PACKET + ETH_HEADER_OTHER)
DECL|macro|PCAP_FD
mdefine_line|#define PCAP_FD(p) (*(int *)(p))
DECL|function|pcap_user_init
r_static
r_void
id|pcap_user_init
c_func
(paren
r_void
op_star
id|data
comma
r_void
op_star
id|dev
)paren
(brace
r_struct
id|pcap_data
op_star
id|pri
op_assign
id|data
suffix:semicolon
id|pcap_t
op_star
id|p
suffix:semicolon
r_char
id|errors
(braket
id|PCAP_ERRBUF_SIZE
)braket
suffix:semicolon
id|p
op_assign
id|pcap_open_live
c_func
(paren
id|pri-&gt;host_if
comma
id|MAX_PACKET
comma
id|pri-&gt;promisc
comma
l_int|0
comma
id|errors
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pcap_user_init : pcap_open_live failed - &squot;%s&squot;&bslash;n&quot;
comma
id|errors
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|pri-&gt;dev
op_assign
id|dev
suffix:semicolon
id|pri-&gt;pcap
op_assign
id|p
suffix:semicolon
)brace
DECL|function|pcap_open
r_static
r_int
id|pcap_open
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|pcap_data
op_star
id|pri
op_assign
id|data
suffix:semicolon
id|__u32
id|netmask
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|pri-&gt;pcap
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pri-&gt;filter
op_ne
l_int|NULL
)paren
(brace
id|err
op_assign
id|dev_netmask
c_func
(paren
id|pri-&gt;dev
comma
op_amp
id|netmask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pcap_open : dev_netmask failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|pri-&gt;compiled
op_assign
id|um_kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|bpf_program
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pri-&gt;compiled
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pcap_open : kmalloc failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|err
op_assign
id|pcap_compile
c_func
(paren
id|pri-&gt;pcap
comma
(paren
r_struct
id|bpf_program
op_star
)paren
id|pri-&gt;compiled
comma
id|pri-&gt;filter
comma
id|pri-&gt;optimize
comma
id|netmask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pcap_open : pcap_compile failed - &squot;%s&squot;&bslash;n&quot;
comma
id|pcap_geterr
c_func
(paren
id|pri-&gt;pcap
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
id|err
op_assign
id|pcap_setfilter
c_func
(paren
id|pri-&gt;pcap
comma
id|pri-&gt;compiled
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pcap_open : pcap_setfilter failed - &squot;%s&squot;&bslash;n&quot;
comma
id|pcap_geterr
c_func
(paren
id|pri-&gt;pcap
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
)brace
r_return
id|PCAP_FD
c_func
(paren
id|pri-&gt;pcap
)paren
suffix:semicolon
)brace
DECL|function|pcap_remove
r_static
r_void
id|pcap_remove
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_struct
id|pcap_data
op_star
id|pri
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|pri-&gt;compiled
op_ne
l_int|NULL
)paren
(brace
id|pcap_freecode
c_func
(paren
id|pri-&gt;compiled
)paren
suffix:semicolon
)brace
id|pcap_close
c_func
(paren
id|pri-&gt;pcap
)paren
suffix:semicolon
)brace
DECL|struct|pcap_handler_data
r_struct
id|pcap_handler_data
(brace
DECL|member|buffer
r_char
op_star
id|buffer
suffix:semicolon
DECL|member|len
r_int
id|len
suffix:semicolon
)brace
suffix:semicolon
DECL|function|handler
r_static
r_void
id|handler
c_func
(paren
id|u_char
op_star
id|data
comma
r_const
r_struct
id|pcap_pkthdr
op_star
id|header
comma
r_const
id|u_char
op_star
id|packet
)paren
(brace
r_int
id|len
suffix:semicolon
r_struct
id|pcap_handler_data
op_star
id|hdata
op_assign
(paren
r_struct
id|pcap_handler_data
op_star
)paren
id|data
suffix:semicolon
id|len
op_assign
id|hdata-&gt;len
OL
id|header-&gt;caplen
ques
c_cond
id|hdata-&gt;len
suffix:colon
id|header-&gt;caplen
suffix:semicolon
id|memcpy
c_func
(paren
id|hdata-&gt;buffer
comma
id|packet
comma
id|len
)paren
suffix:semicolon
id|hdata-&gt;len
op_assign
id|len
suffix:semicolon
)brace
DECL|function|pcap_user_read
r_int
id|pcap_user_read
c_func
(paren
r_int
id|fd
comma
r_void
op_star
id|buffer
comma
r_int
id|len
comma
r_struct
id|pcap_data
op_star
id|pri
)paren
(brace
r_struct
id|pcap_handler_data
id|hdata
op_assign
(paren
(paren
r_struct
id|pcap_handler_data
)paren
(brace
dot
id|buffer
op_assign
id|buffer
comma
dot
id|len
op_assign
id|len
)brace
)paren
suffix:semicolon
r_int
id|n
suffix:semicolon
id|n
op_assign
id|pcap_dispatch
c_func
(paren
id|pri-&gt;pcap
comma
l_int|1
comma
id|handler
comma
(paren
id|u_char
op_star
)paren
op_amp
id|hdata
)paren
suffix:semicolon
r_if
c_cond
(paren
id|n
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;pcap_dispatch failed - %s&bslash;n&quot;
comma
id|pcap_geterr
c_func
(paren
id|pri-&gt;pcap
)paren
)paren
suffix:semicolon
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|n
op_eq
l_int|0
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_return
id|hdata.len
suffix:semicolon
)brace
DECL|variable|pcap_user_info
r_struct
id|net_user_info
id|pcap_user_info
op_assign
(brace
dot
id|init
op_assign
id|pcap_user_init
comma
dot
id|open
op_assign
id|pcap_open
comma
dot
id|close
op_assign
l_int|NULL
comma
dot
id|remove
op_assign
id|pcap_remove
comma
dot
id|set_mtu
op_assign
l_int|NULL
comma
dot
id|add_address
op_assign
l_int|NULL
comma
dot
id|delete_address
op_assign
l_int|NULL
comma
dot
id|max_packet
op_assign
id|MAX_PACKET
op_minus
id|ETH_HEADER_OTHER
)brace
suffix:semicolon
multiline_comment|/*&n; * Overrides for Emacs so that we follow Linus&squot;s tabbing style.&n; * Emacs will notice this stuff at the end of the file and automatically&n; * adjust the settings for this buffer only.  This must remain at the end&n; * of the file.&n; * ---------------------------------------------------------------------------&n; * Local variables:&n; * c-file-style: &quot;linux&quot;&n; * End:&n; */
eof
