multiline_comment|/*&n; * Copyright (C) 2001 Lennert Buytenhek (buytenh@gnu.org) and &n; * James Leu (jleu@mindspring.net).&n; * Copyright (C) 2001 by various other people who didn&squot;t put their name here.&n; * Licensed under the GPL.&n; */
macro_line|#include &quot;linux/config.h&quot;
macro_line|#include &quot;linux/kernel.h&quot;
macro_line|#include &quot;linux/netdevice.h&quot;
macro_line|#include &quot;linux/rtnetlink.h&quot;
macro_line|#include &quot;linux/skbuff.h&quot;
macro_line|#include &quot;linux/socket.h&quot;
macro_line|#include &quot;linux/spinlock.h&quot;
macro_line|#include &quot;linux/module.h&quot;
macro_line|#include &quot;linux/init.h&quot;
macro_line|#include &quot;linux/etherdevice.h&quot;
macro_line|#include &quot;linux/list.h&quot;
macro_line|#include &quot;linux/inetdevice.h&quot;
macro_line|#include &quot;linux/ctype.h&quot;
macro_line|#include &quot;linux/bootmem.h&quot;
macro_line|#include &quot;linux/ethtool.h&quot;
macro_line|#include &quot;asm/uaccess.h&quot;
macro_line|#include &quot;user_util.h&quot;
macro_line|#include &quot;kern_util.h&quot;
macro_line|#include &quot;net_kern.h&quot;
macro_line|#include &quot;net_user.h&quot;
macro_line|#include &quot;mconsole_kern.h&quot;
macro_line|#include &quot;init.h&quot;
macro_line|#include &quot;irq_user.h&quot;
macro_line|#include &quot;irq_kern.h&quot;
DECL|macro|DRIVER_NAME
mdefine_line|#define DRIVER_NAME &quot;uml-netdev&quot;
DECL|variable|opened_lock
r_static
id|spinlock_t
id|opened_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|opened
id|LIST_HEAD
c_func
(paren
id|opened
)paren
suffix:semicolon
DECL|function|uml_net_rx
r_static
r_int
id|uml_net_rx
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|uml_net_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|pkt_len
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
multiline_comment|/* If we can&squot;t allocate memory, try again next round. */
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|dev-&gt;mtu
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|lp-&gt;stats.rx_dropped
op_increment
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|skb-&gt;dev
op_assign
id|dev
suffix:semicolon
id|skb_put
c_func
(paren
id|skb
comma
id|dev-&gt;mtu
)paren
suffix:semicolon
id|skb-&gt;mac.raw
op_assign
id|skb-&gt;data
suffix:semicolon
id|pkt_len
op_assign
(paren
op_star
id|lp-&gt;read
)paren
(paren
id|lp-&gt;fd
comma
op_amp
id|skb
comma
id|lp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pkt_len
OG
l_int|0
)paren
(brace
id|skb_trim
c_func
(paren
id|skb
comma
id|pkt_len
)paren
suffix:semicolon
id|skb-&gt;protocol
op_assign
(paren
op_star
id|lp-&gt;protocol
)paren
(paren
id|skb
)paren
suffix:semicolon
id|netif_rx
c_func
(paren
id|skb
)paren
suffix:semicolon
id|lp-&gt;stats.rx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|lp-&gt;stats.rx_packets
op_increment
suffix:semicolon
r_return
id|pkt_len
suffix:semicolon
)brace
id|kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|pkt_len
suffix:semicolon
)brace
DECL|function|uml_net_interrupt
id|irqreturn_t
id|uml_net_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|dev_id
suffix:semicolon
r_struct
id|uml_net_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|netif_running
c_func
(paren
id|dev
)paren
)paren
(brace
r_return
id|IRQ_NONE
suffix:semicolon
)brace
id|spin_lock
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|err
op_assign
id|uml_net_rx
c_func
(paren
id|dev
)paren
)paren
OG
l_int|0
)paren
(brace
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Device &squot;%s&squot; read returned %d, shutting it down&bslash;n&quot;
comma
id|dev-&gt;name
comma
id|err
)paren
suffix:semicolon
id|dev_close
c_func
(paren
id|dev
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|reactivate_fd
c_func
(paren
id|lp-&gt;fd
comma
id|UM_ETH_IRQ
)paren
suffix:semicolon
id|out
suffix:colon
id|spin_unlock
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|uml_net_open
r_static
r_int
id|uml_net_open
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|uml_net_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_char
id|addr
(braket
r_sizeof
(paren
l_string|&quot;255.255.255.255&bslash;0&quot;
)paren
)braket
suffix:semicolon
r_int
id|err
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;fd
op_ge
l_int|0
)paren
(brace
id|err
op_assign
op_minus
id|ENXIO
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|lp-&gt;have_mac
)paren
(brace
id|dev_ip_addr
c_func
(paren
id|dev
comma
id|addr
comma
op_amp
id|lp-&gt;mac
(braket
l_int|2
)braket
)paren
suffix:semicolon
id|set_ether_mac
c_func
(paren
id|dev
comma
id|lp-&gt;mac
)paren
suffix:semicolon
)brace
id|lp-&gt;fd
op_assign
(paren
op_star
id|lp-&gt;open
)paren
(paren
op_amp
id|lp-&gt;user
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;fd
OL
l_int|0
)paren
(brace
id|err
op_assign
id|lp-&gt;fd
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|err
op_assign
id|um_request_irq
c_func
(paren
id|dev-&gt;irq
comma
id|lp-&gt;fd
comma
id|IRQ_READ
comma
id|uml_net_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
id|dev-&gt;name
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;uml_net_open: failed to get irq(%d)&bslash;n&quot;
comma
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;close
op_ne
l_int|NULL
)paren
(brace
(paren
op_star
id|lp-&gt;close
)paren
(paren
id|lp-&gt;fd
comma
op_amp
id|lp-&gt;user
)paren
suffix:semicolon
)brace
id|lp-&gt;fd
op_assign
op_minus
l_int|1
suffix:semicolon
id|err
op_assign
op_minus
id|ENETUNREACH
suffix:semicolon
)brace
id|lp-&gt;tl.data
op_assign
(paren
r_int
r_int
)paren
op_amp
id|lp-&gt;user
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* clear buffer - it can happen that the host side of the interface&n;&t; * is full when we get here.  In this case, new data is never queued,&n;&t; * SIGIOs never arrive, and the net never works.&n;&t; */
r_while
c_loop
(paren
(paren
id|err
op_assign
id|uml_net_rx
c_func
(paren
id|dev
)paren
)paren
OG
l_int|0
)paren
(brace
suffix:semicolon
)brace
id|out
suffix:colon
id|spin_unlock
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|uml_net_close
r_static
r_int
id|uml_net_close
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|uml_net_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|free_irq_by_irq_and_dev
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|dev-&gt;irq
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;close
op_ne
l_int|NULL
)paren
(brace
(paren
op_star
id|lp-&gt;close
)paren
(paren
id|lp-&gt;fd
comma
op_amp
id|lp-&gt;user
)paren
suffix:semicolon
)brace
id|lp-&gt;fd
op_assign
op_minus
l_int|1
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|uml_net_start_xmit
r_static
r_int
id|uml_net_start_xmit
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|uml_net_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|len
suffix:semicolon
id|netif_stop_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|len
op_assign
(paren
op_star
id|lp-&gt;write
)paren
(paren
id|lp-&gt;fd
comma
op_amp
id|skb
comma
id|lp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_eq
id|skb-&gt;len
)paren
(brace
id|lp-&gt;stats.tx_packets
op_increment
suffix:semicolon
id|lp-&gt;stats.tx_bytes
op_add_assign
id|skb-&gt;len
suffix:semicolon
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
multiline_comment|/* this is normally done in the interrupt when tx finishes */
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|len
op_eq
l_int|0
)paren
(brace
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|lp-&gt;stats.tx_dropped
op_increment
suffix:semicolon
)brace
r_else
(brace
id|netif_start_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;uml_net_start_xmit: failed(%d)&bslash;n&quot;
comma
id|len
)paren
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|lp-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|uml_net_get_stats
r_static
r_struct
id|net_device_stats
op_star
id|uml_net_get_stats
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_struct
id|uml_net_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_return
op_amp
id|lp-&gt;stats
suffix:semicolon
)brace
DECL|function|uml_net_set_multicast_list
r_static
r_void
id|uml_net_set_multicast_list
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
r_if
c_cond
(paren
id|dev-&gt;flags
op_amp
id|IFF_PROMISC
)paren
r_return
suffix:semicolon
r_else
r_if
c_cond
(paren
id|dev-&gt;mc_count
)paren
id|dev-&gt;flags
op_or_assign
id|IFF_ALLMULTI
suffix:semicolon
r_else
id|dev-&gt;flags
op_and_assign
op_complement
id|IFF_ALLMULTI
suffix:semicolon
)brace
DECL|function|uml_net_tx_timeout
r_static
r_void
id|uml_net_tx_timeout
c_func
(paren
r_struct
id|net_device
op_star
id|dev
)paren
(brace
id|dev-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
id|netif_wake_queue
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
DECL|function|uml_net_set_mac
r_static
r_int
id|uml_net_set_mac
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_void
op_star
id|addr
)paren
(brace
r_struct
id|uml_net_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_struct
id|sockaddr
op_star
id|hwaddr
op_assign
id|addr
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|hwaddr-&gt;sa_data
comma
id|ETH_ALEN
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|uml_net_change_mtu
r_static
r_int
id|uml_net_change_mtu
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_int
id|new_mtu
)paren
(brace
r_struct
id|uml_net_private
op_star
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
id|new_mtu
op_assign
(paren
op_star
id|lp-&gt;set_mtu
)paren
(paren
id|new_mtu
comma
op_amp
id|lp-&gt;user
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_mtu
OL
l_int|0
)paren
(brace
id|err
op_assign
id|new_mtu
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|dev-&gt;mtu
op_assign
id|new_mtu
suffix:semicolon
id|out
suffix:colon
id|spin_unlock
c_func
(paren
op_amp
id|lp-&gt;lock
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
DECL|function|uml_net_ioctl
r_static
r_int
id|uml_net_ioctl
c_func
(paren
r_struct
id|net_device
op_star
id|dev
comma
r_struct
id|ifreq
op_star
id|ifr
comma
r_int
id|cmd
)paren
(brace
r_static
r_const
r_struct
id|ethtool_drvinfo
id|info
op_assign
(brace
dot
id|cmd
op_assign
id|ETHTOOL_GDRVINFO
comma
dot
id|driver
op_assign
id|DRIVER_NAME
comma
dot
id|version
op_assign
l_string|&quot;42&quot;
comma
)brace
suffix:semicolon
r_void
op_star
id|useraddr
suffix:semicolon
id|u32
id|ethcmd
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|SIOCETHTOOL
suffix:colon
id|useraddr
op_assign
id|ifr-&gt;ifr_data
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|ethcmd
comma
id|useraddr
comma
r_sizeof
(paren
id|ethcmd
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_switch
c_cond
(paren
id|ethcmd
)paren
(brace
r_case
id|ETHTOOL_GDRVINFO
suffix:colon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|useraddr
comma
op_amp
id|info
comma
r_sizeof
(paren
id|info
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EOPNOTSUPP
suffix:semicolon
)brace
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
DECL|function|uml_net_user_timer_expire
r_void
id|uml_net_user_timer_expire
c_func
(paren
r_int
r_int
id|_conn
)paren
(brace
macro_line|#ifdef undef
r_struct
id|connection
op_star
id|conn
op_assign
(paren
r_struct
id|connection
op_star
)paren
id|_conn
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;uml_net_user_timer_expire [%p]&bslash;n&quot;
comma
id|conn
)paren
suffix:semicolon
id|do_connect
c_func
(paren
id|conn
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|variable|devices_lock
r_static
id|spinlock_t
id|devices_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|variable|devices
r_static
r_struct
id|list_head
id|devices
op_assign
id|LIST_HEAD_INIT
c_func
(paren
id|devices
)paren
suffix:semicolon
DECL|variable|uml_net_driver
r_static
r_struct
id|device_driver
id|uml_net_driver
op_assign
(brace
dot
id|name
op_assign
id|DRIVER_NAME
comma
dot
id|bus
op_assign
op_amp
id|platform_bus_type
comma
)brace
suffix:semicolon
DECL|variable|driver_registered
r_static
r_int
id|driver_registered
suffix:semicolon
DECL|function|eth_configure
r_static
r_int
id|eth_configure
c_func
(paren
r_int
id|n
comma
r_void
op_star
id|init
comma
r_char
op_star
id|mac
comma
r_struct
id|transport
op_star
id|transport
)paren
(brace
r_struct
id|uml_net
op_star
id|device
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|uml_net_private
op_star
id|lp
suffix:semicolon
r_int
id|save
comma
id|err
comma
id|size
suffix:semicolon
id|size
op_assign
id|transport-&gt;private_size
op_plus
r_sizeof
(paren
r_struct
id|uml_net_private
)paren
op_plus
r_sizeof
(paren
(paren
(paren
r_struct
id|uml_net_private
op_star
)paren
l_int|0
)paren
op_member_access_from_pointer
id|user
)paren
suffix:semicolon
id|device
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|device
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|device
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;eth_configure failed to allocate uml_net&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|memset
c_func
(paren
id|device
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|device
)paren
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|device-&gt;list
)paren
suffix:semicolon
id|device-&gt;index
op_assign
id|n
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|devices_lock
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|device-&gt;list
comma
op_amp
id|devices
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|devices_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|setup_etheraddr
c_func
(paren
id|mac
comma
id|device-&gt;mac
)paren
)paren
id|device-&gt;have_mac
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Netdevice %d &quot;
comma
id|n
)paren
suffix:semicolon
r_if
c_cond
(paren
id|device-&gt;have_mac
)paren
id|printk
c_func
(paren
l_string|&quot;(%02x:%02x:%02x:%02x:%02x:%02x) &quot;
comma
id|device-&gt;mac
(braket
l_int|0
)braket
comma
id|device-&gt;mac
(braket
l_int|1
)braket
comma
id|device-&gt;mac
(braket
l_int|2
)braket
comma
id|device-&gt;mac
(braket
l_int|3
)braket
comma
id|device-&gt;mac
(braket
l_int|4
)braket
comma
id|device-&gt;mac
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;: &quot;
)paren
suffix:semicolon
id|dev
op_assign
id|alloc_etherdev
c_func
(paren
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;eth_configure: failed to allocate device&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/* sysfs register */
r_if
c_cond
(paren
op_logical_neg
id|driver_registered
)paren
(brace
id|driver_register
c_func
(paren
op_amp
id|uml_net_driver
)paren
suffix:semicolon
id|driver_registered
op_assign
l_int|1
suffix:semicolon
)brace
id|device-&gt;pdev.id
op_assign
id|n
suffix:semicolon
id|device-&gt;pdev.name
op_assign
id|DRIVER_NAME
suffix:semicolon
id|platform_device_register
c_func
(paren
op_amp
id|device-&gt;pdev
)paren
suffix:semicolon
id|SET_NETDEV_DEV
c_func
(paren
id|dev
comma
op_amp
id|device-&gt;pdev.dev
)paren
suffix:semicolon
multiline_comment|/* If this name ends up conflicting with an existing registered&n;&t; * netdevice, that is OK, register_netdev{,ice}() will notice this&n;&t; * and fail.&n;&t; */
id|snprintf
c_func
(paren
id|dev-&gt;name
comma
r_sizeof
(paren
id|dev-&gt;name
)paren
comma
l_string|&quot;eth%d&quot;
comma
id|n
)paren
suffix:semicolon
id|device-&gt;dev
op_assign
id|dev
suffix:semicolon
(paren
op_star
id|transport-&gt;kern-&gt;init
)paren
(paren
id|dev
comma
id|init
)paren
suffix:semicolon
id|dev-&gt;mtu
op_assign
id|transport-&gt;user-&gt;max_packet
suffix:semicolon
id|dev-&gt;open
op_assign
id|uml_net_open
suffix:semicolon
id|dev-&gt;hard_start_xmit
op_assign
id|uml_net_start_xmit
suffix:semicolon
id|dev-&gt;stop
op_assign
id|uml_net_close
suffix:semicolon
id|dev-&gt;get_stats
op_assign
id|uml_net_get_stats
suffix:semicolon
id|dev-&gt;set_multicast_list
op_assign
id|uml_net_set_multicast_list
suffix:semicolon
id|dev-&gt;tx_timeout
op_assign
id|uml_net_tx_timeout
suffix:semicolon
id|dev-&gt;set_mac_address
op_assign
id|uml_net_set_mac
suffix:semicolon
id|dev-&gt;change_mtu
op_assign
id|uml_net_change_mtu
suffix:semicolon
id|dev-&gt;do_ioctl
op_assign
id|uml_net_ioctl
suffix:semicolon
id|dev-&gt;watchdog_timeo
op_assign
(paren
id|HZ
op_rshift
l_int|1
)paren
suffix:semicolon
id|dev-&gt;irq
op_assign
id|UM_ETH_IRQ
suffix:semicolon
id|rtnl_lock
c_func
(paren
)paren
suffix:semicolon
id|err
op_assign
id|register_netdevice
c_func
(paren
id|dev
)paren
suffix:semicolon
id|rtnl_unlock
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|device-&gt;dev
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* XXX: should we call -&gt;remove() here? */
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
multiline_comment|/* lp.user is the first four bytes of the transport data, which&n;&t; * has already been initialized.  This structure assignment will&n;&t; * overwrite that, so we make sure that .user gets overwritten with&n;&t; * what it already has.&n;&t; */
id|save
op_assign
id|lp-&gt;user
(braket
l_int|0
)braket
suffix:semicolon
op_star
id|lp
op_assign
(paren
(paren
r_struct
id|uml_net_private
)paren
(brace
dot
id|list
op_assign
id|LIST_HEAD_INIT
c_func
(paren
id|lp-&gt;list
)paren
comma
dot
id|lock
op_assign
id|SPIN_LOCK_UNLOCKED
comma
dot
id|dev
op_assign
id|dev
comma
dot
id|fd
op_assign
op_minus
l_int|1
comma
dot
id|mac
op_assign
(brace
l_int|0xfe
comma
l_int|0xfd
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
comma
l_int|0x0
)brace
comma
dot
id|have_mac
op_assign
id|device-&gt;have_mac
comma
dot
id|protocol
op_assign
id|transport-&gt;kern-&gt;protocol
comma
dot
id|open
op_assign
id|transport-&gt;user-&gt;open
comma
dot
id|close
op_assign
id|transport-&gt;user-&gt;close
comma
dot
id|remove
op_assign
id|transport-&gt;user-&gt;remove
comma
dot
id|read
op_assign
id|transport-&gt;kern-&gt;read
comma
dot
id|write
op_assign
id|transport-&gt;kern-&gt;write
comma
dot
id|add_address
op_assign
id|transport-&gt;user-&gt;add_address
comma
dot
id|delete_address
op_assign
id|transport-&gt;user-&gt;delete_address
comma
dot
id|set_mtu
op_assign
id|transport-&gt;user-&gt;set_mtu
comma
dot
id|user
op_assign
(brace
id|save
)brace
)brace
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|lp-&gt;tl
)paren
suffix:semicolon
id|lp-&gt;tl.function
op_assign
id|uml_net_user_timer_expire
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;have_mac
)paren
id|memcpy
c_func
(paren
id|lp-&gt;mac
comma
id|device-&gt;mac
comma
r_sizeof
(paren
id|lp-&gt;mac
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|transport-&gt;user-&gt;init
)paren
(paren
op_star
id|transport-&gt;user-&gt;init
)paren
(paren
op_amp
id|lp-&gt;user
comma
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|device-&gt;have_mac
)paren
id|set_ether_mac
c_func
(paren
id|dev
comma
id|device-&gt;mac
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|opened_lock
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|lp-&gt;list
comma
op_amp
id|opened
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|opened_lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|find_device
r_static
r_struct
id|uml_net
op_star
id|find_device
c_func
(paren
r_int
id|n
)paren
(brace
r_struct
id|uml_net
op_star
id|device
suffix:semicolon
r_struct
id|list_head
op_star
id|ele
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|devices_lock
)paren
suffix:semicolon
(def_block
id|list_for_each
c_func
(paren
id|ele
comma
op_amp
id|devices
)paren
(brace
id|device
op_assign
id|list_entry
c_func
(paren
id|ele
comma
r_struct
id|uml_net
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|device-&gt;index
op_eq
id|n
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
)brace
)def_block
id|device
op_assign
l_int|NULL
suffix:semicolon
id|out
suffix:colon
id|spin_unlock
c_func
(paren
op_amp
id|devices_lock
)paren
suffix:semicolon
r_return
id|device
suffix:semicolon
)brace
DECL|function|eth_parse
r_static
r_int
id|eth_parse
c_func
(paren
r_char
op_star
id|str
comma
r_int
op_star
id|index_out
comma
r_char
op_star
op_star
id|str_out
)paren
(brace
r_char
op_star
id|end
suffix:semicolon
r_int
id|n
suffix:semicolon
id|n
op_assign
id|simple_strtoul
c_func
(paren
id|str
comma
op_amp
id|end
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|end
op_eq
id|str
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;eth_setup: Failed to parse &squot;%s&squot;&bslash;n&quot;
comma
id|str
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|n
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;eth_setup: device %d is negative&bslash;n&quot;
comma
id|n
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|str
op_assign
id|end
suffix:semicolon
r_if
c_cond
(paren
op_star
id|str
op_ne
l_char|&squot;=&squot;
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;eth_setup: expected &squot;=&squot; after device number&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|str
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|find_device
c_func
(paren
id|n
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;eth_setup: Device %d already configured&bslash;n&quot;
comma
id|n
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|index_out
)paren
(brace
op_star
id|index_out
op_assign
id|n
suffix:semicolon
)brace
op_star
id|str_out
op_assign
id|str
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|struct|eth_init
r_struct
id|eth_init
(brace
DECL|member|list
r_struct
id|list_head
id|list
suffix:semicolon
DECL|member|init
r_char
op_star
id|init
suffix:semicolon
DECL|member|index
r_int
id|index
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* Filled in at boot time.  Will need locking if the transports become&n; * modular.&n; */
DECL|variable|transports
r_struct
id|list_head
id|transports
op_assign
id|LIST_HEAD_INIT
c_func
(paren
id|transports
)paren
suffix:semicolon
multiline_comment|/* Filled in during early boot */
DECL|variable|eth_cmd_line
r_struct
id|list_head
id|eth_cmd_line
op_assign
id|LIST_HEAD_INIT
c_func
(paren
id|eth_cmd_line
)paren
suffix:semicolon
DECL|function|check_transport
r_static
r_int
id|check_transport
c_func
(paren
r_struct
id|transport
op_star
id|transport
comma
r_char
op_star
id|eth
comma
r_int
id|n
comma
r_void
op_star
op_star
id|init_out
comma
r_char
op_star
op_star
id|mac_out
)paren
(brace
r_int
id|len
suffix:semicolon
id|len
op_assign
id|strlen
c_func
(paren
id|transport-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|eth
comma
id|transport-&gt;name
comma
id|len
)paren
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|eth
op_add_assign
id|len
suffix:semicolon
r_if
c_cond
(paren
op_star
id|eth
op_eq
l_char|&squot;,&squot;
)paren
(brace
id|eth
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_star
id|eth
op_ne
l_char|&squot;&bslash;0&squot;
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
op_star
id|init_out
op_assign
id|kmalloc
c_func
(paren
id|transport-&gt;setup_size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|init_out
op_eq
l_int|NULL
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|transport
op_member_access_from_pointer
id|setup
c_func
(paren
id|eth
comma
id|mac_out
comma
op_star
id|init_out
)paren
)paren
(brace
id|kfree
c_func
(paren
op_star
id|init_out
)paren
suffix:semicolon
op_star
id|init_out
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|register_transport
r_void
id|register_transport
c_func
(paren
r_struct
id|transport
op_star
r_new
)paren
(brace
r_struct
id|list_head
op_star
id|ele
comma
op_star
id|next
suffix:semicolon
r_struct
id|eth_init
op_star
id|eth
suffix:semicolon
r_void
op_star
id|init
suffix:semicolon
r_char
op_star
id|mac
op_assign
l_int|NULL
suffix:semicolon
r_int
id|match
suffix:semicolon
id|list_add
c_func
(paren
op_amp
r_new
op_member_access_from_pointer
id|list
comma
op_amp
id|transports
)paren
suffix:semicolon
(def_block
id|list_for_each_safe
c_func
(paren
id|ele
comma
id|next
comma
op_amp
id|eth_cmd_line
)paren
(brace
id|eth
op_assign
id|list_entry
c_func
(paren
id|ele
comma
r_struct
id|eth_init
comma
id|list
)paren
suffix:semicolon
id|match
op_assign
id|check_transport
c_func
(paren
r_new
comma
id|eth-&gt;init
comma
id|eth-&gt;index
comma
op_amp
id|init
comma
op_amp
id|mac
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|match
)paren
(brace
r_continue
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|init
op_ne
l_int|NULL
)paren
(brace
id|eth_configure
c_func
(paren
id|eth-&gt;index
comma
id|init
comma
id|mac
comma
r_new
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|init
)paren
suffix:semicolon
)brace
id|list_del
c_func
(paren
op_amp
id|eth-&gt;list
)paren
suffix:semicolon
)brace
)def_block
)brace
DECL|function|eth_setup_common
r_static
r_int
id|eth_setup_common
c_func
(paren
r_char
op_star
id|str
comma
r_int
id|index
)paren
(brace
r_struct
id|list_head
op_star
id|ele
suffix:semicolon
r_struct
id|transport
op_star
id|transport
suffix:semicolon
r_void
op_star
id|init
suffix:semicolon
r_char
op_star
id|mac
op_assign
l_int|NULL
suffix:semicolon
(def_block
id|list_for_each
c_func
(paren
id|ele
comma
op_amp
id|transports
)paren
(brace
id|transport
op_assign
id|list_entry
c_func
(paren
id|ele
comma
r_struct
id|transport
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|check_transport
c_func
(paren
id|transport
comma
id|str
comma
id|index
comma
op_amp
id|init
comma
op_amp
id|mac
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|init
op_ne
l_int|NULL
)paren
(brace
id|eth_configure
c_func
(paren
id|index
comma
id|init
comma
id|mac
comma
id|transport
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|init
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
)def_block
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|eth_setup
r_static
r_int
id|eth_setup
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_struct
id|eth_init
op_star
r_new
suffix:semicolon
r_int
id|n
comma
id|err
suffix:semicolon
id|err
op_assign
id|eth_parse
c_func
(paren
id|str
comma
op_amp
id|n
comma
op_amp
id|str
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
r_new
op_assign
id|alloc_bootmem
c_func
(paren
r_sizeof
(paren
r_new
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
r_new
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;eth_init : alloc_bootmem failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|INIT_LIST_HEAD
c_func
(paren
op_amp
r_new
op_member_access_from_pointer
id|list
)paren
suffix:semicolon
r_new
op_member_access_from_pointer
id|index
op_assign
id|n
suffix:semicolon
r_new
op_member_access_from_pointer
id|init
op_assign
id|str
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
r_new
op_member_access_from_pointer
id|list
comma
op_amp
id|eth_cmd_line
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;eth&quot;
comma
id|eth_setup
)paren
suffix:semicolon
id|__uml_help
c_func
(paren
id|eth_setup
comma
l_string|&quot;eth[0-9]+=&lt;transport&gt;,&lt;options&gt;&bslash;n&quot;
l_string|&quot;    Configure a network device.&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#if 0
r_static
r_int
id|eth_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|list_head
op_star
id|ele
comma
op_star
id|next
suffix:semicolon
r_struct
id|eth_init
op_star
id|eth
suffix:semicolon
(def_block
id|list_for_each_safe
c_func
(paren
id|ele
comma
id|next
comma
op_amp
id|eth_cmd_line
)paren
(brace
id|eth
op_assign
id|list_entry
c_func
(paren
id|ele
comma
r_struct
id|eth_init
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|eth_setup_common
c_func
(paren
id|eth-&gt;init
comma
id|eth-&gt;index
)paren
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|eth-&gt;list
)paren
suffix:semicolon
)brace
)brace
)def_block
r_return
l_int|1
suffix:semicolon
)brace
id|__initcall
c_func
(paren
id|eth_init
)paren
suffix:semicolon
macro_line|#endif
DECL|function|net_config
r_static
r_int
id|net_config
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_int
id|n
comma
id|err
suffix:semicolon
id|err
op_assign
id|eth_parse
c_func
(paren
id|str
comma
op_amp
id|n
comma
op_amp
id|str
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
r_return
id|err
suffix:semicolon
)brace
id|str
op_assign
id|uml_strdup
c_func
(paren
id|str
)paren
suffix:semicolon
r_if
c_cond
(paren
id|str
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;net_config failed to strdup string&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|err
op_assign
op_logical_neg
id|eth_setup_common
c_func
(paren
id|str
comma
id|n
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|kfree
c_func
(paren
id|str
)paren
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
DECL|function|net_remove
r_static
r_int
id|net_remove
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_struct
id|uml_net
op_star
id|device
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
suffix:semicolon
r_struct
id|uml_net_private
op_star
id|lp
suffix:semicolon
r_char
op_star
id|end
suffix:semicolon
r_int
id|n
suffix:semicolon
id|n
op_assign
id|simple_strtoul
c_func
(paren
id|str
comma
op_amp
id|end
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|end
op_ne
l_char|&squot;&bslash;0&squot;
)paren
op_logical_or
(paren
id|end
op_eq
id|str
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|device
op_assign
id|find_device
c_func
(paren
id|n
)paren
suffix:semicolon
r_if
c_cond
(paren
id|device
op_eq
l_int|NULL
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|dev
op_assign
id|device-&gt;dev
suffix:semicolon
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;fd
OG
l_int|0
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lp-&gt;remove
op_ne
l_int|NULL
)paren
(brace
(paren
op_star
id|lp-&gt;remove
)paren
(paren
op_amp
id|lp-&gt;user
)paren
suffix:semicolon
)brace
id|unregister_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
id|platform_device_unregister
c_func
(paren
op_amp
id|device-&gt;pdev
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|device-&gt;list
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|device
)paren
suffix:semicolon
id|free_netdev
c_func
(paren
id|dev
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|net_mc
r_static
r_struct
id|mc_device
id|net_mc
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;eth&quot;
comma
dot
id|config
op_assign
id|net_config
comma
dot
id|get_config
op_assign
l_int|NULL
comma
dot
id|remove
op_assign
id|net_remove
comma
)brace
suffix:semicolon
DECL|function|uml_inetaddr_event
r_static
r_int
id|uml_inetaddr_event
c_func
(paren
r_struct
id|notifier_block
op_star
id|this
comma
r_int
r_int
id|event
comma
r_void
op_star
id|ptr
)paren
(brace
r_struct
id|in_ifaddr
op_star
id|ifa
op_assign
id|ptr
suffix:semicolon
id|u32
id|addr
op_assign
id|ifa-&gt;ifa_address
suffix:semicolon
id|u32
id|netmask
op_assign
id|ifa-&gt;ifa_mask
suffix:semicolon
r_struct
id|net_device
op_star
id|dev
op_assign
id|ifa-&gt;ifa_dev-&gt;dev
suffix:semicolon
r_struct
id|uml_net_private
op_star
id|lp
suffix:semicolon
r_void
(paren
op_star
id|proc
)paren
(paren
r_int
r_char
op_star
comma
r_int
r_char
op_star
comma
r_void
op_star
)paren
suffix:semicolon
r_int
r_char
id|addr_buf
(braket
l_int|4
)braket
comma
id|netmask_buf
(braket
l_int|4
)braket
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;open
op_ne
id|uml_net_open
)paren
(brace
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
id|lp
op_assign
id|dev-&gt;priv
suffix:semicolon
id|proc
op_assign
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|NETDEV_UP
suffix:colon
id|proc
op_assign
id|lp-&gt;add_address
suffix:semicolon
r_break
suffix:semicolon
r_case
id|NETDEV_DOWN
suffix:colon
id|proc
op_assign
id|lp-&gt;delete_address
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|proc
op_ne
l_int|NULL
)paren
(brace
id|addr_buf
(braket
l_int|0
)braket
op_assign
id|addr
op_amp
l_int|0xff
suffix:semicolon
id|addr_buf
(braket
l_int|1
)braket
op_assign
(paren
id|addr
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|addr_buf
(braket
l_int|2
)braket
op_assign
(paren
id|addr
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|addr_buf
(braket
l_int|3
)braket
op_assign
id|addr
op_rshift
l_int|24
suffix:semicolon
id|netmask_buf
(braket
l_int|0
)braket
op_assign
id|netmask
op_amp
l_int|0xff
suffix:semicolon
id|netmask_buf
(braket
l_int|1
)braket
op_assign
(paren
id|netmask
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|netmask_buf
(braket
l_int|2
)braket
op_assign
(paren
id|netmask
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|netmask_buf
(braket
l_int|3
)braket
op_assign
id|netmask
op_rshift
l_int|24
suffix:semicolon
(paren
op_star
id|proc
)paren
(paren
id|addr_buf
comma
id|netmask_buf
comma
op_amp
id|lp-&gt;user
)paren
suffix:semicolon
)brace
r_return
id|NOTIFY_DONE
suffix:semicolon
)brace
DECL|variable|uml_inetaddr_notifier
r_struct
id|notifier_block
id|uml_inetaddr_notifier
op_assign
(brace
dot
id|notifier_call
op_assign
id|uml_inetaddr_event
comma
)brace
suffix:semicolon
DECL|function|uml_net_init
r_static
r_int
id|uml_net_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|list_head
op_star
id|ele
suffix:semicolon
r_struct
id|uml_net_private
op_star
id|lp
suffix:semicolon
r_struct
id|in_device
op_star
id|ip
suffix:semicolon
r_struct
id|in_ifaddr
op_star
id|in
suffix:semicolon
id|mconsole_register_dev
c_func
(paren
op_amp
id|net_mc
)paren
suffix:semicolon
id|register_inetaddr_notifier
c_func
(paren
op_amp
id|uml_inetaddr_notifier
)paren
suffix:semicolon
multiline_comment|/* Devices may have been opened already, so the uml_inetaddr_notifier&n;&t; * didn&squot;t get a chance to run for them.  This fakes it so that&n;&t; * addresses which have already been set up get handled properly.&n;&t; */
(def_block
id|list_for_each
c_func
(paren
id|ele
comma
op_amp
id|opened
)paren
(brace
id|lp
op_assign
id|list_entry
c_func
(paren
id|ele
comma
r_struct
id|uml_net_private
comma
id|list
)paren
suffix:semicolon
id|ip
op_assign
id|lp-&gt;dev-&gt;ip_ptr
suffix:semicolon
r_if
c_cond
(paren
id|ip
op_eq
l_int|NULL
)paren
(brace
r_continue
suffix:semicolon
)brace
id|in
op_assign
id|ip-&gt;ifa_list
suffix:semicolon
r_while
c_loop
(paren
id|in
op_ne
l_int|NULL
)paren
(brace
id|uml_inetaddr_event
c_func
(paren
l_int|NULL
comma
id|NETDEV_UP
comma
id|in
)paren
suffix:semicolon
id|in
op_assign
id|in-&gt;ifa_next
suffix:semicolon
)brace
)brace
)def_block
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|uml_net_init
id|__initcall
c_func
(paren
id|uml_net_init
)paren
suffix:semicolon
DECL|function|close_devices
r_static
r_void
id|close_devices
c_func
(paren
r_void
)paren
(brace
r_struct
id|list_head
op_star
id|ele
suffix:semicolon
r_struct
id|uml_net_private
op_star
id|lp
suffix:semicolon
(def_block
id|list_for_each
c_func
(paren
id|ele
comma
op_amp
id|opened
)paren
(brace
id|lp
op_assign
id|list_entry
c_func
(paren
id|ele
comma
r_struct
id|uml_net_private
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lp-&gt;close
op_ne
l_int|NULL
)paren
(brace
(paren
op_star
id|lp-&gt;close
)paren
(paren
id|lp-&gt;fd
comma
op_amp
id|lp-&gt;user
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lp-&gt;remove
op_ne
l_int|NULL
)paren
(brace
(paren
op_star
id|lp-&gt;remove
)paren
(paren
op_amp
id|lp-&gt;user
)paren
suffix:semicolon
)brace
)brace
)def_block
)brace
DECL|variable|close_devices
id|__uml_exitcall
c_func
(paren
id|close_devices
)paren
suffix:semicolon
DECL|function|setup_etheraddr
r_int
id|setup_etheraddr
c_func
(paren
r_char
op_star
id|str
comma
r_int
r_char
op_star
id|addr
)paren
(brace
r_char
op_star
id|end
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|str
op_eq
l_int|NULL
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|addr
(braket
id|i
)braket
op_assign
id|simple_strtoul
c_func
(paren
id|str
comma
op_amp
id|end
comma
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|end
op_eq
id|str
)paren
op_logical_or
(paren
(paren
op_star
id|end
op_ne
l_char|&squot;:&squot;
)paren
op_logical_and
(paren
op_star
id|end
op_ne
l_char|&squot;,&squot;
)paren
op_logical_and
(paren
op_star
id|end
op_ne
l_char|&squot;&bslash;0&squot;
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;setup_etheraddr: failed to parse &squot;%s&squot; &quot;
l_string|&quot;as an ethernet address&bslash;n&quot;
comma
id|str
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|str
op_assign
id|end
op_plus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|addr
(braket
l_int|0
)braket
op_amp
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Attempt to assign a broadcast ethernet address to a &quot;
l_string|&quot;device disallowed&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|dev_ip_addr
r_void
id|dev_ip_addr
c_func
(paren
r_void
op_star
id|d
comma
r_char
op_star
id|buf
comma
r_char
op_star
id|bin_buf
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|d
suffix:semicolon
r_struct
id|in_device
op_star
id|ip
op_assign
id|dev-&gt;ip_ptr
suffix:semicolon
r_struct
id|in_ifaddr
op_star
id|in
suffix:semicolon
id|u32
id|addr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|ip
op_eq
l_int|NULL
)paren
op_logical_or
(paren
(paren
id|in
op_assign
id|ip-&gt;ifa_list
)paren
op_eq
l_int|NULL
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;dev_ip_addr - device not assigned an &quot;
l_string|&quot;IP address&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|addr
op_assign
id|in-&gt;ifa_address
suffix:semicolon
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;%d.%d.%d.%d&quot;
comma
id|addr
op_amp
l_int|0xff
comma
(paren
id|addr
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
comma
(paren
id|addr
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
comma
id|addr
op_rshift
l_int|24
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bin_buf
)paren
(brace
id|bin_buf
(braket
l_int|0
)braket
op_assign
id|addr
op_amp
l_int|0xff
suffix:semicolon
id|bin_buf
(braket
l_int|1
)braket
op_assign
(paren
id|addr
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|bin_buf
(braket
l_int|2
)braket
op_assign
(paren
id|addr
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|bin_buf
(braket
l_int|3
)braket
op_assign
id|addr
op_rshift
l_int|24
suffix:semicolon
)brace
)brace
DECL|function|set_ether_mac
r_void
id|set_ether_mac
c_func
(paren
r_void
op_star
id|d
comma
r_int
r_char
op_star
id|addr
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|d
suffix:semicolon
id|memcpy
c_func
(paren
id|dev-&gt;dev_addr
comma
id|addr
comma
id|ETH_ALEN
)paren
suffix:semicolon
)brace
DECL|function|ether_adjust_skb
r_struct
id|sk_buff
op_star
id|ether_adjust_skb
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|extra
)paren
(brace
r_if
c_cond
(paren
(paren
id|skb
op_ne
l_int|NULL
)paren
op_logical_and
(paren
id|skb_tailroom
c_func
(paren
id|skb
)paren
OL
id|extra
)paren
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb2
suffix:semicolon
id|skb2
op_assign
id|skb_copy_expand
c_func
(paren
id|skb
comma
l_int|0
comma
id|extra
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|skb
op_assign
id|skb2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skb
op_ne
l_int|NULL
)paren
(brace
id|skb_put
c_func
(paren
id|skb
comma
id|extra
)paren
suffix:semicolon
)brace
r_return
id|skb
suffix:semicolon
)brace
DECL|function|iter_addresses
r_void
id|iter_addresses
c_func
(paren
r_void
op_star
id|d
comma
r_void
(paren
op_star
id|cb
)paren
(paren
r_int
r_char
op_star
comma
r_int
r_char
op_star
comma
r_void
op_star
)paren
comma
r_void
op_star
id|arg
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|d
suffix:semicolon
r_struct
id|in_device
op_star
id|ip
op_assign
id|dev-&gt;ip_ptr
suffix:semicolon
r_struct
id|in_ifaddr
op_star
id|in
suffix:semicolon
r_int
r_char
id|address
(braket
l_int|4
)braket
comma
id|netmask
(braket
l_int|4
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ip
op_eq
l_int|NULL
)paren
(brace
r_return
suffix:semicolon
)brace
id|in
op_assign
id|ip-&gt;ifa_list
suffix:semicolon
r_while
c_loop
(paren
id|in
op_ne
l_int|NULL
)paren
(brace
id|address
(braket
l_int|0
)braket
op_assign
id|in-&gt;ifa_address
op_amp
l_int|0xff
suffix:semicolon
id|address
(braket
l_int|1
)braket
op_assign
(paren
id|in-&gt;ifa_address
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|address
(braket
l_int|2
)braket
op_assign
(paren
id|in-&gt;ifa_address
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|address
(braket
l_int|3
)braket
op_assign
id|in-&gt;ifa_address
op_rshift
l_int|24
suffix:semicolon
id|netmask
(braket
l_int|0
)braket
op_assign
id|in-&gt;ifa_mask
op_amp
l_int|0xff
suffix:semicolon
id|netmask
(braket
l_int|1
)braket
op_assign
(paren
id|in-&gt;ifa_mask
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|netmask
(braket
l_int|2
)braket
op_assign
(paren
id|in-&gt;ifa_mask
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
id|netmask
(braket
l_int|3
)braket
op_assign
id|in-&gt;ifa_mask
op_rshift
l_int|24
suffix:semicolon
(paren
op_star
id|cb
)paren
(paren
id|address
comma
id|netmask
comma
id|arg
)paren
suffix:semicolon
id|in
op_assign
id|in-&gt;ifa_next
suffix:semicolon
)brace
)brace
DECL|function|dev_netmask
r_int
id|dev_netmask
c_func
(paren
r_void
op_star
id|d
comma
r_void
op_star
id|m
)paren
(brace
r_struct
id|net_device
op_star
id|dev
op_assign
id|d
suffix:semicolon
r_struct
id|in_device
op_star
id|ip
op_assign
id|dev-&gt;ip_ptr
suffix:semicolon
r_struct
id|in_ifaddr
op_star
id|in
suffix:semicolon
id|__u32
op_star
id|mask_out
op_assign
id|m
suffix:semicolon
r_if
c_cond
(paren
id|ip
op_eq
l_int|NULL
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
id|in
op_assign
id|ip-&gt;ifa_list
suffix:semicolon
r_if
c_cond
(paren
id|in
op_eq
l_int|NULL
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
op_star
id|mask_out
op_assign
id|in-&gt;ifa_mask
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|get_output_buffer
r_void
op_star
id|get_output_buffer
c_func
(paren
r_int
op_star
id|len_out
)paren
(brace
r_void
op_star
id|ret
suffix:semicolon
id|ret
op_assign
(paren
r_void
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
op_star
id|len_out
op_assign
id|PAGE_SIZE
suffix:semicolon
)brace
r_else
op_star
id|len_out
op_assign
l_int|0
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|free_output_buffer
r_void
id|free_output_buffer
c_func
(paren
r_void
op_star
id|buffer
)paren
(brace
id|free_pages
c_func
(paren
(paren
r_int
r_int
)paren
id|buffer
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|tap_setup_common
r_int
id|tap_setup_common
c_func
(paren
r_char
op_star
id|str
comma
r_char
op_star
id|type
comma
r_char
op_star
op_star
id|dev_name
comma
r_char
op_star
op_star
id|mac_out
comma
r_char
op_star
op_star
id|gate_addr
)paren
(brace
r_char
op_star
id|remain
suffix:semicolon
id|remain
op_assign
id|split_if_spec
c_func
(paren
id|str
comma
id|dev_name
comma
id|mac_out
comma
id|gate_addr
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|remain
op_ne
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;tap_setup_common - Extra garbage on specification : &quot;
l_string|&quot;&squot;%s&squot;&bslash;n&quot;
comma
id|remain
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|eth_protocol
r_int
r_int
id|eth_protocol
c_func
(paren
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_return
id|eth_type_trans
c_func
(paren
id|skb
comma
id|skb-&gt;dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Overrides for Emacs so that we follow Linus&squot;s tabbing style.&n; * Emacs will notice this stuff at the end of the file and automatically&n; * adjust the settings for this buffer only.  This must remain at the end&n; * of the file.&n; * ---------------------------------------------------------------------------&n; * Local variables:&n; * c-file-style: &quot;linux&quot;&n; * End:&n; */
eof
