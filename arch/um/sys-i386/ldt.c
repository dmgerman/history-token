multiline_comment|/*&n; * Copyright (C) 2001, 2002 Jeff Dike (jdike@karaya.com)&n; * Licensed under the GPL&n; */
macro_line|#include &quot;linux/config.h&quot;
macro_line|#include &quot;linux/slab.h&quot;
macro_line|#include &quot;asm/uaccess.h&quot;
macro_line|#include &quot;asm/ptrace.h&quot;
macro_line|#include &quot;choose-mode.h&quot;
macro_line|#include &quot;kern.h&quot;
macro_line|#ifdef CONFIG_MODE_TT
r_extern
r_int
id|modify_ldt
c_func
(paren
r_int
id|func
comma
r_void
op_star
id|ptr
comma
r_int
r_int
id|bytecount
)paren
suffix:semicolon
multiline_comment|/* XXX this needs copy_to_user and copy_from_user */
DECL|function|sys_modify_ldt_tt
r_int
id|sys_modify_ldt_tt
c_func
(paren
r_int
id|func
comma
r_void
id|__user
op_star
id|ptr
comma
r_int
r_int
id|bytecount
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|access_ok
c_func
(paren
id|VERIFY_READ
comma
id|ptr
comma
id|bytecount
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
id|modify_ldt
c_func
(paren
id|func
comma
id|ptr
comma
id|bytecount
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_MODE_SKAS
r_extern
r_int
id|userspace_pid
suffix:semicolon
macro_line|#include &quot;skas_ptrace.h&quot;
DECL|function|sys_modify_ldt_skas
r_int
id|sys_modify_ldt_skas
c_func
(paren
r_int
id|func
comma
r_void
id|__user
op_star
id|ptr
comma
r_int
r_int
id|bytecount
)paren
(brace
r_struct
id|ptrace_ldt
id|ldt
suffix:semicolon
r_void
op_star
id|buf
suffix:semicolon
r_int
id|res
comma
id|n
suffix:semicolon
id|buf
op_assign
id|kmalloc
c_func
(paren
id|bytecount
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf
op_eq
l_int|NULL
)paren
(brace
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|res
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|func
)paren
(brace
r_case
l_int|1
suffix:colon
r_case
l_int|0x11
suffix:colon
id|res
op_assign
id|copy_from_user
c_func
(paren
id|buf
comma
id|ptr
comma
id|bytecount
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|res
op_ne
l_int|0
)paren
(brace
id|res
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|ldt
op_assign
(paren
(paren
r_struct
id|ptrace_ldt
)paren
(brace
dot
id|func
op_assign
id|func
comma
dot
id|ptr
op_assign
id|buf
comma
dot
id|bytecount
op_assign
id|bytecount
)brace
)paren
suffix:semicolon
id|res
op_assign
id|ptrace
c_func
(paren
id|PTRACE_LDT
comma
id|userspace_pid
comma
l_int|0
comma
(paren
r_int
r_int
)paren
op_amp
id|ldt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
OL
l_int|0
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|func
)paren
(brace
r_case
l_int|0
suffix:colon
r_case
l_int|2
suffix:colon
id|n
op_assign
id|res
suffix:semicolon
id|res
op_assign
id|copy_to_user
c_func
(paren
id|ptr
comma
id|buf
comma
id|n
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
op_ne
l_int|0
)paren
(brace
id|res
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
r_else
id|res
op_assign
id|n
suffix:semicolon
r_break
suffix:semicolon
)brace
id|out
suffix:colon
id|kfree
c_func
(paren
id|buf
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
macro_line|#endif
DECL|function|sys_modify_ldt
r_int
id|sys_modify_ldt
c_func
(paren
r_int
id|func
comma
r_void
id|__user
op_star
id|ptr
comma
r_int
r_int
id|bytecount
)paren
(brace
r_return
id|CHOOSE_MODE_PROC
c_func
(paren
id|sys_modify_ldt_tt
comma
id|sys_modify_ldt_skas
comma
id|func
comma
id|ptr
comma
id|bytecount
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Overrides for Emacs so that we follow Linus&squot;s tabbing style.&n; * Emacs will notice this stuff at the end of the file and automatically&n; * adjust the settings for this buffer only.  This must remain at the end&n; * of the file.&n; * ---------------------------------------------------------------------------&n; * Local variables:&n; * c-file-style: &quot;linux&quot;&n; * End:&n; */
eof
