multiline_comment|/*&n; * align.c - address exception handler for M32R&n; *&n; * Copyright (c) 2003 Hitoshi Yamamoto&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
DECL|function|get_reg
r_static
r_int
id|get_reg
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|nr
)paren
(brace
r_int
id|val
suffix:semicolon
r_if
c_cond
(paren
id|nr
OL
l_int|4
)paren
id|val
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
(paren
op_amp
id|regs-&gt;r0
op_plus
id|nr
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|nr
OL
l_int|7
)paren
id|val
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
(paren
op_amp
id|regs-&gt;r4
op_plus
(paren
id|nr
op_minus
l_int|4
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|nr
OL
l_int|13
)paren
id|val
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
(paren
op_amp
id|regs-&gt;r7
op_plus
(paren
id|nr
op_minus
l_int|7
)paren
)paren
suffix:semicolon
r_else
id|val
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
(paren
op_amp
id|regs-&gt;fp
op_plus
(paren
id|nr
op_minus
l_int|13
)paren
)paren
suffix:semicolon
r_return
id|val
suffix:semicolon
)brace
DECL|function|set_reg
r_static
r_void
id|set_reg
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|nr
comma
r_int
id|val
)paren
(brace
r_if
c_cond
(paren
id|nr
OL
l_int|4
)paren
op_star
(paren
r_int
r_int
op_star
)paren
(paren
op_amp
id|regs-&gt;r0
op_plus
id|nr
)paren
op_assign
id|val
suffix:semicolon
r_else
r_if
c_cond
(paren
id|nr
OL
l_int|7
)paren
op_star
(paren
r_int
r_int
op_star
)paren
(paren
op_amp
id|regs-&gt;r4
op_plus
(paren
id|nr
op_minus
l_int|4
)paren
)paren
op_assign
id|val
suffix:semicolon
r_else
r_if
c_cond
(paren
id|nr
OL
l_int|13
)paren
op_star
(paren
r_int
r_int
op_star
)paren
(paren
op_amp
id|regs-&gt;r7
op_plus
(paren
id|nr
op_minus
l_int|7
)paren
)paren
op_assign
id|val
suffix:semicolon
r_else
op_star
(paren
r_int
r_int
op_star
)paren
(paren
op_amp
id|regs-&gt;fp
op_plus
(paren
id|nr
op_minus
l_int|13
)paren
)paren
op_assign
id|val
suffix:semicolon
)brace
DECL|macro|REG1
mdefine_line|#define REG1(insn)&t;(((insn) &amp; 0x0f00) &gt;&gt; 8)
DECL|macro|REG2
mdefine_line|#define REG2(insn)&t;((insn) &amp; 0x000f)
DECL|macro|PSW_BC
mdefine_line|#define PSW_BC&t;&t;0x100
multiline_comment|/* O- instruction */
DECL|macro|ISA_LD1
mdefine_line|#define ISA_LD1&t;&t;0x20c0&t;/* ld Rdest, @Rsrc */
DECL|macro|ISA_LD2
mdefine_line|#define ISA_LD2&t;&t;0x20e0&t;/* ld Rdest, @Rsrc+ */
DECL|macro|ISA_LDH
mdefine_line|#define ISA_LDH&t;&t;0x20a0&t;/* ldh Rdest, @Rsrc */
DECL|macro|ISA_LDUH
mdefine_line|#define ISA_LDUH&t;0x20b0&t;/* lduh Rdest, @Rsrc */
DECL|macro|ISA_ST1
mdefine_line|#define ISA_ST1&t;&t;0x2040&t;/* st Rsrc1, @Rsrc2 */
DECL|macro|ISA_ST2
mdefine_line|#define ISA_ST2&t;&t;0x2060&t;/* st Rsrc1, @+Rsrc2 */
DECL|macro|ISA_ST3
mdefine_line|#define ISA_ST3&t;&t;0x2070&t;/* st Rsrc1, @-Rsrc2 */
DECL|macro|ISA_STH1
mdefine_line|#define ISA_STH1&t;0x2020&t;/* sth Rsrc1, @Rsrc2 */
DECL|macro|ISA_STH2
mdefine_line|#define ISA_STH2&t;0x2030&t;/* sth Rsrc1, @Rsrc2+ */
macro_line|#ifdef CONFIG_ISA_DUAL_ISSUE
multiline_comment|/* OS instruction */
DECL|macro|ISA_ADD
mdefine_line|#define ISA_ADD&t;&t;0x00a0&t;/* add Rdest, Rsrc */
DECL|macro|ISA_ADDI
mdefine_line|#define ISA_ADDI&t;0x4000&t;/* addi Rdest, #imm8 */
DECL|macro|ISA_ADDX
mdefine_line|#define ISA_ADDX&t;0x0090&t;/* addx Rdest, Rsrc */
DECL|macro|ISA_AND
mdefine_line|#define ISA_AND&t;&t;0x00c0&t;/* and Rdest, Rsrc */
DECL|macro|ISA_CMP
mdefine_line|#define ISA_CMP&t;&t;0x0040&t;/* cmp Rsrc1, Rsrc2 */
DECL|macro|ISA_CMPEQ
mdefine_line|#define ISA_CMPEQ&t;0x0060&t;/* cmpeq Rsrc1, Rsrc2 */
DECL|macro|ISA_CMPU
mdefine_line|#define ISA_CMPU&t;0x0050&t;/* cmpu Rsrc1, Rsrc2 */
DECL|macro|ISA_CMPZ
mdefine_line|#define ISA_CMPZ&t;0x0070&t;/* cmpz Rsrc */
DECL|macro|ISA_LDI
mdefine_line|#define ISA_LDI&t;&t;0x6000&t;/* ldi Rdest, #imm8 */
DECL|macro|ISA_MV
mdefine_line|#define ISA_MV&t;&t;0x1080&t;/* mv Rdest, Rsrc */
DECL|macro|ISA_NEG
mdefine_line|#define ISA_NEG&t;&t;0x0030&t;/* neg Rdest, Rsrc */
DECL|macro|ISA_NOP
mdefine_line|#define ISA_NOP&t;&t;0x7000&t;/* nop */
DECL|macro|ISA_NOT
mdefine_line|#define ISA_NOT&t;&t;0x00b0&t;/* not Rdest, Rsrc */
DECL|macro|ISA_OR
mdefine_line|#define ISA_OR&t;&t;0x00e0&t;/* or Rdest, Rsrc */
DECL|macro|ISA_SUB
mdefine_line|#define ISA_SUB&t;&t;0x0020&t;/* sub Rdest, Rsrc */
DECL|macro|ISA_SUBX
mdefine_line|#define ISA_SUBX&t;0x0010&t;/* subx Rdest, Rsrc */
DECL|macro|ISA_XOR
mdefine_line|#define ISA_XOR&t;&t;0x00d0&t;/* xor Rdest, Rsrc */
multiline_comment|/* -S instruction */
DECL|macro|ISA_MUL
mdefine_line|#define ISA_MUL&t;&t;0x1060&t;/* mul Rdest, Rsrc */
DECL|macro|ISA_MULLO_A0
mdefine_line|#define ISA_MULLO_A0&t;0x3010&t;/* mullo Rsrc1, Rsrc2, A0 */
DECL|macro|ISA_MULLO_A1
mdefine_line|#define ISA_MULLO_A1&t;0x3090&t;/* mullo Rsrc1, Rsrc2, A1 */
DECL|macro|ISA_MVFACMI_A0
mdefine_line|#define ISA_MVFACMI_A0&t;0x50f2&t;/* mvfacmi Rdest, A0 */
DECL|macro|ISA_MVFACMI_A1
mdefine_line|#define ISA_MVFACMI_A1&t;0x50f6&t;/* mvfacmi Rdest, A1 */
DECL|function|emu_addi
r_static
r_int
id|emu_addi
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_char
id|imm
op_assign
(paren
r_char
)paren
(paren
id|insn
op_amp
l_int|0xff
)paren
suffix:semicolon
r_int
id|dest
op_assign
id|REG1
c_func
(paren
id|insn
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
id|val
op_assign
id|get_reg
c_func
(paren
id|regs
comma
id|dest
)paren
suffix:semicolon
id|val
op_add_assign
id|imm
suffix:semicolon
id|set_reg
c_func
(paren
id|regs
comma
id|dest
comma
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_ldi
r_static
r_int
id|emu_ldi
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_char
id|imm
op_assign
(paren
r_char
)paren
(paren
id|insn
op_amp
l_int|0xff
)paren
suffix:semicolon
id|set_reg
c_func
(paren
id|regs
comma
id|REG1
c_func
(paren
id|insn
)paren
comma
(paren
r_int
)paren
id|imm
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_add
r_static
r_int
id|emu_add
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|dest
op_assign
id|REG1
c_func
(paren
id|insn
)paren
suffix:semicolon
r_int
id|src
op_assign
id|REG2
c_func
(paren
id|insn
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
id|val
op_assign
id|get_reg
c_func
(paren
id|regs
comma
id|dest
)paren
suffix:semicolon
id|val
op_add_assign
id|get_reg
c_func
(paren
id|regs
comma
id|src
)paren
suffix:semicolon
id|set_reg
c_func
(paren
id|regs
comma
id|dest
comma
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_addx
r_static
r_int
id|emu_addx
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|dest
op_assign
id|REG1
c_func
(paren
id|insn
)paren
suffix:semicolon
r_int
r_int
id|val
comma
id|tmp
suffix:semicolon
id|val
op_assign
id|regs-&gt;psw
op_amp
id|PSW_BC
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|tmp
op_assign
id|get_reg
c_func
(paren
id|regs
comma
id|dest
)paren
suffix:semicolon
id|val
op_add_assign
id|tmp
suffix:semicolon
id|val
op_add_assign
(paren
r_int
r_int
)paren
id|get_reg
c_func
(paren
id|regs
comma
id|REG2
c_func
(paren
id|insn
)paren
)paren
suffix:semicolon
id|set_reg
c_func
(paren
id|regs
comma
id|dest
comma
id|val
)paren
suffix:semicolon
multiline_comment|/* C bit set */
r_if
c_cond
(paren
id|val
OL
id|tmp
)paren
id|regs-&gt;psw
op_or_assign
id|PSW_BC
suffix:semicolon
r_else
id|regs-&gt;psw
op_and_assign
op_complement
(paren
id|PSW_BC
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_and
r_static
r_int
id|emu_and
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|dest
op_assign
id|REG1
c_func
(paren
id|insn
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
id|val
op_assign
id|get_reg
c_func
(paren
id|regs
comma
id|dest
)paren
suffix:semicolon
id|val
op_and_assign
id|get_reg
c_func
(paren
id|regs
comma
id|REG2
c_func
(paren
id|insn
)paren
)paren
suffix:semicolon
id|set_reg
c_func
(paren
id|regs
comma
id|dest
comma
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_cmp
r_static
r_int
id|emu_cmp
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_if
c_cond
(paren
id|get_reg
c_func
(paren
id|regs
comma
id|REG1
c_func
(paren
id|insn
)paren
)paren
OL
id|get_reg
c_func
(paren
id|regs
comma
id|REG2
c_func
(paren
id|insn
)paren
)paren
)paren
id|regs-&gt;psw
op_or_assign
id|PSW_BC
suffix:semicolon
r_else
id|regs-&gt;psw
op_and_assign
op_complement
(paren
id|PSW_BC
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_cmpeq
r_static
r_int
id|emu_cmpeq
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_if
c_cond
(paren
id|get_reg
c_func
(paren
id|regs
comma
id|REG1
c_func
(paren
id|insn
)paren
)paren
op_eq
id|get_reg
c_func
(paren
id|regs
comma
id|REG2
c_func
(paren
id|insn
)paren
)paren
)paren
id|regs-&gt;psw
op_or_assign
id|PSW_BC
suffix:semicolon
r_else
id|regs-&gt;psw
op_and_assign
op_complement
(paren
id|PSW_BC
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_cmpu
r_static
r_int
id|emu_cmpu
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
id|get_reg
c_func
(paren
id|regs
comma
id|REG1
c_func
(paren
id|insn
)paren
)paren
OL
(paren
r_int
r_int
)paren
id|get_reg
c_func
(paren
id|regs
comma
id|REG2
c_func
(paren
id|insn
)paren
)paren
)paren
id|regs-&gt;psw
op_or_assign
id|PSW_BC
suffix:semicolon
r_else
id|regs-&gt;psw
op_and_assign
op_complement
(paren
id|PSW_BC
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_cmpz
r_static
r_int
id|emu_cmpz
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|get_reg
c_func
(paren
id|regs
comma
id|REG2
c_func
(paren
id|insn
)paren
)paren
)paren
id|regs-&gt;psw
op_or_assign
id|PSW_BC
suffix:semicolon
r_else
id|regs-&gt;psw
op_and_assign
op_complement
(paren
id|PSW_BC
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_mv
r_static
r_int
id|emu_mv
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|val
suffix:semicolon
id|val
op_assign
id|get_reg
c_func
(paren
id|regs
comma
id|REG2
c_func
(paren
id|insn
)paren
)paren
suffix:semicolon
id|set_reg
c_func
(paren
id|regs
comma
id|REG1
c_func
(paren
id|insn
)paren
comma
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_neg
r_static
r_int
id|emu_neg
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|val
suffix:semicolon
id|val
op_assign
id|get_reg
c_func
(paren
id|regs
comma
id|REG2
c_func
(paren
id|insn
)paren
)paren
suffix:semicolon
id|set_reg
c_func
(paren
id|regs
comma
id|REG1
c_func
(paren
id|insn
)paren
comma
l_int|0
op_minus
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_not
r_static
r_int
id|emu_not
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|val
suffix:semicolon
id|val
op_assign
id|get_reg
c_func
(paren
id|regs
comma
id|REG2
c_func
(paren
id|insn
)paren
)paren
suffix:semicolon
id|set_reg
c_func
(paren
id|regs
comma
id|REG1
c_func
(paren
id|insn
)paren
comma
op_complement
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_or
r_static
r_int
id|emu_or
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|dest
op_assign
id|REG1
c_func
(paren
id|insn
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
id|val
op_assign
id|get_reg
c_func
(paren
id|regs
comma
id|dest
)paren
suffix:semicolon
id|val
op_or_assign
id|get_reg
c_func
(paren
id|regs
comma
id|REG2
c_func
(paren
id|insn
)paren
)paren
suffix:semicolon
id|set_reg
c_func
(paren
id|regs
comma
id|dest
comma
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_sub
r_static
r_int
id|emu_sub
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|dest
op_assign
id|REG1
c_func
(paren
id|insn
)paren
suffix:semicolon
r_int
id|val
suffix:semicolon
id|val
op_assign
id|get_reg
c_func
(paren
id|regs
comma
id|dest
)paren
suffix:semicolon
id|val
op_sub_assign
id|get_reg
c_func
(paren
id|regs
comma
id|REG2
c_func
(paren
id|insn
)paren
)paren
suffix:semicolon
id|set_reg
c_func
(paren
id|regs
comma
id|dest
comma
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_subx
r_static
r_int
id|emu_subx
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|dest
op_assign
id|REG1
c_func
(paren
id|insn
)paren
suffix:semicolon
r_int
r_int
id|val
comma
id|tmp
suffix:semicolon
id|val
op_assign
id|tmp
op_assign
id|get_reg
c_func
(paren
id|regs
comma
id|dest
)paren
suffix:semicolon
id|val
op_sub_assign
(paren
r_int
r_int
)paren
id|get_reg
c_func
(paren
id|regs
comma
id|REG2
c_func
(paren
id|insn
)paren
)paren
suffix:semicolon
id|val
op_sub_assign
id|regs-&gt;psw
op_amp
id|PSW_BC
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|set_reg
c_func
(paren
id|regs
comma
id|dest
comma
id|val
)paren
suffix:semicolon
multiline_comment|/* C bit set */
r_if
c_cond
(paren
id|val
OG
id|tmp
)paren
id|regs-&gt;psw
op_or_assign
id|PSW_BC
suffix:semicolon
r_else
id|regs-&gt;psw
op_and_assign
op_complement
(paren
id|PSW_BC
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_xor
r_static
r_int
id|emu_xor
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|dest
op_assign
id|REG1
c_func
(paren
id|insn
)paren
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
(paren
r_int
r_int
)paren
id|get_reg
c_func
(paren
id|regs
comma
id|dest
)paren
suffix:semicolon
id|val
op_xor_assign
(paren
r_int
r_int
)paren
id|get_reg
c_func
(paren
id|regs
comma
id|REG2
c_func
(paren
id|insn
)paren
)paren
suffix:semicolon
id|set_reg
c_func
(paren
id|regs
comma
id|dest
comma
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_mul
r_static
r_int
id|emu_mul
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|dest
op_assign
id|REG1
c_func
(paren
id|insn
)paren
suffix:semicolon
r_int
id|reg1
comma
id|reg2
suffix:semicolon
id|reg1
op_assign
id|get_reg
c_func
(paren
id|regs
comma
id|dest
)paren
suffix:semicolon
id|reg2
op_assign
id|get_reg
c_func
(paren
id|regs
comma
id|REG2
c_func
(paren
id|insn
)paren
)paren
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;mul&t;%0, %1;&t;&t;&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;+r&quot;
(paren
id|reg1
)paren
suffix:colon
l_string|&quot;r&quot;
(paren
id|reg2
)paren
)paren
suffix:semicolon
id|set_reg
c_func
(paren
id|regs
comma
id|dest
comma
id|reg1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_mullo_a0
r_static
r_int
id|emu_mullo_a0
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|reg1
comma
id|reg2
suffix:semicolon
id|reg1
op_assign
id|get_reg
c_func
(paren
id|regs
comma
id|REG1
c_func
(paren
id|insn
)paren
)paren
suffix:semicolon
id|reg2
op_assign
id|get_reg
c_func
(paren
id|regs
comma
id|REG2
c_func
(paren
id|insn
)paren
)paren
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;mullo&t;&t;%0, %1, a0;&t;&bslash;n&bslash;t&quot;
l_string|&quot;mvfachi&t;%0, a0;&t;&t;&bslash;n&bslash;t&quot;
l_string|&quot;mvfaclo&t;%1, a0;&t;&t;&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;+r&quot;
(paren
id|reg1
)paren
comma
l_string|&quot;+r&quot;
(paren
id|reg2
)paren
)paren
suffix:semicolon
id|regs-&gt;acc0h
op_assign
id|reg1
suffix:semicolon
id|regs-&gt;acc0l
op_assign
id|reg2
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_mullo_a1
r_static
r_int
id|emu_mullo_a1
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|reg1
comma
id|reg2
suffix:semicolon
id|reg1
op_assign
id|get_reg
c_func
(paren
id|regs
comma
id|REG1
c_func
(paren
id|insn
)paren
)paren
suffix:semicolon
id|reg2
op_assign
id|get_reg
c_func
(paren
id|regs
comma
id|REG2
c_func
(paren
id|insn
)paren
)paren
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;mullo&t;&t;%0, %1, a0;&t;&bslash;n&bslash;t&quot;
l_string|&quot;mvfachi&t;%0, a0;&t;&t;&bslash;n&bslash;t&quot;
l_string|&quot;mvfaclo&t;%1, a0;&t;&t;&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;+r&quot;
(paren
id|reg1
)paren
comma
l_string|&quot;+r&quot;
(paren
id|reg2
)paren
)paren
suffix:semicolon
id|regs-&gt;acc1h
op_assign
id|reg1
suffix:semicolon
id|regs-&gt;acc1l
op_assign
id|reg2
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_mvfacmi_a0
r_static
r_int
id|emu_mvfacmi_a0
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
(paren
id|regs-&gt;acc0h
op_lshift
l_int|16
)paren
op_or
(paren
id|regs-&gt;acc0l
op_rshift
l_int|16
)paren
suffix:semicolon
id|set_reg
c_func
(paren
id|regs
comma
id|REG1
c_func
(paren
id|insn
)paren
comma
(paren
r_int
)paren
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_mvfacmi_a1
r_static
r_int
id|emu_mvfacmi_a1
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
(paren
id|regs-&gt;acc1h
op_lshift
l_int|16
)paren
op_or
(paren
id|regs-&gt;acc1l
op_rshift
l_int|16
)paren
suffix:semicolon
id|set_reg
c_func
(paren
id|regs
comma
id|REG1
c_func
(paren
id|insn
)paren
comma
(paren
r_int
)paren
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_m32r2
r_static
r_int
id|emu_m32r2
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|res
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|insn
op_amp
l_int|0x7fff
)paren
op_eq
id|ISA_NOP
)paren
multiline_comment|/* nop */
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|insn
op_amp
l_int|0x7000
)paren
(brace
r_case
id|ISA_ADDI
suffix:colon
multiline_comment|/* addi Rdest, #imm8 */
id|res
op_assign
id|emu_addi
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISA_LDI
suffix:colon
multiline_comment|/* ldi Rdest, #imm8 */
id|res
op_assign
id|emu_ldi
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|res
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|insn
op_amp
l_int|0x70f0
)paren
(brace
r_case
id|ISA_ADD
suffix:colon
multiline_comment|/* add Rdest, Rsrc */
id|res
op_assign
id|emu_add
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISA_ADDX
suffix:colon
multiline_comment|/* addx Rdest, Rsrc */
id|res
op_assign
id|emu_addx
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISA_AND
suffix:colon
multiline_comment|/* and Rdest, Rsrc */
id|res
op_assign
id|emu_and
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISA_CMP
suffix:colon
multiline_comment|/* cmp Rsrc1, Rsrc2 */
id|res
op_assign
id|emu_cmp
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISA_CMPEQ
suffix:colon
multiline_comment|/* cmpeq Rsrc1, Rsrc2 */
id|res
op_assign
id|emu_cmpeq
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISA_CMPU
suffix:colon
multiline_comment|/* cmpu Rsrc1, Rsrc2 */
id|res
op_assign
id|emu_cmpu
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISA_CMPZ
suffix:colon
multiline_comment|/* cmpz Rsrc */
id|res
op_assign
id|emu_cmpz
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISA_MV
suffix:colon
multiline_comment|/* mv Rdest, Rsrc */
id|res
op_assign
id|emu_mv
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISA_NEG
suffix:colon
multiline_comment|/* neg Rdest, Rsrc */
id|res
op_assign
id|emu_neg
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISA_NOT
suffix:colon
multiline_comment|/* not Rdest, Rsrc */
id|res
op_assign
id|emu_not
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISA_OR
suffix:colon
multiline_comment|/* or Rdest, Rsrc */
id|res
op_assign
id|emu_or
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISA_SUB
suffix:colon
multiline_comment|/* sub Rdest, Rsrc */
id|res
op_assign
id|emu_sub
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISA_SUBX
suffix:colon
multiline_comment|/* subx Rdest, Rsrc */
id|res
op_assign
id|emu_subx
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISA_XOR
suffix:colon
multiline_comment|/* xor Rdest, Rsrc */
id|res
op_assign
id|emu_xor
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISA_MUL
suffix:colon
multiline_comment|/* mul Rdest, Rsrc */
id|res
op_assign
id|emu_mul
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISA_MULLO_A0
suffix:colon
multiline_comment|/* mullo Rsrc1, Rsrc2 */
id|res
op_assign
id|emu_mullo_a0
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISA_MULLO_A1
suffix:colon
multiline_comment|/* mullo Rsrc1, Rsrc2 */
id|res
op_assign
id|emu_mullo_a1
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|res
)paren
r_return
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|insn
op_amp
l_int|0x70ff
)paren
(brace
r_case
id|ISA_MVFACMI_A0
suffix:colon
multiline_comment|/* mvfacmi Rdest */
id|res
op_assign
id|emu_mvfacmi_a0
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ISA_MVFACMI_A1
suffix:colon
multiline_comment|/* mvfacmi Rdest */
id|res
op_assign
id|emu_mvfacmi_a1
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
id|res
suffix:semicolon
)brace
macro_line|#endif&t;/* CONFIG_ISA_DUAL_ISSUE */
multiline_comment|/*&n; * ld   : ?010 dest 1100 src&n; *        0010 dest 1110 src : ld Rdest, @Rsrc+&n; * ldh  : ?010 dest 1010 src&n; * lduh : ?010 dest 1011 src&n; * st   : ?010 src1 0100 src2&n; *        0010 src1 0110 src2 : st Rsrc1, @+Rsrc2&n; *        0010 src1 0111 src2 : st Rsrc1, @-Rsrc2&n; * sth  : ?010 src1 0010 src2&n; */
DECL|function|insn_check
r_static
r_int
id|insn_check
c_func
(paren
r_int
r_int
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
r_char
op_star
op_star
id|ucp
)paren
(brace
r_int
id|res
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * 32bit insn&n;&t; *  ld Rdest, @(disp16, Rsrc)&n;&t; *  st Rdest, @(disp16, Rsrc)&n;&t; */
r_if
c_cond
(paren
id|insn
op_amp
l_int|0x80000000
)paren
(brace
multiline_comment|/* 32bit insn */
op_star
id|ucp
op_add_assign
(paren
r_int
)paren
(paren
id|insn
op_amp
l_int|0x0000ffff
)paren
suffix:semicolon
id|regs-&gt;bpc
op_add_assign
l_int|4
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* 16bit insn */
macro_line|#ifdef CONFIG_ISA_DUAL_ISSUE
multiline_comment|/* parallel exec check */
r_if
c_cond
(paren
op_logical_neg
(paren
id|regs-&gt;bpc
op_amp
l_int|0x2
)paren
op_logical_and
id|insn
op_amp
l_int|0x8000
)paren
(brace
id|res
op_assign
id|emu_m32r2
c_func
(paren
(paren
r_int
r_int
)paren
id|insn
comma
id|regs
)paren
suffix:semicolon
id|regs-&gt;bpc
op_add_assign
l_int|4
suffix:semicolon
)brace
r_else
macro_line|#endif&t;/* CONFIG_ISA_DUAL_ISSUE */
id|regs-&gt;bpc
op_add_assign
l_int|2
suffix:semicolon
)brace
r_return
id|res
suffix:semicolon
)brace
DECL|function|emu_ld
r_static
r_int
id|emu_ld
c_func
(paren
r_int
r_int
id|insn32
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_char
op_star
id|ucp
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
r_int
id|insn16
suffix:semicolon
r_int
id|size
comma
id|src
suffix:semicolon
id|insn16
op_assign
id|insn32
op_rshift
l_int|16
suffix:semicolon
id|src
op_assign
id|REG2
c_func
(paren
id|insn16
)paren
suffix:semicolon
id|ucp
op_assign
(paren
r_int
r_char
op_star
)paren
id|get_reg
c_func
(paren
id|regs
comma
id|src
)paren
suffix:semicolon
r_if
c_cond
(paren
id|insn_check
c_func
(paren
id|insn32
comma
id|regs
comma
op_amp
id|ucp
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|size
op_assign
id|insn16
op_amp
l_int|0x0040
ques
c_cond
l_int|4
suffix:colon
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|val
comma
id|ucp
comma
id|size
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|size
op_eq
l_int|2
)paren
id|val
op_rshift_assign
l_int|16
suffix:semicolon
multiline_comment|/* ldh sign check */
r_if
c_cond
(paren
(paren
id|insn16
op_amp
l_int|0x00f0
)paren
op_eq
l_int|0x00a0
op_logical_and
(paren
id|val
op_amp
l_int|0x8000
)paren
)paren
id|val
op_or_assign
l_int|0xffff0000
suffix:semicolon
id|set_reg
c_func
(paren
id|regs
comma
id|REG1
c_func
(paren
id|insn16
)paren
comma
id|val
)paren
suffix:semicolon
multiline_comment|/* ld increment check */
r_if
c_cond
(paren
(paren
id|insn16
op_amp
l_int|0xf0f0
)paren
op_eq
id|ISA_LD2
)paren
multiline_comment|/* ld Rdest, @Rsrc+ */
id|set_reg
c_func
(paren
id|regs
comma
id|src
comma
(paren
r_int
r_int
)paren
(paren
id|ucp
op_plus
l_int|4
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|emu_st
r_static
r_int
id|emu_st
c_func
(paren
r_int
r_int
id|insn32
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_char
op_star
id|ucp
suffix:semicolon
r_int
r_int
id|val
suffix:semicolon
r_int
r_int
id|insn16
suffix:semicolon
r_int
id|size
comma
id|src2
suffix:semicolon
id|insn16
op_assign
id|insn32
op_rshift
l_int|16
suffix:semicolon
id|src2
op_assign
id|REG2
c_func
(paren
id|insn16
)paren
suffix:semicolon
id|ucp
op_assign
(paren
r_int
r_char
op_star
)paren
id|get_reg
c_func
(paren
id|regs
comma
id|src2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|insn_check
c_func
(paren
id|insn32
comma
id|regs
comma
op_amp
id|ucp
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|size
op_assign
id|insn16
op_amp
l_int|0x0040
ques
c_cond
l_int|4
suffix:colon
l_int|2
suffix:semicolon
id|val
op_assign
id|get_reg
c_func
(paren
id|regs
comma
id|REG1
c_func
(paren
id|insn16
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|size
op_eq
l_int|2
)paren
id|val
op_lshift_assign
l_int|16
suffix:semicolon
multiline_comment|/* st inc/dec check */
r_if
c_cond
(paren
(paren
id|insn16
op_amp
l_int|0xf0e0
)paren
op_eq
l_int|0x2060
)paren
(brace
r_if
c_cond
(paren
id|insn16
op_amp
l_int|0x0010
)paren
id|ucp
op_sub_assign
l_int|4
suffix:semicolon
r_else
id|ucp
op_add_assign
l_int|4
suffix:semicolon
id|set_reg
c_func
(paren
id|regs
comma
id|src2
comma
(paren
r_int
r_int
)paren
id|ucp
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|ucp
comma
op_amp
id|val
comma
id|size
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* sth inc check */
r_if
c_cond
(paren
(paren
id|insn16
op_amp
l_int|0xf0f0
)paren
op_eq
id|ISA_STH2
)paren
(brace
id|ucp
op_add_assign
l_int|2
suffix:semicolon
id|set_reg
c_func
(paren
id|regs
comma
id|src2
comma
(paren
r_int
r_int
)paren
id|ucp
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|handle_unaligned_access
r_int
id|handle_unaligned_access
c_func
(paren
r_int
r_int
id|insn32
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|insn16
suffix:semicolon
r_int
id|res
suffix:semicolon
id|insn16
op_assign
id|insn32
op_rshift
l_int|16
suffix:semicolon
multiline_comment|/* ld or st check */
r_if
c_cond
(paren
(paren
id|insn16
op_amp
l_int|0x7000
)paren
op_ne
l_int|0x2000
)paren
r_return
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* insn alignment check */
r_if
c_cond
(paren
(paren
id|insn16
op_amp
l_int|0x8000
)paren
op_logical_and
(paren
id|regs-&gt;bpc
op_amp
l_int|3
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|insn16
op_amp
l_int|0x0080
)paren
multiline_comment|/* ld */
id|res
op_assign
id|emu_ld
c_func
(paren
id|insn32
comma
id|regs
)paren
suffix:semicolon
r_else
multiline_comment|/* st */
id|res
op_assign
id|emu_st
c_func
(paren
id|insn32
comma
id|regs
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
eof
