multiline_comment|/*&n; *  linux/arch/m32r/kernel/traps.c&n; *&n; *  Copyright (C) 2001, 2002  Hirokazu Takata, Hiroyuki Kondo,&n; *                            Hitoshi Yamamoto&n; */
multiline_comment|/* $Id$ */
multiline_comment|/*&n; * &squot;traps.c&squot; handles hardware traps and faults after we have saved some&n; * state in &squot;entry.S&squot;.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/kallsyms.h&gt;
macro_line|#include &lt;linux/stddef.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/atomic.h&gt;
macro_line|#include &lt;asm/smp.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#if defined(CONFIG_MMU)
DECL|macro|PIE_HANDLER
mdefine_line|#define PIE_HANDLER &quot;pie_handler&quot;
DECL|macro|ACE_HANDLER
mdefine_line|#define ACE_HANDLER &quot;ace_handler&quot;
DECL|macro|TME_HANDLER
mdefine_line|#define TME_HANDLER &quot;tme_handler&quot;
macro_line|#else
DECL|macro|PIE_HANDLER
mdefine_line|#define PIE_HANDLER &quot;default_eit_handler&quot;
DECL|macro|ACE_HANDLER
mdefine_line|#define ACE_HANDLER &quot;default_eit_handler&quot;
DECL|macro|TME_HANDLER
mdefine_line|#define TME_HANDLER &quot;default_eit_handler&quot;
macro_line|#endif
id|asmlinkage
r_void
id|alignment_check
c_func
(paren
r_void
)paren
suffix:semicolon
id|asmlinkage
r_void
id|ei_handler
c_func
(paren
r_void
)paren
suffix:semicolon
id|asmlinkage
r_void
id|rie_handler
c_func
(paren
r_void
)paren
suffix:semicolon
id|asmlinkage
r_void
id|debug_trap
c_func
(paren
r_void
)paren
suffix:semicolon
id|asmlinkage
r_void
id|cache_flushing_handler
c_func
(paren
r_void
)paren
suffix:semicolon
id|asm
(paren
l_string|&quot;&t;.section .eit_vector,&bslash;&quot;ax&bslash;&quot;&t;&bslash;n&quot;
l_string|&quot;&t;.balign 4&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;.global _RE&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;.global default_eit_handler&t;&bslash;n&quot;
l_string|&quot;&t;.global system_call&t;&t;&bslash;n&quot;
l_string|&quot;&t;.global &quot;
id|PIE_HANDLER
l_string|&quot;&t;&t;&bslash;n&quot;
l_string|&quot;&t;.global &quot;
id|ACE_HANDLER
l_string|&quot;&t;&t;&bslash;n&quot;
l_string|&quot;&t;.global &quot;
id|TME_HANDLER
l_string|&quot;&t;&t;&bslash;n&quot;
l_string|&quot;_RE:&t;seth&t;r0, 0x01&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;default_eit_handler&t;&bslash;n&quot;
l_string|&quot;&t;.long&t;0,0&t;&t;&t;&bslash;n&quot;
l_string|&quot;_SBI:&t;seth&t;r0, 0x10&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;default_eit_handler&t;&bslash;n&quot;
l_string|&quot;&t;.long&t;0,0&t;&t;&t;&bslash;n&quot;
l_string|&quot;_RIE:&t;bra&t;rie_handler&t;&t;&bslash;n&quot;
l_string|&quot;&t;.long&t;0,0,0&t;&t;&t;&bslash;n&quot;
l_string|&quot;_AE:&t;bra&t;alignment_check&t;&t;&bslash;n&quot;
l_string|&quot;&t;.long&t;0,0,0&t;&t;&t;&bslash;n&quot;
l_string|&quot;_TRAP0:&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;_TRAP0&t;&t;&t;&bslash;n&quot;
l_string|&quot;_TRAP1:&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;debug_trap&t;&t;&bslash;n&quot;
l_string|&quot;_TRAP2:&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;system_call&t;&t;&bslash;n&quot;
l_string|&quot;_TRAP3:&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;_TRAP3&t;&t;&t;&bslash;n&quot;
l_string|&quot;_TRAP4:&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;_TRAP4&t;&t;&t;&bslash;n&quot;
l_string|&quot;_TRAP5:&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;_TRAP5&t;&t;&t;&bslash;n&quot;
l_string|&quot;_TRAP6:&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;_TRAP6&t;&t;&t;&bslash;n&quot;
l_string|&quot;_TRAP7:&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;_TRAP7&t;&t;&t;&bslash;n&quot;
l_string|&quot;_TRAP8:&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;_TRAP8&t;&t;&t;&bslash;n&quot;
l_string|&quot;_TRAP9:&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;_TRAP9&t;&t;&t;&bslash;n&quot;
l_string|&quot;_TRAP10:&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;_TRAP10&t;&t;&t;&bslash;n&quot;
l_string|&quot;_TRAP11:&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;_TRAP11&t;&t;&t;&bslash;n&quot;
l_string|&quot;_TRAP12:&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;cache_flushing_handler&t;&bslash;n&quot;
l_string|&quot;_TRAP13:&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;_TRAP13&t;&t;&t;&bslash;n&quot;
l_string|&quot;_TRAP14:&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;_TRAP14&t;&t;&t;&bslash;n&quot;
l_string|&quot;_TRAP15:&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;_TRAP15&t;&t;&t;&bslash;n&quot;
l_string|&quot;_EI:&t;bra&t;ei_handler&t;&t;&bslash;n&quot;
l_string|&quot;&t;.long   0,0,0&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;.previous&t;&t;&t;&bslash;n&quot;
)paren
suffix:semicolon
id|asm
(paren
l_string|&quot;&t;.section .eit_vector1,&bslash;&quot;ax&bslash;&quot;&t;&bslash;n&quot;
l_string|&quot;_BRA_SYSCAL:&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;system_call&t;&t;&bslash;n&quot;
l_string|&quot;&t;.long&t;0,0,0&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;.previous&t;&t;&t;&bslash;n&quot;
)paren
suffix:semicolon
id|asm
(paren
l_string|&quot;&t;.section .eit_vector2,&bslash;&quot;ax&bslash;&quot;&t;&bslash;n&quot;
l_string|&quot;_PIE:&t;&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;&quot;
id|PIE_HANDLER
l_string|&quot;&t;&t;&bslash;n&quot;
l_string|&quot;&t;.long   0,0,0&t;&t;&t;&bslash;n&quot;
l_string|&quot;_TLB_ACE:&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;&quot;
id|ACE_HANDLER
l_string|&quot;&t;&t;&bslash;n&quot;
l_string|&quot;&t;.long   0,0,0&t;&t;&t;&bslash;n&quot;
l_string|&quot;_TLB_MIS:&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;bra&t;&quot;
id|TME_HANDLER
l_string|&quot;&t;&t;&bslash;n&quot;
l_string|&quot;&t;.long   0,0,0&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;.previous &t;&t;&t;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SMP
multiline_comment|/*&n; * for IPI&n; */
id|asm
(paren
l_string|&quot;&t;.section .eit_vector3,&bslash;&quot;ax&bslash;&quot;&t;&t;&bslash;n&quot;
l_string|&quot;&t;.global smp_reschedule_interrupt&t;&bslash;n&quot;
l_string|&quot;&t;.global smp_invalidate_interrupt&t;&bslash;n&quot;
l_string|&quot;&t;.global smp_call_function_interrupt&t;&bslash;n&quot;
l_string|&quot;&t;.global smp_ipi_timer_interrupt&t;&t;&bslash;n&quot;
l_string|&quot;&t;.global smp_flush_cache_all_interrupt&t;&bslash;n&quot;
l_string|&quot;&t;.global _EI_VEC_TABLE&t;&t;&t;&bslash;n&quot;
l_string|&quot;_EI_VEC_TABLE:&t;&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;.fill 56, 4, 0&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;.long smp_reschedule_interrupt&t;&t;&bslash;n&quot;
l_string|&quot;&t;.long smp_invalidate_interrupt&t;&t;&bslash;n&quot;
l_string|&quot;&t;.long smp_call_function_interrupt&t;&bslash;n&quot;
l_string|&quot;&t;.long smp_ipi_timer_interrupt&t;&t;&bslash;n&quot;
l_string|&quot;&t;.long smp_flush_cache_all_interrupt&t;&bslash;n&quot;
l_string|&quot;&t;.fill 4, 4, 0&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;.previous&t;&t;&t;&t;&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n; * for Boot AP function&n; */
id|asm
(paren
l_string|&quot;&t;.section .eit_vector4,&bslash;&quot;ax&bslash;&quot;&t;&bslash;n&quot;
l_string|&quot;&t;.global _AP_RE&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;.global startup_AP&t;&t;&bslash;n&quot;
l_string|&quot;_AP_RE:&t;&t;&t;&t;&bslash;n&quot;
l_string|&quot;&t;.fill 32, 4, 0&t;&t;&t;&bslash;n&quot;
l_string|&quot;_AP_EI: bra&t;startup_AP&t;&t;&bslash;n&quot;
l_string|&quot;&t;.previous&t;&t;&t;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif  /* CONFIG_SMP */
DECL|macro|set_eit_vector_entries
mdefine_line|#define&t;set_eit_vector_entries(void)&t;do { } while (0)
DECL|function|trap_init
r_void
id|__init
id|trap_init
c_func
(paren
r_void
)paren
(brace
id|set_eit_vector_entries
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Should be a barrier for any external CPU state.&n;&t; */
id|cpu_init
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|kstack_depth_to_print
r_int
id|kstack_depth_to_print
op_assign
l_int|24
suffix:semicolon
DECL|function|show_trace
r_void
id|show_trace
c_func
(paren
r_struct
id|task_struct
op_star
id|task
comma
r_int
r_int
op_star
id|stack
)paren
(brace
r_int
r_int
id|addr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|stack
)paren
id|stack
op_assign
(paren
r_int
r_int
op_star
)paren
op_amp
id|stack
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Call Trace: &quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|kstack_end
c_func
(paren
id|stack
)paren
)paren
(brace
id|addr
op_assign
op_star
id|stack
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|__kernel_text_address
c_func
(paren
id|addr
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;[&lt;%08lx&gt;] &quot;
comma
id|addr
)paren
suffix:semicolon
id|print_symbol
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|addr
)paren
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|show_stack
r_void
id|show_stack
c_func
(paren
r_struct
id|task_struct
op_star
id|task
comma
r_int
r_int
op_star
id|sp
)paren
(brace
r_int
r_int
op_star
id|stack
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/*&n;&t; * debugging aid: &quot;show_stack(NULL);&quot; prints the&n;&t; * back trace for this cpu.&n;&t; */
r_if
c_cond
(paren
id|sp
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|task
)paren
id|sp
op_assign
(paren
r_int
r_int
op_star
)paren
id|task-&gt;thread.sp
suffix:semicolon
r_else
id|sp
op_assign
(paren
r_int
r_int
op_star
)paren
op_amp
id|sp
suffix:semicolon
)brace
id|stack
op_assign
id|sp
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|kstack_depth_to_print
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|kstack_end
c_func
(paren
id|stack
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|i
op_logical_and
(paren
(paren
id|i
op_mod
l_int|4
)paren
op_eq
l_int|0
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n       &quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%08lx &quot;
comma
op_star
id|stack
op_increment
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|show_trace
c_func
(paren
id|task
comma
id|sp
)paren
suffix:semicolon
)brace
DECL|function|dump_stack
r_void
id|dump_stack
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|stack
suffix:semicolon
id|show_trace
c_func
(paren
id|current
comma
op_amp
id|stack
)paren
suffix:semicolon
)brace
DECL|variable|dump_stack
id|EXPORT_SYMBOL
c_func
(paren
id|dump_stack
)paren
suffix:semicolon
DECL|function|show_registers
r_static
r_void
id|show_registers
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_int
id|in_kernel
op_assign
l_int|1
suffix:semicolon
r_int
r_int
id|sp
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;CPU:    %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
)paren
suffix:semicolon
id|show_regs
c_func
(paren
id|regs
)paren
suffix:semicolon
id|sp
op_assign
(paren
r_int
r_int
)paren
(paren
l_int|1
op_plus
id|regs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|user_mode
c_func
(paren
id|regs
)paren
)paren
(brace
id|in_kernel
op_assign
l_int|0
suffix:semicolon
id|sp
op_assign
id|regs-&gt;spu
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;SPU: %08lx&bslash;n&quot;
comma
id|sp
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;SPI: %08lx&bslash;n&quot;
comma
id|sp
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;Process %s (pid: %d, process nr: %d, stackpage=%08lx)&quot;
comma
id|current-&gt;comm
comma
id|current-&gt;pid
comma
l_int|0xffff
op_amp
id|i
comma
l_int|4096
op_plus
(paren
r_int
r_int
)paren
id|current
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * When in-kernel, we also print out the stack and code at the&n;&t; * time of the fault..&n;&t; */
r_if
c_cond
(paren
id|in_kernel
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;nStack: &quot;
)paren
suffix:semicolon
id|show_stack
c_func
(paren
id|current
comma
(paren
r_int
r_int
op_star
)paren
id|sp
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;nCode: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|regs-&gt;bpc
OL
id|PAGE_OFFSET
)paren
r_goto
id|bad
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|20
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_char
id|c
suffix:semicolon
r_if
c_cond
(paren
id|__get_user
c_func
(paren
id|c
comma
op_amp
(paren
(paren
r_int
r_char
op_star
)paren
id|regs-&gt;bpc
)paren
(braket
id|i
)braket
)paren
)paren
(brace
id|bad
suffix:colon
id|printk
c_func
(paren
l_string|&quot; Bad PC value.&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;%02x &quot;
comma
id|c
)paren
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|variable|die_lock
id|spinlock_t
id|die_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|function|die
r_void
id|die
c_func
(paren
r_const
r_char
op_star
id|str
comma
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|err
)paren
(brace
id|console_verbose
c_func
(paren
)paren
suffix:semicolon
id|spin_lock_irq
c_func
(paren
op_amp
id|die_lock
)paren
suffix:semicolon
id|bust_spinlocks
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: %04lx&bslash;n&quot;
comma
id|str
comma
id|err
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|show_registers
c_func
(paren
id|regs
)paren
suffix:semicolon
id|bust_spinlocks
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|die_lock
)paren
suffix:semicolon
id|do_exit
c_func
(paren
id|SIGSEGV
)paren
suffix:semicolon
)brace
DECL|function|die_if_kernel
r_static
id|__inline__
r_void
id|die_if_kernel
c_func
(paren
r_const
r_char
op_star
id|str
comma
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|err
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|user_mode
c_func
(paren
id|regs
)paren
)paren
id|die
c_func
(paren
id|str
comma
id|regs
comma
id|err
)paren
suffix:semicolon
)brace
DECL|function|do_trap
r_static
id|__inline__
r_void
id|do_trap
c_func
(paren
r_int
id|trapnr
comma
r_int
id|signr
comma
r_const
r_char
op_star
id|str
comma
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|error_code
comma
id|siginfo_t
op_star
id|info
)paren
(brace
r_if
c_cond
(paren
id|user_mode
c_func
(paren
id|regs
)paren
)paren
(brace
multiline_comment|/* trap_signal */
r_struct
id|task_struct
op_star
id|tsk
op_assign
id|current
suffix:semicolon
id|tsk-&gt;thread.error_code
op_assign
id|error_code
suffix:semicolon
id|tsk-&gt;thread.trap_no
op_assign
id|trapnr
suffix:semicolon
r_if
c_cond
(paren
id|info
)paren
id|force_sig_info
c_func
(paren
id|signr
comma
id|info
comma
id|tsk
)paren
suffix:semicolon
r_else
id|force_sig
c_func
(paren
id|signr
comma
id|tsk
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* kernel_trap */
r_if
c_cond
(paren
op_logical_neg
id|fixup_exception
c_func
(paren
id|regs
)paren
)paren
id|die
c_func
(paren
id|str
comma
id|regs
comma
id|error_code
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
DECL|macro|DO_ERROR
mdefine_line|#define DO_ERROR(trapnr, signr, str, name) &bslash;&n;asmlinkage void do_##name(struct pt_regs * regs, long error_code) &bslash;&n;{ &bslash;&n;&t;do_trap(trapnr, signr, 0, regs, error_code, NULL); &bslash;&n;}
DECL|macro|DO_ERROR_INFO
mdefine_line|#define DO_ERROR_INFO(trapnr, signr, str, name, sicode, siaddr) &bslash;&n;asmlinkage void do_##name(struct pt_regs * regs, long error_code) &bslash;&n;{ &bslash;&n;&t;siginfo_t info; &bslash;&n;&t;info.si_signo = signr; &bslash;&n;&t;info.si_errno = 0; &bslash;&n;&t;info.si_code = sicode; &bslash;&n;&t;info.si_addr = (void __user *)siaddr; &bslash;&n;&t;do_trap(trapnr, signr, str, regs, error_code, &amp;info); &bslash;&n;}
id|DO_ERROR
c_func
(paren
l_int|1
comma
id|SIGTRAP
comma
l_string|&quot;debug trap&quot;
comma
id|debug_trap
)paren
id|DO_ERROR_INFO
c_func
(paren
l_int|0x20
comma
id|SIGILL
comma
l_string|&quot;reserved instruction &quot;
comma
id|rie_handler
comma
id|ILL_ILLOPC
comma
id|regs-&gt;bpc
)paren
id|DO_ERROR_INFO
c_func
(paren
l_int|0x100
comma
id|SIGILL
comma
l_string|&quot;privilege instruction&quot;
comma
id|pie_handler
comma
id|ILL_PRVOPC
comma
id|regs-&gt;bpc
)paren
r_extern
r_int
id|handle_unaligned_access
c_func
(paren
r_int
r_int
comma
r_struct
id|pt_regs
op_star
)paren
suffix:semicolon
multiline_comment|/* This code taken from arch/sh/kernel/traps.c */
DECL|function|do_alignment_check
id|asmlinkage
r_void
id|do_alignment_check
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|error_code
)paren
(brace
id|mm_segment_t
id|oldfs
suffix:semicolon
r_int
r_int
id|insn
suffix:semicolon
r_int
id|tmp
suffix:semicolon
id|oldfs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|user_mode
c_func
(paren
id|regs
)paren
)paren
(brace
id|local_irq_enable
c_func
(paren
)paren
suffix:semicolon
id|current-&gt;thread.error_code
op_assign
id|error_code
suffix:semicolon
id|current-&gt;thread.trap_no
op_assign
l_int|0x17
suffix:semicolon
id|set_fs
c_func
(paren
id|USER_DS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|insn
comma
(paren
r_void
op_star
)paren
id|regs-&gt;bpc
comma
l_int|4
)paren
)paren
(brace
id|set_fs
c_func
(paren
id|oldfs
)paren
suffix:semicolon
r_goto
id|uspace_segv
suffix:semicolon
)brace
id|tmp
op_assign
id|handle_unaligned_access
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|oldfs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tmp
)paren
r_return
suffix:semicolon
id|uspace_segv
suffix:colon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;Killing process &bslash;&quot;%s&bslash;&quot; due to unaligned &quot;
l_string|&quot;access&bslash;n&quot;
comma
id|current-&gt;comm
)paren
suffix:semicolon
id|force_sig
c_func
(paren
id|SIGSEGV
comma
id|current
)paren
suffix:semicolon
)brace
r_else
(brace
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|insn
comma
(paren
r_void
op_star
)paren
id|regs-&gt;bpc
comma
l_int|4
)paren
)paren
(brace
id|set_fs
c_func
(paren
id|oldfs
)paren
suffix:semicolon
id|die
c_func
(paren
l_string|&quot;insn faulting in do_address_error&quot;
comma
id|regs
comma
l_int|0
)paren
suffix:semicolon
)brace
id|handle_unaligned_access
c_func
(paren
id|insn
comma
id|regs
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|oldfs
)paren
suffix:semicolon
)brace
)brace
eof
