multiline_comment|/*&n; *  linux/arch/m32r/mm/discontig.c&n; *&n; *  Discontig memory support&n; *&n; *  Copyright (c) 2003  Hitoshi Yamamoto&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/bootmem.h&gt;
macro_line|#include &lt;linux/mmzone.h&gt;
macro_line|#include &lt;linux/initrd.h&gt;
macro_line|#include &lt;asm/setup.h&gt;
r_extern
r_char
id|_end
(braket
)braket
suffix:semicolon
DECL|variable|node_data
r_struct
id|pglist_data
op_star
id|node_data
(braket
id|MAX_NUMNODES
)braket
suffix:semicolon
DECL|variable|__initdata
r_static
id|bootmem_data_t
id|node_bdata
(braket
id|MAX_NUMNODES
)braket
id|__initdata
suffix:semicolon
DECL|variable|m32r_node_data
id|pg_data_t
id|m32r_node_data
(braket
id|MAX_NUMNODES
)braket
suffix:semicolon
multiline_comment|/* Memory profile */
r_typedef
r_struct
(brace
DECL|member|start_pfn
r_int
r_int
id|start_pfn
suffix:semicolon
DECL|member|pages
r_int
r_int
id|pages
suffix:semicolon
DECL|member|holes
r_int
r_int
id|holes
suffix:semicolon
DECL|member|free_pfn
r_int
r_int
id|free_pfn
suffix:semicolon
DECL|typedef|mem_prof_t
)brace
id|mem_prof_t
suffix:semicolon
DECL|variable|mem_prof
r_static
id|mem_prof_t
id|mem_prof
(braket
id|MAX_NUMNODES
)braket
suffix:semicolon
DECL|function|mem_prof_init
r_static
r_void
id|__init
id|mem_prof_init
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|start_pfn
comma
id|holes
comma
id|free_pfn
suffix:semicolon
r_const
r_int
r_int
id|zone_alignment
op_assign
l_int|1UL
op_lshift
(paren
id|MAX_ORDER
op_minus
l_int|1
)paren
suffix:semicolon
r_int
r_int
id|ul
suffix:semicolon
id|mem_prof_t
op_star
id|mp
suffix:semicolon
multiline_comment|/* Node#0 SDRAM */
id|mp
op_assign
op_amp
id|mem_prof
(braket
l_int|0
)braket
suffix:semicolon
id|mp-&gt;start_pfn
op_assign
id|PFN_UP
c_func
(paren
id|CONFIG_MEMORY_START
)paren
suffix:semicolon
id|mp-&gt;pages
op_assign
id|PFN_DOWN
c_func
(paren
id|CONFIG_MEMORY_SIZE
)paren
suffix:semicolon
id|mp-&gt;holes
op_assign
l_int|0
suffix:semicolon
id|mp-&gt;free_pfn
op_assign
id|PFN_UP
c_func
(paren
id|__pa
c_func
(paren
id|_end
)paren
)paren
suffix:semicolon
multiline_comment|/* Node#1 internal SRAM */
id|mp
op_assign
op_amp
id|mem_prof
(braket
l_int|1
)braket
suffix:semicolon
id|start_pfn
op_assign
id|free_pfn
op_assign
id|PFN_UP
c_func
(paren
id|CONFIG_IRAM_START
)paren
suffix:semicolon
id|holes
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|start_pfn
op_amp
(paren
id|zone_alignment
op_minus
l_int|1
)paren
)paren
(brace
id|ul
op_assign
id|zone_alignment
suffix:semicolon
r_while
c_loop
(paren
id|start_pfn
op_ge
id|ul
)paren
id|ul
op_add_assign
id|zone_alignment
suffix:semicolon
id|start_pfn
op_assign
id|ul
op_minus
id|zone_alignment
suffix:semicolon
id|holes
op_assign
id|free_pfn
op_minus
id|start_pfn
suffix:semicolon
)brace
id|mp-&gt;start_pfn
op_assign
id|start_pfn
suffix:semicolon
id|mp-&gt;pages
op_assign
id|PFN_DOWN
c_func
(paren
id|CONFIG_IRAM_SIZE
)paren
op_plus
id|holes
suffix:semicolon
id|mp-&gt;holes
op_assign
id|holes
suffix:semicolon
id|mp-&gt;free_pfn
op_assign
id|PFN_UP
c_func
(paren
id|CONFIG_IRAM_START
)paren
suffix:semicolon
)brace
DECL|function|setup_memory
r_int
r_int
id|__init
id|setup_memory
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|bootmap_size
suffix:semicolon
r_int
r_int
id|min_pfn
suffix:semicolon
r_int
id|nid
suffix:semicolon
id|mem_prof_t
op_star
id|mp
suffix:semicolon
id|max_low_pfn
op_assign
l_int|0
suffix:semicolon
id|min_low_pfn
op_assign
op_minus
l_int|1
suffix:semicolon
id|mem_prof_init
c_func
(paren
)paren
suffix:semicolon
id|for_each_online_node
c_func
(paren
id|nid
)paren
(brace
id|mp
op_assign
op_amp
id|mem_prof
(braket
id|nid
)braket
suffix:semicolon
id|NODE_DATA
c_func
(paren
id|nid
)paren
op_assign
(paren
id|pg_data_t
op_star
)paren
op_amp
id|m32r_node_data
(braket
id|nid
)braket
suffix:semicolon
id|NODE_DATA
c_func
(paren
id|nid
)paren
op_member_access_from_pointer
id|bdata
op_assign
op_amp
id|node_bdata
(braket
id|nid
)braket
suffix:semicolon
id|min_pfn
op_assign
id|mp-&gt;start_pfn
suffix:semicolon
id|max_pfn
op_assign
id|mp-&gt;start_pfn
op_plus
id|mp-&gt;pages
suffix:semicolon
id|bootmap_size
op_assign
id|init_bootmem_node
c_func
(paren
id|NODE_DATA
c_func
(paren
id|nid
)paren
comma
id|mp-&gt;free_pfn
comma
id|mp-&gt;start_pfn
comma
id|max_pfn
)paren
suffix:semicolon
id|free_bootmem_node
c_func
(paren
id|NODE_DATA
c_func
(paren
id|nid
)paren
comma
id|PFN_PHYS
c_func
(paren
id|mp-&gt;start_pfn
)paren
comma
id|PFN_PHYS
c_func
(paren
id|mp-&gt;pages
)paren
)paren
suffix:semicolon
id|reserve_bootmem_node
c_func
(paren
id|NODE_DATA
c_func
(paren
id|nid
)paren
comma
id|PFN_PHYS
c_func
(paren
id|mp-&gt;start_pfn
)paren
comma
id|PFN_PHYS
c_func
(paren
id|mp-&gt;free_pfn
op_minus
id|mp-&gt;start_pfn
)paren
op_plus
id|bootmap_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|max_low_pfn
OL
id|max_pfn
)paren
id|max_low_pfn
op_assign
id|max_pfn
suffix:semicolon
r_if
c_cond
(paren
id|min_low_pfn
OG
id|min_pfn
)paren
id|min_low_pfn
op_assign
id|min_pfn
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_BLK_DEV_INITRD
r_if
c_cond
(paren
id|LOADER_TYPE
op_logical_and
id|INITRD_START
)paren
(brace
r_if
c_cond
(paren
id|INITRD_START
op_plus
id|INITRD_SIZE
op_le
id|PFN_PHYS
c_func
(paren
id|max_low_pfn
)paren
)paren
(brace
id|reserve_bootmem_node
c_func
(paren
id|NODE_DATA
c_func
(paren
l_int|0
)paren
comma
id|INITRD_START
comma
id|INITRD_SIZE
)paren
suffix:semicolon
id|initrd_start
op_assign
id|INITRD_START
ques
c_cond
id|INITRD_START
op_plus
id|PAGE_OFFSET
suffix:colon
l_int|0
suffix:semicolon
id|initrd_end
op_assign
id|initrd_start
op_plus
id|INITRD_SIZE
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;initrd:start[%08lx],size[%08lx]&bslash;n&quot;
comma
id|initrd_start
comma
id|INITRD_SIZE
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;initrd extends beyond end of memory &quot;
l_string|&quot;(0x%08lx &gt; 0x%08lx)&bslash;ndisabling initrd&bslash;n&quot;
comma
id|INITRD_START
op_plus
id|INITRD_SIZE
comma
id|PFN_PHYS
c_func
(paren
id|max_low_pfn
)paren
)paren
suffix:semicolon
id|initrd_start
op_assign
l_int|0
suffix:semicolon
)brace
)brace
macro_line|#endif&t;/* CONFIG_BLK_DEV_INITRD */
r_return
id|max_low_pfn
suffix:semicolon
)brace
DECL|macro|START_PFN
mdefine_line|#define START_PFN(nid)&t;&bslash;&n;&t;(NODE_DATA(nid)-&gt;bdata-&gt;node_boot_start &gt;&gt; PAGE_SHIFT)
DECL|macro|MAX_LOW_PFN
mdefine_line|#define MAX_LOW_PFN(nid)&t;(NODE_DATA(nid)-&gt;bdata-&gt;node_low_pfn)
DECL|function|zone_sizes_init
r_int
r_int
id|__init
id|zone_sizes_init
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|zones_size
(braket
id|MAX_NR_ZONES
)braket
comma
id|zholes_size
(braket
id|MAX_NR_ZONES
)braket
suffix:semicolon
r_int
r_int
id|low
comma
id|start_pfn
suffix:semicolon
r_int
r_int
id|holes
op_assign
l_int|0
suffix:semicolon
r_int
id|nid
comma
id|i
suffix:semicolon
id|mem_prof_t
op_star
id|mp
suffix:semicolon
id|pgdat_list
op_assign
l_int|NULL
suffix:semicolon
r_for
c_loop
(paren
id|nid
op_assign
id|num_online_nodes
c_func
(paren
)paren
op_minus
l_int|1
suffix:semicolon
id|nid
op_ge
l_int|0
suffix:semicolon
id|nid
op_decrement
)paren
(brace
id|NODE_DATA
c_func
(paren
id|nid
)paren
op_member_access_from_pointer
id|pgdat_next
op_assign
id|pgdat_list
suffix:semicolon
id|pgdat_list
op_assign
id|NODE_DATA
c_func
(paren
id|nid
)paren
suffix:semicolon
)brace
id|for_each_online_node
c_func
(paren
id|nid
)paren
(brace
id|mp
op_assign
op_amp
id|mem_prof
(braket
id|nid
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAX_NR_ZONES
suffix:semicolon
id|i
op_increment
)paren
(brace
id|zones_size
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|zholes_size
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
id|start_pfn
op_assign
id|START_PFN
c_func
(paren
id|nid
)paren
suffix:semicolon
id|low
op_assign
id|MAX_LOW_PFN
c_func
(paren
id|nid
)paren
suffix:semicolon
id|zones_size
(braket
id|ZONE_DMA
)braket
op_assign
id|low
op_minus
id|start_pfn
suffix:semicolon
id|zholes_size
(braket
id|ZONE_DMA
)braket
op_assign
id|mp-&gt;holes
suffix:semicolon
id|holes
op_add_assign
id|zholes_size
(braket
id|ZONE_DMA
)braket
suffix:semicolon
id|free_area_init_node
c_func
(paren
id|nid
comma
id|NODE_DATA
c_func
(paren
id|nid
)paren
comma
id|zones_size
comma
id|start_pfn
comma
id|zholes_size
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * For test&n;&t; *  Use all area of internal RAM.&n;&t; *  see __alloc_pages()&n;&t; */
id|NODE_DATA
c_func
(paren
l_int|1
)paren
op_member_access_from_pointer
id|node_zones-&gt;pages_min
op_assign
l_int|0
suffix:semicolon
id|NODE_DATA
c_func
(paren
l_int|1
)paren
op_member_access_from_pointer
id|node_zones-&gt;pages_low
op_assign
l_int|0
suffix:semicolon
id|NODE_DATA
c_func
(paren
l_int|1
)paren
op_member_access_from_pointer
id|node_zones-&gt;pages_high
op_assign
l_int|0
suffix:semicolon
r_return
id|holes
suffix:semicolon
)brace
eof
