multiline_comment|/*&n; *&t;linux/arch/alpha/kernel/err_ev6.c&n; *&n; *&t;Copyright (C) 2000 Jeff Wiedemeier (Compaq Computer Corporation)&n; *&n; *&t;Error handling code supporting Alpha systems&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/hwrpb.h&gt;
macro_line|#include &lt;asm/smp.h&gt;
macro_line|#include &lt;asm/err_common.h&gt;
macro_line|#include &lt;asm/err_ev6.h&gt;
macro_line|#include &quot;err_impl.h&quot;
macro_line|#include &quot;proto.h&quot;
r_static
r_int
DECL|function|ev6_parse_ibox
id|ev6_parse_ibox
c_func
(paren
id|u64
id|i_stat
comma
r_int
id|print
)paren
(brace
r_int
id|status
op_assign
id|MCHK_DISPOSITION_REPORT
suffix:semicolon
DECL|macro|EV6__I_STAT__PAR
mdefine_line|#define EV6__I_STAT__PAR&t;(1UL &lt;&lt; 29)
DECL|macro|EV6__I_STAT__ERRMASK
mdefine_line|#define EV6__I_STAT__ERRMASK&t;(EV6__I_STAT__PAR)
r_if
c_cond
(paren
op_logical_neg
(paren
id|i_stat
op_amp
id|EV6__I_STAT__ERRMASK
)paren
)paren
r_return
id|MCHK_DISPOSITION_UNKNOWN_ERROR
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|print
)paren
r_return
id|status
suffix:semicolon
r_if
c_cond
(paren
id|i_stat
op_amp
id|EV6__I_STAT__PAR
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Icache parity error&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
r_static
r_int
DECL|function|ev6_parse_mbox
id|ev6_parse_mbox
c_func
(paren
id|u64
id|mm_stat
comma
id|u64
id|d_stat
comma
id|u64
id|c_stat
comma
r_int
id|print
)paren
(brace
r_int
id|status
op_assign
id|MCHK_DISPOSITION_REPORT
suffix:semicolon
DECL|macro|EV6__MM_STAT__DC_TAG_PERR
mdefine_line|#define EV6__MM_STAT__DC_TAG_PERR&t;(1UL &lt;&lt; 10)
DECL|macro|EV6__MM_STAT__ERRMASK
mdefine_line|#define EV6__MM_STAT__ERRMASK&t;&t;(EV6__MM_STAT__DC_TAG_PERR)
DECL|macro|EV6__D_STAT__TPERR_P0
mdefine_line|#define EV6__D_STAT__TPERR_P0&t;&t;(1UL &lt;&lt; 0)
DECL|macro|EV6__D_STAT__TPERR_P1
mdefine_line|#define EV6__D_STAT__TPERR_P1&t;&t;(1UL &lt;&lt; 1)
DECL|macro|EV6__D_STAT__ECC_ERR_ST
mdefine_line|#define EV6__D_STAT__ECC_ERR_ST&t;&t;(1UL &lt;&lt; 2)
DECL|macro|EV6__D_STAT__ECC_ERR_LD
mdefine_line|#define EV6__D_STAT__ECC_ERR_LD&t;&t;(1UL &lt;&lt; 3)
DECL|macro|EV6__D_STAT__SEO
mdefine_line|#define EV6__D_STAT__SEO&t;&t;(1UL &lt;&lt; 4)
DECL|macro|EV6__D_STAT__ERRMASK
mdefine_line|#define EV6__D_STAT__ERRMASK&t;&t;(EV6__D_STAT__TPERR_P0 |&t;&bslash;&n;                                         EV6__D_STAT__TPERR_P1 | &t;&bslash;&n;                                         EV6__D_STAT__ECC_ERR_ST | &t;&bslash;&n;                                         EV6__D_STAT__ECC_ERR_LD | &t;&bslash;&n;                                         EV6__D_STAT__SEO)
r_if
c_cond
(paren
op_logical_neg
(paren
id|d_stat
op_amp
id|EV6__D_STAT__ERRMASK
)paren
op_logical_and
op_logical_neg
(paren
id|mm_stat
op_amp
id|EV6__MM_STAT__ERRMASK
)paren
)paren
r_return
id|MCHK_DISPOSITION_UNKNOWN_ERROR
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|print
)paren
r_return
id|status
suffix:semicolon
r_if
c_cond
(paren
id|mm_stat
op_amp
id|EV6__MM_STAT__DC_TAG_PERR
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Dcache tag parity error on probe&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d_stat
op_amp
id|EV6__D_STAT__TPERR_P0
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Dcache tag parity error - pipe 0&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d_stat
op_amp
id|EV6__D_STAT__TPERR_P1
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Dcache tag parity error - pipe 1&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d_stat
op_amp
id|EV6__D_STAT__ECC_ERR_ST
)paren
id|printk
c_func
(paren
l_string|&quot;%s    ECC error occurred on a store&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d_stat
op_amp
id|EV6__D_STAT__ECC_ERR_LD
)paren
id|printk
c_func
(paren
l_string|&quot;%s    ECC error occurred on a %s load&bslash;n&quot;
comma
id|err_print_prefix
comma
id|c_stat
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;speculative &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d_stat
op_amp
id|EV6__D_STAT__SEO
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Dcache second error&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
r_static
r_int
DECL|function|ev6_parse_cbox
id|ev6_parse_cbox
c_func
(paren
id|u64
id|c_addr
comma
id|u64
id|c1_syn
comma
id|u64
id|c2_syn
comma
id|u64
id|c_stat
comma
id|u64
id|c_sts
comma
r_int
id|print
)paren
(brace
r_char
op_star
id|sourcename
(braket
)braket
op_assign
(brace
l_string|&quot;UNKNOWN&quot;
comma
l_string|&quot;UNKNOWN&quot;
comma
l_string|&quot;UNKNOWN&quot;
comma
l_string|&quot;MEMORY&quot;
comma
l_string|&quot;BCACHE&quot;
comma
l_string|&quot;DCACHE&quot;
comma
l_string|&quot;BCACHE PROBE&quot;
comma
l_string|&quot;BCACHE PROBE&quot;
)brace
suffix:semicolon
r_char
op_star
id|streamname
(braket
)braket
op_assign
(brace
l_string|&quot;D&quot;
comma
l_string|&quot;I&quot;
)brace
suffix:semicolon
r_char
op_star
id|bitsname
(braket
)braket
op_assign
(brace
l_string|&quot;SINGLE&quot;
comma
l_string|&quot;DOUBLE&quot;
)brace
suffix:semicolon
r_int
id|status
op_assign
id|MCHK_DISPOSITION_REPORT
suffix:semicolon
r_int
id|source
op_assign
op_minus
l_int|1
comma
id|stream
op_assign
op_minus
l_int|1
comma
id|bits
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|macro|EV6__C_STAT__BC_PERR
mdefine_line|#define EV6__C_STAT__BC_PERR&t;&t;(0x01)
DECL|macro|EV6__C_STAT__DC_PERR
mdefine_line|#define EV6__C_STAT__DC_PERR&t;&t;(0x02)
DECL|macro|EV6__C_STAT__DSTREAM_MEM_ERR
mdefine_line|#define EV6__C_STAT__DSTREAM_MEM_ERR&t;(0x03)
DECL|macro|EV6__C_STAT__DSTREAM_BC_ERR
mdefine_line|#define EV6__C_STAT__DSTREAM_BC_ERR&t;(0x04)
DECL|macro|EV6__C_STAT__DSTREAM_DC_ERR
mdefine_line|#define EV6__C_STAT__DSTREAM_DC_ERR&t;(0x05)
DECL|macro|EV6__C_STAT__PROBE_BC_ERR0
mdefine_line|#define EV6__C_STAT__PROBE_BC_ERR0&t;(0x06)&t;/* both 6 and 7 indicate... */
DECL|macro|EV6__C_STAT__PROBE_BC_ERR1
mdefine_line|#define EV6__C_STAT__PROBE_BC_ERR1&t;(0x07)&t;/* ...probe bc error.       */
DECL|macro|EV6__C_STAT__ISTREAM_MEM_ERR
mdefine_line|#define EV6__C_STAT__ISTREAM_MEM_ERR&t;(0x0B)
DECL|macro|EV6__C_STAT__ISTREAM_BC_ERR
mdefine_line|#define EV6__C_STAT__ISTREAM_BC_ERR&t;(0x0C)
DECL|macro|EV6__C_STAT__DSTREAM_MEM_DBL
mdefine_line|#define EV6__C_STAT__DSTREAM_MEM_DBL&t;(0x13)
DECL|macro|EV6__C_STAT__DSTREAM_BC_DBL
mdefine_line|#define EV6__C_STAT__DSTREAM_BC_DBL&t;(0x14)
DECL|macro|EV6__C_STAT__ISTREAM_MEM_DBL
mdefine_line|#define EV6__C_STAT__ISTREAM_MEM_DBL&t;(0x1B)
DECL|macro|EV6__C_STAT__ISTREAM_BC_DBL
mdefine_line|#define EV6__C_STAT__ISTREAM_BC_DBL&t;(0x1C)
DECL|macro|EV6__C_STAT__SOURCE_MEMORY
mdefine_line|#define EV6__C_STAT__SOURCE_MEMORY&t;(0x03)
DECL|macro|EV6__C_STAT__SOURCE_BCACHE
mdefine_line|#define EV6__C_STAT__SOURCE_BCACHE&t;(0x04)
DECL|macro|EV6__C_STAT__SOURCE__S
mdefine_line|#define EV6__C_STAT__SOURCE__S&t;&t;(0)
DECL|macro|EV6__C_STAT__SOURCE__M
mdefine_line|#define EV6__C_STAT__SOURCE__M &t;&t;(0x07)
DECL|macro|EV6__C_STAT__ISTREAM__S
mdefine_line|#define EV6__C_STAT__ISTREAM__S&t;&t;(3)
DECL|macro|EV6__C_STAT__ISTREAM__M
mdefine_line|#define EV6__C_STAT__ISTREAM__M&t;&t;(0x01)
DECL|macro|EV6__C_STAT__DOUBLE__S
mdefine_line|#define EV6__C_STAT__DOUBLE__S&t;&t;(4)
DECL|macro|EV6__C_STAT__DOUBLE__M
mdefine_line|#define EV6__C_STAT__DOUBLE__M&t;&t;(0x01)
DECL|macro|EV6__C_STAT__ERRMASK
mdefine_line|#define EV6__C_STAT__ERRMASK&t;&t;(0x1F)
DECL|macro|EV6__C_STS__SHARED
mdefine_line|#define EV6__C_STS__SHARED&t;&t;(1 &lt;&lt; 0)
DECL|macro|EV6__C_STS__DIRTY
mdefine_line|#define EV6__C_STS__DIRTY&t;&t;(1 &lt;&lt; 1)
DECL|macro|EV6__C_STS__VALID
mdefine_line|#define EV6__C_STS__VALID&t;&t;(1 &lt;&lt; 2)
DECL|macro|EV6__C_STS__PARITY
mdefine_line|#define EV6__C_STS__PARITY&t;&t;(1 &lt;&lt; 3)
r_if
c_cond
(paren
op_logical_neg
(paren
id|c_stat
op_amp
id|EV6__C_STAT__ERRMASK
)paren
)paren
r_return
id|MCHK_DISPOSITION_UNKNOWN_ERROR
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|print
)paren
r_return
id|status
suffix:semicolon
id|source
op_assign
id|EXTRACT
c_func
(paren
id|c_stat
comma
id|EV6__C_STAT__SOURCE
)paren
suffix:semicolon
id|stream
op_assign
id|EXTRACT
c_func
(paren
id|c_stat
comma
id|EV6__C_STAT__ISTREAM
)paren
suffix:semicolon
id|bits
op_assign
id|EXTRACT
c_func
(paren
id|c_stat
comma
id|EV6__C_STAT__DOUBLE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c_stat
op_amp
id|EV6__C_STAT__BC_PERR
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s    Bcache tag parity error&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
id|source
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|c_stat
op_amp
id|EV6__C_STAT__DC_PERR
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s    Dcache tag parity error&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
id|source
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|c_stat
op_eq
id|EV6__C_STAT__PROBE_BC_ERR0
op_logical_or
id|c_stat
op_eq
id|EV6__C_STAT__PROBE_BC_ERR1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s    Bcache single-bit error on a probe hit&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
id|source
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|source
op_ne
op_minus
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;%s    %s-STREAM %s-BIT ECC error from %s&bslash;n&quot;
comma
id|err_print_prefix
comma
id|streamname
(braket
id|stream
)braket
comma
id|bitsname
(braket
id|bits
)braket
comma
id|sourcename
(braket
id|source
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s    Address: 0x%016lx&bslash;n&quot;
l_string|&quot;    Syndrome[upper.lower]: %02lx.%02lx&bslash;n&quot;
comma
id|err_print_prefix
comma
id|c_addr
comma
id|c2_syn
comma
id|c1_syn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|source
op_eq
id|EV6__C_STAT__SOURCE_MEMORY
op_logical_or
id|source
op_eq
id|EV6__C_STAT__SOURCE_BCACHE
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Block status: %s%s%s%s&bslash;n&quot;
comma
id|err_print_prefix
comma
(paren
id|c_sts
op_amp
id|EV6__C_STS__SHARED
)paren
ques
c_cond
l_string|&quot;SHARED &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|c_sts
op_amp
id|EV6__C_STS__DIRTY
)paren
ques
c_cond
l_string|&quot;DIRTY &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|c_sts
op_amp
id|EV6__C_STS__VALID
)paren
ques
c_cond
l_string|&quot;VALID &quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|c_sts
op_amp
id|EV6__C_STS__PARITY
)paren
ques
c_cond
l_string|&quot;PARITY &quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
r_void
DECL|function|ev6_register_error_handlers
id|ev6_register_error_handlers
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* None right now. */
)brace
r_int
DECL|function|ev6_process_logout_frame
id|ev6_process_logout_frame
c_func
(paren
r_struct
id|el_common
op_star
id|mchk_header
comma
r_int
id|print
)paren
(brace
r_struct
id|el_common_EV6_mcheck
op_star
id|ev6mchk
op_assign
(paren
r_struct
id|el_common_EV6_mcheck
op_star
)paren
id|mchk_header
suffix:semicolon
r_int
id|status
op_assign
id|MCHK_DISPOSITION_UNKNOWN_ERROR
suffix:semicolon
id|status
op_or_assign
id|ev6_parse_ibox
c_func
(paren
id|ev6mchk-&gt;I_STAT
comma
id|print
)paren
suffix:semicolon
id|status
op_or_assign
id|ev6_parse_mbox
c_func
(paren
id|ev6mchk-&gt;MM_STAT
comma
id|ev6mchk-&gt;DC_STAT
comma
id|ev6mchk-&gt;C_STAT
comma
id|print
)paren
suffix:semicolon
id|status
op_or_assign
id|ev6_parse_cbox
c_func
(paren
id|ev6mchk-&gt;C_ADDR
comma
id|ev6mchk-&gt;DC1_SYNDROME
comma
id|ev6mchk-&gt;DC0_SYNDROME
comma
id|ev6mchk-&gt;C_STAT
comma
id|ev6mchk-&gt;C_STS
comma
id|print
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|print
)paren
r_return
id|status
suffix:semicolon
r_if
c_cond
(paren
id|status
op_ne
id|MCHK_DISPOSITION_DISMISS
)paren
(brace
r_char
op_star
id|saved_err_prefix
op_assign
id|err_print_prefix
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Dump some additional information from the frame&n;&t;&t; */
id|printk
c_func
(paren
l_string|&quot;%s    EXC_ADDR: 0x%016lx   IER_CM: 0x%016lx&quot;
l_string|&quot;   ISUM: 0x%016lx&bslash;n&quot;
l_string|&quot;    PAL_BASE: 0x%016lx   I_CTL:  0x%016lx&quot;
l_string|&quot;   PCTX: 0x%016lx&bslash;n&quot;
comma
id|err_print_prefix
comma
id|ev6mchk-&gt;EXC_ADDR
comma
id|ev6mchk-&gt;IER_CM
comma
id|ev6mchk-&gt;ISUM
comma
id|ev6mchk-&gt;PAL_BASE
comma
id|ev6mchk-&gt;I_CTL
comma
id|ev6mchk-&gt;PCTX
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
id|MCHK_DISPOSITION_UNKNOWN_ERROR
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s    UNKNOWN error, frame follows:&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* had decode -- downgrade print level for frame */
id|err_print_prefix
op_assign
id|KERN_NOTICE
suffix:semicolon
)brace
id|mchk_dump_logout_frame
c_func
(paren
id|mchk_header
)paren
suffix:semicolon
id|err_print_prefix
op_assign
id|saved_err_prefix
suffix:semicolon
)brace
r_return
id|status
suffix:semicolon
)brace
r_void
DECL|function|ev6_machine_check
id|ev6_machine_check
c_func
(paren
id|u64
id|vector
comma
id|u64
id|la_ptr
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|el_common
op_star
id|mchk_header
op_assign
(paren
r_struct
id|el_common
op_star
)paren
id|la_ptr
suffix:semicolon
multiline_comment|/*&n;&t; * Sync the processor&n;&t; */
id|mb
c_func
(paren
)paren
suffix:semicolon
id|draina
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Parse the logout frame without printing first. If the only error(s)&n;&t; * found are have a disposition of &quot;dismiss&quot;, then just dismiss them&n;&t; * and don&squot;t print any message&n;&t; */
r_if
c_cond
(paren
id|ev6_process_logout_frame
c_func
(paren
id|mchk_header
comma
l_int|0
)paren
op_ne
id|MCHK_DISPOSITION_DISMISS
)paren
(brace
r_char
op_star
id|saved_err_prefix
op_assign
id|err_print_prefix
suffix:semicolon
id|err_print_prefix
op_assign
id|KERN_CRIT
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Either a nondismissable error was detected or no&n;&t;&t; * recognized error was detected  in the logout frame &n;&t;&t; * -- report the error in either case&n;&t;&t; */
id|printk
c_func
(paren
l_string|&quot;%s*CPU %s Error (Vector 0x%x) reported on CPU %d:&bslash;n&quot;
comma
id|err_print_prefix
comma
(paren
id|vector
op_eq
id|SCB_Q_PROCERR
)paren
ques
c_cond
l_string|&quot;Correctable&quot;
suffix:colon
l_string|&quot;Uncorrectable&quot;
comma
(paren
r_int
r_int
)paren
id|vector
comma
(paren
r_int
)paren
id|smp_processor_id
c_func
(paren
)paren
)paren
suffix:semicolon
id|ev6_process_logout_frame
c_func
(paren
id|mchk_header
comma
l_int|1
)paren
suffix:semicolon
id|dik_show_regs
c_func
(paren
id|regs
comma
l_int|NULL
)paren
suffix:semicolon
id|err_print_prefix
op_assign
id|saved_err_prefix
suffix:semicolon
)brace
multiline_comment|/* &n;&t; * Release the logout frame &n;&t; */
id|wrmces
c_func
(paren
l_int|0x7
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
)brace
eof
