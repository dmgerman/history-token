multiline_comment|/*&n; *&t;linux/arch/alpha/kernel/err_ev7.c&n; *&n; *&t;Copyright (C) 2000 Jeff Wiedemeier (Compaq Computer Corporation)&n; *&n; *&t;Error handling code supporting Alpha systems&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/hwrpb.h&gt;
macro_line|#include &lt;asm/smp.h&gt;
macro_line|#include &lt;asm/err_common.h&gt;
macro_line|#include &lt;asm/err_ev7.h&gt;
macro_line|#include &quot;err_impl.h&quot;
macro_line|#include &quot;proto.h&quot;
r_struct
id|ev7_lf_subpackets
op_star
DECL|function|ev7_collect_logout_frame_subpackets
id|ev7_collect_logout_frame_subpackets
c_func
(paren
r_struct
id|el_subpacket
op_star
id|el_ptr
comma
r_struct
id|ev7_lf_subpackets
op_star
id|lf_subpackets
)paren
(brace
r_struct
id|el_subpacket
op_star
id|subpacket
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/*&n;&t; * A Marvel machine check frame is always packaged in an&n;&t; * el_subpacket of class HEADER, type LOGOUT_FRAME.&n;&t; */
r_if
c_cond
(paren
id|el_ptr
op_member_access_from_pointer
r_class
op_ne
id|EL_CLASS__HEADER
op_logical_or
id|el_ptr-&gt;type
op_ne
id|EL_TYPE__HEADER__LOGOUT_FRAME
)paren
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;&t; * It is a logout frame header. Look at the one subpacket.&n;&t; */
id|el_ptr
op_assign
(paren
r_struct
id|el_subpacket
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|el_ptr
op_plus
id|el_ptr-&gt;length
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * It has to be class PAL, type LOGOUT_FRAME.&n;&t; */
r_if
c_cond
(paren
id|el_ptr
op_member_access_from_pointer
r_class
op_ne
id|EL_CLASS__PAL
op_logical_or
id|el_ptr-&gt;type
op_ne
id|EL_TYPE__PAL__LOGOUT_FRAME
)paren
r_return
l_int|NULL
suffix:semicolon
id|lf_subpackets-&gt;logout
op_assign
(paren
r_struct
id|ev7_pal_logout_subpacket
op_star
)paren
id|el_ptr-&gt;by_type.raw.data_start
suffix:semicolon
multiline_comment|/*&n;&t; * Process the subpackets.&n;&t; */
id|subpacket
op_assign
(paren
r_struct
id|el_subpacket
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|el_ptr
op_plus
id|el_ptr-&gt;length
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|subpacket
op_logical_and
id|i
OL
id|lf_subpackets-&gt;logout-&gt;subpacket_count
suffix:semicolon
id|subpacket
op_assign
(paren
r_struct
id|el_subpacket
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|subpacket
op_plus
id|subpacket-&gt;length
)paren
comma
id|i
op_increment
)paren
(brace
multiline_comment|/*&n;&t;&t; * All subpackets should be class PAL.&n;&t;&t; */
r_if
c_cond
(paren
id|subpacket
op_member_access_from_pointer
r_class
op_ne
id|EL_CLASS__PAL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s**UNEXPECTED SUBPACKET CLASS %d &quot;
l_string|&quot;IN LOGOUT FRAME (packet %d&bslash;n&quot;
comma
id|err_print_prefix
comma
id|subpacket
op_member_access_from_pointer
r_class
comma
id|i
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Remember the subpacket.&n;&t;&t; */
r_switch
c_cond
(paren
id|subpacket-&gt;type
)paren
(brace
r_case
id|EL_TYPE__PAL__EV7_PROCESSOR
suffix:colon
id|lf_subpackets-&gt;ev7
op_assign
(paren
r_struct
id|ev7_pal_processor_subpacket
op_star
)paren
id|subpacket-&gt;by_type.raw.data_start
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EL_TYPE__PAL__EV7_RBOX
suffix:colon
id|lf_subpackets-&gt;rbox
op_assign
(paren
r_struct
id|ev7_pal_rbox_subpacket
op_star
)paren
id|subpacket-&gt;by_type.raw.data_start
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EL_TYPE__PAL__EV7_ZBOX
suffix:colon
id|lf_subpackets-&gt;zbox
op_assign
(paren
r_struct
id|ev7_pal_zbox_subpacket
op_star
)paren
id|subpacket-&gt;by_type.raw.data_start
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EL_TYPE__PAL__EV7_IO
suffix:colon
id|lf_subpackets-&gt;io
op_assign
(paren
r_struct
id|ev7_pal_io_subpacket
op_star
)paren
id|subpacket-&gt;by_type.raw.data_start
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EL_TYPE__PAL__ENV__AMBIENT_TEMPERATURE
suffix:colon
r_case
id|EL_TYPE__PAL__ENV__AIRMOVER_FAN
suffix:colon
r_case
id|EL_TYPE__PAL__ENV__VOLTAGE
suffix:colon
r_case
id|EL_TYPE__PAL__ENV__INTRUSION
suffix:colon
r_case
id|EL_TYPE__PAL__ENV__POWER_SUPPLY
suffix:colon
r_case
id|EL_TYPE__PAL__ENV__LAN
suffix:colon
r_case
id|EL_TYPE__PAL__ENV__HOT_PLUG
suffix:colon
id|lf_subpackets-&gt;env
(braket
id|ev7_lf_env_index
c_func
(paren
id|subpacket-&gt;type
)paren
)braket
op_assign
(paren
r_struct
id|ev7_pal_environmental_subpacket
op_star
)paren
id|subpacket-&gt;by_type.raw.data_start
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * Don&squot;t know what kind of frame this is.&n;&t;&t;&t; */
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
r_return
id|lf_subpackets
suffix:semicolon
)brace
r_void
DECL|function|ev7_machine_check
id|ev7_machine_check
c_func
(paren
id|u64
id|vector
comma
id|u64
id|la_ptr
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|el_subpacket
op_star
id|el_ptr
op_assign
(paren
r_struct
id|el_subpacket
op_star
)paren
id|la_ptr
suffix:semicolon
r_char
op_star
id|saved_err_prefix
op_assign
id|err_print_prefix
suffix:semicolon
multiline_comment|/*&n;&t; * Sync the processor&n;&t; */
id|mb
c_func
(paren
)paren
suffix:semicolon
id|draina
c_func
(paren
)paren
suffix:semicolon
id|err_print_prefix
op_assign
id|KERN_CRIT
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s*CPU %s Error (Vector 0x%x) reported on CPU %d&bslash;n&quot;
comma
id|err_print_prefix
comma
(paren
id|vector
op_eq
id|SCB_Q_PROCERR
)paren
ques
c_cond
l_string|&quot;Correctable&quot;
suffix:colon
l_string|&quot;Uncorrectable&quot;
comma
(paren
r_int
r_int
)paren
id|vector
comma
(paren
r_int
)paren
id|smp_processor_id
c_func
(paren
)paren
)paren
suffix:semicolon
id|el_process_subpacket
c_func
(paren
id|el_ptr
)paren
suffix:semicolon
id|err_print_prefix
op_assign
id|saved_err_prefix
suffix:semicolon
multiline_comment|/* &n;&t; * Release the logout frame &n;&t; */
id|wrmces
c_func
(paren
l_int|0x7
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|el_ev7_processor_subpacket_annotation
r_static
r_char
op_star
id|el_ev7_processor_subpacket_annotation
(braket
)braket
op_assign
(brace
l_string|&quot;Subpacket Header&quot;
comma
l_string|&quot;I_STAT&quot;
comma
l_string|&quot;DC_STAT&quot;
comma
l_string|&quot;C_ADDR&quot;
comma
l_string|&quot;C_SYNDROME_1&quot;
comma
l_string|&quot;C_SYNDROME_0&quot;
comma
l_string|&quot;C_STAT&quot;
comma
l_string|&quot;C_STS&quot;
comma
l_string|&quot;MM_STAT&quot;
comma
l_string|&quot;EXC_ADDR&quot;
comma
l_string|&quot;IER_CM&quot;
comma
l_string|&quot;ISUM&quot;
comma
l_string|&quot;PAL_BASE&quot;
comma
l_string|&quot;I_CTL&quot;
comma
l_string|&quot;PROCESS_CONTEXT&quot;
comma
l_string|&quot;CBOX_CTL&quot;
comma
l_string|&quot;CBOX_STP_CTL&quot;
comma
l_string|&quot;CBOX_ACC_CTL&quot;
comma
l_string|&quot;CBOX_LCL_SET&quot;
comma
l_string|&quot;CBOX_GLB_SET&quot;
comma
l_string|&quot;BBOX_CTL&quot;
comma
l_string|&quot;BBOX_ERR_STS&quot;
comma
l_string|&quot;BBOX_ERR_IDX&quot;
comma
l_string|&quot;CBOX_DDP_ERR_STS&quot;
comma
l_string|&quot;BBOX_DAT_RMP&quot;
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|el_ev7_zbox_subpacket_annotation
r_static
r_char
op_star
id|el_ev7_zbox_subpacket_annotation
(braket
)braket
op_assign
(brace
l_string|&quot;Subpacket Header&quot;
comma
l_string|&quot;ZBOX(0): DRAM_ERR_STATUS_2 / DRAM_ERR_STATUS_1&quot;
comma
l_string|&quot;ZBOX(0): DRAM_ERROR_CTL    / DRAM_ERR_STATUS_3&quot;
comma
l_string|&quot;ZBOX(0): DIFT_TIMEOUT      / DRAM_ERR_ADR&quot;
comma
l_string|&quot;ZBOX(0): FRC_ERR_ADR       / DRAM_MAPPER_CTL&quot;
comma
l_string|&quot;ZBOX(0): reserved          / DIFT_ERR_STATUS&quot;
comma
l_string|&quot;ZBOX(1): DRAM_ERR_STATUS_2 / DRAM_ERR_STATUS_1&quot;
comma
l_string|&quot;ZBOX(1): DRAM_ERROR_CTL    / DRAM_ERR_STATUS_3&quot;
comma
l_string|&quot;ZBOX(1): DIFT_TIMEOUT      / DRAM_ERR_ADR&quot;
comma
l_string|&quot;ZBOX(1): FRC_ERR_ADR       / DRAM_MAPPER_CTL&quot;
comma
l_string|&quot;ZBOX(1): reserved          / DIFT_ERR_STATUS&quot;
comma
l_string|&quot;CBOX_CTL&quot;
comma
l_string|&quot;CBOX_STP_CTL&quot;
comma
l_string|&quot;ZBOX(0)_ERROR_PA&quot;
comma
l_string|&quot;ZBOX(1)_ERROR_PA&quot;
comma
l_string|&quot;ZBOX(0)_ORED_SYNDROME&quot;
comma
l_string|&quot;ZBOX(1)_ORED_SYNDROME&quot;
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|el_ev7_rbox_subpacket_annotation
r_static
r_char
op_star
id|el_ev7_rbox_subpacket_annotation
(braket
)braket
op_assign
(brace
l_string|&quot;Subpacket Header&quot;
comma
l_string|&quot;RBOX_CFG&quot;
comma
l_string|&quot;RBOX_N_CFG&quot;
comma
l_string|&quot;RBOX_S_CFG&quot;
comma
l_string|&quot;RBOX_E_CFG&quot;
comma
l_string|&quot;RBOX_W_CFG&quot;
comma
l_string|&quot;RBOX_N_ERR&quot;
comma
l_string|&quot;RBOX_S_ERR&quot;
comma
l_string|&quot;RBOX_E_ERR&quot;
comma
l_string|&quot;RBOX_W_ERR&quot;
comma
l_string|&quot;RBOX_IO_CFG&quot;
comma
l_string|&quot;RBOX_IO_ERR&quot;
comma
l_string|&quot;RBOX_L_ERR&quot;
comma
l_string|&quot;RBOX_WHOAMI&quot;
comma
l_string|&quot;RBOX_IMASL&quot;
comma
l_string|&quot;RBOX_INTQ&quot;
comma
l_string|&quot;RBOX_INT&quot;
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|el_ev7_io_subpacket_annotation
r_static
r_char
op_star
id|el_ev7_io_subpacket_annotation
(braket
)braket
op_assign
(brace
l_string|&quot;Subpacket Header&quot;
comma
l_string|&quot;IO_ASIC_REV&quot;
comma
l_string|&quot;IO_SYS_REV&quot;
comma
l_string|&quot;IO7_UPH&quot;
comma
l_string|&quot;HPI_CTL&quot;
comma
l_string|&quot;CRD_CTL&quot;
comma
l_string|&quot;HEI_CTL&quot;
comma
l_string|&quot;PO7_ERROR_SUM&quot;
comma
l_string|&quot;PO7_UNCRR_SYM&quot;
comma
l_string|&quot;PO7_CRRCT_SYM&quot;
comma
l_string|&quot;PO7_UGBGE_SYM&quot;
comma
l_string|&quot;PO7_ERR_PKT0&quot;
comma
l_string|&quot;PO7_ERR_PKT1&quot;
comma
l_string|&quot;reserved&quot;
comma
l_string|&quot;reserved&quot;
comma
l_string|&quot;PO0_ERR_SUM&quot;
comma
l_string|&quot;PO0_TLB_ERR&quot;
comma
l_string|&quot;PO0_SPL_COMPLT&quot;
comma
l_string|&quot;PO0_TRANS_SUM&quot;
comma
l_string|&quot;PO0_FIRST_ERR&quot;
comma
l_string|&quot;PO0_MULT_ERR&quot;
comma
l_string|&quot;DM CSR PH&quot;
comma
l_string|&quot;DM CSR PH&quot;
comma
l_string|&quot;DM CSR PH&quot;
comma
l_string|&quot;DM CSR PH&quot;
comma
l_string|&quot;reserved&quot;
comma
l_string|&quot;PO1_ERR_SUM&quot;
comma
l_string|&quot;PO1_TLB_ERR&quot;
comma
l_string|&quot;PO1_SPL_COMPLT&quot;
comma
l_string|&quot;PO1_TRANS_SUM&quot;
comma
l_string|&quot;PO1_FIRST_ERR&quot;
comma
l_string|&quot;PO1_MULT_ERR&quot;
comma
l_string|&quot;DM CSR PH&quot;
comma
l_string|&quot;DM CSR PH&quot;
comma
l_string|&quot;DM CSR PH&quot;
comma
l_string|&quot;DM CSR PH&quot;
comma
l_string|&quot;reserved&quot;
comma
l_string|&quot;PO2_ERR_SUM&quot;
comma
l_string|&quot;PO2_TLB_ERR&quot;
comma
l_string|&quot;PO2_SPL_COMPLT&quot;
comma
l_string|&quot;PO2_TRANS_SUM&quot;
comma
l_string|&quot;PO2_FIRST_ERR&quot;
comma
l_string|&quot;PO2_MULT_ERR&quot;
comma
l_string|&quot;DM CSR PH&quot;
comma
l_string|&quot;DM CSR PH&quot;
comma
l_string|&quot;DM CSR PH&quot;
comma
l_string|&quot;DM CSR PH&quot;
comma
l_string|&quot;reserved&quot;
comma
l_string|&quot;PO3_ERR_SUM&quot;
comma
l_string|&quot;PO3_TLB_ERR&quot;
comma
l_string|&quot;PO3_SPL_COMPLT&quot;
comma
l_string|&quot;PO3_TRANS_SUM&quot;
comma
l_string|&quot;PO3_FIRST_ERR&quot;
comma
l_string|&quot;PO3_MULT_ERR&quot;
comma
l_string|&quot;DM CSR PH&quot;
comma
l_string|&quot;DM CSR PH&quot;
comma
l_string|&quot;DM CSR PH&quot;
comma
l_string|&quot;DM CSR PH&quot;
comma
l_string|&quot;reserved&quot;
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|el_ev7_pal_annotations
r_static
r_struct
id|el_subpacket_annotation
id|el_ev7_pal_annotations
(braket
)braket
op_assign
(brace
id|SUBPACKET_ANNOTATION
c_func
(paren
id|EL_CLASS__PAL
comma
id|EL_TYPE__PAL__EV7_PROCESSOR
comma
l_int|1
comma
l_string|&quot;EV7 Processor Subpacket&quot;
comma
id|el_ev7_processor_subpacket_annotation
)paren
comma
id|SUBPACKET_ANNOTATION
c_func
(paren
id|EL_CLASS__PAL
comma
id|EL_TYPE__PAL__EV7_ZBOX
comma
l_int|1
comma
l_string|&quot;EV7 ZBOX Subpacket&quot;
comma
id|el_ev7_zbox_subpacket_annotation
)paren
comma
id|SUBPACKET_ANNOTATION
c_func
(paren
id|EL_CLASS__PAL
comma
id|EL_TYPE__PAL__EV7_RBOX
comma
l_int|1
comma
l_string|&quot;EV7 RBOX Subpacket&quot;
comma
id|el_ev7_rbox_subpacket_annotation
)paren
comma
id|SUBPACKET_ANNOTATION
c_func
(paren
id|EL_CLASS__PAL
comma
id|EL_TYPE__PAL__EV7_IO
comma
l_int|1
comma
l_string|&quot;EV7 IO Subpacket&quot;
comma
id|el_ev7_io_subpacket_annotation
)paren
)brace
suffix:semicolon
r_static
r_struct
id|el_subpacket
op_star
DECL|function|ev7_process_pal_subpacket
id|ev7_process_pal_subpacket
c_func
(paren
r_struct
id|el_subpacket
op_star
id|header
)paren
(brace
r_struct
id|ev7_pal_subpacket
op_star
id|packet
suffix:semicolon
r_if
c_cond
(paren
id|header
op_member_access_from_pointer
r_class
op_ne
id|EL_CLASS__PAL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s  ** Unexpected header CLASS %d TYPE %d, aborting&bslash;n&quot;
comma
id|err_print_prefix
comma
id|header
op_member_access_from_pointer
r_class
comma
id|header-&gt;type
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|packet
op_assign
(paren
r_struct
id|ev7_pal_subpacket
op_star
)paren
id|header-&gt;by_type.raw.data_start
suffix:semicolon
r_switch
c_cond
(paren
id|header-&gt;type
)paren
(brace
r_case
id|EL_TYPE__PAL__LOGOUT_FRAME
suffix:colon
id|printk
c_func
(paren
l_string|&quot;%s*** MCHK occurred on LPID %ld (RBOX %lx)&bslash;n&quot;
comma
id|err_print_prefix
comma
id|packet-&gt;by_type.logout.whami
comma
id|packet-&gt;by_type.logout.rbox_whami
)paren
suffix:semicolon
id|el_print_timestamp
c_func
(paren
op_amp
id|packet-&gt;by_type.logout.timestamp
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s  EXC_ADDR: %016lx&bslash;n&quot;
l_string|&quot;  HALT_CODE: %lx&bslash;n&quot;
comma
id|err_print_prefix
comma
id|packet-&gt;by_type.logout.exc_addr
comma
id|packet-&gt;by_type.logout.halt_code
)paren
suffix:semicolon
id|el_process_subpackets
c_func
(paren
id|header
comma
id|packet-&gt;by_type.logout.subpacket_count
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;%s  ** PAL TYPE %d SUBPACKET&bslash;n&quot;
comma
id|err_print_prefix
comma
id|header-&gt;type
)paren
suffix:semicolon
id|el_annotate_subpacket
c_func
(paren
id|header
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
(paren
r_struct
id|el_subpacket
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|header
op_plus
id|header-&gt;length
)paren
suffix:semicolon
)brace
DECL|variable|ev7_pal_subpacket_handler
r_struct
id|el_subpacket_handler
id|ev7_pal_subpacket_handler
op_assign
id|SUBPACKET_HANDLER_INIT
c_func
(paren
id|EL_CLASS__PAL
comma
id|ev7_process_pal_subpacket
)paren
suffix:semicolon
r_void
DECL|function|ev7_register_error_handlers
id|ev7_register_error_handlers
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|el_ev7_pal_annotations
)paren
op_div
r_sizeof
(paren
id|el_ev7_pal_annotations
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cdl_register_subpacket_annotation
c_func
(paren
op_amp
id|el_ev7_pal_annotations
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|cdl_register_subpacket_handler
c_func
(paren
op_amp
id|ev7_pal_subpacket_handler
)paren
suffix:semicolon
)brace
eof
