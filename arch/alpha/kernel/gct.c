macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;asm/hwrpb.h&gt;
macro_line|#include &lt;asm/gct.h&gt;
r_int
DECL|function|gct6_find_nodes
id|gct6_find_nodes
c_func
(paren
id|gct6_node
op_star
id|node
comma
id|gct6_search_struct
op_star
id|search
)paren
(brace
id|gct6_search_struct
op_star
id|wanted
suffix:semicolon
r_int
id|status
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* first check the magic number */
r_if
c_cond
(paren
id|node-&gt;magic
op_ne
id|GCT_NODE_MAGIC
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;GCT Node MAGIC incorrect - GCT invalid&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* check against the search struct */
r_for
c_loop
(paren
id|wanted
op_assign
id|search
suffix:semicolon
id|wanted
op_logical_and
(paren
id|wanted-&gt;type
op_or
id|wanted-&gt;subtype
)paren
suffix:semicolon
id|wanted
op_increment
)paren
(brace
r_if
c_cond
(paren
id|node-&gt;type
op_ne
id|wanted-&gt;type
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|node-&gt;subtype
op_ne
id|wanted-&gt;subtype
)paren
r_continue
suffix:semicolon
multiline_comment|/* found it -- call out */
r_if
c_cond
(paren
id|wanted-&gt;callout
)paren
id|wanted
op_member_access_from_pointer
id|callout
c_func
(paren
id|node
)paren
suffix:semicolon
)brace
multiline_comment|/* now walk the tree, siblings first.. */
r_if
c_cond
(paren
id|node-&gt;next
)paren
id|status
op_or_assign
id|gct6_find_nodes
c_func
(paren
id|GCT_NODE_PTR
c_func
(paren
id|node-&gt;next
)paren
comma
id|search
)paren
suffix:semicolon
multiline_comment|/* then the children */
r_if
c_cond
(paren
id|node-&gt;child
)paren
id|status
op_or_assign
id|gct6_find_nodes
c_func
(paren
id|GCT_NODE_PTR
c_func
(paren
id|node-&gt;child
)paren
comma
id|search
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
eof
