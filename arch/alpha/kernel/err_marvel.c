multiline_comment|/*&n; *&t;linux/arch/alpha/kernel/err_marvel.c&n; *&n; *&t;Copyright (C) 2001 Jeff Wiedemeier (Compaq Computer Corporation)&n; *&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/console.h&gt;
macro_line|#include &lt;asm/core_marvel.h&gt;
macro_line|#include &lt;asm/hwrpb.h&gt;
macro_line|#include &lt;asm/smp.h&gt;
macro_line|#include &lt;asm/err_common.h&gt;
macro_line|#include &lt;asm/err_ev7.h&gt;
macro_line|#include &quot;err_impl.h&quot;
macro_line|#include &quot;proto.h&quot;
r_static
r_void
DECL|function|marvel_print_680_frame
id|marvel_print_680_frame
c_func
(paren
r_struct
id|ev7_lf_subpackets
op_star
id|lf_subpackets
)paren
(brace
macro_line|#ifdef CONFIG_VERBOSE_MCHECK
r_struct
id|ev7_pal_environmental_subpacket
op_star
id|env
suffix:semicolon
r_struct
(brace
r_int
id|type
suffix:semicolon
r_char
op_star
id|name
suffix:semicolon
)brace
id|ev_packets
(braket
)braket
op_assign
(brace
(brace
id|EL_TYPE__PAL__ENV__AMBIENT_TEMPERATURE
comma
l_string|&quot;Ambient Temperature&quot;
)brace
comma
(brace
id|EL_TYPE__PAL__ENV__AIRMOVER_FAN
comma
l_string|&quot;AirMover / Fan&quot;
)brace
comma
(brace
id|EL_TYPE__PAL__ENV__VOLTAGE
comma
l_string|&quot;Voltage&quot;
)brace
comma
(brace
id|EL_TYPE__PAL__ENV__INTRUSION
comma
l_string|&quot;Intrusion&quot;
)brace
comma
(brace
id|EL_TYPE__PAL__ENV__POWER_SUPPLY
comma
l_string|&quot;Power Supply&quot;
)brace
comma
(brace
id|EL_TYPE__PAL__ENV__LAN
comma
l_string|&quot;LAN&quot;
)brace
comma
(brace
id|EL_TYPE__PAL__ENV__HOT_PLUG
comma
l_string|&quot;Hot Plug&quot;
)brace
comma
(brace
l_int|0
comma
l_int|NULL
)brace
)brace
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|ev_packets
(braket
id|i
)braket
dot
id|type
op_ne
l_int|0
suffix:semicolon
id|i
op_increment
)paren
(brace
id|env
op_assign
id|lf_subpackets-&gt;env
(braket
id|ev7_lf_env_index
c_func
(paren
id|ev_packets
(braket
id|i
)braket
dot
id|type
)paren
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|env
)paren
r_continue
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s**%s event (cabinet %d, drawer %d)&bslash;n&quot;
comma
id|err_print_prefix
comma
id|ev_packets
(braket
id|i
)braket
dot
id|name
comma
id|env-&gt;cabinet
comma
id|env-&gt;drawer
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s   Module Type: 0x%x - Unit ID 0x%x - &quot;
l_string|&quot;Condition 0x%x&bslash;n&quot;
comma
id|err_print_prefix
comma
id|env-&gt;module_type
comma
id|env-&gt;unit_id
comma
id|env-&gt;condition
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_VERBOSE_MCHECK */
)brace
r_static
r_int
DECL|function|marvel_process_680_frame
id|marvel_process_680_frame
c_func
(paren
r_struct
id|ev7_lf_subpackets
op_star
id|lf_subpackets
comma
r_int
id|print
)paren
(brace
r_int
id|status
op_assign
id|MCHK_DISPOSITION_UNKNOWN_ERROR
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|ev7_lf_env_index
c_func
(paren
id|EL_TYPE__PAL__ENV__AMBIENT_TEMPERATURE
)paren
suffix:semicolon
id|i
op_le
id|ev7_lf_env_index
c_func
(paren
id|EL_TYPE__PAL__ENV__HOT_PLUG
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|lf_subpackets-&gt;env
(braket
id|i
)braket
)paren
id|status
op_assign
id|MCHK_DISPOSITION_REPORT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|print
)paren
id|marvel_print_680_frame
c_func
(paren
id|lf_subpackets
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_VERBOSE_MCHECK
r_static
r_void
DECL|function|marvel_print_err_cyc
id|marvel_print_err_cyc
c_func
(paren
id|u64
id|err_cyc
)paren
(brace
r_static
r_char
op_star
id|packet_desc
(braket
)braket
op_assign
(brace
l_string|&quot;No Error&quot;
comma
l_string|&quot;UNKNOWN&quot;
comma
l_string|&quot;1 cycle (1 or 2 flit packet)&quot;
comma
l_string|&quot;2 cycles (3 flit packet)&quot;
comma
l_string|&quot;9 cycles (18 flit packet)&quot;
comma
l_string|&quot;10 cycles (19 flit packet)&quot;
comma
l_string|&quot;UNKNOWN&quot;
comma
l_string|&quot;UNKNOWN&quot;
comma
l_string|&quot;UNKNOWN&quot;
)brace
suffix:semicolon
DECL|macro|IO7__ERR_CYC__ODD_FLT
mdefine_line|#define IO7__ERR_CYC__ODD_FLT&t;(1UL &lt;&lt;  0)
DECL|macro|IO7__ERR_CYC__EVN_FLT
mdefine_line|#define IO7__ERR_CYC__EVN_FLT&t;(1UL &lt;&lt;  1)
DECL|macro|IO7__ERR_CYC__PACKET__S
mdefine_line|#define IO7__ERR_CYC__PACKET__S&t;(6)
DECL|macro|IO7__ERR_CYC__PACKET__M
mdefine_line|#define IO7__ERR_CYC__PACKET__M&t;(0x7)
DECL|macro|IO7__ERR_CYC__LOC
mdefine_line|#define IO7__ERR_CYC__LOC&t;(1UL &lt;&lt;  5)
DECL|macro|IO7__ERR_CYC__CYCLE__S
mdefine_line|#define IO7__ERR_CYC__CYCLE__S&t;(2)
DECL|macro|IO7__ERR_CYC__CYCLE__M
mdefine_line|#define IO7__ERR_CYC__CYCLE__M&t;(0x7)
id|printk
c_func
(paren
l_string|&quot;%s        Packet In Error: %s&bslash;n&quot;
l_string|&quot;%s        Error in %s, cycle %ld%s%s&bslash;n&quot;
comma
id|err_print_prefix
comma
id|packet_desc
(braket
id|EXTRACT
c_func
(paren
id|err_cyc
comma
id|IO7__ERR_CYC__PACKET
)paren
)braket
comma
id|err_print_prefix
comma
(paren
id|err_cyc
op_amp
id|IO7__ERR_CYC__LOC
)paren
ques
c_cond
l_string|&quot;DATA&quot;
suffix:colon
l_string|&quot;HEADER&quot;
comma
id|EXTRACT
c_func
(paren
id|err_cyc
comma
id|IO7__ERR_CYC__CYCLE
)paren
comma
(paren
id|err_cyc
op_amp
id|IO7__ERR_CYC__ODD_FLT
)paren
ques
c_cond
l_string|&quot; [ODD Flit]&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|err_cyc
op_amp
id|IO7__ERR_CYC__EVN_FLT
)paren
ques
c_cond
l_string|&quot; [Even Flit]&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|marvel_print_po7_crrct_sym
id|marvel_print_po7_crrct_sym
c_func
(paren
id|u64
id|crrct_sym
)paren
(brace
DECL|macro|IO7__PO7_CRRCT_SYM__SYN__S
mdefine_line|#define IO7__PO7_CRRCT_SYM__SYN__S&t;(0)
DECL|macro|IO7__PO7_CRRCT_SYM__SYN__M
mdefine_line|#define IO7__PO7_CRRCT_SYM__SYN__M&t;(0x7f)
DECL|macro|IO7__PO7_CRRCT_SYM__ERR_CYC__S
mdefine_line|#define IO7__PO7_CRRCT_SYM__ERR_CYC__S&t;(7)   /* ERR_CYC + ODD_FLT + EVN_FLT */
DECL|macro|IO7__PO7_CRRCT_SYM__ERR_CYC__M
mdefine_line|#define IO7__PO7_CRRCT_SYM__ERR_CYC__M&t;(0x1ff)
id|printk
c_func
(paren
l_string|&quot;%s      Correctable Error Symptoms:&bslash;n&quot;
l_string|&quot;%s        Syndrome: 0x%lx&bslash;n&quot;
comma
id|err_print_prefix
comma
id|err_print_prefix
comma
id|EXTRACT
c_func
(paren
id|crrct_sym
comma
id|IO7__PO7_CRRCT_SYM__SYN
)paren
)paren
suffix:semicolon
id|marvel_print_err_cyc
c_func
(paren
id|EXTRACT
c_func
(paren
id|crrct_sym
comma
id|IO7__PO7_CRRCT_SYM__ERR_CYC
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|marvel_print_po7_uncrr_sym
id|marvel_print_po7_uncrr_sym
c_func
(paren
id|u64
id|uncrr_sym
comma
id|u64
id|valid_mask
)paren
(brace
r_static
r_char
op_star
id|clk_names
(braket
)braket
op_assign
(brace
l_string|&quot;_h[0]&quot;
comma
l_string|&quot;_h[1]&quot;
comma
l_string|&quot;_n[0]&quot;
comma
l_string|&quot;_n[1]&quot;
)brace
suffix:semicolon
r_static
r_char
op_star
id|clk_decode
(braket
)braket
op_assign
(brace
l_string|&quot;No Error&quot;
comma
l_string|&quot;One extra rising edge&quot;
comma
l_string|&quot;Two extra rising edges&quot;
comma
l_string|&quot;Lost one clock&quot;
)brace
suffix:semicolon
r_static
r_char
op_star
id|port_names
(braket
)braket
op_assign
(brace
l_string|&quot;Port 0&quot;
comma
l_string|&quot;Port 1&quot;
comma
l_string|&quot;Port 2&quot;
comma
l_string|&quot;Port 3&quot;
comma
l_string|&quot;Unknown Port&quot;
comma
l_string|&quot;Unknown Port&quot;
comma
l_string|&quot;Unknown Port&quot;
comma
l_string|&quot;Port 7&quot;
)brace
suffix:semicolon
r_int
id|scratch
comma
id|i
suffix:semicolon
DECL|macro|IO7__PO7_UNCRR_SYM__SYN__S
mdefine_line|#define IO7__PO7_UNCRR_SYM__SYN__S&t;    (0)
DECL|macro|IO7__PO7_UNCRR_SYM__SYN__M
mdefine_line|#define IO7__PO7_UNCRR_SYM__SYN__M&t;    (0x7f)
DECL|macro|IO7__PO7_UNCRR_SYM__ERR_CYC__S
mdefine_line|#define IO7__PO7_UNCRR_SYM__ERR_CYC__S&t;    (7)      /* ERR_CYC + ODD_FLT... */
DECL|macro|IO7__PO7_UNCRR_SYM__ERR_CYC__M
mdefine_line|#define IO7__PO7_UNCRR_SYM__ERR_CYC__M&t;    (0x1ff)  /* ... + EVN_FLT        */
DECL|macro|IO7__PO7_UNCRR_SYM__CLK__S
mdefine_line|#define IO7__PO7_UNCRR_SYM__CLK__S&t;    (16)
DECL|macro|IO7__PO7_UNCRR_SYM__CLK__M
mdefine_line|#define IO7__PO7_UNCRR_SYM__CLK__M&t;    (0xff)
DECL|macro|IO7__PO7_UNCRR_SYM__CDT_OVF_TO__REQ
mdefine_line|#define IO7__PO7_UNCRR_SYM__CDT_OVF_TO__REQ (1UL &lt;&lt; 24)
DECL|macro|IO7__PO7_UNCRR_SYM__CDT_OVF_TO__RIO
mdefine_line|#define IO7__PO7_UNCRR_SYM__CDT_OVF_TO__RIO (1UL &lt;&lt; 25)
DECL|macro|IO7__PO7_UNCRR_SYM__CDT_OVF_TO__WIO
mdefine_line|#define IO7__PO7_UNCRR_SYM__CDT_OVF_TO__WIO (1UL &lt;&lt; 26)
DECL|macro|IO7__PO7_UNCRR_SYM__CDT_OVF_TO__BLK
mdefine_line|#define IO7__PO7_UNCRR_SYM__CDT_OVF_TO__BLK (1UL &lt;&lt; 27)
DECL|macro|IO7__PO7_UNCRR_SYM__CDT_OVF_TO__NBK
mdefine_line|#define IO7__PO7_UNCRR_SYM__CDT_OVF_TO__NBK (1UL &lt;&lt; 28)
DECL|macro|IO7__PO7_UNCRR_SYM__OVF__READIO
mdefine_line|#define IO7__PO7_UNCRR_SYM__OVF__READIO&t;    (1UL &lt;&lt; 29)
DECL|macro|IO7__PO7_UNCRR_SYM__OVF__WRITEIO
mdefine_line|#define IO7__PO7_UNCRR_SYM__OVF__WRITEIO    (1UL &lt;&lt; 30)
DECL|macro|IO7__PO7_UNCRR_SYM__OVF__FWD
mdefine_line|#define IO7__PO7_UNCRR_SYM__OVF__FWD        (1UL &lt;&lt; 31)
DECL|macro|IO7__PO7_UNCRR_SYM__VICTIM_SP__S
mdefine_line|#define IO7__PO7_UNCRR_SYM__VICTIM_SP__S    (32)
DECL|macro|IO7__PO7_UNCRR_SYM__VICTIM_SP__M
mdefine_line|#define IO7__PO7_UNCRR_SYM__VICTIM_SP__M    (0xff)
DECL|macro|IO7__PO7_UNCRR_SYM__DETECT_SP__S
mdefine_line|#define IO7__PO7_UNCRR_SYM__DETECT_SP__S    (40)
DECL|macro|IO7__PO7_UNCRR_SYM__DETECT_SP__M
mdefine_line|#define IO7__PO7_UNCRR_SYM__DETECT_SP__M    (0xff)
DECL|macro|IO7__PO7_UNCRR_SYM__STRV_VTR__S
mdefine_line|#define IO7__PO7_UNCRR_SYM__STRV_VTR__S     (48)
DECL|macro|IO7__PO7_UNCRR_SYM__STRV_VTR__M
mdefine_line|#define IO7__PO7_UNCRR_SYM__STRV_VTR__M     (0x3ff)
DECL|macro|IO7__STRV_VTR__LSI__INTX__S
mdefine_line|#define IO7__STRV_VTR__LSI__INTX__S&t;    (0)
DECL|macro|IO7__STRV_VTR__LSI__INTX__M
mdefine_line|#define IO7__STRV_VTR__LSI__INTX__M&t;    (0x3)
DECL|macro|IO7__STRV_VTR__LSI__SLOT__S
mdefine_line|#define IO7__STRV_VTR__LSI__SLOT__S&t;    (2)
DECL|macro|IO7__STRV_VTR__LSI__SLOT__M
mdefine_line|#define IO7__STRV_VTR__LSI__SLOT__M&t;    (0x7)
DECL|macro|IO7__STRV_VTR__LSI__BUS__S
mdefine_line|#define IO7__STRV_VTR__LSI__BUS__S&t;    (5)
DECL|macro|IO7__STRV_VTR__LSI__BUS__M
mdefine_line|#define IO7__STRV_VTR__LSI__BUS__M&t;    (0x3)
DECL|macro|IO7__STRV_VTR__MSI__INTNUM__S
mdefine_line|#define IO7__STRV_VTR__MSI__INTNUM__S&t;    (0)
DECL|macro|IO7__STRV_VTR__MSI__INTNUM__M
mdefine_line|#define IO7__STRV_VTR__MSI__INTNUM__M&t;    (0x1ff)
DECL|macro|IO7__STRV_VTR__IS_MSI
mdefine_line|#define IO7__STRV_VTR__IS_MSI&t;&t;    (1UL &lt;&lt; 9)
id|printk
c_func
(paren
l_string|&quot;%s      Uncorrectable Error Symptoms:&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
id|uncrr_sym
op_and_assign
id|valid_mask
suffix:semicolon
r_if
c_cond
(paren
id|EXTRACT
c_func
(paren
id|valid_mask
comma
id|IO7__PO7_UNCRR_SYM__SYN
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;%s        Syndrome: 0x%lx&bslash;n&quot;
comma
id|err_print_prefix
comma
id|EXTRACT
c_func
(paren
id|uncrr_sym
comma
id|IO7__PO7_UNCRR_SYM__SYN
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|EXTRACT
c_func
(paren
id|valid_mask
comma
id|IO7__PO7_UNCRR_SYM__ERR_CYC
)paren
)paren
id|marvel_print_err_cyc
c_func
(paren
id|EXTRACT
c_func
(paren
id|uncrr_sym
comma
id|IO7__PO7_UNCRR_SYM__ERR_CYC
)paren
)paren
suffix:semicolon
id|scratch
op_assign
id|EXTRACT
c_func
(paren
id|uncrr_sym
comma
id|IO7__PO7_UNCRR_SYM__CLK
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
comma
id|scratch
op_rshift_assign
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|scratch
op_amp
l_int|0x3
)paren
id|printk
c_func
(paren
l_string|&quot;%s        Clock %s: %s&bslash;n&quot;
comma
id|err_print_prefix
comma
id|clk_names
(braket
id|i
)braket
comma
id|clk_decode
(braket
id|scratch
op_amp
l_int|0x3
)braket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|uncrr_sym
op_amp
id|IO7__PO7_UNCRR_SYM__CDT_OVF_TO__REQ
)paren
id|printk
c_func
(paren
l_string|&quot;%s       REQ Credit Timeout or Overflow&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|uncrr_sym
op_amp
id|IO7__PO7_UNCRR_SYM__CDT_OVF_TO__RIO
)paren
id|printk
c_func
(paren
l_string|&quot;%s       RIO Credit Timeout or Overflow&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|uncrr_sym
op_amp
id|IO7__PO7_UNCRR_SYM__CDT_OVF_TO__WIO
)paren
id|printk
c_func
(paren
l_string|&quot;%s       WIO Credit Timeout or Overflow&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|uncrr_sym
op_amp
id|IO7__PO7_UNCRR_SYM__CDT_OVF_TO__BLK
)paren
id|printk
c_func
(paren
l_string|&quot;%s       BLK Credit Timeout or Overflow&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|uncrr_sym
op_amp
id|IO7__PO7_UNCRR_SYM__CDT_OVF_TO__NBK
)paren
id|printk
c_func
(paren
l_string|&quot;%s       NBK Credit Timeout or Overflow&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|uncrr_sym
op_amp
id|IO7__PO7_UNCRR_SYM__OVF__READIO
)paren
id|printk
c_func
(paren
l_string|&quot;%s       Read I/O Buffer Overflow&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|uncrr_sym
op_amp
id|IO7__PO7_UNCRR_SYM__OVF__WRITEIO
)paren
id|printk
c_func
(paren
l_string|&quot;%s       Write I/O Buffer Overflow&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|uncrr_sym
op_amp
id|IO7__PO7_UNCRR_SYM__OVF__FWD
)paren
id|printk
c_func
(paren
l_string|&quot;%s       FWD Buffer Overflow&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|scratch
op_assign
id|EXTRACT
c_func
(paren
id|uncrr_sym
comma
id|IO7__PO7_UNCRR_SYM__VICTIM_SP
)paren
)paren
)paren
(brace
r_int
id|lost
op_assign
id|scratch
op_amp
(paren
l_int|1UL
op_lshift
l_int|4
)paren
suffix:semicolon
id|scratch
op_and_assign
op_complement
id|lost
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
comma
id|scratch
op_rshift_assign
l_int|1
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|scratch
op_amp
l_int|1
)paren
)paren
r_continue
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s        Error Response sent to %s&quot;
comma
id|err_print_prefix
comma
id|port_names
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|lost
)paren
id|printk
c_func
(paren
l_string|&quot;%s        Lost Error sent somewhere else&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|scratch
op_assign
id|EXTRACT
c_func
(paren
id|uncrr_sym
comma
id|IO7__PO7_UNCRR_SYM__DETECT_SP
)paren
)paren
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
comma
id|scratch
op_rshift_assign
l_int|1
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|scratch
op_amp
l_int|1
)paren
)paren
r_continue
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s        Error Reported by %s&quot;
comma
id|err_print_prefix
comma
id|port_names
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|EXTRACT
c_func
(paren
id|valid_mask
comma
id|IO7__PO7_UNCRR_SYM__STRV_VTR
)paren
)paren
(brace
r_char
id|starvation_message
(braket
l_int|80
)braket
suffix:semicolon
id|scratch
op_assign
id|EXTRACT
c_func
(paren
id|uncrr_sym
comma
id|IO7__PO7_UNCRR_SYM__STRV_VTR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scratch
op_amp
id|IO7__STRV_VTR__IS_MSI
)paren
id|sprintf
c_func
(paren
id|starvation_message
comma
l_string|&quot;MSI Interrupt 0x%x&quot;
comma
id|EXTRACT
c_func
(paren
id|scratch
comma
id|IO7__STRV_VTR__MSI__INTNUM
)paren
)paren
suffix:semicolon
r_else
id|sprintf
c_func
(paren
id|starvation_message
comma
l_string|&quot;LSI INT%c for Bus:Slot (%d:%d)&bslash;n&quot;
comma
l_char|&squot;A&squot;
op_plus
id|EXTRACT
c_func
(paren
id|scratch
comma
id|IO7__STRV_VTR__LSI__INTX
)paren
comma
id|EXTRACT
c_func
(paren
id|scratch
comma
id|IO7__STRV_VTR__LSI__BUS
)paren
comma
id|EXTRACT
c_func
(paren
id|scratch
comma
id|IO7__STRV_VTR__LSI__SLOT
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s        Starvation Int Trigger By: %s&bslash;n&quot;
comma
id|err_print_prefix
comma
id|starvation_message
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|marvel_print_po7_ugbge_sym
id|marvel_print_po7_ugbge_sym
c_func
(paren
id|u64
id|ugbge_sym
)paren
(brace
r_char
id|opcode_str
(braket
l_int|10
)braket
suffix:semicolon
DECL|macro|IO7__PO7_UGBGE_SYM__UPH_PKT_OFF__S
mdefine_line|#define IO7__PO7_UGBGE_SYM__UPH_PKT_OFF__S&t;(6)
DECL|macro|IO7__PO7_UGBGE_SYM__UPH_PKT_OFF__M
mdefine_line|#define IO7__PO7_UGBGE_SYM__UPH_PKT_OFF__M&t;(0xfffffffful)
DECL|macro|IO7__PO7_UGBGE_SYM__UPH_OPCODE__S
mdefine_line|#define IO7__PO7_UGBGE_SYM__UPH_OPCODE__S&t;(40)
DECL|macro|IO7__PO7_UGBGE_SYM__UPH_OPCODE__M
mdefine_line|#define IO7__PO7_UGBGE_SYM__UPH_OPCODE__M&t;(0xff)
DECL|macro|IO7__PO7_UGBGE_SYM__UPH_SRC_PORT__S
mdefine_line|#define IO7__PO7_UGBGE_SYM__UPH_SRC_PORT__S&t;(48)
DECL|macro|IO7__PO7_UGBGE_SYM__UPH_SRC_PORT__M
mdefine_line|#define IO7__PO7_UGBGE_SYM__UPH_SRC_PORT__M&t;(0xf)
DECL|macro|IO7__PO7_UGBGE_SYM__UPH_DEST_PID__S
mdefine_line|#define IO7__PO7_UGBGE_SYM__UPH_DEST_PID__S&t;(52)
DECL|macro|IO7__PO7_UGBGE_SYM__UPH_DEST_PID__M
mdefine_line|#define IO7__PO7_UGBGE_SYM__UPH_DEST_PID__M&t;(0x7ff)
DECL|macro|IO7__PO7_UGBGE_SYM__VALID
mdefine_line|#define IO7__PO7_UGBGE_SYM__VALID&t;&t;(1UL &lt;&lt; 63)
r_if
c_cond
(paren
op_logical_neg
(paren
id|ugbge_sym
op_amp
id|IO7__PO7_UGBGE_SYM__VALID
)paren
)paren
r_return
suffix:semicolon
r_switch
c_cond
(paren
id|EXTRACT
c_func
(paren
id|ugbge_sym
comma
id|IO7__PO7_UGBGE_SYM__UPH_OPCODE
)paren
)paren
(brace
r_case
l_int|0x51
suffix:colon
id|sprintf
c_func
(paren
id|opcode_str
comma
l_string|&quot;Wr32&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x50
suffix:colon
id|sprintf
c_func
(paren
id|opcode_str
comma
l_string|&quot;WrQW&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x54
suffix:colon
id|sprintf
c_func
(paren
id|opcode_str
comma
l_string|&quot;WrIPR&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xD8
suffix:colon
id|sprintf
c_func
(paren
id|opcode_str
comma
l_string|&quot;Victim&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xC5
suffix:colon
id|sprintf
c_func
(paren
id|opcode_str
comma
l_string|&quot;BlkIO&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|sprintf
c_func
(paren
id|opcode_str
comma
l_string|&quot;0x%lx&bslash;n&quot;
comma
id|EXTRACT
c_func
(paren
id|ugbge_sym
comma
id|IO7__PO7_UGBGE_SYM__UPH_OPCODE
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;%s      Up Hose Garbage Symptom:&bslash;n&quot;
l_string|&quot;%s        Source Port: %ld - Dest PID: %ld - OpCode: %s&bslash;n&quot;
comma
id|err_print_prefix
comma
id|err_print_prefix
comma
id|EXTRACT
c_func
(paren
id|ugbge_sym
comma
id|IO7__PO7_UGBGE_SYM__UPH_SRC_PORT
)paren
comma
id|EXTRACT
c_func
(paren
id|ugbge_sym
comma
id|IO7__PO7_UGBGE_SYM__UPH_DEST_PID
)paren
comma
id|opcode_str
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0xC5
op_ne
id|EXTRACT
c_func
(paren
id|ugbge_sym
comma
id|IO7__PO7_UGBGE_SYM__UPH_OPCODE
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;%s        Packet Offset 0x%08lx&bslash;n&quot;
comma
id|err_print_prefix
comma
id|EXTRACT
c_func
(paren
id|ugbge_sym
comma
id|IO7__PO7_UGBGE_SYM__UPH_PKT_OFF
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|marvel_print_po7_err_sum
id|marvel_print_po7_err_sum
c_func
(paren
r_struct
id|ev7_pal_io_subpacket
op_star
id|io
)paren
(brace
id|u64
id|uncrr_sym_valid
op_assign
l_int|0
suffix:semicolon
DECL|macro|IO7__PO7_ERRSUM__CR_SBE
mdefine_line|#define IO7__PO7_ERRSUM__CR_SBE&t;&t;(1UL &lt;&lt; 32)
DECL|macro|IO7__PO7_ERRSUM__CR_SBE2
mdefine_line|#define IO7__PO7_ERRSUM__CR_SBE2&t;(1UL &lt;&lt; 33)
DECL|macro|IO7__PO7_ERRSUM__CR_PIO_WBYTE
mdefine_line|#define IO7__PO7_ERRSUM__CR_PIO_WBYTE&t;(1UL &lt;&lt; 34)
DECL|macro|IO7__PO7_ERRSUM__CR_CSR_NXM
mdefine_line|#define IO7__PO7_ERRSUM__CR_CSR_NXM&t;(1UL &lt;&lt; 35)
DECL|macro|IO7__PO7_ERRSUM__CR_RPID_ACV
mdefine_line|#define IO7__PO7_ERRSUM__CR_RPID_ACV&t;(1UL &lt;&lt; 36)
DECL|macro|IO7__PO7_ERRSUM__CR_RSP_NXM
mdefine_line|#define IO7__PO7_ERRSUM__CR_RSP_NXM&t;(1UL &lt;&lt; 37)
DECL|macro|IO7__PO7_ERRSUM__CR_ERR_RESP
mdefine_line|#define IO7__PO7_ERRSUM__CR_ERR_RESP&t;(1UL &lt;&lt; 38)
DECL|macro|IO7__PO7_ERRSUM__CR_CLK_DERR
mdefine_line|#define IO7__PO7_ERRSUM__CR_CLK_DERR&t;(1UL &lt;&lt; 39)
DECL|macro|IO7__PO7_ERRSUM__CR_DAT_DBE
mdefine_line|#define IO7__PO7_ERRSUM__CR_DAT_DBE&t;(1UL &lt;&lt; 40)
DECL|macro|IO7__PO7_ERRSUM__CR_DAT_GRBG
mdefine_line|#define IO7__PO7_ERRSUM__CR_DAT_GRBG&t;(1UL &lt;&lt; 41)
DECL|macro|IO7__PO7_ERRSUM__MAF_TO
mdefine_line|#define IO7__PO7_ERRSUM__MAF_TO&t;&t;(1UL &lt;&lt; 42)
DECL|macro|IO7__PO7_ERRSUM__UGBGE
mdefine_line|#define IO7__PO7_ERRSUM__UGBGE&t;&t;(1UL &lt;&lt; 43)
DECL|macro|IO7__PO7_ERRSUM__UN_MAF_LOST
mdefine_line|#define IO7__PO7_ERRSUM__UN_MAF_LOST&t;(1UL &lt;&lt; 44)
DECL|macro|IO7__PO7_ERRSUM__UN_PKT_OVF
mdefine_line|#define IO7__PO7_ERRSUM__UN_PKT_OVF&t;(1UL &lt;&lt; 45)
DECL|macro|IO7__PO7_ERRSUM__UN_CDT_OVF
mdefine_line|#define IO7__PO7_ERRSUM__UN_CDT_OVF&t;(1UL &lt;&lt; 46)
DECL|macro|IO7__PO7_ERRSUM__UN_DEALLOC
mdefine_line|#define IO7__PO7_ERRSUM__UN_DEALLOC&t;(1UL &lt;&lt; 47)
DECL|macro|IO7__PO7_ERRSUM__BH_CDT_TO
mdefine_line|#define IO7__PO7_ERRSUM__BH_CDT_TO&t;(1UL &lt;&lt; 51)
DECL|macro|IO7__PO7_ERRSUM__BH_CLK_HDR
mdefine_line|#define IO7__PO7_ERRSUM__BH_CLK_HDR&t;(1UL &lt;&lt; 52)
DECL|macro|IO7__PO7_ERRSUM__BH_DBE_HDR
mdefine_line|#define IO7__PO7_ERRSUM__BH_DBE_HDR&t;(1UL &lt;&lt; 53)
DECL|macro|IO7__PO7_ERRSUM__BH_GBG_HDR
mdefine_line|#define IO7__PO7_ERRSUM__BH_GBG_HDR&t;(1UL &lt;&lt; 54)
DECL|macro|IO7__PO7_ERRSUM__BH_BAD_CMD
mdefine_line|#define IO7__PO7_ERRSUM__BH_BAD_CMD&t;(1UL &lt;&lt; 55)
DECL|macro|IO7__PO7_ERRSUM__HLT_INT
mdefine_line|#define IO7__PO7_ERRSUM__HLT_INT&t;(1UL &lt;&lt; 56)
DECL|macro|IO7__PO7_ERRSUM__HP_INT
mdefine_line|#define IO7__PO7_ERRSUM__HP_INT&t;&t;(1UL &lt;&lt; 57)
DECL|macro|IO7__PO7_ERRSUM__CRD_INT
mdefine_line|#define IO7__PO7_ERRSUM__CRD_INT&t;(1UL &lt;&lt; 58)
DECL|macro|IO7__PO7_ERRSUM__STV_INT
mdefine_line|#define IO7__PO7_ERRSUM__STV_INT&t;(1UL &lt;&lt; 59)
DECL|macro|IO7__PO7_ERRSUM__HRD_INT
mdefine_line|#define IO7__PO7_ERRSUM__HRD_INT&t;(1UL &lt;&lt; 60)
DECL|macro|IO7__PO7_ERRSUM__BH_SUM
mdefine_line|#define IO7__PO7_ERRSUM__BH_SUM&t;&t;(1UL &lt;&lt; 61)
DECL|macro|IO7__PO7_ERRSUM__ERR_LST
mdefine_line|#define IO7__PO7_ERRSUM__ERR_LST&t;(1UL &lt;&lt; 62)
DECL|macro|IO7__PO7_ERRSUM__ERR_VALID
mdefine_line|#define IO7__PO7_ERRSUM__ERR_VALID&t;(1UL &lt;&lt; 63)
DECL|macro|IO7__PO7_ERRSUM__ERR_MASK
mdefine_line|#define IO7__PO7_ERRSUM__ERR_MASK&t;(IO7__PO7_ERRSUM__ERR_VALID |&t;&bslash;&n;&t;&t;&t;&t;&t; IO7__PO7_ERRSUM__CR_SBE)
multiline_comment|/*&n;&t; * Single bit errors aren&squot;t covered by ERR_VALID.&n;&t; */
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__CR_SBE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s    %sSingle Bit Error(s) detected/corrected&bslash;n&quot;
comma
id|err_print_prefix
comma
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__CR_SBE2
)paren
ques
c_cond
l_string|&quot;Multiple &quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|marvel_print_po7_crrct_sym
c_func
(paren
id|io-&gt;po7_crrct_sym
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Neither are the interrupt status bits&n;&t; */
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__HLT_INT
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Halt Interrupt posted&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__HP_INT
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s    Hot Plug Event Interrupt posted&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
id|uncrr_sym_valid
op_or_assign
id|GEN_MASK
c_func
(paren
id|IO7__PO7_UNCRR_SYM__DETECT_SP
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__CRD_INT
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Correctable Error Interrupt posted&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__STV_INT
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s    Starvation Interrupt posted&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
id|uncrr_sym_valid
op_or_assign
id|GEN_MASK
c_func
(paren
id|IO7__PO7_UNCRR_SYM__STRV_VTR
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__HRD_INT
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s    Hard Error Interrupt posted&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
id|uncrr_sym_valid
op_or_assign
id|GEN_MASK
c_func
(paren
id|IO7__PO7_UNCRR_SYM__DETECT_SP
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Everything else is valid only with ERR_VALID, so skip to the end&n;&t; * (uncrr_sym check) unless ERR_VALID is set.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__ERR_VALID
)paren
)paren
r_goto
id|check_uncrr_sym
suffix:semicolon
multiline_comment|/*&n;&t; * Since ERR_VALID is set, VICTIM_SP in uncrr_sym is valid.&n;&t; * For bits [29:0] to also be valid, the following bits must&n;&t; * not be set:&n;&t; *&t;CR_PIO_WBYTE&t;CR_CSR_NXM&t;CR_RSP_NXM&n;&t; *&t;CR_ERR_RESP&t;MAF_TO&n;&t; */
id|uncrr_sym_valid
op_or_assign
id|GEN_MASK
c_func
(paren
id|IO7__PO7_UNCRR_SYM__VICTIM_SP
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|io-&gt;po7_error_sum
op_amp
(paren
id|IO7__PO7_ERRSUM__CR_PIO_WBYTE
op_or
id|IO7__PO7_ERRSUM__CR_CSR_NXM
op_or
id|IO7__PO7_ERRSUM__CR_RSP_NXM
op_or
id|IO7__PO7_ERRSUM__CR_ERR_RESP
op_or
id|IO7__PO7_ERRSUM__MAF_TO
)paren
)paren
)paren
id|uncrr_sym_valid
op_or_assign
l_int|0x3ffffffful
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__CR_PIO_WBYTE
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Write byte into IO7 CSR&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__CR_CSR_NXM
)paren
id|printk
c_func
(paren
l_string|&quot;%s    PIO to non-existent CSR&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__CR_RPID_ACV
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Bus Requester PID (Access Violation)&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__CR_RSP_NXM
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Received NXM response from EV7&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__CR_ERR_RESP
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Received ERROR RESPONSE&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__CR_CLK_DERR
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Clock error on data flit&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__CR_DAT_DBE
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Double Bit Error Data Error Detected&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__CR_DAT_GRBG
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Garbage Encoding Detected on the data&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__UGBGE
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s    Garbage Encoding sent up hose&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
id|marvel_print_po7_ugbge_sym
c_func
(paren
id|io-&gt;po7_ugbge_sym
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__UN_MAF_LOST
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Orphan response (unexpected response)&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__UN_PKT_OVF
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Down hose packet overflow&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__UN_CDT_OVF
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Down hose credit overflow&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__UN_DEALLOC
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Unexpected or bad dealloc field&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * The black hole events.&n;&t; */
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__MAF_TO
)paren
id|printk
c_func
(paren
l_string|&quot;%s    BLACK HOLE: Timeout for all responses&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__BH_CDT_TO
)paren
id|printk
c_func
(paren
l_string|&quot;%s    BLACK HOLE: Credit Timeout&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__BH_CLK_HDR
)paren
id|printk
c_func
(paren
l_string|&quot;%s    BLACK HOLE: Clock check on header&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__BH_DBE_HDR
)paren
id|printk
c_func
(paren
l_string|&quot;%s    BLACK HOLE: Uncorrectable Error on header&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__BH_GBG_HDR
)paren
id|printk
c_func
(paren
l_string|&quot;%s    BLACK HOLE: Garbage on header&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__BH_BAD_CMD
)paren
id|printk
c_func
(paren
l_string|&quot;%s    BLACK HOLE: Bad EV7 command&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__ERR_LST
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Lost Error&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s    Failing Packet:&bslash;n&quot;
l_string|&quot;%s      Cycle 1: %016lx&bslash;n&quot;
l_string|&quot;%s      Cycle 2: %016lx&bslash;n&quot;
comma
id|err_print_prefix
comma
id|err_print_prefix
comma
id|io-&gt;po7_err_pkt0
comma
id|err_print_prefix
comma
id|io-&gt;po7_err_pkt1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * If there are any valid bits in UNCRR sym for this err, &n;&t; * print UNCRR_SYM as well.&n;&t; */
id|check_uncrr_sym
suffix:colon
r_if
c_cond
(paren
id|uncrr_sym_valid
)paren
id|marvel_print_po7_uncrr_sym
c_func
(paren
id|io-&gt;po7_uncrr_sym
comma
id|uncrr_sym_valid
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|marvel_print_pox_tlb_err
id|marvel_print_pox_tlb_err
c_func
(paren
id|u64
id|tlb_err
)paren
(brace
r_static
r_char
op_star
id|tlb_errors
(braket
)braket
op_assign
(brace
l_string|&quot;No Error&quot;
comma
l_string|&quot;North Port Signaled Error fetching TLB entry&quot;
comma
l_string|&quot;PTE invalid or UCC or GBG error on this entry&quot;
comma
l_string|&quot;Address did not hit any DMA window&quot;
)brace
suffix:semicolon
DECL|macro|IO7__POX_TLBERR__ERR_VALID
mdefine_line|#define IO7__POX_TLBERR__ERR_VALID&t;&t;(1UL &lt;&lt; 63)
DECL|macro|IO7__POX_TLBERR__ERRCODE__S
mdefine_line|#define IO7__POX_TLBERR__ERRCODE__S&t;&t;(0)
DECL|macro|IO7__POX_TLBERR__ERRCODE__M
mdefine_line|#define IO7__POX_TLBERR__ERRCODE__M&t;&t;(0x3)
DECL|macro|IO7__POX_TLBERR__ERR_TLB_PTR__S
mdefine_line|#define IO7__POX_TLBERR__ERR_TLB_PTR__S&t;&t;(3)
DECL|macro|IO7__POX_TLBERR__ERR_TLB_PTR__M
mdefine_line|#define IO7__POX_TLBERR__ERR_TLB_PTR__M&t;&t;(0x7)
DECL|macro|IO7__POX_TLBERR__FADDR__S
mdefine_line|#define IO7__POX_TLBERR__FADDR__S&t;&t;(6)
DECL|macro|IO7__POX_TLBERR__FADDR__M
mdefine_line|#define IO7__POX_TLBERR__FADDR__M&t;&t;(0x3fffffffffful)
r_if
c_cond
(paren
op_logical_neg
(paren
id|tlb_err
op_amp
id|IO7__POX_TLBERR__ERR_VALID
)paren
)paren
r_return
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s      TLB Error on index 0x%lx:&bslash;n&quot;
l_string|&quot;%s        - %s&bslash;n&quot;
l_string|&quot;%s        - Addr: 0x%016lx&bslash;n&quot;
comma
id|err_print_prefix
comma
id|EXTRACT
c_func
(paren
id|tlb_err
comma
id|IO7__POX_TLBERR__ERR_TLB_PTR
)paren
comma
id|err_print_prefix
comma
id|tlb_errors
(braket
id|EXTRACT
c_func
(paren
id|tlb_err
comma
id|IO7__POX_TLBERR__ERRCODE
)paren
)braket
comma
id|err_print_prefix
comma
id|EXTRACT
c_func
(paren
id|tlb_err
comma
id|IO7__POX_TLBERR__FADDR
)paren
op_lshift
l_int|6
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|marvel_print_pox_spl_cmplt
id|marvel_print_pox_spl_cmplt
c_func
(paren
id|u64
id|spl_cmplt
)paren
(brace
r_char
id|message
(braket
l_int|80
)braket
suffix:semicolon
DECL|macro|IO7__POX_SPLCMPLT__MESSAGE__S
mdefine_line|#define IO7__POX_SPLCMPLT__MESSAGE__S&t;&t;(0)
DECL|macro|IO7__POX_SPLCMPLT__MESSAGE__M
mdefine_line|#define IO7__POX_SPLCMPLT__MESSAGE__M&t;&t;(0x0fffffffful)
DECL|macro|IO7__POX_SPLCMPLT__SOURCE_BUS__S
mdefine_line|#define IO7__POX_SPLCMPLT__SOURCE_BUS__S&t;(40)
DECL|macro|IO7__POX_SPLCMPLT__SOURCE_BUS__M
mdefine_line|#define IO7__POX_SPLCMPLT__SOURCE_BUS__M&t;(0xfful)
DECL|macro|IO7__POX_SPLCMPLT__SOURCE_DEV__S
mdefine_line|#define IO7__POX_SPLCMPLT__SOURCE_DEV__S&t;(35)
DECL|macro|IO7__POX_SPLCMPLT__SOURCE_DEV__M
mdefine_line|#define IO7__POX_SPLCMPLT__SOURCE_DEV__M&t;(0x1ful)
DECL|macro|IO7__POX_SPLCMPLT__SOURCE_FUNC__S
mdefine_line|#define IO7__POX_SPLCMPLT__SOURCE_FUNC__S&t;(32)
DECL|macro|IO7__POX_SPLCMPLT__SOURCE_FUNC__M
mdefine_line|#define IO7__POX_SPLCMPLT__SOURCE_FUNC__M&t;(0x07ul)
DECL|macro|IO7__POX_SPLCMPLT__MSG_CLASS__S
mdefine_line|#define IO7__POX_SPLCMPLT__MSG_CLASS__S&t;&t;(28)
DECL|macro|IO7__POX_SPLCMPLT__MSG_CLASS__M
mdefine_line|#define IO7__POX_SPLCMPLT__MSG_CLASS__M&t;&t;(0xf)
DECL|macro|IO7__POX_SPLCMPLT__MSG_INDEX__S
mdefine_line|#define IO7__POX_SPLCMPLT__MSG_INDEX__S&t;&t;(20)
DECL|macro|IO7__POX_SPLCMPLT__MSG_INDEX__M
mdefine_line|#define IO7__POX_SPLCMPLT__MSG_INDEX__M&t;&t;(0xff)
DECL|macro|IO7__POX_SPLCMPLT__MSG_CLASSINDEX__S
mdefine_line|#define IO7__POX_SPLCMPLT__MSG_CLASSINDEX__S&t;(20)
DECL|macro|IO7__POX_SPLCMPLT__MSG_CLASSINDEX__M
mdefine_line|#define IO7__POX_SPLCMPLT__MSG_CLASSINDEX__M    (0xfff)
DECL|macro|IO7__POX_SPLCMPLT__REM_LOWER_ADDR__S
mdefine_line|#define IO7__POX_SPLCMPLT__REM_LOWER_ADDR__S&t;(12)
DECL|macro|IO7__POX_SPLCMPLT__REM_LOWER_ADDR__M
mdefine_line|#define IO7__POX_SPLCMPLT__REM_LOWER_ADDR__M&t;(0x7f)
DECL|macro|IO7__POX_SPLCMPLT__REM_BYTE_COUNT__S
mdefine_line|#define IO7__POX_SPLCMPLT__REM_BYTE_COUNT__S&t;(0)
DECL|macro|IO7__POX_SPLCMPLT__REM_BYTE_COUNT__M
mdefine_line|#define IO7__POX_SPLCMPLT__REM_BYTE_COUNT__M&t;(0xfff)
id|printk
c_func
(paren
l_string|&quot;%s      Split Completion Error:&bslash;n&quot;
l_string|&quot;%s         Source (Bus:Dev:Func): %ld:%ld:%ld&bslash;n&quot;
comma
id|err_print_prefix
comma
id|err_print_prefix
comma
id|EXTRACT
c_func
(paren
id|spl_cmplt
comma
id|IO7__POX_SPLCMPLT__SOURCE_BUS
)paren
comma
id|EXTRACT
c_func
(paren
id|spl_cmplt
comma
id|IO7__POX_SPLCMPLT__SOURCE_DEV
)paren
comma
id|EXTRACT
c_func
(paren
id|spl_cmplt
comma
id|IO7__POX_SPLCMPLT__SOURCE_FUNC
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|EXTRACT
c_func
(paren
id|spl_cmplt
comma
id|IO7__POX_SPLCMPLT__MSG_CLASSINDEX
)paren
)paren
(brace
r_case
l_int|0x000
suffix:colon
id|sprintf
c_func
(paren
id|message
comma
l_string|&quot;Normal completion&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x100
suffix:colon
id|sprintf
c_func
(paren
id|message
comma
l_string|&quot;Bridge - Master Abort&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x101
suffix:colon
id|sprintf
c_func
(paren
id|message
comma
l_string|&quot;Bridge - Target Abort&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x102
suffix:colon
id|sprintf
c_func
(paren
id|message
comma
l_string|&quot;Bridge - Uncorrectable Write Data Error&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x200
suffix:colon
id|sprintf
c_func
(paren
id|message
comma
l_string|&quot;Byte Count Out of Range&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x201
suffix:colon
id|sprintf
c_func
(paren
id|message
comma
l_string|&quot;Uncorrectable Split Write Data Error&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|sprintf
c_func
(paren
id|message
comma
l_string|&quot;%08lx&bslash;n&quot;
comma
id|EXTRACT
c_func
(paren
id|spl_cmplt
comma
id|IO7__POX_SPLCMPLT__MESSAGE
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;%s&t;   Message: %s&bslash;n&quot;
comma
id|err_print_prefix
comma
id|message
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|marvel_print_pox_trans_sum
id|marvel_print_pox_trans_sum
c_func
(paren
id|u64
id|trans_sum
)paren
(brace
r_char
op_star
id|pcix_cmd
(braket
)braket
op_assign
(brace
l_string|&quot;Interrupt Acknowledge&quot;
comma
l_string|&quot;Special Cycle&quot;
comma
l_string|&quot;I/O Read&quot;
comma
l_string|&quot;I/O Write&quot;
comma
l_string|&quot;Reserved&quot;
comma
l_string|&quot;Reserved / Device ID Message&quot;
comma
l_string|&quot;Memory Read&quot;
comma
l_string|&quot;Memory Write&quot;
comma
l_string|&quot;Reserved / Alias to Memory Read Block&quot;
comma
l_string|&quot;Reserved / Alias to Memory Write Block&quot;
comma
l_string|&quot;Configuration Read&quot;
comma
l_string|&quot;Configuration Write&quot;
comma
l_string|&quot;Memory Read Multiple / Split Completion&quot;
comma
l_string|&quot;Dual Address Cycle&quot;
comma
l_string|&quot;Memory Read Line / Memory Read Block&quot;
comma
l_string|&quot;Memory Write and Invalidate / Memory Write Block&quot;
)brace
suffix:semicolon
DECL|macro|IO7__POX_TRANSUM__PCI_ADDR__S
mdefine_line|#define IO7__POX_TRANSUM__PCI_ADDR__S&t;&t;(0)
DECL|macro|IO7__POX_TRANSUM__PCI_ADDR__M
mdefine_line|#define IO7__POX_TRANSUM__PCI_ADDR__M&t;&t;(0x3fffffffffffful)
DECL|macro|IO7__POX_TRANSUM__DAC
mdefine_line|#define IO7__POX_TRANSUM__DAC&t;&t;&t;(1UL &lt;&lt; 50)
DECL|macro|IO7__POX_TRANSUM__PCIX_MASTER_SLOT__S
mdefine_line|#define IO7__POX_TRANSUM__PCIX_MASTER_SLOT__S&t;(52)
DECL|macro|IO7__POX_TRANSUM__PCIX_MASTER_SLOT__M
mdefine_line|#define IO7__POX_TRANSUM__PCIX_MASTER_SLOT__M&t;(0xf)
DECL|macro|IO7__POX_TRANSUM__PCIX_CMD__S
mdefine_line|#define IO7__POX_TRANSUM__PCIX_CMD__S&t;&t;(56)
DECL|macro|IO7__POX_TRANSUM__PCIX_CMD__M
mdefine_line|#define IO7__POX_TRANSUM__PCIX_CMD__M&t;&t;(0xf)
DECL|macro|IO7__POX_TRANSUM__ERR_VALID
mdefine_line|#define IO7__POX_TRANSUM__ERR_VALID&t;&t;(1UL &lt;&lt; 63)
r_if
c_cond
(paren
op_logical_neg
(paren
id|trans_sum
op_amp
id|IO7__POX_TRANSUM__ERR_VALID
)paren
)paren
r_return
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s      Transaction Summary:&bslash;n&quot;
l_string|&quot;%s        Command: 0x%lx - %s&bslash;n&quot;
l_string|&quot;%s        Address: 0x%016lx%s&bslash;n&quot;
l_string|&quot;%s        PCI-X Master Slot: 0x%lx&bslash;n&quot;
comma
id|err_print_prefix
comma
id|err_print_prefix
comma
id|EXTRACT
c_func
(paren
id|trans_sum
comma
id|IO7__POX_TRANSUM__PCIX_CMD
)paren
comma
id|pcix_cmd
(braket
id|EXTRACT
c_func
(paren
id|trans_sum
comma
id|IO7__POX_TRANSUM__PCIX_CMD
)paren
)braket
comma
id|err_print_prefix
comma
id|EXTRACT
c_func
(paren
id|trans_sum
comma
id|IO7__POX_TRANSUM__PCI_ADDR
)paren
comma
(paren
id|trans_sum
op_amp
id|IO7__POX_TRANSUM__DAC
)paren
ques
c_cond
l_string|&quot; (DAC)&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|err_print_prefix
comma
id|EXTRACT
c_func
(paren
id|trans_sum
comma
id|IO7__POX_TRANSUM__PCIX_MASTER_SLOT
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|marvel_print_pox_err
id|marvel_print_pox_err
c_func
(paren
id|u64
id|err_sum
comma
r_struct
id|ev7_pal_io_one_port
op_star
id|port
)paren
(brace
DECL|macro|IO7__POX_ERRSUM__AGP_REQQ_OVFL
mdefine_line|#define IO7__POX_ERRSUM__AGP_REQQ_OVFL    (1UL &lt;&lt;  4)
DECL|macro|IO7__POX_ERRSUM__AGP_SYNC_ERR
mdefine_line|#define IO7__POX_ERRSUM__AGP_SYNC_ERR     (1UL &lt;&lt;  5)
DECL|macro|IO7__POX_ERRSUM__MRETRY_TO
mdefine_line|#define IO7__POX_ERRSUM__MRETRY_TO        (1UL &lt;&lt;  6)
DECL|macro|IO7__POX_ERRSUM__PCIX_UX_SPL
mdefine_line|#define IO7__POX_ERRSUM__PCIX_UX_SPL      (1UL &lt;&lt;  7)
DECL|macro|IO7__POX_ERRSUM__PCIX_SPLIT_TO
mdefine_line|#define IO7__POX_ERRSUM__PCIX_SPLIT_TO    (1UL &lt;&lt;  8)
DECL|macro|IO7__POX_ERRSUM__PCIX_DISCARD_SPL
mdefine_line|#define IO7__POX_ERRSUM__PCIX_DISCARD_SPL (1UL &lt;&lt;  9)
DECL|macro|IO7__POX_ERRSUM__DMA_RD_TO
mdefine_line|#define IO7__POX_ERRSUM__DMA_RD_TO        (1UL &lt;&lt; 10)
DECL|macro|IO7__POX_ERRSUM__CSR_NXM_RD
mdefine_line|#define IO7__POX_ERRSUM__CSR_NXM_RD       (1UL &lt;&lt; 11)
DECL|macro|IO7__POX_ERRSUM__CSR_NXM_WR
mdefine_line|#define IO7__POX_ERRSUM__CSR_NXM_WR       (1UL &lt;&lt; 12)
DECL|macro|IO7__POX_ERRSUM__DMA_TO
mdefine_line|#define IO7__POX_ERRSUM__DMA_TO           (1UL &lt;&lt; 13)
DECL|macro|IO7__POX_ERRSUM__ALL_MABORTS
mdefine_line|#define IO7__POX_ERRSUM__ALL_MABORTS      (1UL &lt;&lt; 14)
DECL|macro|IO7__POX_ERRSUM__MABORT
mdefine_line|#define IO7__POX_ERRSUM__MABORT&t;&t;  (1UL &lt;&lt; 15)
DECL|macro|IO7__POX_ERRSUM__MABORT_MASK
mdefine_line|#define IO7__POX_ERRSUM__MABORT_MASK&t;  (IO7__POX_ERRSUM__ALL_MABORTS|&bslash;&n;&t;&t;&t;&t;&t;   IO7__POX_ERRSUM__MABORT)
DECL|macro|IO7__POX_ERRSUM__PT_TABORT
mdefine_line|#define IO7__POX_ERRSUM__PT_TABORT        (1UL &lt;&lt; 16)
DECL|macro|IO7__POX_ERRSUM__PM_TABORT
mdefine_line|#define IO7__POX_ERRSUM__PM_TABORT        (1UL &lt;&lt; 17)
DECL|macro|IO7__POX_ERRSUM__TABORT_MASK
mdefine_line|#define IO7__POX_ERRSUM__TABORT_MASK      (IO7__POX_ERRSUM__PT_TABORT | &bslash;&n;                                           IO7__POX_ERRSUM__PM_TABORT)
DECL|macro|IO7__POX_ERRSUM__SERR
mdefine_line|#define IO7__POX_ERRSUM__SERR             (1UL &lt;&lt; 18)
DECL|macro|IO7__POX_ERRSUM__ADDRERR_STB
mdefine_line|#define IO7__POX_ERRSUM__ADDRERR_STB      (1UL &lt;&lt; 19)
DECL|macro|IO7__POX_ERRSUM__DETECTED_SERR
mdefine_line|#define IO7__POX_ERRSUM__DETECTED_SERR    (1UL &lt;&lt; 20)
DECL|macro|IO7__POX_ERRSUM__PERR
mdefine_line|#define IO7__POX_ERRSUM__PERR             (1UL &lt;&lt; 21)
DECL|macro|IO7__POX_ERRSUM__DATAERR_STB_NIOW
mdefine_line|#define IO7__POX_ERRSUM__DATAERR_STB_NIOW (1UL &lt;&lt; 22)
DECL|macro|IO7__POX_ERRSUM__DETECTED_PERR
mdefine_line|#define IO7__POX_ERRSUM__DETECTED_PERR    (1UL &lt;&lt; 23)
DECL|macro|IO7__POX_ERRSUM__PM_PERR
mdefine_line|#define IO7__POX_ERRSUM__PM_PERR          (1UL &lt;&lt; 24)
DECL|macro|IO7__POX_ERRSUM__PT_SCERROR
mdefine_line|#define IO7__POX_ERRSUM__PT_SCERROR       (1UL &lt;&lt; 26)
DECL|macro|IO7__POX_ERRSUM__HUNG_BUS
mdefine_line|#define IO7__POX_ERRSUM__HUNG_BUS         (1UL &lt;&lt; 28)
DECL|macro|IO7__POX_ERRSUM__UPE_ERROR__S
mdefine_line|#define IO7__POX_ERRSUM__UPE_ERROR__S     (51)
DECL|macro|IO7__POX_ERRSUM__UPE_ERROR__M
mdefine_line|#define IO7__POX_ERRSUM__UPE_ERROR__M     (0xffUL)
DECL|macro|IO7__POX_ERRSUM__UPE_ERROR
mdefine_line|#define IO7__POX_ERRSUM__UPE_ERROR        GEN_MASK(IO7__POX_ERRSUM__UPE_ERROR)
DECL|macro|IO7__POX_ERRSUM__TLB_ERR
mdefine_line|#define IO7__POX_ERRSUM__TLB_ERR          (1UL &lt;&lt; 59)
DECL|macro|IO7__POX_ERRSUM__ERR_VALID
mdefine_line|#define IO7__POX_ERRSUM__ERR_VALID        (1UL &lt;&lt; 63)
DECL|macro|IO7__POX_ERRSUM__TRANS_SUM__MASK
mdefine_line|#define IO7__POX_ERRSUM__TRANS_SUM__MASK  (IO7__POX_ERRSUM__MRETRY_TO |       &bslash;&n;&t;&t;&t;&t;&t;   IO7__POX_ERRSUM__PCIX_UX_SPL |     &bslash;&n;&t;&t;&t;&t;&t;   IO7__POX_ERRSUM__PCIX_SPLIT_TO |   &bslash;&n;&t;&t;&t;&t;&t;   IO7__POX_ERRSUM__DMA_TO |          &bslash;&n;&t;&t;&t;&t;&t;   IO7__POX_ERRSUM__MABORT_MASK |     &bslash;&n;&t;&t;&t;&t;&t;   IO7__POX_ERRSUM__TABORT_MASK |     &bslash;&n;&t;&t;&t;&t;&t;   IO7__POX_ERRSUM__SERR |            &bslash;&n;&t;&t;&t;&t;&t;   IO7__POX_ERRSUM__ADDRERR_STB |     &bslash;&n;&t;&t;&t;&t;&t;   IO7__POX_ERRSUM__PERR |            &bslash;&n;&t;&t;&t;&t;&t;   IO7__POX_ERRSUM__DATAERR_STB_NIOW |&bslash;&n;&t;&t;&t;&t;&t;   IO7__POX_ERRSUM__DETECTED_PERR |   &bslash;&n;&t;&t;&t;&t;&t;   IO7__POX_ERRSUM__PM_PERR |         &bslash;&n;&t;&t;&t;&t;&t;   IO7__POX_ERRSUM__PT_SCERROR |      &bslash;&n;&t;&t;&t;&t;&t;   IO7__POX_ERRSUM__UPE_ERROR)
r_if
c_cond
(paren
op_logical_neg
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__ERR_VALID
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/*&n;&t; * First the transaction summary errors&n;&t; */
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__MRETRY_TO
)paren
id|printk
c_func
(paren
l_string|&quot;%s    IO7 Master Retry Timeout expired&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__PCIX_UX_SPL
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Unexpected Split Completion&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__PCIX_SPLIT_TO
)paren
id|printk
c_func
(paren
l_string|&quot;%s    IO7 Split Completion Timeout expired&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__DMA_TO
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Hung bus during DMA transaction&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__MABORT_MASK
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Master Abort&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__PT_TABORT
)paren
id|printk
c_func
(paren
l_string|&quot;%s    IO7 Asserted Target Abort&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__PM_TABORT
)paren
id|printk
c_func
(paren
l_string|&quot;%s    IO7 Received Target Abort&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__ADDRERR_STB
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s    Address or PCI-X Attribute Parity Error&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__SERR
)paren
id|printk
c_func
(paren
l_string|&quot;%s     IO7 Asserted SERR&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__PERR
)paren
(brace
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__DATAERR_STB_NIOW
)paren
id|printk
c_func
(paren
l_string|&quot;%s    IO7 Detected Data Parity Error&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;%s    Split Completion Response with &quot;
l_string|&quot;Parity Error&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__DETECTED_PERR
)paren
id|printk
c_func
(paren
l_string|&quot;%s    PERR detected&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__PM_PERR
)paren
id|printk
c_func
(paren
l_string|&quot;%s    PERR while IO7 is master&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__PT_SCERROR
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s    IO7 Received Split Completion Error message&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
id|marvel_print_pox_spl_cmplt
c_func
(paren
id|port-&gt;pox_spl_cmplt
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__UPE_ERROR
)paren
(brace
r_int
r_int
id|upe_error
op_assign
id|EXTRACT
c_func
(paren
id|err_sum
comma
id|IO7__POX_ERRSUM__UPE_ERROR
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_static
r_char
op_star
id|upe_errors
(braket
)braket
op_assign
(brace
l_string|&quot;Parity Error on MSI write data&quot;
comma
l_string|&quot;MSI read (MSI window is write only&quot;
comma
l_string|&quot;TLB - Invalid WR transaction&quot;
comma
l_string|&quot;TLB - Invalid RD transaction&quot;
comma
l_string|&quot;DMA - WR error (see north port)&quot;
comma
l_string|&quot;DMA - RD error (see north port)&quot;
comma
l_string|&quot;PPR - WR error (see north port)&quot;
comma
l_string|&quot;PPR - RD error (see north port)&quot;
)brace
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s    UPE Error:&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|upe_error
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;%s      %s&bslash;n&quot;
comma
id|err_print_prefix
comma
id|upe_errors
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; * POx_TRANS_SUM, if appropriate.&n;&t; */
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__TRANS_SUM__MASK
)paren
id|marvel_print_pox_trans_sum
c_func
(paren
id|port-&gt;pox_trans_sum
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Then TLB_ERR.&n;&t; */
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__TLB_ERR
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s    TLB ERROR&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
id|marvel_print_pox_tlb_err
c_func
(paren
id|port-&gt;pox_tlb_err
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * And the single bit status errors.&n;&t; */
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__AGP_REQQ_OVFL
)paren
id|printk
c_func
(paren
l_string|&quot;%s    AGP Request Queue Overflow&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__AGP_SYNC_ERR
)paren
id|printk
c_func
(paren
l_string|&quot;%s    AGP Sync Error&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__PCIX_DISCARD_SPL
)paren
id|printk
c_func
(paren
l_string|&quot;%s    Discarded split completion&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__DMA_RD_TO
)paren
id|printk
c_func
(paren
l_string|&quot;%s    DMA Read Timeout&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__CSR_NXM_RD
)paren
id|printk
c_func
(paren
l_string|&quot;%s    CSR NXM READ&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__CSR_NXM_WR
)paren
id|printk
c_func
(paren
l_string|&quot;%s    CSR NXM WRITE&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__DETECTED_SERR
)paren
id|printk
c_func
(paren
l_string|&quot;%s    SERR detected&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err_sum
op_amp
id|IO7__POX_ERRSUM__HUNG_BUS
)paren
id|printk
c_func
(paren
l_string|&quot;%s    HUNG BUS detected&bslash;n&quot;
comma
id|err_print_prefix
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_VERBOSE_MCHECK */
r_static
r_struct
id|ev7_pal_io_subpacket
op_star
DECL|function|marvel_find_io7_with_error
id|marvel_find_io7_with_error
c_func
(paren
r_struct
id|ev7_lf_subpackets
op_star
id|lf_subpackets
)paren
(brace
r_struct
id|ev7_pal_io_subpacket
op_star
id|io
op_assign
id|lf_subpackets-&gt;io
suffix:semicolon
r_struct
id|io7
op_star
id|io7
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/*&n;&t; * Caller must provide the packet to fill&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|io
)paren
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;&t; * Fill the subpacket with the console&squot;s standard fill pattern&n;&t; */
id|memset
c_func
(paren
id|io
comma
l_int|0x55
comma
r_sizeof
(paren
op_star
id|io
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|io7
op_assign
l_int|NULL
suffix:semicolon
l_int|NULL
op_ne
(paren
id|io7
op_assign
id|marvel_next_io7
c_func
(paren
id|io7
)paren
)paren
suffix:semicolon
)paren
(brace
r_int
r_int
id|err_sum
op_assign
l_int|0
suffix:semicolon
id|err_sum
op_or_assign
id|io7-&gt;csrs-&gt;PO7_ERROR_SUM.csr
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IO7_NUM_PORTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|io7-&gt;ports
(braket
id|i
)braket
dot
id|enabled
)paren
r_continue
suffix:semicolon
id|err_sum
op_or_assign
id|io7-&gt;ports
(braket
id|i
)braket
dot
id|csrs-&gt;POx_ERR_SUM.csr
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Is there at least one error? &n;&t;&t; */
r_if
c_cond
(paren
id|err_sum
op_amp
(paren
l_int|1UL
op_lshift
l_int|63
)paren
)paren
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Did we find an IO7 with an error?&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|io7
)paren
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;&t; * We have an IO7 with an error. &n;&t; *&n;&t; * Fill in the IO subpacket.&n;&t; */
id|io-&gt;io_asic_rev
op_assign
id|io7-&gt;csrs-&gt;IO_ASIC_REV.csr
suffix:semicolon
id|io-&gt;io_sys_rev
op_assign
id|io7-&gt;csrs-&gt;IO_SYS_REV.csr
suffix:semicolon
id|io-&gt;io7_uph
op_assign
id|io7-&gt;csrs-&gt;IO7_UPH.csr
suffix:semicolon
id|io-&gt;hpi_ctl
op_assign
id|io7-&gt;csrs-&gt;HPI_CTL.csr
suffix:semicolon
id|io-&gt;crd_ctl
op_assign
id|io7-&gt;csrs-&gt;CRD_CTL.csr
suffix:semicolon
id|io-&gt;hei_ctl
op_assign
id|io7-&gt;csrs-&gt;HEI_CTL.csr
suffix:semicolon
id|io-&gt;po7_error_sum
op_assign
id|io7-&gt;csrs-&gt;PO7_ERROR_SUM.csr
suffix:semicolon
id|io-&gt;po7_uncrr_sym
op_assign
id|io7-&gt;csrs-&gt;PO7_UNCRR_SYM.csr
suffix:semicolon
id|io-&gt;po7_crrct_sym
op_assign
id|io7-&gt;csrs-&gt;PO7_CRRCT_SYM.csr
suffix:semicolon
id|io-&gt;po7_ugbge_sym
op_assign
id|io7-&gt;csrs-&gt;PO7_UGBGE_SYM.csr
suffix:semicolon
id|io-&gt;po7_err_pkt0
op_assign
id|io7-&gt;csrs-&gt;PO7_ERR_PKT
(braket
l_int|0
)braket
dot
id|csr
suffix:semicolon
id|io-&gt;po7_err_pkt1
op_assign
id|io7-&gt;csrs-&gt;PO7_ERR_PKT
(braket
l_int|1
)braket
dot
id|csr
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IO7_NUM_PORTS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|io7_ioport_csrs
op_star
id|csrs
op_assign
id|io7-&gt;ports
(braket
id|i
)braket
dot
id|csrs
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|io7-&gt;ports
(braket
id|i
)braket
dot
id|enabled
)paren
r_continue
suffix:semicolon
id|io-&gt;ports
(braket
id|i
)braket
dot
id|pox_err_sum
op_assign
id|csrs-&gt;POx_ERR_SUM.csr
suffix:semicolon
id|io-&gt;ports
(braket
id|i
)braket
dot
id|pox_tlb_err
op_assign
id|csrs-&gt;POx_TLB_ERR.csr
suffix:semicolon
id|io-&gt;ports
(braket
id|i
)braket
dot
id|pox_spl_cmplt
op_assign
id|csrs-&gt;POx_SPL_COMPLT.csr
suffix:semicolon
id|io-&gt;ports
(braket
id|i
)braket
dot
id|pox_trans_sum
op_assign
id|csrs-&gt;POx_TRANS_SUM.csr
suffix:semicolon
id|io-&gt;ports
(braket
id|i
)braket
dot
id|pox_first_err
op_assign
id|csrs-&gt;POx_FIRST_ERR.csr
suffix:semicolon
id|io-&gt;ports
(braket
id|i
)braket
dot
id|pox_mult_err
op_assign
id|csrs-&gt;POx_MULT_ERR.csr
suffix:semicolon
id|io-&gt;ports
(braket
id|i
)braket
dot
id|pox_dm_source
op_assign
id|csrs-&gt;POx_DM_SOURCE.csr
suffix:semicolon
id|io-&gt;ports
(braket
id|i
)braket
dot
id|pox_dm_dest
op_assign
id|csrs-&gt;POx_DM_DEST.csr
suffix:semicolon
id|io-&gt;ports
(braket
id|i
)braket
dot
id|pox_dm_size
op_assign
id|csrs-&gt;POx_DM_SIZE.csr
suffix:semicolon
id|io-&gt;ports
(braket
id|i
)braket
dot
id|pox_dm_ctrl
op_assign
id|csrs-&gt;POx_DM_CTRL.csr
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Ack this port&squot;s errors, if any. POx_ERR_SUM must be last.&n;&t;&t; *&n;&t;&t; * Most of the error registers get cleared and unlocked when&n;&t;&t; * the associated bits in POx_ERR_SUM are cleared (by writing&n;&t;&t; * 1). POx_TLB_ERR is an exception and must be explicitly &n;&t;&t; * cleared.&n;&t;&t; */
id|csrs-&gt;POx_TLB_ERR.csr
op_assign
id|io-&gt;ports
(braket
id|i
)braket
dot
id|pox_tlb_err
suffix:semicolon
id|csrs-&gt;POx_ERR_SUM.csr
op_assign
id|io-&gt;ports
(braket
id|i
)braket
dot
id|pox_err_sum
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|csrs-&gt;POx_ERR_SUM.csr
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Ack any port 7 error(s).&n;&t; */
id|io7-&gt;csrs-&gt;PO7_ERROR_SUM.csr
op_assign
id|io-&gt;po7_error_sum
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
id|io7-&gt;csrs-&gt;PO7_ERROR_SUM.csr
suffix:semicolon
multiline_comment|/*&n;&t; * Correct the io7_pid.&n;&t; */
id|lf_subpackets-&gt;io_pid
op_assign
id|io7-&gt;pe
suffix:semicolon
r_return
id|io
suffix:semicolon
)brace
r_static
r_int
DECL|function|marvel_process_io_error
id|marvel_process_io_error
c_func
(paren
r_struct
id|ev7_lf_subpackets
op_star
id|lf_subpackets
comma
r_int
id|print
)paren
(brace
r_int
id|status
op_assign
id|MCHK_DISPOSITION_UNKNOWN_ERROR
suffix:semicolon
macro_line|#ifdef CONFIG_VERBOSE_MCHECK
r_struct
id|ev7_pal_io_subpacket
op_star
id|io
op_assign
id|lf_subpackets-&gt;io
suffix:semicolon
r_int
id|i
suffix:semicolon
macro_line|#endif /* CONFIG_VERBOSE_MCHECK */
DECL|macro|MARVEL_IO_ERR_VALID
mdefine_line|#define MARVEL_IO_ERR_VALID(x)  ((x) &amp; (1UL &lt;&lt; 63))
r_if
c_cond
(paren
op_logical_neg
id|lf_subpackets-&gt;logout
op_logical_or
op_logical_neg
id|lf_subpackets-&gt;io
)paren
r_return
id|status
suffix:semicolon
multiline_comment|/*&n;&t; * The PALcode only builds an IO subpacket if there is a &n;&t; * locally connected IO7. In the cases of&n;&t; *&t;1) a uniprocessor kernel&n;&t; *&t;2) an mp kernel before the local secondary has called in&n;&t; * error interrupts are all directed to the primary processor.&n;&t; * In that case, we may not have an IO subpacket at all and, event&n;&t; * if we do, it may not be the right now. &n;&t; *&n;&t; * If the RBOX indicates an I/O error interrupt, make sure we have&n;&t; * the correct IO7 information. If we don&squot;t have an IO subpacket&n;&t; * or it&squot;s the wrong one, try to find the right one.&n;&t; *&n;&t; * RBOX I/O error interrupts are indicated by RBOX_INT&lt;29&gt; and&n;&t; * RBOX_INT&lt;10&gt;.&n;&t; */
r_if
c_cond
(paren
(paren
id|lf_subpackets-&gt;io-&gt;po7_error_sum
op_amp
(paren
l_int|1UL
op_lshift
l_int|32
)paren
)paren
op_logical_or
(paren
(paren
id|lf_subpackets-&gt;io-&gt;po7_error_sum
op_or
id|lf_subpackets-&gt;io-&gt;ports
(braket
l_int|0
)braket
dot
id|pox_err_sum
op_or
id|lf_subpackets-&gt;io-&gt;ports
(braket
l_int|1
)braket
dot
id|pox_err_sum
op_or
id|lf_subpackets-&gt;io-&gt;ports
(braket
l_int|2
)braket
dot
id|pox_err_sum
op_or
id|lf_subpackets-&gt;io-&gt;ports
(braket
l_int|3
)braket
dot
id|pox_err_sum
)paren
op_amp
(paren
l_int|1UL
op_lshift
l_int|63
)paren
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * Either we have no IO subpacket or no error is&n;&t;&t; * indicated in the one we do have. Try find the&n;&t;&t; * one with the error.&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|marvel_find_io7_with_error
c_func
(paren
id|lf_subpackets
)paren
)paren
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * We have an IO7 indicating an error - we&squot;re going to report it&n;&t; */
id|status
op_assign
id|MCHK_DISPOSITION_REPORT
suffix:semicolon
macro_line|#ifdef CONFIG_VERBOSE_MCHECK
r_if
c_cond
(paren
op_logical_neg
id|print
)paren
r_return
id|status
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s*Error occurred on IO7 at PID %u&bslash;n&quot;
comma
id|err_print_prefix
comma
id|lf_subpackets-&gt;io_pid
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Check port 7 first&n;&t; */
r_if
c_cond
(paren
id|lf_subpackets-&gt;io-&gt;po7_error_sum
op_amp
id|IO7__PO7_ERRSUM__ERR_MASK
)paren
(brace
id|marvel_print_po7_err_sum
c_func
(paren
id|io
)paren
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;%s  PORT 7 ERROR:&bslash;n&quot;
l_string|&quot;%s    PO7_ERROR_SUM: %016lx&bslash;n&quot;
l_string|&quot;%s    PO7_UNCRR_SYM: %016lx&bslash;n&quot;
l_string|&quot;%s    PO7_CRRCT_SYM: %016lx&bslash;n&quot;
l_string|&quot;%s    PO7_UGBGE_SYM: %016lx&bslash;n&quot;
l_string|&quot;%s    PO7_ERR_PKT0:  %016lx&bslash;n&quot;
l_string|&quot;%s    PO7_ERR_PKT1:  %016lx&bslash;n&quot;
comma
id|err_print_prefix
comma
id|err_print_prefix
comma
id|io-&gt;po7_error_sum
comma
id|err_print_prefix
comma
id|io-&gt;po7_uncrr_sym
comma
id|err_print_prefix
comma
id|io-&gt;po7_crrct_sym
comma
id|err_print_prefix
comma
id|io-&gt;po7_ugbge_sym
comma
id|err_print_prefix
comma
id|io-&gt;po7_err_pkt0
comma
id|err_print_prefix
comma
id|io-&gt;po7_err_pkt1
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n;&t; * Then loop through the ports&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|IO7_NUM_PORTS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|MARVEL_IO_ERR_VALID
c_func
(paren
id|io-&gt;ports
(braket
id|i
)braket
dot
id|pox_err_sum
)paren
)paren
r_continue
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s  PID %u PORT %d POx_ERR_SUM: %016lx&bslash;n&quot;
comma
id|err_print_prefix
comma
id|lf_subpackets-&gt;io_pid
comma
id|i
comma
id|io-&gt;ports
(braket
id|i
)braket
dot
id|pox_err_sum
)paren
suffix:semicolon
id|marvel_print_pox_err
c_func
(paren
id|io-&gt;ports
(braket
id|i
)braket
dot
id|pox_err_sum
comma
op_amp
id|io-&gt;ports
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s  [ POx_FIRST_ERR: %016lx ]&bslash;n&quot;
comma
id|err_print_prefix
comma
id|io-&gt;ports
(braket
id|i
)braket
dot
id|pox_first_err
)paren
suffix:semicolon
id|marvel_print_pox_err
c_func
(paren
id|io-&gt;ports
(braket
id|i
)braket
dot
id|pox_first_err
comma
op_amp
id|io-&gt;ports
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_VERBOSE_MCHECK */
r_return
id|status
suffix:semicolon
)brace
r_static
r_int
DECL|function|marvel_process_logout_frame
id|marvel_process_logout_frame
c_func
(paren
r_struct
id|ev7_lf_subpackets
op_star
id|lf_subpackets
comma
r_int
id|print
)paren
(brace
r_int
id|status
op_assign
id|MCHK_DISPOSITION_UNKNOWN_ERROR
suffix:semicolon
multiline_comment|/*&n;&t; * I/O error? &n;&t; */
DECL|macro|EV7__RBOX_INT__IO_ERROR__MASK
mdefine_line|#define EV7__RBOX_INT__IO_ERROR__MASK 0x20000400ul
r_if
c_cond
(paren
id|lf_subpackets-&gt;logout
op_logical_and
(paren
id|lf_subpackets-&gt;logout-&gt;rbox_int
op_amp
l_int|0x20000400ul
)paren
)paren
id|status
op_assign
id|marvel_process_io_error
c_func
(paren
id|lf_subpackets
comma
id|print
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Probing behind PCI-X bridges can cause machine checks on&n;&t; * Marvel when the probe is handled by the bridge as a split&n;&t; * completion transaction. The symptom is an ERROR_RESPONSE &n;&t; * to a CONFIG address. Since these errors will happen in&n;&t; * normal operation, dismiss them.&n;&t; *&n;&t; * Dismiss if:&n;&t; *&t;C_STAT&t;&t;= 0x14 &t;&t;(Error Reponse)&n;&t; *&t;C_STS&lt;3&gt;&t;= 0    &t;&t;(C_ADDR valid)&n;&t; *&t;C_ADDR&lt;42&gt;&t;= 1    &t;&t;(I/O)&n;&t; *&t;C_ADDR&lt;31:22&gt;&t;= 111110xxb&t;(PCI Config space)&n;&t; */
r_if
c_cond
(paren
id|lf_subpackets-&gt;ev7
op_logical_and
(paren
id|lf_subpackets-&gt;ev7-&gt;c_stat
op_eq
l_int|0x14
)paren
op_logical_and
op_logical_neg
(paren
id|lf_subpackets-&gt;ev7-&gt;c_sts
op_amp
l_int|0x8
)paren
op_logical_and
(paren
(paren
id|lf_subpackets-&gt;ev7-&gt;c_addr
op_amp
l_int|0x400ff000000ul
)paren
op_eq
l_int|0x400fe000000ul
)paren
)paren
id|status
op_assign
id|MCHK_DISPOSITION_DISMISS
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
r_void
DECL|function|marvel_machine_check
id|marvel_machine_check
c_func
(paren
id|u64
id|vector
comma
id|u64
id|la_ptr
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|el_subpacket
op_star
id|el_ptr
op_assign
(paren
r_struct
id|el_subpacket
op_star
)paren
id|la_ptr
suffix:semicolon
r_int
(paren
op_star
id|process_frame
)paren
(paren
r_struct
id|ev7_lf_subpackets
op_star
comma
r_int
)paren
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|ev7_lf_subpackets
id|subpacket_collection
op_assign
(brace
l_int|NULL
comma
)brace
suffix:semicolon
r_struct
id|ev7_pal_io_subpacket
id|scratch_io_packet
op_assign
(brace
l_int|0
comma
)brace
suffix:semicolon
r_struct
id|ev7_lf_subpackets
op_star
id|lf_subpackets
op_assign
l_int|NULL
suffix:semicolon
r_int
id|disposition
op_assign
id|MCHK_DISPOSITION_UNKNOWN_ERROR
suffix:semicolon
r_char
op_star
id|saved_err_prefix
op_assign
id|err_print_prefix
suffix:semicolon
r_char
op_star
id|error_type
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/*&n;&t; * Sync the processor&n;&t; */
id|mb
c_func
(paren
)paren
suffix:semicolon
id|draina
c_func
(paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|vector
)paren
(brace
r_case
id|SCB_Q_SYSEVENT
suffix:colon
id|process_frame
op_assign
id|marvel_process_680_frame
suffix:semicolon
id|error_type
op_assign
l_string|&quot;System Event&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SCB_Q_SYSMCHK
suffix:colon
id|process_frame
op_assign
id|marvel_process_logout_frame
suffix:semicolon
id|error_type
op_assign
l_string|&quot;System Uncorrectable Error&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SCB_Q_SYSERR
suffix:colon
id|process_frame
op_assign
id|marvel_process_logout_frame
suffix:semicolon
id|error_type
op_assign
l_string|&quot;System Correctable Error&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* Don&squot;t know it - pass it up.  */
r_return
id|ev7_machine_check
c_func
(paren
id|vector
comma
id|la_ptr
comma
id|regs
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * A system event or error has occured, handle it here.&n;&t; *&n;&t; * Any errors in the logout frame have already been cleared by the&n;&t; * PALcode, so just parse it.&n;&t; */
id|err_print_prefix
op_assign
id|KERN_CRIT
suffix:semicolon
multiline_comment|/* &n;&t; * Parse the logout frame without printing first. If the only error(s)&n;&t; * found are classified as &quot;dismissable&quot;, then just dismiss them and&n;&t; * don&squot;t print any message&n;&t; */
id|lf_subpackets
op_assign
id|ev7_collect_logout_frame_subpackets
c_func
(paren
id|el_ptr
comma
op_amp
id|subpacket_collection
)paren
suffix:semicolon
r_if
c_cond
(paren
id|process_frame
op_logical_and
id|lf_subpackets
op_logical_and
id|lf_subpackets-&gt;logout
)paren
(brace
multiline_comment|/*&n;&t;&t; * We might not have the correct (or any) I/O subpacket.&n;&t;&t; * [ See marvel_process_io_error() for explanation. ]&n;&t;&t; * If we don&squot;t have one, point the io subpacket in&n;&t;&t; * lf_subpackets at scratch_io_packet so that &n;&t;&t; * marvel_find_io7_with_error() will have someplace to&n;&t;&t; * store the info.&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|lf_subpackets-&gt;io
)paren
id|lf_subpackets-&gt;io
op_assign
op_amp
id|scratch_io_packet
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Default io_pid to the processor reporting the error&n;&t;&t; * [this will get changed in marvel_find_io7_with_error()&n;&t;&t; * if a different one is needed]&n;&t;&t; */
id|lf_subpackets-&gt;io_pid
op_assign
id|lf_subpackets-&gt;logout-&gt;whami
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Evaluate the frames.&n;&t;&t; */
id|disposition
op_assign
id|process_frame
c_func
(paren
id|lf_subpackets
comma
l_int|0
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|disposition
)paren
(brace
r_case
id|MCHK_DISPOSITION_DISMISS
suffix:colon
multiline_comment|/* Nothing to do. */
r_break
suffix:semicolon
r_case
id|MCHK_DISPOSITION_REPORT
suffix:colon
multiline_comment|/* Recognized error, report it. */
id|printk
c_func
(paren
l_string|&quot;%s*%s (Vector 0x%x) reported on CPU %d&bslash;n&quot;
comma
id|err_print_prefix
comma
id|error_type
comma
(paren
r_int
r_int
)paren
id|vector
comma
(paren
r_int
)paren
id|smp_processor_id
c_func
(paren
)paren
)paren
suffix:semicolon
id|el_print_timestamp
c_func
(paren
op_amp
id|lf_subpackets-&gt;logout-&gt;timestamp
)paren
suffix:semicolon
id|process_frame
c_func
(paren
id|lf_subpackets
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* Unknown - dump the annotated subpackets. */
id|printk
c_func
(paren
l_string|&quot;%s*%s (Vector 0x%x) reported on CPU %d&bslash;n&quot;
comma
id|err_print_prefix
comma
id|error_type
comma
(paren
r_int
r_int
)paren
id|vector
comma
(paren
r_int
)paren
id|smp_processor_id
c_func
(paren
)paren
)paren
suffix:semicolon
id|el_process_subpacket
c_func
(paren
id|el_ptr
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|err_print_prefix
op_assign
id|saved_err_prefix
suffix:semicolon
multiline_comment|/* Release the logout frame.  */
id|wrmces
c_func
(paren
l_int|0x7
)paren
suffix:semicolon
id|mb
c_func
(paren
)paren
suffix:semicolon
)brace
r_void
DECL|function|marvel_register_error_handlers
id|marvel_register_error_handlers
c_func
(paren
r_void
)paren
(brace
id|ev7_register_error_handlers
c_func
(paren
)paren
suffix:semicolon
)brace
eof
