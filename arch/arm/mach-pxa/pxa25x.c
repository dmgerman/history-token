multiline_comment|/*&n; *  linux/arch/arm/mach-pxa/pxa25x.c&n; *&n; *  Author:&t;Nicolas Pitre&n; *  Created:&t;Jun 15, 2001&n; *  Copyright:&t;MontaVista Software Inc.&n; *&n; * Code specific to PXA21x/25x/26x variants.&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2 as&n; * published by the Free Software Foundation.&n; *&n; * Since this file should be linked before any other machine specific file,&n; * the __initcall() here will be executed first.  This serves as default&n; * initialization stuff for PXA machines which can be overridden later if&n; * need be.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pm.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
macro_line|#include &quot;generic.h&quot;
multiline_comment|/*&n; * Various clock factors driven by the CCCR register.&n; */
multiline_comment|/* Crystal Frequency to Memory Frequency Multiplier (L) */
DECL|variable|L_clk_mult
r_static
r_int
r_char
id|L_clk_mult
(braket
l_int|32
)braket
op_assign
(brace
l_int|0
comma
l_int|27
comma
l_int|32
comma
l_int|36
comma
l_int|40
comma
l_int|45
comma
l_int|0
comma
)brace
suffix:semicolon
multiline_comment|/* Memory Frequency to Run Mode Frequency Multiplier (M) */
DECL|variable|M_clk_mult
r_static
r_int
r_char
id|M_clk_mult
(braket
l_int|4
)braket
op_assign
(brace
l_int|0
comma
l_int|1
comma
l_int|2
comma
l_int|4
)brace
suffix:semicolon
multiline_comment|/* Run Mode Frequency to Turbo Mode Frequency Multiplier (N) */
multiline_comment|/* Note: we store the value N * 2 here. */
DECL|variable|N2_clk_mult
r_static
r_int
r_char
id|N2_clk_mult
(braket
l_int|8
)braket
op_assign
(brace
l_int|0
comma
l_int|0
comma
l_int|2
comma
l_int|3
comma
l_int|4
comma
l_int|0
comma
l_int|6
comma
l_int|0
)brace
suffix:semicolon
multiline_comment|/* Crystal clock */
DECL|macro|BASE_CLK
mdefine_line|#define BASE_CLK&t;3686400
multiline_comment|/*&n; * Get the clock frequency as reflected by CCCR and the turbo flag.&n; * We assume these values have been applied via a fcs.&n; * If info is not 0 we also display the current settings.&n; */
DECL|function|get_clk_frequency_khz
r_int
r_int
id|get_clk_frequency_khz
c_func
(paren
r_int
id|info
)paren
(brace
r_int
r_int
id|cccr
comma
id|turbo
suffix:semicolon
r_int
r_int
id|l
comma
id|L
comma
id|m
comma
id|M
comma
id|n2
comma
id|N
suffix:semicolon
id|cccr
op_assign
id|CCCR
suffix:semicolon
id|asm
c_func
(paren
l_string|&quot;mrc&bslash;tp14, 0, %0, c6, c0, 0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|turbo
)paren
)paren
suffix:semicolon
id|l
op_assign
id|L_clk_mult
(braket
(paren
id|cccr
op_rshift
l_int|0
)paren
op_amp
l_int|0x1f
)braket
suffix:semicolon
id|m
op_assign
id|M_clk_mult
(braket
(paren
id|cccr
op_rshift
l_int|5
)paren
op_amp
l_int|0x03
)braket
suffix:semicolon
id|n2
op_assign
id|N2_clk_mult
(braket
(paren
id|cccr
op_rshift
l_int|7
)paren
op_amp
l_int|0x07
)braket
suffix:semicolon
id|L
op_assign
id|l
op_star
id|BASE_CLK
suffix:semicolon
id|M
op_assign
id|m
op_star
id|L
suffix:semicolon
id|N
op_assign
id|n2
op_star
id|M
op_div
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|info
)paren
(brace
id|L
op_add_assign
l_int|5000
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Memory clock: %d.%02dMHz (*%d)&bslash;n&quot;
comma
id|L
op_div
l_int|1000000
comma
(paren
id|L
op_mod
l_int|1000000
)paren
op_div
l_int|10000
comma
id|l
)paren
suffix:semicolon
id|M
op_add_assign
l_int|5000
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Run Mode clock: %d.%02dMHz (*%d)&bslash;n&quot;
comma
id|M
op_div
l_int|1000000
comma
(paren
id|M
op_mod
l_int|1000000
)paren
op_div
l_int|10000
comma
id|m
)paren
suffix:semicolon
id|N
op_add_assign
l_int|5000
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Turbo Mode clock: %d.%02dMHz (*%d.%d, %sactive)&bslash;n&quot;
comma
id|N
op_div
l_int|1000000
comma
(paren
id|N
op_mod
l_int|1000000
)paren
op_div
l_int|10000
comma
id|n2
op_div
l_int|2
comma
(paren
id|n2
op_mod
l_int|2
)paren
op_star
l_int|5
comma
(paren
id|turbo
op_amp
l_int|1
)paren
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;in&quot;
)paren
suffix:semicolon
)brace
r_return
(paren
id|turbo
op_amp
l_int|1
)paren
ques
c_cond
(paren
id|N
op_div
l_int|1000
)paren
suffix:colon
(paren
id|M
op_div
l_int|1000
)paren
suffix:semicolon
)brace
DECL|variable|get_clk_frequency_khz
id|EXPORT_SYMBOL
c_func
(paren
id|get_clk_frequency_khz
)paren
suffix:semicolon
multiline_comment|/*&n; * Return the current memory clock frequency in units of 10kHz&n; */
DECL|function|get_memclk_frequency_10khz
r_int
r_int
id|get_memclk_frequency_10khz
c_func
(paren
r_void
)paren
(brace
r_return
id|L_clk_mult
(braket
(paren
id|CCCR
op_rshift
l_int|0
)paren
op_amp
l_int|0x1f
)braket
op_star
id|BASE_CLK
op_div
l_int|10000
suffix:semicolon
)brace
DECL|variable|get_memclk_frequency_10khz
id|EXPORT_SYMBOL
c_func
(paren
id|get_memclk_frequency_10khz
)paren
suffix:semicolon
multiline_comment|/*&n; * Return the current LCD clock frequency in units of 10kHz&n; */
DECL|function|get_lcdclk_frequency_10khz
r_int
r_int
id|get_lcdclk_frequency_10khz
c_func
(paren
r_void
)paren
(brace
r_return
id|get_memclk_frequency_10khz
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|get_lcdclk_frequency_10khz
id|EXPORT_SYMBOL
c_func
(paren
id|get_lcdclk_frequency_10khz
)paren
suffix:semicolon
eof
