multiline_comment|/*&n; *  linux/arch/arm/mach-integrator/irq.c&n; *&n; *  Copyright (C) 1999 ARM Limited&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/mach/irq.h&gt;
multiline_comment|/* &n; * All IO addresses are mapped onto VA 0xFFFx.xxxx, where x.xxxx&n; * is the (PA &gt;&gt; 12).&n; *&n; * Setup a VA for the Integrator interrupt controller (for header #0,&n; * just for now).&n; */
DECL|macro|VA_IC_BASE
mdefine_line|#define VA_IC_BASE              IO_ADDRESS(INTEGRATOR_IC_BASE) 
DECL|macro|VA_CMIC_BASE
mdefine_line|#define VA_CMIC_BASE            IO_ADDRESS(INTEGRATOR_HDR_BASE) + INTEGRATOR_HDR_IC_OFFSET
DECL|macro|ALLPCI
mdefine_line|#define ALLPCI ( (1 &lt;&lt; IRQ_PCIINT0) | (1 &lt;&lt; IRQ_PCIINT1) | (1 &lt;&lt; IRQ_PCIINT2) | (1 &lt;&lt; IRQ_PCIINT3) ) 
DECL|function|sc_mask_irq
r_static
r_void
id|sc_mask_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|__raw_writel
c_func
(paren
l_int|1
op_lshift
id|irq
comma
id|VA_IC_BASE
op_plus
id|IRQ_ENABLE_CLEAR
)paren
suffix:semicolon
)brace
DECL|function|sc_unmask_irq
r_static
r_void
id|sc_unmask_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|__raw_writel
c_func
(paren
l_int|1
op_lshift
id|irq
comma
id|VA_IC_BASE
op_plus
id|IRQ_ENABLE_SET
)paren
suffix:semicolon
)brace
DECL|variable|sc_chip
r_static
r_struct
id|irqchip
id|sc_chip
op_assign
(brace
dot
id|ack
op_assign
id|sc_mask_irq
comma
dot
id|mask
op_assign
id|sc_mask_irq
comma
dot
id|unmask
op_assign
id|sc_unmask_irq
comma
)brace
suffix:semicolon
DECL|function|integrator_init_irq
r_void
id|__init
id|integrator_init_irq
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
multiline_comment|/* Disable all interrupts initially. */
multiline_comment|/* Do the core module ones */
id|__raw_writel
c_func
(paren
op_minus
l_int|1
comma
id|VA_CMIC_BASE
op_plus
id|IRQ_ENABLE_CLEAR
)paren
suffix:semicolon
multiline_comment|/* do the header card stuff next */
id|__raw_writel
c_func
(paren
op_minus
l_int|1
comma
id|VA_IC_BASE
op_plus
id|IRQ_ENABLE_CLEAR
)paren
suffix:semicolon
id|__raw_writel
c_func
(paren
op_minus
l_int|1
comma
id|VA_IC_BASE
op_plus
id|FIQ_ENABLE_CLEAR
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_IRQS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
l_int|1
op_lshift
id|i
)paren
op_logical_and
id|INTEGRATOR_SC_VALID_INT
)paren
op_ne
l_int|0
)paren
(brace
id|set_irq_chip
c_func
(paren
id|i
comma
op_amp
id|sc_chip
)paren
suffix:semicolon
id|set_irq_handler
c_func
(paren
id|i
comma
id|do_level_IRQ
)paren
suffix:semicolon
id|set_irq_flags
c_func
(paren
id|i
comma
id|IRQF_VALID
op_or
id|IRQF_PROBE
)paren
suffix:semicolon
)brace
)brace
)brace
eof
