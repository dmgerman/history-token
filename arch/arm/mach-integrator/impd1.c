multiline_comment|/*&n; *  linux/arch/arm/mach-integrator/impd1.c&n; *&n; *  Copyright (C) 2003 Deep Blue Solutions Ltd, All Rights Reserved.&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2 as&n; * published by the Free Software Foundation.&n; *&n; *  This file provides the core support for the IM-PD1 module.&n; *&n; * Module / boot parameters.&n; *   lmid=n   impd1.lmid=n - set the logic module position in stack to &squot;n&squot;&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/device.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/hardware/icst525.h&gt;
macro_line|#include &lt;asm/hardware/amba.h&gt;
macro_line|#include &lt;asm/hardware/amba_clcd.h&gt;
macro_line|#include &lt;asm/arch/lm.h&gt;
macro_line|#include &lt;asm/arch/impd1.h&gt;
macro_line|#include &lt;asm/sizes.h&gt;
macro_line|#include &quot;clock.h&quot;
DECL|variable|module_id
r_static
r_int
id|module_id
suffix:semicolon
id|module_param_named
c_func
(paren
id|lmid
comma
id|module_id
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|lmid
comma
l_string|&quot;logic module stack position&quot;
)paren
suffix:semicolon
DECL|struct|impd1_module
r_struct
id|impd1_module
(brace
DECL|member|base
r_void
op_star
id|base
suffix:semicolon
DECL|member|vcos
r_struct
id|clk
id|vcos
(braket
l_int|2
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|impd1_vco_params
r_static
r_const
r_struct
id|icst525_params
id|impd1_vco_params
op_assign
(brace
dot
id|ref
op_assign
l_int|24000
comma
multiline_comment|/* 24 MHz */
dot
id|vco_max
op_assign
l_int|200000
comma
multiline_comment|/* 200 MHz */
dot
id|vd_min
op_assign
l_int|12
comma
dot
id|vd_max
op_assign
l_int|519
comma
dot
id|rd_min
op_assign
l_int|3
comma
dot
id|rd_max
op_assign
l_int|120
comma
)brace
suffix:semicolon
DECL|function|impd1_setvco
r_static
r_void
id|impd1_setvco
c_func
(paren
r_struct
id|clk
op_star
id|clk
comma
r_struct
id|icst525_vco
id|vco
)paren
(brace
r_struct
id|impd1_module
op_star
id|impd1
op_assign
id|clk-&gt;data
suffix:semicolon
r_int
id|vconr
op_assign
id|clk
op_minus
id|impd1-&gt;vcos
suffix:semicolon
id|u32
id|val
suffix:semicolon
id|val
op_assign
id|vco.v
op_or
(paren
id|vco.r
op_lshift
l_int|9
)paren
op_or
(paren
id|vco.s
op_lshift
l_int|16
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0xa05f
comma
id|impd1-&gt;base
op_plus
id|IMPD1_LOCK
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|vconr
)paren
(brace
r_case
l_int|0
suffix:colon
id|writel
c_func
(paren
id|val
comma
id|impd1-&gt;base
op_plus
id|IMPD1_OSC1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|writel
c_func
(paren
id|val
comma
id|impd1-&gt;base
op_plus
id|IMPD1_OSC2
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|writel
c_func
(paren
l_int|0
comma
id|impd1-&gt;base
op_plus
id|IMPD1_LOCK
)paren
suffix:semicolon
macro_line|#if DEBUG
id|vco.v
op_assign
id|val
op_amp
l_int|0x1ff
suffix:semicolon
id|vco.r
op_assign
(paren
id|val
op_rshift
l_int|9
)paren
op_amp
l_int|0x7f
suffix:semicolon
id|vco.s
op_assign
(paren
id|val
op_rshift
l_int|16
)paren
op_amp
l_int|7
suffix:semicolon
id|pr_debug
c_func
(paren
l_string|&quot;IM-PD1: VCO%d clock is %ld kHz&bslash;n&quot;
comma
id|vconr
comma
id|icst525_khz
c_func
(paren
op_amp
id|impd1_vco_params
comma
id|vco
)paren
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|impd1_tweak_control
r_void
id|impd1_tweak_control
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
id|u32
id|mask
comma
id|u32
id|val
)paren
(brace
r_struct
id|impd1_module
op_star
id|impd1
op_assign
id|dev_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
id|u32
id|cur
suffix:semicolon
id|val
op_and_assign
id|mask
suffix:semicolon
id|cur
op_assign
id|readl
c_func
(paren
id|impd1-&gt;base
op_plus
id|IMPD1_CTRL
)paren
op_amp
op_complement
id|mask
suffix:semicolon
id|writel
c_func
(paren
id|cur
op_or
id|val
comma
id|impd1-&gt;base
op_plus
id|IMPD1_CTRL
)paren
suffix:semicolon
)brace
DECL|variable|impd1_tweak_control
id|EXPORT_SYMBOL
c_func
(paren
id|impd1_tweak_control
)paren
suffix:semicolon
multiline_comment|/*&n; * CLCD support&n; */
DECL|macro|PANEL
mdefine_line|#define PANEL&t;&t;PROSPECTOR
DECL|macro|LTM10C209
mdefine_line|#define LTM10C209&t;&t;1
DECL|macro|PROSPECTOR
mdefine_line|#define PROSPECTOR&t;&t;2
DECL|macro|SVGA
mdefine_line|#define SVGA&t;&t;&t;3
DECL|macro|VGA
mdefine_line|#define VGA&t;&t;&t;4
macro_line|#if PANEL == VGA
DECL|macro|PANELTYPE
mdefine_line|#define PANELTYPE&t;vga
DECL|variable|vga
r_static
r_struct
id|clcd_panel
id|vga
op_assign
(brace
dot
id|mode
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;VGA&quot;
comma
dot
id|refresh
op_assign
l_int|60
comma
dot
id|xres
op_assign
l_int|640
comma
dot
id|yres
op_assign
l_int|480
comma
dot
id|pixclock
op_assign
l_int|39721
comma
dot
id|left_margin
op_assign
l_int|40
comma
dot
id|right_margin
op_assign
l_int|24
comma
dot
id|upper_margin
op_assign
l_int|32
comma
dot
id|lower_margin
op_assign
l_int|11
comma
dot
id|hsync_len
op_assign
l_int|96
comma
dot
id|vsync_len
op_assign
l_int|2
comma
dot
id|sync
op_assign
l_int|0
comma
dot
id|vmode
op_assign
id|FB_VMODE_NONINTERLACED
comma
)brace
comma
dot
id|width
op_assign
op_minus
l_int|1
comma
dot
id|height
op_assign
op_minus
l_int|1
comma
dot
id|tim2
op_assign
id|TIM2_BCD
op_or
id|TIM2_IPC
comma
dot
id|cntl
op_assign
id|CNTL_LCDTFT
op_or
id|CNTL_LCDVCOMP
c_func
(paren
l_int|1
)paren
comma
dot
id|connector
op_assign
id|IMPD1_CTRL_DISP_VGA
comma
dot
id|bpp
op_assign
l_int|16
comma
dot
id|grayscale
op_assign
l_int|0
comma
)brace
suffix:semicolon
macro_line|#elif PANEL == SVGA
DECL|macro|PANELTYPE
mdefine_line|#define PANELTYPE&t;svga
DECL|variable|svga
r_static
r_struct
id|clcd_panel
id|svga
op_assign
(brace
dot
id|mode
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;SVGA&quot;
comma
dot
id|refresh
op_assign
l_int|0
comma
dot
id|xres
op_assign
l_int|800
comma
dot
id|yres
op_assign
l_int|600
comma
dot
id|pixclock
op_assign
l_int|27778
comma
dot
id|left_margin
op_assign
l_int|20
comma
dot
id|right_margin
op_assign
l_int|20
comma
dot
id|upper_margin
op_assign
l_int|5
comma
dot
id|lower_margin
op_assign
l_int|5
comma
dot
id|hsync_len
op_assign
l_int|164
comma
dot
id|vsync_len
op_assign
l_int|62
comma
dot
id|sync
op_assign
l_int|0
comma
dot
id|vmode
op_assign
id|FB_VMODE_NONINTERLACED
comma
)brace
comma
dot
id|width
op_assign
op_minus
l_int|1
comma
dot
id|height
op_assign
op_minus
l_int|1
comma
dot
id|tim2
op_assign
id|TIM2_BCD
comma
dot
id|cntl
op_assign
id|CNTL_LCDTFT
op_or
id|CNTL_LCDVCOMP
c_func
(paren
l_int|1
)paren
comma
dot
id|connector
op_assign
id|IMPD1_CTRL_DISP_VGA
comma
dot
id|bpp
op_assign
l_int|16
comma
dot
id|grayscale
op_assign
l_int|0
comma
)brace
suffix:semicolon
macro_line|#elif PANEL == PROSPECTOR
DECL|macro|PANELTYPE
mdefine_line|#define PANELTYPE&t;prospector
DECL|variable|prospector
r_static
r_struct
id|clcd_panel
id|prospector
op_assign
(brace
dot
id|mode
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;PROSPECTOR&quot;
comma
dot
id|refresh
op_assign
l_int|0
comma
dot
id|xres
op_assign
l_int|640
comma
dot
id|yres
op_assign
l_int|480
comma
dot
id|pixclock
op_assign
l_int|40000
comma
dot
id|left_margin
op_assign
l_int|33
comma
dot
id|right_margin
op_assign
l_int|64
comma
dot
id|upper_margin
op_assign
l_int|36
comma
dot
id|lower_margin
op_assign
l_int|7
comma
dot
id|hsync_len
op_assign
l_int|64
comma
dot
id|vsync_len
op_assign
l_int|25
comma
dot
id|sync
op_assign
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
dot
id|vmode
op_assign
id|FB_VMODE_NONINTERLACED
comma
)brace
comma
dot
id|width
op_assign
op_minus
l_int|1
comma
dot
id|height
op_assign
op_minus
l_int|1
comma
dot
id|tim2
op_assign
id|TIM2_BCD
comma
dot
id|cntl
op_assign
id|CNTL_LCDTFT
op_or
id|CNTL_LCDVCOMP
c_func
(paren
l_int|1
)paren
comma
dot
id|fixedtimings
op_assign
l_int|1
comma
dot
id|connector
op_assign
id|IMPD1_CTRL_DISP_LCD
comma
dot
id|bpp
op_assign
l_int|16
comma
dot
id|grayscale
op_assign
l_int|0
comma
)brace
suffix:semicolon
macro_line|#elif PANEL == LTM10C209
DECL|macro|PANELTYPE
mdefine_line|#define PANELTYPE&t;ltm10c209
multiline_comment|/*&n; * Untested.&n; */
DECL|variable|ltm10c209
r_static
r_struct
id|clcd_panel
id|ltm10c209
op_assign
(brace
dot
id|mode
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;LTM10C209&quot;
comma
dot
id|refresh
op_assign
l_int|0
comma
dot
id|xres
op_assign
l_int|640
comma
dot
id|yres
op_assign
l_int|480
comma
dot
id|pixclock
op_assign
l_int|40000
comma
dot
id|left_margin
op_assign
l_int|20
comma
dot
id|right_margin
op_assign
l_int|20
comma
dot
id|upper_margin
op_assign
l_int|19
comma
dot
id|lower_margin
op_assign
l_int|19
comma
dot
id|hsync_len
op_assign
l_int|20
comma
dot
id|vsync_len
op_assign
l_int|10
comma
dot
id|sync
op_assign
id|FB_SYNC_HOR_HIGH_ACT
op_or
id|FB_SYNC_VERT_HIGH_ACT
comma
dot
id|vmode
op_assign
id|FB_VMODE_NONINTERLACED
comma
)brace
comma
dot
id|width
op_assign
op_minus
l_int|1
comma
dot
id|height
op_assign
op_minus
l_int|1
comma
dot
id|tim2
op_assign
id|TIM2_BCD
comma
dot
id|cntl
op_assign
id|CNTL_LCDTFT
op_or
id|CNTL_LCDVCOMP
c_func
(paren
l_int|1
)paren
comma
dot
id|fixedtimings
op_assign
l_int|1
comma
dot
id|connector
op_assign
id|IMPD1_CTRL_DISP_LCD
comma
dot
id|bpp
op_assign
l_int|16
comma
dot
id|grayscale
op_assign
l_int|0
comma
)brace
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n; * Disable all display connectors on the interface module.&n; */
DECL|function|impd1fb_clcd_disable
r_static
r_void
id|impd1fb_clcd_disable
c_func
(paren
r_struct
id|clcd_fb
op_star
id|fb
)paren
(brace
id|impd1_tweak_control
c_func
(paren
id|fb-&gt;dev-&gt;dev.parent
comma
id|IMPD1_CTRL_DISP_MASK
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Enable the relevant connector on the interface module.&n; */
DECL|function|impd1fb_clcd_enable
r_static
r_void
id|impd1fb_clcd_enable
c_func
(paren
r_struct
id|clcd_fb
op_star
id|fb
)paren
(brace
id|impd1_tweak_control
c_func
(paren
id|fb-&gt;dev-&gt;dev.parent
comma
id|IMPD1_CTRL_DISP_MASK
comma
id|fb-&gt;panel-&gt;connector
op_or
id|IMPD1_CTRL_DISP_ENABLE
)paren
suffix:semicolon
)brace
DECL|function|impd1fb_clcd_setup
r_static
r_int
id|impd1fb_clcd_setup
c_func
(paren
r_struct
id|clcd_fb
op_star
id|fb
)paren
(brace
r_int
r_int
id|framebase
op_assign
id|fb-&gt;dev-&gt;res.start
op_plus
l_int|0x01000000
suffix:semicolon
r_int
r_int
id|framesize
op_assign
id|SZ_1M
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|fb-&gt;panel
op_assign
op_amp
id|PANELTYPE
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|framebase
comma
id|framesize
comma
l_string|&quot;clcd framebuffer&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;IM-PD1: unable to reserve framebuffer&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|fb-&gt;fb.screen_base
op_assign
id|ioremap
c_func
(paren
id|framebase
comma
id|framesize
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fb-&gt;fb.screen_base
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;IM-PD1: unable to map framebuffer&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|free_buffer
suffix:semicolon
)brace
id|fb-&gt;fb.fix.smem_start
op_assign
id|framebase
suffix:semicolon
id|fb-&gt;fb.fix.smem_len
op_assign
id|framesize
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|free_buffer
suffix:colon
id|release_mem_region
c_func
(paren
id|framebase
comma
id|framesize
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|impd1fb_clcd_remove
r_static
r_void
id|impd1fb_clcd_remove
c_func
(paren
r_struct
id|clcd_fb
op_star
id|fb
)paren
(brace
id|iounmap
c_func
(paren
id|fb-&gt;fb.screen_base
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|fb-&gt;fb.fix.smem_start
comma
id|fb-&gt;fb.fix.smem_len
)paren
suffix:semicolon
)brace
DECL|variable|impd1_clcd_data
r_static
r_struct
id|clcd_board
id|impd1_clcd_data
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;IM-PD/1&quot;
comma
dot
id|check
op_assign
id|clcdfb_check
comma
dot
id|decode
op_assign
id|clcdfb_decode
comma
dot
id|disable
op_assign
id|impd1fb_clcd_disable
comma
dot
id|enable
op_assign
id|impd1fb_clcd_enable
comma
dot
id|setup
op_assign
id|impd1fb_clcd_setup
comma
dot
id|remove
op_assign
id|impd1fb_clcd_remove
comma
)brace
suffix:semicolon
DECL|struct|impd1_device
r_struct
id|impd1_device
(brace
DECL|member|offset
r_int
r_int
id|offset
suffix:semicolon
DECL|member|irq
r_int
r_int
id|irq
(braket
l_int|2
)braket
suffix:semicolon
DECL|member|id
r_int
r_int
id|id
suffix:semicolon
DECL|member|platform_data
r_void
op_star
id|platform_data
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|impd1_devs
r_static
r_struct
id|impd1_device
id|impd1_devs
(braket
)braket
op_assign
(brace
(brace
dot
id|offset
op_assign
l_int|0x03000000
comma
dot
id|id
op_assign
l_int|0x00041190
comma
)brace
comma
(brace
dot
id|offset
op_assign
l_int|0x00100000
comma
dot
id|irq
op_assign
(brace
l_int|1
)brace
comma
dot
id|id
op_assign
l_int|0x00141011
comma
)brace
comma
(brace
dot
id|offset
op_assign
l_int|0x00200000
comma
dot
id|irq
op_assign
(brace
l_int|2
)brace
comma
dot
id|id
op_assign
l_int|0x00141011
comma
)brace
comma
(brace
dot
id|offset
op_assign
l_int|0x00300000
comma
dot
id|irq
op_assign
(brace
l_int|3
)brace
comma
dot
id|id
op_assign
l_int|0x00041022
comma
)brace
comma
(brace
dot
id|offset
op_assign
l_int|0x00400000
comma
dot
id|irq
op_assign
(brace
l_int|4
)brace
comma
dot
id|id
op_assign
l_int|0x00041061
comma
)brace
comma
(brace
dot
id|offset
op_assign
l_int|0x00500000
comma
dot
id|irq
op_assign
(brace
l_int|5
)brace
comma
dot
id|id
op_assign
l_int|0x00041061
comma
)brace
comma
(brace
dot
id|offset
op_assign
l_int|0x00600000
comma
dot
id|irq
op_assign
(brace
l_int|6
)brace
comma
dot
id|id
op_assign
l_int|0x00041130
comma
)brace
comma
(brace
dot
id|offset
op_assign
l_int|0x00700000
comma
dot
id|irq
op_assign
(brace
l_int|7
comma
l_int|8
)brace
comma
dot
id|id
op_assign
l_int|0x00041181
comma
)brace
comma
(brace
dot
id|offset
op_assign
l_int|0x00800000
comma
dot
id|irq
op_assign
(brace
l_int|9
)brace
comma
dot
id|id
op_assign
l_int|0x00041041
comma
)brace
comma
(brace
dot
id|offset
op_assign
l_int|0x01000000
comma
dot
id|irq
op_assign
(brace
l_int|11
)brace
comma
dot
id|id
op_assign
l_int|0x00041110
comma
dot
id|platform_data
op_assign
op_amp
id|impd1_clcd_data
comma
)brace
)brace
suffix:semicolon
DECL|variable|impd1_vconames
r_static
r_const
r_char
op_star
id|impd1_vconames
(braket
l_int|2
)braket
op_assign
(brace
l_string|&quot;CLCDCLK&quot;
comma
l_string|&quot;AUXVCO2&quot;
comma
)brace
suffix:semicolon
DECL|function|impd1_probe
r_static
r_int
id|impd1_probe
c_func
(paren
r_struct
id|lm_device
op_star
id|dev
)paren
(brace
r_struct
id|impd1_module
op_star
id|impd1
suffix:semicolon
r_int
id|i
comma
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;id
op_ne
id|module_id
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|request_mem_region
c_func
(paren
id|dev-&gt;resource.start
comma
id|SZ_4K
comma
l_string|&quot;LM registers&quot;
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|impd1
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|impd1_module
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|impd1
)paren
(brace
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|release_lm
suffix:semicolon
)brace
id|memset
c_func
(paren
id|impd1
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|impd1_module
)paren
)paren
suffix:semicolon
id|impd1-&gt;base
op_assign
id|ioremap
c_func
(paren
id|dev-&gt;resource.start
comma
id|SZ_4K
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|impd1-&gt;base
)paren
(brace
id|ret
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|free_impd1
suffix:semicolon
)brace
id|lm_set_drvdata
c_func
(paren
id|dev
comma
id|impd1
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;IM-PD1 found at 0x%08lx&bslash;n&quot;
comma
id|dev-&gt;resource.start
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|impd1-&gt;vcos
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|impd1-&gt;vcos
(braket
id|i
)braket
dot
id|owner
op_assign
id|THIS_MODULE
comma
id|impd1-&gt;vcos
(braket
id|i
)braket
dot
id|name
op_assign
id|impd1_vconames
(braket
id|i
)braket
comma
id|impd1-&gt;vcos
(braket
id|i
)braket
dot
id|params
op_assign
op_amp
id|impd1_vco_params
comma
id|impd1-&gt;vcos
(braket
id|i
)braket
dot
id|data
op_assign
id|impd1
comma
id|impd1-&gt;vcos
(braket
id|i
)braket
dot
id|setvco
op_assign
id|impd1_setvco
suffix:semicolon
id|clk_register
c_func
(paren
op_amp
id|impd1-&gt;vcos
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|impd1_devs
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|impd1_device
op_star
id|idev
op_assign
id|impd1_devs
op_plus
id|i
suffix:semicolon
r_struct
id|amba_device
op_star
id|d
suffix:semicolon
r_int
r_int
id|pc_base
suffix:semicolon
id|pc_base
op_assign
id|dev-&gt;resource.start
op_plus
id|idev-&gt;offset
suffix:semicolon
id|d
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|amba_device
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|d
)paren
r_continue
suffix:semicolon
id|memset
c_func
(paren
id|d
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|amba_device
)paren
)paren
suffix:semicolon
id|snprintf
c_func
(paren
id|d-&gt;dev.bus_id
comma
r_sizeof
(paren
id|d-&gt;dev.bus_id
)paren
comma
l_string|&quot;lm%x:%5.5lx&quot;
comma
id|dev-&gt;id
comma
id|idev-&gt;offset
op_rshift
l_int|12
)paren
suffix:semicolon
id|d-&gt;dev.parent
op_assign
op_amp
id|dev-&gt;dev
suffix:semicolon
id|d-&gt;res.start
op_assign
id|dev-&gt;resource.start
op_plus
id|idev-&gt;offset
suffix:semicolon
id|d-&gt;res.end
op_assign
id|d-&gt;res.start
op_plus
id|SZ_4K
op_minus
l_int|1
suffix:semicolon
id|d-&gt;res.flags
op_assign
id|IORESOURCE_MEM
suffix:semicolon
id|d-&gt;irq
(braket
l_int|0
)braket
op_assign
id|dev-&gt;irq
suffix:semicolon
id|d-&gt;irq
(braket
l_int|1
)braket
op_assign
id|dev-&gt;irq
suffix:semicolon
id|d-&gt;periphid
op_assign
id|idev-&gt;id
suffix:semicolon
id|d-&gt;dev.platform_data
op_assign
id|idev-&gt;platform_data
suffix:semicolon
id|ret
op_assign
id|amba_device_register
c_func
(paren
id|d
comma
op_amp
id|dev-&gt;resource
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;unable to register device %s: %d&bslash;n&quot;
comma
id|d-&gt;dev.bus_id
comma
id|ret
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
id|free_impd1
suffix:colon
r_if
c_cond
(paren
id|impd1
op_logical_and
id|impd1-&gt;base
)paren
id|iounmap
c_func
(paren
id|impd1-&gt;base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|impd1
)paren
id|kfree
c_func
(paren
id|impd1
)paren
suffix:semicolon
id|release_lm
suffix:colon
id|release_mem_region
c_func
(paren
id|dev-&gt;resource.start
comma
id|SZ_4K
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|impd1_remove
r_static
r_void
id|impd1_remove
c_func
(paren
r_struct
id|lm_device
op_star
id|dev
)paren
(brace
r_struct
id|impd1_module
op_star
id|impd1
op_assign
id|lm_get_drvdata
c_func
(paren
id|dev
)paren
suffix:semicolon
r_struct
id|list_head
op_star
id|l
comma
op_star
id|n
suffix:semicolon
r_int
id|i
suffix:semicolon
id|list_for_each_safe
c_func
(paren
id|l
comma
id|n
comma
op_amp
id|dev-&gt;dev.children
)paren
(brace
r_struct
id|device
op_star
id|d
op_assign
id|list_to_dev
c_func
(paren
id|l
)paren
suffix:semicolon
id|device_unregister
c_func
(paren
id|d
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|impd1-&gt;vcos
)paren
suffix:semicolon
id|i
op_increment
)paren
id|clk_unregister
c_func
(paren
op_amp
id|impd1-&gt;vcos
(braket
id|i
)braket
)paren
suffix:semicolon
id|lm_set_drvdata
c_func
(paren
id|dev
comma
l_int|NULL
)paren
suffix:semicolon
id|iounmap
c_func
(paren
id|impd1-&gt;base
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|impd1
)paren
suffix:semicolon
id|release_mem_region
c_func
(paren
id|dev-&gt;resource.start
comma
id|SZ_4K
)paren
suffix:semicolon
)brace
DECL|variable|impd1_driver
r_static
r_struct
id|lm_driver
id|impd1_driver
op_assign
(brace
dot
id|drv
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;impd1&quot;
comma
)brace
comma
dot
id|probe
op_assign
id|impd1_probe
comma
dot
id|remove
op_assign
id|impd1_remove
comma
)brace
suffix:semicolon
DECL|function|impd1_init
r_static
r_int
id|__init
id|impd1_init
c_func
(paren
r_void
)paren
(brace
r_return
id|lm_driver_register
c_func
(paren
op_amp
id|impd1_driver
)paren
suffix:semicolon
)brace
DECL|function|impd1_exit
r_static
r_void
id|__exit
id|impd1_exit
c_func
(paren
r_void
)paren
(brace
id|lm_driver_unregister
c_func
(paren
op_amp
id|impd1_driver
)paren
suffix:semicolon
)brace
DECL|variable|impd1_init
id|module_init
c_func
(paren
id|impd1_init
)paren
suffix:semicolon
DECL|variable|impd1_exit
id|module_exit
c_func
(paren
id|impd1_exit
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;Integrator/IM-PD1 logic module core driver&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Deep Blue Solutions Ltd&quot;
)paren
suffix:semicolon
eof
