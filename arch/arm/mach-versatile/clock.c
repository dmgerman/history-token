multiline_comment|/*&n; *  linux/arch/arm/mach-versatile/clock.c&n; *&n; *  Copyright (C) 2004 ARM Limited.&n; *  Written by Deep Blue Solutions Limited.&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2 as&n; * published by the Free Software Foundation.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/err.h&gt;
macro_line|#include &lt;asm/semaphore.h&gt;
macro_line|#include &lt;asm/hardware/clock.h&gt;
macro_line|#include &lt;asm/hardware/icst525.h&gt;
macro_line|#include &quot;clock.h&quot;
r_static
id|LIST_HEAD
c_func
(paren
id|clocks
)paren
suffix:semicolon
r_static
id|DECLARE_MUTEX
c_func
(paren
id|clocks_sem
)paren
suffix:semicolon
DECL|function|clk_get
r_struct
id|clk
op_star
id|clk_get
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|id
)paren
(brace
r_struct
id|clk
op_star
id|p
comma
op_star
id|clk
op_assign
id|ERR_PTR
c_func
(paren
op_minus
id|ENOENT
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|clocks_sem
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|p
comma
op_amp
id|clocks
comma
id|node
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|id
comma
id|p-&gt;name
)paren
op_eq
l_int|0
op_logical_and
id|try_module_get
c_func
(paren
id|p-&gt;owner
)paren
)paren
(brace
id|clk
op_assign
id|p
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|clocks_sem
)paren
suffix:semicolon
r_return
id|clk
suffix:semicolon
)brace
DECL|variable|clk_get
id|EXPORT_SYMBOL
c_func
(paren
id|clk_get
)paren
suffix:semicolon
DECL|function|clk_put
r_void
id|clk_put
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
id|module_put
c_func
(paren
id|clk-&gt;owner
)paren
suffix:semicolon
)brace
DECL|variable|clk_put
id|EXPORT_SYMBOL
c_func
(paren
id|clk_put
)paren
suffix:semicolon
DECL|function|clk_enable
r_int
id|clk_enable
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|clk_enable
id|EXPORT_SYMBOL
c_func
(paren
id|clk_enable
)paren
suffix:semicolon
DECL|function|clk_disable
r_void
id|clk_disable
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
)brace
DECL|variable|clk_disable
id|EXPORT_SYMBOL
c_func
(paren
id|clk_disable
)paren
suffix:semicolon
DECL|function|clk_use
r_int
id|clk_use
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|clk_use
id|EXPORT_SYMBOL
c_func
(paren
id|clk_use
)paren
suffix:semicolon
DECL|function|clk_unuse
r_void
id|clk_unuse
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
)brace
DECL|variable|clk_unuse
id|EXPORT_SYMBOL
c_func
(paren
id|clk_unuse
)paren
suffix:semicolon
DECL|function|clk_get_rate
r_int
r_int
id|clk_get_rate
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
r_return
id|clk-&gt;rate
suffix:semicolon
)brace
DECL|variable|clk_get_rate
id|EXPORT_SYMBOL
c_func
(paren
id|clk_get_rate
)paren
suffix:semicolon
DECL|function|clk_round_rate
r_int
id|clk_round_rate
c_func
(paren
r_struct
id|clk
op_star
id|clk
comma
r_int
r_int
id|rate
)paren
(brace
r_return
id|rate
suffix:semicolon
)brace
DECL|variable|clk_round_rate
id|EXPORT_SYMBOL
c_func
(paren
id|clk_round_rate
)paren
suffix:semicolon
DECL|function|clk_set_rate
r_int
id|clk_set_rate
c_func
(paren
r_struct
id|clk
op_star
id|clk
comma
r_int
r_int
id|rate
)paren
(brace
r_int
id|ret
op_assign
op_minus
id|EIO
suffix:semicolon
macro_line|#if 0 
singleline_comment|// Not yet
r_if
c_cond
(paren
id|clk-&gt;setvco
)paren
(brace
r_struct
id|icst525_vco
id|vco
suffix:semicolon
id|vco
op_assign
id|icst525_khz_to_vco
c_func
(paren
id|clk-&gt;params
comma
id|rate
)paren
suffix:semicolon
id|clk-&gt;rate
op_assign
id|icst525_khz
c_func
(paren
id|clk-&gt;params
comma
id|vco
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Clock %s: setting VCO reg params: S=%d R=%d V=%d&bslash;n&quot;
comma
id|clk-&gt;name
comma
id|vco.s
comma
id|vco.r
comma
id|vco.v
)paren
suffix:semicolon
id|clk
op_member_access_from_pointer
id|setvco
c_func
(paren
id|clk
comma
id|vco
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|clk_set_rate
id|EXPORT_SYMBOL
c_func
(paren
id|clk_set_rate
)paren
suffix:semicolon
multiline_comment|/*&n; * These are fixed clocks.&n; */
DECL|variable|kmi_clk
r_static
r_struct
id|clk
id|kmi_clk
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;KMIREFCLK&quot;
comma
dot
id|rate
op_assign
l_int|24000000
comma
)brace
suffix:semicolon
DECL|variable|uart_clk
r_static
r_struct
id|clk
id|uart_clk
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;UARTCLK&quot;
comma
dot
id|rate
op_assign
l_int|24000000
comma
)brace
suffix:semicolon
DECL|variable|mmci_clk
r_static
r_struct
id|clk
id|mmci_clk
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;MCLK&quot;
comma
dot
id|rate
op_assign
l_int|33000000
comma
)brace
suffix:semicolon
DECL|function|clk_register
r_int
id|clk_register
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
id|down
c_func
(paren
op_amp
id|clocks_sem
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|clk-&gt;node
comma
op_amp
id|clocks
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|clocks_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|clk_register
id|EXPORT_SYMBOL
c_func
(paren
id|clk_register
)paren
suffix:semicolon
DECL|function|clk_unregister
r_void
id|clk_unregister
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
id|down
c_func
(paren
op_amp
id|clocks_sem
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|clk-&gt;node
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|clocks_sem
)paren
suffix:semicolon
)brace
DECL|variable|clk_unregister
id|EXPORT_SYMBOL
c_func
(paren
id|clk_unregister
)paren
suffix:semicolon
DECL|function|clk_init
r_static
r_int
id|__init
id|clk_init
c_func
(paren
r_void
)paren
(brace
id|clk_register
c_func
(paren
op_amp
id|kmi_clk
)paren
suffix:semicolon
id|clk_register
c_func
(paren
op_amp
id|uart_clk
)paren
suffix:semicolon
id|clk_register
c_func
(paren
op_amp
id|mmci_clk
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|clk_init
id|arch_initcall
c_func
(paren
id|clk_init
)paren
suffix:semicolon
eof
