multiline_comment|/*&n; * arch/arm/mach-ixp4xx/gtwx5715-pci.c&n; *&n; * Gemtek GTWX5715 (Linksys WRV54G) board setup&n; *&n; * Copyright (C) 2004 George T. Joseph&n; * Derived from Coyote&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version 2&n; * of the License, or (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.&n; *&n; */
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;asm/mach-types.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/arch/gtwx5715.h&gt;
macro_line|#include &lt;asm/mach/pci.h&gt;
r_extern
r_void
id|ixp4xx_pci_preinit
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|ixp4xx_setup
c_func
(paren
r_int
id|nr
comma
r_struct
id|pci_sys_data
op_star
id|sys
)paren
suffix:semicolon
r_extern
r_struct
id|pci_bus
op_star
id|ixp4xx_scan_bus
c_func
(paren
r_int
id|nr
comma
r_struct
id|pci_sys_data
op_star
id|sys
)paren
suffix:semicolon
multiline_comment|/*&n;        * The exact GPIO pins and IRQs are defined in arch-ixp4xx/gtwx5715.h&n;        * Slot 0 isn&squot;t actually populated with a card connector but&n;        * we initialize it anyway in case a future version has the&n;        * slot populated or someone with good soldering skills has&n;        * some free time.&n;        */
DECL|function|gtwx5715_init_gpio
r_static
r_void
id|gtwx5715_init_gpio
c_func
(paren
id|u8
id|pin
comma
id|u32
id|style
)paren
(brace
id|gpio_line_config
c_func
(paren
id|pin
comma
id|style
op_or
id|IXP4XX_GPIO_ACTIVE_LOW
)paren
suffix:semicolon
r_if
c_cond
(paren
id|style
op_amp
id|IXP4XX_GPIO_IN
)paren
id|gpio_line_isr_clear
c_func
(paren
id|pin
)paren
suffix:semicolon
)brace
DECL|function|gtwx5715_pci_preinit
r_void
id|__init
id|gtwx5715_pci_preinit
c_func
(paren
r_void
)paren
(brace
id|gtwx5715_init_gpio
c_func
(paren
id|GTWX5715_PCI_SLOT0_INTA_GPIO
comma
id|IXP4XX_GPIO_IN
)paren
suffix:semicolon
id|gtwx5715_init_gpio
c_func
(paren
id|GTWX5715_PCI_SLOT1_INTA_GPIO
comma
id|IXP4XX_GPIO_IN
)paren
suffix:semicolon
id|ixp4xx_pci_preinit
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|gtwx5715_map_irq
r_static
r_int
id|__init
id|gtwx5715_map_irq
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
id|u8
id|slot
comma
id|u8
id|pin
)paren
(brace
r_int
id|rc
suffix:semicolon
r_static
r_int
id|gtwx5715_irqmap
(braket
id|GTWX5715_PCI_SLOT_COUNT
)braket
(braket
id|GTWX5715_PCI_INT_PIN_COUNT
)braket
op_assign
(brace
(brace
id|GTWX5715_PCI_SLOT0_INTA_IRQ
comma
id|GTWX5715_PCI_SLOT0_INTB_IRQ
)brace
comma
(brace
id|GTWX5715_PCI_SLOT1_INTA_IRQ
comma
id|GTWX5715_PCI_SLOT1_INTB_IRQ
)brace
comma
)brace
suffix:semicolon
r_if
c_cond
(paren
id|slot
op_ge
id|GTWX5715_PCI_SLOT_COUNT
op_logical_or
id|pin
op_ge
id|GTWX5715_PCI_INT_PIN_COUNT
)paren
id|rc
op_assign
op_minus
l_int|1
suffix:semicolon
r_else
id|rc
op_assign
id|gtwx5715_irqmap
(braket
id|slot
)braket
(braket
id|pin
op_minus
l_int|1
)braket
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: Mapped slot %d pin %d to IRQ %d&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|slot
comma
id|pin
comma
id|rc
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|variable|__initdata
r_struct
id|hw_pci
id|gtwx5715_pci
id|__initdata
op_assign
(brace
dot
id|nr_controllers
op_assign
l_int|1
comma
dot
id|preinit
op_assign
id|gtwx5715_pci_preinit
comma
dot
id|swizzle
op_assign
id|pci_std_swizzle
comma
dot
id|setup
op_assign
id|ixp4xx_setup
comma
dot
id|scan
op_assign
id|ixp4xx_scan_bus
comma
dot
id|map_irq
op_assign
id|gtwx5715_map_irq
comma
)brace
suffix:semicolon
DECL|function|gtwx5715_pci_init
r_int
id|__init
id|gtwx5715_pci_init
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|machine_is_gtwx5715
c_func
(paren
)paren
)paren
(brace
id|pci_common_init
c_func
(paren
op_amp
id|gtwx5715_pci
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|gtwx5715_pci_init
id|subsys_initcall
c_func
(paren
id|gtwx5715_pci_init
)paren
suffix:semicolon
eof
