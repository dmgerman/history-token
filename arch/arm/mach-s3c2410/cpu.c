multiline_comment|/* linux/arch/arm/mach-s3c2410/cpu.c&n; *&n; * Copyright (c) 2004 Simtec Electronics&n; * Ben Dooks &lt;ben@simtec.co.uk&gt;&n; *&n; * S3C24XX CPU Support&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n;*/
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/device.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/delay.h&gt;
macro_line|#include &lt;asm/mach/arch.h&gt;
macro_line|#include &lt;asm/mach/map.h&gt;
macro_line|#include &lt;asm/arch/regs-gpio.h&gt;
macro_line|#include &quot;cpu.h&quot;
macro_line|#include &quot;clock.h&quot;
macro_line|#include &quot;s3c2410.h&quot;
macro_line|#include &quot;s3c2440.h&quot;
DECL|struct|cpu_table
r_struct
id|cpu_table
(brace
DECL|member|idcode
r_int
r_int
id|idcode
suffix:semicolon
DECL|member|idmask
r_int
r_int
id|idmask
suffix:semicolon
DECL|member|map_io
r_void
(paren
op_star
id|map_io
)paren
(paren
r_struct
id|map_desc
op_star
id|mach_desc
comma
r_int
id|size
)paren
suffix:semicolon
DECL|member|init
r_int
(paren
op_star
id|init
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* table of supported CPUs */
DECL|variable|name_s3c2410
r_static
r_const
r_char
id|name_s3c2410
(braket
)braket
op_assign
l_string|&quot;S3C2410&quot;
suffix:semicolon
DECL|variable|name_s3c2440
r_static
r_const
r_char
id|name_s3c2440
(braket
)braket
op_assign
l_string|&quot;S3C2440&quot;
suffix:semicolon
DECL|variable|name_s3c2410a
r_static
r_const
r_char
id|name_s3c2410a
(braket
)braket
op_assign
l_string|&quot;S3C2410A&quot;
suffix:semicolon
DECL|variable|name_s3c2440a
r_static
r_const
r_char
id|name_s3c2440a
(braket
)braket
op_assign
l_string|&quot;S3C2440A&quot;
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|cpu_table
id|cpu_ids
(braket
)braket
id|__initdata
op_assign
(brace
(brace
dot
id|idcode
op_assign
l_int|0x32410000
comma
dot
id|idmask
op_assign
l_int|0xffffffff
comma
dot
id|map_io
op_assign
id|s3c2410_map_io
comma
dot
id|init
op_assign
id|s3c2410_init
comma
dot
id|name
op_assign
id|name_s3c2410
)brace
comma
(brace
dot
id|idcode
op_assign
l_int|0x3241002
comma
dot
id|idmask
op_assign
l_int|0xffffffff
comma
dot
id|map_io
op_assign
id|s3c2410_map_io
comma
dot
id|init
op_assign
id|s3c2410_init
comma
dot
id|name
op_assign
id|name_s3c2410a
)brace
comma
(brace
dot
id|idcode
op_assign
l_int|0x32440000
comma
dot
id|idmask
op_assign
l_int|0xffffffff
comma
dot
id|map_io
op_assign
id|s3c2440_map_io
comma
dot
id|init
op_assign
id|s3c2440_init
comma
dot
id|name
op_assign
id|name_s3c2440
)brace
comma
(brace
dot
id|idcode
op_assign
l_int|0x32440001
comma
dot
id|idmask
op_assign
l_int|0xffffffff
comma
dot
id|map_io
op_assign
id|s3c2440_map_io
comma
dot
id|init
op_assign
id|s3c2440_init
comma
dot
id|name
op_assign
id|name_s3c2440a
)brace
)brace
suffix:semicolon
multiline_comment|/* minimal IO mapping */
DECL|variable|__initdata
r_static
r_struct
id|map_desc
id|s3c_iodesc
(braket
)braket
id|__initdata
op_assign
(brace
id|IODESC_ENT
c_func
(paren
id|GPIO
)paren
comma
id|IODESC_ENT
c_func
(paren
id|IRQ
)paren
comma
id|IODESC_ENT
c_func
(paren
id|MEMCTRL
)paren
comma
id|IODESC_ENT
c_func
(paren
id|UART
)paren
)brace
suffix:semicolon
r_static
r_struct
id|cpu_table
op_star
DECL|function|s3c_lookup_cpu
id|s3c_lookup_cpu
c_func
(paren
r_int
r_int
id|idcode
)paren
(brace
r_struct
id|cpu_table
op_star
id|tab
suffix:semicolon
r_int
id|count
suffix:semicolon
id|tab
op_assign
id|cpu_ids
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
id|ARRAY_SIZE
c_func
(paren
id|cpu_ids
)paren
suffix:semicolon
id|count
op_increment
comma
id|tab
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|idcode
op_amp
id|tab-&gt;idmask
)paren
op_eq
id|tab-&gt;idcode
)paren
r_return
id|tab
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* board information */
DECL|variable|board
r_static
r_struct
id|s3c24xx_board
op_star
id|board
suffix:semicolon
DECL|function|s3c24xx_set_board
r_void
id|s3c24xx_set_board
c_func
(paren
r_struct
id|s3c24xx_board
op_star
id|b
)paren
(brace
r_int
id|i
suffix:semicolon
id|board
op_assign
id|b
suffix:semicolon
r_if
c_cond
(paren
id|b-&gt;clocks_count
op_ne
l_int|0
)paren
(brace
r_struct
id|clk
op_star
op_star
id|ptr
op_assign
id|b-&gt;clocks
suffix:semicolon
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|b-&gt;clocks_count
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
comma
id|ptr
op_increment
)paren
id|s3c2410_register_clock
c_func
(paren
op_star
id|ptr
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* cpu information */
DECL|variable|cpu
r_static
r_struct
id|cpu_table
op_star
id|cpu
suffix:semicolon
DECL|function|s3c24xx_init_io
r_void
id|__init
id|s3c24xx_init_io
c_func
(paren
r_struct
id|map_desc
op_star
id|mach_desc
comma
r_int
id|size
)paren
(brace
r_int
r_int
id|idcode
suffix:semicolon
multiline_comment|/* initialise the io descriptors we need for initialisation */
id|iotable_init
c_func
(paren
id|s3c_iodesc
comma
id|ARRAY_SIZE
c_func
(paren
id|s3c_iodesc
)paren
)paren
suffix:semicolon
id|idcode
op_assign
id|__raw_readl
c_func
(paren
id|S3C2410_GSTATUS1
)paren
suffix:semicolon
id|cpu
op_assign
id|s3c_lookup_cpu
c_func
(paren
id|idcode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpu
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Unknown CPU type 0x%08lx&bslash;n&quot;
comma
id|idcode
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;Unknown S3C24XX CPU&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cpu-&gt;map_io
op_eq
l_int|NULL
op_logical_or
id|cpu-&gt;init
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;CPU %s support not enabled&bslash;n&quot;
comma
id|cpu-&gt;name
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;Unsupported S3C24XX CPU&quot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;CPU %s (id 0x%08lx)&bslash;n&quot;
comma
id|cpu-&gt;name
comma
id|idcode
)paren
suffix:semicolon
(paren
id|cpu-&gt;map_io
)paren
(paren
id|mach_desc
comma
id|size
)paren
suffix:semicolon
)brace
DECL|function|s3c_arch_init
r_static
r_int
id|__init
id|s3c_arch_init
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
suffix:semicolon
singleline_comment|// do the correct init for cpu
r_if
c_cond
(paren
id|cpu
op_eq
l_int|NULL
)paren
id|panic
c_func
(paren
l_string|&quot;s3c_arch_init: NULL cpu&bslash;n&quot;
)paren
suffix:semicolon
id|ret
op_assign
(paren
id|cpu-&gt;init
)paren
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
l_int|0
)paren
r_return
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|board
op_ne
l_int|NULL
)paren
(brace
id|ret
op_assign
id|platform_add_devices
c_func
(paren
id|board-&gt;devices
comma
id|board-&gt;devices_count
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;s3c24xx: failed to add board devices (%d)&bslash;n&quot;
comma
id|ret
)paren
suffix:semicolon
)brace
multiline_comment|/* mask any error, we may not need all these board&n;&t;&t; * devices */
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|s3c_arch_init
id|arch_initcall
c_func
(paren
id|s3c_arch_init
)paren
suffix:semicolon
eof
