multiline_comment|/* arch/arm/mach-lh7a40x/irq-lh7a404.c&n; *&n; *  Copyright (C) 2004 Logic Product Development&n; *&n; *  This program is free software; you can redistribute it and/or&n; *  modify it under the terms of the GNU General Public License&n; *  version 2 as published by the Free Software Foundation.&n; *&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/mach/irq.h&gt;
macro_line|#include &lt;asm/arch/irq.h&gt;
macro_line|#include &lt;asm/arch/irqs.h&gt;
DECL|macro|USE_PRIORITIES
mdefine_line|#define USE_PRIORITIES
multiline_comment|/* See Documentation/arm/Sharp-LH/VectoredInterruptController for more&n; * information on using the vectored interrupt controller&squot;s&n; * prioritizing feature. */
DECL|variable|irq_pri_vic1
r_static
r_int
r_char
id|irq_pri_vic1
(braket
)braket
op_assign
(brace
macro_line|#if defined (USE_PRIORITIES)
id|IRQ_GPIO3INTR
comma
macro_line|#endif
)brace
suffix:semicolon
DECL|variable|irq_pri_vic2
r_static
r_int
r_char
id|irq_pri_vic2
(braket
)braket
op_assign
(brace
macro_line|#if defined (USE_PRIORITIES)
id|IRQ_T3UI
comma
id|IRQ_GPIO7INTR
comma
id|IRQ_UART1INTR
comma
id|IRQ_UART2INTR
comma
id|IRQ_UART3INTR
comma
macro_line|#endif
)brace
suffix:semicolon
multiline_comment|/* CPU IRQ handling */
DECL|function|lh7a404_vic1_mask_irq
r_static
r_void
id|lh7a404_vic1_mask_irq
(paren
id|u32
id|irq
)paren
(brace
id|VIC1_INTENCLR
op_assign
(paren
l_int|1
op_lshift
id|irq
)paren
suffix:semicolon
)brace
DECL|function|lh7a404_vic1_unmask_irq
r_static
r_void
id|lh7a404_vic1_unmask_irq
(paren
id|u32
id|irq
)paren
(brace
id|VIC1_INTEN
op_assign
(paren
l_int|1
op_lshift
id|irq
)paren
suffix:semicolon
)brace
DECL|function|lh7a404_vic2_mask_irq
r_static
r_void
id|lh7a404_vic2_mask_irq
(paren
id|u32
id|irq
)paren
(brace
id|VIC2_INTENCLR
op_assign
(paren
l_int|1
op_lshift
(paren
id|irq
op_minus
l_int|32
)paren
)paren
suffix:semicolon
)brace
DECL|function|lh7a404_vic2_unmask_irq
r_static
r_void
id|lh7a404_vic2_unmask_irq
(paren
id|u32
id|irq
)paren
(brace
id|VIC2_INTEN
op_assign
(paren
l_int|1
op_lshift
(paren
id|irq
op_minus
l_int|32
)paren
)paren
suffix:semicolon
)brace
DECL|function|lh7a404_vic1_ack_gpio_irq
r_static
r_void
id|lh7a404_vic1_ack_gpio_irq
(paren
id|u32
id|irq
)paren
(brace
id|GPIO_GPIOFEOI
op_assign
(paren
l_int|1
op_lshift
id|IRQ_TO_GPIO
(paren
id|irq
)paren
)paren
suffix:semicolon
id|VIC1_INTENCLR
op_assign
(paren
l_int|1
op_lshift
id|irq
)paren
suffix:semicolon
)brace
DECL|function|lh7a404_vic2_ack_gpio_irq
r_static
r_void
id|lh7a404_vic2_ack_gpio_irq
(paren
id|u32
id|irq
)paren
(brace
id|GPIO_GPIOFEOI
op_assign
(paren
l_int|1
op_lshift
id|IRQ_TO_GPIO
(paren
id|irq
)paren
)paren
suffix:semicolon
id|VIC2_INTENCLR
op_assign
(paren
l_int|1
op_lshift
id|irq
)paren
suffix:semicolon
)brace
DECL|variable|lh7a404_vic1_chip
r_static
r_struct
id|irqchip
id|lh7a404_vic1_chip
op_assign
(brace
dot
id|ack
op_assign
id|lh7a404_vic1_mask_irq
comma
multiline_comment|/* Because level-triggered */
dot
id|mask
op_assign
id|lh7a404_vic1_mask_irq
comma
dot
id|unmask
op_assign
id|lh7a404_vic1_unmask_irq
comma
)brace
suffix:semicolon
DECL|variable|lh7a404_vic2_chip
r_static
r_struct
id|irqchip
id|lh7a404_vic2_chip
op_assign
(brace
dot
id|ack
op_assign
id|lh7a404_vic2_mask_irq
comma
multiline_comment|/* Because level-triggered */
dot
id|mask
op_assign
id|lh7a404_vic2_mask_irq
comma
dot
id|unmask
op_assign
id|lh7a404_vic2_unmask_irq
comma
)brace
suffix:semicolon
DECL|variable|lh7a404_gpio_vic1_chip
r_static
r_struct
id|irqchip
id|lh7a404_gpio_vic1_chip
op_assign
(brace
dot
id|ack
op_assign
id|lh7a404_vic1_ack_gpio_irq
comma
dot
id|mask
op_assign
id|lh7a404_vic1_mask_irq
comma
dot
id|unmask
op_assign
id|lh7a404_vic1_unmask_irq
comma
)brace
suffix:semicolon
DECL|variable|lh7a404_gpio_vic2_chip
r_static
r_struct
id|irqchip
id|lh7a404_gpio_vic2_chip
op_assign
(brace
dot
id|ack
op_assign
id|lh7a404_vic2_ack_gpio_irq
comma
dot
id|mask
op_assign
id|lh7a404_vic2_mask_irq
comma
dot
id|unmask
op_assign
id|lh7a404_vic2_unmask_irq
comma
)brace
suffix:semicolon
multiline_comment|/* IRQ initialization */
DECL|function|lh7a404_init_irq
r_void
id|__init
id|lh7a404_init_irq
(paren
r_void
)paren
(brace
r_int
id|irq
suffix:semicolon
id|VIC1_INTENCLR
op_assign
l_int|0xffffffff
suffix:semicolon
id|VIC2_INTENCLR
op_assign
l_int|0xffffffff
suffix:semicolon
id|VIC1_INTSEL
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* All IRQs */
id|VIC2_INTSEL
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* All IRQs */
id|VIC1_NVADDR
op_assign
id|VA_VIC1DEFAULT
suffix:semicolon
id|VIC2_NVADDR
op_assign
id|VA_VIC2DEFAULT
suffix:semicolon
id|VIC1_VECTADDR
op_assign
l_int|0
suffix:semicolon
id|VIC2_VECTADDR
op_assign
l_int|0
suffix:semicolon
id|GPIO_GPIOFINTEN
op_assign
l_int|0x00
suffix:semicolon
multiline_comment|/* Disable all GPIOF interrupts */
id|barrier
(paren
)paren
suffix:semicolon
multiline_comment|/* Install prioritized interrupts, if there are any. */
multiline_comment|/* The | 0x20*/
r_for
c_loop
(paren
id|irq
op_assign
l_int|0
suffix:semicolon
id|irq
OL
l_int|16
suffix:semicolon
op_increment
id|irq
)paren
(brace
(paren
op_amp
id|VIC1_VAD0
)paren
(braket
id|irq
)braket
op_assign
(paren
id|irq
OL
id|ARRAY_SIZE
(paren
id|irq_pri_vic1
)paren
)paren
ques
c_cond
(paren
id|irq_pri_vic1
(braket
id|irq
)braket
op_or
id|VA_VECTORED
)paren
suffix:colon
l_int|0
suffix:semicolon
(paren
op_amp
id|VIC1_VECTCNTL0
)paren
(braket
id|irq
)braket
op_assign
(paren
id|irq
OL
id|ARRAY_SIZE
(paren
id|irq_pri_vic1
)paren
)paren
ques
c_cond
(paren
id|irq_pri_vic1
(braket
id|irq
)braket
op_or
id|VIC_CNTL_ENABLE
)paren
suffix:colon
l_int|0
suffix:semicolon
(paren
op_amp
id|VIC2_VAD0
)paren
(braket
id|irq
)braket
op_assign
(paren
id|irq
OL
id|ARRAY_SIZE
(paren
id|irq_pri_vic2
)paren
)paren
ques
c_cond
(paren
id|irq_pri_vic2
(braket
id|irq
)braket
op_or
id|VA_VECTORED
)paren
suffix:colon
l_int|0
suffix:semicolon
(paren
op_amp
id|VIC2_VECTCNTL0
)paren
(braket
id|irq
)braket
op_assign
(paren
id|irq
OL
id|ARRAY_SIZE
(paren
id|irq_pri_vic2
)paren
)paren
ques
c_cond
(paren
id|irq_pri_vic2
(braket
id|irq
)braket
op_or
id|VIC_CNTL_ENABLE
)paren
suffix:colon
l_int|0
suffix:semicolon
)brace
r_for
c_loop
(paren
id|irq
op_assign
l_int|0
suffix:semicolon
id|irq
OL
id|NR_IRQS
suffix:semicolon
op_increment
id|irq
)paren
(brace
r_switch
c_cond
(paren
id|irq
)paren
(brace
r_case
id|IRQ_GPIO0INTR
suffix:colon
r_case
id|IRQ_GPIO1INTR
suffix:colon
r_case
id|IRQ_GPIO2INTR
suffix:colon
r_case
id|IRQ_GPIO3INTR
suffix:colon
r_case
id|IRQ_GPIO4INTR
suffix:colon
r_case
id|IRQ_GPIO5INTR
suffix:colon
r_case
id|IRQ_GPIO6INTR
suffix:colon
r_case
id|IRQ_GPIO7INTR
suffix:colon
id|set_irq_chip
(paren
id|irq
comma
id|irq
OL
l_int|32
ques
c_cond
op_amp
id|lh7a404_gpio_vic1_chip
suffix:colon
op_amp
id|lh7a404_gpio_vic2_chip
)paren
suffix:semicolon
id|set_irq_handler
(paren
id|irq
comma
id|do_level_IRQ
)paren
suffix:semicolon
multiline_comment|/* OK default */
r_break
suffix:semicolon
r_default
suffix:colon
id|set_irq_chip
(paren
id|irq
comma
id|irq
OL
l_int|32
ques
c_cond
op_amp
id|lh7a404_vic1_chip
suffix:colon
op_amp
id|lh7a404_vic2_chip
)paren
suffix:semicolon
id|set_irq_handler
(paren
id|irq
comma
id|do_level_IRQ
)paren
suffix:semicolon
)brace
id|set_irq_flags
(paren
id|irq
comma
id|IRQF_VALID
)paren
suffix:semicolon
)brace
id|lh7a40x_init_board_irq
(paren
)paren
suffix:semicolon
)brace
eof
