multiline_comment|/*&n; *  linux/arch/arm/mach-sa1100/dma-sa1111.c&n; *&n; *  Copyright (C) 2000 John Dorsey&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License version 2 as&n; *  published by the Free Software Foundation.&n; *&n; *  4 September 2000 - created.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
singleline_comment|// #define DEBUG
macro_line|#ifdef DEBUG
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK( s, arg... )  printk( &quot;dma&lt;%s&gt;: &quot; s, dma-&gt;device_id , ##arg )
macro_line|#else
DECL|macro|DPRINTK
mdefine_line|#define DPRINTK( x... )
macro_line|#endif
multiline_comment|/*&n; * Control register structure for the SA1111 SAC DMA&n; */
r_typedef
r_struct
(brace
DECL|member|SAD_CS
r_volatile
id|u_long
id|SAD_CS
suffix:semicolon
DECL|member|SAD_SA
r_volatile
id|dma_addr_t
id|SAD_SA
suffix:semicolon
DECL|member|SAD_CA
r_volatile
id|u_long
id|SAD_CA
suffix:semicolon
DECL|member|SAD_SB
r_volatile
id|dma_addr_t
id|SAD_SB
suffix:semicolon
DECL|member|SAD_CB
r_volatile
id|u_long
id|SAD_CB
suffix:semicolon
DECL|typedef|dma_regs_t
)brace
id|dma_regs_t
suffix:semicolon
macro_line|#include &quot;dma.h&quot;
DECL|function|sa1111_reset_sac_dma
r_void
id|sa1111_reset_sac_dma
c_func
(paren
id|dmach_t
id|channel
)paren
(brace
id|sa1100_dma_t
op_star
id|dma
op_assign
op_amp
id|dma_chan
(braket
id|channel
)braket
suffix:semicolon
id|dma-&gt;regs-&gt;SAD_CS
op_assign
l_int|0
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|dma-&gt;dma_a
op_assign
id|dma-&gt;dma_b
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|start_sa1111_sac_dma
r_int
id|start_sa1111_sac_dma
c_func
(paren
id|sa1100_dma_t
op_star
id|dma
comma
id|dma_addr_t
id|dma_ptr
comma
r_int
id|size
)paren
(brace
id|dma_regs_t
op_star
id|sac_regs
op_assign
id|dma-&gt;regs
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot; SAC DMA %cCS %02x at %08x (%d)&bslash;n&quot;
comma
(paren
id|sac_regs
op_eq
op_amp
id|SADTCS
)paren
ques
c_cond
l_char|&squot;T&squot;
suffix:colon
l_char|&squot;R&squot;
comma
id|sac_regs-&gt;SAD_CS
comma
id|dma_ptr
comma
id|size
)paren
suffix:semicolon
multiline_comment|/* The minimum transfer length requirement has not yet been&n;&t; * verified:&n;&t; */
r_if
c_cond
(paren
id|size
OL
id|SA1111_SAC_DMA_MIN_XFER
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Warning: SAC xfers below %u bytes may be buggy!&quot;
l_string|&quot; (%u bytes)&bslash;n&quot;
comma
id|SA1111_SAC_DMA_MIN_XFER
comma
id|size
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dma-&gt;dma_a
op_logical_and
id|dma-&gt;dma_b
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;  neither engine available! (A %d, B %d)&bslash;n&quot;
comma
id|dma-&gt;dma_a
comma
id|dma-&gt;dma_b
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sa1111_check_dma_bug
c_func
(paren
id|dma_ptr
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Warning: DMA address %08x is buggy!&bslash;n&quot;
comma
id|dma_ptr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dma-&gt;last_dma
op_logical_or
id|dma-&gt;dma_b
)paren
op_logical_and
id|dma-&gt;dma_a
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|sac_regs-&gt;SAD_CS
op_amp
id|SAD_CS_DBDB
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;  awaiting &bslash;&quot;done B&bslash;&quot; interrupt, not starting&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|sac_regs-&gt;SAD_SA
op_assign
id|SA1111_DMA_ADDR
c_func
(paren
(paren
id|u_int
)paren
id|dma_ptr
)paren
suffix:semicolon
id|sac_regs-&gt;SAD_CA
op_assign
id|size
suffix:semicolon
id|sac_regs-&gt;SAD_CS
op_assign
id|SAD_CS_DSTA
op_or
id|SAD_CS_DEN
suffix:semicolon
op_increment
id|dma-&gt;dma_a
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;  with A [%02lx %08lx %04lx]&bslash;n&quot;
comma
id|sac_regs-&gt;SAD_CS
comma
id|sac_regs-&gt;SAD_SA
comma
id|sac_regs-&gt;SAD_CA
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|sac_regs-&gt;SAD_CS
op_amp
id|SAD_CS_DBDA
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;  awaiting &bslash;&quot;done A&bslash;&quot; interrupt, not starting&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|sac_regs-&gt;SAD_SB
op_assign
id|SA1111_DMA_ADDR
c_func
(paren
(paren
id|u_int
)paren
id|dma_ptr
)paren
suffix:semicolon
id|sac_regs-&gt;SAD_CB
op_assign
id|size
suffix:semicolon
id|sac_regs-&gt;SAD_CS
op_assign
id|SAD_CS_DSTB
op_or
id|SAD_CS_DEN
suffix:semicolon
op_increment
id|dma-&gt;dma_b
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;  with B [%02lx %08lx %04lx]&bslash;n&quot;
comma
id|sac_regs-&gt;SAD_CS
comma
id|sac_regs-&gt;SAD_SB
comma
id|sac_regs-&gt;SAD_CB
)paren
suffix:semicolon
)brace
multiline_comment|/* Additional delay to avoid DMA engine lockup during record: */
r_if
c_cond
(paren
id|sac_regs
op_eq
(paren
id|dma_regs_t
op_star
)paren
op_amp
id|SADRCS
)paren
(brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/* NP : wouuuh! ugly... */
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sa1111_sac_dma_irq
r_static
r_void
id|sa1111_sac_dma_irq
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|sa1100_dma_t
op_star
id|dma
op_assign
(paren
id|sa1100_dma_t
op_star
)paren
id|dev_id
suffix:semicolon
id|DPRINTK
c_func
(paren
l_string|&quot;irq %d, last DMA serviced was %c, CS %02x&bslash;n&quot;
comma
id|irq
comma
id|dma-&gt;last_dma
ques
c_cond
l_char|&squot;B&squot;
suffix:colon
l_char|&squot;A&squot;
comma
id|dma-&gt;regs-&gt;SAD_CS
)paren
suffix:semicolon
multiline_comment|/* Occasionally, one of the DMA engines (A or B) will&n;&t; * lock up. We try to deal with this by quietly kicking&n;&t; * the control register for the afflicted transfer&n;&t; * direction.&n;&t; *&n;&t; * Note for the debugging-inclined: we currently aren&squot;t&n;&t; * properly flushing the DMA engines during channel&n;&t; * shutdown. A slight hiccup at the beginning of playback&n;&t; * after a channel has been stopped can be heard as&n;&t; * evidence of this. Programmatically, this shows up&n;&t; * as either a locked engine, or a spurious interrupt. -jd&n;&t; */
r_if
c_cond
(paren
id|irq
op_eq
id|AUDXMTDMADONEA
op_logical_or
id|irq
op_eq
id|AUDRCVDMADONEA
)paren
(brace
r_if
c_cond
(paren
id|dma-&gt;last_dma
op_eq
l_int|0
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;DMA B has locked up!&bslash;n&quot;
)paren
suffix:semicolon
id|dma-&gt;regs-&gt;SAD_CS
op_assign
l_int|0
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|dma-&gt;dma_a
op_assign
id|dma-&gt;dma_b
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|dma-&gt;dma_a
op_eq
l_int|0
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;spurious SAC IRQ %d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
)brace
r_else
(brace
op_decrement
id|dma-&gt;dma_a
suffix:semicolon
multiline_comment|/* Servicing the SAC DMA engines too quickly&n;&t;&t;&t;&t; * after they issue a DONE interrupt causes&n;&t;&t;&t;&t; * them to lock up.&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|irq
op_eq
id|AUDRCVDMADONEA
op_logical_or
id|irq
op_eq
id|AUDRCVDMADONEB
)paren
(brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
)brace
)brace
id|dma-&gt;regs-&gt;SAD_CS
op_assign
id|SAD_CS_DBDA
op_or
id|SAD_CS_DEN
suffix:semicolon
multiline_comment|/* w1c */
id|dma-&gt;last_dma
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|dma-&gt;last_dma
op_eq
l_int|1
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;DMA A has locked up!&bslash;n&quot;
)paren
suffix:semicolon
id|dma-&gt;regs-&gt;SAD_CS
op_assign
l_int|0
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|dma-&gt;dma_a
op_assign
id|dma-&gt;dma_b
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|dma-&gt;dma_b
op_eq
l_int|0
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;spurious SAC IRQ %d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
)brace
r_else
(brace
op_decrement
id|dma-&gt;dma_b
suffix:semicolon
multiline_comment|/* See lock-up note above. */
r_if
c_cond
(paren
id|irq
op_eq
id|AUDRCVDMADONEA
op_logical_or
id|irq
op_eq
id|AUDRCVDMADONEB
)paren
(brace
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
)brace
)brace
id|dma-&gt;regs-&gt;SAD_CS
op_assign
id|SAD_CS_DBDB
op_or
id|SAD_CS_DEN
suffix:semicolon
multiline_comment|/* w1c */
id|dma-&gt;last_dma
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* NP: maybe this shouldn&squot;t be called in all cases? */
id|sa1100_dma_done
(paren
id|dma
)paren
suffix:semicolon
)brace
DECL|function|sa1111_sac_request_dma
r_int
id|sa1111_sac_request_dma
c_func
(paren
id|dmach_t
op_star
id|channel
comma
r_const
r_char
op_star
id|device_id
comma
r_int
r_int
id|direction
)paren
(brace
id|sa1100_dma_t
op_star
id|dma
op_assign
l_int|NULL
suffix:semicolon
r_int
id|ch
comma
id|irq
comma
id|err
suffix:semicolon
op_star
id|channel
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* to be sure we catch the freeing of a misregistered channel */
id|ch
op_assign
id|SA1111_SAC_DMA_BASE
op_plus
id|direction
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|channel_is_sa1111_sac
c_func
(paren
id|ch
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: invalid SA-1111 SAC DMA channel (%d)&bslash;n&quot;
comma
id|device_id
comma
id|ch
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|dma
op_assign
op_amp
id|dma_chan
(braket
id|ch
)braket
suffix:semicolon
r_if
c_cond
(paren
id|xchg
c_func
(paren
op_amp
id|dma-&gt;in_use
comma
l_int|1
)paren
op_eq
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: SA-1111 SAC DMA channel %d in use&bslash;n&quot;
comma
id|device_id
comma
id|ch
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|irq
op_assign
id|AUDXMTDMADONEA
op_plus
id|direction
suffix:semicolon
id|err
op_assign
id|request_irq
c_func
(paren
id|irq
comma
id|sa1111_sac_dma_irq
comma
id|SA_INTERRUPT
comma
id|device_id
comma
(paren
r_void
op_star
)paren
id|dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: unable to request IRQ %d for DMA channel %d (A)&bslash;n&quot;
comma
id|device_id
comma
id|irq
comma
id|ch
)paren
suffix:semicolon
id|dma-&gt;in_use
op_assign
l_int|0
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
id|irq
op_assign
id|AUDXMTDMADONEB
op_plus
id|direction
suffix:semicolon
id|err
op_assign
id|request_irq
c_func
(paren
id|irq
comma
id|sa1111_sac_dma_irq
comma
id|SA_INTERRUPT
comma
id|device_id
comma
(paren
r_void
op_star
)paren
id|dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: unable to request IRQ %d for DMA channel %d (B)&bslash;n&quot;
comma
id|device_id
comma
id|irq
comma
id|ch
)paren
suffix:semicolon
id|dma-&gt;in_use
op_assign
l_int|0
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
op_star
id|channel
op_assign
id|ch
suffix:semicolon
id|dma-&gt;device_id
op_assign
id|device_id
suffix:semicolon
id|dma-&gt;callback
op_assign
l_int|NULL
suffix:semicolon
id|dma-&gt;spin_size
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* FIXME:  need to complete the three following functions */
DECL|function|sa1111_dma_get_current
r_int
id|sa1111_dma_get_current
c_func
(paren
id|dmach_t
id|channel
comma
r_void
op_star
op_star
id|buf_id
comma
id|dma_addr_t
op_star
id|addr
)paren
(brace
id|sa1100_dma_t
op_star
id|dma
op_assign
op_amp
id|dma_chan
(braket
id|channel
)braket
suffix:semicolon
r_int
id|flags
comma
id|ret
suffix:semicolon
id|local_irq_save
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dma-&gt;curr
op_logical_and
id|dma-&gt;spin_ref
op_le
l_int|0
)paren
(brace
id|dma_buf_t
op_star
id|buf
op_assign
id|dma-&gt;curr
suffix:semicolon
r_if
c_cond
(paren
id|buf_id
)paren
op_star
id|buf_id
op_assign
id|buf-&gt;id
suffix:semicolon
multiline_comment|/* not fully accurate but still... */
op_star
id|addr
op_assign
id|buf-&gt;dma_ptr
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|buf_id
)paren
op_star
id|buf_id
op_assign
l_int|NULL
suffix:semicolon
op_star
id|addr
op_assign
l_int|0
suffix:semicolon
id|ret
op_assign
op_minus
id|ENXIO
suffix:semicolon
)brace
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|sa1111_dma_stop
r_int
id|sa1111_dma_stop
c_func
(paren
id|dmach_t
id|channel
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sa1111_dma_resume
r_int
id|sa1111_dma_resume
c_func
(paren
id|dmach_t
id|channel
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|sa1111_cleanup_sac_dma
r_void
id|sa1111_cleanup_sac_dma
c_func
(paren
id|dmach_t
id|channel
)paren
(brace
id|sa1100_dma_t
op_star
id|dma
op_assign
op_amp
id|dma_chan
(braket
id|channel
)braket
suffix:semicolon
id|free_irq
c_func
(paren
id|AUDXMTDMADONEA
op_plus
(paren
id|channel
op_minus
id|SA1111_SAC_DMA_BASE
)paren
comma
(paren
r_void
op_star
)paren
id|dma
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|AUDXMTDMADONEB
op_plus
(paren
id|channel
op_minus
id|SA1111_SAC_DMA_BASE
)paren
comma
(paren
r_void
op_star
)paren
id|dma
)paren
suffix:semicolon
)brace
multiline_comment|/* According to the &quot;Intel StrongARM SA-1111 Microprocessor Companion&n; * Chip Specification Update&quot; (June 2000), erratum #7, there is a&n; * significant bug in Serial Audio Controller DMA. If the SAC is&n; * accessing a region of memory above 1MB relative to the bank base,&n; * it is important that address bit 10 _NOT_ be asserted. Depending&n; * on the configuration of the RAM, bit 10 may correspond to one&n; * of several different (processor-relative) address bits.&n; *&n; * This routine only identifies whether or not a given DMA address&n; * is susceptible to the bug.&n; */
DECL|function|sa1111_check_dma_bug
r_int
(def_block
id|sa1111_check_dma_bug
c_func
(paren
id|dma_addr_t
id|addr
)paren
(brace
r_int
r_int
id|physaddr
op_assign
id|SA1111_DMA_ADDR
c_func
(paren
(paren
r_int
r_int
)paren
id|addr
)paren
suffix:semicolon
multiline_comment|/* Section 4.6 of the &quot;Intel StrongARM SA-1111 Development Module&n;&t; * User&squot;s Guide&quot; mentions that jumpers R51 and R52 control the&n;&t; * target of SA-1111 DMA (either SDRAM bank 0 on Assabet, or&n;&t; * SDRAM bank 1 on Neponset). The default configuration selects&n;&t; * Assabet, so any address in bank 1 is necessarily invalid.&n;&t; */
r_if
c_cond
(paren
(paren
id|machine_is_assabet
c_func
(paren
)paren
op_logical_or
id|machine_is_pfs168
c_func
(paren
)paren
)paren
op_logical_and
id|addr
op_ge
l_int|0xc8000000
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* The bug only applies to buffers located more than one megabyte&n;&t; * above the start of the target bank:&n;&t; */
r_if
c_cond
(paren
id|physaddr
OL
(paren
l_int|1
op_lshift
l_int|20
)paren
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|FExtr
c_func
(paren
id|SBI_SMCR
comma
id|SMCR_DRAC
)paren
)paren
(brace
r_case
l_int|01
suffix:colon
multiline_comment|/* 10 row + bank address bits, A&lt;20&gt; must not be set */
r_if
c_cond
(paren
id|physaddr
op_amp
(paren
l_int|1
op_lshift
l_int|20
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|02
suffix:colon
multiline_comment|/* 11 row + bank address bits, A&lt;23&gt; must not be set */
r_if
c_cond
(paren
id|physaddr
op_amp
(paren
l_int|1
op_lshift
l_int|23
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|03
suffix:colon
multiline_comment|/* 12 row + bank address bits, A&lt;24&gt; must not be set */
r_if
c_cond
(paren
id|physaddr
op_amp
(paren
l_int|1
op_lshift
l_int|24
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|04
suffix:colon
multiline_comment|/* 13 row + bank address bits, A&lt;25&gt; must not be set */
r_if
c_cond
(paren
id|physaddr
op_amp
(paren
l_int|1
op_lshift
l_int|25
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|05
suffix:colon
multiline_comment|/* 14 row + bank address bits, A&lt;20&gt; must not be set */
r_if
c_cond
(paren
id|physaddr
op_amp
(paren
l_int|1
op_lshift
l_int|20
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|06
suffix:colon
multiline_comment|/* 15 row + bank address bits, A&lt;20&gt; must not be set */
r_if
c_cond
(paren
id|physaddr
op_amp
(paren
l_int|1
op_lshift
l_int|20
)paren
)paren
(brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s(): invalid SMCR DRAC value 0%lo&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|FExtr
c_func
(paren
id|SBI_SMCR
comma
id|SMCR_DRAC
)paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
)def_block
DECL|variable|sa1111_sac_request_dma
id|EXPORT_SYMBOL
c_func
(paren
id|sa1111_sac_request_dma
)paren
suffix:semicolon
DECL|variable|sa1111_check_dma_bug
id|EXPORT_SYMBOL
c_func
(paren
id|sa1111_check_dma_bug
)paren
suffix:semicolon
DECL|function|sa1111_init_sac_dma
r_static
r_int
id|__init
id|sa1111_init_sac_dma
c_func
(paren
r_void
)paren
(brace
r_int
id|channel
op_assign
id|SA1111_SAC_DMA_BASE
suffix:semicolon
id|dma_chan
(braket
id|channel
op_increment
)braket
dot
id|regs
op_assign
(paren
id|dma_regs_t
op_star
)paren
op_amp
id|SADTCS
suffix:semicolon
id|dma_chan
(braket
id|channel
op_increment
)braket
dot
id|regs
op_assign
(paren
id|dma_regs_t
op_star
)paren
op_amp
id|SADRCS
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|sa1111_init_sac_dma
id|__initcall
c_func
(paren
id|sa1111_init_sac_dma
)paren
suffix:semicolon
eof
