multiline_comment|/*&n; *  arch/arm/mach-imx/generic.c&n; *&n; *  author: Sascha Hauer&n; *  Created: april 20th, 2004&n; *  Copyright: Synertronixx GmbH&n; *&n; *  Common code for i.MX machines&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; *&n; */
macro_line|#include &lt;linux/device.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
macro_line|#include &lt;asm/mach/map.h&gt;
DECL|function|imx_gpio_mode
r_void
id|imx_gpio_mode
c_func
(paren
r_int
id|gpio_mode
)paren
(brace
r_int
r_int
id|pin
op_assign
id|gpio_mode
op_amp
id|GPIO_PIN_MASK
suffix:semicolon
r_int
r_int
id|port
op_assign
(paren
id|gpio_mode
op_amp
id|GPIO_PORT_MASK
)paren
op_rshift
l_int|5
suffix:semicolon
r_int
r_int
id|ocr
op_assign
(paren
id|gpio_mode
op_amp
id|GPIO_OCR_MASK
)paren
op_rshift
l_int|10
suffix:semicolon
r_int
r_int
id|tmp
suffix:semicolon
multiline_comment|/* Pullup enable */
r_if
c_cond
(paren
id|gpio_mode
op_amp
id|GPIO_PUEN
)paren
(brace
id|PUEN
c_func
(paren
id|port
)paren
op_or_assign
(paren
l_int|1
op_lshift
id|pin
)paren
suffix:semicolon
)brace
r_else
id|PUEN
c_func
(paren
id|port
)paren
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|pin
)paren
suffix:semicolon
multiline_comment|/* Data direction */
r_if
c_cond
(paren
id|gpio_mode
op_amp
id|GPIO_OUT
)paren
(brace
id|DDIR
c_func
(paren
id|port
)paren
op_or_assign
l_int|1
op_lshift
id|pin
suffix:semicolon
)brace
r_else
id|DDIR
c_func
(paren
id|port
)paren
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|pin
)paren
suffix:semicolon
multiline_comment|/* Primary / alternate function */
r_if
c_cond
(paren
id|gpio_mode
op_amp
id|GPIO_AF
)paren
(brace
id|GPR
c_func
(paren
id|port
)paren
op_or_assign
(paren
l_int|1
op_lshift
id|pin
)paren
suffix:semicolon
)brace
r_else
id|GPR
c_func
(paren
id|port
)paren
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|pin
)paren
suffix:semicolon
multiline_comment|/* use as gpio? */
r_if
c_cond
(paren
id|ocr
op_eq
l_int|3
)paren
(brace
id|GIUS
c_func
(paren
id|port
)paren
op_or_assign
(paren
l_int|1
op_lshift
id|pin
)paren
suffix:semicolon
)brace
r_else
id|GIUS
c_func
(paren
id|port
)paren
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|pin
)paren
suffix:semicolon
multiline_comment|/* Output / input configuration */
multiline_comment|/* FIXME: I&squot;m not very sure about OCR and ICONF, someone&n;&t; * should have a look over it&n;&t; */
r_if
c_cond
(paren
id|pin
OL
l_int|16
)paren
(brace
id|tmp
op_assign
id|OCR1
c_func
(paren
id|port
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
l_int|3
op_lshift
(paren
id|pin
op_star
l_int|2
)paren
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|ocr
op_lshift
(paren
id|pin
op_star
l_int|2
)paren
)paren
suffix:semicolon
id|OCR1
c_func
(paren
id|port
)paren
op_assign
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|gpio_mode
op_amp
id|GPIO_AOUT
)paren
(brace
id|ICONFA1
c_func
(paren
id|port
)paren
op_and_assign
op_complement
(paren
l_int|3
op_lshift
(paren
id|pin
op_star
l_int|2
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|gpio_mode
op_amp
id|GPIO_BOUT
)paren
(brace
id|ICONFB1
c_func
(paren
id|port
)paren
op_and_assign
op_complement
(paren
l_int|3
op_lshift
(paren
id|pin
op_star
l_int|2
)paren
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|tmp
op_assign
id|OCR2
c_func
(paren
id|port
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
l_int|3
op_lshift
(paren
(paren
id|pin
op_minus
l_int|16
)paren
op_star
l_int|2
)paren
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|ocr
op_lshift
(paren
(paren
id|pin
op_minus
l_int|16
)paren
op_star
l_int|2
)paren
)paren
suffix:semicolon
id|OCR2
c_func
(paren
id|port
)paren
op_assign
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|gpio_mode
op_amp
id|GPIO_AOUT
)paren
(brace
id|ICONFA2
c_func
(paren
id|port
)paren
op_and_assign
op_complement
(paren
l_int|3
op_lshift
(paren
(paren
id|pin
op_minus
l_int|16
)paren
op_star
l_int|2
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|gpio_mode
op_amp
id|GPIO_BOUT
)paren
(brace
id|ICONFB2
c_func
(paren
id|port
)paren
op_and_assign
op_complement
(paren
l_int|3
op_lshift
(paren
(paren
id|pin
op_minus
l_int|16
)paren
op_star
l_int|2
)paren
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|variable|imx_gpio_mode
id|EXPORT_SYMBOL
c_func
(paren
id|imx_gpio_mode
)paren
suffix:semicolon
multiline_comment|/*&n; *  get the system pll clock in Hz&n; *&n; *                  mfi + mfn / (mfd +1)&n; *  f = 2 * f_ref * --------------------&n; *                        pd + 1&n; */
DECL|function|imx_decode_pll
r_static
r_int
r_int
id|imx_decode_pll
c_func
(paren
r_int
r_int
id|pll
)paren
(brace
id|u32
id|mfi
op_assign
(paren
id|pll
op_rshift
l_int|10
)paren
op_amp
l_int|0xf
suffix:semicolon
id|u32
id|mfn
op_assign
id|pll
op_amp
l_int|0x3ff
suffix:semicolon
id|u32
id|mfd
op_assign
(paren
id|pll
op_rshift
l_int|16
)paren
op_amp
l_int|0x3ff
suffix:semicolon
id|u32
id|pd
op_assign
(paren
id|pll
op_rshift
l_int|26
)paren
op_amp
l_int|0xf
suffix:semicolon
id|u32
id|f_ref
op_assign
(paren
id|CSCR
op_amp
id|CSCR_SYSTEM_SEL
)paren
ques
c_cond
l_int|16000000
suffix:colon
(paren
id|CLK32
op_star
l_int|512
)paren
suffix:semicolon
id|mfi
op_assign
id|mfi
op_le
l_int|5
ques
c_cond
l_int|5
suffix:colon
id|mfi
suffix:semicolon
r_return
(paren
l_int|2
op_star
(paren
id|f_ref
op_rshift
l_int|10
)paren
op_star
(paren
(paren
id|mfi
op_lshift
l_int|10
)paren
op_plus
(paren
id|mfn
op_lshift
l_int|10
)paren
op_div
(paren
id|mfd
op_plus
l_int|1
)paren
)paren
)paren
op_div
(paren
id|pd
op_plus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|imx_get_system_clk
r_int
r_int
id|imx_get_system_clk
c_func
(paren
r_void
)paren
(brace
r_return
id|imx_decode_pll
c_func
(paren
id|SPCTL0
)paren
suffix:semicolon
)brace
DECL|variable|imx_get_system_clk
id|EXPORT_SYMBOL
c_func
(paren
id|imx_get_system_clk
)paren
suffix:semicolon
DECL|function|imx_get_mcu_clk
r_int
r_int
id|imx_get_mcu_clk
c_func
(paren
r_void
)paren
(brace
r_return
id|imx_decode_pll
c_func
(paren
id|MPCTL0
)paren
suffix:semicolon
)brace
DECL|variable|imx_get_mcu_clk
id|EXPORT_SYMBOL
c_func
(paren
id|imx_get_mcu_clk
)paren
suffix:semicolon
multiline_comment|/*&n; *  get peripheral clock 1 ( UART[12], Timer[12], PWM )&n; */
DECL|function|imx_get_perclk1
r_int
r_int
id|imx_get_perclk1
c_func
(paren
r_void
)paren
(brace
r_return
id|imx_get_system_clk
c_func
(paren
)paren
op_div
(paren
(paren
(paren
id|PCDR
)paren
op_amp
l_int|0xf
)paren
op_plus
l_int|1
)paren
suffix:semicolon
)brace
DECL|variable|imx_get_perclk1
id|EXPORT_SYMBOL
c_func
(paren
id|imx_get_perclk1
)paren
suffix:semicolon
multiline_comment|/*&n; *  get peripheral clock 2 ( LCD, SD, SPI[12] )&n; */
DECL|function|imx_get_perclk2
r_int
r_int
id|imx_get_perclk2
c_func
(paren
r_void
)paren
(brace
r_return
id|imx_get_system_clk
c_func
(paren
)paren
op_div
(paren
(paren
(paren
id|PCDR
op_rshift
l_int|4
)paren
op_amp
l_int|0xf
)paren
op_plus
l_int|1
)paren
suffix:semicolon
)brace
DECL|variable|imx_get_perclk2
id|EXPORT_SYMBOL
c_func
(paren
id|imx_get_perclk2
)paren
suffix:semicolon
multiline_comment|/*&n; *  get peripheral clock 3 ( SSI )&n; */
DECL|function|imx_get_perclk3
r_int
r_int
id|imx_get_perclk3
c_func
(paren
r_void
)paren
(brace
r_return
id|imx_get_system_clk
c_func
(paren
)paren
op_div
(paren
(paren
(paren
id|PCDR
op_rshift
l_int|16
)paren
op_amp
l_int|0x7f
)paren
op_plus
l_int|1
)paren
suffix:semicolon
)brace
DECL|variable|imx_get_perclk3
id|EXPORT_SYMBOL
c_func
(paren
id|imx_get_perclk3
)paren
suffix:semicolon
multiline_comment|/*&n; *  get hclk ( SDRAM, CSI, Memory Stick, I2C, DMA )&n; */
DECL|function|imx_get_hclk
r_int
r_int
id|imx_get_hclk
c_func
(paren
r_void
)paren
(brace
r_return
id|imx_get_system_clk
c_func
(paren
)paren
op_div
(paren
(paren
(paren
id|CSCR
op_rshift
l_int|10
)paren
op_amp
l_int|0xf
)paren
op_plus
l_int|1
)paren
suffix:semicolon
)brace
DECL|variable|imx_get_hclk
id|EXPORT_SYMBOL
c_func
(paren
id|imx_get_hclk
)paren
suffix:semicolon
DECL|variable|imx_mmc_resources
r_static
r_struct
id|resource
id|imx_mmc_resources
(braket
)braket
op_assign
(brace
(braket
l_int|0
)braket
op_assign
(brace
dot
id|start
op_assign
l_int|0x00214000
comma
dot
id|end
op_assign
l_int|0x002140FF
comma
dot
id|flags
op_assign
id|IORESOURCE_MEM
comma
)brace
comma
(braket
l_int|1
)braket
op_assign
(brace
dot
id|start
op_assign
(paren
id|SDHC_INT
)paren
comma
dot
id|end
op_assign
(paren
id|SDHC_INT
)paren
comma
dot
id|flags
op_assign
id|IORESOURCE_IRQ
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|imx_mmc_device
r_static
r_struct
id|platform_device
id|imx_mmc_device
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;imx-mmc&quot;
comma
dot
id|id
op_assign
l_int|0
comma
dot
id|num_resources
op_assign
id|ARRAY_SIZE
c_func
(paren
id|imx_mmc_resources
)paren
comma
dot
id|resource
op_assign
id|imx_mmc_resources
comma
)brace
suffix:semicolon
DECL|variable|imx_uart1_resources
r_static
r_struct
id|resource
id|imx_uart1_resources
(braket
)braket
op_assign
(brace
(braket
l_int|0
)braket
op_assign
(brace
dot
id|start
op_assign
l_int|0x00206000
comma
dot
id|end
op_assign
l_int|0x002060FF
comma
dot
id|flags
op_assign
id|IORESOURCE_MEM
comma
)brace
comma
(braket
l_int|1
)braket
op_assign
(brace
dot
id|start
op_assign
(paren
id|UART1_MINT_RX
)paren
comma
dot
id|end
op_assign
(paren
id|UART1_MINT_RX
)paren
comma
dot
id|flags
op_assign
id|IORESOURCE_IRQ
comma
)brace
comma
(braket
l_int|2
)braket
op_assign
(brace
dot
id|start
op_assign
(paren
id|UART1_MINT_TX
)paren
comma
dot
id|end
op_assign
(paren
id|UART1_MINT_TX
)paren
comma
dot
id|flags
op_assign
id|IORESOURCE_IRQ
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|imx_uart1_device
r_static
r_struct
id|platform_device
id|imx_uart1_device
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;imx-uart&quot;
comma
dot
id|id
op_assign
l_int|0
comma
dot
id|num_resources
op_assign
id|ARRAY_SIZE
c_func
(paren
id|imx_uart1_resources
)paren
comma
dot
id|resource
op_assign
id|imx_uart1_resources
comma
)brace
suffix:semicolon
DECL|variable|imx_uart2_resources
r_static
r_struct
id|resource
id|imx_uart2_resources
(braket
)braket
op_assign
(brace
(braket
l_int|0
)braket
op_assign
(brace
dot
id|start
op_assign
l_int|0x00207000
comma
dot
id|end
op_assign
l_int|0x002070FF
comma
dot
id|flags
op_assign
id|IORESOURCE_MEM
comma
)brace
comma
(braket
l_int|1
)braket
op_assign
(brace
dot
id|start
op_assign
(paren
id|UART2_MINT_RX
)paren
comma
dot
id|end
op_assign
(paren
id|UART2_MINT_RX
)paren
comma
dot
id|flags
op_assign
id|IORESOURCE_IRQ
comma
)brace
comma
(braket
l_int|2
)braket
op_assign
(brace
dot
id|start
op_assign
(paren
id|UART2_MINT_TX
)paren
comma
dot
id|end
op_assign
(paren
id|UART2_MINT_TX
)paren
comma
dot
id|flags
op_assign
id|IORESOURCE_IRQ
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|imx_uart2_device
r_static
r_struct
id|platform_device
id|imx_uart2_device
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;imx-uart&quot;
comma
dot
id|id
op_assign
l_int|1
comma
dot
id|num_resources
op_assign
id|ARRAY_SIZE
c_func
(paren
id|imx_uart2_resources
)paren
comma
dot
id|resource
op_assign
id|imx_uart2_resources
comma
)brace
suffix:semicolon
DECL|variable|imxfb_resources
r_static
r_struct
id|resource
id|imxfb_resources
(braket
)braket
op_assign
(brace
(braket
l_int|0
)braket
op_assign
(brace
dot
id|start
op_assign
l_int|0x00205000
comma
dot
id|end
op_assign
l_int|0x002050FF
comma
dot
id|flags
op_assign
id|IORESOURCE_MEM
comma
)brace
comma
(braket
l_int|1
)braket
op_assign
(brace
dot
id|start
op_assign
id|LCDC_INT
comma
dot
id|end
op_assign
id|LCDC_INT
comma
dot
id|flags
op_assign
id|IORESOURCE_IRQ
comma
)brace
comma
)brace
suffix:semicolon
DECL|variable|imxfb_device
r_static
r_struct
id|platform_device
id|imxfb_device
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;imx-fb&quot;
comma
dot
id|id
op_assign
l_int|0
comma
dot
id|num_resources
op_assign
id|ARRAY_SIZE
c_func
(paren
id|imxfb_resources
)paren
comma
dot
id|resource
op_assign
id|imxfb_resources
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|platform_device
op_star
id|devices
(braket
)braket
id|__initdata
op_assign
(brace
op_amp
id|imx_mmc_device
comma
op_amp
id|imxfb_device
comma
op_amp
id|imx_uart1_device
comma
op_amp
id|imx_uart2_device
comma
)brace
suffix:semicolon
DECL|variable|__initdata
r_static
r_struct
id|map_desc
id|imx_io_desc
(braket
)braket
id|__initdata
op_assign
(brace
multiline_comment|/* virtual     physical    length      type */
(brace
id|IMX_IO_BASE
comma
id|IMX_IO_PHYS
comma
id|IMX_IO_SIZE
comma
id|MT_DEVICE
)brace
comma
)brace
suffix:semicolon
r_void
id|__init
DECL|function|imx_map_io
id|imx_map_io
c_func
(paren
r_void
)paren
(brace
id|iotable_init
c_func
(paren
id|imx_io_desc
comma
id|ARRAY_SIZE
c_func
(paren
id|imx_io_desc
)paren
)paren
suffix:semicolon
)brace
DECL|function|imx_init
r_static
r_int
id|__init
id|imx_init
c_func
(paren
r_void
)paren
(brace
r_return
id|platform_add_devices
c_func
(paren
id|devices
comma
id|ARRAY_SIZE
c_func
(paren
id|devices
)paren
)paren
suffix:semicolon
)brace
DECL|variable|imx_init
id|subsys_initcall
c_func
(paren
id|imx_init
)paren
suffix:semicolon
eof
