multiline_comment|/*&n; *  linux/arch/arm/kernel/compat.c&n; *&n; *  Copyright (C) 2001 Russell King&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2 as&n; * published by the Free Software Foundation.&n; *&n; * We keep the old params compatibility cruft in one place (here)&n; * so we don&squot;t end up with lots of mess around other places.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/setup.h&gt;
macro_line|#include &lt;asm/mach-types.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/mach/arch.h&gt;
DECL|function|memtag
r_static
r_struct
id|tag
op_star
id|__init
id|memtag
c_func
(paren
r_struct
id|tag
op_star
id|tag
comma
r_int
r_int
id|start
comma
r_int
r_int
id|size
)paren
(brace
id|tag
op_assign
id|tag_next
c_func
(paren
id|tag
)paren
suffix:semicolon
id|tag-&gt;hdr.tag
op_assign
id|ATAG_MEM
suffix:semicolon
id|tag-&gt;hdr.size
op_assign
id|tag_size
c_func
(paren
id|tag_mem32
)paren
suffix:semicolon
id|tag-&gt;u.mem.size
op_assign
id|size
suffix:semicolon
id|tag-&gt;u.mem.start
op_assign
id|start
suffix:semicolon
r_return
id|tag
suffix:semicolon
)brace
DECL|function|build_tag_list
r_static
r_void
id|__init
id|build_tag_list
c_func
(paren
r_struct
id|param_struct
op_star
id|params
comma
r_void
op_star
id|taglist
comma
r_int
id|mem_init
)paren
(brace
r_struct
id|tag
op_star
id|tag
op_assign
id|taglist
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;Converting old-style param struct to taglist&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|params-&gt;u1.s.page_size
op_ne
id|PAGE_SIZE
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Warning: bad configuration page, &quot;
l_string|&quot;trying to continue&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|tag-&gt;hdr.tag
op_assign
id|ATAG_CORE
suffix:semicolon
id|tag-&gt;hdr.size
op_assign
id|tag_size
c_func
(paren
id|tag_core
)paren
suffix:semicolon
id|tag-&gt;u.core.flags
op_assign
id|params-&gt;u1.s.flags
op_amp
id|FLAG_READONLY
suffix:semicolon
id|tag-&gt;u.core.pagesize
op_assign
id|params-&gt;u1.s.page_size
suffix:semicolon
id|tag-&gt;u.core.rootdev
op_assign
id|params-&gt;u1.s.rootdev
suffix:semicolon
id|tag
op_assign
id|tag_next
c_func
(paren
id|tag
)paren
suffix:semicolon
id|tag-&gt;hdr.tag
op_assign
id|ATAG_RAMDISK
suffix:semicolon
id|tag-&gt;hdr.size
op_assign
id|tag_size
c_func
(paren
id|tag_ramdisk
)paren
suffix:semicolon
id|tag-&gt;u.ramdisk.flags
op_assign
(paren
id|params-&gt;u1.s.flags
op_amp
id|FLAG_RDLOAD
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
op_or
(paren
id|params-&gt;u1.s.flags
op_amp
id|FLAG_RDPROMPT
ques
c_cond
l_int|2
suffix:colon
l_int|0
)paren
suffix:semicolon
id|tag-&gt;u.ramdisk.size
op_assign
id|params-&gt;u1.s.ramdisk_size
suffix:semicolon
id|tag-&gt;u.ramdisk.start
op_assign
id|params-&gt;u1.s.rd_start
suffix:semicolon
id|tag
op_assign
id|tag_next
c_func
(paren
id|tag
)paren
suffix:semicolon
id|tag-&gt;hdr.tag
op_assign
id|ATAG_INITRD
suffix:semicolon
id|tag-&gt;hdr.size
op_assign
id|tag_size
c_func
(paren
id|tag_initrd
)paren
suffix:semicolon
id|tag-&gt;u.initrd.start
op_assign
id|params-&gt;u1.s.initrd_start
suffix:semicolon
id|tag-&gt;u.initrd.size
op_assign
id|params-&gt;u1.s.initrd_size
suffix:semicolon
id|tag
op_assign
id|tag_next
c_func
(paren
id|tag
)paren
suffix:semicolon
id|tag-&gt;hdr.tag
op_assign
id|ATAG_SERIAL
suffix:semicolon
id|tag-&gt;hdr.size
op_assign
id|tag_size
c_func
(paren
id|tag_serialnr
)paren
suffix:semicolon
id|tag-&gt;u.serialnr.low
op_assign
id|params-&gt;u1.s.system_serial_low
suffix:semicolon
id|tag-&gt;u.serialnr.high
op_assign
id|params-&gt;u1.s.system_serial_high
suffix:semicolon
id|tag
op_assign
id|tag_next
c_func
(paren
id|tag
)paren
suffix:semicolon
id|tag-&gt;hdr.tag
op_assign
id|ATAG_REVISION
suffix:semicolon
id|tag-&gt;hdr.size
op_assign
id|tag_size
c_func
(paren
id|tag_revision
)paren
suffix:semicolon
id|tag-&gt;u.revision.rev
op_assign
id|params-&gt;u1.s.system_rev
suffix:semicolon
r_if
c_cond
(paren
id|mem_init
)paren
(brace
macro_line|#ifdef CONFIG_ARCH_ACORN
r_if
c_cond
(paren
id|machine_is_riscpc
c_func
(paren
)paren
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|tag
op_assign
id|memtag
c_func
(paren
id|tag
comma
id|PHYS_OFFSET
op_plus
(paren
id|i
op_lshift
l_int|26
)paren
comma
id|params-&gt;u1.s.pages_in_bank
(braket
id|i
)braket
op_star
id|PAGE_SIZE
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
id|tag
op_assign
id|memtag
c_func
(paren
id|tag
comma
id|PHYS_OFFSET
comma
id|params-&gt;u1.s.nr_pages
op_star
id|PAGE_SIZE
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_FOOTBRIDGE
r_if
c_cond
(paren
id|params-&gt;u1.s.mem_fclk_21285
)paren
(brace
id|tag
op_assign
id|tag_next
c_func
(paren
id|tag
)paren
suffix:semicolon
id|tag-&gt;hdr.tag
op_assign
id|ATAG_MEMCLK
suffix:semicolon
id|tag-&gt;hdr.size
op_assign
id|tag_size
c_func
(paren
id|tag_memclk
)paren
suffix:semicolon
id|tag-&gt;u.memclk.fmemclk
op_assign
id|params-&gt;u1.s.mem_fclk_21285
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_ARCH_ACORN
id|tag
op_assign
id|tag_next
c_func
(paren
id|tag
)paren
suffix:semicolon
id|tag-&gt;hdr.tag
op_assign
id|ATAG_ACORN
suffix:semicolon
id|tag-&gt;hdr.size
op_assign
id|tag_size
c_func
(paren
id|tag_acorn
)paren
suffix:semicolon
id|tag-&gt;u.acorn.memc_control_reg
op_assign
id|params-&gt;u1.s.memc_control_reg
suffix:semicolon
id|tag-&gt;u.acorn.vram_pages
op_assign
id|params-&gt;u1.s.pages_in_vram
suffix:semicolon
id|tag-&gt;u.acorn.sounddefault
op_assign
id|params-&gt;u1.s.sounddefault
suffix:semicolon
id|tag-&gt;u.acorn.adfsdrives
op_assign
id|params-&gt;u1.s.adfsdrives
suffix:semicolon
macro_line|#endif
id|tag
op_assign
id|tag_next
c_func
(paren
id|tag
)paren
suffix:semicolon
id|tag-&gt;hdr.tag
op_assign
id|ATAG_CMDLINE
suffix:semicolon
id|tag-&gt;hdr.size
op_assign
(paren
id|strlen
c_func
(paren
id|params-&gt;commandline
)paren
op_plus
l_int|3
op_plus
r_sizeof
(paren
r_struct
id|tag_header
)paren
)paren
op_rshift
l_int|2
suffix:semicolon
id|strcpy
c_func
(paren
id|tag-&gt;u.cmdline.cmdline
comma
id|params-&gt;commandline
)paren
suffix:semicolon
id|tag
op_assign
id|tag_next
c_func
(paren
id|tag
)paren
suffix:semicolon
id|tag-&gt;hdr.tag
op_assign
l_int|0
suffix:semicolon
id|tag-&gt;hdr.size
op_assign
l_int|0
suffix:semicolon
id|memmove
c_func
(paren
id|params
comma
id|taglist
comma
(paren
(paren
r_int
)paren
id|tag
)paren
op_minus
(paren
(paren
r_int
)paren
id|taglist
)paren
op_plus
r_sizeof
(paren
r_struct
id|tag_header
)paren
)paren
suffix:semicolon
)brace
DECL|function|convert_to_tag_list
r_void
id|__init
id|convert_to_tag_list
c_func
(paren
r_struct
id|param_struct
op_star
id|params
comma
r_int
id|mem_init
)paren
(brace
id|build_tag_list
c_func
(paren
id|params
comma
op_amp
id|params-&gt;u2
comma
id|mem_init
)paren
suffix:semicolon
)brace
eof
