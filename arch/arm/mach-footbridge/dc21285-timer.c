multiline_comment|/*&n; *  linux/arch/arm/mach-footbridge/dc21285-timer.c&n; *&n; *  Copyright (C) 1998 Russell King.&n; *  Copyright (C) 1998 Phil Blundell&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/hardware/dec21285.h&gt;
macro_line|#include &lt;asm/mach/time.h&gt;
macro_line|#include &quot;common.h&quot;
multiline_comment|/*&n; * Footbridge timer 1 support.&n; */
DECL|variable|timer1_latch
r_static
r_int
r_int
id|timer1_latch
suffix:semicolon
DECL|function|timer1_gettimeoffset
r_static
r_int
r_int
id|timer1_gettimeoffset
(paren
r_void
)paren
(brace
r_int
r_int
id|value
op_assign
id|timer1_latch
op_minus
op_star
id|CSR_TIMER1_VALUE
suffix:semicolon
r_return
(paren
(paren
id|tick_nsec
op_div
l_int|1000
)paren
op_star
id|value
)paren
op_div
id|timer1_latch
suffix:semicolon
)brace
r_static
id|irqreturn_t
DECL|function|timer1_interrupt
id|timer1_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|write_seqlock
c_func
(paren
op_amp
id|xtime_lock
)paren
suffix:semicolon
op_star
id|CSR_TIMER1_CLR
op_assign
l_int|0
suffix:semicolon
id|timer_tick
c_func
(paren
id|regs
)paren
suffix:semicolon
id|write_sequnlock
c_func
(paren
op_amp
id|xtime_lock
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|variable|footbridge_timer_irq
r_static
r_struct
id|irqaction
id|footbridge_timer_irq
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;Timer1 timer tick&quot;
comma
dot
id|handler
op_assign
id|timer1_interrupt
comma
dot
id|flags
op_assign
id|SA_INTERRUPT
comma
)brace
suffix:semicolon
multiline_comment|/*&n; * Set up timer interrupt.&n; */
DECL|function|footbridge_timer_init
r_static
r_void
id|__init
id|footbridge_timer_init
c_func
(paren
r_void
)paren
(brace
id|isa_rtc_init
c_func
(paren
)paren
suffix:semicolon
id|timer1_latch
op_assign
(paren
id|mem_fclk_21285
op_plus
l_int|8
op_star
id|HZ
)paren
op_div
(paren
l_int|16
op_star
id|HZ
)paren
suffix:semicolon
op_star
id|CSR_TIMER1_CLR
op_assign
l_int|0
suffix:semicolon
op_star
id|CSR_TIMER1_LOAD
op_assign
id|timer1_latch
suffix:semicolon
op_star
id|CSR_TIMER1_CNTL
op_assign
id|TIMER_CNTL_ENABLE
op_or
id|TIMER_CNTL_AUTORELOAD
op_or
id|TIMER_CNTL_DIV16
suffix:semicolon
id|setup_irq
c_func
(paren
id|IRQ_TIMER1
comma
op_amp
id|footbridge_timer_irq
)paren
suffix:semicolon
)brace
DECL|variable|footbridge_timer
r_struct
id|sys_timer
id|footbridge_timer
op_assign
(brace
dot
id|init
op_assign
id|footbridge_timer_init
comma
dot
id|offset
op_assign
id|timer1_gettimeoffset
comma
)brace
suffix:semicolon
eof
