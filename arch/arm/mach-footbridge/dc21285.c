multiline_comment|/*&n; *  linux/arch/arm/kernel/dec21285.c: PCI functions for DC21285&n; *&n; *  Copyright (C) 1998-2001 Russell King&n; *  Copyright (C) 1998-2000 Phil Blundell&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2 as&n; * published by the Free Software Foundation.&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/mach/pci.h&gt;
macro_line|#include &lt;asm/hardware/dec21285.h&gt;
DECL|macro|MAX_SLOTS
mdefine_line|#define MAX_SLOTS&t;&t;21
DECL|macro|PCICMD_ABORT
mdefine_line|#define PCICMD_ABORT&t;&t;((PCI_STATUS_REC_MASTER_ABORT| &bslash;&n;&t;&t;&t;&t;  PCI_STATUS_REC_TARGET_ABORT)&lt;&lt;16)
DECL|macro|PCICMD_ERROR_BITS
mdefine_line|#define PCICMD_ERROR_BITS&t;((PCI_STATUS_DETECTED_PARITY | &bslash;&n;&t;&t;&t;&t;  PCI_STATUS_REC_MASTER_ABORT | &bslash;&n;&t;&t;&t;&t;  PCI_STATUS_REC_TARGET_ABORT | &bslash;&n;&t;&t;&t;&t;  PCI_STATUS_PARITY) &lt;&lt; 16)
r_extern
r_int
id|setup_arm_irq
c_func
(paren
r_int
comma
r_struct
id|irqaction
op_star
)paren
suffix:semicolon
r_extern
r_void
id|pcibios_report_status
c_func
(paren
id|u_int
id|status_mask
comma
r_int
id|warn
)paren
suffix:semicolon
r_extern
r_void
id|register_isa_ports
c_func
(paren
r_int
r_int
comma
r_int
r_int
comma
r_int
r_int
)paren
suffix:semicolon
r_static
r_int
r_int
DECL|function|dc21285_base_address
id|dc21285_base_address
c_func
(paren
r_struct
id|pci_bus
op_star
id|bus
comma
r_int
r_int
id|devfn
)paren
(brace
r_int
r_int
id|addr
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|bus-&gt;number
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|PCI_SLOT
c_func
(paren
id|devfn
)paren
op_eq
l_int|0
)paren
multiline_comment|/*&n;&t;&t;&t; * For devfn 0, point at the 21285&n;&t;&t;&t; */
id|addr
op_assign
id|ARMCSR_BASE
suffix:semicolon
r_else
(brace
id|devfn
op_sub_assign
l_int|1
op_lshift
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|devfn
OL
id|PCI_DEVFN
c_func
(paren
id|MAX_SLOTS
comma
l_int|0
)paren
)paren
id|addr
op_assign
id|PCICFG0_BASE
op_or
l_int|0xc00000
op_or
(paren
id|devfn
op_lshift
l_int|8
)paren
suffix:semicolon
)brace
)brace
r_else
id|addr
op_assign
id|PCICFG1_BASE
op_or
(paren
id|bus-&gt;number
op_lshift
l_int|16
)paren
op_or
(paren
id|devfn
op_lshift
l_int|8
)paren
suffix:semicolon
r_return
id|addr
suffix:semicolon
)brace
r_static
r_int
DECL|function|dc21285_read_config
id|dc21285_read_config
c_func
(paren
r_struct
id|pci_bus
op_star
id|bus
comma
r_int
r_int
id|devfn
comma
r_int
id|where
comma
r_int
id|size
comma
id|u32
op_star
id|value
)paren
(brace
r_int
r_int
id|addr
op_assign
id|dc21285_base_address
c_func
(paren
id|bus
comma
id|devfn
)paren
suffix:semicolon
id|u32
id|v
op_assign
l_int|0xffffffff
suffix:semicolon
r_if
c_cond
(paren
id|addr
)paren
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
l_int|1
suffix:colon
id|asm
c_func
(paren
l_string|&quot;ldr%?b&t;%0, [%1, %2]&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|v
)paren
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
)paren
comma
l_string|&quot;r&quot;
(paren
id|where
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|asm
c_func
(paren
l_string|&quot;ldr%?h&t;%0, [%1, %2]&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|v
)paren
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
)paren
comma
l_string|&quot;r&quot;
(paren
id|where
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|asm
c_func
(paren
l_string|&quot;ldr%?&t;%0, [%1, %2]&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|v
)paren
suffix:colon
l_string|&quot;r&quot;
(paren
id|addr
)paren
comma
l_string|&quot;r&quot;
(paren
id|where
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
op_star
id|value
op_assign
id|v
suffix:semicolon
id|v
op_assign
op_star
id|CSR_PCICMD
suffix:semicolon
r_if
c_cond
(paren
id|v
op_amp
id|PCICMD_ABORT
)paren
(brace
op_star
id|CSR_PCICMD
op_assign
id|v
op_amp
(paren
l_int|0xffff
op_or
id|PCICMD_ABORT
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_static
r_int
DECL|function|dc21285_write_config
id|dc21285_write_config
c_func
(paren
r_struct
id|pci_bus
op_star
id|bus
comma
r_int
r_int
id|devfn
comma
r_int
id|where
comma
r_int
id|size
comma
id|u32
id|value
)paren
(brace
r_int
r_int
id|addr
op_assign
id|dc21285_base_address
c_func
(paren
id|bus
comma
id|devfn
)paren
suffix:semicolon
id|u32
id|v
suffix:semicolon
r_if
c_cond
(paren
id|addr
)paren
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
l_int|1
suffix:colon
id|asm
c_func
(paren
l_string|&quot;str%?b&t;%0, [%1, %2]&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|value
)paren
comma
l_string|&quot;r&quot;
(paren
id|addr
)paren
comma
l_string|&quot;r&quot;
(paren
id|where
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|asm
c_func
(paren
l_string|&quot;str%?h&t;%0, [%1, %2]&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|value
)paren
comma
l_string|&quot;r&quot;
(paren
id|addr
)paren
comma
l_string|&quot;r&quot;
(paren
id|where
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|asm
c_func
(paren
l_string|&quot;str%?&t;%0, [%1, %2]&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|value
)paren
comma
l_string|&quot;r&quot;
(paren
id|addr
)paren
comma
l_string|&quot;r&quot;
(paren
id|where
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|v
op_assign
op_star
id|CSR_PCICMD
suffix:semicolon
r_if
c_cond
(paren
id|v
op_amp
id|PCICMD_ABORT
)paren
(brace
op_star
id|CSR_PCICMD
op_assign
id|v
op_amp
(paren
l_int|0xffff
op_or
id|PCICMD_ABORT
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|variable|dc21285_ops
r_static
r_struct
id|pci_ops
id|dc21285_ops
op_assign
(brace
dot
id|read
op_assign
id|dc21285_read_config
comma
dot
id|write
op_assign
id|dc21285_write_config
comma
)brace
suffix:semicolon
DECL|variable|serr_timer
r_static
r_struct
id|timer_list
id|serr_timer
suffix:semicolon
DECL|variable|perr_timer
r_static
r_struct
id|timer_list
id|perr_timer
suffix:semicolon
DECL|function|dc21285_enable_error
r_static
r_void
id|dc21285_enable_error
c_func
(paren
r_int
r_int
id|__data
)paren
(brace
r_switch
c_cond
(paren
id|__data
)paren
(brace
r_case
id|IRQ_PCI_SERR
suffix:colon
id|del_timer
c_func
(paren
op_amp
id|serr_timer
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|IRQ_PCI_PERR
suffix:colon
id|del_timer
c_func
(paren
op_amp
id|perr_timer
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|enable_irq
c_func
(paren
id|__data
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Warn on PCI errors.&n; */
DECL|function|dc21285_abort_irq
r_static
id|irqreturn_t
id|dc21285_abort_irq
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|cmd
suffix:semicolon
r_int
r_int
id|status
suffix:semicolon
id|cmd
op_assign
op_star
id|CSR_PCICMD
suffix:semicolon
id|status
op_assign
id|cmd
op_rshift
l_int|16
suffix:semicolon
id|cmd
op_assign
id|cmd
op_amp
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|status
op_amp
id|PCI_STATUS_REC_MASTER_ABORT
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;PCI: master abort, pc=0x%08lx&bslash;n&quot;
comma
id|instruction_pointer
c_func
(paren
id|regs
)paren
)paren
suffix:semicolon
id|cmd
op_or_assign
id|PCI_STATUS_REC_MASTER_ABORT
op_lshift
l_int|16
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_amp
id|PCI_STATUS_REC_TARGET_ABORT
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;PCI: target abort: &quot;
)paren
suffix:semicolon
id|pcibios_report_status
c_func
(paren
id|PCI_STATUS_REC_MASTER_ABORT
op_or
id|PCI_STATUS_SIG_TARGET_ABORT
op_or
id|PCI_STATUS_REC_TARGET_ABORT
comma
l_int|1
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|cmd
op_or_assign
id|PCI_STATUS_REC_TARGET_ABORT
op_lshift
l_int|16
suffix:semicolon
)brace
op_star
id|CSR_PCICMD
op_assign
id|cmd
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|dc21285_serr_irq
r_static
id|irqreturn_t
id|dc21285_serr_irq
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|timer_list
op_star
id|timer
op_assign
id|dev_id
suffix:semicolon
r_int
r_int
id|cntl
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;PCI: system error received: &quot;
)paren
suffix:semicolon
id|pcibios_report_status
c_func
(paren
id|PCI_STATUS_SIG_SYSTEM_ERROR
comma
l_int|1
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|cntl
op_assign
op_star
id|CSR_SA110_CNTL
op_amp
l_int|0xffffdf07
suffix:semicolon
op_star
id|CSR_SA110_CNTL
op_assign
id|cntl
op_or
id|SA110_CNTL_RXSERR
suffix:semicolon
multiline_comment|/*&n;&t; * back off this interrupt&n;&t; */
id|disable_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
id|timer-&gt;expires
op_assign
id|jiffies
op_plus
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
id|timer
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|dc21285_discard_irq
r_static
id|irqreturn_t
id|dc21285_discard_irq
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;PCI: discard timer expired&bslash;n&quot;
)paren
suffix:semicolon
op_star
id|CSR_SA110_CNTL
op_and_assign
l_int|0xffffde07
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|dc21285_dparity_irq
r_static
id|irqreturn_t
id|dc21285_dparity_irq
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|cmd
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;PCI: data parity error detected: &quot;
)paren
suffix:semicolon
id|pcibios_report_status
c_func
(paren
id|PCI_STATUS_PARITY
op_or
id|PCI_STATUS_DETECTED_PARITY
comma
l_int|1
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|cmd
op_assign
op_star
id|CSR_PCICMD
op_amp
l_int|0xffff
suffix:semicolon
op_star
id|CSR_PCICMD
op_assign
id|cmd
op_or
l_int|1
op_lshift
l_int|24
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|dc21285_parity_irq
r_static
id|irqreturn_t
id|dc21285_parity_irq
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|timer_list
op_star
id|timer
op_assign
id|dev_id
suffix:semicolon
r_int
r_int
id|cmd
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;PCI: parity error detected: &quot;
)paren
suffix:semicolon
id|pcibios_report_status
c_func
(paren
id|PCI_STATUS_PARITY
op_or
id|PCI_STATUS_DETECTED_PARITY
comma
l_int|1
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|cmd
op_assign
op_star
id|CSR_PCICMD
op_amp
l_int|0xffff
suffix:semicolon
op_star
id|CSR_PCICMD
op_assign
id|cmd
op_or
l_int|1
op_lshift
l_int|31
suffix:semicolon
multiline_comment|/*&n;&t; * back off this interrupt&n;&t; */
id|disable_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
id|timer-&gt;expires
op_assign
id|jiffies
op_plus
id|HZ
suffix:semicolon
id|add_timer
c_func
(paren
id|timer
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|dc21285_setup
r_int
id|__init
id|dc21285_setup
c_func
(paren
r_int
id|nr
comma
r_struct
id|pci_sys_data
op_star
id|sys
)paren
(brace
r_struct
id|resource
op_star
id|res
suffix:semicolon
r_if
c_cond
(paren
id|nr
op_logical_or
op_logical_neg
id|footbridge_cfn_mode
c_func
(paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|res
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|resource
)paren
op_star
l_int|2
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|res
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;out of memory for root bus resources&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
id|res
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|resource
)paren
op_star
l_int|2
)paren
suffix:semicolon
id|res
(braket
l_int|0
)braket
dot
id|flags
op_assign
id|IORESOURCE_MEM
suffix:semicolon
id|res
(braket
l_int|0
)braket
dot
id|name
op_assign
l_string|&quot;Footbridge non-prefetch&quot;
suffix:semicolon
id|res
(braket
l_int|1
)braket
dot
id|flags
op_assign
id|IORESOURCE_MEM
op_or
id|IORESOURCE_PREFETCH
suffix:semicolon
id|res
(braket
l_int|1
)braket
dot
id|name
op_assign
l_string|&quot;Footbridge prefetch&quot;
suffix:semicolon
id|allocate_resource
c_func
(paren
op_amp
id|iomem_resource
comma
op_amp
id|res
(braket
l_int|1
)braket
comma
l_int|0x20000000
comma
l_int|0xa0000000
comma
l_int|0xffffffff
comma
l_int|0x20000000
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|allocate_resource
c_func
(paren
op_amp
id|iomem_resource
comma
op_amp
id|res
(braket
l_int|0
)braket
comma
l_int|0x40000000
comma
l_int|0x80000000
comma
l_int|0xffffffff
comma
l_int|0x40000000
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|sys-&gt;resource
(braket
l_int|0
)braket
op_assign
op_amp
id|ioport_resource
suffix:semicolon
id|sys-&gt;resource
(braket
l_int|1
)braket
op_assign
op_amp
id|res
(braket
l_int|0
)braket
suffix:semicolon
id|sys-&gt;resource
(braket
l_int|2
)braket
op_assign
op_amp
id|res
(braket
l_int|1
)braket
suffix:semicolon
id|sys-&gt;mem_offset
op_assign
id|DC21285_PCI_MEM
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|dc21285_scan_bus
r_struct
id|pci_bus
op_star
id|__init
id|dc21285_scan_bus
c_func
(paren
r_int
id|nr
comma
r_struct
id|pci_sys_data
op_star
id|sys
)paren
(brace
r_return
id|pci_scan_bus
c_func
(paren
l_int|0
comma
op_amp
id|dc21285_ops
comma
id|sys
)paren
suffix:semicolon
)brace
DECL|function|dc21285_preinit
r_void
id|__init
id|dc21285_preinit
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|mem_size
comma
id|mem_mask
suffix:semicolon
r_int
id|cfn_mode
suffix:semicolon
id|mem_size
op_assign
(paren
r_int
r_int
)paren
id|high_memory
op_minus
id|PAGE_OFFSET
suffix:semicolon
r_for
c_loop
(paren
id|mem_mask
op_assign
l_int|0x00100000
suffix:semicolon
id|mem_mask
OL
l_int|0x10000000
suffix:semicolon
id|mem_mask
op_lshift_assign
l_int|1
)paren
r_if
c_cond
(paren
id|mem_mask
op_ge
id|mem_size
)paren
r_break
suffix:semicolon
multiline_comment|/*&n;&t; * These registers need to be set up whether we&squot;re the&n;&t; * central function or not.&n;&t; */
op_star
id|CSR_SDRAMBASEMASK
op_assign
(paren
id|mem_mask
op_minus
l_int|1
)paren
op_amp
l_int|0x0ffc0000
suffix:semicolon
op_star
id|CSR_SDRAMBASEOFFSET
op_assign
l_int|0
suffix:semicolon
op_star
id|CSR_ROMBASEMASK
op_assign
l_int|0x80000000
suffix:semicolon
op_star
id|CSR_CSRBASEMASK
op_assign
l_int|0
suffix:semicolon
op_star
id|CSR_CSRBASEOFFSET
op_assign
l_int|0
suffix:semicolon
op_star
id|CSR_PCIADDR_EXTN
op_assign
l_int|0
suffix:semicolon
id|cfn_mode
op_assign
id|__footbridge_cfn_mode
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;PCI: DC21285 footbridge, revision %02lX, in &quot;
l_string|&quot;%s mode&bslash;n&quot;
comma
op_star
id|CSR_CLASSREV
op_amp
l_int|0xff
comma
id|cfn_mode
ques
c_cond
l_string|&quot;central function&quot;
suffix:colon
l_string|&quot;addin&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|footbridge_cfn_mode
c_func
(paren
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * Clear any existing errors - we aren&squot;t&n;&t;&t; * interested in historical data...&n;&t;&t; */
op_star
id|CSR_SA110_CNTL
op_assign
(paren
op_star
id|CSR_SA110_CNTL
op_amp
l_int|0xffffde07
)paren
op_or
id|SA110_CNTL_RXSERR
suffix:semicolon
op_star
id|CSR_PCICMD
op_assign
(paren
op_star
id|CSR_PCICMD
op_amp
l_int|0xffff
)paren
op_or
id|PCICMD_ERROR_BITS
suffix:semicolon
)brace
id|init_timer
c_func
(paren
op_amp
id|serr_timer
)paren
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|perr_timer
)paren
suffix:semicolon
id|serr_timer.data
op_assign
id|IRQ_PCI_SERR
suffix:semicolon
id|serr_timer.function
op_assign
id|dc21285_enable_error
suffix:semicolon
id|perr_timer.data
op_assign
id|IRQ_PCI_PERR
suffix:semicolon
id|perr_timer.function
op_assign
id|dc21285_enable_error
suffix:semicolon
multiline_comment|/*&n;&t; * We don&squot;t care if these fail.&n;&t; */
id|request_irq
c_func
(paren
id|IRQ_PCI_SERR
comma
id|dc21285_serr_irq
comma
id|SA_INTERRUPT
comma
l_string|&quot;PCI system error&quot;
comma
op_amp
id|serr_timer
)paren
suffix:semicolon
id|request_irq
c_func
(paren
id|IRQ_PCI_PERR
comma
id|dc21285_parity_irq
comma
id|SA_INTERRUPT
comma
l_string|&quot;PCI parity error&quot;
comma
op_amp
id|perr_timer
)paren
suffix:semicolon
id|request_irq
c_func
(paren
id|IRQ_PCI_ABORT
comma
id|dc21285_abort_irq
comma
id|SA_INTERRUPT
comma
l_string|&quot;PCI abort&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|request_irq
c_func
(paren
id|IRQ_DISCARD_TIMER
comma
id|dc21285_discard_irq
comma
id|SA_INTERRUPT
comma
l_string|&quot;Discard timer&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|request_irq
c_func
(paren
id|IRQ_PCI_DPERR
comma
id|dc21285_dparity_irq
comma
id|SA_INTERRUPT
comma
l_string|&quot;PCI data parity&quot;
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cfn_mode
)paren
(brace
r_static
r_struct
id|resource
id|csrio
suffix:semicolon
id|csrio.flags
op_assign
id|IORESOURCE_IO
suffix:semicolon
id|csrio.name
op_assign
l_string|&quot;Footbridge&quot;
suffix:semicolon
id|allocate_resource
c_func
(paren
op_amp
id|ioport_resource
comma
op_amp
id|csrio
comma
l_int|128
comma
l_int|0xff00
comma
l_int|0xffff
comma
l_int|128
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Map our SDRAM at a known address in PCI space, just in case&n;&t;&t; * the firmware had other ideas.  Using a nonzero base is&n;&t;&t; * necessary, since some VGA cards forcefully use PCI addresses&n;&t;&t; * in the range 0x000a0000 to 0x000c0000. (eg, S3 cards).&n;&t;&t; */
op_star
id|CSR_PCICSRBASE
op_assign
l_int|0xf4000000
suffix:semicolon
op_star
id|CSR_PCICSRIOBASE
op_assign
id|csrio.start
suffix:semicolon
op_star
id|CSR_PCISDRAMBASE
op_assign
id|__virt_to_bus
c_func
(paren
id|PAGE_OFFSET
)paren
suffix:semicolon
op_star
id|CSR_PCIROMBASE
op_assign
l_int|0
suffix:semicolon
op_star
id|CSR_PCICMD
op_assign
id|PCI_COMMAND_MEMORY
op_or
id|PCI_COMMAND_MASTER
op_or
id|PCI_COMMAND_INVALIDATE
op_or
id|PCICMD_ERROR_BITS
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|footbridge_cfn_mode
c_func
(paren
)paren
op_ne
l_int|0
)paren
(brace
multiline_comment|/*&n;&t;&t; * If we are not compiled to accept &quot;add-in&quot; mode, then&n;&t;&t; * we are using a constant virt_to_bus translation which&n;&t;&t; * can not hope to cater for the way the host BIOS  has&n;&t;&t; * set up the machine.&n;&t;&t; */
id|panic
c_func
(paren
l_string|&quot;PCI: this kernel is compiled for central &quot;
l_string|&quot;function mode only&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|dc21285_postinit
r_void
id|__init
id|dc21285_postinit
c_func
(paren
r_void
)paren
(brace
id|register_isa_ports
c_func
(paren
id|DC21285_PCI_MEM
comma
id|DC21285_PCI_IO
comma
l_int|0
)paren
suffix:semicolon
)brace
eof
