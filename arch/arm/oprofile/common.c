multiline_comment|/**&n; * @file common.c&n; *&n; * @remark Copyright 2004 Oprofile Authors&n; * @remark Read the file COPYING&n; *&n; * @author Zwane Mwaikambo&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/oprofile.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;asm/semaphore.h&gt;
macro_line|#include &lt;linux/sysdev.h&gt;
macro_line|#include &quot;op_counter.h&quot;
macro_line|#include &quot;op_arm_model.h&quot;
DECL|variable|pmu_model
r_static
r_struct
id|op_arm_model_spec
op_star
id|pmu_model
suffix:semicolon
DECL|variable|pmu_enabled
r_static
r_int
id|pmu_enabled
suffix:semicolon
DECL|variable|pmu_sem
r_static
r_struct
id|semaphore
id|pmu_sem
suffix:semicolon
r_static
r_int
id|pmu_start
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|pmu_setup
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|pmu_stop
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_int
id|pmu_create_files
c_func
(paren
r_struct
id|super_block
op_star
comma
r_struct
id|dentry
op_star
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PM
DECL|function|pmu_suspend
r_static
r_int
id|pmu_suspend
c_func
(paren
r_struct
id|sys_device
op_star
id|dev
comma
id|u32
id|state
)paren
(brace
r_if
c_cond
(paren
id|pmu_enabled
)paren
id|pmu_stop
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pmu_resume
r_static
r_int
id|pmu_resume
c_func
(paren
r_struct
id|sys_device
op_star
id|dev
)paren
(brace
r_if
c_cond
(paren
id|pmu_enabled
)paren
id|pmu_start
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|oprofile_sysclass
r_static
r_struct
id|sysdev_class
id|oprofile_sysclass
op_assign
(brace
id|set_kset_name
c_func
(paren
l_string|&quot;oprofile&quot;
)paren
comma
dot
id|resume
op_assign
id|pmu_resume
comma
dot
id|suspend
op_assign
id|pmu_suspend
comma
)brace
suffix:semicolon
DECL|variable|device_oprofile
r_static
r_struct
id|sys_device
id|device_oprofile
op_assign
(brace
dot
id|id
op_assign
l_int|0
comma
dot
id|cls
op_assign
op_amp
id|oprofile_sysclass
comma
)brace
suffix:semicolon
DECL|function|init_driverfs
r_static
r_int
id|__init
id|init_driverfs
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ret
op_assign
id|sysdev_class_register
c_func
(paren
op_amp
id|oprofile_sysclass
)paren
)paren
)paren
id|ret
op_assign
id|sysdev_register
c_func
(paren
op_amp
id|device_oprofile
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|exit_driverfs
r_static
r_void
id|exit_driverfs
c_func
(paren
r_void
)paren
(brace
id|sysdev_unregister
c_func
(paren
op_amp
id|device_oprofile
)paren
suffix:semicolon
id|sysdev_class_unregister
c_func
(paren
op_amp
id|oprofile_sysclass
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|macro|init_driverfs
mdefine_line|#define init_driverfs()&t;do { } while (0)
DECL|macro|exit_driverfs
mdefine_line|#define exit_driverfs() do { } while (0)
macro_line|#endif /* CONFIG_PM */
DECL|variable|counter_config
r_struct
id|op_counter_config
id|counter_config
(braket
id|OP_MAX_COUNTER
)braket
suffix:semicolon
DECL|function|pmu_create_files
r_static
r_int
id|pmu_create_files
c_func
(paren
r_struct
id|super_block
op_star
id|sb
comma
r_struct
id|dentry
op_star
id|root
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pmu_model-&gt;num_counters
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|dentry
op_star
id|dir
suffix:semicolon
r_char
id|buf
(braket
l_int|2
)braket
suffix:semicolon
id|snprintf
c_func
(paren
id|buf
comma
r_sizeof
id|buf
comma
l_string|&quot;%d&quot;
comma
id|i
)paren
suffix:semicolon
id|dir
op_assign
id|oprofilefs_mkdir
c_func
(paren
id|sb
comma
id|root
comma
id|buf
)paren
suffix:semicolon
id|oprofilefs_create_ulong
c_func
(paren
id|sb
comma
id|dir
comma
l_string|&quot;enabled&quot;
comma
op_amp
id|counter_config
(braket
id|i
)braket
dot
id|enabled
)paren
suffix:semicolon
id|oprofilefs_create_ulong
c_func
(paren
id|sb
comma
id|dir
comma
l_string|&quot;event&quot;
comma
op_amp
id|counter_config
(braket
id|i
)braket
dot
id|event
)paren
suffix:semicolon
id|oprofilefs_create_ulong
c_func
(paren
id|sb
comma
id|dir
comma
l_string|&quot;count&quot;
comma
op_amp
id|counter_config
(braket
id|i
)braket
dot
id|count
)paren
suffix:semicolon
id|oprofilefs_create_ulong
c_func
(paren
id|sb
comma
id|dir
comma
l_string|&quot;unit_mask&quot;
comma
op_amp
id|counter_config
(braket
id|i
)braket
dot
id|unit_mask
)paren
suffix:semicolon
id|oprofilefs_create_ulong
c_func
(paren
id|sb
comma
id|dir
comma
l_string|&quot;kernel&quot;
comma
op_amp
id|counter_config
(braket
id|i
)braket
dot
id|kernel
)paren
suffix:semicolon
id|oprofilefs_create_ulong
c_func
(paren
id|sb
comma
id|dir
comma
l_string|&quot;user&quot;
comma
op_amp
id|counter_config
(braket
id|i
)braket
dot
id|user
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pmu_setup
r_static
r_int
id|pmu_setup
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|oprofilefs_lock
)paren
suffix:semicolon
id|ret
op_assign
id|pmu_model
op_member_access_from_pointer
id|setup_ctrs
c_func
(paren
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|oprofilefs_lock
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|pmu_start
r_static
r_int
id|pmu_start
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
op_assign
op_minus
id|EBUSY
suffix:semicolon
id|down
c_func
(paren
op_amp
id|pmu_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pmu_enabled
)paren
(brace
id|ret
op_assign
id|pmu_model
op_member_access_from_pointer
id|start
c_func
(paren
)paren
suffix:semicolon
id|pmu_enabled
op_assign
op_logical_neg
id|ret
suffix:semicolon
)brace
id|up
c_func
(paren
op_amp
id|pmu_sem
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|pmu_stop
r_static
r_void
id|pmu_stop
c_func
(paren
r_void
)paren
(brace
id|down
c_func
(paren
op_amp
id|pmu_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pmu_enabled
)paren
id|pmu_model
op_member_access_from_pointer
id|stop
c_func
(paren
)paren
suffix:semicolon
id|pmu_enabled
op_assign
l_int|0
suffix:semicolon
id|up
c_func
(paren
op_amp
id|pmu_sem
)paren
suffix:semicolon
)brace
DECL|function|pmu_init
r_int
id|__init
id|pmu_init
c_func
(paren
r_struct
id|oprofile_operations
op_star
id|ops
comma
r_struct
id|op_arm_model_spec
op_star
id|spec
)paren
(brace
id|init_MUTEX
c_func
(paren
op_amp
id|pmu_sem
)paren
suffix:semicolon
r_if
c_cond
(paren
id|spec
op_member_access_from_pointer
id|init
c_func
(paren
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|pmu_model
op_assign
id|spec
suffix:semicolon
id|init_driverfs
c_func
(paren
)paren
suffix:semicolon
id|ops-&gt;create_files
op_assign
id|pmu_create_files
suffix:semicolon
id|ops-&gt;setup
op_assign
id|pmu_setup
suffix:semicolon
id|ops-&gt;shutdown
op_assign
id|pmu_stop
suffix:semicolon
id|ops-&gt;start
op_assign
id|pmu_start
suffix:semicolon
id|ops-&gt;stop
op_assign
id|pmu_stop
suffix:semicolon
id|ops-&gt;cpu_type
op_assign
id|pmu_model-&gt;name
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;oprofile: using %s PMU&bslash;n&quot;
comma
id|spec-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pmu_exit
r_void
id|pmu_exit
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|pmu_model
)paren
(brace
id|exit_driverfs
c_func
(paren
)paren
suffix:semicolon
id|pmu_model
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
eof
