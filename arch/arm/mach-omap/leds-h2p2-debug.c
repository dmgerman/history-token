multiline_comment|/*&n; * linux/arch/arm/mach-omap/leds-h2p2-debug.c&n; *&n; * Copyright 2003 by Texas Instruments Incorporated&n; *&n; * There are 16 LEDs on the debug board (all green); four may be used&n; * for logical &squot;green&squot;, &squot;amber&squot;, &squot;red&squot;, and &squot;blue&squot; (after &quot;claiming&quot;).&n; *&n; * The &quot;surfer&quot; expansion board and H2 sample board also have two-color&n; * green+red LEDs (in parallel), used here for timer and idle indicators.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel_stat.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
macro_line|#include &lt;asm/leds.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/arch/fpga.h&gt;
macro_line|#include &lt;asm/arch/gpio.h&gt;
macro_line|#include &quot;leds.h&quot;
DECL|macro|GPIO_LED_RED
mdefine_line|#define GPIO_LED_RED&t;&t;3
DECL|macro|GPIO_LED_GREEN
mdefine_line|#define GPIO_LED_GREEN&t;&t;OMAP_MPUIO(4)
DECL|macro|LED_STATE_ENABLED
mdefine_line|#define LED_STATE_ENABLED&t;0x01
DECL|macro|LED_STATE_CLAIMED
mdefine_line|#define LED_STATE_CLAIMED&t;0x02
DECL|macro|LED_TIMER_ON
mdefine_line|#define LED_TIMER_ON&t;&t;0x04
DECL|macro|GPIO_IDLE
mdefine_line|#define GPIO_IDLE&t;&t;GPIO_LED_GREEN
DECL|macro|GPIO_TIMER
mdefine_line|#define GPIO_TIMER&t;&t;GPIO_LED_RED
DECL|function|h2p2_dbg_leds_event
r_void
id|h2p2_dbg_leds_event
c_func
(paren
id|led_event_t
id|evt
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_static
r_struct
id|h2p2_dbg_fpga
id|__iomem
op_star
id|fpga
suffix:semicolon
r_static
id|u16
id|led_state
comma
id|hw_led_state
suffix:semicolon
id|local_irq_save
c_func
(paren
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|led_state
op_amp
id|LED_STATE_ENABLED
)paren
op_logical_and
id|evt
op_ne
id|led_start
)paren
r_goto
id|done
suffix:semicolon
r_switch
c_cond
(paren
id|evt
)paren
(brace
r_case
id|led_start
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|fpga
)paren
id|fpga
op_assign
id|ioremap
c_func
(paren
id|H2P2_DBG_FPGA_START
comma
id|H2P2_DBG_FPGA_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fpga
)paren
(brace
id|led_state
op_or_assign
id|LED_STATE_ENABLED
suffix:semicolon
id|__raw_writew
c_func
(paren
op_complement
l_int|0
comma
op_amp
id|fpga-&gt;leds
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|led_stop
suffix:colon
r_case
id|led_halted
suffix:colon
multiline_comment|/* all leds off during suspend or shutdown */
id|omap_set_gpio_dataout
c_func
(paren
id|GPIO_TIMER
comma
l_int|0
)paren
suffix:semicolon
id|omap_set_gpio_dataout
c_func
(paren
id|GPIO_IDLE
comma
l_int|0
)paren
suffix:semicolon
id|__raw_writew
c_func
(paren
op_complement
l_int|0
comma
op_amp
id|fpga-&gt;leds
)paren
suffix:semicolon
id|led_state
op_and_assign
op_complement
id|LED_STATE_ENABLED
suffix:semicolon
r_if
c_cond
(paren
id|evt
op_eq
id|led_halted
)paren
(brace
id|iounmap
c_func
(paren
id|fpga
)paren
suffix:semicolon
id|fpga
op_assign
l_int|NULL
suffix:semicolon
)brace
r_goto
id|done
suffix:semicolon
r_case
id|led_claim
suffix:colon
id|led_state
op_or_assign
id|LED_STATE_CLAIMED
suffix:semicolon
id|hw_led_state
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|led_release
suffix:colon
id|led_state
op_and_assign
op_complement
id|LED_STATE_CLAIMED
suffix:semicolon
r_break
suffix:semicolon
macro_line|#ifdef CONFIG_LEDS_TIMER
r_case
id|led_timer
suffix:colon
id|led_state
op_xor_assign
id|LED_TIMER_ON
suffix:semicolon
id|omap_set_gpio_dataout
c_func
(paren
id|GPIO_TIMER
comma
id|led_state
op_amp
id|LED_TIMER_ON
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_LEDS_CPU
r_case
id|led_idle_start
suffix:colon
id|omap_set_gpio_dataout
c_func
(paren
id|GPIO_IDLE
comma
l_int|1
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
r_case
id|led_idle_end
suffix:colon
id|omap_set_gpio_dataout
c_func
(paren
id|GPIO_IDLE
comma
l_int|0
)paren
suffix:semicolon
r_goto
id|done
suffix:semicolon
macro_line|#endif
r_case
id|led_green_on
suffix:colon
id|hw_led_state
op_or_assign
id|H2P2_DBG_FPGA_LED_GREEN
suffix:semicolon
r_break
suffix:semicolon
r_case
id|led_green_off
suffix:colon
id|hw_led_state
op_and_assign
op_complement
id|H2P2_DBG_FPGA_LED_GREEN
suffix:semicolon
r_break
suffix:semicolon
r_case
id|led_amber_on
suffix:colon
id|hw_led_state
op_or_assign
id|H2P2_DBG_FPGA_LED_AMBER
suffix:semicolon
r_break
suffix:semicolon
r_case
id|led_amber_off
suffix:colon
id|hw_led_state
op_and_assign
op_complement
id|H2P2_DBG_FPGA_LED_AMBER
suffix:semicolon
r_break
suffix:semicolon
r_case
id|led_red_on
suffix:colon
id|hw_led_state
op_or_assign
id|H2P2_DBG_FPGA_LED_RED
suffix:semicolon
r_break
suffix:semicolon
r_case
id|led_red_off
suffix:colon
id|hw_led_state
op_and_assign
op_complement
id|H2P2_DBG_FPGA_LED_RED
suffix:semicolon
r_break
suffix:semicolon
r_case
id|led_blue_on
suffix:colon
id|hw_led_state
op_or_assign
id|H2P2_DBG_FPGA_LED_BLUE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|led_blue_off
suffix:colon
id|hw_led_state
op_and_assign
op_complement
id|H2P2_DBG_FPGA_LED_BLUE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
multiline_comment|/*&n;&t; *  Actually burn the LEDs&n;&t; */
r_if
c_cond
(paren
id|led_state
op_amp
id|LED_STATE_CLAIMED
)paren
id|__raw_writew
c_func
(paren
op_complement
id|hw_led_state
comma
op_amp
id|fpga-&gt;leds
)paren
suffix:semicolon
id|done
suffix:colon
id|local_irq_restore
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
eof
