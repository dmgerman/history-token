multiline_comment|/*&n; *  linux/arch/arm/mach-omap/clock.c&n; *&n; *  Copyright (C) 2004 Nokia corporation&n; *  Written by Tuukka Tikkanen &lt;tuukka.tikkanen@elektrobit.com&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2 as&n; * published by the Free Software Foundation.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/err.h&gt;
macro_line|#include &lt;asm/semaphore.h&gt;
macro_line|#include &lt;asm/hardware/clock.h&gt;
macro_line|#include &lt;asm/arch/board.h&gt;
macro_line|#include &quot;clock.h&quot;
r_static
id|LIST_HEAD
c_func
(paren
id|clocks
)paren
suffix:semicolon
r_static
id|DECLARE_MUTEX
c_func
(paren
id|clocks_sem
)paren
suffix:semicolon
DECL|variable|clockfw_lock
r_static
id|spinlock_t
id|clockfw_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
r_static
r_void
id|propagate_rate
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
suffix:semicolon
multiline_comment|/* MPU virtual clock functions */
r_static
r_int
id|select_table_rate
c_func
(paren
r_int
r_int
id|rate
)paren
suffix:semicolon
r_static
r_int
id|round_to_table_rate
c_func
(paren
r_int
r_int
id|rate
)paren
suffix:semicolon
r_void
id|clk_setdpll
c_func
(paren
id|__u16
comma
id|__u16
)paren
suffix:semicolon
DECL|variable|rate_table
r_struct
id|mpu_rate
id|rate_table
(braket
)braket
op_assign
(brace
multiline_comment|/* MPU MHz, xtal MHz, dpll1 MHz, CKCTL, DPLL_CTL&n;&t; * armdiv, dspdiv, dspmmu, tcdiv, perdiv, lcddiv&n;&t; */
macro_line|#if defined(CONFIG_OMAP_ARM_195MHZ) &amp;&amp; defined(CONFIG_ARCH_OMAP730)
(brace
l_int|195000000
comma
l_int|13000000
comma
l_int|195000000
comma
l_int|0x050e
comma
l_int|0x2790
)brace
comma
multiline_comment|/* 1/1/2/2/4/8 */
macro_line|#endif
macro_line|#if defined(CONFIG_OMAP_ARM_192MHZ) &amp;&amp; defined(CONFIG_ARCH_OMAP16XX)
(brace
l_int|192000000
comma
l_int|19200000
comma
l_int|192000000
comma
l_int|0x050f
comma
l_int|0x2510
)brace
comma
multiline_comment|/* 1/1/2/2/8/8 */
(brace
l_int|192000000
comma
l_int|12000000
comma
l_int|192000000
comma
l_int|0x050f
comma
l_int|0x2810
)brace
comma
multiline_comment|/* 1/1/2/2/8/8 */
(brace
l_int|96000000
comma
l_int|12000000
comma
l_int|192000000
comma
l_int|0x055f
comma
l_int|0x2810
)brace
comma
multiline_comment|/* 2/2/2/2/8/8 */
(brace
l_int|48000000
comma
l_int|12000000
comma
l_int|192000000
comma
l_int|0x0ccf
comma
l_int|0x2810
)brace
comma
multiline_comment|/* 4/4/4/4/8/8 */
(brace
l_int|24000000
comma
l_int|12000000
comma
l_int|192000000
comma
l_int|0x0fff
comma
l_int|0x2810
)brace
comma
multiline_comment|/* 8/8/8/8/8/8 */
macro_line|#endif
macro_line|#if defined(CONFIG_OMAP_ARM_182MHZ) &amp;&amp; defined(CONFIG_ARCH_OMAP730)
(brace
l_int|182000000
comma
l_int|13000000
comma
l_int|182000000
comma
l_int|0x050e
comma
l_int|0x2710
)brace
comma
multiline_comment|/* 1/1/2/2/4/8 */
macro_line|#endif
macro_line|#if defined(CONFIG_OMAP_ARM_168MHZ)
(brace
l_int|168000000
comma
l_int|12000000
comma
l_int|168000000
comma
l_int|0x010f
comma
l_int|0x2710
)brace
comma
multiline_comment|/* 1/1/1/2/8/8 */
macro_line|#endif
macro_line|#if defined(CONFIG_OMAP_ARM_120MHZ)
(brace
l_int|120000000
comma
l_int|12000000
comma
l_int|120000000
comma
l_int|0x010a
comma
l_int|0x2510
)brace
comma
multiline_comment|/* 1/1/1/2/4/4 */
macro_line|#endif
macro_line|#if defined(CONFIG_OMAP_ARM_96MHZ)
(brace
l_int|96000000
comma
l_int|12000000
comma
l_int|96000000
comma
l_int|0x0005
comma
l_int|0x2410
)brace
comma
multiline_comment|/* 1/1/1/1/2/2 */
macro_line|#endif
macro_line|#if defined(CONFIG_OMAP_ARM_60MHZ)
(brace
l_int|60000000
comma
l_int|12000000
comma
l_int|60000000
comma
l_int|0x0005
comma
l_int|0x2290
)brace
comma
multiline_comment|/* 1/1/1/1/2/2 */
macro_line|#endif
macro_line|#if defined(CONFIG_OMAP_ARM_30MHZ)
(brace
l_int|30000000
comma
l_int|12000000
comma
l_int|60000000
comma
l_int|0x0555
comma
l_int|0x2290
)brace
comma
multiline_comment|/* 2/2/2/2/2/2 */
macro_line|#endif
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
)brace
suffix:semicolon
DECL|function|ckctl_recalc
r_static
r_void
id|ckctl_recalc
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
r_int
id|dsor
suffix:semicolon
multiline_comment|/* Calculate divisor encoded as 2-bit exponent */
id|dsor
op_assign
l_int|1
op_lshift
(paren
l_int|3
op_amp
(paren
id|omap_readw
c_func
(paren
id|ARM_CKCTL
)paren
op_rshift
id|clk-&gt;rate_offset
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|clk-&gt;rate
op_eq
id|clk-&gt;parent-&gt;rate
op_div
id|dsor
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* No change, quick exit */
id|clk-&gt;rate
op_assign
id|clk-&gt;parent-&gt;rate
op_div
id|dsor
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|clk-&gt;flags
op_amp
id|RATE_PROPAGATES
)paren
)paren
id|propagate_rate
c_func
(paren
id|clk
)paren
suffix:semicolon
)brace
DECL|function|followparent_recalc
r_static
r_void
id|followparent_recalc
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
id|clk-&gt;rate
op_assign
id|clk-&gt;parent-&gt;rate
suffix:semicolon
)brace
DECL|function|watchdog_recalc
r_static
r_void
id|watchdog_recalc
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
id|clk-&gt;rate
op_assign
id|clk-&gt;parent-&gt;rate
op_div
l_int|14
suffix:semicolon
)brace
DECL|variable|ck_ref
r_static
r_struct
id|clk
id|ck_ref
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;ck_ref&quot;
comma
dot
id|rate
op_assign
l_int|12000000
comma
dot
id|flags
op_assign
id|ALWAYS_ENABLED
comma
)brace
suffix:semicolon
DECL|variable|ck_dpll1
r_static
r_struct
id|clk
id|ck_dpll1
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;ck_dpll1&quot;
comma
dot
id|parent
op_assign
op_amp
id|ck_ref
comma
dot
id|flags
op_assign
id|RATE_PROPAGATES
op_or
id|ALWAYS_ENABLED
comma
)brace
suffix:semicolon
DECL|variable|ck_dpll1out
r_static
r_struct
id|clk
id|ck_dpll1out
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;ck_dpll1out&quot;
comma
dot
id|parent
op_assign
op_amp
id|ck_dpll1
comma
dot
id|flags
op_assign
id|DOES_NOT_EXIST_ON_1510
comma
dot
id|enable_reg
op_assign
id|ARM_IDLECT2
comma
dot
id|enable_bit
op_assign
id|EN_CKOUT_ARM
comma
dot
id|recalc
op_assign
op_amp
id|followparent_recalc
comma
)brace
suffix:semicolon
DECL|variable|arm_ck
r_static
r_struct
id|clk
id|arm_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;arm_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|ck_dpll1
comma
dot
id|flags
op_assign
id|RATE_CKCTL
op_or
id|RATE_PROPAGATES
op_or
id|ALWAYS_ENABLED
comma
dot
id|rate_offset
op_assign
id|CKCTL_ARMDIV_OFFSET
comma
dot
id|recalc
op_assign
op_amp
id|ckctl_recalc
comma
)brace
suffix:semicolon
DECL|variable|armper_ck
r_static
r_struct
id|clk
id|armper_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;armper_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|ck_dpll1
comma
dot
id|flags
op_assign
id|RATE_CKCTL
comma
dot
id|enable_reg
op_assign
id|ARM_IDLECT2
comma
dot
id|enable_bit
op_assign
id|EN_PERCK
comma
dot
id|rate_offset
op_assign
id|CKCTL_PERDIV_OFFSET
comma
dot
id|recalc
op_assign
op_amp
id|ckctl_recalc
comma
)brace
suffix:semicolon
DECL|variable|arm_gpio_ck
r_static
r_struct
id|clk
id|arm_gpio_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;arm_gpio_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|ck_dpll1
comma
dot
id|flags
op_assign
id|DOES_NOT_EXIST_ON_1610
comma
dot
id|enable_reg
op_assign
id|ARM_IDLECT2
comma
dot
id|enable_bit
op_assign
id|EN_GPIOCK
comma
dot
id|recalc
op_assign
op_amp
id|followparent_recalc
comma
)brace
suffix:semicolon
DECL|variable|armxor_ck
r_static
r_struct
id|clk
id|armxor_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;armxor_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|ck_ref
comma
dot
id|enable_reg
op_assign
id|ARM_IDLECT2
comma
dot
id|enable_bit
op_assign
id|EN_XORPCK
comma
dot
id|recalc
op_assign
op_amp
id|followparent_recalc
comma
)brace
suffix:semicolon
DECL|variable|armtim_ck
r_static
r_struct
id|clk
id|armtim_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;armtim_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|ck_ref
comma
dot
id|enable_reg
op_assign
id|ARM_IDLECT2
comma
dot
id|enable_bit
op_assign
id|EN_TIMCK
comma
dot
id|recalc
op_assign
op_amp
id|followparent_recalc
comma
)brace
suffix:semicolon
DECL|variable|armwdt_ck
r_static
r_struct
id|clk
id|armwdt_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;armwdt_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|ck_ref
comma
dot
id|enable_reg
op_assign
id|ARM_IDLECT2
comma
dot
id|enable_bit
op_assign
id|EN_WDTCK
comma
dot
id|recalc
op_assign
op_amp
id|watchdog_recalc
comma
)brace
suffix:semicolon
DECL|variable|arminth_ck1610
r_static
r_struct
id|clk
id|arminth_ck1610
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;arminth_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|arm_ck
comma
dot
id|flags
op_assign
id|DOES_NOT_EXIST_ON_1510
comma
dot
id|recalc
op_assign
op_amp
id|followparent_recalc
comma
multiline_comment|/* Note: On 1610/1710 frequency can be divided by 2 by programming&n;&t; * ARM_CKCTL:ARM_INTHCK_SEL(14) to 1&n;&t; *&n;&t; * 1510 version is in TC clocks.&n;&t; */
)brace
suffix:semicolon
DECL|variable|dsp_ck
r_static
r_struct
id|clk
id|dsp_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;dsp_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|ck_dpll1
comma
dot
id|flags
op_assign
id|RATE_CKCTL
comma
dot
id|enable_reg
op_assign
id|ARM_CKCTL
comma
dot
id|enable_bit
op_assign
id|EN_DSPCK
comma
dot
id|rate_offset
op_assign
id|CKCTL_DSPDIV_OFFSET
comma
dot
id|recalc
op_assign
op_amp
id|ckctl_recalc
comma
)brace
suffix:semicolon
DECL|variable|dspmmu_ck
r_static
r_struct
id|clk
id|dspmmu_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;dspmmu_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|ck_dpll1
comma
dot
id|flags
op_assign
id|RATE_CKCTL
op_or
id|ALWAYS_ENABLED
comma
dot
id|rate_offset
op_assign
id|CKCTL_DSPMMUDIV_OFFSET
comma
dot
id|recalc
op_assign
op_amp
id|ckctl_recalc
comma
)brace
suffix:semicolon
DECL|variable|tc_ck
r_static
r_struct
id|clk
id|tc_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;tc_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|ck_dpll1
comma
dot
id|flags
op_assign
id|RATE_CKCTL
op_or
id|RATE_PROPAGATES
op_or
id|ALWAYS_ENABLED
comma
dot
id|rate_offset
op_assign
id|CKCTL_TCDIV_OFFSET
comma
dot
id|recalc
op_assign
op_amp
id|ckctl_recalc
comma
)brace
suffix:semicolon
DECL|variable|arminth_ck1510
r_static
r_struct
id|clk
id|arminth_ck1510
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;arminth_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|tc_ck
comma
dot
id|flags
op_assign
id|DOES_NOT_EXIST_ON_1610
comma
dot
id|recalc
op_assign
op_amp
id|followparent_recalc
comma
multiline_comment|/* Note: On 1510 frequency follows TC_CK&n;&t; *&n;&t; * 1610/1710 version is in MPU clocks.&n;&t; */
)brace
suffix:semicolon
DECL|variable|tipb_ck
r_static
r_struct
id|clk
id|tipb_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;tibp_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|tc_ck
comma
dot
id|flags
op_assign
id|DOES_NOT_EXIST_ON_1610
comma
dot
id|recalc
op_assign
op_amp
id|followparent_recalc
comma
)brace
suffix:semicolon
DECL|variable|l3_ocpi_ck
r_static
r_struct
id|clk
id|l3_ocpi_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;l3_ocpi_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|tc_ck
comma
dot
id|flags
op_assign
id|DOES_NOT_EXIST_ON_1510
comma
dot
id|enable_reg
op_assign
id|ARM_IDLECT3
comma
dot
id|enable_bit
op_assign
id|EN_OCPI_CK
comma
dot
id|recalc
op_assign
op_amp
id|followparent_recalc
comma
)brace
suffix:semicolon
DECL|variable|tc1_ck
r_static
r_struct
id|clk
id|tc1_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;tc1_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|tc_ck
comma
dot
id|flags
op_assign
id|DOES_NOT_EXIST_ON_1510
comma
dot
id|enable_reg
op_assign
id|ARM_IDLECT3
comma
dot
id|enable_bit
op_assign
id|EN_TC1_CK
comma
dot
id|recalc
op_assign
op_amp
id|followparent_recalc
comma
)brace
suffix:semicolon
DECL|variable|tc2_ck
r_static
r_struct
id|clk
id|tc2_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;tc2_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|tc_ck
comma
dot
id|flags
op_assign
id|DOES_NOT_EXIST_ON_1510
comma
dot
id|enable_reg
op_assign
id|ARM_IDLECT3
comma
dot
id|enable_bit
op_assign
id|EN_TC2_CK
comma
dot
id|recalc
op_assign
op_amp
id|followparent_recalc
comma
)brace
suffix:semicolon
DECL|variable|dma_ck
r_static
r_struct
id|clk
id|dma_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;dma_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|tc_ck
comma
dot
id|recalc
op_assign
op_amp
id|followparent_recalc
comma
)brace
suffix:semicolon
DECL|variable|dma_lcdfree_ck
r_static
r_struct
id|clk
id|dma_lcdfree_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;dma_lcdfree_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|tc_ck
comma
dot
id|flags
op_assign
id|DOES_NOT_EXIST_ON_1510
comma
dot
id|recalc
op_assign
op_amp
id|followparent_recalc
comma
)brace
suffix:semicolon
DECL|variable|api_ck
r_static
r_struct
id|clk
id|api_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;api_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|tc_ck
comma
dot
id|enable_reg
op_assign
id|ARM_IDLECT2
comma
dot
id|enable_bit
op_assign
id|EN_APICK
comma
dot
id|recalc
op_assign
op_amp
id|followparent_recalc
comma
)brace
suffix:semicolon
DECL|variable|lb_ck
r_static
r_struct
id|clk
id|lb_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;lb_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|tc_ck
comma
dot
id|flags
op_assign
id|DOES_NOT_EXIST_ON_1610
comma
dot
id|enable_reg
op_assign
id|ARM_IDLECT2
comma
dot
id|enable_bit
op_assign
id|EN_LBCK
comma
dot
id|recalc
op_assign
op_amp
id|followparent_recalc
comma
)brace
suffix:semicolon
DECL|variable|rhea1_ck
r_static
r_struct
id|clk
id|rhea1_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;rhea1_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|tc_ck
comma
dot
id|flags
op_assign
id|DOES_NOT_EXIST_ON_1510
comma
dot
id|recalc
op_assign
op_amp
id|followparent_recalc
comma
)brace
suffix:semicolon
DECL|variable|rhea2_ck
r_static
r_struct
id|clk
id|rhea2_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;rhea2_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|tc_ck
comma
dot
id|flags
op_assign
id|DOES_NOT_EXIST_ON_1510
comma
dot
id|recalc
op_assign
op_amp
id|followparent_recalc
comma
)brace
suffix:semicolon
DECL|variable|lcd_ck
r_static
r_struct
id|clk
id|lcd_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;lcd_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|ck_dpll1
comma
dot
id|flags
op_assign
id|RATE_CKCTL
comma
dot
id|enable_reg
op_assign
id|ARM_IDLECT2
comma
dot
id|enable_bit
op_assign
id|EN_LCDCK
comma
dot
id|rate_offset
op_assign
id|CKCTL_LCDDIV_OFFSET
comma
dot
id|recalc
op_assign
op_amp
id|ckctl_recalc
comma
)brace
suffix:semicolon
DECL|variable|uart1_ck
r_static
r_struct
id|clk
id|uart1_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;uart1_ck&quot;
comma
multiline_comment|/* Direct from ULPD, no parent */
dot
id|rate
op_assign
l_int|48000000
comma
dot
id|flags
op_assign
id|RATE_FIXED
op_or
id|ENABLE_REG_32BIT
comma
dot
id|enable_reg
op_assign
id|MOD_CONF_CTRL_0
comma
dot
id|enable_bit
op_assign
l_int|29
comma
multiline_comment|/* (Only on 1510)&n;&t; * The &quot;enable bit&quot; actually chooses between 48MHz and 12MHz.&n;&t; */
)brace
suffix:semicolon
DECL|variable|uart2_ck
r_static
r_struct
id|clk
id|uart2_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;uart2_ck&quot;
comma
multiline_comment|/* Direct from ULPD, no parent */
dot
id|rate
op_assign
l_int|48000000
comma
dot
id|flags
op_assign
id|RATE_FIXED
op_or
id|ENABLE_REG_32BIT
comma
dot
id|enable_reg
op_assign
id|MOD_CONF_CTRL_0
comma
dot
id|enable_bit
op_assign
l_int|30
comma
multiline_comment|/* (1510/1610/1710)&n;&t; * The &quot;enable bit&quot; actually chooses between 48MHz and 12MHz/32kHz.&n;&t; */
)brace
suffix:semicolon
DECL|variable|uart3_ck
r_static
r_struct
id|clk
id|uart3_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;uart3_ck&quot;
comma
multiline_comment|/* Direct from ULPD, no parent */
dot
id|rate
op_assign
l_int|48000000
comma
dot
id|flags
op_assign
id|RATE_FIXED
op_or
id|ENABLE_REG_32BIT
comma
dot
id|enable_reg
op_assign
id|MOD_CONF_CTRL_0
comma
dot
id|enable_bit
op_assign
l_int|31
comma
multiline_comment|/* (Only on 1510)&n;&t; * The &quot;enable bit&quot; actually chooses between 48MHz and 12MHz.&n;&t; */
)brace
suffix:semicolon
DECL|variable|usb_ck1610
r_static
r_struct
id|clk
id|usb_ck1610
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;usb_ck&quot;
comma
multiline_comment|/* Direct from ULPD, no parent */
dot
id|rate
op_assign
l_int|48000000
comma
dot
id|flags
op_assign
id|RATE_FIXED
op_or
id|ENABLE_REG_32BIT
op_or
id|DOES_NOT_EXIST_ON_1510
comma
dot
id|enable_reg
op_assign
id|ULPD_CLOCK_CTRL
comma
dot
id|enable_bit
op_assign
id|USB_MCLK_EN
comma
)brace
suffix:semicolon
DECL|variable|usb_ck1510
r_static
r_struct
id|clk
id|usb_ck1510
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;usb_ck&quot;
comma
multiline_comment|/* Direct from ULPD, no parent */
dot
id|rate
op_assign
l_int|48000000
comma
dot
id|flags
op_assign
id|RATE_FIXED
op_or
id|DOES_NOT_EXIST_ON_1610
comma
)brace
suffix:semicolon
DECL|variable|usb_hhc_ck
r_static
r_struct
id|clk
id|usb_hhc_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;usb_hhc_ck&quot;
comma
multiline_comment|/* Direct from ULPD, no parent */
dot
id|rate
op_assign
l_int|48000000
comma
multiline_comment|/* Actually 2 clocks, 12MHz and 48MHz */
dot
id|flags
op_assign
id|RATE_FIXED
op_or
id|ENABLE_REG_32BIT
comma
dot
id|enable_reg
op_assign
id|MOD_CONF_CTRL_0
comma
dot
id|enable_bit
op_assign
id|USB_HOST_HHC_UHOST_EN
comma
)brace
suffix:semicolon
multiline_comment|/* To be done --&n;static struct clk mclk = {&n;&t;.name&t;&t;= &quot;mclk&quot;,&n;};&n;&n;static struct clk bclk = {&n;&t;.name&t;&t;= &quot;bclk&quot;,&n;};&n;-- to be done */
DECL|variable|mmc_ck
r_static
r_struct
id|clk
id|mmc_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;mmc1_ck&quot;
comma
dot
id|parent
op_assign
op_amp
id|armxor_ck
comma
multiline_comment|/* (1510) */
dot
id|rate
op_assign
l_int|48000000
comma
dot
id|flags
op_assign
id|RATE_FIXED
op_or
id|ENABLE_REG_32BIT
op_or
id|DOES_NOT_EXIST_ON_1610
comma
dot
id|enable_reg
op_assign
id|MOD_CONF_CTRL_0
comma
dot
id|enable_bit
op_assign
l_int|23
comma
)brace
suffix:semicolon
DECL|variable|mmc1_ck
r_static
r_struct
id|clk
id|mmc1_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;mmc1_ck&quot;
comma
multiline_comment|/* Direct from ULPD, no parent (1610/1710) */
dot
id|rate
op_assign
l_int|48000000
comma
dot
id|flags
op_assign
id|RATE_FIXED
op_or
id|ENABLE_REG_32BIT
op_or
id|DOES_NOT_EXIST_ON_1510
comma
dot
id|enable_reg
op_assign
id|MOD_CONF_CTRL_0
comma
dot
id|enable_bit
op_assign
l_int|23
comma
)brace
suffix:semicolon
DECL|variable|mmc2_ck
r_static
r_struct
id|clk
id|mmc2_ck
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;mmc2_ck&quot;
comma
multiline_comment|/* Direct from ULPD, no parent */
dot
id|rate
op_assign
l_int|48000000
comma
dot
id|flags
op_assign
id|RATE_FIXED
op_or
id|ENABLE_REG_32BIT
op_or
id|DOES_NOT_EXIST_ON_1510
comma
dot
id|enable_reg
op_assign
id|MOD_CONF_CTRL_0
comma
dot
id|enable_bit
op_assign
l_int|20
comma
)brace
suffix:semicolon
DECL|variable|virtual_ck_mpu
r_static
r_struct
id|clk
id|virtual_ck_mpu
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;mpu&quot;
comma
dot
id|flags
op_assign
id|VIRTUAL_CLOCK
op_or
id|ALWAYS_ENABLED
comma
dot
id|parent
op_assign
op_amp
id|arm_ck
comma
multiline_comment|/* Is smarter alias for */
dot
id|recalc
op_assign
op_amp
id|followparent_recalc
comma
dot
id|set_rate
op_assign
op_amp
id|select_table_rate
comma
dot
id|round_rate
op_assign
op_amp
id|round_to_table_rate
comma
)brace
suffix:semicolon
DECL|variable|onchip_clks
r_static
r_struct
id|clk
op_star
id|onchip_clks
(braket
)braket
op_assign
(brace
multiline_comment|/* non-ULPD clocks */
op_amp
id|ck_ref
comma
op_amp
id|ck_dpll1
comma
multiline_comment|/* CK_GEN1 clocks */
op_amp
id|ck_dpll1out
comma
op_amp
id|arm_ck
comma
op_amp
id|armper_ck
comma
op_amp
id|arm_gpio_ck
comma
op_amp
id|armxor_ck
comma
op_amp
id|armtim_ck
comma
op_amp
id|armwdt_ck
comma
op_amp
id|arminth_ck1510
comma
op_amp
id|arminth_ck1610
comma
multiline_comment|/* CK_GEN2 clocks */
op_amp
id|dsp_ck
comma
op_amp
id|dspmmu_ck
comma
multiline_comment|/* CK_GEN3 clocks */
op_amp
id|tc_ck
comma
op_amp
id|tipb_ck
comma
op_amp
id|l3_ocpi_ck
comma
op_amp
id|tc1_ck
comma
op_amp
id|tc2_ck
comma
op_amp
id|dma_ck
comma
op_amp
id|dma_lcdfree_ck
comma
op_amp
id|api_ck
comma
op_amp
id|lb_ck
comma
op_amp
id|rhea1_ck
comma
op_amp
id|rhea2_ck
comma
op_amp
id|lcd_ck
comma
multiline_comment|/* ULPD clocks */
op_amp
id|uart1_ck
comma
op_amp
id|uart2_ck
comma
op_amp
id|uart3_ck
comma
op_amp
id|usb_ck1510
comma
op_amp
id|usb_ck1610
comma
op_amp
id|usb_hhc_ck
comma
multiline_comment|/* To be done --&n;&t;&amp;mclk,&n;&t;&amp;bclk,&n;&t;-- to be done */
op_amp
id|mmc_ck
comma
multiline_comment|/* 1510 */
op_amp
id|mmc1_ck
comma
multiline_comment|/* 1610/1710 */
op_amp
id|mmc2_ck
comma
multiline_comment|/* Virtual clocks */
op_amp
id|virtual_ck_mpu
comma
)brace
suffix:semicolon
DECL|function|clk_get
r_struct
id|clk
op_star
id|clk_get
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_const
r_char
op_star
id|id
)paren
(brace
r_struct
id|clk
op_star
id|p
comma
op_star
id|clk
op_assign
id|ERR_PTR
c_func
(paren
op_minus
id|ENOENT
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|clocks_sem
)paren
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|p
comma
op_amp
id|clocks
comma
id|node
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|id
comma
id|p-&gt;name
)paren
op_eq
l_int|0
op_logical_and
id|try_module_get
c_func
(paren
id|p-&gt;owner
)paren
)paren
(brace
id|clk
op_assign
id|p
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|up
c_func
(paren
op_amp
id|clocks_sem
)paren
suffix:semicolon
r_return
id|clk
suffix:semicolon
)brace
DECL|variable|clk_get
id|EXPORT_SYMBOL
c_func
(paren
id|clk_get
)paren
suffix:semicolon
DECL|function|clk_put
r_void
id|clk_put
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
r_if
c_cond
(paren
id|clk
op_logical_and
op_logical_neg
id|IS_ERR
c_func
(paren
id|clk
)paren
)paren
id|module_put
c_func
(paren
id|clk-&gt;owner
)paren
suffix:semicolon
)brace
DECL|variable|clk_put
id|EXPORT_SYMBOL
c_func
(paren
id|clk_put
)paren
suffix:semicolon
DECL|function|__clk_enable
r_int
id|__clk_enable
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
id|__u16
id|regval16
suffix:semicolon
id|__u32
id|regval32
suffix:semicolon
r_if
c_cond
(paren
id|clk-&gt;flags
op_amp
id|ALWAYS_ENABLED
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|clk-&gt;enable_reg
op_eq
l_int|0
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Enable for %s without enable enabled&bslash;n&quot;
comma
id|clk-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|clk-&gt;flags
op_amp
id|ENABLE_REG_32BIT
)paren
(brace
id|regval32
op_assign
id|omap_readl
c_func
(paren
id|clk-&gt;enable_reg
)paren
suffix:semicolon
id|regval32
op_or_assign
(paren
l_int|1
op_lshift
id|clk-&gt;enable_bit
)paren
suffix:semicolon
id|omap_writel
c_func
(paren
id|regval32
comma
id|clk-&gt;enable_reg
)paren
suffix:semicolon
)brace
r_else
(brace
id|regval16
op_assign
id|omap_readw
c_func
(paren
id|clk-&gt;enable_reg
)paren
suffix:semicolon
id|regval16
op_or_assign
(paren
l_int|1
op_lshift
id|clk-&gt;enable_bit
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|regval16
comma
id|clk-&gt;enable_reg
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|__clk_disable
r_void
id|__clk_disable
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
id|__u16
id|regval16
suffix:semicolon
id|__u32
id|regval32
suffix:semicolon
r_if
c_cond
(paren
id|clk-&gt;enable_reg
op_eq
l_int|0
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|clk-&gt;flags
op_amp
id|ENABLE_REG_32BIT
)paren
(brace
id|regval32
op_assign
id|omap_readl
c_func
(paren
id|clk-&gt;enable_reg
)paren
suffix:semicolon
id|regval32
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|clk-&gt;enable_bit
)paren
suffix:semicolon
id|omap_writel
c_func
(paren
id|regval32
comma
id|clk-&gt;enable_reg
)paren
suffix:semicolon
)brace
r_else
(brace
id|regval16
op_assign
id|omap_readw
c_func
(paren
id|clk-&gt;enable_reg
)paren
suffix:semicolon
id|regval16
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|clk-&gt;enable_bit
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|regval16
comma
id|clk-&gt;enable_reg
)paren
suffix:semicolon
)brace
)brace
DECL|function|__clk_unuse
r_void
id|__clk_unuse
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
r_if
c_cond
(paren
id|clk-&gt;usecount
OG
l_int|0
op_logical_and
op_logical_neg
(paren
op_decrement
id|clk-&gt;usecount
)paren
)paren
(brace
id|__clk_disable
c_func
(paren
id|clk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|clk-&gt;parent
)paren
)paren
id|__clk_unuse
c_func
(paren
id|clk-&gt;parent
)paren
suffix:semicolon
)brace
)brace
DECL|function|__clk_use
r_int
id|__clk_use
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|clk-&gt;usecount
op_increment
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|likely
c_func
(paren
id|clk-&gt;parent
)paren
)paren
id|ret
op_assign
id|__clk_use
c_func
(paren
id|clk-&gt;parent
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|ret
op_ne
l_int|0
)paren
)paren
(brace
id|clk-&gt;usecount
op_decrement
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|ret
op_assign
id|__clk_enable
c_func
(paren
id|clk
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|ret
op_ne
l_int|0
)paren
op_logical_and
id|clk-&gt;parent
)paren
(brace
id|__clk_unuse
c_func
(paren
id|clk-&gt;parent
)paren
suffix:semicolon
id|clk-&gt;usecount
op_decrement
suffix:semicolon
)brace
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|clk_enable
r_int
id|clk_enable
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|clockfw_lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|__clk_enable
c_func
(paren
id|clk
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|clockfw_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|clk_enable
id|EXPORT_SYMBOL
c_func
(paren
id|clk_enable
)paren
suffix:semicolon
DECL|function|clk_disable
r_void
id|clk_disable
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|clockfw_lock
comma
id|flags
)paren
suffix:semicolon
id|__clk_disable
c_func
(paren
id|clk
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|clockfw_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|variable|clk_disable
id|EXPORT_SYMBOL
c_func
(paren
id|clk_disable
)paren
suffix:semicolon
DECL|function|clk_use
r_int
id|clk_use
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|clockfw_lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|__clk_use
c_func
(paren
id|clk
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|clockfw_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|clk_use
id|EXPORT_SYMBOL
c_func
(paren
id|clk_use
)paren
suffix:semicolon
DECL|function|clk_unuse
r_void
id|clk_unuse
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|clockfw_lock
comma
id|flags
)paren
suffix:semicolon
id|__clk_unuse
c_func
(paren
id|clk
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|clockfw_lock
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|variable|clk_unuse
id|EXPORT_SYMBOL
c_func
(paren
id|clk_unuse
)paren
suffix:semicolon
DECL|function|clk_get_rate
r_int
r_int
id|clk_get_rate
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
r_if
c_cond
(paren
id|clk-&gt;rate
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Get rate for %s without cached clock&bslash;n&quot;
comma
id|clk-&gt;name
)paren
suffix:semicolon
)brace
r_return
id|clk-&gt;rate
suffix:semicolon
)brace
DECL|variable|clk_get_rate
id|EXPORT_SYMBOL
c_func
(paren
id|clk_get_rate
)paren
suffix:semicolon
DECL|function|verify_ckctl_value
r_static
id|__u16
id|verify_ckctl_value
c_func
(paren
id|__u16
id|newval
)paren
(brace
multiline_comment|/* This function checks for following limitations set&n;&t; * by the hardware (all conditions must be true):&n;&t; * DSPMMU_CK == DSP_CK  or  DSPMMU_CK == DSP_CK/2&n;&t; * ARM_CK &gt;= TC_CK&n;&t; * DSP_CK &gt;= TC_CK&n;&t; * DSPMMU_CK &gt;= TC_CK&n;&t; *&n;&t; * In addition following rules are enforced:&n;&t; * LCD_CK &lt;= TC_CK&n;&t; * ARMPER_CK &lt;= TC_CK&n;&t; *&n;&t; * However, maximum frequencies are not checked for!&n;&t; */
id|__u8
id|per_exp
suffix:semicolon
id|__u8
id|lcd_exp
suffix:semicolon
id|__u8
id|arm_exp
suffix:semicolon
id|__u8
id|dsp_exp
suffix:semicolon
id|__u8
id|tc_exp
suffix:semicolon
id|__u8
id|dspmmu_exp
suffix:semicolon
id|per_exp
op_assign
(paren
id|newval
op_rshift
id|CKCTL_PERDIV_OFFSET
)paren
op_amp
l_int|3
suffix:semicolon
id|lcd_exp
op_assign
(paren
id|newval
op_rshift
id|CKCTL_LCDDIV_OFFSET
)paren
op_amp
l_int|3
suffix:semicolon
id|arm_exp
op_assign
(paren
id|newval
op_rshift
id|CKCTL_ARMDIV_OFFSET
)paren
op_amp
l_int|3
suffix:semicolon
id|dsp_exp
op_assign
(paren
id|newval
op_rshift
id|CKCTL_DSPDIV_OFFSET
)paren
op_amp
l_int|3
suffix:semicolon
id|tc_exp
op_assign
(paren
id|newval
op_rshift
id|CKCTL_TCDIV_OFFSET
)paren
op_amp
l_int|3
suffix:semicolon
id|dspmmu_exp
op_assign
(paren
id|newval
op_rshift
id|CKCTL_DSPMMUDIV_OFFSET
)paren
op_amp
l_int|3
suffix:semicolon
r_if
c_cond
(paren
id|dspmmu_exp
OL
id|dsp_exp
)paren
id|dspmmu_exp
op_assign
id|dsp_exp
suffix:semicolon
r_if
c_cond
(paren
id|dspmmu_exp
OG
id|dsp_exp
op_plus
l_int|1
)paren
id|dspmmu_exp
op_assign
id|dsp_exp
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|tc_exp
OL
id|arm_exp
)paren
id|tc_exp
op_assign
id|arm_exp
suffix:semicolon
r_if
c_cond
(paren
id|tc_exp
OL
id|dspmmu_exp
)paren
id|tc_exp
op_assign
id|dspmmu_exp
suffix:semicolon
r_if
c_cond
(paren
id|tc_exp
OG
id|lcd_exp
)paren
id|lcd_exp
op_assign
id|tc_exp
suffix:semicolon
r_if
c_cond
(paren
id|tc_exp
OG
id|per_exp
)paren
id|per_exp
op_assign
id|tc_exp
suffix:semicolon
id|newval
op_and_assign
l_int|0xf000
suffix:semicolon
id|newval
op_or_assign
id|per_exp
op_lshift
id|CKCTL_PERDIV_OFFSET
suffix:semicolon
id|newval
op_or_assign
id|lcd_exp
op_lshift
id|CKCTL_LCDDIV_OFFSET
suffix:semicolon
id|newval
op_or_assign
id|arm_exp
op_lshift
id|CKCTL_ARMDIV_OFFSET
suffix:semicolon
id|newval
op_or_assign
id|dsp_exp
op_lshift
id|CKCTL_DSPDIV_OFFSET
suffix:semicolon
id|newval
op_or_assign
id|tc_exp
op_lshift
id|CKCTL_TCDIV_OFFSET
suffix:semicolon
id|newval
op_or_assign
id|dspmmu_exp
op_lshift
id|CKCTL_DSPMMUDIV_OFFSET
suffix:semicolon
r_return
id|newval
suffix:semicolon
)brace
DECL|function|calc_dsor_exp
r_static
r_int
id|calc_dsor_exp
c_func
(paren
r_struct
id|clk
op_star
id|clk
comma
r_int
r_int
id|rate
)paren
(brace
multiline_comment|/* Note: If target frequency is too low, this function will return 4,&n;&t; * which is invalid value. Caller must check for this value and act&n;&t; * accordingly.&n;&t; *&n;&t; * Note: This function does not check for following limitations set&n;&t; * by the hardware (all conditions must be true):&n;&t; * DSPMMU_CK == DSP_CK  or  DSPMMU_CK == DSP_CK/2&n;&t; * ARM_CK &gt;= TC_CK&n;&t; * DSP_CK &gt;= TC_CK&n;&t; * DSPMMU_CK &gt;= TC_CK&n;&t; */
r_int
r_int
id|realrate
suffix:semicolon
r_struct
id|clk
op_star
id|parent
suffix:semicolon
r_int
id|dsor_exp
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
op_logical_neg
(paren
id|clk-&gt;flags
op_amp
id|RATE_CKCTL
)paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|parent
op_assign
id|clk-&gt;parent
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|parent
op_eq
l_int|0
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|realrate
op_assign
id|parent-&gt;rate
suffix:semicolon
r_for
c_loop
(paren
id|dsor_exp
op_assign
l_int|0
suffix:semicolon
id|dsor_exp
OL
l_int|4
suffix:semicolon
id|dsor_exp
op_increment
)paren
(brace
r_if
c_cond
(paren
id|realrate
op_le
id|rate
)paren
r_break
suffix:semicolon
id|realrate
op_div_assign
l_int|2
suffix:semicolon
)brace
r_return
id|dsor_exp
suffix:semicolon
)brace
DECL|function|clk_round_rate
r_int
id|clk_round_rate
c_func
(paren
r_struct
id|clk
op_star
id|clk
comma
r_int
r_int
id|rate
)paren
(brace
r_int
id|dsor_exp
suffix:semicolon
r_if
c_cond
(paren
id|clk-&gt;flags
op_amp
id|RATE_FIXED
)paren
r_return
id|clk-&gt;rate
suffix:semicolon
r_if
c_cond
(paren
id|clk-&gt;flags
op_amp
id|RATE_CKCTL
)paren
(brace
id|dsor_exp
op_assign
id|calc_dsor_exp
c_func
(paren
id|clk
comma
id|rate
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dsor_exp
OL
l_int|0
)paren
r_return
id|dsor_exp
suffix:semicolon
r_if
c_cond
(paren
id|dsor_exp
OG
l_int|3
)paren
id|dsor_exp
op_assign
l_int|3
suffix:semicolon
r_return
id|clk-&gt;parent-&gt;rate
op_div
(paren
l_int|1
op_lshift
id|dsor_exp
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|clk-&gt;round_rate
op_ne
l_int|0
)paren
(brace
r_return
id|clk
op_member_access_from_pointer
id|round_rate
c_func
(paren
id|rate
)paren
suffix:semicolon
)brace
r_return
id|clk-&gt;rate
suffix:semicolon
)brace
DECL|variable|clk_round_rate
id|EXPORT_SYMBOL
c_func
(paren
id|clk_round_rate
)paren
suffix:semicolon
DECL|function|propagate_rate
r_static
r_void
id|propagate_rate
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
r_struct
id|clk
op_star
op_star
id|clkp
suffix:semicolon
r_for
c_loop
(paren
id|clkp
op_assign
id|onchip_clks
suffix:semicolon
id|clkp
OL
id|onchip_clks
op_plus
id|ARRAY_SIZE
c_func
(paren
id|onchip_clks
)paren
suffix:semicolon
id|clkp
op_increment
)paren
(brace
r_if
c_cond
(paren
id|likely
c_func
(paren
(paren
op_star
id|clkp
)paren
op_member_access_from_pointer
id|parent
op_ne
id|clk
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
(paren
op_star
id|clkp
)paren
op_member_access_from_pointer
id|recalc
)paren
)paren
(paren
op_star
id|clkp
)paren
op_member_access_from_pointer
id|recalc
c_func
(paren
op_star
id|clkp
)paren
suffix:semicolon
)brace
)brace
DECL|function|select_table_rate
r_static
r_int
id|select_table_rate
c_func
(paren
r_int
r_int
id|rate
)paren
(brace
multiline_comment|/* Find the highest supported frequency &lt;= rate and switch to it */
r_struct
id|mpu_rate
op_star
id|ptr
suffix:semicolon
r_for
c_loop
(paren
id|ptr
op_assign
id|rate_table
suffix:semicolon
id|ptr-&gt;rate
suffix:semicolon
id|ptr
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ptr-&gt;xtal
op_ne
id|ck_ref.rate
)paren
r_continue
suffix:semicolon
multiline_comment|/* DPLL1 cannot be reprogrammed without risking system crash */
r_if
c_cond
(paren
id|likely
c_func
(paren
id|ck_dpll1.rate
op_ne
l_int|0
)paren
op_logical_and
id|ptr-&gt;pll_rate
op_ne
id|ck_dpll1.rate
)paren
r_continue
suffix:semicolon
multiline_comment|/* Can check only after xtal frequency check */
r_if
c_cond
(paren
id|ptr-&gt;rate
op_le
id|rate
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ptr-&gt;rate
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|ck_dpll1.rate
op_eq
l_int|0
)paren
)paren
(brace
id|omap_writew
c_func
(paren
id|ptr-&gt;dpllctl_val
comma
id|DPLL_CTL
)paren
suffix:semicolon
id|ck_dpll1.rate
op_assign
id|ptr-&gt;pll_rate
suffix:semicolon
)brace
id|omap_writew
c_func
(paren
id|ptr-&gt;ckctl_val
comma
id|ARM_CKCTL
)paren
suffix:semicolon
id|propagate_rate
c_func
(paren
op_amp
id|ck_dpll1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|round_to_table_rate
r_static
r_int
id|round_to_table_rate
c_func
(paren
r_int
r_int
id|rate
)paren
(brace
multiline_comment|/* Find the highest supported frequency &lt;= rate */
r_struct
id|mpu_rate
op_star
id|ptr
suffix:semicolon
r_int
id|highest_rate
suffix:semicolon
id|highest_rate
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_for
c_loop
(paren
id|ptr
op_assign
id|rate_table
suffix:semicolon
id|ptr-&gt;rate
suffix:semicolon
id|ptr
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ptr-&gt;xtal
op_ne
id|ck_ref.rate
)paren
r_continue
suffix:semicolon
id|highest_rate
op_assign
id|ptr-&gt;rate
suffix:semicolon
multiline_comment|/* Can check only after xtal frequency check */
r_if
c_cond
(paren
id|ptr-&gt;rate
op_le
id|rate
)paren
r_break
suffix:semicolon
)brace
r_return
id|highest_rate
suffix:semicolon
)brace
DECL|function|clk_set_rate
r_int
id|clk_set_rate
c_func
(paren
r_struct
id|clk
op_star
id|clk
comma
r_int
r_int
id|rate
)paren
(brace
r_int
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_int
id|dsor_exp
suffix:semicolon
id|__u16
id|regval
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
id|clk-&gt;flags
op_amp
id|RATE_CKCTL
)paren
(brace
id|dsor_exp
op_assign
id|calc_dsor_exp
c_func
(paren
id|clk
comma
id|rate
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dsor_exp
OG
l_int|3
)paren
id|dsor_exp
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|dsor_exp
OL
l_int|0
)paren
r_return
id|dsor_exp
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|clockfw_lock
comma
id|flags
)paren
suffix:semicolon
id|regval
op_assign
id|omap_readw
c_func
(paren
id|ARM_CKCTL
)paren
suffix:semicolon
id|regval
op_and_assign
op_complement
(paren
l_int|3
op_lshift
id|clk-&gt;rate_offset
)paren
suffix:semicolon
id|regval
op_or_assign
id|dsor_exp
op_lshift
id|clk-&gt;rate_offset
suffix:semicolon
id|regval
op_assign
id|verify_ckctl_value
c_func
(paren
id|regval
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|regval
comma
id|ARM_CKCTL
)paren
suffix:semicolon
id|clk-&gt;rate
op_assign
id|clk-&gt;parent-&gt;rate
op_div
(paren
l_int|1
op_lshift
id|dsor_exp
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|clockfw_lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|clk-&gt;set_rate
op_ne
l_int|0
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|clockfw_lock
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
id|clk
op_member_access_from_pointer
id|set_rate
c_func
(paren
id|rate
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|clockfw_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|ret
op_eq
l_int|0
op_logical_and
(paren
id|clk-&gt;flags
op_amp
id|RATE_PROPAGATES
)paren
)paren
)paren
id|propagate_rate
c_func
(paren
id|clk
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|variable|clk_set_rate
id|EXPORT_SYMBOL
c_func
(paren
id|clk_set_rate
)paren
suffix:semicolon
DECL|function|clk_register
r_int
id|clk_register
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
id|down
c_func
(paren
op_amp
id|clocks_sem
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|clk-&gt;node
comma
op_amp
id|clocks
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|clocks_sem
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|clk_register
id|EXPORT_SYMBOL
c_func
(paren
id|clk_register
)paren
suffix:semicolon
DECL|function|clk_unregister
r_void
id|clk_unregister
c_func
(paren
r_struct
id|clk
op_star
id|clk
)paren
(brace
id|down
c_func
(paren
op_amp
id|clocks_sem
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|clk-&gt;node
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|clocks_sem
)paren
suffix:semicolon
)brace
DECL|variable|clk_unregister
id|EXPORT_SYMBOL
c_func
(paren
id|clk_unregister
)paren
suffix:semicolon
DECL|function|clk_init
r_int
id|__init
id|clk_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|clk
op_star
op_star
id|clkp
suffix:semicolon
r_const
r_struct
id|omap_clock_config
op_star
id|info
suffix:semicolon
r_int
id|crystal_type
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Default 12 MHz */
r_for
c_loop
(paren
id|clkp
op_assign
id|onchip_clks
suffix:semicolon
id|clkp
OL
id|onchip_clks
op_plus
id|ARRAY_SIZE
c_func
(paren
id|onchip_clks
)paren
suffix:semicolon
id|clkp
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
(paren
(paren
op_star
id|clkp
)paren
op_member_access_from_pointer
id|flags
op_amp
id|DOES_NOT_EXIST_ON_1510
)paren
op_logical_and
id|cpu_is_omap1510
c_func
(paren
)paren
)paren
op_logical_or
(paren
(paren
(paren
op_star
id|clkp
)paren
op_member_access_from_pointer
id|flags
op_amp
id|DOES_NOT_EXIST_ON_1610
)paren
op_logical_and
(paren
id|cpu_is_omap1610
c_func
(paren
)paren
op_logical_or
id|cpu_is_omap1710
c_func
(paren
)paren
)paren
)paren
)paren
(brace
(paren
op_star
id|clkp
)paren
op_member_access_from_pointer
id|parent
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|clk_register
c_func
(paren
op_star
id|clkp
)paren
suffix:semicolon
)brace
id|info
op_assign
id|omap_get_config
c_func
(paren
id|OMAP_TAG_CLOCK
comma
r_struct
id|omap_clock_config
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cpu_is_omap1510
c_func
(paren
)paren
)paren
id|crystal_type
op_assign
id|info-&gt;system_clock_type
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_ARCH_OMAP730)
id|ck_ref.rate
op_assign
l_int|13000000
suffix:semicolon
macro_line|#elif defined(CONFIG_ARCH_OMAP16XX)
r_if
c_cond
(paren
id|crystal_type
op_eq
l_int|2
)paren
id|ck_ref.rate
op_assign
l_int|19200000
suffix:semicolon
macro_line|#endif
multiline_comment|/* We want to be in syncronous scalable mode */
id|omap_writew
c_func
(paren
l_int|0x1000
comma
id|ARM_SYSST
)paren
suffix:semicolon
multiline_comment|/* Find the highest supported frequency and enable it */
r_if
c_cond
(paren
id|select_table_rate
c_func
(paren
op_complement
l_int|0
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;System frequencies not set. Check your config.&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Guess sane values (60MHz) */
id|omap_writew
c_func
(paren
l_int|0x2290
comma
id|DPLL_CTL
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
l_int|0x1005
comma
id|ARM_CKCTL
)paren
suffix:semicolon
id|ck_dpll1.rate
op_assign
l_int|60000000
suffix:semicolon
id|propagate_rate
c_func
(paren
op_amp
id|ck_dpll1
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Clocking rate (xtal/DPLL1/MPU): %ld/%ld/%ld&bslash;n&quot;
comma
id|ck_ref.rate
comma
id|ck_dpll1.rate
comma
id|arm_ck.rate
)paren
suffix:semicolon
)brace
multiline_comment|/* Cache rates for clocks connected to ck_ref (not dpll1) */
id|propagate_rate
c_func
(paren
op_amp
id|ck_ref
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MACH_OMAP_PERSEUS2
multiline_comment|/* Select slicer output as OMAP input clock */
id|omap_writew
c_func
(paren
id|omap_readw
c_func
(paren
id|OMAP730_PCC_UPLD_CTRL
)paren
op_amp
op_complement
l_int|0x1
comma
id|OMAP730_PCC_UPLD_CTRL
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Turn off DSP and ARM_TIMXO. Make sure ARM_INTHCK is not divided */
id|omap_writew
c_func
(paren
id|omap_readw
c_func
(paren
id|ARM_CKCTL
)paren
op_amp
l_int|0x0fff
comma
id|ARM_CKCTL
)paren
suffix:semicolon
multiline_comment|/* Put DSP/MPUI into reset until needed */
id|omap_writew
c_func
(paren
l_int|0
comma
id|ARM_RSTCT1
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
l_int|1
comma
id|ARM_RSTCT2
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
l_int|0x400
comma
id|ARM_IDLECT1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * According to OMAP5910 Erratum SYS_DMA_1, bit DMACK_REQ (bit 8)&n;&t; * of the ARM_IDLECT2 register must be set to zero. The power-on&n;&t; * default value of this bit is one.&n;&t; */
id|omap_writew
c_func
(paren
l_int|0x0000
comma
id|ARM_IDLECT2
)paren
suffix:semicolon
multiline_comment|/* Turn LCD clock off also */
multiline_comment|/*&n;&t; * Only enable those clocks we will need, let the drivers&n;&t; * enable other clocks as necessary&n;&t; */
id|clk_use
c_func
(paren
op_amp
id|armper_ck
)paren
suffix:semicolon
id|clk_use
c_func
(paren
op_amp
id|armxor_ck
)paren
suffix:semicolon
id|clk_use
c_func
(paren
op_amp
id|armtim_ck
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpu_is_omap1510
c_func
(paren
)paren
)paren
id|clk_enable
c_func
(paren
op_amp
id|arm_gpio_ck
)paren
suffix:semicolon
id|start_mputimer1
c_func
(paren
l_int|0xffffffff
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
