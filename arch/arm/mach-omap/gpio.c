multiline_comment|/*&n; *  linux/arch/arm/mach-omap/gpio.c&n; *&n; * Support functions for OMAP GPIO&n; *&n; * Copyright (C) 2003 Nokia Corporation&n; * Written by Juha Yrj&#xfffd;l&#xfffd; &lt;juha.yrjola@nokia.com&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2 as&n; * published by the Free Software Foundation.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/arch/irqs.h&gt;
macro_line|#include &lt;asm/arch/gpio.h&gt;
macro_line|#include &lt;asm/mach/irq.h&gt;
macro_line|#include &lt;asm/io.h&gt;
multiline_comment|/*&n; * OMAP1510 GPIO registers&n; */
DECL|macro|OMAP1510_GPIO_BASE
mdefine_line|#define OMAP1510_GPIO_BASE&t;&t;0xfffce000
DECL|macro|OMAP1510_GPIO_DATA_INPUT
mdefine_line|#define OMAP1510_GPIO_DATA_INPUT&t;0x00
DECL|macro|OMAP1510_GPIO_DATA_OUTPUT
mdefine_line|#define OMAP1510_GPIO_DATA_OUTPUT&t;0x04
DECL|macro|OMAP1510_GPIO_DIR_CONTROL
mdefine_line|#define OMAP1510_GPIO_DIR_CONTROL&t;0x08
DECL|macro|OMAP1510_GPIO_INT_CONTROL
mdefine_line|#define OMAP1510_GPIO_INT_CONTROL&t;0x0c
DECL|macro|OMAP1510_GPIO_INT_MASK
mdefine_line|#define OMAP1510_GPIO_INT_MASK&t;&t;0x10
DECL|macro|OMAP1510_GPIO_INT_STATUS
mdefine_line|#define OMAP1510_GPIO_INT_STATUS&t;0x14
DECL|macro|OMAP1510_GPIO_PIN_CONTROL
mdefine_line|#define OMAP1510_GPIO_PIN_CONTROL&t;0x18
DECL|macro|OMAP1510_IH_GPIO_BASE
mdefine_line|#define OMAP1510_IH_GPIO_BASE&t;&t;64
multiline_comment|/*&n; * OMAP1610 specific GPIO registers&n; */
DECL|macro|OMAP1610_GPIO1_BASE
mdefine_line|#define OMAP1610_GPIO1_BASE&t;&t;0xfffbe400
DECL|macro|OMAP1610_GPIO2_BASE
mdefine_line|#define OMAP1610_GPIO2_BASE&t;&t;0xfffbec00
DECL|macro|OMAP1610_GPIO3_BASE
mdefine_line|#define OMAP1610_GPIO3_BASE&t;&t;0xfffbb400
DECL|macro|OMAP1610_GPIO4_BASE
mdefine_line|#define OMAP1610_GPIO4_BASE&t;&t;0xfffbbc00
DECL|macro|OMAP1610_GPIO_REVISION
mdefine_line|#define OMAP1610_GPIO_REVISION&t;&t;0x0000
DECL|macro|OMAP1610_GPIO_SYSCONFIG
mdefine_line|#define OMAP1610_GPIO_SYSCONFIG&t;&t;0x0010
DECL|macro|OMAP1610_GPIO_SYSSTATUS
mdefine_line|#define OMAP1610_GPIO_SYSSTATUS&t;&t;0x0014
DECL|macro|OMAP1610_GPIO_IRQSTATUS1
mdefine_line|#define OMAP1610_GPIO_IRQSTATUS1&t;0x0018
DECL|macro|OMAP1610_GPIO_IRQENABLE1
mdefine_line|#define OMAP1610_GPIO_IRQENABLE1&t;0x001c
DECL|macro|OMAP1610_GPIO_DATAIN
mdefine_line|#define OMAP1610_GPIO_DATAIN&t;&t;0x002c
DECL|macro|OMAP1610_GPIO_DATAOUT
mdefine_line|#define OMAP1610_GPIO_DATAOUT&t;&t;0x0030
DECL|macro|OMAP1610_GPIO_DIRECTION
mdefine_line|#define OMAP1610_GPIO_DIRECTION&t;&t;0x0034
DECL|macro|OMAP1610_GPIO_EDGE_CTRL1
mdefine_line|#define OMAP1610_GPIO_EDGE_CTRL1&t;0x0038
DECL|macro|OMAP1610_GPIO_EDGE_CTRL2
mdefine_line|#define OMAP1610_GPIO_EDGE_CTRL2&t;0x003c
DECL|macro|OMAP1610_GPIO_CLEAR_IRQENABLE1
mdefine_line|#define OMAP1610_GPIO_CLEAR_IRQENABLE1&t;0x009c
DECL|macro|OMAP1610_GPIO_CLEAR_DATAOUT
mdefine_line|#define OMAP1610_GPIO_CLEAR_DATAOUT&t;0x00b0
DECL|macro|OMAP1610_GPIO_SET_IRQENABLE1
mdefine_line|#define OMAP1610_GPIO_SET_IRQENABLE1&t;0x00dc
DECL|macro|OMAP1610_GPIO_SET_DATAOUT
mdefine_line|#define OMAP1610_GPIO_SET_DATAOUT&t;0x00f0
multiline_comment|/*&n; * OMAP730 specific GPIO registers&n; */
DECL|macro|OMAP730_GPIO1_BASE
mdefine_line|#define OMAP730_GPIO1_BASE&t;&t;0xfffbc000
DECL|macro|OMAP730_GPIO2_BASE
mdefine_line|#define OMAP730_GPIO2_BASE&t;&t;0xfffbc800
DECL|macro|OMAP730_GPIO3_BASE
mdefine_line|#define OMAP730_GPIO3_BASE&t;&t;0xfffbd000
DECL|macro|OMAP730_GPIO4_BASE
mdefine_line|#define OMAP730_GPIO4_BASE&t;&t;0xfffbd800
DECL|macro|OMAP730_GPIO5_BASE
mdefine_line|#define OMAP730_GPIO5_BASE&t;&t;0xfffbe000
DECL|macro|OMAP730_GPIO6_BASE
mdefine_line|#define OMAP730_GPIO6_BASE&t;&t;0xfffbe800
DECL|macro|OMAP730_GPIO_DATA_INPUT
mdefine_line|#define OMAP730_GPIO_DATA_INPUT&t;&t;0x00
DECL|macro|OMAP730_GPIO_DATA_OUTPUT
mdefine_line|#define OMAP730_GPIO_DATA_OUTPUT&t;0x04
DECL|macro|OMAP730_GPIO_DIR_CONTROL
mdefine_line|#define OMAP730_GPIO_DIR_CONTROL&t;0x08
DECL|macro|OMAP730_GPIO_INT_CONTROL
mdefine_line|#define OMAP730_GPIO_INT_CONTROL&t;0x0c
DECL|macro|OMAP730_GPIO_INT_MASK
mdefine_line|#define OMAP730_GPIO_INT_MASK&t;&t;0x10
DECL|macro|OMAP730_GPIO_INT_STATUS
mdefine_line|#define OMAP730_GPIO_INT_STATUS&t;&t;0x14
DECL|macro|OMAP_MPUIO_MASK
mdefine_line|#define OMAP_MPUIO_MASK&t;&t;(~OMAP_MAX_GPIO_LINES &amp; 0xff)
DECL|struct|gpio_bank
r_struct
id|gpio_bank
(brace
DECL|member|base
id|u32
id|base
suffix:semicolon
DECL|member|irq
id|u16
id|irq
suffix:semicolon
DECL|member|virtual_irq_start
id|u16
id|virtual_irq_start
suffix:semicolon
DECL|member|method
id|u8
id|method
suffix:semicolon
DECL|member|reserved_map
id|u32
id|reserved_map
suffix:semicolon
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|METHOD_MPUIO
mdefine_line|#define METHOD_MPUIO&t;&t;0
DECL|macro|METHOD_GPIO_1510
mdefine_line|#define METHOD_GPIO_1510&t;1
DECL|macro|METHOD_GPIO_1610
mdefine_line|#define METHOD_GPIO_1610&t;2
DECL|macro|METHOD_GPIO_730
mdefine_line|#define METHOD_GPIO_730&t;&t;3
macro_line|#if defined(CONFIG_ARCH_OMAP16XX)
DECL|variable|gpio_bank_1610
r_static
r_struct
id|gpio_bank
id|gpio_bank_1610
(braket
l_int|5
)braket
op_assign
(brace
(brace
id|OMAP_MPUIO_BASE
comma
id|INT_MPUIO
comma
id|IH_MPUIO_BASE
comma
id|METHOD_MPUIO
)brace
comma
(brace
id|OMAP1610_GPIO1_BASE
comma
id|INT_GPIO_BANK1
comma
id|IH_GPIO_BASE
comma
id|METHOD_GPIO_1610
)brace
comma
(brace
id|OMAP1610_GPIO2_BASE
comma
id|INT_1610_GPIO_BANK2
comma
id|IH_GPIO_BASE
op_plus
l_int|16
comma
id|METHOD_GPIO_1610
)brace
comma
(brace
id|OMAP1610_GPIO3_BASE
comma
id|INT_1610_GPIO_BANK3
comma
id|IH_GPIO_BASE
op_plus
l_int|32
comma
id|METHOD_GPIO_1610
)brace
comma
(brace
id|OMAP1610_GPIO4_BASE
comma
id|INT_1610_GPIO_BANK4
comma
id|IH_GPIO_BASE
op_plus
l_int|48
comma
id|METHOD_GPIO_1610
)brace
comma
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ARCH_OMAP1510
DECL|variable|gpio_bank_1510
r_static
r_struct
id|gpio_bank
id|gpio_bank_1510
(braket
l_int|2
)braket
op_assign
(brace
(brace
id|OMAP_MPUIO_BASE
comma
id|INT_MPUIO
comma
id|IH_MPUIO_BASE
comma
id|METHOD_MPUIO
)brace
comma
(brace
id|OMAP1510_GPIO_BASE
comma
id|INT_GPIO_BANK1
comma
id|IH_GPIO_BASE
comma
id|METHOD_GPIO_1510
)brace
)brace
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ARCH_OMAP730
DECL|variable|gpio_bank_730
r_static
r_struct
id|gpio_bank
id|gpio_bank_730
(braket
l_int|7
)braket
op_assign
(brace
(brace
id|OMAP_MPUIO_BASE
comma
id|INT_730_MPUIO
comma
id|IH_MPUIO_BASE
comma
id|METHOD_MPUIO
)brace
comma
(brace
id|OMAP730_GPIO1_BASE
comma
id|INT_GPIO_BANK1
comma
id|IH_GPIO_BASE
comma
id|METHOD_GPIO_730
)brace
comma
(brace
id|OMAP730_GPIO2_BASE
comma
id|INT_730_GPIO_BANK2
comma
id|IH_GPIO_BASE
op_plus
l_int|32
comma
id|METHOD_GPIO_730
)brace
comma
(brace
id|OMAP730_GPIO3_BASE
comma
id|INT_730_GPIO_BANK3
comma
id|IH_GPIO_BASE
op_plus
l_int|64
comma
id|METHOD_GPIO_730
)brace
comma
(brace
id|OMAP730_GPIO4_BASE
comma
id|INT_730_GPIO_BANK4
comma
id|IH_GPIO_BASE
op_plus
l_int|96
comma
id|METHOD_GPIO_730
)brace
comma
(brace
id|OMAP730_GPIO5_BASE
comma
id|INT_730_GPIO_BANK5
comma
id|IH_GPIO_BASE
op_plus
l_int|128
comma
id|METHOD_GPIO_730
)brace
comma
(brace
id|OMAP730_GPIO6_BASE
comma
id|INT_730_GPIO_BANK6
comma
id|IH_GPIO_BASE
op_plus
l_int|160
comma
id|METHOD_GPIO_730
)brace
comma
)brace
suffix:semicolon
macro_line|#endif
DECL|variable|gpio_bank
r_static
r_struct
id|gpio_bank
op_star
id|gpio_bank
suffix:semicolon
DECL|variable|gpio_bank_count
r_static
r_int
id|gpio_bank_count
suffix:semicolon
DECL|function|get_gpio_bank
r_static
r_inline
r_struct
id|gpio_bank
op_star
id|get_gpio_bank
c_func
(paren
r_int
id|gpio
)paren
(brace
macro_line|#ifdef CONFIG_ARCH_OMAP1510
r_if
c_cond
(paren
id|cpu_is_omap1510
c_func
(paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|OMAP_GPIO_IS_MPUIO
c_func
(paren
id|gpio
)paren
)paren
r_return
op_amp
id|gpio_bank
(braket
l_int|0
)braket
suffix:semicolon
r_return
op_amp
id|gpio_bank
(braket
l_int|1
)braket
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if defined(CONFIG_ARCH_OMAP16XX)
r_if
c_cond
(paren
id|cpu_is_omap16xx
c_func
(paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|OMAP_GPIO_IS_MPUIO
c_func
(paren
id|gpio
)paren
)paren
r_return
op_amp
id|gpio_bank
(braket
l_int|0
)braket
suffix:semicolon
r_return
op_amp
id|gpio_bank
(braket
l_int|1
op_plus
(paren
id|gpio
op_rshift
l_int|4
)paren
)braket
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_ARCH_OMAP730
r_if
c_cond
(paren
id|cpu_is_omap730
c_func
(paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|OMAP_GPIO_IS_MPUIO
c_func
(paren
id|gpio
)paren
)paren
r_return
op_amp
id|gpio_bank
(braket
l_int|0
)braket
suffix:semicolon
r_return
op_amp
id|gpio_bank
(braket
l_int|1
op_plus
(paren
id|gpio
op_rshift
l_int|5
)paren
)braket
suffix:semicolon
)brace
macro_line|#endif
)brace
DECL|function|get_gpio_index
r_static
r_inline
r_int
id|get_gpio_index
c_func
(paren
r_int
id|gpio
)paren
(brace
r_if
c_cond
(paren
id|cpu_is_omap730
c_func
(paren
)paren
)paren
r_return
id|gpio
op_amp
l_int|0x1f
suffix:semicolon
r_else
r_return
id|gpio
op_amp
l_int|0x0f
suffix:semicolon
)brace
DECL|function|gpio_valid
r_static
r_inline
r_int
id|gpio_valid
c_func
(paren
r_int
id|gpio
)paren
(brace
r_if
c_cond
(paren
id|gpio
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|OMAP_GPIO_IS_MPUIO
c_func
(paren
id|gpio
)paren
)paren
(brace
r_if
c_cond
(paren
(paren
id|gpio
op_amp
id|OMAP_MPUIO_MASK
)paren
OG
l_int|16
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ARCH_OMAP1510
r_if
c_cond
(paren
id|cpu_is_omap1510
c_func
(paren
)paren
op_logical_and
id|gpio
OL
l_int|16
)paren
r_return
l_int|0
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_ARCH_OMAP16XX)
r_if
c_cond
(paren
(paren
id|cpu_is_omap16xx
c_func
(paren
)paren
)paren
op_logical_and
id|gpio
OL
l_int|64
)paren
r_return
l_int|0
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ARCH_OMAP730
r_if
c_cond
(paren
id|cpu_is_omap730
c_func
(paren
)paren
op_logical_and
id|gpio
OL
l_int|192
)paren
r_return
l_int|0
suffix:semicolon
macro_line|#endif
r_return
op_minus
l_int|1
suffix:semicolon
)brace
DECL|function|check_gpio
r_static
r_int
id|check_gpio
c_func
(paren
r_int
id|gpio
)paren
(brace
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|gpio_valid
c_func
(paren
id|gpio
)paren
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;omap-gpio: invalid GPIO %d&bslash;n&quot;
comma
id|gpio
)paren
suffix:semicolon
id|dump_stack
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|_set_gpio_direction
r_static
r_void
id|_set_gpio_direction
c_func
(paren
r_struct
id|gpio_bank
op_star
id|bank
comma
r_int
id|gpio
comma
r_int
id|is_input
)paren
(brace
id|u32
id|reg
op_assign
id|bank-&gt;base
suffix:semicolon
id|u32
id|l
suffix:semicolon
r_switch
c_cond
(paren
id|bank-&gt;method
)paren
(brace
r_case
id|METHOD_MPUIO
suffix:colon
id|reg
op_add_assign
id|OMAP_MPUIO_IO_CNTL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|METHOD_GPIO_1510
suffix:colon
id|reg
op_add_assign
id|OMAP1510_GPIO_DIR_CONTROL
suffix:semicolon
r_break
suffix:semicolon
r_case
id|METHOD_GPIO_1610
suffix:colon
id|reg
op_add_assign
id|OMAP1610_GPIO_DIRECTION
suffix:semicolon
r_break
suffix:semicolon
r_case
id|METHOD_GPIO_730
suffix:colon
id|reg
op_add_assign
id|OMAP730_GPIO_DIR_CONTROL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|l
op_assign
id|__raw_readl
c_func
(paren
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is_input
)paren
id|l
op_or_assign
l_int|1
op_lshift
id|gpio
suffix:semicolon
r_else
id|l
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|gpio
)paren
suffix:semicolon
id|__raw_writel
c_func
(paren
id|l
comma
id|reg
)paren
suffix:semicolon
)brace
DECL|function|omap_set_gpio_direction
r_void
id|omap_set_gpio_direction
c_func
(paren
r_int
id|gpio
comma
r_int
id|is_input
)paren
(brace
r_struct
id|gpio_bank
op_star
id|bank
suffix:semicolon
r_if
c_cond
(paren
id|check_gpio
c_func
(paren
id|gpio
)paren
OL
l_int|0
)paren
r_return
suffix:semicolon
id|bank
op_assign
id|get_gpio_bank
c_func
(paren
id|gpio
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|bank-&gt;lock
)paren
suffix:semicolon
id|_set_gpio_direction
c_func
(paren
id|bank
comma
id|get_gpio_index
c_func
(paren
id|gpio
)paren
comma
id|is_input
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|bank-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|_set_gpio_dataout
r_static
r_void
id|_set_gpio_dataout
c_func
(paren
r_struct
id|gpio_bank
op_star
id|bank
comma
r_int
id|gpio
comma
r_int
id|enable
)paren
(brace
id|u32
id|reg
op_assign
id|bank-&gt;base
suffix:semicolon
id|u32
id|l
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|bank-&gt;method
)paren
(brace
r_case
id|METHOD_MPUIO
suffix:colon
id|reg
op_add_assign
id|OMAP_MPUIO_OUTPUT
suffix:semicolon
id|l
op_assign
id|__raw_readl
c_func
(paren
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enable
)paren
id|l
op_or_assign
l_int|1
op_lshift
id|gpio
suffix:semicolon
r_else
id|l
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|gpio
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|METHOD_GPIO_1510
suffix:colon
id|reg
op_add_assign
id|OMAP1510_GPIO_DATA_OUTPUT
suffix:semicolon
id|l
op_assign
id|__raw_readl
c_func
(paren
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enable
)paren
id|l
op_or_assign
l_int|1
op_lshift
id|gpio
suffix:semicolon
r_else
id|l
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|gpio
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|METHOD_GPIO_1610
suffix:colon
r_if
c_cond
(paren
id|enable
)paren
id|reg
op_add_assign
id|OMAP1610_GPIO_SET_DATAOUT
suffix:semicolon
r_else
id|reg
op_add_assign
id|OMAP1610_GPIO_CLEAR_DATAOUT
suffix:semicolon
id|l
op_assign
l_int|1
op_lshift
id|gpio
suffix:semicolon
r_break
suffix:semicolon
r_case
id|METHOD_GPIO_730
suffix:colon
id|reg
op_add_assign
id|OMAP730_GPIO_DATA_OUTPUT
suffix:semicolon
id|l
op_assign
id|__raw_readl
c_func
(paren
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enable
)paren
id|l
op_or_assign
l_int|1
op_lshift
id|gpio
suffix:semicolon
r_else
id|l
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|gpio
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|__raw_writel
c_func
(paren
id|l
comma
id|reg
)paren
suffix:semicolon
)brace
DECL|function|omap_set_gpio_dataout
r_void
id|omap_set_gpio_dataout
c_func
(paren
r_int
id|gpio
comma
r_int
id|enable
)paren
(brace
r_struct
id|gpio_bank
op_star
id|bank
suffix:semicolon
r_if
c_cond
(paren
id|check_gpio
c_func
(paren
id|gpio
)paren
OL
l_int|0
)paren
r_return
suffix:semicolon
id|bank
op_assign
id|get_gpio_bank
c_func
(paren
id|gpio
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|bank-&gt;lock
)paren
suffix:semicolon
id|_set_gpio_dataout
c_func
(paren
id|bank
comma
id|get_gpio_index
c_func
(paren
id|gpio
)paren
comma
id|enable
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|bank-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|omap_get_gpio_datain
r_int
id|omap_get_gpio_datain
c_func
(paren
r_int
id|gpio
)paren
(brace
r_struct
id|gpio_bank
op_star
id|bank
suffix:semicolon
id|u32
id|reg
suffix:semicolon
r_if
c_cond
(paren
id|check_gpio
c_func
(paren
id|gpio
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|bank
op_assign
id|get_gpio_bank
c_func
(paren
id|gpio
)paren
suffix:semicolon
id|reg
op_assign
id|bank-&gt;base
suffix:semicolon
r_switch
c_cond
(paren
id|bank-&gt;method
)paren
(brace
r_case
id|METHOD_MPUIO
suffix:colon
id|reg
op_add_assign
id|OMAP_MPUIO_INPUT_LATCH
suffix:semicolon
r_break
suffix:semicolon
r_case
id|METHOD_GPIO_1510
suffix:colon
id|reg
op_add_assign
id|OMAP1510_GPIO_DATA_INPUT
suffix:semicolon
r_break
suffix:semicolon
r_case
id|METHOD_GPIO_1610
suffix:colon
id|reg
op_add_assign
id|OMAP1610_GPIO_DATAIN
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
(paren
id|__raw_readl
c_func
(paren
id|reg
)paren
op_amp
(paren
l_int|1
op_lshift
id|get_gpio_index
c_func
(paren
id|gpio
)paren
)paren
)paren
op_ne
l_int|0
suffix:semicolon
)brace
DECL|function|_set_gpio_edge_ctrl
r_static
r_void
id|_set_gpio_edge_ctrl
c_func
(paren
r_struct
id|gpio_bank
op_star
id|bank
comma
r_int
id|gpio
comma
r_int
id|edge
)paren
(brace
id|u32
id|reg
op_assign
id|bank-&gt;base
suffix:semicolon
id|u32
id|l
suffix:semicolon
r_switch
c_cond
(paren
id|bank-&gt;method
)paren
(brace
r_case
id|METHOD_MPUIO
suffix:colon
id|reg
op_add_assign
id|OMAP_MPUIO_GPIO_INT_EDGE
suffix:semicolon
id|l
op_assign
id|__raw_readl
c_func
(paren
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|edge
op_eq
id|OMAP_GPIO_RISING_EDGE
)paren
id|l
op_or_assign
l_int|1
op_lshift
id|gpio
suffix:semicolon
r_else
id|l
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|gpio
)paren
suffix:semicolon
id|__raw_writel
c_func
(paren
id|l
comma
id|reg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|METHOD_GPIO_1510
suffix:colon
id|reg
op_add_assign
id|OMAP1510_GPIO_INT_CONTROL
suffix:semicolon
id|l
op_assign
id|__raw_readl
c_func
(paren
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|edge
op_eq
id|OMAP_GPIO_RISING_EDGE
)paren
id|l
op_or_assign
l_int|1
op_lshift
id|gpio
suffix:semicolon
r_else
id|l
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|gpio
)paren
suffix:semicolon
id|__raw_writel
c_func
(paren
id|l
comma
id|reg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|METHOD_GPIO_1610
suffix:colon
id|edge
op_and_assign
l_int|0x03
suffix:semicolon
r_if
c_cond
(paren
id|gpio
op_amp
l_int|0x08
)paren
id|reg
op_add_assign
id|OMAP1610_GPIO_EDGE_CTRL2
suffix:semicolon
r_else
id|reg
op_add_assign
id|OMAP1610_GPIO_EDGE_CTRL1
suffix:semicolon
id|gpio
op_and_assign
l_int|0x07
suffix:semicolon
id|l
op_assign
id|__raw_readl
c_func
(paren
id|reg
)paren
suffix:semicolon
id|l
op_and_assign
op_complement
(paren
l_int|3
op_lshift
(paren
id|gpio
op_lshift
l_int|1
)paren
)paren
suffix:semicolon
id|l
op_or_assign
id|edge
op_lshift
(paren
id|gpio
op_lshift
l_int|1
)paren
suffix:semicolon
id|__raw_writel
c_func
(paren
id|l
comma
id|reg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|METHOD_GPIO_730
suffix:colon
id|reg
op_add_assign
id|OMAP730_GPIO_INT_CONTROL
suffix:semicolon
id|l
op_assign
id|__raw_readl
c_func
(paren
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|edge
op_eq
id|OMAP_GPIO_RISING_EDGE
)paren
id|l
op_or_assign
l_int|1
op_lshift
id|gpio
suffix:semicolon
r_else
id|l
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|gpio
)paren
suffix:semicolon
id|__raw_writel
c_func
(paren
id|l
comma
id|reg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
DECL|function|omap_set_gpio_edge_ctrl
r_void
id|omap_set_gpio_edge_ctrl
c_func
(paren
r_int
id|gpio
comma
r_int
id|edge
)paren
(brace
r_struct
id|gpio_bank
op_star
id|bank
suffix:semicolon
r_if
c_cond
(paren
id|check_gpio
c_func
(paren
id|gpio
)paren
OL
l_int|0
)paren
r_return
suffix:semicolon
id|bank
op_assign
id|get_gpio_bank
c_func
(paren
id|gpio
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|bank-&gt;lock
)paren
suffix:semicolon
id|_set_gpio_edge_ctrl
c_func
(paren
id|bank
comma
id|get_gpio_index
c_func
(paren
id|gpio
)paren
comma
id|edge
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|bank-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|_get_gpio_edge_ctrl
r_static
r_int
id|_get_gpio_edge_ctrl
c_func
(paren
r_struct
id|gpio_bank
op_star
id|bank
comma
r_int
id|gpio
)paren
(brace
id|u32
id|reg
op_assign
id|bank-&gt;base
comma
id|l
suffix:semicolon
r_switch
c_cond
(paren
id|bank-&gt;method
)paren
(brace
r_case
id|METHOD_MPUIO
suffix:colon
id|l
op_assign
id|__raw_readl
c_func
(paren
id|reg
op_plus
id|OMAP_MPUIO_GPIO_INT_EDGE
)paren
suffix:semicolon
r_return
(paren
id|l
op_amp
(paren
l_int|1
op_lshift
id|gpio
)paren
)paren
ques
c_cond
id|OMAP_GPIO_RISING_EDGE
suffix:colon
id|OMAP_GPIO_FALLING_EDGE
suffix:semicolon
r_case
id|METHOD_GPIO_1510
suffix:colon
id|l
op_assign
id|__raw_readl
c_func
(paren
id|reg
op_plus
id|OMAP1510_GPIO_INT_CONTROL
)paren
suffix:semicolon
r_return
(paren
id|l
op_amp
(paren
l_int|1
op_lshift
id|gpio
)paren
)paren
ques
c_cond
id|OMAP_GPIO_RISING_EDGE
suffix:colon
id|OMAP_GPIO_FALLING_EDGE
suffix:semicolon
r_case
id|METHOD_GPIO_1610
suffix:colon
r_if
c_cond
(paren
id|gpio
op_amp
l_int|0x08
)paren
id|reg
op_add_assign
id|OMAP1610_GPIO_EDGE_CTRL2
suffix:semicolon
r_else
id|reg
op_add_assign
id|OMAP1610_GPIO_EDGE_CTRL1
suffix:semicolon
r_return
(paren
id|__raw_readl
c_func
(paren
id|reg
)paren
op_rshift
(paren
(paren
id|gpio
op_amp
l_int|0x07
)paren
op_lshift
l_int|1
)paren
)paren
op_amp
l_int|0x03
suffix:semicolon
r_case
id|METHOD_GPIO_730
suffix:colon
id|l
op_assign
id|__raw_readl
c_func
(paren
id|reg
op_plus
id|OMAP730_GPIO_INT_CONTROL
)paren
suffix:semicolon
r_return
(paren
id|l
op_amp
(paren
l_int|1
op_lshift
id|gpio
)paren
)paren
ques
c_cond
id|OMAP_GPIO_RISING_EDGE
suffix:colon
id|OMAP_GPIO_FALLING_EDGE
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|_clear_gpio_irqstatus
r_static
r_void
id|_clear_gpio_irqstatus
c_func
(paren
r_struct
id|gpio_bank
op_star
id|bank
comma
r_int
id|gpio
)paren
(brace
id|u32
id|reg
op_assign
id|bank-&gt;base
suffix:semicolon
r_switch
c_cond
(paren
id|bank-&gt;method
)paren
(brace
r_case
id|METHOD_MPUIO
suffix:colon
multiline_comment|/* MPUIO irqstatus cannot be cleared one bit at a time,&n;&t;&t; * so do nothing here */
r_return
suffix:semicolon
r_case
id|METHOD_GPIO_1510
suffix:colon
id|reg
op_add_assign
id|OMAP1510_GPIO_INT_STATUS
suffix:semicolon
r_break
suffix:semicolon
r_case
id|METHOD_GPIO_1610
suffix:colon
id|reg
op_add_assign
id|OMAP1610_GPIO_IRQSTATUS1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|METHOD_GPIO_730
suffix:colon
id|reg
op_add_assign
id|OMAP730_GPIO_INT_STATUS
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|__raw_writel
c_func
(paren
l_int|1
op_lshift
id|get_gpio_index
c_func
(paren
id|gpio
)paren
comma
id|reg
)paren
suffix:semicolon
)brace
DECL|function|_set_gpio_irqenable
r_static
r_void
id|_set_gpio_irqenable
c_func
(paren
r_struct
id|gpio_bank
op_star
id|bank
comma
r_int
id|gpio
comma
r_int
id|enable
)paren
(brace
id|u32
id|reg
op_assign
id|bank-&gt;base
suffix:semicolon
id|u32
id|l
suffix:semicolon
r_switch
c_cond
(paren
id|bank-&gt;method
)paren
(brace
r_case
id|METHOD_MPUIO
suffix:colon
id|reg
op_add_assign
id|OMAP_MPUIO_GPIO_MASKIT
suffix:semicolon
id|l
op_assign
id|__raw_readl
c_func
(paren
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enable
)paren
id|l
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|gpio
)paren
suffix:semicolon
r_else
id|l
op_or_assign
l_int|1
op_lshift
id|gpio
suffix:semicolon
r_break
suffix:semicolon
r_case
id|METHOD_GPIO_1510
suffix:colon
id|reg
op_add_assign
id|OMAP1510_GPIO_INT_MASK
suffix:semicolon
id|l
op_assign
id|__raw_readl
c_func
(paren
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enable
)paren
id|l
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|gpio
)paren
suffix:semicolon
r_else
id|l
op_or_assign
l_int|1
op_lshift
id|gpio
suffix:semicolon
r_break
suffix:semicolon
r_case
id|METHOD_GPIO_1610
suffix:colon
r_if
c_cond
(paren
id|enable
)paren
(brace
id|reg
op_add_assign
id|OMAP1610_GPIO_SET_IRQENABLE1
suffix:semicolon
id|_clear_gpio_irqstatus
c_func
(paren
id|bank
comma
id|gpio
)paren
suffix:semicolon
)brace
r_else
id|reg
op_add_assign
id|OMAP1610_GPIO_CLEAR_IRQENABLE1
suffix:semicolon
id|l
op_assign
l_int|1
op_lshift
id|gpio
suffix:semicolon
r_break
suffix:semicolon
r_case
id|METHOD_GPIO_730
suffix:colon
id|reg
op_add_assign
id|OMAP730_GPIO_INT_MASK
suffix:semicolon
id|l
op_assign
id|__raw_readl
c_func
(paren
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enable
)paren
id|l
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|gpio
)paren
suffix:semicolon
r_else
id|l
op_or_assign
l_int|1
op_lshift
id|gpio
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|__raw_writel
c_func
(paren
id|l
comma
id|reg
)paren
suffix:semicolon
)brace
DECL|function|omap_request_gpio
r_int
id|omap_request_gpio
c_func
(paren
r_int
id|gpio
)paren
(brace
r_struct
id|gpio_bank
op_star
id|bank
suffix:semicolon
r_if
c_cond
(paren
id|check_gpio
c_func
(paren
id|gpio
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|bank
op_assign
id|get_gpio_bank
c_func
(paren
id|gpio
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|bank-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|bank-&gt;reserved_map
op_amp
(paren
l_int|1
op_lshift
id|get_gpio_index
c_func
(paren
id|gpio
)paren
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;omap-gpio: GPIO %d is already reserved!&bslash;n&quot;
comma
id|gpio
)paren
suffix:semicolon
id|dump_stack
c_func
(paren
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|bank-&gt;lock
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|bank-&gt;reserved_map
op_or_assign
(paren
l_int|1
op_lshift
id|get_gpio_index
c_func
(paren
id|gpio
)paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ARCH_OMAP1510
r_if
c_cond
(paren
id|bank-&gt;method
op_eq
id|METHOD_GPIO_1510
)paren
(brace
id|u32
id|reg
suffix:semicolon
multiline_comment|/* Claim the pin for the ARM */
id|reg
op_assign
id|bank-&gt;base
op_plus
id|OMAP1510_GPIO_PIN_CONTROL
suffix:semicolon
id|__raw_writel
c_func
(paren
id|__raw_readl
c_func
(paren
id|reg
)paren
op_or
(paren
l_int|1
op_lshift
id|get_gpio_index
c_func
(paren
id|gpio
)paren
)paren
comma
id|reg
)paren
suffix:semicolon
)brace
macro_line|#endif
id|spin_unlock
c_func
(paren
op_amp
id|bank-&gt;lock
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|omap_free_gpio
r_void
id|omap_free_gpio
c_func
(paren
r_int
id|gpio
)paren
(brace
r_struct
id|gpio_bank
op_star
id|bank
suffix:semicolon
r_if
c_cond
(paren
id|check_gpio
c_func
(paren
id|gpio
)paren
OL
l_int|0
)paren
r_return
suffix:semicolon
id|bank
op_assign
id|get_gpio_bank
c_func
(paren
id|gpio
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|bank-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
op_logical_neg
(paren
id|bank-&gt;reserved_map
op_amp
(paren
l_int|1
op_lshift
id|get_gpio_index
c_func
(paren
id|gpio
)paren
)paren
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;omap-gpio: GPIO %d wasn&squot;t reserved!&bslash;n&quot;
comma
id|gpio
)paren
suffix:semicolon
id|dump_stack
c_func
(paren
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|bank-&gt;lock
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|bank-&gt;reserved_map
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|get_gpio_index
c_func
(paren
id|gpio
)paren
)paren
suffix:semicolon
id|_set_gpio_direction
c_func
(paren
id|bank
comma
id|get_gpio_index
c_func
(paren
id|gpio
)paren
comma
l_int|1
)paren
suffix:semicolon
id|_set_gpio_irqenable
c_func
(paren
id|bank
comma
id|get_gpio_index
c_func
(paren
id|gpio
)paren
comma
l_int|0
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|bank-&gt;lock
)paren
suffix:semicolon
)brace
DECL|function|gpio_irq_handler
r_static
r_void
id|gpio_irq_handler
c_func
(paren
r_int
r_int
id|irq
comma
r_struct
id|irqdesc
op_star
id|desc
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|u32
id|isr_reg
op_assign
l_int|0
suffix:semicolon
r_struct
id|gpio_bank
op_star
id|bank
op_assign
(paren
r_struct
id|gpio_bank
op_star
)paren
id|desc-&gt;data
suffix:semicolon
multiline_comment|/*&n;&t; * Acknowledge the parent IRQ.&n;&t; */
id|desc-&gt;chip
op_member_access_from_pointer
id|ack
c_func
(paren
id|irq
)paren
suffix:semicolon
multiline_comment|/* Since the level 1 GPIO interrupt cascade (IRQ14) is configured as&n;&t; * edge-sensitive, we need to unmask it here in order to avoid missing&n;&t; * any additional GPIO interrupts that might occur after the last time&n;&t; * we check for pending GPIO interrupts here.&n;&t; * We are relying on the fact that this interrupt handler was installed&n;&t; * with the SA_INTERRUPT flag so that interrupts are disabled at the&n;&t; * CPU while it is executing.&n;&t; */
id|desc-&gt;chip
op_member_access_from_pointer
id|unmask
c_func
(paren
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bank-&gt;method
op_eq
id|METHOD_MPUIO
)paren
id|isr_reg
op_assign
id|bank-&gt;base
op_plus
id|OMAP_MPUIO_GPIO_INT
suffix:semicolon
macro_line|#ifdef CONFIG_ARCH_OMAP1510
r_if
c_cond
(paren
id|bank-&gt;method
op_eq
id|METHOD_GPIO_1510
)paren
id|isr_reg
op_assign
id|bank-&gt;base
op_plus
id|OMAP1510_GPIO_INT_STATUS
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_ARCH_OMAP16XX)
r_if
c_cond
(paren
id|bank-&gt;method
op_eq
id|METHOD_GPIO_1610
)paren
id|isr_reg
op_assign
id|bank-&gt;base
op_plus
id|OMAP1610_GPIO_IRQSTATUS1
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ARCH_OMAP730
r_if
c_cond
(paren
id|bank-&gt;method
op_eq
id|METHOD_GPIO_730
)paren
id|isr_reg
op_assign
id|bank-&gt;base
op_plus
id|OMAP730_GPIO_INT_STATUS
suffix:semicolon
macro_line|#endif
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|u32
id|isr
op_assign
id|__raw_readl
c_func
(paren
id|isr_reg
)paren
suffix:semicolon
r_int
r_int
id|gpio_irq
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isr
)paren
r_break
suffix:semicolon
id|gpio_irq
op_assign
id|bank-&gt;virtual_irq_start
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
id|isr
op_ne
l_int|0
suffix:semicolon
id|isr
op_rshift_assign
l_int|1
comma
id|gpio_irq
op_increment
)paren
(brace
r_if
c_cond
(paren
id|isr
op_amp
l_int|1
)paren
(brace
r_struct
id|irqdesc
op_star
id|d
op_assign
id|irq_desc
op_plus
id|gpio_irq
suffix:semicolon
id|d
op_member_access_from_pointer
id|handle
c_func
(paren
id|gpio_irq
comma
id|d
comma
id|regs
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|gpio_ack_irq
r_static
r_void
id|gpio_ack_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|gpio
op_assign
id|irq
op_minus
id|IH_GPIO_BASE
suffix:semicolon
r_struct
id|gpio_bank
op_star
id|bank
op_assign
id|get_gpio_bank
c_func
(paren
id|gpio
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ARCH_OMAP1510
r_if
c_cond
(paren
id|bank-&gt;method
op_eq
id|METHOD_GPIO_1510
)paren
id|__raw_writew
c_func
(paren
l_int|1
op_lshift
(paren
id|gpio
op_amp
l_int|0x0f
)paren
comma
id|bank-&gt;base
op_plus
id|OMAP1510_GPIO_INT_STATUS
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_ARCH_OMAP16XX)
r_if
c_cond
(paren
id|bank-&gt;method
op_eq
id|METHOD_GPIO_1610
)paren
id|__raw_writew
c_func
(paren
l_int|1
op_lshift
(paren
id|gpio
op_amp
l_int|0x0f
)paren
comma
id|bank-&gt;base
op_plus
id|OMAP1610_GPIO_IRQSTATUS1
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_ARCH_OMAP730
r_if
c_cond
(paren
id|bank-&gt;method
op_eq
id|METHOD_GPIO_730
)paren
id|__raw_writel
c_func
(paren
l_int|1
op_lshift
(paren
id|gpio
op_amp
l_int|0x1f
)paren
comma
id|bank-&gt;base
op_plus
id|OMAP730_GPIO_INT_STATUS
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|gpio_mask_irq
r_static
r_void
id|gpio_mask_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|gpio
op_assign
id|irq
op_minus
id|IH_GPIO_BASE
suffix:semicolon
r_struct
id|gpio_bank
op_star
id|bank
op_assign
id|get_gpio_bank
c_func
(paren
id|gpio
)paren
suffix:semicolon
id|_set_gpio_irqenable
c_func
(paren
id|bank
comma
id|get_gpio_index
c_func
(paren
id|gpio
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|gpio_unmask_irq
r_static
r_void
id|gpio_unmask_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|gpio
op_assign
id|irq
op_minus
id|IH_GPIO_BASE
suffix:semicolon
r_struct
id|gpio_bank
op_star
id|bank
op_assign
id|get_gpio_bank
c_func
(paren
id|gpio
)paren
suffix:semicolon
r_if
c_cond
(paren
id|_get_gpio_edge_ctrl
c_func
(paren
id|bank
comma
id|get_gpio_index
c_func
(paren
id|gpio
)paren
)paren
op_eq
id|OMAP_GPIO_NO_EDGE
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;OMAP GPIO %d: trying to enable GPIO IRQ while no edge is set&bslash;n&quot;
comma
id|gpio
)paren
suffix:semicolon
id|_set_gpio_edge_ctrl
c_func
(paren
id|bank
comma
id|get_gpio_index
c_func
(paren
id|gpio
)paren
comma
id|OMAP_GPIO_RISING_EDGE
)paren
suffix:semicolon
)brace
id|_set_gpio_irqenable
c_func
(paren
id|bank
comma
id|get_gpio_index
c_func
(paren
id|gpio
)paren
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|mpuio_ack_irq
r_static
r_void
id|mpuio_ack_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
multiline_comment|/* The ISR is reset automatically, so do nothing here. */
)brace
DECL|function|mpuio_mask_irq
r_static
r_void
id|mpuio_mask_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|gpio
op_assign
id|OMAP_MPUIO
c_func
(paren
id|irq
op_minus
id|IH_MPUIO_BASE
)paren
suffix:semicolon
r_struct
id|gpio_bank
op_star
id|bank
op_assign
id|get_gpio_bank
c_func
(paren
id|gpio
)paren
suffix:semicolon
id|_set_gpio_irqenable
c_func
(paren
id|bank
comma
id|get_gpio_index
c_func
(paren
id|gpio
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|mpuio_unmask_irq
r_static
r_void
id|mpuio_unmask_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|gpio
op_assign
id|OMAP_MPUIO
c_func
(paren
id|irq
op_minus
id|IH_MPUIO_BASE
)paren
suffix:semicolon
r_struct
id|gpio_bank
op_star
id|bank
op_assign
id|get_gpio_bank
c_func
(paren
id|gpio
)paren
suffix:semicolon
id|_set_gpio_irqenable
c_func
(paren
id|bank
comma
id|get_gpio_index
c_func
(paren
id|gpio
)paren
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|variable|gpio_irq_chip
r_static
r_struct
id|irqchip
id|gpio_irq_chip
op_assign
(brace
dot
id|ack
op_assign
id|gpio_ack_irq
comma
dot
id|mask
op_assign
id|gpio_mask_irq
comma
dot
id|unmask
op_assign
id|gpio_unmask_irq
comma
)brace
suffix:semicolon
DECL|variable|mpuio_irq_chip
r_static
r_struct
id|irqchip
id|mpuio_irq_chip
op_assign
(brace
dot
id|ack
op_assign
id|mpuio_ack_irq
comma
dot
id|mask
op_assign
id|mpuio_mask_irq
comma
dot
id|unmask
op_assign
id|mpuio_unmask_irq
)brace
suffix:semicolon
DECL|variable|initialized
r_static
r_int
id|initialized
op_assign
l_int|0
suffix:semicolon
DECL|function|_omap_gpio_init
r_static
r_int
id|__init
id|_omap_gpio_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|gpio_bank
op_star
id|bank
suffix:semicolon
id|initialized
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef CONFIG_ARCH_OMAP1510
r_if
c_cond
(paren
id|cpu_is_omap1510
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;OMAP1510 GPIO hardware&bslash;n&quot;
)paren
suffix:semicolon
id|gpio_bank_count
op_assign
l_int|2
suffix:semicolon
id|gpio_bank
op_assign
id|gpio_bank_1510
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if defined(CONFIG_ARCH_OMAP16XX)
r_if
c_cond
(paren
id|cpu_is_omap16xx
c_func
(paren
)paren
)paren
(brace
r_int
id|rev
suffix:semicolon
id|gpio_bank_count
op_assign
l_int|5
suffix:semicolon
id|gpio_bank
op_assign
id|gpio_bank_1610
suffix:semicolon
id|rev
op_assign
id|omap_readw
c_func
(paren
id|gpio_bank
(braket
l_int|1
)braket
dot
id|base
op_plus
id|OMAP1610_GPIO_REVISION
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;OMAP GPIO hardware version %d.%d&bslash;n&quot;
comma
(paren
id|rev
op_rshift
l_int|4
)paren
op_amp
l_int|0x0f
comma
id|rev
op_amp
l_int|0x0f
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_ARCH_OMAP730
r_if
c_cond
(paren
id|cpu_is_omap730
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;OMAP730 GPIO hardware&bslash;n&quot;
)paren
suffix:semicolon
id|gpio_bank_count
op_assign
l_int|7
suffix:semicolon
id|gpio_bank
op_assign
id|gpio_bank_730
suffix:semicolon
)brace
macro_line|#endif
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|gpio_bank_count
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|j
comma
id|gpio_count
op_assign
l_int|16
suffix:semicolon
id|bank
op_assign
op_amp
id|gpio_bank
(braket
id|i
)braket
suffix:semicolon
id|bank-&gt;reserved_map
op_assign
l_int|0
suffix:semicolon
id|bank-&gt;base
op_assign
id|IO_ADDRESS
c_func
(paren
id|bank-&gt;base
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|bank-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bank-&gt;method
op_eq
id|METHOD_MPUIO
)paren
(brace
id|omap_writew
c_func
(paren
l_int|0xFFFF
comma
id|OMAP_MPUIO_BASE
op_plus
id|OMAP_MPUIO_GPIO_MASKIT
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ARCH_OMAP1510
r_if
c_cond
(paren
id|bank-&gt;method
op_eq
id|METHOD_GPIO_1510
)paren
(brace
id|__raw_writew
c_func
(paren
l_int|0xffff
comma
id|bank-&gt;base
op_plus
id|OMAP1510_GPIO_INT_MASK
)paren
suffix:semicolon
id|__raw_writew
c_func
(paren
l_int|0x0000
comma
id|bank-&gt;base
op_plus
id|OMAP1510_GPIO_INT_STATUS
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if defined(CONFIG_ARCH_OMAP16XX)
r_if
c_cond
(paren
id|bank-&gt;method
op_eq
id|METHOD_GPIO_1610
)paren
(brace
id|__raw_writew
c_func
(paren
l_int|0x0000
comma
id|bank-&gt;base
op_plus
id|OMAP1610_GPIO_IRQENABLE1
)paren
suffix:semicolon
id|__raw_writew
c_func
(paren
l_int|0xffff
comma
id|bank-&gt;base
op_plus
id|OMAP1610_GPIO_IRQSTATUS1
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_ARCH_OMAP730
r_if
c_cond
(paren
id|bank-&gt;method
op_eq
id|METHOD_GPIO_730
)paren
(brace
id|__raw_writel
c_func
(paren
l_int|0xffffffff
comma
id|bank-&gt;base
op_plus
id|OMAP730_GPIO_INT_MASK
)paren
suffix:semicolon
id|__raw_writel
c_func
(paren
l_int|0x00000000
comma
id|bank-&gt;base
op_plus
id|OMAP730_GPIO_INT_STATUS
)paren
suffix:semicolon
id|gpio_count
op_assign
l_int|32
suffix:semicolon
multiline_comment|/* 730 has 32-bit GPIOs */
)brace
macro_line|#endif
r_for
c_loop
(paren
id|j
op_assign
id|bank-&gt;virtual_irq_start
suffix:semicolon
id|j
OL
id|bank-&gt;virtual_irq_start
op_plus
id|gpio_count
suffix:semicolon
id|j
op_increment
)paren
(brace
r_if
c_cond
(paren
id|bank-&gt;method
op_eq
id|METHOD_MPUIO
)paren
id|set_irq_chip
c_func
(paren
id|j
comma
op_amp
id|mpuio_irq_chip
)paren
suffix:semicolon
r_else
id|set_irq_chip
c_func
(paren
id|j
comma
op_amp
id|gpio_irq_chip
)paren
suffix:semicolon
id|set_irq_handler
c_func
(paren
id|j
comma
id|do_edge_IRQ
)paren
suffix:semicolon
id|set_irq_flags
c_func
(paren
id|j
comma
id|IRQF_VALID
)paren
suffix:semicolon
)brace
id|set_irq_chained_handler
c_func
(paren
id|bank-&gt;irq
comma
id|gpio_irq_handler
)paren
suffix:semicolon
id|set_irq_data
c_func
(paren
id|bank-&gt;irq
comma
id|bank
)paren
suffix:semicolon
)brace
multiline_comment|/* Enable system clock for GPIO module.&n;&t; * The CAM_CLK_CTRL *is* really the right place. */
r_if
c_cond
(paren
id|cpu_is_omap1610
c_func
(paren
)paren
op_logical_or
id|cpu_is_omap1710
c_func
(paren
)paren
)paren
id|omap_writel
c_func
(paren
id|omap_readl
c_func
(paren
id|ULPD_CAM_CLK_CTRL
)paren
op_or
l_int|0x04
comma
id|ULPD_CAM_CLK_CTRL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * This may get called early from board specific init&n; */
DECL|function|omap_gpio_init
r_int
id|omap_gpio_init
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|initialized
)paren
r_return
id|_omap_gpio_init
c_func
(paren
)paren
suffix:semicolon
r_else
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|omap_request_gpio
id|EXPORT_SYMBOL
c_func
(paren
id|omap_request_gpio
)paren
suffix:semicolon
DECL|variable|omap_free_gpio
id|EXPORT_SYMBOL
c_func
(paren
id|omap_free_gpio
)paren
suffix:semicolon
DECL|variable|omap_set_gpio_direction
id|EXPORT_SYMBOL
c_func
(paren
id|omap_set_gpio_direction
)paren
suffix:semicolon
DECL|variable|omap_set_gpio_dataout
id|EXPORT_SYMBOL
c_func
(paren
id|omap_set_gpio_dataout
)paren
suffix:semicolon
DECL|variable|omap_get_gpio_datain
id|EXPORT_SYMBOL
c_func
(paren
id|omap_get_gpio_datain
)paren
suffix:semicolon
DECL|variable|omap_set_gpio_edge_ctrl
id|EXPORT_SYMBOL
c_func
(paren
id|omap_set_gpio_edge_ctrl
)paren
suffix:semicolon
DECL|variable|omap_gpio_init
id|arch_initcall
c_func
(paren
id|omap_gpio_init
)paren
suffix:semicolon
eof
