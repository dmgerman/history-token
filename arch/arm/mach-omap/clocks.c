multiline_comment|/*&n; * Clock interface for OMAP&n; *&n; * Copyright (C) 2001 RidgeRun, Inc&n; * Written by Gordon McNutt &lt;gmcnutt@ridgerun.com&gt;&n; * Updated 2004 for Linux 2.6 by Tony Lindgren &lt;tony@atomide.com&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify it&n; * under the terms of the GNU General Public License as published by the&n; * Free Software Foundation; either version 2 of the License, or (at your&n; * option) any later version.&n; *&n; * THIS SOFTWARE IS PROVIDED ``AS IS&squot;&squot; AND ANY EXPRESS OR IMPLIED&n; * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF&n; * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN&n; * NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,&n; * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT&n; * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF&n; * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON&n; * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT&n; * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF&n; * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.&n; *&n; * You should have received a copy of the GNU General Public License along&n; * with this program; if not, write to the Free Software Foundation, Inc.,&n; * 675 Mass Ave, Cambridge, MA 02139, USA.&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;asm/errno.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/arch/clocks.h&gt;
macro_line|#include &lt;asm/arch/board.h&gt;
multiline_comment|/* Input clock in MHz */
DECL|variable|source_clock
r_static
r_int
r_int
id|source_clock
op_assign
l_int|12
suffix:semicolon
multiline_comment|/*&n; * We use one spinlock for all clock registers for now. We may want to&n; * change this to be clock register specific later on. Before we can do&n; * that, we need to map out the shared clock registers.&n; */
DECL|variable|clock_lock
r_static
id|spinlock_t
id|clock_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|flags
id|__u8
id|flags
suffix:semicolon
DECL|member|parent
id|ck_t
id|parent
suffix:semicolon
DECL|member|rate_reg
r_int
r_int
id|rate_reg
suffix:semicolon
multiline_comment|/* Clock rate register */
DECL|member|enbl_reg
r_int
r_int
id|enbl_reg
suffix:semicolon
multiline_comment|/* Enable register */
DECL|member|idle_reg
r_int
r_int
id|idle_reg
suffix:semicolon
multiline_comment|/* Idle register */
DECL|member|slct_reg
r_int
r_int
id|slct_reg
suffix:semicolon
multiline_comment|/* Select register */
DECL|member|rate_shift
id|__s8
id|rate_shift
suffix:semicolon
multiline_comment|/* Clock rate bit shift */
DECL|member|enbl_shift
id|__s8
id|enbl_shift
suffix:semicolon
multiline_comment|/* Clock enable bit shift */
DECL|member|idle_shift
id|__s8
id|idle_shift
suffix:semicolon
multiline_comment|/* Clock idle bit shift */
DECL|member|slct_shift
id|__s8
id|slct_shift
suffix:semicolon
multiline_comment|/* Clock select bit shift */
DECL|typedef|ck_info_t
)brace
id|ck_info_t
suffix:semicolon
DECL|macro|CK_NAME
mdefine_line|#define CK_NAME(ck)&t;&t;ck_info_table[ck].name
DECL|macro|CK_FLAGS
mdefine_line|#define CK_FLAGS(ck)&t;&t;ck_info_table[ck].flags
DECL|macro|CK_PARENT
mdefine_line|#define CK_PARENT(ck)&t;&t;ck_info_table[ck].parent
DECL|macro|CK_RATE_REG
mdefine_line|#define CK_RATE_REG(ck)&t;&t;ck_info_table[ck].rate_reg
DECL|macro|CK_ENABLE_REG
mdefine_line|#define CK_ENABLE_REG(ck)&t;ck_info_table[ck].enbl_reg
DECL|macro|CK_IDLE_REG
mdefine_line|#define CK_IDLE_REG(ck)&t;&t;ck_info_table[ck].idle_reg
DECL|macro|CK_SELECT_REG
mdefine_line|#define CK_SELECT_REG(ck)&t;ck_info_table[ck].slct_reg
DECL|macro|CK_RATE_SHIFT
mdefine_line|#define CK_RATE_SHIFT(ck)&t;ck_info_table[ck].rate_shift
DECL|macro|CK_ENABLE_SHIFT
mdefine_line|#define CK_ENABLE_SHIFT(ck)&t;ck_info_table[ck].enbl_shift
DECL|macro|CK_IDLE_SHIFT
mdefine_line|#define CK_IDLE_SHIFT(ck)&t;ck_info_table[ck].idle_shift
DECL|macro|CK_SELECT_SHIFT
mdefine_line|#define CK_SELECT_SHIFT(ck)&t;ck_info_table[ck].slct_shift
DECL|macro|CK_CAN_CHANGE_RATE
mdefine_line|#define CK_CAN_CHANGE_RATE(cl)&t;(CK_FLAGS(ck) &amp; CK_RATEF)
DECL|macro|CK_CAN_DISABLE
mdefine_line|#define CK_CAN_DISABLE(cl)&t;(CK_FLAGS(ck) &amp; CK_ENABLEF)
DECL|macro|CK_CAN_IDLE
mdefine_line|#define CK_CAN_IDLE(cl)&t;&t;(CK_FLAGS(ck) &amp; CK_IDLEF)
DECL|macro|CK_CAN_SWITCH
mdefine_line|#define CK_CAN_SWITCH(cl)&t;(CK_FLAGS(ck) &amp; CK_SELECTF)
DECL|variable|ck_info_table
r_static
id|ck_info_t
id|ck_info_table
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;clkin&quot;
comma
dot
id|flags
op_assign
l_int|0
comma
dot
id|parent
op_assign
id|OMAP_CLKIN
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;ck_gen1&quot;
comma
dot
id|flags
op_assign
id|CK_RATEF
op_or
id|CK_IDLEF
comma
dot
id|rate_reg
op_assign
id|CK_DPLL1
comma
dot
id|idle_reg
op_assign
id|ARM_IDLECT1
comma
dot
id|idle_shift
op_assign
id|IDLDPLL_ARM
comma
dot
id|parent
op_assign
id|OMAP_CLKIN
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;ck_gen2&quot;
comma
dot
id|flags
op_assign
l_int|0
comma
dot
id|parent
op_assign
id|OMAP_CK_GEN1
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;ck_gen3&quot;
comma
dot
id|flags
op_assign
l_int|0
comma
dot
id|parent
op_assign
id|OMAP_CK_GEN1
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;tc_ck&quot;
comma
dot
id|flags
op_assign
id|CK_RATEF
op_or
id|CK_IDLEF
comma
dot
id|parent
op_assign
id|OMAP_CK_GEN3
comma
dot
id|rate_reg
op_assign
id|ARM_CKCTL
comma
multiline_comment|/* ARM_CKCTL[TCDIV(9:8)] */
dot
id|idle_reg
op_assign
id|ARM_IDLECT1
comma
dot
id|rate_shift
op_assign
id|TCDIV
comma
dot
id|idle_shift
op_assign
id|IDLIF_ARM
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;arm_ck&quot;
comma
dot
id|flags
op_assign
id|CK_IDLEF
op_or
id|CK_RATEF
comma
dot
id|parent
op_assign
id|OMAP_CK_GEN1
comma
dot
id|rate_reg
op_assign
id|ARM_CKCTL
comma
multiline_comment|/* ARM_CKCTL[ARMDIV(5:4)] */
dot
id|idle_reg
op_assign
id|ARM_IDLECT1
comma
dot
id|rate_shift
op_assign
id|ARMDIV
comma
dot
id|idle_shift
op_assign
id|SETARM_IDLE
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;mpuper_ck&quot;
comma
dot
id|flags
op_assign
id|CK_RATEF
op_or
id|CK_IDLEF
op_or
id|CK_ENABLEF
comma
dot
id|parent
op_assign
id|OMAP_CK_GEN1
comma
dot
id|rate_reg
op_assign
id|ARM_CKCTL
comma
multiline_comment|/* ARM_CKCTL[PERDIV(1:0)] */
dot
id|enbl_reg
op_assign
id|ARM_IDLECT2
comma
dot
id|idle_reg
op_assign
id|ARM_IDLECT1
comma
dot
id|rate_shift
op_assign
id|PERDIV
comma
dot
id|enbl_shift
op_assign
id|EN_PERCK
comma
dot
id|idle_shift
op_assign
id|IDLPER_ARM
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;arm_gpio_ck&quot;
comma
dot
id|flags
op_assign
id|CK_ENABLEF
comma
dot
id|parent
op_assign
id|OMAP_CK_GEN1
comma
dot
id|enbl_reg
op_assign
id|ARM_IDLECT2
comma
dot
id|enbl_shift
op_assign
id|EN_GPIOCK
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;mpuxor_ck&quot;
comma
dot
id|flags
op_assign
id|CK_ENABLEF
op_or
id|CK_IDLEF
comma
dot
id|parent
op_assign
id|OMAP_CLKIN
comma
dot
id|idle_reg
op_assign
id|ARM_IDLECT1
comma
dot
id|enbl_reg
op_assign
id|ARM_IDLECT2
comma
dot
id|idle_shift
op_assign
id|IDLXORP_ARM
comma
dot
id|enbl_shift
op_assign
id|EN_XORPCK
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;mputim_ck&quot;
comma
dot
id|flags
op_assign
id|CK_IDLEF
op_or
id|CK_ENABLEF
op_or
id|CK_SELECTF
comma
dot
id|parent
op_assign
id|OMAP_CLKIN
comma
dot
id|idle_reg
op_assign
id|ARM_IDLECT1
comma
dot
id|enbl_reg
op_assign
id|ARM_IDLECT2
comma
dot
id|slct_reg
op_assign
id|ARM_CKCTL
comma
dot
id|idle_shift
op_assign
id|IDLTIM_ARM
comma
dot
id|enbl_shift
op_assign
id|EN_TIMCK
comma
dot
id|slct_shift
op_assign
id|ARM_TIMXO
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;mpuwd_ck&quot;
comma
dot
id|flags
op_assign
id|CK_IDLEF
op_or
id|CK_ENABLEF
comma
dot
id|parent
op_assign
id|OMAP_CLKIN
comma
dot
id|idle_reg
op_assign
id|ARM_IDLECT1
comma
dot
id|enbl_reg
op_assign
id|ARM_IDLECT2
comma
dot
id|idle_shift
op_assign
id|IDLWDT_ARM
comma
dot
id|enbl_shift
op_assign
id|EN_WDTCK
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;dsp_ck&quot;
comma
dot
id|flags
op_assign
id|CK_RATEF
op_or
id|CK_ENABLEF
comma
dot
id|parent
op_assign
id|OMAP_CK_GEN2
comma
dot
id|rate_reg
op_assign
id|ARM_CKCTL
comma
multiline_comment|/* ARM_CKCTL[DSPDIV(7:6)] */
dot
id|enbl_reg
op_assign
id|ARM_CKCTL
comma
dot
id|rate_shift
op_assign
id|DSPDIV
comma
dot
id|enbl_shift
op_assign
id|EN_DSPCK
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;dspmmu_ck&quot;
comma
dot
id|flags
op_assign
id|CK_RATEF
op_or
id|CK_ENABLEF
comma
dot
id|parent
op_assign
id|OMAP_CK_GEN2
comma
dot
id|rate_reg
op_assign
id|ARM_CKCTL
comma
multiline_comment|/* ARM_CKCTL[DSPMMUDIV(11:10)] */
dot
id|enbl_reg
op_assign
id|ARM_CKCTL
comma
dot
id|rate_shift
op_assign
id|DSPMMUDIV
comma
dot
id|enbl_shift
op_assign
id|EN_DSPCK
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;dma_ck&quot;
comma
dot
id|flags
op_assign
id|CK_RATEF
op_or
id|CK_IDLEF
op_or
id|CK_ENABLEF
comma
dot
id|parent
op_assign
id|OMAP_CK_GEN3
comma
dot
id|rate_reg
op_assign
id|ARM_CKCTL
comma
multiline_comment|/* ARM_CKCTL[TCDIV(9:8)] */
dot
id|idle_reg
op_assign
id|ARM_IDLECT1
comma
dot
id|enbl_reg
op_assign
id|ARM_IDLECT2
comma
dot
id|rate_shift
op_assign
id|TCDIV
comma
dot
id|idle_shift
op_assign
id|IDLIF_ARM
comma
dot
id|enbl_shift
op_assign
id|DMACK_REQ
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;api_ck&quot;
comma
dot
id|flags
op_assign
id|CK_RATEF
op_or
id|CK_IDLEF
op_or
id|CK_ENABLEF
comma
dot
id|parent
op_assign
id|OMAP_CK_GEN3
comma
dot
id|rate_reg
op_assign
id|ARM_CKCTL
comma
multiline_comment|/* ARM_CKCTL[TCDIV(9:8)] */
dot
id|idle_reg
op_assign
id|ARM_IDLECT1
comma
dot
id|enbl_reg
op_assign
id|ARM_IDLECT2
comma
dot
id|rate_shift
op_assign
id|TCDIV
comma
dot
id|idle_shift
op_assign
id|IDLAPI_ARM
comma
dot
id|enbl_shift
op_assign
id|EN_APICK
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;hsab_ck&quot;
comma
dot
id|flags
op_assign
id|CK_RATEF
op_or
id|CK_IDLEF
op_or
id|CK_ENABLEF
comma
dot
id|parent
op_assign
id|OMAP_CK_GEN3
comma
dot
id|rate_reg
op_assign
id|ARM_CKCTL
comma
multiline_comment|/* ARM_CKCTL[TCDIV(9:8)] */
dot
id|idle_reg
op_assign
id|ARM_IDLECT1
comma
dot
id|enbl_reg
op_assign
id|ARM_IDLECT2
comma
dot
id|rate_shift
op_assign
id|TCDIV
comma
dot
id|idle_shift
op_assign
id|IDLHSAB_ARM
comma
dot
id|enbl_shift
op_assign
id|EN_HSABCK
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;lbfree_ck&quot;
comma
dot
id|flags
op_assign
id|CK_RATEF
op_or
id|CK_ENABLEF
comma
dot
id|parent
op_assign
id|OMAP_CK_GEN3
comma
dot
id|rate_reg
op_assign
id|ARM_CKCTL
comma
multiline_comment|/* ARM_CKCTL[TCDIV(9:8)] */
dot
id|enbl_reg
op_assign
id|ARM_IDLECT2
comma
dot
id|rate_shift
op_assign
id|TCDIV
comma
dot
id|enbl_shift
op_assign
id|EN_LBFREECK
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;lb_ck&quot;
comma
dot
id|flags
op_assign
id|CK_RATEF
op_or
id|CK_IDLEF
op_or
id|CK_ENABLEF
comma
dot
id|parent
op_assign
id|OMAP_CK_GEN3
comma
dot
id|rate_reg
op_assign
id|ARM_CKCTL
comma
multiline_comment|/* ARM_CKCTL[TCDIV(9:8)] */
dot
id|idle_reg
op_assign
id|ARM_IDLECT1
comma
dot
id|enbl_reg
op_assign
id|ARM_IDLECT2
comma
dot
id|rate_shift
op_assign
id|TCDIV
comma
dot
id|idle_shift
op_assign
id|IDLLB_ARM
comma
dot
id|enbl_shift
op_assign
id|EN_LBCK
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;lcd_ck&quot;
comma
dot
id|flags
op_assign
id|CK_RATEF
op_or
id|CK_IDLEF
op_or
id|CK_ENABLEF
comma
dot
id|parent
op_assign
id|OMAP_CK_GEN3
comma
dot
id|rate_reg
op_assign
id|ARM_CKCTL
comma
multiline_comment|/* ARM_CKCTL[LCDDIV(3:2)] */
dot
id|idle_reg
op_assign
id|ARM_IDLECT1
comma
dot
id|enbl_reg
op_assign
id|ARM_IDLECT2
comma
dot
id|rate_shift
op_assign
id|LCDDIV
comma
dot
id|idle_shift
op_assign
id|IDLLCD_ARM
comma
dot
id|enbl_shift
op_assign
id|EN_LCDCK
comma
)brace
comma
)brace
suffix:semicolon
multiline_comment|/*****************************************************************************/
DECL|macro|CK_IN_RANGE
mdefine_line|#define CK_IN_RANGE(ck)&t;&t;(!((ck &lt; OMAP_CK_MIN) || (ck &gt; OMAP_CK_MAX)))
DECL|variable|ck_auto_unclock
r_int
id|ck_auto_unclock
op_assign
l_int|1
suffix:semicolon
DECL|variable|ck_debug
r_int
id|ck_debug
op_assign
l_int|0
suffix:semicolon
DECL|macro|CK_MAX_PLL_FREQ
mdefine_line|#define CK_MAX_PLL_FREQ&t;&t;OMAP_CK_MAX_RATE
DECL|variable|ck_valid_table
r_static
id|__u8
id|ck_valid_table
(braket
id|CK_MAX_PLL_FREQ
op_div
l_int|8
op_plus
l_int|1
)braket
suffix:semicolon
DECL|variable|ck_lookup_table
r_static
id|__u8
id|ck_lookup_table
(braket
id|CK_MAX_PLL_FREQ
)braket
suffix:semicolon
r_int
DECL|function|ck_set_input
id|ck_set_input
c_func
(paren
id|ck_t
id|ck
comma
id|ck_t
id|input
)paren
(brace
r_int
id|ret
op_assign
l_int|0
comma
id|shift
suffix:semicolon
r_int
r_int
id|reg
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|CK_IN_RANGE
c_func
(paren
id|ck
)paren
op_logical_or
op_logical_neg
id|CK_CAN_SWITCH
c_func
(paren
id|ck
)paren
)paren
(brace
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
id|reg
op_assign
id|omap_readw
c_func
(paren
id|CK_SELECT_REG
c_func
(paren
id|ck
)paren
)paren
suffix:semicolon
id|shift
op_assign
id|CK_SELECT_SHIFT
c_func
(paren
id|ck
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|clock_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|input
op_eq
id|OMAP_CLKIN
)paren
(brace
id|reg
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|shift
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|reg
comma
id|CK_SELECT_REG
c_func
(paren
id|ck
)paren
)paren
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|input
op_eq
id|CK_PARENT
c_func
(paren
id|ck
)paren
)paren
(brace
id|reg
op_or_assign
(paren
l_int|1
op_lshift
id|shift
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|reg
comma
id|CK_SELECT_REG
c_func
(paren
id|ck
)paren
)paren
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
m_exit
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|clock_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_int
DECL|function|ck_get_input
id|ck_get_input
c_func
(paren
id|ck_t
id|ck
comma
id|ck_t
op_star
id|input
)paren
(brace
r_int
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|CK_IN_RANGE
c_func
(paren
id|ck
)paren
)paren
r_goto
m_exit
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|clock_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|CK_CAN_SWITCH
c_func
(paren
id|ck
)paren
)paren
(brace
r_int
id|shift
suffix:semicolon
r_int
r_int
id|reg
suffix:semicolon
id|reg
op_assign
id|omap_readw
c_func
(paren
id|CK_SELECT_REG
c_func
(paren
id|ck
)paren
)paren
suffix:semicolon
id|shift
op_assign
id|CK_SELECT_SHIFT
c_func
(paren
id|ck
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_amp
(paren
l_int|1
op_lshift
id|shift
)paren
)paren
(brace
op_star
id|input
op_assign
id|CK_PARENT
c_func
(paren
id|ck
)paren
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
)brace
op_star
id|input
op_assign
id|OMAP_CLKIN
suffix:semicolon
m_exit
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|clock_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|__ck_set_pll_rate
id|__ck_set_pll_rate
c_func
(paren
id|ck_t
id|ck
comma
r_int
id|rate
)paren
(brace
r_int
r_int
id|pll
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rate
OL
l_int|0
)paren
op_logical_or
(paren
id|rate
OG
id|CK_MAX_PLL_FREQ
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
multiline_comment|/* Scan downward for the closest matching frequency */
r_while
c_loop
(paren
id|rate
op_logical_and
op_logical_neg
id|test_bit
c_func
(paren
id|rate
comma
(paren
r_int
r_int
op_star
)paren
op_amp
id|ck_valid_table
)paren
)paren
id|rate
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rate
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: couldn&squot;t find a matching rate&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|clock_lock
comma
id|flags
)paren
suffix:semicolon
id|pll
op_assign
id|omap_readw
c_func
(paren
id|CK_RATE_REG
c_func
(paren
id|ck
)paren
)paren
suffix:semicolon
multiline_comment|/* Clear the rate bits */
id|pll
op_and_assign
op_complement
(paren
l_int|0x1f
op_lshift
l_int|5
)paren
suffix:semicolon
multiline_comment|/* Set the rate bits */
id|pll
op_or_assign
(paren
id|ck_lookup_table
(braket
id|rate
op_minus
l_int|1
)braket
op_lshift
l_int|5
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|pll
comma
id|CK_RATE_REG
c_func
(paren
id|ck
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|clock_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|__ck_set_clkm_rate
id|__ck_set_clkm_rate
c_func
(paren
id|ck_t
id|ck
comma
r_int
id|rate
)paren
(brace
r_int
id|shift
comma
id|prate
comma
id|div
comma
id|ret
suffix:semicolon
r_int
r_int
id|reg
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|clock_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * We can only set this clock&squot;s value to a fraction of its&n;&t; * parent&squot;s value. The interface says I&squot;ll round down when necessary.&n;&t; * So first let&squot;s get the parent&squot;s current rate.&n;&t; */
id|prate
op_assign
id|ck_get_rate
c_func
(paren
id|CK_PARENT
c_func
(paren
id|ck
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Let&squot;s just start with the highest fraction and keep searching&n;&t; * down through available rates until we find one less than or equal&n;&t; * to the desired rate.&n;&t; */
r_for
c_loop
(paren
id|div
op_assign
l_int|0
suffix:semicolon
id|div
OL
l_int|4
suffix:semicolon
id|div
op_increment
)paren
(brace
r_if
c_cond
(paren
id|prate
op_le
id|rate
)paren
r_break
suffix:semicolon
id|prate
op_assign
id|prate
op_div
l_int|2
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Oops. Looks like the caller wants a rate lower than we can support.&n;&t; */
r_if
c_cond
(paren
id|div
op_eq
l_int|5
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: %d is too low&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|rate
)paren
suffix:semicolon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * One more detail: if this clock supports more than one parent, then&n;&t; * we&squot;re going to automatically switch over to the parent which runs&n;&t; * through the divisor. For omap this is not ambiguous because for all&n;&t; * such clocks one choice is always OMAP_CLKIN (which doesn&squot;t run&n;&t; * through the divisor) and the other is whatever I encoded as&n;&t; * CK_PARENT. Note that I wait until we get this far because I don&squot;t&n;&t; * want to switch the input until we&squot;re sure this is going to work.&n;&t; */
r_if
c_cond
(paren
id|CK_CAN_SWITCH
c_func
(paren
id|ck
)paren
)paren
r_if
c_cond
(paren
(paren
id|ret
op_assign
id|ck_set_input
c_func
(paren
id|ck
comma
id|CK_PARENT
c_func
(paren
id|ck
)paren
)paren
)paren
OL
l_int|0
)paren
(brace
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * At last, we can set the divisor. Clear the old rate bits and&n;&t; * set the new ones.&n;&t; */
id|reg
op_assign
id|omap_readw
c_func
(paren
id|CK_RATE_REG
c_func
(paren
id|ck
)paren
)paren
suffix:semicolon
id|shift
op_assign
id|CK_RATE_SHIFT
c_func
(paren
id|ck
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
(paren
l_int|3
op_lshift
id|shift
)paren
suffix:semicolon
id|reg
op_or_assign
(paren
id|div
op_lshift
id|shift
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|reg
comma
id|CK_RATE_REG
c_func
(paren
id|ck
)paren
)paren
suffix:semicolon
multiline_comment|/* And return the new (actual, after rounding down) rate. */
id|ret
op_assign
id|prate
suffix:semicolon
m_exit
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|clock_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_int
DECL|function|ck_set_rate
id|ck_set_rate
c_func
(paren
id|ck_t
id|ck
comma
r_int
id|rate
)paren
(brace
r_int
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|CK_IN_RANGE
c_func
(paren
id|ck
)paren
op_logical_or
op_logical_neg
id|CK_CAN_CHANGE_RATE
c_func
(paren
id|ck
)paren
)paren
r_goto
m_exit
suffix:semicolon
r_switch
c_cond
(paren
id|ck
)paren
(brace
r_default
suffix:colon
id|ret
op_assign
id|__ck_set_clkm_rate
c_func
(paren
id|ck
comma
id|rate
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OMAP_CK_GEN1
suffix:colon
id|ret
op_assign
id|__ck_set_pll_rate
c_func
(paren
id|ck
comma
id|rate
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
suffix:semicolon
m_exit
suffix:colon
r_return
id|ret
suffix:semicolon
)brace
r_static
r_int
DECL|function|__ck_get_pll_rate
id|__ck_get_pll_rate
c_func
(paren
id|ck_t
id|ck
)paren
(brace
r_int
id|m
comma
id|d
suffix:semicolon
r_int
r_int
id|pll
op_assign
id|omap_readw
c_func
(paren
id|CK_RATE_REG
c_func
(paren
id|ck
)paren
)paren
suffix:semicolon
id|m
op_assign
(paren
id|pll
op_amp
(paren
l_int|0x1f
op_lshift
l_int|7
)paren
)paren
op_rshift
l_int|7
suffix:semicolon
id|m
op_assign
id|m
ques
c_cond
id|m
suffix:colon
l_int|1
suffix:semicolon
id|d
op_assign
(paren
id|pll
op_amp
(paren
l_int|3
op_lshift
l_int|5
)paren
)paren
op_rshift
l_int|5
suffix:semicolon
id|d
op_increment
suffix:semicolon
r_return
(paren
(paren
id|source_clock
op_star
id|m
)paren
op_div
id|d
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|__ck_get_clkm_rate
id|__ck_get_clkm_rate
c_func
(paren
id|ck_t
id|ck
)paren
(brace
r_static
r_int
id|bits2div
(braket
)braket
op_assign
(brace
l_int|1
comma
l_int|2
comma
l_int|4
comma
l_int|8
)brace
suffix:semicolon
r_int
id|in
comma
id|bits
comma
id|reg
comma
id|shift
suffix:semicolon
id|reg
op_assign
id|omap_readw
c_func
(paren
id|CK_RATE_REG
c_func
(paren
id|ck
)paren
)paren
suffix:semicolon
id|shift
op_assign
id|CK_RATE_SHIFT
c_func
(paren
id|ck
)paren
suffix:semicolon
id|in
op_assign
id|ck_get_rate
c_func
(paren
id|CK_PARENT
c_func
(paren
id|ck
)paren
)paren
suffix:semicolon
id|bits
op_assign
(paren
id|reg
op_amp
(paren
l_int|3
op_lshift
id|shift
)paren
)paren
op_rshift
id|shift
suffix:semicolon
r_return
(paren
id|in
op_div
id|bits2div
(braket
id|bits
)braket
)paren
suffix:semicolon
)brace
r_int
DECL|function|ck_get_rate
id|ck_get_rate
c_func
(paren
id|ck_t
id|ck
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|ck_t
id|parent
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|CK_IN_RANGE
c_func
(paren
id|ck
)paren
)paren
(brace
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
m_exit
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|ck
)paren
(brace
r_case
id|OMAP_CK_GEN1
suffix:colon
id|ret
op_assign
id|__ck_get_pll_rate
c_func
(paren
id|ck
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OMAP_CLKIN
suffix:colon
id|ret
op_assign
id|source_clock
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OMAP_MPUXOR_CK
suffix:colon
r_case
id|OMAP_CK_GEN2
suffix:colon
r_case
id|OMAP_CK_GEN3
suffix:colon
r_case
id|OMAP_ARM_GPIO_CK
suffix:colon
id|ret
op_assign
id|ck_get_rate
c_func
(paren
id|CK_PARENT
c_func
(paren
id|ck
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OMAP_ARM_CK
suffix:colon
r_case
id|OMAP_MPUPER_CK
suffix:colon
r_case
id|OMAP_DSP_CK
suffix:colon
r_case
id|OMAP_DSPMMU_CK
suffix:colon
r_case
id|OMAP_LCD_CK
suffix:colon
r_case
id|OMAP_TC_CK
suffix:colon
r_case
id|OMAP_DMA_CK
suffix:colon
r_case
id|OMAP_API_CK
suffix:colon
r_case
id|OMAP_HSAB_CK
suffix:colon
r_case
id|OMAP_LBFREE_CK
suffix:colon
r_case
id|OMAP_LB_CK
suffix:colon
id|ret
op_assign
id|__ck_get_clkm_rate
c_func
(paren
id|ck
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OMAP_MPUTIM_CK
suffix:colon
id|ck_get_input
c_func
(paren
id|ck
comma
op_amp
id|parent
)paren
suffix:semicolon
id|ret
op_assign
id|ck_get_rate
c_func
(paren
id|parent
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OMAP_MPUWD_CK
suffix:colon
multiline_comment|/* Note that this evaluates to zero if source_clock is 12MHz. */
id|ret
op_assign
id|source_clock
op_div
l_int|14
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ret
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
m_exit
suffix:colon
r_return
id|ret
suffix:semicolon
)brace
r_int
DECL|function|ck_enable
id|ck_enable
c_func
(paren
id|ck_t
id|ck
)paren
(brace
r_int
r_int
id|reg
suffix:semicolon
r_int
id|ret
op_assign
op_minus
id|EINVAL
comma
id|shift
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|CK_IN_RANGE
c_func
(paren
id|ck
)paren
)paren
r_goto
m_exit
suffix:semicolon
r_if
c_cond
(paren
id|ck_debug
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: %s&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|CK_NAME
c_func
(paren
id|ck
)paren
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|CK_CAN_DISABLE
c_func
(paren
id|ck
)paren
)paren
multiline_comment|/* Then it must be on... */
r_goto
m_exit
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|clock_lock
comma
id|flags
)paren
suffix:semicolon
id|reg
op_assign
id|omap_readw
c_func
(paren
id|CK_ENABLE_REG
c_func
(paren
id|ck
)paren
)paren
suffix:semicolon
id|shift
op_assign
id|CK_ENABLE_SHIFT
c_func
(paren
id|ck
)paren
suffix:semicolon
id|reg
op_or_assign
(paren
l_int|1
op_lshift
id|shift
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|reg
comma
id|CK_ENABLE_REG
c_func
(paren
id|ck
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|clock_lock
comma
id|flags
)paren
suffix:semicolon
m_exit
suffix:colon
r_return
id|ret
suffix:semicolon
)brace
r_int
DECL|function|ck_disable
id|ck_disable
c_func
(paren
id|ck_t
id|ck
)paren
(brace
r_int
r_int
id|reg
suffix:semicolon
r_int
id|ret
op_assign
op_minus
id|EINVAL
comma
id|shift
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|CK_IN_RANGE
c_func
(paren
id|ck
)paren
)paren
r_goto
m_exit
suffix:semicolon
r_if
c_cond
(paren
id|ck_debug
)paren
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;%s: %s&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|CK_NAME
c_func
(paren
id|ck
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|CK_CAN_DISABLE
c_func
(paren
id|ck
)paren
)paren
r_goto
m_exit
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ck
op_eq
id|OMAP_CLKIN
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|clock_lock
comma
id|flags
)paren
suffix:semicolon
id|reg
op_assign
id|omap_readw
c_func
(paren
id|CK_ENABLE_REG
c_func
(paren
id|ck
)paren
)paren
suffix:semicolon
id|shift
op_assign
id|CK_ENABLE_SHIFT
c_func
(paren
id|ck
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|shift
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|reg
comma
id|CK_ENABLE_REG
c_func
(paren
id|ck
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|clock_lock
comma
id|flags
)paren
suffix:semicolon
m_exit
suffix:colon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|ck_valid_rate
r_int
id|ck_valid_rate
c_func
(paren
r_int
id|rate
)paren
(brace
r_return
id|test_bit
c_func
(paren
id|rate
comma
(paren
r_int
r_int
op_star
)paren
op_amp
id|ck_valid_table
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|__ck_make_lookup_table
id|__ck_make_lookup_table
c_func
(paren
r_void
)paren
(brace
id|__u8
id|m
comma
id|d
suffix:semicolon
id|memset
c_func
(paren
id|ck_valid_table
comma
l_int|0
comma
r_sizeof
(paren
id|ck_valid_table
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|m
op_assign
l_int|1
suffix:semicolon
id|m
OL
l_int|32
suffix:semicolon
id|m
op_increment
)paren
r_for
c_loop
(paren
id|d
op_assign
l_int|1
suffix:semicolon
id|d
OL
l_int|5
suffix:semicolon
id|d
op_increment
)paren
(brace
r_int
id|rate
op_assign
(paren
(paren
id|source_clock
op_star
id|m
)paren
op_div
(paren
id|d
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rate
OG
id|CK_MAX_PLL_FREQ
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|rate
comma
(paren
r_int
r_int
op_star
)paren
op_amp
id|ck_valid_table
)paren
)paren
r_continue
suffix:semicolon
id|set_bit
c_func
(paren
id|rate
comma
(paren
r_int
r_int
op_star
)paren
op_amp
id|ck_valid_table
)paren
suffix:semicolon
id|ck_lookup_table
(braket
id|rate
op_minus
l_int|1
)braket
op_assign
(paren
id|m
op_lshift
l_int|2
)paren
op_or
(paren
id|d
op_minus
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_int
id|__init
DECL|function|init_ck
id|init_ck
c_func
(paren
r_void
)paren
(brace
r_const
r_struct
id|omap_clock_info
op_star
id|info
suffix:semicolon
r_int
id|crystal_type
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Default 12 MHz */
id|__ck_make_lookup_table
c_func
(paren
)paren
suffix:semicolon
id|info
op_assign
id|omap_get_per_info
c_func
(paren
id|OMAP_TAG_CLOCK
comma
r_struct
id|omap_clock_info
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cpu_is_omap1510
c_func
(paren
)paren
)paren
id|crystal_type
op_assign
id|info-&gt;system_clock_type
suffix:semicolon
)brace
multiline_comment|/* We want to be in syncronous scalable mode */
id|omap_writew
c_func
(paren
l_int|0x1000
comma
id|ARM_SYSST
)paren
suffix:semicolon
macro_line|#if defined(CONFIG_OMAP_ARM_30MHZ)
id|omap_writew
c_func
(paren
l_int|0x1555
comma
id|ARM_CKCTL
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
l_int|0x2290
comma
id|DPLL_CTL_REG
)paren
suffix:semicolon
macro_line|#elif defined(CONFIG_OMAP_ARM_60MHZ)
id|omap_writew
c_func
(paren
l_int|0x1005
comma
id|ARM_CKCTL
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
l_int|0x2290
comma
id|DPLL_CTL_REG
)paren
suffix:semicolon
macro_line|#elif defined(CONFIG_OMAP_ARM_96MHZ)
id|omap_writew
c_func
(paren
l_int|0x1005
comma
id|ARM_CKCTL
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
l_int|0x2410
comma
id|DPLL_CTL_REG
)paren
suffix:semicolon
macro_line|#elif defined(CONFIG_OMAP_ARM_120MHZ)
id|omap_writew
c_func
(paren
l_int|0x110a
comma
id|ARM_CKCTL
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
l_int|0x2510
comma
id|DPLL_CTL_REG
)paren
suffix:semicolon
macro_line|#elif defined(CONFIG_OMAP_ARM_168MHZ)
id|omap_writew
c_func
(paren
l_int|0x110f
comma
id|ARM_CKCTL
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
l_int|0x2710
comma
id|DPLL_CTL_REG
)paren
suffix:semicolon
macro_line|#elif defined(CONFIG_OMAP_ARM_182MHZ) &amp;&amp; defined(CONFIG_ARCH_OMAP730)
id|omap_writew
c_func
(paren
l_int|0x250E
comma
id|ARM_CKCTL
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
l_int|0x2710
comma
id|DPLL_CTL_REG
)paren
suffix:semicolon
macro_line|#elif defined(CONFIG_OMAP_ARM_192MHZ) &amp;&amp; (defined(CONFIG_ARCH_OMAP1610) || defined(CONFIG_ARCH_OMAP5912))
id|omap_writew
c_func
(paren
l_int|0x150f
comma
id|ARM_CKCTL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|crystal_type
op_eq
l_int|2
)paren
(brace
id|source_clock
op_assign
l_int|13
suffix:semicolon
multiline_comment|/* MHz */
id|omap_writew
c_func
(paren
l_int|0x2510
comma
id|DPLL_CTL_REG
)paren
suffix:semicolon
)brace
r_else
id|omap_writew
c_func
(paren
l_int|0x2810
comma
id|DPLL_CTL_REG
)paren
suffix:semicolon
macro_line|#elif defined(CONFIG_OMAP_ARM_195MHZ) &amp;&amp; defined(CONFIG_ARCH_OMAP730)
id|omap_writew
c_func
(paren
l_int|0x250E
comma
id|ARM_CKCTL
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
l_int|0x2790
comma
id|DPLL_CTL_REG
)paren
suffix:semicolon
macro_line|#else
macro_line|#error &quot;OMAP MHZ not set, please run make xconfig&quot;
macro_line|#endif
macro_line|#ifdef CONFIG_MACH_OMAP_PERSEUS2
multiline_comment|/* Select slicer output as OMAP input clock */
id|omap_writew
c_func
(paren
id|omap_readw
c_func
(paren
id|OMAP730_PCC_UPLD_CTRL_REG
)paren
op_amp
op_complement
l_int|0x1
comma
id|OMAP730_PCC_UPLD_CTRL_REG
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Turn off some other junk the bootloader might have turned on */
multiline_comment|/* Turn off DSP, ARM_INTHCK, ARM_TIMXO */
id|omap_writew
c_func
(paren
id|omap_readw
c_func
(paren
id|ARM_CKCTL
)paren
op_amp
l_int|0x0fff
comma
id|ARM_CKCTL
)paren
suffix:semicolon
multiline_comment|/* Put DSP/MPUI into reset until needed */
id|omap_writew
c_func
(paren
l_int|0
comma
id|ARM_RSTCT1
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
l_int|1
comma
id|ARM_RSTCT2
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
l_int|0x400
comma
id|ARM_IDLECT1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * According to OMAP5910 Erratum SYS_DMA_1, bit DMACK_REQ (bit 8)&n;&t; * of the ARM_IDLECT2 register must be set to zero. The power-on&n;&t; * default value of this bit is one.&n;&t; */
id|omap_writew
c_func
(paren
l_int|0x0000
comma
id|ARM_IDLECT2
)paren
suffix:semicolon
multiline_comment|/* Turn LCD clock off also */
multiline_comment|/*&n;&t; * Only enable those clocks we will need, let the drivers&n;&t; * enable other clocks as necessary&n;&t; */
id|ck_enable
c_func
(paren
id|OMAP_MPUPER_CK
)paren
suffix:semicolon
id|ck_enable
c_func
(paren
id|OMAP_ARM_GPIO_CK
)paren
suffix:semicolon
id|ck_enable
c_func
(paren
id|OMAP_MPUXOR_CK
)paren
suffix:semicolon
singleline_comment|//ck_set_rate(OMAP_MPUTIM_CK, OMAP_CLKIN);
id|ck_enable
c_func
(paren
id|OMAP_MPUTIM_CK
)paren
suffix:semicolon
id|start_mputimer1
c_func
(paren
l_int|0xffffffff
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ck_get_rate
id|EXPORT_SYMBOL
c_func
(paren
id|ck_get_rate
)paren
suffix:semicolon
DECL|variable|ck_set_rate
id|EXPORT_SYMBOL
c_func
(paren
id|ck_set_rate
)paren
suffix:semicolon
DECL|variable|ck_enable
id|EXPORT_SYMBOL
c_func
(paren
id|ck_enable
)paren
suffix:semicolon
DECL|variable|ck_disable
id|EXPORT_SYMBOL
c_func
(paren
id|ck_disable
)paren
suffix:semicolon
eof
