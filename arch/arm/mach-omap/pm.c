multiline_comment|/*&n; * linux/arch/arm/mach-omap/pm.c&n; *&n; * OMAP Power Management Routines&n; *&n; * Original code for the SA11x0:&n; * Copyright (c) 2001 Cliff Brake &lt;cbrake@accelent.com&gt;&n; *&n; * Modified for the PXA250 by Nicolas Pitre:&n; * Copyright (c) 2002 Monta Vista Software, Inc.&n; *&n; * Modified for the OMAP1510 by David Singleton:&n; * Copyright (c) 2002 Monta Vista Software, Inc.&n; *&n; * Cleanup 2004 for OMAP1510/1610 by Dirk Behme &lt;dirk.behme@de.bosch.com&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify it&n; * under the terms of the GNU General Public License as published by the&n; * Free Software Foundation; either version 2 of the License, or (at your&n; * option) any later version.&n; *&n; * THIS SOFTWARE IS PROVIDED ``AS IS&squot;&squot; AND ANY EXPRESS OR IMPLIED&n; * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF&n; * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN&n; * NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,&n; * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT&n; * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF&n; * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON&n; * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT&n; * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF&n; * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.&n; *&n; * You should have received a copy of the GNU General Public License along&n; * with this program; if not, write to the Free Software Foundation, Inc.,&n; * 675 Mass Ave, Cambridge, MA 02139, USA.&n; */
macro_line|#include &lt;linux/pm.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/pm.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/mach-types.h&gt;
macro_line|#include &lt;asm/arch/omap16xx.h&gt;
macro_line|#include &lt;asm/arch/pm.h&gt;
macro_line|#include &lt;asm/arch/mux.h&gt;
macro_line|#include &lt;asm/arch/tps65010.h&gt;
macro_line|#include &quot;clock.h&quot;
DECL|variable|arm_sleep_save
r_static
r_int
r_int
id|arm_sleep_save
(braket
id|ARM_SLEEP_SAVE_SIZE
)braket
suffix:semicolon
DECL|variable|ulpd_sleep_save
r_static
r_int
r_int
id|ulpd_sleep_save
(braket
id|ULPD_SLEEP_SAVE_SIZE
)braket
suffix:semicolon
DECL|variable|mpui1510_sleep_save
r_static
r_int
r_int
id|mpui1510_sleep_save
(braket
id|MPUI1510_SLEEP_SAVE_SIZE
)braket
suffix:semicolon
DECL|variable|mpui1610_sleep_save
r_static
r_int
r_int
id|mpui1610_sleep_save
(braket
id|MPUI1610_SLEEP_SAVE_SIZE
)braket
suffix:semicolon
multiline_comment|/*&n; * Let&squot;s power down on idle, but only if we are really&n; * idle, because once we start down the path of&n; * going idle we continue to do idle even if we get&n; * a clock tick interrupt . .&n; */
DECL|function|omap_pm_idle
r_void
id|omap_pm_idle
c_func
(paren
r_void
)paren
(brace
r_int
(paren
op_star
id|func_ptr
)paren
(paren
r_void
)paren
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|mask32
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * If the DSP is being used let&squot;s just idle the CPU, the overhead&n;&t; * to wake up from Big Sleep is big, milliseconds versus micro&n;&t; * seconds for wait for interrupt.&n;&t; */
id|local_irq_disable
c_func
(paren
)paren
suffix:semicolon
id|local_fiq_disable
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|need_resched
c_func
(paren
)paren
)paren
(brace
id|local_fiq_enable
c_func
(paren
)paren
suffix:semicolon
id|local_irq_enable
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|mask32
op_assign
id|omap_readl
c_func
(paren
id|ARM_SYSST
)paren
suffix:semicolon
id|local_fiq_enable
c_func
(paren
)paren
suffix:semicolon
id|local_irq_enable
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|mask32
op_amp
id|DSP_IDLE
)paren
op_eq
l_int|0
)paren
(brace
id|__asm__
r_volatile
(paren
l_string|&quot;mcr&t;p15, 0, r0, c7, c0, 4&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|cpu_is_omap1510
c_func
(paren
)paren
)paren
(brace
id|func_ptr
op_assign
(paren
r_void
op_star
)paren
(paren
id|OMAP1510_SRAM_IDLE_SUSPEND
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cpu_is_omap1610
c_func
(paren
)paren
op_logical_or
id|cpu_is_omap1710
c_func
(paren
)paren
)paren
(brace
id|func_ptr
op_assign
(paren
r_void
op_star
)paren
(paren
id|OMAP1610_SRAM_IDLE_SUSPEND
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cpu_is_omap5912
c_func
(paren
)paren
)paren
(brace
id|func_ptr
op_assign
(paren
r_void
op_star
)paren
(paren
id|OMAP5912_SRAM_IDLE_SUSPEND
)paren
suffix:semicolon
)brace
id|func_ptr
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Configuration of the wakeup event is board specific. For the&n; * moment we put it into this helper function. Later it may move&n; * to board specific files.&n; */
DECL|function|omap_pm_wakeup_setup
r_static
r_void
id|omap_pm_wakeup_setup
c_func
(paren
r_void
)paren
(brace
multiline_comment|/*&n;&t; * Enable ARM XOR clock and release peripheral from reset by&n;&t; * writing 1 to PER_EN bit in ARM_RSTCT2, this is required&n;&t; * for UART configuration to use UART2 to wake up.&n;&t; */
id|omap_writel
c_func
(paren
id|omap_readl
c_func
(paren
id|ARM_IDLECT2
)paren
op_or
id|ENABLE_XORCLK
comma
id|ARM_IDLECT2
)paren
suffix:semicolon
id|omap_writel
c_func
(paren
id|omap_readl
c_func
(paren
id|ARM_RSTCT2
)paren
op_or
id|PER_EN
comma
id|ARM_RSTCT2
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|MODEM_32K_EN
comma
id|ULPD_CLOCK_CTRL
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Turn off all interrupts except L1-2nd level cascade,&n;&t; * and the L2 wakeup interrupts: keypad and UART2.&n;&t; */
id|omap_writel
c_func
(paren
op_complement
id|IRQ_LEVEL2
comma
id|OMAP_IH1_MIR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpu_is_omap1510
c_func
(paren
)paren
)paren
(brace
id|omap_writel
c_func
(paren
op_complement
(paren
id|IRQ_UART2
op_or
id|IRQ_KEYBOARD
)paren
comma
id|OMAP_IH2_MIR
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cpu_is_omap16xx
c_func
(paren
)paren
)paren
(brace
id|omap_writel
c_func
(paren
op_complement
(paren
id|IRQ_UART2
op_or
id|IRQ_KEYBOARD
)paren
comma
id|OMAP_IH2_0_MIR
)paren
suffix:semicolon
id|omap_writel
c_func
(paren
op_complement
l_int|0x0
comma
id|OMAP_IH2_1_MIR
)paren
suffix:semicolon
id|omap_writel
c_func
(paren
op_complement
l_int|0x0
comma
id|OMAP_IH2_2_MIR
)paren
suffix:semicolon
id|omap_writel
c_func
(paren
op_complement
l_int|0x0
comma
id|OMAP_IH2_3_MIR
)paren
suffix:semicolon
)brace
multiline_comment|/*  New IRQ agreement */
id|omap_writel
c_func
(paren
l_int|1
comma
id|OMAP_IH1_CONTROL
)paren
suffix:semicolon
multiline_comment|/* external PULL to down, bit 22 = 0 */
id|omap_writel
c_func
(paren
id|omap_readl
c_func
(paren
id|PULL_DWN_CTRL_2
)paren
op_amp
op_complement
(paren
l_int|1
op_lshift
l_int|22
)paren
comma
id|PULL_DWN_CTRL_2
)paren
suffix:semicolon
)brace
DECL|function|omap_pm_suspend
r_void
id|omap_pm_suspend
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|mask32
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|arg0
op_assign
l_int|0
comma
id|arg1
op_assign
l_int|0
suffix:semicolon
r_int
(paren
op_star
id|func_ptr
)paren
(paren
r_int
r_int
comma
r_int
r_int
)paren
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|save_dsp_idlect2
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;PM: OMAP%x is entering deep sleep now ...&bslash;n&quot;
comma
id|system_rev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|machine_is_omap_osk
c_func
(paren
)paren
)paren
(brace
multiline_comment|/* Stop LED1 (D9) blink */
id|tps65010_set_led
c_func
(paren
id|LED1
comma
id|OFF
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Step 1: turn off interrupts&n;&t; */
id|local_irq_disable
c_func
(paren
)paren
suffix:semicolon
id|local_fiq_disable
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Step 2: save registers&n;&t; *&n;&t; * The omap is a strange/beautiful device. The caches, memory&n;&t; * and register state are preserved across power saves.&n;&t; * We have to save and restore very little register state to&n;&t; * idle the omap.&n;         *&n; &t; * Save interrupt, MPUI, ARM and UPLD control registers.&n;&t; */
r_if
c_cond
(paren
id|cpu_is_omap1510
c_func
(paren
)paren
)paren
(brace
id|MPUI1510_SAVE
c_func
(paren
id|OMAP_IH1_MIR
)paren
suffix:semicolon
id|MPUI1510_SAVE
c_func
(paren
id|OMAP_IH2_MIR
)paren
suffix:semicolon
id|MPUI1510_SAVE
c_func
(paren
id|MPUI_CTRL
)paren
suffix:semicolon
id|MPUI1510_SAVE
c_func
(paren
id|MPUI_DSP_BOOT_CONFIG
)paren
suffix:semicolon
id|MPUI1510_SAVE
c_func
(paren
id|MPUI_DSP_API_CONFIG
)paren
suffix:semicolon
id|MPUI1510_SAVE
c_func
(paren
id|EMIFS_CONFIG
)paren
suffix:semicolon
id|MPUI1510_SAVE
c_func
(paren
id|EMIFF_SDRAM_CONFIG
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cpu_is_omap16xx
c_func
(paren
)paren
)paren
(brace
id|MPUI1610_SAVE
c_func
(paren
id|OMAP_IH1_MIR
)paren
suffix:semicolon
id|MPUI1610_SAVE
c_func
(paren
id|OMAP_IH2_0_MIR
)paren
suffix:semicolon
id|MPUI1610_SAVE
c_func
(paren
id|OMAP_IH2_1_MIR
)paren
suffix:semicolon
id|MPUI1610_SAVE
c_func
(paren
id|OMAP_IH2_2_MIR
)paren
suffix:semicolon
id|MPUI1610_SAVE
c_func
(paren
id|OMAP_IH2_3_MIR
)paren
suffix:semicolon
id|MPUI1610_SAVE
c_func
(paren
id|MPUI_CTRL
)paren
suffix:semicolon
id|MPUI1610_SAVE
c_func
(paren
id|MPUI_DSP_BOOT_CONFIG
)paren
suffix:semicolon
id|MPUI1610_SAVE
c_func
(paren
id|MPUI_DSP_API_CONFIG
)paren
suffix:semicolon
id|MPUI1610_SAVE
c_func
(paren
id|EMIFS_CONFIG
)paren
suffix:semicolon
id|MPUI1610_SAVE
c_func
(paren
id|EMIFF_SDRAM_CONFIG
)paren
suffix:semicolon
)brace
id|ARM_SAVE
c_func
(paren
id|ARM_CKCTL
)paren
suffix:semicolon
id|ARM_SAVE
c_func
(paren
id|ARM_IDLECT1
)paren
suffix:semicolon
id|ARM_SAVE
c_func
(paren
id|ARM_IDLECT2
)paren
suffix:semicolon
id|ARM_SAVE
c_func
(paren
id|ARM_EWUPCT
)paren
suffix:semicolon
id|ARM_SAVE
c_func
(paren
id|ARM_RSTCT1
)paren
suffix:semicolon
id|ARM_SAVE
c_func
(paren
id|ARM_RSTCT2
)paren
suffix:semicolon
id|ARM_SAVE
c_func
(paren
id|ARM_SYSST
)paren
suffix:semicolon
id|ULPD_SAVE
c_func
(paren
id|ULPD_CLOCK_CTRL
)paren
suffix:semicolon
id|ULPD_SAVE
c_func
(paren
id|ULPD_STATUS_REQ
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Step 3: LOW_PWR signal enabling&n;&t; *&n;&t; * Allow the LOW_PWR signal to be visible on MPUIO5 ball.&n;&t; */
r_if
c_cond
(paren
id|cpu_is_omap1510
c_func
(paren
)paren
)paren
(brace
multiline_comment|/* POWER_CTRL_REG = 0x1 (LOW_POWER is available) */
id|omap_writew
c_func
(paren
id|omap_readw
c_func
(paren
id|ULPD_POWER_CTRL
)paren
op_or
id|OMAP1510_ULPD_LOW_POWER_REQ
comma
id|ULPD_POWER_CTRL
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cpu_is_omap16xx
c_func
(paren
)paren
)paren
(brace
multiline_comment|/* POWER_CTRL_REG = 0x1 (LOW_POWER is available) */
id|omap_writew
c_func
(paren
id|omap_readw
c_func
(paren
id|ULPD_POWER_CTRL
)paren
op_or
id|OMAP1610_ULPD_LOW_POWER_REQ
comma
id|ULPD_POWER_CTRL
)paren
suffix:semicolon
)brace
multiline_comment|/* configure LOW_PWR pin */
id|omap_cfg_reg
c_func
(paren
id|T20_1610_LOW_PWR
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Step 4: OMAP DSP Shutdown&n;&t; */
multiline_comment|/* Set DSP_RST = 1 and DSP_EN = 0, put DSP block into reset */
id|omap_writel
c_func
(paren
(paren
id|omap_readl
c_func
(paren
id|ARM_RSTCT1
)paren
op_or
id|DSP_RST
)paren
op_amp
op_complement
id|DSP_ENABLE
comma
id|ARM_RSTCT1
)paren
suffix:semicolon
multiline_comment|/* Set DSP boot mode to DSP-IDLE, DSP_BOOT_MODE = 0x2 */
id|omap_writel
c_func
(paren
id|DSP_IDLE_MODE
comma
id|MPUI_DSP_BOOT_CONFIG
)paren
suffix:semicolon
multiline_comment|/* Set EN_DSPCK = 0, stop DSP block clock */
id|omap_writel
c_func
(paren
id|omap_readl
c_func
(paren
id|ARM_CKCTL
)paren
op_amp
op_complement
id|DSP_CLOCK_ENABLE
comma
id|ARM_CKCTL
)paren
suffix:semicolon
multiline_comment|/* Stop any DSP domain clocks */
id|omap_writel
c_func
(paren
id|omap_readl
c_func
(paren
id|ARM_IDLECT2
)paren
op_or
(paren
l_int|1
op_lshift
id|EN_APICK
)paren
comma
id|ARM_IDLECT2
)paren
suffix:semicolon
id|save_dsp_idlect2
op_assign
id|__raw_readw
c_func
(paren
id|DSP_IDLECT2
)paren
suffix:semicolon
id|__raw_writew
c_func
(paren
l_int|0
comma
id|DSP_IDLECT2
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Step 5: Wakeup Event Setup&n;&t; */
id|omap_pm_wakeup_setup
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Step 6a: ARM and Traffic controller shutdown&n;&t; *&n;&t; * Step 6 starts here with clock and watchdog disable&n;&t; */
multiline_comment|/* stop clocks */
id|mask32
op_assign
id|omap_readl
c_func
(paren
id|ARM_IDLECT2
)paren
suffix:semicolon
id|mask32
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|EN_WDTCK
)paren
suffix:semicolon
multiline_comment|/* bit 0 -&gt; 0 (WDT clock) */
id|mask32
op_or_assign
(paren
l_int|1
op_lshift
id|EN_XORPCK
)paren
suffix:semicolon
multiline_comment|/* bit 1 -&gt; 1 (XORPCK clock) */
id|mask32
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|EN_PERCK
)paren
suffix:semicolon
multiline_comment|/* bit 2 -&gt; 0 (MPUPER_CK clock) */
id|mask32
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|EN_LCDCK
)paren
suffix:semicolon
multiline_comment|/* bit 3 -&gt; 0 (LCDC clock) */
id|mask32
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|EN_LBCK
)paren
suffix:semicolon
multiline_comment|/* bit 4 -&gt; 0 (local bus clock) */
id|mask32
op_or_assign
(paren
l_int|1
op_lshift
id|EN_APICK
)paren
suffix:semicolon
multiline_comment|/* bit 6 -&gt; 1 (MPUI clock) */
id|mask32
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|EN_TIMCK
)paren
suffix:semicolon
multiline_comment|/* bit 7 -&gt; 0 (MPU timer clock) */
id|mask32
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|DMACK_REQ
)paren
suffix:semicolon
multiline_comment|/* bit 8 -&gt; 0 (DMAC clock) */
id|mask32
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|EN_GPIOCK
)paren
suffix:semicolon
multiline_comment|/* bit 9 -&gt; 0 (GPIO clock) */
id|omap_writel
c_func
(paren
id|mask32
comma
id|ARM_IDLECT2
)paren
suffix:semicolon
multiline_comment|/* disable ARM watchdog */
id|omap_writel
c_func
(paren
l_int|0x00F5
comma
id|OMAP_WDT_TIMER_MODE
)paren
suffix:semicolon
id|omap_writel
c_func
(paren
l_int|0x00A0
comma
id|OMAP_WDT_TIMER_MODE
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Step 6b: ARM and Traffic controller shutdown&n;&t; *&n;&t; * Step 6 continues here. Prepare jump to power management&n;&t; * assembly code in internal SRAM.&n;&t; *&n;&t; * Since the omap_cpu_suspend routine has been copied to&n;&t; * SRAM, we&squot;ll do an indirect procedure call to it and pass the&n;&t; * contents of arm_idlect1 and arm_idlect2 so it can restore&n;&t; * them when it wakes up and it will return.&n;&t; */
id|arg0
op_assign
id|arm_sleep_save
(braket
id|ARM_SLEEP_SAVE_ARM_IDLECT1
)braket
suffix:semicolon
id|arg1
op_assign
id|arm_sleep_save
(braket
id|ARM_SLEEP_SAVE_ARM_IDLECT2
)braket
suffix:semicolon
r_if
c_cond
(paren
id|cpu_is_omap1510
c_func
(paren
)paren
)paren
(brace
id|func_ptr
op_assign
(paren
r_void
op_star
)paren
(paren
id|OMAP1510_SRAM_API_SUSPEND
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cpu_is_omap1610
c_func
(paren
)paren
op_logical_or
id|cpu_is_omap1710
c_func
(paren
)paren
)paren
(brace
id|func_ptr
op_assign
(paren
r_void
op_star
)paren
(paren
id|OMAP1610_SRAM_API_SUSPEND
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cpu_is_omap5912
c_func
(paren
)paren
)paren
(brace
id|func_ptr
op_assign
(paren
r_void
op_star
)paren
(paren
id|OMAP5912_SRAM_API_SUSPEND
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Step 6c: ARM and Traffic controller shutdown&n;&t; *&n;&t; * Jump to assembly code. The processor will stay there&n; &t; * until wake up.&n;&t; */
id|func_ptr
c_func
(paren
id|arg0
comma
id|arg1
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * If we are here, processor is woken up!&n;&t; */
r_if
c_cond
(paren
id|cpu_is_omap1510
c_func
(paren
)paren
)paren
(brace
multiline_comment|/* POWER_CTRL_REG = 0x0 (LOW_POWER is disabled) */
id|omap_writew
c_func
(paren
id|omap_readw
c_func
(paren
id|ULPD_POWER_CTRL
)paren
op_amp
op_complement
id|OMAP1510_ULPD_LOW_POWER_REQ
comma
id|ULPD_POWER_CTRL
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cpu_is_omap16xx
c_func
(paren
)paren
)paren
(brace
multiline_comment|/* POWER_CTRL_REG = 0x0 (LOW_POWER is disabled) */
id|omap_writew
c_func
(paren
id|omap_readw
c_func
(paren
id|ULPD_POWER_CTRL
)paren
op_amp
op_complement
id|OMAP1610_ULPD_LOW_POWER_REQ
comma
id|ULPD_POWER_CTRL
)paren
suffix:semicolon
)brace
multiline_comment|/* Restore DSP clocks */
id|omap_writel
c_func
(paren
id|omap_readl
c_func
(paren
id|ARM_IDLECT2
)paren
op_or
(paren
l_int|1
op_lshift
id|EN_APICK
)paren
comma
id|ARM_IDLECT2
)paren
suffix:semicolon
id|__raw_writew
c_func
(paren
id|save_dsp_idlect2
comma
id|DSP_IDLECT2
)paren
suffix:semicolon
id|ARM_RESTORE
c_func
(paren
id|ARM_IDLECT2
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Restore ARM state, except ARM_IDLECT1/2 which omap_cpu_suspend did&n;&t; */
id|ARM_RESTORE
c_func
(paren
id|ARM_CKCTL
)paren
suffix:semicolon
id|ARM_RESTORE
c_func
(paren
id|ARM_EWUPCT
)paren
suffix:semicolon
id|ARM_RESTORE
c_func
(paren
id|ARM_RSTCT1
)paren
suffix:semicolon
id|ARM_RESTORE
c_func
(paren
id|ARM_RSTCT2
)paren
suffix:semicolon
id|ARM_RESTORE
c_func
(paren
id|ARM_SYSST
)paren
suffix:semicolon
id|ULPD_RESTORE
c_func
(paren
id|ULPD_CLOCK_CTRL
)paren
suffix:semicolon
id|ULPD_RESTORE
c_func
(paren
id|ULPD_STATUS_REQ
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpu_is_omap1510
c_func
(paren
)paren
)paren
(brace
id|MPUI1510_RESTORE
c_func
(paren
id|MPUI_CTRL
)paren
suffix:semicolon
id|MPUI1510_RESTORE
c_func
(paren
id|MPUI_DSP_BOOT_CONFIG
)paren
suffix:semicolon
id|MPUI1510_RESTORE
c_func
(paren
id|MPUI_DSP_API_CONFIG
)paren
suffix:semicolon
id|MPUI1510_RESTORE
c_func
(paren
id|EMIFS_CONFIG
)paren
suffix:semicolon
id|MPUI1510_RESTORE
c_func
(paren
id|EMIFF_SDRAM_CONFIG
)paren
suffix:semicolon
id|MPUI1510_RESTORE
c_func
(paren
id|OMAP_IH1_MIR
)paren
suffix:semicolon
id|MPUI1510_RESTORE
c_func
(paren
id|OMAP_IH2_MIR
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cpu_is_omap16xx
c_func
(paren
)paren
)paren
(brace
id|MPUI1610_RESTORE
c_func
(paren
id|MPUI_CTRL
)paren
suffix:semicolon
id|MPUI1610_RESTORE
c_func
(paren
id|MPUI_DSP_BOOT_CONFIG
)paren
suffix:semicolon
id|MPUI1610_RESTORE
c_func
(paren
id|MPUI_DSP_API_CONFIG
)paren
suffix:semicolon
id|MPUI1610_RESTORE
c_func
(paren
id|EMIFS_CONFIG
)paren
suffix:semicolon
id|MPUI1610_RESTORE
c_func
(paren
id|EMIFF_SDRAM_CONFIG
)paren
suffix:semicolon
id|MPUI1610_RESTORE
c_func
(paren
id|OMAP_IH1_MIR
)paren
suffix:semicolon
id|MPUI1610_RESTORE
c_func
(paren
id|OMAP_IH2_0_MIR
)paren
suffix:semicolon
id|MPUI1610_RESTORE
c_func
(paren
id|OMAP_IH2_1_MIR
)paren
suffix:semicolon
id|MPUI1610_RESTORE
c_func
(paren
id|OMAP_IH2_2_MIR
)paren
suffix:semicolon
id|MPUI1610_RESTORE
c_func
(paren
id|OMAP_IH2_3_MIR
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Reenable interrupts&n;&t; */
id|local_irq_enable
c_func
(paren
)paren
suffix:semicolon
id|local_fiq_enable
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;PM: OMAP%x is re-starting from deep sleep...&bslash;n&quot;
comma
id|system_rev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|machine_is_omap_osk
c_func
(paren
)paren
)paren
(brace
multiline_comment|/* Let LED1 (D9) blink again */
id|tps65010_set_led
c_func
(paren
id|LED1
comma
id|BLINK
)paren
suffix:semicolon
)brace
)brace
macro_line|#if defined(DEBUG) &amp;&amp; defined(CONFIG_PROC_FS)
DECL|variable|g_read_completed
r_static
r_int
id|g_read_completed
suffix:semicolon
multiline_comment|/*&n; * Read system PM registers for debugging&n; */
DECL|function|omap_pm_read_proc
r_static
r_int
id|omap_pm_read_proc
c_func
(paren
r_char
op_star
id|page_buffer
comma
r_char
op_star
op_star
id|my_first_byte
comma
id|off_t
id|virtual_start
comma
r_int
id|length
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|my_buffer_offset
op_assign
l_int|0
suffix:semicolon
r_char
op_star
r_const
id|my_base
op_assign
id|page_buffer
suffix:semicolon
id|ARM_SAVE
c_func
(paren
id|ARM_CKCTL
)paren
suffix:semicolon
id|ARM_SAVE
c_func
(paren
id|ARM_IDLECT1
)paren
suffix:semicolon
id|ARM_SAVE
c_func
(paren
id|ARM_IDLECT2
)paren
suffix:semicolon
id|ARM_SAVE
c_func
(paren
id|ARM_EWUPCT
)paren
suffix:semicolon
id|ARM_SAVE
c_func
(paren
id|ARM_RSTCT1
)paren
suffix:semicolon
id|ARM_SAVE
c_func
(paren
id|ARM_RSTCT2
)paren
suffix:semicolon
id|ARM_SAVE
c_func
(paren
id|ARM_SYSST
)paren
suffix:semicolon
id|ULPD_SAVE
c_func
(paren
id|ULPD_IT_STATUS
)paren
suffix:semicolon
id|ULPD_SAVE
c_func
(paren
id|ULPD_CLOCK_CTRL
)paren
suffix:semicolon
id|ULPD_SAVE
c_func
(paren
id|ULPD_SOFT_REQ
)paren
suffix:semicolon
id|ULPD_SAVE
c_func
(paren
id|ULPD_STATUS_REQ
)paren
suffix:semicolon
id|ULPD_SAVE
c_func
(paren
id|ULPD_DPLL_CTRL
)paren
suffix:semicolon
id|ULPD_SAVE
c_func
(paren
id|ULPD_POWER_CTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpu_is_omap1510
c_func
(paren
)paren
)paren
(brace
id|MPUI1510_SAVE
c_func
(paren
id|MPUI_CTRL
)paren
suffix:semicolon
id|MPUI1510_SAVE
c_func
(paren
id|MPUI_DSP_STATUS
)paren
suffix:semicolon
id|MPUI1510_SAVE
c_func
(paren
id|MPUI_DSP_BOOT_CONFIG
)paren
suffix:semicolon
id|MPUI1510_SAVE
c_func
(paren
id|MPUI_DSP_API_CONFIG
)paren
suffix:semicolon
id|MPUI1510_SAVE
c_func
(paren
id|EMIFF_SDRAM_CONFIG
)paren
suffix:semicolon
id|MPUI1510_SAVE
c_func
(paren
id|EMIFS_CONFIG
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cpu_is_omap16xx
c_func
(paren
)paren
)paren
(brace
id|MPUI1610_SAVE
c_func
(paren
id|MPUI_CTRL
)paren
suffix:semicolon
id|MPUI1610_SAVE
c_func
(paren
id|MPUI_DSP_STATUS
)paren
suffix:semicolon
id|MPUI1610_SAVE
c_func
(paren
id|MPUI_DSP_BOOT_CONFIG
)paren
suffix:semicolon
id|MPUI1610_SAVE
c_func
(paren
id|MPUI_DSP_API_CONFIG
)paren
suffix:semicolon
id|MPUI1610_SAVE
c_func
(paren
id|EMIFF_SDRAM_CONFIG
)paren
suffix:semicolon
id|MPUI1610_SAVE
c_func
(paren
id|EMIFS_CONFIG
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|virtual_start
op_eq
l_int|0
)paren
(brace
id|g_read_completed
op_assign
l_int|0
suffix:semicolon
id|my_buffer_offset
op_add_assign
id|sprintf
c_func
(paren
id|my_base
op_plus
id|my_buffer_offset
comma
l_string|&quot;ARM_CKCTL_REG:            0x%-8x     &bslash;n&quot;
l_string|&quot;ARM_IDLECT1_REG:          0x%-8x     &bslash;n&quot;
l_string|&quot;ARM_IDLECT2_REG:          0x%-8x     &bslash;n&quot;
l_string|&quot;ARM_EWUPCT_REG:           0x%-8x     &bslash;n&quot;
l_string|&quot;ARM_RSTCT1_REG:           0x%-8x     &bslash;n&quot;
l_string|&quot;ARM_RSTCT2_REG:           0x%-8x     &bslash;n&quot;
l_string|&quot;ARM_SYSST_REG:            0x%-8x     &bslash;n&quot;
l_string|&quot;ULPD_IT_STATUS_REG:       0x%-4x     &bslash;n&quot;
l_string|&quot;ULPD_CLOCK_CTRL_REG:      0x%-4x     &bslash;n&quot;
l_string|&quot;ULPD_SOFT_REQ_REG:        0x%-4x     &bslash;n&quot;
l_string|&quot;ULPD_DPLL_CTRL_REG:       0x%-4x     &bslash;n&quot;
l_string|&quot;ULPD_STATUS_REQ_REG:      0x%-4x     &bslash;n&quot;
l_string|&quot;ULPD_POWER_CTRL_REG:      0x%-4x     &bslash;n&quot;
comma
id|ARM_SHOW
c_func
(paren
id|ARM_CKCTL
)paren
comma
id|ARM_SHOW
c_func
(paren
id|ARM_IDLECT1
)paren
comma
id|ARM_SHOW
c_func
(paren
id|ARM_IDLECT2
)paren
comma
id|ARM_SHOW
c_func
(paren
id|ARM_EWUPCT
)paren
comma
id|ARM_SHOW
c_func
(paren
id|ARM_RSTCT1
)paren
comma
id|ARM_SHOW
c_func
(paren
id|ARM_RSTCT2
)paren
comma
id|ARM_SHOW
c_func
(paren
id|ARM_SYSST
)paren
comma
id|ULPD_SHOW
c_func
(paren
id|ULPD_IT_STATUS
)paren
comma
id|ULPD_SHOW
c_func
(paren
id|ULPD_CLOCK_CTRL
)paren
comma
id|ULPD_SHOW
c_func
(paren
id|ULPD_SOFT_REQ
)paren
comma
id|ULPD_SHOW
c_func
(paren
id|ULPD_DPLL_CTRL
)paren
comma
id|ULPD_SHOW
c_func
(paren
id|ULPD_STATUS_REQ
)paren
comma
id|ULPD_SHOW
c_func
(paren
id|ULPD_POWER_CTRL
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpu_is_omap1510
c_func
(paren
)paren
)paren
(brace
id|my_buffer_offset
op_add_assign
id|sprintf
c_func
(paren
id|my_base
op_plus
id|my_buffer_offset
comma
l_string|&quot;MPUI1510_CTRL_REG             0x%-8x &bslash;n&quot;
l_string|&quot;MPUI1510_DSP_STATUS_REG:      0x%-8x &bslash;n&quot;
l_string|&quot;MPUI1510_DSP_BOOT_CONFIG_REG: 0x%-8x &bslash;n&quot;
l_string|&quot;MPUI1510_DSP_API_CONFIG_REG:  0x%-8x &bslash;n&quot;
l_string|&quot;MPUI1510_SDRAM_CONFIG_REG:    0x%-8x &bslash;n&quot;
l_string|&quot;MPUI1510_EMIFS_CONFIG_REG:    0x%-8x &bslash;n&quot;
comma
id|MPUI1510_SHOW
c_func
(paren
id|MPUI_CTRL
)paren
comma
id|MPUI1510_SHOW
c_func
(paren
id|MPUI_DSP_STATUS
)paren
comma
id|MPUI1510_SHOW
c_func
(paren
id|MPUI_DSP_BOOT_CONFIG
)paren
comma
id|MPUI1510_SHOW
c_func
(paren
id|MPUI_DSP_API_CONFIG
)paren
comma
id|MPUI1510_SHOW
c_func
(paren
id|EMIFF_SDRAM_CONFIG
)paren
comma
id|MPUI1510_SHOW
c_func
(paren
id|EMIFS_CONFIG
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cpu_is_omap16xx
c_func
(paren
)paren
)paren
(brace
id|my_buffer_offset
op_add_assign
id|sprintf
c_func
(paren
id|my_base
op_plus
id|my_buffer_offset
comma
l_string|&quot;MPUI1610_CTRL_REG             0x%-8x &bslash;n&quot;
l_string|&quot;MPUI1610_DSP_STATUS_REG:      0x%-8x &bslash;n&quot;
l_string|&quot;MPUI1610_DSP_BOOT_CONFIG_REG: 0x%-8x &bslash;n&quot;
l_string|&quot;MPUI1610_DSP_API_CONFIG_REG:  0x%-8x &bslash;n&quot;
l_string|&quot;MPUI1610_SDRAM_CONFIG_REG:    0x%-8x &bslash;n&quot;
l_string|&quot;MPUI1610_EMIFS_CONFIG_REG:    0x%-8x &bslash;n&quot;
comma
id|MPUI1610_SHOW
c_func
(paren
id|MPUI_CTRL
)paren
comma
id|MPUI1610_SHOW
c_func
(paren
id|MPUI_DSP_STATUS
)paren
comma
id|MPUI1610_SHOW
c_func
(paren
id|MPUI_DSP_BOOT_CONFIG
)paren
comma
id|MPUI1610_SHOW
c_func
(paren
id|MPUI_DSP_API_CONFIG
)paren
comma
id|MPUI1610_SHOW
c_func
(paren
id|EMIFF_SDRAM_CONFIG
)paren
comma
id|MPUI1610_SHOW
c_func
(paren
id|EMIFS_CONFIG
)paren
)paren
suffix:semicolon
)brace
id|g_read_completed
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|g_read_completed
op_ge
l_int|1
)paren
(brace
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|g_read_completed
op_increment
suffix:semicolon
op_star
id|my_first_byte
op_assign
id|page_buffer
suffix:semicolon
r_return
id|my_buffer_offset
suffix:semicolon
)brace
DECL|function|omap_pm_init_proc
r_static
r_void
id|omap_pm_init_proc
c_func
(paren
r_void
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|entry
suffix:semicolon
id|entry
op_assign
id|create_proc_read_entry
c_func
(paren
l_string|&quot;driver/omap_pm&quot;
comma
id|S_IWUSR
op_or
id|S_IRUGO
comma
l_int|NULL
comma
id|omap_pm_read_proc
comma
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#endif /* DEBUG &amp;&amp; CONFIG_PROC_FS */
multiline_comment|/*&n; *&t;omap_pm_prepare - Do preliminary suspend work.&n; *&t;@state:&t;&t;suspend state we&squot;re entering.&n; *&n; */
singleline_comment|//#include &lt;asm/arch/hardware.h&gt;
DECL|function|omap_pm_prepare
r_static
r_int
id|omap_pm_prepare
c_func
(paren
id|u32
id|state
)paren
(brace
r_int
id|error
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|state
)paren
(brace
r_case
id|PM_SUSPEND_STANDBY
suffix:colon
r_case
id|PM_SUSPEND_MEM
suffix:colon
r_break
suffix:semicolon
r_case
id|PM_SUSPEND_DISK
suffix:colon
r_return
op_minus
id|ENOTSUPP
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
id|error
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;omap_pm_enter - Actually enter a sleep state.&n; *&t;@state:&t;&t;State we&squot;re entering.&n; *&n; */
DECL|function|omap_pm_enter
r_static
r_int
id|omap_pm_enter
c_func
(paren
id|u32
id|state
)paren
(brace
r_switch
c_cond
(paren
id|state
)paren
(brace
r_case
id|PM_SUSPEND_STANDBY
suffix:colon
r_case
id|PM_SUSPEND_MEM
suffix:colon
id|omap_pm_suspend
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PM_SUSPEND_DISK
suffix:colon
r_return
op_minus
id|ENOTSUPP
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; *&t;omap_pm_finish - Finish up suspend sequence.&n; *&t;@state:&t;&t;State we&squot;re coming out of.&n; *&n; *&t;This is called after we wake back up (or if entering the sleep state&n; *&t;failed).&n; */
DECL|function|omap_pm_finish
r_static
r_int
id|omap_pm_finish
c_func
(paren
id|u32
id|state
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|omap_pm_ops
r_struct
id|pm_ops
id|omap_pm_ops
op_assign
initialization_block
suffix:semicolon
DECL|function|omap_pm_init
r_static
r_int
id|__init
id|omap_pm_init
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Power Management for TI OMAP.&bslash;n&quot;
)paren
suffix:semicolon
id|pm_idle
op_assign
id|omap_pm_idle
suffix:semicolon
multiline_comment|/*&n;&t; * We copy the assembler sleep/wakeup routines to SRAM.&n;&t; * These routines need to be in SRAM as that&squot;s the only&n;&t; * memory the MPU can see when it wakes up.&n;&t; */
macro_line|#ifdef&t;CONFIG_ARCH_OMAP1510
r_if
c_cond
(paren
id|cpu_is_omap1510
c_func
(paren
)paren
)paren
(brace
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|OMAP1510_SRAM_IDLE_SUSPEND
comma
id|omap1510_idle_loop_suspend
comma
id|omap1510_idle_loop_suspend_sz
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|OMAP1510_SRAM_API_SUSPEND
comma
id|omap1510_cpu_suspend
comma
id|omap1510_cpu_suspend_sz
)paren
suffix:semicolon
)brace
r_else
macro_line|#endif
r_if
c_cond
(paren
id|cpu_is_omap1610
c_func
(paren
)paren
op_logical_or
id|cpu_is_omap1710
c_func
(paren
)paren
)paren
(brace
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|OMAP1610_SRAM_IDLE_SUSPEND
comma
id|omap1610_idle_loop_suspend
comma
id|omap1610_idle_loop_suspend_sz
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|OMAP1610_SRAM_API_SUSPEND
comma
id|omap1610_cpu_suspend
comma
id|omap1610_cpu_suspend_sz
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cpu_is_omap5912
c_func
(paren
)paren
)paren
(brace
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|OMAP5912_SRAM_IDLE_SUSPEND
comma
id|omap1610_idle_loop_suspend
comma
id|omap1610_idle_loop_suspend_sz
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|OMAP5912_SRAM_API_SUSPEND
comma
id|omap1610_cpu_suspend
comma
id|omap1610_cpu_suspend_sz
)paren
suffix:semicolon
)brace
id|pm_set_ops
c_func
(paren
op_amp
id|omap_pm_ops
)paren
suffix:semicolon
macro_line|#if defined(DEBUG) &amp;&amp; defined(CONFIG_PROC_FS)
id|omap_pm_init_proc
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|omap_pm_init
id|__initcall
c_func
(paren
id|omap_pm_init
)paren
suffix:semicolon
eof
