multiline_comment|/*&n; * linux/arch/arm/omap/dma.c&n; *&n; * Copyright (C) 2003 Nokia Corporation&n; * Author: Juha Yrj&#xfffd;l&#xfffd; &lt;juha.yrjola@nokia.com&gt;&n; * DMA channel linking for 1610 by Samuel Ortiz &lt;samuel.ortiz@nokia.com&gt;&n; * Graphics DMA and LCD DMA graphics tranformations&n; * by Imre Deak &lt;imre.deak@nokia.com&gt;&n; *&n; * Support functions for the OMAP internal DMA channels.&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License version 2 as&n; * published by the Free Software Foundation.&n; *&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
macro_line|#include &lt;asm/dma.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/arch/tc.h&gt;
DECL|macro|OMAP_DMA_ACTIVE
mdefine_line|#define OMAP_DMA_ACTIVE&t;&t;0x01
DECL|macro|OMAP_DMA_CCR_EN
mdefine_line|#define OMAP_DMA_CCR_EN&t;&t;(1 &lt;&lt; 7)
DECL|macro|OMAP_FUNC_MUX_ARM_BASE
mdefine_line|#define OMAP_FUNC_MUX_ARM_BASE&t;(0xfffe1000 + 0xec)
DECL|variable|enable_1510_mode
r_static
r_int
id|enable_1510_mode
op_assign
l_int|0
suffix:semicolon
DECL|struct|omap_dma_lch
r_struct
id|omap_dma_lch
(brace
DECL|member|next_lch
r_int
id|next_lch
suffix:semicolon
DECL|member|dev_id
r_int
id|dev_id
suffix:semicolon
DECL|member|saved_csr
id|u16
id|saved_csr
suffix:semicolon
DECL|member|enabled_irqs
id|u16
id|enabled_irqs
suffix:semicolon
DECL|member|dev_name
r_const
r_char
op_star
id|dev_name
suffix:semicolon
DECL|member|callback
r_void
(paren
op_star
id|callback
)paren
(paren
r_int
id|lch
comma
id|u16
id|ch_status
comma
r_void
op_star
id|data
)paren
suffix:semicolon
DECL|member|data
r_void
op_star
id|data
suffix:semicolon
DECL|member|flags
r_int
id|flags
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|dma_chan_count
r_static
r_int
id|dma_chan_count
suffix:semicolon
DECL|variable|dma_chan_lock
r_static
id|spinlock_t
id|dma_chan_lock
suffix:semicolon
DECL|variable|dma_chan
r_static
r_struct
id|omap_dma_lch
id|dma_chan
(braket
id|OMAP_LOGICAL_DMA_CH_COUNT
)braket
suffix:semicolon
DECL|variable|dma_irq
r_const
r_static
id|u8
id|dma_irq
(braket
id|OMAP_LOGICAL_DMA_CH_COUNT
)braket
op_assign
(brace
id|INT_DMA_CH0_6
comma
id|INT_DMA_CH1_7
comma
id|INT_DMA_CH2_8
comma
id|INT_DMA_CH3
comma
id|INT_DMA_CH4
comma
id|INT_DMA_CH5
comma
id|INT_1610_DMA_CH6
comma
id|INT_1610_DMA_CH7
comma
id|INT_1610_DMA_CH8
comma
id|INT_1610_DMA_CH9
comma
id|INT_1610_DMA_CH10
comma
id|INT_1610_DMA_CH11
comma
id|INT_1610_DMA_CH12
comma
id|INT_1610_DMA_CH13
comma
id|INT_1610_DMA_CH14
comma
id|INT_1610_DMA_CH15
comma
id|INT_DMA_LCD
)brace
suffix:semicolon
DECL|function|get_gdma_dev
r_static
r_inline
r_int
id|get_gdma_dev
c_func
(paren
r_int
id|req
)paren
(brace
id|u32
id|reg
op_assign
id|OMAP_FUNC_MUX_ARM_BASE
op_plus
(paren
(paren
id|req
op_minus
l_int|1
)paren
op_div
l_int|5
)paren
op_star
l_int|4
suffix:semicolon
r_int
id|shift
op_assign
(paren
(paren
id|req
op_minus
l_int|1
)paren
op_mod
l_int|5
)paren
op_star
l_int|6
suffix:semicolon
r_return
(paren
(paren
id|omap_readl
c_func
(paren
id|reg
)paren
op_rshift
id|shift
)paren
op_amp
l_int|0x3f
)paren
op_plus
l_int|1
suffix:semicolon
)brace
DECL|function|set_gdma_dev
r_static
r_inline
r_void
id|set_gdma_dev
c_func
(paren
r_int
id|req
comma
r_int
id|dev
)paren
(brace
id|u32
id|reg
op_assign
id|OMAP_FUNC_MUX_ARM_BASE
op_plus
(paren
(paren
id|req
op_minus
l_int|1
)paren
op_div
l_int|5
)paren
op_star
l_int|4
suffix:semicolon
r_int
id|shift
op_assign
(paren
(paren
id|req
op_minus
l_int|1
)paren
op_mod
l_int|5
)paren
op_star
l_int|6
suffix:semicolon
id|u32
id|l
suffix:semicolon
id|l
op_assign
id|omap_readl
c_func
(paren
id|reg
)paren
suffix:semicolon
id|l
op_and_assign
op_complement
(paren
l_int|0x3f
op_lshift
id|shift
)paren
suffix:semicolon
id|l
op_or_assign
(paren
id|dev
op_minus
l_int|1
)paren
op_lshift
id|shift
suffix:semicolon
id|omap_writel
c_func
(paren
id|l
comma
id|reg
)paren
suffix:semicolon
)brace
DECL|function|clear_lch_regs
r_static
r_void
id|clear_lch_regs
c_func
(paren
r_int
id|lch
)paren
(brace
r_int
id|i
suffix:semicolon
id|u32
id|lch_base
op_assign
id|OMAP_DMA_BASE
op_plus
id|lch
op_star
l_int|0x40
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x2c
suffix:semicolon
id|i
op_add_assign
l_int|2
)paren
id|omap_writew
c_func
(paren
l_int|0
comma
id|lch_base
op_plus
id|i
)paren
suffix:semicolon
)brace
DECL|function|omap_set_dma_priority
r_void
id|omap_set_dma_priority
c_func
(paren
r_int
id|dst_port
comma
r_int
id|priority
)paren
(brace
r_int
r_int
id|reg
suffix:semicolon
id|u32
id|l
suffix:semicolon
r_switch
c_cond
(paren
id|dst_port
)paren
(brace
r_case
id|OMAP_DMA_PORT_OCP_T1
suffix:colon
multiline_comment|/* FFFECC00 */
id|reg
op_assign
id|OMAP_TC_OCPT1_PRIOR
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OMAP_DMA_PORT_OCP_T2
suffix:colon
multiline_comment|/* FFFECCD0 */
id|reg
op_assign
id|OMAP_TC_OCPT2_PRIOR
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OMAP_DMA_PORT_EMIFF
suffix:colon
multiline_comment|/* FFFECC08 */
id|reg
op_assign
id|OMAP_TC_EMIFF_PRIOR
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OMAP_DMA_PORT_EMIFS
suffix:colon
multiline_comment|/* FFFECC04 */
id|reg
op_assign
id|OMAP_TC_EMIFS_PRIOR
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|l
op_assign
id|omap_readl
c_func
(paren
id|reg
)paren
suffix:semicolon
id|l
op_and_assign
op_complement
(paren
l_int|0xf
op_lshift
l_int|8
)paren
suffix:semicolon
id|l
op_or_assign
(paren
id|priority
op_amp
l_int|0xf
)paren
op_lshift
l_int|8
suffix:semicolon
id|omap_writel
c_func
(paren
id|l
comma
id|reg
)paren
suffix:semicolon
)brace
DECL|function|omap_set_dma_transfer_params
r_void
id|omap_set_dma_transfer_params
c_func
(paren
r_int
id|lch
comma
r_int
id|data_type
comma
r_int
id|elem_count
comma
r_int
id|frame_count
comma
r_int
id|sync_mode
)paren
(brace
id|u16
id|w
suffix:semicolon
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP_DMA_CSDP
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|w
op_and_assign
op_complement
l_int|0x03
suffix:semicolon
id|w
op_or_assign
id|data_type
suffix:semicolon
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP_DMA_CSDP
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP_DMA_CCR
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|w
op_and_assign
op_complement
(paren
l_int|1
op_lshift
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sync_mode
op_eq
id|OMAP_DMA_SYNC_FRAME
)paren
id|w
op_or_assign
l_int|1
op_lshift
l_int|5
suffix:semicolon
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP_DMA_CCR
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP_DMA_CCR2
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|w
op_and_assign
op_complement
(paren
l_int|1
op_lshift
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sync_mode
op_eq
id|OMAP_DMA_SYNC_BLOCK
)paren
id|w
op_or_assign
l_int|1
op_lshift
l_int|2
suffix:semicolon
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP_DMA_CCR2
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|elem_count
comma
id|OMAP_DMA_CEN
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|frame_count
comma
id|OMAP_DMA_CFN
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
)brace
DECL|function|omap_set_dma_color_mode
r_void
id|omap_set_dma_color_mode
c_func
(paren
r_int
id|lch
comma
r_enum
id|omap_dma_color_mode
id|mode
comma
id|u32
id|color
)paren
(brace
id|u16
id|w
suffix:semicolon
id|BUG_ON
c_func
(paren
id|omap_dma_in_1510_mode
c_func
(paren
)paren
)paren
suffix:semicolon
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP_DMA_CCR2
c_func
(paren
id|lch
)paren
)paren
op_amp
op_complement
l_int|0x03
suffix:semicolon
r_switch
c_cond
(paren
id|mode
)paren
(brace
r_case
id|OMAP_DMA_CONSTANT_FILL
suffix:colon
id|w
op_or_assign
l_int|0x01
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OMAP_DMA_TRANSPARENT_COPY
suffix:colon
id|w
op_or_assign
l_int|0x02
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OMAP_DMA_COLOR_DIS
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP_DMA_CCR2
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP_DMA_LCH_CTRL
c_func
(paren
id|lch
)paren
)paren
op_amp
op_complement
l_int|0x0f
suffix:semicolon
multiline_comment|/* Default is channel type 2D */
r_if
c_cond
(paren
id|mode
)paren
(brace
id|omap_writew
c_func
(paren
(paren
id|u16
)paren
id|color
comma
id|OMAP_DMA_COLOR_L
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
(paren
id|u16
)paren
(paren
id|color
op_rshift
l_int|16
)paren
comma
id|OMAP_DMA_COLOR_U
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|w
op_or_assign
l_int|1
suffix:semicolon
multiline_comment|/* Channel type G */
)brace
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP_DMA_LCH_CTRL
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
)brace
DECL|function|omap_set_dma_src_params
r_void
id|omap_set_dma_src_params
c_func
(paren
r_int
id|lch
comma
r_int
id|src_port
comma
r_int
id|src_amode
comma
r_int
r_int
id|src_start
)paren
(brace
id|u16
id|w
suffix:semicolon
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP_DMA_CSDP
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|w
op_and_assign
op_complement
(paren
l_int|0x1f
op_lshift
l_int|2
)paren
suffix:semicolon
id|w
op_or_assign
id|src_port
op_lshift
l_int|2
suffix:semicolon
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP_DMA_CSDP
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP_DMA_CCR
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|w
op_and_assign
op_complement
(paren
l_int|0x03
op_lshift
l_int|12
)paren
suffix:semicolon
id|w
op_or_assign
id|src_amode
op_lshift
l_int|12
suffix:semicolon
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP_DMA_CCR
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|src_start
op_rshift
l_int|16
comma
id|OMAP_DMA_CSSA_U
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|src_start
comma
id|OMAP_DMA_CSSA_L
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
)brace
DECL|function|omap_set_dma_src_index
r_void
id|omap_set_dma_src_index
c_func
(paren
r_int
id|lch
comma
r_int
id|eidx
comma
r_int
id|fidx
)paren
(brace
id|omap_writew
c_func
(paren
id|eidx
comma
id|OMAP_DMA_CSEI
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|fidx
comma
id|OMAP_DMA_CSFI
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
)brace
DECL|function|omap_set_dma_src_data_pack
r_void
id|omap_set_dma_src_data_pack
c_func
(paren
r_int
id|lch
comma
r_int
id|enable
)paren
(brace
id|u16
id|w
suffix:semicolon
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP_DMA_CSDP
c_func
(paren
id|lch
)paren
)paren
op_amp
op_complement
(paren
l_int|1
op_lshift
l_int|6
)paren
suffix:semicolon
id|w
op_or_assign
id|enable
ques
c_cond
(paren
l_int|1
op_lshift
l_int|6
)paren
suffix:colon
l_int|0
suffix:semicolon
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP_DMA_CSDP
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
)brace
DECL|function|omap_set_dma_src_burst_mode
r_void
id|omap_set_dma_src_burst_mode
c_func
(paren
r_int
id|lch
comma
r_enum
id|omap_dma_burst_mode
id|burst_mode
)paren
(brace
id|u16
id|w
suffix:semicolon
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP_DMA_CSDP
c_func
(paren
id|lch
)paren
)paren
op_amp
op_complement
(paren
l_int|0x03
op_lshift
l_int|7
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|burst_mode
)paren
(brace
r_case
id|OMAP_DMA_DATA_BURST_DIS
suffix:colon
r_break
suffix:semicolon
r_case
id|OMAP_DMA_DATA_BURST_4
suffix:colon
id|w
op_or_assign
(paren
l_int|0x01
op_lshift
l_int|7
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OMAP_DMA_DATA_BURST_8
suffix:colon
multiline_comment|/* not supported by current hardware&n;&t;&t; * w |= (0x03 &lt;&lt; 7);&n;&t;&t; * fall through&n;&t;&t; */
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP_DMA_CSDP
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
)brace
DECL|function|omap_set_dma_dest_params
r_void
id|omap_set_dma_dest_params
c_func
(paren
r_int
id|lch
comma
r_int
id|dest_port
comma
r_int
id|dest_amode
comma
r_int
r_int
id|dest_start
)paren
(brace
id|u16
id|w
suffix:semicolon
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP_DMA_CSDP
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|w
op_and_assign
op_complement
(paren
l_int|0x1f
op_lshift
l_int|9
)paren
suffix:semicolon
id|w
op_or_assign
id|dest_port
op_lshift
l_int|9
suffix:semicolon
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP_DMA_CSDP
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP_DMA_CCR
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|w
op_and_assign
op_complement
(paren
l_int|0x03
op_lshift
l_int|14
)paren
suffix:semicolon
id|w
op_or_assign
id|dest_amode
op_lshift
l_int|14
suffix:semicolon
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP_DMA_CCR
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|dest_start
op_rshift
l_int|16
comma
id|OMAP_DMA_CDSA_U
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|dest_start
comma
id|OMAP_DMA_CDSA_L
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
)brace
DECL|function|omap_set_dma_dest_index
r_void
id|omap_set_dma_dest_index
c_func
(paren
r_int
id|lch
comma
r_int
id|eidx
comma
r_int
id|fidx
)paren
(brace
id|omap_writew
c_func
(paren
id|eidx
comma
id|OMAP_DMA_CDEI
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|fidx
comma
id|OMAP_DMA_CDFI
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
)brace
DECL|function|omap_set_dma_dest_data_pack
r_void
id|omap_set_dma_dest_data_pack
c_func
(paren
r_int
id|lch
comma
r_int
id|enable
)paren
(brace
id|u16
id|w
suffix:semicolon
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP_DMA_CSDP
c_func
(paren
id|lch
)paren
)paren
op_amp
op_complement
(paren
l_int|1
op_lshift
l_int|13
)paren
suffix:semicolon
id|w
op_or_assign
id|enable
ques
c_cond
(paren
l_int|1
op_lshift
l_int|13
)paren
suffix:colon
l_int|0
suffix:semicolon
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP_DMA_CSDP
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
)brace
DECL|function|omap_set_dma_dest_burst_mode
r_void
id|omap_set_dma_dest_burst_mode
c_func
(paren
r_int
id|lch
comma
r_enum
id|omap_dma_burst_mode
id|burst_mode
)paren
(brace
id|u16
id|w
suffix:semicolon
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP_DMA_CSDP
c_func
(paren
id|lch
)paren
)paren
op_amp
op_complement
(paren
l_int|0x03
op_lshift
l_int|14
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|burst_mode
)paren
(brace
r_case
id|OMAP_DMA_DATA_BURST_DIS
suffix:colon
r_break
suffix:semicolon
r_case
id|OMAP_DMA_DATA_BURST_4
suffix:colon
id|w
op_or_assign
(paren
l_int|0x01
op_lshift
l_int|14
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OMAP_DMA_DATA_BURST_8
suffix:colon
id|w
op_or_assign
(paren
l_int|0x03
op_lshift
l_int|14
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Invalid DMA burst mode&bslash;n&quot;
)paren
suffix:semicolon
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP_DMA_CSDP
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
)brace
DECL|function|init_intr
r_static
r_inline
r_void
id|init_intr
c_func
(paren
r_int
id|lch
)paren
(brace
id|u16
id|w
suffix:semicolon
multiline_comment|/* Read CSR to make sure it&squot;s cleared. */
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP_DMA_CSR
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
multiline_comment|/* Enable some nice interrupts. */
id|omap_writew
c_func
(paren
id|dma_chan
(braket
id|lch
)braket
dot
id|enabled_irqs
comma
id|OMAP_DMA_CICR
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|dma_chan
(braket
id|lch
)braket
dot
id|flags
op_or_assign
id|OMAP_DMA_ACTIVE
suffix:semicolon
)brace
DECL|function|enable_lnk
r_static
r_inline
r_void
id|enable_lnk
c_func
(paren
r_int
id|lch
)paren
(brace
id|u16
id|w
suffix:semicolon
multiline_comment|/* Clear the STOP_LNK bits */
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP_DMA_CLNK_CTRL
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|w
op_and_assign
op_complement
(paren
l_int|1
op_lshift
l_int|14
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP_DMA_CLNK_CTRL
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
multiline_comment|/* And set the ENABLE_LNK bits */
r_if
c_cond
(paren
id|dma_chan
(braket
id|lch
)braket
dot
id|next_lch
op_ne
op_minus
l_int|1
)paren
id|omap_writew
c_func
(paren
id|dma_chan
(braket
id|lch
)braket
dot
id|next_lch
op_or
(paren
l_int|1
op_lshift
l_int|15
)paren
comma
id|OMAP_DMA_CLNK_CTRL
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
)brace
DECL|function|disable_lnk
r_static
r_inline
r_void
id|disable_lnk
c_func
(paren
r_int
id|lch
)paren
(brace
id|u16
id|w
suffix:semicolon
multiline_comment|/* Disable interrupts */
id|omap_writew
c_func
(paren
l_int|0
comma
id|OMAP_DMA_CICR
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
multiline_comment|/* Set the STOP_LNK bit */
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP_DMA_CLNK_CTRL
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|w
op_or_assign
(paren
l_int|1
op_lshift
l_int|14
)paren
suffix:semicolon
id|w
op_assign
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP_DMA_CLNK_CTRL
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|dma_chan
(braket
id|lch
)braket
dot
id|flags
op_and_assign
op_complement
id|OMAP_DMA_ACTIVE
suffix:semicolon
)brace
DECL|function|omap_start_dma
r_void
id|omap_start_dma
c_func
(paren
r_int
id|lch
)paren
(brace
id|u16
id|w
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|omap_dma_in_1510_mode
c_func
(paren
)paren
op_logical_and
id|dma_chan
(braket
id|lch
)braket
dot
id|next_lch
op_ne
op_minus
l_int|1
)paren
(brace
r_int
id|next_lch
comma
id|cur_lch
suffix:semicolon
r_char
id|dma_chan_link_map
(braket
id|OMAP_LOGICAL_DMA_CH_COUNT
)braket
suffix:semicolon
id|dma_chan_link_map
(braket
id|lch
)braket
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Set the link register of the first channel */
id|enable_lnk
c_func
(paren
id|lch
)paren
suffix:semicolon
id|memset
c_func
(paren
id|dma_chan_link_map
comma
l_int|0
comma
r_sizeof
(paren
id|dma_chan_link_map
)paren
)paren
suffix:semicolon
id|cur_lch
op_assign
id|dma_chan
(braket
id|lch
)braket
dot
id|next_lch
suffix:semicolon
r_do
(brace
id|next_lch
op_assign
id|dma_chan
(braket
id|cur_lch
)braket
dot
id|next_lch
suffix:semicolon
multiline_comment|/* The loop case: we&squot;ve been here already */
r_if
c_cond
(paren
id|dma_chan_link_map
(braket
id|cur_lch
)braket
)paren
r_break
suffix:semicolon
multiline_comment|/* Mark the current channel */
id|dma_chan_link_map
(braket
id|cur_lch
)braket
op_assign
l_int|1
suffix:semicolon
id|enable_lnk
c_func
(paren
id|cur_lch
)paren
suffix:semicolon
id|init_intr
c_func
(paren
id|cur_lch
)paren
suffix:semicolon
id|cur_lch
op_assign
id|next_lch
suffix:semicolon
)brace
r_while
c_loop
(paren
id|next_lch
op_ne
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|init_intr
c_func
(paren
id|lch
)paren
suffix:semicolon
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP_DMA_CCR
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|w
op_or_assign
id|OMAP_DMA_CCR_EN
suffix:semicolon
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP_DMA_CCR
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|dma_chan
(braket
id|lch
)braket
dot
id|flags
op_or_assign
id|OMAP_DMA_ACTIVE
suffix:semicolon
)brace
DECL|function|omap_stop_dma
r_void
id|omap_stop_dma
c_func
(paren
r_int
id|lch
)paren
(brace
id|u16
id|w
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|omap_dma_in_1510_mode
c_func
(paren
)paren
op_logical_and
id|dma_chan
(braket
id|lch
)braket
dot
id|next_lch
op_ne
op_minus
l_int|1
)paren
(brace
r_int
id|next_lch
comma
id|cur_lch
op_assign
id|lch
suffix:semicolon
r_char
id|dma_chan_link_map
(braket
id|OMAP_LOGICAL_DMA_CH_COUNT
)braket
suffix:semicolon
id|memset
c_func
(paren
id|dma_chan_link_map
comma
l_int|0
comma
r_sizeof
(paren
id|dma_chan_link_map
)paren
)paren
suffix:semicolon
r_do
(brace
multiline_comment|/* The loop case: we&squot;ve been here already */
r_if
c_cond
(paren
id|dma_chan_link_map
(braket
id|cur_lch
)braket
)paren
r_break
suffix:semicolon
multiline_comment|/* Mark the current channel */
id|dma_chan_link_map
(braket
id|cur_lch
)braket
op_assign
l_int|1
suffix:semicolon
id|disable_lnk
c_func
(paren
id|cur_lch
)paren
suffix:semicolon
id|next_lch
op_assign
id|dma_chan
(braket
id|cur_lch
)braket
dot
id|next_lch
suffix:semicolon
id|cur_lch
op_assign
id|next_lch
suffix:semicolon
)brace
r_while
c_loop
(paren
id|next_lch
op_ne
op_minus
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Disable all interrupts on the channel */
id|omap_writew
c_func
(paren
l_int|0
comma
id|OMAP_DMA_CICR
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP_DMA_CCR
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|w
op_and_assign
op_complement
id|OMAP_DMA_CCR_EN
suffix:semicolon
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP_DMA_CCR
c_func
(paren
id|lch
)paren
)paren
suffix:semicolon
id|dma_chan
(braket
id|lch
)braket
dot
id|flags
op_and_assign
op_complement
id|OMAP_DMA_ACTIVE
suffix:semicolon
)brace
DECL|function|omap_enable_dma_irq
r_void
id|omap_enable_dma_irq
c_func
(paren
r_int
id|lch
comma
id|u16
id|bits
)paren
(brace
id|dma_chan
(braket
id|lch
)braket
dot
id|enabled_irqs
op_or_assign
id|bits
suffix:semicolon
)brace
DECL|function|omap_disable_dma_irq
r_void
id|omap_disable_dma_irq
c_func
(paren
r_int
id|lch
comma
id|u16
id|bits
)paren
(brace
id|dma_chan
(braket
id|lch
)braket
dot
id|enabled_irqs
op_and_assign
op_complement
id|bits
suffix:semicolon
)brace
DECL|function|dma_handle_ch
r_static
r_int
id|dma_handle_ch
c_func
(paren
r_int
id|ch
)paren
(brace
id|u16
id|csr
suffix:semicolon
r_if
c_cond
(paren
id|enable_1510_mode
op_logical_and
id|ch
op_ge
l_int|6
)paren
(brace
id|csr
op_assign
id|dma_chan
(braket
id|ch
)braket
dot
id|saved_csr
suffix:semicolon
id|dma_chan
(braket
id|ch
)braket
dot
id|saved_csr
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|csr
op_assign
id|omap_readw
c_func
(paren
id|OMAP_DMA_CSR
c_func
(paren
id|ch
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enable_1510_mode
op_logical_and
id|ch
op_le
l_int|2
op_logical_and
(paren
id|csr
op_rshift
l_int|7
)paren
op_ne
l_int|0
)paren
(brace
id|dma_chan
(braket
id|ch
op_plus
l_int|6
)braket
dot
id|saved_csr
op_assign
id|csr
op_rshift
l_int|7
suffix:semicolon
id|csr
op_and_assign
l_int|0x7f
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|csr
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|dma_chan
(braket
id|ch
)braket
dot
id|dev_id
op_eq
op_minus
l_int|1
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Spurious interrupt from DMA channel %d (CSR %04x)&bslash;n&quot;
comma
id|ch
comma
id|csr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|csr
op_amp
id|OMAP_DMA_TOUT_IRQ
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;DMA timeout with device %d&bslash;n&quot;
comma
id|dma_chan
(braket
id|ch
)braket
dot
id|dev_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|csr
op_amp
id|OMAP_DMA_DROP_IRQ
)paren
)paren
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;DMA synchronization event drop occurred with device %d&bslash;n&quot;
comma
id|dma_chan
(braket
id|ch
)braket
dot
id|dev_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|csr
op_amp
id|OMAP_DMA_BLOCK_IRQ
)paren
)paren
id|dma_chan
(braket
id|ch
)braket
dot
id|flags
op_and_assign
op_complement
id|OMAP_DMA_ACTIVE
suffix:semicolon
r_if
c_cond
(paren
id|likely
c_func
(paren
id|dma_chan
(braket
id|ch
)braket
dot
id|callback
op_ne
l_int|NULL
)paren
)paren
id|dma_chan
(braket
id|ch
)braket
dot
id|callback
c_func
(paren
id|ch
comma
id|csr
comma
id|dma_chan
(braket
id|ch
)braket
dot
id|data
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|dma_irq_handler
r_static
id|irqreturn_t
id|dma_irq_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|ch
op_assign
(paren
(paren
r_int
)paren
id|dev_id
)paren
op_minus
l_int|1
suffix:semicolon
r_int
id|handled
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_int
id|handled_now
op_assign
l_int|0
suffix:semicolon
id|handled_now
op_add_assign
id|dma_handle_ch
c_func
(paren
id|ch
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enable_1510_mode
op_logical_and
id|dma_chan
(braket
id|ch
op_plus
l_int|6
)braket
dot
id|saved_csr
)paren
id|handled_now
op_add_assign
id|dma_handle_ch
c_func
(paren
id|ch
op_plus
l_int|6
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|handled_now
)paren
r_break
suffix:semicolon
id|handled
op_add_assign
id|handled_now
suffix:semicolon
)brace
r_return
id|handled
ques
c_cond
id|IRQ_HANDLED
suffix:colon
id|IRQ_NONE
suffix:semicolon
)brace
DECL|function|omap_request_dma
r_int
id|omap_request_dma
c_func
(paren
r_int
id|dev_id
comma
r_const
r_char
op_star
id|dev_name
comma
r_void
(paren
op_star
id|callback
)paren
(paren
r_int
id|lch
comma
id|u16
id|ch_status
comma
r_void
op_star
id|data
)paren
comma
r_void
op_star
id|data
comma
r_int
op_star
id|dma_ch_out
)paren
(brace
r_int
id|ch
comma
id|free_ch
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|omap_dma_lch
op_star
id|chan
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|dma_chan_lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
id|dma_chan_count
suffix:semicolon
id|ch
op_increment
)paren
(brace
r_if
c_cond
(paren
id|free_ch
op_eq
op_minus
l_int|1
op_logical_and
id|dma_chan
(braket
id|ch
)braket
dot
id|dev_id
op_eq
op_minus
l_int|1
)paren
(brace
id|free_ch
op_assign
id|ch
suffix:semicolon
r_if
c_cond
(paren
id|dev_id
op_eq
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev_id
op_ne
l_int|0
op_logical_and
id|dma_chan
(braket
id|ch
)braket
dot
id|dev_id
op_eq
id|dev_id
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dma_chan_lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EAGAIN
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|free_ch
op_eq
op_minus
l_int|1
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dma_chan_lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|chan
op_assign
id|dma_chan
op_plus
id|free_ch
suffix:semicolon
id|chan-&gt;dev_id
op_assign
id|dev_id
suffix:semicolon
id|clear_lch_regs
c_func
(paren
id|free_ch
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dma_chan_lock
comma
id|flags
)paren
suffix:semicolon
id|chan-&gt;dev_id
op_assign
id|dev_id
suffix:semicolon
id|chan-&gt;dev_name
op_assign
id|dev_name
suffix:semicolon
id|chan-&gt;callback
op_assign
id|callback
suffix:semicolon
id|chan-&gt;data
op_assign
id|data
suffix:semicolon
id|chan-&gt;enabled_irqs
op_assign
id|OMAP_DMA_TOUT_IRQ
op_or
id|OMAP_DMA_DROP_IRQ
op_or
id|OMAP_DMA_BLOCK_IRQ
suffix:semicolon
r_if
c_cond
(paren
id|cpu_is_omap16xx
c_func
(paren
)paren
op_logical_or
id|cpu_is_omap730
c_func
(paren
)paren
)paren
(brace
multiline_comment|/* If the sync device is set, configure it dynamically. */
r_if
c_cond
(paren
id|dev_id
op_ne
l_int|0
)paren
(brace
id|set_gdma_dev
c_func
(paren
id|free_ch
op_plus
l_int|1
comma
id|dev_id
)paren
suffix:semicolon
id|dev_id
op_assign
id|free_ch
op_plus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Disable the 1510 compatibility mode and set the sync device&n;&t;&t; * id. */
id|omap_writew
c_func
(paren
id|dev_id
op_or
(paren
l_int|1
op_lshift
l_int|10
)paren
comma
id|OMAP_DMA_CCR
c_func
(paren
id|free_ch
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|omap_writew
c_func
(paren
id|dev_id
comma
id|OMAP_DMA_CCR
c_func
(paren
id|free_ch
)paren
)paren
suffix:semicolon
)brace
op_star
id|dma_ch_out
op_assign
id|free_ch
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|omap_free_dma
r_void
id|omap_free_dma
c_func
(paren
r_int
id|ch
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|dma_chan_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dma_chan
(braket
id|ch
)braket
dot
id|dev_id
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;omap_dma: trying to free nonallocated DMA channel %d&bslash;n&quot;
comma
id|ch
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dma_chan_lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|dma_chan
(braket
id|ch
)braket
dot
id|dev_id
op_assign
op_minus
l_int|1
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|dma_chan_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* Disable all DMA interrupts for the channel. */
id|omap_writew
c_func
(paren
l_int|0
comma
id|OMAP_DMA_CICR
c_func
(paren
id|ch
)paren
)paren
suffix:semicolon
multiline_comment|/* Make sure the DMA transfer is stopped. */
id|omap_writew
c_func
(paren
l_int|0
comma
id|OMAP_DMA_CCR
c_func
(paren
id|ch
)paren
)paren
suffix:semicolon
)brace
DECL|function|omap_dma_in_1510_mode
r_int
id|omap_dma_in_1510_mode
c_func
(paren
r_void
)paren
(brace
r_return
id|enable_1510_mode
suffix:semicolon
)brace
multiline_comment|/*&n; * lch_queue DMA will start right after lch_head one is finished.&n; * For this DMA link to start, you still need to start (see omap_start_dma)&n; * the first one. That will fire up the entire queue.&n; */
DECL|function|omap_dma_link_lch
r_void
id|omap_dma_link_lch
(paren
r_int
id|lch_head
comma
r_int
id|lch_queue
)paren
(brace
r_if
c_cond
(paren
id|omap_dma_in_1510_mode
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;DMA linking is not supported in 1510 mode&bslash;n&quot;
)paren
suffix:semicolon
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dma_chan
(braket
id|lch_head
)braket
dot
id|dev_id
op_eq
op_minus
l_int|1
)paren
op_logical_or
(paren
id|dma_chan
(braket
id|lch_queue
)braket
dot
id|dev_id
op_eq
op_minus
l_int|1
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;omap_dma: trying to link non requested channels&bslash;n&quot;
)paren
suffix:semicolon
id|dump_stack
c_func
(paren
)paren
suffix:semicolon
)brace
id|dma_chan
(braket
id|lch_head
)braket
dot
id|next_lch
op_assign
id|lch_queue
suffix:semicolon
)brace
multiline_comment|/*&n; * Once the DMA queue is stopped, we can destroy it.&n; */
DECL|function|omap_dma_unlink_lch
r_void
id|omap_dma_unlink_lch
(paren
r_int
id|lch_head
comma
r_int
id|lch_queue
)paren
(brace
r_if
c_cond
(paren
id|omap_dma_in_1510_mode
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;DMA linking is not supported in 1510 mode&bslash;n&quot;
)paren
suffix:semicolon
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dma_chan
(braket
id|lch_head
)braket
dot
id|next_lch
op_ne
id|lch_queue
op_logical_or
id|dma_chan
(braket
id|lch_head
)braket
dot
id|next_lch
op_eq
op_minus
l_int|1
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;omap_dma: trying to unlink non linked channels&bslash;n&quot;
)paren
suffix:semicolon
id|dump_stack
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|dma_chan
(braket
id|lch_head
)braket
dot
id|flags
op_amp
id|OMAP_DMA_ACTIVE
)paren
op_logical_or
(paren
id|dma_chan
(braket
id|lch_head
)braket
dot
id|flags
op_amp
id|OMAP_DMA_ACTIVE
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;omap_dma: You need to stop the DMA channels before unlinking&bslash;n&quot;
)paren
suffix:semicolon
id|dump_stack
c_func
(paren
)paren
suffix:semicolon
)brace
id|dma_chan
(braket
id|lch_head
)braket
dot
id|next_lch
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
DECL|struct|lcd_dma_info
r_static
r_struct
id|lcd_dma_info
(brace
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|reserved
r_int
id|reserved
suffix:semicolon
DECL|member|callback
r_void
(paren
op_star
id|callback
)paren
(paren
id|u16
id|status
comma
r_void
op_star
id|data
)paren
suffix:semicolon
DECL|member|cb_data
r_void
op_star
id|cb_data
suffix:semicolon
DECL|member|active
r_int
id|active
suffix:semicolon
DECL|member|addr
DECL|member|size
r_int
r_int
id|addr
comma
id|size
suffix:semicolon
DECL|member|rotate
DECL|member|data_type
DECL|member|xres
DECL|member|yres
r_int
id|rotate
comma
id|data_type
comma
id|xres
comma
id|yres
suffix:semicolon
DECL|member|vxres
r_int
id|vxres
suffix:semicolon
DECL|member|mirror
r_int
id|mirror
suffix:semicolon
DECL|member|xscale
DECL|member|yscale
r_int
id|xscale
comma
id|yscale
suffix:semicolon
DECL|member|ext_ctrl
r_int
id|ext_ctrl
suffix:semicolon
DECL|member|src_port
r_int
id|src_port
suffix:semicolon
DECL|member|single_transfer
r_int
id|single_transfer
suffix:semicolon
DECL|variable|lcd_dma
)brace
id|lcd_dma
suffix:semicolon
DECL|function|omap_set_lcd_dma_b1
r_void
id|omap_set_lcd_dma_b1
c_func
(paren
r_int
r_int
id|addr
comma
id|u16
id|fb_xres
comma
id|u16
id|fb_yres
comma
r_int
id|data_type
)paren
(brace
id|lcd_dma.addr
op_assign
id|addr
suffix:semicolon
id|lcd_dma.data_type
op_assign
id|data_type
suffix:semicolon
id|lcd_dma.xres
op_assign
id|fb_xres
suffix:semicolon
id|lcd_dma.yres
op_assign
id|fb_yres
suffix:semicolon
)brace
DECL|function|omap_set_lcd_dma_src_port
r_void
id|omap_set_lcd_dma_src_port
c_func
(paren
r_int
id|port
)paren
(brace
id|lcd_dma.src_port
op_assign
id|port
suffix:semicolon
)brace
DECL|function|omap_set_lcd_dma_ext_controller
r_void
id|omap_set_lcd_dma_ext_controller
c_func
(paren
r_int
id|external
)paren
(brace
id|lcd_dma.ext_ctrl
op_assign
id|external
suffix:semicolon
)brace
DECL|function|omap_set_lcd_dma_single_transfer
r_void
id|omap_set_lcd_dma_single_transfer
c_func
(paren
r_int
id|single
)paren
(brace
id|lcd_dma.single_transfer
op_assign
id|single
suffix:semicolon
)brace
DECL|function|omap_set_lcd_dma_b1_rotation
r_void
id|omap_set_lcd_dma_b1_rotation
c_func
(paren
r_int
id|rotate
)paren
(brace
r_if
c_cond
(paren
id|omap_dma_in_1510_mode
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;DMA rotation is not supported in 1510 mode&bslash;n&quot;
)paren
suffix:semicolon
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|lcd_dma.rotate
op_assign
id|rotate
suffix:semicolon
)brace
DECL|function|omap_set_lcd_dma_b1_mirror
r_void
id|omap_set_lcd_dma_b1_mirror
c_func
(paren
r_int
id|mirror
)paren
(brace
r_if
c_cond
(paren
id|omap_dma_in_1510_mode
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;DMA mirror is not supported in 1510 mode&bslash;n&quot;
)paren
suffix:semicolon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
id|lcd_dma.mirror
op_assign
id|mirror
suffix:semicolon
)brace
DECL|function|omap_set_lcd_dma_b1_vxres
r_void
id|omap_set_lcd_dma_b1_vxres
c_func
(paren
r_int
r_int
id|vxres
)paren
(brace
r_if
c_cond
(paren
id|omap_dma_in_1510_mode
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;DMA virtual resulotion is not supported &quot;
l_string|&quot;in 1510 mode&bslash;n&quot;
)paren
suffix:semicolon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
id|lcd_dma.vxres
op_assign
id|vxres
suffix:semicolon
)brace
DECL|function|omap_set_lcd_dma_b1_scale
r_void
id|omap_set_lcd_dma_b1_scale
c_func
(paren
r_int
r_int
id|xscale
comma
r_int
r_int
id|yscale
)paren
(brace
r_if
c_cond
(paren
id|omap_dma_in_1510_mode
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;DMA scale is not supported in 1510 mode&bslash;n&quot;
)paren
suffix:semicolon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
id|lcd_dma.xscale
op_assign
id|xscale
suffix:semicolon
id|lcd_dma.yscale
op_assign
id|yscale
suffix:semicolon
)brace
DECL|function|set_b1_regs
r_static
r_void
id|set_b1_regs
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|top
comma
id|bottom
suffix:semicolon
r_int
id|es
suffix:semicolon
id|u16
id|w
suffix:semicolon
r_int
r_int
id|en
comma
id|fn
suffix:semicolon
r_int
id|ei
comma
id|fi
suffix:semicolon
r_int
r_int
id|vxres
suffix:semicolon
r_int
r_int
id|xscale
comma
id|yscale
suffix:semicolon
r_switch
c_cond
(paren
id|lcd_dma.data_type
)paren
(brace
r_case
id|OMAP_DMA_DATA_TYPE_S8
suffix:colon
id|es
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OMAP_DMA_DATA_TYPE_S16
suffix:colon
id|es
op_assign
l_int|2
suffix:semicolon
r_break
suffix:semicolon
r_case
id|OMAP_DMA_DATA_TYPE_S32
suffix:colon
id|es
op_assign
l_int|4
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|vxres
op_assign
id|lcd_dma.vxres
ques
c_cond
id|lcd_dma.vxres
suffix:colon
id|lcd_dma.xres
suffix:semicolon
id|xscale
op_assign
id|lcd_dma.xscale
ques
c_cond
id|lcd_dma.xscale
suffix:colon
l_int|1
suffix:semicolon
id|yscale
op_assign
id|lcd_dma.yscale
ques
c_cond
id|lcd_dma.yscale
suffix:colon
l_int|1
suffix:semicolon
id|BUG_ON
c_func
(paren
id|vxres
OL
id|lcd_dma.xres
)paren
suffix:semicolon
DECL|macro|PIXADDR
mdefine_line|#define PIXADDR(x,y) (lcd_dma.addr + ((y) * vxres * yscale + (x) * xscale) * es)
DECL|macro|PIXSTEP
mdefine_line|#define PIXSTEP(sx, sy, dx, dy) (PIXADDR(dx, dy) - PIXADDR(sx, sy) - es + 1)
r_switch
c_cond
(paren
id|lcd_dma.rotate
)paren
(brace
r_case
l_int|0
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|lcd_dma.mirror
)paren
(brace
id|top
op_assign
id|PIXADDR
c_func
(paren
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|bottom
op_assign
id|PIXADDR
c_func
(paren
id|lcd_dma.xres
op_minus
l_int|1
comma
id|lcd_dma.yres
op_minus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* 1510 DMA requires the bottom address to be 2 more&n;&t;&t;&t; * than the actual last memory access location. */
r_if
c_cond
(paren
id|omap_dma_in_1510_mode
c_func
(paren
)paren
op_logical_and
id|lcd_dma.data_type
op_eq
id|OMAP_DMA_DATA_TYPE_S32
)paren
id|bottom
op_add_assign
l_int|2
suffix:semicolon
id|ei
op_assign
id|PIXSTEP
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|fi
op_assign
id|PIXSTEP
c_func
(paren
id|lcd_dma.xres
op_minus
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|top
op_assign
id|PIXADDR
c_func
(paren
id|lcd_dma.xres
op_minus
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|bottom
op_assign
id|PIXADDR
c_func
(paren
l_int|0
comma
id|lcd_dma.yres
op_minus
l_int|1
)paren
suffix:semicolon
id|ei
op_assign
id|PIXSTEP
c_func
(paren
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|fi
op_assign
id|PIXSTEP
c_func
(paren
l_int|0
comma
l_int|0
comma
id|lcd_dma.xres
op_minus
l_int|1
comma
l_int|1
)paren
suffix:semicolon
)brace
id|en
op_assign
id|lcd_dma.xres
suffix:semicolon
id|fn
op_assign
id|lcd_dma.yres
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|90
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|lcd_dma.mirror
)paren
(brace
id|top
op_assign
id|PIXADDR
c_func
(paren
l_int|0
comma
id|lcd_dma.yres
op_minus
l_int|1
)paren
suffix:semicolon
id|bottom
op_assign
id|PIXADDR
c_func
(paren
id|lcd_dma.xres
op_minus
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|ei
op_assign
id|PIXSTEP
c_func
(paren
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|fi
op_assign
id|PIXSTEP
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|1
comma
id|lcd_dma.yres
op_minus
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|top
op_assign
id|PIXADDR
c_func
(paren
id|lcd_dma.xres
op_minus
l_int|1
comma
id|lcd_dma.yres
op_minus
l_int|1
)paren
suffix:semicolon
id|bottom
op_assign
id|PIXADDR
c_func
(paren
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|ei
op_assign
id|PIXSTEP
c_func
(paren
l_int|0
comma
l_int|1
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|fi
op_assign
id|PIXSTEP
c_func
(paren
l_int|1
comma
l_int|0
comma
l_int|0
comma
id|lcd_dma.yres
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|en
op_assign
id|lcd_dma.yres
suffix:semicolon
id|fn
op_assign
id|lcd_dma.xres
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|180
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|lcd_dma.mirror
)paren
(brace
id|top
op_assign
id|PIXADDR
c_func
(paren
id|lcd_dma.xres
op_minus
l_int|1
comma
id|lcd_dma.yres
op_minus
l_int|1
)paren
suffix:semicolon
id|bottom
op_assign
id|PIXADDR
c_func
(paren
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|ei
op_assign
id|PIXSTEP
c_func
(paren
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|fi
op_assign
id|PIXSTEP
c_func
(paren
l_int|0
comma
l_int|1
comma
id|lcd_dma.xres
op_minus
l_int|1
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|top
op_assign
id|PIXADDR
c_func
(paren
l_int|0
comma
id|lcd_dma.yres
op_minus
l_int|1
)paren
suffix:semicolon
id|bottom
op_assign
id|PIXADDR
c_func
(paren
id|lcd_dma.xres
op_minus
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|ei
op_assign
id|PIXSTEP
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|fi
op_assign
id|PIXSTEP
c_func
(paren
id|lcd_dma.xres
op_minus
l_int|1
comma
l_int|1
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
id|en
op_assign
id|lcd_dma.xres
suffix:semicolon
id|fn
op_assign
id|lcd_dma.yres
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|270
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|lcd_dma.mirror
)paren
(brace
id|top
op_assign
id|PIXADDR
c_func
(paren
id|lcd_dma.xres
op_minus
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|bottom
op_assign
id|PIXADDR
c_func
(paren
l_int|0
comma
id|lcd_dma.yres
op_minus
l_int|1
)paren
suffix:semicolon
id|ei
op_assign
id|PIXSTEP
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
id|fi
op_assign
id|PIXSTEP
c_func
(paren
l_int|1
comma
id|lcd_dma.yres
op_minus
l_int|1
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
r_else
(brace
id|top
op_assign
id|PIXADDR
c_func
(paren
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|bottom
op_assign
id|PIXADDR
c_func
(paren
id|lcd_dma.xres
op_minus
l_int|1
comma
id|lcd_dma.yres
op_minus
l_int|1
)paren
suffix:semicolon
id|ei
op_assign
id|PIXSTEP
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|1
)paren
suffix:semicolon
id|fi
op_assign
id|PIXSTEP
c_func
(paren
l_int|0
comma
id|lcd_dma.yres
op_minus
l_int|1
comma
l_int|1
comma
l_int|0
)paren
suffix:semicolon
)brace
id|en
op_assign
id|lcd_dma.yres
suffix:semicolon
id|fn
op_assign
id|lcd_dma.xres
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
multiline_comment|/* Supress warning about uninitialized vars */
)brace
r_if
c_cond
(paren
id|omap_dma_in_1510_mode
c_func
(paren
)paren
)paren
(brace
id|omap_writew
c_func
(paren
id|top
op_rshift
l_int|16
comma
id|OMAP1510_DMA_LCD_TOP_F1_U
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|top
comma
id|OMAP1510_DMA_LCD_TOP_F1_L
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|bottom
op_rshift
l_int|16
comma
id|OMAP1510_DMA_LCD_BOT_F1_U
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|bottom
comma
id|OMAP1510_DMA_LCD_BOT_F1_L
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* 1610 regs */
id|omap_writew
c_func
(paren
id|top
op_rshift
l_int|16
comma
id|OMAP1610_DMA_LCD_TOP_B1_U
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|top
comma
id|OMAP1610_DMA_LCD_TOP_B1_L
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|bottom
op_rshift
l_int|16
comma
id|OMAP1610_DMA_LCD_BOT_B1_U
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|bottom
comma
id|OMAP1610_DMA_LCD_BOT_B1_L
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|en
comma
id|OMAP1610_DMA_LCD_SRC_EN_B1
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|fn
comma
id|OMAP1610_DMA_LCD_SRC_FN_B1
)paren
suffix:semicolon
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP1610_DMA_LCD_CSDP
)paren
suffix:semicolon
id|w
op_and_assign
op_complement
l_int|0x03
suffix:semicolon
id|w
op_or_assign
id|lcd_dma.data_type
suffix:semicolon
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP1610_DMA_LCD_CSDP
)paren
suffix:semicolon
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP1610_DMA_LCD_CTRL
)paren
suffix:semicolon
multiline_comment|/* Always set the source port as SDRAM for now*/
id|w
op_and_assign
op_complement
(paren
l_int|0x03
op_lshift
l_int|6
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lcd_dma.ext_ctrl
)paren
id|w
op_or_assign
l_int|1
op_lshift
l_int|8
suffix:semicolon
r_else
id|w
op_and_assign
op_complement
(paren
l_int|1
op_lshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lcd_dma.callback
op_ne
l_int|NULL
)paren
id|w
op_or_assign
l_int|1
op_lshift
l_int|1
suffix:semicolon
multiline_comment|/* Block interrupt enable */
r_else
id|w
op_and_assign
op_complement
(paren
l_int|1
op_lshift
l_int|1
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP1610_DMA_LCD_CTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|lcd_dma.rotate
op_logical_or
id|lcd_dma.mirror
op_logical_or
id|lcd_dma.vxres
op_logical_or
id|lcd_dma.xscale
op_logical_or
id|lcd_dma.yscale
)paren
)paren
r_return
suffix:semicolon
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP1610_DMA_LCD_CCR
)paren
suffix:semicolon
multiline_comment|/* Set the double-indexed addressing mode */
id|w
op_or_assign
(paren
l_int|0x03
op_lshift
l_int|12
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP1610_DMA_LCD_CCR
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|ei
comma
id|OMAP1610_DMA_LCD_SRC_EI_B1
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|fi
op_rshift
l_int|16
comma
id|OMAP1610_DMA_LCD_SRC_FI_B1_U
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|fi
comma
id|OMAP1610_DMA_LCD_SRC_FI_B1_L
)paren
suffix:semicolon
)brace
DECL|function|lcd_dma_irq_handler
r_static
id|irqreturn_t
id|lcd_dma_irq_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|u16
id|w
suffix:semicolon
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP1610_DMA_LCD_CTRL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unlikely
c_func
(paren
op_logical_neg
(paren
id|w
op_amp
(paren
l_int|1
op_lshift
l_int|3
)paren
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Spurious LCD DMA IRQ&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|IRQ_NONE
suffix:semicolon
)brace
multiline_comment|/* Ack the IRQ */
id|w
op_or_assign
(paren
l_int|1
op_lshift
l_int|3
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP1610_DMA_LCD_CTRL
)paren
suffix:semicolon
id|lcd_dma.active
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|lcd_dma.callback
op_ne
l_int|NULL
)paren
id|lcd_dma
dot
id|callback
c_func
(paren
id|w
comma
id|lcd_dma.cb_data
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|omap_request_lcd_dma
r_int
id|omap_request_lcd_dma
c_func
(paren
r_void
(paren
op_star
id|callback
)paren
(paren
id|u16
id|status
comma
r_void
op_star
id|data
)paren
comma
r_void
op_star
id|data
)paren
(brace
id|spin_lock_irq
c_func
(paren
op_amp
id|lcd_dma.lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lcd_dma.reserved
)paren
(brace
id|spin_unlock_irq
c_func
(paren
op_amp
id|lcd_dma.lock
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;LCD DMA channel already reserved&bslash;n&quot;
)paren
suffix:semicolon
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
id|lcd_dma.reserved
op_assign
l_int|1
suffix:semicolon
id|spin_unlock_irq
c_func
(paren
op_amp
id|lcd_dma.lock
)paren
suffix:semicolon
id|lcd_dma.callback
op_assign
id|callback
suffix:semicolon
id|lcd_dma.cb_data
op_assign
id|data
suffix:semicolon
id|lcd_dma.active
op_assign
l_int|0
suffix:semicolon
id|lcd_dma.single_transfer
op_assign
l_int|0
suffix:semicolon
id|lcd_dma.rotate
op_assign
l_int|0
suffix:semicolon
id|lcd_dma.vxres
op_assign
l_int|0
suffix:semicolon
id|lcd_dma.mirror
op_assign
l_int|0
suffix:semicolon
id|lcd_dma.xscale
op_assign
l_int|0
suffix:semicolon
id|lcd_dma.yscale
op_assign
l_int|0
suffix:semicolon
id|lcd_dma.ext_ctrl
op_assign
l_int|0
suffix:semicolon
id|lcd_dma.src_port
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|omap_free_lcd_dma
r_void
id|omap_free_lcd_dma
c_func
(paren
r_void
)paren
(brace
id|spin_lock
c_func
(paren
op_amp
id|lcd_dma.lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lcd_dma.reserved
)paren
(brace
id|spin_unlock
c_func
(paren
op_amp
id|lcd_dma.lock
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;LCD DMA is not reserved&bslash;n&quot;
)paren
suffix:semicolon
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|enable_1510_mode
)paren
id|omap_writew
c_func
(paren
id|omap_readw
c_func
(paren
id|OMAP1610_DMA_LCD_CCR
)paren
op_amp
op_complement
l_int|1
comma
id|OMAP1610_DMA_LCD_CCR
)paren
suffix:semicolon
id|lcd_dma.reserved
op_assign
l_int|0
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|lcd_dma.lock
)paren
suffix:semicolon
)brace
DECL|function|omap_enable_lcd_dma
r_void
id|omap_enable_lcd_dma
c_func
(paren
r_void
)paren
(brace
id|u16
id|w
suffix:semicolon
multiline_comment|/* Set the Enable bit only if an external controller is&n;&t; * connected. Otherwise the OMAP internal controller will&n;&t; * start the transfer when it gets enabled.&n;&t; */
r_if
c_cond
(paren
id|enable_1510_mode
op_logical_or
op_logical_neg
id|lcd_dma.ext_ctrl
)paren
r_return
suffix:semicolon
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP1610_DMA_LCD_CCR
)paren
suffix:semicolon
id|w
op_or_assign
l_int|1
op_lshift
l_int|7
suffix:semicolon
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP1610_DMA_LCD_CCR
)paren
suffix:semicolon
id|lcd_dma.active
op_assign
l_int|1
suffix:semicolon
)brace
DECL|function|omap_setup_lcd_dma
r_void
id|omap_setup_lcd_dma
c_func
(paren
r_void
)paren
(brace
id|BUG_ON
c_func
(paren
id|lcd_dma.active
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|enable_1510_mode
)paren
(brace
multiline_comment|/* Set some reasonable defaults */
id|omap_writew
c_func
(paren
l_int|0x5440
comma
id|OMAP1610_DMA_LCD_CCR
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
l_int|0x9102
comma
id|OMAP1610_DMA_LCD_CSDP
)paren
suffix:semicolon
id|omap_writew
c_func
(paren
l_int|0x0004
comma
id|OMAP1610_DMA_LCD_LCH_CTRL
)paren
suffix:semicolon
)brace
id|set_b1_regs
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|enable_1510_mode
)paren
(brace
id|u16
id|w
suffix:semicolon
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP1610_DMA_LCD_CCR
)paren
suffix:semicolon
multiline_comment|/* If DMA was already active set the end_prog bit to have&n;&t;&t; * the programmed register set loaded into the active&n;&t;&t; * register set.&n;&t;&t; */
id|w
op_or_assign
l_int|1
op_lshift
l_int|11
suffix:semicolon
multiline_comment|/* End_prog */
r_if
c_cond
(paren
op_logical_neg
id|lcd_dma.single_transfer
)paren
id|w
op_or_assign
(paren
l_int|3
op_lshift
l_int|8
)paren
suffix:semicolon
multiline_comment|/* Auto_init, repeat */
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP1610_DMA_LCD_CCR
)paren
suffix:semicolon
)brace
)brace
DECL|function|omap_stop_lcd_dma
r_void
id|omap_stop_lcd_dma
c_func
(paren
r_void
)paren
(brace
id|lcd_dma.active
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|enable_1510_mode
op_logical_and
id|lcd_dma.ext_ctrl
)paren
id|omap_writew
c_func
(paren
id|omap_readw
c_func
(paren
id|OMAP1610_DMA_LCD_CCR
)paren
op_amp
op_complement
(paren
l_int|1
op_lshift
l_int|7
)paren
comma
id|OMAP1610_DMA_LCD_CCR
)paren
suffix:semicolon
)brace
DECL|function|omap_init_dma
r_static
r_int
id|__init
id|omap_init_dma
c_func
(paren
r_void
)paren
(brace
r_int
id|ch
comma
id|r
suffix:semicolon
r_if
c_cond
(paren
id|cpu_is_omap1510
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;DMA support for OMAP1510 initialized&bslash;n&quot;
)paren
suffix:semicolon
id|dma_chan_count
op_assign
l_int|9
suffix:semicolon
id|enable_1510_mode
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|cpu_is_omap16xx
c_func
(paren
)paren
op_logical_or
id|cpu_is_omap730
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;OMAP DMA hardware version %d&bslash;n&quot;
comma
id|omap_readw
c_func
(paren
id|OMAP_DMA_HW_ID
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;DMA capabilities: %08x:%08x:%04x:%04x:%04x&bslash;n&quot;
comma
(paren
id|omap_readw
c_func
(paren
id|OMAP_DMA_CAPS_0_U
)paren
op_lshift
l_int|16
)paren
op_or
id|omap_readw
c_func
(paren
id|OMAP_DMA_CAPS_0_L
)paren
comma
(paren
id|omap_readw
c_func
(paren
id|OMAP_DMA_CAPS_1_U
)paren
op_lshift
l_int|16
)paren
op_or
id|omap_readw
c_func
(paren
id|OMAP_DMA_CAPS_1_L
)paren
comma
id|omap_readw
c_func
(paren
id|OMAP_DMA_CAPS_2
)paren
comma
id|omap_readw
c_func
(paren
id|OMAP_DMA_CAPS_3
)paren
comma
id|omap_readw
c_func
(paren
id|OMAP_DMA_CAPS_4
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|enable_1510_mode
)paren
(brace
id|u16
id|w
suffix:semicolon
multiline_comment|/* Disable OMAP 3.0/3.1 compatibility mode. */
id|w
op_assign
id|omap_readw
c_func
(paren
id|OMAP_DMA_GSCR
)paren
suffix:semicolon
id|w
op_or_assign
l_int|1
op_lshift
l_int|3
suffix:semicolon
id|omap_writew
c_func
(paren
id|w
comma
id|OMAP_DMA_GSCR
)paren
suffix:semicolon
id|dma_chan_count
op_assign
l_int|16
suffix:semicolon
)brace
r_else
id|dma_chan_count
op_assign
l_int|9
suffix:semicolon
)brace
r_else
(brace
id|dma_chan_count
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|memset
c_func
(paren
op_amp
id|lcd_dma
comma
l_int|0
comma
r_sizeof
(paren
id|lcd_dma
)paren
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|lcd_dma.lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|dma_chan_lock
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|dma_chan
comma
l_int|0
comma
r_sizeof
(paren
id|dma_chan
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|ch
op_assign
l_int|0
suffix:semicolon
id|ch
OL
id|dma_chan_count
suffix:semicolon
id|ch
op_increment
)paren
(brace
id|dma_chan
(braket
id|ch
)braket
dot
id|dev_id
op_assign
op_minus
l_int|1
suffix:semicolon
id|dma_chan
(braket
id|ch
)braket
dot
id|next_lch
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|ch
op_ge
l_int|6
op_logical_and
id|enable_1510_mode
)paren
r_continue
suffix:semicolon
multiline_comment|/* request_irq() doesn&squot;t like dev_id (ie. ch) being zero,&n;&t;&t; * so we have to kludge around this. */
id|r
op_assign
id|request_irq
c_func
(paren
id|dma_irq
(braket
id|ch
)braket
comma
id|dma_irq_handler
comma
l_int|0
comma
l_string|&quot;DMA&quot;
comma
(paren
r_void
op_star
)paren
(paren
id|ch
op_plus
l_int|1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
op_ne
l_int|0
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;unable to request IRQ %d for DMA (error %d)&bslash;n&quot;
comma
id|dma_irq
(braket
id|ch
)braket
comma
id|r
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ch
suffix:semicolon
id|i
op_increment
)paren
id|free_irq
c_func
(paren
id|dma_irq
(braket
id|i
)braket
comma
(paren
r_void
op_star
)paren
(paren
id|i
op_plus
l_int|1
)paren
)paren
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
)brace
id|r
op_assign
id|request_irq
c_func
(paren
id|INT_DMA_LCD
comma
id|lcd_dma_irq_handler
comma
l_int|0
comma
l_string|&quot;LCD DMA&quot;
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|r
op_ne
l_int|0
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;unable to request IRQ for LCD DMA (error %d)&bslash;n&quot;
comma
id|r
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|dma_chan_count
suffix:semicolon
id|i
op_increment
)paren
id|free_irq
c_func
(paren
id|dma_irq
(braket
id|i
)braket
comma
(paren
r_void
op_star
)paren
(paren
id|i
op_plus
l_int|1
)paren
)paren
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|omap_init_dma
id|arch_initcall
c_func
(paren
id|omap_init_dma
)paren
suffix:semicolon
DECL|variable|omap_set_dma_priority
id|EXPORT_SYMBOL
c_func
(paren
id|omap_set_dma_priority
)paren
suffix:semicolon
DECL|variable|omap_request_dma
id|EXPORT_SYMBOL
c_func
(paren
id|omap_request_dma
)paren
suffix:semicolon
DECL|variable|omap_free_dma
id|EXPORT_SYMBOL
c_func
(paren
id|omap_free_dma
)paren
suffix:semicolon
DECL|variable|omap_start_dma
id|EXPORT_SYMBOL
c_func
(paren
id|omap_start_dma
)paren
suffix:semicolon
DECL|variable|omap_stop_dma
id|EXPORT_SYMBOL
c_func
(paren
id|omap_stop_dma
)paren
suffix:semicolon
DECL|variable|omap_enable_dma_irq
id|EXPORT_SYMBOL
c_func
(paren
id|omap_enable_dma_irq
)paren
suffix:semicolon
DECL|variable|omap_disable_dma_irq
id|EXPORT_SYMBOL
c_func
(paren
id|omap_disable_dma_irq
)paren
suffix:semicolon
DECL|variable|omap_set_dma_transfer_params
id|EXPORT_SYMBOL
c_func
(paren
id|omap_set_dma_transfer_params
)paren
suffix:semicolon
DECL|variable|omap_set_dma_color_mode
id|EXPORT_SYMBOL
c_func
(paren
id|omap_set_dma_color_mode
)paren
suffix:semicolon
DECL|variable|omap_set_dma_src_params
id|EXPORT_SYMBOL
c_func
(paren
id|omap_set_dma_src_params
)paren
suffix:semicolon
DECL|variable|omap_set_dma_src_index
id|EXPORT_SYMBOL
c_func
(paren
id|omap_set_dma_src_index
)paren
suffix:semicolon
DECL|variable|omap_set_dma_src_data_pack
id|EXPORT_SYMBOL
c_func
(paren
id|omap_set_dma_src_data_pack
)paren
suffix:semicolon
DECL|variable|omap_set_dma_src_burst_mode
id|EXPORT_SYMBOL
c_func
(paren
id|omap_set_dma_src_burst_mode
)paren
suffix:semicolon
DECL|variable|omap_set_dma_dest_params
id|EXPORT_SYMBOL
c_func
(paren
id|omap_set_dma_dest_params
)paren
suffix:semicolon
DECL|variable|omap_set_dma_dest_index
id|EXPORT_SYMBOL
c_func
(paren
id|omap_set_dma_dest_index
)paren
suffix:semicolon
DECL|variable|omap_set_dma_dest_data_pack
id|EXPORT_SYMBOL
c_func
(paren
id|omap_set_dma_dest_data_pack
)paren
suffix:semicolon
DECL|variable|omap_set_dma_dest_burst_mode
id|EXPORT_SYMBOL
c_func
(paren
id|omap_set_dma_dest_burst_mode
)paren
suffix:semicolon
DECL|variable|omap_dma_link_lch
id|EXPORT_SYMBOL
c_func
(paren
id|omap_dma_link_lch
)paren
suffix:semicolon
DECL|variable|omap_dma_unlink_lch
id|EXPORT_SYMBOL
c_func
(paren
id|omap_dma_unlink_lch
)paren
suffix:semicolon
DECL|variable|omap_request_lcd_dma
id|EXPORT_SYMBOL
c_func
(paren
id|omap_request_lcd_dma
)paren
suffix:semicolon
DECL|variable|omap_free_lcd_dma
id|EXPORT_SYMBOL
c_func
(paren
id|omap_free_lcd_dma
)paren
suffix:semicolon
DECL|variable|omap_enable_lcd_dma
id|EXPORT_SYMBOL
c_func
(paren
id|omap_enable_lcd_dma
)paren
suffix:semicolon
DECL|variable|omap_setup_lcd_dma
id|EXPORT_SYMBOL
c_func
(paren
id|omap_setup_lcd_dma
)paren
suffix:semicolon
DECL|variable|omap_stop_lcd_dma
id|EXPORT_SYMBOL
c_func
(paren
id|omap_stop_lcd_dma
)paren
suffix:semicolon
DECL|variable|omap_set_lcd_dma_b1
id|EXPORT_SYMBOL
c_func
(paren
id|omap_set_lcd_dma_b1
)paren
suffix:semicolon
DECL|variable|omap_set_lcd_dma_single_transfer
id|EXPORT_SYMBOL
c_func
(paren
id|omap_set_lcd_dma_single_transfer
)paren
suffix:semicolon
DECL|variable|omap_set_lcd_dma_ext_controller
id|EXPORT_SYMBOL
c_func
(paren
id|omap_set_lcd_dma_ext_controller
)paren
suffix:semicolon
DECL|variable|omap_set_lcd_dma_b1_rotation
id|EXPORT_SYMBOL
c_func
(paren
id|omap_set_lcd_dma_b1_rotation
)paren
suffix:semicolon
DECL|variable|omap_set_lcd_dma_b1_vxres
id|EXPORT_SYMBOL
c_func
(paren
id|omap_set_lcd_dma_b1_vxres
)paren
suffix:semicolon
DECL|variable|omap_set_lcd_dma_b1_scale
id|EXPORT_SYMBOL
c_func
(paren
id|omap_set_lcd_dma_b1_scale
)paren
suffix:semicolon
DECL|variable|omap_set_lcd_dma_b1_mirror
id|EXPORT_SYMBOL
c_func
(paren
id|omap_set_lcd_dma_b1_mirror
)paren
suffix:semicolon
eof
