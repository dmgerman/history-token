multiline_comment|/*--------------------------------------------------------------------------&n;--&n;-- Identity : Linux50 Debug Funcions&n;--&n;-- File     : arch/sh64/lib/dbg.C&n;--&n;-- Copyright 2000, 2001 STMicroelectronics Limited.&n;-- Copyright 2004 Richard Curnow (evt_debug etc)&n;--&n;--------------------------------------------------------------------------*/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;asm/mmu_context.h&gt;
DECL|typedef|regType_t
r_typedef
id|u64
id|regType_t
suffix:semicolon
DECL|function|getConfigReg
r_static
id|regType_t
id|getConfigReg
c_func
(paren
id|u64
id|id
)paren
(brace
r_register
id|u64
id|reg
id|__asm__
c_func
(paren
l_string|&quot;r2&quot;
)paren
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;getcfg   %1, 0, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|reg
)paren
suffix:colon
l_string|&quot;r&quot;
(paren
id|id
)paren
)paren
suffix:semicolon
r_return
(paren
id|reg
)paren
suffix:semicolon
)brace
multiline_comment|/* ======================================================================= */
DECL|variable|szTab
r_static
r_char
op_star
id|szTab
(braket
)braket
op_assign
(brace
l_string|&quot;4k&quot;
comma
l_string|&quot;64k&quot;
comma
l_string|&quot;1M&quot;
comma
l_string|&quot;512M&quot;
)brace
suffix:semicolon
DECL|variable|protTab
r_static
r_char
op_star
id|protTab
(braket
)braket
op_assign
(brace
l_string|&quot;----&quot;
comma
l_string|&quot;---R&quot;
comma
l_string|&quot;--X-&quot;
comma
l_string|&quot;--XR&quot;
comma
l_string|&quot;-W--&quot;
comma
l_string|&quot;-W-R&quot;
comma
l_string|&quot;-WX-&quot;
comma
l_string|&quot;-WXR&quot;
comma
l_string|&quot;U---&quot;
comma
l_string|&quot;U--R&quot;
comma
l_string|&quot;U-X-&quot;
comma
l_string|&quot;U-XR&quot;
comma
l_string|&quot;UW--&quot;
comma
l_string|&quot;UW-R&quot;
comma
l_string|&quot;UWX-&quot;
comma
l_string|&quot;UWXR&quot;
)brace
suffix:semicolon
DECL|macro|ITLB_BASE
mdefine_line|#define  ITLB_BASE&t;0x00000000
DECL|macro|DTLB_BASE
mdefine_line|#define  DTLB_BASE&t;0x00800000
DECL|macro|MAX_TLBs
mdefine_line|#define  MAX_TLBs&t;&t;64
multiline_comment|/* PTE High */
DECL|macro|GET_VALID
mdefine_line|#define  GET_VALID(pte)        ((pte) &amp; 0x1)
DECL|macro|GET_SHARED
mdefine_line|#define  GET_SHARED(pte)       ((pte) &amp; 0x2)
DECL|macro|GET_ASID
mdefine_line|#define  GET_ASID(pte)         ((pte &gt;&gt; 2) &amp; 0x0ff)
DECL|macro|GET_EPN
mdefine_line|#define  GET_EPN(pte)          ((pte) &amp; 0xfffff000)
multiline_comment|/* PTE Low */
DECL|macro|GET_CBEHAVIOR
mdefine_line|#define  GET_CBEHAVIOR(pte)    ((pte) &amp; 0x3)
DECL|macro|GET_PAGE_SIZE
mdefine_line|#define  GET_PAGE_SIZE(pte)    szTab[((pte &gt;&gt; 3) &amp; 0x3)]
DECL|macro|GET_PROTECTION
mdefine_line|#define  GET_PROTECTION(pte)   protTab[((pte &gt;&gt; 6) &amp; 0xf)]
DECL|macro|GET_PPN
mdefine_line|#define  GET_PPN(pte)          ((pte) &amp; 0xfffff000)
DECL|macro|PAGE_1K_MASK
mdefine_line|#define PAGE_1K_MASK           0x00000000
DECL|macro|PAGE_4K_MASK
mdefine_line|#define PAGE_4K_MASK           0x00000010
DECL|macro|PAGE_64K_MASK
mdefine_line|#define PAGE_64K_MASK          0x00000080
DECL|macro|MMU_PAGESIZE_MASK
mdefine_line|#define MMU_PAGESIZE_MASK      (PAGE_64K_MASK | PAGE_4K_MASK)
DECL|macro|PAGE_1MB_MASK
mdefine_line|#define PAGE_1MB_MASK          MMU_PAGESIZE_MASK
DECL|macro|PAGE_1K
mdefine_line|#define PAGE_1K                (1024)
DECL|macro|PAGE_4K
mdefine_line|#define PAGE_4K                (1024 * 4)
DECL|macro|PAGE_64K
mdefine_line|#define PAGE_64K               (1024 * 64)
DECL|macro|PAGE_1MB
mdefine_line|#define PAGE_1MB               (1024 * 1024)
DECL|macro|HOW_TO_READ_TLB_CONTENT
mdefine_line|#define HOW_TO_READ_TLB_CONTENT  &bslash;&n;       &quot;[ ID]  PPN         EPN        ASID  Share  CB  P.Size   PROT.&bslash;n&quot;
DECL|function|print_single_tlb
r_void
id|print_single_tlb
c_func
(paren
r_int
r_int
id|tlb
comma
r_int
id|single_print
)paren
(brace
id|regType_t
id|pteH
suffix:semicolon
id|regType_t
id|pteL
suffix:semicolon
r_int
r_int
id|valid
comma
id|shared
comma
id|asid
comma
id|epn
comma
id|cb
comma
id|ppn
suffix:semicolon
r_char
op_star
id|pSize
suffix:semicolon
r_char
op_star
id|pProt
suffix:semicolon
multiline_comment|/*&n;&t;   ** in case of single print &lt;single_print&gt; is true, this implies:&n;&t;   **   1) print the TLB in any case also if NOT VALID&n;&t;   **   2) print out the header&n;&t; */
id|pteH
op_assign
id|getConfigReg
c_func
(paren
id|tlb
)paren
suffix:semicolon
id|valid
op_assign
id|GET_VALID
c_func
(paren
id|pteH
)paren
suffix:semicolon
r_if
c_cond
(paren
id|single_print
)paren
id|printk
c_func
(paren
id|HOW_TO_READ_TLB_CONTENT
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|valid
)paren
r_return
suffix:semicolon
id|pteL
op_assign
id|getConfigReg
c_func
(paren
id|tlb
op_plus
l_int|1
)paren
suffix:semicolon
id|shared
op_assign
id|GET_SHARED
c_func
(paren
id|pteH
)paren
suffix:semicolon
id|asid
op_assign
id|GET_ASID
c_func
(paren
id|pteH
)paren
suffix:semicolon
id|epn
op_assign
id|GET_EPN
c_func
(paren
id|pteH
)paren
suffix:semicolon
id|cb
op_assign
id|GET_CBEHAVIOR
c_func
(paren
id|pteL
)paren
suffix:semicolon
id|pSize
op_assign
id|GET_PAGE_SIZE
c_func
(paren
id|pteL
)paren
suffix:semicolon
id|pProt
op_assign
id|GET_PROTECTION
c_func
(paren
id|pteL
)paren
suffix:semicolon
id|ppn
op_assign
id|GET_PPN
c_func
(paren
id|pteL
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;[%c%2ld]  0x%08x  0x%08x  %03d   %02x    %02x   %4s    %s&bslash;n&quot;
comma
(paren
(paren
id|valid
)paren
ques
c_cond
l_char|&squot; &squot;
suffix:colon
l_char|&squot;u&squot;
)paren
comma
(paren
(paren
id|tlb
op_amp
l_int|0x0ffff
)paren
op_div
id|TLB_STEP
)paren
comma
id|ppn
comma
id|epn
comma
id|asid
comma
id|shared
comma
id|cb
comma
id|pSize
comma
id|pProt
)paren
suffix:semicolon
)brace
DECL|function|print_dtlb
r_void
id|print_dtlb
c_func
(paren
r_void
)paren
(brace
r_int
id|count
suffix:semicolon
r_int
r_int
id|tlb
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; ================= SH-5 D-TLBs Status ===================&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|HOW_TO_READ_TLB_CONTENT
)paren
suffix:semicolon
id|tlb
op_assign
id|DTLB_BASE
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
id|MAX_TLBs
suffix:semicolon
id|count
op_increment
comma
id|tlb
op_add_assign
id|TLB_STEP
)paren
id|print_single_tlb
c_func
(paren
id|tlb
comma
l_int|0
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot; =============================================================&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|print_itlb
r_void
id|print_itlb
c_func
(paren
r_void
)paren
(brace
r_int
id|count
suffix:semicolon
r_int
r_int
id|tlb
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; ================= SH-5 I-TLBs Status ===================&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|HOW_TO_READ_TLB_CONTENT
)paren
suffix:semicolon
id|tlb
op_assign
id|ITLB_BASE
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
id|MAX_TLBs
suffix:semicolon
id|count
op_increment
comma
id|tlb
op_add_assign
id|TLB_STEP
)paren
id|print_single_tlb
c_func
(paren
id|tlb
comma
l_int|0
)paren
suffix:semicolon
id|printk
(paren
l_string|&quot; =============================================================&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* ======================================================================= */
macro_line|#ifdef CONFIG_POOR_MANS_STRACE
macro_line|#include &quot;syscalltab.h&quot;
DECL|struct|ring_node
r_struct
id|ring_node
(brace
DECL|member|evt
r_int
id|evt
suffix:semicolon
DECL|member|ret_addr
r_int
id|ret_addr
suffix:semicolon
DECL|member|event
r_int
id|event
suffix:semicolon
DECL|member|tra
r_int
id|tra
suffix:semicolon
DECL|member|pid
r_int
id|pid
suffix:semicolon
DECL|member|sp
r_int
r_int
id|sp
suffix:semicolon
DECL|member|pc
r_int
r_int
id|pc
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|event_ring
r_static
r_struct
id|ring_node
id|event_ring
(braket
l_int|16
)braket
suffix:semicolon
DECL|variable|event_ptr
r_static
r_int
id|event_ptr
op_assign
l_int|0
suffix:semicolon
DECL|struct|stored_syscall_data
r_struct
id|stored_syscall_data
(brace
DECL|member|pid
r_int
id|pid
suffix:semicolon
DECL|member|syscall_number
r_int
id|syscall_number
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|N_STORED_SYSCALLS
mdefine_line|#define N_STORED_SYSCALLS 16
DECL|variable|stored_syscalls
r_static
r_struct
id|stored_syscall_data
id|stored_syscalls
(braket
id|N_STORED_SYSCALLS
)braket
suffix:semicolon
DECL|variable|syscall_next
r_static
r_int
id|syscall_next
op_assign
l_int|0
suffix:semicolon
DECL|variable|syscall_next_print
r_static
r_int
id|syscall_next_print
op_assign
l_int|0
suffix:semicolon
DECL|function|evt_debug
r_void
id|evt_debug
c_func
(paren
r_int
id|evt
comma
r_int
id|ret_addr
comma
r_int
id|event
comma
r_int
id|tra
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|syscallno
op_assign
id|tra
op_amp
l_int|0xff
suffix:semicolon
r_int
r_int
id|sp
suffix:semicolon
r_int
r_int
id|stack_bottom
suffix:semicolon
r_int
id|pid
suffix:semicolon
r_struct
id|ring_node
op_star
id|rr
suffix:semicolon
id|pid
op_assign
id|current-&gt;pid
suffix:semicolon
id|stack_bottom
op_assign
(paren
r_int
r_int
)paren
id|current-&gt;thread_info
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;ori r15, 0, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|sp
)paren
)paren
suffix:semicolon
id|rr
op_assign
id|event_ring
op_plus
id|event_ptr
suffix:semicolon
id|rr-&gt;evt
op_assign
id|evt
suffix:semicolon
id|rr-&gt;ret_addr
op_assign
id|ret_addr
suffix:semicolon
id|rr-&gt;event
op_assign
id|event
suffix:semicolon
id|rr-&gt;tra
op_assign
id|tra
suffix:semicolon
id|rr-&gt;pid
op_assign
id|pid
suffix:semicolon
id|rr-&gt;sp
op_assign
id|sp
suffix:semicolon
id|rr-&gt;pc
op_assign
id|regs-&gt;pc
suffix:semicolon
r_if
c_cond
(paren
id|sp
OL
id|stack_bottom
op_plus
l_int|3092
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;evt_debug : stack underflow report&bslash;n&quot;
)paren
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
comma
id|i
op_assign
id|event_ptr
suffix:semicolon
id|j
OL
l_int|16
suffix:semicolon
id|j
op_increment
)paren
(brace
id|rr
op_assign
id|event_ring
op_plus
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;evt=%08x event=%08x tra=%08x pid=%5d sp=%08lx pc=%08lx&bslash;n&quot;
comma
id|rr-&gt;evt
comma
id|rr-&gt;event
comma
id|rr-&gt;tra
comma
id|rr-&gt;pid
comma
id|rr-&gt;sp
comma
id|rr-&gt;pc
)paren
suffix:semicolon
id|i
op_decrement
suffix:semicolon
id|i
op_and_assign
l_int|15
suffix:semicolon
)brace
id|panic
c_func
(paren
l_string|&quot;STACK UNDERFLOW&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|event_ptr
op_assign
(paren
id|event_ptr
op_plus
l_int|1
)paren
op_amp
l_int|15
suffix:semicolon
r_if
c_cond
(paren
(paren
id|event
op_eq
l_int|2
)paren
op_logical_and
(paren
id|evt
op_eq
l_int|0x160
)paren
)paren
(brace
r_if
c_cond
(paren
id|syscallno
OL
id|NUM_SYSCALL_INFO_ENTRIES
)paren
(brace
multiline_comment|/* Store the syscall information to print later.  We&n;&t;&t;&t; * can&squot;t print this now - currently we&squot;re running with&n;&t;&t;&t; * SR.BL=1, so we can&squot;t take a tlbmiss (which could occur&n;&t;&t;&t; * in the console drivers under printk).&n;&t;&t;&t; *&n;&t;&t;&t; * Just overwrite old entries on ring overflow - this&n;&t;&t;&t; * is only for last-hope debugging. */
id|stored_syscalls
(braket
id|syscall_next
)braket
dot
id|pid
op_assign
id|current-&gt;pid
suffix:semicolon
id|stored_syscalls
(braket
id|syscall_next
)braket
dot
id|syscall_number
op_assign
id|syscallno
suffix:semicolon
id|syscall_next
op_increment
suffix:semicolon
id|syscall_next
op_and_assign
(paren
id|N_STORED_SYSCALLS
op_minus
l_int|1
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|drain_syscalls
r_static
r_void
id|drain_syscalls
c_func
(paren
r_void
)paren
(brace
r_while
c_loop
(paren
id|syscall_next_print
op_ne
id|syscall_next
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Task %d: %s()&bslash;n&quot;
comma
id|stored_syscalls
(braket
id|syscall_next_print
)braket
dot
id|pid
comma
id|syscall_info_table
(braket
id|stored_syscalls
(braket
id|syscall_next_print
)braket
dot
id|syscall_number
)braket
dot
id|name
)paren
suffix:semicolon
id|syscall_next_print
op_increment
suffix:semicolon
id|syscall_next_print
op_and_assign
(paren
id|N_STORED_SYSCALLS
op_minus
l_int|1
)paren
suffix:semicolon
)brace
)brace
DECL|function|evt_debug2
r_void
id|evt_debug2
c_func
(paren
r_int
r_int
id|ret
)paren
(brace
id|drain_syscalls
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Task %d: syscall returns %08x&bslash;n&quot;
comma
id|current-&gt;pid
comma
id|ret
)paren
suffix:semicolon
)brace
DECL|function|evt_debug_ret_from_irq
r_void
id|evt_debug_ret_from_irq
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|pid
suffix:semicolon
r_struct
id|ring_node
op_star
id|rr
suffix:semicolon
id|pid
op_assign
id|current-&gt;pid
suffix:semicolon
id|rr
op_assign
id|event_ring
op_plus
id|event_ptr
suffix:semicolon
id|rr-&gt;evt
op_assign
l_int|0xffff
suffix:semicolon
id|rr-&gt;ret_addr
op_assign
l_int|0
suffix:semicolon
id|rr-&gt;event
op_assign
l_int|0
suffix:semicolon
id|rr-&gt;tra
op_assign
l_int|0
suffix:semicolon
id|rr-&gt;pid
op_assign
id|pid
suffix:semicolon
id|rr-&gt;pc
op_assign
id|regs-&gt;pc
suffix:semicolon
id|event_ptr
op_assign
(paren
id|event_ptr
op_plus
l_int|1
)paren
op_amp
l_int|15
suffix:semicolon
)brace
DECL|function|evt_debug_ret_from_exc
r_void
id|evt_debug_ret_from_exc
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|pid
suffix:semicolon
r_struct
id|ring_node
op_star
id|rr
suffix:semicolon
id|pid
op_assign
id|current-&gt;pid
suffix:semicolon
id|rr
op_assign
id|event_ring
op_plus
id|event_ptr
suffix:semicolon
id|rr-&gt;evt
op_assign
l_int|0xfffe
suffix:semicolon
id|rr-&gt;ret_addr
op_assign
l_int|0
suffix:semicolon
id|rr-&gt;event
op_assign
l_int|0
suffix:semicolon
id|rr-&gt;tra
op_assign
l_int|0
suffix:semicolon
id|rr-&gt;pid
op_assign
id|pid
suffix:semicolon
id|rr-&gt;pc
op_assign
id|regs-&gt;pc
suffix:semicolon
id|event_ptr
op_assign
(paren
id|event_ptr
op_plus
l_int|1
)paren
op_amp
l_int|15
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_POOR_MANS_STRACE */
multiline_comment|/* ======================================================================= */
DECL|function|show_excp_regs
r_void
id|show_excp_regs
c_func
(paren
r_char
op_star
id|from
comma
r_int
id|trapnr
comma
r_int
id|signr
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
r_int
id|ah
comma
id|al
comma
id|bh
comma
id|bl
comma
id|ch
comma
id|cl
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;EXCEPTION - %s: task %d; Linux trap # %d; signal = %d&bslash;n&quot;
comma
(paren
(paren
id|from
)paren
ques
c_cond
id|from
suffix:colon
l_string|&quot;???&quot;
)paren
comma
id|current-&gt;pid
comma
id|trapnr
comma
id|signr
)paren
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;getcon   &quot;
id|__EXPEVT
l_string|&quot;, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|ah
)paren
)paren
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;getcon   &quot;
id|__EXPEVT
l_string|&quot;, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|al
)paren
)paren
suffix:semicolon
id|ah
op_assign
(paren
id|ah
)paren
op_rshift
l_int|32
suffix:semicolon
id|al
op_assign
(paren
id|al
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;getcon   &quot;
id|__KCR1
l_string|&quot;, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|bh
)paren
)paren
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;getcon   &quot;
id|__KCR1
l_string|&quot;, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|bl
)paren
)paren
suffix:semicolon
id|bh
op_assign
(paren
id|bh
)paren
op_rshift
l_int|32
suffix:semicolon
id|bl
op_assign
(paren
id|bl
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;getcon   &quot;
id|__INTEVT
l_string|&quot;, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|ch
)paren
)paren
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;getcon   &quot;
id|__INTEVT
l_string|&quot;, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|cl
)paren
)paren
suffix:semicolon
id|ch
op_assign
(paren
id|ch
)paren
op_rshift
l_int|32
suffix:semicolon
id|cl
op_assign
(paren
id|cl
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;EXPE: %08Lx%08Lx KCR1: %08Lx%08Lx INTE: %08Lx%08Lx&bslash;n&quot;
comma
id|ah
comma
id|al
comma
id|bh
comma
id|bl
comma
id|ch
comma
id|cl
)paren
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;getcon   &quot;
id|__PEXPEVT
l_string|&quot;, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|ah
)paren
)paren
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;getcon   &quot;
id|__PEXPEVT
l_string|&quot;, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|al
)paren
)paren
suffix:semicolon
id|ah
op_assign
(paren
id|ah
)paren
op_rshift
l_int|32
suffix:semicolon
id|al
op_assign
(paren
id|al
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;getcon   &quot;
id|__PSPC
l_string|&quot;, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|bh
)paren
)paren
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;getcon   &quot;
id|__PSPC
l_string|&quot;, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|bl
)paren
)paren
suffix:semicolon
id|bh
op_assign
(paren
id|bh
)paren
op_rshift
l_int|32
suffix:semicolon
id|bl
op_assign
(paren
id|bl
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;getcon   &quot;
id|__PSSR
l_string|&quot;, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|ch
)paren
)paren
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;getcon   &quot;
id|__PSSR
l_string|&quot;, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|cl
)paren
)paren
suffix:semicolon
id|ch
op_assign
(paren
id|ch
)paren
op_rshift
l_int|32
suffix:semicolon
id|cl
op_assign
(paren
id|cl
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;PEXP: %08Lx%08Lx PSPC: %08Lx%08Lx PSSR: %08Lx%08Lx&bslash;n&quot;
comma
id|ah
comma
id|al
comma
id|bh
comma
id|bl
comma
id|ch
comma
id|cl
)paren
suffix:semicolon
id|ah
op_assign
(paren
id|regs-&gt;pc
)paren
op_rshift
l_int|32
suffix:semicolon
id|al
op_assign
(paren
id|regs-&gt;pc
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|bh
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|18
)braket
)paren
op_rshift
l_int|32
suffix:semicolon
id|bl
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|18
)braket
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|ch
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|15
)braket
)paren
op_rshift
l_int|32
suffix:semicolon
id|cl
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|15
)braket
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;PC  : %08Lx%08Lx LINK: %08Lx%08Lx SP  : %08Lx%08Lx&bslash;n&quot;
comma
id|ah
comma
id|al
comma
id|bh
comma
id|bl
comma
id|ch
comma
id|cl
)paren
suffix:semicolon
id|ah
op_assign
(paren
id|regs-&gt;sr
)paren
op_rshift
l_int|32
suffix:semicolon
id|al
op_assign
(paren
id|regs-&gt;sr
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;getcon   &quot;
id|__TEA
l_string|&quot;, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|bh
)paren
)paren
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;getcon   &quot;
id|__TEA
l_string|&quot;, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|bl
)paren
)paren
suffix:semicolon
id|bh
op_assign
(paren
id|bh
)paren
op_rshift
l_int|32
suffix:semicolon
id|bl
op_assign
(paren
id|bl
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;getcon   &quot;
id|__KCR0
l_string|&quot;, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|ch
)paren
)paren
suffix:semicolon
id|asm
r_volatile
(paren
l_string|&quot;getcon   &quot;
id|__KCR0
l_string|&quot;, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|cl
)paren
)paren
suffix:semicolon
id|ch
op_assign
(paren
id|ch
)paren
op_rshift
l_int|32
suffix:semicolon
id|cl
op_assign
(paren
id|cl
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;SR  : %08Lx%08Lx TEA : %08Lx%08Lx KCR0: %08Lx%08Lx&bslash;n&quot;
comma
id|ah
comma
id|al
comma
id|bh
comma
id|bl
comma
id|ch
comma
id|cl
)paren
suffix:semicolon
id|ah
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|0
)braket
)paren
op_rshift
l_int|32
suffix:semicolon
id|al
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|0
)braket
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|bh
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|1
)braket
)paren
op_rshift
l_int|32
suffix:semicolon
id|bl
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|1
)braket
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|ch
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|2
)braket
)paren
op_rshift
l_int|32
suffix:semicolon
id|cl
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|2
)braket
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;R0  : %08Lx%08Lx R1  : %08Lx%08Lx R2  : %08Lx%08Lx&bslash;n&quot;
comma
id|ah
comma
id|al
comma
id|bh
comma
id|bl
comma
id|ch
comma
id|cl
)paren
suffix:semicolon
id|ah
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|3
)braket
)paren
op_rshift
l_int|32
suffix:semicolon
id|al
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|3
)braket
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|bh
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|4
)braket
)paren
op_rshift
l_int|32
suffix:semicolon
id|bl
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|4
)braket
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|ch
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|5
)braket
)paren
op_rshift
l_int|32
suffix:semicolon
id|cl
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|5
)braket
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;R3  : %08Lx%08Lx R4  : %08Lx%08Lx R5  : %08Lx%08Lx&bslash;n&quot;
comma
id|ah
comma
id|al
comma
id|bh
comma
id|bl
comma
id|ch
comma
id|cl
)paren
suffix:semicolon
id|ah
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|6
)braket
)paren
op_rshift
l_int|32
suffix:semicolon
id|al
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|6
)braket
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|bh
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|7
)braket
)paren
op_rshift
l_int|32
suffix:semicolon
id|bl
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|7
)braket
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|ch
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|8
)braket
)paren
op_rshift
l_int|32
suffix:semicolon
id|cl
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|8
)braket
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;R6  : %08Lx%08Lx R7  : %08Lx%08Lx R8  : %08Lx%08Lx&bslash;n&quot;
comma
id|ah
comma
id|al
comma
id|bh
comma
id|bl
comma
id|ch
comma
id|cl
)paren
suffix:semicolon
id|ah
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|9
)braket
)paren
op_rshift
l_int|32
suffix:semicolon
id|al
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|9
)braket
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|bh
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|10
)braket
)paren
op_rshift
l_int|32
suffix:semicolon
id|bl
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|10
)braket
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|ch
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|11
)braket
)paren
op_rshift
l_int|32
suffix:semicolon
id|cl
op_assign
(paren
id|regs-&gt;regs
(braket
l_int|11
)braket
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;R9  : %08Lx%08Lx R10 : %08Lx%08Lx R11 : %08Lx%08Lx&bslash;n&quot;
comma
id|ah
comma
id|al
comma
id|bh
comma
id|bl
comma
id|ch
comma
id|cl
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;....&bslash;n&quot;
)paren
suffix:semicolon
id|ah
op_assign
(paren
id|regs-&gt;tregs
(braket
l_int|0
)braket
)paren
op_rshift
l_int|32
suffix:semicolon
id|al
op_assign
(paren
id|regs-&gt;tregs
(braket
l_int|0
)braket
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|bh
op_assign
(paren
id|regs-&gt;tregs
(braket
l_int|1
)braket
)paren
op_rshift
l_int|32
suffix:semicolon
id|bl
op_assign
(paren
id|regs-&gt;tregs
(braket
l_int|1
)braket
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|ch
op_assign
(paren
id|regs-&gt;tregs
(braket
l_int|2
)braket
)paren
op_rshift
l_int|32
suffix:semicolon
id|cl
op_assign
(paren
id|regs-&gt;tregs
(braket
l_int|2
)braket
)paren
op_amp
l_int|0xffffffff
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;T0  : %08Lx%08Lx T1  : %08Lx%08Lx T2  : %08Lx%08Lx&bslash;n&quot;
comma
id|ah
comma
id|al
comma
id|bh
comma
id|bl
comma
id|ch
comma
id|cl
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;....&bslash;n&quot;
)paren
suffix:semicolon
id|print_dtlb
c_func
(paren
)paren
suffix:semicolon
id|print_itlb
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* ======================================================================= */
multiline_comment|/*&n;** Depending on &lt;base&gt; scan the MMU, Data or Instrction side&n;** looking for a valid mapping matching Eaddr &amp; asid.&n;** Return -1 if not found or the TLB id entry otherwise.&n;** Note: it works only for 4k pages!&n;*/
r_static
r_int
r_int
DECL|function|lookup_mmu_side
id|lookup_mmu_side
c_func
(paren
r_int
r_int
id|base
comma
r_int
r_int
id|Eaddr
comma
r_int
r_int
id|asid
)paren
(brace
id|regType_t
id|pteH
suffix:semicolon
r_int
r_int
id|epn
suffix:semicolon
r_int
id|count
suffix:semicolon
id|epn
op_assign
id|Eaddr
op_amp
l_int|0xfffff000
suffix:semicolon
r_for
c_loop
(paren
id|count
op_assign
l_int|0
suffix:semicolon
id|count
OL
id|MAX_TLBs
suffix:semicolon
id|count
op_increment
comma
id|base
op_add_assign
id|TLB_STEP
)paren
(brace
id|pteH
op_assign
id|getConfigReg
c_func
(paren
id|base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|GET_VALID
c_func
(paren
id|pteH
)paren
)paren
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
id|GET_EPN
c_func
(paren
id|pteH
)paren
op_eq
id|epn
)paren
r_if
c_cond
(paren
(paren
r_int
r_int
)paren
id|GET_ASID
c_func
(paren
id|pteH
)paren
op_eq
id|asid
)paren
r_break
suffix:semicolon
)brace
r_return
(paren
(paren
r_int
r_int
)paren
(paren
(paren
id|count
OL
id|MAX_TLBs
)paren
ques
c_cond
id|base
suffix:colon
op_minus
l_int|1
)paren
)paren
suffix:semicolon
)brace
DECL|function|lookup_dtlb
r_int
r_int
id|lookup_dtlb
c_func
(paren
r_int
r_int
id|Eaddr
)paren
(brace
r_int
r_int
id|asid
op_assign
id|get_asid
c_func
(paren
)paren
suffix:semicolon
r_return
(paren
id|lookup_mmu_side
c_func
(paren
(paren
id|u64
)paren
id|DTLB_BASE
comma
id|Eaddr
comma
id|asid
)paren
)paren
suffix:semicolon
)brace
DECL|function|lookup_itlb
r_int
r_int
id|lookup_itlb
c_func
(paren
r_int
r_int
id|Eaddr
)paren
(brace
r_int
r_int
id|asid
op_assign
id|get_asid
c_func
(paren
)paren
suffix:semicolon
r_return
(paren
id|lookup_mmu_side
c_func
(paren
(paren
id|u64
)paren
id|ITLB_BASE
comma
id|Eaddr
comma
id|asid
)paren
)paren
suffix:semicolon
)brace
DECL|function|print_page
r_void
id|print_page
c_func
(paren
r_struct
id|page
op_star
id|page
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;  page[%p] -&gt; index 0x%lx,  count 0x%x,  flags 0x%lx&bslash;n&quot;
comma
id|page
comma
id|page-&gt;index
comma
id|page_count
c_func
(paren
id|page
)paren
comma
id|page-&gt;flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;       address_space = %p, pages =%ld&bslash;n&quot;
comma
id|page-&gt;mapping
comma
id|page-&gt;mapping-&gt;nrpages
)paren
suffix:semicolon
)brace
eof
