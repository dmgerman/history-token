multiline_comment|/*&n; * arch/sh64/lib/udelay.c&n; *&n; * Delay routines, using a pre-computed &quot;loops_per_jiffy&quot; value.&n; *&n; * Copyright (C) 2000, 2001  Paolo Alberelli&n; * Copyright (C) 2003, 2004  Paul Mundt&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;asm/param.h&gt;
r_extern
r_int
r_int
id|loops_per_jiffy
suffix:semicolon
multiline_comment|/*&n; * Use only for very small delays (&lt; 1 msec).&n; *&n; * The active part of our cycle counter is only 32-bits wide, and&n; * we&squot;re treating the difference between two marks as signed.  On&n; * a 1GHz box, that&squot;s about 2 seconds.&n; */
DECL|function|__delay
r_void
id|__delay
c_func
(paren
r_int
id|loops
)paren
(brace
r_int
r_int
id|dummy
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;gettr&t;tr0, %1&bslash;n&bslash;t&quot;
l_string|&quot;pta&t;$+4, tr0&bslash;n&bslash;t&quot;
l_string|&quot;addi&t;%0, -1, %0&bslash;n&bslash;t&quot;
l_string|&quot;bne&t;%0, r63, tr0&bslash;n&bslash;t&quot;
l_string|&quot;ptabs&t;%1, tr0&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|loops
)paren
comma
l_string|&quot;=r&quot;
(paren
id|dummy
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|loops
)paren
)paren
suffix:semicolon
)brace
DECL|function|__udelay
r_void
id|__udelay
c_func
(paren
r_int
r_int
r_int
id|usecs
comma
r_int
r_int
id|lpj
)paren
(brace
id|usecs
op_mul_assign
(paren
(paren
(paren
r_int
r_int
r_int
)paren
id|HZ
op_lshift
l_int|32
)paren
op_div
l_int|1000000
)paren
op_star
id|lpj
suffix:semicolon
id|__delay
c_func
(paren
(paren
r_int
r_int
)paren
id|usecs
op_rshift
l_int|32
)paren
suffix:semicolon
)brace
DECL|function|__ndelay
r_void
id|__ndelay
c_func
(paren
r_int
r_int
r_int
id|nsecs
comma
r_int
r_int
id|lpj
)paren
(brace
id|nsecs
op_mul_assign
(paren
(paren
(paren
r_int
r_int
r_int
)paren
id|HZ
op_lshift
l_int|32
)paren
op_div
l_int|1000000000
)paren
op_star
id|lpj
suffix:semicolon
id|__delay
c_func
(paren
(paren
r_int
r_int
)paren
id|nsecs
op_rshift
l_int|32
)paren
suffix:semicolon
)brace
DECL|function|udelay
r_void
id|udelay
c_func
(paren
r_int
r_int
id|usecs
)paren
(brace
id|__udelay
c_func
(paren
id|usecs
comma
id|loops_per_jiffy
)paren
suffix:semicolon
)brace
DECL|function|ndelay
r_void
id|ndelay
c_func
(paren
r_int
r_int
id|nsecs
)paren
(brace
id|__ndelay
c_func
(paren
id|nsecs
comma
id|loops_per_jiffy
)paren
suffix:semicolon
)brace
eof
