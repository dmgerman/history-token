multiline_comment|/*&n; * arch/sh64/kernel/early_printk.c&n; *&n; * SH-5 Early SCIF console (cloned and hacked from sh implementation)&n; *&n; * Copyright (C) 2003, 2004  Paul Mundt &lt;lethal@linux-sh.org&gt;&n; * Copyright (C) 2002  M. R. Brown &lt;mrbrown@0xd6.org&gt;&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; */
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/hardware.h&gt;
DECL|macro|SCIF_BASE_ADDR
mdefine_line|#define SCIF_BASE_ADDR&t;0x01030000
DECL|macro|SCIF_ADDR_SH5
mdefine_line|#define SCIF_ADDR_SH5&t;PHYS_PERIPHERAL_BLOCK+SCIF_BASE_ADDR
multiline_comment|/*&n; * Fixed virtual address where SCIF is mapped (should already be done&n; * in arch/sh64/kernel/head.S!).&n; */
DECL|macro|SCIF_REG
mdefine_line|#define SCIF_REG&t;0xfa030000
r_enum
(brace
DECL|enumerator|SCIF_SCSMR2
id|SCIF_SCSMR2
op_assign
id|SCIF_REG
op_plus
l_int|0x00
comma
DECL|enumerator|SCIF_SCBRR2
id|SCIF_SCBRR2
op_assign
id|SCIF_REG
op_plus
l_int|0x04
comma
DECL|enumerator|SCIF_SCSCR2
id|SCIF_SCSCR2
op_assign
id|SCIF_REG
op_plus
l_int|0x08
comma
DECL|enumerator|SCIF_SCFTDR2
id|SCIF_SCFTDR2
op_assign
id|SCIF_REG
op_plus
l_int|0x0c
comma
DECL|enumerator|SCIF_SCFSR2
id|SCIF_SCFSR2
op_assign
id|SCIF_REG
op_plus
l_int|0x10
comma
DECL|enumerator|SCIF_SCFRDR2
id|SCIF_SCFRDR2
op_assign
id|SCIF_REG
op_plus
l_int|0x14
comma
DECL|enumerator|SCIF_SCFCR2
id|SCIF_SCFCR2
op_assign
id|SCIF_REG
op_plus
l_int|0x18
comma
DECL|enumerator|SCIF_SCFDR2
id|SCIF_SCFDR2
op_assign
id|SCIF_REG
op_plus
l_int|0x1c
comma
DECL|enumerator|SCIF_SCSPTR2
id|SCIF_SCSPTR2
op_assign
id|SCIF_REG
op_plus
l_int|0x20
comma
DECL|enumerator|SCIF_SCLSR2
id|SCIF_SCLSR2
op_assign
id|SCIF_REG
op_plus
l_int|0x24
comma
)brace
suffix:semicolon
DECL|function|sh_console_putc
r_static
r_void
id|sh_console_putc
c_func
(paren
r_int
id|c
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|ctrl_inw
c_func
(paren
id|SCIF_SCFSR2
)paren
op_amp
l_int|0x20
)paren
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
id|ctrl_outb
c_func
(paren
id|c
comma
id|SCIF_SCFTDR2
)paren
suffix:semicolon
id|ctrl_outw
c_func
(paren
(paren
id|ctrl_inw
c_func
(paren
id|SCIF_SCFSR2
)paren
op_amp
l_int|0x9f
)paren
comma
id|SCIF_SCFSR2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;&bslash;n&squot;
)paren
id|sh_console_putc
c_func
(paren
l_char|&squot;&bslash;r&squot;
)paren
suffix:semicolon
)brace
DECL|function|sh_console_flush
r_static
r_void
id|sh_console_flush
c_func
(paren
r_void
)paren
(brace
id|ctrl_outw
c_func
(paren
(paren
id|ctrl_inw
c_func
(paren
id|SCIF_SCFSR2
)paren
op_amp
l_int|0xbf
)paren
comma
id|SCIF_SCFSR2
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|ctrl_inw
c_func
(paren
id|SCIF_SCFSR2
)paren
op_amp
l_int|0x40
)paren
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
id|ctrl_outw
c_func
(paren
(paren
id|ctrl_inw
c_func
(paren
id|SCIF_SCFSR2
)paren
op_amp
l_int|0xbf
)paren
comma
id|SCIF_SCFSR2
)paren
suffix:semicolon
)brace
DECL|function|sh_console_write
r_static
r_void
id|sh_console_write
c_func
(paren
r_struct
id|console
op_star
id|con
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
)paren
(brace
r_while
c_loop
(paren
id|count
op_decrement
OG
l_int|0
)paren
id|sh_console_putc
c_func
(paren
op_star
id|s
op_increment
)paren
suffix:semicolon
id|sh_console_flush
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|sh_console_setup
r_static
r_int
id|__init
id|sh_console_setup
c_func
(paren
r_struct
id|console
op_star
id|con
comma
r_char
op_star
id|options
)paren
(brace
id|con-&gt;cflag
op_assign
id|CREAD
op_or
id|HUPCL
op_or
id|CLOCAL
op_or
id|B19200
op_or
id|CS8
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|sh_console
r_static
r_struct
id|console
id|sh_console
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;scifcon&quot;
comma
dot
id|write
op_assign
id|sh_console_write
comma
dot
id|setup
op_assign
id|sh_console_setup
comma
dot
id|flags
op_assign
id|CON_PRINTBUFFER
comma
dot
id|index
op_assign
op_minus
l_int|1
comma
)brace
suffix:semicolon
DECL|function|enable_early_printk
r_void
id|__init
id|enable_early_printk
c_func
(paren
r_void
)paren
(brace
id|ctrl_outb
c_func
(paren
l_int|0x2a
comma
id|SCIF_SCBRR2
)paren
suffix:semicolon
multiline_comment|/* 19200bps */
id|ctrl_outw
c_func
(paren
l_int|0x04
comma
id|SCIF_SCFCR2
)paren
suffix:semicolon
multiline_comment|/* Reset TFRST */
id|ctrl_outw
c_func
(paren
l_int|0x10
comma
id|SCIF_SCFCR2
)paren
suffix:semicolon
multiline_comment|/* TTRG0=1 */
id|ctrl_outw
c_func
(paren
l_int|0
comma
id|SCIF_SCSPTR2
)paren
suffix:semicolon
id|ctrl_outw
c_func
(paren
l_int|0x60
comma
id|SCIF_SCFSR2
)paren
suffix:semicolon
id|ctrl_outw
c_func
(paren
l_int|0
comma
id|SCIF_SCLSR2
)paren
suffix:semicolon
id|ctrl_outw
c_func
(paren
l_int|0x30
comma
id|SCIF_SCSCR2
)paren
suffix:semicolon
id|register_console
c_func
(paren
op_amp
id|sh_console
)paren
suffix:semicolon
)brace
DECL|function|disable_early_printk
r_void
id|disable_early_printk
c_func
(paren
r_void
)paren
(brace
id|unregister_console
c_func
(paren
op_amp
id|sh_console
)paren
suffix:semicolon
)brace
eof
