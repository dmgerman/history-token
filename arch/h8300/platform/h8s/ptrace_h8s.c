multiline_comment|/*&n; *  linux/arch/h8300/platform/h8s/ptrace_h8s.c&n; *    ptrace cpu depend helper functions&n; *&n; *  Yoshinori Sato &lt;ysato@users.sourceforge.jp&gt;&n; *&n; * This file is subject to the terms and conditions of the GNU General&n; * Public License.  See the file COPYING in the main directory of&n; * this archive for more details.&n; */
macro_line|#include &lt;linux/linkage.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
DECL|macro|CCR_MASK
mdefine_line|#define CCR_MASK  0x6f
DECL|macro|EXR_TRACE
mdefine_line|#define EXR_TRACE 0x80
multiline_comment|/* Mapping from PT_xxx to the stack offset at which the register is&n;   saved.  Notice that usp has no stack-slot and needs to be treated&n;   specially (see get_reg/put_reg below). */
DECL|variable|h8300_register_offset
r_static
r_const
r_int
id|h8300_register_offset
(braket
)braket
op_assign
(brace
id|PT_REG
c_func
(paren
id|er1
)paren
comma
id|PT_REG
c_func
(paren
id|er2
)paren
comma
id|PT_REG
c_func
(paren
id|er3
)paren
comma
id|PT_REG
c_func
(paren
id|er4
)paren
comma
id|PT_REG
c_func
(paren
id|er5
)paren
comma
id|PT_REG
c_func
(paren
id|er6
)paren
comma
id|PT_REG
c_func
(paren
id|er0
)paren
comma
id|PT_REG
c_func
(paren
id|orig_er0
)paren
comma
id|PT_REG
c_func
(paren
id|ccr
)paren
comma
id|PT_REG
c_func
(paren
id|pc
)paren
comma
id|PT_REG
c_func
(paren
id|exr
)paren
)brace
suffix:semicolon
multiline_comment|/* read register */
DECL|function|h8300_get_reg
r_int
id|h8300_get_reg
c_func
(paren
r_struct
id|task_struct
op_star
id|task
comma
r_int
id|regno
)paren
(brace
r_switch
c_cond
(paren
id|regno
)paren
(brace
r_case
id|PT_USP
suffix:colon
r_return
id|task-&gt;thread.usp
op_plus
r_sizeof
(paren
r_int
)paren
op_star
l_int|2
op_plus
l_int|2
suffix:semicolon
r_case
id|PT_CCR
suffix:colon
r_case
id|PT_EXR
suffix:colon
r_return
op_star
(paren
r_int
r_int
op_star
)paren
(paren
id|task-&gt;thread.esp0
op_plus
id|h8300_register_offset
(braket
id|regno
)braket
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_star
(paren
r_int
r_int
op_star
)paren
(paren
id|task-&gt;thread.esp0
op_plus
id|h8300_register_offset
(braket
id|regno
)braket
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* write register */
DECL|function|h8300_put_reg
r_int
id|h8300_put_reg
c_func
(paren
r_struct
id|task_struct
op_star
id|task
comma
r_int
id|regno
comma
r_int
r_int
id|data
)paren
(brace
r_int
r_int
id|oldccr
suffix:semicolon
r_switch
c_cond
(paren
id|regno
)paren
(brace
r_case
id|PT_USP
suffix:colon
id|task-&gt;thread.usp
op_assign
id|data
op_minus
r_sizeof
(paren
r_int
)paren
op_star
l_int|2
op_minus
l_int|2
suffix:semicolon
r_case
id|PT_CCR
suffix:colon
id|oldccr
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
(paren
id|task-&gt;thread.esp0
op_plus
id|h8300_register_offset
(braket
id|regno
)braket
)paren
suffix:semicolon
id|oldccr
op_and_assign
op_complement
id|CCR_MASK
suffix:semicolon
id|data
op_and_assign
id|CCR_MASK
suffix:semicolon
id|data
op_or_assign
id|oldccr
suffix:semicolon
op_star
(paren
r_int
r_int
op_star
)paren
(paren
id|task-&gt;thread.esp0
op_plus
id|h8300_register_offset
(braket
id|regno
)braket
)paren
op_assign
id|data
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PT_EXR
suffix:colon
multiline_comment|/* exr modify not support */
r_return
op_minus
id|EIO
suffix:semicolon
r_default
suffix:colon
op_star
(paren
r_int
r_int
op_star
)paren
(paren
id|task-&gt;thread.esp0
op_plus
id|h8300_register_offset
(braket
id|regno
)braket
)paren
op_assign
id|data
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* disable singlestep */
DECL|function|h8300_disable_trace
r_void
id|h8300_disable_trace
c_func
(paren
r_struct
id|task_struct
op_star
id|child
)paren
(brace
op_star
(paren
r_int
r_int
op_star
)paren
(paren
id|child-&gt;thread.esp0
op_plus
id|h8300_register_offset
(braket
id|PT_EXR
)braket
)paren
op_and_assign
op_complement
id|EXR_TRACE
suffix:semicolon
)brace
multiline_comment|/* enable singlestep */
DECL|function|h8300_enable_trace
r_void
id|h8300_enable_trace
c_func
(paren
r_struct
id|task_struct
op_star
id|child
)paren
(brace
op_star
(paren
r_int
r_int
op_star
)paren
(paren
id|child-&gt;thread.esp0
op_plus
id|h8300_register_offset
(braket
id|PT_EXR
)braket
)paren
op_or_assign
id|EXR_TRACE
suffix:semicolon
)brace
DECL|function|trace_trap
id|asmlinkage
r_void
id|trace_trap
c_func
(paren
r_int
r_int
id|bp
)paren
(brace
(paren
r_void
)paren
id|bp
suffix:semicolon
id|force_sig
c_func
(paren
id|SIGTRAP
comma
id|current
)paren
suffix:semicolon
)brace
eof
