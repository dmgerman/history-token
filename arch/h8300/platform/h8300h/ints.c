multiline_comment|/*&n; * linux/arch/h8300/platform/h8300h/ints.c&n; *&n; * Yoshinori Sato &lt;ysato@users.sourceforge.jp&gt;&n; *&n; * Based on linux/arch/$(ARCH)/platform/$(PLATFORM)/ints.c&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file COPYING in the main directory of this archive&n; * for more details.&n; *&n; * Copyright 1996 Roman Zippel&n; * Copyright 1999 D. Jeff Dionne &lt;jeff@rt-control.com&gt;&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/kernel_stat.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/traps.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/setup.h&gt;
macro_line|#include &lt;asm/gpio.h&gt;
macro_line|#include &lt;asm/hardirq.h&gt;
macro_line|#include &lt;asm/regs306x.h&gt;
DECL|macro|INTERNAL_IRQS
mdefine_line|#define INTERNAL_IRQS (64)
DECL|macro|EXT_IRQ0
mdefine_line|#define EXT_IRQ0 12
DECL|macro|EXT_IRQ1
mdefine_line|#define EXT_IRQ1 13
DECL|macro|EXT_IRQ2
mdefine_line|#define EXT_IRQ2 14
DECL|macro|EXT_IRQ3
mdefine_line|#define EXT_IRQ3 15
DECL|macro|EXT_IRQ4
mdefine_line|#define EXT_IRQ4 16
DECL|macro|EXT_IRQ5
mdefine_line|#define EXT_IRQ5 17
DECL|macro|EXT_IRQ6
mdefine_line|#define EXT_IRQ6 18
DECL|macro|EXT_IRQ7
mdefine_line|#define EXT_IRQ7 19
DECL|macro|WDT_IRQ
mdefine_line|#define WDT_IRQ 20
multiline_comment|/* table for system interrupt handlers */
DECL|variable|irq_list
r_static
id|irq_handler_t
id|irq_list
(braket
id|SYS_IRQS
)braket
suffix:semicolon
multiline_comment|/* The number of spurious interrupts */
DECL|variable|num_spurious
r_volatile
r_int
r_int
id|num_spurious
suffix:semicolon
multiline_comment|/* assembler routines */
id|asmlinkage
r_void
id|system_call
c_func
(paren
r_void
)paren
suffix:semicolon
id|asmlinkage
r_void
id|bad_interrupt
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/* irq node variables for the 32 (potential) on chip sources */
multiline_comment|/*static irq_node_t *int_irq_list[INTERNAL_IRQS];*/
DECL|variable|int_irq_count
r_static
r_int
id|int_irq_count
(braket
id|INTERNAL_IRQS
)braket
suffix:semicolon
macro_line|#if 0
r_static
r_void
id|int_badint
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
(brace
id|num_spurious
op_add_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
DECL|function|init_IRQ
r_void
id|init_IRQ
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|SYS_IRQS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|irq_list
(braket
id|i
)braket
dot
id|handler
op_assign
l_int|NULL
suffix:semicolon
id|irq_list
(braket
id|i
)braket
dot
id|flags
op_assign
l_int|0
suffix:semicolon
id|irq_list
(braket
id|i
)braket
dot
id|devname
op_assign
l_int|NULL
suffix:semicolon
id|irq_list
(braket
id|i
)braket
dot
id|dev_id
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
DECL|function|request_irq
r_int
id|request_irq
c_func
(paren
r_int
r_int
id|irq
comma
r_void
(paren
op_star
id|handler
)paren
(paren
r_int
comma
r_void
op_star
comma
r_struct
id|pt_regs
op_star
)paren
comma
r_int
r_int
id|flags
comma
r_const
r_char
op_star
id|devname
comma
r_void
op_star
id|dev_id
)paren
(brace
r_if
c_cond
(paren
id|irq
op_ge
id|EXT_IRQ0
op_logical_and
id|irq
op_le
id|EXT_IRQ3
)paren
(brace
r_if
c_cond
(paren
id|H8300_GPIO_RESERVE
c_func
(paren
id|H8300_GPIO_P8
comma
l_int|1
op_lshift
(paren
id|irq
op_minus
id|EXT_IRQ0
)paren
)paren
op_eq
l_int|0
)paren
r_return
l_int|1
suffix:semicolon
id|H8300_GPIO_DDR
c_func
(paren
id|H8300_GPIO_P8
comma
(paren
id|irq
op_minus
id|EXT_IRQ0
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|irq
op_ge
id|EXT_IRQ4
op_logical_and
id|irq
op_le
id|EXT_IRQ5
)paren
(brace
r_if
c_cond
(paren
id|H8300_GPIO_RESERVE
c_func
(paren
id|H8300_GPIO_P9
comma
l_int|1
op_lshift
(paren
id|irq
op_minus
id|EXT_IRQ0
)paren
)paren
op_eq
l_int|0
)paren
r_return
l_int|1
suffix:semicolon
id|H8300_GPIO_DDR
c_func
(paren
id|H8300_GPIO_P9
comma
(paren
id|irq
op_minus
id|EXT_IRQ0
)paren
comma
l_int|0
)paren
suffix:semicolon
)brace
id|irq_list
(braket
id|irq
)braket
dot
id|handler
op_assign
id|handler
suffix:semicolon
id|irq_list
(braket
id|irq
)braket
dot
id|flags
op_assign
id|flags
suffix:semicolon
id|irq_list
(braket
id|irq
)braket
dot
id|devname
op_assign
id|devname
suffix:semicolon
id|irq_list
(braket
id|irq
)braket
dot
id|dev_id
op_assign
id|dev_id
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_ge
id|EXT_IRQ0
op_logical_and
id|irq
op_le
id|EXT_IRQ5
)paren
op_star
(paren
r_volatile
r_int
r_char
op_star
)paren
id|IER
op_or_assign
l_int|1
op_lshift
(paren
id|irq
op_minus
id|EXT_IRQ0
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|free_irq
r_void
id|free_irq
c_func
(paren
r_int
r_int
id|irq
comma
r_void
op_star
id|dev_id
)paren
(brace
r_if
c_cond
(paren
id|irq_list
(braket
id|irq
)braket
dot
id|dev_id
op_ne
id|dev_id
)paren
id|printk
c_func
(paren
l_string|&quot;%s: Removing probably wrong IRQ %d from %s&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|irq
comma
id|irq_list
(braket
id|irq
)braket
dot
id|devname
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_ge
id|EXT_IRQ0
op_logical_and
id|irq
op_le
id|EXT_IRQ5
)paren
op_star
(paren
r_volatile
r_int
r_char
op_star
)paren
id|IER
op_and_assign
op_complement
(paren
l_int|1
op_lshift
(paren
id|irq
op_minus
id|EXT_IRQ0
)paren
)paren
suffix:semicolon
id|irq_list
(braket
id|irq
)braket
dot
id|handler
op_assign
l_int|NULL
suffix:semicolon
id|irq_list
(braket
id|irq
)braket
dot
id|flags
op_assign
l_int|0
suffix:semicolon
id|irq_list
(braket
id|irq
)braket
dot
id|dev_id
op_assign
l_int|NULL
suffix:semicolon
id|irq_list
(braket
id|irq
)braket
dot
id|devname
op_assign
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * Do we need these probe functions on the m68k?&n; */
DECL|function|probe_irq_on
r_int
r_int
id|probe_irq_on
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|probe_irq_off
r_int
id|probe_irq_off
(paren
r_int
r_int
id|irqs
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|struct|int_regs
r_struct
id|int_regs
(brace
DECL|member|ier
r_int
r_int
id|ier
suffix:semicolon
DECL|member|isr
r_int
r_int
id|isr
suffix:semicolon
DECL|member|mask
r_int
r_char
id|mask
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|REGS_DEF
mdefine_line|#define REGS_DEF(ier,isr,mask) {ier,isr,mask}
DECL|variable|interrupt_registers
r_const
r_struct
id|int_regs
id|interrupt_registers
(braket
)braket
op_assign
(brace
id|REGS_DEF
c_func
(paren
id|IER
comma
id|ISR
comma
l_int|0x01
)paren
comma
id|REGS_DEF
c_func
(paren
id|IER
comma
id|ISR
comma
l_int|0x02
)paren
comma
id|REGS_DEF
c_func
(paren
id|IER
comma
id|ISR
comma
l_int|0x04
)paren
comma
id|REGS_DEF
c_func
(paren
id|IER
comma
id|ISR
comma
l_int|0x08
)paren
comma
id|REGS_DEF
c_func
(paren
id|IER
comma
id|ISR
comma
l_int|0x10
)paren
comma
id|REGS_DEF
c_func
(paren
id|IER
comma
id|ISR
comma
l_int|0x20
)paren
comma
id|REGS_DEF
c_func
(paren
id|IER
comma
id|ISR
comma
l_int|0x40
)paren
comma
id|REGS_DEF
c_func
(paren
id|IER
comma
id|ISR
comma
l_int|0x80
)paren
comma
id|REGS_DEF
c_func
(paren
id|TCSR
comma
id|TCSR
comma
l_int|0x20
)paren
comma
id|REGS_DEF
c_func
(paren
id|RTMCSR
comma
id|RTMCSR
comma
l_int|0x40
)paren
comma
id|REGS_DEF
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|0
)paren
comma
id|REGS_DEF
c_func
(paren
id|ADCSR
comma
id|ADCSR
comma
l_int|0x40
)paren
comma
id|REGS_DEF
c_func
(paren
id|TISRA
comma
id|TISRA
comma
l_int|0x10
)paren
comma
id|REGS_DEF
c_func
(paren
id|TISRB
comma
id|TISRB
comma
l_int|0x10
)paren
comma
id|REGS_DEF
c_func
(paren
id|TISRC
comma
id|TISRC
comma
l_int|0x10
)paren
comma
id|REGS_DEF
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|0
)paren
comma
id|REGS_DEF
c_func
(paren
id|TISRA
comma
id|TISRA
comma
l_int|0x20
)paren
comma
id|REGS_DEF
c_func
(paren
id|TISRB
comma
id|TISRB
comma
l_int|0x20
)paren
comma
id|REGS_DEF
c_func
(paren
id|TISRC
comma
id|TISRC
comma
l_int|0x20
)paren
comma
id|REGS_DEF
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|0
)paren
comma
id|REGS_DEF
c_func
(paren
id|TISRA
comma
id|TISRA
comma
l_int|0x40
)paren
comma
id|REGS_DEF
c_func
(paren
id|TISRB
comma
id|TISRB
comma
l_int|0x40
)paren
comma
id|REGS_DEF
c_func
(paren
id|TISRC
comma
id|TISRC
comma
l_int|0x40
)paren
comma
id|REGS_DEF
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|0
)paren
comma
id|REGS_DEF
c_func
(paren
id|_8TCR0
comma
id|_8TCSR0
comma
l_int|0x40
)paren
comma
id|REGS_DEF
c_func
(paren
id|_8TCR0
comma
id|_8TCSR0
comma
l_int|0x80
)paren
comma
id|REGS_DEF
c_func
(paren
id|_8TCR1
comma
id|_8TCSR1
comma
l_int|0xC0
)paren
comma
id|REGS_DEF
c_func
(paren
id|_8TCR0
comma
id|_8TCSR0
comma
l_int|0x20
)paren
comma
id|REGS_DEF
c_func
(paren
id|_8TCR2
comma
id|_8TCSR2
comma
l_int|0x40
)paren
comma
id|REGS_DEF
c_func
(paren
id|_8TCR2
comma
id|_8TCSR2
comma
l_int|0x80
)paren
comma
id|REGS_DEF
c_func
(paren
id|_8TCR3
comma
id|_8TCSR3
comma
l_int|0xC0
)paren
comma
id|REGS_DEF
c_func
(paren
id|_8TCR2
comma
id|_8TCSR2
comma
l_int|0x20
)paren
comma
id|REGS_DEF
c_func
(paren
id|DTCR0A
comma
id|DTCR0A
comma
l_int|0x0
)paren
comma
id|REGS_DEF
c_func
(paren
id|DTCR0B
comma
id|DTCR0B
comma
l_int|0x0
)paren
comma
id|REGS_DEF
c_func
(paren
id|DTCR1A
comma
id|DTCR1A
comma
l_int|0x0
)paren
comma
id|REGS_DEF
c_func
(paren
id|DTCR1B
comma
id|DTCR1B
comma
l_int|0x0
)paren
comma
id|REGS_DEF
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|0
)paren
comma
id|REGS_DEF
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|0
)paren
comma
id|REGS_DEF
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|0
)paren
comma
id|REGS_DEF
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|0
)paren
comma
id|REGS_DEF
c_func
(paren
id|SCR0
comma
id|SSR0
comma
l_int|0x40
)paren
comma
id|REGS_DEF
c_func
(paren
id|SCR0
comma
id|SSR0
comma
l_int|0x40
)paren
comma
id|REGS_DEF
c_func
(paren
id|SCR0
comma
id|SSR0
comma
l_int|0x80
)paren
comma
id|REGS_DEF
c_func
(paren
id|SCR0
comma
id|SSR0
comma
l_int|0x04
)paren
comma
id|REGS_DEF
c_func
(paren
id|SCR1
comma
id|SSR1
comma
l_int|0x40
)paren
comma
id|REGS_DEF
c_func
(paren
id|SCR1
comma
id|SSR1
comma
l_int|0x40
)paren
comma
id|REGS_DEF
c_func
(paren
id|SCR1
comma
id|SSR1
comma
l_int|0x80
)paren
comma
id|REGS_DEF
c_func
(paren
id|SCR1
comma
id|SSR1
comma
l_int|0x04
)paren
comma
id|REGS_DEF
c_func
(paren
id|SCR2
comma
id|SSR2
comma
l_int|0x40
)paren
comma
id|REGS_DEF
c_func
(paren
id|SCR2
comma
id|SSR2
comma
l_int|0x40
)paren
comma
id|REGS_DEF
c_func
(paren
id|SCR2
comma
id|SSR2
comma
l_int|0x80
)paren
comma
id|REGS_DEF
c_func
(paren
id|SCR2
comma
id|SSR2
comma
l_int|0x04
)paren
)brace
suffix:semicolon
DECL|function|enable_irq
r_void
id|enable_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_char
id|ier
suffix:semicolon
r_const
r_struct
id|int_regs
op_star
id|regs
op_assign
op_amp
id|interrupt_registers
(braket
id|irq
op_minus
l_int|12
)braket
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_eq
id|WDT_IRQ
)paren
(brace
id|ier
op_assign
id|ctrl_inb
c_func
(paren
id|TCSR
)paren
suffix:semicolon
id|ier
op_or_assign
l_int|0x20
suffix:semicolon
id|ctrl_outb
c_func
(paren
(paren
l_int|0xa500
op_or
id|ier
)paren
comma
id|TCSR
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|irq
OG
l_int|12
)paren
op_logical_and
id|regs-&gt;ier
)paren
(brace
id|ier
op_assign
id|ctrl_inb
c_func
(paren
id|regs-&gt;ier
)paren
suffix:semicolon
id|ier
op_or_assign
id|regs-&gt;mask
suffix:semicolon
id|ctrl_outb
c_func
(paren
id|ier
comma
id|regs-&gt;ier
)paren
suffix:semicolon
)brace
r_else
id|panic
c_func
(paren
l_string|&quot;Unknown interrupt vector&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|disable_irq
r_void
id|disable_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_char
id|ier
suffix:semicolon
r_const
r_struct
id|int_regs
op_star
id|regs
op_assign
op_amp
id|interrupt_registers
(braket
id|irq
op_minus
l_int|12
)braket
suffix:semicolon
r_if
c_cond
(paren
id|irq
op_eq
id|WDT_IRQ
)paren
(brace
id|ier
op_assign
id|ctrl_inb
c_func
(paren
id|TCSR
)paren
suffix:semicolon
id|ier
op_and_assign
op_complement
l_int|0x20
suffix:semicolon
id|ctrl_outb
c_func
(paren
(paren
l_int|0xa500
op_or
id|ier
)paren
comma
id|TCSR
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|irq
OG
l_int|12
)paren
op_logical_and
id|regs-&gt;ier
)paren
(brace
id|ier
op_assign
id|ctrl_inb
c_func
(paren
id|regs-&gt;ier
)paren
suffix:semicolon
id|ier
op_and_assign
op_complement
(paren
id|regs-&gt;mask
)paren
suffix:semicolon
id|ctrl_outb
c_func
(paren
id|ier
comma
id|regs-&gt;ier
)paren
suffix:semicolon
)brace
r_else
id|panic
c_func
(paren
l_string|&quot;Unknown interrupt vector&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|process_int
id|asmlinkage
r_void
id|process_int
c_func
(paren
r_int
r_int
id|vec
comma
r_struct
id|pt_regs
op_star
id|fp
)paren
(brace
id|irq_enter
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq_list
(braket
id|vec
)braket
dot
id|handler
)paren
(brace
id|irq_list
(braket
id|vec
)braket
dot
id|handler
c_func
(paren
id|vec
comma
id|irq_list
(braket
id|vec
)braket
dot
id|dev_id
comma
id|fp
)paren
suffix:semicolon
id|int_irq_count
(braket
id|vec
)braket
op_increment
suffix:semicolon
)brace
r_else
id|panic
c_func
(paren
l_string|&quot;No interrupt handler for %ld&bslash;n&quot;
comma
id|vec
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vec
op_ge
id|EXT_IRQ0
op_logical_and
id|vec
op_le
id|EXT_IRQ5
)paren
op_star
(paren
r_volatile
r_int
r_char
op_star
)paren
id|ISR
op_and_assign
op_complement
(paren
l_int|1
op_lshift
(paren
id|vec
op_minus
id|EXT_IRQ0
)paren
)paren
suffix:semicolon
id|irq_exit
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|show_interrupts
r_int
id|show_interrupts
c_func
(paren
r_struct
id|seq_file
op_star
id|p
comma
r_void
op_star
id|v
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_IRQS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|seq_printf
c_func
(paren
id|p
comma
l_string|&quot;%3d: %10u &quot;
comma
id|i
comma
id|int_irq_count
(braket
id|i
)braket
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|p
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|irq_list
(braket
id|i
)braket
dot
id|devname
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|init_irq_proc
r_void
id|init_irq_proc
c_func
(paren
r_void
)paren
(brace
)brace
eof
