multiline_comment|/*&n; *  linux/arch/h8300/kernel/gpio.c&n; *&n; *  Yoshinori Sato &lt;ysato@users.sourceforge.jp&gt;&n; *&n; */
multiline_comment|/*&n; * H8/300H Internal I/O Port Management&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/stddef.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#if defined(CONFIG_H83007) || defined(CONFIG_H83068)
DECL|macro|P1DDR
mdefine_line|#define P1DDR (unsigned char *)0xfee000
DECL|macro|P2DDR
mdefine_line|#define P2DDR (unsigned char *)0xfee001
DECL|macro|P3DDR
mdefine_line|#define P3DDR (unsigned char *)0xfee002
DECL|macro|P4DDR
mdefine_line|#define P4DDR (unsigned char *)0xfee003
DECL|macro|P5DDR
mdefine_line|#define P5DDR (unsigned char *)0xfee004
DECL|macro|P6DDR
mdefine_line|#define P6DDR (unsigned char *)0xfee005
DECL|macro|P8DDR
mdefine_line|#define P8DDR (unsigned char *)0xfee007
DECL|macro|P9DDR
mdefine_line|#define P9DDR (unsigned char *)0xfee008
DECL|macro|PADDR
mdefine_line|#define PADDR (unsigned char *)0xfee009
DECL|macro|PBDDR
mdefine_line|#define PBDDR (unsigned char *)0xfee00A
macro_line|#endif
macro_line|#if defined(CONFIG_H83002) || defined(CONFIG_H8048)
DECL|macro|P1DDR
mdefine_line|#define P1DDR (unsigned char *)0xffffc0
DECL|macro|P2DDR
mdefine_line|#define P2DDR (unsigned char *)0xffffc1
DECL|macro|P3DDR
mdefine_line|#define P3DDR (unsigned char *)0xffffc4
DECL|macro|P4DDR
mdefine_line|#define P4DDR (unsigned char *)0xffffc5
DECL|macro|P5DDR
mdefine_line|#define P5DDR (unsigned char *)0xffffc8
DECL|macro|P6DDR
mdefine_line|#define P6DDR (unsigned char *)0xffffc9
DECL|macro|P8DDR
mdefine_line|#define P8DDR (unsigned char *)0xffffcd
DECL|macro|P9DDR
mdefine_line|#define P9DDR (unsigned char *)0xffffd0
DECL|macro|PADDR
mdefine_line|#define PADDR (unsigned char *)0xffffd1
DECL|macro|PBDDR
mdefine_line|#define PBDDR (unsigned char *)0xffffd4
macro_line|#endif
macro_line|#if defined(P1DDR)
DECL|macro|MAX_PORT
mdefine_line|#define MAX_PORT 11
r_static
r_struct
(brace
DECL|member|used
r_int
r_char
id|used
suffix:semicolon
DECL|member|ddr
r_int
r_char
id|ddr
suffix:semicolon
DECL|variable|gpio_regs
)brace
id|gpio_regs
(braket
id|MAX_PORT
)braket
suffix:semicolon
DECL|variable|ddrs
r_static
r_volatile
r_int
r_char
op_star
id|ddrs
(braket
)braket
op_assign
(brace
id|P1DDR
comma
id|P2DDR
comma
id|P3DDR
comma
id|P4DDR
comma
id|P5DDR
comma
id|P6DDR
comma
l_int|NULL
comma
id|P8DDR
comma
id|P9DDR
comma
id|PADDR
comma
id|PBDDR
comma
)brace
suffix:semicolon
r_extern
r_char
op_star
id|_platform_gpio_table
c_func
(paren
r_int
id|length
)paren
suffix:semicolon
DECL|function|h8300_reserved_gpio
r_int
id|h8300_reserved_gpio
c_func
(paren
r_int
id|port
comma
r_int
r_int
id|bits
)paren
(brace
r_int
r_char
op_star
id|used
suffix:semicolon
r_if
c_cond
(paren
id|port
OL
l_int|0
op_logical_or
id|port
op_ge
id|MAX_PORT
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|used
op_assign
op_amp
(paren
id|gpio_regs
(braket
id|port
)braket
dot
id|used
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|used
op_amp
id|bits
)paren
op_ne
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|used
op_or_assign
id|bits
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|h8300_free_gpio
r_int
id|h8300_free_gpio
c_func
(paren
r_int
id|port
comma
r_int
r_int
id|bits
)paren
(brace
r_int
r_char
op_star
id|used
suffix:semicolon
r_if
c_cond
(paren
id|port
OL
l_int|0
op_logical_or
id|port
op_ge
id|MAX_PORT
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|used
op_assign
op_amp
(paren
id|gpio_regs
(braket
id|port
)braket
dot
id|used
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_star
id|used
op_amp
id|bits
)paren
op_ne
id|bits
)paren
r_return
l_int|0
suffix:semicolon
op_star
id|used
op_and_assign
(paren
op_complement
id|bits
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|h8300_set_gpio_dir
r_int
id|h8300_set_gpio_dir
c_func
(paren
r_int
id|port_bit
comma
r_int
id|dir
)paren
(brace
r_const
r_int
r_char
id|mask
(braket
)braket
op_assign
initialization_block
suffix:semicolon
r_int
id|port
op_assign
(paren
id|port_bit
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|bit
op_assign
id|port_bit
op_amp
l_int|0x07
suffix:semicolon
r_if
c_cond
(paren
id|ddrs
(braket
id|port
)braket
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|gpio_regs
(braket
id|port
)braket
dot
id|used
op_amp
id|mask
(braket
id|bit
)braket
)paren
(brace
r_if
c_cond
(paren
id|dir
)paren
id|gpio_regs
(braket
id|port
)braket
dot
id|ddr
op_or_assign
id|mask
(braket
id|bit
)braket
suffix:semicolon
r_else
id|gpio_regs
(braket
id|port
)braket
dot
id|ddr
op_and_assign
op_complement
id|mask
(braket
id|bit
)braket
suffix:semicolon
op_star
id|ddrs
(braket
id|port
)braket
op_assign
id|gpio_regs
(braket
id|port
)braket
dot
id|ddr
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_else
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|h8300_get_gpio_dir
r_int
id|h8300_get_gpio_dir
c_func
(paren
r_int
id|port_bit
)paren
(brace
r_const
r_int
r_char
id|mask
(braket
)braket
op_assign
initialization_block
suffix:semicolon
r_int
id|port
op_assign
(paren
id|port_bit
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
r_int
id|bit
op_assign
id|port_bit
op_amp
l_int|0x07
suffix:semicolon
r_if
c_cond
(paren
id|ddrs
(braket
id|port
)braket
op_eq
l_int|NULL
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|gpio_regs
(braket
id|port
)braket
dot
id|used
op_amp
id|mask
(braket
id|bit
)braket
)paren
(brace
r_return
(paren
id|gpio_regs
(braket
id|port
)braket
dot
id|ddr
op_amp
id|mask
(braket
id|bit
)braket
)paren
op_ne
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#if defined(CONFIG_PROC_FS)
DECL|function|port_status
r_static
r_char
op_star
id|port_status
c_func
(paren
r_int
id|portno
)paren
(brace
r_static
r_char
id|result
(braket
l_int|10
)braket
suffix:semicolon
r_const
r_static
r_char
id|io
(braket
l_int|2
)braket
op_assign
initialization_block
suffix:semicolon
r_char
op_star
id|rp
suffix:semicolon
r_int
id|c
suffix:semicolon
r_int
r_char
id|used
comma
id|ddr
suffix:semicolon
id|used
op_assign
id|gpio_regs
(braket
id|portno
)braket
dot
id|used
suffix:semicolon
id|ddr
op_assign
id|gpio_regs
(braket
id|portno
)braket
dot
id|ddr
suffix:semicolon
id|result
(braket
l_int|8
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|rp
op_assign
id|result
op_plus
l_int|7
suffix:semicolon
r_for
c_loop
(paren
id|c
op_assign
l_int|8
suffix:semicolon
id|c
OG
l_int|0
suffix:semicolon
id|c
op_decrement
comma
id|rp
op_decrement
comma
id|used
op_rshift_assign
l_int|1
comma
id|ddr
op_rshift_assign
l_int|1
)paren
r_if
c_cond
(paren
id|used
op_amp
l_int|0x01
)paren
op_star
id|rp
op_assign
id|io
(braket
id|ddr
op_amp
l_int|0x01
)braket
suffix:semicolon
r_else
op_star
id|rp
op_assign
l_char|&squot;-&squot;
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|gpio_proc_read
r_static
r_int
id|gpio_proc_read
c_func
(paren
r_char
op_star
id|buf
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|offset
comma
r_int
id|len
comma
r_int
id|unused
)paren
(brace
r_int
id|c
comma
id|outlen
suffix:semicolon
r_const
r_static
r_char
id|port_name
(braket
)braket
op_assign
l_string|&quot;123456789AB&quot;
suffix:semicolon
id|outlen
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|c
op_assign
l_int|0
suffix:semicolon
id|c
OL
id|MAX_PORT
suffix:semicolon
id|c
op_increment
)paren
(brace
r_if
c_cond
(paren
id|ddrs
(braket
id|c
)braket
op_eq
l_int|NULL
)paren
r_continue
suffix:semicolon
id|len
op_assign
id|sprintf
c_func
(paren
id|buf
comma
l_string|&quot;P%c: %s&bslash;n&quot;
comma
id|port_name
(braket
id|c
)braket
comma
id|port_status
c_func
(paren
id|c
)paren
)paren
suffix:semicolon
id|buf
op_add_assign
id|len
suffix:semicolon
id|outlen
op_add_assign
id|len
suffix:semicolon
)brace
r_return
id|outlen
suffix:semicolon
)brace
DECL|variable|proc_gpio
r_static
r_const
r_struct
id|proc_dir_entry
id|proc_gpio
op_assign
(brace
l_int|0
comma
l_int|4
comma
l_string|&quot;gpio&quot;
comma
id|S_IFREG
op_or
id|S_IRUGO
comma
l_int|1
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
id|gpio_proc_read
comma
)brace
suffix:semicolon
macro_line|#endif
DECL|function|h8300_gpio_init
r_int
id|h8300_gpio_init
c_func
(paren
r_void
)paren
(brace
id|memcpy
c_func
(paren
id|gpio_regs
comma
id|_platform_gpio_table
c_func
(paren
r_sizeof
(paren
id|gpio_regs
)paren
)paren
comma
r_sizeof
(paren
id|gpio_regs
)paren
)paren
suffix:semicolon
macro_line|#if 0 &amp;&amp; defined(CONFIG_PROC_FS)
id|proc_register
c_func
(paren
op_amp
id|proc_root
comma
op_amp
id|proc_gpio
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#else
macro_line|#error Unsuppoted CPU Selection
macro_line|#endif
eof
