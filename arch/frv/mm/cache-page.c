multiline_comment|/* cache-page.c: whole-page cache wrangling functions for MMU linux&n; *&n; * Copyright (C) 2004 Red Hat, Inc. All Rights Reserved.&n; * Written by David Howells (dhowells@redhat.com)&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version&n; * 2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/highmem.h&gt;
macro_line|#include &lt;asm/pgalloc.h&gt;
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * DCF takes a virtual address and the page may not currently have one&n; * - temporarily hijack a kmap_atomic() slot and attach the page to it&n; */
DECL|function|flush_dcache_page
r_void
id|flush_dcache_page
c_func
(paren
r_struct
id|page
op_star
id|page
)paren
(brace
r_int
r_int
id|dampr2
suffix:semicolon
r_void
op_star
id|vaddr
suffix:semicolon
id|dampr2
op_assign
id|__get_DAMPR
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|vaddr
op_assign
id|kmap_atomic
c_func
(paren
id|page
comma
id|__KM_CACHE
)paren
suffix:semicolon
id|frv_dcache_writeback
c_func
(paren
(paren
r_int
r_int
)paren
id|vaddr
comma
(paren
r_int
r_int
)paren
id|vaddr
op_plus
id|PAGE_SIZE
)paren
suffix:semicolon
id|kunmap_atomic
c_func
(paren
id|vaddr
comma
id|__KM_CACHE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dampr2
)paren
(brace
id|__set_DAMPR
c_func
(paren
l_int|2
comma
id|dampr2
)paren
suffix:semicolon
id|__set_IAMPR
c_func
(paren
l_int|2
comma
id|dampr2
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* end flush_dcache_page() */
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * ICI takes a virtual address and the page may not currently have one&n; * - so we temporarily attach the page to a bit of virtual space so that is can be flushed&n; */
DECL|function|flush_icache_user_range
r_void
id|flush_icache_user_range
c_func
(paren
r_struct
id|vm_area_struct
op_star
id|vma
comma
r_struct
id|page
op_star
id|page
comma
r_int
r_int
id|start
comma
r_int
r_int
id|len
)paren
(brace
r_int
r_int
id|dampr2
suffix:semicolon
r_void
op_star
id|vaddr
suffix:semicolon
id|dampr2
op_assign
id|__get_DAMPR
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|vaddr
op_assign
id|kmap_atomic
c_func
(paren
id|page
comma
id|__KM_CACHE
)paren
suffix:semicolon
id|start
op_assign
(paren
id|start
op_amp
op_complement
id|PAGE_MASK
)paren
op_or
(paren
r_int
r_int
)paren
id|vaddr
suffix:semicolon
id|frv_cache_wback_inv
c_func
(paren
id|start
comma
id|start
op_plus
id|len
)paren
suffix:semicolon
id|kunmap_atomic
c_func
(paren
id|vaddr
comma
id|__KM_CACHE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dampr2
)paren
(brace
id|__set_DAMPR
c_func
(paren
l_int|2
comma
id|dampr2
)paren
suffix:semicolon
id|__set_IAMPR
c_func
(paren
l_int|2
comma
id|dampr2
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* end flush_icache_user_range() */
eof
