multiline_comment|/* pci-dma.c: Dynamic DMA mapping support for the FRV CPUs that have MMUs&n; *&n; * Copyright (C) 2004 Red Hat, Inc. All Rights Reserved.&n; * Written by David Howells (dhowells@redhat.com)&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version&n; * 2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/dma-mapping.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/highmem.h&gt;
macro_line|#include &lt;asm/io.h&gt;
DECL|function|dma_alloc_coherent
r_void
op_star
id|dma_alloc_coherent
c_func
(paren
r_struct
id|device
op_star
id|hwdev
comma
r_int
id|size
comma
id|dma_addr_t
op_star
id|dma_handle
comma
r_int
id|gfp
)paren
(brace
r_void
op_star
id|ret
suffix:semicolon
id|ret
op_assign
id|consistent_alloc
c_func
(paren
id|gfp
comma
id|size
comma
id|dma_handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
id|memset
c_func
(paren
id|ret
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|dma_free_coherent
r_void
id|dma_free_coherent
c_func
(paren
r_struct
id|device
op_star
id|hwdev
comma
r_int
id|size
comma
r_void
op_star
id|vaddr
comma
id|dma_addr_t
id|dma_handle
)paren
(brace
id|consistent_free
c_func
(paren
id|vaddr
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Map a single buffer of the indicated size for DMA in streaming mode.&n; * The 32-bit bus address to use is returned.&n; *&n; * Once the device is given the dma address, the device owns this memory&n; * until either pci_unmap_single or pci_dma_sync_single is performed.&n; */
DECL|function|dma_map_single
id|dma_addr_t
id|dma_map_single
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_void
op_star
id|ptr
comma
r_int
id|size
comma
r_enum
id|dma_data_direction
id|direction
)paren
(brace
r_if
c_cond
(paren
id|direction
op_eq
id|DMA_NONE
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|frv_cache_wback_inv
c_func
(paren
(paren
r_int
r_int
)paren
id|ptr
comma
(paren
r_int
r_int
)paren
id|ptr
op_plus
id|size
)paren
suffix:semicolon
r_return
id|virt_to_bus
c_func
(paren
id|ptr
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Map a set of buffers described by scatterlist in streaming&n; * mode for DMA.  This is the scather-gather version of the&n; * above pci_map_single interface.  Here the scatter gather list&n; * elements are each tagged with the appropriate dma address&n; * and length.  They are obtained via sg_dma_{address,length}(SG).&n; *&n; * NOTE: An implementation may be able to use a smaller number of&n; *       DMA address/length pairs than there are SG table elements.&n; *       (for example via virtual mapping capabilities)&n; *       The routine returns the number of addr/length pairs actually&n; *       used, at most nents.&n; *&n; * Device ownership issues as mentioned above for pci_map_single are&n; * the same here.&n; */
DECL|function|dma_map_sg
r_int
id|dma_map_sg
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|scatterlist
op_star
id|sg
comma
r_int
id|nents
comma
r_enum
id|dma_data_direction
id|direction
)paren
(brace
r_int
r_int
id|dampr2
suffix:semicolon
r_void
op_star
id|vaddr
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|direction
op_eq
id|DMA_NONE
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|dampr2
op_assign
id|__get_DAMPR
c_func
(paren
l_int|2
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nents
suffix:semicolon
id|i
op_increment
)paren
(brace
id|vaddr
op_assign
id|kmap_atomic
c_func
(paren
id|sg
(braket
id|i
)braket
dot
id|page
comma
id|__KM_CACHE
)paren
suffix:semicolon
id|frv_dcache_writeback
c_func
(paren
(paren
r_int
r_int
)paren
id|vaddr
comma
(paren
r_int
r_int
)paren
id|vaddr
op_plus
id|PAGE_SIZE
)paren
suffix:semicolon
)brace
id|kunmap_atomic
c_func
(paren
id|vaddr
comma
id|__KM_CACHE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dampr2
)paren
(brace
id|__set_DAMPR
c_func
(paren
l_int|2
comma
id|dampr2
)paren
suffix:semicolon
id|__set_IAMPR
c_func
(paren
l_int|2
comma
id|dampr2
)paren
suffix:semicolon
)brace
r_return
id|nents
suffix:semicolon
)brace
DECL|function|dma_map_page
id|dma_addr_t
id|dma_map_page
c_func
(paren
r_struct
id|device
op_star
id|dev
comma
r_struct
id|page
op_star
id|page
comma
r_int
r_int
id|offset
comma
r_int
id|size
comma
r_enum
id|dma_data_direction
id|direction
)paren
(brace
id|BUG_ON
c_func
(paren
id|direction
op_eq
id|DMA_NONE
)paren
suffix:semicolon
id|flush_dcache_page
c_func
(paren
id|page
)paren
suffix:semicolon
r_return
(paren
id|dma_addr_t
)paren
id|page_to_phys
c_func
(paren
id|page
)paren
op_plus
id|offset
suffix:semicolon
)brace
eof
