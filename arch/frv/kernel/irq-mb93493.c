multiline_comment|/* irq-mb93493.c: MB93493 companion chip interrupt handler&n; *&n; * Copyright (C) 2004 Red Hat, Inc. All Rights Reserved.&n; * Written by David Howells (dhowells@redhat.com)&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version&n; * 2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/irq.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/delay.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/irc-regs.h&gt;
macro_line|#include &lt;asm/irq-routing.h&gt;
macro_line|#include &lt;asm/mb93493-irqs.h&gt;
r_static
r_void
id|frv_mb93493_doirq
c_func
(paren
r_struct
id|irq_source
op_star
id|source
)paren
suffix:semicolon
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * MB93493 companion chip IRQ multiplexor&n; */
DECL|variable|frv_mb93493
r_static
r_struct
id|irq_source
id|frv_mb93493
(braket
l_int|2
)braket
op_assign
(brace
(braket
l_int|0
)braket
op_assign
(brace
dot
id|muxname
op_assign
l_string|&quot;mb93493.0&quot;
comma
dot
id|muxdata
op_assign
id|__region_CS3
op_plus
l_int|0x3d0
comma
dot
id|doirq
op_assign
id|frv_mb93493_doirq
comma
dot
id|irqmask
op_assign
l_int|0x0000
comma
)brace
comma
(braket
l_int|1
)braket
op_assign
(brace
dot
id|muxname
op_assign
l_string|&quot;mb93493.1&quot;
comma
dot
id|muxdata
op_assign
id|__region_CS3
op_plus
l_int|0x3d4
comma
dot
id|doirq
op_assign
id|frv_mb93493_doirq
comma
dot
id|irqmask
op_assign
l_int|0x0000
comma
)brace
comma
)brace
suffix:semicolon
DECL|function|frv_mb93493_control
r_static
r_void
id|frv_mb93493_control
c_func
(paren
r_struct
id|irq_group
op_star
id|group
comma
r_int
id|index
comma
r_int
id|on
)paren
(brace
r_struct
id|irq_source
op_star
id|source
suffix:semicolon
r_uint32
id|iqsr
suffix:semicolon
r_if
c_cond
(paren
(paren
id|frv_mb93493
(braket
l_int|0
)braket
dot
id|irqmask
op_amp
(paren
l_int|1
op_lshift
id|index
)paren
)paren
)paren
id|source
op_assign
op_amp
id|frv_mb93493
(braket
l_int|0
)braket
suffix:semicolon
r_else
id|source
op_assign
op_amp
id|frv_mb93493
(braket
l_int|1
)braket
suffix:semicolon
id|iqsr
op_assign
id|readl
c_func
(paren
id|source-&gt;muxdata
)paren
suffix:semicolon
r_if
c_cond
(paren
id|on
)paren
id|iqsr
op_or_assign
l_int|1
op_lshift
(paren
id|index
op_plus
l_int|16
)paren
suffix:semicolon
r_else
id|iqsr
op_and_assign
op_complement
(paren
l_int|1
op_lshift
(paren
id|index
op_plus
l_int|16
)paren
)paren
suffix:semicolon
id|writel
c_func
(paren
id|iqsr
comma
id|source-&gt;muxdata
)paren
suffix:semicolon
)brace
DECL|variable|frv_mb93493_irqs
r_static
r_struct
id|irq_group
id|frv_mb93493_irqs
op_assign
(brace
dot
id|first_irq
op_assign
id|IRQ_BASE_MB93493
comma
dot
id|control
op_assign
id|frv_mb93493_control
comma
)brace
suffix:semicolon
DECL|function|frv_mb93493_doirq
r_static
r_void
id|frv_mb93493_doirq
c_func
(paren
r_struct
id|irq_source
op_star
id|source
)paren
(brace
r_uint32
id|mask
op_assign
id|readl
c_func
(paren
id|source-&gt;muxdata
)paren
suffix:semicolon
id|mask
op_assign
id|mask
op_amp
(paren
id|mask
op_rshift
l_int|16
)paren
op_amp
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|mask
)paren
id|distribute_irqs
c_func
(paren
op_amp
id|frv_mb93493_irqs
comma
id|mask
)paren
suffix:semicolon
)brace
DECL|function|mb93493_irq_route
r_static
r_void
id|__init
id|mb93493_irq_route
c_func
(paren
r_int
id|irq
comma
r_int
id|source
)paren
(brace
id|frv_mb93493
(braket
id|source
)braket
dot
id|irqmask
op_or_assign
l_int|1
op_lshift
(paren
id|irq
op_minus
id|IRQ_BASE_MB93493
)paren
suffix:semicolon
id|frv_mb93493_irqs.sources
(braket
id|irq
op_minus
id|IRQ_BASE_MB93493
)braket
op_assign
op_amp
id|frv_mb93493
(braket
id|source
)braket
suffix:semicolon
)brace
DECL|function|route_mb93493_irqs
r_void
id|__init
id|route_mb93493_irqs
c_func
(paren
r_void
)paren
(brace
id|frv_irq_route_external
c_func
(paren
op_amp
id|frv_mb93493
(braket
l_int|0
)braket
comma
id|IRQ_CPU_MB93493_0
)paren
suffix:semicolon
id|frv_irq_route_external
c_func
(paren
op_amp
id|frv_mb93493
(braket
l_int|1
)braket
comma
id|IRQ_CPU_MB93493_1
)paren
suffix:semicolon
id|frv_irq_set_group
c_func
(paren
op_amp
id|frv_mb93493_irqs
)paren
suffix:semicolon
id|mb93493_irq_route
c_func
(paren
id|IRQ_MB93493_VDC
comma
id|IRQ_MB93493_VDC_ROUTE
)paren
suffix:semicolon
id|mb93493_irq_route
c_func
(paren
id|IRQ_MB93493_VCC
comma
id|IRQ_MB93493_VCC_ROUTE
)paren
suffix:semicolon
id|mb93493_irq_route
c_func
(paren
id|IRQ_MB93493_AUDIO_IN
comma
id|IRQ_MB93493_AUDIO_IN_ROUTE
)paren
suffix:semicolon
id|mb93493_irq_route
c_func
(paren
id|IRQ_MB93493_I2C_0
comma
id|IRQ_MB93493_I2C_0_ROUTE
)paren
suffix:semicolon
id|mb93493_irq_route
c_func
(paren
id|IRQ_MB93493_I2C_1
comma
id|IRQ_MB93493_I2C_1_ROUTE
)paren
suffix:semicolon
id|mb93493_irq_route
c_func
(paren
id|IRQ_MB93493_USB
comma
id|IRQ_MB93493_USB_ROUTE
)paren
suffix:semicolon
id|mb93493_irq_route
c_func
(paren
id|IRQ_MB93493_LOCAL_BUS
comma
id|IRQ_MB93493_LOCAL_BUS_ROUTE
)paren
suffix:semicolon
id|mb93493_irq_route
c_func
(paren
id|IRQ_MB93493_PCMCIA
comma
id|IRQ_MB93493_PCMCIA_ROUTE
)paren
suffix:semicolon
id|mb93493_irq_route
c_func
(paren
id|IRQ_MB93493_GPIO
comma
id|IRQ_MB93493_GPIO_ROUTE
)paren
suffix:semicolon
id|mb93493_irq_route
c_func
(paren
id|IRQ_MB93493_AUDIO_OUT
comma
id|IRQ_MB93493_AUDIO_OUT_ROUTE
)paren
suffix:semicolon
)brace
eof
