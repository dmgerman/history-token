multiline_comment|/* traps.c: high-level exception handler for FR-V&n; *&n; * Copyright (C) 2003 Red Hat, Inc. All Rights Reserved.&n; * Written by David Howells (dhowells@redhat.com)&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version&n; * 2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/user.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/linkage.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/setup.h&gt;
macro_line|#include &lt;asm/fpu.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/siginfo.h&gt;
macro_line|#include &lt;asm/unaligned.h&gt;
r_void
id|show_backtrace
c_func
(paren
r_struct
id|pt_regs
op_star
comma
r_int
r_int
)paren
suffix:semicolon
r_extern
id|asmlinkage
r_void
id|__break_hijack_kernel_event
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * instruction access error&n; */
DECL|function|insn_access_error
id|asmlinkage
r_void
id|insn_access_error
c_func
(paren
r_int
r_int
id|esfr1
comma
r_int
r_int
id|epcr0
comma
r_int
r_int
id|esr0
)paren
(brace
id|siginfo_t
id|info
suffix:semicolon
id|die_if_kernel
c_func
(paren
l_string|&quot;-- Insn Access Error --&bslash;n&quot;
l_string|&quot;EPCR0 : %08lx&bslash;n&quot;
l_string|&quot;ESR0  : %08lx&bslash;n&quot;
comma
id|epcr0
comma
id|esr0
)paren
suffix:semicolon
id|info.si_signo
op_assign
id|SIGSEGV
suffix:semicolon
id|info.si_code
op_assign
id|SEGV_ACCERR
suffix:semicolon
id|info.si_errno
op_assign
l_int|0
suffix:semicolon
id|info.si_addr
op_assign
(paren
r_void
op_star
)paren
(paren
(paren
id|epcr0
op_amp
id|EPCR0_V
)paren
ques
c_cond
(paren
id|epcr0
op_amp
id|EPCR0_PC
)paren
suffix:colon
id|__frame-&gt;pc
)paren
suffix:semicolon
id|force_sig_info
c_func
(paren
id|info.si_signo
comma
op_amp
id|info
comma
id|current
)paren
suffix:semicolon
)brace
multiline_comment|/* end insn_access_error() */
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * handler for:&n; * - illegal instruction&n; * - privileged instruction&n; * - unsupported trap&n; * - debug exceptions&n; */
DECL|function|illegal_instruction
id|asmlinkage
r_void
id|illegal_instruction
c_func
(paren
r_int
r_int
id|esfr1
comma
r_int
r_int
id|epcr0
comma
r_int
r_int
id|esr0
)paren
(brace
id|siginfo_t
id|info
suffix:semicolon
id|die_if_kernel
c_func
(paren
l_string|&quot;-- Illegal Instruction --&bslash;n&quot;
l_string|&quot;EPCR0 : %08lx&bslash;n&quot;
l_string|&quot;ESR0  : %08lx&bslash;n&quot;
l_string|&quot;ESFR1 : %08lx&bslash;n&quot;
comma
id|epcr0
comma
id|esr0
comma
id|esfr1
)paren
suffix:semicolon
id|info.si_errno
op_assign
l_int|0
suffix:semicolon
id|info.si_addr
op_assign
(paren
r_void
op_star
)paren
(paren
(paren
id|epcr0
op_amp
id|EPCR0_PC
)paren
ques
c_cond
(paren
id|epcr0
op_amp
id|EPCR0_PC
)paren
suffix:colon
id|__frame-&gt;pc
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|__frame-&gt;tbr
op_amp
id|TBR_TT
)paren
(brace
r_case
id|TBR_TT_ILLEGAL_INSTR
suffix:colon
id|info.si_signo
op_assign
id|SIGILL
suffix:semicolon
id|info.si_code
op_assign
id|ILL_ILLOPC
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TBR_TT_PRIV_INSTR
suffix:colon
id|info.si_signo
op_assign
id|SIGILL
suffix:semicolon
id|info.si_code
op_assign
id|ILL_PRVOPC
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TBR_TT_TRAP2
dot
dot
dot
id|TBR_TT_TRAP126
suffix:colon
id|info.si_signo
op_assign
id|SIGILL
suffix:semicolon
id|info.si_code
op_assign
id|ILL_ILLTRP
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* GDB uses &quot;tira gr0, #1&quot; as a breakpoint instruction.  */
r_case
id|TBR_TT_TRAP1
suffix:colon
r_case
id|TBR_TT_BREAK
suffix:colon
id|info.si_signo
op_assign
id|SIGTRAP
suffix:semicolon
id|info.si_code
op_assign
(paren
id|__frame-&gt;__status
op_amp
id|REG__STATUS_STEPPED
)paren
ques
c_cond
id|TRAP_TRACE
suffix:colon
id|TRAP_BRKPT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|force_sig_info
c_func
(paren
id|info.si_signo
comma
op_amp
id|info
comma
id|current
)paren
suffix:semicolon
)brace
multiline_comment|/* end illegal_instruction() */
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; *&n; */
DECL|function|media_exception
id|asmlinkage
r_void
id|media_exception
c_func
(paren
r_int
r_int
id|msr0
comma
r_int
r_int
id|msr1
)paren
(brace
id|siginfo_t
id|info
suffix:semicolon
id|die_if_kernel
c_func
(paren
l_string|&quot;-- Media Exception --&bslash;n&quot;
l_string|&quot;MSR0 : %08lx&bslash;n&quot;
l_string|&quot;MSR1 : %08lx&bslash;n&quot;
comma
id|msr0
comma
id|msr1
)paren
suffix:semicolon
id|info.si_signo
op_assign
id|SIGFPE
suffix:semicolon
id|info.si_code
op_assign
id|FPE_MDAOVF
suffix:semicolon
id|info.si_errno
op_assign
l_int|0
suffix:semicolon
id|info.si_addr
op_assign
(paren
r_void
op_star
)paren
id|__frame-&gt;pc
suffix:semicolon
id|force_sig_info
c_func
(paren
id|info.si_signo
comma
op_amp
id|info
comma
id|current
)paren
suffix:semicolon
)brace
multiline_comment|/* end media_exception() */
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * instruction or data access exception&n; */
DECL|function|memory_access_exception
id|asmlinkage
r_void
id|memory_access_exception
c_func
(paren
r_int
r_int
id|esr0
comma
r_int
r_int
id|ear0
comma
r_int
r_int
id|epcr0
)paren
(brace
id|siginfo_t
id|info
suffix:semicolon
macro_line|#ifdef CONFIG_MMU
r_int
r_int
id|fixup
suffix:semicolon
r_if
c_cond
(paren
(paren
id|esr0
op_amp
id|ESRx_EC
)paren
op_eq
id|ESRx_EC_DATA_ACCESS
)paren
r_if
c_cond
(paren
id|handle_misalignment
c_func
(paren
id|esr0
comma
id|ear0
comma
id|epcr0
)paren
op_eq
l_int|0
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fixup
op_assign
id|search_exception_table
c_func
(paren
id|__frame-&gt;pc
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|__frame-&gt;pc
op_assign
id|fixup
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
id|die_if_kernel
c_func
(paren
l_string|&quot;-- Memory Access Exception --&bslash;n&quot;
l_string|&quot;ESR0  : %08lx&bslash;n&quot;
l_string|&quot;EAR0  : %08lx&bslash;n&quot;
l_string|&quot;EPCR0 : %08lx&bslash;n&quot;
comma
id|esr0
comma
id|ear0
comma
id|epcr0
)paren
suffix:semicolon
id|info.si_signo
op_assign
id|SIGSEGV
suffix:semicolon
id|info.si_code
op_assign
id|SEGV_ACCERR
suffix:semicolon
id|info.si_errno
op_assign
l_int|0
suffix:semicolon
id|info.si_addr
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
(paren
id|esr0
op_amp
(paren
id|ESRx_VALID
op_or
id|ESR0_EAV
)paren
)paren
op_eq
(paren
id|ESRx_VALID
op_or
id|ESR0_EAV
)paren
)paren
id|info.si_addr
op_assign
(paren
r_void
op_star
)paren
id|ear0
suffix:semicolon
id|force_sig_info
c_func
(paren
id|info.si_signo
comma
op_amp
id|info
comma
id|current
)paren
suffix:semicolon
)brace
multiline_comment|/* end memory_access_exception() */
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * data access error&n; * - double-word data load from CPU control area (0xFExxxxxx)&n; * - read performed on inactive or self-refreshing SDRAM&n; * - error notification from slave device&n; * - misaligned address&n; * - access to out of bounds memory region&n; * - user mode accessing privileged memory region&n; * - write to R/O memory region&n; */
DECL|function|data_access_error
id|asmlinkage
r_void
id|data_access_error
c_func
(paren
r_int
r_int
id|esfr1
comma
r_int
r_int
id|esr15
comma
r_int
r_int
id|ear15
)paren
(brace
id|siginfo_t
id|info
suffix:semicolon
id|die_if_kernel
c_func
(paren
l_string|&quot;-- Data Access Error --&bslash;n&quot;
l_string|&quot;ESR15 : %08lx&bslash;n&quot;
l_string|&quot;EAR15 : %08lx&bslash;n&quot;
comma
id|esr15
comma
id|ear15
)paren
suffix:semicolon
id|info.si_signo
op_assign
id|SIGSEGV
suffix:semicolon
id|info.si_code
op_assign
id|SEGV_ACCERR
suffix:semicolon
id|info.si_errno
op_assign
l_int|0
suffix:semicolon
id|info.si_addr
op_assign
(paren
r_void
op_star
)paren
(paren
(paren
(paren
id|esr15
op_amp
(paren
id|ESRx_VALID
op_or
id|ESR15_EAV
)paren
)paren
op_eq
(paren
id|ESRx_VALID
op_or
id|ESR15_EAV
)paren
)paren
ques
c_cond
id|ear15
suffix:colon
l_int|0
)paren
suffix:semicolon
id|force_sig_info
c_func
(paren
id|info.si_signo
comma
op_amp
id|info
comma
id|current
)paren
suffix:semicolon
)brace
multiline_comment|/* end data_access_error() */
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * data store error - should only happen if accessing inactive or self-refreshing SDRAM&n; */
DECL|function|data_store_error
id|asmlinkage
r_void
id|data_store_error
c_func
(paren
r_int
r_int
id|esfr1
comma
r_int
r_int
id|esr15
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;-- Data Store Error --&bslash;n&quot;
l_string|&quot;ESR15 : %08lx&bslash;n&quot;
comma
id|esr15
)paren
suffix:semicolon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* end data_store_error() */
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; *&n; */
DECL|function|division_exception
id|asmlinkage
r_void
id|division_exception
c_func
(paren
r_int
r_int
id|esfr1
comma
r_int
r_int
id|esr0
comma
r_int
r_int
id|isr
)paren
(brace
id|siginfo_t
id|info
suffix:semicolon
id|die_if_kernel
c_func
(paren
l_string|&quot;-- Division Exception --&bslash;n&quot;
l_string|&quot;ESR0 : %08lx&bslash;n&quot;
l_string|&quot;ISR  : %08lx&bslash;n&quot;
comma
id|esr0
comma
id|isr
)paren
suffix:semicolon
id|info.si_signo
op_assign
id|SIGFPE
suffix:semicolon
id|info.si_code
op_assign
id|FPE_INTDIV
suffix:semicolon
id|info.si_errno
op_assign
l_int|0
suffix:semicolon
id|info.si_addr
op_assign
(paren
r_void
op_star
)paren
id|__frame-&gt;pc
suffix:semicolon
id|force_sig_info
c_func
(paren
id|info.si_signo
comma
op_amp
id|info
comma
id|current
)paren
suffix:semicolon
)brace
multiline_comment|/* end division_exception() */
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; *&n; */
DECL|function|compound_exception
id|asmlinkage
r_void
id|compound_exception
c_func
(paren
r_int
r_int
id|esfr1
comma
r_int
r_int
id|esr0
comma
r_int
r_int
id|esr14
comma
r_int
r_int
id|esr15
comma
r_int
r_int
id|msr0
comma
r_int
r_int
id|msr1
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;-- Compound Exception --&bslash;n&quot;
l_string|&quot;ESR0  : %08lx&bslash;n&quot;
l_string|&quot;ESR15 : %08lx&bslash;n&quot;
l_string|&quot;ESR15 : %08lx&bslash;n&quot;
l_string|&quot;MSR0  : %08lx&bslash;n&quot;
l_string|&quot;MSR1  : %08lx&bslash;n&quot;
comma
id|esr0
comma
id|esr14
comma
id|esr15
comma
id|msr0
comma
id|msr1
)paren
suffix:semicolon
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* end compound_exception() */
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * The architecture-independent backtrace generator&n; */
DECL|function|dump_stack
r_void
id|dump_stack
c_func
(paren
r_void
)paren
(brace
id|show_stack
c_func
(paren
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|show_stack
r_void
id|show_stack
c_func
(paren
r_struct
id|task_struct
op_star
id|task
comma
r_int
r_int
op_star
id|sp
)paren
(brace
)brace
DECL|function|show_trace_task
r_void
id|show_trace_task
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;CONTEXT: stack=0x%lx frame=0x%p LR=0x%lx RET=0x%lx&bslash;n&quot;
comma
id|tsk-&gt;thread.sp
comma
id|tsk-&gt;thread.frame
comma
id|tsk-&gt;thread.lr
comma
id|tsk-&gt;thread.sched_lr
)paren
suffix:semicolon
)brace
DECL|variable|regnames
r_static
r_const
r_char
op_star
id|regnames
(braket
)braket
op_assign
(brace
l_string|&quot;PSR &quot;
comma
l_string|&quot;ISR &quot;
comma
l_string|&quot;CCR &quot;
comma
l_string|&quot;CCCR&quot;
comma
l_string|&quot;LR  &quot;
comma
l_string|&quot;LCR &quot;
comma
l_string|&quot;PC  &quot;
comma
l_string|&quot;_stt&quot;
comma
l_string|&quot;sys &quot;
comma
l_string|&quot;GR8*&quot;
comma
l_string|&quot;GNE0&quot;
comma
l_string|&quot;GNE1&quot;
comma
l_string|&quot;IACH&quot;
comma
l_string|&quot;IACL&quot;
comma
l_string|&quot;TBR &quot;
comma
l_string|&quot;SP  &quot;
comma
l_string|&quot;FP  &quot;
comma
l_string|&quot;GR3 &quot;
comma
l_string|&quot;GR4 &quot;
comma
l_string|&quot;GR5 &quot;
comma
l_string|&quot;GR6 &quot;
comma
l_string|&quot;GR7 &quot;
comma
l_string|&quot;GR8 &quot;
comma
l_string|&quot;GR9 &quot;
comma
l_string|&quot;GR10&quot;
comma
l_string|&quot;GR11&quot;
comma
l_string|&quot;GR12&quot;
comma
l_string|&quot;GR13&quot;
comma
l_string|&quot;GR14&quot;
comma
l_string|&quot;GR15&quot;
comma
l_string|&quot;GR16&quot;
comma
l_string|&quot;GR17&quot;
comma
l_string|&quot;GR18&quot;
comma
l_string|&quot;GR19&quot;
comma
l_string|&quot;GR20&quot;
comma
l_string|&quot;GR21&quot;
comma
l_string|&quot;GR22&quot;
comma
l_string|&quot;GR23&quot;
comma
l_string|&quot;GR24&quot;
comma
l_string|&quot;GR25&quot;
comma
l_string|&quot;GR26&quot;
comma
l_string|&quot;GR27&quot;
comma
l_string|&quot;EFRM&quot;
comma
l_string|&quot;CURR&quot;
comma
l_string|&quot;GR30&quot;
comma
l_string|&quot;BFRM&quot;
)brace
suffix:semicolon
DECL|function|show_regs
r_void
id|show_regs
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_uint32
op_star
id|reg
suffix:semicolon
r_int
id|loop
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Frame: @%08x [%s]&bslash;n&quot;
comma
(paren
r_uint32
)paren
id|regs
comma
id|regs-&gt;psr
op_amp
id|PSR_S
ques
c_cond
l_string|&quot;kernel&quot;
suffix:colon
l_string|&quot;user&quot;
)paren
suffix:semicolon
id|reg
op_assign
(paren
r_uint32
op_star
)paren
id|regs
suffix:semicolon
r_for
c_loop
(paren
id|loop
op_assign
l_int|0
suffix:semicolon
id|loop
OL
id|REG__END
suffix:semicolon
id|loop
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s %08x&quot;
comma
id|regnames
(braket
id|loop
op_plus
l_int|0
)braket
comma
id|reg
(braket
id|loop
op_plus
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|loop
op_eq
id|REG__END
op_minus
l_int|1
op_logical_or
id|loop
op_mod
l_int|5
op_eq
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot; | &quot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;Process %s (pid: %d)&bslash;n&quot;
comma
id|current-&gt;comm
comma
id|current-&gt;pid
)paren
suffix:semicolon
)brace
DECL|function|die_if_kernel
r_void
id|die_if_kernel
c_func
(paren
r_const
r_char
op_star
id|str
comma
dot
dot
dot
)paren
(brace
r_char
id|buffer
(braket
l_int|256
)braket
suffix:semicolon
id|va_list
id|va
suffix:semicolon
r_if
c_cond
(paren
id|user_mode
c_func
(paren
id|__frame
)paren
)paren
r_return
suffix:semicolon
id|va_start
c_func
(paren
id|va
comma
id|str
)paren
suffix:semicolon
id|vsprintf
c_func
(paren
id|buffer
comma
id|str
comma
id|va
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|va
)paren
suffix:semicolon
id|console_verbose
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n===================================&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|buffer
)paren
suffix:semicolon
id|show_backtrace
c_func
(paren
id|__frame
comma
l_int|0
)paren
suffix:semicolon
id|__break_hijack_kernel_event
c_func
(paren
)paren
suffix:semicolon
id|do_exit
c_func
(paren
id|SIGSEGV
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * dump the contents of an exception frame&n; */
DECL|function|show_backtrace_regs
r_static
r_void
id|show_backtrace_regs
c_func
(paren
r_struct
id|pt_regs
op_star
id|frame
)paren
(brace
r_uint32
op_star
id|reg
suffix:semicolon
r_int
id|loop
suffix:semicolon
multiline_comment|/* print the registers for this frame */
id|printk
c_func
(paren
l_string|&quot;&lt;-- %s Frame: @%p --&gt;&bslash;n&quot;
comma
id|frame-&gt;psr
op_amp
id|PSR_S
ques
c_cond
l_string|&quot;Kernel Mode&quot;
suffix:colon
l_string|&quot;User Mode&quot;
comma
id|frame
)paren
suffix:semicolon
id|reg
op_assign
(paren
r_uint32
op_star
)paren
id|frame
suffix:semicolon
r_for
c_loop
(paren
id|loop
op_assign
l_int|0
suffix:semicolon
id|loop
OL
id|REG__END
suffix:semicolon
id|loop
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s %08x&quot;
comma
id|regnames
(braket
id|loop
op_plus
l_int|0
)braket
comma
id|reg
(braket
id|loop
op_plus
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|loop
op_eq
id|REG__END
op_minus
l_int|1
op_logical_or
id|loop
op_mod
l_int|5
op_eq
l_int|4
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot; | &quot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;--------&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* end show_backtrace_regs() */
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * generate a backtrace of the kernel stack&n; */
DECL|function|show_backtrace
r_void
id|show_backtrace
c_func
(paren
r_struct
id|pt_regs
op_star
id|frame
comma
r_int
r_int
id|sp
)paren
(brace
r_struct
id|pt_regs
op_star
id|frame0
suffix:semicolon
r_int
r_int
id|tos
op_assign
l_int|0
comma
id|stop
op_assign
l_int|0
comma
id|base
suffix:semicolon
r_int
id|format
suffix:semicolon
id|base
op_assign
(paren
(paren
(paren
(paren
r_int
r_int
)paren
id|frame
)paren
op_plus
l_int|8191
)paren
op_amp
op_complement
l_int|8191
)paren
op_minus
r_sizeof
(paren
r_struct
id|user_context
)paren
suffix:semicolon
id|frame0
op_assign
(paren
r_struct
id|pt_regs
op_star
)paren
id|base
suffix:semicolon
r_if
c_cond
(paren
id|sp
)paren
(brace
id|tos
op_assign
id|sp
suffix:semicolon
id|stop
op_assign
(paren
r_int
r_int
)paren
id|frame
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;nProcess %s (pid: %d)&bslash;n&bslash;n&quot;
comma
id|current-&gt;comm
comma
id|current-&gt;pid
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
multiline_comment|/* dump stack segment between frames */
singleline_comment|//printk(&quot;%08lx -&gt; %08lx&bslash;n&quot;, tos, stop);
id|format
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|tos
OL
id|stop
)paren
(brace
r_if
c_cond
(paren
id|format
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot; %04lx :&quot;
comma
id|tos
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; %08lx&quot;
comma
op_star
(paren
r_int
r_int
op_star
)paren
id|tos
)paren
suffix:semicolon
id|tos
op_add_assign
l_int|4
suffix:semicolon
id|format
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|format
op_eq
l_int|8
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|format
op_assign
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|format
OG
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* dump frame 0 outside of the loop */
r_if
c_cond
(paren
id|frame
op_eq
id|frame0
)paren
r_break
suffix:semicolon
id|tos
op_assign
id|frame-&gt;sp
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
r_int
r_int
)paren
id|frame
)paren
op_plus
r_sizeof
(paren
op_star
id|frame
)paren
op_ne
id|tos
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;-- TOS %08lx does not follow frame %p --&bslash;n&quot;
comma
id|tos
comma
id|frame
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|show_backtrace_regs
c_func
(paren
id|frame
)paren
suffix:semicolon
multiline_comment|/* dump the stack between this frame and the next */
id|stop
op_assign
(paren
r_int
r_int
)paren
id|frame-&gt;next_frame
suffix:semicolon
r_if
c_cond
(paren
id|stop
op_ne
id|base
op_logical_and
(paren
id|stop
template_param
id|base
op_logical_or
(paren
id|stop
template_param
id|base
)paren
op_logical_or
id|stop
op_amp
l_int|3
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;-- next_frame %08lx is invalid (range %08lx-%08lx) --&bslash;n&quot;
comma
id|stop
comma
id|tos
comma
id|base
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* move to next frame */
id|frame
op_assign
id|frame-&gt;next_frame
suffix:semicolon
)brace
multiline_comment|/* we can always dump frame 0, even if the rest of the stack is corrupt */
id|show_backtrace_regs
c_func
(paren
id|frame0
)paren
suffix:semicolon
)brace
multiline_comment|/* end show_backtrace() */
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * initialise traps&n; */
DECL|function|trap_init
r_void
id|__init
id|trap_init
(paren
r_void
)paren
(brace
)brace
multiline_comment|/* end trap_init() */
eof
