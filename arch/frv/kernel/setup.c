multiline_comment|/* setup.c: FRV specific setup&n; *&n; * Copyright (C) 2003-5 Red Hat, Inc. All Rights Reserved.&n; * Written by David Howells (dhowells@redhat.com)&n; * - Derived from arch/m68k/kernel/setup.c&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version&n; * 2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/fb.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/genhd.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/bootmem.h&gt;
macro_line|#include &lt;linux/highmem.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &lt;linux/serial.h&gt;
macro_line|#include &lt;linux/serial_core.h&gt;
macro_line|#include &lt;linux/serial_reg.h&gt;
macro_line|#include &lt;asm/setup.h&gt;
macro_line|#include &lt;asm/serial.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/sections.h&gt;
macro_line|#include &lt;asm/pgalloc.h&gt;
macro_line|#include &lt;asm/busctl-regs.h&gt;
macro_line|#include &lt;asm/serial-regs.h&gt;
macro_line|#include &lt;asm/timer-regs.h&gt;
macro_line|#include &lt;asm/irc-regs.h&gt;
macro_line|#include &lt;asm/spr-regs.h&gt;
macro_line|#include &lt;asm/mb-regs.h&gt;
macro_line|#include &lt;asm/mb93493-regs.h&gt;
macro_line|#include &lt;asm/gdb-stub.h&gt;
macro_line|#include &lt;asm/irq-routing.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#ifdef CONFIG_BLK_DEV_INITRD
macro_line|#include &lt;linux/blk.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#endif
macro_line|#include &quot;local.h&quot;
macro_line|#ifdef CONFIG_MB93090_MB00
r_static
r_void
id|__init
id|mb93090_display
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_MMU
r_static
r_void
id|__init
id|setup_linux_memory
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#else
r_static
r_void
id|__init
id|setup_uclinux_memory
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_CONSOLE
r_extern
r_struct
id|consw
op_star
id|conswitchp
suffix:semicolon
macro_line|#ifdef CONFIG_FRAMEBUFFER
r_extern
r_struct
id|consw
id|fb_con
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#ifdef CONFIG_MB93090_MB00
DECL|variable|mb93090_banner
r_static
r_char
id|__initdata
id|mb93090_banner
(braket
)braket
op_assign
l_string|&quot;FJ/RH FR-V Linux&quot;
suffix:semicolon
DECL|variable|mb93090_version
r_static
r_char
id|__initdata
id|mb93090_version
(braket
)braket
op_assign
id|UTS_RELEASE
suffix:semicolon
DECL|variable|mb93090_mb00_detected
r_int
id|__nongprelbss
id|mb93090_mb00_detected
suffix:semicolon
macro_line|#endif
DECL|variable|__frv_unknown_system
r_const
r_char
id|__frv_unknown_system
(braket
)braket
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
DECL|variable|__frv_mb93091_cb10
r_const
r_char
id|__frv_mb93091_cb10
(braket
)braket
op_assign
l_string|&quot;mb93091-cb10&quot;
suffix:semicolon
DECL|variable|__frv_mb93091_cb11
r_const
r_char
id|__frv_mb93091_cb11
(braket
)braket
op_assign
l_string|&quot;mb93091-cb11&quot;
suffix:semicolon
DECL|variable|__frv_mb93091_cb30
r_const
r_char
id|__frv_mb93091_cb30
(braket
)braket
op_assign
l_string|&quot;mb93091-cb30&quot;
suffix:semicolon
DECL|variable|__frv_mb93091_cb41
r_const
r_char
id|__frv_mb93091_cb41
(braket
)braket
op_assign
l_string|&quot;mb93091-cb41&quot;
suffix:semicolon
DECL|variable|__frv_mb93091_cb60
r_const
r_char
id|__frv_mb93091_cb60
(braket
)braket
op_assign
l_string|&quot;mb93091-cb60&quot;
suffix:semicolon
DECL|variable|__frv_mb93091_cb70
r_const
r_char
id|__frv_mb93091_cb70
(braket
)braket
op_assign
l_string|&quot;mb93091-cb70&quot;
suffix:semicolon
DECL|variable|__frv_mb93091_cb451
r_const
r_char
id|__frv_mb93091_cb451
(braket
)braket
op_assign
l_string|&quot;mb93091-cb451&quot;
suffix:semicolon
DECL|variable|__frv_mb93090_mb00
r_const
r_char
id|__frv_mb93090_mb00
(braket
)braket
op_assign
l_string|&quot;mb93090-mb00&quot;
suffix:semicolon
DECL|variable|__frv_mb93493
r_const
r_char
id|__frv_mb93493
(braket
)braket
op_assign
l_string|&quot;mb93493&quot;
suffix:semicolon
DECL|variable|__frv_mb93093
r_const
r_char
id|__frv_mb93093
(braket
)braket
op_assign
l_string|&quot;mb93093&quot;
suffix:semicolon
DECL|variable|cpu_series
r_static
r_const
r_char
op_star
id|__nongprelbss
id|cpu_series
suffix:semicolon
DECL|variable|cpu_core
r_static
r_const
r_char
op_star
id|__nongprelbss
id|cpu_core
suffix:semicolon
DECL|variable|cpu_silicon
r_static
r_const
r_char
op_star
id|__nongprelbss
id|cpu_silicon
suffix:semicolon
DECL|variable|cpu_mmu
r_static
r_const
r_char
op_star
id|__nongprelbss
id|cpu_mmu
suffix:semicolon
DECL|variable|cpu_system
r_static
r_const
r_char
op_star
id|__nongprelbss
id|cpu_system
suffix:semicolon
DECL|variable|cpu_board1
r_static
r_const
r_char
op_star
id|__nongprelbss
id|cpu_board1
suffix:semicolon
DECL|variable|cpu_board2
r_static
r_const
r_char
op_star
id|__nongprelbss
id|cpu_board2
suffix:semicolon
DECL|variable|cpu_psr_all
r_static
r_int
r_int
id|__nongprelbss
id|cpu_psr_all
suffix:semicolon
DECL|variable|cpu_hsr0_all
r_static
r_int
r_int
id|__nongprelbss
id|cpu_hsr0_all
suffix:semicolon
DECL|variable|pdm_suspend_mode
r_int
r_int
id|__nongprelbss
id|pdm_suspend_mode
suffix:semicolon
DECL|variable|rom_length
r_int
r_int
id|__nongprelbss
id|rom_length
suffix:semicolon
DECL|variable|memory_start
r_int
r_int
id|__nongprelbss
id|memory_start
suffix:semicolon
DECL|variable|memory_end
r_int
r_int
id|__nongprelbss
id|memory_end
suffix:semicolon
DECL|variable|dma_coherent_mem_start
r_int
r_int
id|__nongprelbss
id|dma_coherent_mem_start
suffix:semicolon
DECL|variable|dma_coherent_mem_end
r_int
r_int
id|__nongprelbss
id|dma_coherent_mem_end
suffix:semicolon
DECL|variable|__sdram_old_base
r_int
r_int
id|__initdata
id|__sdram_old_base
suffix:semicolon
DECL|variable|num_mappedpages
r_int
r_int
id|__initdata
id|num_mappedpages
suffix:semicolon
DECL|variable|boot_cpu_data
r_struct
id|cpuinfo_frv
id|__nongprelbss
id|boot_cpu_data
suffix:semicolon
DECL|variable|command_line
r_char
id|command_line
(braket
id|COMMAND_LINE_SIZE
)braket
suffix:semicolon
DECL|variable|redboot_command_line
r_char
id|__initdata
id|redboot_command_line
(braket
id|COMMAND_LINE_SIZE
)braket
suffix:semicolon
macro_line|#ifdef CONFIG_PM
DECL|macro|__pminit
mdefine_line|#define __pminit
DECL|macro|__pminitdata
mdefine_line|#define __pminitdata
macro_line|#else
DECL|macro|__pminit
mdefine_line|#define __pminit __init
DECL|macro|__pminitdata
mdefine_line|#define __pminitdata __initdata
macro_line|#endif
DECL|struct|clock_cmode
r_struct
id|clock_cmode
(brace
DECL|member|xbus
DECL|member|sdram
DECL|member|corebus
DECL|member|core
DECL|member|dsu
r_uint8
id|xbus
comma
id|sdram
comma
id|corebus
comma
id|core
comma
id|dsu
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|_frac
mdefine_line|#define _frac(N,D) ((N)&lt;&lt;4 | (D))
DECL|macro|_x0_16
mdefine_line|#define _x0_16&t;_frac(1,6)
DECL|macro|_x0_25
mdefine_line|#define _x0_25&t;_frac(1,4)
DECL|macro|_x0_33
mdefine_line|#define _x0_33&t;_frac(1,3)
DECL|macro|_x0_375
mdefine_line|#define _x0_375&t;_frac(3,8)
DECL|macro|_x0_5
mdefine_line|#define _x0_5&t;_frac(1,2)
DECL|macro|_x0_66
mdefine_line|#define _x0_66&t;_frac(2,3)
DECL|macro|_x0_75
mdefine_line|#define _x0_75&t;_frac(3,4)
DECL|macro|_x1
mdefine_line|#define _x1&t;_frac(1,1)
DECL|macro|_x1_5
mdefine_line|#define _x1_5&t;_frac(3,2)
DECL|macro|_x2
mdefine_line|#define _x2&t;_frac(2,1)
DECL|macro|_x3
mdefine_line|#define _x3&t;_frac(3,1)
DECL|macro|_x4
mdefine_line|#define _x4&t;_frac(4,1)
DECL|macro|_x4_5
mdefine_line|#define _x4_5&t;_frac(9,2)
DECL|macro|_x6
mdefine_line|#define _x6&t;_frac(6,1)
DECL|macro|_x8
mdefine_line|#define _x8&t;_frac(8,1)
DECL|macro|_x9
mdefine_line|#define _x9&t;_frac(9,1)
DECL|variable|clock_p0_current
r_int
id|__nongprelbss
id|clock_p0_current
suffix:semicolon
DECL|variable|clock_cm_current
r_int
id|__nongprelbss
id|clock_cm_current
suffix:semicolon
DECL|variable|clock_cmode_current
r_int
id|__nongprelbss
id|clock_cmode_current
suffix:semicolon
macro_line|#ifdef CONFIG_PM
DECL|variable|clock_cmodes_permitted
r_int
id|__nongprelbss
id|clock_cmodes_permitted
suffix:semicolon
DECL|variable|clock_bits_settable
r_int
r_int
id|__nongprelbss
id|clock_bits_settable
suffix:semicolon
macro_line|#endif
DECL|variable|undef_clock_cmode
r_static
r_struct
id|clock_cmode
id|__pminitdata
id|undef_clock_cmode
op_assign
(brace
id|_x1
comma
id|_x1
comma
id|_x1
comma
id|_x1
comma
id|_x1
)brace
suffix:semicolon
DECL|variable|clock_cmodes_fr401_fr403
r_static
r_struct
id|clock_cmode
id|__pminitdata
id|clock_cmodes_fr401_fr403
(braket
l_int|16
)braket
op_assign
(brace
(braket
l_int|4
)braket
op_assign
(brace
id|_x1
comma
id|_x1
comma
id|_x2
comma
id|_x2
comma
id|_x0_25
)brace
comma
(braket
l_int|5
)braket
op_assign
(brace
id|_x1
comma
id|_x2
comma
id|_x4
comma
id|_x4
comma
id|_x0_5
)brace
comma
(braket
l_int|8
)braket
op_assign
(brace
id|_x1
comma
id|_x1
comma
id|_x1
comma
id|_x2
comma
id|_x0_25
)brace
comma
(braket
l_int|9
)braket
op_assign
(brace
id|_x1
comma
id|_x2
comma
id|_x2
comma
id|_x4
comma
id|_x0_5
)brace
comma
(braket
l_int|11
)braket
op_assign
(brace
id|_x1
comma
id|_x4
comma
id|_x4
comma
id|_x8
comma
id|_x1
)brace
comma
(braket
l_int|12
)braket
op_assign
(brace
id|_x1
comma
id|_x1
comma
id|_x2
comma
id|_x4
comma
id|_x0_5
)brace
comma
(braket
l_int|13
)braket
op_assign
(brace
id|_x1
comma
id|_x2
comma
id|_x4
comma
id|_x8
comma
id|_x1
)brace
comma
)brace
suffix:semicolon
DECL|variable|clock_cmodes_fr405
r_static
r_struct
id|clock_cmode
id|__pminitdata
id|clock_cmodes_fr405
(braket
l_int|16
)braket
op_assign
(brace
(braket
l_int|0
)braket
op_assign
(brace
id|_x1
comma
id|_x1
comma
id|_x1
comma
id|_x1
comma
id|_x0_5
)brace
comma
(braket
l_int|1
)braket
op_assign
(brace
id|_x1
comma
id|_x1
comma
id|_x1
comma
id|_x3
comma
id|_x0_25
)brace
comma
(braket
l_int|2
)braket
op_assign
(brace
id|_x1
comma
id|_x1
comma
id|_x2
comma
id|_x6
comma
id|_x0_5
)brace
comma
(braket
l_int|3
)braket
op_assign
(brace
id|_x1
comma
id|_x2
comma
id|_x2
comma
id|_x6
comma
id|_x0_5
)brace
comma
(braket
l_int|4
)braket
op_assign
(brace
id|_x1
comma
id|_x1
comma
id|_x2
comma
id|_x2
comma
id|_x0_16
)brace
comma
(braket
l_int|8
)braket
op_assign
(brace
id|_x1
comma
id|_x1
comma
id|_x1
comma
id|_x2
comma
id|_x0_16
)brace
comma
(braket
l_int|9
)braket
op_assign
(brace
id|_x1
comma
id|_x2
comma
id|_x2
comma
id|_x4
comma
id|_x0_33
)brace
comma
(braket
l_int|12
)braket
op_assign
(brace
id|_x1
comma
id|_x1
comma
id|_x2
comma
id|_x4
comma
id|_x0_33
)brace
comma
(braket
l_int|14
)braket
op_assign
(brace
id|_x1
comma
id|_x3
comma
id|_x3
comma
id|_x9
comma
id|_x0_75
)brace
comma
(braket
l_int|15
)braket
op_assign
(brace
id|_x1
comma
id|_x1_5
comma
id|_x1_5
comma
id|_x4_5
comma
id|_x0_375
)brace
comma
DECL|macro|CLOCK_CMODES_PERMITTED_FR405
mdefine_line|#define CLOCK_CMODES_PERMITTED_FR405 0xd31f
)brace
suffix:semicolon
DECL|variable|clock_cmodes_fr555
r_static
r_struct
id|clock_cmode
id|__pminitdata
id|clock_cmodes_fr555
(braket
l_int|16
)braket
op_assign
(brace
(braket
l_int|0
)braket
op_assign
(brace
id|_x1
comma
id|_x2
comma
id|_x2
comma
id|_x4
comma
id|_x0_33
)brace
comma
(braket
l_int|1
)braket
op_assign
(brace
id|_x1
comma
id|_x3
comma
id|_x3
comma
id|_x6
comma
id|_x0_5
)brace
comma
(braket
l_int|2
)braket
op_assign
(brace
id|_x1
comma
id|_x2
comma
id|_x4
comma
id|_x8
comma
id|_x0_66
)brace
comma
(braket
l_int|3
)braket
op_assign
(brace
id|_x1
comma
id|_x1_5
comma
id|_x3
comma
id|_x6
comma
id|_x0_5
)brace
comma
(braket
l_int|4
)braket
op_assign
(brace
id|_x1
comma
id|_x3
comma
id|_x3
comma
id|_x9
comma
id|_x0_75
)brace
comma
(braket
l_int|5
)braket
op_assign
(brace
id|_x1
comma
id|_x2
comma
id|_x2
comma
id|_x6
comma
id|_x0_5
)brace
comma
(braket
l_int|6
)braket
op_assign
(brace
id|_x1
comma
id|_x1_5
comma
id|_x1_5
comma
id|_x4_5
comma
id|_x0_375
)brace
comma
)brace
suffix:semicolon
DECL|variable|clock_cmodes
r_static
r_const
r_struct
id|clock_cmode
id|__pminitdata
op_star
id|clock_cmodes
suffix:semicolon
DECL|variable|clock_doubled
r_static
r_int
id|__pminitdata
id|clock_doubled
suffix:semicolon
DECL|variable|__frv_uart0
r_static
r_struct
id|uart_port
id|__initdata
id|__frv_uart0
op_assign
(brace
dot
id|uartclk
op_assign
l_int|0
comma
dot
id|membase
op_assign
(paren
r_char
op_star
)paren
id|UART0_BASE
comma
dot
id|irq
op_assign
id|IRQ_CPU_UART0
comma
dot
id|regshift
op_assign
l_int|3
comma
dot
id|iotype
op_assign
id|UPIO_MEM
comma
dot
id|flags
op_assign
id|UPF_BOOT_AUTOCONF
op_or
id|UPF_SKIP_TEST
comma
)brace
suffix:semicolon
DECL|variable|__frv_uart1
r_static
r_struct
id|uart_port
id|__initdata
id|__frv_uart1
op_assign
(brace
dot
id|uartclk
op_assign
l_int|0
comma
dot
id|membase
op_assign
(paren
r_char
op_star
)paren
id|UART1_BASE
comma
dot
id|irq
op_assign
id|IRQ_CPU_UART1
comma
dot
id|regshift
op_assign
l_int|3
comma
dot
id|iotype
op_assign
id|UPIO_MEM
comma
dot
id|flags
op_assign
id|UPF_BOOT_AUTOCONF
op_or
id|UPF_SKIP_TEST
comma
)brace
suffix:semicolon
macro_line|#if 0
r_static
r_void
id|__init
id|printk_xampr
c_func
(paren
r_int
r_int
id|ampr
comma
r_int
r_int
id|amlr
comma
r_char
id|i_d
comma
r_int
id|n
)paren
(brace
r_int
r_int
id|phys
comma
id|virt
comma
id|cxn
comma
id|size
suffix:semicolon
macro_line|#ifdef CONFIG_MMU
id|virt
op_assign
id|amlr
op_amp
l_int|0xffffc000
suffix:semicolon
id|cxn
op_assign
id|amlr
op_amp
l_int|0x3fff
suffix:semicolon
macro_line|#else
id|virt
op_assign
id|ampr
op_amp
l_int|0xffffc000
suffix:semicolon
id|cxn
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|phys
op_assign
id|ampr
op_amp
id|xAMPRx_PPFN
suffix:semicolon
id|size
op_assign
l_int|1
op_lshift
(paren
(paren
(paren
id|ampr
op_amp
id|xAMPRx_SS
)paren
op_rshift
l_int|4
)paren
op_plus
l_int|17
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%cAMPR%d: va %08lx-%08lx [pa %08lx] %c%c%c%c [cxn:%04lx]&bslash;n&quot;
comma
id|i_d
comma
id|n
comma
id|virt
comma
id|virt
op_plus
id|size
op_minus
l_int|1
comma
id|phys
comma
id|ampr
op_amp
id|xAMPRx_S
ques
c_cond
l_char|&squot;S&squot;
suffix:colon
l_char|&squot;-&squot;
comma
id|ampr
op_amp
id|xAMPRx_C
ques
c_cond
l_char|&squot;C&squot;
suffix:colon
l_char|&squot;-&squot;
comma
id|ampr
op_amp
id|DAMPRx_WP
ques
c_cond
l_char|&squot;W&squot;
suffix:colon
l_char|&squot;-&squot;
comma
id|ampr
op_amp
id|xAMPRx_V
ques
c_cond
l_char|&squot;V&squot;
suffix:colon
l_char|&squot;-&squot;
comma
id|cxn
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * dump the memory map&n; */
DECL|function|dump_memory_map
r_static
r_void
id|__init
id|dump_memory_map
c_func
(paren
r_void
)paren
(brace
macro_line|#if 0
multiline_comment|/* dump the protection map */
id|printk_xampr
c_func
(paren
id|__get_IAMPR
c_func
(paren
l_int|0
)paren
comma
id|__get_IAMLR
c_func
(paren
l_int|0
)paren
comma
l_char|&squot;I&squot;
comma
l_int|0
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_IAMPR
c_func
(paren
l_int|1
)paren
comma
id|__get_IAMLR
c_func
(paren
l_int|1
)paren
comma
l_char|&squot;I&squot;
comma
l_int|1
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_IAMPR
c_func
(paren
l_int|2
)paren
comma
id|__get_IAMLR
c_func
(paren
l_int|2
)paren
comma
l_char|&squot;I&squot;
comma
l_int|2
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_IAMPR
c_func
(paren
l_int|3
)paren
comma
id|__get_IAMLR
c_func
(paren
l_int|3
)paren
comma
l_char|&squot;I&squot;
comma
l_int|3
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_IAMPR
c_func
(paren
l_int|4
)paren
comma
id|__get_IAMLR
c_func
(paren
l_int|4
)paren
comma
l_char|&squot;I&squot;
comma
l_int|4
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_IAMPR
c_func
(paren
l_int|5
)paren
comma
id|__get_IAMLR
c_func
(paren
l_int|5
)paren
comma
l_char|&squot;I&squot;
comma
l_int|5
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_IAMPR
c_func
(paren
l_int|6
)paren
comma
id|__get_IAMLR
c_func
(paren
l_int|6
)paren
comma
l_char|&squot;I&squot;
comma
l_int|6
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_IAMPR
c_func
(paren
l_int|7
)paren
comma
id|__get_IAMLR
c_func
(paren
l_int|7
)paren
comma
l_char|&squot;I&squot;
comma
l_int|7
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_IAMPR
c_func
(paren
l_int|8
)paren
comma
id|__get_IAMLR
c_func
(paren
l_int|8
)paren
comma
l_char|&squot;I&squot;
comma
l_int|8
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_IAMPR
c_func
(paren
l_int|9
)paren
comma
id|__get_IAMLR
c_func
(paren
l_int|9
)paren
comma
l_char|&squot;i&squot;
comma
l_int|9
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_IAMPR
c_func
(paren
l_int|10
)paren
comma
id|__get_IAMLR
c_func
(paren
l_int|10
)paren
comma
l_char|&squot;I&squot;
comma
l_int|10
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_IAMPR
c_func
(paren
l_int|11
)paren
comma
id|__get_IAMLR
c_func
(paren
l_int|11
)paren
comma
l_char|&squot;I&squot;
comma
l_int|11
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_IAMPR
c_func
(paren
l_int|12
)paren
comma
id|__get_IAMLR
c_func
(paren
l_int|12
)paren
comma
l_char|&squot;I&squot;
comma
l_int|12
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_IAMPR
c_func
(paren
l_int|13
)paren
comma
id|__get_IAMLR
c_func
(paren
l_int|13
)paren
comma
l_char|&squot;I&squot;
comma
l_int|13
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_IAMPR
c_func
(paren
l_int|14
)paren
comma
id|__get_IAMLR
c_func
(paren
l_int|14
)paren
comma
l_char|&squot;I&squot;
comma
l_int|14
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_IAMPR
c_func
(paren
l_int|15
)paren
comma
id|__get_IAMLR
c_func
(paren
l_int|15
)paren
comma
l_char|&squot;I&squot;
comma
l_int|15
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_DAMPR
c_func
(paren
l_int|0
)paren
comma
id|__get_DAMLR
c_func
(paren
l_int|0
)paren
comma
l_char|&squot;D&squot;
comma
l_int|0
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_DAMPR
c_func
(paren
l_int|1
)paren
comma
id|__get_DAMLR
c_func
(paren
l_int|1
)paren
comma
l_char|&squot;D&squot;
comma
l_int|1
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_DAMPR
c_func
(paren
l_int|2
)paren
comma
id|__get_DAMLR
c_func
(paren
l_int|2
)paren
comma
l_char|&squot;D&squot;
comma
l_int|2
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_DAMPR
c_func
(paren
l_int|3
)paren
comma
id|__get_DAMLR
c_func
(paren
l_int|3
)paren
comma
l_char|&squot;D&squot;
comma
l_int|3
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_DAMPR
c_func
(paren
l_int|4
)paren
comma
id|__get_DAMLR
c_func
(paren
l_int|4
)paren
comma
l_char|&squot;D&squot;
comma
l_int|4
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_DAMPR
c_func
(paren
l_int|5
)paren
comma
id|__get_DAMLR
c_func
(paren
l_int|5
)paren
comma
l_char|&squot;D&squot;
comma
l_int|5
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_DAMPR
c_func
(paren
l_int|6
)paren
comma
id|__get_DAMLR
c_func
(paren
l_int|6
)paren
comma
l_char|&squot;D&squot;
comma
l_int|6
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_DAMPR
c_func
(paren
l_int|7
)paren
comma
id|__get_DAMLR
c_func
(paren
l_int|7
)paren
comma
l_char|&squot;D&squot;
comma
l_int|7
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_DAMPR
c_func
(paren
l_int|8
)paren
comma
id|__get_DAMLR
c_func
(paren
l_int|8
)paren
comma
l_char|&squot;D&squot;
comma
l_int|8
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_DAMPR
c_func
(paren
l_int|9
)paren
comma
id|__get_DAMLR
c_func
(paren
l_int|9
)paren
comma
l_char|&squot;D&squot;
comma
l_int|9
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_DAMPR
c_func
(paren
l_int|10
)paren
comma
id|__get_DAMLR
c_func
(paren
l_int|10
)paren
comma
l_char|&squot;D&squot;
comma
l_int|10
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_DAMPR
c_func
(paren
l_int|11
)paren
comma
id|__get_DAMLR
c_func
(paren
l_int|11
)paren
comma
l_char|&squot;D&squot;
comma
l_int|11
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_DAMPR
c_func
(paren
l_int|12
)paren
comma
id|__get_DAMLR
c_func
(paren
l_int|12
)paren
comma
l_char|&squot;D&squot;
comma
l_int|12
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_DAMPR
c_func
(paren
l_int|13
)paren
comma
id|__get_DAMLR
c_func
(paren
l_int|13
)paren
comma
l_char|&squot;D&squot;
comma
l_int|13
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_DAMPR
c_func
(paren
l_int|14
)paren
comma
id|__get_DAMLR
c_func
(paren
l_int|14
)paren
comma
l_char|&squot;D&squot;
comma
l_int|14
)paren
suffix:semicolon
id|printk_xampr
c_func
(paren
id|__get_DAMPR
c_func
(paren
l_int|15
)paren
comma
id|__get_DAMLR
c_func
(paren
l_int|15
)paren
comma
l_char|&squot;D&squot;
comma
l_int|15
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if 0
multiline_comment|/* dump the bus controller registers */
id|printk
c_func
(paren
l_string|&quot;LGCR: %08lx&bslash;n&quot;
comma
id|__get_LGCR
c_func
(paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Master: %08lx-%08lx CR=%08lx&bslash;n&quot;
comma
id|__get_LEMBR
c_func
(paren
)paren
comma
id|__get_LEMBR
c_func
(paren
)paren
op_plus
id|__get_LEMAM
c_func
(paren
)paren
comma
id|__get_LMAICR
c_func
(paren
)paren
)paren
suffix:semicolon
r_int
id|loop
suffix:semicolon
r_for
c_loop
(paren
id|loop
op_assign
l_int|1
suffix:semicolon
id|loop
op_le
l_int|7
suffix:semicolon
id|loop
op_increment
)paren
(brace
r_int
r_int
id|lcr
op_assign
id|__get_LCR
c_func
(paren
id|loop
)paren
comma
id|lsbr
op_assign
id|__get_LSBR
c_func
(paren
id|loop
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;CS#%d: %08lx-%08lx %c%c%c%c%c%c%c%c%c&bslash;n&quot;
comma
id|loop
comma
id|lsbr
comma
id|lsbr
op_plus
id|__get_LSAM
c_func
(paren
id|loop
)paren
comma
id|lcr
op_amp
l_int|0x80000000
ques
c_cond
l_char|&squot;r&squot;
suffix:colon
l_char|&squot;-&squot;
comma
id|lcr
op_amp
l_int|0x40000000
ques
c_cond
l_char|&squot;w&squot;
suffix:colon
l_char|&squot;-&squot;
comma
id|lcr
op_amp
l_int|0x08000000
ques
c_cond
l_char|&squot;b&squot;
suffix:colon
l_char|&squot;-&squot;
comma
id|lcr
op_amp
l_int|0x04000000
ques
c_cond
l_char|&squot;B&squot;
suffix:colon
l_char|&squot;-&squot;
comma
id|lcr
op_amp
l_int|0x02000000
ques
c_cond
l_char|&squot;C&squot;
suffix:colon
l_char|&squot;-&squot;
comma
id|lcr
op_amp
l_int|0x01000000
ques
c_cond
l_char|&squot;D&squot;
suffix:colon
l_char|&squot;-&squot;
comma
id|lcr
op_amp
l_int|0x00800000
ques
c_cond
l_char|&squot;W&squot;
suffix:colon
l_char|&squot;-&squot;
comma
id|lcr
op_amp
l_int|0x00400000
ques
c_cond
l_char|&squot;R&squot;
suffix:colon
l_char|&squot;-&squot;
comma
(paren
id|lcr
op_amp
l_int|0x00030000
)paren
op_eq
l_int|0x00000000
ques
c_cond
l_char|&squot;4&squot;
suffix:colon
(paren
id|lcr
op_amp
l_int|0x00030000
)paren
op_eq
l_int|0x00010000
ques
c_cond
l_char|&squot;2&squot;
suffix:colon
(paren
id|lcr
op_amp
l_int|0x00030000
)paren
op_eq
l_int|0x00020000
ques
c_cond
l_char|&squot;1&squot;
suffix:colon
l_char|&squot;-&squot;
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* end dump_memory_map() */
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * attempt to detect a VDK motherboard and DAV daughter board on an MB93091 system&n; */
macro_line|#ifdef CONFIG_MB93091_VDK
DECL|function|detect_mb93091
r_static
r_void
id|__init
id|detect_mb93091
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_MB93090_MB00
multiline_comment|/* Detect CB70 without motherboard */
r_if
c_cond
(paren
op_logical_neg
(paren
id|cpu_system
op_eq
id|__frv_mb93091_cb70
op_logical_and
(paren
(paren
op_star
(paren
r_int
r_int
op_star
)paren
l_int|0xffc00030
)paren
op_amp
l_int|0x100
)paren
)paren
)paren
(brace
id|cpu_board1
op_assign
id|__frv_mb93090_mb00
suffix:semicolon
id|mb93090_mb00_detected
op_assign
l_int|1
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FUJITSU_MB93493
id|cpu_board2
op_assign
id|__frv_mb93493
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* end detect_mb93091() */
macro_line|#endif
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * determine the CPU type and set appropriate parameters&n; *&n; * Family     Series      CPU Core    Silicon    Imple  Vers&n; * ----------------------------------------------------------&n; * FR-V --+-&gt; FR400 --+-&gt; FR401 --+-&gt; MB93401     02     00 [1]&n; *        |           |           |&n; *        |           |           +-&gt; MB93401/A   02     01&n; *        |           |           |&n; *        |           |           +-&gt; MB93403     02     02&n; *        |           |&n; *        |           +-&gt; FR405 ----&gt; MB93405     04     00&n; *        |&n; *        +-&gt; FR450 ----&gt; FR451 ----&gt; MB93451     05     00&n; *        |&n; *        +-&gt; FR500 ----&gt; FR501 --+-&gt; MB93501     01     01 [2]&n; *        |                       |&n; *        |                       +-&gt; MB93501/A   01     02&n; *        |&n; *        +-&gt; FR550 --+-&gt; FR551 ----&gt; MB93555     03     01&n; *&n; *  [1] The MB93401 is an obsolete CPU replaced by the MB93401A&n; *  [2] The MB93501 is an obsolete CPU replaced by the MB93501A&n; *&n; * Imple is PSR(Processor Status Register)[31:28].&n; * Vers is PSR(Processor Status Register)[27:24].&n; *&n; * A &quot;Silicon&quot; consists of CPU core and some on-chip peripherals.&n; */
DECL|function|determine_cpu
r_static
r_void
id|__init
id|determine_cpu
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|hsr0
op_assign
id|__get_HSR
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_int
r_int
id|psr
op_assign
id|__get_PSR
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* work out what selectable services the CPU supports */
id|__set_PSR
c_func
(paren
id|psr
op_or
id|PSR_EM
op_or
id|PSR_EF
op_or
id|PSR_CM
op_or
id|PSR_NEM
)paren
suffix:semicolon
id|cpu_psr_all
op_assign
id|__get_PSR
c_func
(paren
)paren
suffix:semicolon
id|__set_PSR
c_func
(paren
id|psr
)paren
suffix:semicolon
id|__set_HSR
c_func
(paren
l_int|0
comma
id|hsr0
op_or
id|HSR0_GRLE
op_or
id|HSR0_GRHE
op_or
id|HSR0_FRLE
op_or
id|HSR0_FRHE
)paren
suffix:semicolon
id|cpu_hsr0_all
op_assign
id|__get_HSR
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|__set_HSR
c_func
(paren
l_int|0
comma
id|hsr0
)paren
suffix:semicolon
multiline_comment|/* derive other service specs from the CPU type */
id|cpu_series
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
id|cpu_core
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
id|cpu_silicon
op_assign
l_string|&quot;unknown&quot;
suffix:semicolon
id|cpu_mmu
op_assign
l_string|&quot;Prot&quot;
suffix:semicolon
id|cpu_system
op_assign
id|__frv_unknown_system
suffix:semicolon
id|clock_cmodes
op_assign
l_int|NULL
suffix:semicolon
id|clock_doubled
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_PM
id|clock_bits_settable
op_assign
id|CLOCK_BIT_CM_H
op_or
id|CLOCK_BIT_CM_M
op_or
id|CLOCK_BIT_P0
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|PSR_IMPLE
c_func
(paren
id|psr
)paren
)paren
(brace
r_case
id|PSR_IMPLE_FR401
suffix:colon
id|cpu_series
op_assign
l_string|&quot;fr400&quot;
suffix:semicolon
id|cpu_core
op_assign
l_string|&quot;fr401&quot;
suffix:semicolon
id|pdm_suspend_mode
op_assign
id|HSR0_PDM_PLL_RUN
suffix:semicolon
r_switch
c_cond
(paren
id|PSR_VERSION
c_func
(paren
id|psr
)paren
)paren
(brace
r_case
id|PSR_VERSION_FR401_MB93401
suffix:colon
id|cpu_silicon
op_assign
l_string|&quot;mb93401&quot;
suffix:semicolon
id|cpu_system
op_assign
id|__frv_mb93091_cb10
suffix:semicolon
id|clock_cmodes
op_assign
id|clock_cmodes_fr401_fr403
suffix:semicolon
id|clock_doubled
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSR_VERSION_FR401_MB93401A
suffix:colon
id|cpu_silicon
op_assign
l_string|&quot;mb93401/A&quot;
suffix:semicolon
id|cpu_system
op_assign
id|__frv_mb93091_cb11
suffix:semicolon
id|clock_cmodes
op_assign
id|clock_cmodes_fr401_fr403
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSR_VERSION_FR401_MB93403
suffix:colon
id|cpu_silicon
op_assign
l_string|&quot;mb93403&quot;
suffix:semicolon
macro_line|#ifndef CONFIG_MB93093_PDK
id|cpu_system
op_assign
id|__frv_mb93091_cb30
suffix:semicolon
macro_line|#else
id|cpu_system
op_assign
id|__frv_mb93093
suffix:semicolon
macro_line|#endif
id|clock_cmodes
op_assign
id|clock_cmodes_fr401_fr403
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PSR_IMPLE_FR405
suffix:colon
id|cpu_series
op_assign
l_string|&quot;fr400&quot;
suffix:semicolon
id|cpu_core
op_assign
l_string|&quot;fr405&quot;
suffix:semicolon
id|pdm_suspend_mode
op_assign
id|HSR0_PDM_PLL_STOP
suffix:semicolon
r_switch
c_cond
(paren
id|PSR_VERSION
c_func
(paren
id|psr
)paren
)paren
(brace
r_case
id|PSR_VERSION_FR405_MB93405
suffix:colon
id|cpu_silicon
op_assign
l_string|&quot;mb93405&quot;
suffix:semicolon
id|cpu_system
op_assign
id|__frv_mb93091_cb60
suffix:semicolon
id|clock_cmodes
op_assign
id|clock_cmodes_fr405
suffix:semicolon
macro_line|#ifdef CONFIG_PM
id|clock_bits_settable
op_or_assign
id|CLOCK_BIT_CMODE
suffix:semicolon
id|clock_cmodes_permitted
op_assign
id|CLOCK_CMODES_PERMITTED_FR405
suffix:semicolon
macro_line|#endif
multiline_comment|/* the FPGA on the CB70 has extra registers&n;&t;&t;&t; * - it has 0x0046 in the VDK_ID FPGA register at 0x1a0, which is&n;&t;&t;&t; *   how we tell the difference between it and a CB60&n;&t;&t;&t; */
r_if
c_cond
(paren
op_star
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xffc001a0
op_eq
l_int|0x0046
)paren
id|cpu_system
op_assign
id|__frv_mb93091_cb70
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PSR_IMPLE_FR451
suffix:colon
id|cpu_series
op_assign
l_string|&quot;fr450&quot;
suffix:semicolon
id|cpu_core
op_assign
l_string|&quot;fr451&quot;
suffix:semicolon
id|pdm_suspend_mode
op_assign
id|HSR0_PDM_PLL_STOP
suffix:semicolon
macro_line|#ifdef CONFIG_PM
id|clock_bits_settable
op_or_assign
id|CLOCK_BIT_CMODE
suffix:semicolon
id|clock_cmodes_permitted
op_assign
id|CLOCK_CMODES_PERMITTED_FR405
suffix:semicolon
macro_line|#endif
r_switch
c_cond
(paren
id|PSR_VERSION
c_func
(paren
id|psr
)paren
)paren
(brace
r_case
id|PSR_VERSION_FR451_MB93451
suffix:colon
id|cpu_silicon
op_assign
l_string|&quot;mb93451&quot;
suffix:semicolon
id|cpu_mmu
op_assign
l_string|&quot;Prot, SAT, xSAT, DAT&quot;
suffix:semicolon
id|cpu_system
op_assign
id|__frv_mb93091_cb451
suffix:semicolon
id|clock_cmodes
op_assign
id|clock_cmodes_fr405
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PSR_IMPLE_FR501
suffix:colon
id|cpu_series
op_assign
l_string|&quot;fr500&quot;
suffix:semicolon
id|cpu_core
op_assign
l_string|&quot;fr501&quot;
suffix:semicolon
id|pdm_suspend_mode
op_assign
id|HSR0_PDM_PLL_STOP
suffix:semicolon
r_switch
c_cond
(paren
id|PSR_VERSION
c_func
(paren
id|psr
)paren
)paren
(brace
r_case
id|PSR_VERSION_FR501_MB93501
suffix:colon
id|cpu_silicon
op_assign
l_string|&quot;mb93501&quot;
suffix:semicolon
r_break
suffix:semicolon
r_case
id|PSR_VERSION_FR501_MB93501A
suffix:colon
id|cpu_silicon
op_assign
l_string|&quot;mb93501/A&quot;
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|PSR_IMPLE_FR551
suffix:colon
id|cpu_series
op_assign
l_string|&quot;fr550&quot;
suffix:semicolon
id|cpu_core
op_assign
l_string|&quot;fr551&quot;
suffix:semicolon
id|pdm_suspend_mode
op_assign
id|HSR0_PDM_PLL_RUN
suffix:semicolon
r_switch
c_cond
(paren
id|PSR_VERSION
c_func
(paren
id|psr
)paren
)paren
(brace
r_case
id|PSR_VERSION_FR551_MB93555
suffix:colon
id|cpu_silicon
op_assign
l_string|&quot;mb93555&quot;
suffix:semicolon
id|cpu_mmu
op_assign
l_string|&quot;Prot, SAT&quot;
suffix:semicolon
id|cpu_system
op_assign
id|__frv_mb93091_cb41
suffix:semicolon
id|clock_cmodes
op_assign
id|clock_cmodes_fr555
suffix:semicolon
id|clock_doubled
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;- Series:%s CPU:%s Silicon:%s&bslash;n&quot;
comma
id|cpu_series
comma
id|cpu_core
comma
id|cpu_silicon
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MB93091_VDK
id|detect_mb93091
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_MB93093_PDK) &amp;&amp; defined(CONFIG_FUJITSU_MB93493)
id|cpu_board2
op_assign
id|__frv_mb93493
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* end determine_cpu() */
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * calculate the bus clock speed&n; */
DECL|function|determine_clocks
r_void
id|__pminit
id|determine_clocks
c_func
(paren
r_int
id|verbose
)paren
(brace
r_const
r_struct
id|clock_cmode
op_star
id|mode
comma
op_star
id|tmode
suffix:semicolon
r_int
r_int
id|clkc
comma
id|psr
comma
id|quot
suffix:semicolon
id|clkc
op_assign
id|__get_CLKC
c_func
(paren
)paren
suffix:semicolon
id|psr
op_assign
id|__get_PSR
c_func
(paren
)paren
suffix:semicolon
id|clock_p0_current
op_assign
op_logical_neg
op_logical_neg
(paren
id|clkc
op_amp
id|CLKC_P0
)paren
suffix:semicolon
id|clock_cm_current
op_assign
id|clkc
op_amp
id|CLKC_CM
suffix:semicolon
id|clock_cmode_current
op_assign
(paren
id|clkc
op_amp
id|CLKC_CMODE
)paren
op_rshift
id|CLKC_CMODE_s
suffix:semicolon
r_if
c_cond
(paren
id|verbose
)paren
id|printk
c_func
(paren
l_string|&quot;psr=%08lx hsr0=%08lx clkc=%08lx&bslash;n&quot;
comma
id|psr
comma
id|__get_HSR
c_func
(paren
l_int|0
)paren
comma
id|clkc
)paren
suffix:semicolon
multiline_comment|/* the CB70 has some alternative ways of setting the clock speed through switches accessed&n;&t; * through the FPGA.  */
r_if
c_cond
(paren
id|cpu_system
op_eq
id|__frv_mb93091_cb70
)paren
(brace
r_int
r_int
id|clkswr
op_assign
op_star
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xffc00104UL
op_amp
l_int|0x1fffUL
suffix:semicolon
r_if
c_cond
(paren
id|clkswr
op_amp
l_int|0x1000
)paren
id|__clkin_clock_speed_HZ
op_assign
l_int|60000000UL
suffix:semicolon
r_else
id|__clkin_clock_speed_HZ
op_assign
(paren
(paren
id|clkswr
op_rshift
l_int|8
)paren
op_amp
l_int|0xf
)paren
op_star
l_int|10000000
op_plus
(paren
(paren
id|clkswr
op_rshift
l_int|4
)paren
op_amp
l_int|0xf
)paren
op_star
l_int|1000000
op_plus
(paren
(paren
id|clkswr
)paren
op_amp
l_int|0xf
)paren
op_star
l_int|100000
suffix:semicolon
)brace
multiline_comment|/* the FR451 is currently fixed at 24MHz */
r_else
r_if
c_cond
(paren
id|cpu_system
op_eq
id|__frv_mb93091_cb451
)paren
(brace
singleline_comment|//__clkin_clock_speed_HZ = 24000000UL; // CB451-FPGA
r_int
r_int
id|clkswr
op_assign
op_star
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xffc00104UL
op_amp
l_int|0x1fffUL
suffix:semicolon
r_if
c_cond
(paren
id|clkswr
op_amp
l_int|0x1000
)paren
id|__clkin_clock_speed_HZ
op_assign
l_int|60000000UL
suffix:semicolon
r_else
id|__clkin_clock_speed_HZ
op_assign
(paren
(paren
id|clkswr
op_rshift
l_int|8
)paren
op_amp
l_int|0xf
)paren
op_star
l_int|10000000
op_plus
(paren
(paren
id|clkswr
op_rshift
l_int|4
)paren
op_amp
l_int|0xf
)paren
op_star
l_int|1000000
op_plus
(paren
(paren
id|clkswr
)paren
op_amp
l_int|0xf
)paren
op_star
l_int|100000
suffix:semicolon
)brace
multiline_comment|/* otherwise determine the clockspeed from VDK or other registers */
r_else
(brace
id|__clkin_clock_speed_HZ
op_assign
id|__get_CLKIN
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* look up the appropriate clock relationships table entry */
id|mode
op_assign
op_amp
id|undef_clock_cmode
suffix:semicolon
r_if
c_cond
(paren
id|clock_cmodes
)paren
(brace
id|tmode
op_assign
op_amp
id|clock_cmodes
(braket
(paren
id|clkc
op_amp
id|CLKC_CMODE
)paren
op_rshift
id|CLKC_CMODE_s
)braket
suffix:semicolon
r_if
c_cond
(paren
id|tmode-&gt;xbus
)paren
id|mode
op_assign
id|tmode
suffix:semicolon
)brace
DECL|macro|CLOCK
mdefine_line|#define CLOCK(SRC,RATIO) ((SRC) * (((RATIO) &gt;&gt; 4) &amp; 0x0f) / ((RATIO) &amp; 0x0f))
r_if
c_cond
(paren
id|clock_doubled
)paren
id|__clkin_clock_speed_HZ
op_lshift_assign
l_int|1
suffix:semicolon
id|__ext_bus_clock_speed_HZ
op_assign
id|CLOCK
c_func
(paren
id|__clkin_clock_speed_HZ
comma
id|mode-&gt;xbus
)paren
suffix:semicolon
id|__sdram_clock_speed_HZ
op_assign
id|CLOCK
c_func
(paren
id|__clkin_clock_speed_HZ
comma
id|mode-&gt;sdram
)paren
suffix:semicolon
id|__dsu_clock_speed_HZ
op_assign
id|CLOCK
c_func
(paren
id|__clkin_clock_speed_HZ
comma
id|mode-&gt;dsu
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|clkc
op_amp
id|CLKC_CM
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* High */
id|__core_bus_clock_speed_HZ
op_assign
id|CLOCK
c_func
(paren
id|__clkin_clock_speed_HZ
comma
id|mode-&gt;corebus
)paren
suffix:semicolon
id|__core_clock_speed_HZ
op_assign
id|CLOCK
c_func
(paren
id|__clkin_clock_speed_HZ
comma
id|mode-&gt;core
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
multiline_comment|/* Medium */
id|__core_bus_clock_speed_HZ
op_assign
id|CLOCK
c_func
(paren
id|__clkin_clock_speed_HZ
comma
id|mode-&gt;sdram
)paren
suffix:semicolon
id|__core_clock_speed_HZ
op_assign
id|CLOCK
c_func
(paren
id|__clkin_clock_speed_HZ
comma
id|mode-&gt;sdram
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* Low; not supported */
r_case
l_int|3
suffix:colon
multiline_comment|/* UNDEF */
id|printk
c_func
(paren
l_string|&quot;Unsupported CLKC CM %ld&bslash;n&quot;
comma
id|clkc
op_amp
id|CLKC_CM
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;Bye&quot;
)paren
suffix:semicolon
)brace
id|__res_bus_clock_speed_HZ
op_assign
id|__ext_bus_clock_speed_HZ
suffix:semicolon
r_if
c_cond
(paren
id|clkc
op_amp
id|CLKC_P0
)paren
id|__res_bus_clock_speed_HZ
op_rshift_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|verbose
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;CLKIN: %lu.%3.3luMHz&bslash;n&quot;
comma
id|__clkin_clock_speed_HZ
op_div
l_int|1000000
comma
(paren
id|__clkin_clock_speed_HZ
op_div
l_int|1000
)paren
op_mod
l_int|1000
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;CLKS:&quot;
l_string|&quot; ext=%luMHz res=%luMHz sdram=%luMHz cbus=%luMHz core=%luMHz dsu=%luMHz&bslash;n&quot;
comma
id|__ext_bus_clock_speed_HZ
op_div
l_int|1000000
comma
id|__res_bus_clock_speed_HZ
op_div
l_int|1000000
comma
id|__sdram_clock_speed_HZ
op_div
l_int|1000000
comma
id|__core_bus_clock_speed_HZ
op_div
l_int|1000000
comma
id|__core_clock_speed_HZ
op_div
l_int|1000000
comma
id|__dsu_clock_speed_HZ
op_div
l_int|1000000
)paren
suffix:semicolon
)brace
multiline_comment|/* calculate the number of __delay() loop iterations per sec (2 insn loop) */
id|__delay_loops_MHz
op_assign
id|__core_clock_speed_HZ
op_div
(paren
l_int|1000000
op_star
l_int|2
)paren
suffix:semicolon
multiline_comment|/* set the serial prescaler */
id|__serial_clock_speed_HZ
op_assign
id|__res_bus_clock_speed_HZ
suffix:semicolon
id|quot
op_assign
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|__serial_clock_speed_HZ
op_div
id|quot
op_div
l_int|16
op_div
l_int|65536
OG
l_int|3000
)paren
id|quot
op_add_assign
l_int|1
suffix:semicolon
multiline_comment|/* double the divisor if P0 is clear, so that if/when P0 is set, it&squot;s still achievable&n;&t; * - we have to be careful - dividing too much can mean we can&squot;t get 115200 baud&n;&t; */
r_if
c_cond
(paren
id|__serial_clock_speed_HZ
OG
l_int|32000000
op_logical_and
op_logical_neg
(paren
id|clkc
op_amp
id|CLKC_P0
)paren
)paren
id|quot
op_lshift_assign
l_int|1
suffix:semicolon
id|__serial_clock_speed_HZ
op_div_assign
id|quot
suffix:semicolon
id|__frv_uart0.uartclk
op_assign
id|__serial_clock_speed_HZ
suffix:semicolon
id|__frv_uart1.uartclk
op_assign
id|__serial_clock_speed_HZ
suffix:semicolon
r_if
c_cond
(paren
id|verbose
)paren
id|printk
c_func
(paren
l_string|&quot;      uart=%luMHz&bslash;n&quot;
comma
id|__serial_clock_speed_HZ
op_div
l_int|1000000
op_star
id|quot
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|__get_UART0_LSR
c_func
(paren
)paren
op_amp
id|UART_LSR_TEMT
)paren
)paren
r_continue
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
(paren
id|__get_UART1_LSR
c_func
(paren
)paren
op_amp
id|UART_LSR_TEMT
)paren
)paren
r_continue
suffix:semicolon
id|__set_UCPVR
c_func
(paren
id|quot
)paren
suffix:semicolon
id|__set_UCPSR
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* end determine_clocks() */
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * reserve some DMA consistent memory&n; */
macro_line|#ifdef CONFIG_RESERVE_DMA_COHERENT
DECL|function|reserve_dma_coherent
r_static
r_void
id|__init
id|reserve_dma_coherent
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|ampr
suffix:semicolon
multiline_comment|/* find the first non-kernel memory tile and steal it */
DECL|macro|__steal_AMPR
mdefine_line|#define __steal_AMPR(r)&t;&t;&t;&t;&t;&t;&bslash;&n;&t;if (__get_DAMPR(r) &amp; xAMPRx_V) {&t;&t;&t;&bslash;&n;&t;&t;ampr = __get_DAMPR(r);&t;&t;&t;&t;&bslash;&n;&t;&t;__set_DAMPR(r, ampr | xAMPRx_S | xAMPRx_C);&t;&bslash;&n;&t;&t;__set_IAMPR(r, 0);&t;&t;&t;&t;&bslash;&n;&t;&t;goto found;&t;&t;&t;&t;&t;&bslash;&n;&t;}
id|__steal_AMPR
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|__steal_AMPR
c_func
(paren
l_int|2
)paren
suffix:semicolon
id|__steal_AMPR
c_func
(paren
l_int|3
)paren
suffix:semicolon
id|__steal_AMPR
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|__steal_AMPR
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|__steal_AMPR
c_func
(paren
l_int|6
)paren
suffix:semicolon
r_if
c_cond
(paren
id|PSR_IMPLE
c_func
(paren
id|__get_PSR
c_func
(paren
)paren
)paren
op_eq
id|PSR_IMPLE_FR551
)paren
(brace
id|__steal_AMPR
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|__steal_AMPR
c_func
(paren
l_int|8
)paren
suffix:semicolon
id|__steal_AMPR
c_func
(paren
l_int|9
)paren
suffix:semicolon
id|__steal_AMPR
c_func
(paren
l_int|10
)paren
suffix:semicolon
id|__steal_AMPR
c_func
(paren
l_int|11
)paren
suffix:semicolon
id|__steal_AMPR
c_func
(paren
l_int|12
)paren
suffix:semicolon
id|__steal_AMPR
c_func
(paren
l_int|13
)paren
suffix:semicolon
id|__steal_AMPR
c_func
(paren
l_int|14
)paren
suffix:semicolon
)brace
multiline_comment|/* unable to grant any DMA consistent memory */
id|printk
c_func
(paren
l_string|&quot;No DMA consistent memory reserved&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
id|found
suffix:colon
id|dma_coherent_mem_start
op_assign
id|ampr
op_amp
id|xAMPRx_PPFN
suffix:semicolon
id|ampr
op_and_assign
id|xAMPRx_SS
suffix:semicolon
id|ampr
op_rshift_assign
l_int|4
suffix:semicolon
id|ampr
op_assign
l_int|1
op_lshift
(paren
id|ampr
op_minus
l_int|3
op_plus
l_int|20
)paren
suffix:semicolon
id|dma_coherent_mem_end
op_assign
id|dma_coherent_mem_start
op_plus
id|ampr
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;DMA consistent memory reserved %lx-%lx&bslash;n&quot;
comma
id|dma_coherent_mem_start
comma
id|dma_coherent_mem_end
)paren
suffix:semicolon
)brace
multiline_comment|/* end reserve_dma_coherent() */
macro_line|#endif
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * calibrate the delay loop&n; */
DECL|function|calibrate_delay
r_void
id|__init
id|calibrate_delay
c_func
(paren
r_void
)paren
(brace
id|loops_per_jiffy
op_assign
id|__delay_loops_MHz
op_star
(paren
l_int|1000000
op_div
id|HZ
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Calibrating delay loop... %lu.%02lu BogoMIPS&bslash;n&quot;
comma
id|loops_per_jiffy
op_div
(paren
l_int|500000
op_div
id|HZ
)paren
comma
(paren
id|loops_per_jiffy
op_div
(paren
l_int|5000
op_div
id|HZ
)paren
)paren
op_mod
l_int|100
)paren
suffix:semicolon
)brace
multiline_comment|/* end calibrate_delay() */
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * look through the command line for some things we need to know immediately&n; */
DECL|function|parse_cmdline_early
r_static
r_void
id|__init
id|parse_cmdline_early
c_func
(paren
r_char
op_star
id|cmdline
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cmdline
)paren
r_return
suffix:semicolon
r_while
c_loop
(paren
op_star
id|cmdline
)paren
(brace
r_if
c_cond
(paren
op_star
id|cmdline
op_eq
l_char|&squot; &squot;
)paren
id|cmdline
op_increment
suffix:semicolon
multiline_comment|/* &quot;mem=XXX[kKmM]&quot; sets SDRAM size to &lt;mem&gt;, overriding the value we worked&n;&t;&t; * out from the SDRAM controller mask register&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|cmdline
comma
l_string|&quot;mem=&quot;
comma
l_int|4
)paren
)paren
(brace
r_int
r_int
r_int
id|mem_size
suffix:semicolon
id|mem_size
op_assign
id|memparse
c_func
(paren
id|cmdline
op_plus
l_int|4
comma
op_amp
id|cmdline
)paren
suffix:semicolon
id|memory_end
op_assign
id|memory_start
op_plus
id|mem_size
suffix:semicolon
)brace
r_while
c_loop
(paren
op_star
id|cmdline
op_logical_and
op_star
id|cmdline
op_ne
l_char|&squot; &squot;
)paren
id|cmdline
op_increment
suffix:semicolon
)brace
)brace
multiline_comment|/* end parse_cmdline_early() */
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; *&n; */
DECL|function|setup_arch
r_void
id|__init
id|setup_arch
c_func
(paren
r_char
op_star
op_star
id|cmdline_p
)paren
(brace
macro_line|#ifdef CONFIG_MMU
id|printk
c_func
(paren
l_string|&quot;Linux FR-V port done by Red Hat Inc &lt;dhowells@redhat.com&gt;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#else
id|printk
c_func
(paren
l_string|&quot;uClinux FR-V port done by Red Hat Inc &lt;dhowells@redhat.com&gt;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|memcpy
c_func
(paren
id|saved_command_line
comma
id|redboot_command_line
comma
id|COMMAND_LINE_SIZE
)paren
suffix:semicolon
id|determine_cpu
c_func
(paren
)paren
suffix:semicolon
id|determine_clocks
c_func
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* For printk-directly-beats-on-serial-hardware hack */
id|console_set_baud
c_func
(paren
l_int|115200
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_GDBSTUB
id|gdbstub_set_baud
c_func
(paren
l_int|115200
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_RESERVE_DMA_COHERENT
id|reserve_dma_coherent
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|dump_memory_map
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_MB93090_MB00
r_if
c_cond
(paren
id|mb93090_mb00_detected
)paren
id|mb93090_display
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* register those serial ports that are available */
macro_line|#ifndef CONFIG_GDBSTUB_UART0
id|__reg
c_func
(paren
id|UART0_BASE
op_plus
id|UART_IER
op_star
l_int|8
)paren
op_assign
l_int|0
suffix:semicolon
id|early_serial_setup
c_func
(paren
op_amp
id|__frv_uart0
)paren
suffix:semicolon
singleline_comment|//&t;register_serial(&amp;__frv_uart0);
macro_line|#endif
macro_line|#ifndef CONFIG_GDBSTUB_UART1
id|__reg
c_func
(paren
id|UART1_BASE
op_plus
id|UART_IER
op_star
l_int|8
)paren
op_assign
l_int|0
suffix:semicolon
id|early_serial_setup
c_func
(paren
op_amp
id|__frv_uart1
)paren
suffix:semicolon
singleline_comment|//&t;register_serial(&amp;__frv_uart1);
macro_line|#endif
macro_line|#if defined(CONFIG_CHR_DEV_FLASH) || defined(CONFIG_BLK_DEV_FLASH)
multiline_comment|/* we need to initialize the Flashrom device here since we might&n;&t; * do things with flash early on in the boot&n;&t; */
id|flash_probe
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* deal with the command line - RedBoot may have passed one to the kernel */
id|memcpy
c_func
(paren
id|command_line
comma
id|saved_command_line
comma
r_sizeof
(paren
id|command_line
)paren
)paren
suffix:semicolon
op_star
id|cmdline_p
op_assign
op_amp
id|command_line
(braket
l_int|0
)braket
suffix:semicolon
id|parse_cmdline_early
c_func
(paren
id|command_line
)paren
suffix:semicolon
multiline_comment|/* set up the memory description&n;&t; * - by now the stack is part of the init task */
id|printk
c_func
(paren
l_string|&quot;Memory %08lx-%08lx&bslash;n&quot;
comma
id|memory_start
comma
id|memory_end
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memory_start
op_eq
id|memory_end
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|init_mm.start_code
op_assign
(paren
r_int
r_int
)paren
op_amp
id|_stext
suffix:semicolon
id|init_mm.end_code
op_assign
(paren
r_int
r_int
)paren
op_amp
id|_etext
suffix:semicolon
id|init_mm.end_data
op_assign
(paren
r_int
r_int
)paren
op_amp
id|_edata
suffix:semicolon
macro_line|#if 0 /* DAVIDM - don&squot;t set brk just incase someone decides to use it */
id|init_mm.brk
op_assign
(paren
r_int
r_int
)paren
op_amp
id|_end
suffix:semicolon
macro_line|#else
id|init_mm.brk
op_assign
(paren
r_int
r_int
)paren
l_int|0
suffix:semicolon
macro_line|#endif
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
l_string|&quot;KERNEL -&gt; TEXT=0x%06x-0x%06x DATA=0x%06x-0x%06x BSS=0x%06x-0x%06x&bslash;n&quot;
comma
(paren
r_int
)paren
op_amp
id|_stext
comma
(paren
r_int
)paren
op_amp
id|_etext
comma
(paren
r_int
)paren
op_amp
id|_sdata
comma
(paren
r_int
)paren
op_amp
id|_edata
comma
(paren
r_int
)paren
op_amp
id|_sbss
comma
(paren
r_int
)paren
op_amp
id|_ebss
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_VT
macro_line|#if defined(CONFIG_VGA_CONSOLE)
id|conswitchp
op_assign
op_amp
id|vga_con
suffix:semicolon
macro_line|#elif defined(CONFIG_DUMMY_CONSOLE)
id|conswitchp
op_assign
op_amp
id|dummy_con
suffix:semicolon
macro_line|#endif
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_BLKMEM
id|ROOT_DEV
op_assign
id|MKDEV
c_func
(paren
id|BLKMEM_MAJOR
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*rom_length = (unsigned long)&amp;_flashend - (unsigned long)&amp;_romvec;*/
macro_line|#ifdef CONFIG_MMU
id|setup_linux_memory
c_func
(paren
)paren
suffix:semicolon
macro_line|#else
id|setup_uclinux_memory
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* get kmalloc into gear */
id|paging_init
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* init DMA */
id|frv_dma_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
id|printk
c_func
(paren
l_string|&quot;Done setup_arch&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* start the decrement timer running */
singleline_comment|//&t;asm volatile(&quot;movgs %0,timerd&quot; :: &quot;r&quot;(10000000));
singleline_comment|//&t;__set_HSR(0, __get_HSR(0) | HSR0_ETMD);
)brace
multiline_comment|/* end setup_arch() */
macro_line|#if 0
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; *&n; */
r_static
r_int
id|__devinit
id|setup_arch_serial
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* register those serial ports that are available */
macro_line|#ifndef CONFIG_GDBSTUB_UART0
id|early_serial_setup
c_func
(paren
op_amp
id|__frv_uart0
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifndef CONFIG_GDBSTUB_UART1
id|early_serial_setup
c_func
(paren
op_amp
id|__frv_uart1
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* end setup_arch_serial() */
id|late_initcall
c_func
(paren
id|setup_arch_serial
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * set up the memory map for normal MMU linux&n; */
macro_line|#ifdef CONFIG_MMU
DECL|function|setup_linux_memory
r_static
r_void
id|__init
id|setup_linux_memory
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|bootmap_size
comma
id|low_top_pfn
comma
id|kstart
comma
id|kend
comma
id|high_mem
suffix:semicolon
id|kstart
op_assign
(paren
r_int
r_int
)paren
op_amp
id|__kernel_image_start
op_minus
id|PAGE_OFFSET
suffix:semicolon
id|kend
op_assign
(paren
r_int
r_int
)paren
op_amp
id|__kernel_image_end
op_minus
id|PAGE_OFFSET
suffix:semicolon
id|kstart
op_assign
id|kstart
op_amp
id|PAGE_MASK
suffix:semicolon
id|kend
op_assign
(paren
id|kend
op_plus
id|PAGE_SIZE
op_minus
l_int|1
)paren
op_amp
id|PAGE_MASK
suffix:semicolon
multiline_comment|/* give all the memory to the bootmap allocator,  tell it to put the&n;&t; * boot mem_map immediately following the kernel image&n;&t; */
id|bootmap_size
op_assign
id|init_bootmem_node
c_func
(paren
id|NODE_DATA
c_func
(paren
l_int|0
)paren
comma
id|kend
op_rshift
id|PAGE_SHIFT
comma
multiline_comment|/* map addr */
id|memory_start
op_rshift
id|PAGE_SHIFT
comma
multiline_comment|/* start of RAM */
id|memory_end
op_rshift
id|PAGE_SHIFT
multiline_comment|/* end of RAM */
)paren
suffix:semicolon
multiline_comment|/* pass the memory that the kernel can immediately use over to the bootmem allocator */
id|max_mapnr
op_assign
id|num_physpages
op_assign
(paren
id|memory_end
op_minus
id|memory_start
)paren
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|low_top_pfn
op_assign
(paren
id|KERNEL_LOWMEM_END
op_minus
id|KERNEL_LOWMEM_START
)paren
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|high_mem
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|num_physpages
OG
id|low_top_pfn
)paren
(brace
macro_line|#ifdef CONFIG_HIGHMEM
id|high_mem
op_assign
id|num_physpages
op_minus
id|low_top_pfn
suffix:semicolon
macro_line|#else
id|max_mapnr
op_assign
id|num_physpages
op_assign
id|low_top_pfn
suffix:semicolon
macro_line|#endif
)brace
r_else
(brace
id|low_top_pfn
op_assign
id|num_physpages
suffix:semicolon
)brace
id|min_low_pfn
op_assign
id|memory_start
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|max_low_pfn
op_assign
id|low_top_pfn
suffix:semicolon
id|max_pfn
op_assign
id|memory_end
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|num_mappedpages
op_assign
id|low_top_pfn
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%ldMB LOWMEM available.&bslash;n&quot;
comma
id|low_top_pfn
op_rshift
(paren
l_int|20
op_minus
id|PAGE_SHIFT
)paren
)paren
suffix:semicolon
id|free_bootmem
c_func
(paren
id|memory_start
comma
id|low_top_pfn
op_lshift
id|PAGE_SHIFT
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_HIGHMEM
r_if
c_cond
(paren
id|high_mem
)paren
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;%ldMB HIGHMEM available.&bslash;n&quot;
comma
id|high_mem
op_rshift
(paren
l_int|20
op_minus
id|PAGE_SHIFT
)paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* take back the memory occupied by the kernel image and the bootmem alloc map */
id|reserve_bootmem
c_func
(paren
id|kstart
comma
id|kend
op_minus
id|kstart
op_plus
id|bootmap_size
)paren
suffix:semicolon
multiline_comment|/* reserve the memory occupied by the initial ramdisk */
macro_line|#ifdef CONFIG_BLK_DEV_INITRD
r_if
c_cond
(paren
id|LOADER_TYPE
op_logical_and
id|INITRD_START
)paren
(brace
r_if
c_cond
(paren
id|INITRD_START
op_plus
id|INITRD_SIZE
op_le
(paren
id|low_top_pfn
op_lshift
id|PAGE_SHIFT
)paren
)paren
(brace
id|reserve_bootmem
c_func
(paren
id|INITRD_START
comma
id|INITRD_SIZE
)paren
suffix:semicolon
id|initrd_start
op_assign
id|INITRD_START
ques
c_cond
id|INITRD_START
op_plus
id|PAGE_OFFSET
suffix:colon
l_int|0
suffix:semicolon
id|initrd_end
op_assign
id|initrd_start
op_plus
id|INITRD_SIZE
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;initrd extends beyond end of memory (0x%08lx &gt; 0x%08lx)&bslash;n&quot;
l_string|&quot;disabling initrd&bslash;n&quot;
comma
id|INITRD_START
op_plus
id|INITRD_SIZE
comma
id|low_top_pfn
op_lshift
id|PAGE_SHIFT
)paren
suffix:semicolon
id|initrd_start
op_assign
l_int|0
suffix:semicolon
)brace
)brace
macro_line|#endif
)brace
multiline_comment|/* end setup_linux_memory() */
macro_line|#endif
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * set up the memory map for uClinux&n; */
macro_line|#ifndef CONFIG_MMU
DECL|function|setup_uclinux_memory
r_static
r_void
id|__init
id|setup_uclinux_memory
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_PROTECT_KERNEL
r_int
r_int
id|dampr
suffix:semicolon
macro_line|#endif
r_int
r_int
id|kend
suffix:semicolon
r_int
id|bootmap_size
suffix:semicolon
id|kend
op_assign
(paren
r_int
r_int
)paren
op_amp
id|__kernel_image_end
suffix:semicolon
id|kend
op_assign
(paren
id|kend
op_plus
id|PAGE_SIZE
op_minus
l_int|1
)paren
op_amp
id|PAGE_MASK
suffix:semicolon
multiline_comment|/* give all the memory to the bootmap allocator,  tell it to put the&n;&t; * boot mem_map immediately following the kernel image&n;&t; */
id|bootmap_size
op_assign
id|init_bootmem_node
c_func
(paren
id|NODE_DATA
c_func
(paren
l_int|0
)paren
comma
id|kend
op_rshift
id|PAGE_SHIFT
comma
multiline_comment|/* map addr */
id|memory_start
op_rshift
id|PAGE_SHIFT
comma
multiline_comment|/* start of RAM */
id|memory_end
op_rshift
id|PAGE_SHIFT
multiline_comment|/* end of RAM */
)paren
suffix:semicolon
multiline_comment|/* free all the usable memory */
id|free_bootmem
c_func
(paren
id|memory_start
comma
id|memory_end
op_minus
id|memory_start
)paren
suffix:semicolon
id|high_memory
op_assign
(paren
r_void
op_star
)paren
(paren
id|memory_end
op_amp
id|PAGE_MASK
)paren
suffix:semicolon
id|max_mapnr
op_assign
id|num_physpages
op_assign
(paren
(paren
r_int
r_int
)paren
id|high_memory
op_minus
id|PAGE_OFFSET
)paren
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|min_low_pfn
op_assign
id|memory_start
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|max_low_pfn
op_assign
id|memory_end
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|max_pfn
op_assign
id|max_low_pfn
suffix:semicolon
multiline_comment|/* now take back the bits the core kernel is occupying */
macro_line|#ifndef CONFIG_PROTECT_KERNEL
id|reserve_bootmem
c_func
(paren
id|kend
comma
id|bootmap_size
)paren
suffix:semicolon
id|reserve_bootmem
c_func
(paren
(paren
r_int
r_int
)paren
op_amp
id|__kernel_image_start
comma
id|kend
op_minus
(paren
r_int
r_int
)paren
op_amp
id|__kernel_image_start
)paren
suffix:semicolon
macro_line|#else
id|dampr
op_assign
id|__get_DAMPR
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|dampr
op_and_assign
id|xAMPRx_SS
suffix:semicolon
id|dampr
op_assign
(paren
id|dampr
op_rshift
l_int|4
)paren
op_plus
l_int|17
suffix:semicolon
id|dampr
op_assign
l_int|1
op_lshift
id|dampr
suffix:semicolon
id|reserve_bootmem
c_func
(paren
id|__get_DAMPR
c_func
(paren
l_int|0
)paren
op_amp
id|xAMPRx_PPFN
comma
id|dampr
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* reserve some memory to do uncached DMA through if requested */
macro_line|#ifdef CONFIG_RESERVE_DMA_COHERENT
r_if
c_cond
(paren
id|dma_coherent_mem_start
)paren
id|reserve_bootmem
c_func
(paren
id|dma_coherent_mem_start
comma
id|dma_coherent_mem_end
op_minus
id|dma_coherent_mem_start
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/* end setup_uclinux_memory() */
macro_line|#endif
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * get CPU information for use by procfs&n; */
DECL|function|show_cpuinfo
r_static
r_int
id|show_cpuinfo
c_func
(paren
r_struct
id|seq_file
op_star
id|m
comma
r_void
op_star
id|v
)paren
(brace
r_const
r_char
op_star
id|gr
comma
op_star
id|fr
comma
op_star
id|fm
comma
op_star
id|fp
comma
op_star
id|cm
comma
op_star
id|nem
comma
op_star
id|ble
suffix:semicolon
macro_line|#ifdef CONFIG_PM
r_const
r_char
op_star
id|sep
suffix:semicolon
macro_line|#endif
id|gr
op_assign
id|cpu_hsr0_all
op_amp
id|HSR0_GRHE
ques
c_cond
l_string|&quot;gr0-63&quot;
suffix:colon
l_string|&quot;gr0-31&quot;
suffix:semicolon
id|fr
op_assign
id|cpu_hsr0_all
op_amp
id|HSR0_FRHE
ques
c_cond
l_string|&quot;fr0-63&quot;
suffix:colon
l_string|&quot;fr0-31&quot;
suffix:semicolon
id|fm
op_assign
id|cpu_psr_all
op_amp
id|PSR_EM
ques
c_cond
l_string|&quot;, Media&quot;
suffix:colon
l_string|&quot;&quot;
suffix:semicolon
id|fp
op_assign
id|cpu_psr_all
op_amp
id|PSR_EF
ques
c_cond
l_string|&quot;, FPU&quot;
suffix:colon
l_string|&quot;&quot;
suffix:semicolon
id|cm
op_assign
id|cpu_psr_all
op_amp
id|PSR_CM
ques
c_cond
l_string|&quot;, CCCR&quot;
suffix:colon
l_string|&quot;&quot;
suffix:semicolon
id|nem
op_assign
id|cpu_psr_all
op_amp
id|PSR_NEM
ques
c_cond
l_string|&quot;, NE&quot;
suffix:colon
l_string|&quot;&quot;
suffix:semicolon
id|ble
op_assign
id|cpu_psr_all
op_amp
id|PSR_BE
ques
c_cond
l_string|&quot;BE&quot;
suffix:colon
l_string|&quot;LE&quot;
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;CPU-Series:&bslash;t%s&bslash;n&quot;
l_string|&quot;CPU-Core:&bslash;t%s, %s, %s%s%s&bslash;n&quot;
l_string|&quot;CPU:&bslash;t&bslash;t%s&bslash;n&quot;
l_string|&quot;MMU:&bslash;t&bslash;t%s&bslash;n&quot;
l_string|&quot;FP-Media:&bslash;t%s%s%s&bslash;n&quot;
l_string|&quot;System:&bslash;t&bslash;t%s&quot;
comma
id|cpu_series
comma
id|cpu_core
comma
id|gr
comma
id|ble
comma
id|cm
comma
id|nem
comma
id|cpu_silicon
comma
id|cpu_mmu
comma
id|fr
comma
id|fm
comma
id|fp
comma
id|cpu_system
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpu_board1
)paren
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;, %s&quot;
comma
id|cpu_board1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpu_board2
)paren
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;, %s&quot;
comma
id|cpu_board2
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PM
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;PM-Controls:&quot;
)paren
suffix:semicolon
id|sep
op_assign
l_string|&quot;&bslash;t&quot;
suffix:semicolon
r_if
c_cond
(paren
id|clock_bits_settable
op_amp
id|CLOCK_BIT_CMODE
)paren
(brace
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;%scmode=0x%04hx&quot;
comma
id|sep
comma
id|clock_cmodes_permitted
)paren
suffix:semicolon
id|sep
op_assign
l_string|&quot;, &quot;
suffix:semicolon
)brace
r_if
c_cond
(paren
id|clock_bits_settable
op_amp
id|CLOCK_BIT_CM
)paren
(brace
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;%scm=0x%lx&quot;
comma
id|sep
comma
id|clock_bits_settable
op_amp
id|CLOCK_BIT_CM
)paren
suffix:semicolon
id|sep
op_assign
l_string|&quot;, &quot;
suffix:semicolon
)brace
r_if
c_cond
(paren
id|clock_bits_settable
op_amp
id|CLOCK_BIT_P0
)paren
(brace
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;%sp0=0x3&quot;
comma
id|sep
)paren
suffix:semicolon
id|sep
op_assign
l_string|&quot;, &quot;
suffix:semicolon
)brace
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;%ssuspend=0x22&bslash;n&quot;
comma
id|sep
)paren
suffix:semicolon
macro_line|#endif
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;PM-Status:&bslash;tcmode=%d, cm=%d, p0=%d&bslash;n&quot;
comma
id|clock_cmode_current
comma
id|clock_cm_current
comma
id|clock_p0_current
)paren
suffix:semicolon
DECL|macro|print_clk
mdefine_line|#define print_clk(TAG, VAR) &bslash;&n;&t;seq_printf(m, &quot;Clock-&quot; TAG &quot;:&bslash;t%lu.%2.2lu MHz&bslash;n&quot;, VAR / 1000000, (VAR / 10000) % 100)
id|print_clk
c_func
(paren
l_string|&quot;In&quot;
comma
id|__clkin_clock_speed_HZ
)paren
suffix:semicolon
id|print_clk
c_func
(paren
l_string|&quot;Core&quot;
comma
id|__core_clock_speed_HZ
)paren
suffix:semicolon
id|print_clk
c_func
(paren
l_string|&quot;SDRAM&quot;
comma
id|__sdram_clock_speed_HZ
)paren
suffix:semicolon
id|print_clk
c_func
(paren
l_string|&quot;CBus&quot;
comma
id|__core_bus_clock_speed_HZ
)paren
suffix:semicolon
id|print_clk
c_func
(paren
l_string|&quot;Res&quot;
comma
id|__res_bus_clock_speed_HZ
)paren
suffix:semicolon
id|print_clk
c_func
(paren
l_string|&quot;Ext&quot;
comma
id|__ext_bus_clock_speed_HZ
)paren
suffix:semicolon
id|print_clk
c_func
(paren
l_string|&quot;DSU&quot;
comma
id|__dsu_clock_speed_HZ
)paren
suffix:semicolon
id|seq_printf
c_func
(paren
id|m
comma
l_string|&quot;BogoMips:&bslash;t%lu.%02lu&bslash;n&quot;
comma
(paren
id|loops_per_jiffy
op_star
id|HZ
)paren
op_div
l_int|500000
comma
(paren
(paren
id|loops_per_jiffy
op_star
id|HZ
)paren
op_div
l_int|5000
)paren
op_mod
l_int|100
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* end show_cpuinfo() */
DECL|function|c_start
r_static
r_void
op_star
id|c_start
c_func
(paren
r_struct
id|seq_file
op_star
id|m
comma
id|loff_t
op_star
id|pos
)paren
(brace
r_return
op_star
id|pos
OL
id|NR_CPUS
ques
c_cond
(paren
r_void
op_star
)paren
l_int|0x12345678
suffix:colon
l_int|NULL
suffix:semicolon
)brace
DECL|function|c_next
r_static
r_void
op_star
id|c_next
c_func
(paren
r_struct
id|seq_file
op_star
id|m
comma
r_void
op_star
id|v
comma
id|loff_t
op_star
id|pos
)paren
(brace
op_increment
op_star
id|pos
suffix:semicolon
r_return
id|c_start
c_func
(paren
id|m
comma
id|pos
)paren
suffix:semicolon
)brace
DECL|function|c_stop
r_static
r_void
id|c_stop
c_func
(paren
r_struct
id|seq_file
op_star
id|m
comma
r_void
op_star
id|v
)paren
(brace
)brace
DECL|variable|cpuinfo_op
r_struct
id|seq_operations
id|cpuinfo_op
op_assign
(brace
dot
id|start
op_assign
id|c_start
comma
dot
id|next
op_assign
id|c_next
comma
dot
id|stop
op_assign
id|c_stop
comma
dot
id|show
op_assign
id|show_cpuinfo
comma
)brace
suffix:semicolon
DECL|function|arch_gettod
r_void
id|arch_gettod
c_func
(paren
r_int
op_star
id|year
comma
r_int
op_star
id|mon
comma
r_int
op_star
id|day
comma
r_int
op_star
id|hour
comma
r_int
op_star
id|min
comma
r_int
op_star
id|sec
)paren
(brace
op_star
id|year
op_assign
op_star
id|mon
op_assign
op_star
id|day
op_assign
op_star
id|hour
op_assign
op_star
id|min
op_assign
op_star
id|sec
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; *&n; */
macro_line|#ifdef CONFIG_MB93090_MB00
DECL|function|mb93090_sendlcdcmd
r_static
r_void
id|__init
id|mb93090_sendlcdcmd
c_func
(paren
r_uint32
id|cmd
)paren
(brace
r_int
r_int
id|base
op_assign
id|__addr_LCD
c_func
(paren
)paren
suffix:semicolon
r_int
id|loop
suffix:semicolon
multiline_comment|/* request reading of the busy flag */
id|__set_LCD
c_func
(paren
id|base
comma
id|LCD_CMD_READ_BUSY
)paren
suffix:semicolon
id|__set_LCD
c_func
(paren
id|base
comma
id|LCD_CMD_READ_BUSY
op_amp
op_complement
id|LCD_E
)paren
suffix:semicolon
multiline_comment|/* wait for the busy flag to become clear */
r_for
c_loop
(paren
id|loop
op_assign
l_int|10000
suffix:semicolon
id|loop
OG
l_int|0
suffix:semicolon
id|loop
op_decrement
)paren
r_if
c_cond
(paren
op_logical_neg
(paren
id|__get_LCD
c_func
(paren
id|base
)paren
op_amp
l_int|0x80
)paren
)paren
r_break
suffix:semicolon
multiline_comment|/* send the command */
id|__set_LCD
c_func
(paren
id|base
comma
id|cmd
)paren
suffix:semicolon
id|__set_LCD
c_func
(paren
id|base
comma
id|cmd
op_amp
op_complement
id|LCD_E
)paren
suffix:semicolon
)brace
multiline_comment|/* end mb93090_sendlcdcmd() */
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * write to the MB93090 LEDs and LCD&n; */
DECL|function|mb93090_display
r_static
r_void
id|__init
id|mb93090_display
c_func
(paren
r_void
)paren
(brace
r_const
r_char
op_star
id|p
suffix:semicolon
id|__set_LEDS
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* set up the LCD */
id|mb93090_sendlcdcmd
c_func
(paren
id|LCD_CMD_CLEAR
)paren
suffix:semicolon
id|mb93090_sendlcdcmd
c_func
(paren
id|LCD_CMD_FUNCSET
c_func
(paren
l_int|1
comma
l_int|1
comma
l_int|0
)paren
)paren
suffix:semicolon
id|mb93090_sendlcdcmd
c_func
(paren
id|LCD_CMD_ON
c_func
(paren
l_int|0
comma
l_int|0
)paren
)paren
suffix:semicolon
id|mb93090_sendlcdcmd
c_func
(paren
id|LCD_CMD_HOME
)paren
suffix:semicolon
id|mb93090_sendlcdcmd
c_func
(paren
id|LCD_CMD_SET_DD_ADDR
c_func
(paren
l_int|0
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|mb93090_banner
suffix:semicolon
op_star
id|p
suffix:semicolon
id|p
op_increment
)paren
id|mb93090_sendlcdcmd
c_func
(paren
id|LCD_DATA_WRITE
c_func
(paren
op_star
id|p
)paren
)paren
suffix:semicolon
id|mb93090_sendlcdcmd
c_func
(paren
id|LCD_CMD_SET_DD_ADDR
c_func
(paren
l_int|64
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|mb93090_version
suffix:semicolon
op_star
id|p
suffix:semicolon
id|p
op_increment
)paren
id|mb93090_sendlcdcmd
c_func
(paren
id|LCD_DATA_WRITE
c_func
(paren
op_star
id|p
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* end mb93090_display() */
macro_line|#endif 
singleline_comment|// CONFIG_MB93090_MB00
eof
