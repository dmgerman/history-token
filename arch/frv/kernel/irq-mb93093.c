multiline_comment|/* irq-mb93093.c: MB93093 FPGA interrupt handling&n; *&n; * Copyright (C) 2004 Red Hat, Inc. All Rights Reserved.&n; * Written by David Howells (dhowells@redhat.com)&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License&n; * as published by the Free Software Foundation; either version&n; * 2 of the License, or (at your option) any later version.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/irq.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/delay.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/irc-regs.h&gt;
macro_line|#include &lt;asm/irq-routing.h&gt;
DECL|macro|__reg16
mdefine_line|#define __reg16(ADDR) (*(volatile unsigned short *)(__region_CS2 + (ADDR)))
DECL|macro|__get_IMR
mdefine_line|#define __get_IMR()&t;({ __reg16(0x0a); })
DECL|macro|__set_IMR
mdefine_line|#define __set_IMR(M)&t;do { __reg16(0x0a) = (M);  wmb(); } while(0)
DECL|macro|__get_IFR
mdefine_line|#define __get_IFR()&t;({ __reg16(0x02); })
DECL|macro|__clr_IFR
mdefine_line|#define __clr_IFR(M)&t;do { __reg16(0x02) = ~(M); wmb(); } while(0)
r_static
r_void
id|frv_fpga_doirq
c_func
(paren
r_struct
id|irq_source
op_star
id|source
)paren
suffix:semicolon
r_static
r_void
id|frv_fpga_control
c_func
(paren
r_struct
id|irq_group
op_star
id|group
comma
r_int
id|irq
comma
r_int
id|on
)paren
suffix:semicolon
multiline_comment|/*****************************************************************************/
multiline_comment|/*&n; * FPGA IRQ multiplexor&n; */
DECL|variable|frv_fpga
r_static
r_struct
id|irq_source
id|frv_fpga
(braket
l_int|4
)braket
op_assign
(brace
DECL|macro|__FPGA
mdefine_line|#define __FPGA(X, M)&t;&t;&t;&t;&t;&bslash;&n;&t;[X] = {&t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;.muxname&t;= &quot;fpga.&quot;#X,&t;&t;&bslash;&n;&t;&t;.irqmask&t;= M,&t;&t;&t;&bslash;&n;&t;&t;.doirq&t;&t;= frv_fpga_doirq,&t;&bslash;&n;&t;}
id|__FPGA
c_func
(paren
l_int|0
comma
l_int|0x0700
)paren
comma
)brace
suffix:semicolon
DECL|variable|frv_fpga_irqs
r_static
r_struct
id|irq_group
id|frv_fpga_irqs
op_assign
(brace
dot
id|first_irq
op_assign
id|IRQ_BASE_FPGA
comma
dot
id|control
op_assign
id|frv_fpga_control
comma
dot
id|sources
op_assign
(brace
(braket
l_int|8
)braket
op_assign
op_amp
id|frv_fpga
(braket
l_int|0
)braket
comma
(braket
l_int|9
)braket
op_assign
op_amp
id|frv_fpga
(braket
l_int|0
)braket
comma
(braket
l_int|10
)braket
op_assign
op_amp
id|frv_fpga
(braket
l_int|0
)braket
comma
)brace
comma
)brace
suffix:semicolon
DECL|function|frv_fpga_control
r_static
r_void
id|frv_fpga_control
c_func
(paren
r_struct
id|irq_group
op_star
id|group
comma
r_int
id|index
comma
r_int
id|on
)paren
(brace
r_uint16
id|imr
op_assign
id|__get_IMR
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|on
)paren
id|imr
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|index
)paren
suffix:semicolon
r_else
id|imr
op_or_assign
l_int|1
op_lshift
id|index
suffix:semicolon
id|__set_IMR
c_func
(paren
id|imr
)paren
suffix:semicolon
)brace
DECL|function|frv_fpga_doirq
r_static
r_void
id|frv_fpga_doirq
c_func
(paren
r_struct
id|irq_source
op_star
id|source
)paren
(brace
r_uint16
id|mask
comma
id|imr
suffix:semicolon
id|imr
op_assign
id|__get_IMR
c_func
(paren
)paren
suffix:semicolon
id|mask
op_assign
id|source-&gt;irqmask
op_amp
op_complement
id|imr
op_amp
id|__get_IFR
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mask
)paren
(brace
id|__set_IMR
c_func
(paren
id|imr
op_or
id|mask
)paren
suffix:semicolon
id|__clr_IFR
c_func
(paren
id|mask
)paren
suffix:semicolon
id|distribute_irqs
c_func
(paren
op_amp
id|frv_fpga_irqs
comma
id|mask
)paren
suffix:semicolon
id|__set_IMR
c_func
(paren
id|imr
)paren
suffix:semicolon
)brace
)brace
DECL|function|fpga_init
r_void
id|__init
id|fpga_init
c_func
(paren
r_void
)paren
(brace
id|__set_IMR
c_func
(paren
l_int|0x0700
)paren
suffix:semicolon
id|__clr_IFR
c_func
(paren
l_int|0x0000
)paren
suffix:semicolon
id|frv_irq_route_external
c_func
(paren
op_amp
id|frv_fpga
(braket
l_int|0
)braket
comma
id|IRQ_CPU_EXTERNAL2
)paren
suffix:semicolon
id|frv_irq_set_group
c_func
(paren
op_amp
id|frv_fpga_irqs
)paren
suffix:semicolon
)brace
eof
