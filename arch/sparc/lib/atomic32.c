multiline_comment|/*&n; * atomic32.c: 32-bit atomic_t implementation&n; *&n; * Copyright (C) 2004 Keith M Wesolowski&n; * &n; * Based on asm-parisc/atomic.h Copyright (C) 2000 Philipp Rumpf&n; */
macro_line|#include &lt;asm/atomic.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#ifdef CONFIG_SMP
DECL|macro|ATOMIC_HASH_SIZE
mdefine_line|#define ATOMIC_HASH_SIZE&t;4
DECL|macro|ATOMIC_HASH
mdefine_line|#define ATOMIC_HASH(a)&t;(&amp;__atomic_hash[(((unsigned long)a)&gt;&gt;8) &amp; (ATOMIC_HASH_SIZE-1)])
DECL|variable|__atomic_hash
id|spinlock_t
id|__atomic_hash
(braket
id|ATOMIC_HASH_SIZE
)braket
op_assign
(brace
(braket
l_int|0
dot
dot
dot
(paren
id|ATOMIC_HASH_SIZE
op_minus
l_int|1
)paren
)braket
op_assign
id|SPIN_LOCK_UNLOCKED
)brace
suffix:semicolon
macro_line|#else /* SMP */
DECL|variable|dummy
r_static
id|spinlock_t
id|dummy
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|macro|ATOMIC_HASH_SIZE
mdefine_line|#define ATOMIC_HASH_SIZE&t;1
DECL|macro|ATOMIC_HASH
mdefine_line|#define ATOMIC_HASH(a)&t;&t;(&amp;dummy)
macro_line|#endif /* SMP */
DECL|function|__atomic_add_return
r_int
id|__atomic_add_return
c_func
(paren
r_int
id|i
comma
id|atomic_t
op_star
id|v
)paren
(brace
r_int
id|ret
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
id|ATOMIC_HASH
c_func
(paren
id|v
)paren
comma
id|flags
)paren
suffix:semicolon
id|ret
op_assign
(paren
id|v-&gt;counter
op_add_assign
id|i
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|ATOMIC_HASH
c_func
(paren
id|v
)paren
comma
id|flags
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|atomic_set
r_void
id|atomic_set
c_func
(paren
id|atomic_t
op_star
id|v
comma
r_int
id|i
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
id|ATOMIC_HASH
c_func
(paren
id|v
)paren
comma
id|flags
)paren
suffix:semicolon
id|v-&gt;counter
op_assign
id|i
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
id|ATOMIC_HASH
c_func
(paren
id|v
)paren
comma
id|flags
)paren
suffix:semicolon
)brace
DECL|variable|__atomic_add_return
id|EXPORT_SYMBOL
c_func
(paren
id|__atomic_add_return
)paren
suffix:semicolon
DECL|variable|atomic_set
id|EXPORT_SYMBOL
c_func
(paren
id|atomic_set
)paren
suffix:semicolon
eof
