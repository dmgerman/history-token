multiline_comment|/*&n; * PROM interface routines.&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/bootmem.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#include &lt;asm/lasat/lasat.h&gt;
macro_line|#include &lt;asm/cpu.h&gt;
macro_line|#include &quot;at93c.h&quot;
macro_line|#include &lt;asm/lasat/eeprom.h&gt;
macro_line|#include &quot;prom.h&quot;
DECL|macro|RESET_VECTOR
mdefine_line|#define RESET_VECTOR&t;0xbfc00000
DECL|macro|PROM_JUMP_TABLE_ENTRY
mdefine_line|#define PROM_JUMP_TABLE_ENTRY(n) (*((u32 *)(RESET_VECTOR + 0x20) + n))
DECL|macro|PROM_DISPLAY_ADDR
mdefine_line|#define PROM_DISPLAY_ADDR&t;PROM_JUMP_TABLE_ENTRY(0)
DECL|macro|PROM_PUTC_ADDR
mdefine_line|#define PROM_PUTC_ADDR&t;&t;PROM_JUMP_TABLE_ENTRY(1)
DECL|macro|PROM_MONITOR_ADDR
mdefine_line|#define PROM_MONITOR_ADDR&t;PROM_JUMP_TABLE_ENTRY(2)
DECL|function|null_prom_printf
r_static
r_void
id|null_prom_printf
c_func
(paren
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
)brace
DECL|function|null_prom_display
r_static
r_void
id|null_prom_display
c_func
(paren
r_const
r_char
op_star
id|string
comma
r_int
id|pos
comma
r_int
id|clear
)paren
(brace
)brace
DECL|function|null_prom_monitor
r_static
r_void
id|null_prom_monitor
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|null_prom_putc
r_static
r_void
id|null_prom_putc
c_func
(paren
r_char
id|c
)paren
(brace
)brace
multiline_comment|/* these are functions provided by the bootloader */
DECL|variable|prom_putc
r_static
r_void
(paren
op_star
id|prom_putc
)paren
(paren
r_char
id|c
)paren
op_assign
id|null_prom_putc
suffix:semicolon
DECL|variable|prom_printf
r_void
(paren
op_star
id|prom_printf
)paren
(paren
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
op_assign
id|null_prom_printf
suffix:semicolon
DECL|variable|prom_display
r_void
(paren
op_star
id|prom_display
)paren
(paren
r_const
r_char
op_star
id|string
comma
r_int
id|pos
comma
r_int
id|clear
)paren
op_assign
id|null_prom_display
suffix:semicolon
DECL|variable|prom_monitor
r_void
(paren
op_star
id|prom_monitor
)paren
(paren
r_void
)paren
op_assign
id|null_prom_monitor
suffix:semicolon
DECL|variable|lasat_ndelay_divider
r_int
r_int
id|lasat_ndelay_divider
suffix:semicolon
DECL|macro|PROM_PRINTFBUF_SIZE
mdefine_line|#define PROM_PRINTFBUF_SIZE 256
DECL|variable|prom_printfbuf
r_static
r_char
id|prom_printfbuf
(braket
id|PROM_PRINTFBUF_SIZE
)braket
suffix:semicolon
DECL|function|real_prom_printf
r_static
r_void
id|real_prom_printf
c_func
(paren
r_const
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
id|va_list
id|ap
suffix:semicolon
r_int
id|len
suffix:semicolon
r_char
op_star
id|c
op_assign
id|prom_printfbuf
suffix:semicolon
r_int
id|i
suffix:semicolon
id|va_start
c_func
(paren
id|ap
comma
id|fmt
)paren
suffix:semicolon
id|len
op_assign
id|vsnprintf
c_func
(paren
id|prom_printfbuf
comma
id|PROM_PRINTFBUF_SIZE
comma
id|fmt
comma
id|ap
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|ap
)paren
suffix:semicolon
multiline_comment|/* output overflowed the buffer */
r_if
c_cond
(paren
id|len
template_param
id|PROM_PRINTFBUF_SIZE
)paren
id|len
op_assign
id|PROM_PRINTFBUF_SIZE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_star
id|c
op_eq
l_char|&squot;&bslash;n&squot;
)paren
id|prom_putc
c_func
(paren
l_char|&squot;&bslash;r&squot;
)paren
suffix:semicolon
id|prom_putc
c_func
(paren
op_star
id|c
op_increment
)paren
suffix:semicolon
)brace
)brace
DECL|function|setup_prom_vectors
r_static
r_void
id|setup_prom_vectors
c_func
(paren
r_void
)paren
(brace
id|u32
id|version
op_assign
op_star
(paren
id|u32
op_star
)paren
(paren
id|RESET_VECTOR
op_plus
l_int|0x90
)paren
suffix:semicolon
r_if
c_cond
(paren
id|version
op_ge
l_int|307
)paren
(brace
id|prom_display
op_assign
(paren
r_void
op_star
)paren
id|PROM_DISPLAY_ADDR
suffix:semicolon
id|prom_putc
op_assign
(paren
r_void
op_star
)paren
id|PROM_PUTC_ADDR
suffix:semicolon
id|prom_printf
op_assign
id|real_prom_printf
suffix:semicolon
id|prom_monitor
op_assign
(paren
r_void
op_star
)paren
id|PROM_MONITOR_ADDR
suffix:semicolon
)brace
id|prom_printf
c_func
(paren
l_string|&quot;prom vectors set up&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|variable|at93c_defs
r_static
r_struct
id|at93c_defs
id|at93c_defs
(braket
id|N_MACHTYPES
)braket
op_assign
(brace
(brace
(paren
r_void
op_star
)paren
id|AT93C_REG_100
comma
(paren
r_void
op_star
)paren
id|AT93C_RDATA_REG_100
comma
id|AT93C_RDATA_SHIFT_100
comma
id|AT93C_WDATA_SHIFT_100
comma
id|AT93C_CS_M_100
comma
id|AT93C_CLK_M_100
)brace
comma
(brace
(paren
r_void
op_star
)paren
id|AT93C_REG_200
comma
(paren
r_void
op_star
)paren
id|AT93C_RDATA_REG_200
comma
id|AT93C_RDATA_SHIFT_200
comma
id|AT93C_WDATA_SHIFT_200
comma
id|AT93C_CS_M_200
comma
id|AT93C_CLK_M_200
)brace
comma
)brace
suffix:semicolon
DECL|function|prom_init
r_void
id|__init
id|prom_init
c_func
(paren
r_void
)paren
(brace
r_int
id|argc
op_assign
id|fw_arg0
suffix:semicolon
r_char
op_star
op_star
id|argv
op_assign
(paren
r_char
op_star
op_star
)paren
id|fw_arg1
suffix:semicolon
id|setup_prom_vectors
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|current_cpu_data.cputype
op_eq
id|CPU_R5000
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;LASAT 200 board&bslash;n&quot;
)paren
suffix:semicolon
id|mips_machtype
op_assign
id|MACH_LASAT_200
suffix:semicolon
id|lasat_ndelay_divider
op_assign
id|LASAT_200_DIVIDER
suffix:semicolon
)brace
r_else
(brace
id|prom_printf
c_func
(paren
l_string|&quot;LASAT 100 board&bslash;n&quot;
)paren
suffix:semicolon
id|mips_machtype
op_assign
id|MACH_LASAT_100
suffix:semicolon
id|lasat_ndelay_divider
op_assign
id|LASAT_100_DIVIDER
suffix:semicolon
)brace
id|at93c
op_assign
op_amp
id|at93c_defs
(braket
id|mips_machtype
)braket
suffix:semicolon
id|lasat_init_board_info
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Read info from EEPROM */
id|mips_machgroup
op_assign
id|MACH_GROUP_LASAT
suffix:semicolon
multiline_comment|/* Get the command line */
r_if
c_cond
(paren
id|argc
OG
l_int|0
)paren
(brace
id|strncpy
c_func
(paren
id|arcs_cmdline
comma
id|argv
(braket
l_int|0
)braket
comma
id|CL_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|arcs_cmdline
(braket
id|CL_SIZE
op_minus
l_int|1
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
multiline_comment|/* Set the I/O base address */
id|set_io_port_base
c_func
(paren
id|KSEG1
)paren
suffix:semicolon
multiline_comment|/* Set memory regions */
id|ioport_resource.start
op_assign
l_int|0
suffix:semicolon
id|ioport_resource.end
op_assign
l_int|0xffffffff
suffix:semicolon
multiline_comment|/* Wrong, fixme.  */
id|add_memory_region
c_func
(paren
l_int|0
comma
id|lasat_board_info.li_memsize
comma
id|BOOT_MEM_RAM
)paren
suffix:semicolon
)brace
DECL|function|prom_free_prom_memory
r_int
r_int
id|__init
id|prom_free_prom_memory
c_func
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|get_system_type
r_const
r_char
op_star
id|get_system_type
c_func
(paren
r_void
)paren
(brace
r_return
id|lasat_board_info.li_bmstr
suffix:semicolon
)brace
eof
