multiline_comment|/* &n; * Atmel AT93C46 serial eeprom driver&n; *&n; * Brian Murphy &lt;brian.murphy@eicon.com&gt; &n; *&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;asm/lasat/lasat.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &quot;at93c.h&quot;
DECL|macro|AT93C_ADDR_SHIFT
mdefine_line|#define AT93C_ADDR_SHIFT&t;7
DECL|macro|AT93C_ADDR_MAX
mdefine_line|#define AT93C_ADDR_MAX&t;&t;((1 &lt;&lt; AT93C_ADDR_SHIFT) - 1)
DECL|macro|AT93C_RCMD
mdefine_line|#define AT93C_RCMD&t;&t;(0x6 &lt;&lt; AT93C_ADDR_SHIFT)
DECL|macro|AT93C_WCMD
mdefine_line|#define AT93C_WCMD&t;&t;(0x5 &lt;&lt; AT93C_ADDR_SHIFT)
DECL|macro|AT93C_WENCMD
mdefine_line|#define AT93C_WENCMD&t;&t;0x260
DECL|macro|AT93C_WDSCMD
mdefine_line|#define AT93C_WDSCMD&t;&t;0x200
DECL|variable|at93c
r_struct
id|at93c_defs
op_star
id|at93c
suffix:semicolon
DECL|function|at93c_reg_write
r_static
r_void
id|at93c_reg_write
c_func
(paren
id|u32
id|val
)paren
(brace
op_star
id|at93c-&gt;reg
op_assign
id|val
suffix:semicolon
)brace
DECL|function|at93c_reg_read
r_static
id|u32
id|at93c_reg_read
c_func
(paren
r_void
)paren
(brace
id|u32
id|tmp
op_assign
op_star
id|at93c-&gt;reg
suffix:semicolon
r_return
id|tmp
suffix:semicolon
)brace
DECL|function|at93c_datareg_read
r_static
id|u32
id|at93c_datareg_read
c_func
(paren
r_void
)paren
(brace
id|u32
id|tmp
op_assign
op_star
id|at93c-&gt;rdata_reg
suffix:semicolon
r_return
id|tmp
suffix:semicolon
)brace
DECL|function|at93c_cycle_clk
r_static
r_void
id|at93c_cycle_clk
c_func
(paren
id|u32
id|data
)paren
(brace
id|at93c_reg_write
c_func
(paren
id|data
op_or
id|at93c-&gt;clk
)paren
suffix:semicolon
id|ndelay
c_func
(paren
l_int|250
)paren
suffix:semicolon
id|at93c_reg_write
c_func
(paren
id|data
op_amp
op_complement
id|at93c-&gt;clk
)paren
suffix:semicolon
id|ndelay
c_func
(paren
l_int|250
)paren
suffix:semicolon
)brace
DECL|function|at93c_write_databit
r_static
r_void
id|at93c_write_databit
c_func
(paren
id|u8
id|bit
)paren
(brace
id|u32
id|data
op_assign
id|at93c_reg_read
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bit
)paren
id|data
op_or_assign
l_int|1
op_lshift
id|at93c-&gt;wdata_shift
suffix:semicolon
r_else
id|data
op_and_assign
op_complement
(paren
l_int|1
op_lshift
id|at93c-&gt;wdata_shift
)paren
suffix:semicolon
id|at93c_reg_write
c_func
(paren
id|data
)paren
suffix:semicolon
id|ndelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|at93c_cycle_clk
c_func
(paren
id|data
)paren
suffix:semicolon
)brace
DECL|function|at93c_read_databit
r_static
r_int
r_int
id|at93c_read_databit
c_func
(paren
r_void
)paren
(brace
id|u32
id|data
suffix:semicolon
id|at93c_cycle_clk
c_func
(paren
id|at93c_reg_read
c_func
(paren
)paren
)paren
suffix:semicolon
id|data
op_assign
(paren
id|at93c_datareg_read
c_func
(paren
)paren
op_rshift
id|at93c-&gt;rdata_shift
)paren
op_amp
l_int|1
suffix:semicolon
r_return
id|data
suffix:semicolon
)brace
DECL|function|at93c_read_byte
r_static
id|u8
id|at93c_read_byte
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|u8
id|data
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|7
suffix:semicolon
id|i
op_increment
)paren
(brace
id|data
op_lshift_assign
l_int|1
suffix:semicolon
id|data
op_or_assign
id|at93c_read_databit
c_func
(paren
)paren
suffix:semicolon
)brace
r_return
id|data
suffix:semicolon
)brace
DECL|function|at93c_write_bits
r_static
r_void
id|at93c_write_bits
c_func
(paren
id|u32
id|data
comma
r_int
id|size
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|shift
op_assign
id|size
op_minus
l_int|1
suffix:semicolon
id|u32
id|mask
op_assign
(paren
l_int|1
op_lshift
id|shift
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
id|i
op_increment
)paren
(brace
id|at93c_write_databit
c_func
(paren
(paren
id|data
op_amp
id|mask
)paren
op_rshift
id|shift
)paren
suffix:semicolon
id|data
op_lshift_assign
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|at93c_init_op
r_static
r_void
id|at93c_init_op
c_func
(paren
r_void
)paren
(brace
id|at93c_reg_write
c_func
(paren
(paren
id|at93c_reg_read
c_func
(paren
)paren
op_or
id|at93c-&gt;cs
)paren
op_amp
op_complement
id|at93c-&gt;clk
op_amp
op_complement
(paren
l_int|1
op_lshift
id|at93c-&gt;rdata_shift
)paren
)paren
suffix:semicolon
id|ndelay
c_func
(paren
l_int|50
)paren
suffix:semicolon
)brace
DECL|function|at93c_end_op
r_static
r_void
id|at93c_end_op
c_func
(paren
r_void
)paren
(brace
id|at93c_reg_write
c_func
(paren
id|at93c_reg_read
c_func
(paren
)paren
op_amp
op_complement
id|at93c-&gt;cs
)paren
suffix:semicolon
id|ndelay
c_func
(paren
l_int|250
)paren
suffix:semicolon
)brace
DECL|function|at93c_wait
r_static
r_void
id|at93c_wait
c_func
(paren
r_void
)paren
(brace
id|at93c_init_op
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|at93c_read_databit
c_func
(paren
)paren
)paren
suffix:semicolon
id|at93c_end_op
c_func
(paren
)paren
suffix:semicolon
)brace
suffix:semicolon
DECL|function|at93c_disable_wp
r_static
r_void
id|at93c_disable_wp
c_func
(paren
r_void
)paren
(brace
id|at93c_init_op
c_func
(paren
)paren
suffix:semicolon
id|at93c_write_bits
c_func
(paren
id|AT93C_WENCMD
comma
l_int|10
)paren
suffix:semicolon
id|at93c_end_op
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|at93c_enable_wp
r_static
r_void
id|at93c_enable_wp
c_func
(paren
r_void
)paren
(brace
id|at93c_init_op
c_func
(paren
)paren
suffix:semicolon
id|at93c_write_bits
c_func
(paren
id|AT93C_WDSCMD
comma
l_int|10
)paren
suffix:semicolon
id|at93c_end_op
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|at93c_read
id|u8
id|at93c_read
c_func
(paren
id|u8
id|addr
)paren
(brace
id|u8
id|byte
suffix:semicolon
id|at93c_init_op
c_func
(paren
)paren
suffix:semicolon
id|at93c_write_bits
c_func
(paren
(paren
id|addr
op_amp
id|AT93C_ADDR_MAX
)paren
op_or
id|AT93C_RCMD
comma
l_int|10
)paren
suffix:semicolon
id|byte
op_assign
id|at93c_read_byte
c_func
(paren
)paren
suffix:semicolon
id|at93c_end_op
c_func
(paren
)paren
suffix:semicolon
r_return
id|byte
suffix:semicolon
)brace
DECL|function|at93c_write
r_void
id|at93c_write
c_func
(paren
id|u8
id|addr
comma
id|u8
id|data
)paren
(brace
id|at93c_disable_wp
c_func
(paren
)paren
suffix:semicolon
id|at93c_init_op
c_func
(paren
)paren
suffix:semicolon
id|at93c_write_bits
c_func
(paren
(paren
id|addr
op_amp
id|AT93C_ADDR_MAX
)paren
op_or
id|AT93C_WCMD
comma
l_int|10
)paren
suffix:semicolon
id|at93c_write_bits
c_func
(paren
id|data
comma
l_int|8
)paren
suffix:semicolon
id|at93c_end_op
c_func
(paren
)paren
suffix:semicolon
id|at93c_wait
c_func
(paren
)paren
suffix:semicolon
id|at93c_enable_wp
c_func
(paren
)paren
suffix:semicolon
)brace
eof
