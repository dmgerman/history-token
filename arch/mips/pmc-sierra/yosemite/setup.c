multiline_comment|/*&n; *  arch/mips/pmc-sierra/yosemite/setup.c&n; *&n; *  Copyright (C) 2003 PMC-Sierra Inc.&n; *  Author: Manish Lachwani (lachwani@pmc-sierra.com)&n; *&n; *  This program is free software; you can redistribute  it and/or modify it&n; *  under  the terms of  the GNU General  Public License as published by the&n; *  Free Software Foundation;  either version 2 of the  License, or (at your&n; *  option) any later version.&n; *&n; *  THIS  SOFTWARE  IS PROVIDED   ``AS  IS&squot;&squot; AND   ANY  EXPRESS OR IMPLIED&n; *  WARRANTIES,   INCLUDING, BUT NOT  LIMITED  TO, THE IMPLIED WARRANTIES OF&n; *  MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  IN&n; *  NO  EVENT  SHALL   THE AUTHOR  BE    LIABLE FOR ANY   DIRECT, INDIRECT,&n; *  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT&n; *  NOT LIMITED   TO, PROCUREMENT OF  SUBSTITUTE GOODS  OR SERVICES; LOSS OF&n; *  USE, DATA,  OR PROFITS; OR  BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON&n; *  ANY THEORY OF LIABILITY, WHETHER IN  CONTRACT, STRICT LIABILITY, OR TORT&n; *  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF&n; *  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.&n; *&n; *  You should have received a copy of the  GNU General Public License along&n; *  with this program; if not, write  to the Free Software Foundation, Inc.,&n; *  675 Mass Ave, Cambridge, MA 02139, USA.&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/mc146818rtc.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/swap.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/timex.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;asm/time.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/reboot.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/bootmem.h&gt;
macro_line|#include &lt;linux/blk.h&gt;
macro_line|#include &quot;setup.h&quot;
DECL|variable|cpu_clock
r_int
r_int
id|cpu_clock
suffix:semicolon
DECL|variable|yosemite_base
r_int
r_int
id|yosemite_base
suffix:semicolon
DECL|function|bus_error_init
r_void
id|__init
id|bus_error_init
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Do nothing */
)brace
DECL|function|m48t37y_get_time
r_int
r_int
id|m48t37y_get_time
c_func
(paren
r_void
)paren
(brace
r_int
r_char
op_star
id|rtc_base
op_assign
id|YOSEMITE_RTC_BASE
suffix:semicolon
r_int
r_int
id|year
comma
id|month
comma
id|day
comma
id|hour
comma
id|min
comma
id|sec
suffix:semicolon
multiline_comment|/* Stop the update to the time */
id|rtc_base
(braket
l_int|0x7ff8
)braket
op_assign
l_int|0x40
suffix:semicolon
id|year
op_assign
id|CONV_BCD_TO_BIN
c_func
(paren
id|rtc_base
(braket
l_int|0x7fff
)braket
)paren
suffix:semicolon
id|year
op_add_assign
id|CONV_BCD_TO_BIN
c_func
(paren
id|rtc_base
(braket
l_int|0x7fff1
)braket
)paren
op_star
l_int|100
suffix:semicolon
id|month
op_assign
id|CONV_BCD_TO_BIN
c_func
(paren
id|rtc_base
(braket
l_int|0x7ffe
)braket
)paren
suffix:semicolon
id|day
op_assign
id|CONV_BCD_TO_BIN
c_func
(paren
id|rtc_base
(braket
l_int|0x7ffd
)braket
)paren
suffix:semicolon
id|hour
op_assign
id|CONV_BCD_TO_BIN
c_func
(paren
id|rtc_base
(braket
l_int|0x7ffb
)braket
)paren
suffix:semicolon
id|min
op_assign
id|CONV_BCD_TO_BIN
c_func
(paren
id|rtc_base
(braket
l_int|0x7ffa
)braket
)paren
suffix:semicolon
id|sec
op_assign
id|CONV_BCD_TO_BIN
c_func
(paren
id|rtc_base
(braket
l_int|0x7ff9
)braket
)paren
suffix:semicolon
multiline_comment|/* Start the update to the time again */
id|rtc_base
(braket
l_int|0x7ff8
)braket
op_assign
l_int|0x00
suffix:semicolon
r_return
id|mktime
c_func
(paren
id|year
comma
id|month
comma
id|day
comma
id|hour
comma
id|min
comma
id|sec
)paren
suffix:semicolon
)brace
DECL|function|m48t37y_set_time
r_int
id|m48t37y_set_time
c_func
(paren
r_int
r_int
id|sec
)paren
(brace
r_int
r_char
op_star
id|rtc_base
op_assign
id|YOSEMITE_RTC_BASE
suffix:semicolon
r_int
r_int
id|year
comma
id|month
comma
id|day
comma
id|hour
comma
id|min
comma
id|sec
suffix:semicolon
r_struct
id|rtc_time
id|tm
suffix:semicolon
multiline_comment|/* convert to a more useful format -- note months count from 0 */
id|to_tm
c_func
(paren
id|sec
comma
op_amp
id|tm
)paren
suffix:semicolon
id|tm.tm_mon
op_add_assign
l_int|1
suffix:semicolon
multiline_comment|/* enable writing */
id|rtc_base
(braket
l_int|0x7ff8
)braket
op_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* year */
id|rtc_base
(braket
l_int|0x7fff
)braket
op_assign
id|CONV_BIN_TO_BCD
c_func
(paren
id|tm.tm_year
op_mod
l_int|100
)paren
suffix:semicolon
id|rtc_base
(braket
l_int|0x7ff1
)braket
op_assign
id|CONV_BIN_TO_BCD
c_func
(paren
id|tm.tm_year
op_div
l_int|100
)paren
suffix:semicolon
multiline_comment|/* month */
id|rtc_base
(braket
l_int|0x7ffe
)braket
op_assign
id|CONV_BIN_TO_BCD
c_func
(paren
id|tm.tm_mon
)paren
suffix:semicolon
multiline_comment|/* day */
id|rtc_base
(braket
l_int|0x7ffd
)braket
op_assign
id|CONV_BIN_TO_BCD
c_func
(paren
id|tm.tm_mday
)paren
suffix:semicolon
multiline_comment|/* hour/min/sec */
id|rtc_base
(braket
l_int|0x7ffb
)braket
op_assign
id|CONV_BIN_TO_BCD
c_func
(paren
id|tm.tm_hour
)paren
suffix:semicolon
id|rtc_base
(braket
l_int|0x7ffa
)braket
op_assign
id|CONV_BIN_TO_BCD
c_func
(paren
id|tm.tm_min
)paren
suffix:semicolon
id|rtc_base
(braket
l_int|0x7ff9
)braket
op_assign
id|CONV_BIN_TO_BCD
c_func
(paren
id|tm.tm_sec
)paren
suffix:semicolon
multiline_comment|/* day of week -- not really used, but let&squot;s keep it up-to-date */
id|rtc_base
(braket
l_int|0x7ffc
)braket
op_assign
id|CONV_BIN_TO_BCD
c_func
(paren
id|tm.tm_wday
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* disable writing */
id|rtc_base
(braket
l_int|0x7ff8
)braket
op_assign
l_int|0x00
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|yosemite_timer_setup
r_void
id|yosemite_timer_setup
c_func
(paren
r_struct
id|irqaction
op_star
id|irq
)paren
(brace
id|setup_irq
c_func
(paren
l_int|6
comma
id|irq
)paren
suffix:semicolon
)brace
DECL|function|yosemite_time_init
r_void
id|yosemite_time_init
c_func
(paren
r_void
)paren
(brace
id|mips_counter_frequency
op_assign
id|cpu_clock
op_div
l_int|2
suffix:semicolon
id|board_timer_setup
op_assign
id|yosemite_timer_setup
suffix:semicolon
id|rtc_get_time
op_assign
id|m48t37y_get_time
suffix:semicolon
id|rtc_set_time
op_assign
id|m48t37y_set_time
suffix:semicolon
)brace
DECL|function|pmc_yosemite_setup
r_static
r_int
id|__init
id|pmc_yosemite_setup
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|val
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;PMC-Sierra Yosemite Board Setup  &bslash;n&quot;
)paren
suffix:semicolon
id|board_time_init
op_assign
id|yosemite_time_init
suffix:semicolon
multiline_comment|/* Add memory regions */
id|add_memory_region
c_func
(paren
l_int|0x00000000
comma
l_int|0x10000000
comma
id|BOOT_MEM_RAM
)paren
suffix:semicolon
id|add_memory_region
c_func
(paren
l_int|0x10000000
comma
l_int|0x10000000
comma
id|BOOT_MEM_RAM
)paren
suffix:semicolon
multiline_comment|/* Setup the HT controller */
id|val
op_assign
op_star
(paren
r_volatile
id|u_int32_t
op_star
)paren
(paren
id|HYPERTRANSPORT_CONFIG_REG
)paren
suffix:semicolon
id|val
op_or_assign
id|HYPERTRANSPORT_ENABLE
suffix:semicolon
op_star
(paren
r_volatile
id|u_int32_t
op_star
)paren
(paren
id|HYPERTRANSPORT_CONFIG_REG
)paren
op_assign
id|val
suffix:semicolon
multiline_comment|/* Set the BAR. Shifted mode */
op_star
(paren
r_volatile
id|u_int32_t
op_star
)paren
(paren
id|HYPERTRANSPORT_BAR0_REG
)paren
op_assign
id|HYPERTRANSPORT_BAR0_ADDR
suffix:semicolon
op_star
(paren
r_volatile
id|u_int32_t
op_star
)paren
(paren
id|HYPERTRANSPORT_SIZE0_REG
)paren
op_assign
id|HYPERTRANSPORT_SIZE0
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
id|ioport_resource.start
op_assign
l_int|0xe0000000
suffix:semicolon
id|ioport_resource.end
op_assign
l_int|0xe0000000
op_plus
l_int|0x20000000
op_minus
l_int|1
suffix:semicolon
id|iomem_resource.start
op_assign
l_int|0xc0000000
suffix:semicolon
id|iomem_resource.end
op_assign
l_int|0xc0000000
op_plus
l_int|0x20000000
op_minus
l_int|1
suffix:semicolon
id|pci_scan_bus
c_func
(paren
l_int|0
comma
op_amp
id|titan_pci_ops
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|pmc_yosemite_setup
id|early_initcall
c_func
(paren
id|pmc_yosemite_setup
)paren
suffix:semicolon
eof
