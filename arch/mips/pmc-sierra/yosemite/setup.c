multiline_comment|/*&n; *  Copyright (C) 2003 PMC-Sierra Inc.&n; *  Author: Manish Lachwani (lachwani@pmc-sierra.com)&n; *&n; * Copyright (C) 2004 by Ralf Baechle (ralf@linux-mips.org)&n; *&n; *  This program is free software; you can redistribute  it and/or modify it&n; *  under  the terms of  the GNU General  Public License as published by the&n; *  Free Software Foundation;  either version 2 of the  License, or (at your&n; *  option) any later version.&n; *&n; *  THIS  SOFTWARE  IS PROVIDED   ``AS  IS&squot;&squot; AND   ANY  EXPRESS OR IMPLIED&n; *  WARRANTIES,   INCLUDING, BUT NOT  LIMITED  TO, THE IMPLIED WARRANTIES OF&n; *  MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  IN&n; *  NO  EVENT  SHALL   THE AUTHOR  BE    LIABLE FOR ANY   DIRECT, INDIRECT,&n; *  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT&n; *  NOT LIMITED   TO, PROCUREMENT OF  SUBSTITUTE GOODS  OR SERVICES; LOSS OF&n; *  USE, DATA,  OR PROFITS; OR  BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON&n; *  ANY THEORY OF LIABILITY, WHETHER IN  CONTRACT, STRICT LIABILITY, OR TORT&n; *  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF&n; *  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.&n; *&n; *  You should have received a copy of the  GNU General Public License along&n; *  with this program; if not, write  to the Free Software Foundation, Inc.,&n; *  675 Mass Ave, Cambridge, MA 02139, USA.&n; */
macro_line|#include &lt;linux/bcd.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/bootmem.h&gt;
macro_line|#include &lt;linux/swap.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/timex.h&gt;
macro_line|#include &lt;linux/termios.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/serial.h&gt;
macro_line|#include &lt;linux/serial_core.h&gt;
macro_line|#include &lt;asm/time.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/reboot.h&gt;
macro_line|#include &lt;asm/serial.h&gt;
macro_line|#include &lt;asm/titan_dep.h&gt;
macro_line|#include &lt;asm/m48t37.h&gt;
macro_line|#include &quot;setup.h&quot;
DECL|variable|titan_ge_mac_addr_base
r_int
r_char
id|titan_ge_mac_addr_base
(braket
l_int|6
)braket
op_assign
(brace
singleline_comment|// 0x00, 0x03, 0xcc, 0x1d, 0x22, 0x00
l_int|0x00
comma
l_int|0xe0
comma
l_int|0x04
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x21
)brace
suffix:semicolon
DECL|variable|cpu_clock
r_int
r_int
id|cpu_clock
suffix:semicolon
DECL|variable|yosemite_base
r_int
r_int
id|yosemite_base
suffix:semicolon
DECL|variable|m48t37_base
r_static
r_struct
id|m48t37_rtc
op_star
id|m48t37_base
suffix:semicolon
DECL|function|bus_error_init
r_void
id|__init
id|bus_error_init
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Do nothing */
)brace
DECL|function|m48t37y_get_time
r_int
r_int
id|m48t37y_get_time
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|year
comma
id|month
comma
id|day
comma
id|hour
comma
id|min
comma
id|sec
suffix:semicolon
multiline_comment|/* Stop the update to the time */
id|m48t37_base-&gt;control
op_assign
l_int|0x40
suffix:semicolon
id|year
op_assign
id|BCD2BIN
c_func
(paren
id|m48t37_base-&gt;year
)paren
suffix:semicolon
id|year
op_add_assign
id|BCD2BIN
c_func
(paren
id|m48t37_base-&gt;century
)paren
op_star
l_int|100
suffix:semicolon
id|month
op_assign
id|BCD2BIN
c_func
(paren
id|m48t37_base-&gt;month
)paren
suffix:semicolon
id|day
op_assign
id|BCD2BIN
c_func
(paren
id|m48t37_base-&gt;date
)paren
suffix:semicolon
id|hour
op_assign
id|BCD2BIN
c_func
(paren
id|m48t37_base-&gt;hour
)paren
suffix:semicolon
id|min
op_assign
id|BCD2BIN
c_func
(paren
id|m48t37_base-&gt;min
)paren
suffix:semicolon
id|sec
op_assign
id|BCD2BIN
c_func
(paren
id|m48t37_base-&gt;sec
)paren
suffix:semicolon
multiline_comment|/* Start the update to the time again */
id|m48t37_base-&gt;control
op_assign
l_int|0x00
suffix:semicolon
r_return
id|mktime
c_func
(paren
id|year
comma
id|month
comma
id|day
comma
id|hour
comma
id|min
comma
id|sec
)paren
suffix:semicolon
)brace
DECL|function|m48t37y_set_time
r_int
id|m48t37y_set_time
c_func
(paren
r_int
r_int
id|sec
)paren
(brace
r_struct
id|rtc_time
id|tm
suffix:semicolon
multiline_comment|/* convert to a more useful format -- note months count from 0 */
id|to_tm
c_func
(paren
id|sec
comma
op_amp
id|tm
)paren
suffix:semicolon
id|tm.tm_mon
op_add_assign
l_int|1
suffix:semicolon
multiline_comment|/* enable writing */
id|m48t37_base-&gt;control
op_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* year */
id|m48t37_base-&gt;year
op_assign
id|BIN2BCD
c_func
(paren
id|tm.tm_year
op_mod
l_int|100
)paren
suffix:semicolon
id|m48t37_base-&gt;century
op_assign
id|BIN2BCD
c_func
(paren
id|tm.tm_year
op_div
l_int|100
)paren
suffix:semicolon
multiline_comment|/* month */
id|m48t37_base-&gt;month
op_assign
id|BIN2BCD
c_func
(paren
id|tm.tm_mon
)paren
suffix:semicolon
multiline_comment|/* day */
id|m48t37_base-&gt;date
op_assign
id|BIN2BCD
c_func
(paren
id|tm.tm_mday
)paren
suffix:semicolon
multiline_comment|/* hour/min/sec */
id|m48t37_base-&gt;hour
op_assign
id|BIN2BCD
c_func
(paren
id|tm.tm_hour
)paren
suffix:semicolon
id|m48t37_base-&gt;min
op_assign
id|BIN2BCD
c_func
(paren
id|tm.tm_min
)paren
suffix:semicolon
id|m48t37_base-&gt;sec
op_assign
id|BIN2BCD
c_func
(paren
id|tm.tm_sec
)paren
suffix:semicolon
multiline_comment|/* day of week -- not really used, but let&squot;s keep it up-to-date */
id|m48t37_base-&gt;day
op_assign
id|BIN2BCD
c_func
(paren
id|tm.tm_wday
op_plus
l_int|1
)paren
suffix:semicolon
multiline_comment|/* disable writing */
id|m48t37_base-&gt;control
op_assign
l_int|0x00
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|yosemite_timer_setup
r_void
id|yosemite_timer_setup
c_func
(paren
r_struct
id|irqaction
op_star
id|irq
)paren
(brace
id|setup_irq
c_func
(paren
l_int|7
comma
id|irq
)paren
suffix:semicolon
)brace
DECL|function|yosemite_time_init
r_void
id|yosemite_time_init
c_func
(paren
r_void
)paren
(brace
id|board_timer_setup
op_assign
id|yosemite_timer_setup
suffix:semicolon
id|mips_hpt_frequency
op_assign
id|cpu_clock
op_div
l_int|2
suffix:semicolon
id|mips_hpt_frequency
op_assign
l_int|33000000
op_star
l_int|3
op_star
l_int|5
suffix:semicolon
)brace
multiline_comment|/* No other usable initialization hook than this ...  */
r_extern
r_void
(paren
op_star
id|late_time_init
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|variable|ocd_base
r_int
r_int
id|ocd_base
suffix:semicolon
DECL|variable|ocd_base
id|EXPORT_SYMBOL
c_func
(paren
id|ocd_base
)paren
suffix:semicolon
multiline_comment|/*&n; * Common setup before any secondaries are started&n; */
DECL|macro|TITAN_UART_CLK
mdefine_line|#define TITAN_UART_CLK&t;&t;3686400
DECL|macro|TITAN_SERIAL_BASE_BAUD
mdefine_line|#define TITAN_SERIAL_BASE_BAUD&t;(TITAN_UART_CLK / 16)
DECL|macro|TITAN_SERIAL_IRQ
mdefine_line|#define TITAN_SERIAL_IRQ&t;4
DECL|macro|TITAN_SERIAL_BASE
mdefine_line|#define TITAN_SERIAL_BASE&t;0xfd000008UL
DECL|function|py_map_ocd
r_static
r_void
id|__init
id|py_map_ocd
c_func
(paren
r_void
)paren
(brace
id|ocd_base
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|OCD_BASE
comma
id|OCD_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ocd_base
)paren
id|panic
c_func
(paren
l_string|&quot;Mapping OCD failed - game over.  Your score is 0.&quot;
)paren
suffix:semicolon
multiline_comment|/* Kludge for PMON bug ... */
id|OCD_WRITE
c_func
(paren
l_int|0x0710
comma
l_int|0x0ffff029
)paren
suffix:semicolon
)brace
DECL|function|py_uart_setup
r_static
r_void
id|__init
id|py_uart_setup
c_func
(paren
r_void
)paren
(brace
r_struct
id|uart_port
id|up
suffix:semicolon
multiline_comment|/*&n;&t; * Register to interrupt zero because we share the interrupt with&n;&t; * the serial driver which we don&squot;t properly support yet.&n;&t; */
id|memset
c_func
(paren
op_amp
id|up
comma
l_int|0
comma
r_sizeof
(paren
id|up
)paren
)paren
suffix:semicolon
id|up.membase
op_assign
(paren
r_int
r_char
op_star
)paren
id|ioremap
c_func
(paren
id|TITAN_SERIAL_BASE
comma
l_int|8
)paren
suffix:semicolon
id|up.irq
op_assign
id|TITAN_SERIAL_IRQ
suffix:semicolon
id|up.uartclk
op_assign
id|TITAN_UART_CLK
suffix:semicolon
id|up.regshift
op_assign
l_int|0
suffix:semicolon
id|up.iotype
op_assign
id|UPIO_MEM
suffix:semicolon
id|up.flags
op_assign
id|ASYNC_BOOT_AUTOCONF
op_or
id|ASYNC_SKIP_TEST
suffix:semicolon
id|up.line
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|early_serial_setup
c_func
(paren
op_amp
id|up
)paren
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Early serial init of port 0 failed&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|py_rtc_setup
r_static
r_void
id|__init
id|py_rtc_setup
c_func
(paren
r_void
)paren
(brace
id|m48t37_base
op_assign
id|ioremap
c_func
(paren
id|YOSEMITE_RTC_BASE
comma
id|YOSEMITE_RTC_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|m48t37_base
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Mapping the RTC failed&bslash;n&quot;
)paren
suffix:semicolon
id|rtc_get_time
op_assign
id|m48t37y_get_time
suffix:semicolon
id|rtc_set_time
op_assign
id|m48t37y_set_time
suffix:semicolon
id|write_seqlock
c_func
(paren
op_amp
id|xtime_lock
)paren
suffix:semicolon
id|xtime.tv_sec
op_assign
id|m48t37y_get_time
c_func
(paren
)paren
suffix:semicolon
id|xtime.tv_nsec
op_assign
l_int|0
suffix:semicolon
id|set_normalized_timespec
c_func
(paren
op_amp
id|wall_to_monotonic
comma
op_minus
id|xtime.tv_sec
comma
op_minus
id|xtime.tv_nsec
)paren
suffix:semicolon
id|write_sequnlock
c_func
(paren
op_amp
id|xtime_lock
)paren
suffix:semicolon
)brace
multiline_comment|/* Not only time init but that&squot;s what the hook it&squot;s called through is named */
DECL|function|py_late_time_init
r_static
r_void
id|__init
id|py_late_time_init
c_func
(paren
r_void
)paren
(brace
id|py_map_ocd
c_func
(paren
)paren
suffix:semicolon
id|py_uart_setup
c_func
(paren
)paren
suffix:semicolon
id|py_rtc_setup
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|pmc_yosemite_setup
r_static
r_int
id|__init
id|pmc_yosemite_setup
c_func
(paren
r_void
)paren
(brace
id|board_time_init
op_assign
id|yosemite_time_init
suffix:semicolon
id|late_time_init
op_assign
id|py_late_time_init
suffix:semicolon
multiline_comment|/* Add memory regions */
id|add_memory_region
c_func
(paren
l_int|0x00000000
comma
l_int|0x10000000
comma
id|BOOT_MEM_RAM
)paren
suffix:semicolon
macro_line|#if 0 /* XXX Crash ...  */
id|OCD_WRITE
c_func
(paren
id|RM9000x2_OCD_HTSC
comma
id|OCD_READ
c_func
(paren
id|RM9000x2_OCD_HTSC
)paren
op_or
id|HYPERTRANSPORT_ENABLE
)paren
suffix:semicolon
multiline_comment|/* Set the BAR. Shifted mode */
id|OCD_WRITE
c_func
(paren
id|RM9000x2_OCD_HTBAR0
comma
id|HYPERTRANSPORT_BAR0_ADDR
)paren
suffix:semicolon
id|OCD_WRITE
c_func
(paren
id|RM9000x2_OCD_HTMASK0
comma
id|HYPERTRANSPORT_SIZE0
)paren
suffix:semicolon
macro_line|#endif
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|pmc_yosemite_setup
id|early_initcall
c_func
(paren
id|pmc_yosemite_setup
)paren
suffix:semicolon
eof
