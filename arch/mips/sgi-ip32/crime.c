multiline_comment|/*&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; *&n; * Copyright (C) 2001, 2003 Keith M Wesolowski&n; */
macro_line|#include &lt;asm/ip32/crime.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/mipsregs.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
DECL|function|crime_init
r_void
id|__init
id|crime_init
(paren
r_void
)paren
(brace
id|u64
id|id
op_assign
id|crime_read_64
(paren
id|CRIME_ID
)paren
suffix:semicolon
id|u64
id|rev
op_assign
id|id
op_amp
id|CRIME_ID_REV
suffix:semicolon
id|id
op_assign
(paren
id|id
op_amp
id|CRIME_ID_IDBITS
)paren
op_rshift
l_int|4
suffix:semicolon
id|printk
(paren
l_string|&quot;CRIME id %1lx rev %ld detected at 0x%016lx&bslash;n&quot;
comma
id|id
comma
id|rev
comma
(paren
r_int
r_int
)paren
id|CRIME_BASE
)paren
suffix:semicolon
)brace
DECL|function|crime_memerr_intr
id|irqreturn_t
id|crime_memerr_intr
(paren
r_int
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|u64
id|memerr
op_assign
id|crime_read_64
(paren
id|CRIME_MEM_ERROR_STAT
)paren
suffix:semicolon
id|u64
id|addr
op_assign
id|crime_read_64
(paren
id|CRIME_MEM_ERROR_ADDR
)paren
suffix:semicolon
r_int
id|fatal
op_assign
l_int|0
suffix:semicolon
id|memerr
op_and_assign
id|CRIME_MEM_ERROR_STAT_MASK
suffix:semicolon
id|addr
op_and_assign
id|CRIME_MEM_ERROR_ADDR_MASK
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;CRIME memory error at 0x%08lx ST 0x%08lx&lt;&quot;
comma
id|addr
comma
id|memerr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memerr
op_amp
id|CRIME_MEM_ERROR_INV
)paren
id|printk
c_func
(paren
l_string|&quot;INV,&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memerr
op_amp
id|CRIME_MEM_ERROR_ECC
)paren
(brace
id|u64
id|ecc_syn
op_assign
id|crime_read_64
c_func
(paren
id|CRIME_MEM_ERROR_ECC_SYN
)paren
suffix:semicolon
id|u64
id|ecc_gen
op_assign
id|crime_read_64
c_func
(paren
id|CRIME_MEM_ERROR_ECC_CHK
)paren
suffix:semicolon
id|ecc_syn
op_and_assign
id|CRIME_MEM_ERROR_ECC_SYN_MASK
suffix:semicolon
id|ecc_gen
op_and_assign
id|CRIME_MEM_ERROR_ECC_CHK_MASK
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;ECC,SYN=0x%08lx,GEN=0x%08lx,&quot;
comma
id|ecc_syn
comma
id|ecc_gen
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|memerr
op_amp
id|CRIME_MEM_ERROR_MULTIPLE
)paren
(brace
id|fatal
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;MULTIPLE,&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|memerr
op_amp
id|CRIME_MEM_ERROR_HARD_ERR
)paren
(brace
id|fatal
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;HARD,&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|memerr
op_amp
id|CRIME_MEM_ERROR_SOFT_ERR
)paren
id|printk
c_func
(paren
l_string|&quot;SOFT,&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memerr
op_amp
id|CRIME_MEM_ERROR_CPU_ACCESS
)paren
id|printk
c_func
(paren
l_string|&quot;CPU,&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memerr
op_amp
id|CRIME_MEM_ERROR_VICE_ACCESS
)paren
id|printk
c_func
(paren
l_string|&quot;VICE,&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memerr
op_amp
id|CRIME_MEM_ERROR_GBE_ACCESS
)paren
id|printk
c_func
(paren
l_string|&quot;GBE,&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memerr
op_amp
id|CRIME_MEM_ERROR_RE_ACCESS
)paren
id|printk
c_func
(paren
l_string|&quot;RE,REID=0x%02lx,&quot;
comma
(paren
id|memerr
op_amp
id|CRIME_MEM_ERROR_RE_ID
)paren
op_rshift
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memerr
op_amp
id|CRIME_MEM_ERROR_MACE_ACCESS
)paren
id|printk
c_func
(paren
l_string|&quot;MACE,MACEID=0x%02lx,&quot;
comma
id|memerr
op_amp
id|CRIME_MEM_ERROR_MACE_ID
)paren
suffix:semicolon
id|crime_write_64
(paren
id|CRIME_MEM_ERROR_STAT
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fatal
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;FATAL&gt;&bslash;n&quot;
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;Fatal memory error detected, halting&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;NONFATAL&gt;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|crime_cpuerr_intr
id|irqreturn_t
id|crime_cpuerr_intr
(paren
r_int
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|u64
id|cpuerr
op_assign
id|crime_read_64
(paren
id|CRIME_CPU_ERROR_STAT
)paren
suffix:semicolon
id|u64
id|addr
op_assign
id|crime_read_64
(paren
id|CRIME_CPU_ERROR_ADDR
)paren
suffix:semicolon
id|cpuerr
op_and_assign
id|CRIME_CPU_ERROR_MASK
suffix:semicolon
id|addr
op_lshift_assign
l_int|2UL
suffix:semicolon
id|printk
(paren
l_string|&quot;CRIME CPU error detected at 0x%09lx status 0x%08lx&bslash;n&quot;
comma
id|addr
comma
id|cpuerr
)paren
suffix:semicolon
id|crime_write_64
(paren
id|CRIME_CPU_ERROR_STAT
comma
l_int|0
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
eof
