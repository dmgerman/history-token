multiline_comment|/*&n; * linux/arch/mips/tx4927/common/tx4927_setup.c&n; *&n; * common tx4927 setup stuff&n; *&n; * Author: MontaVista Software, Inc.&n; *         source@mvista.com&n; *&n; * Copyright 2001-2002 MontaVista Software Inc.&n; *&n; *  This program is free software; you can redistribute it and/or modify it&n; *  under the terms of the GNU General Public License as published by the&n; *  Free Software Foundation; either version 2 of the License, or (at your&n; *  option) any later version.&n; *&n; *  THIS SOFTWARE IS PROVIDED ``AS IS&squot;&squot; AND ANY EXPRESS OR IMPLIED&n; *  WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF&n; *  MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.&n; *  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,&n; *  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,&n; *  BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS&n; *  OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND&n; *  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR&n; *  TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE&n; *  USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.&n; *&n; *  You should have received a copy of the GNU General Public License along&n; *  with this program; if not, write to the Free Software Foundation, Inc.,&n; *  675 Mass Ave, Cambridge, MA 02139, USA.&n; */
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel_stat.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/timex.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/random.h&gt;
macro_line|#include &lt;linux/irq.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/mipsregs.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/time.h&gt;
macro_line|#include &lt;asm/time.h&gt;
macro_line|#include &lt;asm/tx4927/tx4927.h&gt;
DECL|macro|DEBUG
macro_line|#undef DEBUG
r_void
id|__init
id|tx4927_setup
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|__init
id|tx4927_time_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|__init
id|tx4927_timer_setup
c_func
(paren
r_struct
id|irqaction
op_star
id|irq
)paren
suffix:semicolon
r_void
id|dump_cp0
c_func
(paren
r_char
op_star
id|key
)paren
suffix:semicolon
DECL|variable|__wbflush
r_void
(paren
op_star
id|__wbflush
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|function|tx4927_write_buffer_flush
r_static
r_void
id|tx4927_write_buffer_flush
c_func
(paren
r_void
)paren
(brace
id|__asm__
id|__volatile__
(paren
l_string|&quot;sync&bslash;n&bslash;t&quot;
l_string|&quot;nop&bslash;n&bslash;t&quot;
l_string|&quot;loop: bc0f loop&bslash;n&bslash;t&quot;
l_string|&quot;nop&bslash;n&bslash;t&quot;
)paren
suffix:semicolon
)brace
DECL|function|tx4927_setup
r_void
id|__init
id|tx4927_setup
c_func
(paren
r_void
)paren
(brace
id|board_time_init
op_assign
id|tx4927_time_init
suffix:semicolon
id|board_timer_setup
op_assign
id|tx4927_timer_setup
suffix:semicolon
id|__wbflush
op_assign
id|tx4927_write_buffer_flush
suffix:semicolon
macro_line|#ifdef CONFIG_TOSHIBA_RBTX4927
(brace
r_extern
r_void
id|toshiba_rbtx4927_setup
c_func
(paren
r_void
)paren
suffix:semicolon
id|toshiba_rbtx4927_setup
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
suffix:semicolon
)brace
DECL|function|tx4927_time_init
r_void
id|__init
id|tx4927_time_init
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_TOSHIBA_RBTX4927
(brace
r_extern
r_void
id|toshiba_rbtx4927_time_init
c_func
(paren
r_void
)paren
suffix:semicolon
id|toshiba_rbtx4927_time_init
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_KGDB
(brace
id|printk
c_func
(paren
l_string|&quot;Calling breakpoint() -- start remote kgdb&bslash;n&quot;
)paren
suffix:semicolon
id|set_debug_traps
c_func
(paren
)paren
suffix:semicolon
id|breakpoint
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Calling breakpoint() -- done&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
suffix:semicolon
)brace
DECL|function|tx4927_timer_setup
r_void
id|__init
id|tx4927_timer_setup
c_func
(paren
r_struct
id|irqaction
op_star
id|irq
)paren
(brace
id|u32
id|count
suffix:semicolon
id|u32
id|c1
suffix:semicolon
id|u32
id|c2
suffix:semicolon
id|setup_irq
c_func
(paren
id|TX4927_IRQ_CPU_TIMER
comma
id|irq
)paren
suffix:semicolon
multiline_comment|/* to generate the first timer interrupt */
id|c1
op_assign
id|read_c0_count
c_func
(paren
)paren
suffix:semicolon
id|count
op_assign
id|c1
op_plus
(paren
id|mips_counter_frequency
op_div
id|HZ
)paren
suffix:semicolon
id|write_c0_compare
c_func
(paren
id|count
)paren
suffix:semicolon
id|c2
op_assign
id|read_c0_count
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_TOSHIBA_RBTX4927
(brace
r_extern
r_void
id|toshiba_rbtx4927_timer_setup
c_func
(paren
r_struct
id|irqaction
op_star
id|irq
)paren
suffix:semicolon
id|toshiba_rbtx4927_timer_setup
c_func
(paren
id|irq
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
suffix:semicolon
)brace
macro_line|#ifdef DEBUG
DECL|function|print_cp0
r_void
id|print_cp0
c_func
(paren
r_char
op_star
id|key
comma
r_int
id|num
comma
r_char
op_star
id|name
comma
id|u32
id|val
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s cp0:%02d:%s=0x%08x&bslash;n&quot;
comma
id|key
comma
id|num
comma
id|name
comma
id|val
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|indent
suffix:colon
id|Standard
id|input
suffix:colon
l_int|25
suffix:colon
id|Error
suffix:colon
id|Unexpected
id|end
id|of
id|file
r_void
DECL|function|dump_cp0
id|dump_cp0
c_func
(paren
r_char
op_star
id|key
)paren
(brace
r_if
c_cond
(paren
id|key
op_eq
l_int|NULL
)paren
id|key
op_assign
l_string|&quot;&quot;
suffix:semicolon
id|print_cp0
c_func
(paren
id|key
comma
l_int|0
comma
l_string|&quot;INDEX   &quot;
comma
id|read_c0_index
c_func
(paren
)paren
)paren
suffix:semicolon
id|print_cp0
c_func
(paren
id|key
comma
l_int|2
comma
l_string|&quot;ENTRYLO1&quot;
comma
id|read_c0_entrylo0
c_func
(paren
)paren
)paren
suffix:semicolon
id|print_cp0
c_func
(paren
id|key
comma
l_int|3
comma
l_string|&quot;ENTRYLO2&quot;
comma
id|read_c0_entrylo1
c_func
(paren
)paren
)paren
suffix:semicolon
id|print_cp0
c_func
(paren
id|key
comma
l_int|4
comma
l_string|&quot;CONTEXT &quot;
comma
id|read_c0_context
c_func
(paren
)paren
)paren
suffix:semicolon
id|print_cp0
c_func
(paren
id|key
comma
l_int|5
comma
l_string|&quot;PAGEMASK&quot;
comma
id|read_c0_pagemask
c_func
(paren
)paren
)paren
suffix:semicolon
id|print_cp0
c_func
(paren
id|key
comma
l_int|6
comma
l_string|&quot;WIRED   &quot;
comma
id|read_c0_wired
c_func
(paren
)paren
)paren
suffix:semicolon
singleline_comment|//print_cp0(key, 8, &quot;BADVADDR&quot;,  read_c0_badvaddr());
id|print_cp0
c_func
(paren
id|key
comma
l_int|9
comma
l_string|&quot;COUNT   &quot;
comma
id|read_c0_count
c_func
(paren
)paren
)paren
suffix:semicolon
id|print_cp0
c_func
(paren
id|key
comma
l_int|10
comma
l_string|&quot;ENTRYHI &quot;
comma
id|read_c0_entryhi
c_func
(paren
)paren
)paren
suffix:semicolon
id|print_cp0
c_func
(paren
id|key
comma
l_int|11
comma
l_string|&quot;COMPARE &quot;
comma
id|read_c0_compare
c_func
(paren
)paren
)paren
suffix:semicolon
id|print_cp0
c_func
(paren
id|key
comma
l_int|12
comma
l_string|&quot;STATUS  &quot;
comma
id|read_c0_status
c_func
(paren
)paren
)paren
suffix:semicolon
id|print_cp0
c_func
(paren
id|key
comma
l_int|13
comma
l_string|&quot;CAUSE   &quot;
comma
id|read_c0_cause
c_func
(paren
)paren
op_amp
l_int|0xffff87ff
)paren
suffix:semicolon
id|print_cp0
c_func
(paren
id|key
comma
l_int|16
comma
l_string|&quot;CONFIG  &quot;
comma
id|read_c0_config
c_func
(paren
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|print_pic
r_void
id|print_pic
c_func
(paren
r_char
op_star
id|key
comma
id|u32
id|reg
comma
r_char
op_star
id|name
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s pic:0x%08x:%s=0x%08x&bslash;n&quot;
comma
id|key
comma
id|reg
comma
id|name
comma
id|TX4927_RD
c_func
(paren
id|reg
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|dump_pic
r_void
id|dump_pic
c_func
(paren
r_char
op_star
id|key
)paren
(brace
r_if
c_cond
(paren
id|key
op_eq
l_int|NULL
)paren
id|key
op_assign
l_string|&quot;&quot;
suffix:semicolon
id|print_pic
c_func
(paren
id|key
comma
l_int|0xff1ff600
comma
l_string|&quot;IRDEN    &quot;
)paren
suffix:semicolon
id|print_pic
c_func
(paren
id|key
comma
l_int|0xff1ff604
comma
l_string|&quot;IRDM0    &quot;
)paren
suffix:semicolon
id|print_pic
c_func
(paren
id|key
comma
l_int|0xff1ff608
comma
l_string|&quot;IRDM1    &quot;
)paren
suffix:semicolon
id|print_pic
c_func
(paren
id|key
comma
l_int|0xff1ff610
comma
l_string|&quot;IRLVL0   &quot;
)paren
suffix:semicolon
id|print_pic
c_func
(paren
id|key
comma
l_int|0xff1ff614
comma
l_string|&quot;IRLVL1   &quot;
)paren
suffix:semicolon
id|print_pic
c_func
(paren
id|key
comma
l_int|0xff1ff618
comma
l_string|&quot;IRLVL2   &quot;
)paren
suffix:semicolon
id|print_pic
c_func
(paren
id|key
comma
l_int|0xff1ff61c
comma
l_string|&quot;IRLVL3   &quot;
)paren
suffix:semicolon
id|print_pic
c_func
(paren
id|key
comma
l_int|0xff1ff620
comma
l_string|&quot;IRLVL4   &quot;
)paren
suffix:semicolon
id|print_pic
c_func
(paren
id|key
comma
l_int|0xff1ff624
comma
l_string|&quot;IRLVL5   &quot;
)paren
suffix:semicolon
id|print_pic
c_func
(paren
id|key
comma
l_int|0xff1ff628
comma
l_string|&quot;IRLVL6   &quot;
)paren
suffix:semicolon
id|print_pic
c_func
(paren
id|key
comma
l_int|0xff1ff62c
comma
l_string|&quot;IRLVL7   &quot;
)paren
suffix:semicolon
id|print_pic
c_func
(paren
id|key
comma
l_int|0xff1ff640
comma
l_string|&quot;IRMSK    &quot;
)paren
suffix:semicolon
id|print_pic
c_func
(paren
id|key
comma
l_int|0xff1ff660
comma
l_string|&quot;IREDC    &quot;
)paren
suffix:semicolon
id|print_pic
c_func
(paren
id|key
comma
l_int|0xff1ff680
comma
l_string|&quot;IRPND    &quot;
)paren
suffix:semicolon
id|print_pic
c_func
(paren
id|key
comma
l_int|0xff1ff6a0
comma
l_string|&quot;IRCS     &quot;
)paren
suffix:semicolon
id|print_pic
c_func
(paren
id|key
comma
l_int|0xff1ff514
comma
l_string|&quot;IRFLAG1  &quot;
)paren
suffix:semicolon
multiline_comment|/* don&squot;t read IRLAG0 -- it hangs system */
id|print_pic
c_func
(paren
id|key
comma
l_int|0xff1ff518
comma
l_string|&quot;IRPOL    &quot;
)paren
suffix:semicolon
id|print_pic
c_func
(paren
id|key
comma
l_int|0xff1ff51c
comma
l_string|&quot;IRRCNT   &quot;
)paren
suffix:semicolon
id|print_pic
c_func
(paren
id|key
comma
l_int|0xff1ff520
comma
l_string|&quot;IRMASKINT&quot;
)paren
suffix:semicolon
id|print_pic
c_func
(paren
id|key
comma
l_int|0xff1ff524
comma
l_string|&quot;IRMASKEXT&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|print_addr
r_void
id|print_addr
c_func
(paren
r_char
op_star
id|hdr
comma
r_char
op_star
id|key
comma
id|u32
id|addr
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s %s:0x%08x=0x%08x&bslash;n&quot;
comma
id|hdr
comma
id|key
comma
id|addr
comma
id|TX4927_RD
c_func
(paren
id|addr
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|dump_180
r_void
id|dump_180
c_func
(paren
r_char
op_star
id|key
)paren
(brace
id|u32
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0x80000180
suffix:semicolon
id|i
OL
l_int|0x80000180
op_plus
l_int|0x80
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
(brace
id|print_addr
c_func
(paren
l_string|&quot;180&quot;
comma
id|key
comma
id|i
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|dump_eh0
r_void
id|dump_eh0
c_func
(paren
r_char
op_star
id|key
)paren
(brace
r_int
id|i
suffix:semicolon
r_extern
r_int
r_int
id|exception_handlers
(braket
)braket
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
(paren
r_int
)paren
id|exception_handlers
suffix:semicolon
id|i
OL
(paren
r_int
)paren
(paren
id|exception_handlers
op_plus
l_int|20
)paren
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
(brace
id|print_addr
c_func
(paren
l_string|&quot;eh0&quot;
comma
id|key
comma
id|i
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
DECL|function|pk0
r_void
id|pk0
c_func
(paren
r_void
)paren
(brace
r_volatile
id|u32
id|val
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ori %0, $26, 0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|val
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;k0=[0x%08x]&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
)brace
macro_line|#endif
eof
