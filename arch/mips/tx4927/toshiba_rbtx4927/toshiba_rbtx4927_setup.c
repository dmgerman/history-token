multiline_comment|/*&n; * Toshiba rbtx4927 specific setup&n; *&n; * Author: MontaVista Software, Inc.&n; *         source@mvista.com&n; *&n; * Copyright 2001-2002 MontaVista Software Inc.&n; *&n; * Copyright (C) 1996, 1997, 2001  Ralf Baechle&n; * Copyright (C) 2000 RidgeRun, Inc.&n; * Author: RidgeRun, Inc.&n; *   glonnon@ridgerun.com, skranz@ridgerun.com, stevej@ridgerun.com&n; *&n; * Copyright 2001 MontaVista Software Inc.&n; * Author: jsun@mvista.com or jsun@junsun.net&n; *&n; * Copyright 2002 MontaVista Software Inc.&n; * Author: Michael Pruznick, michael_pruznick@mvista.com&n; *&n; * Copyright (C) 2000-2001 Toshiba Corporation &n; *&n; *  This program is free software; you can redistribute it and/or modify it&n; *  under the terms of the GNU General Public License as published by the&n; *  Free Software Foundation; either version 2 of the License, or (at your&n; *  option) any later version.&n; *&n; *  THIS SOFTWARE IS PROVIDED ``AS IS&squot;&squot; AND ANY EXPRESS OR IMPLIED&n; *  WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF&n; *  MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.&n; *  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,&n; *  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,&n; *  BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS&n; *  OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND&n; *  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR&n; *  TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE&n; *  USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.&n; *&n; *  You should have received a copy of the GNU General Public License along&n; *  with this program; if not, write to the Free Software Foundation, Inc.,&n; *  675 Mass Ave, Cambridge, MA 02139, USA.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/swap.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/timex.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/pci.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/reboot.h&gt;
macro_line|#include &lt;asm/time.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/bootmem.h&gt;
macro_line|#include &lt;linux/blk.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#ifdef CONFIG_RTC_DS1742
macro_line|#include &lt;asm/rtc_ds1742.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_TOSHIBA_FPCIB0
macro_line|#include &lt;asm/smsc_fdc37m81x.h&gt;
macro_line|#endif
macro_line|#include &lt;asm/tx4927/toshiba_rbtx4927.h&gt;
macro_line|#ifdef CONFIG_PCI
macro_line|#include &lt;asm/tx4927/tx4927_pci.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/pci_channel.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_PC_KEYB
macro_line|#include &lt;asm/keyboard.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_BLK_DEV_IDEPCI
macro_line|#include &lt;linux/hdreg.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;linux/ide.h&gt;
r_extern
r_struct
id|ide_ops
id|std_ide_ops
suffix:semicolon
macro_line|#endif
DECL|macro|TOSHIBA_RBTX4927_SETUP_DEBUG
macro_line|#undef TOSHIBA_RBTX4927_SETUP_DEBUG
macro_line|#ifdef TOSHIBA_RBTX4927_SETUP_DEBUG
DECL|macro|TOSHIBA_RBTX4927_SETUP_NONE
mdefine_line|#define TOSHIBA_RBTX4927_SETUP_NONE        0x00000000
DECL|macro|TOSHIBA_RBTX4927_SETUP_INFO
mdefine_line|#define TOSHIBA_RBTX4927_SETUP_INFO        ( 1 &lt;&lt;  0 )
DECL|macro|TOSHIBA_RBTX4927_SETUP_WARN
mdefine_line|#define TOSHIBA_RBTX4927_SETUP_WARN        ( 1 &lt;&lt;  1 )
DECL|macro|TOSHIBA_RBTX4927_SETUP_EROR
mdefine_line|#define TOSHIBA_RBTX4927_SETUP_EROR        ( 1 &lt;&lt;  2 )
DECL|macro|TOSHIBA_RBTX4927_SETUP_EFWFU
mdefine_line|#define TOSHIBA_RBTX4927_SETUP_EFWFU       ( 1 &lt;&lt;  3 )
DECL|macro|TOSHIBA_RBTX4927_SETUP_SETUP
mdefine_line|#define TOSHIBA_RBTX4927_SETUP_SETUP       ( 1 &lt;&lt;  4 )
DECL|macro|TOSHIBA_RBTX4927_SETUP_TIME_INIT
mdefine_line|#define TOSHIBA_RBTX4927_SETUP_TIME_INIT   ( 1 &lt;&lt;  5 )
DECL|macro|TOSHIBA_RBTX4927_SETUP_TIMER_SETUP
mdefine_line|#define TOSHIBA_RBTX4927_SETUP_TIMER_SETUP ( 1 &lt;&lt;  6 )
DECL|macro|TOSHIBA_RBTX4927_SETUP_PCIBIOS
mdefine_line|#define TOSHIBA_RBTX4927_SETUP_PCIBIOS     ( 1 &lt;&lt;  7 )
DECL|macro|TOSHIBA_RBTX4927_SETUP_PCI1
mdefine_line|#define TOSHIBA_RBTX4927_SETUP_PCI1        ( 1 &lt;&lt;  8 )
DECL|macro|TOSHIBA_RBTX4927_SETUP_PCI2
mdefine_line|#define TOSHIBA_RBTX4927_SETUP_PCI2        ( 1 &lt;&lt;  9 )
DECL|macro|TOSHIBA_RBTX4927_SETUP_PCI66
mdefine_line|#define TOSHIBA_RBTX4927_SETUP_PCI66       ( 1 &lt;&lt; 10 )
DECL|macro|TOSHIBA_RBTX4927_SETUP_ALL
mdefine_line|#define TOSHIBA_RBTX4927_SETUP_ALL         0xffffffff
macro_line|#endif
macro_line|#ifdef TOSHIBA_RBTX4927_SETUP_DEBUG
DECL|variable|toshiba_rbtx4927_setup_debug_flag
r_static
r_const
id|u32
id|toshiba_rbtx4927_setup_debug_flag
op_assign
(paren
id|TOSHIBA_RBTX4927_SETUP_NONE
op_or
id|TOSHIBA_RBTX4927_SETUP_INFO
op_or
id|TOSHIBA_RBTX4927_SETUP_WARN
op_or
id|TOSHIBA_RBTX4927_SETUP_EROR
op_or
id|TOSHIBA_RBTX4927_SETUP_EFWFU
op_or
id|TOSHIBA_RBTX4927_SETUP_SETUP
op_or
id|TOSHIBA_RBTX4927_SETUP_TIME_INIT
op_or
id|TOSHIBA_RBTX4927_SETUP_TIMER_SETUP
op_or
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
op_or
id|TOSHIBA_RBTX4927_SETUP_PCI1
op_or
id|TOSHIBA_RBTX4927_SETUP_PCI2
op_or
id|TOSHIBA_RBTX4927_SETUP_PCI66
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef TOSHIBA_RBTX4927_SETUP_DEBUG
DECL|macro|TOSHIBA_RBTX4927_SETUP_DPRINTK
mdefine_line|#define TOSHIBA_RBTX4927_SETUP_DPRINTK(flag,str...) &bslash;&n;        if ( (toshiba_rbtx4927_setup_debug_flag) &amp; (flag) ) &bslash;&n;        { &bslash;&n;           char tmp[100]; &bslash;&n;           sprintf( tmp, str ); &bslash;&n;           printk( &quot;%s(%s:%u)::%s&quot;, __FUNCTION__, __FILE__, __LINE__, tmp ); &bslash;&n;        }
macro_line|#else
DECL|macro|TOSHIBA_RBTX4927_SETUP_DPRINTK
mdefine_line|#define TOSHIBA_RBTX4927_SETUP_DPRINTK(flag,str...)
macro_line|#endif
multiline_comment|/* These functions are used for rebooting or halting the machine*/
r_extern
r_void
id|toshiba_rbtx4927_restart
c_func
(paren
r_char
op_star
id|command
)paren
suffix:semicolon
r_extern
r_void
id|toshiba_rbtx4927_halt
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|toshiba_rbtx4927_power_off
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|variable|tx4927_using_backplane
r_int
id|tx4927_using_backplane
op_assign
l_int|0
suffix:semicolon
r_extern
r_void
id|gt64120_time_init
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|toshiba_rbtx4927_irq_setup
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
DECL|macro|CONFIG_TX4927BUG_WORKAROUND
mdefine_line|#define CONFIG_TX4927BUG_WORKAROUND
DECL|macro|TX4927_SUPPORT_COMMAND_IO
macro_line|#undef TX4927_SUPPORT_COMMAND_IO
DECL|macro|TX4927_SUPPORT_PCI_66
macro_line|#undef  TX4927_SUPPORT_PCI_66
DECL|variable|tx4927_cpu_clock
r_int
id|tx4927_cpu_clock
op_assign
l_int|100000000
suffix:semicolon
multiline_comment|/* 100MHz */
DECL|variable|mips_pci_io_base
r_int
r_int
id|mips_pci_io_base
suffix:semicolon
DECL|variable|mips_pci_io_size
r_int
r_int
id|mips_pci_io_size
suffix:semicolon
DECL|variable|mips_pci_mem_base
r_int
r_int
id|mips_pci_mem_base
suffix:semicolon
DECL|variable|mips_pci_mem_size
r_int
r_int
id|mips_pci_mem_size
suffix:semicolon
multiline_comment|/* for legacy I/O, PCI I/O PCI Bus address must be 0 */
DECL|variable|mips_pci_io_pciaddr
r_int
r_int
id|mips_pci_io_pciaddr
op_assign
l_int|0
suffix:semicolon
DECL|variable|mips_memory_upper
r_int
r_int
id|mips_memory_upper
suffix:semicolon
DECL|variable|tx4927_ccfg_toeon
r_static
r_int
id|tx4927_ccfg_toeon
op_assign
l_int|1
suffix:semicolon
DECL|variable|tx4927_pcic_trdyto
r_static
r_int
id|tx4927_pcic_trdyto
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* default: disabled */
DECL|variable|tx4927_ce_base
r_int
r_int
id|tx4927_ce_base
(braket
l_int|8
)braket
suffix:semicolon
r_void
id|tx4927_pci_setup
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
id|tx4927_reset_pci_pcic
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#ifdef  TX4927_SUPPORT_PCI_66
r_void
id|tx4927_pci66_setup
c_func
(paren
r_void
)paren
suffix:semicolon
r_extern
r_int
id|tx4927_pci66_check
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|tx4927_pci66
r_int
id|tx4927_pci66
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* 0:auto */
macro_line|#endif
DECL|variable|toshiba_name
r_char
op_star
id|toshiba_name
op_assign
l_string|&quot;&quot;
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
DECL|function|tx4927_dump_pcic_settings
r_void
id|tx4927_dump_pcic_settings
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s pcic settings:&quot;
comma
id|toshiba_name
)paren
suffix:semicolon
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
op_star
id|preg
op_assign
(paren
r_int
r_int
op_star
)paren
id|tx4927_pcicptr
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
r_struct
id|tx4927_pcic_reg
)paren
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
(brace
r_if
c_cond
(paren
id|i
op_mod
l_int|32
op_eq
l_int|0
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n%04x:&quot;
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|preg
op_eq
op_amp
id|tx4927_pcicptr-&gt;g2pintack
op_logical_or
id|preg
op_eq
op_amp
id|tx4927_pcicptr-&gt;g2pspc
macro_line|#ifdef CONFIG_TX4927BUG_WORKAROUND
op_logical_or
id|preg
op_eq
op_amp
id|tx4927_pcicptr-&gt;g2pcfgadrs
op_logical_or
id|preg
op_eq
op_amp
id|tx4927_pcicptr-&gt;g2pcfgdata
macro_line|#endif
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; XXXXXXXX&quot;
)paren
suffix:semicolon
id|preg
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot; %08lx&quot;
comma
op_star
id|preg
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
id|preg
op_eq
op_amp
id|tx4927_pcicptr-&gt;g2pcfgadrs
)paren
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|tx4927_pcierr_interrupt
r_static
r_void
id|tx4927_pcierr_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_extern
r_void
id|tx4927_dump_pcic_settings
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_IDEPCI
multiline_comment|/* ignore MasterAbort for ide probing... */
r_if
c_cond
(paren
id|irq
op_eq
id|TX4927_IRQ_IRC_PCIERR
op_logical_and
(paren
(paren
id|tx4927_pcicptr-&gt;pcistatus
op_rshift
l_int|16
)paren
op_amp
l_int|0xf900
)paren
op_eq
id|PCI_STATUS_REC_MASTER_ABORT
)paren
(brace
id|tx4927_pcicptr-&gt;pcistatus
op_assign
(paren
id|tx4927_pcicptr
op_member_access_from_pointer
id|pcistatus
op_amp
l_int|0x0000ffff
)paren
op_or
(paren
id|PCI_STATUS_REC_MASTER_ABORT
op_lshift
l_int|16
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
id|printk
c_func
(paren
l_string|&quot;PCI error interrupt (irq 0x%x).&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;pcistat:%04x, g2pstatus:%08lx, pcicstatus:%08lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
(paren
id|tx4927_pcicptr-&gt;pcistatus
op_rshift
l_int|16
)paren
comma
id|tx4927_pcicptr-&gt;g2pstatus
comma
id|tx4927_pcicptr-&gt;pcicstatus
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;ccfg:%08lx, tear:%02lx_%08lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|tx4927_ccfgptr-&gt;ccfg
comma
(paren
r_int
r_int
)paren
(paren
id|tx4927_ccfgptr-&gt;tear
op_rshift
l_int|32
)paren
comma
(paren
r_int
r_int
)paren
id|tx4927_ccfgptr-&gt;tear
)paren
suffix:semicolon
id|show_regs
c_func
(paren
id|regs
)paren
suffix:semicolon
singleline_comment|//tx4927_dump_pcic_settings();
id|panic
c_func
(paren
l_string|&quot;PCI error at PC:%08lx.&quot;
comma
id|regs-&gt;cp0_epc
)paren
suffix:semicolon
)brace
DECL|variable|pcic_action
r_static
r_struct
id|irqaction
id|pcic_action
op_assign
(brace
id|tx4927_pcierr_interrupt
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;PCI-C&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|pcierr_action
r_static
r_struct
id|irqaction
id|pcierr_action
op_assign
(brace
id|tx4927_pcierr_interrupt
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;PCI-ERR&quot;
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|function|toshiba_rbtx4927_pci_irq_init
r_void
id|__init
id|toshiba_rbtx4927_pci_irq_init
c_func
(paren
r_void
)paren
(brace
id|setup_irq
c_func
(paren
id|TX4927_IRQ_IRC_PCIC
comma
op_amp
id|pcic_action
)paren
suffix:semicolon
id|setup_irq
c_func
(paren
id|TX4927_IRQ_IRC_PCIERR
comma
op_amp
id|pcierr_action
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|tx4927_reset_pci_pcic
r_void
id|tx4927_reset_pci_pcic
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Reset PCI Bus */
op_star
id|tx4927_pcireset_ptr
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Reset PCIC */
id|tx4927_ccfgptr-&gt;clkctr
op_or_assign
id|TX4927_CLKCTR_PCIRST
suffix:semicolon
id|udelay
c_func
(paren
l_int|10000
)paren
suffix:semicolon
multiline_comment|/* clear PCIC reset */
id|tx4927_ccfgptr-&gt;clkctr
op_and_assign
op_complement
id|TX4927_CLKCTR_PCIRST
suffix:semicolon
op_star
id|tx4927_pcireset_ptr
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PCI */
macro_line|#ifdef CONFIG_PCI
macro_line|#ifdef  TX4927_SUPPORT_PCI_66
DECL|function|tx4927_pci66_setup
r_void
id|tx4927_pci66_setup
c_func
(paren
r_void
)paren
(brace
r_int
id|pciclk
comma
id|pciclkin
op_assign
l_int|1
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI66
comma
l_string|&quot;-&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tx4927_ccfgptr-&gt;ccfg
op_amp
id|TX4927_CCFG_PCI66
)paren
r_return
suffix:semicolon
id|tx4927_reset_pci_pcic
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Assert M66EN */
id|tx4927_ccfgptr-&gt;ccfg
op_or_assign
id|TX4927_CCFG_PCI66
suffix:semicolon
multiline_comment|/* set PCICLK 66MHz */
r_if
c_cond
(paren
id|tx4927_ccfgptr-&gt;pcfg
op_amp
id|TX4927_PCFG_PCICLKEN_ALL
)paren
(brace
r_int
r_int
id|pcidivmode
op_assign
l_int|0
suffix:semicolon
id|pcidivmode
op_assign
(paren
r_int
r_int
)paren
id|tx4927_ccfgptr
op_member_access_from_pointer
id|ccfg
op_amp
id|TX4927_CCFG_PCIDIVMODE_MASK
suffix:semicolon
r_if
c_cond
(paren
id|tx4927_cpu_clock
op_ge
l_int|170000000
)paren
(brace
multiline_comment|/* CPU 200MHz */
id|pcidivmode
op_assign
id|TX4927_CCFG_PCIDIVMODE_3
suffix:semicolon
id|pciclk
op_assign
id|tx4927_cpu_clock
op_div
l_int|3
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* CPU 166MHz */
id|pcidivmode
op_assign
id|TX4927_CCFG_PCIDIVMODE_2_5
suffix:semicolon
id|pciclk
op_assign
id|tx4927_cpu_clock
op_star
l_int|2
op_div
l_int|5
suffix:semicolon
)brace
id|tx4927_ccfgptr-&gt;ccfg
op_assign
(paren
id|tx4927_ccfgptr-&gt;ccfg
op_amp
op_complement
id|TX4927_CCFG_PCIDIVMODE_MASK
)paren
op_or
id|pcidivmode
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI66
comma
l_string|&quot;:PCICLK: ccfg:0x%08lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|tx4927_ccfgptr-&gt;ccfg
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|pciclk_setting
op_assign
op_star
id|tx4927_pci_clk_ptr
suffix:semicolon
id|pciclkin
op_assign
l_int|0
suffix:semicolon
id|pciclk
op_assign
l_int|66666666
suffix:semicolon
id|pciclk_setting
op_and_assign
op_complement
id|TX4927_PCI_CLK_MASK
suffix:semicolon
id|pciclk_setting
op_or_assign
id|TX4927_PCI_CLK_66
suffix:semicolon
op_star
id|tx4927_pci_clk_ptr
op_assign
id|pciclk_setting
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI66
comma
l_string|&quot;PCICLK: pci_clk:%02x&bslash;n&quot;
comma
op_star
id|tx4927_pci_clk_ptr
)paren
suffix:semicolon
)brace
id|udelay
c_func
(paren
l_int|10000
)paren
suffix:semicolon
multiline_comment|/* clear PCIC reset */
id|tx4927_ccfgptr-&gt;clkctr
op_and_assign
op_complement
id|TX4927_CLKCTR_PCIRST
suffix:semicolon
multiline_comment|/* clear PCI reset */
op_star
id|tx4927_pcireset_ptr
op_assign
l_int|0
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI66
comma
l_string|&quot;+&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif&t;&t;&t;&t;/* TX4927_SUPPORT_PCI_66 */
DECL|function|print_pci_status
r_void
id|print_pci_status
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;PCI STATUS %lx&bslash;n&quot;
comma
id|tx4927_pcicptr-&gt;pcistatus
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;PCIC STATUS %lx&bslash;n&quot;
comma
id|tx4927_pcicptr-&gt;pcicstatus
)paren
suffix:semicolon
)brace
DECL|function|fake_pci_dev
r_static
r_struct
id|pci_dev
op_star
id|fake_pci_dev
c_func
(paren
r_struct
id|pci_channel
op_star
id|hose
comma
r_int
id|top_bus
comma
r_int
id|busnr
comma
r_int
id|devfn
)paren
(brace
r_static
r_struct
id|pci_dev
id|dev
suffix:semicolon
r_static
r_struct
id|pci_bus
id|bus
suffix:semicolon
id|dev.bus
op_assign
op_amp
id|bus
suffix:semicolon
id|dev.sysdata
op_assign
id|hose
suffix:semicolon
id|dev.devfn
op_assign
id|devfn
suffix:semicolon
id|bus.number
op_assign
id|busnr
suffix:semicolon
id|bus.ops
op_assign
id|hose-&gt;pci_ops
suffix:semicolon
r_if
c_cond
(paren
id|busnr
op_ne
id|top_bus
)paren
multiline_comment|/* Fake a parent bus structure. */
id|bus.parent
op_assign
op_amp
id|bus
suffix:semicolon
r_else
id|bus.parent
op_assign
l_int|NULL
suffix:semicolon
r_return
op_amp
id|dev
suffix:semicolon
)brace
DECL|macro|EARLY_PCI_OP
mdefine_line|#define EARLY_PCI_OP(rw, size, type)                                    &bslash;&n;static int early_##rw##_config_##size(struct pci_channel *hose,                &bslash;&n;        int top_bus, int bus, int devfn, int offset, type value)        &bslash;&n;{                                                                       &bslash;&n;        return pci_##rw##_config_##size(                                &bslash;&n;                fake_pci_dev(hose, top_bus, bus, devfn),                &bslash;&n;                offset, value);                                         &bslash;&n;}
id|EARLY_PCI_OP
c_func
(paren
id|read
comma
id|byte
comma
id|u8
op_star
)paren
id|EARLY_PCI_OP
c_func
(paren
id|read
comma
id|word
comma
id|u16
op_star
)paren
id|EARLY_PCI_OP
c_func
(paren
id|read
comma
id|dword
comma
id|u32
op_star
)paren
id|EARLY_PCI_OP
c_func
(paren
id|write
comma
id|byte
comma
id|u8
)paren
id|EARLY_PCI_OP
c_func
(paren
id|write
comma
id|word
comma
id|u16
)paren
id|EARLY_PCI_OP
c_func
(paren
id|write
comma
id|dword
comma
id|u32
)paren
DECL|function|tx4927_pcibios_init
r_static
r_int
id|__init
id|tx4927_pcibios_init
c_func
(paren
r_int
id|busno
comma
r_struct
id|pci_channel
op_star
id|hose
)paren
(brace
id|u32
id|pci_devfn
suffix:semicolon
r_int
id|devfn_start
op_assign
l_int|0
suffix:semicolon
r_int
id|devfn_stop
op_assign
l_int|0xff
suffix:semicolon
r_int
r_int
id|id
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;-&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hose-&gt;first_devfn
)paren
id|devfn_start
op_assign
id|hose-&gt;first_devfn
suffix:semicolon
r_if
c_cond
(paren
id|hose-&gt;last_devfn
)paren
id|devfn_stop
op_assign
id|hose-&gt;last_devfn
suffix:semicolon
r_for
c_loop
(paren
id|pci_devfn
op_assign
id|devfn_start
suffix:semicolon
id|pci_devfn
OL
id|devfn_stop
suffix:semicolon
id|pci_devfn
op_increment
)paren
(brace
id|early_read_config_dword
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
id|PCI_VENDOR_ID
comma
op_amp
id|id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
op_eq
l_int|0xffffffff
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|id
op_eq
l_int|0x94601055
)paren
(brace
id|u8
id|v08_64
suffix:semicolon
id|u32
id|v32_b0
suffix:semicolon
id|u8
id|v08_e1
suffix:semicolon
r_char
op_star
id|s
op_assign
l_string|&quot; sb/isa --&quot;
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s beg&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
id|early_read_config_byte
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0x64
comma
op_amp
id|v08_64
)paren
suffix:semicolon
id|early_read_config_dword
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0xb0
comma
op_amp
id|v32_b0
)paren
suffix:semicolon
id|early_read_config_byte
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0xe1
comma
op_amp
id|v08_e1
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s beg 0x64 = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v08_64
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s beg 0xb0 = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v32_b0
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s beg 0xe1 = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v08_e1
)paren
suffix:semicolon
multiline_comment|/* serial irq control */
id|v08_64
op_assign
l_int|0xd0
suffix:semicolon
multiline_comment|/* serial irq pin */
id|v32_b0
op_or_assign
l_int|0x00010000
suffix:semicolon
multiline_comment|/* ide irq on isa14 */
id|v08_e1
op_and_assign
l_int|0xf0
suffix:semicolon
id|v08_e1
op_or_assign
l_int|0x0d
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s mid 0x64 = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v08_64
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s mid 0xb0 = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v32_b0
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s mid 0xe1 = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v08_e1
)paren
suffix:semicolon
id|early_write_config_byte
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0x64
comma
id|v08_64
)paren
suffix:semicolon
id|early_write_config_dword
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0xb0
comma
id|v32_b0
)paren
suffix:semicolon
id|early_write_config_byte
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0xe1
comma
id|v08_e1
)paren
suffix:semicolon
macro_line|#ifdef TOSHIBA_RBTX4927_SETUP_DEBUG
(brace
id|early_read_config_byte
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0x64
comma
op_amp
id|v08_64
)paren
suffix:semicolon
id|early_read_config_dword
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0xb0
comma
op_amp
id|v32_b0
)paren
suffix:semicolon
id|early_read_config_byte
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0xe1
comma
op_amp
id|v08_e1
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s end 0x64 = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v08_64
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s end 0xb0 = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v32_b0
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s end 0xe1 = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v08_e1
)paren
suffix:semicolon
)brace
macro_line|#endif
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s end&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|id
op_eq
l_int|0x91301055
)paren
(brace
id|u8
id|v08_04
suffix:semicolon
id|u8
id|v08_09
suffix:semicolon
id|u8
id|v08_41
suffix:semicolon
id|u8
id|v08_43
suffix:semicolon
id|u8
id|v08_5c
suffix:semicolon
r_char
op_star
id|s
op_assign
l_string|&quot; sb/ide --&quot;
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s beg&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
id|early_read_config_byte
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0x04
comma
op_amp
id|v08_04
)paren
suffix:semicolon
id|early_read_config_byte
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0x09
comma
op_amp
id|v08_09
)paren
suffix:semicolon
id|early_read_config_byte
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0x41
comma
op_amp
id|v08_41
)paren
suffix:semicolon
id|early_read_config_byte
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0x43
comma
op_amp
id|v08_43
)paren
suffix:semicolon
id|early_read_config_byte
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0x5c
comma
op_amp
id|v08_5c
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s beg 0x04 = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v08_04
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s beg 0x09 = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v08_09
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s beg 0x41 = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v08_41
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s beg 0x43 = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v08_43
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s beg 0x5c = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v08_5c
)paren
suffix:semicolon
multiline_comment|/* enable ide master/io */
id|v08_04
op_or_assign
(paren
id|PCI_COMMAND_MASTER
op_or
id|PCI_COMMAND_IO
)paren
suffix:semicolon
multiline_comment|/* enable ide native mode */
id|v08_09
op_or_assign
l_int|0x05
suffix:semicolon
multiline_comment|/* enable primary ide */
id|v08_41
op_or_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* enable secondary ide */
id|v08_43
op_or_assign
l_int|0x80
suffix:semicolon
multiline_comment|/* &n;&t;&t;&t; * !!! DO NOT REMOVE THIS COMMENT IT IS REQUIRED BY SMSC !!!&n;&t;&t;&t; *&n;&t;&t;&t; * This line of code is intended to provide the user with a work&n;&t;&t;&t; * around solution to the anomalies cited in SMSC&squot;s anomaly sheet&n;&t;&t;&t; * entitled, &quot;SLC90E66 Functional Rev.J_0.1 Anomalies&quot;&quot;.&n;&t;&t;&t; *&n;&t;&t;&t; * !!! DO NOT REMOVE THIS COMMENT IT IS REQUIRED BY SMSC !!!&n;&t;&t;&t; */
id|v08_5c
op_or_assign
l_int|0x01
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s mid 0x04 = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v08_04
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s mid 0x09 = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v08_09
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s mid 0x41 = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v08_41
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s mid 0x43 = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v08_43
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s mid 0x5c = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v08_5c
)paren
suffix:semicolon
id|early_write_config_byte
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0x5c
comma
id|v08_5c
)paren
suffix:semicolon
id|early_write_config_byte
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0x04
comma
id|v08_04
)paren
suffix:semicolon
id|early_write_config_byte
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0x09
comma
id|v08_09
)paren
suffix:semicolon
id|early_write_config_byte
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0x41
comma
id|v08_41
)paren
suffix:semicolon
id|early_write_config_byte
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0x43
comma
id|v08_43
)paren
suffix:semicolon
macro_line|#ifdef TOSHIBA_RBTX4927_SETUP_DEBUG
(brace
id|early_read_config_byte
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0x04
comma
op_amp
id|v08_04
)paren
suffix:semicolon
id|early_read_config_byte
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0x09
comma
op_amp
id|v08_09
)paren
suffix:semicolon
id|early_read_config_byte
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0x41
comma
op_amp
id|v08_41
)paren
suffix:semicolon
id|early_read_config_byte
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0x43
comma
op_amp
id|v08_43
)paren
suffix:semicolon
id|early_read_config_byte
c_func
(paren
id|hose
comma
id|busno
comma
id|busno
comma
id|pci_devfn
comma
l_int|0x5c
comma
op_amp
id|v08_5c
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s end 0x04 = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v08_04
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s end 0x09 = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v08_09
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s end 0x41 = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v08_41
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s end 0x43 = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v08_43
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s end 0x5c = 0x%02x&bslash;n&quot;
comma
id|s
comma
id|v08_5c
)paren
suffix:semicolon
)brace
macro_line|#endif
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;:%s end&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
)brace
)brace
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCIBIOS
comma
l_string|&quot;+&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
id|busno
)paren
suffix:semicolon
)brace
r_extern
r_struct
id|resource
id|pci_io_resource
suffix:semicolon
r_extern
r_struct
id|resource
id|pci_mem_resource
suffix:semicolon
DECL|function|tx4927_pci_setup
r_void
id|tx4927_pci_setup
c_func
(paren
r_void
)paren
(brace
r_static
r_int
id|called
op_assign
l_int|0
suffix:semicolon
r_extern
r_int
r_int
id|tx4927_get_mem_size
c_func
(paren
r_void
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI2
comma
l_string|&quot;-&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifndef  TX4927_SUPPORT_PCI_66
r_if
c_cond
(paren
id|tx4927_ccfgptr-&gt;ccfg
op_amp
id|TX4927_CCFG_PCI66
)paren
id|printk
c_func
(paren
l_string|&quot;PCI 66 current unsupported&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
id|mips_memory_upper
op_assign
id|tx4927_get_mem_size
c_func
(paren
)paren
op_lshift
l_int|20
suffix:semicolon
id|mips_memory_upper
op_add_assign
id|KSEG0
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI2
comma
l_string|&quot;0x%08lx=mips_memory_upper&bslash;n&quot;
comma
id|mips_memory_upper
)paren
suffix:semicolon
id|mips_pci_io_base
op_assign
id|TX4927_PCIIO
suffix:semicolon
id|mips_pci_io_size
op_assign
id|TX4927_PCIIO_SIZE
suffix:semicolon
id|mips_pci_mem_base
op_assign
id|TX4927_PCIMEM
suffix:semicolon
id|mips_pci_mem_size
op_assign
id|TX4927_PCIMEM_SIZE
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI2
comma
l_string|&quot;0x%08lx=mips_pci_io_base&bslash;n&quot;
comma
id|mips_pci_io_base
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI2
comma
l_string|&quot;0x%08lx=mips_pci_io_size&bslash;n&quot;
comma
id|mips_pci_io_size
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI2
comma
l_string|&quot;0x%08lx=mips_pci_mem_base&bslash;n&quot;
comma
id|mips_pci_mem_base
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI2
comma
l_string|&quot;0x%08lx=mips_pci_mem_size&bslash;n&quot;
comma
id|mips_pci_mem_size
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI2
comma
l_string|&quot;0x%08lx=pci_io_resource.start&bslash;n&quot;
comma
id|pci_io_resource.start
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI2
comma
l_string|&quot;0x%08lx=pci_io_resource.end&bslash;n&quot;
comma
id|pci_io_resource.end
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI2
comma
l_string|&quot;0x%08lx=pci_mem_resource.start&bslash;n&quot;
comma
id|pci_mem_resource.start
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI2
comma
l_string|&quot;0x%08lx=pci_mem_resource.end&bslash;n&quot;
comma
id|pci_mem_resource.end
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI2
comma
l_string|&quot;0x%08lx=mips_io_port_base&quot;
comma
id|mips_io_port_base
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI2
comma
l_string|&quot;setup pci_io_resource  to 0x%08lx 0x%08lx&bslash;n&quot;
comma
id|pci_io_resource.start
comma
id|pci_io_resource.end
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI2
comma
l_string|&quot;setup pci_mem_resource to 0x%08lx 0x%08lx&bslash;n&quot;
comma
id|pci_mem_resource.start
comma
id|pci_mem_resource.end
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|called
)paren
(brace
id|printk
(paren
l_string|&quot;TX4927 PCIC -- DID:%04x VID:%04x RID:%02x Arbiter:%s&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
(paren
id|tx4927_pcicptr-&gt;pciid
op_rshift
l_int|16
)paren
comma
(paren
r_int
r_int
)paren
(paren
id|tx4927_pcicptr-&gt;pciid
op_amp
l_int|0xffff
)paren
comma
(paren
r_int
r_int
)paren
(paren
id|tx4927_pcicptr-&gt;pciccrev
op_amp
l_int|0xff
)paren
comma
(paren
op_logical_neg
(paren
id|tx4927_ccfgptr
op_member_access_from_pointer
id|ccfg
op_amp
id|TX4927_CCFG_PCIXARB
)paren
)paren
ques
c_cond
l_string|&quot;External&quot;
suffix:colon
l_string|&quot;Internal&quot;
)paren
suffix:semicolon
id|called
op_assign
l_int|1
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;%s PCIC --%s PCICLK:&quot;
comma
id|toshiba_name
comma
(paren
id|tx4927_ccfgptr-&gt;ccfg
op_amp
id|TX4927_CCFG_PCI66
)paren
ques
c_cond
l_string|&quot; PCI66&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tx4927_ccfgptr-&gt;pcfg
op_amp
id|TX4927_PCFG_PCICLKEN_ALL
)paren
(brace
r_int
id|pciclk
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
(paren
r_int
r_int
)paren
id|tx4927_ccfgptr
op_member_access_from_pointer
id|ccfg
op_amp
id|TX4927_CCFG_PCIDIVMODE_MASK
)paren
(brace
r_case
id|TX4927_CCFG_PCIDIVMODE_2_5
suffix:colon
id|pciclk
op_assign
id|tx4927_cpu_clock
op_star
l_int|2
op_div
l_int|5
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TX4927_CCFG_PCIDIVMODE_3
suffix:colon
id|pciclk
op_assign
id|tx4927_cpu_clock
op_div
l_int|3
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TX4927_CCFG_PCIDIVMODE_5
suffix:colon
id|pciclk
op_assign
id|tx4927_cpu_clock
op_div
l_int|5
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TX4927_CCFG_PCIDIVMODE_6
suffix:colon
id|pciclk
op_assign
id|tx4927_cpu_clock
op_div
l_int|6
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;Internal(%dMHz)&quot;
comma
id|pciclk
op_div
l_int|1000000
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|pciclk
op_assign
l_int|0
suffix:semicolon
r_int
id|pciclk_setting
op_assign
op_star
id|tx4927_pci_clk_ptr
suffix:semicolon
r_switch
c_cond
(paren
id|pciclk_setting
op_amp
id|TX4927_PCI_CLK_MASK
)paren
(brace
r_case
id|TX4927_PCI_CLK_33
suffix:colon
id|pciclk
op_assign
l_int|33333333
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TX4927_PCI_CLK_25
suffix:colon
id|pciclk
op_assign
l_int|25000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TX4927_PCI_CLK_66
suffix:colon
id|pciclk
op_assign
l_int|66666666
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TX4927_PCI_CLK_50
suffix:colon
id|pciclk
op_assign
l_int|50000000
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;External(%dMHz)&quot;
comma
id|pciclk
op_div
l_int|1000000
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* GB-&gt;PCI mappings */
id|tx4927_pcicptr-&gt;g2piomask
op_assign
(paren
id|mips_pci_io_size
op_minus
l_int|1
)paren
op_rshift
l_int|4
suffix:semicolon
id|tx4927_pcicptr-&gt;g2piogbase
op_assign
id|mips_pci_io_base
op_or
macro_line|#ifdef __BIG_ENDIAN
id|TX4927_PCIC_G2PIOGBASE_ECHG
macro_line|#else
id|TX4927_PCIC_G2PIOGBASE_BSDIS
macro_line|#endif
suffix:semicolon
id|tx4927_pcicptr-&gt;g2piopbase
op_assign
l_int|0
suffix:semicolon
id|tx4927_pcicptr-&gt;g2pmmask
(braket
l_int|0
)braket
op_assign
(paren
id|mips_pci_mem_size
op_minus
l_int|1
)paren
op_rshift
l_int|4
suffix:semicolon
id|tx4927_pcicptr-&gt;g2pmgbase
(braket
l_int|0
)braket
op_assign
id|mips_pci_mem_base
op_or
macro_line|#ifdef __BIG_ENDIAN
id|TX4927_PCIC_G2PMnGBASE_ECHG
macro_line|#else
id|TX4927_PCIC_G2PMnGBASE_BSDIS
macro_line|#endif
suffix:semicolon
id|tx4927_pcicptr-&gt;g2pmpbase
(braket
l_int|0
)braket
op_assign
id|mips_pci_mem_base
suffix:semicolon
id|tx4927_pcicptr-&gt;g2pmmask
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|tx4927_pcicptr-&gt;g2pmgbase
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|tx4927_pcicptr-&gt;g2pmpbase
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|tx4927_pcicptr-&gt;g2pmmask
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
id|tx4927_pcicptr-&gt;g2pmgbase
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
id|tx4927_pcicptr-&gt;g2pmpbase
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* PCI-&gt;GB mappings (I/O 256B) */
id|tx4927_pcicptr-&gt;p2giopbase
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* 256B */
macro_line|#ifdef TX4927_SUPPORT_COMMAND_IO
id|tx4927_pcicptr-&gt;p2giogbase
op_assign
l_int|0
op_or
id|TX4927_PCIC_P2GIOGBASE_TIOEN
op_or
macro_line|#ifdef __BIG_ENDIAN
id|TX4927_PCIC_P2GIOGBASE_TECHG
macro_line|#else
id|TX4927_PCIC_P2GIOGBASE_TBSDIS
macro_line|#endif
suffix:semicolon
macro_line|#else
id|tx4927_pcicptr-&gt;p2giogbase
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
multiline_comment|/* PCI-&gt;GB mappings (MEM 512MB) M0 gets all of memory */
id|tx4927_pcicptr-&gt;p2gm0plbase
op_assign
l_int|0
suffix:semicolon
id|tx4927_pcicptr-&gt;p2gm0pubase
op_assign
l_int|0
suffix:semicolon
id|tx4927_pcicptr-&gt;p2gmgbase
(braket
l_int|0
)braket
op_assign
l_int|0
op_or
id|TX4927_PCIC_P2GMnGBASE_TMEMEN
op_or
macro_line|#ifdef __BIG_ENDIAN
id|TX4927_PCIC_P2GMnGBASE_TECHG
macro_line|#else
id|TX4927_PCIC_P2GMnGBASE_TBSDIS
macro_line|#endif
suffix:semicolon
multiline_comment|/* PCI-&gt;GB mappings (MEM 16MB) -not used */
id|tx4927_pcicptr-&gt;p2gm1plbase
op_assign
l_int|0xffffffff
suffix:semicolon
macro_line|#ifdef CONFIG_TX4927BUG_WORKAROUND
multiline_comment|/*&n;&t; * TX4927-PCIC-BUG: P2GM1PUBASE must be 0&n;&t; * if P2GM0PUBASE was 0.&n;&t; */
id|tx4927_pcicptr-&gt;p2gm1pubase
op_assign
l_int|0
suffix:semicolon
macro_line|#else
id|tx4927_pcicptr-&gt;p2gm1pubase
op_assign
l_int|0xffffffff
suffix:semicolon
macro_line|#endif
id|tx4927_pcicptr-&gt;p2gmgbase
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* PCI-&gt;GB mappings (MEM 1MB) -not used */
id|tx4927_pcicptr-&gt;p2gm2pbase
op_assign
l_int|0xffffffff
suffix:semicolon
id|tx4927_pcicptr-&gt;p2gmgbase
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Enable Initiator Memory 0 Space, I/O Space, Config */
id|tx4927_pcicptr-&gt;pciccfg
op_and_assign
id|TX4927_PCIC_PCICCFG_LBWC_MASK
suffix:semicolon
id|tx4927_pcicptr-&gt;pciccfg
op_or_assign
id|TX4927_PCIC_PCICCFG_IMSE0
op_or
id|TX4927_PCIC_PCICCFG_IISE
op_or
id|TX4927_PCIC_PCICCFG_ICAE
op_or
id|TX4927_PCIC_PCICCFG_ATR
suffix:semicolon
multiline_comment|/* Do not use MEMMUL, MEMINF: YMFPCI card causes M_ABORT. */
id|tx4927_pcicptr-&gt;pcicfg1
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|tx4927_pcic_trdyto
op_ge
l_int|0
)paren
(brace
id|tx4927_pcicptr-&gt;g2ptocnt
op_and_assign
op_complement
l_int|0xff
suffix:semicolon
id|tx4927_pcicptr-&gt;g2ptocnt
op_or_assign
(paren
id|tx4927_pcic_trdyto
op_amp
l_int|0xff
)paren
suffix:semicolon
singleline_comment|//printk(&quot;%s PCIC -- TRDYTO:%02lx&bslash;n&quot;,toshiba_name,
singleline_comment|//      tx4927_pcicptr-&gt;g2ptocnt &amp; 0xff);
)brace
multiline_comment|/* Clear All Local Bus Status */
id|tx4927_pcicptr-&gt;pcicstatus
op_assign
id|TX4927_PCIC_PCICSTATUS_ALL
suffix:semicolon
multiline_comment|/* Enable All Local Bus Interrupts */
id|tx4927_pcicptr-&gt;pcicmask
op_assign
id|TX4927_PCIC_PCICSTATUS_ALL
suffix:semicolon
multiline_comment|/* Clear All Initiator Status */
id|tx4927_pcicptr-&gt;g2pstatus
op_assign
id|TX4927_PCIC_G2PSTATUS_ALL
suffix:semicolon
multiline_comment|/* Enable All Initiator Interrupts */
id|tx4927_pcicptr-&gt;g2pmask
op_assign
id|TX4927_PCIC_G2PSTATUS_ALL
suffix:semicolon
multiline_comment|/* Clear All PCI Status Error */
id|tx4927_pcicptr-&gt;pcistatus
op_assign
(paren
id|tx4927_pcicptr-&gt;pcistatus
op_amp
l_int|0x0000ffff
)paren
op_or
(paren
id|TX4927_PCIC_PCISTATUS_ALL
op_lshift
l_int|16
)paren
suffix:semicolon
multiline_comment|/* Enable All PCI Status Error Interrupts */
id|tx4927_pcicptr-&gt;pcimask
op_assign
id|TX4927_PCIC_PCISTATUS_ALL
suffix:semicolon
multiline_comment|/* PCIC Int =&gt; IRC IRQ16 */
id|tx4927_pcicptr-&gt;pcicfg2
op_assign
(paren
id|tx4927_pcicptr-&gt;pcicfg2
op_amp
l_int|0xffffff00
)paren
op_or
id|TX4927_IR_PCIC
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|tx4927_ccfgptr-&gt;ccfg
op_amp
id|TX4927_CCFG_PCIXARB
)paren
)paren
(brace
multiline_comment|/* XXX */
)brace
r_else
(brace
multiline_comment|/* Reset Bus Arbiter */
id|tx4927_pcicptr-&gt;pbacfg
op_assign
id|TX4927_PCIC_PBACFG_RPBA
suffix:semicolon
multiline_comment|/* Enable Bus Arbiter */
id|tx4927_pcicptr-&gt;pbacfg
op_assign
id|TX4927_PCIC_PBACFG_PBAEN
suffix:semicolon
)brace
id|tx4927_pcicptr-&gt;pcistatus
op_assign
id|PCI_COMMAND_MASTER
op_or
id|PCI_COMMAND_MEMORY
op_or
macro_line|#ifdef TX4927_SUPPORT_COMMAND_IO
id|PCI_COMMAND_IO
op_or
macro_line|#endif
id|PCI_COMMAND_PARITY
op_or
id|PCI_COMMAND_SERR
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI2
comma
l_string|&quot;:pci setup complete:&bslash;n&quot;
)paren
suffix:semicolon
singleline_comment|//tx4927_dump_pcic_settings();
(brace
r_struct
id|pci_channel
op_star
id|p
suffix:semicolon
r_int
id|busno
suffix:semicolon
id|busno
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|mips_pci_channels
suffix:semicolon
id|p-&gt;pci_ops
op_ne
l_int|NULL
suffix:semicolon
id|p
op_increment
)paren
(brace
id|busno
op_assign
id|tx4927_pcibios_init
c_func
(paren
id|busno
comma
id|p
)paren
op_plus
l_int|1
suffix:semicolon
)brace
)brace
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI2
comma
l_string|&quot;+&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PCI */
DECL|function|toshiba_rbtx4927_restart
r_void
id|toshiba_rbtx4927_restart
c_func
(paren
r_char
op_star
id|command
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;System Rebooting...&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* enable the s/w reset register */
id|reg_wr08
c_func
(paren
id|RBTX4927_SW_RESET_ENABLE
comma
id|RBTX4927_SW_RESET_ENABLE_SET
)paren
suffix:semicolon
multiline_comment|/* wait for enable to be seen */
r_while
c_loop
(paren
(paren
id|reg_rd08
c_func
(paren
id|RBTX4927_SW_RESET_ENABLE
)paren
op_amp
id|RBTX4927_SW_RESET_ENABLE_SET
)paren
op_eq
l_int|0x00
)paren
suffix:semicolon
multiline_comment|/* do a s/w reset */
id|reg_wr08
c_func
(paren
id|RBTX4927_SW_RESET_DO
comma
id|RBTX4927_SW_RESET_DO_SET
)paren
suffix:semicolon
multiline_comment|/* do something passive while waiting for reset */
id|cli
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
id|asm_wait
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* no return */
)brace
DECL|function|toshiba_rbtx4927_halt
r_void
id|toshiba_rbtx4927_halt
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;System Halted&bslash;n&quot;
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|asm_wait
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* no return */
)brace
DECL|function|toshiba_rbtx4927_power_off
r_void
id|toshiba_rbtx4927_power_off
c_func
(paren
r_void
)paren
(brace
id|toshiba_rbtx4927_halt
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* no return */
)brace
DECL|function|toshiba_rbtx4927_setup
r_void
id|__init
id|toshiba_rbtx4927_setup
c_func
(paren
r_void
)paren
(brace
id|vu32
id|cp0_config
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;CPU is %s&bslash;n&quot;
comma
id|toshiba_name
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;-&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* f/w leaves this on at startup */
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;:Clearing STO_ERL.&bslash;n&quot;
)paren
suffix:semicolon
id|clear_c0_status
c_func
(paren
id|ST0_ERL
)paren
suffix:semicolon
multiline_comment|/* enable caches -- HCP5 does this, pmon does not */
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;:Enabling TX49_CONF_IC,TX49_CONF_DC.&bslash;n&quot;
)paren
suffix:semicolon
id|cp0_config
op_assign
id|read_c0_config
c_func
(paren
)paren
suffix:semicolon
id|cp0_config
op_assign
id|cp0_config
op_amp
op_complement
(paren
id|TX49_CONF_IC
op_or
id|TX49_CONF_DC
)paren
suffix:semicolon
id|write_c0_config
c_func
(paren
id|cp0_config
)paren
suffix:semicolon
macro_line|#ifdef TOSHIBA_RBTX4927_SETUP_DEBUG
(brace
r_extern
r_void
id|dump_cp0
c_func
(paren
r_char
op_star
)paren
suffix:semicolon
id|dump_cp0
c_func
(paren
l_string|&quot;toshiba_rbtx4927_early_fw_fixup&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* setup irq stuff */
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;:Setting up tx4927 pic.&bslash;n&quot;
)paren
suffix:semicolon
id|TX4927_WR
c_func
(paren
l_int|0xff1ff604
comma
l_int|0x00000400
)paren
suffix:semicolon
multiline_comment|/* irq trigger */
id|TX4927_WR
c_func
(paren
l_int|0xff1ff608
comma
l_int|0x00000000
)paren
suffix:semicolon
multiline_comment|/* irq trigger */
multiline_comment|/* setup serial stuff */
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;:Setting up tx4927 sio.&bslash;n&quot;
)paren
suffix:semicolon
id|TX4927_WR
c_func
(paren
l_int|0xff1ff314
comma
l_int|0x00000000
)paren
suffix:semicolon
multiline_comment|/* h/w flow control off */
id|TX4927_WR
c_func
(paren
l_int|0xff1ff414
comma
l_int|0x00000000
)paren
suffix:semicolon
multiline_comment|/* h/w flow control off */
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;+&bslash;n&quot;
)paren
suffix:semicolon
id|mips_io_port_base
op_assign
id|KSEG1
op_plus
id|TBTX4927_ISA_IO_OFFSET
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;:mips_io_port_base=0x%08lx&bslash;n&quot;
comma
id|mips_io_port_base
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;:Resource&bslash;n&quot;
)paren
suffix:semicolon
id|ioport_resource.start
op_assign
l_int|0
suffix:semicolon
id|ioport_resource.end
op_assign
l_int|0xffffffff
suffix:semicolon
id|iomem_resource.start
op_assign
l_int|0
suffix:semicolon
id|iomem_resource.end
op_assign
l_int|0xffffffff
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;:ResetRoutines&bslash;n&quot;
)paren
suffix:semicolon
id|_machine_restart
op_assign
id|toshiba_rbtx4927_restart
suffix:semicolon
id|_machine_halt
op_assign
id|toshiba_rbtx4927_halt
suffix:semicolon
id|_machine_power_off
op_assign
id|toshiba_rbtx4927_power_off
suffix:semicolon
macro_line|#ifdef CONFIG_BLK_DEV_IDEPCI
(brace
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;:ide_ops=&amp;std_ide_ops(modified)&bslash;n&quot;
)paren
suffix:semicolon
id|ide_ops
op_assign
op_amp
id|std_ide_ops
suffix:semicolon
)brace
macro_line|#else
(brace
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;:ide_ops=&lt;NOT_CONFIG&gt;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_FB
(brace
id|conswitchp
op_assign
op_amp
id|dummy_con
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_PCI
multiline_comment|/* PCIC */
multiline_comment|/*&n;&t;   * ASSUMPTION: PCIDIVMODE is configured for PCI 33MHz or 66MHz.&n;&t;   * PCIDIVMODE[12:11]&squot;s initial value are given by S9[4:3] (ON:0, OFF:1).&n;&t;   * CPU 166MHz: PCI 66MHz : PCIDIVMODE: 00 (1/2.5)&n;&t;   * CPU 200MHz: PCI 66MHz : PCIDIVMODE: 01 (1/3)&n;&t;   * CPU 166MHz: PCI 33MHz : PCIDIVMODE: 10 (1/5)&n;&t;   * CPU 200MHz: PCI 33MHz : PCIDIVMODE: 11 (1/6)&n;&t;   * i.e. S9[3]: ON (83MHz), OFF (100MHz)&n;&t; */
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI1
comma
l_string|&quot;ccfg is %lx, DIV is %x&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|tx4927_ccfgptr
op_member_access_from_pointer
id|ccfg
comma
id|TX4927_CCFG_PCIDIVMODE_MASK
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI1
comma
l_string|&quot;PCI66 mode is %lx, PCI mode is %lx, pci arb is %lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|tx4927_ccfgptr
op_member_access_from_pointer
id|ccfg
op_amp
id|TX4927_CCFG_PCI66
comma
(paren
r_int
r_int
)paren
id|tx4927_ccfgptr
op_member_access_from_pointer
id|ccfg
op_amp
id|TX4927_CCFG_PCIMIDE
comma
(paren
r_int
r_int
)paren
id|tx4927_ccfgptr
op_member_access_from_pointer
id|ccfg
op_amp
id|TX4927_CCFG_PCIXARB
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_PCI1
comma
l_string|&quot;PCIDIVMODE is %lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|tx4927_ccfgptr
op_member_access_from_pointer
id|ccfg
op_amp
id|TX4927_CCFG_PCIDIVMODE_MASK
)paren
suffix:semicolon
r_switch
c_cond
(paren
(paren
r_int
r_int
)paren
id|tx4927_ccfgptr
op_member_access_from_pointer
id|ccfg
op_amp
id|TX4927_CCFG_PCIDIVMODE_MASK
)paren
(brace
r_case
id|TX4927_CCFG_PCIDIVMODE_2_5
suffix:colon
r_case
id|TX4927_CCFG_PCIDIVMODE_5
suffix:colon
id|tx4927_cpu_clock
op_assign
l_int|166000000
suffix:semicolon
multiline_comment|/* 166MHz */
r_break
suffix:semicolon
r_default
suffix:colon
id|tx4927_cpu_clock
op_assign
l_int|200000000
suffix:semicolon
multiline_comment|/* 200MHz */
)brace
multiline_comment|/* CCFG */
multiline_comment|/* enable Timeout BusError */
r_if
c_cond
(paren
id|tx4927_ccfg_toeon
)paren
id|tx4927_ccfgptr-&gt;ccfg
op_or_assign
id|TX4927_CCFG_TOE
suffix:semicolon
multiline_comment|/* SDRAMC fixup */
macro_line|#ifdef CONFIG_TX4927BUG_WORKAROUND
multiline_comment|/*&n;&t; * TX4927-BUG: INF 01-01-18/ BUG 01-01-22&n;&t; * G-bus timeout error detection is incorrect&n;&t; */
r_if
c_cond
(paren
id|tx4927_ccfg_toeon
)paren
id|tx4927_sdramcptr-&gt;tr
op_or_assign
l_int|0x02000000
suffix:semicolon
multiline_comment|/* RCD:3tck */
macro_line|#endif
macro_line|#ifdef  TX4927_SUPPORT_PCI_66
id|tx4927_pci66_setup
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
id|tx4927_pci_setup
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
(brace
id|u32
id|id
op_assign
l_int|0
suffix:semicolon
id|early_read_config_dword
c_func
(paren
op_amp
id|mips_pci_channels
(braket
l_int|0
)braket
comma
l_int|0
comma
l_int|0
comma
l_int|0x90
comma
id|PCI_VENDOR_ID
comma
op_amp
id|id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|id
op_eq
l_int|0x94601055
)paren
(brace
id|tx4927_using_backplane
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;backplane board IS installed&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;backplane board NOT installed&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* this is only done if backplane board installed, so must wait for pci */
macro_line|#ifdef CONFIG_PC_KEYB
(brace
r_if
c_cond
(paren
id|tx4927_using_backplane
)paren
(brace
r_extern
r_struct
id|kbd_ops
id|std_kbd_ops
suffix:semicolon
id|kbd_ops
op_assign
op_amp
id|std_kbd_ops
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;:kbd_ops=&amp;std_kbd_ops&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;:kbd_ops=&lt;NO_BACKPLANE&gt;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
macro_line|#else
(brace
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;:kbd_ops=&lt;NOT_CONFIG&gt;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* this is on ISA bus behind PCI bus, so need PCI up first */
macro_line|#ifdef CONFIG_TOSHIBA_FPCIB0
(brace
r_if
c_cond
(paren
id|tx4927_using_backplane
)paren
(brace
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;:fpcibo=yes&bslash;n&quot;
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;:smsc_fdc37m81x_init()&bslash;n&quot;
)paren
suffix:semicolon
id|smsc_fdc37m81x_init
c_func
(paren
l_int|0x3f0
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;:smsc_fdc37m81x_config_beg()&bslash;n&quot;
)paren
suffix:semicolon
id|smsc_fdc37m81x_config_beg
c_func
(paren
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;:smsc_fdc37m81x_config_set(KBD)&bslash;n&quot;
)paren
suffix:semicolon
id|smsc_fdc37m81x_config_set
c_func
(paren
id|SMSC_FDC37M81X_DNUM
comma
id|SMSC_FDC37M81X_KBD
)paren
suffix:semicolon
id|smsc_fdc37m81x_config_set
c_func
(paren
id|SMSC_FDC37M81X_INT
comma
l_int|1
)paren
suffix:semicolon
id|smsc_fdc37m81x_config_set
c_func
(paren
id|SMSC_FDC37M81X_INT2
comma
l_int|12
)paren
suffix:semicolon
id|smsc_fdc37m81x_config_set
c_func
(paren
id|SMSC_FDC37M81X_ACTIVE
comma
l_int|1
)paren
suffix:semicolon
id|smsc_fdc37m81x_config_end
c_func
(paren
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;:smsc_fdc37m81x_config_end()&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;:fpcibo=not_found&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
macro_line|#else
(brace
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;:fpcibo=no&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_SETUP
comma
l_string|&quot;+&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_void
id|__init
DECL|function|toshiba_rbtx4927_time_init
id|toshiba_rbtx4927_time_init
c_func
(paren
r_void
)paren
(brace
id|u32
id|c1
suffix:semicolon
id|u32
id|c2
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_TIME_INIT
comma
l_string|&quot;-&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_RTC_DS1742
id|rtc_get_time
op_assign
id|rtc_ds1742_get_time
suffix:semicolon
id|rtc_set_time
op_assign
id|rtc_ds1742_set_time
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_TIME_INIT
comma
l_string|&quot;:rtc_ds1742_init()-&bslash;n&quot;
)paren
suffix:semicolon
id|rtc_ds1742_init
c_func
(paren
l_int|0xbc010000
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_TIME_INIT
comma
l_string|&quot;:rtc_ds1742_init()+&bslash;n&quot;
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_TIME_INIT
comma
l_string|&quot;:Calibrate mips_counter_frequency-&bslash;n&quot;
)paren
suffix:semicolon
id|rtc_ds1742_wait
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* get the count */
id|c1
op_assign
id|read_c0_count
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* wait for the seconds to change again */
id|rtc_ds1742_wait
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* get the count again */
id|c2
op_assign
id|read_c0_count
c_func
(paren
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_TIME_INIT
comma
l_string|&quot;:Calibrate mips_counter_frequency+&bslash;n&quot;
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_TIME_INIT
comma
l_string|&quot;:c1=%12u&bslash;n&quot;
comma
id|c1
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_TIME_INIT
comma
l_string|&quot;:c2=%12u&bslash;n&quot;
comma
id|c2
)paren
suffix:semicolon
multiline_comment|/* this diff is as close as we are going to get to counter ticks per sec */
id|mips_counter_frequency
op_assign
id|abs
c_func
(paren
id|c2
op_minus
id|c1
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_TIME_INIT
comma
l_string|&quot;:f1=%12u&bslash;n&quot;
comma
id|mips_counter_frequency
)paren
suffix:semicolon
multiline_comment|/* round to 1/10th of a MHz */
id|mips_counter_frequency
op_div_assign
(paren
l_int|100
op_star
l_int|1000
)paren
suffix:semicolon
id|mips_counter_frequency
op_mul_assign
(paren
l_int|100
op_star
l_int|1000
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_TIME_INIT
comma
l_string|&quot;:f2=%12u&bslash;n&quot;
comma
id|mips_counter_frequency
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_INFO
comma
l_string|&quot;:mips_counter_frequency=%uHz (%uMHz)&bslash;n&quot;
comma
id|mips_counter_frequency
comma
id|mips_counter_frequency
op_div
l_int|1000000
)paren
suffix:semicolon
macro_line|#else
id|mips_counter_frequency
op_assign
l_int|100000000
suffix:semicolon
macro_line|#endif
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_TIME_INIT
comma
l_string|&quot;+&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|toshiba_rbtx4927_timer_setup
r_void
id|__init
id|toshiba_rbtx4927_timer_setup
c_func
(paren
r_struct
id|irqaction
op_star
id|irq
)paren
(brace
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_TIMER_SETUP
comma
l_string|&quot;-&bslash;n&quot;
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_SETUP_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_SETUP_TIMER_SETUP
comma
l_string|&quot;+&bslash;n&quot;
)paren
suffix:semicolon
)brace
eof
