multiline_comment|/*&n; * linux/arch/mips/tx4927/toshiba_rbtx4927/toshiba_rbtx4927_irq.c&n; *&n; * Toshiba RBTX4927 specific interrupt handlers&n; *&n; * Author: MontaVista Software, Inc.&n; *         source@mvista.com&n; *&n; * Copyright 2001-2002 MontaVista Software Inc.&n; *&n; *  This program is free software; you can redistribute it and/or modify it&n; *  under the terms of the GNU General Public License as published by the&n; *  Free Software Foundation; either version 2 of the License, or (at your&n; *  option) any later version.&n; *&n; *  THIS SOFTWARE IS PROVIDED ``AS IS&squot;&squot; AND ANY EXPRESS OR IMPLIED&n; *  WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF&n; *  MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.&n; *  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,&n; *  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,&n; *  BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS&n; *  OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND&n; *  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR&n; *  TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE&n; *  USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.&n; *&n; *  You should have received a copy of the GNU General Public License along&n; *  with this program; if not, write to the Free Software Foundation, Inc.,&n; *  675 Mass Ave, Cambridge, MA 02139, USA.&n; */
multiline_comment|/*&n;IRQ  Device  &n;00   RBTX4927-ISA/00&n;01   RBTX4927-ISA/01 PS2/Keyboard&n;02   RBTX4927-ISA/02 Cascade RBTX4927-ISA (irqs 8-15)&n;03   RBTX4927-ISA/03&n;04   RBTX4927-ISA/04&n;05   RBTX4927-ISA/05&n;06   RBTX4927-ISA/06&n;07   RBTX4927-ISA/07&n;08   RBTX4927-ISA/08&n;09   RBTX4927-ISA/09&n;10   RBTX4927-ISA/10&n;11   RBTX4927-ISA/11&n;12   RBTX4927-ISA/12 PS2/Mouse (not supported at this time)&n;13   RBTX4927-ISA/13&n;14   RBTX4927-ISA/14 IDE&n;15   RBTX4927-ISA/15&n;&n;16   TX4927-CP0/00 Software 0&n;17   TX4927-CP0/01 Software 1&n;18   TX4927-CP0/02 Cascade TX4927-CP0&n;19   TX4927-CP0/03 Multiplexed -- do not use &n;20   TX4927-CP0/04 Multiplexed -- do not use &n;21   TX4927-CP0/05 Multiplexed -- do not use &n;22   TX4927-CP0/06 Multiplexed -- do not use &n;23   TX4927-CP0/07 CPU TIMER&n;&n;24   TX4927-PIC/00&n;25   TX4927-PIC/01&n;26   TX4927-PIC/02  &n;27   TX4927-PIC/03 Cascade RBTX4927-IOC&n;28   TX4927-PIC/04&n;29   TX4927-PIC/05 RBTX4927 RTL-8019AS ethernet&n;30   TX4927-PIC/06&n;31   TX4927-PIC/07&n;32   TX4927-PIC/08 TX4927 SerialIO Channel 0&n;33   TX4927-PIC/09 TX4927 SerialIO Channel 1&n;34   TX4927-PIC/10&n;35   TX4927-PIC/11&n;36   TX4927-PIC/12&n;37   TX4927-PIC/13&n;38   TX4927-PIC/14&n;39   TX4927-PIC/15&n;40   TX4927-PIC/16 TX4927 PCI PCI-C&n;41   TX4927-PIC/17&n;42   TX4927-PIC/18&n;43   TX4927-PIC/19&n;44   TX4927-PIC/20&n;45   TX4927-PIC/21&n;46   TX4927-PIC/22 TX4927 PCI PCI-ERR &n;47   TX4927-PIC/23 TX4927 PCI PCI-PMA (not used)&n;48   TX4927-PIC/24&n;49   TX4927-PIC/25&n;50   TX4927-PIC/26&n;51   TX4927-PIC/27&n;52   TX4927-PIC/28&n;53   TX4927-PIC/29&n;54   TX4927-PIC/30&n;55   TX4927-PIC/31&n;&n;56 RBTX4927-IOC/00 FPCIB0 PCI-D PJ4/A PJ5/B SB/C PJ6/D PJ7/A (SouthBridge/NotUsed)        [RTL-8139=PJ4]&n;57 RBTX4927-IOC/01 FPCIB0 PCI-C PJ4/D PJ5/A SB/B PJ6/C PJ7/D (SouthBridge/NotUsed)        [RTL-8139=PJ5]&n;58 RBTX4927-IOC/02 FPCIB0 PCI-B PJ4/C PJ5/D SB/A PJ6/B PJ7/C (SouthBridge/IDE/pin=1,INTR) [RTL-8139=NotSupported]&n;59 RBTX4927-IOC/03 FPCIB0 PCI-A PJ4/B PJ5/C SB/D PJ6/A PJ7/B (SouthBridge/USB/pin=4)      [RTL-8139=PJ6]&n;60 RBTX4927-IOC/04&n;61 RBTX4927-IOC/05&n;62 RBTX4927-IOC/06&n;63 RBTX4927-IOC/07&n;&n;NOTES: &n;SouthBridge/INTR is mapped to SouthBridge/A=PCI-B/#58&n;SouthBridge/ISA/pin=0 no pci irq used by this device&n;SouthBridge/IDE/pin=1 no pci irq used by this device, using INTR via ISA IRQ14&n;SouthBridge/USB/pin=4 using pci irq SouthBridge/D=PCI-A=#59&n;SouthBridge/PMC/pin=0 no pci irq used by this device&n;SuperIO/PS2/Keyboard, using INTR via ISA IRQ1&n;SuperIO/PS2/Mouse, using INTR via ISA IRQ12 (mouse not currently supported)&n;JP7 is not bus master -- do NOT use -- only 4 pci bus master&squot;s allowed -- SouthBridge, JP4, JP5, JP6&n;*/
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/swap.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/timex.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/pci.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/reboot.h&gt;
macro_line|#include &lt;asm/time.h&gt;
macro_line|#include &lt;linux/bootmem.h&gt;
macro_line|#include &lt;linux/blkdev.h&gt;
macro_line|#ifdef CONFIG_RTC_DS1742
macro_line|#include &lt;linux/ds1742rtc.h&gt;
macro_line|#endif
macro_line|#ifdef CONFIG_TOSHIBA_FPCIB0
macro_line|#include &lt;asm/tx4927/smsc_fdc37m81x.h&gt;
macro_line|#endif
macro_line|#include &lt;asm/tx4927/toshiba_rbtx4927.h&gt;
DECL|macro|TOSHIBA_RBTX4927_IRQ_DEBUG
macro_line|#undef TOSHIBA_RBTX4927_IRQ_DEBUG
macro_line|#ifdef TOSHIBA_RBTX4927_IRQ_DEBUG
DECL|macro|TOSHIBA_RBTX4927_IRQ_NONE
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_NONE        0x00000000
DECL|macro|TOSHIBA_RBTX4927_IRQ_INFO
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_INFO          ( 1 &lt;&lt;  0 )
DECL|macro|TOSHIBA_RBTX4927_IRQ_WARN
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_WARN          ( 1 &lt;&lt;  1 )
DECL|macro|TOSHIBA_RBTX4927_IRQ_EROR
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_EROR          ( 1 &lt;&lt;  2 )
DECL|macro|TOSHIBA_RBTX4927_IRQ_IOC_INIT
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_IOC_INIT      ( 1 &lt;&lt; 10 )
DECL|macro|TOSHIBA_RBTX4927_IRQ_IOC_STARTUP
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_IOC_STARTUP   ( 1 &lt;&lt; 11 )
DECL|macro|TOSHIBA_RBTX4927_IRQ_IOC_SHUTDOWN
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_IOC_SHUTDOWN  ( 1 &lt;&lt; 12 )
DECL|macro|TOSHIBA_RBTX4927_IRQ_IOC_ENABLE
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_IOC_ENABLE    ( 1 &lt;&lt; 13 )
DECL|macro|TOSHIBA_RBTX4927_IRQ_IOC_DISABLE
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_IOC_DISABLE   ( 1 &lt;&lt; 14 )
DECL|macro|TOSHIBA_RBTX4927_IRQ_IOC_MASK
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_IOC_MASK      ( 1 &lt;&lt; 15 )
DECL|macro|TOSHIBA_RBTX4927_IRQ_IOC_ENDIRQ
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_IOC_ENDIRQ    ( 1 &lt;&lt; 16 )
DECL|macro|TOSHIBA_RBTX4927_IRQ_ISA_INIT
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_ISA_INIT      ( 1 &lt;&lt; 20 )
DECL|macro|TOSHIBA_RBTX4927_IRQ_ISA_STARTUP
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_ISA_STARTUP   ( 1 &lt;&lt; 21 )
DECL|macro|TOSHIBA_RBTX4927_IRQ_ISA_SHUTDOWN
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_ISA_SHUTDOWN  ( 1 &lt;&lt; 22 )
DECL|macro|TOSHIBA_RBTX4927_IRQ_ISA_ENABLE
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_ISA_ENABLE    ( 1 &lt;&lt; 23 )
DECL|macro|TOSHIBA_RBTX4927_IRQ_ISA_DISABLE
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_ISA_DISABLE   ( 1 &lt;&lt; 24 )
DECL|macro|TOSHIBA_RBTX4927_IRQ_ISA_MASK
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_ISA_MASK      ( 1 &lt;&lt; 25 )
DECL|macro|TOSHIBA_RBTX4927_IRQ_ISA_ENDIRQ
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_ISA_ENDIRQ    ( 1 &lt;&lt; 26 )
DECL|macro|TOSHIBA_RBTX4927_SETUP_ALL
mdefine_line|#define TOSHIBA_RBTX4927_SETUP_ALL         0xffffffff
macro_line|#endif
macro_line|#ifdef TOSHIBA_RBTX4927_IRQ_DEBUG
DECL|variable|toshiba_rbtx4927_irq_debug_flag
r_static
r_const
id|u32
id|toshiba_rbtx4927_irq_debug_flag
op_assign
(paren
id|TOSHIBA_RBTX4927_IRQ_NONE
op_or
id|TOSHIBA_RBTX4927_IRQ_INFO
op_or
id|TOSHIBA_RBTX4927_IRQ_WARN
op_or
id|TOSHIBA_RBTX4927_IRQ_EROR
singleline_comment|//                                                 | TOSHIBA_RBTX4927_IRQ_IOC_INIT  
singleline_comment|//                                                 | TOSHIBA_RBTX4927_IRQ_IOC_STARTUP  
singleline_comment|//                                                 | TOSHIBA_RBTX4927_IRQ_IOC_SHUTDOWN  
singleline_comment|//                                                 | TOSHIBA_RBTX4927_IRQ_IOC_ENABLE  
singleline_comment|//                                                 | TOSHIBA_RBTX4927_IRQ_IOC_DISABLE  
singleline_comment|//                                                 | TOSHIBA_RBTX4927_IRQ_IOC_MASK  
singleline_comment|//                                                 | TOSHIBA_RBTX4927_IRQ_IOC_ENDIRQ  
singleline_comment|//                                                 | TOSHIBA_RBTX4927_IRQ_ISA_INIT  
singleline_comment|//                                                 | TOSHIBA_RBTX4927_IRQ_ISA_STARTUP  
singleline_comment|//                                                 | TOSHIBA_RBTX4927_IRQ_ISA_SHUTDOWN  
singleline_comment|//                                                 | TOSHIBA_RBTX4927_IRQ_ISA_ENABLE  
singleline_comment|//                                                 | TOSHIBA_RBTX4927_IRQ_ISA_DISABLE  
singleline_comment|//                                                 | TOSHIBA_RBTX4927_IRQ_ISA_MASK  
singleline_comment|//                                                 | TOSHIBA_RBTX4927_IRQ_ISA_ENDIRQ
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef TOSHIBA_RBTX4927_IRQ_DEBUG
DECL|macro|TOSHIBA_RBTX4927_IRQ_DPRINTK
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_DPRINTK(flag,str...) &bslash;&n;        if ( (toshiba_rbtx4927_irq_debug_flag) &amp; (flag) ) &bslash;&n;        { &bslash;&n;           char tmp[100]; &bslash;&n;           sprintf( tmp, str ); &bslash;&n;           printk( &quot;%s(%s:%u)::%s&quot;, __FUNCTION__, __FILE__, __LINE__, tmp ); &bslash;&n;        }
macro_line|#else
DECL|macro|TOSHIBA_RBTX4927_IRQ_DPRINTK
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_DPRINTK(flag,str...)
macro_line|#endif
DECL|macro|TOSHIBA_RBTX4927_IRQ_IOC_RAW_BEG
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_IOC_RAW_BEG   0
DECL|macro|TOSHIBA_RBTX4927_IRQ_IOC_RAW_END
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_IOC_RAW_END   7
DECL|macro|TOSHIBA_RBTX4927_IRQ_IOC_BEG
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_IOC_BEG  ((TX4927_IRQ_PIC_END+1)+TOSHIBA_RBTX4927_IRQ_IOC_RAW_BEG)&t;/* 56 */
DECL|macro|TOSHIBA_RBTX4927_IRQ_IOC_END
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_IOC_END  ((TX4927_IRQ_PIC_END+1)+TOSHIBA_RBTX4927_IRQ_IOC_RAW_END)&t;/* 63 */
DECL|macro|TOSHIBA_RBTX4927_IRQ_ISA_BEG
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_ISA_BEG MI8259_IRQ_ISA_BEG
DECL|macro|TOSHIBA_RBTX4927_IRQ_ISA_END
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_ISA_END MI8259_IRQ_ISA_END
DECL|macro|TOSHIBA_RBTX4927_IRQ_ISA_MID
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_ISA_MID ((TOSHIBA_RBTX4927_IRQ_ISA_BEG+TOSHIBA_RBTX4927_IRQ_ISA_END+1)/2)
DECL|macro|TOSHIBA_RBTX4927_IRQ_NEST_IOC_ON_PIC
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_NEST_IOC_ON_PIC TX4927_IRQ_NEST_EXT_ON_PIC
DECL|macro|TOSHIBA_RBTX4927_IRQ_NEST_ISA_ON_IOC
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_NEST_ISA_ON_IOC (TOSHIBA_RBTX4927_IRQ_IOC_BEG+2)
DECL|macro|TOSHIBA_RBTX4927_IRQ_NEST_ISA_ON_ISA
mdefine_line|#define TOSHIBA_RBTX4927_IRQ_NEST_ISA_ON_ISA (TOSHIBA_RBTX4927_IRQ_ISA_BEG+2)
r_extern
r_int
id|tx4927_using_backplane
suffix:semicolon
macro_line|#ifdef CONFIG_TOSHIBA_FPCIB0
r_extern
r_void
id|enable_8259A_irq
c_func
(paren
r_int
r_int
id|irq
)paren
suffix:semicolon
r_extern
r_void
id|disable_8259A_irq
c_func
(paren
r_int
r_int
id|irq
)paren
suffix:semicolon
r_extern
r_void
id|mask_and_ack_8259A
c_func
(paren
r_int
r_int
id|irq
)paren
suffix:semicolon
macro_line|#endif
r_static
r_int
r_int
id|toshiba_rbtx4927_irq_ioc_startup
c_func
(paren
r_int
r_int
id|irq
)paren
suffix:semicolon
r_static
r_void
id|toshiba_rbtx4927_irq_ioc_shutdown
c_func
(paren
r_int
r_int
id|irq
)paren
suffix:semicolon
r_static
r_void
id|toshiba_rbtx4927_irq_ioc_enable
c_func
(paren
r_int
r_int
id|irq
)paren
suffix:semicolon
r_static
r_void
id|toshiba_rbtx4927_irq_ioc_disable
c_func
(paren
r_int
r_int
id|irq
)paren
suffix:semicolon
r_static
r_void
id|toshiba_rbtx4927_irq_ioc_mask_and_ack
c_func
(paren
r_int
r_int
id|irq
)paren
suffix:semicolon
r_static
r_void
id|toshiba_rbtx4927_irq_ioc_end
c_func
(paren
r_int
r_int
id|irq
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_TOSHIBA_FPCIB0
r_static
r_int
r_int
id|toshiba_rbtx4927_irq_isa_startup
c_func
(paren
r_int
r_int
id|irq
)paren
suffix:semicolon
r_static
r_void
id|toshiba_rbtx4927_irq_isa_shutdown
c_func
(paren
r_int
r_int
id|irq
)paren
suffix:semicolon
r_static
r_void
id|toshiba_rbtx4927_irq_isa_enable
c_func
(paren
r_int
r_int
id|irq
)paren
suffix:semicolon
r_static
r_void
id|toshiba_rbtx4927_irq_isa_disable
c_func
(paren
r_int
r_int
id|irq
)paren
suffix:semicolon
r_static
r_void
id|toshiba_rbtx4927_irq_isa_mask_and_ack
c_func
(paren
r_int
r_int
id|irq
)paren
suffix:semicolon
r_static
r_void
id|toshiba_rbtx4927_irq_isa_end
c_func
(paren
r_int
r_int
id|irq
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|toshiba_rbtx4927_ioc_lock
r_static
id|spinlock_t
id|toshiba_rbtx4927_ioc_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|macro|TOSHIBA_RBTX4927_IOC_NAME
mdefine_line|#define TOSHIBA_RBTX4927_IOC_NAME &quot;RBTX4927-IOC&quot;
DECL|variable|toshiba_rbtx4927_irq_ioc_type
r_static
r_struct
id|hw_interrupt_type
id|toshiba_rbtx4927_irq_ioc_type
op_assign
(brace
dot
r_typename
op_assign
id|TOSHIBA_RBTX4927_IOC_NAME
comma
dot
id|startup
op_assign
id|toshiba_rbtx4927_irq_ioc_startup
comma
dot
id|shutdown
op_assign
id|toshiba_rbtx4927_irq_ioc_shutdown
comma
dot
id|enable
op_assign
id|toshiba_rbtx4927_irq_ioc_enable
comma
dot
id|disable
op_assign
id|toshiba_rbtx4927_irq_ioc_disable
comma
dot
id|ack
op_assign
id|toshiba_rbtx4927_irq_ioc_mask_and_ack
comma
dot
id|end
op_assign
id|toshiba_rbtx4927_irq_ioc_end
comma
dot
id|set_affinity
op_assign
l_int|NULL
)brace
suffix:semicolon
DECL|macro|TOSHIBA_RBTX4927_IOC_INTR_ENAB
mdefine_line|#define TOSHIBA_RBTX4927_IOC_INTR_ENAB 0xbc002000
DECL|macro|TOSHIBA_RBTX4927_IOC_INTR_STAT
mdefine_line|#define TOSHIBA_RBTX4927_IOC_INTR_STAT 0xbc002006
macro_line|#ifdef CONFIG_TOSHIBA_FPCIB0
DECL|macro|TOSHIBA_RBTX4927_ISA_NAME
mdefine_line|#define TOSHIBA_RBTX4927_ISA_NAME &quot;RBTX4927-ISA&quot;
DECL|variable|toshiba_rbtx4927_irq_isa_type
r_static
r_struct
id|hw_interrupt_type
id|toshiba_rbtx4927_irq_isa_type
op_assign
(brace
dot
r_typename
op_assign
id|TOSHIBA_RBTX4927_ISA_NAME
comma
dot
id|startup
op_assign
id|toshiba_rbtx4927_irq_isa_startup
comma
dot
id|shutdown
op_assign
id|toshiba_rbtx4927_irq_isa_shutdown
comma
dot
id|enable
op_assign
id|toshiba_rbtx4927_irq_isa_enable
comma
dot
id|disable
op_assign
id|toshiba_rbtx4927_irq_isa_disable
comma
dot
id|ack
op_assign
id|toshiba_rbtx4927_irq_isa_mask_and_ack
comma
dot
id|end
op_assign
id|toshiba_rbtx4927_irq_isa_end
comma
dot
id|set_affinity
op_assign
l_int|NULL
)brace
suffix:semicolon
macro_line|#endif
DECL|function|bit2num
id|u32
id|bit2num
c_func
(paren
id|u32
id|num
)paren
(brace
id|u32
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
r_sizeof
(paren
id|num
)paren
op_star
l_int|8
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|num
op_amp
(paren
l_int|1
op_lshift
id|i
)paren
)paren
(brace
r_return
(paren
id|i
)paren
suffix:semicolon
)brace
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|toshiba_rbtx4927_irq_nested
r_int
id|toshiba_rbtx4927_irq_nested
c_func
(paren
r_int
id|sw_irq
)paren
(brace
id|u32
id|level3
suffix:semicolon
id|u32
id|level4
suffix:semicolon
id|u32
id|level5
suffix:semicolon
id|level3
op_assign
id|reg_rd08
c_func
(paren
id|TOSHIBA_RBTX4927_IOC_INTR_STAT
)paren
op_amp
l_int|0x1f
suffix:semicolon
r_if
c_cond
(paren
id|level3
)paren
(brace
id|sw_irq
op_assign
id|TOSHIBA_RBTX4927_IRQ_IOC_BEG
op_plus
id|bit2num
c_func
(paren
id|level3
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sw_irq
op_ne
id|TOSHIBA_RBTX4927_IRQ_NEST_ISA_ON_IOC
)paren
(brace
r_goto
id|RETURN
suffix:semicolon
)brace
)brace
macro_line|#ifdef CONFIG_TOSHIBA_FPCIB0
(brace
r_if
c_cond
(paren
id|tx4927_using_backplane
)paren
(brace
id|outb
c_func
(paren
l_int|0x0A
comma
l_int|0x20
)paren
suffix:semicolon
id|level4
op_assign
id|inb
c_func
(paren
l_int|0x20
)paren
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|level4
)paren
(brace
id|sw_irq
op_assign
id|TOSHIBA_RBTX4927_IRQ_ISA_BEG
op_plus
id|bit2num
c_func
(paren
id|level4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sw_irq
op_ne
id|TOSHIBA_RBTX4927_IRQ_NEST_ISA_ON_ISA
)paren
(brace
r_goto
id|RETURN
suffix:semicolon
)brace
)brace
id|outb
c_func
(paren
l_int|0x0A
comma
l_int|0xA0
)paren
suffix:semicolon
id|level5
op_assign
id|inb
c_func
(paren
l_int|0xA0
)paren
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|level5
)paren
(brace
id|sw_irq
op_assign
id|TOSHIBA_RBTX4927_IRQ_ISA_MID
op_plus
id|bit2num
c_func
(paren
id|level5
)paren
suffix:semicolon
r_goto
id|RETURN
suffix:semicolon
)brace
)brace
)brace
macro_line|#endif
id|RETURN
suffix:colon
r_return
(paren
id|sw_irq
)paren
suffix:semicolon
)brace
singleline_comment|//#define TOSHIBA_RBTX4927_PIC_ACTION(s) { no_action, 0, CPU_MASK_NONE, s, NULL, NULL }
DECL|macro|TOSHIBA_RBTX4927_PIC_ACTION
mdefine_line|#define TOSHIBA_RBTX4927_PIC_ACTION(s) { no_action, SA_SHIRQ, CPU_MASK_NONE, s, NULL, NULL }
DECL|variable|toshiba_rbtx4927_irq_ioc_action
r_static
r_struct
id|irqaction
id|toshiba_rbtx4927_irq_ioc_action
op_assign
id|TOSHIBA_RBTX4927_PIC_ACTION
c_func
(paren
id|TOSHIBA_RBTX4927_IOC_NAME
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_TOSHIBA_FPCIB0
DECL|variable|toshiba_rbtx4927_irq_isa_master
r_static
r_struct
id|irqaction
id|toshiba_rbtx4927_irq_isa_master
op_assign
id|TOSHIBA_RBTX4927_PIC_ACTION
c_func
(paren
id|TOSHIBA_RBTX4927_ISA_NAME
l_string|&quot;/M&quot;
)paren
suffix:semicolon
DECL|variable|toshiba_rbtx4927_irq_isa_slave
r_static
r_struct
id|irqaction
id|toshiba_rbtx4927_irq_isa_slave
op_assign
id|TOSHIBA_RBTX4927_PIC_ACTION
c_func
(paren
id|TOSHIBA_RBTX4927_ISA_NAME
l_string|&quot;/S&quot;
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/**********************************************************************************/
multiline_comment|/* Functions for ioc                                                              */
multiline_comment|/**********************************************************************************/
DECL|function|toshiba_rbtx4927_irq_ioc_init
r_static
r_void
id|__init
id|toshiba_rbtx4927_irq_ioc_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_IOC_INIT
comma
l_string|&quot;beg=%d end=%d&bslash;n&quot;
comma
id|TOSHIBA_RBTX4927_IRQ_IOC_BEG
comma
id|TOSHIBA_RBTX4927_IRQ_IOC_END
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|TOSHIBA_RBTX4927_IRQ_IOC_BEG
suffix:semicolon
id|i
op_le
id|TOSHIBA_RBTX4927_IRQ_IOC_END
suffix:semicolon
id|i
op_increment
)paren
(brace
id|irq_desc
(braket
id|i
)braket
dot
id|status
op_assign
id|IRQ_DISABLED
suffix:semicolon
id|irq_desc
(braket
id|i
)braket
dot
id|action
op_assign
l_int|0
suffix:semicolon
id|irq_desc
(braket
id|i
)braket
dot
id|depth
op_assign
l_int|3
suffix:semicolon
id|irq_desc
(braket
id|i
)braket
dot
id|handler
op_assign
op_amp
id|toshiba_rbtx4927_irq_ioc_type
suffix:semicolon
)brace
id|setup_irq
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_NEST_IOC_ON_PIC
comma
op_amp
id|toshiba_rbtx4927_irq_ioc_action
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|toshiba_rbtx4927_irq_ioc_startup
r_static
r_int
r_int
id|toshiba_rbtx4927_irq_ioc_startup
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_IOC_STARTUP
comma
l_string|&quot;irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
template_param
id|TOSHIBA_RBTX4927_IRQ_IOC_END
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_EROR
comma
l_string|&quot;bad irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|toshiba_rbtx4927_irq_ioc_enable
c_func
(paren
id|irq
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|toshiba_rbtx4927_irq_ioc_shutdown
r_static
r_void
id|toshiba_rbtx4927_irq_ioc_shutdown
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_IOC_SHUTDOWN
comma
l_string|&quot;irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
template_param
id|TOSHIBA_RBTX4927_IRQ_IOC_END
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_EROR
comma
l_string|&quot;bad irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|toshiba_rbtx4927_irq_ioc_disable
c_func
(paren
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|toshiba_rbtx4927_irq_ioc_enable
r_static
r_void
id|toshiba_rbtx4927_irq_ioc_enable
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_volatile
r_int
r_char
id|v
suffix:semicolon
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_IOC_ENABLE
comma
l_string|&quot;irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
template_param
id|TOSHIBA_RBTX4927_IRQ_IOC_END
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_EROR
comma
l_string|&quot;bad irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|toshiba_rbtx4927_ioc_lock
comma
id|flags
)paren
suffix:semicolon
id|v
op_assign
id|TX4927_RD08
c_func
(paren
id|TOSHIBA_RBTX4927_IOC_INTR_ENAB
)paren
suffix:semicolon
id|v
op_or_assign
(paren
l_int|1
op_lshift
(paren
id|irq
op_minus
id|TOSHIBA_RBTX4927_IRQ_IOC_BEG
)paren
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_WR08
c_func
(paren
id|TOSHIBA_RBTX4927_IOC_INTR_ENAB
comma
id|v
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|toshiba_rbtx4927_ioc_lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|toshiba_rbtx4927_irq_ioc_disable
r_static
r_void
id|toshiba_rbtx4927_irq_ioc_disable
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_volatile
r_int
r_char
id|v
suffix:semicolon
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_IOC_DISABLE
comma
l_string|&quot;irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
template_param
id|TOSHIBA_RBTX4927_IRQ_IOC_END
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_EROR
comma
l_string|&quot;bad irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|toshiba_rbtx4927_ioc_lock
comma
id|flags
)paren
suffix:semicolon
id|v
op_assign
id|TX4927_RD08
c_func
(paren
id|TOSHIBA_RBTX4927_IOC_INTR_ENAB
)paren
suffix:semicolon
id|v
op_and_assign
op_complement
(paren
l_int|1
op_lshift
(paren
id|irq
op_minus
id|TOSHIBA_RBTX4927_IRQ_IOC_BEG
)paren
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_WR08
c_func
(paren
id|TOSHIBA_RBTX4927_IOC_INTR_ENAB
comma
id|v
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|toshiba_rbtx4927_ioc_lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|toshiba_rbtx4927_irq_ioc_mask_and_ack
r_static
r_void
id|toshiba_rbtx4927_irq_ioc_mask_and_ack
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_IOC_MASK
comma
l_string|&quot;irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
template_param
id|TOSHIBA_RBTX4927_IRQ_IOC_END
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_EROR
comma
l_string|&quot;bad irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|toshiba_rbtx4927_irq_ioc_disable
c_func
(paren
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|toshiba_rbtx4927_irq_ioc_end
r_static
r_void
id|toshiba_rbtx4927_irq_ioc_end
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_IOC_ENDIRQ
comma
l_string|&quot;irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
template_param
id|TOSHIBA_RBTX4927_IRQ_IOC_END
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_EROR
comma
l_string|&quot;bad irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|irq_desc
(braket
id|irq
)braket
dot
id|status
op_amp
(paren
id|IRQ_DISABLED
op_or
id|IRQ_INPROGRESS
)paren
)paren
)paren
(brace
id|toshiba_rbtx4927_irq_ioc_enable
c_func
(paren
id|irq
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/**********************************************************************************/
multiline_comment|/* Functions for isa                                                              */
multiline_comment|/**********************************************************************************/
macro_line|#ifdef CONFIG_TOSHIBA_FPCIB0
DECL|function|toshiba_rbtx4927_irq_isa_init
r_static
r_void
id|__init
id|toshiba_rbtx4927_irq_isa_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_ISA_INIT
comma
l_string|&quot;beg=%d end=%d&bslash;n&quot;
comma
id|TOSHIBA_RBTX4927_IRQ_ISA_BEG
comma
id|TOSHIBA_RBTX4927_IRQ_ISA_END
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|TOSHIBA_RBTX4927_IRQ_ISA_BEG
suffix:semicolon
id|i
op_le
id|TOSHIBA_RBTX4927_IRQ_ISA_END
suffix:semicolon
id|i
op_increment
)paren
(brace
id|irq_desc
(braket
id|i
)braket
dot
id|status
op_assign
id|IRQ_DISABLED
suffix:semicolon
id|irq_desc
(braket
id|i
)braket
dot
id|action
op_assign
l_int|0
suffix:semicolon
id|irq_desc
(braket
id|i
)braket
dot
id|depth
op_assign
(paren
(paren
id|i
OL
id|TOSHIBA_RBTX4927_IRQ_ISA_MID
)paren
ques
c_cond
(paren
l_int|4
)paren
suffix:colon
(paren
l_int|5
)paren
)paren
suffix:semicolon
id|irq_desc
(braket
id|i
)braket
dot
id|handler
op_assign
op_amp
id|toshiba_rbtx4927_irq_isa_type
suffix:semicolon
)brace
id|setup_irq
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_NEST_ISA_ON_IOC
comma
op_amp
id|toshiba_rbtx4927_irq_isa_master
)paren
suffix:semicolon
id|setup_irq
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_NEST_ISA_ON_ISA
comma
op_amp
id|toshiba_rbtx4927_irq_isa_slave
)paren
suffix:semicolon
multiline_comment|/* make sure we are looking at IRR (not ISR) */
id|outb
c_func
(paren
l_int|0x0A
comma
l_int|0x20
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x0A
comma
l_int|0xA0
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_TOSHIBA_FPCIB0
DECL|function|toshiba_rbtx4927_irq_isa_startup
r_static
r_int
r_int
id|toshiba_rbtx4927_irq_isa_startup
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_ISA_STARTUP
comma
l_string|&quot;irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
template_param
id|TOSHIBA_RBTX4927_IRQ_ISA_END
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_EROR
comma
l_string|&quot;bad irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|toshiba_rbtx4927_irq_isa_enable
c_func
(paren
id|irq
)paren
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_TOSHIBA_FPCIB0
DECL|function|toshiba_rbtx4927_irq_isa_shutdown
r_static
r_void
id|toshiba_rbtx4927_irq_isa_shutdown
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_ISA_SHUTDOWN
comma
l_string|&quot;irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
template_param
id|TOSHIBA_RBTX4927_IRQ_ISA_END
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_EROR
comma
l_string|&quot;bad irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|toshiba_rbtx4927_irq_isa_disable
c_func
(paren
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_TOSHIBA_FPCIB0
DECL|function|toshiba_rbtx4927_irq_isa_enable
r_static
r_void
id|toshiba_rbtx4927_irq_isa_enable
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_ISA_ENABLE
comma
l_string|&quot;irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
template_param
id|TOSHIBA_RBTX4927_IRQ_ISA_END
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_EROR
comma
l_string|&quot;bad irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|enable_8259A_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_TOSHIBA_FPCIB0
DECL|function|toshiba_rbtx4927_irq_isa_disable
r_static
r_void
id|toshiba_rbtx4927_irq_isa_disable
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_ISA_DISABLE
comma
l_string|&quot;irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
template_param
id|TOSHIBA_RBTX4927_IRQ_ISA_END
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_EROR
comma
l_string|&quot;bad irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|disable_8259A_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_TOSHIBA_FPCIB0
DECL|function|toshiba_rbtx4927_irq_isa_mask_and_ack
r_static
r_void
id|toshiba_rbtx4927_irq_isa_mask_and_ack
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_ISA_MASK
comma
l_string|&quot;irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
template_param
id|TOSHIBA_RBTX4927_IRQ_ISA_END
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_EROR
comma
l_string|&quot;bad irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|mask_and_ack_8259A
c_func
(paren
id|irq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
macro_line|#ifdef CONFIG_TOSHIBA_FPCIB0
DECL|function|toshiba_rbtx4927_irq_isa_end
r_static
r_void
id|toshiba_rbtx4927_irq_isa_end
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_ISA_ENDIRQ
comma
l_string|&quot;irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq
template_param
id|TOSHIBA_RBTX4927_IRQ_ISA_END
)paren
(brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_EROR
comma
l_string|&quot;bad irq=%d&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|irq_desc
(braket
id|irq
)braket
dot
id|status
op_amp
(paren
id|IRQ_DISABLED
op_or
id|IRQ_INPROGRESS
)paren
)paren
)paren
(brace
id|toshiba_rbtx4927_irq_isa_enable
c_func
(paren
id|irq
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
macro_line|#endif
DECL|function|arch_init_irq
r_void
id|__init
id|arch_init_irq
c_func
(paren
r_void
)paren
(brace
r_extern
r_void
id|tx4927_irq_init
c_func
(paren
r_void
)paren
suffix:semicolon
id|cli
c_func
(paren
)paren
suffix:semicolon
id|tx4927_irq_init
c_func
(paren
)paren
suffix:semicolon
id|toshiba_rbtx4927_irq_ioc_init
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_TOSHIBA_FPCIB0
(brace
r_if
c_cond
(paren
id|tx4927_using_backplane
)paren
(brace
id|toshiba_rbtx4927_irq_isa_init
c_func
(paren
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
id|wbflush
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|function|toshiba_rbtx4927_irq_dump
r_void
id|toshiba_rbtx4927_irq_dump
c_func
(paren
r_char
op_star
id|key
)paren
(brace
macro_line|#ifdef TOSHIBA_RBTX4927_IRQ_DEBUG
(brace
id|u32
id|i
comma
id|j
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_IRQS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|irq_desc
(braket
id|i
)braket
dot
id|handler
op_member_access_from_pointer
r_typename
comma
l_string|&quot;none&quot;
)paren
op_eq
l_int|0
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
id|i
op_ge
l_int|1
)paren
op_logical_and
(paren
id|irq_desc
(braket
id|i
op_minus
l_int|1
)braket
dot
id|handler
op_member_access_from_pointer
r_typename
op_eq
id|irq_desc
(braket
id|i
)braket
dot
id|handler
op_member_access_from_pointer
r_typename
)paren
)paren
(brace
id|j
op_increment
suffix:semicolon
)brace
r_else
(brace
id|j
op_assign
l_int|0
suffix:semicolon
)brace
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
(paren
id|TOSHIBA_RBTX4927_IRQ_INFO
comma
l_string|&quot;%s irq=0x%02x/%3d s=0x%08x h=0x%08x a=0x%08x ah=0x%08x d=%1d n=%s/%02d&bslash;n&quot;
comma
id|key
comma
id|i
comma
id|i
comma
id|irq_desc
(braket
id|i
)braket
dot
id|status
comma
(paren
id|u32
)paren
id|irq_desc
(braket
id|i
)braket
dot
id|handler
comma
(paren
id|u32
)paren
id|irq_desc
(braket
id|i
)braket
dot
id|action
comma
(paren
id|u32
)paren
(paren
id|irq_desc
(braket
id|i
)braket
dot
id|action
ques
c_cond
id|irq_desc
(braket
id|i
)braket
dot
id|action-&gt;handler
suffix:colon
l_int|0
)paren
comma
id|irq_desc
(braket
id|i
)braket
dot
id|depth
comma
id|irq_desc
(braket
id|i
)braket
dot
id|handler
op_member_access_from_pointer
r_typename
comma
id|j
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
r_return
suffix:semicolon
)brace
DECL|function|toshiba_rbtx4927_irq_dump_pics
r_void
id|toshiba_rbtx4927_irq_dump_pics
c_func
(paren
r_char
op_star
id|s
)paren
(brace
id|u32
id|level0_m
suffix:semicolon
id|u32
id|level0_s
suffix:semicolon
id|u32
id|level1_m
suffix:semicolon
id|u32
id|level1_s
suffix:semicolon
id|u32
id|level2
suffix:semicolon
id|u32
id|level2_p
suffix:semicolon
id|u32
id|level2_s
suffix:semicolon
id|u32
id|level3_m
suffix:semicolon
id|u32
id|level3_s
suffix:semicolon
id|u32
id|level4_m
suffix:semicolon
id|u32
id|level4_s
suffix:semicolon
id|u32
id|level5_m
suffix:semicolon
id|u32
id|level5_s
suffix:semicolon
r_if
c_cond
(paren
id|s
op_eq
l_int|NULL
)paren
id|s
op_assign
l_string|&quot;null&quot;
suffix:semicolon
id|level0_m
op_assign
(paren
id|read_c0_status
c_func
(paren
)paren
op_amp
l_int|0x0000ff00
)paren
op_rshift
l_int|8
suffix:semicolon
id|level0_s
op_assign
(paren
id|read_c0_cause
c_func
(paren
)paren
op_amp
l_int|0x0000ff00
)paren
op_rshift
l_int|8
suffix:semicolon
id|level1_m
op_assign
id|level0_m
suffix:semicolon
id|level1_s
op_assign
id|level0_s
op_amp
l_int|0x87
suffix:semicolon
id|level2
op_assign
id|TX4927_RD
c_func
(paren
l_int|0xff1ff6a0
)paren
suffix:semicolon
id|level2_p
op_assign
(paren
(paren
(paren
id|level2
op_amp
l_int|0x10000
)paren
)paren
ques
c_cond
l_int|0
suffix:colon
l_int|1
)paren
suffix:semicolon
id|level2_s
op_assign
(paren
(paren
(paren
id|level2
op_amp
l_int|0x1f
)paren
op_eq
l_int|0x1f
)paren
ques
c_cond
l_int|0
suffix:colon
(paren
id|level2
op_amp
l_int|0x1f
)paren
)paren
suffix:semicolon
id|level3_m
op_assign
id|reg_rd08
c_func
(paren
id|TOSHIBA_RBTX4927_IOC_INTR_ENAB
)paren
op_amp
l_int|0x1f
suffix:semicolon
id|level3_s
op_assign
id|reg_rd08
c_func
(paren
id|TOSHIBA_RBTX4927_IOC_INTR_STAT
)paren
op_amp
l_int|0x1f
suffix:semicolon
id|level4_m
op_assign
id|inb
c_func
(paren
l_int|0x21
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x0A
comma
l_int|0x20
)paren
suffix:semicolon
id|level4_s
op_assign
id|inb
c_func
(paren
l_int|0x20
)paren
suffix:semicolon
id|level5_m
op_assign
id|inb
c_func
(paren
l_int|0xa1
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x0A
comma
l_int|0xa0
)paren
suffix:semicolon
id|level5_s
op_assign
id|inb
c_func
(paren
l_int|0xa0
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_INFO
comma
l_string|&quot;dump_raw_pic() &quot;
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_INFO
comma
l_string|&quot;cp0:m=0x%02x/s=0x%02x &quot;
comma
id|level0_m
comma
id|level0_s
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_INFO
comma
l_string|&quot;cp0:m=0x%02x/s=0x%02x &quot;
comma
id|level1_m
comma
id|level1_s
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_INFO
comma
l_string|&quot;pic:e=0x%02x/s=0x%02x &quot;
comma
id|level2_p
comma
id|level2_s
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_INFO
comma
l_string|&quot;ioc:m=0x%02x/s=0x%02x &quot;
comma
id|level3_m
comma
id|level3_s
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_INFO
comma
l_string|&quot;sbm:m=0x%02x/s=0x%02x &quot;
comma
id|level4_m
comma
id|level4_s
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_INFO
comma
l_string|&quot;sbs:m=0x%02x/s=0x%02x &quot;
comma
id|level5_m
comma
id|level5_s
)paren
suffix:semicolon
id|TOSHIBA_RBTX4927_IRQ_DPRINTK
c_func
(paren
id|TOSHIBA_RBTX4927_IRQ_INFO
comma
l_string|&quot;[%s]&bslash;n&quot;
comma
id|s
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
eof
