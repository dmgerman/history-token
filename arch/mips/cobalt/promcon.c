multiline_comment|/*&n; * PROM console for Cobalt Raq2&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; *&n; * Copyright (C) 1995, 1996, 1997 by Ralf Baechle&n; * Copyright (C) 2001 by Liam Davies (ldavies@agile.tv)&n; *&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/kdev_t.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/serial_reg.h&gt;
macro_line|#include &lt;asm/delay.h&gt;
macro_line|#include &lt;asm/serial.h&gt;
macro_line|#include &lt;asm/io.h&gt;
DECL|variable|port
r_static
r_int
r_int
id|port
op_assign
l_int|0xc800000
suffix:semicolon
DECL|function|ns16550_cons_put_char
r_static
id|__inline__
r_void
id|ns16550_cons_put_char
c_func
(paren
r_char
id|ch
comma
r_int
r_int
id|ioaddr
)paren
(brace
r_char
id|lsr
suffix:semicolon
r_do
(brace
id|lsr
op_assign
id|inb
c_func
(paren
id|ioaddr
op_plus
id|UART_LSR
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|lsr
op_amp
(paren
id|UART_LSR_TEMT
op_or
id|UART_LSR_THRE
)paren
)paren
op_ne
(paren
id|UART_LSR_TEMT
op_or
id|UART_LSR_THRE
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|ch
comma
id|ioaddr
op_plus
id|UART_TX
)paren
suffix:semicolon
)brace
DECL|function|ns16550_cons_get_char
r_static
id|__inline__
r_char
id|ns16550_cons_get_char
c_func
(paren
r_int
r_int
id|ioaddr
)paren
(brace
r_while
c_loop
(paren
(paren
id|inb
c_func
(paren
id|ioaddr
op_plus
id|UART_LSR
)paren
op_amp
id|UART_LSR_DR
)paren
op_eq
l_int|0
)paren
id|udelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_return
id|inb
c_func
(paren
id|ioaddr
op_plus
id|UART_RX
)paren
suffix:semicolon
)brace
DECL|function|ns16550_console_write
r_void
id|ns16550_console_write
c_func
(paren
r_struct
id|console
op_star
id|co
comma
r_const
r_char
op_star
id|s
comma
r_int
id|count
)paren
(brace
r_char
id|lsr
comma
id|ier
suffix:semicolon
r_int
id|i
suffix:semicolon
id|ier
op_assign
id|inb
c_func
(paren
id|port
op_plus
id|UART_IER
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x00
comma
id|port
op_plus
id|UART_IER
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
comma
id|s
op_increment
)paren
(brace
r_if
c_cond
(paren
op_star
id|s
op_eq
l_char|&squot;&bslash;n&squot;
)paren
(brace
id|ns16550_cons_put_char
c_func
(paren
l_char|&squot;&bslash;r&squot;
comma
id|port
)paren
suffix:semicolon
)brace
id|ns16550_cons_put_char
c_func
(paren
op_star
id|s
comma
id|port
)paren
suffix:semicolon
)brace
r_do
(brace
id|lsr
op_assign
id|inb
c_func
(paren
id|port
op_plus
id|UART_LSR
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|lsr
op_amp
(paren
id|UART_LSR_TEMT
op_or
id|UART_LSR_THRE
)paren
)paren
op_ne
(paren
id|UART_LSR_TEMT
op_or
id|UART_LSR_THRE
)paren
)paren
suffix:semicolon
id|outb
c_func
(paren
id|ier
comma
id|port
op_plus
id|UART_IER
)paren
suffix:semicolon
)brace
DECL|function|getDebugChar
r_char
id|getDebugChar
c_func
(paren
r_void
)paren
(brace
r_return
id|ns16550_cons_get_char
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
DECL|function|putDebugChar
r_void
id|putDebugChar
c_func
(paren
r_char
id|kgdb_char
)paren
(brace
id|ns16550_cons_put_char
c_func
(paren
id|kgdb_char
comma
id|port
)paren
suffix:semicolon
)brace
r_static
id|kdev_t
DECL|function|ns16550_console_dev
id|ns16550_console_dev
c_func
(paren
r_struct
id|console
op_star
id|c
)paren
(brace
r_return
id|mk_kdev
c_func
(paren
id|TTY_MAJOR
comma
l_int|64
op_plus
id|c-&gt;index
)paren
suffix:semicolon
)brace
DECL|variable|ns16550_console
r_static
r_struct
id|console
id|ns16550_console
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;prom&quot;
comma
dot
id|setup
op_assign
l_int|NULL
comma
dot
id|write
op_assign
id|ns16550_console_write
comma
dot
id|device
op_assign
id|ns16550_console_dev
comma
dot
id|flags
op_assign
id|CON_PRINTBUFFER
comma
dot
id|index
op_assign
op_minus
l_int|1
comma
)brace
suffix:semicolon
DECL|function|ns16550_setup_console
r_void
id|__init
id|ns16550_setup_console
c_func
(paren
r_void
)paren
(brace
id|register_console
c_func
(paren
op_amp
id|ns16550_console
)paren
suffix:semicolon
)brace
eof
