multiline_comment|/*&n; * VIA chipset irq handling&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; *&n; * Copyright (C) 1996, 1997 by Ralf Baechle&n; * Copyright (C) 2001, 2002, 2003 by Liam Davies (ldavies@agile.tv)&n; *&n; */
macro_line|#include &lt;linux/irq.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;asm/gt64120.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/cobalt/cobalt.h&gt;
DECL|function|via_irq
id|asmlinkage
r_void
id|via_irq
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_char
id|mstat
comma
id|sstat
suffix:semicolon
multiline_comment|/* Read Master Status */
id|outb
c_func
(paren
l_int|0x0C
comma
l_int|0x20
)paren
suffix:semicolon
id|mstat
op_assign
id|inb
c_func
(paren
l_int|0x20
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mstat
OL
l_int|0
)paren
(brace
id|mstat
op_and_assign
l_int|0x7f
suffix:semicolon
r_if
c_cond
(paren
id|mstat
op_ne
l_int|2
)paren
(brace
id|do_IRQ
c_func
(paren
id|mstat
comma
id|regs
)paren
suffix:semicolon
id|outb
c_func
(paren
id|mstat
op_or
l_int|0x20
comma
l_int|0x20
)paren
suffix:semicolon
)brace
r_else
(brace
id|sstat
op_assign
id|inb
c_func
(paren
l_int|0xA0
)paren
suffix:semicolon
multiline_comment|/* Slave interrupt */
id|outb
c_func
(paren
l_int|0x0C
comma
l_int|0xA0
)paren
suffix:semicolon
id|sstat
op_assign
id|inb
c_func
(paren
l_int|0xA0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sstat
OL
l_int|0
)paren
(brace
id|do_IRQ
c_func
(paren
(paren
id|sstat
op_plus
l_int|8
)paren
op_amp
l_int|0x7f
comma
id|regs
)paren
suffix:semicolon
id|outb
c_func
(paren
l_int|0x22
comma
l_int|0x20
)paren
suffix:semicolon
id|outb
c_func
(paren
(paren
id|sstat
op_amp
l_int|0x7f
)paren
op_or
l_int|0x20
comma
l_int|0xA0
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;Spurious slave interrupt...&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;Spurious master interrupt...&quot;
)paren
suffix:semicolon
)brace
DECL|function|galileo_irq
id|asmlinkage
r_void
id|galileo_irq
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|irq_src
suffix:semicolon
id|irq_src
op_assign
id|GALILEO_INL
c_func
(paren
id|GT_INTRCAUSE_OFS
)paren
suffix:semicolon
multiline_comment|/* Check for timer irq ... */
r_if
c_cond
(paren
id|irq_src
op_amp
id|GALILEO_T0EXP
)paren
(brace
multiline_comment|/* Clear the int line */
id|GALILEO_OUTL
c_func
(paren
l_int|0
comma
id|GT_INTRCAUSE_OFS
)paren
suffix:semicolon
id|do_IRQ
c_func
(paren
id|COBALT_TIMER_IRQ
comma
id|regs
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;Spurious Galileo interrupt...&bslash;n&quot;
)paren
suffix:semicolon
)brace
eof
