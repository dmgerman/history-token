multiline_comment|/*&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; *&n; * Copyright (C) 2000, 2001 Keith M Wesolowski&n; * Copyright (C) 2004 by Ralf Baechle (ralf@linux-mips.org)&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;asm/ip32/mace.h&gt;
macro_line|#include &lt;asm/ip32/ip32_ints.h&gt;
DECL|macro|DEBUG_MACE_PCI
macro_line|#undef DEBUG_MACE_PCI
multiline_comment|/*&n; * Handle errors from the bridge.  This includes master and target aborts,&n; * various command and address errors, and the interrupt test.  This gets&n; * registered on the bridge error irq.  It&squot;s conceivable that some of these&n; * conditions warrant a panic.  Anybody care to say which ones?&n; */
DECL|function|macepci_error
r_static
id|irqreturn_t
id|macepci_error
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_char
id|s
suffix:semicolon
r_int
r_int
id|flags
op_assign
id|mace-&gt;pci.error
suffix:semicolon
r_int
r_int
id|addr
op_assign
id|mace-&gt;pci.error_addr
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|MACEPCI_ERROR_MEMORY_ADDR
)paren
id|s
op_assign
l_char|&squot;M&squot;
suffix:semicolon
r_else
r_if
c_cond
(paren
id|flags
op_amp
id|MACEPCI_ERROR_CONFIG_ADDR
)paren
id|s
op_assign
l_char|&squot;C&squot;
suffix:semicolon
r_else
id|s
op_assign
l_char|&squot;X&squot;
suffix:semicolon
r_if
c_cond
(paren
id|flags
op_amp
id|MACEPCI_ERROR_MASTER_ABORT
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;MACEPCI: Master abort at 0x%08x (%c)&bslash;n&quot;
comma
id|addr
comma
id|s
)paren
suffix:semicolon
id|flags
op_and_assign
op_complement
id|MACEPCI_ERROR_MASTER_ABORT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|MACEPCI_ERROR_TARGET_ABORT
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;MACEPCI: Target abort at 0x%08x (%c)&bslash;n&quot;
comma
id|addr
comma
id|s
)paren
suffix:semicolon
id|flags
op_and_assign
op_complement
id|MACEPCI_ERROR_TARGET_ABORT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|MACEPCI_ERROR_DATA_PARITY_ERR
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;MACEPCI: Data parity error at 0x%08x (%c)&bslash;n&quot;
comma
id|addr
comma
id|s
)paren
suffix:semicolon
id|flags
op_and_assign
op_complement
id|MACEPCI_ERROR_DATA_PARITY_ERR
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|MACEPCI_ERROR_RETRY_ERR
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;MACEPCI: Retry error at 0x%08x (%c)&bslash;n&quot;
comma
id|addr
comma
id|s
)paren
suffix:semicolon
id|flags
op_and_assign
op_complement
id|MACEPCI_ERROR_RETRY_ERR
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|MACEPCI_ERROR_ILLEGAL_CMD
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;MACEPCI: Illegal command at 0x%08x (%c)&bslash;n&quot;
comma
id|addr
comma
id|s
)paren
suffix:semicolon
id|flags
op_and_assign
op_complement
id|MACEPCI_ERROR_ILLEGAL_CMD
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|MACEPCI_ERROR_SYSTEM_ERR
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;MACEPCI: System error at 0x%08x (%c)&bslash;n&quot;
comma
id|addr
comma
id|s
)paren
suffix:semicolon
id|flags
op_and_assign
op_complement
id|MACEPCI_ERROR_SYSTEM_ERR
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|MACEPCI_ERROR_PARITY_ERR
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;MACEPCI: Parity error at 0x%08x (%c)&bslash;n&quot;
comma
id|addr
comma
id|s
)paren
suffix:semicolon
id|flags
op_and_assign
op_complement
id|MACEPCI_ERROR_PARITY_ERR
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|MACEPCI_ERROR_OVERRUN
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;MACEPCI: Overrun error at 0x%08x (%c)&bslash;n&quot;
comma
id|addr
comma
id|s
)paren
suffix:semicolon
id|flags
op_and_assign
op_complement
id|MACEPCI_ERROR_OVERRUN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|MACEPCI_ERROR_SIG_TABORT
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;MACEPCI: Signaled target abort (clearing)&bslash;n&quot;
)paren
suffix:semicolon
id|flags
op_and_assign
op_complement
id|MACEPCI_ERROR_SIG_TABORT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|flags
op_amp
id|MACEPCI_ERROR_INTERRUPT_TEST
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;MACEPCI: Interrupt test triggered (clearing)&bslash;n&quot;
)paren
suffix:semicolon
id|flags
op_and_assign
op_complement
id|MACEPCI_ERROR_INTERRUPT_TEST
suffix:semicolon
)brace
id|mace-&gt;pci.error
op_assign
id|flags
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
r_extern
r_struct
id|pci_ops
id|mace_pci_ops
suffix:semicolon
macro_line|#ifdef CONFIG_MIPS64
DECL|variable|mace_pci_mem_resource
r_static
r_struct
id|resource
id|mace_pci_mem_resource
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;SGI O2 PCI MEM&quot;
comma
dot
id|start
op_assign
id|MACEPCI_HI_MEMORY
comma
dot
id|end
op_assign
l_int|0x2FFFFFFFFUL
comma
dot
id|flags
op_assign
id|IORESOURCE_MEM
comma
)brace
suffix:semicolon
DECL|variable|mace_pci_io_resource
r_static
r_struct
id|resource
id|mace_pci_io_resource
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;SGI O2 PCI IO&quot;
comma
dot
id|start
op_assign
l_int|0x00000000UL
comma
dot
id|end
op_assign
l_int|0xffffffffUL
comma
dot
id|flags
op_assign
id|IORESOURCE_IO
comma
)brace
suffix:semicolon
DECL|macro|MACE_PCI_MEM_OFFSET
mdefine_line|#define MACE_PCI_MEM_OFFSET 0x200000000
macro_line|#else
DECL|variable|mace_pci_mem_resource
r_static
r_struct
id|resource
id|mace_pci_mem_resource
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;SGI O2 PCI MEM&quot;
comma
dot
id|start
op_assign
id|MACEPCI_LOW_MEMORY
comma
dot
id|end
op_assign
id|MACEPCI_LOW_MEMORY
op_plus
l_int|0x2000000
op_minus
l_int|1
comma
dot
id|flags
op_assign
id|IORESOURCE_MEM
comma
)brace
suffix:semicolon
DECL|variable|mace_pci_io_resource
r_static
r_struct
id|resource
id|mace_pci_io_resource
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;SGI O2 PCI IO&quot;
comma
dot
id|start
op_assign
l_int|0x00000000
comma
dot
id|end
op_assign
l_int|0xFFFFFFFF
comma
dot
id|flags
op_assign
id|IORESOURCE_IO
comma
)brace
suffix:semicolon
DECL|macro|MACE_PCI_MEM_OFFSET
mdefine_line|#define MACE_PCI_MEM_OFFSET (MACEPCI_LOW_MEMORY - 0x80000000)
macro_line|#endif
DECL|variable|mace_pci_controller
r_static
r_struct
id|pci_controller
id|mace_pci_controller
op_assign
(brace
dot
id|pci_ops
op_assign
op_amp
id|mace_pci_ops
comma
dot
id|mem_resource
op_assign
op_amp
id|mace_pci_mem_resource
comma
dot
id|io_resource
op_assign
op_amp
id|mace_pci_io_resource
comma
dot
id|iommu
op_assign
l_int|0
comma
dot
id|mem_offset
op_assign
id|MACE_PCI_MEM_OFFSET
comma
dot
id|io_offset
op_assign
l_int|0
comma
)brace
suffix:semicolon
DECL|function|mace_init
r_static
r_int
id|__init
id|mace_init
c_func
(paren
r_void
)paren
(brace
id|PCIBIOS_MIN_IO
op_assign
l_int|0x1000
suffix:semicolon
multiline_comment|/* Clear any outstanding errors and enable interrupts */
id|mace-&gt;pci.error_addr
op_assign
l_int|0
suffix:semicolon
id|mace-&gt;pci.error
op_assign
l_int|0
suffix:semicolon
id|mace-&gt;pci.control
op_assign
l_int|0xff008500
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;MACE PCI rev %d&bslash;n&quot;
comma
id|mace-&gt;pci.rev
)paren
suffix:semicolon
id|BUG_ON
c_func
(paren
id|request_irq
c_func
(paren
id|MACE_PCI_BRIDGE_IRQ
comma
id|macepci_error
comma
l_int|0
comma
l_string|&quot;MACE PCI error&quot;
comma
l_int|NULL
)paren
)paren
suffix:semicolon
id|ioport_resource.end
op_assign
id|mace_pci_io_resource.end
suffix:semicolon
id|register_pci_controller
c_func
(paren
op_amp
id|mace_pci_controller
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|mace_init
id|arch_initcall
c_func
(paren
id|mace_init
)paren
suffix:semicolon
eof
