macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
multiline_comment|/* PCI interrupt pins */
DECL|macro|PCIA
mdefine_line|#define PCIA&t;&t;1
DECL|macro|PCIB
mdefine_line|#define PCIB&t;&t;2
DECL|macro|PCIC
mdefine_line|#define PCIC&t;&t;3
DECL|macro|PCID
mdefine_line|#define PCID&t;&t;4
multiline_comment|/* This table is filled in by interrogating the PIIX4 chip */
DECL|variable|__initdata
r_static
r_char
id|pci_irq
(braket
l_int|5
)braket
id|__initdata
suffix:semicolon
DECL|variable|__initdata
r_static
r_char
id|irq_tab
(braket
)braket
(braket
l_int|5
)braket
id|__initdata
op_assign
(brace
multiline_comment|/*      INTA    INTB    INTC    INTD */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/*  0: GT64120 PCI bridge */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/*  1: Unused */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/*  2: Unused */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/*  3: Unused */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/*  4: Unused */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/*  5: Unused */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/*  6: Unused */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/*  7: Unused */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/*  8: Unused */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/*  9: Unused */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
id|PCID
)brace
comma
multiline_comment|/* 10: PIIX4 USB */
(brace
l_int|0
comma
id|PCIB
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* 11: AMD 79C973 Ethernet */
(brace
l_int|0
comma
id|PCIC
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* 12: Crystal 4281 Sound */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* 13: Unused */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* 14: Unused */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* 15: Unused */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* 16: Unused */
(brace
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
multiline_comment|/* 17: Bonito/SOC-it PCI Bridge*/
(brace
l_int|0
comma
id|PCIA
comma
id|PCIB
comma
id|PCIC
comma
id|PCID
)brace
comma
multiline_comment|/* 18: PCI Slot 1 */
(brace
l_int|0
comma
id|PCIB
comma
id|PCIC
comma
id|PCID
comma
id|PCIA
)brace
comma
multiline_comment|/* 19: PCI Slot 2 */
(brace
l_int|0
comma
id|PCIC
comma
id|PCID
comma
id|PCIA
comma
id|PCIB
)brace
comma
multiline_comment|/* 20: PCI Slot 3 */
(brace
l_int|0
comma
id|PCID
comma
id|PCIA
comma
id|PCIB
comma
id|PCIC
)brace
multiline_comment|/* 21: PCI Slot 4 */
)brace
suffix:semicolon
DECL|function|pcibios_map_irq
r_int
id|__init
id|pcibios_map_irq
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
id|u8
id|slot
comma
id|u8
id|pin
)paren
(brace
r_int
id|virq
suffix:semicolon
id|virq
op_assign
id|irq_tab
(braket
id|slot
)braket
(braket
id|pin
)braket
suffix:semicolon
r_return
id|pci_irq
(braket
id|virq
)braket
suffix:semicolon
)brace
multiline_comment|/* Do platform specific device initialization at pci_enable_device() time */
DECL|function|pcibios_plat_dev_init
r_int
id|pcibios_plat_dev_init
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|malta_piix_func0_fixup
r_static
r_void
id|__init
id|malta_piix_func0_fixup
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_int
r_char
id|reg_val
suffix:semicolon
r_static
r_int
id|piixirqmap
(braket
l_int|16
)braket
id|__initdata
op_assign
(brace
multiline_comment|/* PIIX PIRQC[A:D] irq mappings */
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|3
comma
l_int|4
comma
l_int|5
comma
l_int|6
comma
l_int|7
comma
l_int|0
comma
l_int|9
comma
l_int|10
comma
l_int|11
comma
l_int|12
comma
l_int|0
comma
l_int|14
comma
l_int|15
)brace
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Interrogate PIIX4 to get PCI IRQ mapping */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
l_int|3
suffix:semicolon
id|i
op_increment
)paren
(brace
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
l_int|0x60
op_plus
id|i
comma
op_amp
id|reg_val
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reg_val
op_amp
l_int|0x80
)paren
id|pci_irq
(braket
id|PCIA
op_plus
id|i
)braket
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Disabled */
r_else
id|pci_irq
(braket
id|PCIA
op_plus
id|i
)braket
op_assign
id|piixirqmap
(braket
id|reg_val
op_amp
l_int|15
)braket
suffix:semicolon
)brace
multiline_comment|/* Done by YAMON 2.00 onwards */
r_if
c_cond
(paren
id|PCI_SLOT
c_func
(paren
id|pdev-&gt;devfn
)paren
op_eq
l_int|10
)paren
(brace
multiline_comment|/*&n;&t;&t; * Set top of main memory accessible by ISA or DMA&n;&t;&t; * devices to 16 Mb.&n;&t;&t; */
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
l_int|0x69
comma
op_amp
id|reg_val
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pdev
comma
l_int|0x69
comma
id|reg_val
op_or
l_int|0xf0
)paren
suffix:semicolon
)brace
)brace
id|DECLARE_PCI_FIXUP_HEADER
c_func
(paren
id|PCI_VENDOR_ID_INTEL
comma
id|PCI_DEVICE_ID_INTEL_82371AB_0
comma
id|malta_piix_func0_fixup
)paren
suffix:semicolon
DECL|function|malta_piix_func1_fixup
r_static
r_void
id|__init
id|malta_piix_func1_fixup
c_func
(paren
r_struct
id|pci_dev
op_star
id|pdev
)paren
(brace
r_int
r_char
id|reg_val
suffix:semicolon
multiline_comment|/* Done by YAMON 2.02 onwards */
r_if
c_cond
(paren
id|PCI_SLOT
c_func
(paren
id|pdev-&gt;devfn
)paren
op_eq
l_int|10
)paren
(brace
multiline_comment|/*&n;&t;&t; * IDE Decode enable.&n;&t;&t; */
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
l_int|0x41
comma
op_amp
id|reg_val
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pdev
comma
l_int|0x41
comma
id|reg_val
op_or
l_int|0x80
)paren
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|pdev
comma
l_int|0x43
comma
op_amp
id|reg_val
)paren
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pdev
comma
l_int|0x43
comma
id|reg_val
op_or
l_int|0x80
)paren
suffix:semicolon
)brace
)brace
id|DECLARE_PCI_FIXUP_HEADER
c_func
(paren
id|PCI_VENDOR_ID_INTEL
comma
id|PCI_DEVICE_ID_INTEL_82371AB
comma
id|malta_piix_func1_fixup
)paren
suffix:semicolon
eof
