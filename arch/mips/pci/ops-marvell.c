multiline_comment|/*&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; *&n; * Copyright (C) 2003, 2004 Ralf Baechle (ralf@linux-mips.org)&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;asm/marvell.h&gt;
DECL|function|mv_read_config
r_static
r_int
id|mv_read_config
c_func
(paren
r_struct
id|pci_bus
op_star
id|bus
comma
r_int
r_int
id|devfn
comma
r_int
id|where
comma
r_int
id|size
comma
id|u32
op_star
id|val
)paren
(brace
r_struct
id|mv_pci_controller
op_star
id|mvbc
op_assign
id|bus-&gt;sysdata
suffix:semicolon
r_int
r_int
id|address_reg
comma
id|data_reg
suffix:semicolon
id|u32
id|address
suffix:semicolon
id|address_reg
op_assign
id|mvbc-&gt;config_addr
suffix:semicolon
id|data_reg
op_assign
id|mvbc-&gt;config_vreg
suffix:semicolon
multiline_comment|/* Accessing device 31 crashes those Marvells.  Since years.&n;&t;   Will they ever make sane controllers ... */
r_if
c_cond
(paren
id|PCI_SLOT
c_func
(paren
id|devfn
)paren
op_eq
l_int|31
)paren
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
id|address
op_assign
(paren
id|bus-&gt;number
op_lshift
l_int|16
)paren
op_or
(paren
id|devfn
op_lshift
l_int|8
)paren
op_or
(paren
id|where
op_amp
l_int|0xfc
)paren
op_or
l_int|0x80000000
suffix:semicolon
multiline_comment|/* start the configuration cycle */
id|MV_WRITE
c_func
(paren
id|address_reg
comma
id|address
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
l_int|1
suffix:colon
op_star
id|val
op_assign
id|MV_READ_8
c_func
(paren
id|data_reg
op_plus
(paren
id|where
op_amp
l_int|0x3
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
op_star
id|val
op_assign
id|MV_READ_16
c_func
(paren
id|data_reg
op_plus
(paren
id|where
op_amp
l_int|0x3
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
op_star
id|val
op_assign
id|MV_READ
c_func
(paren
id|data_reg
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|mv_write_config
r_static
r_int
id|mv_write_config
c_func
(paren
r_struct
id|pci_bus
op_star
id|bus
comma
r_int
r_int
id|devfn
comma
r_int
id|where
comma
r_int
id|size
comma
id|u32
id|val
)paren
(brace
r_struct
id|mv_pci_controller
op_star
id|mvbc
op_assign
id|bus-&gt;sysdata
suffix:semicolon
r_int
r_int
id|address_reg
comma
id|data_reg
suffix:semicolon
id|u32
id|address
suffix:semicolon
id|address_reg
op_assign
id|mvbc-&gt;config_addr
suffix:semicolon
id|data_reg
op_assign
id|mvbc-&gt;config_vreg
suffix:semicolon
multiline_comment|/* Accessing device 31 crashes those Marvells.  Since years.&n;&t;   Will they ever make sane controllers ... */
r_if
c_cond
(paren
id|PCI_SLOT
c_func
(paren
id|devfn
)paren
op_eq
l_int|31
)paren
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
id|address
op_assign
(paren
id|bus-&gt;number
op_lshift
l_int|16
)paren
op_or
(paren
id|devfn
op_lshift
l_int|8
)paren
op_or
(paren
id|where
op_amp
l_int|0xfc
)paren
op_or
l_int|0x80000000
suffix:semicolon
multiline_comment|/* start the configuration cycle */
id|MV_WRITE
c_func
(paren
id|address_reg
comma
id|address
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
l_int|1
suffix:colon
id|MV_WRITE_8
c_func
(paren
id|data_reg
op_plus
(paren
id|where
op_amp
l_int|0x3
)paren
comma
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|MV_WRITE_16
c_func
(paren
id|data_reg
op_plus
(paren
id|where
op_amp
l_int|0x3
)paren
comma
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
id|MV_WRITE
c_func
(paren
id|data_reg
comma
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|variable|mv_pci_ops
r_struct
id|pci_ops
id|mv_pci_ops
op_assign
(brace
dot
id|read
op_assign
id|mv_read_config
comma
dot
id|write
op_assign
id|mv_write_config
)brace
suffix:semicolon
eof
