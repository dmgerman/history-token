multiline_comment|/*&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; *&n; * SNI specific PCI support for RM200/RM300.&n; *&n; * Copyright (C) 1997 - 2000, 2003 Ralf Baechle &lt;ralf@linux-mips.org&gt;&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;asm/sni.h&gt;
multiline_comment|/*&n; * It seems that on the RM200 only lower 3 bits of the 5 bit PCI device&n; * address are decoded.  We therefore manually have to reject attempts at&n; * reading outside this range.  Being on the paranoid side we only do this&n; * test for bus 0 and hope forwarding and decoding work properly for any&n; * subordinated busses.&n; *&n; * ASIC PCI only supports type 1 config cycles.&n; */
DECL|function|set_config_address
r_static
r_int
id|set_config_address
c_func
(paren
r_int
r_int
id|busno
comma
r_int
r_int
id|devfn
comma
r_int
id|reg
)paren
(brace
r_if
c_cond
(paren
(paren
id|devfn
OG
l_int|255
)paren
op_logical_or
(paren
id|reg
OG
l_int|255
)paren
)paren
r_return
id|PCIBIOS_BAD_REGISTER_NUMBER
suffix:semicolon
r_if
c_cond
(paren
id|busno
op_eq
l_int|0
op_logical_and
id|devfn
op_ge
id|PCI_DEVFN
c_func
(paren
l_int|8
comma
l_int|0
)paren
)paren
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
op_star
(paren
r_volatile
id|u32
op_star
)paren
id|PCIMT_CONFIG_ADDRESS
op_assign
(paren
(paren
id|busno
op_amp
l_int|0xff
)paren
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|devfn
op_amp
l_int|0xff
)paren
op_lshift
l_int|8
)paren
op_or
(paren
id|reg
op_amp
l_int|0xfc
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
DECL|function|pcimt_read
r_static
r_int
id|pcimt_read
c_func
(paren
r_struct
id|pci_bus
op_star
id|bus
comma
r_int
r_int
id|devfn
comma
r_int
id|reg
comma
r_int
id|size
comma
id|u32
op_star
id|val
)paren
(brace
r_int
id|res
suffix:semicolon
r_if
c_cond
(paren
(paren
id|res
op_assign
id|set_config_address
c_func
(paren
id|bus-&gt;number
comma
id|devfn
comma
id|reg
)paren
)paren
)paren
r_return
id|res
suffix:semicolon
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
l_int|1
suffix:colon
op_star
id|val
op_assign
op_star
(paren
r_volatile
id|u8
op_star
)paren
(paren
id|PCIMT_CONFIG_DATA
op_plus
(paren
id|reg
op_amp
l_int|3
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
op_star
id|val
op_assign
op_star
(paren
r_volatile
id|u16
op_star
)paren
(paren
id|PCIMT_CONFIG_DATA
op_plus
(paren
id|reg
op_amp
l_int|2
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
op_star
id|val
op_assign
op_star
(paren
r_volatile
id|u32
op_star
)paren
id|PCIMT_CONFIG_DATA
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|pcimt_write
r_static
r_int
id|pcimt_write
c_func
(paren
r_struct
id|pci_bus
op_star
id|bus
comma
r_int
r_int
id|devfn
comma
r_int
id|reg
comma
r_int
id|size
comma
id|u32
id|val
)paren
(brace
r_int
id|res
suffix:semicolon
r_if
c_cond
(paren
(paren
id|res
op_assign
id|set_config_address
c_func
(paren
id|bus-&gt;number
comma
id|devfn
comma
id|reg
)paren
)paren
)paren
r_return
id|res
suffix:semicolon
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
l_int|1
suffix:colon
op_star
(paren
r_volatile
id|u8
op_star
)paren
(paren
id|PCIMT_CONFIG_DATA
op_plus
(paren
id|reg
op_amp
l_int|3
)paren
)paren
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
op_star
(paren
r_volatile
id|u16
op_star
)paren
(paren
id|PCIMT_CONFIG_DATA
op_plus
(paren
id|reg
op_amp
l_int|2
)paren
)paren
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|4
suffix:colon
op_star
(paren
r_volatile
id|u32
op_star
)paren
id|PCIMT_CONFIG_DATA
op_assign
id|val
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|sni_pci_ops
r_struct
id|pci_ops
id|sni_pci_ops
op_assign
(brace
dot
id|read
op_assign
id|pcimt_read
comma
dot
id|write
op_assign
id|pcimt_write
comma
)brace
suffix:semicolon
eof
