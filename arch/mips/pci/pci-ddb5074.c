macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;asm/pci_channel.h&gt;
macro_line|#include &lt;asm/debug.h&gt;
macro_line|#include &lt;asm/ddb5xxx/ddb5xxx.h&gt;
DECL|variable|extpci_io_resource
r_static
r_struct
id|resource
id|extpci_io_resource
op_assign
(brace
l_string|&quot;pci IO space&quot;
comma
l_int|0x1000
comma
multiline_comment|/* leave some room for ISA bus */
id|DDB_PCI_IO_SIZE
op_minus
l_int|1
comma
id|IORESOURCE_IO
)brace
suffix:semicolon
DECL|variable|extpci_mem_resource
r_static
r_struct
id|resource
id|extpci_mem_resource
op_assign
(brace
l_string|&quot;pci memory space&quot;
comma
id|DDB_PCI_MEM_BASE
op_plus
l_int|0x00100000
comma
multiline_comment|/* leave 1 MB for RTC */
id|DDB_PCI_MEM_BASE
op_plus
id|DDB_PCI_MEM_SIZE
op_minus
l_int|1
comma
id|IORESOURCE_MEM
)brace
suffix:semicolon
r_extern
r_struct
id|pci_ops
id|ddb5476_ext_pci_ops
suffix:semicolon
DECL|variable|ddb5476_controller
r_struct
id|pci_controller
id|ddb5476_controller
op_assign
(brace
dot
id|pci_ops
op_assign
op_amp
id|ddb5476_ext_pci_ops
comma
dot
id|io_resource
op_assign
op_amp
id|extpci_io_resource
comma
dot
id|mem_resource
op_assign
op_amp
id|extpci_mem_resource
comma
)brace
suffix:semicolon
DECL|macro|PCI_EXT_INTA
mdefine_line|#define     PCI_EXT_INTA        8
DECL|macro|PCI_EXT_INTB
mdefine_line|#define     PCI_EXT_INTB        9
DECL|macro|PCI_EXT_INTC
mdefine_line|#define     PCI_EXT_INTC        10
DECL|macro|PCI_EXT_INTD
mdefine_line|#define     PCI_EXT_INTD        11
DECL|macro|PCI_EXT_INTE
mdefine_line|#define     PCI_EXT_INTE        12
DECL|macro|MAX_SLOT_NUM
mdefine_line|#define     MAX_SLOT_NUM        14
DECL|variable|irq_map
r_static
r_int
r_char
id|irq_map
(braket
id|MAX_SLOT_NUM
)braket
op_assign
(brace
(braket
l_int|0
)braket
op_assign
id|nile4_to_irq
c_func
(paren
id|PCI_EXT_INTE
)paren
comma
(braket
l_int|1
)braket
op_assign
id|nile4_to_irq
c_func
(paren
id|PCI_EXT_INTA
)paren
comma
(braket
l_int|2
)braket
op_assign
id|nile4_to_irq
c_func
(paren
id|PCI_EXT_INTA
)paren
comma
(braket
l_int|3
)braket
op_assign
id|nile4_to_irq
c_func
(paren
id|PCI_EXT_INTB
)paren
comma
(braket
l_int|4
)braket
op_assign
id|nile4_to_irq
c_func
(paren
id|PCI_EXT_INTC
)paren
comma
(braket
l_int|5
)braket
op_assign
id|nile4_to_irq
c_func
(paren
id|NILE4_INT_UART
)paren
comma
(braket
l_int|10
)braket
op_assign
id|nile4_to_irq
c_func
(paren
id|PCI_EXT_INTE
)paren
comma
(braket
l_int|13
)braket
op_assign
id|nile4_to_irq
c_func
(paren
id|PCI_EXT_INTE
)paren
comma
)brace
suffix:semicolon
DECL|function|pcibios_map_irq
r_int
id|__init
id|pcibios_map_irq
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
id|u8
id|slot
comma
id|u8
id|pin
)paren
(brace
r_return
id|irq_map
(braket
id|slot
)braket
suffix:semicolon
)brace
DECL|function|ddb_pci_reset_bus
r_void
id|__init
id|ddb_pci_reset_bus
c_func
(paren
r_void
)paren
(brace
id|u32
id|temp
suffix:semicolon
multiline_comment|/*&n;&t; * I am not sure about the &quot;official&quot; procedure, the following&n;&t; * steps work as far as I know:&n;&t; * We first set PCI cold reset bit (bit 31) in PCICTRL-H.&n;&t; * Then we clear the PCI warm reset bit (bit 30) to 0 in PCICTRL-H.&n;&t; * The same is true for both PCI channels.&n;&t; */
id|temp
op_assign
id|ddb_in32
c_func
(paren
id|DDB_PCICTRL
op_plus
l_int|4
)paren
suffix:semicolon
id|temp
op_or_assign
l_int|0x80000000
suffix:semicolon
id|ddb_out32
c_func
(paren
id|DDB_PCICTRL
op_plus
l_int|4
comma
id|temp
)paren
suffix:semicolon
id|temp
op_and_assign
op_complement
l_int|0xc0000000
suffix:semicolon
id|ddb_out32
c_func
(paren
id|DDB_PCICTRL
op_plus
l_int|4
comma
id|temp
)paren
suffix:semicolon
)brace
eof
