multiline_comment|/*&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; *&n; * Copyright (C) 1995, 1996, 1997, 2002 by Ralf Baechle&n; * Copyright (C) 2001, 2002, 2003 by Liam Davies (ldavies@agile.tv)&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;asm/pci.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/gt64120.h&gt;
macro_line|#include &lt;asm/cobalt/cobalt.h&gt;
multiline_comment|/*&n; * Accessing device 31 hangs the GT64120.  Not sure if this will also hang&n; * the GT64111, let&squot;s be paranoid for now.&n; */
DECL|function|pci_range_ck
r_static
r_inline
r_int
id|pci_range_ck
c_func
(paren
r_struct
id|pci_bus
op_star
id|bus
comma
r_int
r_int
id|devfn
)paren
(brace
r_if
c_cond
(paren
id|bus-&gt;number
op_eq
l_int|0
op_logical_and
id|devfn
op_eq
id|PCI_DEVFN
c_func
(paren
l_int|31
comma
l_int|0
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gt64111_pci_read_config
r_static
r_int
id|gt64111_pci_read_config
c_func
(paren
r_struct
id|pci_bus
op_star
id|bus
comma
r_int
r_int
id|devfn
comma
r_int
id|where
comma
r_int
id|size
comma
id|u32
op_star
id|val
)paren
(brace
r_if
c_cond
(paren
id|pci_range_ck
c_func
(paren
id|bus
comma
id|devfn
)paren
)paren
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
l_int|4
suffix:colon
id|PCI_CFG_SET
c_func
(paren
id|devfn
comma
id|where
)paren
suffix:semicolon
op_star
id|val
op_assign
id|GALILEO_INL
c_func
(paren
id|GT_PCI0_CFGDATA_OFS
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
r_case
l_int|2
suffix:colon
id|PCI_CFG_SET
c_func
(paren
id|devfn
comma
(paren
id|where
op_amp
op_complement
l_int|0x3
)paren
)paren
suffix:semicolon
op_star
id|val
op_assign
id|GALILEO_INL
c_func
(paren
id|GT_PCI0_CFGDATA_OFS
)paren
op_rshift
(paren
(paren
id|where
op_amp
l_int|3
)paren
op_star
l_int|8
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
r_case
l_int|1
suffix:colon
id|PCI_CFG_SET
c_func
(paren
id|devfn
comma
(paren
id|where
op_amp
op_complement
l_int|0x3
)paren
)paren
suffix:semicolon
op_star
id|val
op_assign
id|GALILEO_INL
c_func
(paren
id|GT_PCI0_CFGDATA_OFS
)paren
op_rshift
(paren
(paren
id|where
op_amp
l_int|3
)paren
op_star
l_int|8
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_return
id|PCIBIOS_BAD_REGISTER_NUMBER
suffix:semicolon
)brace
DECL|function|gt64111_pci_write_config
r_static
r_int
id|gt64111_pci_write_config
c_func
(paren
r_struct
id|pci_bus
op_star
id|bus
comma
r_int
r_int
id|devfn
comma
r_int
id|where
comma
r_int
id|size
comma
id|u32
id|val
)paren
(brace
id|u32
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|pci_range_ck
c_func
(paren
id|bus
comma
id|devfn
)paren
)paren
r_return
id|PCIBIOS_DEVICE_NOT_FOUND
suffix:semicolon
r_switch
c_cond
(paren
id|size
)paren
(brace
r_case
l_int|4
suffix:colon
id|PCI_CFG_SET
c_func
(paren
id|devfn
comma
id|where
)paren
suffix:semicolon
id|GALILEO_OUTL
c_func
(paren
id|val
comma
id|GT_PCI0_CFGDATA_OFS
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
r_case
l_int|2
suffix:colon
id|PCI_CFG_SET
c_func
(paren
id|devfn
comma
(paren
id|where
op_amp
op_complement
l_int|0x3
)paren
)paren
suffix:semicolon
id|tmp
op_assign
id|GALILEO_INL
c_func
(paren
id|GT_PCI0_CFGDATA_OFS
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
l_int|0xffff
op_lshift
(paren
(paren
id|where
op_amp
l_int|0x3
)paren
op_star
l_int|8
)paren
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|val
op_lshift
(paren
(paren
id|where
op_amp
l_int|0x3
)paren
op_star
l_int|8
)paren
)paren
suffix:semicolon
id|GALILEO_OUTL
c_func
(paren
id|tmp
comma
id|GT_PCI0_CFGDATA_OFS
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
r_case
l_int|1
suffix:colon
id|PCI_CFG_SET
c_func
(paren
id|devfn
comma
(paren
id|where
op_amp
op_complement
l_int|0x3
)paren
)paren
suffix:semicolon
id|tmp
op_assign
id|GALILEO_INL
c_func
(paren
id|GT_PCI0_CFGDATA_OFS
)paren
suffix:semicolon
id|tmp
op_and_assign
op_complement
(paren
l_int|0xff
op_lshift
(paren
(paren
id|where
op_amp
l_int|0x3
)paren
op_star
l_int|8
)paren
)paren
suffix:semicolon
id|tmp
op_or_assign
(paren
id|val
op_lshift
(paren
(paren
id|where
op_amp
l_int|0x3
)paren
op_star
l_int|8
)paren
)paren
suffix:semicolon
id|GALILEO_OUTL
c_func
(paren
id|tmp
comma
id|GT_PCI0_CFGDATA_OFS
)paren
suffix:semicolon
r_return
id|PCIBIOS_SUCCESSFUL
suffix:semicolon
)brace
r_return
id|PCIBIOS_BAD_REGISTER_NUMBER
suffix:semicolon
)brace
DECL|variable|gt64111_pci_ops
r_struct
id|pci_ops
id|gt64111_pci_ops
op_assign
(brace
dot
id|read
op_assign
id|gt64111_pci_read_config
comma
dot
id|write
op_assign
id|gt64111_pci_write_config
comma
)brace
suffix:semicolon
eof
