multiline_comment|/*&n; * The irq controller for vrc5476.&n; *&n; * Copyright (C) 2001 MontaVista Software Inc.&n; * Author: jsun@mvista.com or jsun@junsun.net&n; *&n; * This program is free software; you can redistribute  it and/or modify it&n; * under  the terms of  the GNU General  Public License as published by the&n; * Free Software Foundation;  either version 2 of the  License, or (at your&n; * option) any later version.&n; *&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/irq.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/ptrace.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/ddb5xxx/ddb5xxx.h&gt;
DECL|variable|irq_base
r_static
r_int
id|irq_base
suffix:semicolon
DECL|function|vrc5476_irq_enable
r_static
r_void
id|vrc5476_irq_enable
c_func
(paren
id|uint
id|irq
)paren
(brace
id|nile4_enable_irq
c_func
(paren
id|irq
op_minus
id|irq_base
)paren
suffix:semicolon
)brace
DECL|function|vrc5476_irq_disable
r_static
r_void
id|vrc5476_irq_disable
c_func
(paren
id|uint
id|irq
)paren
(brace
id|nile4_disable_irq
c_func
(paren
id|irq
op_minus
id|irq_base
)paren
suffix:semicolon
)brace
DECL|function|vrc5476_irq_startup
r_static
r_int
r_int
id|vrc5476_irq_startup
c_func
(paren
id|uint
id|irq
)paren
(brace
id|nile4_enable_irq
c_func
(paren
id|irq
op_minus
id|irq_base
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|vrc5476_irq_shutdown
mdefine_line|#define vrc5476_irq_shutdown&t;vrc5476_irq_disable
DECL|function|vrc5476_irq_ack
r_static
r_void
id|vrc5476_irq_ack
c_func
(paren
id|uint
id|irq
)paren
(brace
id|nile4_clear_irq
c_func
(paren
id|irq
op_minus
id|irq_base
)paren
suffix:semicolon
id|nile4_disable_irq
c_func
(paren
id|irq
op_minus
id|irq_base
)paren
suffix:semicolon
)brace
DECL|function|vrc5476_irq_end
r_static
r_void
id|vrc5476_irq_end
c_func
(paren
id|uint
id|irq
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|irq_desc
(braket
id|irq
)braket
dot
id|status
op_amp
(paren
id|IRQ_DISABLED
op_or
id|IRQ_INPROGRESS
)paren
)paren
)paren
(brace
id|vrc5476_irq_enable
c_func
(paren
id|irq
)paren
suffix:semicolon
)brace
)brace
DECL|variable|vrc5476_irq_controller
r_static
id|hw_irq_controller
id|vrc5476_irq_controller
op_assign
(brace
l_string|&quot;vrc5476&quot;
comma
id|vrc5476_irq_startup
comma
id|vrc5476_irq_shutdown
comma
id|vrc5476_irq_enable
comma
id|vrc5476_irq_disable
comma
id|vrc5476_irq_ack
comma
id|vrc5476_irq_end
comma
l_int|NULL
multiline_comment|/* no affinity stuff for UP */
)brace
suffix:semicolon
r_void
id|__init
DECL|function|vrc5476_irq_init
id|vrc5476_irq_init
c_func
(paren
id|u32
id|base
)paren
(brace
id|u32
id|i
suffix:semicolon
id|irq_base
op_assign
id|base
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|base
suffix:semicolon
id|i
OL
id|base
op_plus
id|NUM_VRC5476_IRQ
suffix:semicolon
id|i
op_increment
)paren
(brace
id|irq_desc
(braket
id|i
)braket
dot
id|status
op_assign
id|IRQ_DISABLED
suffix:semicolon
id|irq_desc
(braket
id|i
)braket
dot
id|action
op_assign
l_int|NULL
suffix:semicolon
id|irq_desc
(braket
id|i
)braket
dot
id|depth
op_assign
l_int|1
suffix:semicolon
id|irq_desc
(braket
id|i
)braket
dot
id|handler
op_assign
op_amp
id|vrc5476_irq_controller
suffix:semicolon
)brace
)brace
id|asmlinkage
r_void
DECL|function|vrc5476_irq_dispatch
id|vrc5476_irq_dispatch
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_extern
r_void
id|spurious_interrupt
c_func
(paren
r_void
)paren
suffix:semicolon
id|u32
id|mask
suffix:semicolon
r_int
id|nile4_irq
suffix:semicolon
id|mask
op_assign
id|nile4_get_irq_stat
c_func
(paren
l_int|0
)paren
suffix:semicolon
multiline_comment|/* quick check for possible time interrupt */
r_if
c_cond
(paren
id|mask
op_amp
(paren
l_int|1
op_lshift
id|VRC5476_IRQ_GPT
)paren
)paren
(brace
id|do_IRQ
c_func
(paren
id|VRC5476_IRQ_BASE
op_plus
id|VRC5476_IRQ_GPT
comma
id|regs
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* check for i8259 interrupts */
r_if
c_cond
(paren
id|mask
op_amp
(paren
l_int|1
op_lshift
id|VRC5476_I8259_CASCADE
)paren
)paren
(brace
r_int
id|i8259_irq
op_assign
id|nile4_i8259_iack
c_func
(paren
)paren
suffix:semicolon
id|do_IRQ
c_func
(paren
id|I8259_IRQ_BASE
op_plus
id|i8259_irq
comma
id|regs
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* regular nile4 interrupts (we should not really have any */
r_for
c_loop
(paren
id|nile4_irq
op_assign
l_int|0
suffix:semicolon
id|mask
suffix:semicolon
id|nile4_irq
op_increment
comma
id|mask
op_rshift_assign
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|mask
op_amp
l_int|1
)paren
(brace
id|do_IRQ
c_func
(paren
id|VRC5476_IRQ_BASE
op_plus
id|nile4_irq
comma
id|regs
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|spurious_interrupt
c_func
(paren
)paren
suffix:semicolon
)brace
eof
