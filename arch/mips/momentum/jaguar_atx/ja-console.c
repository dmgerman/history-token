multiline_comment|/*&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; *&n; * Copyright (C) 2001, 2002, 2004 Ralf Baechle&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/kdev_t.h&gt;
macro_line|#include &lt;linux/major.h&gt;
macro_line|#include &lt;linux/termios.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/tty.h&gt;
macro_line|#include &lt;linux/serial.h&gt;
macro_line|#include &lt;linux/serial_core.h&gt;
macro_line|#include &lt;asm/serial.h&gt;
multiline_comment|/* SUPERIO uart register map */
DECL|struct|ja_uartregs
r_struct
id|ja_uartregs
(brace
r_union
(brace
DECL|member|pad0
r_volatile
id|u8
id|pad0
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|rbr
r_volatile
id|u8
id|rbr
suffix:semicolon
multiline_comment|/* read only, DLAB == 0 */
DECL|member|pad1
r_volatile
id|u8
id|pad1
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|thr
r_volatile
id|u8
id|thr
suffix:semicolon
multiline_comment|/* write only, DLAB == 0 */
DECL|member|pad2
r_volatile
id|u8
id|pad2
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|dll
r_volatile
id|u8
id|dll
suffix:semicolon
multiline_comment|/* DLAB == 1 */
DECL|member|u1
)brace
id|u1
suffix:semicolon
r_union
(brace
DECL|member|pad0
r_volatile
id|u8
id|pad0
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|ier
r_volatile
id|u8
id|ier
suffix:semicolon
multiline_comment|/* DLAB == 0 */
DECL|member|pad1
r_volatile
id|u8
id|pad1
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|dlm
r_volatile
id|u8
id|dlm
suffix:semicolon
multiline_comment|/* DLAB == 1 */
DECL|member|u2
)brace
id|u2
suffix:semicolon
r_union
(brace
DECL|member|pad0
r_volatile
id|u8
id|pad0
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|iir
r_volatile
id|u8
id|iir
suffix:semicolon
multiline_comment|/* read only */
DECL|member|pad1
r_volatile
id|u8
id|pad1
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|fcr
r_volatile
id|u8
id|fcr
suffix:semicolon
multiline_comment|/* write only */
DECL|member|u3
)brace
id|u3
suffix:semicolon
DECL|member|pad0
r_volatile
id|u8
id|pad0
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|iu_lcr
r_volatile
id|u8
id|iu_lcr
suffix:semicolon
DECL|member|pad1
r_volatile
id|u8
id|pad1
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|iu_mcr
r_volatile
id|u8
id|iu_mcr
suffix:semicolon
DECL|member|pad2
r_volatile
id|u8
id|pad2
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|iu_lsr
r_volatile
id|u8
id|iu_lsr
suffix:semicolon
DECL|member|pad3
r_volatile
id|u8
id|pad3
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|iu_msr
r_volatile
id|u8
id|iu_msr
suffix:semicolon
DECL|member|pad4
r_volatile
id|u8
id|pad4
(braket
l_int|3
)braket
suffix:semicolon
DECL|member|iu_scr
r_volatile
id|u8
id|iu_scr
suffix:semicolon
DECL|variable|ja_uregs_t
)brace
id|ja_uregs_t
suffix:semicolon
DECL|macro|iu_rbr
mdefine_line|#define iu_rbr u1.rbr
DECL|macro|iu_thr
mdefine_line|#define iu_thr u1.thr
DECL|macro|iu_dll
mdefine_line|#define iu_dll u1.dll
DECL|macro|iu_ier
mdefine_line|#define iu_ier u2.ier
DECL|macro|iu_dlm
mdefine_line|#define iu_dlm u2.dlm
DECL|macro|iu_iir
mdefine_line|#define iu_iir u3.iir
DECL|macro|iu_fcr
mdefine_line|#define iu_fcr u3.fcr
r_extern
r_int
r_int
id|uart_base
suffix:semicolon
DECL|function|console_uart
r_static
r_inline
r_struct
id|ja_uartregs
op_star
id|console_uart
c_func
(paren
r_void
)paren
(brace
r_return
(paren
r_struct
id|ja_uartregs
op_star
)paren
(paren
id|uart_base
op_plus
l_int|0x23UL
)paren
suffix:semicolon
)brace
DECL|function|prom_putchar
r_void
id|prom_putchar
c_func
(paren
r_char
id|c
)paren
(brace
r_struct
id|ja_uartregs
op_star
id|uart
op_assign
id|console_uart
c_func
(paren
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|uart-&gt;iu_lsr
op_amp
l_int|0x20
)paren
op_eq
l_int|0
)paren
suffix:semicolon
id|uart-&gt;iu_thr
op_assign
id|c
suffix:semicolon
)brace
DECL|function|prom_getchar
r_char
id|__init
id|prom_getchar
c_func
(paren
r_void
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ja_console_probe
r_static
r_void
r_inline
id|ja_console_probe
c_func
(paren
r_void
)paren
(brace
r_struct
id|uart_port
id|up
suffix:semicolon
multiline_comment|/*&n;&t; * Register to interrupt zero because we share the interrupt with&n;&t; * the serial driver which we don&squot;t properly support yet.&n;&t; */
id|memset
c_func
(paren
op_amp
id|up
comma
l_int|0
comma
r_sizeof
(paren
id|up
)paren
)paren
suffix:semicolon
id|up.membase
op_assign
(paren
r_int
r_char
op_star
)paren
id|uart_base
op_plus
l_int|0x23UL
suffix:semicolon
id|up.irq
op_assign
id|JAGUAR_ATX_SERIAL1_IRQ
suffix:semicolon
id|up.uartclk
op_assign
id|JAGUAR_ATX_UART_CLK
suffix:semicolon
id|up.regshift
op_assign
l_int|2
suffix:semicolon
id|up.iotype
op_assign
id|UPIO_MEM
suffix:semicolon
id|up.flags
op_assign
id|ASYNC_BOOT_AUTOCONF
op_or
id|ASYNC_SKIP_TEST
suffix:semicolon
id|up.line
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|early_serial_setup
c_func
(paren
op_amp
id|up
)paren
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;Early serial init of port 0 failed&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|ja_setup_console
id|__init
r_void
id|ja_setup_console
c_func
(paren
r_void
)paren
(brace
id|ja_console_probe
c_func
(paren
)paren
suffix:semicolon
)brace
eof
