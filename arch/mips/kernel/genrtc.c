multiline_comment|/*&n; * A glue layer that provides RTC read/write to drivers/char/genrtc.c driver&n; * based on MIPS internal RTC routines.  It does take care locking&n; * issues so that we are SMP/Preemption safe.&n; *&n; * Copyright (C) 2004 MontaVista Software Inc.&n; * Author: Jun Sun, jsun@mvista.com or jsun@junsun.net&n; *&n; * Please read the COPYING file for all license details.&n; */
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;asm/rtc.h&gt;
macro_line|#include &lt;asm/time.h&gt;
DECL|variable|mips_rtc_lock
r_static
id|spinlock_t
id|mips_rtc_lock
op_assign
id|SPIN_LOCK_UNLOCKED
suffix:semicolon
DECL|function|get_rtc_time
r_int
r_int
id|get_rtc_time
c_func
(paren
r_struct
id|rtc_time
op_star
id|time
)paren
(brace
r_int
r_int
id|nowtime
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|mips_rtc_lock
)paren
suffix:semicolon
id|nowtime
op_assign
id|rtc_get_time
c_func
(paren
)paren
suffix:semicolon
id|to_tm
c_func
(paren
id|nowtime
comma
id|time
)paren
suffix:semicolon
id|time-&gt;tm_year
op_sub_assign
l_int|1900
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|mips_rtc_lock
)paren
suffix:semicolon
r_return
id|RTC_24H
suffix:semicolon
)brace
DECL|function|set_rtc_time
r_int
id|set_rtc_time
c_func
(paren
r_struct
id|rtc_time
op_star
id|time
)paren
(brace
r_int
r_int
id|nowtime
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|mips_rtc_lock
)paren
suffix:semicolon
id|nowtime
op_assign
id|mktime
c_func
(paren
id|time-&gt;tm_year
op_plus
l_int|1900
comma
id|time-&gt;tm_mon
op_plus
l_int|1
comma
id|time-&gt;tm_mday
comma
id|time-&gt;tm_hour
comma
id|time-&gt;tm_min
comma
id|time-&gt;tm_sec
)paren
suffix:semicolon
id|ret
op_assign
id|rtc_set_time
c_func
(paren
id|nowtime
)paren
suffix:semicolon
id|spin_unlock
c_func
(paren
op_amp
id|mips_rtc_lock
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|get_rtc_ss
r_int
r_int
id|get_rtc_ss
c_func
(paren
r_void
)paren
(brace
r_struct
id|rtc_time
id|h
suffix:semicolon
id|get_rtc_time
c_func
(paren
op_amp
id|h
)paren
suffix:semicolon
r_return
id|h.tm_sec
suffix:semicolon
)brace
DECL|function|get_rtc_pll
r_int
id|get_rtc_pll
c_func
(paren
r_struct
id|rtc_pll_info
op_star
id|pll
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|function|set_rtc_pll
r_int
id|set_rtc_pll
c_func
(paren
r_struct
id|rtc_pll_info
op_star
id|pll
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
eof
