multiline_comment|/*&n; *  pmu.c, Power Management Unit routines for NEC VR4100 series.&n; *&n; *  Copyright (C) 2003-2004  Yoichi Yuasa &lt;yuasa@hh.iij4u.or.jp&gt;&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or&n; *  (at your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;asm/cpu.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/reboot.h&gt;
macro_line|#include &lt;asm/system.h&gt;
DECL|macro|PMUCNT2REG
mdefine_line|#define PMUCNT2REG&t;KSEG1ADDR(0x0f0000c6)
DECL|macro|SOFTRST
mdefine_line|#define SOFTRST&t;0x0010
DECL|function|software_reset
r_static
r_inline
r_void
id|software_reset
c_func
(paren
r_void
)paren
(brace
r_uint16
id|val
suffix:semicolon
r_switch
c_cond
(paren
id|current_cpu_data.cputype
)paren
(brace
r_case
id|CPU_VR4122
suffix:colon
r_case
id|CPU_VR4131
suffix:colon
r_case
id|CPU_VR4133
suffix:colon
id|val
op_assign
id|readw
c_func
(paren
id|PMUCNT2REG
)paren
suffix:semicolon
id|val
op_or_assign
id|SOFTRST
suffix:semicolon
id|writew
c_func
(paren
id|val
comma
id|PMUCNT2REG
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
DECL|function|vr41xx_restart
r_static
r_void
id|vr41xx_restart
c_func
(paren
r_char
op_star
id|command
)paren
(brace
id|local_irq_disable
c_func
(paren
)paren
suffix:semicolon
id|software_reset
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;&bslash;nYou can reset your system&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|vr41xx_halt
r_static
r_void
id|vr41xx_halt
c_func
(paren
r_void
)paren
(brace
id|local_irq_disable
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;&bslash;nYou can turn off the power supply&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|vr41xx_power_off
r_static
r_void
id|vr41xx_power_off
c_func
(paren
r_void
)paren
(brace
id|local_irq_disable
c_func
(paren
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;&bslash;nYou can turn off the power supply&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|vr41xx_pmu_init
r_static
r_int
id|__init
id|vr41xx_pmu_init
c_func
(paren
r_void
)paren
(brace
id|_machine_restart
op_assign
id|vr41xx_restart
suffix:semicolon
id|_machine_halt
op_assign
id|vr41xx_halt
suffix:semicolon
id|_machine_power_off
op_assign
id|vr41xx_power_off
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|vr41xx_pmu_init
id|early_initcall
c_func
(paren
id|vr41xx_pmu_init
)paren
suffix:semicolon
eof
