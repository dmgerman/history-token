multiline_comment|/*&n; * arch/mips/vr41xx/nec-cmbvr4133/init.c&n; *&n; * PROM library initialisation code for NEC CMB-VR4133 board.&n; *&n; * Author: Yoichi Yuasa &lt;yyuasa@mvista.com, or source@mvista.com&gt; and&n; *         Jun Sun &lt;jsun@mvista.com, or source@mvista.com&gt; and&n; *         Alex Sapkov &lt;asapkov@ru.mvista.com&gt;&n; *&n; * 2001-2004 (c) MontaVista, Software, Inc. This file is licensed under&n; * the terms of the GNU General Public License version 2. This program&n; * is licensed &quot;as is&quot; without any warranty of any kind, whether express&n; * or implied.&n; *&n; * Support for NEC-CMBVR4133 in 2.6&n; * Manish Lachwani (mlachwani@mvista.com)&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#ifdef CONFIG_ROCKHOPPER
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
DECL|macro|PCICONFDREG
mdefine_line|#define PCICONFDREG&t;0xaf000c14
DECL|macro|PCICONFAREG
mdefine_line|#define PCICONFAREG&t;0xaf000c18
macro_line|#endif
DECL|function|get_system_type
r_const
r_char
op_star
id|get_system_type
c_func
(paren
r_void
)paren
(brace
r_return
l_string|&quot;NEC CMB-VR4133&quot;
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ROCKHOPPER
DECL|function|disable_pcnet
r_void
id|disable_pcnet
c_func
(paren
r_void
)paren
(brace
id|u32
id|data
suffix:semicolon
multiline_comment|/*&n;&t; * Workaround for the bug in PMON on VR4133. PMON leaves&n;&t; * AMD PCNet controller (on Rockhopper) initialized and running in&n;&t; * bus master mode. We have do disable it before doing any&n;&t; * further initialization. Or we get problems with PCI bus 2&n;&t; * and random lockups and crashes.&n;&t; */
id|writel
c_func
(paren
(paren
l_int|2
op_lshift
l_int|16
)paren
op_or
(paren
id|PCI_DEVFN
c_func
(paren
l_int|1
comma
l_int|0
)paren
op_lshift
l_int|8
)paren
op_or
(paren
l_int|0
op_amp
l_int|0xfc
)paren
op_or
l_int|1UL
comma
id|PCICONFAREG
)paren
suffix:semicolon
id|data
op_assign
id|readl
c_func
(paren
id|PCICONFDREG
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
l_int|2
op_lshift
l_int|16
)paren
op_or
(paren
id|PCI_DEVFN
c_func
(paren
l_int|1
comma
l_int|0
)paren
op_lshift
l_int|8
)paren
op_or
(paren
l_int|4
op_amp
l_int|0xfc
)paren
op_or
l_int|1UL
comma
id|PCICONFAREG
)paren
suffix:semicolon
id|data
op_assign
id|readl
c_func
(paren
id|PCICONFDREG
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
l_int|2
op_lshift
l_int|16
)paren
op_or
(paren
id|PCI_DEVFN
c_func
(paren
l_int|1
comma
l_int|0
)paren
op_lshift
l_int|8
)paren
op_or
(paren
l_int|4
op_amp
l_int|0xfc
)paren
op_or
l_int|1UL
comma
id|PCICONFAREG
)paren
suffix:semicolon
id|data
op_and_assign
op_complement
l_int|4
suffix:semicolon
id|writel
c_func
(paren
id|data
comma
id|PCICONFDREG
)paren
suffix:semicolon
)brace
macro_line|#endif
eof
