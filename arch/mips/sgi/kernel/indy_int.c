multiline_comment|/*&n; * indy_int.c: Routines for generic manipulation of the INT[23] ASIC&n; *             found on INDY workstations..&n; *&n; * Copyright (C) 1996 David S. Miller (dm@engr.sgi.com)&n; * Copyright (C) 1997, 1998 Ralf Baechle (ralf@gnu.org)&n; * Copyright (C) 1999 Andrew R. Baker (andrewb@uab.edu) &n; *                    - Indigo2 changes&n; *                    - Interrupt handling fixes&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/kernel_stat.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;linux/timex.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/random.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/bootinfo.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/mipsregs.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/sgi/sgi.h&gt;
macro_line|#include &lt;asm/sgi/sgihpc.h&gt;
macro_line|#include &lt;asm/sgi/sgint23.h&gt;
macro_line|#include &lt;asm/sgialib.h&gt;
macro_line|#include &lt;asm/gdb-stub.h&gt;
multiline_comment|/*&n; * Linux has a controller-independent x86 interrupt architecture.&n; * every controller has a &squot;controller-template&squot;, that is used&n; * by the main code to do the right thing. Each driver-visible&n; * interrupt source is transparently wired to the apropriate&n; * controller. Thus drivers need not be aware of the&n; * interrupt-controller.&n; *&n; * Various interrupt controllers we handle: 8259 PIC, SMP IO-APIC,&n; * PIIX4&squot;s internal 8259 PIC and SGI&squot;s Visual Workstation Cobalt (IO-)APIC.&n; * (IO-APICs assumed to be messaging to Pentium local-APICs)&n; *&n; * the code is designed to be easily extended with new/different&n; * interrupt controllers, without having to do assembly magic.&n; */
multiline_comment|/* #define DEBUG_SGINT */
DECL|variable|sgi_i2regs
r_struct
id|sgi_int2_regs
op_star
id|sgi_i2regs
suffix:semicolon
DECL|variable|sgi_i3regs
r_struct
id|sgi_int3_regs
op_star
id|sgi_i3regs
suffix:semicolon
DECL|variable|ioc_icontrol
r_struct
id|sgi_ioc_ints
op_star
id|ioc_icontrol
suffix:semicolon
DECL|variable|ioc_timers
r_struct
id|sgi_ioc_timers
op_star
id|ioc_timers
suffix:semicolon
DECL|variable|ioc_tclear
r_volatile
r_int
r_char
op_star
id|ioc_tclear
suffix:semicolon
DECL|variable|lc0msk_to_irqnr
r_static
r_char
id|lc0msk_to_irqnr
(braket
l_int|256
)braket
suffix:semicolon
DECL|variable|lc1msk_to_irqnr
r_static
r_char
id|lc1msk_to_irqnr
(braket
l_int|256
)braket
suffix:semicolon
DECL|variable|lc2msk_to_irqnr
r_static
r_char
id|lc2msk_to_irqnr
(braket
l_int|256
)braket
suffix:semicolon
DECL|variable|lc3msk_to_irqnr
r_static
r_char
id|lc3msk_to_irqnr
(braket
l_int|256
)braket
suffix:semicolon
r_extern
id|asmlinkage
r_void
id|indyIRQ
c_func
(paren
r_void
)paren
suffix:semicolon
multiline_comment|/* Local IRQ&squot;s are layed out logically like this:&n; *&n; * 0  --&gt; 7   ==   local 0 interrupts&n; * 8  --&gt; 15  ==   local 1 interrupts&n; * 16 --&gt; 23  ==   vectored level 2 interrupts&n; * 24 --&gt; 31  ==   vectored level 3 interrupts (not used)&n; */
DECL|function|enable_local0_irq
r_static
r_void
id|enable_local0_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|ioc_icontrol-&gt;imask0
op_or_assign
(paren
l_int|1
op_lshift
(paren
id|irq
op_minus
id|SGINT_LOCAL0
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|startup_local0_irq
r_static
r_int
r_int
id|startup_local0_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|enable_local0_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Never anything pending  */
)brace
DECL|function|disable_local0_irq
r_static
r_void
id|disable_local0_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|ioc_icontrol-&gt;imask0
op_and_assign
op_complement
(paren
l_int|1
op_lshift
(paren
id|irq
op_minus
id|SGINT_LOCAL0
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|macro|shutdown_local0_irq
mdefine_line|#define shutdown_local0_irq&t;disable_local0_irq
DECL|macro|mask_and_ack_local0_irq
mdefine_line|#define mask_and_ack_local0_irq&t;disable_local0_irq
DECL|function|end_local0_irq
r_static
r_void
id|end_local0_irq
(paren
r_int
r_int
id|irq
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|irq_desc
(braket
id|irq
)braket
dot
id|status
op_amp
(paren
id|IRQ_DISABLED
op_or
id|IRQ_INPROGRESS
)paren
)paren
)paren
id|enable_local0_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
)brace
DECL|variable|ip22_local0_irq_type
r_static
r_struct
id|hw_interrupt_type
id|ip22_local0_irq_type
op_assign
(brace
l_string|&quot;IP22 local 0&quot;
comma
id|startup_local0_irq
comma
id|shutdown_local0_irq
comma
id|enable_local0_irq
comma
id|disable_local0_irq
comma
id|mask_and_ack_local0_irq
comma
id|end_local0_irq
comma
l_int|NULL
)brace
suffix:semicolon
DECL|function|enable_local1_irq
r_static
r_void
id|enable_local1_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|ioc_icontrol-&gt;imask1
op_or_assign
(paren
l_int|1
op_lshift
(paren
id|irq
op_minus
id|SGINT_LOCAL1
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|startup_local1_irq
r_static
r_int
r_int
id|startup_local1_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|enable_local1_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Never anything pending  */
)brace
DECL|function|disable_local1_irq
r_void
id|disable_local1_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|ioc_icontrol-&gt;imask1
op_and_assign
op_complement
(paren
l_int|1
op_lshift
(paren
id|irq
op_minus
id|SGINT_LOCAL1
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|macro|shutdown_local1_irq
mdefine_line|#define shutdown_local1_irq&t;disable_local1_irq
DECL|macro|mask_and_ack_local1_irq
mdefine_line|#define mask_and_ack_local1_irq&t;disable_local1_irq
DECL|function|end_local1_irq
r_static
r_void
id|end_local1_irq
(paren
r_int
r_int
id|irq
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|irq_desc
(braket
id|irq
)braket
dot
id|status
op_amp
(paren
id|IRQ_DISABLED
op_or
id|IRQ_INPROGRESS
)paren
)paren
)paren
id|enable_local1_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
)brace
DECL|variable|ip22_local1_irq_type
r_static
r_struct
id|hw_interrupt_type
id|ip22_local1_irq_type
op_assign
(brace
l_string|&quot;IP22 local 1&quot;
comma
id|startup_local1_irq
comma
id|shutdown_local1_irq
comma
id|enable_local1_irq
comma
id|disable_local1_irq
comma
id|mask_and_ack_local1_irq
comma
id|end_local1_irq
comma
l_int|NULL
)brace
suffix:semicolon
DECL|function|enable_local2_irq
r_static
r_void
id|enable_local2_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|enable_local0_irq
c_func
(paren
l_int|7
)paren
suffix:semicolon
id|ioc_icontrol-&gt;cmeimask0
op_or_assign
(paren
l_int|1
op_lshift
(paren
id|irq
op_minus
id|SGINT_LOCAL2
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|startup_local2_irq
r_static
r_int
r_int
id|startup_local2_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|enable_local2_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Never anything pending  */
)brace
DECL|function|disable_local2_irq
r_void
id|disable_local2_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|ioc_icontrol-&gt;cmeimask0
op_and_assign
op_complement
(paren
l_int|1
op_lshift
(paren
id|irq
op_minus
id|SGINT_LOCAL2
)paren
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|macro|shutdown_local2_irq
mdefine_line|#define shutdown_local2_irq disable_local2_irq
DECL|macro|mask_and_ack_local2_irq
mdefine_line|#define mask_and_ack_local2_irq&t;disable_local2_irq
DECL|function|end_local2_irq
r_static
r_void
id|end_local2_irq
(paren
r_int
r_int
id|irq
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|irq_desc
(braket
id|irq
)braket
dot
id|status
op_amp
(paren
id|IRQ_DISABLED
op_or
id|IRQ_INPROGRESS
)paren
)paren
)paren
id|enable_local2_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
)brace
DECL|variable|ip22_local2_irq_type
r_static
r_struct
id|hw_interrupt_type
id|ip22_local2_irq_type
op_assign
(brace
l_string|&quot;IP22 local 2&quot;
comma
id|startup_local2_irq
comma
id|shutdown_local2_irq
comma
id|enable_local2_irq
comma
id|disable_local2_irq
comma
id|mask_and_ack_local2_irq
comma
id|end_local2_irq
comma
l_int|NULL
)brace
suffix:semicolon
DECL|function|enable_local3_irq
r_static
r_void
id|enable_local3_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Yeeee, got passed irq_nr %d at enable_local3_irq&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;INVALID IRQ level!&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|function|startup_local3_irq
r_static
r_int
r_int
id|startup_local3_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|enable_local3_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Never anything pending  */
)brace
DECL|function|disable_local3_irq
r_void
id|disable_local3_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * This way we&squot;ll see if anyone would ever want vectored level 3&n;&t; * interrupts.  Highly unlikely.&n;&t; */
id|printk
c_func
(paren
l_string|&quot;Yeeee, got passed irq_nr %d at disable_local3_irq&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;INVALID IRQ level!&quot;
)paren
suffix:semicolon
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
DECL|macro|shutdown_local3_irq
mdefine_line|#define shutdown_local3_irq disable_local3_irq
DECL|macro|mask_and_ack_local3_irq
mdefine_line|#define mask_and_ack_local3_irq&t;disable_local3_irq
DECL|function|end_local3_irq
r_static
r_void
id|end_local3_irq
(paren
r_int
r_int
id|irq
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|irq_desc
(braket
id|irq
)braket
dot
id|status
op_amp
(paren
id|IRQ_DISABLED
op_or
id|IRQ_INPROGRESS
)paren
)paren
)paren
id|enable_local3_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
)brace
DECL|variable|ip22_local3_irq_type
r_static
r_struct
id|hw_interrupt_type
id|ip22_local3_irq_type
op_assign
(brace
l_string|&quot;IP22 local 3&quot;
comma
id|startup_local3_irq
comma
id|shutdown_local3_irq
comma
id|enable_local3_irq
comma
id|disable_local3_irq
comma
id|mask_and_ack_local3_irq
comma
id|end_local3_irq
comma
l_int|NULL
)brace
suffix:semicolon
DECL|function|enable_gio_irq
r_void
id|enable_gio_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
multiline_comment|/* XXX TODO XXX */
)brace
DECL|function|startup_gio_irq
r_static
r_int
r_int
id|startup_gio_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|enable_gio_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Never anything pending  */
)brace
DECL|function|disable_gio_irq
r_void
id|disable_gio_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
multiline_comment|/* XXX TODO XXX */
)brace
DECL|macro|shutdown_gio_irq
mdefine_line|#define shutdown_gio_irq&t;disable_gio_irq
DECL|macro|mask_and_ack_gio_irq
mdefine_line|#define mask_and_ack_gio_irq&t;disable_gio_irq
DECL|function|end_gio_irq
r_static
r_void
id|end_gio_irq
(paren
r_int
r_int
id|irq
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|irq_desc
(braket
id|irq
)braket
dot
id|status
op_amp
(paren
id|IRQ_DISABLED
op_or
id|IRQ_INPROGRESS
)paren
)paren
)paren
id|enable_gio_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
)brace
DECL|variable|ip22_gio_irq_type
r_static
r_struct
id|hw_interrupt_type
id|ip22_gio_irq_type
op_assign
(brace
l_string|&quot;IP22 GIO&quot;
comma
id|startup_gio_irq
comma
id|shutdown_gio_irq
comma
id|enable_gio_irq
comma
id|disable_gio_irq
comma
id|mask_and_ack_gio_irq
comma
id|end_gio_irq
comma
l_int|NULL
)brace
suffix:semicolon
DECL|function|enable_hpcdma_irq
r_void
id|enable_hpcdma_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
multiline_comment|/* XXX TODO XXX */
)brace
DECL|function|startup_hpcdma_irq
r_static
r_int
r_int
id|startup_hpcdma_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
id|enable_hpcdma_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
multiline_comment|/* Never anything pending  */
)brace
DECL|function|disable_hpcdma_irq
r_void
id|disable_hpcdma_irq
c_func
(paren
r_int
r_int
id|irq
)paren
(brace
multiline_comment|/* XXX TODO XXX */
)brace
DECL|macro|shutdown_hpcdma_irq
mdefine_line|#define shutdown_hpcdma_irq&t;disable_hpcdma_irq
DECL|macro|mask_and_ack_hpcdma_irq
mdefine_line|#define mask_and_ack_hpcdma_irq&t;disable_hpcdma_irq
DECL|function|end_hpcdma_irq
r_static
r_void
id|end_hpcdma_irq
(paren
r_int
r_int
id|irq
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|irq_desc
(braket
id|irq
)braket
dot
id|status
op_amp
(paren
id|IRQ_DISABLED
op_or
id|IRQ_INPROGRESS
)paren
)paren
)paren
id|enable_hpcdma_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
)brace
DECL|variable|ip22_hpcdma_irq_type
r_static
r_struct
id|hw_interrupt_type
id|ip22_hpcdma_irq_type
op_assign
(brace
l_string|&quot;IP22 HPC DMA&quot;
comma
id|startup_hpcdma_irq
comma
id|shutdown_hpcdma_irq
comma
id|enable_hpcdma_irq
comma
id|disable_hpcdma_irq
comma
id|mask_and_ack_hpcdma_irq
comma
id|end_hpcdma_irq
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|r4ktimer_action
r_static
r_struct
id|irqaction
id|r4ktimer_action
op_assign
(brace
l_int|NULL
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;R4000 timer/counter&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
)brace
suffix:semicolon
DECL|variable|indy_berr_action
r_static
r_struct
id|irqaction
id|indy_berr_action
op_assign
(brace
l_int|NULL
comma
l_int|0
comma
l_int|0
comma
l_string|&quot;IP22 Bus Error&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
)brace
suffix:semicolon
DECL|variable|irq_action
r_static
r_struct
id|irqaction
op_star
id|irq_action
(braket
l_int|16
)braket
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
op_amp
id|indy_berr_action
comma
op_amp
id|r4ktimer_action
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
DECL|function|indy_local0_irqdispatch
r_void
id|indy_local0_irqdispatch
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_char
id|mask
op_assign
id|ioc_icontrol-&gt;istat0
suffix:semicolon
r_int
r_char
id|mask2
op_assign
l_int|0
suffix:semicolon
r_int
id|irq
suffix:semicolon
id|mask
op_and_assign
id|ioc_icontrol-&gt;imask0
suffix:semicolon
r_if
c_cond
(paren
id|mask
op_amp
id|ISTAT0_LIO2
)paren
(brace
id|mask2
op_assign
id|ioc_icontrol-&gt;vmeistat
suffix:semicolon
id|mask2
op_and_assign
id|ioc_icontrol-&gt;cmeimask0
suffix:semicolon
id|irq
op_assign
id|lc2msk_to_irqnr
(braket
id|mask2
)braket
suffix:semicolon
)brace
r_else
(brace
id|irq
op_assign
id|lc0msk_to_irqnr
(braket
id|mask
)braket
suffix:semicolon
)brace
multiline_comment|/* if irq == 0, then the interrupt has already been cleared */
r_if
c_cond
(paren
id|irq
op_eq
l_int|0
)paren
r_goto
id|end
suffix:semicolon
id|do_IRQ
c_func
(paren
id|irq
comma
id|regs
)paren
suffix:semicolon
r_goto
id|end
suffix:semicolon
id|no_handler
suffix:colon
id|printk
c_func
(paren
l_string|&quot;No handler for local0 irq: %i&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|end
suffix:colon
r_return
suffix:semicolon
)brace
DECL|function|indy_local1_irqdispatch
r_void
id|indy_local1_irqdispatch
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_char
id|mask
op_assign
id|ioc_icontrol-&gt;istat1
suffix:semicolon
r_int
r_char
id|mask2
op_assign
l_int|0
suffix:semicolon
r_int
id|irq
suffix:semicolon
id|mask
op_and_assign
id|ioc_icontrol-&gt;imask1
suffix:semicolon
r_if
c_cond
(paren
id|mask
op_amp
id|ISTAT1_LIO3
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;WHee: Got an LIO3 irq, winging it...&bslash;n&quot;
)paren
suffix:semicolon
id|mask2
op_assign
id|ioc_icontrol-&gt;vmeistat
suffix:semicolon
id|mask2
op_and_assign
id|ioc_icontrol-&gt;cmeimask1
suffix:semicolon
id|irq
op_assign
id|lc3msk_to_irqnr
(braket
id|ioc_icontrol-&gt;vmeistat
)braket
suffix:semicolon
)brace
r_else
(brace
id|irq
op_assign
id|lc1msk_to_irqnr
(braket
id|mask
)braket
suffix:semicolon
)brace
multiline_comment|/* if irq == 0, then the interrupt has already been cleared */
multiline_comment|/* not sure if it is needed here, but it is needed for local0 */
r_if
c_cond
(paren
id|irq
op_eq
l_int|0
)paren
r_goto
id|end
suffix:semicolon
id|do_IRQ
c_func
(paren
id|irq
comma
id|regs
)paren
suffix:semicolon
r_goto
id|end
suffix:semicolon
id|no_handler
suffix:colon
id|printk
c_func
(paren
l_string|&quot;No handler for local1 irq: %i&bslash;n&quot;
comma
id|irq
)paren
suffix:semicolon
id|end
suffix:colon
r_return
suffix:semicolon
)brace
DECL|function|indy_buserror_irq
r_void
id|indy_buserror_irq
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
id|cpu
op_assign
id|smp_processor_id
c_func
(paren
)paren
suffix:semicolon
r_int
id|irq
op_assign
l_int|6
suffix:semicolon
id|irq_enter
c_func
(paren
id|cpu
comma
id|irq
)paren
suffix:semicolon
id|kstat.irqs
(braket
l_int|0
)braket
(braket
id|irq
)braket
op_increment
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Got a bus error IRQ, shouldn&squot;t happen yet&bslash;n&quot;
)paren
suffix:semicolon
id|show_regs
c_func
(paren
id|regs
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Spinning...&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
suffix:semicolon
)brace
id|irq_exit
c_func
(paren
id|cpu
comma
id|irq
)paren
suffix:semicolon
)brace
DECL|function|init_IRQ
r_void
id|__init
id|init_IRQ
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|sgi_i2regs
op_assign
(paren
r_struct
id|sgi_int2_regs
op_star
)paren
(paren
id|KSEG1
op_plus
id|SGI_INT2_BASE
)paren
suffix:semicolon
id|sgi_i3regs
op_assign
(paren
r_struct
id|sgi_int3_regs
op_star
)paren
(paren
id|KSEG1
op_plus
id|SGI_INT3_BASE
)paren
suffix:semicolon
multiline_comment|/* Init local mask --&gt; irq tables. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|i
op_amp
l_int|0x80
)paren
(brace
id|lc0msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|7
suffix:semicolon
id|lc1msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|15
suffix:semicolon
id|lc2msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|23
suffix:semicolon
id|lc3msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|31
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|i
op_amp
l_int|0x40
)paren
(brace
id|lc0msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|6
suffix:semicolon
id|lc1msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|14
suffix:semicolon
id|lc2msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|22
suffix:semicolon
id|lc3msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|30
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|i
op_amp
l_int|0x20
)paren
(brace
id|lc0msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|5
suffix:semicolon
id|lc1msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|13
suffix:semicolon
id|lc2msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|21
suffix:semicolon
id|lc3msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|29
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|i
op_amp
l_int|0x10
)paren
(brace
id|lc0msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|4
suffix:semicolon
id|lc1msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|12
suffix:semicolon
id|lc2msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|20
suffix:semicolon
id|lc3msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|28
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|i
op_amp
l_int|0x08
)paren
(brace
id|lc0msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|3
suffix:semicolon
id|lc1msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|11
suffix:semicolon
id|lc2msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|19
suffix:semicolon
id|lc3msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|27
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|i
op_amp
l_int|0x04
)paren
(brace
id|lc0msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|2
suffix:semicolon
id|lc1msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|10
suffix:semicolon
id|lc2msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|18
suffix:semicolon
id|lc3msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|26
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|i
op_amp
l_int|0x02
)paren
(brace
id|lc0msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|1
suffix:semicolon
id|lc1msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|9
suffix:semicolon
id|lc2msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|17
suffix:semicolon
id|lc3msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|25
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|i
op_amp
l_int|0x01
)paren
(brace
id|lc0msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|lc1msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|8
suffix:semicolon
id|lc2msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|16
suffix:semicolon
id|lc3msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|24
suffix:semicolon
)brace
r_else
(brace
id|lc0msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|lc1msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|lc2msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
id|lc3msk_to_irqnr
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/* Indy uses an INT3, Indigo2 uses an INT2 */
r_if
c_cond
(paren
id|sgi_guiness
)paren
(brace
id|ioc_icontrol
op_assign
op_amp
id|sgi_i3regs-&gt;ints
suffix:semicolon
id|ioc_timers
op_assign
op_amp
id|sgi_i3regs-&gt;timers
suffix:semicolon
id|ioc_tclear
op_assign
op_amp
id|sgi_i3regs-&gt;tclear
suffix:semicolon
)brace
r_else
(brace
id|ioc_icontrol
op_assign
op_amp
id|sgi_i2regs-&gt;ints
suffix:semicolon
id|ioc_timers
op_assign
op_amp
id|sgi_i2regs-&gt;timers
suffix:semicolon
id|ioc_tclear
op_assign
op_amp
id|sgi_i2regs-&gt;tclear
suffix:semicolon
)brace
multiline_comment|/* Mask out all interrupts. */
id|ioc_icontrol-&gt;imask0
op_assign
l_int|0
suffix:semicolon
id|ioc_icontrol-&gt;imask1
op_assign
l_int|0
suffix:semicolon
id|ioc_icontrol-&gt;cmeimask0
op_assign
l_int|0
suffix:semicolon
id|ioc_icontrol-&gt;cmeimask1
op_assign
l_int|0
suffix:semicolon
id|set_except_vector
c_func
(paren
l_int|0
comma
id|indyIRQ
)paren
suffix:semicolon
id|init_generic_irq
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|SGINT_LOCAL0
suffix:semicolon
id|i
OL
id|SGINT_END
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hw_irq_controller
op_star
id|handler
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|SGINT_LOCAL1
)paren
id|handler
op_assign
op_amp
id|ip22_local0_irq_type
suffix:semicolon
r_else
r_if
c_cond
(paren
id|i
OL
id|SGINT_LOCAL2
)paren
id|handler
op_assign
op_amp
id|ip22_local1_irq_type
suffix:semicolon
r_else
r_if
c_cond
(paren
id|i
OL
id|SGINT_LOCAL3
)paren
id|handler
op_assign
op_amp
id|ip22_local2_irq_type
suffix:semicolon
r_else
r_if
c_cond
(paren
id|i
OL
id|SGINT_GIO
)paren
id|handler
op_assign
op_amp
id|ip22_local3_irq_type
suffix:semicolon
r_else
r_if
c_cond
(paren
id|i
OL
id|SGINT_HPCDMA
)paren
id|handler
op_assign
op_amp
id|ip22_gio_irq_type
suffix:semicolon
r_else
r_if
c_cond
(paren
id|i
OL
id|SGINT_END
)paren
id|handler
op_assign
op_amp
id|ip22_hpcdma_irq_type
suffix:semicolon
id|irq_desc
(braket
id|i
)braket
dot
id|status
op_assign
id|IRQ_DISABLED
suffix:semicolon
id|irq_desc
(braket
id|i
)braket
dot
id|action
op_assign
l_int|0
suffix:semicolon
id|irq_desc
(braket
id|i
)braket
dot
id|depth
op_assign
l_int|1
suffix:semicolon
id|irq_desc
(braket
id|i
)braket
dot
id|handler
op_assign
id|handler
suffix:semicolon
)brace
)brace
eof
