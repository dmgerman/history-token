multiline_comment|/*&n; *&n; *&n; *&n; *&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;utils.h&quot;
DECL|macro|miu_chan_cfg
mdefine_line|#define  miu_chan_cfg(x)      ((volatile unsigned long  *)(0xbff40000+x*4))       /* for andros */
DECL|variable|mbsize
r_int
id|mbsize
(braket
l_int|8
)braket
op_assign
(brace
l_int|1
comma
l_int|2
comma
l_int|4
comma
l_int|8
comma
l_int|16
comma
l_int|32
comma
l_int|64
comma
l_int|128
)brace
suffix:semicolon
DECL|function|get_mem_avail
r_int
r_int
id|get_mem_avail
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|cfg
(braket
l_int|10
)braket
comma
id|i
comma
id|total_mem
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cfg
(braket
id|i
)braket
op_assign
op_star
id|miu_chan_cfg
c_func
(paren
id|i
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|10
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|cfg
(braket
id|i
)braket
op_eq
l_int|0x1fc160c2
)paren
(brace
r_continue
suffix:semicolon
)brace
singleline_comment|// skip empties
r_if
c_cond
(paren
(paren
(paren
id|cfg
(braket
id|i
)braket
op_rshift
l_int|12
)paren
op_amp
l_int|0xf
)paren
op_le
l_int|0xb
)paren
(brace
r_continue
suffix:semicolon
)brace
singleline_comment|// skip roms
id|total_mem
op_add_assign
id|mbsize
(braket
(paren
id|cfg
(braket
id|i
)braket
op_rshift
l_int|16
)paren
op_amp
l_int|0x7
)braket
op_star
l_int|1024
op_star
l_int|1024
suffix:semicolon
)brace
r_return
id|total_mem
suffix:semicolon
)brace
DECL|variable|buffer_ptr
r_static
id|ulong
op_star
id|buffer_ptr
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|buffer_size
r_static
id|ulong
id|buffer_size
op_assign
l_int|0
suffix:semicolon
DECL|function|get_reserved_buffer
id|ulong
op_star
id|get_reserved_buffer
c_func
(paren
r_void
)paren
(brace
r_return
id|KSEG0ADDR
c_func
(paren
id|buffer_ptr
)paren
suffix:semicolon
)brace
DECL|function|get_reserved_buffer_virtual
id|ulong
op_star
id|get_reserved_buffer_virtual
c_func
(paren
r_void
)paren
(brace
r_return
(paren
id|ulong
op_star
)paren
id|ReservedMemVirtualAddr
suffix:semicolon
)brace
DECL|function|get_reserved_buffer_size
id|ulong
id|get_reserved_buffer_size
c_func
(paren
r_void
)paren
(brace
r_return
id|buffer_size
suffix:semicolon
)brace
DECL|macro|MIN_GEN_MEM
mdefine_line|#define MIN_GEN_MEM (4 &lt;&lt; 20)
DECL|function|reserve_buffer
r_void
id|reserve_buffer
c_func
(paren
r_const
r_char
op_star
id|cl
comma
id|ulong
id|base_mem
)paren
(brace
r_char
op_star
id|pos
op_assign
id|strstr
c_func
(paren
id|cl
comma
l_string|&quot;reserved_buffer=&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pos
)paren
(brace
id|buffer_size
op_assign
id|simple_strtol
c_func
(paren
id|pos
op_plus
id|strlen
c_func
(paren
l_string|&quot;reserved_buffer=&quot;
)paren
comma
l_int|0
comma
l_int|10
)paren
suffix:semicolon
id|buffer_size
op_lshift_assign
l_int|20
suffix:semicolon
r_if
c_cond
(paren
id|buffer_size
op_plus
id|MIN_GEN_MEM
OG
id|base_mem
)paren
id|buffer_size
op_assign
id|base_mem
op_minus
id|MIN_GEN_MEM
suffix:semicolon
r_if
c_cond
(paren
id|buffer_size
OG
l_int|0
)paren
id|buffer_ptr
op_assign
(paren
id|ulong
op_star
)paren
(paren
id|base_mem
op_minus
id|buffer_size
)paren
suffix:semicolon
r_else
id|buffer_size
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|variable|get_reserved_buffer
id|EXPORT_SYMBOL
c_func
(paren
id|get_reserved_buffer
)paren
suffix:semicolon
DECL|variable|get_reserved_buffer_virtual
id|EXPORT_SYMBOL
c_func
(paren
id|get_reserved_buffer_virtual
)paren
suffix:semicolon
DECL|variable|get_reserved_buffer_size
id|EXPORT_SYMBOL
c_func
(paren
id|get_reserved_buffer_size
)paren
suffix:semicolon
eof
