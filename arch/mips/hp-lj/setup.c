multiline_comment|/*&n; * Setup pointers to hardware-dependent routines.&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; *&n; * Copyright (C) 1996, 1997, 1998 by Ralf Baechle&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/hdreg.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/ide.h&gt;
macro_line|#include &lt;linux/bootmem.h&gt;
macro_line|#include &lt;asm/mc146818rtc.h&gt;
macro_line|#include &lt;asm/reboot.h&gt;
macro_line|#include &lt;asm/time.h&gt;
macro_line|#include &lt;asm/hp-lj/asic.h&gt;
macro_line|#include &quot;utils.h&quot;
macro_line|#ifdef CONFIG_KGDB
DECL|variable|remote_debug
r_int
id|remote_debug
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
DECL|function|get_system_type
r_const
r_char
op_star
id|get_system_type
c_func
(paren
r_void
)paren
(brace
r_return
l_string|&quot;HP LaserJet&quot;
suffix:semicolon
multiline_comment|/* But which exactly?  */
)brace
DECL|variable|timer_interrupt_service
r_static
r_void
(paren
op_star
id|timer_interrupt_service
)paren
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
op_assign
l_int|NULL
suffix:semicolon
DECL|function|andros_timer_interrupt
r_static
r_void
id|andros_timer_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
(paren
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xbfea0010
)paren
op_amp
l_int|0x20
)paren
)paren
singleline_comment|// mask = pend &amp; en
r_return
suffix:semicolon
multiline_comment|/* clear timer interrupt */
(brace
r_int
r_int
id|tmr
op_assign
op_star
(paren
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xbfe90040
)paren
suffix:semicolon
singleline_comment|// ctl bits
op_star
(paren
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xbfe90040
)paren
op_assign
id|tmr
suffix:semicolon
singleline_comment|// write to ack
op_star
(paren
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xbfea000c
)paren
op_assign
l_int|0x20
suffix:semicolon
singleline_comment|// sys int ack
)brace
multiline_comment|/* service interrupt */
id|timer_interrupt_service
c_func
(paren
id|irq
comma
id|dev_id
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|harmony_timer_interrupt
r_static
r_void
id|harmony_timer_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
(paren
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xbff63000
)paren
op_amp
l_int|0x01
)paren
)paren
r_return
suffix:semicolon
singleline_comment|// big sys     int reg, 01-timer  did it
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
(paren
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xbff610a4
)paren
op_amp
l_int|0x01
)paren
)paren
r_return
suffix:semicolon
singleline_comment|// local small int reg, 01-timer0 did it
op_star
(paren
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xbff610a4
)paren
op_assign
l_int|1
suffix:semicolon
singleline_comment|// ack local timer0 bit
op_star
(paren
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xbff63000
)paren
op_assign
l_int|1
suffix:semicolon
singleline_comment|// ack global timer bit
multiline_comment|/* service interrupt */
id|timer_interrupt_service
c_func
(paren
id|irq
comma
id|dev_id
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|macro|ASIC_IRQ_NUMBER
mdefine_line|#define ASIC_IRQ_NUMBER  2
DECL|function|hp_time_init
r_static
r_void
id|__init
id|hp_time_init
c_func
(paren
r_struct
id|irqaction
op_star
id|irq
)paren
(brace
id|timer_interrupt_service
op_assign
id|irq-&gt;handler
suffix:semicolon
r_if
c_cond
(paren
id|GetAsicId
c_func
(paren
)paren
op_eq
id|AndrosAsic
)paren
(brace
singleline_comment|//*((volatile unsigned int*)0xbfe90000) = 0x2f;  // set by bootloader to 0x20              // prescaler
op_star
(paren
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xbfe90040
)paren
op_assign
l_int|0x21
suffix:semicolon
singleline_comment|// 20-res of 1kHz,1-int ack                // control
op_star
(paren
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xbfe90048
)paren
op_assign
l_int|0x09
suffix:semicolon
singleline_comment|// 09-reload val                          // reload
op_star
(paren
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xbfe90044
)paren
op_assign
l_int|0x09
suffix:semicolon
singleline_comment|// 09-count val                           // count
op_star
(paren
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xbfe90040
)paren
op_assign
l_int|0x2f
suffix:semicolon
singleline_comment|// 8-int enable,4-reload en,2-count down en,1-int-ack
id|irq-&gt;handler
op_assign
id|andros_timer_interrupt
suffix:semicolon
id|irq-&gt;flags
op_or_assign
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;setting up timer in hp_time_init&bslash;n&quot;
)paren
suffix:semicolon
id|setup_irq
c_func
(paren
id|ASIC_IRQ_NUMBER
comma
id|irq
)paren
suffix:semicolon
singleline_comment|// enable timer interrupt
op_star
(paren
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xbfea0000
)paren
op_assign
l_int|0x20
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|GetAsicId
c_func
(paren
)paren
op_eq
id|HarmonyAsic
)paren
(brace
op_star
(paren
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xbff61000
)paren
op_assign
l_int|99
suffix:semicolon
singleline_comment|// prescaler, 100Mz sys clk
op_star
(paren
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xbff61028
)paren
op_assign
l_int|0x09
suffix:semicolon
singleline_comment|// reload reg
op_star
(paren
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xbff61024
)paren
op_assign
l_int|0x09
suffix:semicolon
singleline_comment|// count reg
op_star
(paren
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xbff61020
)paren
op_assign
l_int|0x0b
suffix:semicolon
singleline_comment|// 80-1khz res on timer, 2 reload en, 1 - count down en
id|irq-&gt;handler
op_assign
id|harmony_timer_interrupt
suffix:semicolon
id|irq-&gt;flags
op_or_assign
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
suffix:semicolon
id|setup_irq
c_func
(paren
id|ASIC_IRQ_NUMBER
comma
id|irq
)paren
suffix:semicolon
op_star
(paren
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xbff610a0
)paren
op_or_assign
l_int|1
suffix:semicolon
singleline_comment|// turn on timer0
)brace
r_else
r_if
c_cond
(paren
id|GetAsicId
c_func
(paren
)paren
op_eq
id|UnknownAsic
)paren
id|printk
c_func
(paren
l_string|&quot;Unknown asic in hp_time_init()&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot;Unsupported asic in hp_time_init()&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|hplj_restart
r_static
r_void
id|hplj_restart
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|GetAsicId
c_func
(paren
)paren
op_eq
id|AndrosAsic
)paren
op_star
(paren
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xbfe900c0
)paren
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|GetAsicId
c_func
(paren
)paren
op_eq
id|HarmonyAsic
)paren
op_star
(paren
(paren
r_volatile
r_int
r_int
op_star
)paren
l_int|0xbff62030
)paren
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Restart Failed ... halting instead&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
(brace
suffix:semicolon
)brace
)brace
DECL|function|hplj_halt
r_static
r_void
id|hplj_halt
c_func
(paren
r_void
)paren
(brace
r_while
c_loop
(paren
l_int|1
)paren
(brace
suffix:semicolon
)brace
)brace
DECL|function|hp_setup
r_void
id|__init
id|hp_setup
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_PCI
r_extern
r_void
id|pci_setup
c_func
(paren
r_void
)paren
suffix:semicolon
id|pci_setup
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef CONFIG_IDE
(brace
r_extern
r_struct
id|ide_ops
id|std_ide_ops
suffix:semicolon
id|ide_ops
op_assign
op_amp
id|std_ide_ops
suffix:semicolon
)brace
macro_line|#endif
id|_machine_restart
op_assign
(paren
r_void
(paren
op_star
)paren
(paren
r_char
op_star
)paren
)paren
id|hplj_restart
suffix:semicolon
id|_machine_halt
op_assign
id|hplj_halt
suffix:semicolon
id|_machine_power_off
op_assign
id|hplj_halt
suffix:semicolon
id|board_timer_setup
op_assign
id|hp_time_init
suffix:semicolon
macro_line|#ifdef CONFIG_KGDB
(brace
r_extern
r_char
id|CommandLine
(braket
)braket
suffix:semicolon
id|remote_debug
op_assign
(paren
id|strstr
c_func
(paren
id|CommandLine
comma
l_string|&quot;kgdb&quot;
)paren
op_ne
l_int|NULL
)paren
suffix:semicolon
)brace
macro_line|#endif
id|printk
c_func
(paren
l_string|&quot;HP SETUP&bslash;n&quot;
)paren
suffix:semicolon
)brace
eof
