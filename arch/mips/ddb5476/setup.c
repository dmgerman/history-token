multiline_comment|/*&n; *  arch/mips/ddb5476/setup.c -- NEC DDB Vrc-5476 setup routines&n; *&n; *  Copyright (C) 2000 Geert Uytterhoeven &lt;geert@sonycom.com&gt;&n; *                     Sony Software Development Center Europe (SDCE), Brussels&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kbd_ll.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/kdev_t.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/console.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/mc146818rtc.h&gt;
macro_line|#include &lt;linux/pc_keyb.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/ide.h&gt;
macro_line|#include &lt;asm/addrspace.h&gt;
macro_line|#include &lt;asm/bcache.h&gt;
macro_line|#include &lt;asm/keyboard.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/reboot.h&gt;
macro_line|#include &lt;asm/gdb-stub.h&gt;
macro_line|#include &lt;asm/nile4.h&gt;
macro_line|#ifdef CONFIG_REMOTE_DEBUG
r_extern
r_void
id|rs_kgdb_hook
c_func
(paren
r_int
)paren
suffix:semicolon
r_extern
r_void
id|breakpoint
c_func
(paren
r_void
)paren
suffix:semicolon
macro_line|#endif
macro_line|#if defined(CONFIG_SERIAL_CONSOLE)
r_extern
r_void
id|console_setup
c_func
(paren
r_char
op_star
)paren
suffix:semicolon
macro_line|#endif
r_extern
r_struct
id|ide_ops
id|std_ide_ops
suffix:semicolon
r_extern
r_struct
id|rtc_ops
id|ddb_rtc_ops
suffix:semicolon
r_extern
r_struct
id|kbd_ops
id|std_kbd_ops
suffix:semicolon
DECL|variable|back_to_prom
r_static
r_void
(paren
op_star
id|back_to_prom
)paren
(paren
r_void
)paren
op_assign
(paren
r_void
(paren
op_star
)paren
(paren
r_void
)paren
)paren
l_int|0xbfc00000
suffix:semicolon
DECL|function|ddb_machine_restart
r_static
r_void
id|ddb_machine_restart
c_func
(paren
r_char
op_star
id|command
)paren
(brace
id|u32
id|t
suffix:semicolon
multiline_comment|/* PCI cold reset */
id|t
op_assign
id|nile4_in32
c_func
(paren
id|NILE4_PCICTRL
op_plus
l_int|4
)paren
suffix:semicolon
id|t
op_or_assign
l_int|0x40000000
suffix:semicolon
id|nile4_out32
c_func
(paren
id|NILE4_PCICTRL
op_plus
l_int|4
comma
id|t
)paren
suffix:semicolon
multiline_comment|/* CPU cold reset */
id|t
op_assign
id|nile4_in32
c_func
(paren
id|NILE4_CPUSTAT
)paren
suffix:semicolon
id|t
op_or_assign
l_int|1
suffix:semicolon
id|nile4_out32
c_func
(paren
id|NILE4_CPUSTAT
comma
id|t
)paren
suffix:semicolon
multiline_comment|/* Call the PROM */
id|back_to_prom
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|ddb_machine_halt
r_static
r_void
id|ddb_machine_halt
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;DDB Vrc-5476 halted.&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|ddb_machine_power_off
r_static
r_void
id|ddb_machine_power_off
c_func
(paren
r_void
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;DDB Vrc-5476 halted. Please turn off the power.&bslash;n&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_extern
r_void
id|ddb_irq_setup
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|variable|board_time_init
r_void
(paren
op_star
id|board_time_init
)paren
(paren
r_struct
id|irqaction
op_star
id|irq
)paren
suffix:semicolon
DECL|function|ddb_time_init
r_static
r_void
id|__init
id|ddb_time_init
c_func
(paren
r_struct
id|irqaction
op_star
id|irq
)paren
(brace
multiline_comment|/* set the clock to 1 Hz */
id|nile4_out32
c_func
(paren
id|NILE4_T2CTRL
comma
l_int|1000000
)paren
suffix:semicolon
multiline_comment|/* enable the General-Purpose Timer */
id|nile4_out32
c_func
(paren
id|NILE4_T2CTRL
op_plus
l_int|4
comma
l_int|0x00000001
)paren
suffix:semicolon
multiline_comment|/* reset timer */
id|nile4_out32
c_func
(paren
id|NILE4_T2CNTR
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* enable interrupt */
id|nile4_enable_irq
c_func
(paren
id|NILE4_INT_GPT
)paren
suffix:semicolon
id|i8259_setup_irq
c_func
(paren
id|nile4_to_irq
c_func
(paren
id|NILE4_INT_GPT
)paren
comma
id|irq
)paren
suffix:semicolon
)brace
r_static
r_struct
(brace
DECL|member|dma1
r_struct
id|resource
id|dma1
suffix:semicolon
DECL|member|pic1
r_struct
id|resource
id|pic1
suffix:semicolon
DECL|member|timer
r_struct
id|resource
id|timer
suffix:semicolon
DECL|member|rtc
r_struct
id|resource
id|rtc
suffix:semicolon
DECL|member|dma_page_reg
r_struct
id|resource
id|dma_page_reg
suffix:semicolon
DECL|member|pic2
r_struct
id|resource
id|pic2
suffix:semicolon
DECL|member|dma2
r_struct
id|resource
id|dma2
suffix:semicolon
DECL|variable|ddb5476_ioport
)brace
id|ddb5476_ioport
op_assign
(brace
(brace
l_string|&quot;dma1&quot;
comma
l_int|0x00
comma
l_int|0x1f
comma
id|IORESOURCE_BUSY
)brace
comma
(brace
l_string|&quot;pic1&quot;
comma
l_int|0x20
comma
l_int|0x3f
comma
id|IORESOURCE_BUSY
)brace
comma
(brace
l_string|&quot;timer&quot;
comma
l_int|0x40
comma
l_int|0x5f
comma
id|IORESOURCE_BUSY
)brace
comma
(brace
l_string|&quot;rtc&quot;
comma
l_int|0x70
comma
l_int|0x7f
comma
id|IORESOURCE_BUSY
)brace
comma
(brace
l_string|&quot;dma page reg&quot;
comma
l_int|0x80
comma
l_int|0x8f
comma
id|IORESOURCE_BUSY
)brace
comma
(brace
l_string|&quot;pic2&quot;
comma
l_int|0xa0
comma
l_int|0xbf
comma
id|IORESOURCE_BUSY
)brace
comma
(brace
l_string|&quot;dma2&quot;
comma
l_int|0xc0
comma
l_int|0xdf
comma
id|IORESOURCE_BUSY
)brace
)brace
suffix:semicolon
r_static
r_struct
(brace
DECL|member|nile4
r_struct
id|resource
id|nile4
suffix:semicolon
DECL|variable|ddb5476_iomem
)brace
id|ddb5476_iomem
op_assign
(brace
(brace
l_string|&quot;Nile 4&quot;
comma
id|NILE4_BASE
comma
id|NILE4_BASE
op_plus
id|NILE4_SIZE
op_minus
l_int|1
comma
id|IORESOURCE_BUSY
)brace
)brace
suffix:semicolon
DECL|function|ddb_setup
r_void
id|__init
id|ddb_setup
c_func
(paren
r_void
)paren
(brace
r_extern
r_int
id|panic_timeout
suffix:semicolon
id|irq_setup
op_assign
id|ddb_irq_setup
suffix:semicolon
id|mips_io_port_base
op_assign
id|NILE4_PCI_IO_BASE
suffix:semicolon
id|isa_slot_offset
op_assign
id|NILE4_PCI_MEM_BASE
suffix:semicolon
id|board_time_init
op_assign
id|ddb_time_init
suffix:semicolon
id|_machine_restart
op_assign
id|ddb_machine_restart
suffix:semicolon
id|_machine_halt
op_assign
id|ddb_machine_halt
suffix:semicolon
id|_machine_power_off
op_assign
id|ddb_machine_power_off
suffix:semicolon
multiline_comment|/* request io port/mem resources  */
r_if
c_cond
(paren
id|request_resource
c_func
(paren
op_amp
id|ioport_resource
comma
op_amp
id|ddb5476_ioport.dma1
)paren
op_logical_or
id|request_resource
c_func
(paren
op_amp
id|ioport_resource
comma
op_amp
id|ddb5476_ioport.pic1
)paren
op_logical_or
id|request_resource
c_func
(paren
op_amp
id|ioport_resource
comma
op_amp
id|ddb5476_ioport.timer
)paren
op_logical_or
id|request_resource
c_func
(paren
op_amp
id|ioport_resource
comma
op_amp
id|ddb5476_ioport.rtc
)paren
op_logical_or
id|request_resource
c_func
(paren
op_amp
id|ioport_resource
comma
op_amp
id|ddb5476_ioport.dma_page_reg
)paren
op_logical_or
id|request_resource
c_func
(paren
op_amp
id|ioport_resource
comma
op_amp
id|ddb5476_ioport.pic2
)paren
op_logical_or
id|request_resource
c_func
(paren
op_amp
id|ioport_resource
comma
op_amp
id|ddb5476_ioport.dma2
)paren
op_logical_or
id|request_resource
c_func
(paren
op_amp
id|iomem_resource
comma
op_amp
id|ddb5476_iomem.nile4
)paren
)paren
(brace
id|printk
(paren
l_string|&quot;ddb_setup - requesting oo port resources failed.&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_BLK_DEV_IDE
id|ide_ops
op_assign
op_amp
id|std_ide_ops
suffix:semicolon
macro_line|#endif
id|rtc_ops
op_assign
op_amp
id|ddb_rtc_ops
suffix:semicolon
macro_line|#ifdef CONFIG_PC_KEYB
id|kbd_ops
op_assign
op_amp
id|std_kbd_ops
suffix:semicolon
macro_line|#endif
multiline_comment|/* Reboot on panic */
id|panic_timeout
op_assign
l_int|180
suffix:semicolon
multiline_comment|/* [jsun] we need to set BAR0 so that SDRAM 0 appears at 0x0 in PCI */
multiline_comment|/* *(long*)0xbfa00218 = 0x8; */
macro_line|#ifdef CONFIG_FB
id|conswitchp
op_assign
op_amp
id|dummy_con
suffix:semicolon
macro_line|#endif
multiline_comment|/* board initialization stuff - non-fundamental, but need to be set&n;&t; * before kernel runs */
multiline_comment|/* setup I/O space */
id|nile4_set_pdar
c_func
(paren
id|NILE4_PCIW0
comma
id|PHYSADDR
c_func
(paren
id|NILE4_PCI_IO_BASE
)paren
comma
l_int|0x02000000
comma
l_int|32
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|nile4_set_pmr
c_func
(paren
id|NILE4_PCIINIT0
comma
id|NILE4_PCICMD_IO
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* map config space to 0xa8000000, 128MB */
id|nile4_set_pdar
c_func
(paren
id|NILE4_PCIW1
comma
id|PHYSADDR
c_func
(paren
id|NILE4_PCI_CFG_BASE
)paren
comma
l_int|0x08000000
comma
l_int|32
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|nile4_set_pmr
c_func
(paren
id|NILE4_PCIINIT1
comma
id|NILE4_PCICMD_CFG
comma
l_int|0x0
)paren
suffix:semicolon
multiline_comment|/* ----- M1543 PCI setup ------ */
multiline_comment|/* we know M1543 PCI-ISA controller is at addr:18 */
multiline_comment|/* xxxx1010 makes USB at addr:13 and PMU at addr:14 */
op_star
(paren
r_volatile
r_int
r_char
op_star
)paren
l_int|0xa8040072
op_and_assign
l_int|0xf0
suffix:semicolon
op_star
(paren
r_volatile
r_int
r_char
op_star
)paren
l_int|0xa8040072
op_or_assign
l_int|0xa
suffix:semicolon
multiline_comment|/* setup USB interrupt to IRQ 9, (bit 0:3 - 0001)&n;&t; * no IOCHRDY signal, (bit 7 - 1)&n;&t; * M1543C &amp; M7101 VID and Subsys Device ID are read-only (bit 6 - 1)&n;&t; * Bypass USB Master INTAJ level to edge conversion (bit 4 - 0)&n;&t; */
op_star
(paren
r_int
r_char
op_star
)paren
l_int|0xa8040074
op_assign
l_int|0xc1
suffix:semicolon
multiline_comment|/* setup PMU(SCI to IRQ 10 (bit 0:3 - 0011)&n;&t; * SCI routing to IRQ 13 disabled (bit 7 - 1)&n;&t; * SCI interrupt level to edge conversion bypassed (bit 4 - 0)&n;&t; */
op_star
(paren
r_int
r_char
op_star
)paren
l_int|0xa8040076
op_assign
l_int|0x83
suffix:semicolon
multiline_comment|/* setup IDE controller&n;&t; * enable IDE controller (bit 6 - 1)&n;&t; * IDE IDSEL to be addr:24 (bit 4:5 - 11)&n;&t; * no IDE ATA Secondary Bus Signal Pad Control (bit 3 - 0)&n;&t; * no IDE ATA Primary Bus Signal Pad Control (bit 2 - 0)&n;&t; * primary IRQ is 14, secondary is 15 (bit 1:0 - 01&n;&t; */
singleline_comment|// *(unsigned char*)0xa8040058 = 0x71;
singleline_comment|// *(unsigned char*)0xa8040058 = 0x79;
singleline_comment|// *(unsigned char*)0xa8040058 = 0x74;              // use SIRQ, primary tri-state
op_star
(paren
r_int
r_char
op_star
)paren
l_int|0xa8040058
op_assign
l_int|0x75
suffix:semicolon
singleline_comment|// primary tri-state
macro_line|#if 0
multiline_comment|/* this is not necessary if M5229 does not use SIRQ */
op_star
(paren
r_int
r_char
op_star
)paren
l_int|0xa8040044
op_assign
l_int|0x0d
suffix:semicolon
singleline_comment|// primary to IRQ 14
op_star
(paren
r_int
r_char
op_star
)paren
l_int|0xa8040075
op_assign
l_int|0x0d
suffix:semicolon
singleline_comment|// secondary to IRQ 14
macro_line|#endif
multiline_comment|/* enable IDE in the M5229 config register 0x50 (bit 0 - 1) */
multiline_comment|/* M5229 IDSEL is addr:24; see above setting */
op_star
(paren
r_int
r_char
op_star
)paren
l_int|0xa9000050
op_or_assign
l_int|0x1
suffix:semicolon
multiline_comment|/* enable bus master (bit 2)  and IO decoding  (bit 0) */
op_star
(paren
r_int
r_char
op_star
)paren
l_int|0xa9000004
op_or_assign
l_int|0x5
suffix:semicolon
multiline_comment|/* enable native, copied from arch/ppc/k2boot/head.S */
multiline_comment|/* TODO - need volatile, need to be portable */
op_star
(paren
r_int
r_char
op_star
)paren
l_int|0xa9000009
op_assign
l_int|0xff
suffix:semicolon
multiline_comment|/* ----- end of M1543 PCI setup ------ */
multiline_comment|/* ----- reset on-board ether chip  ------ */
op_star
(paren
(paren
r_volatile
id|u32
op_star
)paren
l_int|0xa8020004
)paren
op_or_assign
l_int|1
suffix:semicolon
multiline_comment|/* decode I/O */
op_star
(paren
(paren
r_volatile
id|u32
op_star
)paren
l_int|0xa8020010
)paren
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* set BAR address */
multiline_comment|/* send reset command */
op_star
(paren
(paren
r_volatile
id|u32
op_star
)paren
l_int|0xa6000000
)paren
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* do a soft reset */
multiline_comment|/* disable ether chip */
op_star
(paren
(paren
r_volatile
id|u32
op_star
)paren
l_int|0xa8020004
)paren
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* disable any decoding */
multiline_comment|/* put it into sleep */
op_star
(paren
(paren
r_volatile
id|u32
op_star
)paren
l_int|0xa8020040
)paren
op_assign
l_int|0x80000000
suffix:semicolon
multiline_comment|/* ----- end of reset on-board ether chip  ------ */
multiline_comment|/* ----- set pci window 1 to pci memory space -------- */
id|nile4_set_pdar
c_func
(paren
id|NILE4_PCIW1
comma
id|PHYSADDR
c_func
(paren
id|NILE4_PCI_MEM_BASE
)paren
comma
l_int|0x08000000
comma
l_int|32
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
singleline_comment|// nile4_set_pmr(NILE4_PCIINIT1, NILE4_PCICMD_MEM, 0);
id|nile4_set_pmr
c_func
(paren
id|NILE4_PCIINIT1
comma
id|NILE4_PCICMD_MEM
comma
l_int|0x08000000
)paren
suffix:semicolon
)brace
DECL|macro|USE_NILE4_SERIAL
mdefine_line|#define USE_NILE4_SERIAL&t;0
macro_line|#if USE_NILE4_SERIAL
DECL|macro|ns16550_in
mdefine_line|#define ns16550_in(reg)&t;&t;nile4_in8((reg)*8)
DECL|macro|ns16550_out
mdefine_line|#define ns16550_out(reg, val)&t;nile4_out8((reg)*8, (val))
macro_line|#else
DECL|macro|NS16550_BASE
mdefine_line|#define NS16550_BASE&t;&t;(NILE4_PCI_IO_BASE+0x03f8)
DECL|function|ns16550_in
r_static
r_inline
id|u8
id|ns16550_in
c_func
(paren
id|u32
id|reg
)paren
(brace
r_return
op_star
(paren
r_volatile
id|u8
op_star
)paren
(paren
id|NS16550_BASE
op_plus
id|reg
)paren
suffix:semicolon
)brace
DECL|function|ns16550_out
r_static
r_inline
r_void
id|ns16550_out
c_func
(paren
id|u32
id|reg
comma
id|u8
id|val
)paren
(brace
op_star
(paren
r_volatile
id|u8
op_star
)paren
(paren
id|NS16550_BASE
op_plus
id|reg
)paren
op_assign
id|val
suffix:semicolon
)brace
macro_line|#endif
DECL|macro|NS16550_RBR
mdefine_line|#define NS16550_RBR&t;&t;0
DECL|macro|NS16550_THR
mdefine_line|#define NS16550_THR&t;&t;0
DECL|macro|NS16550_DLL
mdefine_line|#define NS16550_DLL&t;&t;0
DECL|macro|NS16550_IER
mdefine_line|#define NS16550_IER&t;&t;1
DECL|macro|NS16550_DLM
mdefine_line|#define NS16550_DLM&t;&t;1
DECL|macro|NS16550_FCR
mdefine_line|#define NS16550_FCR&t;&t;2
DECL|macro|NS16550_IIR
mdefine_line|#define NS16550_IIR&t;&t;2
DECL|macro|NS16550_LCR
mdefine_line|#define NS16550_LCR&t;&t;3
DECL|macro|NS16550_MCR
mdefine_line|#define NS16550_MCR&t;&t;4
DECL|macro|NS16550_LSR
mdefine_line|#define NS16550_LSR&t;&t;5
DECL|macro|NS16550_MSR
mdefine_line|#define NS16550_MSR&t;&t;6
DECL|macro|NS16550_SCR
mdefine_line|#define NS16550_SCR&t;&t;7
DECL|macro|NS16550_LSR_DR
mdefine_line|#define NS16550_LSR_DR&t;&t;0x01&t;/* Data ready */
DECL|macro|NS16550_LSR_OE
mdefine_line|#define NS16550_LSR_OE&t;&t;0x02&t;/* Overrun */
DECL|macro|NS16550_LSR_PE
mdefine_line|#define NS16550_LSR_PE&t;&t;0x04&t;/* Parity error */
DECL|macro|NS16550_LSR_FE
mdefine_line|#define NS16550_LSR_FE&t;&t;0x08&t;/* Framing error */
DECL|macro|NS16550_LSR_BI
mdefine_line|#define NS16550_LSR_BI&t;&t;0x10&t;/* Break */
DECL|macro|NS16550_LSR_THRE
mdefine_line|#define NS16550_LSR_THRE&t;0x20&t;/* Xmit holding register empty */
DECL|macro|NS16550_LSR_TEMT
mdefine_line|#define NS16550_LSR_TEMT&t;0x40&t;/* Xmitter empty */
DECL|macro|NS16550_LSR_ERR
mdefine_line|#define NS16550_LSR_ERR&t;&t;0x80&t;/* Error */
DECL|function|_serinit
r_void
id|_serinit
c_func
(paren
r_void
)paren
(brace
macro_line|#if USE_NILE4_SERIAL
id|ns16550_out
c_func
(paren
id|NS16550_LCR
comma
l_int|0x80
)paren
suffix:semicolon
id|ns16550_out
c_func
(paren
id|NS16550_DLM
comma
l_int|0x00
)paren
suffix:semicolon
id|ns16550_out
c_func
(paren
id|NS16550_DLL
comma
l_int|0x36
)paren
suffix:semicolon
multiline_comment|/* 9600 baud */
id|ns16550_out
c_func
(paren
id|NS16550_LCR
comma
l_int|0x00
)paren
suffix:semicolon
id|ns16550_out
c_func
(paren
id|NS16550_LCR
comma
l_int|0x03
)paren
suffix:semicolon
id|ns16550_out
c_func
(paren
id|NS16550_FCR
comma
l_int|0x47
)paren
suffix:semicolon
macro_line|#else
multiline_comment|/* done by PMON */
macro_line|#endif
)brace
DECL|function|_putc
r_void
id|_putc
c_func
(paren
r_char
id|c
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|ns16550_in
c_func
(paren
id|NS16550_LSR
)paren
op_amp
id|NS16550_LSR_THRE
)paren
)paren
suffix:semicolon
id|ns16550_out
c_func
(paren
id|NS16550_THR
comma
id|c
)paren
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;&bslash;n&squot;
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|ns16550_in
c_func
(paren
id|NS16550_LSR
)paren
op_amp
id|NS16550_LSR_THRE
)paren
)paren
suffix:semicolon
id|ns16550_out
c_func
(paren
id|NS16550_THR
comma
l_char|&squot;&bslash;r&squot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|_puts
r_void
id|_puts
c_func
(paren
r_const
r_char
op_star
id|s
)paren
(brace
r_char
id|c
suffix:semicolon
r_while
c_loop
(paren
(paren
id|c
op_assign
op_star
id|s
op_increment
)paren
)paren
id|_putc
c_func
(paren
id|c
)paren
suffix:semicolon
)brace
DECL|function|_getc
r_char
id|_getc
c_func
(paren
r_void
)paren
(brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|ns16550_in
c_func
(paren
id|NS16550_LSR
)paren
op_amp
id|NS16550_LSR_DR
)paren
)paren
suffix:semicolon
r_return
id|ns16550_in
c_func
(paren
id|NS16550_RBR
)paren
suffix:semicolon
)brace
DECL|function|_testc
r_int
id|_testc
c_func
(paren
r_void
)paren
(brace
r_return
(paren
id|ns16550_in
c_func
(paren
id|NS16550_LSR
)paren
op_amp
id|NS16550_LSR_DR
)paren
op_ne
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; *  Hexadecimal 7-segment LED&n; */
DECL|function|ddb5476_led_hex
r_void
id|ddb5476_led_hex
c_func
(paren
r_int
id|hex
)paren
(brace
id|outb
c_func
(paren
id|hex
comma
l_int|0x80
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  LEDs D2 and D3, connected to the GPIO pins of the PMU in the ALi M1543&n; */
DECL|variable|pci_pmu
r_struct
id|pci_dev
op_star
id|pci_pmu
op_assign
l_int|NULL
suffix:semicolon
DECL|function|ddb5476_led_d2
r_void
id|ddb5476_led_d2
c_func
(paren
r_int
id|on
)paren
(brace
id|u8
id|t
suffix:semicolon
r_if
c_cond
(paren
id|pci_pmu
)paren
(brace
id|pci_read_config_byte
c_func
(paren
id|pci_pmu
comma
l_int|0x7e
comma
op_amp
id|t
)paren
suffix:semicolon
r_if
c_cond
(paren
id|on
)paren
id|t
op_and_assign
l_int|0x7f
suffix:semicolon
r_else
id|t
op_or_assign
l_int|0x80
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pci_pmu
comma
l_int|0x7e
comma
id|t
)paren
suffix:semicolon
)brace
)brace
DECL|function|ddb5476_led_d3
r_void
id|ddb5476_led_d3
c_func
(paren
r_int
id|on
)paren
(brace
id|u8
id|t
suffix:semicolon
r_if
c_cond
(paren
id|pci_pmu
)paren
(brace
id|pci_read_config_byte
c_func
(paren
id|pci_pmu
comma
l_int|0x7e
comma
op_amp
id|t
)paren
suffix:semicolon
r_if
c_cond
(paren
id|on
)paren
id|t
op_and_assign
l_int|0xbf
suffix:semicolon
r_else
id|t
op_or_assign
l_int|0x40
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|pci_pmu
comma
l_int|0x7e
comma
id|t
)paren
suffix:semicolon
)brace
)brace
eof
