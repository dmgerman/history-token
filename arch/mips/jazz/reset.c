multiline_comment|/*&n; * Reset a Jazz machine.&n; */
macro_line|#include &lt;linux/jiffies.h&gt;
macro_line|#include &lt;asm/jazz.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/reboot.h&gt;
macro_line|#include &lt;asm/delay.h&gt;
DECL|function|kb_wait
r_static
r_inline
r_void
id|kb_wait
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|start
op_assign
id|jiffies
suffix:semicolon
r_int
r_int
id|timeout
op_assign
id|start
op_plus
id|HZ
op_div
l_int|2
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|kbd_read_status
c_func
(paren
)paren
op_amp
l_int|0x02
)paren
)paren
r_return
suffix:semicolon
)brace
id|time_before_eq
c_func
(paren
id|jiffies
comma
id|timeout
)paren
suffix:semicolon
)brace
DECL|function|jazz_machine_restart
r_void
id|jazz_machine_restart
c_func
(paren
r_char
op_star
id|command
)paren
(brace
r_while
c_loop
(paren
l_int|1
)paren
(brace
id|kb_wait
(paren
)paren
suffix:semicolon
id|kbd_write_command
(paren
l_int|0xd1
)paren
suffix:semicolon
id|kb_wait
(paren
)paren
suffix:semicolon
id|kbd_write_output
(paren
l_int|0x00
)paren
suffix:semicolon
)brace
)brace
DECL|function|jazz_machine_halt
r_void
id|jazz_machine_halt
c_func
(paren
r_void
)paren
(brace
)brace
DECL|function|jazz_machine_power_off
r_void
id|jazz_machine_power_off
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Jazz machines don&squot;t have a software power switch */
)brace
eof
