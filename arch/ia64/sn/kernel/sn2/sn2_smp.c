multiline_comment|/*&n; * SN2 Platform specific SMP Support&n; *&n; * Copyright (C) 2000-2002 Silicon Graphics, Inc. All rights reserved.&n; * &n; * This program is free software; you can redistribute it and/or modify it &n; * under the terms of version 2 of the GNU General Public License &n; * as published by the Free Software Foundation.&n; * &n; * This program is distributed in the hope that it would be useful, but &n; * WITHOUT ANY WARRANTY; without even the implied warranty of &n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. &n; * &n; * Further, this software is distributed without any warranty that it is &n; * free of the rightful claim of any third person regarding infringement &n; * or the like.  Any license provided herein, whether implied or &n; * otherwise, applies only to this software file.  Patent licenses, if &n; * any, provided herein do not apply to combinations of this program with &n; * other software, or any other product whatsoever.&n; * &n; * You should have received a copy of the GNU General Public &n; * License along with this program; if not, write the Free Software &n; * Foundation, Inc., 59 Temple Place - Suite 330, Boston MA 02111-1307, USA.&n; * &n; * Contact information:  Silicon Graphics, Inc., 1600 Amphitheatre Pkwy, &n; * Mountain View, CA  94043, or:&n; * &n; * http://www.sgi.com &n; * &n; * For further information regarding this notice, see: &n; * &n; * http://oss.sgi.com/projects/GenInfo/NoticeExplan&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/spinlock.h&gt;
macro_line|#include &lt;linux/threads.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/irq.h&gt;
macro_line|#include &lt;linux/mmzone.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/sal.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/smp.h&gt;
macro_line|#include &lt;asm/hw_irq.h&gt;
macro_line|#include &lt;asm/current.h&gt;
macro_line|#include &lt;asm/sn/sn_cpuid.h&gt;
macro_line|#include &lt;asm/sn/addrs.h&gt;
macro_line|#include &lt;asm/sn/sn2/shub_mmr.h&gt;
multiline_comment|/**&n; * sn2_global_tlb_purge - globally purge translation cache of virtual address range&n; * @start: start of virtual address range&n; * @end: end of virtual address range&n; * @nbits: specifies number of bytes to purge per instruction (num = 1&lt;&lt;(nbits &amp; 0xfc))&n; *&n; * Purges the translation caches of all processors of the given virtual address&n; * range.&n; */
r_void
DECL|function|sn2_global_tlb_purge
id|sn2_global_tlb_purge
(paren
r_int
r_int
id|start
comma
r_int
r_int
id|end
comma
r_int
r_int
id|nbits
)paren
(brace
r_int
id|cnode
comma
id|nasid
suffix:semicolon
r_volatile
r_int
op_star
id|ptc0
comma
op_star
id|ptc1
comma
op_star
id|piows
suffix:semicolon
r_int
r_int
id|ws
comma
id|next
comma
id|data0
comma
id|data1
suffix:semicolon
id|piows
op_assign
(paren
r_int
op_star
)paren
id|LOCAL_MMR_ADDR
c_func
(paren
id|get_slice
c_func
(paren
)paren
ques
c_cond
id|SH_PIO_WRITE_STATUS_1
suffix:colon
id|SH_PIO_WRITE_STATUS_0
)paren
suffix:semicolon
id|data0
op_assign
(paren
l_int|1UL
op_lshift
id|SH_PTC_0_A_SHFT
)paren
op_or
(paren
id|nbits
op_lshift
id|SH_PTC_0_PS_SHFT
)paren
op_or
(paren
(paren
id|ia64_get_rr
c_func
(paren
id|start
)paren
op_rshift
l_int|8
)paren
op_lshift
id|SH_PTC_0_RID_SHFT
)paren
op_or
(paren
l_int|1UL
op_lshift
id|SH_PTC_0_START_SHFT
)paren
suffix:semicolon
id|ptc0
op_assign
(paren
r_int
op_star
)paren
id|GLOBAL_MMR_ADDR
c_func
(paren
l_int|0
comma
id|SH_PTC_0
)paren
suffix:semicolon
id|ptc1
op_assign
(paren
r_int
op_star
)paren
id|GLOBAL_MMR_ADDR
c_func
(paren
l_int|0
comma
id|SH_PTC_1
)paren
suffix:semicolon
r_do
(brace
op_star
(paren
id|piows
op_plus
l_int|1
)paren
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/* use alias address to clear bits*/
id|next
op_assign
id|start
suffix:semicolon
r_do
(brace
r_for
c_loop
(paren
id|cnode
op_assign
l_int|0
suffix:semicolon
id|cnode
OL
id|numnodes
suffix:semicolon
id|cnode
op_increment
)paren
(brace
id|nasid
op_assign
id|cnodeid_to_nasid
c_func
(paren
id|cnode
)paren
suffix:semicolon
id|ptc0
op_assign
id|CHANGE_NASID
c_func
(paren
id|nasid
comma
id|ptc0
)paren
suffix:semicolon
id|ptc1
op_assign
id|CHANGE_NASID
c_func
(paren
id|nasid
comma
id|ptc1
)paren
suffix:semicolon
id|data1
op_assign
id|next
op_or
(paren
l_int|1UL
op_lshift
id|SH_PTC_1_START_SHFT
)paren
suffix:semicolon
op_star
id|ptc0
op_assign
id|data0
suffix:semicolon
op_star
id|ptc1
op_assign
id|data1
suffix:semicolon
)brace
id|next
op_add_assign
(paren
l_int|1UL
op_lshift
id|nbits
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|next
OL
id|end
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|ws
op_assign
op_star
id|piows
)paren
op_amp
id|SH_PIO_WRITE_STATUS_0_PENDING_WRITE_COUNT_MASK
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|ws
op_amp
id|SH_PIO_WRITE_STATUS_0_WRITE_DEADLOCK_MASK
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * sn2_send_IPI - send an IPI to a processor&n; * @cpuid: target of the IPI&n; * @vector: command to send&n; * @delivery_mode: delivery mechanism&n; * @redirect: redirect the IPI?&n; *&n; * Sends an IPI (InterProcessor Interrupt) to the processor specified by&n; * @cpuid.  @vector specifies the command to send, while @delivery_mode can &n; * be one of the following&n; *&n; * %IA64_IPI_DM_INT - pend an interrupt&n; * %IA64_IPI_DM_PMI - pend a PMI&n; * %IA64_IPI_DM_NMI - pend an NMI&n; * %IA64_IPI_DM_INIT - pend an INIT interrupt&n; */
r_void
DECL|function|sn2_send_IPI
id|sn2_send_IPI
c_func
(paren
r_int
id|cpuid
comma
r_int
id|vector
comma
r_int
id|delivery_mode
comma
r_int
id|redirect
)paren
(brace
r_int
op_star
id|p
comma
id|val
suffix:semicolon
r_int
id|physid
suffix:semicolon
r_int
id|nasid
comma
id|slice
suffix:semicolon
id|physid
op_assign
id|cpu_physical_id
c_func
(paren
id|cpuid
)paren
suffix:semicolon
id|nasid
op_assign
id|cpu_physical_id_to_nasid
c_func
(paren
id|physid
)paren
suffix:semicolon
id|slice
op_assign
id|cpu_physical_id_to_slice
c_func
(paren
id|physid
)paren
suffix:semicolon
id|p
op_assign
(paren
r_int
op_star
)paren
id|GLOBAL_MMR_ADDR
c_func
(paren
id|nasid
comma
id|SH_IPI_INT
)paren
suffix:semicolon
id|val
op_assign
(paren
l_int|1UL
op_lshift
id|SH_IPI_INT_SEND_SHFT
)paren
op_or
(paren
id|physid
op_lshift
id|SH_IPI_INT_PID_SHFT
)paren
op_or
(paren
(paren
r_int
)paren
id|delivery_mode
op_lshift
id|SH_IPI_INT_TYPE_SHFT
)paren
op_or
(paren
(paren
r_int
)paren
id|vector
op_lshift
id|SH_IPI_INT_IDX_SHFT
)paren
op_or
(paren
l_int|0x000feeUL
op_lshift
id|SH_IPI_INT_BASE_SHFT
)paren
suffix:semicolon
macro_line|#if defined(BRINGUP)
(brace
r_static
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|count
op_increment
OL
l_int|10
)paren
id|printk
c_func
(paren
l_string|&quot;ZZ sendIPI 0x%x-&gt;0x%x, vec %d, nasid 0x%lx, slice %ld, adr 0x%lx, val 0x%lx&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpuid
comma
id|vector
comma
id|nasid
comma
id|slice
comma
(paren
r_int
)paren
id|p
comma
id|val
)paren
suffix:semicolon
)brace
macro_line|#endif
id|mb
c_func
(paren
)paren
suffix:semicolon
op_star
id|p
op_assign
id|val
suffix:semicolon
)brace
multiline_comment|/**&n; * init_sn2_smp_config - initialize SN2 smp configuration&n; *&n; * currently a NOP.&n; */
r_void
id|__init
DECL|function|init_sn2_smp_config
id|init_sn2_smp_config
c_func
(paren
r_void
)paren
(brace
)brace
eof
