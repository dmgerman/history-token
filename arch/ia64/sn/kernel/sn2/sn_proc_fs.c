multiline_comment|/*&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; *&n; * Copyright (C) 2000-2003 Silicon Graphics, Inc. All rights reserved.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#ifdef CONFIG_PROC_FS
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;asm/sn/sgi.h&gt;
macro_line|#include &lt;asm/sn/sn_sal.h&gt;
DECL|function|partition_id_read_proc
r_static
r_int
id|partition_id_read_proc
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%d&bslash;n&quot;
comma
id|sn_local_partid
c_func
(paren
)paren
)paren
suffix:semicolon
)brace
DECL|variable|sgi_proc_dir
r_static
r_struct
id|proc_dir_entry
op_star
id|sgi_proc_dir
suffix:semicolon
r_void
DECL|function|register_sn_partition_id
id|register_sn_partition_id
c_func
(paren
r_void
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|entry
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sgi_proc_dir
)paren
(brace
id|sgi_proc_dir
op_assign
id|proc_mkdir
c_func
(paren
l_string|&quot;sgi_sn&quot;
comma
l_int|0
)paren
suffix:semicolon
)brace
id|entry
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;partition_id&quot;
comma
l_int|0444
comma
id|sgi_proc_dir
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
)paren
(brace
id|entry-&gt;nlink
op_assign
l_int|1
suffix:semicolon
id|entry-&gt;data
op_assign
l_int|0
suffix:semicolon
id|entry-&gt;read_proc
op_assign
id|partition_id_read_proc
suffix:semicolon
id|entry-&gt;write_proc
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
r_static
r_int
DECL|function|system_serial_number_read_proc
id|system_serial_number_read_proc
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|sn_system_serial_number
c_func
(paren
)paren
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|licenseID_read_proc
id|licenseID_read_proc
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;0x%lx&bslash;n&quot;
comma
id|sn_partition_serial_number_val
c_func
(paren
)paren
)paren
suffix:semicolon
)brace
r_void
DECL|function|register_sn_serial_numbers
id|register_sn_serial_numbers
c_func
(paren
r_void
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|entry
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sgi_proc_dir
)paren
(brace
id|sgi_proc_dir
op_assign
id|proc_mkdir
c_func
(paren
l_string|&quot;sgi_sn&quot;
comma
l_int|0
)paren
suffix:semicolon
)brace
id|entry
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;system_serial_number&quot;
comma
l_int|0444
comma
id|sgi_proc_dir
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
)paren
(brace
id|entry-&gt;nlink
op_assign
l_int|1
suffix:semicolon
id|entry-&gt;data
op_assign
l_int|0
suffix:semicolon
id|entry-&gt;read_proc
op_assign
id|system_serial_number_read_proc
suffix:semicolon
id|entry-&gt;write_proc
op_assign
l_int|NULL
suffix:semicolon
)brace
id|entry
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;licenseID&quot;
comma
l_int|0444
comma
id|sgi_proc_dir
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
)paren
(brace
id|entry-&gt;nlink
op_assign
l_int|1
suffix:semicolon
id|entry-&gt;data
op_assign
l_int|0
suffix:semicolon
id|entry-&gt;read_proc
op_assign
id|licenseID_read_proc
suffix:semicolon
id|entry-&gt;write_proc
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Enable forced interrupt by default.&n; * When set, the sn interrupt handler writes the force interrupt register on&n; * the bridge chip.  The hardware will then send an interrupt message if the&n; * interrupt line is active.  This mimics a level sensitive interrupt.&n; */
DECL|variable|sn_force_interrupt_flag
r_int
id|sn_force_interrupt_flag
op_assign
l_int|1
suffix:semicolon
r_static
r_int
DECL|function|sn_force_interrupt_read_proc
id|sn_force_interrupt_read_proc
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_if
c_cond
(paren
id|sn_force_interrupt_flag
)paren
(brace
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;Force interrupt is enabled&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;Force interrupt is disabled&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|sn_force_interrupt_write_proc
id|sn_force_interrupt_write_proc
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
r_int
id|count
comma
r_void
op_star
id|data
)paren
(brace
r_if
c_cond
(paren
op_star
id|buffer
op_eq
l_char|&squot;0&squot;
)paren
(brace
id|sn_force_interrupt_flag
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|sn_force_interrupt_flag
op_assign
l_int|1
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
r_void
DECL|function|register_sn_force_interrupt
id|register_sn_force_interrupt
c_func
(paren
r_void
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|entry
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sgi_proc_dir
)paren
(brace
id|sgi_proc_dir
op_assign
id|proc_mkdir
c_func
(paren
l_string|&quot;sgi_sn&quot;
comma
l_int|0
)paren
suffix:semicolon
)brace
id|entry
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;sn_force_interrupt&quot;
comma
l_int|0444
comma
id|sgi_proc_dir
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
)paren
(brace
id|entry-&gt;nlink
op_assign
l_int|1
suffix:semicolon
id|entry-&gt;data
op_assign
l_int|0
suffix:semicolon
id|entry-&gt;read_proc
op_assign
id|sn_force_interrupt_read_proc
suffix:semicolon
id|entry-&gt;write_proc
op_assign
id|sn_force_interrupt_write_proc
suffix:semicolon
)brace
)brace
r_extern
r_int
id|sn_linkstats_get
c_func
(paren
r_char
op_star
)paren
suffix:semicolon
r_extern
r_int
id|sn_linkstats_reset
c_func
(paren
r_int
r_int
)paren
suffix:semicolon
r_static
r_int
DECL|function|sn_linkstats_read_proc
id|sn_linkstats_read_proc
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_return
id|sn_linkstats_get
c_func
(paren
id|page
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|sn_linkstats_write_proc
id|sn_linkstats_write_proc
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
op_star
id|buffer
comma
r_int
r_int
id|count
comma
r_void
op_star
id|data
)paren
(brace
r_char
id|s
(braket
l_int|64
)braket
suffix:semicolon
r_int
r_int
id|msecs
suffix:semicolon
r_int
id|e
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|s
comma
id|buffer
comma
id|count
OL
r_sizeof
(paren
id|s
)paren
ques
c_cond
id|count
suffix:colon
r_sizeof
(paren
id|s
)paren
)paren
)paren
id|e
op_assign
op_minus
id|EFAULT
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
id|sscanf
c_func
(paren
id|s
comma
l_string|&quot;%lu&quot;
comma
op_amp
id|msecs
)paren
op_ne
l_int|1
op_logical_or
id|msecs
OL
l_int|5
)paren
multiline_comment|/* at least 5 milliseconds between updates */
id|e
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_else
id|sn_linkstats_reset
c_func
(paren
id|msecs
)paren
suffix:semicolon
)brace
r_return
id|e
suffix:semicolon
)brace
r_void
DECL|function|register_sn_linkstats
id|register_sn_linkstats
c_func
(paren
r_void
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|entry
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sgi_proc_dir
)paren
(brace
id|sgi_proc_dir
op_assign
id|proc_mkdir
c_func
(paren
l_string|&quot;sgi_sn&quot;
comma
l_int|0
)paren
suffix:semicolon
)brace
id|entry
op_assign
id|create_proc_entry
c_func
(paren
l_string|&quot;linkstats&quot;
comma
l_int|0444
comma
id|sgi_proc_dir
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entry
)paren
(brace
id|entry-&gt;nlink
op_assign
l_int|1
suffix:semicolon
id|entry-&gt;data
op_assign
l_int|0
suffix:semicolon
id|entry-&gt;read_proc
op_assign
id|sn_linkstats_read_proc
suffix:semicolon
id|entry-&gt;write_proc
op_assign
id|sn_linkstats_write_proc
suffix:semicolon
)brace
)brace
r_void
DECL|function|register_sn_procfs
id|register_sn_procfs
c_func
(paren
r_void
)paren
(brace
id|register_sn_partition_id
c_func
(paren
)paren
suffix:semicolon
id|register_sn_serial_numbers
c_func
(paren
)paren
suffix:semicolon
id|register_sn_force_interrupt
c_func
(paren
)paren
suffix:semicolon
id|register_sn_linkstats
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_PROC_FS */
eof
