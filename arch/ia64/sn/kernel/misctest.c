multiline_comment|/* &n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; *&n; * Copyright (C) 2000-2001 Silicon Graphics, Inc. All rights reserved.&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;asm/sn/sn_sal.h&gt;
macro_line|#include &lt;asm/sn/sn_cpuid.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
r_extern
r_int
id|autotest_enabled
suffix:semicolon
DECL|variable|mcatest
r_int
id|mcatest
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* &n; * mcatest&n; *&t;1 = expected MCA&n; *&t;2 = unexpected MCA&n; *&t;3 = expected MCA + unexpected MCA&n; *&t;4 = INIT&n; *&t;5 = speculative load to garbage memory address&n; *&t;6 = speculative load with ld8.s (needs poison hack in PROM)&n; *&t;7 = speculative load from mis-predicted branch (needs poison hack in PROM)&n; */
DECL|function|set_mcatest
r_static
r_int
id|__init
id|set_mcatest
c_func
(paren
r_char
op_star
id|str
)paren
(brace
id|get_option
c_func
(paren
op_amp
id|str
comma
op_amp
id|mcatest
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|__setup
c_func
(paren
l_string|&quot;mcatest=&quot;
comma
id|set_mcatest
)paren
suffix:semicolon
r_void
DECL|function|sgi_mcatest
id|sgi_mcatest
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|mcatest
op_eq
l_int|1
op_logical_or
id|mcatest
op_eq
l_int|3
)paren
(brace
r_int
op_star
id|p
comma
id|result
comma
id|adrs
(braket
)braket
op_assign
(brace
l_int|0xc0000a000f021004UL
comma
l_int|0xc0000a000f026004UL
comma
l_int|0x800000000
comma
l_int|0x500000
comma
l_int|0
)brace
suffix:semicolon
r_int
id|size
(braket
)braket
op_assign
(brace
l_int|1
comma
l_int|2
comma
l_int|4
comma
l_int|8
)brace
suffix:semicolon
r_int
id|r
comma
id|i
comma
id|j
suffix:semicolon
id|p
op_assign
(paren
r_int
op_star
)paren
l_int|0xc000000000000000UL
suffix:semicolon
id|ia64_fc
c_func
(paren
id|p
)paren
suffix:semicolon
op_star
id|p
op_assign
l_int|0x0123456789abcdefL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|4
suffix:semicolon
id|j
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Probing 0x%lx, size %ld&bslash;n&quot;
comma
id|adrs
(braket
id|i
)braket
comma
id|size
(braket
id|j
)braket
)paren
suffix:semicolon
id|result
op_assign
op_minus
l_int|1
suffix:semicolon
id|r
op_assign
id|ia64_sn_probe_io_slot
(paren
id|adrs
(braket
id|i
)braket
comma
id|size
(braket
id|j
)braket
comma
op_amp
id|result
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;    status %d, val 0x%lx&bslash;n&quot;
comma
id|r
comma
id|result
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|mcatest
op_eq
l_int|2
op_logical_or
id|mcatest
op_eq
l_int|3
)paren
(brace
r_void
id|zzzmca
c_func
(paren
r_int
comma
r_int
comma
r_int
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;About to cause unexpected MCA&bslash;n&quot;
)paren
suffix:semicolon
id|zzzmca
c_func
(paren
id|mcatest
comma
l_int|0x32dead
comma
l_int|0x33dead
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mcatest
op_eq
l_int|4
)paren
(brace
r_int
op_star
id|p
suffix:semicolon
r_int
id|delivery_mode
op_assign
l_int|5
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;About to try to cause an INIT on cpu 0&bslash;n&quot;
)paren
suffix:semicolon
id|p
op_assign
(paren
r_int
op_star
)paren
(paren
(paren
l_int|0xc0000a0000000000LL
op_or
(paren
(paren
r_int
)paren
id|get_nasid
c_func
(paren
)paren
)paren
op_lshift
l_int|33
)paren
op_or
l_int|0x1800080
)paren
suffix:semicolon
op_star
id|p
op_assign
(paren
id|delivery_mode
op_lshift
l_int|8
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|10000
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Returned from INIT&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mcatest
op_eq
l_int|5
)paren
(brace
r_int
id|zzzspec
c_func
(paren
r_int
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|psr
comma
id|dcr
comma
id|res
comma
id|val
comma
id|addr
op_assign
l_int|0xff00000000UL
suffix:semicolon
id|dcr
op_assign
id|ia64_get_dcr
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Default DCR: 0x%lx&bslash;n&quot;
comma
id|ia64_get_dcr
c_func
(paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;zzzspec: 0x%x&bslash;n&quot;
comma
id|zzzspec
c_func
(paren
id|addr
)paren
)paren
suffix:semicolon
id|ia64_set_dcr
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;New     DCR: 0x%lx&bslash;n&quot;
comma
id|ia64_get_dcr
c_func
(paren
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;zzzspec: 0x%x&bslash;n&quot;
comma
id|zzzspec
c_func
(paren
id|addr
)paren
)paren
suffix:semicolon
id|ia64_set_dcr
c_func
(paren
id|dcr
)paren
suffix:semicolon
id|res
op_assign
id|ia64_sn_probe_io_slot
c_func
(paren
l_int|0xff00000000UL
comma
l_int|8
comma
op_amp
id|val
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;zzzspec: probe %ld, 0x%lx&bslash;n&quot;
comma
id|res
comma
id|val
)paren
suffix:semicolon
id|psr
op_assign
id|ia64_clear_ic
c_func
(paren
)paren
suffix:semicolon
id|ia64_itc
c_func
(paren
l_int|0x2
comma
l_int|0xe00000ff00000000UL
comma
id|pte_val
c_func
(paren
id|mk_pte_phys
c_func
(paren
l_int|0xff00000000UL
comma
id|__pgprot
c_func
(paren
id|__DIRTY_BITS
op_or
id|_PAGE_PL_0
op_or
id|_PAGE_AR_RW
)paren
)paren
)paren
comma
id|_PAGE_SIZE_256M
)paren
suffix:semicolon
id|ia64_set_psr
c_func
(paren
id|psr
)paren
suffix:semicolon
id|ia64_srlz_i
(paren
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|mcatest
op_eq
l_int|6
)paren
(brace
r_int
id|zzzspec
c_func
(paren
r_int
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|dcr
comma
id|addr
op_assign
l_int|0xe000000008000000UL
suffix:semicolon
id|dcr
op_assign
id|ia64_get_dcr
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;zzzspec: 0x%x&bslash;n&quot;
comma
id|zzzspec
c_func
(paren
id|addr
)paren
)paren
suffix:semicolon
id|ia64_set_dcr
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|ia64_set_dcr
c_func
(paren
id|dcr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mcatest
op_eq
l_int|7
)paren
(brace
r_int
id|zzzspec2
c_func
(paren
r_int
comma
r_int
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|addr
op_assign
l_int|0xe000000008000000UL
suffix:semicolon
r_int
id|addr2
op_assign
l_int|0xe000000007000000UL
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|5
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;zzzspec2&bslash;n&quot;
)paren
suffix:semicolon
id|zzzspec2
c_func
(paren
id|addr
comma
id|addr2
)paren
suffix:semicolon
)brace
)brace
)brace
eof
