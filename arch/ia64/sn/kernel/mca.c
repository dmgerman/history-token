multiline_comment|/*&n; * File:&t;mca.c&n; * Purpose:&t;SN specific MCA code.&n; *&n; * Copyright (C) 2001-2002 Silicon Graphics, Inc.  All Rights Reserved.&n; * &n; * This program is free software; you can redistribute it and/or modify it &n; * under the terms of version 2 of the GNU General Public License &n; * as published by the Free Software Foundation.&n; * &n; * This program is distributed in the hope that it would be useful, but &n; * WITHOUT ANY WARRANTY; without even the implied warranty of &n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. &n; * &n; * Further, this software is distributed without any warranty that it is &n; * free of the rightful claim of any third person regarding infringement &n; * or the like.  Any license provided herein, whether implied or &n; * otherwise, applies only to this software file.  Patent licenses, if &n; * any, provided herein do not apply to combinations of this program with &n; * other software, or any other product whatsoever.&n; * &n; * You should have received a copy of the GNU General Public &n; * License along with this program; if not, write the Free Software &n; * Foundation, Inc., 59 Temple Place - Suite 330, Boston MA 02111-1307, USA.&n; * &n; * Contact information:  Silicon Graphics, Inc., 1600 Amphitheatre Pkwy, &n; * Mountain View, CA  94043, or:&n; * &n; * http://www.sgi.com &n; * &n; * For further information regarding this notice, see: &n; * &n; * http://oss.sgi.com/projects/GenInfo/NoticeExplan&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/jiffies.h&gt;
macro_line|#include &lt;linux/threads.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/irq.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/kdb.h&gt;
macro_line|#include &lt;asm/machvec.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/sal.h&gt;
macro_line|#include &lt;asm/sn/sn_sal.h&gt;
macro_line|#include &lt;asm/mca.h&gt;
macro_line|#include &lt;asm/sn/mca.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/hw_irq.h&gt;
macro_line|#include &lt;asm/acpi-ext.h&gt;
macro_line|#include &lt;asm/smp.h&gt;
macro_line|#include &lt;asm/sn/sn_cpuid.h&gt;
DECL|variable|shub_mmr_names
r_static
r_char
op_star
id|shub_mmr_names
(braket
)braket
op_assign
(brace
l_string|&quot;sh_event_occurred&quot;
comma
l_string|&quot;sh_first_error&quot;
comma
l_string|&quot;sh_event_overflow&quot;
comma
multiline_comment|/* PI */
l_string|&quot;sh_pi_first_error&quot;
comma
l_string|&quot;sh_pi_error_summary&quot;
comma
l_string|&quot;sh_pi_error_overflow&quot;
comma
multiline_comment|/* PI HW */
l_string|&quot;sh_pi_error_detail_1&quot;
comma
l_string|&quot;sh_pi_error_detail_2&quot;
comma
l_string|&quot;sh_pi_hw_time_stamp&quot;
comma
multiline_comment|/* PI UCE */
l_string|&quot;sh_pi_uncorrected_detail_1&quot;
comma
l_string|&quot;sh_pi_uncorrected_detail_2&quot;
comma
l_string|&quot;sh_pi_uncorrected_detail_3&quot;
comma
l_string|&quot;sh_pi_uncorrected_detail_4&quot;
comma
l_string|&quot;sh_pi_uncor_time_stamp&quot;
comma
multiline_comment|/* PI CE */
l_string|&quot;sh_pi_corrected_detail_1&quot;
comma
l_string|&quot;sh_pi_corrected_detail_2&quot;
comma
l_string|&quot;sh_pi_corrected_detail_3&quot;
comma
l_string|&quot;sh_pi_corrected_detail_4&quot;
comma
l_string|&quot;sh_pi_cor_time_stamp&quot;
comma
multiline_comment|/* MD */
l_string|&quot;sh_mem_error_summary&quot;
comma
l_string|&quot;sh_mem_error_overflow&quot;
comma
multiline_comment|/* MD HW */
l_string|&quot;sh_misc_err_hdr_upper&quot;
comma
l_string|&quot;sh_misc_err_hdr_lower&quot;
comma
l_string|&quot;sh_md_dqlp_mmr_xperr_val&quot;
comma
l_string|&quot;sh_md_dqlp_mmr_yperr_val&quot;
comma
l_string|&quot;sh_md_dqrp_mmr_xperr_val&quot;
comma
l_string|&quot;sh_md_dqrp_mmr_yperr_val&quot;
comma
l_string|&quot;sh_md_hw_time_stamp&quot;
comma
multiline_comment|/* MD UCE */
l_string|&quot;sh_dir_uc_err_hdr_lower&quot;
comma
l_string|&quot;sh_dir_uc_err_hdr_upper&quot;
comma
l_string|&quot;sh_md_dqlp_mmr_xuerr1&quot;
comma
l_string|&quot;sh_md_dqlp_mmr_xuerr2&quot;
comma
l_string|&quot;sh_md_dqlp_mmr_yuerr1&quot;
comma
l_string|&quot;sh_md_dqlp_mmr_yuerr2&quot;
comma
l_string|&quot;sh_md_dqrp_mmr_xuerr1&quot;
comma
l_string|&quot;sh_md_dqrp_mmr_xuerr2&quot;
comma
l_string|&quot;sh_md_dqrp_mmr_yuerr1&quot;
comma
l_string|&quot;sh_md_dqrp_mmr_yuerr2&quot;
comma
l_string|&quot;sh_md_uncor_time_stamp&quot;
comma
multiline_comment|/* MD CE */
l_string|&quot;sh_dir_cor_err_hdr_lower&quot;
comma
l_string|&quot;sh_dir_cor_err_hdr_upper&quot;
comma
l_string|&quot;sh_md_dqlp_mmr_xcerr1&quot;
comma
l_string|&quot;sh_md_dqlp_mmr_xcerr2&quot;
comma
l_string|&quot;sh_md_dqlp_mmr_ycerr1&quot;
comma
l_string|&quot;sh_md_dqlp_mmr_ycerr2&quot;
comma
l_string|&quot;sh_md_dqrp_mmr_xcerr1&quot;
comma
l_string|&quot;sh_md_dqrp_mmr_xcerr2&quot;
comma
l_string|&quot;sh_md_dqrp_mmr_ycerr1&quot;
comma
l_string|&quot;sh_md_dqrp_mmr_ycerr2&quot;
comma
l_string|&quot;sh_md_cor_time_stamp&quot;
comma
multiline_comment|/* MD CE, UCE */
l_string|&quot;sh_md_dqls_mmr_xamopw_err&quot;
comma
l_string|&quot;sh_md_dqrs_mmr_yamopw_err&quot;
comma
multiline_comment|/* XN */
l_string|&quot;sh_xn_error_summary&quot;
comma
l_string|&quot;sh_xn_first_error&quot;
comma
l_string|&quot;sh_xn_error_overflow&quot;
comma
multiline_comment|/* XN HW */
l_string|&quot;sh_xniilb_error_summary&quot;
comma
l_string|&quot;sh_xniilb_first_error&quot;
comma
l_string|&quot;sh_xniilb_error_overflow&quot;
comma
l_string|&quot;sh_xniilb_error_detail_1&quot;
comma
l_string|&quot;sh_xniilb_error_detail_2&quot;
comma
l_string|&quot;sh_xniilb_error_detail_3&quot;
comma
l_string|&quot;sh_ni0_error_summary_1&quot;
comma
l_string|&quot;sh_ni0_first_error_1&quot;
comma
l_string|&quot;sh_ni0_error_overflow_1&quot;
comma
l_string|&quot;sh_ni0_error_summary_2&quot;
comma
l_string|&quot;sh_ni0_first_error_2&quot;
comma
l_string|&quot;sh_ni0_error_overflow_2&quot;
comma
l_string|&quot;sh_ni0_error_detail_1&quot;
comma
l_string|&quot;sh_ni0_error_detail_2&quot;
comma
l_string|&quot;sh_ni0_error_detail_3&quot;
comma
l_string|&quot;sh_ni1_error_summary_1&quot;
comma
l_string|&quot;sh_ni1_first_error_1&quot;
comma
l_string|&quot;sh_ni1_error_overflow_1&quot;
comma
l_string|&quot;sh_ni1_error_summary_2&quot;
comma
l_string|&quot;sh_ni1_first_error_2&quot;
comma
l_string|&quot;sh_ni1_error_overflow_2&quot;
comma
l_string|&quot;sh_ni1_error_detail_1&quot;
comma
l_string|&quot;sh_ni1_error_detail_2&quot;
comma
l_string|&quot;sh_ni1_error_detail_3&quot;
comma
l_string|&quot;sh_xn_hw_time_stamp&quot;
comma
multiline_comment|/* XN HW &amp; UCE &amp; SBE */
l_string|&quot;sh_xnpi_error_summary&quot;
comma
l_string|&quot;sh_xnpi_first_error&quot;
comma
l_string|&quot;sh_xnpi_error_overflow&quot;
comma
l_string|&quot;sh_xnpi_error_detail_1&quot;
comma
l_string|&quot;sh_xnmd_error_summary&quot;
comma
l_string|&quot;sh_xnmd_first_error&quot;
comma
l_string|&quot;sh_xnmd_error_overflow&quot;
comma
l_string|&quot;sh_xnmd_ecc_err_report&quot;
comma
l_string|&quot;sh_xnmd_error_detail_1&quot;
comma
multiline_comment|/* XN UCE */
l_string|&quot;sh_xn_uncorrected_detail_1&quot;
comma
l_string|&quot;sh_xn_uncorrected_detail_2&quot;
comma
l_string|&quot;sh_xn_uncorrected_detail_3&quot;
comma
l_string|&quot;sh_xn_uncorrected_detail_4&quot;
comma
l_string|&quot;sh_xn_uncor_time_stamp&quot;
comma
multiline_comment|/* XN CE */
l_string|&quot;sh_xn_corrected_detail_1&quot;
comma
l_string|&quot;sh_xn_corrected_detail_2&quot;
comma
l_string|&quot;sh_xn_corrected_detail_3&quot;
comma
l_string|&quot;sh_xn_corrected_detail_4&quot;
comma
l_string|&quot;sh_xn_cor_time_stamp&quot;
comma
multiline_comment|/* LB HW */
l_string|&quot;sh_lb_error_summary&quot;
comma
l_string|&quot;sh_lb_first_error&quot;
comma
l_string|&quot;sh_lb_error_overflow&quot;
comma
l_string|&quot;sh_lb_error_detail_1&quot;
comma
l_string|&quot;sh_lb_error_detail_2&quot;
comma
l_string|&quot;sh_lb_error_detail_3&quot;
comma
l_string|&quot;sh_lb_error_detail_4&quot;
comma
l_string|&quot;sh_lb_error_detail_5&quot;
comma
l_string|&quot;sh_junk_error_status&quot;
comma
)brace
suffix:semicolon
r_void
DECL|function|sal_log_plat_print
id|sal_log_plat_print
c_func
(paren
r_int
id|header_len
comma
r_int
id|sect_len
comma
id|u8
op_star
id|p_data
comma
id|prfunc_t
id|prfunc
)paren
(brace
id|sal_log_plat_info_t
op_star
id|sh_info
op_assign
(paren
id|sal_log_plat_info_t
op_star
)paren
id|p_data
suffix:semicolon
id|u64
op_star
id|mmr_val
op_assign
(paren
id|u64
op_star
)paren
op_amp
(paren
id|sh_info-&gt;shub_state
)paren
suffix:semicolon
r_char
op_star
op_star
id|mmr_name
op_assign
id|shub_mmr_names
suffix:semicolon
r_int
id|mmr_count
op_assign
r_sizeof
(paren
id|sal_log_shub_state_t
)paren
op_rshift
l_int|3
suffix:semicolon
r_while
c_loop
(paren
id|mmr_count
)paren
(brace
r_if
c_cond
(paren
op_star
id|mmr_val
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot;%-40s: %#016lx&bslash;n&quot;
comma
op_star
id|mmr_name
comma
op_star
id|mmr_val
)paren
suffix:semicolon
)brace
id|mmr_name
op_increment
suffix:semicolon
id|mmr_val
op_increment
suffix:semicolon
id|mmr_count
op_decrement
suffix:semicolon
)brace
)brace
r_void
DECL|function|sn_cpei_handler
id|sn_cpei_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|devid
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|ia64_sal_retval
id|isrv
suffix:semicolon
singleline_comment|// this function&squot;s sole purpose is to call SAL when we receive
singleline_comment|// a CE interrupt from SHUB or when the timer routine decides
singleline_comment|// we need to call SAL to check for CEs.
singleline_comment|// CALL SAL_LOG_CE
id|SAL_CALL
c_func
(paren
id|isrv
comma
id|SN_SAL_LOG_CE
comma
id|irq
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#include &lt;linux/timer.h&gt;
DECL|macro|CPEI_INTERVAL
mdefine_line|#define CPEI_INTERVAL   (HZ/100)
DECL|variable|sn_cpei_timer
r_struct
id|timer_list
id|sn_cpei_timer
op_assign
id|TIMER_INITIALIZER
c_func
(paren
l_int|NULL
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_void
id|sn_init_cpei_timer
c_func
(paren
r_void
)paren
suffix:semicolon
r_void
DECL|function|sn_cpei_timer_handler
id|sn_cpei_timer_handler
c_func
(paren
r_int
r_int
id|dummy
)paren
(brace
id|sn_cpei_handler
c_func
(paren
op_minus
l_int|1
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|sn_cpei_timer
)paren
suffix:semicolon
id|sn_cpei_timer.expires
op_assign
id|jiffies
op_plus
id|CPEI_INTERVAL
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|sn_cpei_timer
)paren
suffix:semicolon
)brace
r_void
DECL|function|sn_init_cpei_timer
id|sn_init_cpei_timer
c_func
(paren
)paren
(brace
id|sn_cpei_timer.expires
op_assign
id|jiffies
op_plus
id|CPEI_INTERVAL
suffix:semicolon
id|sn_cpei_timer.function
op_assign
id|sn_cpei_timer_handler
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|sn_cpei_timer
)paren
suffix:semicolon
)brace
macro_line|#ifdef ajmtestceintr
DECL|variable|sn_ce_timer
r_struct
id|timer_list
id|sn_ce_timer
suffix:semicolon
r_void
DECL|function|sn_ce_timer_handler
id|sn_ce_timer_handler
c_func
(paren
r_int
id|dummy
)paren
(brace
r_int
r_int
op_star
id|pi_ce_error_inject_reg
op_assign
l_int|0xc00000092fffff00
suffix:semicolon
op_star
id|pi_ce_error_inject_reg
op_assign
l_int|0x0000000000000100
suffix:semicolon
id|del_timer
c_func
(paren
op_amp
id|sn_ce_timer
)paren
suffix:semicolon
id|sn_ce_timer.expires
op_assign
id|jiffies
op_plus
id|CPEI_INTERVAL
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|sn_ce_timer
)paren
suffix:semicolon
)brace
DECL|function|sn_init_ce_timer
id|sn_init_ce_timer
c_func
(paren
)paren
(brace
id|sn_ce_timer.expires
op_assign
id|jiffies
op_plus
id|CPEI_INTERVAL
suffix:semicolon
id|sn_ce_timer.function
op_assign
id|sn_ce_timer_handler
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|sn_ce_timer
)paren
suffix:semicolon
)brace
macro_line|#endif /* ajmtestceintr */
eof
