multiline_comment|/*&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; *&n; * Copyright (C) 1992 - 1997, 2000-2004 Silicon Graphics, Inc. All rights reserved.&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/ctype.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;asm/sn/types.h&gt;
macro_line|#include &lt;asm/sn/module.h&gt;
macro_line|#include &lt;asm/sn/l1.h&gt;
DECL|variable|brick_types
r_char
id|brick_types
(braket
id|MAX_BRICK_TYPES
op_plus
l_int|1
)braket
op_assign
l_string|&quot;cri.xdpn%#=vo^kjbf890123456789...&quot;
suffix:semicolon
multiline_comment|/*&n; * Format a module id for printing.&n; *&n; * There are three possible formats:&n; *&n; *   MODULE_FORMAT_BRIEF&t;is the brief 6-character format, including&n; *&t;&t;&t;&t;the actual brick-type as recorded in the &n; *&t;&t;&t;&t;moduleid_t, eg. 002c15 for a C-brick, or&n; *&t;&t;&t;&t;101#17 for a PX-brick.&n; *&n; *   MODULE_FORMAT_LONG&t;&t;is the hwgraph format, eg. rack/002/bay/15&n; *&t;&t;&t;&t;of rack/101/bay/17 (note that the brick&n; *&t;&t;&t;&t;type does not appear in this format).&n; *&n; *   MODULE_FORMAT_LCD&t;&t;is like MODULE_FORMAT_BRIEF, except that it&n; *&t;&t;&t;&t;ensures that the module id provided appears&n; *&t;&t;&t;&t;exactly as it would on the LCD display of&n; *&t;&t;&t;&t;the corresponding brick, eg. still 002c15&n; *&t;&t;&t;&t;for a C-brick, but 101p17 for a PX-brick.&n; *&n; * maule (9/13/04):  Removed top-level check for (fmt == MODULE_FORMAT_LCD)&n; * making MODULE_FORMAT_LCD equivalent to MODULE_FORMAT_BRIEF.  It was&n; * decided that all callers should assume the returned string should be what&n; * is displayed on the brick L1 LCD.&n; */
r_void
DECL|function|format_module_id
id|format_module_id
c_func
(paren
r_char
op_star
id|buffer
comma
id|moduleid_t
id|m
comma
r_int
id|fmt
)paren
(brace
r_int
id|rack
comma
id|position
suffix:semicolon
r_int
r_char
id|brickchar
suffix:semicolon
id|rack
op_assign
id|MODULE_GET_RACK
c_func
(paren
id|m
)paren
suffix:semicolon
id|brickchar
op_assign
id|MODULE_GET_BTCHAR
c_func
(paren
id|m
)paren
suffix:semicolon
multiline_comment|/* Be sure we use the same brick type character as displayed&n;&t; * on the brick&squot;s LCD&n;&t; */
r_switch
c_cond
(paren
id|brickchar
)paren
(brace
r_case
id|L1_BRICKTYPE_GA
suffix:colon
r_case
id|L1_BRICKTYPE_OPUS_TIO
suffix:colon
id|brickchar
op_assign
id|L1_BRICKTYPE_C
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L1_BRICKTYPE_PX
suffix:colon
r_case
id|L1_BRICKTYPE_PE
suffix:colon
r_case
id|L1_BRICKTYPE_PA
suffix:colon
r_case
id|L1_BRICKTYPE_SA
suffix:colon
multiline_comment|/* we can move this to the &quot;I&squot;s&quot; later&n;&t;&t;&t;       * if that makes more sense&n;&t;&t;&t;       */
id|brickchar
op_assign
id|L1_BRICKTYPE_P
suffix:semicolon
r_break
suffix:semicolon
r_case
id|L1_BRICKTYPE_IX
suffix:colon
r_case
id|L1_BRICKTYPE_IA
suffix:colon
id|brickchar
op_assign
id|L1_BRICKTYPE_I
suffix:semicolon
r_break
suffix:semicolon
)brace
id|position
op_assign
id|MODULE_GET_BPOS
c_func
(paren
id|m
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fmt
op_eq
id|MODULE_FORMAT_BRIEF
)paren
op_logical_or
(paren
id|fmt
op_eq
id|MODULE_FORMAT_LCD
)paren
)paren
(brace
multiline_comment|/* Brief module number format, eg. 002c15 */
multiline_comment|/* Decompress the rack number */
op_star
id|buffer
op_increment
op_assign
l_char|&squot;0&squot;
op_plus
id|RACK_GET_CLASS
c_func
(paren
id|rack
)paren
suffix:semicolon
op_star
id|buffer
op_increment
op_assign
l_char|&squot;0&squot;
op_plus
id|RACK_GET_GROUP
c_func
(paren
id|rack
)paren
suffix:semicolon
op_star
id|buffer
op_increment
op_assign
l_char|&squot;0&squot;
op_plus
id|RACK_GET_NUM
c_func
(paren
id|rack
)paren
suffix:semicolon
multiline_comment|/* Add the brick type */
op_star
id|buffer
op_increment
op_assign
id|brickchar
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|fmt
op_eq
id|MODULE_FORMAT_LONG
)paren
(brace
multiline_comment|/* Fuller hwgraph format, eg. rack/002/bay/15 */
id|strcpy
c_func
(paren
id|buffer
comma
l_string|&quot;rack&quot;
l_string|&quot;/&quot;
)paren
suffix:semicolon
id|buffer
op_add_assign
id|strlen
c_func
(paren
id|buffer
)paren
suffix:semicolon
op_star
id|buffer
op_increment
op_assign
l_char|&squot;0&squot;
op_plus
id|RACK_GET_CLASS
c_func
(paren
id|rack
)paren
suffix:semicolon
op_star
id|buffer
op_increment
op_assign
l_char|&squot;0&squot;
op_plus
id|RACK_GET_GROUP
c_func
(paren
id|rack
)paren
suffix:semicolon
op_star
id|buffer
op_increment
op_assign
l_char|&squot;0&squot;
op_plus
id|RACK_GET_NUM
c_func
(paren
id|rack
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|buffer
comma
l_string|&quot;/&quot;
l_string|&quot;bay&quot;
l_string|&quot;/&quot;
)paren
suffix:semicolon
id|buffer
op_add_assign
id|strlen
c_func
(paren
id|buffer
)paren
suffix:semicolon
)brace
multiline_comment|/* Add the bay position, using at least two digits */
r_if
c_cond
(paren
id|position
OL
l_int|10
)paren
op_star
id|buffer
op_increment
op_assign
l_char|&squot;0&squot;
suffix:semicolon
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;%d&quot;
comma
id|position
)paren
suffix:semicolon
)brace
eof
