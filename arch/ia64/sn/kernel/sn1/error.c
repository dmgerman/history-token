multiline_comment|/*&n; * SN1 Platform specific error Support&n; *&n; * Copyright (C) 2001-2002 Silicon Graphics, Inc. All rights reserved.&n; * &n; * This program is free software; you can redistribute it and/or modify it &n; * under the terms of version 2 of the GNU General Public License &n; * as published by the Free Software Foundation.&n; * &n; * This program is distributed in the hope that it would be useful, but &n; * WITHOUT ANY WARRANTY; without even the implied warranty of &n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. &n; * &n; * Further, this software is distributed without any warranty that it is &n; * free of the rightful claim of any third person regarding infringement &n; * or the like.  Any license provided herein, whether implied or &n; * otherwise, applies only to this software file.  Patent licenses, if &n; * any, provided herein do not apply to combinations of this program with &n; * other software, or any other product whatsoever.&n; * &n; * You should have received a copy of the GNU General Public &n; * License along with this program; if not, write the Free Software &n; * Foundation, Inc., 59 Temple Place - Suite 330, Boston MA 02111-1307, USA.&n; * &n; * Contact information:  Silicon Graphics, Inc., 1600 Amphitheatre Pkwy, &n; * Mountain View, CA  94043, or:&n; * &n; * http://www.sgi.com &n; * &n; * For further information regarding this notice, see: &n; * &n; * http://oss.sgi.com/projects/GenInfo/NoticeExplan&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;linux/devfs_fs_kernel.h&gt;
macro_line|#include &lt;asm/smp.h&gt;
macro_line|#include &lt;asm/sn/sn_cpuid.h&gt;
macro_line|#include &lt;asm/sn/sn1/bedrock.h&gt;
macro_line|#include &lt;asm/sn/intr.h&gt;
macro_line|#include &lt;asm/sn/addrs.h&gt;
multiline_comment|/**&n; * snia_error_intr_handler - handle SN specific error interrupts&n; * @irq: error interrupt received&n; * @devid: device causing the interrupt&n; * @pt_regs: saved register state&n; *&n; * This routine is called when certain interrupts occur on SN systems.&n; * It will either recover from the situations that caused the interrupt&n; * or panic.&n; */
r_void
DECL|function|snia_error_intr_handler
id|snia_error_intr_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|devid
comma
r_struct
id|pt_regs
op_star
id|pt_regs
)paren
(brace
r_int
r_int
r_int
id|intpend_val
suffix:semicolon
r_int
r_int
r_int
id|bit
suffix:semicolon
r_switch
c_cond
(paren
id|irq
)paren
(brace
r_case
id|SGI_UART_IRQ
suffix:colon
multiline_comment|/*&n;&t;&t; * This isn&squot;t really an error interrupt.  We&squot;re just&n;&t;&t; * here because we have to do something with them.&n;&t;&t; * This is probably wrong, and this code will be&n;&t;&t; * removed.&n;&t;&t; */
id|intpend_val
op_assign
id|LOCAL_HUB_L
c_func
(paren
id|PI_INT_PEND0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|GFX_INTR_A
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|GFX_INTR_A
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|GFX_INTR_B
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|GFX_INTR_B
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|PG_MIG_INTR
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|PG_MIG_INTR
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|UART_INTR
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|UART_INTR
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|CC_PEND_A
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|CC_PEND_A
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|CC_PEND_B
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|CC_PEND_B
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;Received SGI_UART_IRQ (65), but no intpend0 bits were set???&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|SGI_HUB_ERROR_IRQ
suffix:colon
multiline_comment|/*&n;&t;&t; * These are mostly error interrupts of various&n;&t;&t; * sorts.  We need to do more than panic here, but&n;&t;&t; * what the heck, this is bring up.&n;&t;&t; */
id|intpend_val
op_assign
id|LOCAL_HUB_L
c_func
(paren
id|PI_INT_PEND1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|XB_ERROR
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|XB_ERROR
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;RECEIVED XB_ERROR on cpu %d, cnode %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpuid_to_cnodeid
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|LB_ERROR
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|LB_ERROR
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;RECEIVED LB_ERROR on cpu %d, cnode %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpuid_to_cnodeid
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|NACK_INT_A
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|NACK_INT_A
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;RECEIVED NACK_INT_A on cpu %d, cnode %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpuid_to_cnodeid
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|NACK_INT_B
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|NACK_INT_B
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;RECEIVED NACK_INT_B on cpu %d, cnode %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpuid_to_cnodeid
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|CLK_ERR_INTR
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|CLK_ERR_INTR
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;RECEIVED CLK_ERR_INTR on cpu %d, cnode %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpuid_to_cnodeid
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|COR_ERR_INTR_A
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|COR_ERR_INTR_A
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;RECEIVED COR_ERR_INTR_A on cpu %d, cnode %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpuid_to_cnodeid
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|COR_ERR_INTR_B
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|COR_ERR_INTR_B
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;RECEIVED COR_ERR_INTR_B on cpu %d, cnode %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpuid_to_cnodeid
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|MD_COR_ERR_INTR
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|MD_COR_ERR_INTR
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;RECEIVED MD_COR_ERR_INTR on cpu %d, cnode %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpuid_to_cnodeid
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|NI_ERROR_INTR
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|NI_ERROR_INTR
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;RECEIVED NI_ERROR_INTR on cpu %d, cnode %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpuid_to_cnodeid
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|MSC_PANIC_INTR
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|MSC_PANIC_INTR
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;RECEIVED MSC_PANIC_INTR on cpu %d, cnode %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpuid_to_cnodeid
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;Received SGI_XB_ERROR_IRQ (182) but no intpend1 bits are set???&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;Received invalid irq in snia_error_intr_handler()&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
eof
