multiline_comment|/* &n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; *&n; * Copyright (C) 2000-2003 Silicon Graphics, Inc. All rights reserved.&n; */
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/delay.h&gt;
macro_line|#include &lt;asm/sn/nodepda.h&gt;
macro_line|#include &lt;asm/sn/simulator.h&gt;
macro_line|#include &lt;asm/sn/pda.h&gt;
macro_line|#include &lt;asm/sn/sn_cpuid.h&gt;
macro_line|#include &lt;asm/sn/shub_mmr.h&gt;
multiline_comment|/**&n; * sn_io_addr - convert an in/out port to an i/o address&n; * @port: port to convert&n; *&n; * Legacy in/out instructions are converted to ld/st instructions&n; * on IA64.  This routine will convert a port number into a valid &n; * SN i/o address.  Used by sn_in*() and sn_out*().&n; */
DECL|function|sn_io_addr
r_void
op_star
id|sn_io_addr
c_func
(paren
r_int
r_int
id|port
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|IS_RUNNING_ON_SIMULATOR
c_func
(paren
)paren
)paren
(brace
multiline_comment|/* On sn2, legacy I/O ports don&squot;t point at anything */
r_if
c_cond
(paren
id|port
OL
(paren
l_int|64
op_star
l_int|1024
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
r_return
(paren
(paren
r_void
op_star
)paren
(paren
id|port
op_or
id|__IA64_UNCACHED_OFFSET
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* but the simulator uses them... */
r_int
r_int
id|addr
suffix:semicolon
multiline_comment|/*&n;&t;&t; * word align port, but need more than 10 bits&n;&t;&t; * for accessing registers in bedrock local block&n;&t;&t; * (so we don&squot;t do port&amp;0xfff)&n;&t;&t; */
id|addr
op_assign
(paren
id|is_shub2
c_func
(paren
)paren
ques
c_cond
l_int|0xc00000028c000000UL
suffix:colon
l_int|0xc0000087cc000000UL
)paren
op_or
(paren
(paren
id|port
op_rshift
l_int|2
)paren
op_lshift
l_int|12
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|port
op_ge
l_int|0x1f0
op_logical_and
id|port
op_le
l_int|0x1f7
)paren
op_logical_or
id|port
op_eq
l_int|0x3f6
op_logical_or
id|port
op_eq
l_int|0x3f7
)paren
id|addr
op_or_assign
id|port
suffix:semicolon
r_return
(paren
r_void
op_star
)paren
id|addr
suffix:semicolon
)brace
)brace
DECL|variable|sn_io_addr
id|EXPORT_SYMBOL
c_func
(paren
id|sn_io_addr
)paren
suffix:semicolon
multiline_comment|/**&n; * __sn_mmiowb - I/O space memory barrier&n; *&n; * See include/asm-ia64/io.h and Documentation/DocBook/deviceiobook.tmpl&n; * for details.&n; *&n; * On SN2, we wait for the PIO_WRITE_STATUS SHub register to clear.&n; * See PV 871084 for details about the WAR about zero value.&n; *&n; */
DECL|function|__sn_mmiowb
r_void
id|__sn_mmiowb
c_func
(paren
r_void
)paren
(brace
r_volatile
r_int
r_int
op_star
id|adr
op_assign
id|pda-&gt;pio_write_status_addr
suffix:semicolon
r_int
r_int
id|val
op_assign
id|pda-&gt;pio_write_status_val
suffix:semicolon
r_while
c_loop
(paren
(paren
op_star
id|adr
op_amp
id|SH_PIO_WRITE_STATUS_PENDING_WRITE_COUNT_MASK
)paren
op_ne
id|val
)paren
id|cpu_relax
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|variable|__sn_mmiowb
id|EXPORT_SYMBOL
c_func
(paren
id|__sn_mmiowb
)paren
suffix:semicolon
eof
