multiline_comment|/*&n; * PAL &amp; SAL emulation.&n; *&n; * Copyright (C) 1998-2000 Hewlett-Packard Co&n; * Copyright (C) 1998-2000 David Mosberger-Tang &lt;davidm@hpl.hp.com&gt;&n; *&n; *&n; * Copyright (C) 2000-2003 Silicon Graphics, Inc.  All rights reserved.&n; * &n; * This program is free software; you can redistribute it and/or modify it &n; * under the terms of version 2 of the GNU General Public License &n; * as published by the Free Software Foundation.&n; * &n; * This program is distributed in the hope that it would be useful, but &n; * WITHOUT ANY WARRANTY; without even the implied warranty of &n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. &n; * &n; * Further, this software is distributed without any warranty that it is &n; * free of the rightful claim of any third person regarding infringement &n; * or the like.  Any license provided herein, whether implied or &n; * otherwise, applies only to this software file.  Patent licenses, if &n; * any, provided herein do not apply to combinations of this program with &n; * other software, or any other product whatsoever.&n; * &n; * You should have received a copy of the GNU General Public &n; * License along with this program; if not, write the Free Software &n; * Foundation, Inc., 59 Temple Place - Suite 330, Boston MA 02111-1307, USA.&n; * &n; * Contact information:  Silicon Graphics, Inc., 1600 Amphitheatre Pkwy, &n; * Mountain View, CA  94043, or:&n; * &n; * http://www.sgi.com &n; * &n; * For further information regarding this notice, see: &n; * &n; * http://oss.sgi.com/projects/GenInfo/NoticeExplan&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/efi.h&gt;
macro_line|#include &lt;asm/pal.h&gt;
macro_line|#include &lt;asm/sal.h&gt;
macro_line|#include &lt;asm/sn/sn_sal.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/sn/sn_cpuid.h&gt;
macro_line|#ifdef SGI_SN2
macro_line|#include &lt;asm/sn/sn2/addrs.h&gt;
macro_line|#include &lt;asm/sn/sn2/shub_mmr.h&gt;
macro_line|#endif
macro_line|#include &lt;linux/acpi.h&gt;
macro_line|#include &quot;fpmem.h&quot;
DECL|macro|RSDP_NAME
mdefine_line|#define RSDP_NAME               &quot;RSDP&quot;
DECL|macro|RSDP_SIG
mdefine_line|#define RSDP_SIG                &quot;RSD PTR &quot;  /* RSDT Pointer signature */
DECL|macro|APIC_SIG
mdefine_line|#define APIC_SIG                &quot;APIC&quot;      /* Multiple APIC Description Table */
DECL|macro|DSDT_SIG
mdefine_line|#define DSDT_SIG                &quot;DSDT&quot;      /* Differentiated System Description Table */
DECL|macro|FADT_SIG
mdefine_line|#define FADT_SIG                &quot;FACP&quot;      /* Fixed ACPI Description Table */
DECL|macro|FACS_SIG
mdefine_line|#define FACS_SIG                &quot;FACS&quot;      /* Firmware ACPI Control Structure */
DECL|macro|PSDT_SIG
mdefine_line|#define PSDT_SIG                &quot;PSDT&quot;      /* Persistent System Description Table */
DECL|macro|RSDT_SIG
mdefine_line|#define RSDT_SIG                &quot;RSDT&quot;      /* Root System Description Table */
DECL|macro|XSDT_SIG
mdefine_line|#define XSDT_SIG                &quot;XSDT&quot;      /* Extended  System Description Table */
DECL|macro|SSDT_SIG
mdefine_line|#define SSDT_SIG                &quot;SSDT&quot;      /* Secondary System Description Table */
DECL|macro|SBST_SIG
mdefine_line|#define SBST_SIG                &quot;SBST&quot;      /* Smart Battery Specification Table */
DECL|macro|SPIC_SIG
mdefine_line|#define SPIC_SIG                &quot;SPIC&quot;      /* IOSAPIC table */
DECL|macro|SRAT_SIG
mdefine_line|#define SRAT_SIG                &quot;SRAT&quot;      /* SRAT table */
DECL|macro|SLIT_SIG
mdefine_line|#define SLIT_SIG                &quot;SLIT&quot;      /* SLIT table */
DECL|macro|BOOT_SIG
mdefine_line|#define BOOT_SIG                &quot;BOOT&quot;      /* Boot table */
DECL|macro|ACPI_SRAT_REVISION
mdefine_line|#define ACPI_SRAT_REVISION 1
DECL|macro|ACPI_SLIT_REVISION
mdefine_line|#define ACPI_SLIT_REVISION 1
DECL|macro|OEMID
mdefine_line|#define OEMID&t;&t;&t;&quot;SGI&quot;
macro_line|#ifdef SGI_SN2
DECL|macro|PRODUCT
mdefine_line|#define PRODUCT&t;&t;&t;&quot;SN2&quot;
DECL|macro|PROXIMITY_DOMAIN
mdefine_line|#define PROXIMITY_DOMAIN(nasid)&t;(((nasid)&gt;&gt;1) &amp; 255)
macro_line|#endif
DECL|macro|MB
mdefine_line|#define MB&t;(1024*1024UL)
DECL|macro|GB
mdefine_line|#define GB&t;(MB*1024UL)
DECL|macro|BOOT_PARAM_ADDR
mdefine_line|#define BOOT_PARAM_ADDR 0x40000
DECL|macro|MAX
mdefine_line|#define MAX(i,j)&t;&t;((i) &gt; (j) ? (i) : (j))
DECL|macro|MIN
mdefine_line|#define MIN(i,j)&t;&t;((i) &lt; (j) ? (i) : (j))
DECL|macro|ABS
mdefine_line|#define ABS(i)&t;&t;&t;((i) &gt; 0   ? (i) : -(i))
DECL|macro|ALIGN8
mdefine_line|#define ALIGN8(p)&t;&t;(((long)(p) +7) &amp; ~7)
DECL|macro|FPROM_BUG
mdefine_line|#define FPROM_BUG()&t;&t;do {while (1);} while (0)
DECL|macro|MAX_SN_NODES
mdefine_line|#define MAX_SN_NODES&t;&t;128
DECL|macro|MAX_LSAPICS
mdefine_line|#define MAX_LSAPICS&t;&t;512
DECL|macro|MAX_CPUS
mdefine_line|#define MAX_CPUS&t;&t;512
DECL|macro|MAX_CPUS_NODE
mdefine_line|#define MAX_CPUS_NODE&t;&t;4
DECL|macro|CPUS_PER_NODE
mdefine_line|#define CPUS_PER_NODE&t;&t;4
DECL|macro|CPUS_PER_FSB
mdefine_line|#define CPUS_PER_FSB&t;&t;2
DECL|macro|CPUS_PER_FSB_MASK
mdefine_line|#define CPUS_PER_FSB_MASK&t;(CPUS_PER_FSB-1)
DECL|macro|NUM_EFI_DESCS
mdefine_line|#define NUM_EFI_DESCS&t;&t;2
DECL|macro|RSDP_CHECKSUM_LENGTH
mdefine_line|#define RSDP_CHECKSUM_LENGTH&t;20
DECL|union|ia64_nasid_va
r_typedef
r_union
id|ia64_nasid_va
(brace
r_struct
(brace
macro_line|#if defined(SGI_SN2)
DECL|member|off
r_int
r_int
id|off
suffix:colon
l_int|36
suffix:semicolon
multiline_comment|/* intra-region offset */
DECL|member|attr
r_int
r_int
id|attr
suffix:colon
l_int|2
suffix:semicolon
DECL|member|nasid
r_int
r_int
id|nasid
suffix:colon
l_int|11
suffix:semicolon
multiline_comment|/* NASID */
DECL|member|off2
r_int
r_int
id|off2
suffix:colon
l_int|12
suffix:semicolon
multiline_comment|/* fill */
DECL|member|reg
r_int
r_int
id|reg
suffix:colon
l_int|3
suffix:semicolon
multiline_comment|/* region number */
macro_line|#endif
DECL|member|f
)brace
id|f
suffix:semicolon
DECL|member|l
r_int
r_int
id|l
suffix:semicolon
DECL|member|p
r_void
op_star
id|p
suffix:semicolon
DECL|typedef|ia64_nasid_va
)brace
id|ia64_nasid_va
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|pc
r_int
r_int
id|pc
suffix:semicolon
DECL|member|gp
r_int
r_int
id|gp
suffix:semicolon
DECL|typedef|func_ptr_t
)brace
id|func_ptr_t
suffix:semicolon
DECL|macro|IS_VIRTUAL_MODE
mdefine_line|#define IS_VIRTUAL_MODE() &t; ({struct ia64_psr psr; asm(&quot;mov %0=psr&quot; : &quot;=r&quot;(psr)); psr.dt;})
DECL|macro|ADDR_OF
mdefine_line|#define ADDR_OF(p)&t;&t;(IS_VIRTUAL_MODE() ? ((void*)((long)(p)+PAGE_OFFSET)) : ((void*) (p)))
macro_line|#if defined(SGI_SN2)
DECL|macro|__fwtab_pa
mdefine_line|#define __fwtab_pa(n,x)&t;&t;({ia64_nasid_va _v; _v.l = (long) (x); _v.f.nasid = (x) ? (n) : 0; _v.f.reg = 0; _v.f.attr = 3; _v.l;})
macro_line|#endif
multiline_comment|/*&n; * The following variables are passed thru registersfrom the configuration file and&n; * are set via the _start function.&n; */
DECL|variable|base_nasid
r_int
id|base_nasid
suffix:semicolon
DECL|variable|num_cpus
r_int
id|num_cpus
suffix:semicolon
DECL|variable|bsp_entry_pc
r_int
id|bsp_entry_pc
op_assign
l_int|0
suffix:semicolon
DECL|variable|num_nodes
r_int
id|num_nodes
suffix:semicolon
DECL|variable|app_entry_pc
r_int
id|app_entry_pc
suffix:semicolon
DECL|variable|bsp_lid
r_int
id|bsp_lid
suffix:semicolon
DECL|variable|ap_entry
id|func_ptr_t
id|ap_entry
suffix:semicolon
r_extern
r_void
id|pal_emulator
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|variable|efi_runtime_p
r_static
id|efi_runtime_services_t
op_star
id|efi_runtime_p
suffix:semicolon
DECL|variable|fw_mem
r_static
r_char
id|fw_mem
(braket
(paren
r_sizeof
(paren
id|efi_system_table_t
)paren
op_plus
r_sizeof
(paren
id|efi_runtime_services_t
)paren
op_plus
id|NUM_EFI_DESCS
op_star
r_sizeof
(paren
id|efi_config_table_t
)paren
op_plus
r_sizeof
(paren
r_struct
id|ia64_sal_systab
)paren
op_plus
r_sizeof
(paren
r_struct
id|ia64_sal_desc_entry_point
)paren
op_plus
r_sizeof
(paren
r_struct
id|ia64_sal_desc_ap_wakeup
)paren
op_plus
r_sizeof
(paren
r_struct
id|acpi20_table_rsdp
)paren
op_plus
r_sizeof
(paren
r_struct
id|acpi_table_xsdt
)paren
op_plus
r_sizeof
(paren
r_struct
id|acpi_table_slit
)paren
op_plus
id|MAX_SN_NODES
op_star
id|MAX_SN_NODES
op_plus
l_int|8
op_plus
r_sizeof
(paren
r_struct
id|acpi_table_madt
)paren
op_plus
l_int|16
op_star
id|MAX_CPUS
op_plus
(paren
l_int|1
op_plus
l_int|8
op_star
id|MAX_SN_NODES
)paren
op_star
(paren
r_sizeof
(paren
id|efi_memory_desc_t
)paren
)paren
op_plus
r_sizeof
(paren
r_struct
id|acpi_table_srat
)paren
op_plus
id|MAX_CPUS
op_star
r_sizeof
(paren
r_struct
id|acpi_table_processor_affinity
)paren
op_plus
id|MAX_SN_NODES
op_star
r_sizeof
(paren
r_struct
id|acpi_table_memory_affinity
)paren
op_plus
r_sizeof
(paren
id|ia64_sal_desc_ptc_t
)paren
op_plus
op_plus
id|MAX_SN_NODES
op_star
r_sizeof
(paren
id|ia64_sal_ptc_domain_info_t
)paren
op_plus
op_plus
id|MAX_CPUS
op_star
r_sizeof
(paren
id|ia64_sal_ptc_domain_proc_entry_t
)paren
op_plus
op_plus
l_int|1024
)paren
)braket
id|__attribute__
(paren
(paren
id|aligned
(paren
l_int|8
)paren
)paren
)paren
suffix:semicolon
r_static
id|efi_status_t
DECL|function|efi_get_time
id|efi_get_time
(paren
id|efi_time_t
op_star
id|tm
comma
id|efi_time_cap_t
op_star
id|tc
)paren
(brace
r_if
c_cond
(paren
id|tm
)paren
(brace
id|memset
c_func
(paren
id|tm
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|tm
)paren
)paren
suffix:semicolon
id|tm-&gt;year
op_assign
l_int|2000
suffix:semicolon
id|tm-&gt;month
op_assign
l_int|2
suffix:semicolon
id|tm-&gt;day
op_assign
l_int|13
suffix:semicolon
id|tm-&gt;hour
op_assign
l_int|10
suffix:semicolon
id|tm-&gt;minute
op_assign
l_int|11
suffix:semicolon
id|tm-&gt;second
op_assign
l_int|12
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tc
)paren
(brace
id|tc-&gt;resolution
op_assign
l_int|10
suffix:semicolon
id|tc-&gt;accuracy
op_assign
l_int|12
suffix:semicolon
id|tc-&gt;sets_to_zero
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|EFI_SUCCESS
suffix:semicolon
)brace
r_static
r_void
DECL|function|efi_reset_system
id|efi_reset_system
(paren
r_int
id|reset_type
comma
id|efi_status_t
id|status
comma
r_int
r_int
id|data_size
comma
id|efi_char16_t
op_star
id|data
)paren
(brace
r_while
c_loop
(paren
l_int|1
)paren
(brace
suffix:semicolon
)brace
multiline_comment|/* Is there a pseudo-op to stop medusa */
)brace
r_static
id|efi_status_t
DECL|function|efi_success
id|efi_success
(paren
r_void
)paren
(brace
r_return
id|EFI_SUCCESS
suffix:semicolon
)brace
r_static
id|efi_status_t
DECL|function|efi_unimplemented
id|efi_unimplemented
(paren
r_void
)paren
(brace
r_return
id|EFI_UNSUPPORTED
suffix:semicolon
)brace
macro_line|#ifdef SGI_SN2
DECL|macro|cpu_physical_id
macro_line|#undef cpu_physical_id
DECL|macro|cpu_physical_id
mdefine_line|#define cpu_physical_id(cpuid)                  ((ia64_getreg(_IA64_REG_CR_LID) &gt;&gt; 16) &amp; 0xffff)
r_void
DECL|function|fprom_send_cpei
id|fprom_send_cpei
c_func
(paren
r_void
)paren
(brace
r_int
op_star
id|p
comma
id|val
suffix:semicolon
r_int
id|physid
suffix:semicolon
r_int
id|nasid
comma
id|slice
suffix:semicolon
id|physid
op_assign
id|cpu_physical_id
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|nasid
op_assign
id|cpu_physical_id_to_nasid
c_func
(paren
id|physid
)paren
suffix:semicolon
id|slice
op_assign
id|cpu_physical_id_to_slice
c_func
(paren
id|physid
)paren
suffix:semicolon
id|p
op_assign
(paren
r_int
op_star
)paren
id|GLOBAL_MMR_ADDR
c_func
(paren
id|nasid
comma
id|SH_IPI_INT
)paren
suffix:semicolon
id|val
op_assign
(paren
l_int|1UL
op_lshift
id|SH_IPI_INT_SEND_SHFT
)paren
op_or
(paren
id|physid
op_lshift
id|SH_IPI_INT_PID_SHFT
)paren
op_or
(paren
(paren
r_int
)paren
l_int|0
op_lshift
id|SH_IPI_INT_TYPE_SHFT
)paren
op_or
(paren
(paren
r_int
)paren
l_int|0x1e
op_lshift
id|SH_IPI_INT_IDX_SHFT
)paren
op_or
(paren
l_int|0x000feeUL
op_lshift
id|SH_IPI_INT_BASE_SHFT
)paren
suffix:semicolon
op_star
id|p
op_assign
id|val
suffix:semicolon
)brace
macro_line|#endif
r_static
r_struct
id|sal_ret_values
DECL|function|sal_emulator
id|sal_emulator
(paren
r_int
id|index
comma
r_int
r_int
id|in1
comma
r_int
r_int
id|in2
comma
r_int
r_int
id|in3
comma
r_int
r_int
id|in4
comma
r_int
r_int
id|in5
comma
r_int
r_int
id|in6
comma
r_int
r_int
id|in7
)paren
(brace
r_int
id|r9
op_assign
l_int|0
suffix:semicolon
r_int
id|r10
op_assign
l_int|0
suffix:semicolon
r_int
id|r11
op_assign
l_int|0
suffix:semicolon
r_int
id|status
suffix:semicolon
multiline_comment|/*&n;&t; * Don&squot;t do a &quot;switch&quot; here since that gives us code that&n;&t; * isn&squot;t self-relocatable.&n;&t; */
id|status
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|index
op_eq
id|SAL_FREQ_BASE
)paren
(brace
r_switch
c_cond
(paren
id|in1
)paren
(brace
r_case
id|SAL_FREQ_BASE_PLATFORM
suffix:colon
id|r9
op_assign
l_int|500000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SAL_FREQ_BASE_INTERVAL_TIMER
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * Is this supposed to be the cr.itc frequency&n;&t;&t;&t; * or something platform specific?  The SAL&n;&t;&t;&t; * doc ain&squot;t exactly clear on this...&n;&t;&t;&t; */
id|r9
op_assign
l_int|700000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SAL_FREQ_BASE_REALTIME_CLOCK
suffix:colon
id|r9
op_assign
l_int|50000000
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|status
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SAL_SET_VECTORS
)paren
(brace
r_if
c_cond
(paren
id|in1
op_eq
id|SAL_VECTOR_OS_BOOT_RENDEZ
)paren
(brace
id|func_ptr_t
op_star
id|fp
suffix:semicolon
id|fp
op_assign
id|ADDR_OF
c_func
(paren
op_amp
id|ap_entry
)paren
suffix:semicolon
id|fp-&gt;pc
op_assign
id|in2
suffix:semicolon
id|fp-&gt;gp
op_assign
id|in3
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|in1
op_eq
id|SAL_VECTOR_OS_MCA
op_logical_or
id|in1
op_eq
id|SAL_VECTOR_OS_INIT
)paren
(brace
)brace
r_else
(brace
id|status
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SAL_GET_STATE_INFO
)paren
(brace
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SAL_GET_STATE_INFO_SIZE
)paren
(brace
id|r9
op_assign
l_int|10000
suffix:semicolon
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SAL_CLEAR_STATE_INFO
)paren
(brace
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SAL_MC_RENDEZ
)paren
(brace
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SAL_MC_SET_PARAMS
)paren
(brace
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SAL_CACHE_FLUSH
)paren
(brace
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SAL_CACHE_INIT
)paren
(brace
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SAL_UPDATE_PAL
)paren
(brace
suffix:semicolon
macro_line|#ifdef SGI_SN2
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SN_SAL_LOG_CE
)paren
(brace
macro_line|#ifdef ajmtestcpei
id|fprom_send_cpei
c_func
(paren
)paren
suffix:semicolon
macro_line|#else /* ajmtestcpei */
suffix:semicolon
macro_line|#endif /* ajmtestcpei */
macro_line|#endif
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SN_SAL_PROBE
)paren
(brace
id|r9
op_assign
l_int|0UL
suffix:semicolon
r_if
c_cond
(paren
id|in2
op_eq
l_int|4
)paren
(brace
id|r9
op_assign
op_star
(paren
r_int
op_star
)paren
id|in1
suffix:semicolon
r_if
c_cond
(paren
id|r9
op_eq
op_minus
l_int|1
)paren
(brace
id|status
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|in2
op_eq
l_int|2
)paren
(brace
id|r9
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|in1
suffix:semicolon
r_if
c_cond
(paren
id|r9
op_eq
op_minus
l_int|1
)paren
(brace
id|status
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|in2
op_eq
l_int|1
)paren
(brace
id|r9
op_assign
op_star
(paren
r_int
r_char
op_star
)paren
id|in1
suffix:semicolon
r_if
c_cond
(paren
id|r9
op_eq
op_minus
l_int|1
)paren
(brace
id|status
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|in2
op_eq
l_int|8
)paren
(brace
id|r9
op_assign
op_star
(paren
r_int
r_int
op_star
)paren
id|in1
suffix:semicolon
r_if
c_cond
(paren
id|r9
op_eq
op_minus
l_int|1
)paren
(brace
id|status
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
(brace
id|status
op_assign
l_int|2
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SN_SAL_GET_KLCONFIG_ADDR
)paren
(brace
id|r9
op_assign
l_int|0x30000
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SN_SAL_CONSOLE_PUTC
)paren
(brace
id|status
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SN_SAL_CONSOLE_GETC
)paren
(brace
id|status
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SN_SAL_CONSOLE_POLL
)paren
(brace
id|status
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SN_SAL_SYSCTL_IOBRICK_MODULE_GET
)paren
(brace
id|status
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|status
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
id|asm
r_volatile
(paren
l_string|&quot;&quot;
op_scope_resolution
l_string|&quot;r&quot;
(paren
id|r9
)paren
comma
l_string|&quot;r&quot;
(paren
id|r10
)paren
comma
l_string|&quot;r&quot;
(paren
id|r11
)paren
)paren
suffix:semicolon
r_return
(paren
(paren
r_struct
id|sal_ret_values
)paren
(brace
id|status
comma
id|r9
comma
id|r10
comma
id|r11
)brace
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * This is here to work around a bug in egcs-1.1.1b that causes the&n; * compiler to crash (seems like a bug in the new alias analysis code.&n; */
r_void
op_star
DECL|function|id
id|id
(paren
r_int
id|addr
)paren
(brace
r_return
(paren
r_void
op_star
)paren
id|addr
suffix:semicolon
)brace
multiline_comment|/*&n; * Fix the addresses in a function pointer by adding base node address&n; * to pc &amp; gp.&n; */
r_void
DECL|function|fix_function_pointer
id|fix_function_pointer
c_func
(paren
r_void
op_star
id|fp
)paren
(brace
id|func_ptr_t
op_star
id|_fp
suffix:semicolon
id|_fp
op_assign
id|fp
suffix:semicolon
id|_fp-&gt;pc
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|_fp-&gt;pc
)paren
suffix:semicolon
id|_fp-&gt;gp
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|_fp-&gt;gp
)paren
suffix:semicolon
)brace
r_void
DECL|function|fix_virt_function_pointer
id|fix_virt_function_pointer
c_func
(paren
r_void
op_star
op_star
id|fptr
)paren
(brace
id|func_ptr_t
op_star
id|fp
suffix:semicolon
r_int
op_star
id|p
suffix:semicolon
id|p
op_assign
(paren
r_int
op_star
)paren
id|fptr
suffix:semicolon
id|fp
op_assign
op_star
id|fptr
suffix:semicolon
id|fp-&gt;pc
op_assign
id|fp-&gt;pc
op_or
id|PAGE_OFFSET
suffix:semicolon
id|fp-&gt;gp
op_assign
id|fp-&gt;gp
op_or
id|PAGE_OFFSET
suffix:semicolon
op_star
id|p
op_or_assign
id|PAGE_OFFSET
suffix:semicolon
)brace
r_int
DECL|function|efi_set_virtual_address_map
id|efi_set_virtual_address_map
c_func
(paren
r_void
)paren
(brace
id|efi_runtime_services_t
op_star
id|runtime
suffix:semicolon
id|runtime
op_assign
id|efi_runtime_p
suffix:semicolon
id|fix_virt_function_pointer
c_func
(paren
(paren
r_void
op_star
op_star
)paren
op_amp
id|runtime-&gt;get_time
)paren
suffix:semicolon
id|fix_virt_function_pointer
c_func
(paren
(paren
r_void
op_star
op_star
)paren
op_amp
id|runtime-&gt;set_time
)paren
suffix:semicolon
id|fix_virt_function_pointer
c_func
(paren
(paren
r_void
op_star
op_star
)paren
op_amp
id|runtime-&gt;get_wakeup_time
)paren
suffix:semicolon
id|fix_virt_function_pointer
c_func
(paren
(paren
r_void
op_star
op_star
)paren
op_amp
id|runtime-&gt;set_wakeup_time
)paren
suffix:semicolon
id|fix_virt_function_pointer
c_func
(paren
(paren
r_void
op_star
op_star
)paren
op_amp
id|runtime-&gt;set_virtual_address_map
)paren
suffix:semicolon
id|fix_virt_function_pointer
c_func
(paren
(paren
r_void
op_star
op_star
)paren
op_amp
id|runtime-&gt;get_variable
)paren
suffix:semicolon
id|fix_virt_function_pointer
c_func
(paren
(paren
r_void
op_star
op_star
)paren
op_amp
id|runtime-&gt;get_next_variable
)paren
suffix:semicolon
id|fix_virt_function_pointer
c_func
(paren
(paren
r_void
op_star
op_star
)paren
op_amp
id|runtime-&gt;set_variable
)paren
suffix:semicolon
id|fix_virt_function_pointer
c_func
(paren
(paren
r_void
op_star
op_star
)paren
op_amp
id|runtime-&gt;get_next_high_mono_count
)paren
suffix:semicolon
id|fix_virt_function_pointer
c_func
(paren
(paren
r_void
op_star
op_star
)paren
op_amp
id|runtime-&gt;reset_system
)paren
suffix:semicolon
r_return
id|EFI_SUCCESS
suffix:semicolon
suffix:semicolon
)brace
r_void
DECL|function|acpi_table_initx
id|acpi_table_initx
c_func
(paren
r_struct
id|acpi_table_header
op_star
id|p
comma
r_char
op_star
id|sig
comma
r_int
id|siglen
comma
r_int
id|revision
comma
r_int
id|oem_revision
)paren
(brace
id|memcpy
c_func
(paren
id|p-&gt;signature
comma
id|sig
comma
id|siglen
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|p-&gt;oem_id
comma
id|OEMID
comma
l_int|6
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|p-&gt;oem_table_id
comma
id|sig
comma
l_int|4
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|p-&gt;oem_table_id
op_plus
l_int|4
comma
id|PRODUCT
comma
l_int|4
)paren
suffix:semicolon
id|p-&gt;revision
op_assign
id|revision
suffix:semicolon
id|p-&gt;oem_revision
op_assign
(paren
id|revision
op_lshift
l_int|16
)paren
op_plus
id|oem_revision
suffix:semicolon
id|memcpy
c_func
(paren
id|p-&gt;asl_compiler_id
comma
l_string|&quot;FPRM&quot;
comma
l_int|4
)paren
suffix:semicolon
id|p-&gt;asl_compiler_revision
op_assign
l_int|1
suffix:semicolon
)brace
r_void
DECL|function|acpi_checksum
id|acpi_checksum
c_func
(paren
r_struct
id|acpi_table_header
op_star
id|p
comma
r_int
id|length
)paren
(brace
id|u8
op_star
id|cp
comma
op_star
id|cpe
comma
id|checksum
suffix:semicolon
id|p-&gt;checksum
op_assign
l_int|0
suffix:semicolon
id|p-&gt;length
op_assign
id|length
suffix:semicolon
id|checksum
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|cp
op_assign
(paren
id|u8
op_star
)paren
id|p
comma
id|cpe
op_assign
id|cp
op_plus
id|p-&gt;length
suffix:semicolon
id|cp
OL
id|cpe
suffix:semicolon
id|cp
op_increment
)paren
id|checksum
op_add_assign
op_star
id|cp
suffix:semicolon
id|p-&gt;checksum
op_assign
op_minus
id|checksum
suffix:semicolon
)brace
r_void
DECL|function|acpi_checksum_rsdp20
id|acpi_checksum_rsdp20
c_func
(paren
r_struct
id|acpi20_table_rsdp
op_star
id|p
comma
r_int
id|length
)paren
(brace
id|u8
op_star
id|cp
comma
op_star
id|cpe
comma
id|checksum
suffix:semicolon
id|p-&gt;checksum
op_assign
l_int|0
suffix:semicolon
id|p-&gt;ext_checksum
op_assign
l_int|0
suffix:semicolon
id|p-&gt;length
op_assign
id|length
suffix:semicolon
id|checksum
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|cp
op_assign
(paren
id|u8
op_star
)paren
id|p
comma
id|cpe
op_assign
id|cp
op_plus
l_int|20
suffix:semicolon
id|cp
OL
id|cpe
suffix:semicolon
id|cp
op_increment
)paren
id|checksum
op_add_assign
op_star
id|cp
suffix:semicolon
id|p-&gt;checksum
op_assign
op_minus
id|checksum
suffix:semicolon
id|checksum
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|cp
op_assign
(paren
id|u8
op_star
)paren
id|p
comma
id|cpe
op_assign
id|cp
op_plus
id|length
suffix:semicolon
id|cp
OL
id|cpe
suffix:semicolon
id|cp
op_increment
)paren
id|checksum
op_add_assign
op_star
id|cp
suffix:semicolon
id|p-&gt;ext_checksum
op_assign
op_minus
id|checksum
suffix:semicolon
)brace
r_int
DECL|function|nasid_present
id|nasid_present
c_func
(paren
r_int
id|nasid
)paren
(brace
r_int
id|cnode
suffix:semicolon
r_for
c_loop
(paren
id|cnode
op_assign
l_int|0
suffix:semicolon
id|cnode
OL
id|num_nodes
suffix:semicolon
id|cnode
op_increment
)paren
r_if
c_cond
(paren
id|GetNasid
c_func
(paren
id|cnode
)paren
op_eq
id|nasid
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|sys_fw_init
id|sys_fw_init
(paren
r_const
r_char
op_star
id|args
comma
r_int
id|arglen
comma
r_int
id|bsp
)paren
(brace
multiline_comment|/*&n;&t; * Use static variables to keep from overflowing the RSE stack&n;&t; */
r_static
id|efi_system_table_t
op_star
id|efi_systab
suffix:semicolon
r_static
id|efi_runtime_services_t
op_star
id|efi_runtime
suffix:semicolon
r_static
id|efi_config_table_t
op_star
id|efi_tables
suffix:semicolon
r_static
id|ia64_sal_desc_ptc_t
op_star
id|sal_ptc
suffix:semicolon
r_static
id|ia64_sal_ptc_domain_info_t
op_star
id|sal_ptcdi
suffix:semicolon
r_static
id|ia64_sal_ptc_domain_proc_entry_t
op_star
id|sal_ptclid
suffix:semicolon
r_static
r_struct
id|acpi20_table_rsdp
op_star
id|acpi20_rsdp
suffix:semicolon
r_static
r_struct
id|acpi_table_xsdt
op_star
id|acpi_xsdt
suffix:semicolon
r_static
r_struct
id|acpi_table_slit
op_star
id|acpi_slit
suffix:semicolon
r_static
r_struct
id|acpi_table_madt
op_star
id|acpi_madt
suffix:semicolon
r_static
r_struct
id|acpi_table_lsapic
op_star
id|lsapic20
suffix:semicolon
r_static
r_struct
id|ia64_sal_systab
op_star
id|sal_systab
suffix:semicolon
r_static
r_struct
id|acpi_table_srat
op_star
id|acpi_srat
suffix:semicolon
r_static
r_struct
id|acpi_table_processor_affinity
op_star
id|srat_cpu_affinity
suffix:semicolon
r_static
r_struct
id|acpi_table_memory_affinity
op_star
id|srat_memory_affinity
suffix:semicolon
r_static
id|efi_memory_desc_t
op_star
id|efi_memmap
comma
op_star
id|md
suffix:semicolon
r_static
r_int
r_int
op_star
id|pal_desc
comma
op_star
id|sal_desc
suffix:semicolon
r_static
r_struct
id|ia64_sal_desc_entry_point
op_star
id|sal_ed
suffix:semicolon
r_static
r_struct
id|ia64_boot_param
op_star
id|bp
suffix:semicolon
r_static
r_struct
id|ia64_sal_desc_ap_wakeup
op_star
id|sal_apwake
suffix:semicolon
r_static
r_int
r_char
id|checksum
suffix:semicolon
r_static
r_char
op_star
id|cp
comma
op_star
id|cmd_line
comma
op_star
id|vendor
suffix:semicolon
r_static
r_void
op_star
id|ptr
suffix:semicolon
r_static
r_int
id|mdsize
comma
id|domain
comma
id|last_domain
suffix:semicolon
r_static
r_int
id|i
comma
id|j
comma
id|cnode
comma
id|max_nasid
comma
id|nasid
comma
id|cpu
comma
id|num_memmd
comma
id|cpus_found
suffix:semicolon
multiline_comment|/*&n;&t; * Pass the parameter base address to the build_efi_xxx routines.&n;&t; */
macro_line|#if defined(SGI_SN2)
id|build_init
c_func
(paren
l_int|0x3000000000UL
op_or
(paren
(paren
r_int
)paren
id|base_nasid
op_lshift
l_int|38
)paren
)paren
suffix:semicolon
macro_line|#endif
id|num_nodes
op_assign
id|GetNumNodes
c_func
(paren
)paren
suffix:semicolon
id|num_cpus
op_assign
id|GetNumCpus
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|max_nasid
op_assign
l_int|0
comma
id|cnode
op_assign
l_int|0
suffix:semicolon
id|cnode
OL
id|num_nodes
suffix:semicolon
id|cnode
op_increment
)paren
id|max_nasid
op_assign
id|MAX
c_func
(paren
id|max_nasid
comma
id|GetNasid
c_func
(paren
id|cnode
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|fw_mem
comma
l_int|0
comma
r_sizeof
(paren
id|fw_mem
)paren
)paren
suffix:semicolon
id|pal_desc
op_assign
(paren
r_int
r_int
op_star
)paren
op_amp
id|pal_emulator
suffix:semicolon
id|sal_desc
op_assign
(paren
r_int
r_int
op_star
)paren
op_amp
id|sal_emulator
suffix:semicolon
id|fix_function_pointer
c_func
(paren
op_amp
id|pal_emulator
)paren
suffix:semicolon
id|fix_function_pointer
c_func
(paren
op_amp
id|sal_emulator
)paren
suffix:semicolon
multiline_comment|/* Align this to 16 bytes, probably EFI does this  */
id|mdsize
op_assign
(paren
r_sizeof
(paren
id|efi_memory_desc_t
)paren
op_plus
l_int|15
)paren
op_amp
op_complement
l_int|15
suffix:semicolon
id|cp
op_assign
id|fw_mem
suffix:semicolon
id|efi_systab
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
id|ALIGN8
c_func
(paren
r_sizeof
(paren
op_star
id|efi_systab
)paren
)paren
suffix:semicolon
id|efi_runtime_p
op_assign
id|efi_runtime
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
id|ALIGN8
c_func
(paren
r_sizeof
(paren
op_star
id|efi_runtime
)paren
)paren
suffix:semicolon
id|efi_tables
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
id|ALIGN8
c_func
(paren
id|NUM_EFI_DESCS
op_star
r_sizeof
(paren
op_star
id|efi_tables
)paren
)paren
suffix:semicolon
id|sal_systab
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
id|ALIGN8
c_func
(paren
r_sizeof
(paren
op_star
id|sal_systab
)paren
)paren
suffix:semicolon
id|sal_ed
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
id|ALIGN8
c_func
(paren
r_sizeof
(paren
op_star
id|sal_ed
)paren
)paren
suffix:semicolon
id|sal_ptc
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
id|ALIGN8
c_func
(paren
r_sizeof
(paren
op_star
id|sal_ptc
)paren
)paren
suffix:semicolon
id|sal_apwake
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
id|ALIGN8
c_func
(paren
r_sizeof
(paren
op_star
id|sal_apwake
)paren
)paren
suffix:semicolon
id|acpi20_rsdp
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
id|ALIGN8
c_func
(paren
r_sizeof
(paren
op_star
id|acpi20_rsdp
)paren
)paren
suffix:semicolon
id|acpi_xsdt
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
id|ALIGN8
c_func
(paren
r_sizeof
(paren
op_star
id|acpi_xsdt
)paren
op_plus
l_int|64
)paren
suffix:semicolon
multiline_comment|/* save space for more OS defined table pointers. */
id|acpi_slit
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
id|ALIGN8
c_func
(paren
r_sizeof
(paren
op_star
id|acpi_slit
)paren
op_plus
l_int|8
op_plus
(paren
id|max_nasid
op_plus
l_int|1
)paren
op_star
(paren
id|max_nasid
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|acpi_madt
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
id|ALIGN8
c_func
(paren
r_sizeof
(paren
op_star
id|acpi_madt
)paren
op_plus
r_sizeof
(paren
r_struct
id|acpi_table_lsapic
)paren
op_star
(paren
id|num_cpus
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|acpi_srat
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
id|ALIGN8
c_func
(paren
r_sizeof
(paren
r_struct
id|acpi_table_srat
)paren
)paren
suffix:semicolon
id|cp
op_add_assign
r_sizeof
(paren
r_struct
id|acpi_table_processor_affinity
)paren
op_star
id|num_cpus
op_plus
r_sizeof
(paren
r_struct
id|acpi_table_memory_affinity
)paren
op_star
id|num_nodes
suffix:semicolon
id|vendor
op_assign
(paren
r_char
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
id|ALIGN8
c_func
(paren
l_int|40
)paren
suffix:semicolon
id|efi_memmap
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
id|ALIGN8
c_func
(paren
l_int|8
op_star
l_int|32
op_star
r_sizeof
(paren
op_star
id|efi_memmap
)paren
)paren
suffix:semicolon
id|sal_ptcdi
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
id|ALIGN8
c_func
(paren
id|CPUS_PER_FSB
op_star
(paren
l_int|1
op_plus
id|num_nodes
)paren
op_star
r_sizeof
(paren
op_star
id|sal_ptcdi
)paren
)paren
suffix:semicolon
id|sal_ptclid
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
id|ALIGN8
c_func
(paren
(paren
(paren
l_int|3
op_plus
id|num_cpus
)paren
op_star
r_sizeof
(paren
op_star
id|sal_ptclid
)paren
op_plus
l_int|7
)paren
op_div
l_int|8
op_star
l_int|8
)paren
suffix:semicolon
id|cmd_line
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
r_if
c_cond
(paren
id|args
)paren
(brace
r_if
c_cond
(paren
id|arglen
op_ge
l_int|1024
)paren
id|arglen
op_assign
l_int|1023
suffix:semicolon
id|memcpy
c_func
(paren
id|cmd_line
comma
id|args
comma
id|arglen
)paren
suffix:semicolon
)brace
r_else
(brace
id|arglen
op_assign
l_int|0
suffix:semicolon
)brace
id|cmd_line
(braket
id|arglen
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
multiline_comment|/* &n;&t; * For now, just bring up bash.&n;&t; * If you want to execute all the startup scripts, delete the &quot;init=..&quot;.&n;&t; * You can also edit this line to pass other arguments to the kernel.&n;&t; *    Note: disable kernel text replication.&n;&t; */
id|strcpy
c_func
(paren
id|cmd_line
comma
l_string|&quot;init=/bin/bash console=ttyS0&quot;
)paren
suffix:semicolon
id|memset
c_func
(paren
id|efi_systab
comma
l_int|0
comma
r_sizeof
(paren
id|efi_systab
)paren
)paren
suffix:semicolon
id|efi_systab-&gt;hdr.signature
op_assign
id|EFI_SYSTEM_TABLE_SIGNATURE
suffix:semicolon
id|efi_systab-&gt;hdr.revision
op_assign
id|EFI_SYSTEM_TABLE_REVISION
suffix:semicolon
id|efi_systab-&gt;hdr.headersize
op_assign
r_sizeof
(paren
id|efi_systab-&gt;hdr
)paren
suffix:semicolon
id|efi_systab-&gt;fw_vendor
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|vendor
)paren
suffix:semicolon
id|efi_systab-&gt;fw_revision
op_assign
l_int|1
suffix:semicolon
id|efi_systab-&gt;runtime
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|efi_runtime
)paren
suffix:semicolon
id|efi_systab-&gt;nr_tables
op_assign
l_int|2
suffix:semicolon
id|efi_systab-&gt;tables
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|efi_tables
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|vendor
comma
l_string|&quot;S&bslash;0i&bslash;0l&bslash;0i&bslash;0c&bslash;0o&bslash;0n&bslash;0-&bslash;0G&bslash;0r&bslash;0a&bslash;0p&bslash;0h&bslash;0i&bslash;0c&bslash;0s&bslash;0&bslash;0&quot;
comma
l_int|40
)paren
suffix:semicolon
id|efi_runtime-&gt;hdr.signature
op_assign
id|EFI_RUNTIME_SERVICES_SIGNATURE
suffix:semicolon
id|efi_runtime-&gt;hdr.revision
op_assign
id|EFI_RUNTIME_SERVICES_REVISION
suffix:semicolon
id|efi_runtime-&gt;hdr.headersize
op_assign
r_sizeof
(paren
id|efi_runtime-&gt;hdr
)paren
suffix:semicolon
id|efi_runtime-&gt;get_time
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|efi_get_time
)paren
suffix:semicolon
id|efi_runtime-&gt;set_time
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|efi_unimplemented
)paren
suffix:semicolon
id|efi_runtime-&gt;get_wakeup_time
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|efi_unimplemented
)paren
suffix:semicolon
id|efi_runtime-&gt;set_wakeup_time
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|efi_unimplemented
)paren
suffix:semicolon
id|efi_runtime-&gt;set_virtual_address_map
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|efi_set_virtual_address_map
)paren
suffix:semicolon
id|efi_runtime-&gt;get_variable
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|efi_unimplemented
)paren
suffix:semicolon
id|efi_runtime-&gt;get_next_variable
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|efi_unimplemented
)paren
suffix:semicolon
id|efi_runtime-&gt;set_variable
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|efi_unimplemented
)paren
suffix:semicolon
id|efi_runtime-&gt;get_next_high_mono_count
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|efi_unimplemented
)paren
suffix:semicolon
id|efi_runtime-&gt;reset_system
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|efi_reset_system
)paren
suffix:semicolon
id|efi_tables-&gt;guid
op_assign
id|SAL_SYSTEM_TABLE_GUID
suffix:semicolon
id|efi_tables-&gt;table
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|sal_systab
)paren
suffix:semicolon
id|efi_tables
op_increment
suffix:semicolon
id|efi_tables-&gt;guid
op_assign
id|ACPI_20_TABLE_GUID
suffix:semicolon
id|efi_tables-&gt;table
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|acpi20_rsdp
)paren
suffix:semicolon
id|efi_tables
op_increment
suffix:semicolon
id|fix_function_pointer
c_func
(paren
op_amp
id|efi_unimplemented
)paren
suffix:semicolon
id|fix_function_pointer
c_func
(paren
op_amp
id|efi_get_time
)paren
suffix:semicolon
id|fix_function_pointer
c_func
(paren
op_amp
id|efi_success
)paren
suffix:semicolon
id|fix_function_pointer
c_func
(paren
op_amp
id|efi_reset_system
)paren
suffix:semicolon
id|fix_function_pointer
c_func
(paren
op_amp
id|efi_set_virtual_address_map
)paren
suffix:semicolon
multiline_comment|/* fill in the ACPI20 system table - has a pointer to the ACPI table header */
id|memcpy
c_func
(paren
id|acpi20_rsdp-&gt;signature
comma
l_string|&quot;RSD PTR &quot;
comma
l_int|8
)paren
suffix:semicolon
id|acpi20_rsdp-&gt;xsdt_address
op_assign
(paren
id|u64
)paren
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|acpi_xsdt
)paren
suffix:semicolon
id|acpi20_rsdp-&gt;revision
op_assign
l_int|2
suffix:semicolon
id|acpi_checksum_rsdp20
c_func
(paren
id|acpi20_rsdp
comma
r_sizeof
(paren
r_struct
id|acpi20_table_rsdp
)paren
)paren
suffix:semicolon
multiline_comment|/* Set up the XSDT table  - contains pointers to the other ACPI tables */
id|acpi_table_initx
c_func
(paren
op_amp
id|acpi_xsdt-&gt;header
comma
id|XSDT_SIG
comma
l_int|4
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
id|acpi_xsdt-&gt;entry
(braket
l_int|0
)braket
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|acpi_madt
)paren
suffix:semicolon
id|acpi_xsdt-&gt;entry
(braket
l_int|1
)braket
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|acpi_slit
)paren
suffix:semicolon
id|acpi_xsdt-&gt;entry
(braket
l_int|2
)braket
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|acpi_srat
)paren
suffix:semicolon
id|acpi_checksum
c_func
(paren
op_amp
id|acpi_xsdt-&gt;header
comma
r_sizeof
(paren
r_struct
id|acpi_table_xsdt
)paren
op_plus
l_int|16
)paren
suffix:semicolon
multiline_comment|/* Set up the APIC table */
id|acpi_table_initx
c_func
(paren
op_amp
id|acpi_madt-&gt;header
comma
id|APIC_SIG
comma
l_int|4
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
id|lsapic20
op_assign
(paren
r_struct
id|acpi_table_lsapic
op_star
)paren
(paren
id|acpi_madt
op_plus
l_int|1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnode
op_assign
l_int|0
suffix:semicolon
id|cnode
OL
id|num_nodes
suffix:semicolon
id|cnode
op_increment
)paren
(brace
id|nasid
op_assign
id|GetNasid
c_func
(paren
id|cnode
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cpu
op_assign
l_int|0
suffix:semicolon
id|cpu
OL
id|CPUS_PER_NODE
suffix:semicolon
id|cpu
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|IsCpuPresent
c_func
(paren
id|cnode
comma
id|cpu
)paren
)paren
r_continue
suffix:semicolon
id|lsapic20-&gt;header.type
op_assign
id|ACPI_MADT_LSAPIC
suffix:semicolon
id|lsapic20-&gt;header.length
op_assign
r_sizeof
(paren
r_struct
id|acpi_table_lsapic
)paren
suffix:semicolon
id|lsapic20-&gt;acpi_id
op_assign
id|cnode
op_star
l_int|4
op_plus
id|cpu
suffix:semicolon
id|lsapic20-&gt;flags.enabled
op_assign
l_int|1
suffix:semicolon
macro_line|#if defined(SGI_SN2)
id|lsapic20-&gt;eid
op_assign
id|nasid
op_amp
l_int|0xffff
suffix:semicolon
id|lsapic20-&gt;id
op_assign
(paren
id|cpu
op_lshift
l_int|4
)paren
op_or
(paren
id|nasid
op_rshift
l_int|16
)paren
suffix:semicolon
macro_line|#endif
id|lsapic20
op_assign
(paren
r_struct
id|acpi_table_lsapic
op_star
)paren
(paren
(paren
r_int
)paren
id|lsapic20
op_plus
r_sizeof
(paren
r_struct
id|acpi_table_lsapic
)paren
)paren
suffix:semicolon
)brace
)brace
id|acpi_checksum
c_func
(paren
op_amp
id|acpi_madt-&gt;header
comma
(paren
r_char
op_star
)paren
id|lsapic20
op_minus
(paren
r_char
op_star
)paren
id|acpi_madt
)paren
suffix:semicolon
multiline_comment|/* Set up the SRAT table */
id|acpi_table_initx
c_func
(paren
op_amp
id|acpi_srat-&gt;header
comma
id|SRAT_SIG
comma
l_int|4
comma
id|ACPI_SRAT_REVISION
comma
l_int|1
)paren
suffix:semicolon
id|ptr
op_assign
id|acpi_srat
op_plus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|cnode
op_assign
l_int|0
suffix:semicolon
id|cnode
OL
id|num_nodes
suffix:semicolon
id|cnode
op_increment
)paren
(brace
id|nasid
op_assign
id|GetNasid
c_func
(paren
id|cnode
)paren
suffix:semicolon
id|srat_memory_affinity
op_assign
id|ptr
suffix:semicolon
id|ptr
op_assign
id|srat_memory_affinity
op_plus
l_int|1
suffix:semicolon
id|srat_memory_affinity-&gt;header.type
op_assign
id|ACPI_SRAT_MEMORY_AFFINITY
suffix:semicolon
id|srat_memory_affinity-&gt;header.length
op_assign
r_sizeof
(paren
r_struct
id|acpi_table_memory_affinity
)paren
suffix:semicolon
id|srat_memory_affinity-&gt;proximity_domain
op_assign
id|PROXIMITY_DOMAIN
c_func
(paren
id|nasid
)paren
suffix:semicolon
id|srat_memory_affinity-&gt;base_addr_lo
op_assign
l_int|0
suffix:semicolon
id|srat_memory_affinity-&gt;length_lo
op_assign
l_int|0
suffix:semicolon
macro_line|#if defined(SGI_SN2)
id|srat_memory_affinity-&gt;base_addr_hi
op_assign
(paren
id|nasid
op_lshift
l_int|6
)paren
op_or
(paren
l_int|3
op_lshift
l_int|4
)paren
suffix:semicolon
id|srat_memory_affinity-&gt;length_hi
op_assign
(paren
id|MD_BANKSIZE
op_star
id|MD_BANKS_PER_NODE
)paren
op_rshift
l_int|32
suffix:semicolon
macro_line|#endif
id|srat_memory_affinity-&gt;memory_type
op_assign
id|ACPI_ADDRESS_RANGE_MEMORY
suffix:semicolon
id|srat_memory_affinity-&gt;flags.enabled
op_assign
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|cnode
op_assign
l_int|0
suffix:semicolon
id|cnode
OL
id|num_nodes
suffix:semicolon
id|cnode
op_increment
)paren
(brace
id|nasid
op_assign
id|GetNasid
c_func
(paren
id|cnode
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cpu
op_assign
l_int|0
suffix:semicolon
id|cpu
OL
id|CPUS_PER_NODE
suffix:semicolon
id|cpu
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|IsCpuPresent
c_func
(paren
id|cnode
comma
id|cpu
)paren
)paren
r_continue
suffix:semicolon
id|srat_cpu_affinity
op_assign
id|ptr
suffix:semicolon
id|ptr
op_assign
id|srat_cpu_affinity
op_plus
l_int|1
suffix:semicolon
id|srat_cpu_affinity-&gt;header.type
op_assign
id|ACPI_SRAT_PROCESSOR_AFFINITY
suffix:semicolon
id|srat_cpu_affinity-&gt;header.length
op_assign
r_sizeof
(paren
r_struct
id|acpi_table_processor_affinity
)paren
suffix:semicolon
id|srat_cpu_affinity-&gt;proximity_domain
op_assign
id|PROXIMITY_DOMAIN
c_func
(paren
id|nasid
)paren
suffix:semicolon
id|srat_cpu_affinity-&gt;flags.enabled
op_assign
l_int|1
suffix:semicolon
macro_line|#if defined(SGI_SN2)
id|srat_cpu_affinity-&gt;lsapic_eid
op_assign
id|nasid
op_amp
l_int|0xffff
suffix:semicolon
id|srat_cpu_affinity-&gt;apic_id
op_assign
(paren
id|cpu
op_lshift
l_int|4
)paren
op_or
(paren
id|nasid
op_rshift
l_int|16
)paren
suffix:semicolon
macro_line|#endif
)brace
)brace
id|acpi_checksum
c_func
(paren
op_amp
id|acpi_srat-&gt;header
comma
(paren
r_char
op_star
)paren
id|ptr
op_minus
(paren
r_char
op_star
)paren
id|acpi_srat
)paren
suffix:semicolon
multiline_comment|/* Set up the SLIT table */
id|acpi_table_initx
c_func
(paren
op_amp
id|acpi_slit-&gt;header
comma
id|SLIT_SIG
comma
l_int|4
comma
id|ACPI_SLIT_REVISION
comma
l_int|1
)paren
suffix:semicolon
id|acpi_slit-&gt;localities
op_assign
id|PROXIMITY_DOMAIN
c_func
(paren
id|max_nasid
)paren
op_plus
l_int|1
suffix:semicolon
id|cp
op_assign
id|acpi_slit-&gt;entry
suffix:semicolon
id|memset
c_func
(paren
id|cp
comma
l_int|255
comma
id|acpi_slit-&gt;localities
op_star
id|acpi_slit-&gt;localities
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|max_nasid
suffix:semicolon
id|i
op_increment
)paren
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
op_le
id|max_nasid
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|nasid_present
c_func
(paren
id|i
)paren
op_logical_and
id|nasid_present
c_func
(paren
id|j
)paren
)paren
op_star
(paren
id|cp
op_plus
id|PROXIMITY_DOMAIN
c_func
(paren
id|i
)paren
op_star
id|acpi_slit-&gt;localities
op_plus
id|PROXIMITY_DOMAIN
c_func
(paren
id|j
)paren
)paren
op_assign
l_int|10
op_plus
id|MIN
c_func
(paren
l_int|254
comma
l_int|5
op_star
id|ABS
c_func
(paren
id|i
op_minus
id|j
)paren
)paren
suffix:semicolon
id|cp
op_assign
id|acpi_slit-&gt;entry
op_plus
id|acpi_slit-&gt;localities
op_star
id|acpi_slit-&gt;localities
suffix:semicolon
id|acpi_checksum
c_func
(paren
op_amp
id|acpi_slit-&gt;header
comma
id|cp
op_minus
(paren
r_char
op_star
)paren
id|acpi_slit
)paren
suffix:semicolon
multiline_comment|/* fill in the SAL system table: */
id|memcpy
c_func
(paren
id|sal_systab-&gt;signature
comma
l_string|&quot;SST_&quot;
comma
l_int|4
)paren
suffix:semicolon
id|sal_systab-&gt;size
op_assign
r_sizeof
(paren
op_star
id|sal_systab
)paren
suffix:semicolon
id|sal_systab-&gt;sal_rev_minor
op_assign
l_int|1
suffix:semicolon
id|sal_systab-&gt;sal_rev_major
op_assign
l_int|0
suffix:semicolon
id|sal_systab-&gt;entry_count
op_assign
l_int|3
suffix:semicolon
id|sal_systab-&gt;sal_b_rev_major
op_assign
l_int|0x1
suffix:semicolon
multiline_comment|/* set the SN SAL rev to */
id|sal_systab-&gt;sal_b_rev_minor
op_assign
l_int|0x0
suffix:semicolon
multiline_comment|/* 1.00 */
id|strcpy
c_func
(paren
id|sal_systab-&gt;oem_id
comma
l_string|&quot;SGI&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|sal_systab-&gt;product_id
comma
l_string|&quot;SN2&quot;
)paren
suffix:semicolon
multiline_comment|/* fill in an entry point: */
id|sal_ed-&gt;type
op_assign
id|SAL_DESC_ENTRY_POINT
suffix:semicolon
id|sal_ed-&gt;pal_proc
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|pal_desc
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|sal_ed-&gt;sal_proc
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|sal_desc
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|sal_ed-&gt;gp
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|sal_desc
(braket
l_int|1
)braket
)paren
suffix:semicolon
multiline_comment|/* kludge the PTC domain info */
id|sal_ptc-&gt;type
op_assign
id|SAL_DESC_PTC
suffix:semicolon
id|sal_ptc-&gt;num_domains
op_assign
l_int|0
suffix:semicolon
id|sal_ptc-&gt;domain_info
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|sal_ptcdi
)paren
suffix:semicolon
id|cpus_found
op_assign
l_int|0
suffix:semicolon
id|last_domain
op_assign
op_minus
l_int|1
suffix:semicolon
id|sal_ptcdi
op_decrement
suffix:semicolon
r_for
c_loop
(paren
id|cnode
op_assign
l_int|0
suffix:semicolon
id|cnode
OL
id|num_nodes
suffix:semicolon
id|cnode
op_increment
)paren
(brace
id|nasid
op_assign
id|GetNasid
c_func
(paren
id|cnode
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cpu
op_assign
l_int|0
suffix:semicolon
id|cpu
OL
id|CPUS_PER_NODE
suffix:semicolon
id|cpu
op_increment
)paren
(brace
r_if
c_cond
(paren
id|IsCpuPresent
c_func
(paren
id|cnode
comma
id|cpu
)paren
)paren
(brace
id|domain
op_assign
id|cnode
op_star
id|CPUS_PER_NODE
op_plus
id|cpu
op_div
id|CPUS_PER_FSB
suffix:semicolon
r_if
c_cond
(paren
id|domain
op_ne
id|last_domain
)paren
(brace
id|sal_ptc-&gt;num_domains
op_increment
suffix:semicolon
id|sal_ptcdi
op_increment
suffix:semicolon
id|sal_ptcdi-&gt;proc_count
op_assign
l_int|0
suffix:semicolon
id|sal_ptcdi-&gt;proc_list
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|sal_ptclid
)paren
suffix:semicolon
id|last_domain
op_assign
id|domain
suffix:semicolon
)brace
id|sal_ptcdi-&gt;proc_count
op_increment
suffix:semicolon
id|sal_ptclid-&gt;id
op_assign
id|nasid
suffix:semicolon
id|sal_ptclid-&gt;eid
op_assign
id|cpu
suffix:semicolon
id|sal_ptclid
op_increment
suffix:semicolon
id|cpus_found
op_increment
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|cpus_found
op_ne
id|num_cpus
)paren
id|FPROM_BUG
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Make the AP WAKEUP entry */
id|sal_apwake-&gt;type
op_assign
id|SAL_DESC_AP_WAKEUP
suffix:semicolon
id|sal_apwake-&gt;mechanism
op_assign
id|IA64_SAL_AP_EXTERNAL_INT
suffix:semicolon
id|sal_apwake-&gt;vector
op_assign
l_int|18
suffix:semicolon
r_for
c_loop
(paren
id|checksum
op_assign
l_int|0
comma
id|cp
op_assign
(paren
r_char
op_star
)paren
id|sal_systab
suffix:semicolon
id|cp
OL
(paren
r_char
op_star
)paren
id|efi_memmap
suffix:semicolon
op_increment
id|cp
)paren
id|checksum
op_add_assign
op_star
id|cp
suffix:semicolon
id|sal_systab-&gt;checksum
op_assign
op_minus
id|checksum
suffix:semicolon
multiline_comment|/* If the checksum is correct, the kernel tries to use the&n;&t; * table. We dont build enough table &amp; the kernel aborts.&n;&t; * Note that the PROM hasd thhhe same problem!!&n;&t; */
id|md
op_assign
op_amp
id|efi_memmap
(braket
l_int|0
)braket
suffix:semicolon
id|num_memmd
op_assign
id|build_efi_memmap
c_func
(paren
(paren
r_void
op_star
)paren
id|md
comma
id|mdsize
)paren
suffix:semicolon
id|bp
op_assign
(paren
r_struct
id|ia64_boot_param
op_star
)paren
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|BOOT_PARAM_ADDR
)paren
suffix:semicolon
id|bp-&gt;efi_systab
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|fw_mem
)paren
suffix:semicolon
id|bp-&gt;efi_memmap
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|efi_memmap
)paren
suffix:semicolon
id|bp-&gt;efi_memmap_size
op_assign
id|num_memmd
op_star
id|mdsize
suffix:semicolon
id|bp-&gt;efi_memdesc_size
op_assign
id|mdsize
suffix:semicolon
id|bp-&gt;efi_memdesc_version
op_assign
l_int|0x101
suffix:semicolon
id|bp-&gt;command_line
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|cmd_line
)paren
suffix:semicolon
id|bp-&gt;console_info.num_cols
op_assign
l_int|80
suffix:semicolon
id|bp-&gt;console_info.num_rows
op_assign
l_int|25
suffix:semicolon
id|bp-&gt;console_info.orig_x
op_assign
l_int|0
suffix:semicolon
id|bp-&gt;console_info.orig_y
op_assign
l_int|24
suffix:semicolon
id|bp-&gt;fpswa
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Now pick the BSP &amp; store it LID value in&n;&t; * a global variable. Note if BSP is greater than last cpu,&n;&t; * pick the last cpu.&n;&t; */
r_for
c_loop
(paren
id|cnode
op_assign
l_int|0
suffix:semicolon
id|cnode
OL
id|num_nodes
suffix:semicolon
id|cnode
op_increment
)paren
(brace
r_for
c_loop
(paren
id|cpu
op_assign
l_int|0
suffix:semicolon
id|cpu
OL
id|CPUS_PER_NODE
suffix:semicolon
id|cpu
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|IsCpuPresent
c_func
(paren
id|cnode
comma
id|cpu
)paren
)paren
r_continue
suffix:semicolon
macro_line|#ifdef SGI_SN2
id|bsp_lid
op_assign
(paren
id|GetNasid
c_func
(paren
id|cnode
)paren
op_lshift
l_int|16
)paren
op_or
(paren
id|cpu
op_lshift
l_int|28
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|bsp
op_decrement
OG
l_int|0
)paren
r_continue
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
)brace
eof
