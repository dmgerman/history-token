multiline_comment|/*&n; * PAL &amp; SAL emulation.&n; *&n; * Copyright (C) 1998-2000 Hewlett-Packard Co&n; * Copyright (C) 1998-2000 David Mosberger-Tang &lt;davidm@hpl.hp.com&gt;&n; *&n; *&n; * Copyright (C) 2000 Silicon Graphics, Inc.&n; * Copyright (C) 2000 by Jack Steiner (steiner@sgi.com)&n; */
macro_line|#include &lt;asm/efi.h&gt;
macro_line|#include &lt;asm/pal.h&gt;
macro_line|#include &lt;asm/sal.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/acpi-ext.h&gt;
macro_line|#include &quot;fpmem.h&quot;
DECL|macro|MB
mdefine_line|#define MB&t;(1024*1024UL)
DECL|macro|GB
mdefine_line|#define GB&t;(MB*1024UL)
DECL|macro|FPROM_BUG
mdefine_line|#define FPROM_BUG()&t;&t;do {while (1);} while (0)
DECL|macro|MAX_NODES
mdefine_line|#define MAX_NODES&t;&t;128
DECL|macro|MAX_LSAPICS
mdefine_line|#define MAX_LSAPICS&t;&t;512
DECL|macro|MAX_CPUS
mdefine_line|#define MAX_CPUS&t;&t;512
DECL|macro|MAX_CPUS_NODE
mdefine_line|#define MAX_CPUS_NODE&t;&t;4
DECL|macro|CPUS_PER_NODE
mdefine_line|#define CPUS_PER_NODE&t;&t;4
DECL|macro|CPUS_PER_FSB
mdefine_line|#define CPUS_PER_FSB&t;&t;2
DECL|macro|CPUS_PER_FSB_MASK
mdefine_line|#define CPUS_PER_FSB_MASK&t;(CPUS_PER_FSB-1)
DECL|macro|NUM_EFI_DESCS
mdefine_line|#define NUM_EFI_DESCS&t;&t;2
DECL|union|ia64_nasid_va
r_typedef
r_union
id|ia64_nasid_va
(brace
r_struct
(brace
DECL|member|off
r_int
r_int
id|off
suffix:colon
l_int|33
suffix:semicolon
multiline_comment|/* intra-region offset */
DECL|member|nasid
r_int
r_int
id|nasid
suffix:colon
l_int|7
suffix:semicolon
multiline_comment|/* NASID */
DECL|member|off2
r_int
r_int
id|off2
suffix:colon
l_int|21
suffix:semicolon
multiline_comment|/* fill */
DECL|member|reg
r_int
r_int
id|reg
suffix:colon
l_int|3
suffix:semicolon
multiline_comment|/* region number */
DECL|member|f
)brace
id|f
suffix:semicolon
DECL|member|l
r_int
r_int
id|l
suffix:semicolon
DECL|member|p
r_void
op_star
id|p
suffix:semicolon
DECL|typedef|ia64_nasid_va
)brace
id|ia64_nasid_va
suffix:semicolon
r_typedef
r_struct
(brace
DECL|member|pc
r_int
r_int
id|pc
suffix:semicolon
DECL|member|gp
r_int
r_int
id|gp
suffix:semicolon
DECL|typedef|func_ptr_t
)brace
id|func_ptr_t
suffix:semicolon
DECL|macro|IS_VIRTUAL_MODE
mdefine_line|#define IS_VIRTUAL_MODE() &t; ({struct ia64_psr psr; asm(&quot;mov %0=psr&quot; : &quot;=r&quot;(psr)); psr.dt;})
DECL|macro|ADDR_OF
mdefine_line|#define ADDR_OF(p)&t;&t;(IS_VIRTUAL_MODE() ? ((void*)((long)(p)+PAGE_OFFSET)) : ((void*) (p)))
DECL|macro|__fwtab_pa
mdefine_line|#define __fwtab_pa(n,x)&t;&t;({ia64_nasid_va _v; _v.l = (long) (x); _v.f.nasid = (x) ? (n) : 0; _v.f.reg = 0; _v.l;})
multiline_comment|/*&n; * The following variables are passed thru registersfrom the configuration file and&n; * are set via the _start function.&n; */
DECL|variable|base_nasid
r_int
id|base_nasid
suffix:semicolon
DECL|variable|num_cpus
r_int
id|num_cpus
suffix:semicolon
DECL|variable|bsp_entry_pc
r_int
id|bsp_entry_pc
op_assign
l_int|0
suffix:semicolon
DECL|variable|num_nodes
r_int
id|num_nodes
suffix:semicolon
DECL|variable|app_entry_pc
r_int
id|app_entry_pc
suffix:semicolon
DECL|variable|bsp_lid
r_int
id|bsp_lid
suffix:semicolon
DECL|variable|ap_entry
id|func_ptr_t
id|ap_entry
suffix:semicolon
DECL|variable|fw_mem
r_static
r_char
id|fw_mem
(braket
(paren
r_sizeof
(paren
id|efi_system_table_t
)paren
op_plus
r_sizeof
(paren
id|efi_runtime_services_t
)paren
op_plus
id|NUM_EFI_DESCS
op_star
r_sizeof
(paren
id|efi_config_table_t
)paren
op_plus
r_sizeof
(paren
r_struct
id|ia64_sal_systab
)paren
op_plus
r_sizeof
(paren
r_struct
id|ia64_sal_desc_entry_point
)paren
op_plus
r_sizeof
(paren
r_struct
id|ia64_sal_desc_ap_wakeup
)paren
op_plus
r_sizeof
(paren
id|acpi_rsdp_t
)paren
op_plus
r_sizeof
(paren
id|acpi_rsdt_t
)paren
op_plus
r_sizeof
(paren
id|acpi_sapic_t
)paren
op_plus
id|MAX_LSAPICS
op_star
(paren
r_sizeof
(paren
id|acpi_entry_lsapic_t
)paren
)paren
op_plus
(paren
l_int|1
op_plus
l_int|8
op_star
id|MAX_NODES
)paren
op_star
(paren
r_sizeof
(paren
id|efi_memory_desc_t
)paren
)paren
op_plus
r_sizeof
(paren
id|ia64_sal_desc_ptc_t
)paren
op_plus
op_plus
id|MAX_NODES
op_star
r_sizeof
(paren
id|ia64_sal_ptc_domain_info_t
)paren
op_plus
op_plus
id|MAX_CPUS
op_star
r_sizeof
(paren
id|ia64_sal_ptc_domain_proc_entry_t
)paren
op_plus
op_plus
l_int|1024
)paren
)braket
id|__attribute__
(paren
(paren
id|aligned
(paren
l_int|8
)paren
)paren
)paren
suffix:semicolon
multiline_comment|/*&n; * Very ugly, but we need this in the simulator only.  Once we run on&n; * real hw, this can all go away.&n; */
r_extern
r_void
id|pal_emulator_static
(paren
r_void
)paren
suffix:semicolon
id|asm
(paren
"&quot;"
dot
id|text
dot
id|proc
id|pal_emulator_static
id|pal_emulator_static
suffix:colon
id|mov
id|r8
op_assign
op_minus
l_int|1
id|cmp.eq
id|p6
comma
id|p7
op_assign
l_int|6
comma
id|r28
multiline_comment|/* PAL_PTCE_INFO */
(paren
id|p7
)paren
id|br.cond.sptk.few
l_float|1f
suffix:semicolon
suffix:semicolon
id|mov
id|r8
op_assign
l_int|0
multiline_comment|/* status = 0 */
id|movl
id|r9
op_assign
l_int|0x500000000
multiline_comment|/* tc.base */
id|movl
id|r10
op_assign
l_int|0x0000000200000003
multiline_comment|/* count[0], count[1] */
id|movl
id|r11
op_assign
l_int|0x1000000000002000
multiline_comment|/* stride[0], stride[1] */
id|br.cond.sptk.few
id|rp
l_int|1
suffix:colon
id|cmp.eq
id|p6
comma
id|p7
op_assign
l_int|14
comma
id|r28
multiline_comment|/* PAL_FREQ_RATIOS */
(paren
id|p7
)paren
id|br.cond.sptk.few
l_float|1f
id|mov
id|r8
op_assign
l_int|0
multiline_comment|/* status = 0 */
id|movl
id|r9
op_assign
l_int|0x100000064
multiline_comment|/* proc_ratio (1/100) */
id|movl
id|r10
op_assign
l_int|0x100000100
multiline_comment|/* bus_ratio&lt;&lt;32 (1/256) */
id|movl
id|r11
op_assign
l_int|0x10000000a
multiline_comment|/* itc_ratio&lt;&lt;32 (1/100) */
l_int|1
suffix:colon
id|cmp.eq
id|p6
comma
id|p7
op_assign
l_int|22
comma
id|r28
multiline_comment|/* PAL_MC_DRAIN */
(paren
id|p7
)paren
id|br.cond.sptk.few
l_float|1f
id|mov
id|r8
op_assign
l_int|0
id|br.cond.sptk.few
id|rp
l_int|1
suffix:colon
id|cmp.eq
id|p6
comma
id|p7
op_assign
l_int|23
comma
id|r28
multiline_comment|/* PAL_MC_EXPECTED */
(paren
id|p7
)paren
id|br.cond.sptk.few
l_float|1f
id|mov
id|r8
op_assign
l_int|0
id|br.cond.sptk.few
id|rp
l_int|1
suffix:colon
id|br.cond.sptk.few
id|rp
dot
id|endp
id|pal_emulator_static
"&bslash;"
id|n
"&quot;"
)paren
suffix:semicolon
r_static
id|efi_status_t
DECL|function|efi_get_time
id|efi_get_time
(paren
id|efi_time_t
op_star
id|tm
comma
id|efi_time_cap_t
op_star
id|tc
)paren
(brace
r_if
c_cond
(paren
id|tm
)paren
(brace
id|memset
c_func
(paren
id|tm
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|tm
)paren
)paren
suffix:semicolon
id|tm-&gt;year
op_assign
l_int|2000
suffix:semicolon
id|tm-&gt;month
op_assign
l_int|2
suffix:semicolon
id|tm-&gt;day
op_assign
l_int|13
suffix:semicolon
id|tm-&gt;hour
op_assign
l_int|10
suffix:semicolon
id|tm-&gt;minute
op_assign
l_int|11
suffix:semicolon
id|tm-&gt;second
op_assign
l_int|12
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tc
)paren
(brace
id|tc-&gt;resolution
op_assign
l_int|10
suffix:semicolon
id|tc-&gt;accuracy
op_assign
l_int|12
suffix:semicolon
id|tc-&gt;sets_to_zero
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|EFI_SUCCESS
suffix:semicolon
)brace
r_static
r_void
DECL|function|efi_reset_system
id|efi_reset_system
(paren
r_int
id|reset_type
comma
id|efi_status_t
id|status
comma
r_int
r_int
id|data_size
comma
id|efi_char16_t
op_star
id|data
)paren
(brace
r_while
c_loop
(paren
l_int|1
)paren
(brace
suffix:semicolon
)brace
multiline_comment|/* Is there a pseudo-op to stop medusa */
)brace
r_static
id|efi_status_t
DECL|function|efi_success
id|efi_success
(paren
r_void
)paren
(brace
r_return
id|EFI_SUCCESS
suffix:semicolon
)brace
r_static
id|efi_status_t
DECL|function|efi_unimplemented
id|efi_unimplemented
(paren
r_void
)paren
(brace
r_return
id|EFI_UNSUPPORTED
suffix:semicolon
)brace
r_static
r_int
DECL|function|sal_emulator
id|sal_emulator
(paren
r_int
id|index
comma
r_int
r_int
id|in1
comma
r_int
r_int
id|in2
comma
r_int
r_int
id|in3
comma
r_int
r_int
id|in4
comma
r_int
r_int
id|in5
comma
r_int
r_int
id|in6
comma
r_int
r_int
id|in7
)paren
(brace
r_register
r_int
id|r9
id|asm
(paren
l_string|&quot;r9&quot;
)paren
op_assign
l_int|0
suffix:semicolon
r_register
r_int
id|r10
id|asm
(paren
l_string|&quot;r10&quot;
)paren
op_assign
l_int|0
suffix:semicolon
r_register
r_int
id|r11
id|asm
(paren
l_string|&quot;r11&quot;
)paren
op_assign
l_int|0
suffix:semicolon
r_int
id|status
suffix:semicolon
multiline_comment|/*&n;&t; * Don&squot;t do a &quot;switch&quot; here since that gives us code that&n;&t; * isn&squot;t self-relocatable.&n;&t; */
id|status
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|index
op_eq
id|SAL_FREQ_BASE
)paren
(brace
r_switch
c_cond
(paren
id|in1
)paren
(brace
r_case
id|SAL_FREQ_BASE_PLATFORM
suffix:colon
id|r9
op_assign
l_int|500000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SAL_FREQ_BASE_INTERVAL_TIMER
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * Is this supposed to be the cr.itc frequency&n;&t;&t;&t; * or something platform specific?  The SAL&n;&t;&t;&t; * doc ain&squot;t exactly clear on this...&n;&t;&t;&t; */
id|r9
op_assign
l_int|700000000
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SAL_FREQ_BASE_REALTIME_CLOCK
suffix:colon
id|r9
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|status
op_assign
op_minus
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SAL_SET_VECTORS
)paren
(brace
r_if
c_cond
(paren
id|in1
op_eq
id|SAL_VECTOR_OS_BOOT_RENDEZ
)paren
(brace
id|func_ptr_t
op_star
id|fp
suffix:semicolon
id|fp
op_assign
id|ADDR_OF
c_func
(paren
op_amp
id|ap_entry
)paren
suffix:semicolon
id|fp-&gt;pc
op_assign
id|in2
suffix:semicolon
id|fp-&gt;gp
op_assign
id|in3
suffix:semicolon
)brace
r_else
(brace
id|status
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SAL_GET_STATE_INFO
)paren
(brace
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SAL_GET_STATE_INFO_SIZE
)paren
(brace
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SAL_CLEAR_STATE_INFO
)paren
(brace
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SAL_MC_RENDEZ
)paren
(brace
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SAL_MC_SET_PARAMS
)paren
(brace
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SAL_CACHE_FLUSH
)paren
(brace
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SAL_CACHE_INIT
)paren
(brace
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|index
op_eq
id|SAL_UPDATE_PAL
)paren
(brace
suffix:semicolon
)brace
r_else
(brace
id|status
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
id|asm
r_volatile
(paren
l_string|&quot;&quot;
op_scope_resolution
l_string|&quot;r&quot;
(paren
id|r9
)paren
comma
l_string|&quot;r&quot;
(paren
id|r10
)paren
comma
l_string|&quot;r&quot;
(paren
id|r11
)paren
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
multiline_comment|/*&n; * This is here to work around a bug in egcs-1.1.1b that causes the&n; * compiler to crash (seems like a bug in the new alias analysis code.&n; */
r_void
op_star
DECL|function|id
id|id
(paren
r_int
id|addr
)paren
(brace
r_return
(paren
r_void
op_star
)paren
id|addr
suffix:semicolon
)brace
multiline_comment|/*&n; * Fix the addresses in a function pointer by adding base node address&n; * to pc &amp; gp.&n; */
r_void
DECL|function|fix_function_pointer
id|fix_function_pointer
c_func
(paren
r_void
op_star
id|fp
)paren
(brace
id|func_ptr_t
op_star
id|_fp
suffix:semicolon
id|_fp
op_assign
id|fp
suffix:semicolon
id|_fp-&gt;pc
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|_fp-&gt;pc
)paren
suffix:semicolon
id|_fp-&gt;gp
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|_fp-&gt;gp
)paren
suffix:semicolon
)brace
r_void
DECL|function|sys_fw_init
id|sys_fw_init
(paren
r_const
r_char
op_star
id|args
comma
r_int
id|arglen
comma
r_int
id|bsp
)paren
(brace
multiline_comment|/*&n;&t; * Use static variables to keep from overflowing the RSE stack&n;&t; */
r_static
id|efi_system_table_t
op_star
id|efi_systab
suffix:semicolon
r_static
id|efi_runtime_services_t
op_star
id|efi_runtime
suffix:semicolon
r_static
id|efi_config_table_t
op_star
id|efi_tables
suffix:semicolon
r_static
id|ia64_sal_desc_ptc_t
op_star
id|sal_ptc
suffix:semicolon
r_static
id|ia64_sal_ptc_domain_info_t
op_star
id|sal_ptcdi
suffix:semicolon
r_static
id|ia64_sal_ptc_domain_proc_entry_t
op_star
id|sal_ptclid
suffix:semicolon
r_static
id|acpi_rsdp_t
op_star
id|acpi_systab
suffix:semicolon
r_static
id|acpi_rsdt_t
op_star
id|acpi_rsdt
suffix:semicolon
r_static
id|acpi_sapic_t
op_star
id|acpi_sapic
suffix:semicolon
r_static
id|acpi_entry_lsapic_t
op_star
id|acpi_lsapic
suffix:semicolon
r_static
r_struct
id|ia64_sal_systab
op_star
id|sal_systab
suffix:semicolon
r_static
id|efi_memory_desc_t
op_star
id|efi_memmap
comma
op_star
id|md
suffix:semicolon
r_static
r_int
r_int
op_star
id|pal_desc
comma
op_star
id|sal_desc
suffix:semicolon
r_static
r_struct
id|ia64_sal_desc_entry_point
op_star
id|sal_ed
suffix:semicolon
r_static
r_struct
id|ia64_boot_param
op_star
id|bp
suffix:semicolon
r_static
r_struct
id|ia64_sal_desc_ap_wakeup
op_star
id|sal_apwake
suffix:semicolon
r_static
r_int
r_char
id|checksum
op_assign
l_int|0
suffix:semicolon
r_static
r_char
op_star
id|cp
comma
op_star
id|cmd_line
comma
op_star
id|vendor
suffix:semicolon
r_static
r_int
id|mdsize
comma
id|domain
comma
id|last_domain
suffix:semicolon
r_static
r_int
id|cnode
comma
id|nasid
comma
id|cpu
comma
id|num_memmd
comma
id|cpus_found
suffix:semicolon
multiline_comment|/*&n;&t; * Pass the parameter base address to the build_efi_xxx routines.&n;&t; */
id|build_init
c_func
(paren
l_int|8LL
op_star
id|GB
op_star
id|base_nasid
)paren
suffix:semicolon
id|num_nodes
op_assign
id|GetNumNodes
c_func
(paren
)paren
suffix:semicolon
id|num_cpus
op_assign
id|GetNumCpus
c_func
(paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|fw_mem
comma
l_int|0
comma
r_sizeof
(paren
id|fw_mem
)paren
)paren
suffix:semicolon
id|pal_desc
op_assign
(paren
r_int
r_int
op_star
)paren
op_amp
id|pal_emulator_static
suffix:semicolon
id|sal_desc
op_assign
(paren
r_int
r_int
op_star
)paren
op_amp
id|sal_emulator
suffix:semicolon
id|fix_function_pointer
c_func
(paren
op_amp
id|pal_emulator_static
)paren
suffix:semicolon
id|fix_function_pointer
c_func
(paren
op_amp
id|sal_emulator
)paren
suffix:semicolon
multiline_comment|/* Align this to 16 bytes, probably EFI does this  */
id|mdsize
op_assign
(paren
r_sizeof
(paren
id|efi_memory_desc_t
)paren
op_plus
l_int|15
)paren
op_amp
op_complement
l_int|15
suffix:semicolon
id|cp
op_assign
id|fw_mem
suffix:semicolon
id|efi_systab
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
r_sizeof
(paren
op_star
id|efi_systab
)paren
suffix:semicolon
id|efi_runtime
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
r_sizeof
(paren
op_star
id|efi_runtime
)paren
suffix:semicolon
id|efi_tables
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
id|NUM_EFI_DESCS
op_star
r_sizeof
(paren
op_star
id|efi_tables
)paren
suffix:semicolon
id|sal_systab
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
r_sizeof
(paren
op_star
id|sal_systab
)paren
suffix:semicolon
id|sal_ed
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
r_sizeof
(paren
op_star
id|sal_ed
)paren
suffix:semicolon
id|sal_ptc
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
r_sizeof
(paren
op_star
id|sal_ptc
)paren
suffix:semicolon
id|sal_apwake
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
r_sizeof
(paren
op_star
id|sal_apwake
)paren
suffix:semicolon
id|acpi_systab
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
r_sizeof
(paren
op_star
id|acpi_systab
)paren
suffix:semicolon
id|acpi_rsdt
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
r_sizeof
(paren
op_star
id|acpi_rsdt
)paren
suffix:semicolon
id|acpi_sapic
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
r_sizeof
(paren
op_star
id|acpi_sapic
)paren
suffix:semicolon
id|acpi_lsapic
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
id|num_cpus
op_star
r_sizeof
(paren
op_star
id|acpi_lsapic
)paren
suffix:semicolon
id|vendor
op_assign
(paren
r_char
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
l_int|32
suffix:semicolon
id|efi_memmap
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
l_int|8
op_star
l_int|32
op_star
r_sizeof
(paren
op_star
id|efi_memmap
)paren
suffix:semicolon
id|sal_ptcdi
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
id|CPUS_PER_FSB
op_star
(paren
l_int|1
op_plus
id|num_nodes
)paren
op_star
r_sizeof
(paren
op_star
id|sal_ptcdi
)paren
suffix:semicolon
id|sal_ptclid
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
id|cp
op_add_assign
(paren
(paren
l_int|3
op_plus
id|num_cpus
)paren
op_star
r_sizeof
(paren
op_star
id|sal_ptclid
)paren
op_plus
l_int|7
)paren
op_div
l_int|8
op_star
l_int|8
suffix:semicolon
id|cmd_line
op_assign
(paren
r_void
op_star
)paren
id|cp
suffix:semicolon
r_if
c_cond
(paren
id|args
)paren
(brace
r_if
c_cond
(paren
id|arglen
op_ge
l_int|1024
)paren
id|arglen
op_assign
l_int|1023
suffix:semicolon
id|memcpy
c_func
(paren
id|cmd_line
comma
id|args
comma
id|arglen
)paren
suffix:semicolon
)brace
r_else
(brace
id|arglen
op_assign
l_int|0
suffix:semicolon
)brace
id|cmd_line
(braket
id|arglen
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
macro_line|#ifdef BRINGUP
multiline_comment|/* for now, just bring up bash */
id|strcpy
c_func
(paren
id|cmd_line
comma
l_string|&quot;init=/bin/bash&quot;
)paren
suffix:semicolon
macro_line|#else
id|strcpy
c_func
(paren
id|cmd_line
comma
l_string|&quot;&quot;
)paren
suffix:semicolon
macro_line|#endif
id|memset
c_func
(paren
id|efi_systab
comma
l_int|0
comma
r_sizeof
(paren
id|efi_systab
)paren
)paren
suffix:semicolon
id|efi_systab-&gt;hdr.signature
op_assign
id|EFI_SYSTEM_TABLE_SIGNATURE
suffix:semicolon
id|efi_systab-&gt;hdr.revision
op_assign
id|EFI_SYSTEM_TABLE_REVISION
suffix:semicolon
id|efi_systab-&gt;hdr.headersize
op_assign
r_sizeof
(paren
id|efi_systab-&gt;hdr
)paren
suffix:semicolon
id|efi_systab-&gt;fw_vendor
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|vendor
)paren
suffix:semicolon
id|efi_systab-&gt;fw_revision
op_assign
l_int|1
suffix:semicolon
id|efi_systab-&gt;runtime
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|efi_runtime
)paren
suffix:semicolon
id|efi_systab-&gt;nr_tables
op_assign
l_int|2
suffix:semicolon
id|efi_systab-&gt;tables
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|efi_tables
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|vendor
comma
l_string|&quot;S&bslash;0i&bslash;0l&bslash;0i&bslash;0c&bslash;0o&bslash;0n&bslash;0-&bslash;0G&bslash;0r&bslash;0a&bslash;0p&bslash;0h&bslash;0i&bslash;0c&bslash;0s&bslash;0&bslash;0&quot;
comma
l_int|32
)paren
suffix:semicolon
id|efi_runtime-&gt;hdr.signature
op_assign
id|EFI_RUNTIME_SERVICES_SIGNATURE
suffix:semicolon
id|efi_runtime-&gt;hdr.revision
op_assign
id|EFI_RUNTIME_SERVICES_REVISION
suffix:semicolon
id|efi_runtime-&gt;hdr.headersize
op_assign
r_sizeof
(paren
id|efi_runtime-&gt;hdr
)paren
suffix:semicolon
id|efi_runtime-&gt;get_time
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|efi_get_time
)paren
suffix:semicolon
id|efi_runtime-&gt;set_time
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|efi_unimplemented
)paren
suffix:semicolon
id|efi_runtime-&gt;get_wakeup_time
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|efi_unimplemented
)paren
suffix:semicolon
id|efi_runtime-&gt;set_wakeup_time
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|efi_unimplemented
)paren
suffix:semicolon
id|efi_runtime-&gt;set_virtual_address_map
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|efi_success
)paren
suffix:semicolon
id|efi_runtime-&gt;get_variable
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|efi_unimplemented
)paren
suffix:semicolon
id|efi_runtime-&gt;get_next_variable
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|efi_unimplemented
)paren
suffix:semicolon
id|efi_runtime-&gt;set_variable
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|efi_unimplemented
)paren
suffix:semicolon
id|efi_runtime-&gt;get_next_high_mono_count
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|efi_unimplemented
)paren
suffix:semicolon
id|efi_runtime-&gt;reset_system
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|efi_reset_system
)paren
suffix:semicolon
id|efi_tables-&gt;guid
op_assign
id|SAL_SYSTEM_TABLE_GUID
suffix:semicolon
id|efi_tables-&gt;table
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|sal_systab
)paren
suffix:semicolon
id|efi_tables
op_increment
suffix:semicolon
id|efi_tables-&gt;guid
op_assign
id|ACPI_TABLE_GUID
suffix:semicolon
id|efi_tables-&gt;table
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|acpi_systab
)paren
suffix:semicolon
id|fix_function_pointer
c_func
(paren
op_amp
id|efi_unimplemented
)paren
suffix:semicolon
id|fix_function_pointer
c_func
(paren
op_amp
id|efi_get_time
)paren
suffix:semicolon
id|fix_function_pointer
c_func
(paren
op_amp
id|efi_success
)paren
suffix:semicolon
id|fix_function_pointer
c_func
(paren
op_amp
id|efi_reset_system
)paren
suffix:semicolon
multiline_comment|/* fill in the ACPI system table: */
id|memcpy
c_func
(paren
id|acpi_systab-&gt;signature
comma
l_string|&quot;RSD PTR &quot;
comma
l_int|8
)paren
suffix:semicolon
id|acpi_systab-&gt;rsdt
op_assign
(paren
id|acpi_rsdt_t
op_star
)paren
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|acpi_rsdt
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|acpi_rsdt-&gt;header.signature
comma
l_string|&quot;RSDT&quot;
comma
l_int|4
)paren
suffix:semicolon
id|acpi_rsdt-&gt;header.length
op_assign
r_sizeof
(paren
id|acpi_rsdt_t
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|acpi_rsdt-&gt;header.oem_id
comma
l_string|&quot;SGI&quot;
comma
l_int|3
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|acpi_rsdt-&gt;header.oem_table_id
comma
l_string|&quot;SN1&quot;
comma
l_int|3
)paren
suffix:semicolon
id|acpi_rsdt-&gt;header.oem_revision
op_assign
l_int|0x00010001
suffix:semicolon
id|acpi_rsdt-&gt;entry_ptrs
(braket
l_int|0
)braket
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|acpi_sapic
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|acpi_sapic-&gt;header.signature
comma
l_string|&quot;SPIC &quot;
comma
l_int|4
)paren
suffix:semicolon
id|acpi_sapic-&gt;header.length
op_assign
r_sizeof
(paren
id|acpi_sapic_t
)paren
op_plus
id|num_cpus
op_star
r_sizeof
(paren
id|acpi_entry_lsapic_t
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnode
op_assign
l_int|0
suffix:semicolon
id|cnode
OL
id|num_nodes
suffix:semicolon
id|cnode
op_increment
)paren
(brace
id|nasid
op_assign
id|GetNasid
c_func
(paren
id|cnode
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cpu
op_assign
l_int|0
suffix:semicolon
id|cpu
OL
id|CPUS_PER_NODE
suffix:semicolon
id|cpu
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|IsCpuPresent
c_func
(paren
id|cnode
comma
id|cpu
)paren
)paren
r_continue
suffix:semicolon
id|acpi_lsapic-&gt;type
op_assign
id|ACPI_ENTRY_LOCAL_SAPIC
suffix:semicolon
id|acpi_lsapic-&gt;length
op_assign
r_sizeof
(paren
id|acpi_entry_lsapic_t
)paren
suffix:semicolon
id|acpi_lsapic-&gt;acpi_processor_id
op_assign
id|cnode
op_star
l_int|4
op_plus
id|cpu
suffix:semicolon
id|acpi_lsapic-&gt;flags
op_assign
id|LSAPIC_ENABLED
op_or
id|LSAPIC_PRESENT
suffix:semicolon
id|acpi_lsapic-&gt;eid
op_assign
id|cpu
suffix:semicolon
id|acpi_lsapic-&gt;id
op_assign
id|nasid
suffix:semicolon
id|acpi_lsapic
op_increment
suffix:semicolon
)brace
)brace
multiline_comment|/* fill in the SAL system table: */
id|memcpy
c_func
(paren
id|sal_systab-&gt;signature
comma
l_string|&quot;SST_&quot;
comma
l_int|4
)paren
suffix:semicolon
id|sal_systab-&gt;size
op_assign
r_sizeof
(paren
op_star
id|sal_systab
)paren
suffix:semicolon
id|sal_systab-&gt;sal_rev_minor
op_assign
l_int|1
suffix:semicolon
id|sal_systab-&gt;sal_rev_major
op_assign
l_int|0
suffix:semicolon
id|sal_systab-&gt;entry_count
op_assign
l_int|3
suffix:semicolon
id|strcpy
c_func
(paren
id|sal_systab-&gt;oem_id
comma
l_string|&quot;SGI&quot;
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|sal_systab-&gt;product_id
comma
l_string|&quot;SN1&quot;
)paren
suffix:semicolon
multiline_comment|/* fill in an entry point: */
id|sal_ed-&gt;type
op_assign
id|SAL_DESC_ENTRY_POINT
suffix:semicolon
id|sal_ed-&gt;pal_proc
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|pal_desc
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|sal_ed-&gt;sal_proc
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|sal_desc
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|sal_ed-&gt;gp
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|sal_desc
(braket
l_int|1
)braket
)paren
suffix:semicolon
multiline_comment|/* kludge the PTC domain info */
id|sal_ptc-&gt;type
op_assign
id|SAL_DESC_PTC
suffix:semicolon
id|sal_ptc-&gt;num_domains
op_assign
l_int|0
suffix:semicolon
id|sal_ptc-&gt;domain_info
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|sal_ptcdi
)paren
suffix:semicolon
id|cpus_found
op_assign
l_int|0
suffix:semicolon
id|last_domain
op_assign
op_minus
l_int|1
suffix:semicolon
id|sal_ptcdi
op_decrement
suffix:semicolon
r_for
c_loop
(paren
id|cnode
op_assign
l_int|0
suffix:semicolon
id|cnode
OL
id|num_nodes
suffix:semicolon
id|cnode
op_increment
)paren
(brace
id|nasid
op_assign
id|GetNasid
c_func
(paren
id|cnode
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cpu
op_assign
l_int|0
suffix:semicolon
id|cpu
OL
id|CPUS_PER_NODE
suffix:semicolon
id|cpu
op_increment
)paren
(brace
r_if
c_cond
(paren
id|IsCpuPresent
c_func
(paren
id|cnode
comma
id|cpu
)paren
)paren
(brace
id|domain
op_assign
id|cnode
op_star
id|CPUS_PER_NODE
op_plus
id|cpu
op_div
id|CPUS_PER_FSB
suffix:semicolon
r_if
c_cond
(paren
id|domain
op_ne
id|last_domain
)paren
(brace
id|sal_ptc-&gt;num_domains
op_increment
suffix:semicolon
id|sal_ptcdi
op_increment
suffix:semicolon
id|sal_ptcdi-&gt;proc_count
op_assign
l_int|0
suffix:semicolon
id|sal_ptcdi-&gt;proc_list
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|sal_ptclid
)paren
suffix:semicolon
id|last_domain
op_assign
id|domain
suffix:semicolon
)brace
id|sal_ptcdi-&gt;proc_count
op_increment
suffix:semicolon
id|sal_ptclid-&gt;id
op_assign
id|nasid
suffix:semicolon
id|sal_ptclid-&gt;eid
op_assign
id|cpu
suffix:semicolon
id|sal_ptclid
op_increment
suffix:semicolon
id|cpus_found
op_increment
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|cpus_found
op_ne
id|num_cpus
)paren
id|FPROM_BUG
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Make the AP WAKEUP entry */
id|sal_apwake-&gt;type
op_assign
id|SAL_DESC_AP_WAKEUP
suffix:semicolon
id|sal_apwake-&gt;mechanism
op_assign
id|IA64_SAL_AP_EXTERNAL_INT
suffix:semicolon
id|sal_apwake-&gt;vector
op_assign
l_int|18
suffix:semicolon
r_for
c_loop
(paren
id|cp
op_assign
(paren
r_char
op_star
)paren
id|sal_systab
suffix:semicolon
id|cp
OL
(paren
r_char
op_star
)paren
id|efi_memmap
suffix:semicolon
op_increment
id|cp
)paren
id|checksum
op_add_assign
op_star
id|cp
suffix:semicolon
id|sal_systab-&gt;checksum
op_assign
op_minus
id|checksum
suffix:semicolon
id|md
op_assign
op_amp
id|efi_memmap
(braket
l_int|0
)braket
suffix:semicolon
id|num_memmd
op_assign
id|build_efi_memmap
c_func
(paren
(paren
r_void
op_star
)paren
id|md
comma
id|mdsize
)paren
suffix:semicolon
id|bp
op_assign
id|id
c_func
(paren
id|ZERO_PAGE_ADDR
op_plus
(paren
(paren
(paren
r_int
)paren
id|base_nasid
)paren
op_lshift
l_int|33
)paren
)paren
suffix:semicolon
id|bp-&gt;efi_systab
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
op_amp
id|fw_mem
)paren
suffix:semicolon
id|bp-&gt;efi_memmap
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|efi_memmap
)paren
suffix:semicolon
id|bp-&gt;efi_memmap_size
op_assign
id|num_memmd
op_star
id|mdsize
suffix:semicolon
id|bp-&gt;efi_memdesc_size
op_assign
id|mdsize
suffix:semicolon
id|bp-&gt;efi_memdesc_version
op_assign
l_int|0x101
suffix:semicolon
id|bp-&gt;command_line
op_assign
id|__fwtab_pa
c_func
(paren
id|base_nasid
comma
id|cmd_line
)paren
suffix:semicolon
id|bp-&gt;console_info.num_cols
op_assign
l_int|80
suffix:semicolon
id|bp-&gt;console_info.num_rows
op_assign
l_int|25
suffix:semicolon
id|bp-&gt;console_info.orig_x
op_assign
l_int|0
suffix:semicolon
id|bp-&gt;console_info.orig_y
op_assign
l_int|24
suffix:semicolon
id|bp-&gt;num_pci_vectors
op_assign
l_int|0
suffix:semicolon
id|bp-&gt;fpswa
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Now pick the BSP &amp; store it LID value in&n;&t; * a global variable. Note if BSP is greater than last cpu,&n;&t; * pick the last cpu.&n;&t; */
r_for
c_loop
(paren
id|cnode
op_assign
l_int|0
suffix:semicolon
id|cnode
OL
id|num_nodes
suffix:semicolon
id|cnode
op_increment
)paren
(brace
r_for
c_loop
(paren
id|cpu
op_assign
l_int|0
suffix:semicolon
id|cpu
OL
id|CPUS_PER_NODE
suffix:semicolon
id|cpu
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|IsCpuPresent
c_func
(paren
id|cnode
comma
id|cpu
)paren
)paren
r_continue
suffix:semicolon
id|bsp_lid
op_assign
(paren
id|GetNasid
c_func
(paren
id|cnode
)paren
op_lshift
l_int|24
)paren
op_or
(paren
id|cpu
op_lshift
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bsp
op_decrement
OG
l_int|0
)paren
r_continue
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
)brace
eof
