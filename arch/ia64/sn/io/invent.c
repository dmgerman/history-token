multiline_comment|/* $Id$&n; *&n; * This file is subject to the terms and conditions of the GNU General Public&n; * License.  See the file &quot;COPYING&quot; in the main directory of this archive&n; * for more details.&n; *&n; * Copyright (C) 1992 - 1997, 2000 Silicon Graphics, Inc.&n; * Copyright (C) 2000 by Colin Ngam&n; */
multiline_comment|/*&n; * Hardware Inventory&n; *&n; * See sys/sn/invent.h for an explanation of the hardware inventory contents.&n; *&n; */
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;asm/sn/sgi.h&gt;
macro_line|#include &lt;asm/sn/invent.h&gt;
macro_line|#include &lt;asm/sn/hcl.h&gt;
macro_line|#include &lt;asm/sn/labelcl.h&gt;
r_void
DECL|function|inventinit
id|inventinit
c_func
(paren
r_void
)paren
(brace
)brace
multiline_comment|/*&n; * For initializing/updating an inventory entry.&n; */
r_void
DECL|function|replace_in_inventory
id|replace_in_inventory
c_func
(paren
id|inventory_t
op_star
id|pinv
comma
r_int
r_class
comma
r_int
id|type
comma
r_int
id|controller
comma
r_int
id|unit
comma
r_int
id|state
)paren
(brace
id|pinv-&gt;inv_class
op_assign
r_class
suffix:semicolon
id|pinv-&gt;inv_type
op_assign
id|type
suffix:semicolon
id|pinv-&gt;inv_controller
op_assign
id|controller
suffix:semicolon
id|pinv-&gt;inv_unit
op_assign
id|unit
suffix:semicolon
id|pinv-&gt;inv_state
op_assign
id|state
suffix:semicolon
)brace
multiline_comment|/*&n; * Inventory addition &n; *&n; * XXX NOTE: Currently must be called after dynamic memory allocator is&n; * initialized.&n; *&n; */
r_void
DECL|function|add_to_inventory
id|add_to_inventory
c_func
(paren
r_int
r_class
comma
r_int
id|type
comma
r_int
id|controller
comma
r_int
id|unit
comma
r_int
id|state
)paren
(brace
(paren
r_void
)paren
id|device_inventory_add
c_func
(paren
(paren
id|devfs_handle_t
)paren
id|GRAPH_VERTEX_NONE
comma
r_class
comma
id|type
comma
id|controller
comma
id|unit
comma
id|state
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Inventory retrieval &n; *&n; * These two routines are intended to prevent the caller from having to know&n; * the internal structure of the inventory table.&n; *&n; */
id|inventory_t
op_star
DECL|function|get_next_inventory
id|get_next_inventory
c_func
(paren
id|invplace_t
op_star
id|place
)paren
(brace
id|inventory_t
op_star
id|pinv
suffix:semicolon
id|devfs_handle_t
id|device
op_assign
id|place-&gt;invplace_vhdl
suffix:semicolon
r_int
id|rv
suffix:semicolon
r_while
c_loop
(paren
(paren
id|pinv
op_assign
id|device_inventory_get_next
c_func
(paren
id|device
comma
id|place
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/*&n;&t;&t; * We&squot;ve exhausted inventory items on the last device.&n;&t;&t; * Advance to next device.&n;&t;&t; */
id|rv
op_assign
id|hwgraph_vertex_get_next
c_func
(paren
op_amp
id|device
comma
op_amp
id|place-&gt;invplace_vplace
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rv
op_ne
id|LABELCL_SUCCESS
)paren
r_return
l_int|NULL
suffix:semicolon
id|place-&gt;invplace_vhdl
op_assign
id|device
suffix:semicolon
id|place-&gt;invplace_inv
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Start from beginning invent on this device */
)brace
r_return
id|pinv
suffix:semicolon
)brace
multiline_comment|/* ARGSUSED */
r_int
DECL|function|get_sizeof_inventory
id|get_sizeof_inventory
c_func
(paren
r_int
id|abi
)paren
(brace
r_return
r_sizeof
(paren
id|inventory_t
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Hardware inventory scanner.&n; *&n; * Calls fun() for every entry in inventory list unless fun() returns something&n; * other than 0.&n; */
r_int
DECL|function|scaninvent
id|scaninvent
c_func
(paren
r_int
(paren
op_star
id|fun
)paren
(paren
id|inventory_t
op_star
comma
r_void
op_star
)paren
comma
r_void
op_star
id|arg
)paren
(brace
id|inventory_t
op_star
id|ie
suffix:semicolon
id|invplace_t
id|iplace
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
r_int
id|rc
suffix:semicolon
id|ie
op_assign
l_int|0
suffix:semicolon
id|rc
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|ie
op_assign
(paren
id|inventory_t
op_star
)paren
id|get_next_inventory
c_func
(paren
op_amp
id|iplace
)paren
)paren
)paren
(brace
id|rc
op_assign
(paren
op_star
id|fun
)paren
(paren
id|ie
comma
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
)paren
r_break
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * Find a particular inventory object&n; *&n; * pinv can be a pointer to an inventory entry and the search will begin from&n; * there, or it can be 0 in which case the search starts at the beginning.&n; * A -1 for any of the other arguments is a wildcard (i.e. it always matches).&n; */
id|inventory_t
op_star
DECL|function|find_inventory
id|find_inventory
c_func
(paren
id|inventory_t
op_star
id|pinv
comma
r_int
r_class
comma
r_int
id|type
comma
r_int
id|controller
comma
r_int
id|unit
comma
r_int
id|state
)paren
(brace
id|invplace_t
id|iplace
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
r_while
c_loop
(paren
(paren
id|pinv
op_assign
(paren
id|inventory_t
op_star
)paren
id|get_next_inventory
c_func
(paren
op_amp
id|iplace
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
r_class
op_ne
op_minus
l_int|1
op_logical_and
id|pinv-&gt;inv_class
op_ne
r_class
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|type
op_ne
op_minus
l_int|1
op_logical_and
id|pinv-&gt;inv_type
op_ne
id|type
)paren
r_continue
suffix:semicolon
multiline_comment|/* XXXX - perhaps the &quot;state&quot; entry should be ignored so an&n;&t;&t; * an existing entry can be updated.  See vino_init() and&n;&t;&t; * ml/IP22.c:add_ioboard() for an example.&n;&t;&t; */
r_if
c_cond
(paren
id|state
op_ne
op_minus
l_int|1
op_logical_and
id|pinv-&gt;inv_state
op_ne
id|state
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|controller
op_ne
op_minus
l_int|1
op_logical_and
id|pinv-&gt;inv_controller
op_ne
id|controller
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|unit
op_ne
op_minus
l_int|1
op_logical_and
id|pinv-&gt;inv_unit
op_ne
id|unit
)paren
r_continue
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|pinv
suffix:semicolon
)brace
multiline_comment|/*&n;** Retrieve inventory data associated with a device.&n;*/
id|inventory_t
op_star
DECL|function|device_inventory_get_next
id|device_inventory_get_next
c_func
(paren
id|devfs_handle_t
id|device
comma
id|invplace_t
op_star
id|invplace
)paren
(brace
id|inventory_t
op_star
id|pinv
suffix:semicolon
r_int
id|rv
suffix:semicolon
id|rv
op_assign
id|hwgraph_inventory_get_next
c_func
(paren
id|device
comma
id|invplace
comma
op_amp
id|pinv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rv
op_eq
id|LABELCL_SUCCESS
)paren
r_return
id|pinv
suffix:semicolon
r_else
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n;** Associate canonical inventory information with a device (and&n;** add it to the general inventory).&n;*/
r_void
DECL|function|device_inventory_add
id|device_inventory_add
c_func
(paren
id|devfs_handle_t
id|device
comma
r_int
r_class
comma
r_int
id|type
comma
id|major_t
id|controller
comma
id|minor_t
id|unit
comma
r_int
id|state
)paren
(brace
id|hwgraph_inventory_add
c_func
(paren
id|device
comma
r_class
comma
id|type
comma
id|controller
comma
id|unit
comma
id|state
)paren
suffix:semicolon
)brace
r_int
DECL|function|device_controller_num_get
id|device_controller_num_get
c_func
(paren
id|devfs_handle_t
id|device
)paren
(brace
r_return
(paren
id|hwgraph_controller_num_get
c_func
(paren
id|device
)paren
)paren
suffix:semicolon
)brace
r_void
DECL|function|device_controller_num_set
id|device_controller_num_set
c_func
(paren
id|devfs_handle_t
id|device
comma
r_int
id|contr_num
)paren
(brace
id|hwgraph_controller_num_set
c_func
(paren
id|device
comma
id|contr_num
)paren
suffix:semicolon
)brace
eof
