multiline_comment|/*&n; * SN1 Platform specific error Support&n; *&n; * Copyright (C) 2001 Silicon Graphics, Inc.&n; * Copyright (C) 2001 Alan Mayer (ajm@sgi.com)&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;linux/devfs_fs_kernel.h&gt;
macro_line|#include &lt;asm/smp.h&gt;
macro_line|#include &lt;asm/sn/sn_cpuid.h&gt;
macro_line|#include &lt;asm/sn/sn1/bedrock.h&gt;
macro_line|#include &lt;asm/sn/intr.h&gt;
macro_line|#include &lt;asm/sn/addrs.h&gt;
r_void
DECL|function|snia_error_intr_handler
id|snia_error_intr_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|devid
comma
r_struct
id|pt_regs
op_star
id|pt_regs
)paren
(brace
r_int
r_int
r_int
id|intpend_val
suffix:semicolon
r_int
r_int
r_int
id|bit
suffix:semicolon
r_switch
c_cond
(paren
id|irq
)paren
(brace
r_case
id|SGI_UART_IRQ
suffix:colon
singleline_comment|// This isn&squot;t really an error interrupt.  We&squot;re just
singleline_comment|// here because we have to do something with them.
singleline_comment|// This is probably wrong, and this code will be
singleline_comment|// removed.
id|intpend_val
op_assign
id|LOCAL_HUB_L
c_func
(paren
id|PI_INT_PEND0
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|GFX_INTR_A
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|GFX_INTR_A
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|GFX_INTR_B
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|GFX_INTR_B
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|PG_MIG_INTR
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|PG_MIG_INTR
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|UART_INTR
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|UART_INTR
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|CC_PEND_A
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|CC_PEND_A
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|CC_PEND_B
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|CC_PEND_B
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;Received SGI_UART_IRQ (65), but no intpend0 bits were set???&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
id|SGI_HUB_ERROR_IRQ
suffix:colon
singleline_comment|// These are mostly error interrupts of various
singleline_comment|// sorts.  We need to do more than panic here, but
singleline_comment|// what the heck, this is bring up.
id|intpend_val
op_assign
id|LOCAL_HUB_L
c_func
(paren
id|PI_INT_PEND1
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|XB_ERROR
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|XB_ERROR
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;RECEIVED XB_ERROR on cpu %d, cnode %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpuid_to_cnodeid
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|LB_ERROR
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|LB_ERROR
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;RECEIVED LB_ERROR on cpu %d, cnode %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpuid_to_cnodeid
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|NACK_INT_A
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|NACK_INT_A
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;RECEIVED NACK_INT_A on cpu %d, cnode %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpuid_to_cnodeid
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|NACK_INT_B
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|NACK_INT_B
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;RECEIVED NACK_INT_B on cpu %d, cnode %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpuid_to_cnodeid
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|CLK_ERR_INTR
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|CLK_ERR_INTR
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;RECEIVED CLK_ERR_INTR on cpu %d, cnode %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpuid_to_cnodeid
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|COR_ERR_INTR_A
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|COR_ERR_INTR_A
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;RECEIVED COR_ERR_INTR_A on cpu %d, cnode %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpuid_to_cnodeid
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|COR_ERR_INTR_B
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|COR_ERR_INTR_B
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;RECEIVED COR_ERR_INTR_B on cpu %d, cnode %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpuid_to_cnodeid
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|MD_COR_ERR_INTR
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|MD_COR_ERR_INTR
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;RECEIVED MD_COR_ERR_INTR on cpu %d, cnode %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpuid_to_cnodeid
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|NI_ERROR_INTR
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|NI_ERROR_INTR
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;RECEIVED NI_ERROR_INTR on cpu %d, cnode %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpuid_to_cnodeid
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|bit
op_assign
op_complement
(paren
l_int|1L
op_lshift
id|MSC_PANIC_INTR
)paren
)paren
op_eq
(paren
id|intpend_val
op_amp
op_complement
(paren
l_int|1L
op_lshift
id|MSC_PANIC_INTR
)paren
)paren
)paren
(brace
id|LOCAL_HUB_CLR_INTR
c_func
(paren
id|bit
)paren
suffix:semicolon
id|panic
c_func
(paren
l_string|&quot;RECEIVED MSC_PANIC_INTR on cpu %d, cnode %d&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|cpuid_to_cnodeid
c_func
(paren
id|smp_processor_id
c_func
(paren
)paren
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;Received SGI_XB_ERROR_IRQ (182) but no intpend1 bits are set???&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;Received invalid irq in snia_error_intr_handler()/n&quot;
)paren
suffix:semicolon
)brace
)brace
eof
