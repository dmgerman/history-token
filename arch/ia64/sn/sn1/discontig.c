multiline_comment|/*&n; * Copyright 2000, Silicon Graphics, sprasad@engr.sgi.com&n; * Copyright 2000, Kanoj Sarcar, kanoj@sgi.com&n; */
multiline_comment|/*&n; * Contains common definitions and globals for NUMA platform&n; * support. For now, SN-IA64 and SN-MIPS are the NUMA platforms.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/bootmem.h&gt;
macro_line|#include &lt;asm/sn/mmzone.h&gt;
macro_line|#include &lt;asm/efi.h&gt;
r_extern
r_int
id|numnodes
suffix:semicolon
DECL|variable|plat_node_data
id|plat_pg_data_t
id|plat_node_data
(braket
id|MAXNODES
)braket
suffix:semicolon
DECL|variable|bdata
id|bootmem_data_t
id|bdata
(braket
id|MAXNODES
)braket
suffix:semicolon
DECL|variable|chunktonid
r_int
id|chunktonid
(braket
id|MAXCHUNKS
)braket
suffix:semicolon
DECL|variable|nasid_map
r_int
id|nasid_map
(braket
id|MAXNASIDS
)braket
suffix:semicolon
r_void
id|__init
DECL|function|init_chunktonid
id|init_chunktonid
c_func
(paren
r_void
)paren
(brace
id|memset
c_func
(paren
id|chunktonid
comma
op_minus
l_int|1
comma
r_sizeof
(paren
id|chunktonid
)paren
)paren
suffix:semicolon
)brace
r_void
id|__init
DECL|function|init_nodeidmap
id|init_nodeidmap
c_func
(paren
r_void
)paren
(brace
id|memset
c_func
(paren
id|nasid_map
comma
op_minus
l_int|1
comma
r_sizeof
(paren
id|nasid_map
)paren
)paren
suffix:semicolon
)brace
DECL|variable|cnodeid_map
r_int
id|cnodeid_map
(braket
id|MAXNODES
)braket
suffix:semicolon
r_void
id|__init
DECL|function|init_cnodeidmap
id|init_cnodeidmap
c_func
(paren
r_void
)paren
(brace
id|memset
c_func
(paren
id|cnodeid_map
comma
op_minus
l_int|1
comma
r_sizeof
(paren
id|cnodeid_map
)paren
)paren
suffix:semicolon
)brace
r_int
DECL|function|numa_debug
id|numa_debug
c_func
(paren
r_void
)paren
(brace
id|panic
c_func
(paren
l_string|&quot;NUMA debug&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
id|__init
DECL|function|build_cnodeid_map
id|build_cnodeid_map
c_func
(paren
r_void
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAXNASIDS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|nasid_map
(braket
id|i
)braket
op_ge
l_int|0
)paren
id|cnodeid_map
(braket
id|j
op_increment
)braket
op_assign
id|i
suffix:semicolon
)brace
r_return
id|j
suffix:semicolon
)brace
multiline_comment|/*&n; * Since efi_memmap_walk merges contiguous banks, this code will need&n; * to find all the nasids covered by the input memory descriptor.&n; */
r_static
r_int
id|__init
DECL|function|build_nasid_map
id|build_nasid_map
c_func
(paren
r_int
r_int
id|start
comma
r_int
r_int
id|end
comma
r_void
op_star
id|arg
)paren
(brace
r_int
r_int
id|vaddr
op_assign
id|start
suffix:semicolon
r_int
id|nasid
op_assign
id|GetNasId
c_func
(paren
id|__pa
c_func
(paren
id|vaddr
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|vaddr
OL
id|end
)paren
(brace
r_if
c_cond
(paren
id|nasid
OL
id|MAXNASIDS
)paren
id|nasid_map
(braket
id|nasid
)braket
op_assign
l_int|0
suffix:semicolon
r_else
id|panic
c_func
(paren
l_string|&quot;build_nasid_map&quot;
)paren
suffix:semicolon
id|vaddr
op_assign
(paren
r_int
r_int
)paren
id|__va
c_func
(paren
(paren
r_int
r_int
)paren
(paren
op_increment
id|nasid
)paren
op_lshift
id|SN1_NODE_ADDR_SHIFT
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_void
id|__init
DECL|function|fix_nasid_map
id|fix_nasid_map
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
id|j
suffix:semicolon
multiline_comment|/* For every nasid */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|MAXNASIDS
suffix:semicolon
id|j
op_increment
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|MAXNODES
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|CNODEID_TO_NASID
c_func
(paren
id|i
)paren
op_eq
id|j
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
OL
id|MAXNODES
)paren
id|nasid_map
(braket
id|j
)braket
op_assign
id|i
suffix:semicolon
)brace
)brace
r_static
r_void
id|__init
DECL|function|dump_bootmem_info
id|dump_bootmem_info
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|bootmem_data
op_star
id|bdata
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;CNODE INFO ....&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|numnodes
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%d &quot;
comma
id|CNODEID_TO_NASID
c_func
(paren
id|i
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;BOOT MEM INFO ....&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Node   Start                LowPfn               BootmemMap&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|numnodes
suffix:semicolon
id|i
op_increment
)paren
(brace
id|bdata
op_assign
id|NODE_DATA
c_func
(paren
id|i
)paren
op_member_access_from_pointer
id|bdata
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%d      0x%016lx   0x%016lx   0x%016lx&bslash;n&quot;
comma
id|i
comma
id|bdata-&gt;node_boot_start
comma
id|bdata-&gt;node_low_pfn
comma
(paren
r_int
r_int
)paren
id|bdata-&gt;node_bootmem_map
)paren
suffix:semicolon
)brace
)brace
r_void
id|__init
DECL|function|discontig_mem_init
id|discontig_mem_init
c_func
(paren
r_void
)paren
(brace
r_extern
r_void
id|setup_sn1_bootmem
c_func
(paren
r_int
)paren
suffix:semicolon
r_int
id|maxnodes
suffix:semicolon
id|init_chunktonid
c_func
(paren
)paren
suffix:semicolon
id|init_nodeidmap
c_func
(paren
)paren
suffix:semicolon
id|init_cnodeidmap
c_func
(paren
)paren
suffix:semicolon
id|efi_memmap_walk
c_func
(paren
id|build_nasid_map
comma
l_int|0
)paren
suffix:semicolon
id|maxnodes
op_assign
id|build_cnodeid_map
c_func
(paren
)paren
suffix:semicolon
id|fix_nasid_map
c_func
(paren
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_DISCONTIGMEM
id|setup_sn1_bootmem
c_func
(paren
id|maxnodes
)paren
suffix:semicolon
macro_line|#endif
id|numnodes
op_assign
id|maxnodes
suffix:semicolon
id|dump_bootmem_info
c_func
(paren
)paren
suffix:semicolon
)brace
r_void
id|__init
DECL|function|discontig_paging_init
id|discontig_paging_init
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|max_dma
comma
id|zones_size
(braket
id|MAX_NR_ZONES
)braket
suffix:semicolon
r_void
id|dump_node_data
c_func
(paren
r_void
)paren
suffix:semicolon
id|max_dma
op_assign
id|virt_to_phys
c_func
(paren
(paren
r_void
op_star
)paren
id|MAX_DMA_ADDRESS
)paren
op_rshift
id|PAGE_SHIFT
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|numnodes
suffix:semicolon
id|i
op_increment
)paren
(brace
r_extern
r_void
id|free_unused_memmap_node
c_func
(paren
r_int
)paren
suffix:semicolon
r_int
r_int
id|startpfn
op_assign
id|__pa
c_func
(paren
(paren
r_void
op_star
)paren
id|NODE_START
c_func
(paren
id|i
)paren
)paren
op_rshift
id|PAGE_SHIFT
suffix:semicolon
r_int
r_int
id|numpfn
op_assign
id|NODE_SIZE
c_func
(paren
id|i
)paren
op_rshift
id|PAGE_SHIFT
suffix:semicolon
id|memset
c_func
(paren
id|zones_size
comma
l_int|0
comma
r_sizeof
(paren
id|zones_size
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|startpfn
op_plus
id|numpfn
)paren
OL
id|max_dma
)paren
(brace
id|zones_size
(braket
id|ZONE_DMA
)braket
op_assign
id|numpfn
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|startpfn
OG
id|max_dma
)paren
(brace
id|zones_size
(braket
id|ZONE_NORMAL
)braket
op_assign
id|numpfn
suffix:semicolon
)brace
r_else
(brace
id|zones_size
(braket
id|ZONE_DMA
)braket
op_assign
(paren
id|max_dma
op_minus
id|startpfn
)paren
suffix:semicolon
id|zones_size
(braket
id|ZONE_NORMAL
)braket
op_assign
id|numpfn
op_minus
id|zones_size
(braket
id|ZONE_DMA
)braket
suffix:semicolon
)brace
id|free_area_init_node
c_func
(paren
id|i
comma
id|NODE_DATA
c_func
(paren
id|i
)paren
comma
l_int|NULL
comma
id|zones_size
comma
id|startpfn
op_lshift
id|PAGE_SHIFT
comma
l_int|0
)paren
suffix:semicolon
id|free_unused_memmap_node
c_func
(paren
id|i
)paren
suffix:semicolon
)brace
id|dump_node_data
c_func
(paren
)paren
suffix:semicolon
)brace
r_void
DECL|function|dump_node_data
id|dump_node_data
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;NODE DATA ....&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Node, Start, Size, MemMap, BitMap, StartP, Mapnr, Size, Id&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|numnodes
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%d, 0x%lx, 0x%lx, 0x%lx, 0x%lx, 0x%lx, 0x%lx, 0x%lx, %d&bslash;n&quot;
comma
id|CNODEID_TO_NASID
c_func
(paren
id|i
)paren
comma
id|NODE_START
c_func
(paren
id|i
)paren
comma
id|NODE_SIZE
c_func
(paren
id|i
)paren
comma
(paren
r_int
)paren
id|NODE_MEM_MAP
c_func
(paren
id|i
)paren
comma
(paren
r_int
)paren
id|NODE_DATA
c_func
(paren
id|i
)paren
op_member_access_from_pointer
id|valid_addr_bitmap
comma
id|NODE_DATA
c_func
(paren
id|i
)paren
op_member_access_from_pointer
id|node_start_paddr
comma
id|NODE_DATA
c_func
(paren
id|i
)paren
op_member_access_from_pointer
id|node_start_mapnr
comma
id|NODE_DATA
c_func
(paren
id|i
)paren
op_member_access_from_pointer
id|node_size
comma
id|NODE_DATA
c_func
(paren
id|i
)paren
op_member_access_from_pointer
id|node_id
)paren
suffix:semicolon
)brace
)brace
eof
