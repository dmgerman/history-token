multiline_comment|/*&n; * Advanced Configuration and Power Interface&n; *&n; * Based on &squot;ACPI Specification 1.0b&squot; February 2, 1999 and&n; * &squot;IA-64 Extensions to ACPI Specification&squot; Revision 0.6&n; *&n; * Copyright (C) 1999 VA Linux Systems&n; * Copyright (C) 1999, 2000 Walt Drummond &lt;drummond@valinux.com&gt;&n; * Copyright (C) 2000, 2002 Hewlett-Packard Co.&n; *&t;David Mosberger-Tang &lt;davidm@hpl.hp.com&gt;&n; * Copyright (C) 2000 Intel Corp.&n; * Copyright (C) 2000, 2001 J.I. Lee &lt;jung-ik.lee@intel.com&gt;&n; *      ACPI based kernel configuration manager.&n; *      ACPI 2.0 &amp; IA64 ext 0.71&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/irq.h&gt;
macro_line|#include &lt;linux/acpi.h&gt;
macro_line|#ifdef CONFIG_SERIAL_ACPI
macro_line|#include &lt;linux/acpi_serial.h&gt;
macro_line|#endif
macro_line|#include &lt;asm/acpi-ext.h&gt;
macro_line|#include &lt;asm/acpikcfg.h&gt;
macro_line|#include &lt;asm/efi.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/iosapic.h&gt;
macro_line|#include &lt;asm/machvec.h&gt;
macro_line|#include &lt;asm/page.h&gt;
DECL|macro|ACPI_DEBUG
macro_line|#undef ACPI_DEBUG&t;&t;/* Guess what this does? */
multiline_comment|/* global array to record platform interrupt vectors for generic int routing */
DECL|variable|platform_irq_list
r_int
id|platform_irq_list
(braket
id|ACPI_MAX_PLATFORM_IRQS
)braket
suffix:semicolon
multiline_comment|/* These are ugly but will be reclaimed by the kernel */
DECL|variable|available_cpus
r_int
id|__initdata
id|available_cpus
suffix:semicolon
DECL|variable|total_cpus
r_int
id|__initdata
id|total_cpus
suffix:semicolon
DECL|variable|pcat_compat
r_int
id|__initdata
id|pcat_compat
suffix:semicolon
DECL|variable|pm_idle
r_void
(paren
op_star
id|pm_idle
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|variable|pm_power_off
r_void
(paren
op_star
id|pm_power_off
)paren
(paren
r_void
)paren
suffix:semicolon
id|asm
(paren
l_string|&quot;.weak iosapic_register_irq&quot;
)paren
suffix:semicolon
id|asm
(paren
l_string|&quot;.weak iosapic_register_legacy_irq&quot;
)paren
suffix:semicolon
id|asm
(paren
l_string|&quot;.weak iosapic_register_platform_irq&quot;
)paren
suffix:semicolon
id|asm
(paren
l_string|&quot;.weak iosapic_init&quot;
)paren
suffix:semicolon
id|asm
(paren
l_string|&quot;.weak iosapic_version&quot;
)paren
suffix:semicolon
r_const
r_char
op_star
DECL|function|acpi_get_sysname
id|acpi_get_sysname
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_IA64_GENERIC
r_if
c_cond
(paren
id|efi.acpi20
)paren
(brace
id|acpi20_rsdp_t
op_star
id|rsdp20
suffix:semicolon
id|acpi_xsdt_t
op_star
id|xsdt
suffix:semicolon
id|acpi_desc_table_hdr_t
op_star
id|hdrp
suffix:semicolon
id|rsdp20
op_assign
id|efi.acpi20
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|rsdp20-&gt;signature
comma
id|ACPI_RSDP_SIG
comma
id|ACPI_RSDP_SIG_LEN
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ACPI 2.0 RSDP signature incorrect, default to DIG compatible&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_string|&quot;dig&quot;
suffix:semicolon
)brace
id|xsdt
op_assign
id|__va
c_func
(paren
id|rsdp20-&gt;xsdt
)paren
suffix:semicolon
id|hdrp
op_assign
op_amp
id|xsdt-&gt;header
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|hdrp-&gt;signature
comma
id|ACPI_XSDT_SIG
comma
id|ACPI_XSDT_SIG_LEN
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ACPI 2.0 XSDT signature incorrect, default to DIG compatible&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_string|&quot;dig&quot;
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|hdrp-&gt;oem_id
comma
l_string|&quot;HP&quot;
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Enabling Hewlett Packard zx1 chipset support&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_string|&quot;hpzx1&quot;
suffix:semicolon
)brace
)brace
r_return
l_string|&quot;dig&quot;
suffix:semicolon
macro_line|#else
macro_line|# if defined (CONFIG_IA64_HP_SIM)
r_return
l_string|&quot;hpsim&quot;
suffix:semicolon
macro_line|# elif defined (CONFIG_IA64_SGI_SN1)
r_return
l_string|&quot;sn1&quot;
suffix:semicolon
macro_line|# elif defined (CONFIG_IA64_SGI_SN2)
r_return
l_string|&quot;sn2&quot;
suffix:semicolon
macro_line|# elif defined (CONFIG_IA64_HP_ZX1)
r_return
l_string|&quot;hpzx1&quot;
suffix:semicolon
macro_line|# elif defined (CONFIG_IA64_DIG)
r_return
l_string|&quot;dig&quot;
suffix:semicolon
macro_line|# else
macro_line|#&t;error Unknown platform.  Fix acpi.c.
macro_line|# endif
macro_line|#endif
)brace
multiline_comment|/*&n; * Interrupt routing API for device drivers.&n; * Provides the interrupt vector for a generic platform event&n; * (currently only CPEI implemented)&n; */
r_int
DECL|function|acpi_request_vector
id|acpi_request_vector
c_func
(paren
id|u32
id|int_type
)paren
(brace
r_int
id|vector
op_assign
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|int_type
OL
id|ACPI_MAX_PLATFORM_IRQS
)paren
(brace
multiline_comment|/* correctable platform error interrupt */
id|vector
op_assign
id|platform_irq_list
(braket
id|int_type
)braket
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;acpi_request_vector(): invalid interrupt type&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|vector
suffix:semicolon
)brace
multiline_comment|/*&n; * Configure legacy IRQ information.&n; */
r_static
r_void
id|__init
DECL|function|acpi_legacy_irq
id|acpi_legacy_irq
(paren
r_char
op_star
id|p
)paren
(brace
id|acpi_entry_int_override_t
op_star
id|legacy
op_assign
(paren
id|acpi_entry_int_override_t
op_star
)paren
id|p
suffix:semicolon
r_int
r_int
id|polarity
op_assign
l_int|0
comma
id|edge_triggered
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * If the platform we&squot;re running doesn&squot;t define&n;&t; * iosapic_register_legacy_irq(), we ignore this info...&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|iosapic_register_legacy_irq
)paren
r_return
suffix:semicolon
r_switch
c_cond
(paren
id|legacy-&gt;flags
)paren
(brace
r_case
l_int|0x5
suffix:colon
id|polarity
op_assign
l_int|1
suffix:semicolon
id|edge_triggered
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x7
suffix:colon
id|polarity
op_assign
l_int|0
suffix:semicolon
id|edge_triggered
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xd
suffix:colon
id|polarity
op_assign
l_int|1
suffix:semicolon
id|edge_triggered
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xf
suffix:colon
id|polarity
op_assign
l_int|0
suffix:semicolon
id|edge_triggered
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;    ACPI Legacy IRQ 0x%02x: Unknown flags 0x%x&bslash;n&quot;
comma
id|legacy-&gt;isa_irq
comma
id|legacy-&gt;flags
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|iosapic_register_legacy_irq
c_func
(paren
id|legacy-&gt;isa_irq
comma
id|legacy-&gt;pin
comma
id|polarity
comma
id|edge_triggered
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ACPI 2.0 tables parsing functions&n; */
r_static
r_int
r_int
DECL|function|readl_unaligned
id|readl_unaligned
c_func
(paren
r_void
op_star
id|p
)paren
(brace
r_int
r_int
id|ret
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|ret
comma
id|p
comma
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/*&n; * Identify usable CPU&squot;s and remember them for SMP bringup later.&n; */
r_static
r_void
id|__init
DECL|function|acpi20_lsapic
id|acpi20_lsapic
(paren
r_char
op_star
id|p
)paren
(brace
r_int
id|add
op_assign
l_int|1
suffix:semicolon
id|acpi20_entry_lsapic_t
op_star
id|lsapic
op_assign
(paren
id|acpi20_entry_lsapic_t
op_star
)paren
id|p
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;      CPU %.04x:%.04x: &quot;
comma
id|lsapic-&gt;eid
comma
id|lsapic-&gt;id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|lsapic-&gt;flags
op_amp
id|LSAPIC_ENABLED
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;disabled.&bslash;n&quot;
)paren
suffix:semicolon
id|add
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SMP
id|smp_boot_data.cpu_phys_id
(braket
id|total_cpus
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|add
)paren
(brace
id|available_cpus
op_increment
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;available&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SMP
id|smp_boot_data.cpu_phys_id
(braket
id|total_cpus
)braket
op_assign
(paren
id|lsapic-&gt;id
op_lshift
l_int|8
)paren
op_or
id|lsapic-&gt;eid
suffix:semicolon
r_if
c_cond
(paren
id|hard_smp_processor_id
c_func
(paren
)paren
op_eq
id|smp_boot_data.cpu_phys_id
(braket
id|total_cpus
)braket
)paren
id|printk
c_func
(paren
l_string|&quot; (BSP)&quot;
)paren
suffix:semicolon
macro_line|#endif
id|printk
c_func
(paren
l_string|&quot;.&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|total_cpus
op_increment
suffix:semicolon
)brace
multiline_comment|/*&n; * Extract iosapic info from madt (again) to determine which iosapic&n; * this platform interrupt resides in&n; */
r_static
r_int
id|__init
DECL|function|acpi20_which_iosapic
id|acpi20_which_iosapic
(paren
r_int
id|global_vector
comma
id|acpi_madt_t
op_star
id|madt
comma
id|u32
op_star
id|irq_base
comma
r_char
op_star
op_star
id|iosapic_address
)paren
(brace
id|acpi_entry_iosapic_t
op_star
id|iosapic
suffix:semicolon
r_char
op_star
id|p
comma
op_star
id|end
suffix:semicolon
r_int
id|ver
comma
id|max_pin
suffix:semicolon
id|p
op_assign
(paren
r_char
op_star
)paren
(paren
id|madt
op_plus
l_int|1
)paren
suffix:semicolon
id|end
op_assign
id|p
op_plus
(paren
id|madt-&gt;header.length
op_minus
r_sizeof
(paren
id|acpi_madt_t
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|p
OL
id|end
)paren
(brace
r_switch
c_cond
(paren
op_star
id|p
)paren
(brace
r_case
id|ACPI20_ENTRY_IO_SAPIC
suffix:colon
multiline_comment|/* collect IOSAPIC info for platform int use later */
id|iosapic
op_assign
(paren
id|acpi_entry_iosapic_t
op_star
)paren
id|p
suffix:semicolon
op_star
id|irq_base
op_assign
id|iosapic-&gt;irq_base
suffix:semicolon
op_star
id|iosapic_address
op_assign
id|ioremap
c_func
(paren
id|iosapic-&gt;address
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* is this the iosapic we&squot;re looking for? */
id|ver
op_assign
id|iosapic_version
c_func
(paren
op_star
id|iosapic_address
)paren
suffix:semicolon
id|max_pin
op_assign
(paren
id|ver
op_rshift
l_int|16
)paren
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
(paren
id|global_vector
op_minus
op_star
id|irq_base
)paren
op_le
id|max_pin
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* found it! */
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|p
op_add_assign
id|p
(braket
l_int|1
)braket
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * Info on platform interrupt sources: NMI, PMI, INIT, etc.&n; */
r_static
r_void
id|__init
DECL|function|acpi20_platform
id|acpi20_platform
(paren
r_char
op_star
id|p
comma
id|acpi_madt_t
op_star
id|madt
)paren
(brace
r_int
id|vector
suffix:semicolon
id|u32
id|irq_base
suffix:semicolon
r_char
op_star
id|iosapic_address
suffix:semicolon
r_int
r_int
id|polarity
op_assign
l_int|0
comma
id|trigger
op_assign
l_int|0
suffix:semicolon
id|acpi20_entry_platform_src_t
op_star
id|plat
op_assign
(paren
id|acpi20_entry_platform_src_t
op_star
)paren
id|p
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;PLATFORM: IOSAPIC %x -&gt; Vector %x on CPU %.04u:%.04u&bslash;n&quot;
comma
id|plat-&gt;iosapic_vector
comma
id|plat-&gt;global_vector
comma
id|plat-&gt;eid
comma
id|plat-&gt;id
)paren
suffix:semicolon
multiline_comment|/* record platform interrupt vectors for generic int routing code */
r_if
c_cond
(paren
op_logical_neg
id|iosapic_register_platform_irq
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;acpi20_platform(): no ACPI platform IRQ support&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* extract polarity and trigger info from flags */
r_switch
c_cond
(paren
id|plat-&gt;flags
)paren
(brace
r_case
l_int|0x5
suffix:colon
id|polarity
op_assign
l_int|1
suffix:semicolon
id|trigger
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0x7
suffix:colon
id|polarity
op_assign
l_int|0
suffix:semicolon
id|trigger
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xd
suffix:colon
id|polarity
op_assign
l_int|1
suffix:semicolon
id|trigger
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|0xf
suffix:colon
id|polarity
op_assign
l_int|0
suffix:semicolon
id|trigger
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;acpi20_platform(): unknown flags 0x%x&bslash;n&quot;
comma
id|plat-&gt;flags
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* which iosapic does this IRQ belong to? */
r_if
c_cond
(paren
id|acpi20_which_iosapic
c_func
(paren
id|plat-&gt;global_vector
comma
id|madt
comma
op_amp
id|irq_base
comma
op_amp
id|iosapic_address
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;acpi20_platform(): I/O SAPIC not found!&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * get vector assignment for this IRQ, set attributes, and program the IOSAPIC&n;&t; * routing table&n;&t; */
id|vector
op_assign
id|iosapic_register_platform_irq
c_func
(paren
id|plat-&gt;int_type
comma
id|plat-&gt;global_vector
comma
id|plat-&gt;iosapic_vector
comma
id|plat-&gt;eid
comma
id|plat-&gt;id
comma
id|polarity
comma
id|trigger
comma
id|irq_base
comma
id|iosapic_address
)paren
suffix:semicolon
id|platform_irq_list
(braket
id|plat-&gt;int_type
)braket
op_assign
id|vector
suffix:semicolon
)brace
multiline_comment|/*&n; * Override the physical address of the local APIC in the MADT stable header.&n; */
r_static
r_void
id|__init
DECL|function|acpi20_lapic_addr_override
id|acpi20_lapic_addr_override
(paren
r_char
op_star
id|p
)paren
(brace
id|acpi20_entry_lapic_addr_override_t
op_star
id|lapic
op_assign
(paren
id|acpi20_entry_lapic_addr_override_t
op_star
)paren
id|p
suffix:semicolon
r_if
c_cond
(paren
id|lapic-&gt;lapic_address
)paren
(brace
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|ipi_base_addr
)paren
suffix:semicolon
id|ipi_base_addr
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|lapic-&gt;lapic_address
comma
l_int|0
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;LOCAL ACPI override to 0x%lx(p=0x%lx)&bslash;n&quot;
comma
id|ipi_base_addr
comma
id|lapic-&gt;lapic_address
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * Parse the ACPI Multiple APIC Description Table&n; */
r_static
r_void
id|__init
DECL|function|acpi20_parse_madt
id|acpi20_parse_madt
(paren
id|acpi_madt_t
op_star
id|madt
)paren
(brace
id|acpi_entry_iosapic_t
op_star
id|iosapic
op_assign
l_int|NULL
suffix:semicolon
id|acpi20_entry_lsapic_t
op_star
id|lsapic
op_assign
l_int|NULL
suffix:semicolon
r_char
op_star
id|p
comma
op_star
id|end
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Base address of IPI Message Block */
r_if
c_cond
(paren
id|madt-&gt;lapic_address
)paren
(brace
id|ipi_base_addr
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|madt-&gt;lapic_address
comma
l_int|0
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Lapic address set to 0x%lx&bslash;n&quot;
comma
id|ipi_base_addr
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;Lapic address set to default 0x%lx&bslash;n&quot;
comma
id|ipi_base_addr
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * The PCAT_COMPAT flag indicates that the system has a dual-8259 compatible&n;&t; * setup.&n;&t; */
macro_line|#ifdef CONFIG_ITANIUM
id|pcat_compat
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* fw on some Itanium systems is broken... */
macro_line|#else
id|pcat_compat
op_assign
(paren
id|madt-&gt;flags
op_amp
id|MADT_PCAT_COMPAT
)paren
suffix:semicolon
macro_line|#endif
id|p
op_assign
(paren
r_char
op_star
)paren
(paren
id|madt
op_plus
l_int|1
)paren
suffix:semicolon
id|end
op_assign
id|p
op_plus
(paren
id|madt-&gt;header.length
op_minus
r_sizeof
(paren
id|acpi_madt_t
)paren
)paren
suffix:semicolon
multiline_comment|/* Initialize platform interrupt vector array */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ACPI_MAX_PLATFORM_IRQS
suffix:semicolon
id|i
op_increment
)paren
id|platform_irq_list
(braket
id|i
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * Split-up entry parsing to ensure ordering.&n;&t; */
r_while
c_loop
(paren
id|p
OL
id|end
)paren
(brace
r_switch
c_cond
(paren
op_star
id|p
)paren
(brace
r_case
id|ACPI20_ENTRY_LOCAL_APIC_ADDR_OVERRIDE
suffix:colon
id|printk
c_func
(paren
l_string|&quot;ACPI 2.0 MADT: LOCAL APIC Override&bslash;n&quot;
)paren
suffix:semicolon
id|acpi20_lapic_addr_override
c_func
(paren
id|p
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI20_ENTRY_LOCAL_SAPIC
suffix:colon
id|printk
c_func
(paren
l_string|&quot;ACPI 2.0 MADT: LOCAL SAPIC&bslash;n&quot;
)paren
suffix:semicolon
id|lsapic
op_assign
(paren
id|acpi20_entry_lsapic_t
op_star
)paren
id|p
suffix:semicolon
id|acpi20_lsapic
c_func
(paren
id|p
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI20_ENTRY_IO_SAPIC
suffix:colon
id|iosapic
op_assign
(paren
id|acpi_entry_iosapic_t
op_star
)paren
id|p
suffix:semicolon
r_if
c_cond
(paren
id|iosapic_init
)paren
id|iosapic_init
c_func
(paren
id|iosapic-&gt;address
comma
id|iosapic-&gt;irq_base
comma
id|pcat_compat
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI20_ENTRY_PLATFORM_INT_SOURCE
suffix:colon
id|printk
c_func
(paren
l_string|&quot;ACPI 2.0 MADT: PLATFORM INT SOURCE&bslash;n&quot;
)paren
suffix:semicolon
id|acpi20_platform
c_func
(paren
id|p
comma
id|madt
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI20_ENTRY_LOCAL_APIC
suffix:colon
id|printk
c_func
(paren
l_string|&quot;ACPI 2.0 MADT: LOCAL APIC entry&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI20_ENTRY_IO_APIC
suffix:colon
id|printk
c_func
(paren
l_string|&quot;ACPI 2.0 MADT: IO APIC entry&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI20_ENTRY_NMI_SOURCE
suffix:colon
id|printk
c_func
(paren
l_string|&quot;ACPI 2.0 MADT: NMI SOURCE entry&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI20_ENTRY_LOCAL_APIC_NMI
suffix:colon
id|printk
c_func
(paren
l_string|&quot;ACPI 2.0 MADT: LOCAL APIC NMI entry&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI20_ENTRY_INT_SRC_OVERRIDE
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;ACPI 2.0 MADT: unknown entry skip&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_break
suffix:semicolon
)brace
id|p
op_add_assign
id|p
(braket
l_int|1
)braket
suffix:semicolon
)brace
id|p
op_assign
(paren
r_char
op_star
)paren
(paren
id|madt
op_plus
l_int|1
)paren
suffix:semicolon
id|end
op_assign
id|p
op_plus
(paren
id|madt-&gt;header.length
op_minus
r_sizeof
(paren
id|acpi_madt_t
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|p
OL
id|end
)paren
(brace
r_switch
c_cond
(paren
op_star
id|p
)paren
(brace
r_case
id|ACPI20_ENTRY_LOCAL_APIC
suffix:colon
r_if
c_cond
(paren
id|lsapic
)paren
r_break
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;ACPI 2.0 MADT: LOCAL APIC entry&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* parse local apic if there&squot;s no local Sapic */
r_break
suffix:semicolon
r_case
id|ACPI20_ENTRY_IO_APIC
suffix:colon
r_if
c_cond
(paren
id|iosapic
)paren
r_break
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;ACPI 2.0 MADT: IO APIC entry&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* parse ioapic if there&squot;s no ioSapic */
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|p
op_add_assign
id|p
(braket
l_int|1
)braket
suffix:semicolon
)brace
id|p
op_assign
(paren
r_char
op_star
)paren
(paren
id|madt
op_plus
l_int|1
)paren
suffix:semicolon
id|end
op_assign
id|p
op_plus
(paren
id|madt-&gt;header.length
op_minus
r_sizeof
(paren
id|acpi_madt_t
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|p
OL
id|end
)paren
(brace
r_switch
c_cond
(paren
op_star
id|p
)paren
(brace
r_case
id|ACPI20_ENTRY_INT_SRC_OVERRIDE
suffix:colon
id|printk
c_func
(paren
l_string|&quot;ACPI 2.0 MADT: INT SOURCE Override&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_legacy_irq
c_func
(paren
id|p
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
id|p
op_add_assign
id|p
(braket
l_int|1
)braket
suffix:semicolon
)brace
multiline_comment|/* Make bootup pretty */
id|printk
c_func
(paren
l_string|&quot;      %d CPUs available, %d CPUs total&bslash;n&quot;
comma
id|available_cpus
comma
id|total_cpus
)paren
suffix:semicolon
)brace
r_int
id|__init
DECL|function|acpi20_parse
id|acpi20_parse
(paren
id|acpi20_rsdp_t
op_star
id|rsdp20
)paren
(brace
macro_line|# ifdef CONFIG_ACPI
id|acpi_xsdt_t
op_star
id|xsdt
suffix:semicolon
id|acpi_desc_table_hdr_t
op_star
id|hdrp
suffix:semicolon
id|acpi_madt_t
op_star
id|madt
op_assign
l_int|NULL
suffix:semicolon
r_int
id|tables
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|rsdp20-&gt;signature
comma
id|ACPI_RSDP_SIG
comma
id|ACPI_RSDP_SIG_LEN
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ACPI 2.0 RSDP signature incorrect!&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;ACPI 2.0 Root System Description Ptr at 0x%lx&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|rsdp20
)paren
suffix:semicolon
)brace
id|xsdt
op_assign
id|__va
c_func
(paren
id|rsdp20-&gt;xsdt
)paren
suffix:semicolon
id|hdrp
op_assign
op_amp
id|xsdt-&gt;header
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|hdrp-&gt;signature
comma
id|ACPI_XSDT_SIG
comma
id|ACPI_XSDT_SIG_LEN
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ACPI 2.0 XSDT signature incorrect. Trying RSDT&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* RSDT parsing here */
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;ACPI 2.0 XSDT at 0x%lx (p=0x%lx)&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|xsdt
comma
(paren
r_int
r_int
)paren
id|rsdp20-&gt;xsdt
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;ACPI 2.0: %.6s %.8s %d.%d&bslash;n&quot;
comma
id|hdrp-&gt;oem_id
comma
id|hdrp-&gt;oem_table_id
comma
id|hdrp-&gt;oem_revision
op_rshift
l_int|16
comma
id|hdrp-&gt;oem_revision
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|acpi_cf_init
c_func
(paren
(paren
r_void
op_star
)paren
id|rsdp20
)paren
suffix:semicolon
id|tables
op_assign
(paren
id|hdrp-&gt;length
op_minus
r_sizeof
(paren
id|acpi_desc_table_hdr_t
)paren
)paren
op_rshift
l_int|3
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|tables
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hdrp
op_assign
(paren
id|acpi_desc_table_hdr_t
op_star
)paren
id|__va
c_func
(paren
id|readl_unaligned
c_func
(paren
op_amp
id|xsdt-&gt;entry_ptrs
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;        :table %4.4s found&bslash;n&quot;
comma
id|hdrp-&gt;signature
)paren
suffix:semicolon
multiline_comment|/* Only interested int the MADT table for now ... */
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|hdrp-&gt;signature
comma
id|ACPI_MADT_SIG
comma
id|ACPI_MADT_SIG_LEN
)paren
op_ne
l_int|0
)paren
r_continue
suffix:semicolon
multiline_comment|/* Save MADT pointer for later */
id|madt
op_assign
(paren
id|acpi_madt_t
op_star
)paren
id|hdrp
suffix:semicolon
id|acpi20_parse_madt
c_func
(paren
id|madt
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SERIAL_ACPI
multiline_comment|/*&n;&t; * Now we&squot;re interested in other tables.  We want the iosapics already&n;&t; * initialized, so we do it in a separate loop.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|tables
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hdrp
op_assign
(paren
id|acpi_desc_table_hdr_t
op_star
)paren
id|__va
c_func
(paren
id|readl_unaligned
c_func
(paren
op_amp
id|xsdt-&gt;entry_ptrs
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * search for SPCR and DBGP table entries so we can enable&n;&t;&t; * non-pci interrupts to IO-SAPICs.&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|hdrp-&gt;signature
comma
id|ACPI_SPCRT_SIG
comma
id|ACPI_SPCRT_SIG_LEN
)paren
op_logical_or
op_logical_neg
id|strncmp
c_func
(paren
id|hdrp-&gt;signature
comma
id|ACPI_DBGPT_SIG
comma
id|ACPI_DBGPT_SIG_LEN
)paren
)paren
(brace
id|acpi_ser_t
op_star
id|spcr
op_assign
(paren
r_void
op_star
)paren
id|hdrp
suffix:semicolon
r_int
r_int
id|global_int
suffix:semicolon
id|setup_serial_acpi
c_func
(paren
id|hdrp
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * ACPI is able to describe serial ports that live at non-standard&n;&t;&t;&t; * memory space addresses and use SAPIC interrupts.  If not also&n;&t;&t;&t; * PCI devices, there would be no interrupt vector information for&n;&t;&t;&t; * them.  This checks for and fixes that situation.&n;&t;&t;&t; */
r_if
c_cond
(paren
id|spcr-&gt;length
OL
r_sizeof
(paren
id|acpi_ser_t
)paren
)paren
multiline_comment|/* table is not long enough for full info, thus no int */
r_break
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * If the device is not in PCI space, but uses a SAPIC interrupt,&n;&t;&t;&t; * we need to program the SAPIC so that serial can autoprobe for&n;&t;&t;&t; * the IA64 interrupt vector later on.  If the device is in PCI&n;&t;&t;&t; * space, it should already be setup via the PCI vectors&n;&t;&t;&t; */
r_if
c_cond
(paren
id|spcr-&gt;base_addr.space_id
op_ne
id|ACPI_SERIAL_PCICONF_SPACE
op_logical_and
id|spcr-&gt;int_type
op_eq
id|ACPI_SERIAL_INT_SAPIC
)paren
(brace
id|u32
id|irq_base
suffix:semicolon
r_char
op_star
id|iosapic_address
suffix:semicolon
r_int
id|vector
suffix:semicolon
multiline_comment|/* We have a UART in memory space with a SAPIC interrupt */
id|global_int
op_assign
(paren
(paren
id|spcr-&gt;global_int
(braket
l_int|3
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|spcr-&gt;global_int
(braket
l_int|2
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|spcr-&gt;global_int
(braket
l_int|1
)braket
op_lshift
l_int|8
)paren
op_or
id|spcr-&gt;global_int
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|iosapic_register_irq
)paren
r_continue
suffix:semicolon
multiline_comment|/* which iosapic does this IRQ belong to? */
r_if
c_cond
(paren
id|acpi20_which_iosapic
c_func
(paren
id|global_int
comma
id|madt
comma
op_amp
id|irq_base
comma
op_amp
id|iosapic_address
)paren
op_eq
l_int|0
)paren
(brace
id|vector
op_assign
id|iosapic_register_irq
c_func
(paren
id|global_int
comma
l_int|1
comma
multiline_comment|/* active high polarity */
l_int|1
comma
multiline_comment|/* edge triggered */
id|irq_base
comma
id|iosapic_address
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
macro_line|#endif
id|acpi_cf_terminate
c_func
(paren
)paren
suffix:semicolon
macro_line|#  ifdef CONFIG_SMP
r_if
c_cond
(paren
id|available_cpus
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ACPI: Found 0 CPUS; assuming 1&bslash;n&quot;
)paren
suffix:semicolon
id|available_cpus
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* We&squot;ve got at least one of these, no? */
)brace
id|smp_boot_data.cpu_count
op_assign
id|total_cpus
suffix:semicolon
macro_line|#  endif
macro_line|# endif /* CONFIG_ACPI */
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * ACPI 1.0b with 0.71 IA64 extensions functions; should be removed once all&n; * platforms start supporting ACPI 2.0&n; */
multiline_comment|/*&n; * Identify usable CPU&squot;s and remember them for SMP bringup later.&n; */
r_static
r_void
id|__init
DECL|function|acpi_lsapic
id|acpi_lsapic
(paren
r_char
op_star
id|p
)paren
(brace
r_int
id|add
op_assign
l_int|1
suffix:semicolon
id|acpi_entry_lsapic_t
op_star
id|lsapic
op_assign
(paren
id|acpi_entry_lsapic_t
op_star
)paren
id|p
suffix:semicolon
r_if
c_cond
(paren
(paren
id|lsapic-&gt;flags
op_amp
id|LSAPIC_PRESENT
)paren
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;      CPU %d (%.04x:%.04x): &quot;
comma
id|total_cpus
comma
id|lsapic-&gt;eid
comma
id|lsapic-&gt;id
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|lsapic-&gt;flags
op_amp
id|LSAPIC_ENABLED
)paren
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Disabled.&bslash;n&quot;
)paren
suffix:semicolon
id|add
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|lsapic-&gt;flags
op_amp
id|LSAPIC_PERFORMANCE_RESTRICTED
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Performance Restricted; ignoring.&bslash;n&quot;
)paren
suffix:semicolon
id|add
op_assign
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SMP
id|smp_boot_data.cpu_phys_id
(braket
id|total_cpus
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|add
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Available.&bslash;n&quot;
)paren
suffix:semicolon
id|available_cpus
op_increment
suffix:semicolon
macro_line|#ifdef CONFIG_SMP
id|smp_boot_data.cpu_phys_id
(braket
id|total_cpus
)braket
op_assign
(paren
id|lsapic-&gt;id
op_lshift
l_int|8
)paren
op_or
id|lsapic-&gt;eid
suffix:semicolon
macro_line|#endif /* CONFIG_SMP */
)brace
id|total_cpus
op_increment
suffix:semicolon
)brace
multiline_comment|/*&n; * Info on platform interrupt sources: NMI. PMI, INIT, etc.&n; */
r_static
r_void
id|__init
DECL|function|acpi_platform
id|acpi_platform
(paren
r_char
op_star
id|p
)paren
(brace
id|acpi_entry_platform_src_t
op_star
id|plat
op_assign
(paren
id|acpi_entry_platform_src_t
op_star
)paren
id|p
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;PLATFORM: IOSAPIC %x -&gt; Vector %x on CPU %.04u:%.04u&bslash;n&quot;
comma
id|plat-&gt;iosapic_vector
comma
id|plat-&gt;global_vector
comma
id|plat-&gt;eid
comma
id|plat-&gt;id
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Parse the ACPI Multiple SAPIC Table&n; */
r_static
r_void
id|__init
DECL|function|acpi_parse_msapic
id|acpi_parse_msapic
(paren
id|acpi_sapic_t
op_star
id|msapic
)paren
(brace
id|acpi_entry_iosapic_t
op_star
id|iosapic
suffix:semicolon
r_char
op_star
id|p
comma
op_star
id|end
suffix:semicolon
multiline_comment|/* Base address of IPI Message Block */
id|ipi_base_addr
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|msapic-&gt;interrupt_block
comma
l_int|0
)paren
suffix:semicolon
id|p
op_assign
(paren
r_char
op_star
)paren
(paren
id|msapic
op_plus
l_int|1
)paren
suffix:semicolon
id|end
op_assign
id|p
op_plus
(paren
id|msapic-&gt;header.length
op_minus
r_sizeof
(paren
id|acpi_sapic_t
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|p
OL
id|end
)paren
(brace
r_switch
c_cond
(paren
op_star
id|p
)paren
(brace
r_case
id|ACPI_ENTRY_LOCAL_SAPIC
suffix:colon
id|acpi_lsapic
c_func
(paren
id|p
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_ENTRY_IO_SAPIC
suffix:colon
id|iosapic
op_assign
(paren
id|acpi_entry_iosapic_t
op_star
)paren
id|p
suffix:semicolon
r_if
c_cond
(paren
id|iosapic_init
)paren
multiline_comment|/*&n;&t;&t;&t;&t; * The ACPI I/O SAPIC table doesn&squot;t have a PCAT_COMPAT&n;&t;&t;&t;&t; * flag like the MADT table, but we can safely assume that&n;&t;&t;&t;&t; * ACPI 1.0b systems have a dual-8259 setup.&n;&t;&t;&t;&t; */
id|iosapic_init
c_func
(paren
id|iosapic-&gt;address
comma
id|iosapic-&gt;irq_base
comma
l_int|1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_ENTRY_INT_SRC_OVERRIDE
suffix:colon
id|acpi_legacy_irq
c_func
(paren
id|p
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_ENTRY_PLATFORM_INT_SOURCE
suffix:colon
id|acpi_platform
c_func
(paren
id|p
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
multiline_comment|/* Move to next table entry. */
id|p
op_add_assign
id|p
(braket
l_int|1
)braket
suffix:semicolon
)brace
multiline_comment|/* Make bootup pretty */
id|printk
c_func
(paren
l_string|&quot;      %d CPUs available, %d CPUs total&bslash;n&quot;
comma
id|available_cpus
comma
id|total_cpus
)paren
suffix:semicolon
)brace
r_int
id|__init
DECL|function|acpi_parse
id|acpi_parse
(paren
id|acpi_rsdp_t
op_star
id|rsdp
)paren
(brace
macro_line|# ifdef CONFIG_ACPI
id|acpi_rsdt_t
op_star
id|rsdt
suffix:semicolon
id|acpi_desc_table_hdr_t
op_star
id|hdrp
suffix:semicolon
r_int
id|tables
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|rsdp-&gt;signature
comma
id|ACPI_RSDP_SIG
comma
id|ACPI_RSDP_SIG_LEN
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Uh-oh, ACPI RSDP signature incorrect!&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|rsdt
op_assign
id|__va
c_func
(paren
id|rsdp-&gt;rsdt
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|rsdt-&gt;header.signature
comma
id|ACPI_RSDT_SIG
comma
id|ACPI_RSDT_SIG_LEN
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Uh-oh, ACPI RDST signature incorrect!&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;ACPI: %.6s %.8s %d.%d&bslash;n&quot;
comma
id|rsdt-&gt;header.oem_id
comma
id|rsdt-&gt;header.oem_table_id
comma
id|rsdt-&gt;header.oem_revision
op_rshift
l_int|16
comma
id|rsdt-&gt;header.oem_revision
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|acpi_cf_init
c_func
(paren
id|rsdp
)paren
suffix:semicolon
id|tables
op_assign
(paren
id|rsdt-&gt;header.length
op_minus
r_sizeof
(paren
id|acpi_desc_table_hdr_t
)paren
)paren
op_div
l_int|8
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|tables
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hdrp
op_assign
(paren
id|acpi_desc_table_hdr_t
op_star
)paren
id|__va
c_func
(paren
id|rsdt-&gt;entry_ptrs
(braket
id|i
)braket
)paren
suffix:semicolon
multiline_comment|/* Only interested int the MSAPIC table for now ... */
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|hdrp-&gt;signature
comma
id|ACPI_SAPIC_SIG
comma
id|ACPI_SAPIC_SIG_LEN
)paren
op_ne
l_int|0
)paren
r_continue
suffix:semicolon
id|acpi_parse_msapic
c_func
(paren
(paren
id|acpi_sapic_t
op_star
)paren
id|hdrp
)paren
suffix:semicolon
)brace
id|acpi_cf_terminate
c_func
(paren
)paren
suffix:semicolon
macro_line|#  ifdef CONFIG_SMP
r_if
c_cond
(paren
id|available_cpus
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ACPI: Found 0 CPUS; assuming 1&bslash;n&quot;
)paren
suffix:semicolon
id|available_cpus
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* We&squot;ve got at least one of these, no? */
)brace
id|smp_boot_data.cpu_count
op_assign
id|total_cpus
suffix:semicolon
macro_line|#  endif
macro_line|# endif /* CONFIG_ACPI */
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ACPI
macro_line|#include &quot;../drivers/acpi/include/platform/acgcc.h&quot;
macro_line|#include &quot;../drivers/acpi/include/actypes.h&quot;
macro_line|#include &quot;../drivers/acpi/include/acexcep.h&quot;
macro_line|#include &quot;../drivers/acpi/include/acpixf.h&quot;
macro_line|#include &quot;../drivers/acpi/include/actbl.h&quot;
macro_line|#include &quot;../drivers/acpi/include/acconfig.h&quot;
macro_line|#include &quot;../drivers/acpi/include/acmacros.h&quot;
macro_line|#include &quot;../drivers/acpi/include/aclocal.h&quot;
macro_line|#include &quot;../drivers/acpi/include/acobject.h&quot;
macro_line|#include &quot;../drivers/acpi/include/acstruct.h&quot;
macro_line|#include &quot;../drivers/acpi/include/acnamesp.h&quot;
macro_line|#include &quot;../drivers/acpi/include/acutils.h&quot;
multiline_comment|/**&n; * acpi_get_crs - Return the current resource settings for a device&n; * obj: A handle for this device&n; * buf: A buffer to be populated by this call.&n; *&n; * Pass a valid handle, typically obtained by walking the namespace and a&n; * pointer to an allocated buffer, and this function will fill in the buffer&n; * with a list of acpi_resource structures.&n; */
DECL|function|acpi_get_crs
id|acpi_status
id|acpi_get_crs
c_func
(paren
id|acpi_handle
id|obj
comma
id|acpi_buffer
op_star
id|buf
)paren
(brace
id|acpi_status
id|result
suffix:semicolon
id|buf-&gt;length
op_assign
l_int|0
suffix:semicolon
id|buf-&gt;pointer
op_assign
l_int|NULL
suffix:semicolon
id|result
op_assign
id|acpi_get_current_resources
c_func
(paren
id|obj
comma
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_ne
id|AE_BUFFER_OVERFLOW
)paren
r_return
id|result
suffix:semicolon
id|buf-&gt;pointer
op_assign
id|kmalloc
c_func
(paren
id|buf-&gt;length
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf-&gt;pointer
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
id|result
op_assign
id|acpi_get_current_resources
c_func
(paren
id|obj
comma
id|buf
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|acpi_get_crs_next
id|acpi_resource
op_star
id|acpi_get_crs_next
c_func
(paren
id|acpi_buffer
op_star
id|buf
comma
r_int
op_star
id|offset
)paren
(brace
id|acpi_resource
op_star
id|res
suffix:semicolon
r_if
c_cond
(paren
op_star
id|offset
op_ge
id|buf-&gt;length
)paren
r_return
l_int|NULL
suffix:semicolon
id|res
op_assign
id|buf-&gt;pointer
op_plus
op_star
id|offset
suffix:semicolon
op_star
id|offset
op_add_assign
id|res-&gt;length
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|acpi_get_crs_type
id|acpi_resource_data
op_star
id|acpi_get_crs_type
c_func
(paren
id|acpi_buffer
op_star
id|buf
comma
r_int
op_star
id|offset
comma
r_int
id|type
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|acpi_resource
op_star
id|res
op_assign
id|acpi_get_crs_next
c_func
(paren
id|buf
comma
id|offset
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|res
)paren
r_return
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|res-&gt;id
op_eq
id|type
)paren
r_return
op_amp
id|res-&gt;data
suffix:semicolon
)brace
)brace
DECL|function|acpi_dispose_crs
r_void
id|acpi_dispose_crs
c_func
(paren
id|acpi_buffer
op_star
id|buf
)paren
(brace
id|kfree
c_func
(paren
id|buf-&gt;pointer
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_ACPI */
eof
