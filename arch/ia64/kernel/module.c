multiline_comment|/*&n; * IA-64-specific support for kernel module loader.&n; *&n; * Copyright (C) 2003 Hewlett-Packard Co&n; *&t;David Mosberger-Tang &lt;davidm@hpl.hp.com&gt;&n; *&n; * Loosely based on patch by Rusty Russell.&n; */
multiline_comment|/* relocs tested so far:&n;&n;   DIR64LSB&n;   FPTR64LSB&n;   GPREL22&n;   LDXMOV&n;   LDXMOV&n;   LTOFF22&n;   LTOFF22X&n;   LTOFF22X&n;   LTOFF_FPTR22&n;   PCREL21B&t;(for br.call only; br.cond is not supported out of modules!)&n;   PCREL60B&t;(for brl.cond only; brl.call is not supported for modules!)&n;   PCREL64LSB&n;   SECREL32LSB&n;   SEGREL64LSB&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/elf.h&gt;
macro_line|#include &lt;linux/moduleloader.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;asm/patch.h&gt;
macro_line|#include &lt;asm/unaligned.h&gt;
DECL|macro|ARCH_MODULE_DEBUG
mdefine_line|#define ARCH_MODULE_DEBUG 0
macro_line|#if ARCH_MODULE_DEBUG
DECL|macro|DEBUGP
macro_line|# define DEBUGP printk
DECL|macro|inline
macro_line|# define inline
macro_line|#else
DECL|macro|DEBUGP
macro_line|# define DEBUGP(fmt , a...)
macro_line|#endif
macro_line|#ifdef CONFIG_ITANIUM
DECL|macro|USE_BRL
macro_line|# define USE_BRL&t;0
macro_line|#else
DECL|macro|USE_BRL
macro_line|# define USE_BRL&t;1
macro_line|#endif
DECL|macro|MAX_LTOFF
mdefine_line|#define MAX_LTOFF&t;((uint64_t) (1 &lt;&lt; 22))&t;/* max. allowable linkage-table offset */
multiline_comment|/* Define some relocation helper macros/types: */
DECL|macro|FORMAT_SHIFT
mdefine_line|#define FORMAT_SHIFT&t;0
DECL|macro|FORMAT_BITS
mdefine_line|#define FORMAT_BITS&t;3
DECL|macro|FORMAT_MASK
mdefine_line|#define FORMAT_MASK&t;((1 &lt;&lt; FORMAT_BITS) - 1)
DECL|macro|VALUE_SHIFT
mdefine_line|#define VALUE_SHIFT&t;3
DECL|macro|VALUE_BITS
mdefine_line|#define VALUE_BITS&t;5
DECL|macro|VALUE_MASK
mdefine_line|#define VALUE_MASK&t;((1 &lt;&lt; VALUE_BITS) - 1)
DECL|enum|reloc_target_format
r_enum
id|reloc_target_format
(brace
multiline_comment|/* direct encoded formats: */
DECL|enumerator|RF_NONE
id|RF_NONE
op_assign
l_int|0
comma
DECL|enumerator|RF_INSN14
id|RF_INSN14
op_assign
l_int|1
comma
DECL|enumerator|RF_INSN22
id|RF_INSN22
op_assign
l_int|2
comma
DECL|enumerator|RF_INSN64
id|RF_INSN64
op_assign
l_int|3
comma
DECL|enumerator|RF_32MSB
id|RF_32MSB
op_assign
l_int|4
comma
DECL|enumerator|RF_32LSB
id|RF_32LSB
op_assign
l_int|5
comma
DECL|enumerator|RF_64MSB
id|RF_64MSB
op_assign
l_int|6
comma
DECL|enumerator|RF_64LSB
id|RF_64LSB
op_assign
l_int|7
comma
multiline_comment|/* formats that cannot be directly decoded: */
DECL|enumerator|RF_INSN60
id|RF_INSN60
comma
DECL|enumerator|RF_INSN21B
id|RF_INSN21B
comma
multiline_comment|/* imm21 form 1 */
DECL|enumerator|RF_INSN21M
id|RF_INSN21M
comma
multiline_comment|/* imm21 form 2 */
DECL|enumerator|RF_INSN21F
id|RF_INSN21F
multiline_comment|/* imm21 form 3 */
)brace
suffix:semicolon
DECL|enum|reloc_value_formula
r_enum
id|reloc_value_formula
(brace
DECL|enumerator|RV_DIRECT
id|RV_DIRECT
op_assign
l_int|4
comma
multiline_comment|/* S + A */
DECL|enumerator|RV_GPREL
id|RV_GPREL
op_assign
l_int|5
comma
multiline_comment|/* @gprel(S + A) */
DECL|enumerator|RV_LTREL
id|RV_LTREL
op_assign
l_int|6
comma
multiline_comment|/* @ltoff(S + A) */
DECL|enumerator|RV_PLTREL
id|RV_PLTREL
op_assign
l_int|7
comma
multiline_comment|/* @pltoff(S + A) */
DECL|enumerator|RV_FPTR
id|RV_FPTR
op_assign
l_int|8
comma
multiline_comment|/* @fptr(S + A) */
DECL|enumerator|RV_PCREL
id|RV_PCREL
op_assign
l_int|9
comma
multiline_comment|/* S + A - P */
DECL|enumerator|RV_LTREL_FPTR
id|RV_LTREL_FPTR
op_assign
l_int|10
comma
multiline_comment|/* @ltoff(@fptr(S + A)) */
DECL|enumerator|RV_SEGREL
id|RV_SEGREL
op_assign
l_int|11
comma
multiline_comment|/* @segrel(S + A) */
DECL|enumerator|RV_SECREL
id|RV_SECREL
op_assign
l_int|12
comma
multiline_comment|/* @secrel(S + A) */
DECL|enumerator|RV_BDREL
id|RV_BDREL
op_assign
l_int|13
comma
multiline_comment|/* BD + A */
DECL|enumerator|RV_LTV
id|RV_LTV
op_assign
l_int|14
comma
multiline_comment|/* S + A (like RV_DIRECT, except frozen at static link-time) */
DECL|enumerator|RV_PCREL2
id|RV_PCREL2
op_assign
l_int|15
comma
multiline_comment|/* S + A - P */
DECL|enumerator|RV_SPECIAL
id|RV_SPECIAL
op_assign
l_int|16
comma
multiline_comment|/* various (see below) */
DECL|enumerator|RV_RSVD17
id|RV_RSVD17
op_assign
l_int|17
comma
DECL|enumerator|RV_TPREL
id|RV_TPREL
op_assign
l_int|18
comma
multiline_comment|/* @tprel(S + A) */
DECL|enumerator|RV_LTREL_TPREL
id|RV_LTREL_TPREL
op_assign
l_int|19
comma
multiline_comment|/* @ltoff(@tprel(S + A)) */
DECL|enumerator|RV_DTPMOD
id|RV_DTPMOD
op_assign
l_int|20
comma
multiline_comment|/* @dtpmod(S + A) */
DECL|enumerator|RV_LTREL_DTPMOD
id|RV_LTREL_DTPMOD
op_assign
l_int|21
comma
multiline_comment|/* @ltoff(@dtpmod(S + A)) */
DECL|enumerator|RV_DTPREL
id|RV_DTPREL
op_assign
l_int|22
comma
multiline_comment|/* @dtprel(S + A) */
DECL|enumerator|RV_LTREL_DTPREL
id|RV_LTREL_DTPREL
op_assign
l_int|23
comma
multiline_comment|/* @ltoff(@dtprel(S + A)) */
DECL|enumerator|RV_RSVD24
id|RV_RSVD24
op_assign
l_int|24
comma
DECL|enumerator|RV_RSVD25
id|RV_RSVD25
op_assign
l_int|25
comma
DECL|enumerator|RV_RSVD26
id|RV_RSVD26
op_assign
l_int|26
comma
DECL|enumerator|RV_RSVD27
id|RV_RSVD27
op_assign
l_int|27
multiline_comment|/* 28-31 reserved for implementation-specific purposes.  */
)brace
suffix:semicolon
DECL|macro|N
mdefine_line|#define N(reloc)&t;[R_IA64_##reloc] = #reloc
DECL|variable|reloc_name
r_static
r_const
r_char
op_star
id|reloc_name
(braket
l_int|256
)braket
op_assign
(brace
id|N
c_func
(paren
id|NONE
)paren
comma
id|N
c_func
(paren
id|IMM14
)paren
comma
id|N
c_func
(paren
id|IMM22
)paren
comma
id|N
c_func
(paren
id|IMM64
)paren
comma
id|N
c_func
(paren
id|DIR32MSB
)paren
comma
id|N
c_func
(paren
id|DIR32LSB
)paren
comma
id|N
c_func
(paren
id|DIR64MSB
)paren
comma
id|N
c_func
(paren
id|DIR64LSB
)paren
comma
id|N
c_func
(paren
id|GPREL22
)paren
comma
id|N
c_func
(paren
id|GPREL64I
)paren
comma
id|N
c_func
(paren
id|GPREL32MSB
)paren
comma
id|N
c_func
(paren
id|GPREL32LSB
)paren
comma
id|N
c_func
(paren
id|GPREL64MSB
)paren
comma
id|N
c_func
(paren
id|GPREL64LSB
)paren
comma
id|N
c_func
(paren
id|LTOFF22
)paren
comma
id|N
c_func
(paren
id|LTOFF64I
)paren
comma
id|N
c_func
(paren
id|PLTOFF22
)paren
comma
id|N
c_func
(paren
id|PLTOFF64I
)paren
comma
id|N
c_func
(paren
id|PLTOFF64MSB
)paren
comma
id|N
c_func
(paren
id|PLTOFF64LSB
)paren
comma
id|N
c_func
(paren
id|FPTR64I
)paren
comma
id|N
c_func
(paren
id|FPTR32MSB
)paren
comma
id|N
c_func
(paren
id|FPTR32LSB
)paren
comma
id|N
c_func
(paren
id|FPTR64MSB
)paren
comma
id|N
c_func
(paren
id|FPTR64LSB
)paren
comma
id|N
c_func
(paren
id|PCREL60B
)paren
comma
id|N
c_func
(paren
id|PCREL21B
)paren
comma
id|N
c_func
(paren
id|PCREL21M
)paren
comma
id|N
c_func
(paren
id|PCREL21F
)paren
comma
id|N
c_func
(paren
id|PCREL32MSB
)paren
comma
id|N
c_func
(paren
id|PCREL32LSB
)paren
comma
id|N
c_func
(paren
id|PCREL64MSB
)paren
comma
id|N
c_func
(paren
id|PCREL64LSB
)paren
comma
id|N
c_func
(paren
id|LTOFF_FPTR22
)paren
comma
id|N
c_func
(paren
id|LTOFF_FPTR64I
)paren
comma
id|N
c_func
(paren
id|LTOFF_FPTR32MSB
)paren
comma
id|N
c_func
(paren
id|LTOFF_FPTR32LSB
)paren
comma
id|N
c_func
(paren
id|LTOFF_FPTR64MSB
)paren
comma
id|N
c_func
(paren
id|LTOFF_FPTR64LSB
)paren
comma
id|N
c_func
(paren
id|SEGREL32MSB
)paren
comma
id|N
c_func
(paren
id|SEGREL32LSB
)paren
comma
id|N
c_func
(paren
id|SEGREL64MSB
)paren
comma
id|N
c_func
(paren
id|SEGREL64LSB
)paren
comma
id|N
c_func
(paren
id|SECREL32MSB
)paren
comma
id|N
c_func
(paren
id|SECREL32LSB
)paren
comma
id|N
c_func
(paren
id|SECREL64MSB
)paren
comma
id|N
c_func
(paren
id|SECREL64LSB
)paren
comma
id|N
c_func
(paren
id|REL32MSB
)paren
comma
id|N
c_func
(paren
id|REL32LSB
)paren
comma
id|N
c_func
(paren
id|REL64MSB
)paren
comma
id|N
c_func
(paren
id|REL64LSB
)paren
comma
id|N
c_func
(paren
id|LTV32MSB
)paren
comma
id|N
c_func
(paren
id|LTV32LSB
)paren
comma
id|N
c_func
(paren
id|LTV64MSB
)paren
comma
id|N
c_func
(paren
id|LTV64LSB
)paren
comma
id|N
c_func
(paren
id|PCREL21BI
)paren
comma
id|N
c_func
(paren
id|PCREL22
)paren
comma
id|N
c_func
(paren
id|PCREL64I
)paren
comma
id|N
c_func
(paren
id|IPLTMSB
)paren
comma
id|N
c_func
(paren
id|IPLTLSB
)paren
comma
id|N
c_func
(paren
id|COPY
)paren
comma
id|N
c_func
(paren
id|LTOFF22X
)paren
comma
id|N
c_func
(paren
id|LDXMOV
)paren
comma
id|N
c_func
(paren
id|TPREL14
)paren
comma
id|N
c_func
(paren
id|TPREL22
)paren
comma
id|N
c_func
(paren
id|TPREL64I
)paren
comma
id|N
c_func
(paren
id|TPREL64MSB
)paren
comma
id|N
c_func
(paren
id|TPREL64LSB
)paren
comma
id|N
c_func
(paren
id|LTOFF_TPREL22
)paren
comma
id|N
c_func
(paren
id|DTPMOD64MSB
)paren
comma
id|N
c_func
(paren
id|DTPMOD64LSB
)paren
comma
id|N
c_func
(paren
id|LTOFF_DTPMOD22
)paren
comma
id|N
c_func
(paren
id|DTPREL14
)paren
comma
id|N
c_func
(paren
id|DTPREL22
)paren
comma
id|N
c_func
(paren
id|DTPREL64I
)paren
comma
id|N
c_func
(paren
id|DTPREL32MSB
)paren
comma
id|N
c_func
(paren
id|DTPREL32LSB
)paren
comma
id|N
c_func
(paren
id|DTPREL64MSB
)paren
comma
id|N
c_func
(paren
id|DTPREL64LSB
)paren
comma
id|N
c_func
(paren
id|LTOFF_DTPREL22
)paren
)brace
suffix:semicolon
DECL|macro|N
macro_line|#undef N
DECL|struct|got_entry
r_struct
id|got_entry
(brace
DECL|member|val
r_uint64
id|val
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|fdesc
r_struct
id|fdesc
(brace
DECL|member|ip
r_uint64
id|ip
suffix:semicolon
DECL|member|gp
r_uint64
id|gp
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* Opaque struct for insns, to protect against derefs. */
r_struct
id|insn
suffix:semicolon
r_static
r_inline
r_uint64
DECL|function|bundle
id|bundle
(paren
r_const
r_struct
id|insn
op_star
id|insn
)paren
(brace
r_return
(paren
r_uint64
)paren
id|insn
op_amp
op_complement
l_int|0xfUL
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|slot
id|slot
(paren
r_const
r_struct
id|insn
op_star
id|insn
)paren
(brace
r_return
(paren
r_uint64
)paren
id|insn
op_amp
l_int|0x3
suffix:semicolon
)brace
r_static
r_int
DECL|function|apply_imm64
id|apply_imm64
(paren
r_struct
id|module
op_star
id|mod
comma
r_struct
id|insn
op_star
id|insn
comma
r_uint64
id|val
)paren
(brace
r_if
c_cond
(paren
id|slot
c_func
(paren
id|insn
)paren
op_ne
l_int|2
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: invalid slot number %d for IMM64&bslash;n&quot;
comma
id|mod-&gt;name
comma
id|slot
c_func
(paren
id|insn
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ia64_patch_imm64
c_func
(paren
(paren
id|u64
)paren
id|insn
comma
id|val
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_static
r_int
DECL|function|apply_imm60
id|apply_imm60
(paren
r_struct
id|module
op_star
id|mod
comma
r_struct
id|insn
op_star
id|insn
comma
r_uint64
id|val
)paren
(brace
r_if
c_cond
(paren
id|slot
c_func
(paren
id|insn
)paren
op_ne
l_int|2
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: invalid slot number %d for IMM60&bslash;n&quot;
comma
id|mod-&gt;name
comma
id|slot
c_func
(paren
id|insn
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|val
op_plus
(paren
(paren
r_uint64
)paren
l_int|1
op_lshift
l_int|59
)paren
op_ge
(paren
l_int|1UL
op_lshift
l_int|60
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: value %ld out of IMM60 range&bslash;n&quot;
comma
id|mod-&gt;name
comma
(paren
r_int64
)paren
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ia64_patch_imm60
c_func
(paren
(paren
id|u64
)paren
id|insn
comma
id|val
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_static
r_int
DECL|function|apply_imm22
id|apply_imm22
(paren
r_struct
id|module
op_star
id|mod
comma
r_struct
id|insn
op_star
id|insn
comma
r_uint64
id|val
)paren
(brace
r_if
c_cond
(paren
id|val
op_plus
(paren
l_int|1
op_lshift
l_int|21
)paren
op_ge
(paren
l_int|1
op_lshift
l_int|22
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: value %li out of IMM22 range&bslash;n&quot;
comma
id|mod-&gt;name
comma
(paren
r_int64
)paren
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ia64_patch
c_func
(paren
(paren
id|u64
)paren
id|insn
comma
l_int|0x01fffcfe000
comma
(paren
(paren
(paren
id|val
op_amp
l_int|0x200000
)paren
op_lshift
l_int|15
)paren
multiline_comment|/* bit 21 -&gt; 36 */
op_or
(paren
(paren
id|val
op_amp
l_int|0x1f0000
)paren
op_lshift
l_int|6
)paren
multiline_comment|/* bit 16 -&gt; 22 */
op_or
(paren
(paren
id|val
op_amp
l_int|0x00ff80
)paren
op_lshift
l_int|20
)paren
multiline_comment|/* bit  7 -&gt; 27 */
op_or
(paren
(paren
id|val
op_amp
l_int|0x00007f
)paren
op_lshift
l_int|13
)paren
multiline_comment|/* bit  0 -&gt; 13 */
)paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_static
r_int
DECL|function|apply_imm21b
id|apply_imm21b
(paren
r_struct
id|module
op_star
id|mod
comma
r_struct
id|insn
op_star
id|insn
comma
r_uint64
id|val
)paren
(brace
r_if
c_cond
(paren
id|val
op_plus
(paren
l_int|1
op_lshift
l_int|20
)paren
op_ge
(paren
l_int|1
op_lshift
l_int|21
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: value %li out of IMM21b range&bslash;n&quot;
comma
id|mod-&gt;name
comma
(paren
r_int64
)paren
id|val
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|ia64_patch
c_func
(paren
(paren
id|u64
)paren
id|insn
comma
l_int|0x11ffffe000
comma
(paren
(paren
(paren
id|val
op_amp
l_int|0x100000
)paren
op_lshift
l_int|16
)paren
multiline_comment|/* bit 20 -&gt; 36 */
op_or
(paren
(paren
id|val
op_amp
l_int|0x0fffff
)paren
op_lshift
l_int|13
)paren
multiline_comment|/* bit  0 -&gt; 13 */
)paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
macro_line|#if USE_BRL
DECL|struct|plt_entry
r_struct
id|plt_entry
(brace
multiline_comment|/* Three instruction bundles in PLT. */
DECL|member|bundle
r_int
r_char
id|bundle
(braket
l_int|2
)braket
(braket
l_int|16
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|ia64_plt_template
r_static
r_const
r_struct
id|plt_entry
id|ia64_plt_template
op_assign
(brace
(brace
(brace
l_int|0x04
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x01
comma
l_int|0x00
comma
multiline_comment|/* [MLX] nop.m 0 */
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x20
comma
multiline_comment|/*&t;     movl gp=TARGET_GP */
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x60
)brace
comma
(brace
l_int|0x05
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x01
comma
l_int|0x00
comma
multiline_comment|/* [MLX] nop.m 0 */
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
multiline_comment|/*&t;     brl.many gp=TARGET_GP */
l_int|0x08
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0xc0
)brace
)brace
)brace
suffix:semicolon
r_static
r_int
DECL|function|patch_plt
id|patch_plt
(paren
r_struct
id|module
op_star
id|mod
comma
r_struct
id|plt_entry
op_star
id|plt
comma
r_int
id|target_ip
comma
r_int
r_int
id|target_gp
)paren
(brace
r_if
c_cond
(paren
id|apply_imm64
c_func
(paren
id|mod
comma
(paren
r_struct
id|insn
op_star
)paren
(paren
id|plt-&gt;bundle
(braket
l_int|0
)braket
op_plus
l_int|2
)paren
comma
id|target_gp
)paren
op_logical_and
id|apply_imm60
c_func
(paren
id|mod
comma
(paren
r_struct
id|insn
op_star
)paren
(paren
id|plt-&gt;bundle
(braket
l_int|1
)braket
op_plus
l_int|2
)paren
comma
(paren
id|target_ip
op_minus
(paren
r_int64
)paren
id|plt-&gt;bundle
(braket
l_int|1
)braket
)paren
op_div
l_int|16
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
r_int
DECL|function|plt_target
id|plt_target
(paren
r_struct
id|plt_entry
op_star
id|plt
)paren
(brace
r_uint64
id|b0
comma
id|b1
comma
op_star
id|b
op_assign
(paren
r_uint64
op_star
)paren
id|plt-&gt;bundle
(braket
l_int|1
)braket
suffix:semicolon
r_int
id|off
suffix:semicolon
id|b0
op_assign
id|b
(braket
l_int|0
)braket
suffix:semicolon
id|b1
op_assign
id|b
(braket
l_int|1
)braket
suffix:semicolon
id|off
op_assign
(paren
(paren
(paren
id|b1
op_amp
l_int|0x00fffff000000000
)paren
op_rshift
l_int|36
)paren
multiline_comment|/* imm20b -&gt; bit 0 */
op_or
(paren
(paren
id|b0
op_rshift
l_int|48
)paren
op_lshift
l_int|20
)paren
op_or
(paren
(paren
id|b1
op_amp
l_int|0x7fffff
)paren
op_lshift
l_int|36
)paren
multiline_comment|/* imm39 -&gt; bit 20 */
op_or
(paren
(paren
id|b1
op_amp
l_int|0x0800000000000000
)paren
op_lshift
l_int|0
)paren
)paren
suffix:semicolon
multiline_comment|/* i -&gt; bit 59 */
r_return
(paren
r_int
)paren
id|plt-&gt;bundle
(braket
l_int|1
)braket
op_plus
l_int|16
op_star
id|off
suffix:semicolon
)brace
macro_line|#else /* !USE_BRL */
DECL|struct|plt_entry
r_struct
id|plt_entry
(brace
multiline_comment|/* Three instruction bundles in PLT. */
DECL|member|bundle
r_int
r_char
id|bundle
(braket
l_int|3
)braket
(braket
l_int|16
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|ia64_plt_template
r_static
r_const
r_struct
id|plt_entry
id|ia64_plt_template
op_assign
(brace
(brace
(brace
l_int|0x05
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x01
comma
l_int|0x00
comma
multiline_comment|/* [MLX] nop.m 0 */
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
multiline_comment|/*&t;     movl r16=TARGET_IP */
l_int|0x02
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x60
)brace
comma
(brace
l_int|0x04
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x01
comma
l_int|0x00
comma
multiline_comment|/* [MLX] nop.m 0 */
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x20
comma
multiline_comment|/*&t;     movl gp=TARGET_GP */
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x60
)brace
comma
(brace
l_int|0x11
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x00
comma
l_int|0x01
comma
l_int|0x00
comma
multiline_comment|/* [MIB] nop.m 0 */
l_int|0x60
comma
l_int|0x80
comma
l_int|0x04
comma
l_int|0x80
comma
l_int|0x03
comma
l_int|0x00
comma
multiline_comment|/*&t;     mov b6=r16 */
l_int|0x60
comma
l_int|0x00
comma
l_int|0x80
comma
l_int|0x00
multiline_comment|/*&t;     br.few b6 */
)brace
)brace
)brace
suffix:semicolon
r_static
r_int
DECL|function|patch_plt
id|patch_plt
(paren
r_struct
id|module
op_star
id|mod
comma
r_struct
id|plt_entry
op_star
id|plt
comma
r_int
id|target_ip
comma
r_int
r_int
id|target_gp
)paren
(brace
r_if
c_cond
(paren
id|apply_imm64
c_func
(paren
id|mod
comma
(paren
r_struct
id|insn
op_star
)paren
(paren
id|plt-&gt;bundle
(braket
l_int|0
)braket
op_plus
l_int|2
)paren
comma
id|target_ip
)paren
op_logical_and
id|apply_imm64
c_func
(paren
id|mod
comma
(paren
r_struct
id|insn
op_star
)paren
(paren
id|plt-&gt;bundle
(braket
l_int|1
)braket
op_plus
l_int|2
)paren
comma
id|target_gp
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
r_int
DECL|function|plt_target
id|plt_target
(paren
r_struct
id|plt_entry
op_star
id|plt
)paren
(brace
r_uint64
id|b0
comma
id|b1
comma
op_star
id|b
op_assign
(paren
r_uint64
op_star
)paren
id|plt-&gt;bundle
(braket
l_int|0
)braket
suffix:semicolon
id|b0
op_assign
id|b
(braket
l_int|0
)braket
suffix:semicolon
id|b1
op_assign
id|b
(braket
l_int|1
)braket
suffix:semicolon
r_return
(paren
(paren
(paren
id|b1
op_amp
l_int|0x000007f000000000
)paren
op_rshift
l_int|36
)paren
multiline_comment|/* imm7b -&gt; bit 0 */
op_or
(paren
(paren
id|b1
op_amp
l_int|0x07fc000000000000
)paren
op_rshift
l_int|43
)paren
multiline_comment|/* imm9d -&gt; bit 7 */
op_or
(paren
(paren
id|b1
op_amp
l_int|0x0003e00000000000
)paren
op_rshift
l_int|29
)paren
multiline_comment|/* imm5c -&gt; bit 16 */
op_or
(paren
(paren
id|b1
op_amp
l_int|0x0000100000000000
)paren
op_rshift
l_int|23
)paren
multiline_comment|/* ic -&gt; bit 21 */
op_or
(paren
(paren
id|b0
op_rshift
l_int|46
)paren
op_lshift
l_int|22
)paren
op_or
(paren
(paren
id|b1
op_amp
l_int|0x7fffff
)paren
op_lshift
l_int|40
)paren
multiline_comment|/* imm41 -&gt; bit 22 */
op_or
(paren
(paren
id|b1
op_amp
l_int|0x0800000000000000
)paren
op_lshift
l_int|4
)paren
)paren
suffix:semicolon
multiline_comment|/* i -&gt; bit 63 */
)brace
macro_line|#endif /* !USE_BRL */
r_void
op_star
DECL|function|module_alloc
id|module_alloc
(paren
r_int
r_int
id|size
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|size
)paren
r_return
l_int|NULL
suffix:semicolon
r_return
id|vmalloc
c_func
(paren
id|size
)paren
suffix:semicolon
)brace
r_void
DECL|function|module_free
id|module_free
(paren
r_struct
id|module
op_star
id|mod
comma
r_void
op_star
id|module_region
)paren
(brace
id|vfree
c_func
(paren
id|module_region
)paren
suffix:semicolon
)brace
multiline_comment|/* Have we already seen one of these relocations? */
multiline_comment|/* FIXME: we could look in other sections, too --RR */
r_static
r_int
DECL|function|duplicate_reloc
id|duplicate_reloc
(paren
r_const
id|Elf64_Rela
op_star
id|rela
comma
r_int
r_int
id|num
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|rela
(braket
id|i
)braket
dot
id|r_info
op_eq
id|rela
(braket
id|num
)braket
dot
id|r_info
op_logical_and
id|rela
(braket
id|i
)braket
dot
id|r_addend
op_eq
id|rela
(braket
id|num
)braket
dot
id|r_addend
)paren
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Count how many GOT entries we may need */
r_static
r_int
r_int
DECL|function|count_gots
id|count_gots
(paren
r_const
id|Elf64_Rela
op_star
id|rela
comma
r_int
r_int
id|num
)paren
(brace
r_int
r_int
id|i
comma
id|ret
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Sure, this is order(n^2), but it&squot;s usually short, and not&n;           time critical */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num
suffix:semicolon
id|i
op_increment
)paren
(brace
r_switch
c_cond
(paren
id|ELF64_R_TYPE
c_func
(paren
id|rela
(braket
id|i
)braket
dot
id|r_info
)paren
)paren
(brace
r_case
id|R_IA64_LTOFF22
suffix:colon
r_case
id|R_IA64_LTOFF22X
suffix:colon
r_case
id|R_IA64_LTOFF64I
suffix:colon
r_case
id|R_IA64_LTOFF_FPTR22
suffix:colon
r_case
id|R_IA64_LTOFF_FPTR64I
suffix:colon
r_case
id|R_IA64_LTOFF_FPTR32MSB
suffix:colon
r_case
id|R_IA64_LTOFF_FPTR32LSB
suffix:colon
r_case
id|R_IA64_LTOFF_FPTR64MSB
suffix:colon
r_case
id|R_IA64_LTOFF_FPTR64LSB
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|duplicate_reloc
c_func
(paren
id|rela
comma
id|i
)paren
)paren
id|ret
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* Count how many PLT entries we may need */
r_static
r_int
r_int
DECL|function|count_plts
id|count_plts
(paren
r_const
id|Elf64_Rela
op_star
id|rela
comma
r_int
r_int
id|num
)paren
(brace
r_int
r_int
id|i
comma
id|ret
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Sure, this is order(n^2), but it&squot;s usually short, and not&n;           time critical */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num
suffix:semicolon
id|i
op_increment
)paren
(brace
r_switch
c_cond
(paren
id|ELF64_R_TYPE
c_func
(paren
id|rela
(braket
id|i
)braket
dot
id|r_info
)paren
)paren
(brace
r_case
id|R_IA64_PCREL21B
suffix:colon
r_case
id|R_IA64_PLTOFF22
suffix:colon
r_case
id|R_IA64_PLTOFF64I
suffix:colon
r_case
id|R_IA64_PLTOFF64MSB
suffix:colon
r_case
id|R_IA64_PLTOFF64LSB
suffix:colon
r_case
id|R_IA64_IPLTMSB
suffix:colon
r_case
id|R_IA64_IPLTLSB
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|duplicate_reloc
c_func
(paren
id|rela
comma
id|i
)paren
)paren
id|ret
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* We need to create an function-descriptors for any internal function&n;   which is referenced. */
r_static
r_int
r_int
DECL|function|count_fdescs
id|count_fdescs
(paren
r_const
id|Elf64_Rela
op_star
id|rela
comma
r_int
r_int
id|num
)paren
(brace
r_int
r_int
id|i
comma
id|ret
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Sure, this is order(n^2), but it&squot;s usually short, and not time critical.  */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num
suffix:semicolon
id|i
op_increment
)paren
(brace
r_switch
c_cond
(paren
id|ELF64_R_TYPE
c_func
(paren
id|rela
(braket
id|i
)braket
dot
id|r_info
)paren
)paren
(brace
r_case
id|R_IA64_FPTR64I
suffix:colon
r_case
id|R_IA64_FPTR32LSB
suffix:colon
r_case
id|R_IA64_FPTR32MSB
suffix:colon
r_case
id|R_IA64_FPTR64LSB
suffix:colon
r_case
id|R_IA64_FPTR64MSB
suffix:colon
r_case
id|R_IA64_LTOFF_FPTR22
suffix:colon
r_case
id|R_IA64_LTOFF_FPTR32LSB
suffix:colon
r_case
id|R_IA64_LTOFF_FPTR32MSB
suffix:colon
r_case
id|R_IA64_LTOFF_FPTR64I
suffix:colon
r_case
id|R_IA64_LTOFF_FPTR64LSB
suffix:colon
r_case
id|R_IA64_LTOFF_FPTR64MSB
suffix:colon
r_case
id|R_IA64_IPLTMSB
suffix:colon
r_case
id|R_IA64_IPLTLSB
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * Jumps to static functions sometimes go straight to their&n;&t;&t;&t; * offset.  Of course, that may not be possible if the jump is&n;&t;&t;&t; * from init -&gt; core or vice. versa, so we need to generate an&n;&t;&t;&t; * FDESC (and PLT etc) for that.&n;&t;&t;&t; */
r_case
id|R_IA64_PCREL21B
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|duplicate_reloc
c_func
(paren
id|rela
comma
id|i
)paren
)paren
id|ret
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_return
id|ret
suffix:semicolon
)brace
r_int
DECL|function|module_frob_arch_sections
id|module_frob_arch_sections
(paren
id|Elf_Ehdr
op_star
id|ehdr
comma
id|Elf_Shdr
op_star
id|sechdrs
comma
r_char
op_star
id|secstrings
comma
r_struct
id|module
op_star
id|mod
)paren
(brace
r_int
r_int
id|core_plts
op_assign
l_int|0
comma
id|init_plts
op_assign
l_int|0
comma
id|gots
op_assign
l_int|0
comma
id|fdescs
op_assign
l_int|0
suffix:semicolon
id|Elf64_Shdr
op_star
id|s
comma
op_star
id|sechdrs_end
op_assign
id|sechdrs
op_plus
id|ehdr-&gt;e_shnum
suffix:semicolon
multiline_comment|/*&n;&t; * To store the PLTs and function-descriptors, we expand the .text section for&n;&t; * core module-code and the .init.text section for initialization code.&n;&t; */
r_for
c_loop
(paren
id|s
op_assign
id|sechdrs
suffix:semicolon
id|s
OL
id|sechdrs_end
suffix:semicolon
op_increment
id|s
)paren
r_if
c_cond
(paren
id|strcmp
c_func
(paren
l_string|&quot;.core.plt&quot;
comma
id|secstrings
op_plus
id|s-&gt;sh_name
)paren
op_eq
l_int|0
)paren
id|mod-&gt;arch.core_plt
op_assign
id|s
suffix:semicolon
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
l_string|&quot;.init.plt&quot;
comma
id|secstrings
op_plus
id|s-&gt;sh_name
)paren
op_eq
l_int|0
)paren
id|mod-&gt;arch.init_plt
op_assign
id|s
suffix:semicolon
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
l_string|&quot;.got&quot;
comma
id|secstrings
op_plus
id|s-&gt;sh_name
)paren
op_eq
l_int|0
)paren
id|mod-&gt;arch.got
op_assign
id|s
suffix:semicolon
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
l_string|&quot;.opd&quot;
comma
id|secstrings
op_plus
id|s-&gt;sh_name
)paren
op_eq
l_int|0
)paren
id|mod-&gt;arch.opd
op_assign
id|s
suffix:semicolon
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
l_string|&quot;.IA_64.unwind&quot;
comma
id|secstrings
op_plus
id|s-&gt;sh_name
)paren
op_eq
l_int|0
)paren
id|mod-&gt;arch.unwind
op_assign
id|s
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mod-&gt;arch.core_plt
op_logical_or
op_logical_neg
id|mod-&gt;arch.init_plt
op_logical_or
op_logical_neg
id|mod-&gt;arch.got
op_logical_or
op_logical_neg
id|mod-&gt;arch.opd
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: sections missing&bslash;n&quot;
comma
id|mod-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENOEXEC
suffix:semicolon
)brace
multiline_comment|/* GOT and PLTs can occur in any relocated section... */
r_for
c_loop
(paren
id|s
op_assign
id|sechdrs
op_plus
l_int|1
suffix:semicolon
id|s
OL
id|sechdrs_end
suffix:semicolon
op_increment
id|s
)paren
(brace
r_const
id|Elf64_Rela
op_star
id|rels
op_assign
(paren
r_void
op_star
)paren
id|ehdr
op_plus
id|s-&gt;sh_offset
suffix:semicolon
r_int
r_int
id|numrels
op_assign
id|s-&gt;sh_size
op_div
r_sizeof
(paren
id|Elf64_Rela
)paren
suffix:semicolon
r_if
c_cond
(paren
id|s-&gt;sh_type
op_ne
id|SHT_RELA
)paren
r_continue
suffix:semicolon
id|gots
op_add_assign
id|count_gots
c_func
(paren
id|rels
comma
id|numrels
)paren
suffix:semicolon
id|fdescs
op_add_assign
id|count_fdescs
c_func
(paren
id|rels
comma
id|numrels
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strstr
c_func
(paren
id|secstrings
op_plus
id|s-&gt;sh_name
comma
l_string|&quot;.init&quot;
)paren
)paren
id|init_plts
op_add_assign
id|count_plts
c_func
(paren
id|rels
comma
id|numrels
)paren
suffix:semicolon
r_else
id|core_plts
op_add_assign
id|count_plts
c_func
(paren
id|rels
comma
id|numrels
)paren
suffix:semicolon
)brace
id|mod-&gt;arch.core_plt-&gt;sh_type
op_assign
id|SHT_NOBITS
suffix:semicolon
id|mod-&gt;arch.core_plt-&gt;sh_flags
op_assign
id|SHF_EXECINSTR
op_or
id|SHF_ALLOC
suffix:semicolon
id|mod-&gt;arch.core_plt-&gt;sh_addralign
op_assign
l_int|16
suffix:semicolon
id|mod-&gt;arch.core_plt-&gt;sh_size
op_assign
id|core_plts
op_star
r_sizeof
(paren
r_struct
id|plt_entry
)paren
suffix:semicolon
id|mod-&gt;arch.init_plt-&gt;sh_type
op_assign
id|SHT_NOBITS
suffix:semicolon
id|mod-&gt;arch.init_plt-&gt;sh_flags
op_assign
id|SHF_EXECINSTR
op_or
id|SHF_ALLOC
suffix:semicolon
id|mod-&gt;arch.init_plt-&gt;sh_addralign
op_assign
l_int|16
suffix:semicolon
id|mod-&gt;arch.init_plt-&gt;sh_size
op_assign
id|init_plts
op_star
r_sizeof
(paren
r_struct
id|plt_entry
)paren
suffix:semicolon
id|mod-&gt;arch.got-&gt;sh_type
op_assign
id|SHT_NOBITS
suffix:semicolon
id|mod-&gt;arch.got-&gt;sh_flags
op_assign
id|ARCH_SHF_SMALL
op_or
id|SHF_ALLOC
suffix:semicolon
id|mod-&gt;arch.got-&gt;sh_addralign
op_assign
l_int|8
suffix:semicolon
id|mod-&gt;arch.got-&gt;sh_size
op_assign
id|gots
op_star
r_sizeof
(paren
r_struct
id|got_entry
)paren
suffix:semicolon
id|mod-&gt;arch.opd-&gt;sh_type
op_assign
id|SHT_NOBITS
suffix:semicolon
id|mod-&gt;arch.opd-&gt;sh_flags
op_assign
id|SHF_ALLOC
suffix:semicolon
id|mod-&gt;arch.opd-&gt;sh_addralign
op_assign
l_int|8
suffix:semicolon
id|mod-&gt;arch.opd-&gt;sh_size
op_assign
id|fdescs
op_star
r_sizeof
(paren
r_struct
id|fdesc
)paren
suffix:semicolon
id|DEBUGP
c_func
(paren
l_string|&quot;%s: core.plt=%lx, init.plt=%lx, got=%lx, fdesc=%lx&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|mod-&gt;arch.core_plt-&gt;sh_size
comma
id|mod-&gt;arch.init_plt-&gt;sh_size
comma
id|mod-&gt;arch.got-&gt;sh_size
comma
id|mod-&gt;arch.opd-&gt;sh_size
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|in_init
id|in_init
(paren
r_const
r_struct
id|module
op_star
id|mod
comma
r_uint64
id|addr
)paren
(brace
r_return
id|addr
op_minus
(paren
r_uint64
)paren
id|mod-&gt;module_init
OL
id|mod-&gt;init_size
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|in_core
id|in_core
(paren
r_const
r_struct
id|module
op_star
id|mod
comma
r_uint64
id|addr
)paren
(brace
r_return
id|addr
op_minus
(paren
r_uint64
)paren
id|mod-&gt;module_core
OL
id|mod-&gt;core_size
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|is_internal
id|is_internal
(paren
r_const
r_struct
id|module
op_star
id|mod
comma
r_uint64
id|value
)paren
(brace
r_return
id|in_init
c_func
(paren
id|mod
comma
id|value
)paren
op_logical_or
id|in_core
c_func
(paren
id|mod
comma
id|value
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Get gp-relative offset for the linkage-table entry of VALUE.&n; */
r_static
r_uint64
DECL|function|get_ltoff
id|get_ltoff
(paren
r_struct
id|module
op_star
id|mod
comma
r_uint64
id|value
comma
r_int
op_star
id|okp
)paren
(brace
r_struct
id|got_entry
op_star
id|got
comma
op_star
id|e
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|okp
)paren
r_return
l_int|0
suffix:semicolon
id|got
op_assign
(paren
r_void
op_star
)paren
id|mod-&gt;arch.got-&gt;sh_addr
suffix:semicolon
r_for
c_loop
(paren
id|e
op_assign
id|got
suffix:semicolon
id|e
OL
id|got
op_plus
id|mod-&gt;arch.next_got_entry
suffix:semicolon
op_increment
id|e
)paren
r_if
c_cond
(paren
id|e-&gt;val
op_eq
id|value
)paren
r_goto
id|found
suffix:semicolon
multiline_comment|/* Not enough GOT entries? */
r_if
c_cond
(paren
id|e
op_ge
(paren
r_struct
id|got_entry
op_star
)paren
(paren
id|mod-&gt;arch.got-&gt;sh_addr
op_plus
id|mod-&gt;arch.got-&gt;sh_size
)paren
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
id|e-&gt;val
op_assign
id|value
suffix:semicolon
op_increment
id|mod-&gt;arch.next_got_entry
suffix:semicolon
id|found
suffix:colon
r_return
(paren
r_uint64
)paren
id|e
op_minus
id|mod-&gt;arch.gp
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|gp_addressable
id|gp_addressable
(paren
r_struct
id|module
op_star
id|mod
comma
r_uint64
id|value
)paren
(brace
r_return
id|value
op_minus
id|mod-&gt;arch.gp
op_plus
id|MAX_LTOFF
op_div
l_int|2
OL
id|MAX_LTOFF
suffix:semicolon
)brace
multiline_comment|/* Get PC-relative PLT entry for this value.  Returns 0 on failure. */
r_static
r_uint64
DECL|function|get_plt
id|get_plt
(paren
r_struct
id|module
op_star
id|mod
comma
r_const
r_struct
id|insn
op_star
id|insn
comma
r_uint64
id|value
comma
r_int
op_star
id|okp
)paren
(brace
r_struct
id|plt_entry
op_star
id|plt
comma
op_star
id|plt_end
suffix:semicolon
r_uint64
id|target_ip
comma
id|target_gp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|okp
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|in_init
c_func
(paren
id|mod
comma
(paren
r_uint64
)paren
id|insn
)paren
)paren
(brace
id|plt
op_assign
(paren
r_void
op_star
)paren
id|mod-&gt;arch.init_plt-&gt;sh_addr
suffix:semicolon
id|plt_end
op_assign
(paren
r_void
op_star
)paren
id|plt
op_plus
id|mod-&gt;arch.init_plt-&gt;sh_size
suffix:semicolon
)brace
r_else
(brace
id|plt
op_assign
(paren
r_void
op_star
)paren
id|mod-&gt;arch.core_plt-&gt;sh_addr
suffix:semicolon
id|plt_end
op_assign
(paren
r_void
op_star
)paren
id|plt
op_plus
id|mod-&gt;arch.core_plt-&gt;sh_size
suffix:semicolon
)brace
multiline_comment|/* &quot;value&quot; is a pointer to a function-descriptor; fetch the target ip/gp from it: */
id|target_ip
op_assign
(paren
(paren
r_uint64
op_star
)paren
id|value
)paren
(braket
l_int|0
)braket
suffix:semicolon
id|target_gp
op_assign
(paren
(paren
r_uint64
op_star
)paren
id|value
)paren
(braket
l_int|1
)braket
suffix:semicolon
multiline_comment|/* Look for existing PLT entry. */
r_while
c_loop
(paren
id|plt-&gt;bundle
(braket
l_int|0
)braket
(braket
l_int|0
)braket
)paren
(brace
r_if
c_cond
(paren
id|plt_target
c_func
(paren
id|plt
)paren
op_eq
id|target_ip
)paren
r_goto
id|found
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|plt
op_ge
id|plt_end
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
op_star
id|plt
op_assign
id|ia64_plt_template
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|patch_plt
c_func
(paren
id|mod
comma
id|plt
comma
id|target_ip
comma
id|target_gp
)paren
)paren
(brace
op_star
id|okp
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#if ARCH_MODULE_DEBUG
r_if
c_cond
(paren
id|plt_target
c_func
(paren
id|plt
)paren
op_ne
id|target_ip
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: mistargeted PLT: wanted %lx, got %lx&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|target_ip
comma
id|plt_target
c_func
(paren
id|plt
)paren
)paren
suffix:semicolon
op_star
id|okp
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#endif
id|found
suffix:colon
r_return
(paren
r_uint64
)paren
id|plt
suffix:semicolon
)brace
multiline_comment|/* Get function descriptor for VALUE. */
r_static
r_uint64
DECL|function|get_fdesc
id|get_fdesc
(paren
r_struct
id|module
op_star
id|mod
comma
r_uint64
id|value
comma
r_int
op_star
id|okp
)paren
(brace
r_struct
id|fdesc
op_star
id|fdesc
op_assign
(paren
r_void
op_star
)paren
id|mod-&gt;arch.opd-&gt;sh_addr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|okp
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|value
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: fdesc for zero requested!&bslash;n&quot;
comma
id|mod-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|is_internal
c_func
(paren
id|mod
comma
id|value
)paren
)paren
multiline_comment|/*&n;&t;&t; * If it&squot;s not a module-local entry-point, &quot;value&quot; already points to a&n;&t;&t; * function-descriptor.&n;&t;&t; */
r_return
id|value
suffix:semicolon
multiline_comment|/* Look for existing function descriptor. */
r_while
c_loop
(paren
id|fdesc-&gt;ip
)paren
(brace
r_if
c_cond
(paren
id|fdesc-&gt;ip
op_eq
id|value
)paren
r_return
(paren
r_uint64
)paren
id|fdesc
suffix:semicolon
r_if
c_cond
(paren
(paren
r_uint64
)paren
op_increment
id|fdesc
op_ge
id|mod-&gt;arch.opd-&gt;sh_addr
op_plus
id|mod-&gt;arch.opd-&gt;sh_size
)paren
id|BUG
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Create new one */
id|fdesc-&gt;ip
op_assign
id|value
suffix:semicolon
id|fdesc-&gt;gp
op_assign
id|mod-&gt;arch.gp
suffix:semicolon
r_return
(paren
r_uint64
)paren
id|fdesc
suffix:semicolon
)brace
r_static
r_inline
r_int
DECL|function|do_reloc
id|do_reloc
(paren
r_struct
id|module
op_star
id|mod
comma
r_uint8
id|r_type
comma
id|Elf64_Sym
op_star
id|sym
comma
r_uint64
id|addend
comma
id|Elf64_Shdr
op_star
id|sec
comma
r_void
op_star
id|location
)paren
(brace
r_enum
id|reloc_target_format
id|format
op_assign
(paren
id|r_type
op_rshift
id|FORMAT_SHIFT
)paren
op_amp
id|FORMAT_MASK
suffix:semicolon
r_enum
id|reloc_value_formula
id|formula
op_assign
(paren
id|r_type
op_rshift
id|VALUE_SHIFT
)paren
op_amp
id|VALUE_MASK
suffix:semicolon
r_uint64
id|val
suffix:semicolon
r_int
id|ok
op_assign
l_int|1
suffix:semicolon
id|val
op_assign
id|sym-&gt;st_value
op_plus
id|addend
suffix:semicolon
r_switch
c_cond
(paren
id|formula
)paren
(brace
r_case
id|RV_SEGREL
suffix:colon
multiline_comment|/* segment base is arbitrarily chosen to be 0 for kernel modules */
r_case
id|RV_DIRECT
suffix:colon
r_break
suffix:semicolon
r_case
id|RV_GPREL
suffix:colon
id|val
op_sub_assign
id|mod-&gt;arch.gp
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RV_LTREL
suffix:colon
id|val
op_assign
id|get_ltoff
c_func
(paren
id|mod
comma
id|val
comma
op_amp
id|ok
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RV_PLTREL
suffix:colon
id|val
op_assign
id|get_plt
c_func
(paren
id|mod
comma
id|location
comma
id|val
comma
op_amp
id|ok
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RV_FPTR
suffix:colon
id|val
op_assign
id|get_fdesc
c_func
(paren
id|mod
comma
id|val
comma
op_amp
id|ok
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RV_SECREL
suffix:colon
id|val
op_sub_assign
id|sec-&gt;sh_addr
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RV_LTREL_FPTR
suffix:colon
id|val
op_assign
id|get_ltoff
c_func
(paren
id|mod
comma
id|get_fdesc
c_func
(paren
id|mod
comma
id|val
comma
op_amp
id|ok
)paren
comma
op_amp
id|ok
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RV_PCREL
suffix:colon
r_switch
c_cond
(paren
id|r_type
)paren
(brace
r_case
id|R_IA64_PCREL21B
suffix:colon
multiline_comment|/* special because it can cross into other module/kernel-core.  */
r_if
c_cond
(paren
op_logical_neg
id|is_internal
c_func
(paren
id|mod
comma
id|val
)paren
)paren
id|val
op_assign
id|get_plt
c_func
(paren
id|mod
comma
id|location
comma
id|val
comma
op_amp
id|ok
)paren
suffix:semicolon
multiline_comment|/* FALL THROUGH */
r_default
suffix:colon
id|val
op_sub_assign
id|bundle
c_func
(paren
id|location
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|R_IA64_PCREL32MSB
suffix:colon
r_case
id|R_IA64_PCREL32LSB
suffix:colon
r_case
id|R_IA64_PCREL64MSB
suffix:colon
r_case
id|R_IA64_PCREL64LSB
suffix:colon
id|val
op_sub_assign
(paren
r_uint64
)paren
id|location
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|r_type
)paren
(brace
r_case
id|R_IA64_PCREL60B
suffix:colon
id|format
op_assign
id|RF_INSN60
suffix:semicolon
r_break
suffix:semicolon
r_case
id|R_IA64_PCREL21B
suffix:colon
id|format
op_assign
id|RF_INSN21B
suffix:semicolon
r_break
suffix:semicolon
r_case
id|R_IA64_PCREL21M
suffix:colon
id|format
op_assign
id|RF_INSN21M
suffix:semicolon
r_break
suffix:semicolon
r_case
id|R_IA64_PCREL21F
suffix:colon
id|format
op_assign
id|RF_INSN21F
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RV_BDREL
suffix:colon
id|val
op_sub_assign
(paren
r_uint64
)paren
(paren
id|in_init
c_func
(paren
id|mod
comma
id|val
)paren
ques
c_cond
id|mod-&gt;module_init
suffix:colon
id|mod-&gt;module_core
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RV_LTV
suffix:colon
multiline_comment|/* can link-time value relocs happen here?  */
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RV_PCREL2
suffix:colon
r_if
c_cond
(paren
id|r_type
op_eq
id|R_IA64_PCREL21BI
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|is_internal
c_func
(paren
id|mod
comma
id|val
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: %s reloc against non-local symbol (%lx)&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|reloc_name
(braket
id|r_type
)braket
comma
id|val
)paren
suffix:semicolon
r_return
op_minus
id|ENOEXEC
suffix:semicolon
)brace
id|format
op_assign
id|RF_INSN21B
suffix:semicolon
)brace
id|val
op_sub_assign
id|bundle
c_func
(paren
id|location
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RV_SPECIAL
suffix:colon
r_switch
c_cond
(paren
id|r_type
)paren
(brace
r_case
id|R_IA64_IPLTMSB
suffix:colon
r_case
id|R_IA64_IPLTLSB
suffix:colon
id|val
op_assign
id|get_fdesc
c_func
(paren
id|mod
comma
id|get_plt
c_func
(paren
id|mod
comma
id|location
comma
id|val
comma
op_amp
id|ok
)paren
comma
op_amp
id|ok
)paren
suffix:semicolon
id|format
op_assign
id|RF_64LSB
suffix:semicolon
r_if
c_cond
(paren
id|r_type
op_eq
id|R_IA64_IPLTMSB
)paren
id|format
op_assign
id|RF_64MSB
suffix:semicolon
r_break
suffix:semicolon
r_case
id|R_IA64_SUB
suffix:colon
id|val
op_assign
id|addend
op_minus
id|sym-&gt;st_value
suffix:semicolon
id|format
op_assign
id|RF_INSN64
suffix:semicolon
r_break
suffix:semicolon
r_case
id|R_IA64_LTOFF22X
suffix:colon
r_if
c_cond
(paren
id|gp_addressable
c_func
(paren
id|mod
comma
id|val
)paren
)paren
id|val
op_sub_assign
id|mod-&gt;arch.gp
suffix:semicolon
r_else
id|val
op_assign
id|get_ltoff
c_func
(paren
id|mod
comma
id|val
comma
op_amp
id|ok
)paren
suffix:semicolon
id|format
op_assign
id|RF_INSN22
suffix:semicolon
r_break
suffix:semicolon
r_case
id|R_IA64_LDXMOV
suffix:colon
r_if
c_cond
(paren
id|gp_addressable
c_func
(paren
id|mod
comma
id|val
)paren
)paren
(brace
multiline_comment|/* turn &quot;ld8&quot; into &quot;mov&quot;: */
id|DEBUGP
c_func
(paren
l_string|&quot;%s: patching ld8 at %p to mov&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|location
)paren
suffix:semicolon
id|ia64_patch
c_func
(paren
(paren
id|u64
)paren
id|location
comma
l_int|0x1fff80fe000
comma
l_int|0x10000000000
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
id|reloc_name
(braket
id|r_type
)braket
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: special reloc %s not supported&quot;
comma
id|mod-&gt;name
comma
id|reloc_name
(braket
id|r_type
)braket
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: unknown special reloc %x&bslash;n&quot;
comma
id|mod-&gt;name
comma
id|r_type
)paren
suffix:semicolon
r_return
op_minus
id|ENOEXEC
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|RV_TPREL
suffix:colon
r_case
id|RV_LTREL_TPREL
suffix:colon
r_case
id|RV_DTPMOD
suffix:colon
r_case
id|RV_LTREL_DTPMOD
suffix:colon
r_case
id|RV_DTPREL
suffix:colon
r_case
id|RV_LTREL_DTPREL
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: %s reloc not supported&bslash;n&quot;
comma
id|mod-&gt;name
comma
id|reloc_name
(braket
id|r_type
)braket
ques
c_cond
id|reloc_name
(braket
id|r_type
)braket
suffix:colon
l_string|&quot;?&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOEXEC
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: unknown reloc %x&bslash;n&quot;
comma
id|mod-&gt;name
comma
id|r_type
)paren
suffix:semicolon
r_return
op_minus
id|ENOEXEC
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|ok
)paren
r_return
op_minus
id|ENOEXEC
suffix:semicolon
id|DEBUGP
c_func
(paren
l_string|&quot;%s: [%p]&lt;-%016lx = %s(%lx)&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|location
comma
id|val
comma
id|reloc_name
(braket
id|r_type
)braket
ques
c_cond
id|reloc_name
(braket
id|r_type
)braket
suffix:colon
l_string|&quot;?&quot;
comma
id|sym-&gt;st_value
op_plus
id|addend
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|format
)paren
(brace
r_case
id|RF_INSN21B
suffix:colon
id|ok
op_assign
id|apply_imm21b
c_func
(paren
id|mod
comma
id|location
comma
(paren
r_int64
)paren
id|val
op_div
l_int|16
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RF_INSN22
suffix:colon
id|ok
op_assign
id|apply_imm22
c_func
(paren
id|mod
comma
id|location
comma
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RF_INSN64
suffix:colon
id|ok
op_assign
id|apply_imm64
c_func
(paren
id|mod
comma
id|location
comma
id|val
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RF_INSN60
suffix:colon
id|ok
op_assign
id|apply_imm60
c_func
(paren
id|mod
comma
id|location
comma
(paren
r_int64
)paren
id|val
op_div
l_int|16
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RF_32LSB
suffix:colon
id|put_unaligned
c_func
(paren
id|val
comma
(paren
r_uint32
op_star
)paren
id|location
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RF_64LSB
suffix:colon
id|put_unaligned
c_func
(paren
id|val
comma
(paren
r_uint64
op_star
)paren
id|location
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|RF_32MSB
suffix:colon
multiline_comment|/* ia64 Linux is little-endian... */
r_case
id|RF_64MSB
suffix:colon
multiline_comment|/* ia64 Linux is little-endian... */
r_case
id|RF_INSN14
suffix:colon
multiline_comment|/* must be within-module, i.e., resolved by &quot;ld -r&quot; */
r_case
id|RF_INSN21M
suffix:colon
multiline_comment|/* must be within-module, i.e., resolved by &quot;ld -r&quot; */
r_case
id|RF_INSN21F
suffix:colon
multiline_comment|/* must be within-module, i.e., resolved by &quot;ld -r&quot; */
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: format %u needed by %s reloc is not supported&bslash;n&quot;
comma
id|mod-&gt;name
comma
id|format
comma
id|reloc_name
(braket
id|r_type
)braket
ques
c_cond
id|reloc_name
(braket
id|r_type
)braket
suffix:colon
l_string|&quot;?&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOEXEC
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;%s: relocation %s resulted in unknown format %u&bslash;n&quot;
comma
id|mod-&gt;name
comma
id|reloc_name
(braket
id|r_type
)braket
ques
c_cond
id|reloc_name
(braket
id|r_type
)braket
suffix:colon
l_string|&quot;?&quot;
comma
id|format
)paren
suffix:semicolon
r_return
op_minus
id|ENOEXEC
suffix:semicolon
)brace
r_return
id|ok
ques
c_cond
l_int|0
suffix:colon
op_minus
id|ENOEXEC
suffix:semicolon
)brace
r_int
DECL|function|apply_relocate_add
id|apply_relocate_add
(paren
id|Elf64_Shdr
op_star
id|sechdrs
comma
r_const
r_char
op_star
id|strtab
comma
r_int
r_int
id|symindex
comma
r_int
r_int
id|relsec
comma
r_struct
id|module
op_star
id|mod
)paren
(brace
r_int
r_int
id|i
comma
id|n
op_assign
id|sechdrs
(braket
id|relsec
)braket
dot
id|sh_size
op_div
r_sizeof
(paren
id|Elf64_Rela
)paren
suffix:semicolon
id|Elf64_Rela
op_star
id|rela
op_assign
(paren
r_void
op_star
)paren
id|sechdrs
(braket
id|relsec
)braket
dot
id|sh_addr
suffix:semicolon
id|Elf64_Shdr
op_star
id|target_sec
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|DEBUGP
c_func
(paren
l_string|&quot;%s: applying section %u (%u relocs) to %u&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|relsec
comma
id|n
comma
id|sechdrs
(braket
id|relsec
)braket
dot
id|sh_info
)paren
suffix:semicolon
id|target_sec
op_assign
id|sechdrs
op_plus
id|sechdrs
(braket
id|relsec
)braket
dot
id|sh_info
suffix:semicolon
r_if
c_cond
(paren
id|target_sec-&gt;sh_entsize
op_eq
op_complement
l_int|0UL
)paren
multiline_comment|/*&n;&t;&t; * If target section wasn&squot;t allocated, we don&squot;t need to relocate it.&n;&t;&t; * Happens, e.g., for debug sections.&n;&t;&t; */
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|mod-&gt;arch.gp
)paren
(brace
multiline_comment|/*&n;&t;&t; * XXX Should have an arch-hook for running this after final section&n;&t;&t; *     addresses have been selected...&n;&t;&t; */
multiline_comment|/* See if gp can cover the entire core module:  */
r_uint64
id|gp
op_assign
(paren
r_uint64
)paren
id|mod-&gt;module_core
op_plus
id|MAX_LTOFF
op_div
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|mod-&gt;core_size
op_ge
id|MAX_LTOFF
)paren
multiline_comment|/*&n;&t;&t;&t; * This takes advantage of fact that SHF_ARCH_SMALL gets allocated&n;&t;&t;&t; * at the end of the module.&n;&t;&t;&t; */
id|gp
op_assign
(paren
r_uint64
)paren
id|mod-&gt;module_core
op_plus
id|mod-&gt;core_size
op_minus
id|MAX_LTOFF
op_div
l_int|2
suffix:semicolon
id|mod-&gt;arch.gp
op_assign
id|gp
suffix:semicolon
id|DEBUGP
c_func
(paren
l_string|&quot;%s: placing gp at 0x%lx&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|gp
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|n
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ret
op_assign
id|do_reloc
c_func
(paren
id|mod
comma
id|ELF64_R_TYPE
c_func
(paren
id|rela
(braket
id|i
)braket
dot
id|r_info
)paren
comma
(paren
(paren
id|Elf64_Sym
op_star
)paren
id|sechdrs
(braket
id|symindex
)braket
dot
id|sh_addr
op_plus
id|ELF64_R_SYM
c_func
(paren
id|rela
(braket
id|i
)braket
dot
id|r_info
)paren
)paren
comma
id|rela
(braket
id|i
)braket
dot
id|r_addend
comma
id|target_sec
comma
(paren
r_void
op_star
)paren
id|target_sec-&gt;sh_addr
op_plus
id|rela
(braket
id|i
)braket
dot
id|r_offset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|apply_relocate
id|apply_relocate
(paren
id|Elf64_Shdr
op_star
id|sechdrs
comma
r_const
r_char
op_star
id|strtab
comma
r_int
r_int
id|symindex
comma
r_int
r_int
id|relsec
comma
r_struct
id|module
op_star
id|mod
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;module %s: REL relocs in section %u unsupported&bslash;n&quot;
comma
id|mod-&gt;name
comma
id|relsec
)paren
suffix:semicolon
r_return
op_minus
id|ENOEXEC
suffix:semicolon
)brace
r_int
DECL|function|module_finalize
id|module_finalize
(paren
r_const
id|Elf_Ehdr
op_star
id|hdr
comma
r_const
id|Elf_Shdr
op_star
id|sechdrs
comma
r_struct
id|module
op_star
id|mod
)paren
(brace
id|DEBUGP
c_func
(paren
l_string|&quot;%s: init: entry=%p&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|mod-&gt;init
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mod-&gt;arch.unwind
)paren
id|mod-&gt;arch.unw_table
op_assign
id|unw_add_unwind_table
c_func
(paren
id|mod-&gt;name
comma
l_int|0
comma
id|mod-&gt;arch.gp
comma
(paren
r_void
op_star
)paren
id|mod-&gt;arch.unwind-&gt;sh_addr
comma
(paren
(paren
r_void
op_star
)paren
id|mod-&gt;arch.unwind-&gt;sh_addr
op_plus
id|mod-&gt;arch.unwind-&gt;sh_size
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|module_arch_cleanup
id|module_arch_cleanup
(paren
r_struct
id|module
op_star
id|mod
)paren
(brace
r_if
c_cond
(paren
id|mod-&gt;arch.unwind
)paren
id|unw_remove_unwind_table
c_func
(paren
id|mod-&gt;arch.unw_table
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SMP
r_void
DECL|function|percpu_modcopy
id|percpu_modcopy
(paren
r_void
op_star
id|pcpudst
comma
r_const
r_void
op_star
id|src
comma
r_int
r_int
id|size
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|cpu_possible
c_func
(paren
id|i
)paren
)paren
id|memcpy
c_func
(paren
id|pcpudst
op_plus
id|__per_cpu_offset
(braket
id|i
)braket
comma
id|src
comma
id|size
)paren
suffix:semicolon
)brace
macro_line|#endif /* CONFIG_SMP */
eof
