multiline_comment|/*&n; * arch/ia64/kernel/acpi-ext.c&n; *&n; * Copyright (C) 2003 Hewlett-Packard&n; * Copyright (C) Alex Williamson&n; *&n; * Vendor specific extensions to ACPI.  These are used by both&n; * HP and NEC.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/acpi.h&gt;
macro_line|#include &lt;linux/efi.h&gt;
macro_line|#include &lt;asm/acpi-ext.h&gt;
multiline_comment|/*&n; * Note: Strictly speaking, this is only needed for HP and NEC machines.&n; *&t; However, NEC machines identify themselves as DIG-compliant, so there is&n; *&t; no easy way to #ifdef this out.&n; */
id|acpi_status
DECL|function|hp_acpi_csr_space
id|hp_acpi_csr_space
(paren
id|acpi_handle
id|obj
comma
id|u64
op_star
id|csr_base
comma
id|u64
op_star
id|csr_length
)paren
(brace
r_int
id|i
comma
id|offset
op_assign
l_int|0
suffix:semicolon
id|acpi_status
id|status
suffix:semicolon
r_struct
id|acpi_buffer
id|buf
suffix:semicolon
r_struct
id|acpi_resource_vendor
op_star
id|res
suffix:semicolon
r_struct
id|acpi_hp_vendor_long
op_star
id|hp_res
suffix:semicolon
id|efi_guid_t
id|vendor_guid
suffix:semicolon
op_star
id|csr_base
op_assign
l_int|0
suffix:semicolon
op_star
id|csr_length
op_assign
l_int|0
suffix:semicolon
id|status
op_assign
id|acpi_get_crs
c_func
(paren
id|obj
comma
op_amp
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
c_func
(paren
id|status
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PREFIX
l_string|&quot;Unable to get _CRS data on object&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
id|res
op_assign
(paren
r_struct
id|acpi_resource_vendor
op_star
)paren
id|acpi_get_crs_type
c_func
(paren
op_amp
id|buf
comma
op_amp
id|offset
comma
id|ACPI_RSTYPE_VENDOR
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|res
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PREFIX
l_string|&quot;Failed to find config space for device&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_dispose_crs
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
r_return
id|AE_NOT_FOUND
suffix:semicolon
)brace
id|hp_res
op_assign
(paren
r_struct
id|acpi_hp_vendor_long
op_star
)paren
(paren
id|res-&gt;reserved
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res-&gt;length
op_ne
id|HP_CCSR_LENGTH
op_logical_or
id|hp_res-&gt;guid_id
op_ne
id|HP_CCSR_TYPE
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PREFIX
l_string|&quot;Unknown Vendor data&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_dispose_crs
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
r_return
id|AE_TYPE
suffix:semicolon
multiline_comment|/* Revisit error? */
)brace
id|memcpy
c_func
(paren
op_amp
id|vendor_guid
comma
id|hp_res-&gt;guid
comma
r_sizeof
(paren
id|efi_guid_t
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|efi_guidcmp
c_func
(paren
id|vendor_guid
comma
id|HP_CCSR_GUID
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
id|PREFIX
l_string|&quot;Vendor GUID does not match&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_dispose_crs
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
r_return
id|AE_TYPE
suffix:semicolon
multiline_comment|/* Revisit error? */
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
op_star
id|csr_base
op_or_assign
(paren
(paren
id|u64
)paren
(paren
id|hp_res-&gt;csr_base
(braket
id|i
)braket
)paren
op_lshift
(paren
id|i
op_star
l_int|8
)paren
)paren
suffix:semicolon
op_star
id|csr_length
op_or_assign
(paren
(paren
id|u64
)paren
(paren
id|hp_res-&gt;csr_length
(braket
id|i
)braket
)paren
op_lshift
(paren
id|i
op_star
l_int|8
)paren
)paren
suffix:semicolon
)brace
id|acpi_dispose_crs
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
r_return
id|AE_OK
suffix:semicolon
)brace
eof
