multiline_comment|/*&n; * File:&t;mca.c&n; * Purpose:&t;Generic MCA handling layer&n; *&n; * Updated for latest kernel&n; * Copyright (C) 2002 Dell Computer Corporation&n; * Copyright (C) Matt Domsch (Matt_Domsch@dell.com)&n; *&n; * Copyright (C) 2002 Intel&n; * Copyright (C) Jenna Hall (jenna.s.hall@intel.com)&n; *&n; * Copyright (C) 2001 Intel&n; * Copyright (C) Fred Lewis (frederick.v.lewis@intel.com)&n; *&n; * Copyright (C) 2000 Intel&n; * Copyright (C) Chuck Fleckenstein (cfleck@co.intel.com)&n; *&n; * Copyright (C) 1999 Silicon Graphics, Inc.&n; * Copyright (C) Vijay Chander(vijay@engr.sgi.com)&n; *&n; * 02/03/25 M. Domsch&t;GUID cleanups&n; *&n; * 02/01/04 J. Hall&t;Aligned MCA stack to 16 bytes, added platform vs. CPU&n; *&t;&t;&t;error flag, set SAL default return values, changed&n; *&t;&t;&t;error record structure to linked list, added init call&n; *&t;&t;&t;to sal_get_state_info_size().&n; *&n; * 01/01/03 F. Lewis    Added setup of CMCI and CPEI IRQs, logging of corrected&n; *                      platform errors, completed code for logging of&n; *                      corrected &amp; uncorrected machine check errors, and&n; *                      updated for conformance with Nov. 2000 revision of the&n; *                      SAL 3.0 spec.&n; * 00/03/29 C. Fleckenstein  Fixed PAL/SAL update issues, began MCA bug fixes, logging issues,&n; *                           added min save state dump, added INIT handler.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/irq.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/bootmem.h&gt;
macro_line|#include &lt;linux/acpi.h&gt;
macro_line|#include &lt;asm/machvec.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/sal.h&gt;
macro_line|#include &lt;asm/mca.h&gt;
macro_line|#include &lt;asm/irq.h&gt;
macro_line|#include &lt;asm/hw_irq.h&gt;
DECL|macro|MCA_PRT_XTRA_DATA
macro_line|#undef MCA_PRT_XTRA_DATA
DECL|struct|ia64_fptr
r_typedef
r_struct
id|ia64_fptr
(brace
DECL|member|fp
r_int
r_int
id|fp
suffix:semicolon
DECL|member|gp
r_int
r_int
id|gp
suffix:semicolon
DECL|typedef|ia64_fptr_t
)brace
id|ia64_fptr_t
suffix:semicolon
DECL|variable|ia64_mc_info
id|ia64_mc_info_t
id|ia64_mc_info
suffix:semicolon
DECL|variable|ia64_sal_to_os_handoff_state
id|ia64_mca_sal_to_os_state_t
id|ia64_sal_to_os_handoff_state
suffix:semicolon
DECL|variable|ia64_os_to_sal_handoff_state
id|ia64_mca_os_to_sal_state_t
id|ia64_os_to_sal_handoff_state
suffix:semicolon
DECL|variable|ia64_mca_proc_state_dump
id|u64
id|ia64_mca_proc_state_dump
(braket
l_int|512
)braket
suffix:semicolon
DECL|variable|ia64_mca_stack
id|u64
id|ia64_mca_stack
(braket
l_int|1024
)braket
id|__attribute__
c_func
(paren
(paren
id|aligned
c_func
(paren
l_int|16
)paren
)paren
)paren
suffix:semicolon
DECL|variable|ia64_mca_stackframe
id|u64
id|ia64_mca_stackframe
(braket
l_int|32
)braket
suffix:semicolon
DECL|variable|ia64_mca_bspstore
id|u64
id|ia64_mca_bspstore
(braket
l_int|1024
)braket
suffix:semicolon
DECL|variable|ia64_init_stack
id|u64
id|ia64_init_stack
(braket
id|KERNEL_STACK_SIZE
)braket
id|__attribute__
c_func
(paren
(paren
id|aligned
c_func
(paren
l_int|16
)paren
)paren
)paren
suffix:semicolon
DECL|variable|ia64_mca_sal_data_area
id|u64
id|ia64_mca_sal_data_area
(braket
l_int|1356
)braket
suffix:semicolon
DECL|variable|ia64_mca_min_state_save_info
id|u64
id|ia64_mca_min_state_save_info
suffix:semicolon
DECL|variable|ia64_tlb_functional
id|u64
id|ia64_tlb_functional
suffix:semicolon
DECL|variable|ia64_os_mca_recovery_successful
id|u64
id|ia64_os_mca_recovery_successful
suffix:semicolon
r_static
r_void
id|ia64_mca_wakeup_ipi_wait
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|ia64_mca_wakeup
c_func
(paren
r_int
id|cpu
)paren
suffix:semicolon
r_static
r_void
id|ia64_mca_wakeup_all
c_func
(paren
r_void
)paren
suffix:semicolon
r_static
r_void
id|ia64_log_init
c_func
(paren
r_int
)paren
suffix:semicolon
r_extern
r_void
id|ia64_monarch_init_handler
(paren
r_void
)paren
suffix:semicolon
r_extern
r_void
id|ia64_slave_init_handler
(paren
r_void
)paren
suffix:semicolon
r_extern
r_struct
id|hw_interrupt_type
id|irq_type_iosapic_level
suffix:semicolon
DECL|variable|cmci_irqaction
r_static
r_struct
id|irqaction
id|cmci_irqaction
op_assign
(brace
id|handler
suffix:colon
id|ia64_mca_cmc_int_handler
comma
id|flags
suffix:colon
id|SA_INTERRUPT
comma
id|name
suffix:colon
l_string|&quot;cmc_hndlr&quot;
)brace
suffix:semicolon
DECL|variable|mca_rdzv_irqaction
r_static
r_struct
id|irqaction
id|mca_rdzv_irqaction
op_assign
(brace
id|handler
suffix:colon
id|ia64_mca_rendez_int_handler
comma
id|flags
suffix:colon
id|SA_INTERRUPT
comma
id|name
suffix:colon
l_string|&quot;mca_rdzv&quot;
)brace
suffix:semicolon
DECL|variable|mca_wkup_irqaction
r_static
r_struct
id|irqaction
id|mca_wkup_irqaction
op_assign
(brace
id|handler
suffix:colon
id|ia64_mca_wakeup_int_handler
comma
id|flags
suffix:colon
id|SA_INTERRUPT
comma
id|name
suffix:colon
l_string|&quot;mca_wkup&quot;
)brace
suffix:semicolon
DECL|variable|mca_cpe_irqaction
r_static
r_struct
id|irqaction
id|mca_cpe_irqaction
op_assign
(brace
id|handler
suffix:colon
id|ia64_mca_cpe_int_handler
comma
id|flags
suffix:colon
id|SA_INTERRUPT
comma
id|name
suffix:colon
l_string|&quot;cpe_hndlr&quot;
)brace
suffix:semicolon
multiline_comment|/*&n; *  ia64_mca_log_sal_error_record&n; *&n; *  This function retrieves a specified error record type from SAL, sends it to&n; *  the system log, and notifies SALs to clear the record from its non-volatile&n; *  memory.&n; *&n; *  Inputs  :   sal_info_type   (Type of error record MCA/CMC/CPE/INIT)&n; *  Outputs :   platform error status&n; */
r_int
DECL|function|ia64_mca_log_sal_error_record
id|ia64_mca_log_sal_error_record
c_func
(paren
r_int
id|sal_info_type
)paren
(brace
r_int
id|platform_err
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Get the MCA error record */
r_if
c_cond
(paren
op_logical_neg
id|ia64_log_get
c_func
(paren
id|sal_info_type
comma
(paren
id|prfunc_t
)paren
id|printk
)paren
)paren
r_return
id|platform_err
suffix:semicolon
singleline_comment|// no record retrieved
multiline_comment|/* TODO:&n;&t; * 1. analyze error logs to determine recoverability&n;&t; * 2. perform error recovery procedures, if applicable&n;&t; * 3. set ia64_os_mca_recovery_successful flag, if applicable&n;&t; */
id|platform_err
op_assign
id|ia64_log_print
c_func
(paren
id|sal_info_type
comma
(paren
id|prfunc_t
)paren
id|printk
)paren
suffix:semicolon
id|ia64_sal_clear_state_info
c_func
(paren
id|sal_info_type
)paren
suffix:semicolon
r_return
id|platform_err
suffix:semicolon
)brace
multiline_comment|/*&n; * platform dependent error handling&n; */
macro_line|#ifndef PLATFORM_MCA_HANDLERS
r_void
DECL|function|mca_handler_platform
id|mca_handler_platform
(paren
r_void
)paren
(brace
)brace
r_void
DECL|function|ia64_mca_cpe_int_handler
id|ia64_mca_cpe_int_handler
(paren
r_int
id|cpe_irq
comma
r_void
op_star
id|arg
comma
r_struct
id|pt_regs
op_star
id|ptregs
)paren
(brace
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_cpe_int_handler: received interrupt. vector = %#x&bslash;n&quot;
comma
id|cpe_irq
)paren
suffix:semicolon
multiline_comment|/* Get the CMC error record and log it */
id|ia64_mca_log_sal_error_record
c_func
(paren
id|SAL_INFO_TYPE_CPE
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * This routine will be used to deal with platform specific handling&n; * of the init, i.e. drop into the kernel debugger on server machine,&n; * or if the processor is part of some parallel machine without a&n; * console, then we would call the appropriate debug hooks here.&n; */
r_void
DECL|function|init_handler_platform
id|init_handler_platform
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
multiline_comment|/* if a kernel debugger is available call it here else just dump the registers */
id|show_regs
c_func
(paren
id|regs
)paren
suffix:semicolon
multiline_comment|/* dump the state info */
r_while
c_loop
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* hang city if no debugger */
)brace
multiline_comment|/*&n; * ia64_mca_init_platform&n; *&n; *  External entry for platform specific MCA initialization.&n; *&n; *  Inputs&n; *      None&n; *&n; *  Outputs&n; *      None&n; */
r_void
DECL|function|ia64_mca_init_platform
id|ia64_mca_init_platform
(paren
r_void
)paren
(brace
)brace
multiline_comment|/*&n; *  ia64_mca_check_errors&n; *&n; *  External entry to check for error records which may have been posted by SAL&n; *  for a prior failure which resulted in a machine shutdown before an the&n; *  error could be logged.  This function must be called after the filesystem&n; *  is initialized.&n; *&n; *  Inputs  :   None&n; *&n; *  Outputs :   None&n; */
r_void
DECL|function|ia64_mca_check_errors
id|ia64_mca_check_errors
(paren
r_void
)paren
(brace
multiline_comment|/*&n;&t; *  If there is an MCA error record pending, get it and log it.&n;&t; */
id|ia64_mca_log_sal_error_record
c_func
(paren
id|SAL_INFO_TYPE_MCA
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_mca_register_cpev&n; *&n; *  Register the corrected platform error vector with SAL.&n; *&n; *  Inputs&n; *      cpev        Corrected Platform Error Vector number&n; *&n; *  Outputs&n; *      None&n; */
r_static
r_void
DECL|function|ia64_mca_register_cpev
id|ia64_mca_register_cpev
(paren
r_int
id|cpev
)paren
(brace
multiline_comment|/* Register the CPE interrupt vector with SAL */
r_if
c_cond
(paren
id|ia64_sal_mc_set_params
c_func
(paren
id|SAL_MC_PARAM_CPE_INT
comma
id|SAL_MC_PARAM_MECHANISM_INT
comma
id|cpev
comma
l_int|0
comma
l_int|0
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ia64_mca_platform_init: failed to register Corrected &quot;
l_string|&quot;Platform Error interrupt vector with SAL.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_platform_init: corrected platform error &quot;
l_string|&quot;vector %#x setup and enabled&bslash;n&quot;
comma
id|cpev
)paren
suffix:semicolon
)brace
macro_line|#endif /* PLATFORM_MCA_HANDLERS */
DECL|variable|min_state_labels
r_static
r_char
op_star
id|min_state_labels
(braket
)braket
op_assign
(brace
l_string|&quot;nat&quot;
comma
l_string|&quot;r1&quot;
comma
l_string|&quot;r2&quot;
comma
l_string|&quot;r3&quot;
comma
l_string|&quot;r4&quot;
comma
l_string|&quot;r5&quot;
comma
l_string|&quot;r6&quot;
comma
l_string|&quot;r7&quot;
comma
l_string|&quot;r8&quot;
comma
l_string|&quot;r9&quot;
comma
l_string|&quot;r10&quot;
comma
l_string|&quot;r11&quot;
comma
l_string|&quot;r12&quot;
comma
l_string|&quot;r13&quot;
comma
l_string|&quot;r14&quot;
comma
l_string|&quot;r15&quot;
comma
l_string|&quot;b0r16&quot;
comma
l_string|&quot;b0r17&quot;
comma
l_string|&quot;b0r18&quot;
comma
l_string|&quot;b0r19&quot;
comma
l_string|&quot;b0r20&quot;
comma
l_string|&quot;b0r21&quot;
comma
l_string|&quot;b0r22&quot;
comma
l_string|&quot;b0r23&quot;
comma
l_string|&quot;b0r24&quot;
comma
l_string|&quot;b0r25&quot;
comma
l_string|&quot;b0r26&quot;
comma
l_string|&quot;b0r27&quot;
comma
l_string|&quot;b0r28&quot;
comma
l_string|&quot;b0r29&quot;
comma
l_string|&quot;b0r30&quot;
comma
l_string|&quot;b0r31&quot;
comma
l_string|&quot;r16&quot;
comma
l_string|&quot;r17&quot;
comma
l_string|&quot;r18&quot;
comma
l_string|&quot;r19&quot;
comma
l_string|&quot;r20&quot;
comma
l_string|&quot;r21&quot;
comma
l_string|&quot;r22&quot;
comma
l_string|&quot;r23&quot;
comma
l_string|&quot;r24&quot;
comma
l_string|&quot;r25&quot;
comma
l_string|&quot;r26&quot;
comma
l_string|&quot;r27&quot;
comma
l_string|&quot;r28&quot;
comma
l_string|&quot;r29&quot;
comma
l_string|&quot;r30&quot;
comma
l_string|&quot;r31&quot;
comma
l_string|&quot;preds&quot;
comma
l_string|&quot;br0&quot;
comma
l_string|&quot;rsc&quot;
comma
l_string|&quot;iip&quot;
comma
l_string|&quot;ipsr&quot;
comma
l_string|&quot;ifs&quot;
comma
l_string|&quot;xip&quot;
comma
l_string|&quot;xpsr&quot;
comma
l_string|&quot;xfs&quot;
)brace
suffix:semicolon
DECL|variable|ia64_pmss_dump_bank0
r_int
id|ia64_pmss_dump_bank0
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* dump bank 0 ? */
multiline_comment|/*&n; * routine to process and prepare to dump min_state_save&n; * information for debugging purposes.&n; *&n; */
r_void
DECL|function|ia64_process_min_state_save
id|ia64_process_min_state_save
(paren
id|pal_min_state_area_t
op_star
id|pmss
comma
r_struct
id|pt_regs
op_star
id|ptregs
)paren
(brace
r_int
id|i
comma
id|max
op_assign
l_int|57
suffix:semicolon
id|u64
op_star
id|tpmss_ptr
op_assign
(paren
id|u64
op_star
)paren
id|pmss
suffix:semicolon
multiline_comment|/* dump out the min_state_area information */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|max
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ia64_pmss_dump_bank0
)paren
(brace
r_if
c_cond
(paren
id|strncmp
c_func
(paren
l_string|&quot;B0&quot;
comma
id|min_state_labels
(braket
id|i
)braket
comma
l_int|2
)paren
op_eq
l_int|0
)paren
(brace
id|tpmss_ptr
op_increment
suffix:semicolon
multiline_comment|/* skip to next entry */
r_continue
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;%5s=0x%16.16lx &quot;
comma
id|min_state_labels
(braket
id|i
)braket
comma
op_star
id|tpmss_ptr
op_increment
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
id|i
op_plus
l_int|1
)paren
op_mod
l_int|3
)paren
op_eq
l_int|0
op_logical_or
(paren
(paren
op_logical_neg
id|strcmp
c_func
(paren
l_string|&quot;GR16&quot;
comma
id|min_state_labels
(braket
id|i
)braket
)paren
)paren
op_logical_and
op_logical_neg
id|ia64_pmss_dump_bank0
)paren
)paren
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * ia64_mca_cmc_vector_setup&n; *&n; *  Setup the corrected machine check vector register in the processor and&n; *  unmask interrupt.  This function is invoked on a per-processor basis.&n; *&n; * Inputs&n; *      None&n; *&n; * Outputs&n; *&t;None&n; */
r_void
DECL|function|ia64_mca_cmc_vector_setup
id|ia64_mca_cmc_vector_setup
(paren
r_void
)paren
(brace
id|cmcv_reg_t
id|cmcv
suffix:semicolon
id|cmcv.cmcv_regval
op_assign
l_int|0
suffix:semicolon
id|cmcv.cmcv_mask
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Unmask/enable interrupt */
id|cmcv.cmcv_vector
op_assign
id|IA64_CMC_VECTOR
suffix:semicolon
id|ia64_set_cmcv
c_func
(paren
id|cmcv.cmcv_regval
)paren
suffix:semicolon
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_platform_init: CPU %d corrected &quot;
l_string|&quot;machine check vector %#x setup and enabled.&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|IA64_CMC_VECTOR
)paren
suffix:semicolon
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_platform_init: CPU %d CMCV = %#016lx&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|ia64_get_cmcv
c_func
(paren
)paren
)paren
suffix:semicolon
)brace
macro_line|#if defined(MCA_TEST)
DECL|variable|slpi_buf
id|sal_log_processor_info_t
id|slpi_buf
suffix:semicolon
r_void
DECL|function|mca_test
id|mca_test
c_func
(paren
r_void
)paren
(brace
id|slpi_buf.valid.psi_static_struct
op_assign
l_int|1
suffix:semicolon
id|slpi_buf.valid.num_cache_check
op_assign
l_int|1
suffix:semicolon
id|slpi_buf.valid.num_tlb_check
op_assign
l_int|1
suffix:semicolon
id|slpi_buf.valid.num_bus_check
op_assign
l_int|1
suffix:semicolon
id|slpi_buf.valid.processor_static_info.minstate
op_assign
l_int|1
suffix:semicolon
id|slpi_buf.valid.processor_static_info.br
op_assign
l_int|1
suffix:semicolon
id|slpi_buf.valid.processor_static_info.cr
op_assign
l_int|1
suffix:semicolon
id|slpi_buf.valid.processor_static_info.ar
op_assign
l_int|1
suffix:semicolon
id|slpi_buf.valid.processor_static_info.rr
op_assign
l_int|1
suffix:semicolon
id|slpi_buf.valid.processor_static_info.fr
op_assign
l_int|1
suffix:semicolon
id|ia64_os_mca_dispatch
c_func
(paren
)paren
suffix:semicolon
)brace
macro_line|#endif /* #if defined(MCA_TEST) */
multiline_comment|/*&n; *  verify_guid&n; *&n; *  Compares a test guid to a target guid and returns result.&n; *&n; *  Inputs&n; *      test_guid *     (ptr to guid to be verified)&n; *      target_guid *   (ptr to standard guid to be verified against)&n; *&n; *  Outputs&n; *      0               (test verifies against target)&n; *      non-zero        (test guid does not verify)&n; */
r_static
r_int
DECL|function|verify_guid
id|verify_guid
(paren
id|efi_guid_t
op_star
id|test
comma
id|efi_guid_t
op_star
id|target
)paren
(brace
r_int
id|rc
suffix:semicolon
macro_line|#ifdef IA64_MCA_DEBUG_INFO
r_char
id|out
(braket
l_int|40
)braket
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|efi_guidcmp
c_func
(paren
op_star
id|test
comma
op_star
id|target
)paren
)paren
)paren
(brace
id|IA64_MCA_DEBUG
c_func
(paren
id|KERN_DEBUG
l_string|&quot;verify_guid: invalid GUID = %s&bslash;n&quot;
comma
id|efi_guid_unparse
c_func
(paren
id|test
comma
id|out
)paren
)paren
suffix:semicolon
)brace
r_return
id|rc
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_mca_init&n; *&n; *  Do all the system level mca specific initialization.&n; *&n; *&t;1. Register spinloop and wakeup request interrupt vectors&n; *&n; *&t;2. Register OS_MCA handler entry point&n; *&n; *&t;3. Register OS_INIT handler entry point&n; *&n; *  4. Initialize MCA/CMC/INIT related log buffers maintained by the OS.&n; *&n; *  Note that this initialization is done very early before some kernel&n; *  services are available.&n; *&n; *  Inputs  :   None&n; *&n; *  Outputs :   None&n; */
r_void
id|__init
DECL|function|ia64_mca_init
id|ia64_mca_init
c_func
(paren
r_void
)paren
(brace
id|ia64_fptr_t
op_star
id|mon_init_ptr
op_assign
(paren
id|ia64_fptr_t
op_star
)paren
id|ia64_monarch_init_handler
suffix:semicolon
id|ia64_fptr_t
op_star
id|slave_init_ptr
op_assign
(paren
id|ia64_fptr_t
op_star
)paren
id|ia64_slave_init_handler
suffix:semicolon
id|ia64_fptr_t
op_star
id|mca_hldlr_ptr
op_assign
(paren
id|ia64_fptr_t
op_star
)paren
id|ia64_os_mca_dispatch
suffix:semicolon
r_int
id|i
suffix:semicolon
id|s64
id|rc
suffix:semicolon
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_init: begin&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* initialize recovery success indicator */
id|ia64_os_mca_recovery_successful
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Clear the Rendez checkin flag for all cpus */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ia64_mc_info.imi_rendez_checkin
(braket
id|i
)braket
op_assign
id|IA64_MCA_RENDEZ_CHECKIN_NOTDONE
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Register the rendezvous spinloop and wakeup mechanism with SAL&n;&t; */
multiline_comment|/* Register the rendezvous interrupt vector with SAL */
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|ia64_sal_mc_set_params
c_func
(paren
id|SAL_MC_PARAM_RENDEZ_INT
comma
id|SAL_MC_PARAM_MECHANISM_INT
comma
id|IA64_MCA_RENDEZ_VECTOR
comma
id|IA64_MCA_RENDEZ_TIMEOUT
comma
l_int|0
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ia64_mca_init: Failed to register rendezvous interrupt &quot;
l_string|&quot;with SAL.  rc = %ld&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Register the wakeup interrupt vector with SAL */
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|ia64_sal_mc_set_params
c_func
(paren
id|SAL_MC_PARAM_RENDEZ_WAKEUP
comma
id|SAL_MC_PARAM_MECHANISM_INT
comma
id|IA64_MCA_WAKEUP_VECTOR
comma
l_int|0
comma
l_int|0
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ia64_mca_init: Failed to register wakeup interrupt with SAL.  rc = %ld&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_init: registered mca rendezvous spinloop and wakeup mech.&bslash;n&quot;
)paren
suffix:semicolon
id|ia64_mc_info.imi_mca_handler
op_assign
id|__pa
c_func
(paren
id|mca_hldlr_ptr-&gt;fp
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * XXX - disable SAL checksum by setting size to 0; should be&n;&t; *&t;__pa(ia64_os_mca_dispatch_end) - __pa(ia64_os_mca_dispatch);&n;&t; */
id|ia64_mc_info.imi_mca_handler_size
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Register the os mca handler with SAL */
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|ia64_sal_set_vectors
c_func
(paren
id|SAL_VECTOR_OS_MCA
comma
id|ia64_mc_info.imi_mca_handler
comma
id|mca_hldlr_ptr-&gt;gp
comma
id|ia64_mc_info.imi_mca_handler_size
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ia64_mca_init: Failed to register os mca handler with SAL.  rc = %ld&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_init: registered os mca handler with SAL at 0x%lx, gp = 0x%lx&bslash;n&quot;
comma
id|ia64_mc_info.imi_mca_handler
comma
id|mca_hldlr_ptr-&gt;gp
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * XXX - disable SAL checksum by setting size to 0, should be&n;&t; * IA64_INIT_HANDLER_SIZE&n;&t; */
id|ia64_mc_info.imi_monarch_init_handler
op_assign
id|__pa
c_func
(paren
id|mon_init_ptr-&gt;fp
)paren
suffix:semicolon
id|ia64_mc_info.imi_monarch_init_handler_size
op_assign
l_int|0
suffix:semicolon
id|ia64_mc_info.imi_slave_init_handler
op_assign
id|__pa
c_func
(paren
id|slave_init_ptr-&gt;fp
)paren
suffix:semicolon
id|ia64_mc_info.imi_slave_init_handler_size
op_assign
l_int|0
suffix:semicolon
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_init: os init handler at %lx&bslash;n&quot;
comma
id|ia64_mc_info.imi_monarch_init_handler
)paren
suffix:semicolon
multiline_comment|/* Register the os init handler with SAL */
r_if
c_cond
(paren
(paren
id|rc
op_assign
id|ia64_sal_set_vectors
c_func
(paren
id|SAL_VECTOR_OS_INIT
comma
id|ia64_mc_info.imi_monarch_init_handler
comma
id|__pa
c_func
(paren
id|ia64_get_gp
c_func
(paren
)paren
)paren
comma
id|ia64_mc_info.imi_monarch_init_handler_size
comma
id|ia64_mc_info.imi_slave_init_handler
comma
id|__pa
c_func
(paren
id|ia64_get_gp
c_func
(paren
)paren
)paren
comma
id|ia64_mc_info.imi_slave_init_handler_size
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ia64_mca_init: Failed to register m/s init handlers with SAL. rc = %ld&bslash;n&quot;
comma
id|rc
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_init: registered os init handler with SAL&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Configure the CMCI vector and handler. Interrupts for CMC are&n;&t; *  per-processor, so AP CMC interrupts are setup in smp_callin() (smpboot.c).&n;&t; */
id|register_percpu_irq
c_func
(paren
id|IA64_CMC_VECTOR
comma
op_amp
id|cmci_irqaction
)paren
suffix:semicolon
id|ia64_mca_cmc_vector_setup
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Setup vector on BSP &amp; enable */
multiline_comment|/* Setup the MCA rendezvous interrupt vector */
id|register_percpu_irq
c_func
(paren
id|IA64_MCA_RENDEZ_VECTOR
comma
op_amp
id|mca_rdzv_irqaction
)paren
suffix:semicolon
multiline_comment|/* Setup the MCA wakeup interrupt vector */
id|register_percpu_irq
c_func
(paren
id|IA64_MCA_WAKEUP_VECTOR
comma
op_amp
id|mca_wkup_irqaction
)paren
suffix:semicolon
multiline_comment|/* Setup the CPE interrupt vector */
(brace
id|irq_desc_t
op_star
id|desc
suffix:semicolon
r_int
r_int
id|irq
suffix:semicolon
r_int
id|cpev
op_assign
id|acpi_request_vector
c_func
(paren
id|ACPI_INTERRUPT_CPEI
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpev
op_ge
l_int|0
)paren
(brace
r_for
c_loop
(paren
id|irq
op_assign
l_int|0
suffix:semicolon
id|irq
OL
id|NR_IRQS
suffix:semicolon
op_increment
id|irq
)paren
r_if
c_cond
(paren
id|irq_to_vector
c_func
(paren
id|irq
)paren
op_eq
id|cpev
)paren
(brace
id|desc
op_assign
id|irq_desc
c_func
(paren
id|irq
)paren
suffix:semicolon
id|desc-&gt;status
op_or_assign
id|IRQ_PER_CPU
suffix:semicolon
id|desc-&gt;handler
op_assign
op_amp
id|irq_type_iosapic_level
suffix:semicolon
id|setup_irq
c_func
(paren
id|irq
comma
op_amp
id|mca_cpe_irqaction
)paren
suffix:semicolon
)brace
id|ia64_mca_register_cpev
c_func
(paren
id|cpev
)paren
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
l_string|&quot;ia64_mca_init: Failed to get routed CPEI vector from ACPI.&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* Initialize the areas set aside by the OS to buffer the&n;&t; * platform/processor error states for MCA/INIT/CMC&n;&t; * handling.&n;&t; */
id|ia64_log_init
c_func
(paren
id|SAL_INFO_TYPE_MCA
)paren
suffix:semicolon
id|ia64_log_init
c_func
(paren
id|SAL_INFO_TYPE_INIT
)paren
suffix:semicolon
id|ia64_log_init
c_func
(paren
id|SAL_INFO_TYPE_CMC
)paren
suffix:semicolon
id|ia64_log_init
c_func
(paren
id|SAL_INFO_TYPE_CPE
)paren
suffix:semicolon
multiline_comment|/* Zero the min state save info */
id|ia64_mca_min_state_save_info
op_assign
l_int|0
suffix:semicolon
macro_line|#if defined(MCA_TEST)
id|mca_test
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif /* #if defined(MCA_TEST) */
id|printk
c_func
(paren
l_string|&quot;Mca related initialization done&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#if 0   
singleline_comment|// Too early in initialization -- error log is lost
multiline_comment|/* Do post-failure MCA error logging */
id|ia64_mca_check_errors
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif  
singleline_comment|// Too early in initialization -- error log is lost
)brace
multiline_comment|/*&n; * ia64_mca_wakeup_ipi_wait&n; *&n; *&t;Wait for the inter-cpu interrupt to be sent by the&n; *&t;monarch processor once it is done with handling the&n; *&t;MCA.&n; *&n; *  Inputs  :   None&n; *  Outputs :   None&n; */
r_void
DECL|function|ia64_mca_wakeup_ipi_wait
id|ia64_mca_wakeup_ipi_wait
c_func
(paren
r_void
)paren
(brace
r_int
id|irr_num
op_assign
(paren
id|IA64_MCA_WAKEUP_VECTOR
op_rshift
l_int|6
)paren
suffix:semicolon
r_int
id|irr_bit
op_assign
(paren
id|IA64_MCA_WAKEUP_VECTOR
op_amp
l_int|0x3f
)paren
suffix:semicolon
id|u64
id|irr
op_assign
l_int|0
suffix:semicolon
r_do
(brace
r_switch
c_cond
(paren
id|irr_num
)paren
(brace
r_case
l_int|0
suffix:colon
id|irr
op_assign
id|ia64_get_irr0
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|irr
op_assign
id|ia64_get_irr1
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|irr
op_assign
id|ia64_get_irr2
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|irr
op_assign
id|ia64_get_irr3
c_func
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|irr
op_amp
(paren
l_int|1
op_lshift
id|irr_bit
)paren
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_mca_wakeup&n; *&n; *&t;Send an inter-cpu interrupt to wake-up a particular cpu&n; *&t;and mark that cpu to be out of rendez.&n; *&n; *  Inputs  :   cpuid&n; *  Outputs :   None&n; */
r_void
DECL|function|ia64_mca_wakeup
id|ia64_mca_wakeup
c_func
(paren
r_int
id|cpu
)paren
(brace
id|platform_send_ipi
c_func
(paren
id|cpu
comma
id|IA64_MCA_WAKEUP_VECTOR
comma
id|IA64_IPI_DM_INT
comma
l_int|0
)paren
suffix:semicolon
id|ia64_mc_info.imi_rendez_checkin
(braket
id|cpu
)braket
op_assign
id|IA64_MCA_RENDEZ_CHECKIN_NOTDONE
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_mca_wakeup_all&n; *&n; *&t;Wakeup all the cpus which have rendez&squot;ed previously.&n; *&n; *  Inputs  :   None&n; *  Outputs :   None&n; */
r_void
DECL|function|ia64_mca_wakeup_all
id|ia64_mca_wakeup_all
c_func
(paren
r_void
)paren
(brace
r_int
id|cpu
suffix:semicolon
multiline_comment|/* Clear the Rendez checkin flag for all cpus */
r_for
c_loop
(paren
id|cpu
op_assign
l_int|0
suffix:semicolon
id|cpu
OL
id|smp_num_cpus
suffix:semicolon
id|cpu
op_increment
)paren
r_if
c_cond
(paren
id|ia64_mc_info.imi_rendez_checkin
(braket
id|cpu
)braket
op_eq
id|IA64_MCA_RENDEZ_CHECKIN_DONE
)paren
id|ia64_mca_wakeup
c_func
(paren
id|cpu
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_mca_rendez_interrupt_handler&n; *&n; *&t;This is handler used to put slave processors into spinloop&n; *&t;while the monarch processor does the mca handling and later&n; *&t;wake each slave up once the monarch is done.&n; *&n; *  Inputs  :   None&n; *  Outputs :   None&n; */
r_void
DECL|function|ia64_mca_rendez_int_handler
id|ia64_mca_rendez_int_handler
c_func
(paren
r_int
id|rendez_irq
comma
r_void
op_star
id|arg
comma
r_struct
id|pt_regs
op_star
id|ptregs
)paren
(brace
r_int
id|flags
comma
id|cpu
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Mask all interrupts */
id|save_and_cli
c_func
(paren
id|flags
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_SMP
id|cpu
op_assign
id|cpu_logical_id
c_func
(paren
id|hard_smp_processor_id
c_func
(paren
)paren
)paren
suffix:semicolon
macro_line|#endif
id|ia64_mc_info.imi_rendez_checkin
(braket
id|cpu
)braket
op_assign
id|IA64_MCA_RENDEZ_CHECKIN_DONE
suffix:semicolon
multiline_comment|/* Register with the SAL monarch that the slave has&n;&t; * reached SAL&n;&t; */
id|ia64_sal_mc_rendez
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Wait for the wakeup IPI from the monarch&n;&t; * This waiting is done by polling on the wakeup-interrupt&n;&t; * vector bit in the processor&squot;s IRRs&n;&t; */
id|ia64_mca_wakeup_ipi_wait
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Enable all interrupts */
id|restore_flags
c_func
(paren
id|flags
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_mca_wakeup_int_handler&n; *&n; *&t;The interrupt handler for processing the inter-cpu interrupt to the&n; *&t;slave cpu which was spinning in the rendez loop.&n; *&t;Since this spinning is done by turning off the interrupts and&n; *&t;polling on the wakeup-interrupt bit in the IRR, there is&n; *&t;nothing useful to be done in the handler.&n; *&n; *  Inputs  :   wakeup_irq  (Wakeup-interrupt bit)&n; *&t;arg&t;&t;(Interrupt handler specific argument)&n; *&t;ptregs&t;&t;(Exception frame at the time of the interrupt)&n; *  Outputs :   None&n; *&n; */
r_void
DECL|function|ia64_mca_wakeup_int_handler
id|ia64_mca_wakeup_int_handler
c_func
(paren
r_int
id|wakeup_irq
comma
r_void
op_star
id|arg
comma
r_struct
id|pt_regs
op_star
id|ptregs
)paren
(brace
)brace
multiline_comment|/*&n; * ia64_return_to_sal_check&n; *&n; *&t;This is function called before going back from the OS_MCA handler&n; *&t;to the OS_MCA dispatch code which finally takes the control back&n; *&t;to the SAL.&n; *&t;The main purpose of this routine is to setup the OS_MCA to SAL&n; *&t;return state which can be used by the OS_MCA dispatch code&n; *&t;just before going back to SAL.&n; *&n; *  Inputs  :   None&n; *  Outputs :   None&n; */
r_void
DECL|function|ia64_return_to_sal_check
id|ia64_return_to_sal_check
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Copy over some relevant stuff from the sal_to_os_mca_handoff&n;&t; * so that it can be used at the time of os_mca_to_sal_handoff&n;&t; */
id|ia64_os_to_sal_handoff_state.imots_sal_gp
op_assign
id|ia64_sal_to_os_handoff_state.imsto_sal_gp
suffix:semicolon
id|ia64_os_to_sal_handoff_state.imots_sal_check_ra
op_assign
id|ia64_sal_to_os_handoff_state.imsto_sal_check_ra
suffix:semicolon
multiline_comment|/* Cold Boot for uncorrectable MCA */
id|ia64_os_to_sal_handoff_state.imots_os_status
op_assign
id|IA64_MCA_COLD_BOOT
suffix:semicolon
multiline_comment|/* Default = tell SAL to return to same context */
id|ia64_os_to_sal_handoff_state.imots_context
op_assign
id|IA64_MCA_SAME_CONTEXT
suffix:semicolon
multiline_comment|/* Register pointer to new min state values */
multiline_comment|/* NOTE: need to do something with this during recovery phase */
id|ia64_os_to_sal_handoff_state.imots_new_min_state
op_assign
op_amp
id|ia64_mca_min_state_save_info
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_mca_ucmc_handler&n; *&n; *&t;This is uncorrectable machine check handler called from OS_MCA&n; *&t;dispatch code which is in turn called from SAL_CHECK().&n; *&t;This is the place where the core of OS MCA handling is done.&n; *&t;Right now the logs are extracted and displayed in a well-defined&n; *&t;format. This handler code is supposed to be run only on the&n; *&t;monarch processor. Once the monarch is done with MCA handling&n; *&t;further MCA logging is enabled by clearing logs.&n; *&t;Monarch also has the duty of sending wakeup-IPIs to pull the&n; *&t;slave processors out of rendezvous spinloop.&n; *&n; *  Inputs  :   None&n; *  Outputs :   None&n; */
r_void
DECL|function|ia64_mca_ucmc_handler
id|ia64_mca_ucmc_handler
c_func
(paren
r_void
)paren
(brace
r_int
id|platform_err
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Get the MCA error record and log it */
id|platform_err
op_assign
id|ia64_mca_log_sal_error_record
c_func
(paren
id|SAL_INFO_TYPE_MCA
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Do Platform-specific mca error handling if required.&n;&t; */
r_if
c_cond
(paren
id|platform_err
)paren
id|mca_handler_platform
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Wakeup all the processors which are spinning in the rendezvous&n;&t; *  loop.&n;&t; */
id|ia64_mca_wakeup_all
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Return to SAL */
id|ia64_return_to_sal_check
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_mca_cmc_int_handler&n; *&n; *  This is corrected machine check interrupt handler.&n; *&t;Right now the logs are extracted and displayed in a well-defined&n; *&t;format.&n; *&n; * Inputs&n; *      interrupt number&n; *      client data arg ptr&n; *      saved registers ptr&n; *&n; * Outputs&n; *&t;None&n; */
r_void
DECL|function|ia64_mca_cmc_int_handler
id|ia64_mca_cmc_int_handler
c_func
(paren
r_int
id|cmc_irq
comma
r_void
op_star
id|arg
comma
r_struct
id|pt_regs
op_star
id|ptregs
)paren
(brace
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_cmc_int_handler: received interrupt vector = %#x on CPU %d&bslash;n&quot;
comma
id|cmc_irq
comma
id|smp_processor_id
c_func
(paren
)paren
)paren
suffix:semicolon
multiline_comment|/* Get the CMC error record and log it */
id|ia64_mca_log_sal_error_record
c_func
(paren
id|SAL_INFO_TYPE_CMC
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * IA64_MCA log support&n; */
DECL|macro|IA64_MAX_LOGS
mdefine_line|#define IA64_MAX_LOGS&t;&t;2&t;/* Double-buffering for nested MCAs */
DECL|macro|IA64_MAX_LOG_TYPES
mdefine_line|#define IA64_MAX_LOG_TYPES      4   /* MCA, INIT, CMC, CPE */
DECL|struct|ia64_state_log_s
r_typedef
r_struct
id|ia64_state_log_s
(brace
DECL|member|isl_lock
id|spinlock_t
id|isl_lock
suffix:semicolon
DECL|member|isl_index
r_int
id|isl_index
suffix:semicolon
DECL|member|isl_log
id|ia64_err_rec_t
op_star
id|isl_log
(braket
id|IA64_MAX_LOGS
)braket
suffix:semicolon
multiline_comment|/* need space to store header + error log */
DECL|typedef|ia64_state_log_t
)brace
id|ia64_state_log_t
suffix:semicolon
DECL|variable|ia64_state_log
r_static
id|ia64_state_log_t
id|ia64_state_log
(braket
id|IA64_MAX_LOG_TYPES
)braket
suffix:semicolon
DECL|macro|IA64_LOG_ALLOCATE
mdefine_line|#define IA64_LOG_ALLOCATE(it, size) &bslash;&n;&t;{ia64_state_log[it].isl_log[IA64_LOG_CURR_INDEX(it)] = &bslash;&n;&t;&t;(ia64_err_rec_t *)alloc_bootmem(size); &bslash;&n;&t;ia64_state_log[it].isl_log[IA64_LOG_NEXT_INDEX(it)] = &bslash;&n;&t;&t;(ia64_err_rec_t *)alloc_bootmem(size);}
DECL|macro|IA64_LOG_LOCK_INIT
mdefine_line|#define IA64_LOG_LOCK_INIT(it) spin_lock_init(&amp;ia64_state_log[it].isl_lock)
DECL|macro|IA64_LOG_LOCK
mdefine_line|#define IA64_LOG_LOCK(it)      spin_lock_irqsave(&amp;ia64_state_log[it].isl_lock, s)
DECL|macro|IA64_LOG_UNLOCK
mdefine_line|#define IA64_LOG_UNLOCK(it)    spin_unlock_irqrestore(&amp;ia64_state_log[it].isl_lock,s)
DECL|macro|IA64_LOG_NEXT_INDEX
mdefine_line|#define IA64_LOG_NEXT_INDEX(it)    ia64_state_log[it].isl_index
DECL|macro|IA64_LOG_CURR_INDEX
mdefine_line|#define IA64_LOG_CURR_INDEX(it)    1 - ia64_state_log[it].isl_index
DECL|macro|IA64_LOG_INDEX_INC
mdefine_line|#define IA64_LOG_INDEX_INC(it) &bslash;&n;    ia64_state_log[it].isl_index = 1 - ia64_state_log[it].isl_index
DECL|macro|IA64_LOG_INDEX_DEC
mdefine_line|#define IA64_LOG_INDEX_DEC(it) &bslash;&n;    ia64_state_log[it].isl_index = 1 - ia64_state_log[it].isl_index
DECL|macro|IA64_LOG_NEXT_BUFFER
mdefine_line|#define IA64_LOG_NEXT_BUFFER(it)   (void *)((ia64_state_log[it].isl_log[IA64_LOG_NEXT_INDEX(it)]))
DECL|macro|IA64_LOG_CURR_BUFFER
mdefine_line|#define IA64_LOG_CURR_BUFFER(it)   (void *)((ia64_state_log[it].isl_log[IA64_LOG_CURR_INDEX(it)]))
multiline_comment|/*&n; * C portion of the OS INIT handler&n; *&n; * Called from ia64_monarch_init_handler&n; *&n; * Inputs: pointer to pt_regs where processor info was saved.&n; *&n; * Returns:&n; *   0 if SAL must warm boot the System&n; *   1 if SAL must return to interrupted context using PAL_MC_RESUME&n; *&n; */
r_void
DECL|function|ia64_init_handler
id|ia64_init_handler
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|sal_log_processor_info_t
op_star
id|proc_ptr
suffix:semicolon
id|ia64_err_rec_t
op_star
id|plog_ptr
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Entered OS INIT handler&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Get the INIT processor log */
r_if
c_cond
(paren
op_logical_neg
id|ia64_log_get
c_func
(paren
id|SAL_INFO_TYPE_INIT
comma
(paren
id|prfunc_t
)paren
id|printk
)paren
)paren
r_return
suffix:semicolon
singleline_comment|// no record retrieved
macro_line|#ifdef IA64_DUMP_ALL_PROC_INFO
id|ia64_log_print
c_func
(paren
id|SAL_INFO_TYPE_INIT
comma
(paren
id|prfunc_t
)paren
id|printk
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; * get pointer to min state save area&n;&t; *&n;&t; */
id|plog_ptr
op_assign
(paren
id|ia64_err_rec_t
op_star
)paren
id|IA64_LOG_CURR_BUFFER
c_func
(paren
id|SAL_INFO_TYPE_INIT
)paren
suffix:semicolon
id|proc_ptr
op_assign
op_amp
id|plog_ptr-&gt;proc_err
suffix:semicolon
id|ia64_process_min_state_save
c_func
(paren
op_amp
id|proc_ptr-&gt;processor_static_info.min_state_area
comma
id|regs
)paren
suffix:semicolon
multiline_comment|/* Clear the INIT SAL logs now that they have been saved in the OS buffer */
id|ia64_sal_clear_state_info
c_func
(paren
id|SAL_INFO_TYPE_INIT
)paren
suffix:semicolon
id|init_handler_platform
c_func
(paren
id|regs
)paren
suffix:semicolon
multiline_comment|/* call platform specific routines */
)brace
multiline_comment|/*&n; *  ia64_log_prt_guid&n; *&n; *  Print a formatted GUID.&n; *&n; * Inputs   :   p_guid      (ptr to the GUID)&n; *              prfunc      (print function)&n; * Outputs  :   None&n; *&n; */
r_void
DECL|function|ia64_log_prt_guid
id|ia64_log_prt_guid
(paren
id|efi_guid_t
op_star
id|p_guid
comma
id|prfunc_t
id|prfunc
)paren
(brace
r_char
id|out
(braket
l_int|40
)braket
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;GUID = %s&bslash;n&quot;
comma
id|efi_guid_unparse
c_func
(paren
id|p_guid
comma
id|out
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|ia64_log_hexdump
id|ia64_log_hexdump
c_func
(paren
r_int
r_char
op_star
id|p
comma
r_int
r_int
id|n_ch
comma
id|prfunc_t
id|prfunc
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|n_ch
suffix:semicolon
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot;%p &quot;
comma
(paren
r_void
op_star
)paren
id|p
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
(paren
id|j
OL
l_int|16
)paren
op_logical_and
(paren
id|i
OL
id|n_ch
)paren
suffix:semicolon
id|i
op_increment
comma
id|j
op_increment
comma
id|p
op_increment
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot;%02x &quot;
comma
op_star
id|p
)paren
suffix:semicolon
)brace
id|prfunc
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
macro_line|#ifdef MCA_PRT_XTRA_DATA    
singleline_comment|// for test only @FVL
r_static
r_void
DECL|function|ia64_log_prt_record_header
id|ia64_log_prt_record_header
(paren
id|sal_log_record_header_t
op_star
id|rh
comma
id|prfunc_t
id|prfunc
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot;SAL RECORD HEADER:  Record buffer = %p,  header size = %ld&bslash;n&quot;
comma
(paren
r_void
op_star
)paren
id|rh
comma
r_sizeof
(paren
id|sal_log_record_header_t
)paren
)paren
suffix:semicolon
id|ia64_log_hexdump
c_func
(paren
(paren
r_int
r_char
op_star
)paren
id|rh
comma
r_sizeof
(paren
id|sal_log_record_header_t
)paren
comma
(paren
id|prfunc_t
)paren
id|prfunc
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;Total record length = %d&bslash;n&quot;
comma
id|rh-&gt;len
)paren
suffix:semicolon
id|ia64_log_prt_guid
c_func
(paren
op_amp
id|rh-&gt;platform_guid
comma
id|prfunc
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;End of SAL RECORD HEADER&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|ia64_log_prt_section_header
id|ia64_log_prt_section_header
(paren
id|sal_log_section_hdr_t
op_star
id|sh
comma
id|prfunc_t
id|prfunc
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot;SAL SECTION HEADER:  Record buffer = %p,  header size = %ld&bslash;n&quot;
comma
(paren
r_void
op_star
)paren
id|sh
comma
r_sizeof
(paren
id|sal_log_section_hdr_t
)paren
)paren
suffix:semicolon
id|ia64_log_hexdump
c_func
(paren
(paren
r_int
r_char
op_star
)paren
id|sh
comma
r_sizeof
(paren
id|sal_log_section_hdr_t
)paren
comma
(paren
id|prfunc_t
)paren
id|prfunc
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;Length of section &amp; header = %d&bslash;n&quot;
comma
id|sh-&gt;len
)paren
suffix:semicolon
id|ia64_log_prt_guid
c_func
(paren
op_amp
id|sh-&gt;guid
comma
id|prfunc
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;End of SAL SECTION HEADER&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif  
singleline_comment|// MCA_PRT_XTRA_DATA for test only @FVL
multiline_comment|/*&n; * ia64_log_init&n; *&t;Reset the OS ia64 log buffer&n; * Inputs   :   info_type   (SAL_INFO_TYPE_{MCA,INIT,CMC,CPE})&n; * Outputs&t;:&t;None&n; */
r_void
DECL|function|ia64_log_init
id|ia64_log_init
c_func
(paren
r_int
id|sal_info_type
)paren
(brace
id|u64
id|max_size
op_assign
l_int|0
suffix:semicolon
id|IA64_LOG_NEXT_INDEX
c_func
(paren
id|sal_info_type
)paren
op_assign
l_int|0
suffix:semicolon
id|IA64_LOG_LOCK_INIT
c_func
(paren
id|sal_info_type
)paren
suffix:semicolon
singleline_comment|// SAL will tell us the maximum size of any error record of this type
id|max_size
op_assign
id|ia64_sal_get_state_info_size
c_func
(paren
id|sal_info_type
)paren
suffix:semicolon
singleline_comment|// set up OS data structures to hold error info
id|IA64_LOG_ALLOCATE
c_func
(paren
id|sal_info_type
comma
id|max_size
)paren
suffix:semicolon
id|memset
c_func
(paren
id|IA64_LOG_CURR_BUFFER
c_func
(paren
id|sal_info_type
)paren
comma
l_int|0
comma
id|max_size
)paren
suffix:semicolon
id|memset
c_func
(paren
id|IA64_LOG_NEXT_BUFFER
c_func
(paren
id|sal_info_type
)paren
comma
l_int|0
comma
id|max_size
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_log_get&n; *&n; *&t;Get the current MCA log from SAL and copy it into the OS log buffer.&n; *&n; *  Inputs  :   info_type   (SAL_INFO_TYPE_{MCA,INIT,CMC,CPE})&n; *              prfunc      (fn ptr of log output function)&n; *  Outputs :   size        (total record length)&n; *&n; */
id|u64
DECL|function|ia64_log_get
id|ia64_log_get
c_func
(paren
r_int
id|sal_info_type
comma
id|prfunc_t
id|prfunc
)paren
(brace
id|sal_log_record_header_t
op_star
id|log_buffer
suffix:semicolon
id|u64
id|total_len
op_assign
l_int|0
suffix:semicolon
r_int
id|s
suffix:semicolon
id|IA64_LOG_LOCK
c_func
(paren
id|sal_info_type
)paren
suffix:semicolon
multiline_comment|/* Get the process state information */
id|log_buffer
op_assign
id|IA64_LOG_NEXT_BUFFER
c_func
(paren
id|sal_info_type
)paren
suffix:semicolon
id|total_len
op_assign
id|ia64_sal_get_state_info
c_func
(paren
id|sal_info_type
comma
(paren
id|u64
op_star
)paren
id|log_buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|total_len
)paren
(brace
id|IA64_LOG_INDEX_INC
c_func
(paren
id|sal_info_type
)paren
suffix:semicolon
id|IA64_LOG_UNLOCK
c_func
(paren
id|sal_info_type
)paren
suffix:semicolon
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_log_get: SAL error record type %d retrieved. &quot;
l_string|&quot;Record length = %ld&bslash;n&quot;
comma
id|sal_info_type
comma
id|total_len
)paren
suffix:semicolon
r_return
id|total_len
suffix:semicolon
)brace
r_else
(brace
id|IA64_LOG_UNLOCK
c_func
(paren
id|sal_info_type
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;ia64_log_get: No SAL error record available for type %d&bslash;n&quot;
comma
id|sal_info_type
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *  ia64_log_prt_oem_data&n; *&n; *  Print OEM specific data if included.&n; *&n; * Inputs   :   header_len  (length passed in section header)&n; *              sect_len    (default length of section type)&n; *              p_data      (ptr to data)&n; *&t;&t;&t;prfunc&t;&t;(print function)&n; * Outputs&t;:&t;None&n; *&n; */
r_void
DECL|function|ia64_log_prt_oem_data
id|ia64_log_prt_oem_data
(paren
r_int
id|header_len
comma
r_int
id|sect_len
comma
id|u8
op_star
id|p_data
comma
id|prfunc_t
id|prfunc
)paren
(brace
r_int
id|oem_data_len
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
id|oem_data_len
op_assign
id|header_len
op_minus
id|sect_len
)paren
OG
l_int|0
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot; OEM Specific Data:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|oem_data_len
suffix:semicolon
id|i
op_increment
comma
id|p_data
op_increment
)paren
id|prfunc
c_func
(paren
l_string|&quot; %02x&quot;
comma
op_star
id|p_data
)paren
suffix:semicolon
)brace
id|prfunc
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  ia64_log_rec_header_print&n; *&n; *  Log info from the SAL error record header.&n; *&n; *  Inputs  :   lh *    (ptr to SAL log error record header)&n; *              prfunc  (fn ptr of log output function to use)&n; *  Outputs :   None&n; */
r_void
DECL|function|ia64_log_rec_header_print
id|ia64_log_rec_header_print
(paren
id|sal_log_record_header_t
op_star
id|lh
comma
id|prfunc_t
id|prfunc
)paren
(brace
r_char
id|str_buf
(braket
l_int|32
)braket
suffix:semicolon
id|sprintf
c_func
(paren
id|str_buf
comma
l_string|&quot;%2d.%02d&quot;
comma
(paren
id|lh-&gt;revision.major
op_rshift
l_int|4
)paren
op_star
l_int|10
op_plus
(paren
id|lh-&gt;revision.major
op_amp
l_int|0xf
)paren
comma
(paren
id|lh-&gt;revision.minor
op_rshift
l_int|4
)paren
op_star
l_int|10
op_plus
(paren
id|lh-&gt;revision.minor
op_amp
l_int|0xf
)paren
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+Err Record ID: %d    SAL Rev: %s&bslash;n&quot;
comma
id|lh-&gt;id
comma
id|str_buf
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|str_buf
comma
l_string|&quot;%02d/%02d/%04d/ %02d:%02d:%02d&quot;
comma
(paren
id|lh-&gt;timestamp.slh_month
op_rshift
l_int|4
)paren
op_star
l_int|10
op_plus
(paren
id|lh-&gt;timestamp.slh_month
op_amp
l_int|0xf
)paren
comma
(paren
id|lh-&gt;timestamp.slh_day
op_rshift
l_int|4
)paren
op_star
l_int|10
op_plus
(paren
id|lh-&gt;timestamp.slh_day
op_amp
l_int|0xf
)paren
comma
(paren
id|lh-&gt;timestamp.slh_century
op_rshift
l_int|4
)paren
op_star
l_int|1000
op_plus
(paren
id|lh-&gt;timestamp.slh_century
op_amp
l_int|0xf
)paren
op_star
l_int|100
op_plus
(paren
id|lh-&gt;timestamp.slh_year
op_rshift
l_int|4
)paren
op_star
l_int|10
op_plus
(paren
id|lh-&gt;timestamp.slh_year
op_amp
l_int|0xf
)paren
comma
(paren
id|lh-&gt;timestamp.slh_hour
op_rshift
l_int|4
)paren
op_star
l_int|10
op_plus
(paren
id|lh-&gt;timestamp.slh_hour
op_amp
l_int|0xf
)paren
comma
(paren
id|lh-&gt;timestamp.slh_minute
op_rshift
l_int|4
)paren
op_star
l_int|10
op_plus
(paren
id|lh-&gt;timestamp.slh_minute
op_amp
l_int|0xf
)paren
comma
(paren
id|lh-&gt;timestamp.slh_second
op_rshift
l_int|4
)paren
op_star
l_int|10
op_plus
(paren
id|lh-&gt;timestamp.slh_second
op_amp
l_int|0xf
)paren
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+Time: %s    Severity %d&bslash;n&quot;
comma
id|str_buf
comma
id|lh-&gt;severity
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_log_processor_regs_print&n; *&t;Print the contents of the saved processor register(s) in the format&n; *&t;&t;&lt;reg_prefix&gt;[&lt;index&gt;] &lt;value&gt;&n; *&n; * Inputs&t;:&t;regs&t;&t;(Register save buffer)&n; *&t;&t;&t;reg_num&t;(# of registers)&n; *&t;&t;&t;reg_class&t;(application/banked/control/bank1_general)&n; *&t;&t;&t;reg_prefix&t;(ar/br/cr/b1_gr)&n; * Outputs&t;:&t;None&n; *&n; */
r_void
DECL|function|ia64_log_processor_regs_print
id|ia64_log_processor_regs_print
c_func
(paren
id|u64
op_star
id|regs
comma
r_int
id|reg_num
comma
r_char
op_star
id|reg_class
comma
r_char
op_star
id|reg_prefix
comma
id|prfunc_t
id|prfunc
)paren
(brace
r_int
id|i
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+%s Registers&bslash;n&quot;
comma
id|reg_class
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|reg_num
suffix:semicolon
id|i
op_increment
)paren
id|prfunc
c_func
(paren
l_string|&quot;+ %s[%d] 0x%lx&bslash;n&quot;
comma
id|reg_prefix
comma
id|i
comma
id|regs
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_log_processor_fp_regs_print&n; *  Print the contents of the saved floating page register(s) in the format&n; *      &lt;reg_prefix&gt;[&lt;index&gt;] &lt;value&gt;&n; *&n; * Inputs:  ia64_fpreg  (Register save buffer)&n; *          reg_num     (# of registers)&n; *          reg_class   (application/banked/control/bank1_general)&n; *          reg_prefix  (ar/br/cr/b1_gr)&n; * Outputs: None&n; *&n; */
r_void
DECL|function|ia64_log_processor_fp_regs_print
id|ia64_log_processor_fp_regs_print
(paren
r_struct
id|ia64_fpreg
op_star
id|regs
comma
r_int
id|reg_num
comma
r_char
op_star
id|reg_class
comma
r_char
op_star
id|reg_prefix
comma
id|prfunc_t
id|prfunc
)paren
(brace
r_int
id|i
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+%s Registers&bslash;n&quot;
comma
id|reg_class
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|reg_num
suffix:semicolon
id|i
op_increment
)paren
id|prfunc
c_func
(paren
l_string|&quot;+ %s[%d] 0x%lx%016lx&bslash;n&quot;
comma
id|reg_prefix
comma
id|i
comma
id|regs
(braket
id|i
)braket
dot
id|u.bits
(braket
l_int|1
)braket
comma
id|regs
(braket
id|i
)braket
dot
id|u.bits
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
DECL|variable|pal_mesi_state
r_static
r_char
op_star
id|pal_mesi_state
(braket
)braket
op_assign
(brace
l_string|&quot;Invalid&quot;
comma
l_string|&quot;Shared&quot;
comma
l_string|&quot;Exclusive&quot;
comma
l_string|&quot;Modified&quot;
comma
l_string|&quot;Reserved1&quot;
comma
l_string|&quot;Reserved2&quot;
comma
l_string|&quot;Reserved3&quot;
comma
l_string|&quot;Reserved4&quot;
)brace
suffix:semicolon
DECL|variable|pal_cache_op
r_static
r_char
op_star
id|pal_cache_op
(braket
)braket
op_assign
(brace
l_string|&quot;Unknown&quot;
comma
l_string|&quot;Move in&quot;
comma
l_string|&quot;Cast out&quot;
comma
l_string|&quot;Coherency check&quot;
comma
l_string|&quot;Internal&quot;
comma
l_string|&quot;Instruction fetch&quot;
comma
l_string|&quot;Implicit Writeback&quot;
comma
l_string|&quot;Reserved&quot;
)brace
suffix:semicolon
multiline_comment|/*&n; * ia64_log_cache_check_info_print&n; *&t;Display the machine check information related to cache error(s).&n; * Inputs:  i           (Multiple errors are logged, i - index of logged error)&n; *          cc_info *   (Ptr to cache check info logged by the PAL and later&n; *&t;&t;&t;&t;&t; captured by the SAL)&n; *          prfunc      (fn ptr of print function to be used for output)&n; * Outputs: None&n; */
r_void
DECL|function|ia64_log_cache_check_info_print
id|ia64_log_cache_check_info_print
(paren
r_int
id|i
comma
id|sal_log_mod_error_info_t
op_star
id|cache_check_info
comma
id|prfunc_t
id|prfunc
)paren
(brace
id|pal_cache_check_info_t
op_star
id|info
suffix:semicolon
id|u64
id|target_addr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cache_check_info-&gt;valid.check_info
)paren
(brace
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_log_print: invalid cache_check_info[%d]&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_return
suffix:semicolon
multiline_comment|/* If check info data not valid, skip it */
)brace
id|info
op_assign
(paren
id|pal_cache_check_info_t
op_star
)paren
op_amp
id|cache_check_info-&gt;check_info
suffix:semicolon
id|target_addr
op_assign
id|cache_check_info-&gt;target_identifier
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+ Cache check info[%d]&bslash;n+&quot;
comma
id|i
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;  Level: L%d,&quot;
comma
id|info-&gt;level
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;mv
)paren
id|prfunc
c_func
(paren
l_string|&quot; Mesi: %s,&quot;
comma
id|pal_mesi_state
(braket
id|info-&gt;mesi
)braket
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot; Index: %d,&quot;
comma
id|info-&gt;index
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;ic
)paren
id|prfunc
c_func
(paren
l_string|&quot; Cache: Instruction,&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;dc
)paren
id|prfunc
c_func
(paren
l_string|&quot; Cache: Data,&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;tl
)paren
id|prfunc
c_func
(paren
l_string|&quot; Line: Tag,&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;dl
)paren
id|prfunc
c_func
(paren
l_string|&quot; Line: Data,&quot;
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot; Operation: %s,&quot;
comma
id|pal_cache_op
(braket
id|info-&gt;op
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;wv
)paren
id|prfunc
c_func
(paren
l_string|&quot; Way: %d,&quot;
comma
id|info-&gt;way
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cache_check_info-&gt;valid.target_identifier
)paren
multiline_comment|/* Hope target address is saved in target_identifier */
r_if
c_cond
(paren
id|info-&gt;tv
)paren
id|prfunc
c_func
(paren
l_string|&quot; Target Addr: 0x%lx,&quot;
comma
id|target_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;mc
)paren
id|prfunc
c_func
(paren
l_string|&quot; MC: Corrected&quot;
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_log_tlb_check_info_print&n; *&t;Display the machine check information related to tlb error(s).&n; * Inputs:  i           (Multiple errors are logged, i - index of logged error)&n; *          tlb_info *  (Ptr to machine check info logged by the PAL and later&n; *&t;&t;&t;&t;&t; captured by the SAL)&n; *          prfunc      (fn ptr of print function to be used for output)&n; * Outputs: None&n; */
r_void
DECL|function|ia64_log_tlb_check_info_print
id|ia64_log_tlb_check_info_print
(paren
r_int
id|i
comma
id|sal_log_mod_error_info_t
op_star
id|tlb_check_info
comma
id|prfunc_t
id|prfunc
)paren
(brace
id|pal_tlb_check_info_t
op_star
id|info
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tlb_check_info-&gt;valid.check_info
)paren
(brace
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_log_print: invalid tlb_check_info[%d]&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_return
suffix:semicolon
multiline_comment|/* If check info data not valid, skip it */
)brace
id|info
op_assign
(paren
id|pal_tlb_check_info_t
op_star
)paren
op_amp
id|tlb_check_info-&gt;check_info
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+ TLB Check Info [%d]&bslash;n+&quot;
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;itc
)paren
id|prfunc
c_func
(paren
l_string|&quot;  Failure: Instruction Translation Cache&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;dtc
)paren
id|prfunc
c_func
(paren
l_string|&quot;  Failure: Data Translation Cache&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;itr
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot;  Failure: Instruction Translation Register&quot;
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot; ,Slot: %d&quot;
comma
id|info-&gt;tr_slot
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info-&gt;dtr
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot;  Failure: Data Translation Register&quot;
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot; ,Slot: %d&quot;
comma
id|info-&gt;tr_slot
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|info-&gt;mc
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,MC: Corrected&quot;
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_log_bus_check_info_print&n; *&t;Display the machine check information related to bus error(s).&n; * Inputs:  i           (Multiple errors are logged, i - index of logged error)&n; *          bus_info *  (Ptr to machine check info logged by the PAL and later&n; *&t;&t;&t;&t;&t; captured by the SAL)&n; *          prfunc      (fn ptr of print function to be used for output)&n; * Outputs: None&n; */
r_void
DECL|function|ia64_log_bus_check_info_print
id|ia64_log_bus_check_info_print
(paren
r_int
id|i
comma
id|sal_log_mod_error_info_t
op_star
id|bus_check_info
comma
id|prfunc_t
id|prfunc
)paren
(brace
id|pal_bus_check_info_t
op_star
id|info
suffix:semicolon
id|u64
id|req_addr
suffix:semicolon
multiline_comment|/* Address of the requestor of the transaction */
id|u64
id|resp_addr
suffix:semicolon
multiline_comment|/* Address of the responder of the transaction */
id|u64
id|targ_addr
suffix:semicolon
multiline_comment|/* Address where the data was to be delivered to */
multiline_comment|/* or obtained from */
r_if
c_cond
(paren
op_logical_neg
id|bus_check_info-&gt;valid.check_info
)paren
(brace
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_log_print: invalid bus_check_info[%d]&bslash;n&quot;
comma
id|i
)paren
suffix:semicolon
r_return
suffix:semicolon
multiline_comment|/* If check info data not valid, skip it */
)brace
id|info
op_assign
(paren
id|pal_bus_check_info_t
op_star
)paren
op_amp
id|bus_check_info-&gt;check_info
suffix:semicolon
id|req_addr
op_assign
id|bus_check_info-&gt;requestor_identifier
suffix:semicolon
id|resp_addr
op_assign
id|bus_check_info-&gt;responder_identifier
suffix:semicolon
id|targ_addr
op_assign
id|bus_check_info-&gt;target_identifier
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+ BUS Check Info [%d]&bslash;n+&quot;
comma
id|i
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot; Status Info: %d&quot;
comma
id|info-&gt;bsi
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot; ,Severity: %d&quot;
comma
id|info-&gt;sev
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot; ,Transaction Type: %d&quot;
comma
id|info-&gt;type
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot; ,Transaction Size: %d&quot;
comma
id|info-&gt;size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;cc
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Cache-cache-transfer&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;ib
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Error: Internal&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;eb
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Error: External&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;mc
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,MC: Corrected&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;tv
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Target Address: 0x%lx&quot;
comma
id|targ_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;rq
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Requestor Address: 0x%lx&quot;
comma
id|req_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;tv
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Responder Address: 0x%lx&quot;
comma
id|resp_addr
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  ia64_log_mem_dev_err_info_print&n; *&n; *  Format and log the platform memory device error record section data.&n; *&n; *  Inputs:  mem_dev_err_info * (Ptr to memory device error record section&n; *                               returned by SAL)&n; *           prfunc             (fn ptr of print function to be used for output)&n; *  Outputs: None&n; */
r_void
DECL|function|ia64_log_mem_dev_err_info_print
id|ia64_log_mem_dev_err_info_print
(paren
id|sal_log_mem_dev_err_info_t
op_star
id|mdei
comma
id|prfunc_t
id|prfunc
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot;+ Mem Error Detail: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mdei-&gt;valid.error_status
)paren
id|prfunc
c_func
(paren
l_string|&quot; Error Status: %#lx,&quot;
comma
id|mdei-&gt;error_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mdei-&gt;valid.physical_addr
)paren
id|prfunc
c_func
(paren
l_string|&quot; Physical Address: %#lx,&quot;
comma
id|mdei-&gt;physical_addr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mdei-&gt;valid.addr_mask
)paren
id|prfunc
c_func
(paren
l_string|&quot; Address Mask: %#lx,&quot;
comma
id|mdei-&gt;addr_mask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mdei-&gt;valid.node
)paren
id|prfunc
c_func
(paren
l_string|&quot; Node: %d,&quot;
comma
id|mdei-&gt;node
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mdei-&gt;valid.card
)paren
id|prfunc
c_func
(paren
l_string|&quot; Card: %d,&quot;
comma
id|mdei-&gt;card
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mdei-&gt;valid.module
)paren
id|prfunc
c_func
(paren
l_string|&quot; Module: %d,&quot;
comma
id|mdei-&gt;module
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mdei-&gt;valid.bank
)paren
id|prfunc
c_func
(paren
l_string|&quot; Bank: %d,&quot;
comma
id|mdei-&gt;bank
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mdei-&gt;valid.device
)paren
id|prfunc
c_func
(paren
l_string|&quot; Device: %d,&quot;
comma
id|mdei-&gt;device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mdei-&gt;valid.row
)paren
id|prfunc
c_func
(paren
l_string|&quot; Row: %d,&quot;
comma
id|mdei-&gt;row
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mdei-&gt;valid.column
)paren
id|prfunc
c_func
(paren
l_string|&quot; Column: %d,&quot;
comma
id|mdei-&gt;column
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mdei-&gt;valid.bit_position
)paren
id|prfunc
c_func
(paren
l_string|&quot; Bit Position: %d,&quot;
comma
id|mdei-&gt;bit_position
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mdei-&gt;valid.target_id
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Target Address: %#lx,&quot;
comma
id|mdei-&gt;target_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mdei-&gt;valid.requestor_id
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Requestor Address: %#lx,&quot;
comma
id|mdei-&gt;requestor_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mdei-&gt;valid.responder_id
)paren
id|prfunc
c_func
(paren
l_string|&quot; ,Responder Address: %#lx,&quot;
comma
id|mdei-&gt;responder_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mdei-&gt;valid.bus_spec_data
)paren
id|prfunc
c_func
(paren
l_string|&quot; Bus Specific Data: %#lx,&quot;
comma
id|mdei-&gt;bus_spec_data
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mdei-&gt;valid.oem_id
)paren
(brace
id|u8
op_star
id|p_data
op_assign
op_amp
(paren
id|mdei-&gt;oem_id
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot; OEM Memory Controller ID:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
comma
id|p_data
op_increment
)paren
id|prfunc
c_func
(paren
l_string|&quot; %02x&quot;
comma
op_star
id|p_data
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|mdei-&gt;valid.oem_data
)paren
(brace
id|platform_mem_dev_err_print
c_func
(paren
(paren
r_int
)paren
id|mdei-&gt;header.len
comma
(paren
r_int
)paren
r_sizeof
(paren
id|sal_log_mem_dev_err_info_t
)paren
op_minus
l_int|1
comma
op_amp
(paren
id|mdei-&gt;oem_data
(braket
l_int|0
)braket
)paren
comma
id|prfunc
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *  ia64_log_sel_dev_err_info_print&n; *&n; *  Format and log the platform SEL device error record section data.&n; *&n; *  Inputs:  sel_dev_err_info * (Ptr to the SEL device error record section&n; *                               returned by SAL)&n; *           prfunc             (fn ptr of print function to be used for output)&n; *  Outputs: None&n; */
r_void
DECL|function|ia64_log_sel_dev_err_info_print
id|ia64_log_sel_dev_err_info_print
(paren
id|sal_log_sel_dev_err_info_t
op_star
id|sdei
comma
id|prfunc_t
id|prfunc
)paren
(brace
r_int
id|i
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+ SEL Device Error Detail: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sdei-&gt;valid.record_id
)paren
id|prfunc
c_func
(paren
l_string|&quot; Record ID: %#x&quot;
comma
id|sdei-&gt;record_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sdei-&gt;valid.record_type
)paren
id|prfunc
c_func
(paren
l_string|&quot; Record Type: %#x&quot;
comma
id|sdei-&gt;record_type
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot; Time Stamp: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
id|prfunc
c_func
(paren
l_string|&quot;%1d&quot;
comma
id|sdei-&gt;timestamp
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sdei-&gt;valid.generator_id
)paren
id|prfunc
c_func
(paren
l_string|&quot; Generator ID: %#x&quot;
comma
id|sdei-&gt;generator_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sdei-&gt;valid.evm_rev
)paren
id|prfunc
c_func
(paren
l_string|&quot; Message Format Version: %#x&quot;
comma
id|sdei-&gt;evm_rev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sdei-&gt;valid.sensor_type
)paren
id|prfunc
c_func
(paren
l_string|&quot; Sensor Type: %#x&quot;
comma
id|sdei-&gt;sensor_type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sdei-&gt;valid.sensor_num
)paren
id|prfunc
c_func
(paren
l_string|&quot; Sensor Number: %#x&quot;
comma
id|sdei-&gt;sensor_num
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sdei-&gt;valid.event_dir
)paren
id|prfunc
c_func
(paren
l_string|&quot; Event Direction Type: %#x&quot;
comma
id|sdei-&gt;event_dir
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sdei-&gt;valid.event_data1
)paren
id|prfunc
c_func
(paren
l_string|&quot; Data1: %#x&quot;
comma
id|sdei-&gt;event_data1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sdei-&gt;valid.event_data2
)paren
id|prfunc
c_func
(paren
l_string|&quot; Data2: %#x&quot;
comma
id|sdei-&gt;event_data2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sdei-&gt;valid.event_data3
)paren
id|prfunc
c_func
(paren
l_string|&quot; Data3: %#x&quot;
comma
id|sdei-&gt;event_data3
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  ia64_log_pci_bus_err_info_print&n; *&n; *  Format and log the platform PCI bus error record section data.&n; *&n; *  Inputs:  pci_bus_err_info * (Ptr to the PCI bus error record section&n; *                               returned by SAL)&n; *           prfunc             (fn ptr of print function to be used for output)&n; *  Outputs: None&n; */
r_void
DECL|function|ia64_log_pci_bus_err_info_print
id|ia64_log_pci_bus_err_info_print
(paren
id|sal_log_pci_bus_err_info_t
op_star
id|pbei
comma
id|prfunc_t
id|prfunc
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot;+ PCI Bus Error Detail: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pbei-&gt;valid.err_status
)paren
id|prfunc
c_func
(paren
l_string|&quot; Error Status: %#lx&quot;
comma
id|pbei-&gt;err_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pbei-&gt;valid.err_type
)paren
id|prfunc
c_func
(paren
l_string|&quot; Error Type: %#x&quot;
comma
id|pbei-&gt;err_type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pbei-&gt;valid.bus_id
)paren
id|prfunc
c_func
(paren
l_string|&quot; Bus ID: %#x&quot;
comma
id|pbei-&gt;bus_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pbei-&gt;valid.bus_address
)paren
id|prfunc
c_func
(paren
l_string|&quot; Bus Address: %#lx&quot;
comma
id|pbei-&gt;bus_address
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pbei-&gt;valid.bus_data
)paren
id|prfunc
c_func
(paren
l_string|&quot; Bus Data: %#lx&quot;
comma
id|pbei-&gt;bus_data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pbei-&gt;valid.bus_cmd
)paren
id|prfunc
c_func
(paren
l_string|&quot; Bus Command: %#lx&quot;
comma
id|pbei-&gt;bus_cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pbei-&gt;valid.requestor_id
)paren
id|prfunc
c_func
(paren
l_string|&quot; Requestor ID: %#lx&quot;
comma
id|pbei-&gt;requestor_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pbei-&gt;valid.responder_id
)paren
id|prfunc
c_func
(paren
l_string|&quot; Responder ID: %#lx&quot;
comma
id|pbei-&gt;responder_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pbei-&gt;valid.target_id
)paren
id|prfunc
c_func
(paren
l_string|&quot; Target ID: %#lx&quot;
comma
id|pbei-&gt;target_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pbei-&gt;valid.oem_data
)paren
id|prfunc
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pbei-&gt;valid.oem_data
)paren
(brace
id|platform_pci_bus_err_print
c_func
(paren
(paren
r_int
)paren
id|pbei-&gt;header.len
comma
(paren
r_int
)paren
r_sizeof
(paren
id|sal_log_pci_bus_err_info_t
)paren
op_minus
l_int|1
comma
op_amp
(paren
id|pbei-&gt;oem_data
(braket
l_int|0
)braket
)paren
comma
id|prfunc
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *  ia64_log_smbios_dev_err_info_print&n; *&n; *  Format and log the platform SMBIOS device error record section data.&n; *&n; *  Inputs:  smbios_dev_err_info * (Ptr to the SMBIOS device error record&n; *                                  section returned by SAL)&n; *           prfunc             (fn ptr of print function to be used for output)&n; *  Outputs: None&n; */
r_void
DECL|function|ia64_log_smbios_dev_err_info_print
id|ia64_log_smbios_dev_err_info_print
(paren
id|sal_log_smbios_dev_err_info_t
op_star
id|sdei
comma
id|prfunc_t
id|prfunc
)paren
(brace
id|u8
id|i
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+ SMBIOS Device Error Detail: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sdei-&gt;valid.event_type
)paren
id|prfunc
c_func
(paren
l_string|&quot; Event Type: %#x&quot;
comma
id|sdei-&gt;event_type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sdei-&gt;valid.time_stamp
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot; Time Stamp: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
id|prfunc
c_func
(paren
l_string|&quot;%d&quot;
comma
id|sdei-&gt;time_stamp
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sdei-&gt;valid.data
)paren
op_logical_and
(paren
id|sdei-&gt;valid.length
)paren
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot; Data: &quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|sdei-&gt;length
suffix:semicolon
id|i
op_increment
)paren
id|prfunc
c_func
(paren
l_string|&quot; %02x&quot;
comma
id|sdei-&gt;data
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|prfunc
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  ia64_log_pci_comp_err_info_print&n; *&n; *  Format and log the platform PCI component error record section data.&n; *&n; *  Inputs:  pci_comp_err_info * (Ptr to the PCI component error record section&n; *                                returned by SAL)&n; *           prfunc             (fn ptr of print function to be used for output)&n; *  Outputs: None&n; */
r_void
DECL|function|ia64_log_pci_comp_err_info_print
id|ia64_log_pci_comp_err_info_print
c_func
(paren
id|sal_log_pci_comp_err_info_t
op_star
id|pcei
comma
id|prfunc_t
id|prfunc
)paren
(brace
id|u32
id|n_mem_regs
comma
id|n_io_regs
suffix:semicolon
id|u64
id|i
comma
id|n_pci_data
suffix:semicolon
id|u64
op_star
id|p_reg_data
suffix:semicolon
id|u8
op_star
id|p_oem_data
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+ PCI Component Error Detail: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcei-&gt;valid.err_status
)paren
id|prfunc
c_func
(paren
l_string|&quot; Error Status: %#lx&bslash;n&quot;
comma
id|pcei-&gt;err_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcei-&gt;valid.comp_info
)paren
id|prfunc
c_func
(paren
l_string|&quot; Component Info: Vendor Id = %#x, Device Id = %#x,&quot;
l_string|&quot; Class Code = %#x, Seg/Bus/Dev/Func = %d/%d/%d/%d&bslash;n&quot;
comma
id|pcei-&gt;comp_info.vendor_id
comma
id|pcei-&gt;comp_info.device_id
comma
id|pcei-&gt;comp_info.class_code
comma
id|pcei-&gt;comp_info.seg_num
comma
id|pcei-&gt;comp_info.bus_num
comma
id|pcei-&gt;comp_info.dev_num
comma
id|pcei-&gt;comp_info.func_num
)paren
suffix:semicolon
id|n_mem_regs
op_assign
(paren
id|pcei-&gt;valid.num_mem_regs
)paren
ques
c_cond
id|pcei-&gt;num_mem_regs
suffix:colon
l_int|0
suffix:semicolon
id|n_io_regs
op_assign
(paren
id|pcei-&gt;valid.num_io_regs
)paren
ques
c_cond
id|pcei-&gt;num_io_regs
suffix:colon
l_int|0
suffix:semicolon
id|p_reg_data
op_assign
op_amp
(paren
id|pcei-&gt;reg_data_pairs
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|p_oem_data
op_assign
(paren
id|u8
op_star
)paren
id|p_reg_data
op_plus
(paren
id|n_mem_regs
op_plus
id|n_io_regs
)paren
op_star
l_int|2
op_star
r_sizeof
(paren
id|u64
)paren
suffix:semicolon
id|n_pci_data
op_assign
id|p_oem_data
op_minus
(paren
id|u8
op_star
)paren
id|pcei
suffix:semicolon
r_if
c_cond
(paren
id|n_pci_data
OG
id|pcei-&gt;header.len
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot; Invalid PCI Component Error Record format: length = %ld, &quot;
l_string|&quot; Size PCI Data = %d, Num Mem-Map/IO-Map Regs = %ld/%ld&bslash;n&quot;
comma
id|pcei-&gt;header.len
comma
id|n_pci_data
comma
id|n_mem_regs
comma
id|n_io_regs
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|n_mem_regs
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot; Memory Mapped Registers&bslash;n Address &bslash;tValue&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pcei-&gt;num_mem_regs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot; %#lx %#lx&bslash;n&quot;
comma
id|p_reg_data
(braket
l_int|0
)braket
comma
id|p_reg_data
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|p_reg_data
op_add_assign
l_int|2
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|n_io_regs
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot; I/O Mapped Registers&bslash;n Address &bslash;tValue&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pcei-&gt;num_io_regs
suffix:semicolon
id|i
op_increment
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot; %#lx %#lx&bslash;n&quot;
comma
id|p_reg_data
(braket
l_int|0
)braket
comma
id|p_reg_data
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|p_reg_data
op_add_assign
l_int|2
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|pcei-&gt;valid.oem_data
)paren
(brace
id|platform_pci_comp_err_print
c_func
(paren
(paren
r_int
)paren
id|pcei-&gt;header.len
comma
id|n_pci_data
comma
id|p_oem_data
comma
id|prfunc
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *  ia64_log_plat_specific_err_info_print&n; *&n; *  Format and log the platform specifie error record section data.&n; *&n; *  Inputs:  sel_dev_err_info * (Ptr to the platform specific error record&n; *                               section returned by SAL)&n; *           prfunc             (fn ptr of print function to be used for output)&n; *  Outputs: None&n; */
r_void
DECL|function|ia64_log_plat_specific_err_info_print
id|ia64_log_plat_specific_err_info_print
(paren
id|sal_log_plat_specific_err_info_t
op_star
id|psei
comma
id|prfunc_t
id|prfunc
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot;+ Platform Specific Error Detail: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|psei-&gt;valid.err_status
)paren
id|prfunc
c_func
(paren
l_string|&quot; Error Status: %#lx&quot;
comma
id|psei-&gt;err_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|psei-&gt;valid.guid
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot; GUID: &quot;
)paren
suffix:semicolon
id|ia64_log_prt_guid
c_func
(paren
op_amp
id|psei-&gt;guid
comma
id|prfunc
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|psei-&gt;valid.oem_data
)paren
(brace
id|platform_plat_specific_err_print
c_func
(paren
(paren
r_int
)paren
id|psei-&gt;header.len
comma
(paren
r_int
)paren
r_sizeof
(paren
id|sal_log_plat_specific_err_info_t
)paren
op_minus
l_int|1
comma
op_amp
(paren
id|psei-&gt;oem_data
(braket
l_int|0
)braket
)paren
comma
id|prfunc
)paren
suffix:semicolon
)brace
id|prfunc
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  ia64_log_host_ctlr_err_info_print&n; *&n; *  Format and log the platform host controller error record section data.&n; *&n; *  Inputs:  host_ctlr_err_info * (Ptr to the host controller error record&n; *                                 section returned by SAL)&n; *           prfunc             (fn ptr of print function to be used for output)&n; *  Outputs: None&n; */
r_void
DECL|function|ia64_log_host_ctlr_err_info_print
id|ia64_log_host_ctlr_err_info_print
(paren
id|sal_log_host_ctlr_err_info_t
op_star
id|hcei
comma
id|prfunc_t
id|prfunc
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot;+ Host Controller Error Detail: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hcei-&gt;valid.err_status
)paren
id|prfunc
c_func
(paren
l_string|&quot; Error Status: %#lx&quot;
comma
id|hcei-&gt;err_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hcei-&gt;valid.requestor_id
)paren
id|prfunc
c_func
(paren
l_string|&quot; Requestor ID: %#lx&quot;
comma
id|hcei-&gt;requestor_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hcei-&gt;valid.responder_id
)paren
id|prfunc
c_func
(paren
l_string|&quot; Responder ID: %#lx&quot;
comma
id|hcei-&gt;responder_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hcei-&gt;valid.target_id
)paren
id|prfunc
c_func
(paren
l_string|&quot; Target ID: %#lx&quot;
comma
id|hcei-&gt;target_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hcei-&gt;valid.bus_spec_data
)paren
id|prfunc
c_func
(paren
l_string|&quot; Bus Specific Data: %#lx&quot;
comma
id|hcei-&gt;bus_spec_data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|hcei-&gt;valid.oem_data
)paren
(brace
id|platform_host_ctlr_err_print
c_func
(paren
(paren
r_int
)paren
id|hcei-&gt;header.len
comma
(paren
r_int
)paren
r_sizeof
(paren
id|sal_log_host_ctlr_err_info_t
)paren
op_minus
l_int|1
comma
op_amp
(paren
id|hcei-&gt;oem_data
(braket
l_int|0
)braket
)paren
comma
id|prfunc
)paren
suffix:semicolon
)brace
id|prfunc
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  ia64_log_plat_bus_err_info_print&n; *&n; *  Format and log the platform bus error record section data.&n; *&n; *  Inputs:  plat_bus_err_info * (Ptr to the platform bus error record section&n; *                                returned by SAL)&n; *           prfunc             (fn ptr of print function to be used for output)&n; *  Outputs: None&n; */
r_void
DECL|function|ia64_log_plat_bus_err_info_print
id|ia64_log_plat_bus_err_info_print
(paren
id|sal_log_plat_bus_err_info_t
op_star
id|pbei
comma
id|prfunc_t
id|prfunc
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot;+ Platform Bus Error Detail: &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pbei-&gt;valid.err_status
)paren
id|prfunc
c_func
(paren
l_string|&quot; Error Status: %#lx&quot;
comma
id|pbei-&gt;err_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pbei-&gt;valid.requestor_id
)paren
id|prfunc
c_func
(paren
l_string|&quot; Requestor ID: %#lx&quot;
comma
id|pbei-&gt;requestor_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pbei-&gt;valid.responder_id
)paren
id|prfunc
c_func
(paren
l_string|&quot; Responder ID: %#lx&quot;
comma
id|pbei-&gt;responder_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pbei-&gt;valid.target_id
)paren
id|prfunc
c_func
(paren
l_string|&quot; Target ID: %#lx&quot;
comma
id|pbei-&gt;target_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pbei-&gt;valid.bus_spec_data
)paren
id|prfunc
c_func
(paren
l_string|&quot; Bus Specific Data: %#lx&quot;
comma
id|pbei-&gt;bus_spec_data
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pbei-&gt;valid.oem_data
)paren
(brace
id|platform_plat_bus_err_print
c_func
(paren
(paren
r_int
)paren
id|pbei-&gt;header.len
comma
(paren
r_int
)paren
r_sizeof
(paren
id|sal_log_plat_bus_err_info_t
)paren
op_minus
l_int|1
comma
op_amp
(paren
id|pbei-&gt;oem_data
(braket
l_int|0
)braket
)paren
comma
id|prfunc
)paren
suffix:semicolon
)brace
id|prfunc
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; *  ia64_log_proc_dev_err_info_print&n; *&n; *  Display the processor device error record.&n; *&n; *  Inputs:  sal_log_processor_info_t * (Ptr to processor device error record&n; *                                       section body).&n; *           prfunc                     (fn ptr of print function to be used&n; *                                       for output).&n; *  Outputs: None&n; */
r_void
DECL|function|ia64_log_proc_dev_err_info_print
id|ia64_log_proc_dev_err_info_print
(paren
id|sal_log_processor_info_t
op_star
id|slpi
comma
id|prfunc_t
id|prfunc
)paren
(brace
macro_line|#ifdef MCA_PRT_XTRA_DATA
r_int
id|d_len
op_assign
id|slpi-&gt;header.len
op_minus
r_sizeof
(paren
id|sal_log_section_hdr_t
)paren
suffix:semicolon
macro_line|#endif
id|sal_processor_static_info_t
op_star
id|spsi
suffix:semicolon
r_int
id|i
suffix:semicolon
id|sal_log_mod_error_info_t
op_star
id|p_data
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+Processor Device Error Info Section&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef MCA_PRT_XTRA_DATA    
singleline_comment|// for test only @FVL
(brace
r_char
op_star
id|p_data
op_assign
(paren
r_char
op_star
)paren
op_amp
id|slpi-&gt;valid
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;SAL_PROC_DEV_ERR SECTION DATA:  Data buffer = %p, &quot;
l_string|&quot;Data size = %ld&bslash;n&quot;
comma
(paren
r_void
op_star
)paren
id|p_data
comma
id|d_len
)paren
suffix:semicolon
id|ia64_log_hexdump
c_func
(paren
id|p_data
comma
id|d_len
comma
id|prfunc
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;End of SAL_PROC_DEV_ERR SECTION DATA&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif  
singleline_comment|// MCA_PRT_XTRA_DATA for test only @FVL
r_if
c_cond
(paren
id|slpi-&gt;valid.proc_error_map
)paren
id|prfunc
c_func
(paren
l_string|&quot; Processor Error Map: %#lx&bslash;n&quot;
comma
id|slpi-&gt;proc_error_map
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slpi-&gt;valid.proc_state_param
)paren
id|prfunc
c_func
(paren
l_string|&quot; Processor State Param: %#lx&bslash;n&quot;
comma
id|slpi-&gt;proc_state_parameter
)paren
suffix:semicolon
r_if
c_cond
(paren
id|slpi-&gt;valid.proc_cr_lid
)paren
id|prfunc
c_func
(paren
l_string|&quot; Processor LID: %#lx&bslash;n&quot;
comma
id|slpi-&gt;proc_cr_lid
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *  Note: March 2001 SAL spec states that if the number of elements in any&n;&t; *  of  the MOD_ERROR_INFO_STRUCT arrays is zero, the entire array is&n;&t; *  absent. Also, current implementations only allocate space for number of&n;&t; *  elements used.  So we walk the data pointer from here on.&n;&t; */
id|p_data
op_assign
op_amp
id|slpi-&gt;cache_check_info
(braket
l_int|0
)braket
suffix:semicolon
multiline_comment|/* Print the cache check information if any*/
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|slpi-&gt;valid.num_cache_check
suffix:semicolon
id|i
op_increment
comma
id|p_data
op_increment
)paren
id|ia64_log_cache_check_info_print
c_func
(paren
id|i
comma
id|p_data
comma
id|prfunc
)paren
suffix:semicolon
multiline_comment|/* Print the tlb check information if any*/
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|slpi-&gt;valid.num_tlb_check
suffix:semicolon
id|i
op_increment
comma
id|p_data
op_increment
)paren
id|ia64_log_tlb_check_info_print
c_func
(paren
id|i
comma
id|p_data
comma
id|prfunc
)paren
suffix:semicolon
multiline_comment|/* Print the bus check information if any*/
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|slpi-&gt;valid.num_bus_check
suffix:semicolon
id|i
op_increment
comma
id|p_data
op_increment
)paren
id|ia64_log_bus_check_info_print
c_func
(paren
id|i
comma
id|p_data
comma
id|prfunc
)paren
suffix:semicolon
multiline_comment|/* Print the reg file check information if any*/
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|slpi-&gt;valid.num_reg_file_check
suffix:semicolon
id|i
op_increment
comma
id|p_data
op_increment
)paren
id|ia64_log_hexdump
c_func
(paren
(paren
id|u8
op_star
)paren
id|p_data
comma
r_sizeof
(paren
id|sal_log_mod_error_info_t
)paren
comma
id|prfunc
)paren
suffix:semicolon
multiline_comment|/* Just hex dump for now */
multiline_comment|/* Print the ms check information if any*/
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|slpi-&gt;valid.num_ms_check
suffix:semicolon
id|i
op_increment
comma
id|p_data
op_increment
)paren
id|ia64_log_hexdump
c_func
(paren
(paren
id|u8
op_star
)paren
id|p_data
comma
r_sizeof
(paren
id|sal_log_mod_error_info_t
)paren
comma
id|prfunc
)paren
suffix:semicolon
multiline_comment|/* Just hex dump for now */
multiline_comment|/* Print CPUID registers if any*/
r_if
c_cond
(paren
id|slpi-&gt;valid.cpuid_info
)paren
(brace
id|u64
op_star
id|p
op_assign
(paren
id|u64
op_star
)paren
id|p_data
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot; CPUID Regs: %#lx %#lx %#lx %#lx&bslash;n&quot;
comma
id|p
(braket
l_int|0
)braket
comma
id|p
(braket
l_int|1
)braket
comma
id|p
(braket
l_int|2
)braket
comma
id|p
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|p_data
op_increment
suffix:semicolon
)brace
multiline_comment|/* Print processor static info if any */
r_if
c_cond
(paren
id|slpi-&gt;valid.psi_static_struct
)paren
(brace
id|spsi
op_assign
(paren
id|sal_processor_static_info_t
op_star
)paren
id|p_data
suffix:semicolon
multiline_comment|/* Print branch register contents if valid */
r_if
c_cond
(paren
id|spsi-&gt;valid.br
)paren
id|ia64_log_processor_regs_print
c_func
(paren
id|spsi-&gt;br
comma
l_int|8
comma
l_string|&quot;Branch&quot;
comma
l_string|&quot;br&quot;
comma
id|prfunc
)paren
suffix:semicolon
multiline_comment|/* Print control register contents if valid */
r_if
c_cond
(paren
id|spsi-&gt;valid.cr
)paren
id|ia64_log_processor_regs_print
c_func
(paren
id|spsi-&gt;cr
comma
l_int|128
comma
l_string|&quot;Control&quot;
comma
l_string|&quot;cr&quot;
comma
id|prfunc
)paren
suffix:semicolon
multiline_comment|/* Print application register contents if valid */
r_if
c_cond
(paren
id|spsi-&gt;valid.ar
)paren
id|ia64_log_processor_regs_print
c_func
(paren
id|spsi-&gt;ar
comma
l_int|128
comma
l_string|&quot;Application&quot;
comma
l_string|&quot;ar&quot;
comma
id|prfunc
)paren
suffix:semicolon
multiline_comment|/* Print region register contents if valid */
r_if
c_cond
(paren
id|spsi-&gt;valid.rr
)paren
id|ia64_log_processor_regs_print
c_func
(paren
id|spsi-&gt;rr
comma
l_int|8
comma
l_string|&quot;Region&quot;
comma
l_string|&quot;rr&quot;
comma
id|prfunc
)paren
suffix:semicolon
multiline_comment|/* Print floating-point register contents if valid */
r_if
c_cond
(paren
id|spsi-&gt;valid.fr
)paren
id|ia64_log_processor_fp_regs_print
c_func
(paren
id|spsi-&gt;fr
comma
l_int|128
comma
l_string|&quot;Floating-point&quot;
comma
l_string|&quot;fr&quot;
comma
id|prfunc
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * ia64_log_processor_info_print&n; *&n; *&t;Display the processor-specific information logged by PAL as a part&n; *&t;of MCA or INIT or CMC.&n; *&n; *  Inputs   :  lh      (Pointer of the sal log header which specifies the&n; *                       format of SAL state info as specified by the SAL spec).&n; *              prfunc  (fn ptr of print function to be used for output).&n; * Outputs&t;:&t;None&n; */
r_void
DECL|function|ia64_log_processor_info_print
id|ia64_log_processor_info_print
c_func
(paren
id|sal_log_record_header_t
op_star
id|lh
comma
id|prfunc_t
id|prfunc
)paren
(brace
id|sal_log_section_hdr_t
op_star
id|slsh
suffix:semicolon
r_int
id|n_sects
suffix:semicolon
r_int
id|ercd_pos
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lh
)paren
r_return
suffix:semicolon
macro_line|#ifdef MCA_PRT_XTRA_DATA    
singleline_comment|// for test only @FVL
id|ia64_log_prt_record_header
c_func
(paren
id|lh
comma
id|prfunc
)paren
suffix:semicolon
macro_line|#endif  
singleline_comment|// MCA_PRT_XTRA_DATA for test only @FVL
r_if
c_cond
(paren
(paren
id|ercd_pos
op_assign
r_sizeof
(paren
id|sal_log_record_header_t
)paren
)paren
op_ge
id|lh-&gt;len
)paren
(brace
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_log_print: &quot;
l_string|&quot;truncated SAL CMC error record. len = %d&bslash;n&quot;
comma
id|lh-&gt;len
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Print record header info */
id|ia64_log_rec_header_print
c_func
(paren
id|lh
comma
id|prfunc
)paren
suffix:semicolon
r_for
c_loop
(paren
id|n_sects
op_assign
l_int|0
suffix:semicolon
(paren
id|ercd_pos
OL
id|lh-&gt;len
)paren
suffix:semicolon
id|n_sects
op_increment
comma
id|ercd_pos
op_add_assign
id|slsh-&gt;len
)paren
(brace
multiline_comment|/* point to next section header */
id|slsh
op_assign
(paren
id|sal_log_section_hdr_t
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|lh
op_plus
id|ercd_pos
)paren
suffix:semicolon
macro_line|#ifdef MCA_PRT_XTRA_DATA    
singleline_comment|// for test only @FVL
id|ia64_log_prt_section_header
c_func
(paren
id|slsh
comma
id|prfunc
)paren
suffix:semicolon
macro_line|#endif  
singleline_comment|// MCA_PRT_XTRA_DATA for test only @FVL
r_if
c_cond
(paren
id|verify_guid
c_func
(paren
op_amp
id|slsh-&gt;guid
comma
op_amp
(paren
id|SAL_PROC_DEV_ERR_SECT_GUID
)paren
)paren
)paren
(brace
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_log_print: unsupported record section&bslash;n&quot;
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; *  Now process processor device error record section&n;&t;&t; */
id|ia64_log_proc_dev_err_info_print
c_func
(paren
(paren
id|sal_log_processor_info_t
op_star
)paren
id|slsh
comma
id|printk
)paren
suffix:semicolon
)brace
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_log_print: &quot;
l_string|&quot;found %d sections in SAL CMC error record. len = %d&bslash;n&quot;
comma
id|n_sects
comma
id|lh-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|n_sects
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot;No Processor Device Error Info Section found&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; *  ia64_log_platform_info_print&n; *&n; *  Format and Log the SAL Platform Error Record.&n; *&n; *  Inputs  :   lh      (Pointer to the sal error record header with format&n; *                       specified by the SAL spec).&n; *              prfunc  (fn ptr of log output function to use)&n; *  Outputs :&t;platform error status&n; */
r_int
DECL|function|ia64_log_platform_info_print
id|ia64_log_platform_info_print
(paren
id|sal_log_record_header_t
op_star
id|lh
comma
id|prfunc_t
id|prfunc
)paren
(brace
id|sal_log_section_hdr_t
op_star
id|slsh
suffix:semicolon
r_int
id|n_sects
suffix:semicolon
r_int
id|ercd_pos
suffix:semicolon
r_int
id|platform_err
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lh
)paren
r_return
id|platform_err
suffix:semicolon
macro_line|#ifdef MCA_PRT_XTRA_DATA    
singleline_comment|// for test only @FVL
id|ia64_log_prt_record_header
c_func
(paren
id|lh
comma
id|prfunc
)paren
suffix:semicolon
macro_line|#endif  
singleline_comment|// MCA_PRT_XTRA_DATA for test only @FVL
r_if
c_cond
(paren
(paren
id|ercd_pos
op_assign
r_sizeof
(paren
id|sal_log_record_header_t
)paren
)paren
op_ge
id|lh-&gt;len
)paren
(brace
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_log_print: &quot;
l_string|&quot;truncated SAL error record. len = %d&bslash;n&quot;
comma
id|lh-&gt;len
)paren
suffix:semicolon
r_return
id|platform_err
suffix:semicolon
)brace
multiline_comment|/* Print record header info */
id|ia64_log_rec_header_print
c_func
(paren
id|lh
comma
id|prfunc
)paren
suffix:semicolon
r_for
c_loop
(paren
id|n_sects
op_assign
l_int|0
suffix:semicolon
(paren
id|ercd_pos
OL
id|lh-&gt;len
)paren
suffix:semicolon
id|n_sects
op_increment
comma
id|ercd_pos
op_add_assign
id|slsh-&gt;len
)paren
(brace
multiline_comment|/* point to next section header */
id|slsh
op_assign
(paren
id|sal_log_section_hdr_t
op_star
)paren
(paren
(paren
r_char
op_star
)paren
id|lh
op_plus
id|ercd_pos
)paren
suffix:semicolon
macro_line|#ifdef MCA_PRT_XTRA_DATA    
singleline_comment|// for test only @FVL
id|ia64_log_prt_section_header
c_func
(paren
id|slsh
comma
id|prfunc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|efi_guidcmp
c_func
(paren
id|slsh-&gt;guid
comma
id|SAL_PROC_DEV_ERR_SECT_GUID
)paren
op_ne
l_int|0
)paren
(brace
r_int
id|d_len
op_assign
id|slsh-&gt;len
op_minus
r_sizeof
(paren
id|sal_log_section_hdr_t
)paren
suffix:semicolon
r_char
op_star
id|p_data
op_assign
(paren
r_char
op_star
)paren
op_amp
(paren
(paren
id|sal_log_mem_dev_err_info_t
op_star
)paren
id|slsh
)paren
op_member_access_from_pointer
id|valid
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;Start of Platform Err Data Section:  Data buffer = %p, &quot;
l_string|&quot;Data size = %ld&bslash;n&quot;
comma
(paren
r_void
op_star
)paren
id|p_data
comma
id|d_len
)paren
suffix:semicolon
id|ia64_log_hexdump
c_func
(paren
id|p_data
comma
id|d_len
comma
id|prfunc
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;End of Platform Err Data Section&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif  
singleline_comment|// MCA_PRT_XTRA_DATA for test only @FVL
multiline_comment|/*&n;&t;&t; *  Now process CPE error record section&n;&t;&t; */
r_if
c_cond
(paren
id|efi_guidcmp
c_func
(paren
id|slsh-&gt;guid
comma
id|SAL_PROC_DEV_ERR_SECT_GUID
)paren
op_eq
l_int|0
)paren
(brace
id|ia64_log_proc_dev_err_info_print
c_func
(paren
(paren
id|sal_log_processor_info_t
op_star
)paren
id|slsh
comma
id|prfunc
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|efi_guidcmp
c_func
(paren
id|slsh-&gt;guid
comma
id|SAL_PLAT_MEM_DEV_ERR_SECT_GUID
)paren
op_eq
l_int|0
)paren
(brace
id|platform_err
op_assign
l_int|1
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+Platform Memory Device Error Info Section&bslash;n&quot;
)paren
suffix:semicolon
id|ia64_log_mem_dev_err_info_print
c_func
(paren
(paren
id|sal_log_mem_dev_err_info_t
op_star
)paren
id|slsh
comma
id|prfunc
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|efi_guidcmp
c_func
(paren
id|slsh-&gt;guid
comma
id|SAL_PLAT_SEL_DEV_ERR_SECT_GUID
)paren
op_eq
l_int|0
)paren
(brace
id|platform_err
op_assign
l_int|1
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+Platform SEL Device Error Info Section&bslash;n&quot;
)paren
suffix:semicolon
id|ia64_log_sel_dev_err_info_print
c_func
(paren
(paren
id|sal_log_sel_dev_err_info_t
op_star
)paren
id|slsh
comma
id|prfunc
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|efi_guidcmp
c_func
(paren
id|slsh-&gt;guid
comma
id|SAL_PLAT_PCI_BUS_ERR_SECT_GUID
)paren
op_eq
l_int|0
)paren
(brace
id|platform_err
op_assign
l_int|1
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+Platform PCI Bus Error Info Section&bslash;n&quot;
)paren
suffix:semicolon
id|ia64_log_pci_bus_err_info_print
c_func
(paren
(paren
id|sal_log_pci_bus_err_info_t
op_star
)paren
id|slsh
comma
id|prfunc
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|efi_guidcmp
c_func
(paren
id|slsh-&gt;guid
comma
id|SAL_PLAT_SMBIOS_DEV_ERR_SECT_GUID
)paren
op_eq
l_int|0
)paren
(brace
id|platform_err
op_assign
l_int|1
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+Platform SMBIOS Device Error Info Section&bslash;n&quot;
)paren
suffix:semicolon
id|ia64_log_smbios_dev_err_info_print
c_func
(paren
(paren
id|sal_log_smbios_dev_err_info_t
op_star
)paren
id|slsh
comma
id|prfunc
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|efi_guidcmp
c_func
(paren
id|slsh-&gt;guid
comma
id|SAL_PLAT_PCI_COMP_ERR_SECT_GUID
)paren
op_eq
l_int|0
)paren
(brace
id|platform_err
op_assign
l_int|1
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+Platform PCI Component Error Info Section&bslash;n&quot;
)paren
suffix:semicolon
id|ia64_log_pci_comp_err_info_print
c_func
(paren
(paren
id|sal_log_pci_comp_err_info_t
op_star
)paren
id|slsh
comma
id|prfunc
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|efi_guidcmp
c_func
(paren
id|slsh-&gt;guid
comma
id|SAL_PLAT_SPECIFIC_ERR_SECT_GUID
)paren
op_eq
l_int|0
)paren
(brace
id|platform_err
op_assign
l_int|1
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+Platform Specific Error Info Section&bslash;n&quot;
)paren
suffix:semicolon
id|ia64_log_plat_specific_err_info_print
c_func
(paren
(paren
id|sal_log_plat_specific_err_info_t
op_star
)paren
id|slsh
comma
id|prfunc
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|efi_guidcmp
c_func
(paren
id|slsh-&gt;guid
comma
id|SAL_PLAT_HOST_CTLR_ERR_SECT_GUID
)paren
op_eq
l_int|0
)paren
(brace
id|platform_err
op_assign
l_int|1
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+Platform Host Controller Error Info Section&bslash;n&quot;
)paren
suffix:semicolon
id|ia64_log_host_ctlr_err_info_print
c_func
(paren
(paren
id|sal_log_host_ctlr_err_info_t
op_star
)paren
id|slsh
comma
id|prfunc
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|efi_guidcmp
c_func
(paren
id|slsh-&gt;guid
comma
id|SAL_PLAT_BUS_ERR_SECT_GUID
)paren
op_eq
l_int|0
)paren
(brace
id|platform_err
op_assign
l_int|1
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+Platform Bus Error Info Section&bslash;n&quot;
)paren
suffix:semicolon
id|ia64_log_plat_bus_err_info_print
c_func
(paren
(paren
id|sal_log_plat_bus_err_info_t
op_star
)paren
id|slsh
comma
id|prfunc
)paren
suffix:semicolon
)brace
r_else
(brace
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_log_print: unsupported record section&bslash;n&quot;
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
id|IA64_MCA_DEBUG
c_func
(paren
l_string|&quot;ia64_mca_log_print: found %d sections in SAL error record. len = %d&bslash;n&quot;
comma
id|n_sects
comma
id|lh-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|n_sects
)paren
(brace
id|prfunc
c_func
(paren
l_string|&quot;No Platform Error Info Sections found&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|platform_err
suffix:semicolon
)brace
r_return
id|platform_err
suffix:semicolon
)brace
multiline_comment|/*&n; * ia64_log_print&n; *&n; *  Displays the contents of the OS error log information&n; *&n; *  Inputs   :  info_type   (SAL_INFO_TYPE_{MCA,INIT,CMC,CPE})&n; *              prfunc      (fn ptr of log output function to use)&n; * Outputs&t;:&t;platform error status&n; */
r_int
DECL|function|ia64_log_print
id|ia64_log_print
c_func
(paren
r_int
id|sal_info_type
comma
id|prfunc_t
id|prfunc
)paren
(brace
r_int
id|platform_err
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|sal_info_type
)paren
(brace
r_case
id|SAL_INFO_TYPE_MCA
suffix:colon
id|prfunc
c_func
(paren
l_string|&quot;+BEGIN HARDWARE ERROR STATE AT MCA&bslash;n&quot;
)paren
suffix:semicolon
id|platform_err
op_assign
id|ia64_log_platform_info_print
c_func
(paren
id|IA64_LOG_CURR_BUFFER
c_func
(paren
id|sal_info_type
)paren
comma
id|prfunc
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+END HARDWARE ERROR STATE AT MCA&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SAL_INFO_TYPE_INIT
suffix:colon
id|prfunc
c_func
(paren
l_string|&quot;+MCA INIT ERROR LOG (UNIMPLEMENTED)&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SAL_INFO_TYPE_CMC
suffix:colon
id|prfunc
c_func
(paren
l_string|&quot;+BEGIN HARDWARE ERROR STATE AT CMC&bslash;n&quot;
)paren
suffix:semicolon
id|ia64_log_processor_info_print
c_func
(paren
id|IA64_LOG_CURR_BUFFER
c_func
(paren
id|sal_info_type
)paren
comma
id|prfunc
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+END HARDWARE ERROR STATE AT CMC&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SAL_INFO_TYPE_CPE
suffix:colon
id|prfunc
c_func
(paren
l_string|&quot;+BEGIN HARDWARE ERROR STATE AT CPE&bslash;n&quot;
)paren
suffix:semicolon
id|ia64_log_platform_info_print
c_func
(paren
id|IA64_LOG_CURR_BUFFER
c_func
(paren
id|sal_info_type
)paren
comma
id|prfunc
)paren
suffix:semicolon
id|prfunc
c_func
(paren
l_string|&quot;+END HARDWARE ERROR STATE AT CPE&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|prfunc
c_func
(paren
l_string|&quot;+MCA UNKNOWN ERROR LOG (UNIMPLEMENTED)&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|platform_err
suffix:semicolon
)brace
eof
