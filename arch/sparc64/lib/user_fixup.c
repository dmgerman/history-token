multiline_comment|/* user_fixup.c: Fix up user copy faults.&n; *&n; * Copyright (C) 2004 David S. Miller &lt;davem@redhat.com&gt;&n; */
macro_line|#include &lt;linux/compiler.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
multiline_comment|/* Calculating the exact fault address when using&n; * block loads and stores can be very complicated.&n; * Instead of trying to be clever and handling all&n; * of the cases, just fix things up simply here.&n; */
DECL|function|copy_from_user_fixup
r_int
r_int
id|copy_from_user_fixup
c_func
(paren
r_void
op_star
id|to
comma
r_const
r_void
id|__user
op_star
id|from
comma
r_int
r_int
id|size
)paren
(brace
r_char
op_star
id|dst
op_assign
id|to
suffix:semicolon
r_const
r_char
id|__user
op_star
id|src
op_assign
id|from
suffix:semicolon
r_while
c_loop
(paren
id|size
)paren
(brace
r_if
c_cond
(paren
id|__get_user
c_func
(paren
op_star
id|dst
comma
id|src
)paren
)paren
r_break
suffix:semicolon
id|dst
op_increment
suffix:semicolon
id|src
op_increment
suffix:semicolon
id|size
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
id|size
)paren
id|memset
c_func
(paren
id|dst
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
r_return
id|size
suffix:semicolon
)brace
DECL|function|copy_to_user_fixup
r_int
r_int
id|copy_to_user_fixup
c_func
(paren
r_void
id|__user
op_star
id|to
comma
r_const
r_void
op_star
id|from
comma
r_int
r_int
id|size
)paren
(brace
r_char
id|__user
op_star
id|dst
op_assign
id|to
suffix:semicolon
r_const
r_char
op_star
id|src
op_assign
id|from
suffix:semicolon
r_while
c_loop
(paren
id|size
)paren
(brace
r_if
c_cond
(paren
id|__put_user
c_func
(paren
op_star
id|src
comma
id|dst
)paren
)paren
r_break
suffix:semicolon
id|dst
op_increment
suffix:semicolon
id|src
op_increment
suffix:semicolon
id|size
op_decrement
suffix:semicolon
)brace
r_return
id|size
suffix:semicolon
)brace
DECL|function|copy_in_user_fixup
r_int
r_int
id|copy_in_user_fixup
c_func
(paren
r_void
id|__user
op_star
id|to
comma
r_void
id|__user
op_star
id|from
comma
r_int
r_int
id|size
)paren
(brace
r_char
id|__user
op_star
id|dst
op_assign
id|to
suffix:semicolon
r_char
id|__user
op_star
id|src
op_assign
id|from
suffix:semicolon
r_while
c_loop
(paren
id|size
)paren
(brace
r_char
id|tmp
suffix:semicolon
r_if
c_cond
(paren
id|__get_user
c_func
(paren
id|tmp
comma
id|src
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|__put_user
c_func
(paren
id|tmp
comma
id|dst
)paren
)paren
r_break
suffix:semicolon
id|dst
op_increment
suffix:semicolon
id|src
op_increment
suffix:semicolon
id|size
op_decrement
suffix:semicolon
)brace
r_return
id|size
suffix:semicolon
)brace
eof
