multiline_comment|/* delay.c: Delay loops for sparc64&n; *&n; * Copyright (C) 2004 David S. Miller &lt;davem@redhat.com&gt;&n; *&n; * Based heavily upon x86 variant which is:&n; *&t;Copyright (C) 1993 Linus Torvalds&n; *&t;Copyright (C) 1997 Martin Mares &lt;mj@atrey.karlin.mff.cuni.cz&gt;&n; */
macro_line|#include &lt;linux/delay.h&gt;
DECL|function|__delay
r_void
id|__delay
c_func
(paren
r_int
r_int
id|loops
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;&t;b,pt&t;%%xcc, 1f&bslash;n&quot;
l_string|&quot;&t; cmp&t;%0, 0&bslash;n&quot;
l_string|&quot;&t;.align&t;32&bslash;n&quot;
l_string|&quot;1:&bslash;n&quot;
l_string|&quot;&t;bne,pt&t;%%xcc, 1b&bslash;n&quot;
l_string|&quot;&t; subcc&t;%0, 1, %0&bslash;n&quot;
suffix:colon
l_string|&quot;=&amp;r&quot;
(paren
id|loops
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|loops
)paren
suffix:colon
l_string|&quot;cc&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* We used to multiply by HZ after shifting down by 32 bits&n; * but that runs into problems for higher values of HZ and&n; * slow cpus.&n; */
DECL|function|__const_udelay
r_void
id|__const_udelay
c_func
(paren
r_int
r_int
id|n
)paren
(brace
id|n
op_mul_assign
l_int|4
suffix:semicolon
id|n
op_mul_assign
(paren
id|cpu_data
c_func
(paren
id|_smp_processor_id
c_func
(paren
)paren
)paren
dot
id|udelay_val
op_star
(paren
id|HZ
op_div
l_int|4
)paren
)paren
suffix:semicolon
id|n
op_rshift_assign
l_int|32
suffix:semicolon
id|__delay
c_func
(paren
id|n
op_plus
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|__udelay
r_void
id|__udelay
c_func
(paren
r_int
r_int
id|n
)paren
(brace
id|__const_udelay
c_func
(paren
id|n
op_star
l_int|0x10c7UL
)paren
suffix:semicolon
)brace
DECL|function|__ndelay
r_void
id|__ndelay
c_func
(paren
r_int
r_int
id|n
)paren
(brace
id|__const_udelay
c_func
(paren
id|n
op_star
l_int|0x5UL
)paren
suffix:semicolon
)brace
eof
