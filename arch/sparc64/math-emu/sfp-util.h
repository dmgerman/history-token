multiline_comment|/* $Id: sfp-util.h,v 1.5 2001/06/10 06:48:46 davem Exp $&n; * arch/sparc64/math-emu/sfp-util.h&n; *&n; * Copyright (C) 1999 Jakub Jelinek (jj@ultra.linux.cz)&n; * Copyright (C) 1999 David S. Miller (davem@redhat.com)&n; *&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
DECL|macro|add_ssaaaa
mdefine_line|#define add_ssaaaa(sh, sl, ah, al, bh, bl) &t;&bslash;&n;  __asm__ (&quot;addcc %4,%5,%1&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;&t;   &quot;add %2,%3,%0&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;  &t;   &quot;bcs,a,pn %%xcc, 1f&bslash;n&bslash;t&quot;&t;&t;&bslash;&n;  &t;   &quot;add %0, 1, %0&bslash;n&quot;&t;&t;&t;&bslash;&n;  &t;   &quot;1:&quot;&t;&t;&t;&t;&t;&bslash;&n;&t;   : &quot;=r&quot; ((UDItype)(sh)),&t;&t;&bslash;&n;&t;     &quot;=&amp;r&quot; ((UDItype)(sl))&t;&t;&bslash;&n;&t;   : &quot;r&quot; ((UDItype)(ah)),&t;&t;&bslash;&n;&t;     &quot;r&quot; ((UDItype)(bh)),&t;&t;&bslash;&n;&t;     &quot;r&quot; ((UDItype)(al)),&t;&t;&bslash;&n;&t;     &quot;r&quot; ((UDItype)(bl))&t;&t;&bslash;&n;&t;   : &quot;cc&quot;)
DECL|macro|sub_ddmmss
mdefine_line|#define sub_ddmmss(sh, sl, ah, al, bh, bl) &t;&bslash;&n;  __asm__ (&quot;subcc %4,%5,%1&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;  &t;   &quot;sub %2,%3,%0&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;  &t;   &quot;bcs,a,pn %%xcc, 1f&bslash;n&bslash;t&quot;&t;&t;&bslash;&n;  &t;   &quot;sub %0, 1, %0&bslash;n&quot;&t;&t;&t;&bslash;&n;  &t;   &quot;1:&quot;&t;&t;&t;&t;&t;&bslash;&n;&t;   : &quot;=r&quot; ((UDItype)(sh)),&t;&t;&bslash;&n;&t;     &quot;=&amp;r&quot; ((UDItype)(sl))&t;&t;&bslash;&n;&t;   : &quot;r&quot; ((UDItype)(ah)),&t;&t;&bslash;&n;&t;     &quot;r&quot; ((UDItype)(bh)),&t;&t;&bslash;&n;&t;     &quot;r&quot; ((UDItype)(al)),&t;&t;&bslash;&n;&t;     &quot;r&quot; ((UDItype)(bl))&t;&t;&bslash;&n;&t;   : &quot;cc&quot;)
DECL|macro|umul_ppmm
mdefine_line|#define umul_ppmm(wh, wl, u, v)&t;&t;&t;&t;&bslash;&n;  do {&t;&t;&t;&t;&t;&t;&t;&bslash;&n;&t;  UDItype tmp1, tmp2, tmp3, tmp4;&t;&t;&bslash;&n;&t;  __asm__ __volatile__ (&t;&t;&t;&bslash;&n;&t;&t;   &quot;srl %7,0,%3&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;&t;&t;   &quot;mulx %3,%6,%1&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;&t;&t;   &quot;srlx %6,32,%2&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;&t;&t;   &quot;mulx %2,%3,%4&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;&t;&t;   &quot;sllx %4,32,%5&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;&t;&t;   &quot;srl %6,0,%3&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;&t;&t;   &quot;sub %1,%5,%5&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;&t;&t;   &quot;srlx %5,32,%5&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;&t;&t;   &quot;addcc %4,%5,%4&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;&t;&t;   &quot;srlx %7,32,%5&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;&t;&t;   &quot;mulx %3,%5,%3&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;&t;&t;   &quot;mulx %2,%5,%5&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;&t;&t;   &quot;sethi %%hi(0x80000000),%2&bslash;n&bslash;t&quot;&t;&bslash;&n;&t;&t;   &quot;addcc %4,%3,%4&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;&t;&t;   &quot;srlx %4,32,%4&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;&t;&t;   &quot;add %2,%2,%2&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;&t;&t;   &quot;movcc %%xcc,%%g0,%2&bslash;n&bslash;t&quot;&t;&t;&bslash;&n;&t;&t;   &quot;addcc %5,%4,%5&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;&t;&t;   &quot;sllx %3,32,%3&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;&t;&t;   &quot;add %1,%3,%1&bslash;n&bslash;t&quot;&t;&t;&t;&bslash;&n;&t;&t;   &quot;add %5,%2,%0&quot;&t;&t;&t;&bslash;&n;&t;   : &quot;=r&quot; ((UDItype)(wh)),&t;&t;&t;&bslash;&n;&t;     &quot;=&amp;r&quot; ((UDItype)(wl)),&t;&t;&t;&bslash;&n;&t;     &quot;=&amp;r&quot; (tmp1), &quot;=&amp;r&quot; (tmp2), &quot;=&amp;r&quot; (tmp3), &quot;=&amp;r&quot; (tmp4) &bslash;&n;&t;   : &quot;r&quot; ((UDItype)(u)),&t;&t;&t;&bslash;&n;&t;     &quot;r&quot; ((UDItype)(v))&t;&t;&t;&t;&bslash;&n;&t;   : &quot;cc&quot;);&t;&t;&t;&t;&t;&bslash;&n;  } while (0)
DECL|macro|udiv_qrnnd
mdefine_line|#define udiv_qrnnd(q, r, n1, n0, d) &t;&t;&t;&bslash;&n;  do {                                                  &bslash;&n;    UWtype __d1, __d0, __q1, __q0, __r1, __r0, __m;     &bslash;&n;    __d1 = (d &gt;&gt; 32);                                   &bslash;&n;    __d0 = (USItype)d;                                  &bslash;&n;                                                        &bslash;&n;    __r1 = (n1) % __d1;                                 &bslash;&n;    __q1 = (n1) / __d1;                                 &bslash;&n;    __m = (UWtype) __q1 * __d0;                         &bslash;&n;    __r1 = (__r1 &lt;&lt; 32) | (n0 &gt;&gt; 32);                   &bslash;&n;    if (__r1 &lt; __m)                                     &bslash;&n;      {                                                 &bslash;&n;        __q1--, __r1 += (d);                            &bslash;&n;        if (__r1 &gt;= (d)) /* i.e. we didn&squot;t get carry when adding to __r1 */ &bslash;&n;          if (__r1 &lt; __m)                               &bslash;&n;            __q1--, __r1 += (d);                        &bslash;&n;      }                                                 &bslash;&n;    __r1 -= __m;                                        &bslash;&n;                                                        &bslash;&n;    __r0 = __r1 % __d1;                                 &bslash;&n;    __q0 = __r1 / __d1;                                 &bslash;&n;    __m = (UWtype) __q0 * __d0;                         &bslash;&n;    __r0 = (__r0 &lt;&lt; 32) | ((USItype)n0);                &bslash;&n;    if (__r0 &lt; __m)                                     &bslash;&n;      {                                                 &bslash;&n;        __q0--, __r0 += (d);                            &bslash;&n;        if (__r0 &gt;= (d))                                &bslash;&n;          if (__r0 &lt; __m)                               &bslash;&n;            __q0--, __r0 += (d);                        &bslash;&n;      }                                                 &bslash;&n;    __r0 -= __m;                                        &bslash;&n;                                                        &bslash;&n;    (q) = (UWtype) (__q1 &lt;&lt; 32)  | __q0;                &bslash;&n;    (r) = __r0;                                         &bslash;&n;  } while (0)
DECL|macro|UDIV_NEEDS_NORMALIZATION
mdefine_line|#define UDIV_NEEDS_NORMALIZATION 1  
DECL|macro|abort
mdefine_line|#define abort() &bslash;&n;&t;return 0
macro_line|#ifdef __BIG_ENDIAN
DECL|macro|__BYTE_ORDER
mdefine_line|#define __BYTE_ORDER __BIG_ENDIAN
macro_line|#else
DECL|macro|__BYTE_ORDER
mdefine_line|#define __BYTE_ORDER __LITTLE_ENDIAN
macro_line|#endif
eof
