macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/isa.h&gt;
DECL|variable|isa_chain
r_struct
id|isa_bridge
op_star
id|isa_chain
suffix:semicolon
DECL|function|fatal_err
r_static
r_void
id|__init
id|fatal_err
c_func
(paren
r_const
r_char
op_star
id|reason
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;ISA: fatal error, %s.&bslash;n&quot;
comma
id|reason
)paren
suffix:semicolon
)brace
DECL|function|report_dev
r_static
r_void
id|__init
id|report_dev
c_func
(paren
r_struct
id|isa_device
op_star
id|isa_dev
comma
r_int
id|child
)paren
(brace
r_if
c_cond
(paren
id|child
)paren
id|printk
c_func
(paren
l_string|&quot; (%s)&quot;
comma
id|isa_dev-&gt;prom_name
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
l_string|&quot; [%s&quot;
comma
id|isa_dev-&gt;prom_name
)paren
suffix:semicolon
)brace
DECL|function|isa_dev_get_resource
r_static
r_void
id|__init
id|isa_dev_get_resource
c_func
(paren
r_struct
id|isa_device
op_star
id|isa_dev
)paren
(brace
r_struct
id|linux_prom_registers
id|regs
(braket
id|PROMREG_MAX
)braket
suffix:semicolon
r_int
r_int
id|base
comma
id|len
suffix:semicolon
r_int
id|prop_len
suffix:semicolon
id|prop_len
op_assign
id|prom_getproperty
c_func
(paren
id|isa_dev-&gt;prom_node
comma
l_string|&quot;reg&quot;
comma
(paren
r_char
op_star
)paren
id|regs
comma
r_sizeof
(paren
id|regs
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prop_len
op_le
l_int|0
)paren
r_return
suffix:semicolon
multiline_comment|/* Only the first one is interesting. */
id|len
op_assign
id|regs
(braket
l_int|0
)braket
dot
id|reg_size
suffix:semicolon
id|base
op_assign
(paren
(paren
(paren
r_int
r_int
)paren
id|regs
(braket
l_int|0
)braket
dot
id|which_io
op_lshift
l_int|32
)paren
op_or
(paren
r_int
r_int
)paren
id|regs
(braket
l_int|0
)braket
dot
id|phys_addr
)paren
suffix:semicolon
id|base
op_add_assign
id|isa_dev-&gt;bus-&gt;parent-&gt;io_space.start
suffix:semicolon
id|isa_dev-&gt;resource.start
op_assign
id|base
suffix:semicolon
id|isa_dev-&gt;resource.end
op_assign
(paren
id|base
op_plus
id|len
op_minus
l_int|1UL
)paren
suffix:semicolon
id|isa_dev-&gt;resource.flags
op_assign
id|IORESOURCE_IO
suffix:semicolon
id|isa_dev-&gt;resource.name
op_assign
id|isa_dev-&gt;prom_name
suffix:semicolon
id|request_resource
c_func
(paren
op_amp
id|isa_dev-&gt;bus-&gt;parent-&gt;io_space
comma
op_amp
id|isa_dev-&gt;resource
)paren
suffix:semicolon
)brace
multiline_comment|/* I can&squot;t believe they didn&squot;t put a real INO in the isa device&n; * interrupts property.  The whole point of the OBP properties&n; * is to shield the kernel from IRQ routing details.&n; *&n; * The P1275 standard for ISA devices seems to also have been&n; * totally ignored.&n; */
r_static
r_struct
(brace
DECL|member|obp_irq
r_int
id|obp_irq
suffix:semicolon
DECL|member|pci_ino
r_int
id|pci_ino
suffix:semicolon
DECL|variable|grover_irq_table
)brace
id|grover_irq_table
(braket
)braket
op_assign
(brace
(brace
l_int|1
comma
l_int|0x00
)brace
comma
multiline_comment|/* dma, unknown ino at this point */
(brace
l_int|2
comma
l_int|0x27
)brace
comma
multiline_comment|/* floppy */
(brace
l_int|3
comma
l_int|0x22
)brace
comma
multiline_comment|/* parallel */
(brace
l_int|4
comma
l_int|0x2b
)brace
comma
multiline_comment|/* serial */
(brace
l_int|5
comma
l_int|0x25
)brace
comma
multiline_comment|/* acpi power management */
(brace
l_int|0
comma
l_int|0x00
)brace
multiline_comment|/* end of table */
)brace
suffix:semicolon
DECL|function|isa_dev_get_irq
r_static
r_void
id|__init
id|isa_dev_get_irq
c_func
(paren
r_struct
id|isa_device
op_star
id|isa_dev
)paren
(brace
r_int
id|irq_prop
suffix:semicolon
id|irq_prop
op_assign
id|prom_getintdefault
c_func
(paren
id|isa_dev-&gt;prom_node
comma
l_string|&quot;interrupts&quot;
comma
op_minus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq_prop
op_le
l_int|0
)paren
(brace
id|isa_dev-&gt;irq
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|grover_irq_table
(braket
id|i
)braket
dot
id|obp_irq
op_ne
l_int|0
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|grover_irq_table
(braket
id|i
)braket
dot
id|obp_irq
op_eq
id|irq_prop
)paren
(brace
r_struct
id|pci_controller_info
op_star
id|pcic
suffix:semicolon
r_struct
id|pci_pbm_info
op_star
id|pbm
suffix:semicolon
r_int
id|ino
op_assign
id|grover_irq_table
(braket
id|i
)braket
dot
id|pci_ino
suffix:semicolon
r_if
c_cond
(paren
id|ino
op_eq
l_int|0
)paren
(brace
id|isa_dev-&gt;irq
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|pbm
op_assign
id|isa_dev-&gt;bus-&gt;parent
suffix:semicolon
id|pcic
op_assign
id|pbm-&gt;parent
suffix:semicolon
id|isa_dev-&gt;irq
op_assign
id|pcic
op_member_access_from_pointer
id|irq_build
c_func
(paren
id|pbm
comma
l_int|NULL
comma
id|ino
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
)brace
DECL|function|isa_fill_children
r_static
r_void
id|__init
id|isa_fill_children
c_func
(paren
r_struct
id|isa_device
op_star
id|parent_isa_dev
)paren
(brace
r_int
id|node
op_assign
id|prom_getchild
c_func
(paren
id|parent_isa_dev-&gt;prom_node
)paren
suffix:semicolon
r_if
c_cond
(paren
id|node
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; -&gt;&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|node
op_ne
l_int|0
)paren
(brace
r_struct
id|isa_device
op_star
id|isa_dev
suffix:semicolon
r_int
id|prop_len
suffix:semicolon
id|isa_dev
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|isa_dev
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isa_dev
)paren
(brace
id|fatal_err
c_func
(paren
l_string|&quot;cannot allocate child isa_dev&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
id|isa_dev
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|isa_dev
)paren
)paren
suffix:semicolon
multiline_comment|/* Link it in to parent. */
id|isa_dev-&gt;next
op_assign
id|parent_isa_dev-&gt;child
suffix:semicolon
id|parent_isa_dev-&gt;child
op_assign
id|isa_dev
suffix:semicolon
id|isa_dev-&gt;bus
op_assign
id|parent_isa_dev-&gt;bus
suffix:semicolon
id|isa_dev-&gt;prom_node
op_assign
id|node
suffix:semicolon
id|prop_len
op_assign
id|prom_getproperty
c_func
(paren
id|node
comma
l_string|&quot;name&quot;
comma
(paren
r_char
op_star
)paren
id|isa_dev-&gt;prom_name
comma
r_sizeof
(paren
id|isa_dev-&gt;prom_name
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prop_len
op_le
l_int|0
)paren
(brace
id|fatal_err
c_func
(paren
l_string|&quot;cannot get child isa_dev OBP node name&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|prop_len
op_assign
id|prom_getproperty
c_func
(paren
id|node
comma
l_string|&quot;compatible&quot;
comma
(paren
r_char
op_star
)paren
id|isa_dev-&gt;compatible
comma
r_sizeof
(paren
id|isa_dev-&gt;compatible
)paren
)paren
suffix:semicolon
multiline_comment|/* Not having this is OK. */
r_if
c_cond
(paren
id|prop_len
op_le
l_int|0
)paren
id|isa_dev-&gt;compatible
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|isa_dev_get_resource
c_func
(paren
id|isa_dev
)paren
suffix:semicolon
id|isa_dev_get_irq
c_func
(paren
id|isa_dev
)paren
suffix:semicolon
id|report_dev
c_func
(paren
id|isa_dev
comma
l_int|1
)paren
suffix:semicolon
id|node
op_assign
id|prom_getsibling
c_func
(paren
id|node
)paren
suffix:semicolon
)brace
)brace
DECL|function|isa_fill_devices
r_static
r_void
id|__init
id|isa_fill_devices
c_func
(paren
r_struct
id|isa_bridge
op_star
id|isa_br
)paren
(brace
r_int
id|node
op_assign
id|prom_getchild
c_func
(paren
id|isa_br-&gt;prom_node
)paren
suffix:semicolon
r_while
c_loop
(paren
id|node
op_ne
l_int|0
)paren
(brace
r_struct
id|isa_device
op_star
id|isa_dev
suffix:semicolon
r_int
id|prop_len
suffix:semicolon
id|isa_dev
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|isa_dev
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isa_dev
)paren
(brace
id|fatal_err
c_func
(paren
l_string|&quot;cannot allocate isa_dev&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
id|isa_dev
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|isa_dev
)paren
)paren
suffix:semicolon
multiline_comment|/* Link it in. */
id|isa_dev-&gt;next
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|isa_br-&gt;devices
op_eq
l_int|NULL
)paren
(brace
id|isa_br-&gt;devices
op_assign
id|isa_dev
suffix:semicolon
)brace
r_else
(brace
r_struct
id|isa_device
op_star
id|tmp
op_assign
id|isa_br-&gt;devices
suffix:semicolon
r_while
c_loop
(paren
id|tmp-&gt;next
)paren
id|tmp
op_assign
id|tmp-&gt;next
suffix:semicolon
id|tmp-&gt;next
op_assign
id|isa_dev
suffix:semicolon
)brace
id|isa_dev-&gt;bus
op_assign
id|isa_br
suffix:semicolon
id|isa_dev-&gt;prom_node
op_assign
id|node
suffix:semicolon
id|prop_len
op_assign
id|prom_getproperty
c_func
(paren
id|node
comma
l_string|&quot;name&quot;
comma
(paren
r_char
op_star
)paren
id|isa_dev-&gt;prom_name
comma
r_sizeof
(paren
id|isa_dev-&gt;prom_name
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prop_len
op_le
l_int|0
)paren
(brace
id|fatal_err
c_func
(paren
l_string|&quot;cannot get isa_dev OBP node name&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|prop_len
op_assign
id|prom_getproperty
c_func
(paren
id|node
comma
l_string|&quot;compatible&quot;
comma
(paren
r_char
op_star
)paren
id|isa_dev-&gt;compatible
comma
r_sizeof
(paren
id|isa_dev-&gt;compatible
)paren
)paren
suffix:semicolon
multiline_comment|/* Not having this is OK. */
r_if
c_cond
(paren
id|prop_len
op_le
l_int|0
)paren
id|isa_dev-&gt;compatible
(braket
l_int|0
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|isa_dev_get_resource
c_func
(paren
id|isa_dev
)paren
suffix:semicolon
id|isa_dev_get_irq
c_func
(paren
id|isa_dev
)paren
suffix:semicolon
id|report_dev
c_func
(paren
id|isa_dev
comma
l_int|0
)paren
suffix:semicolon
id|isa_fill_children
c_func
(paren
id|isa_dev
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;]&quot;
)paren
suffix:semicolon
id|node
op_assign
id|prom_getsibling
c_func
(paren
id|node
)paren
suffix:semicolon
)brace
)brace
DECL|function|isa_init
r_void
id|__init
id|isa_init
c_func
(paren
r_void
)paren
(brace
r_struct
id|pci_dev
op_star
id|pdev
suffix:semicolon
r_int
r_int
id|vendor
comma
id|device
suffix:semicolon
r_int
id|index
op_assign
l_int|0
suffix:semicolon
id|vendor
op_assign
id|PCI_VENDOR_ID_AL
suffix:semicolon
id|device
op_assign
id|PCI_DEVICE_ID_AL_M1533
suffix:semicolon
id|pdev
op_assign
l_int|NULL
suffix:semicolon
r_while
c_loop
(paren
(paren
id|pdev
op_assign
id|pci_find_device
c_func
(paren
id|vendor
comma
id|device
comma
id|pdev
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_struct
id|pcidev_cookie
op_star
id|pdev_cookie
suffix:semicolon
r_struct
id|pci_pbm_info
op_star
id|pbm
suffix:semicolon
r_struct
id|isa_bridge
op_star
id|isa_br
suffix:semicolon
r_int
id|prop_len
suffix:semicolon
id|pdev_cookie
op_assign
id|pdev-&gt;sysdata
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pdev_cookie
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ISA: Warning, ISA bridge ignored due to &quot;
l_string|&quot;lack of OBP data.&bslash;n&quot;
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|pbm
op_assign
id|pdev_cookie-&gt;pbm
suffix:semicolon
id|isa_br
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|isa_br
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isa_br
)paren
(brace
id|fatal_err
c_func
(paren
l_string|&quot;cannot allocate isa_bridge&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
id|isa_br
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|isa_br
)paren
)paren
suffix:semicolon
multiline_comment|/* Link it in. */
id|isa_br-&gt;next
op_assign
id|isa_chain
suffix:semicolon
id|isa_chain
op_assign
id|isa_br
suffix:semicolon
id|isa_br-&gt;parent
op_assign
id|pbm
suffix:semicolon
id|isa_br-&gt;self
op_assign
id|pdev
suffix:semicolon
id|isa_br-&gt;index
op_assign
id|index
op_increment
suffix:semicolon
id|isa_br-&gt;prom_node
op_assign
id|pdev_cookie-&gt;prom_node
suffix:semicolon
id|strncpy
c_func
(paren
id|isa_br-&gt;prom_name
comma
id|pdev_cookie-&gt;prom_name
comma
r_sizeof
(paren
id|isa_br-&gt;prom_name
)paren
)paren
suffix:semicolon
id|prop_len
op_assign
id|prom_getproperty
c_func
(paren
id|isa_br-&gt;prom_node
comma
l_string|&quot;ranges&quot;
comma
(paren
r_char
op_star
)paren
id|isa_br-&gt;isa_ranges
comma
r_sizeof
(paren
id|isa_br-&gt;isa_ranges
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prop_len
op_le
l_int|0
)paren
id|isa_br-&gt;num_isa_ranges
op_assign
l_int|0
suffix:semicolon
r_else
id|isa_br-&gt;num_isa_ranges
op_assign
(paren
id|prop_len
op_div
r_sizeof
(paren
r_struct
id|linux_prom_isa_ranges
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;isa%d:&quot;
comma
id|isa_br-&gt;index
)paren
suffix:semicolon
id|isa_fill_devices
c_func
(paren
id|isa_br
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
eof
