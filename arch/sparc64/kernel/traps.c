multiline_comment|/* $Id: traps.c,v 1.84 2002/01/30 01:39:56 davem Exp $&n; * arch/sparc64/kernel/traps.c&n; *&n; * Copyright (C) 1995,1997 David S. Miller (davem@caip.rutgers.edu)&n; * Copyright (C) 1997,1999,2000 Jakub Jelinek (jakub@redhat.com)&n; */
multiline_comment|/*&n; * I like traps on v9, :))))&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/sched.h&gt;  /* for jiffies */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/signal.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;asm/delay.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/ptrace.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/unistd.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/fpumacro.h&gt;
macro_line|#include &lt;asm/lsu.h&gt;
macro_line|#include &lt;asm/dcu.h&gt;
macro_line|#include &lt;asm/estate.h&gt;
macro_line|#include &lt;asm/chafsr.h&gt;
macro_line|#include &lt;asm/psrcompat.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#ifdef CONFIG_KMOD
macro_line|#include &lt;linux/kmod.h&gt;
macro_line|#endif
DECL|function|bad_trap
r_void
id|bad_trap
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|lvl
)paren
(brace
r_char
id|buffer
(braket
l_int|32
)braket
suffix:semicolon
id|siginfo_t
id|info
suffix:semicolon
r_if
c_cond
(paren
id|lvl
OL
l_int|0x100
)paren
(brace
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Bad hw trap %lx at tl0&bslash;n&quot;
comma
id|lvl
)paren
suffix:semicolon
id|die_if_kernel
c_func
(paren
id|buffer
comma
id|regs
)paren
suffix:semicolon
)brace
id|lvl
op_sub_assign
l_int|0x100
suffix:semicolon
r_if
c_cond
(paren
id|regs-&gt;tstate
op_amp
id|TSTATE_PRIV
)paren
(brace
id|sprintf
c_func
(paren
id|buffer
comma
l_string|&quot;Kernel bad sw trap %lx&quot;
comma
id|lvl
)paren
suffix:semicolon
id|die_if_kernel
(paren
id|buffer
comma
id|regs
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|current-&gt;thread.flags
op_amp
id|SPARC_FLAG_32BIT
)paren
op_ne
l_int|0
)paren
(brace
id|regs-&gt;tpc
op_and_assign
l_int|0xffffffff
suffix:semicolon
id|regs-&gt;tnpc
op_and_assign
l_int|0xffffffff
suffix:semicolon
)brace
id|info.si_signo
op_assign
id|SIGILL
suffix:semicolon
id|info.si_errno
op_assign
l_int|0
suffix:semicolon
id|info.si_code
op_assign
id|ILL_ILLTRP
suffix:semicolon
id|info.si_addr
op_assign
(paren
r_void
op_star
)paren
id|regs-&gt;tpc
suffix:semicolon
id|info.si_trapno
op_assign
id|lvl
suffix:semicolon
id|force_sig_info
c_func
(paren
id|SIGILL
comma
op_amp
id|info
comma
id|current
)paren
suffix:semicolon
)brace
DECL|function|bad_trap_tl1
r_void
id|bad_trap_tl1
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
id|lvl
)paren
(brace
r_char
id|buffer
(braket
l_int|24
)braket
suffix:semicolon
id|sprintf
(paren
id|buffer
comma
l_string|&quot;Bad trap %lx at tl&gt;0&quot;
comma
id|lvl
)paren
suffix:semicolon
id|die_if_kernel
(paren
id|buffer
comma
id|regs
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_DEBUG_BUGVERBOSE
DECL|function|do_BUG
r_void
id|do_BUG
c_func
(paren
r_const
r_char
op_star
id|file
comma
r_int
id|line
)paren
(brace
id|bust_spinlocks
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;kernel BUG at %s:%d!&bslash;n&quot;
comma
id|file
comma
id|line
)paren
suffix:semicolon
)brace
macro_line|#endif
DECL|function|instruction_access_exception
r_void
id|instruction_access_exception
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
r_int
id|sfsr
comma
r_int
r_int
id|sfar
)paren
(brace
id|siginfo_t
id|info
suffix:semicolon
r_if
c_cond
(paren
id|regs-&gt;tstate
op_amp
id|TSTATE_PRIV
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;instruction_access_exception: SFSR[%016lx] SFAR[%016lx], going.&bslash;n&quot;
comma
id|sfsr
comma
id|sfar
)paren
suffix:semicolon
id|die_if_kernel
c_func
(paren
l_string|&quot;Iax&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|current-&gt;thread.flags
op_amp
id|SPARC_FLAG_32BIT
)paren
op_ne
l_int|0
)paren
(brace
id|regs-&gt;tpc
op_and_assign
l_int|0xffffffff
suffix:semicolon
id|regs-&gt;tnpc
op_and_assign
l_int|0xffffffff
suffix:semicolon
)brace
id|info.si_signo
op_assign
id|SIGSEGV
suffix:semicolon
id|info.si_errno
op_assign
l_int|0
suffix:semicolon
id|info.si_code
op_assign
id|SEGV_MAPERR
suffix:semicolon
id|info.si_addr
op_assign
(paren
r_void
op_star
)paren
id|regs-&gt;tpc
suffix:semicolon
id|info.si_trapno
op_assign
l_int|0
suffix:semicolon
id|force_sig_info
c_func
(paren
id|SIGSEGV
comma
op_amp
id|info
comma
id|current
)paren
suffix:semicolon
)brace
DECL|function|data_access_exception
r_void
id|data_access_exception
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
r_int
id|sfsr
comma
r_int
r_int
id|sfar
)paren
(brace
id|siginfo_t
id|info
suffix:semicolon
r_if
c_cond
(paren
id|regs-&gt;tstate
op_amp
id|TSTATE_PRIV
)paren
(brace
multiline_comment|/* Test if this comes from uaccess places. */
r_int
r_int
id|fixup
comma
id|g2
suffix:semicolon
id|g2
op_assign
id|regs-&gt;u_regs
(braket
id|UREG_G2
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fixup
op_assign
id|search_exception_table
(paren
id|regs-&gt;tpc
comma
op_amp
id|g2
)paren
)paren
)paren
(brace
multiline_comment|/* Ouch, somebody is trying ugly VM hole tricks on us... */
macro_line|#ifdef DEBUG_EXCEPTIONS
id|printk
c_func
(paren
l_string|&quot;Exception: PC&lt;%016lx&gt; faddr&lt;UNKNOWN&gt;&bslash;n&quot;
comma
id|regs-&gt;tpc
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;EX_TABLE: insn&lt;%016lx&gt; fixup&lt;%016lx&gt; &quot;
l_string|&quot;g2&lt;%016lx&gt;&bslash;n&quot;
comma
id|regs-&gt;tpc
comma
id|fixup
comma
id|g2
)paren
suffix:semicolon
macro_line|#endif
id|regs-&gt;tpc
op_assign
id|fixup
suffix:semicolon
id|regs-&gt;tnpc
op_assign
id|regs-&gt;tpc
op_plus
l_int|4
suffix:semicolon
id|regs-&gt;u_regs
(braket
id|UREG_G2
)braket
op_assign
id|g2
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* Shit... */
id|printk
c_func
(paren
l_string|&quot;data_access_exception: SFSR[%016lx] SFAR[%016lx], going.&bslash;n&quot;
comma
id|sfsr
comma
id|sfar
)paren
suffix:semicolon
id|die_if_kernel
c_func
(paren
l_string|&quot;Dax&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
id|info.si_signo
op_assign
id|SIGSEGV
suffix:semicolon
id|info.si_errno
op_assign
l_int|0
suffix:semicolon
id|info.si_code
op_assign
id|SEGV_MAPERR
suffix:semicolon
id|info.si_addr
op_assign
(paren
r_void
op_star
)paren
id|sfar
suffix:semicolon
id|info.si_trapno
op_assign
l_int|0
suffix:semicolon
id|force_sig_info
c_func
(paren
id|SIGSEGV
comma
op_amp
id|info
comma
id|current
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PCI
multiline_comment|/* This is really pathetic... */
r_extern
r_volatile
r_int
id|pci_poke_in_progress
suffix:semicolon
r_extern
r_volatile
r_int
id|pci_poke_cpu
suffix:semicolon
r_extern
r_volatile
r_int
id|pci_poke_faulted
suffix:semicolon
macro_line|#endif
multiline_comment|/* When access exceptions happen, we must do this. */
DECL|function|clean_and_reenable_l1_caches
r_static
r_void
id|clean_and_reenable_l1_caches
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|va
suffix:semicolon
r_if
c_cond
(paren
id|tlb_type
op_eq
id|spitfire
)paren
(brace
multiline_comment|/* Clean &squot;em. */
r_for
c_loop
(paren
id|va
op_assign
l_int|0
suffix:semicolon
id|va
OL
(paren
id|PAGE_SIZE
op_lshift
l_int|1
)paren
suffix:semicolon
id|va
op_add_assign
l_int|32
)paren
(brace
id|spitfire_put_icache_tag
c_func
(paren
id|va
comma
l_int|0x0
)paren
suffix:semicolon
id|spitfire_put_dcache_tag
c_func
(paren
id|va
comma
l_int|0x0
)paren
suffix:semicolon
)brace
multiline_comment|/* Re-enable in LSU. */
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;flush %%g6&bslash;n&bslash;t&quot;
l_string|&quot;membar #Sync&bslash;n&bslash;t&quot;
l_string|&quot;stxa %0, [%%g0] %1&bslash;n&bslash;t&quot;
l_string|&quot;membar #Sync&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;r&quot;
(paren
id|LSU_CONTROL_IC
op_or
id|LSU_CONTROL_DC
op_or
id|LSU_CONTROL_IM
op_or
id|LSU_CONTROL_DM
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_LSU_CONTROL
)paren
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tlb_type
op_eq
id|cheetah
)paren
(brace
multiline_comment|/* Flush D-cache */
r_for
c_loop
(paren
id|va
op_assign
l_int|0
suffix:semicolon
id|va
OL
(paren
l_int|1
op_lshift
l_int|16
)paren
suffix:semicolon
id|va
op_add_assign
(paren
l_int|1
op_lshift
l_int|5
)paren
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;stxa %%g0, [%0] %1&bslash;n&bslash;t&quot;
l_string|&quot;membar #Sync&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;r&quot;
(paren
id|va
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_DCACHE_TAG
)paren
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|function|do_iae
r_void
id|do_iae
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|siginfo_t
id|info
suffix:semicolon
id|clean_and_reenable_l1_caches
c_func
(paren
)paren
suffix:semicolon
id|info.si_signo
op_assign
id|SIGBUS
suffix:semicolon
id|info.si_errno
op_assign
l_int|0
suffix:semicolon
id|info.si_code
op_assign
id|BUS_OBJERR
suffix:semicolon
id|info.si_addr
op_assign
(paren
r_void
op_star
)paren
l_int|0
suffix:semicolon
id|info.si_trapno
op_assign
l_int|0
suffix:semicolon
id|force_sig_info
c_func
(paren
id|SIGBUS
comma
op_amp
id|info
comma
id|current
)paren
suffix:semicolon
)brace
DECL|function|do_dae
r_void
id|do_dae
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
macro_line|#ifdef CONFIG_PCI
r_if
c_cond
(paren
id|pci_poke_in_progress
op_logical_and
id|pci_poke_cpu
op_eq
id|smp_processor_id
c_func
(paren
)paren
)paren
(brace
id|clean_and_reenable_l1_caches
c_func
(paren
)paren
suffix:semicolon
id|pci_poke_faulted
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Why the fuck did they have to change this? */
r_if
c_cond
(paren
id|tlb_type
op_eq
id|cheetah
)paren
id|regs-&gt;tpc
op_add_assign
l_int|4
suffix:semicolon
id|regs-&gt;tnpc
op_assign
id|regs-&gt;tpc
op_plus
l_int|4
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
id|do_iae
c_func
(paren
id|regs
)paren
suffix:semicolon
)brace
DECL|variable|ecc_syndrome_table
r_static
r_char
id|ecc_syndrome_table
(braket
)braket
op_assign
(brace
l_int|0x4c
comma
l_int|0x40
comma
l_int|0x41
comma
l_int|0x48
comma
l_int|0x42
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x49
comma
l_int|0x43
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x49
comma
l_int|0x48
comma
l_int|0x49
comma
l_int|0x49
comma
l_int|0x4a
comma
l_int|0x44
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x20
comma
l_int|0x48
comma
l_int|0x39
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x25
comma
l_int|0x31
comma
l_int|0x48
comma
l_int|0x28
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x2c
comma
l_int|0x45
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x21
comma
l_int|0x48
comma
l_int|0x3d
comma
l_int|0x04
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x35
comma
l_int|0x48
comma
l_int|0x2d
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x29
comma
l_int|0x48
comma
l_int|0x00
comma
l_int|0x01
comma
l_int|0x48
comma
l_int|0x0a
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x0f
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x49
comma
l_int|0x49
comma
l_int|0x48
comma
l_int|0x46
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x2a
comma
l_int|0x48
comma
l_int|0x3b
comma
l_int|0x27
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x33
comma
l_int|0x48
comma
l_int|0x22
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x2e
comma
l_int|0x48
comma
l_int|0x19
comma
l_int|0x1d
comma
l_int|0x48
comma
l_int|0x1b
comma
l_int|0x4a
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x1f
comma
l_int|0x48
comma
l_int|0x4a
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x24
comma
l_int|0x48
comma
l_int|0x07
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x36
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x3e
comma
l_int|0x48
comma
l_int|0x30
comma
l_int|0x38
comma
l_int|0x48
comma
l_int|0x49
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x16
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x12
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x49
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x47
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x2f
comma
l_int|0x48
comma
l_int|0x3f
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x06
comma
l_int|0x37
comma
l_int|0x48
comma
l_int|0x23
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x2b
comma
l_int|0x48
comma
l_int|0x05
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x32
comma
l_int|0x26
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x3a
comma
l_int|0x48
comma
l_int|0x34
comma
l_int|0x3c
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x11
comma
l_int|0x15
comma
l_int|0x48
comma
l_int|0x13
comma
l_int|0x4a
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x17
comma
l_int|0x48
comma
l_int|0x4a
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x49
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x1e
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x1a
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x49
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x08
comma
l_int|0x0d
comma
l_int|0x48
comma
l_int|0x02
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x49
comma
l_int|0x03
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x49
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x49
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x49
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x10
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x14
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x49
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x49
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x18
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x1c
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x4a
comma
l_int|0x0c
comma
l_int|0x09
comma
l_int|0x48
comma
l_int|0x0e
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x0b
comma
l_int|0x48
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x48
comma
l_int|0x4b
comma
l_int|0x4b
comma
l_int|0x4a
)brace
suffix:semicolon
multiline_comment|/* cee_trap in entry.S encodes AFSR/UDBH/UDBL error status&n; * in the following format.  The AFAR is left as is, with&n; * reserved bits cleared, and is a raw 40-bit physical&n; * address.&n; */
DECL|macro|CE_STATUS_UDBH_UE
mdefine_line|#define CE_STATUS_UDBH_UE&t;&t;(1UL &lt;&lt; (43 + 9))
DECL|macro|CE_STATUS_UDBH_CE
mdefine_line|#define CE_STATUS_UDBH_CE&t;&t;(1UL &lt;&lt; (43 + 8))
DECL|macro|CE_STATUS_UDBH_ESYNDR
mdefine_line|#define CE_STATUS_UDBH_ESYNDR&t;&t;(0xffUL &lt;&lt; 43)
DECL|macro|CE_STATUS_UDBH_SHIFT
mdefine_line|#define CE_STATUS_UDBH_SHIFT&t;&t;43
DECL|macro|CE_STATUS_UDBL_UE
mdefine_line|#define CE_STATUS_UDBL_UE&t;&t;(1UL &lt;&lt; (33 + 9))
DECL|macro|CE_STATUS_UDBL_CE
mdefine_line|#define CE_STATUS_UDBL_CE&t;&t;(1UL &lt;&lt; (33 + 8))
DECL|macro|CE_STATUS_UDBL_ESYNDR
mdefine_line|#define CE_STATUS_UDBL_ESYNDR&t;&t;(0xffUL &lt;&lt; 33)
DECL|macro|CE_STATUS_UDBL_SHIFT
mdefine_line|#define CE_STATUS_UDBL_SHIFT&t;&t;33
DECL|macro|CE_STATUS_AFSR_MASK
mdefine_line|#define CE_STATUS_AFSR_MASK&t;&t;(0x1ffffffffUL)
DECL|macro|CE_STATUS_AFSR_ME
mdefine_line|#define CE_STATUS_AFSR_ME&t;&t;(1UL &lt;&lt; 32)
DECL|macro|CE_STATUS_AFSR_PRIV
mdefine_line|#define CE_STATUS_AFSR_PRIV&t;&t;(1UL &lt;&lt; 31)
DECL|macro|CE_STATUS_AFSR_ISAP
mdefine_line|#define CE_STATUS_AFSR_ISAP&t;&t;(1UL &lt;&lt; 30)
DECL|macro|CE_STATUS_AFSR_ETP
mdefine_line|#define CE_STATUS_AFSR_ETP&t;&t;(1UL &lt;&lt; 29)
DECL|macro|CE_STATUS_AFSR_IVUE
mdefine_line|#define CE_STATUS_AFSR_IVUE&t;&t;(1UL &lt;&lt; 28)
DECL|macro|CE_STATUS_AFSR_TO
mdefine_line|#define CE_STATUS_AFSR_TO&t;&t;(1UL &lt;&lt; 27)
DECL|macro|CE_STATUS_AFSR_BERR
mdefine_line|#define CE_STATUS_AFSR_BERR&t;&t;(1UL &lt;&lt; 26)
DECL|macro|CE_STATUS_AFSR_LDP
mdefine_line|#define CE_STATUS_AFSR_LDP&t;&t;(1UL &lt;&lt; 25)
DECL|macro|CE_STATUS_AFSR_CP
mdefine_line|#define CE_STATUS_AFSR_CP&t;&t;(1UL &lt;&lt; 24)
DECL|macro|CE_STATUS_AFSR_WP
mdefine_line|#define CE_STATUS_AFSR_WP&t;&t;(1UL &lt;&lt; 23)
DECL|macro|CE_STATUS_AFSR_EDP
mdefine_line|#define CE_STATUS_AFSR_EDP&t;&t;(1UL &lt;&lt; 22)
DECL|macro|CE_STATUS_AFSR_UE
mdefine_line|#define CE_STATUS_AFSR_UE&t;&t;(1UL &lt;&lt; 21)
DECL|macro|CE_STATUS_AFSR_CE
mdefine_line|#define CE_STATUS_AFSR_CE&t;&t;(1UL &lt;&lt; 20)
DECL|macro|CE_STATUS_AFSR_ETS
mdefine_line|#define CE_STATUS_AFSR_ETS&t;&t;(0xfUL &lt;&lt; 16)
DECL|macro|CE_STATUS_AFSR_ETS_SHIFT
mdefine_line|#define CE_STATUS_AFSR_ETS_SHIFT&t;16
DECL|macro|CE_STATUS_AFSR_PSYND
mdefine_line|#define CE_STATUS_AFSR_PSYND&t;&t;(0xffffUL &lt;&lt; 0)
DECL|macro|CE_STATUS_AFSR_PSYND_SHIFT
mdefine_line|#define CE_STATUS_AFSR_PSYND_SHIFT&t;0
multiline_comment|/* Layout of Ecache TAG Parity Syndrome of AFSR */
DECL|macro|AFSR_ETSYNDROME_7_0
mdefine_line|#define AFSR_ETSYNDROME_7_0&t;&t;0x1UL /* E$-tag bus bits  &lt;7:0&gt; */
DECL|macro|AFSR_ETSYNDROME_15_8
mdefine_line|#define AFSR_ETSYNDROME_15_8&t;&t;0x2UL /* E$-tag bus bits &lt;15:8&gt; */
DECL|macro|AFSR_ETSYNDROME_21_16
mdefine_line|#define AFSR_ETSYNDROME_21_16&t;&t;0x4UL /* E$-tag bus bits &lt;21:16&gt; */
DECL|macro|AFSR_ETSYNDROME_24_22
mdefine_line|#define AFSR_ETSYNDROME_24_22&t;&t;0x8UL /* E$-tag bus bits &lt;24:22&gt; */
DECL|variable|syndrome_unknown
r_static
r_char
op_star
id|syndrome_unknown
op_assign
l_string|&quot;&lt;Unknown&gt;&quot;
suffix:semicolon
DECL|function|cee_log
id|asmlinkage
r_void
id|cee_log
c_func
(paren
r_int
r_int
id|ce_status
comma
r_int
r_int
id|afar
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_char
id|memmod_str
(braket
l_int|64
)braket
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
r_int
r_int
id|scode
comma
id|udb_reg
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;CPU[%d]: Correctable ECC Error &quot;
l_string|&quot;AFSR[%lx] AFAR[%016lx] UDBL[%lx] UDBH[%lx]&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
(paren
id|ce_status
op_amp
id|CE_STATUS_AFSR_MASK
)paren
comma
id|afar
comma
(paren
(paren
id|ce_status
op_rshift
id|CE_STATUS_UDBL_SHIFT
)paren
op_amp
l_int|0x3ffUL
)paren
comma
(paren
(paren
id|ce_status
op_rshift
id|CE_STATUS_UDBH_SHIFT
)paren
op_amp
l_int|0x3ffUL
)paren
)paren
suffix:semicolon
id|udb_reg
op_assign
(paren
(paren
id|ce_status
op_rshift
id|CE_STATUS_UDBL_SHIFT
)paren
op_amp
l_int|0x3ffUL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|udb_reg
op_amp
(paren
l_int|1
op_lshift
l_int|8
)paren
)paren
(brace
id|scode
op_assign
id|ecc_syndrome_table
(braket
id|udb_reg
op_amp
l_int|0xff
)braket
suffix:semicolon
r_if
c_cond
(paren
id|prom_getunumber
c_func
(paren
id|scode
comma
id|afar
comma
id|memmod_str
comma
r_sizeof
(paren
id|memmod_str
)paren
)paren
op_eq
op_minus
l_int|1
)paren
id|p
op_assign
id|syndrome_unknown
suffix:semicolon
r_else
id|p
op_assign
id|memmod_str
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;CPU[%d]: UDBL Syndrome[%x] &quot;
l_string|&quot;Memory Module &bslash;&quot;%s&bslash;&quot;&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|scode
comma
id|p
)paren
suffix:semicolon
)brace
id|udb_reg
op_assign
(paren
(paren
id|ce_status
op_rshift
id|CE_STATUS_UDBH_SHIFT
)paren
op_amp
l_int|0x3ffUL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|udb_reg
op_amp
(paren
l_int|1
op_lshift
l_int|8
)paren
)paren
(brace
id|scode
op_assign
id|ecc_syndrome_table
(braket
id|udb_reg
op_amp
l_int|0xff
)braket
suffix:semicolon
r_if
c_cond
(paren
id|prom_getunumber
c_func
(paren
id|scode
comma
id|afar
comma
id|memmod_str
comma
r_sizeof
(paren
id|memmod_str
)paren
)paren
op_eq
op_minus
l_int|1
)paren
id|p
op_assign
id|syndrome_unknown
suffix:semicolon
r_else
id|p
op_assign
id|memmod_str
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;CPU[%d]: UDBH Syndrome[%x] &quot;
l_string|&quot;Memory Module &bslash;&quot;%s&bslash;&quot;&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|scode
comma
id|p
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Cheetah error trap handling. */
DECL|variable|ecache_flush_physbase
r_static
r_int
r_int
id|ecache_flush_physbase
suffix:semicolon
DECL|variable|ecache_flush_linesize
r_static
r_int
r_int
id|ecache_flush_linesize
suffix:semicolon
DECL|variable|ecache_flush_size
r_static
r_int
r_int
id|ecache_flush_size
suffix:semicolon
multiline_comment|/* WARNING: The error trap handlers in assembly know the precise&n; *&t;    layout of the following structure.&n; *&n; * C-level handlers below use this information to log the error&n; * and then determine how to recover (if possible).&n; */
DECL|struct|cheetah_err_info
r_struct
id|cheetah_err_info
(brace
DECL|member|afsr
multiline_comment|/*0x00*/
id|u64
id|afsr
suffix:semicolon
DECL|member|afar
multiline_comment|/*0x08*/
id|u64
id|afar
suffix:semicolon
multiline_comment|/* D-cache state */
DECL|member|dcache_data
multiline_comment|/*0x10*/
id|u64
id|dcache_data
(braket
l_int|4
)braket
suffix:semicolon
multiline_comment|/* The actual data&t;*/
DECL|member|dcache_index
multiline_comment|/*0x30*/
id|u64
id|dcache_index
suffix:semicolon
multiline_comment|/* D-cache index&t;*/
DECL|member|dcache_tag
multiline_comment|/*0x38*/
id|u64
id|dcache_tag
suffix:semicolon
multiline_comment|/* D-cache tag/valid&t;*/
DECL|member|dcache_utag
multiline_comment|/*0x40*/
id|u64
id|dcache_utag
suffix:semicolon
multiline_comment|/* D-cache microtag&t;*/
DECL|member|dcache_stag
multiline_comment|/*0x48*/
id|u64
id|dcache_stag
suffix:semicolon
multiline_comment|/* D-cache snooptag&t;*/
multiline_comment|/* I-cache state */
DECL|member|icache_data
multiline_comment|/*0x50*/
id|u64
id|icache_data
(braket
l_int|8
)braket
suffix:semicolon
multiline_comment|/* The actual insns + predecode&t;*/
DECL|member|icache_index
multiline_comment|/*0x90*/
id|u64
id|icache_index
suffix:semicolon
multiline_comment|/* I-cache index&t;*/
DECL|member|icache_tag
multiline_comment|/*0x98*/
id|u64
id|icache_tag
suffix:semicolon
multiline_comment|/* I-cache phys tag&t;*/
DECL|member|icache_utag
multiline_comment|/*0xa0*/
id|u64
id|icache_utag
suffix:semicolon
multiline_comment|/* I-cache microtag&t;*/
DECL|member|icache_stag
multiline_comment|/*0xa8*/
id|u64
id|icache_stag
suffix:semicolon
multiline_comment|/* I-cache snooptag&t;*/
DECL|member|icache_upper
multiline_comment|/*0xb0*/
id|u64
id|icache_upper
suffix:semicolon
multiline_comment|/* I-cache upper-tag&t;*/
DECL|member|icache_lower
multiline_comment|/*0xb8*/
id|u64
id|icache_lower
suffix:semicolon
multiline_comment|/* I-cache lower-tag&t;*/
multiline_comment|/* E-cache state */
DECL|member|ecache_data
multiline_comment|/*0xc0*/
id|u64
id|ecache_data
(braket
l_int|4
)braket
suffix:semicolon
multiline_comment|/* 32 bytes from staging registers */
DECL|member|ecache_index
multiline_comment|/*0xe0*/
id|u64
id|ecache_index
suffix:semicolon
multiline_comment|/* E-cache index&t;*/
DECL|member|ecache_tag
multiline_comment|/*0xe8*/
id|u64
id|ecache_tag
suffix:semicolon
multiline_comment|/* E-cache tag/state&t;*/
DECL|member|__pad
multiline_comment|/*0xf0*/
id|u64
id|__pad
(braket
l_int|32
op_minus
l_int|30
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|CHAFSR_INVALID
mdefine_line|#define CHAFSR_INVALID&t;&t;((u64)-1L)
multiline_comment|/* This is allocated at boot time based upon the largest hardware&n; * cpu ID in the system.  We allocate two entries per cpu, one for&n; * TL==0 logging and one for TL &gt;= 1 logging.&n; */
DECL|variable|cheetah_error_log
r_struct
id|cheetah_err_info
op_star
id|cheetah_error_log
suffix:semicolon
DECL|function|cheetah_get_error_log
r_static
id|__inline__
r_struct
id|cheetah_err_info
op_star
id|cheetah_get_error_log
c_func
(paren
r_int
r_int
id|afsr
)paren
(brace
r_struct
id|cheetah_err_info
op_star
id|p
suffix:semicolon
r_int
id|cpu
op_assign
id|smp_processor_id
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cheetah_error_log
)paren
r_return
l_int|NULL
suffix:semicolon
id|p
op_assign
id|cheetah_error_log
op_plus
(paren
id|cpu
op_star
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|afsr
op_amp
id|CHAFSR_TL1
)paren
op_ne
l_int|0UL
)paren
id|p
op_increment
suffix:semicolon
r_return
id|p
suffix:semicolon
)brace
r_extern
r_int
r_int
id|tl0_fecc
(braket
)braket
comma
id|tl1_fecc
(braket
)braket
suffix:semicolon
r_extern
r_int
r_int
id|tl0_cee
(braket
)braket
comma
id|tl1_cee
(braket
)braket
suffix:semicolon
r_extern
r_int
r_int
id|tl0_iae
(braket
)braket
comma
id|tl1_iae
(braket
)braket
suffix:semicolon
r_extern
r_int
r_int
id|tl0_dae
(braket
)braket
comma
id|tl1_dae
(braket
)braket
suffix:semicolon
r_extern
r_int
r_int
id|cheetah_fecc_trap_vector
(braket
)braket
comma
id|cheetah_fecc_trap_vector_tl1
(braket
)braket
suffix:semicolon
r_extern
r_int
r_int
id|cheetah_cee_trap_vector
(braket
)braket
comma
id|cheetah_cee_trap_vector_tl1
(braket
)braket
suffix:semicolon
r_extern
r_int
r_int
id|cheetah_deferred_trap_vector
(braket
)braket
comma
id|cheetah_deferred_trap_vector_tl1
(braket
)braket
suffix:semicolon
DECL|function|cheetah_ecache_flush_init
r_void
id|cheetah_ecache_flush_init
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|largest_size
comma
id|smallest_linesize
comma
id|order
suffix:semicolon
r_char
id|type
(braket
l_int|16
)braket
suffix:semicolon
r_int
id|node
comma
id|highest_cpu
comma
id|i
suffix:semicolon
multiline_comment|/* Scan all cpu device tree nodes, note two values:&n;&t; * 1) largest E-cache size&n;&t; * 2) smallest E-cache line size&n;&t; */
id|largest_size
op_assign
l_int|0UL
suffix:semicolon
id|smallest_linesize
op_assign
op_complement
l_int|0UL
suffix:semicolon
id|node
op_assign
id|prom_getchild
c_func
(paren
id|prom_root_node
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|node
op_assign
id|prom_getsibling
c_func
(paren
id|node
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|prom_getstring
c_func
(paren
id|node
comma
l_string|&quot;device_type&quot;
comma
id|type
comma
r_sizeof
(paren
id|type
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|type
comma
l_string|&quot;cpu&quot;
)paren
)paren
(brace
r_int
r_int
id|val
suffix:semicolon
id|val
op_assign
id|prom_getintdefault
c_func
(paren
id|node
comma
l_string|&quot;ecache-size&quot;
comma
(paren
l_int|2
op_star
l_int|1024
op_star
l_int|1024
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
OG
id|largest_size
)paren
id|largest_size
op_assign
id|val
suffix:semicolon
id|val
op_assign
id|prom_getintdefault
c_func
(paren
id|node
comma
l_string|&quot;ecache-line-size&quot;
comma
l_int|64
)paren
suffix:semicolon
r_if
c_cond
(paren
id|val
OL
id|smallest_linesize
)paren
id|smallest_linesize
op_assign
id|val
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|largest_size
op_eq
l_int|0UL
op_logical_or
id|smallest_linesize
op_eq
op_complement
l_int|0UL
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;cheetah_ecache_flush_init: Cannot probe cpu E-cache &quot;
l_string|&quot;parameters.&bslash;n&quot;
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|ecache_flush_size
op_assign
(paren
l_int|2
op_star
id|largest_size
)paren
suffix:semicolon
id|ecache_flush_linesize
op_assign
id|smallest_linesize
suffix:semicolon
multiline_comment|/* Discover a physically contiguous chunk of physical&n;&t; * memory in &squot;sp_banks&squot; of size ecache_flush_size calculated&n;&t; * above.  Store the physical base of this area at&n;&t; * ecache_flush_physbase.&n;&t; */
r_for
c_loop
(paren
id|node
op_assign
l_int|0
suffix:semicolon
suffix:semicolon
id|node
op_increment
)paren
(brace
r_if
c_cond
(paren
id|sp_banks
(braket
id|node
)braket
dot
id|num_bytes
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|sp_banks
(braket
id|node
)braket
dot
id|num_bytes
op_ge
id|ecache_flush_size
)paren
(brace
id|ecache_flush_physbase
op_assign
id|sp_banks
(braket
id|node
)braket
dot
id|base_addr
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
multiline_comment|/* Note: Zero would be a valid value of ecache_flush_physbase so&n;&t; * don&squot;t use that as the success test. :-)&n;&t; */
r_if
c_cond
(paren
id|sp_banks
(braket
id|node
)braket
dot
id|num_bytes
op_eq
l_int|0
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;cheetah_ecache_flush_init: Cannot find %d byte &quot;
l_string|&quot;contiguous physical memory.&bslash;n&quot;
comma
id|ecache_flush_size
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Now allocate error trap reporting scoreboard. */
id|highest_cpu
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef CONFIG_SMP
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
l_int|1UL
op_lshift
id|i
)paren
op_amp
id|cpu_present_map
)paren
id|highest_cpu
op_assign
id|i
suffix:semicolon
)brace
macro_line|#endif
id|highest_cpu
op_increment
suffix:semicolon
id|node
op_assign
id|highest_cpu
op_star
(paren
l_int|2
op_star
r_sizeof
(paren
r_struct
id|cheetah_err_info
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|order
op_assign
l_int|0
suffix:semicolon
id|order
OL
id|MAX_ORDER
suffix:semicolon
id|order
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|PAGE_SIZE
op_lshift
id|order
)paren
op_ge
id|node
)paren
r_break
suffix:semicolon
)brace
id|cheetah_error_log
op_assign
(paren
r_struct
id|cheetah_err_info
op_star
)paren
id|__get_free_pages
c_func
(paren
id|GFP_KERNEL
comma
id|order
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cheetah_error_log
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;cheetah_ecache_flush_init: Failed to allocate &quot;
l_string|&quot;error logging scoreboard (%d bytes).&bslash;n&quot;
comma
id|node
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
id|memset
c_func
(paren
id|cheetah_error_log
comma
l_int|0
comma
id|PAGE_SIZE
op_lshift
id|order
)paren
suffix:semicolon
multiline_comment|/* Mark all AFSRs as invalid so that the trap handler will&n;&t; * log new new information there.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|2
op_star
id|highest_cpu
suffix:semicolon
id|i
op_increment
)paren
id|cheetah_error_log
(braket
id|i
)braket
dot
id|afsr
op_assign
id|CHAFSR_INVALID
suffix:semicolon
multiline_comment|/* Now patch trap tables. */
id|memcpy
c_func
(paren
id|tl0_fecc
comma
id|cheetah_fecc_trap_vector
comma
(paren
l_int|8
op_star
l_int|4
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|tl1_fecc
comma
id|cheetah_fecc_trap_vector_tl1
comma
(paren
l_int|8
op_star
l_int|4
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|tl0_cee
comma
id|cheetah_cee_trap_vector
comma
(paren
l_int|8
op_star
l_int|4
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|tl1_cee
comma
id|cheetah_cee_trap_vector_tl1
comma
(paren
l_int|8
op_star
l_int|4
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|tl0_iae
comma
id|cheetah_deferred_trap_vector
comma
(paren
l_int|8
op_star
l_int|4
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|tl1_iae
comma
id|cheetah_deferred_trap_vector_tl1
comma
(paren
l_int|8
op_star
l_int|4
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|tl0_dae
comma
id|cheetah_deferred_trap_vector
comma
(paren
l_int|8
op_star
l_int|4
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|tl1_dae
comma
id|cheetah_deferred_trap_vector_tl1
comma
(paren
l_int|8
op_star
l_int|4
)paren
)paren
suffix:semicolon
id|flushi
c_func
(paren
id|PAGE_OFFSET
)paren
suffix:semicolon
)brace
DECL|function|cheetah_flush_ecache
r_static
r_void
id|cheetah_flush_ecache
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|flush_base
op_assign
id|ecache_flush_physbase
suffix:semicolon
r_int
r_int
id|flush_linesize
op_assign
id|ecache_flush_linesize
suffix:semicolon
r_int
r_int
id|flush_size
op_assign
id|ecache_flush_size
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;1: subcc&t;%0, %4, %0&bslash;n&bslash;t&quot;
l_string|&quot;   bne,pt&t;%%xcc, 1b&bslash;n&bslash;t&quot;
l_string|&quot;    ldxa&t;[%2 + %0] %3, %%g0&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=&amp;r&quot;
(paren
id|flush_size
)paren
suffix:colon
l_string|&quot;0&quot;
(paren
id|flush_size
)paren
comma
l_string|&quot;r&quot;
(paren
id|flush_base
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_PHYS_USE_EC
)paren
comma
l_string|&quot;r&quot;
(paren
id|flush_linesize
)paren
)paren
suffix:semicolon
)brace
DECL|function|cheetah_flush_ecache_line
r_static
r_void
id|cheetah_flush_ecache_line
c_func
(paren
r_int
r_int
id|physaddr
)paren
(brace
r_int
r_int
id|alias
suffix:semicolon
id|physaddr
op_and_assign
op_complement
(paren
l_int|8UL
op_minus
l_int|1UL
)paren
suffix:semicolon
id|physaddr
op_assign
(paren
id|ecache_flush_physbase
op_plus
(paren
id|physaddr
op_amp
(paren
(paren
id|ecache_flush_size
op_rshift
l_int|1UL
)paren
op_minus
l_int|1UL
)paren
)paren
)paren
suffix:semicolon
id|alias
op_assign
id|physaddr
op_plus
(paren
id|ecache_flush_size
op_rshift
l_int|1UL
)paren
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ldxa [%0] %2, %%g0&bslash;n&bslash;t&quot;
l_string|&quot;ldxa [%1] %2, %%g0&bslash;n&bslash;t&quot;
l_string|&quot;membar #Sync&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;r&quot;
(paren
id|physaddr
)paren
comma
l_string|&quot;r&quot;
(paren
id|alias
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_PHYS_USE_EC
)paren
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SMP
DECL|function|cheetah_tune_scheduling
r_int
r_int
id|cheetah_tune_scheduling
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|tick1
comma
id|tick2
comma
id|raw
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;rd %%tick, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|tick1
)paren
)paren
suffix:semicolon
id|cheetah_flush_ecache
c_func
(paren
)paren
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;rd %%tick, %0&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|tick2
)paren
)paren
suffix:semicolon
id|raw
op_assign
(paren
id|tick2
op_minus
id|tick1
)paren
suffix:semicolon
r_return
(paren
id|raw
op_minus
(paren
id|raw
op_rshift
l_int|2
)paren
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* Unfortunately, the diagnostic access to the I-cache tags we need to&n; * use to clear the thing interferes with I-cache coherency transactions.&n; *&n; * So we must only flush the I-cache when it is disabled.&n; */
DECL|function|cheetah_flush_icache
r_static
r_void
id|cheetah_flush_icache
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|dcu_save
comma
id|i
suffix:semicolon
multiline_comment|/* Save current DCU, disable I-cache. */
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ldxa [%%g0] %1, %0&bslash;n&bslash;t&quot;
l_string|&quot;or %0, %2, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;stxa %%g1, [%%g0] %1&bslash;n&bslash;t&quot;
l_string|&quot;membar #Sync&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|dcu_save
)paren
suffix:colon
l_string|&quot;i&quot;
(paren
id|ASI_DCU_CONTROL_REG
)paren
comma
l_string|&quot;i&quot;
(paren
id|DCU_IC
)paren
suffix:colon
l_string|&quot;g1&quot;
)paren
suffix:semicolon
multiline_comment|/* Clear the valid bits in all the tags. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
l_int|1
op_lshift
l_int|16
)paren
suffix:semicolon
id|i
op_add_assign
(paren
l_int|1
op_lshift
l_int|5
)paren
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;stxa %%g0, [%0] %1&bslash;n&bslash;t&quot;
l_string|&quot;membar #Sync&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;r&quot;
(paren
id|i
op_or
(paren
l_int|2
op_lshift
l_int|3
)paren
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_IC_TAG
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Restore DCU register */
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;stxa %0, [%%g0] %1&bslash;n&bslash;t&quot;
l_string|&quot;membar #Sync&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;r&quot;
(paren
id|dcu_save
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_DCU_CONTROL_REG
)paren
)paren
suffix:semicolon
)brace
DECL|function|cheetah_flush_dcache
r_static
r_void
id|cheetah_flush_dcache
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
l_int|1
op_lshift
l_int|16
)paren
suffix:semicolon
id|i
op_add_assign
(paren
l_int|1
op_lshift
l_int|5
)paren
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;stxa %%g0, [%0] %1&bslash;n&bslash;t&quot;
l_string|&quot;membar #Sync&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;r&quot;
(paren
id|i
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_DCACHE_TAG
)paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Conversion tables used to frob Cheetah AFSR syndrome values into&n; * something palatable to the memory controller driver get_unumber&n; * routine.&n; */
DECL|macro|MT0
mdefine_line|#define MT0&t;137
DECL|macro|MT1
mdefine_line|#define MT1&t;138
DECL|macro|MT2
mdefine_line|#define MT2&t;139
DECL|macro|NONE
mdefine_line|#define NONE&t;254
DECL|macro|MTC0
mdefine_line|#define MTC0&t;140
DECL|macro|MTC1
mdefine_line|#define MTC1&t;141
DECL|macro|MTC2
mdefine_line|#define MTC2&t;142
DECL|macro|MTC3
mdefine_line|#define MTC3&t;143
DECL|macro|C0
mdefine_line|#define C0&t;128
DECL|macro|C1
mdefine_line|#define C1&t;129
DECL|macro|C2
mdefine_line|#define C2&t;130
DECL|macro|C3
mdefine_line|#define C3&t;131
DECL|macro|C4
mdefine_line|#define C4&t;132
DECL|macro|C5
mdefine_line|#define C5&t;133
DECL|macro|C6
mdefine_line|#define C6&t;134
DECL|macro|C7
mdefine_line|#define C7&t;135
DECL|macro|C8
mdefine_line|#define C8&t;136
DECL|macro|M2
mdefine_line|#define M2&t;144
DECL|macro|M3
mdefine_line|#define M3&t;145
DECL|macro|M4
mdefine_line|#define M4&t;146
DECL|macro|M
mdefine_line|#define M&t;147
DECL|variable|cheetah_ecc_syntab
r_static
r_int
r_char
id|cheetah_ecc_syntab
(braket
)braket
op_assign
(brace
multiline_comment|/*00*/
id|NONE
comma
id|C0
comma
id|C1
comma
id|M2
comma
id|C2
comma
id|M2
comma
id|M3
comma
l_int|47
comma
id|C3
comma
id|M2
comma
id|M2
comma
l_int|53
comma
id|M2
comma
l_int|41
comma
l_int|29
comma
id|M
comma
multiline_comment|/*01*/
id|C4
comma
id|M
comma
id|M
comma
l_int|50
comma
id|M2
comma
l_int|38
comma
l_int|25
comma
id|M2
comma
id|M2
comma
l_int|33
comma
l_int|24
comma
id|M2
comma
l_int|11
comma
id|M
comma
id|M2
comma
l_int|16
comma
multiline_comment|/*02*/
id|C5
comma
id|M
comma
id|M
comma
l_int|46
comma
id|M2
comma
l_int|37
comma
l_int|19
comma
id|M2
comma
id|M
comma
l_int|31
comma
l_int|32
comma
id|M
comma
l_int|7
comma
id|M2
comma
id|M2
comma
l_int|10
comma
multiline_comment|/*03*/
id|M2
comma
l_int|40
comma
l_int|13
comma
id|M2
comma
l_int|59
comma
id|M
comma
id|M2
comma
l_int|66
comma
id|M
comma
id|M2
comma
id|M2
comma
l_int|0
comma
id|M2
comma
l_int|67
comma
l_int|71
comma
id|M
comma
multiline_comment|/*04*/
id|C6
comma
id|M
comma
id|M
comma
l_int|43
comma
id|M
comma
l_int|36
comma
l_int|18
comma
id|M
comma
id|M2
comma
l_int|49
comma
l_int|15
comma
id|M
comma
l_int|63
comma
id|M2
comma
id|M2
comma
l_int|6
comma
multiline_comment|/*05*/
id|M2
comma
l_int|44
comma
l_int|28
comma
id|M2
comma
id|M
comma
id|M2
comma
id|M2
comma
l_int|52
comma
l_int|68
comma
id|M2
comma
id|M2
comma
l_int|62
comma
id|M2
comma
id|M3
comma
id|M3
comma
id|M4
comma
multiline_comment|/*06*/
id|M2
comma
l_int|26
comma
l_int|106
comma
id|M2
comma
l_int|64
comma
id|M
comma
id|M2
comma
l_int|2
comma
l_int|120
comma
id|M
comma
id|M2
comma
id|M3
comma
id|M
comma
id|M3
comma
id|M3
comma
id|M4
comma
multiline_comment|/*07*/
l_int|116
comma
id|M2
comma
id|M2
comma
id|M3
comma
id|M2
comma
id|M3
comma
id|M
comma
id|M4
comma
id|M2
comma
l_int|58
comma
l_int|54
comma
id|M2
comma
id|M
comma
id|M4
comma
id|M4
comma
id|M3
comma
multiline_comment|/*08*/
id|C7
comma
id|M2
comma
id|M
comma
l_int|42
comma
id|M
comma
l_int|35
comma
l_int|17
comma
id|M2
comma
id|M
comma
l_int|45
comma
l_int|14
comma
id|M2
comma
l_int|21
comma
id|M2
comma
id|M2
comma
l_int|5
comma
multiline_comment|/*09*/
id|M
comma
l_int|27
comma
id|M
comma
id|M
comma
l_int|99
comma
id|M
comma
id|M
comma
l_int|3
comma
l_int|114
comma
id|M2
comma
id|M2
comma
l_int|20
comma
id|M2
comma
id|M3
comma
id|M3
comma
id|M
comma
multiline_comment|/*0a*/
id|M2
comma
l_int|23
comma
l_int|113
comma
id|M2
comma
l_int|112
comma
id|M2
comma
id|M
comma
l_int|51
comma
l_int|95
comma
id|M
comma
id|M2
comma
id|M3
comma
id|M2
comma
id|M3
comma
id|M3
comma
id|M2
comma
multiline_comment|/*0b*/
l_int|103
comma
id|M
comma
id|M2
comma
id|M3
comma
id|M2
comma
id|M3
comma
id|M3
comma
id|M4
comma
id|M2
comma
l_int|48
comma
id|M
comma
id|M
comma
l_int|73
comma
id|M2
comma
id|M
comma
id|M3
comma
multiline_comment|/*0c*/
id|M2
comma
l_int|22
comma
l_int|110
comma
id|M2
comma
l_int|109
comma
id|M2
comma
id|M
comma
l_int|9
comma
l_int|108
comma
id|M2
comma
id|M
comma
id|M3
comma
id|M2
comma
id|M3
comma
id|M3
comma
id|M
comma
multiline_comment|/*0d*/
l_int|102
comma
id|M2
comma
id|M
comma
id|M
comma
id|M2
comma
id|M3
comma
id|M3
comma
id|M
comma
id|M2
comma
id|M3
comma
id|M3
comma
id|M2
comma
id|M
comma
id|M4
comma
id|M
comma
id|M3
comma
multiline_comment|/*0e*/
l_int|98
comma
id|M
comma
id|M2
comma
id|M3
comma
id|M2
comma
id|M
comma
id|M3
comma
id|M4
comma
id|M2
comma
id|M3
comma
id|M3
comma
id|M4
comma
id|M3
comma
id|M
comma
id|M
comma
id|M
comma
multiline_comment|/*0f*/
id|M2
comma
id|M3
comma
id|M3
comma
id|M
comma
id|M3
comma
id|M
comma
id|M
comma
id|M
comma
l_int|56
comma
id|M4
comma
id|M
comma
id|M3
comma
id|M4
comma
id|M
comma
id|M
comma
id|M
comma
multiline_comment|/*10*/
id|C8
comma
id|M
comma
id|M2
comma
l_int|39
comma
id|M
comma
l_int|34
comma
l_int|105
comma
id|M2
comma
id|M
comma
l_int|30
comma
l_int|104
comma
id|M
comma
l_int|101
comma
id|M
comma
id|M
comma
l_int|4
comma
multiline_comment|/*11*/
id|M
comma
id|M
comma
l_int|100
comma
id|M
comma
l_int|83
comma
id|M
comma
id|M2
comma
l_int|12
comma
l_int|87
comma
id|M
comma
id|M
comma
l_int|57
comma
id|M2
comma
id|M
comma
id|M3
comma
id|M
comma
multiline_comment|/*12*/
id|M2
comma
l_int|97
comma
l_int|82
comma
id|M2
comma
l_int|78
comma
id|M2
comma
id|M2
comma
l_int|1
comma
l_int|96
comma
id|M
comma
id|M
comma
id|M
comma
id|M
comma
id|M
comma
id|M3
comma
id|M2
comma
multiline_comment|/*13*/
l_int|94
comma
id|M
comma
id|M2
comma
id|M3
comma
id|M2
comma
id|M
comma
id|M3
comma
id|M
comma
id|M2
comma
id|M
comma
l_int|79
comma
id|M
comma
l_int|69
comma
id|M
comma
id|M4
comma
id|M
comma
multiline_comment|/*14*/
id|M2
comma
l_int|93
comma
l_int|92
comma
id|M
comma
l_int|91
comma
id|M
comma
id|M2
comma
l_int|8
comma
l_int|90
comma
id|M2
comma
id|M2
comma
id|M
comma
id|M
comma
id|M
comma
id|M
comma
id|M4
comma
multiline_comment|/*15*/
l_int|89
comma
id|M
comma
id|M
comma
id|M3
comma
id|M2
comma
id|M3
comma
id|M3
comma
id|M
comma
id|M
comma
id|M
comma
id|M3
comma
id|M2
comma
id|M3
comma
id|M2
comma
id|M
comma
id|M3
comma
multiline_comment|/*16*/
l_int|86
comma
id|M
comma
id|M2
comma
id|M3
comma
id|M2
comma
id|M
comma
id|M3
comma
id|M
comma
id|M2
comma
id|M
comma
id|M3
comma
id|M
comma
id|M3
comma
id|M
comma
id|M
comma
id|M3
comma
multiline_comment|/*17*/
id|M
comma
id|M
comma
id|M3
comma
id|M2
comma
id|M3
comma
id|M2
comma
id|M4
comma
id|M
comma
l_int|60
comma
id|M
comma
id|M2
comma
id|M3
comma
id|M4
comma
id|M
comma
id|M
comma
id|M2
comma
multiline_comment|/*18*/
id|M2
comma
l_int|88
comma
l_int|85
comma
id|M2
comma
l_int|84
comma
id|M
comma
id|M2
comma
l_int|55
comma
l_int|81
comma
id|M2
comma
id|M2
comma
id|M3
comma
id|M2
comma
id|M3
comma
id|M3
comma
id|M4
comma
multiline_comment|/*19*/
l_int|77
comma
id|M
comma
id|M
comma
id|M
comma
id|M2
comma
id|M3
comma
id|M
comma
id|M
comma
id|M2
comma
id|M3
comma
id|M3
comma
id|M4
comma
id|M3
comma
id|M2
comma
id|M
comma
id|M
comma
multiline_comment|/*1a*/
l_int|74
comma
id|M
comma
id|M2
comma
id|M3
comma
id|M
comma
id|M
comma
id|M3
comma
id|M
comma
id|M
comma
id|M
comma
id|M3
comma
id|M
comma
id|M3
comma
id|M
comma
id|M4
comma
id|M3
comma
multiline_comment|/*1b*/
id|M2
comma
l_int|70
comma
l_int|107
comma
id|M4
comma
l_int|65
comma
id|M2
comma
id|M2
comma
id|M
comma
l_int|127
comma
id|M
comma
id|M
comma
id|M
comma
id|M2
comma
id|M3
comma
id|M3
comma
id|M
comma
multiline_comment|/*1c*/
l_int|80
comma
id|M2
comma
id|M2
comma
l_int|72
comma
id|M
comma
l_int|119
comma
l_int|118
comma
id|M
comma
id|M2
comma
l_int|126
comma
l_int|76
comma
id|M
comma
l_int|125
comma
id|M
comma
id|M4
comma
id|M3
comma
multiline_comment|/*1d*/
id|M2
comma
l_int|115
comma
l_int|124
comma
id|M
comma
l_int|75
comma
id|M
comma
id|M
comma
id|M3
comma
l_int|61
comma
id|M
comma
id|M4
comma
id|M
comma
id|M4
comma
id|M
comma
id|M
comma
id|M
comma
multiline_comment|/*1e*/
id|M
comma
l_int|123
comma
l_int|122
comma
id|M4
comma
l_int|121
comma
id|M4
comma
id|M
comma
id|M3
comma
l_int|117
comma
id|M2
comma
id|M2
comma
id|M3
comma
id|M4
comma
id|M3
comma
id|M
comma
id|M
comma
multiline_comment|/*1f*/
l_int|111
comma
id|M
comma
id|M
comma
id|M
comma
id|M4
comma
id|M3
comma
id|M3
comma
id|M
comma
id|M
comma
id|M
comma
id|M3
comma
id|M
comma
id|M3
comma
id|M2
comma
id|M
comma
id|M
)brace
suffix:semicolon
DECL|variable|cheetah_mtag_syntab
r_static
r_int
r_char
id|cheetah_mtag_syntab
(braket
)braket
op_assign
(brace
id|NONE
comma
id|MTC0
comma
id|MTC1
comma
id|NONE
comma
id|MTC2
comma
id|NONE
comma
id|NONE
comma
id|MT0
comma
id|MTC3
comma
id|NONE
comma
id|NONE
comma
id|MT1
comma
id|NONE
comma
id|MT2
comma
id|NONE
comma
id|NONE
)brace
suffix:semicolon
multiline_comment|/* This table is ordered in priority of errors and matches the&n; * AFAR overwrite policy as well.&n; */
r_static
r_struct
(brace
DECL|member|mask
r_int
r_int
id|mask
suffix:semicolon
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|variable|cheetah_error_table
)brace
id|cheetah_error_table
(braket
)braket
op_assign
(brace
(brace
id|CHAFSR_PERR
comma
l_string|&quot;System interface protocol error&quot;
)brace
comma
(brace
id|CHAFSR_IERR
comma
l_string|&quot;Internal processor error&quot;
)brace
comma
(brace
id|CHAFSR_ISAP
comma
l_string|&quot;System request parity error on incoming addresss&quot;
)brace
comma
(brace
id|CHAFSR_UCU
comma
l_string|&quot;Uncorrectable E-cache ECC error for ifetch/data&quot;
)brace
comma
(brace
id|CHAFSR_UCC
comma
l_string|&quot;SW Correctable E-cache ECC error for ifetch/data&quot;
)brace
comma
(brace
id|CHAFSR_UE
comma
l_string|&quot;Uncorrectable system bus data ECC error for read&quot;
)brace
comma
(brace
id|CHAFSR_EDU
comma
l_string|&quot;Uncorrectable E-cache ECC error for stmerge/blkld&quot;
)brace
comma
(brace
id|CHAFSR_EMU
comma
l_string|&quot;Uncorrectable system bus MTAG error&quot;
)brace
comma
(brace
id|CHAFSR_WDU
comma
l_string|&quot;Uncorrectable E-cache ECC error for writeback&quot;
)brace
comma
(brace
id|CHAFSR_CPU
comma
l_string|&quot;Uncorrectable ECC error for copyout&quot;
)brace
comma
(brace
id|CHAFSR_CE
comma
l_string|&quot;HW corrected system bus data ECC error for read&quot;
)brace
comma
(brace
id|CHAFSR_EDC
comma
l_string|&quot;HW corrected E-cache ECC error for stmerge/blkld&quot;
)brace
comma
(brace
id|CHAFSR_EMC
comma
l_string|&quot;HW corrected system bus MTAG ECC error&quot;
)brace
comma
(brace
id|CHAFSR_WDC
comma
l_string|&quot;HW corrected E-cache ECC error for writeback&quot;
)brace
comma
(brace
id|CHAFSR_CPC
comma
l_string|&quot;HW corrected ECC error for copyout&quot;
)brace
comma
(brace
id|CHAFSR_TO
comma
l_string|&quot;Unmapped error from system bus&quot;
)brace
comma
(brace
id|CHAFSR_BERR
comma
l_string|&quot;Bus error response from system bus&quot;
)brace
comma
multiline_comment|/* These two do not update the AFAR. */
(brace
id|CHAFSR_IVC
comma
l_string|&quot;HW corrected system bus data ECC error for ivec read&quot;
)brace
comma
(brace
id|CHAFSR_IVU
comma
l_string|&quot;Uncorrectable system bus data ECC error for ivec read&quot;
)brace
comma
(brace
l_int|0
comma
l_int|NULL
)brace
)brace
suffix:semicolon
multiline_comment|/* Return the highest priority error conditon mentioned. */
DECL|function|cheetah_get_hipri
r_static
id|__inline__
r_int
r_int
id|cheetah_get_hipri
c_func
(paren
r_int
r_int
id|afsr
)paren
(brace
r_int
r_int
id|tmp
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|cheetah_error_table
(braket
id|i
)braket
dot
id|mask
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|tmp
op_assign
(paren
id|afsr
op_amp
id|cheetah_error_table
(braket
id|i
)braket
dot
id|mask
)paren
)paren
op_ne
l_int|0UL
)paren
r_return
id|tmp
suffix:semicolon
)brace
r_return
id|tmp
suffix:semicolon
)brace
DECL|function|cheetah_get_string
r_static
r_char
op_star
id|cheetah_get_string
c_func
(paren
r_int
r_int
id|bit
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|cheetah_error_table
(braket
id|i
)braket
dot
id|mask
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|bit
op_amp
id|cheetah_error_table
(braket
id|i
)braket
dot
id|mask
)paren
op_ne
l_int|0UL
)paren
r_return
id|cheetah_error_table
(braket
id|i
)braket
dot
id|name
suffix:semicolon
)brace
r_return
l_string|&quot;???&quot;
suffix:semicolon
)brace
r_extern
r_int
id|chmc_getunumber
c_func
(paren
r_int
comma
r_int
r_int
comma
r_char
op_star
comma
r_int
)paren
suffix:semicolon
DECL|function|cheetah_log_errors
r_static
r_void
id|cheetah_log_errors
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_struct
id|cheetah_err_info
op_star
id|info
comma
r_int
r_int
id|afsr
comma
r_int
r_int
id|afar
comma
r_int
id|recoverable
)paren
(brace
r_int
r_int
id|hipri
suffix:semicolon
r_char
id|unum
(braket
l_int|256
)braket
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&quot;
l_string|&quot;ERROR(%d): Cheetah error trap taken afsr[%016lx] afar[%016lx] TL1(%d)&bslash;n&quot;
comma
(paren
id|recoverable
ques
c_cond
id|KERN_WARNING
suffix:colon
id|KERN_CRIT
)paren
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|afsr
comma
id|afar
comma
(paren
id|afsr
op_amp
id|CHAFSR_TL1
)paren
ques
c_cond
l_int|1
suffix:colon
l_int|0
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&quot;
l_string|&quot;ERROR(%d): TPC[%016lx] TNPC[%016lx] TSTATE[%016lx]&bslash;n&quot;
comma
(paren
id|recoverable
ques
c_cond
id|KERN_WARNING
suffix:colon
id|KERN_CRIT
)paren
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|regs-&gt;tpc
comma
id|regs-&gt;tnpc
comma
id|regs-&gt;tstate
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&quot;
l_string|&quot;ERROR(%d): M_SYND(%lx),  E_SYND(%lx)%s%s&bslash;n&quot;
comma
(paren
id|recoverable
ques
c_cond
id|KERN_WARNING
suffix:colon
id|KERN_CRIT
)paren
comma
id|smp_processor_id
c_func
(paren
)paren
comma
(paren
id|afsr
op_amp
id|CHAFSR_M_SYNDROME
)paren
op_rshift
id|CHAFSR_M_SYNDROME_SHIFT
comma
(paren
id|afsr
op_amp
id|CHAFSR_E_SYNDROME
)paren
op_rshift
id|CHAFSR_E_SYNDROME_SHIFT
comma
(paren
id|afsr
op_amp
id|CHAFSR_ME
)paren
ques
c_cond
l_string|&quot;, Multiple Errors&quot;
suffix:colon
l_string|&quot;&quot;
comma
(paren
id|afsr
op_amp
id|CHAFSR_PRIV
)paren
ques
c_cond
l_string|&quot;, Privileged&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
id|hipri
op_assign
id|cheetah_get_hipri
c_func
(paren
id|afsr
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&quot;
l_string|&quot;ERROR(%d): Highest priority error (%016lx) &bslash;&quot;%s&bslash;&quot;&bslash;n&quot;
comma
(paren
id|recoverable
ques
c_cond
id|KERN_WARNING
suffix:colon
id|KERN_CRIT
)paren
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|hipri
comma
id|cheetah_get_string
c_func
(paren
id|hipri
)paren
)paren
suffix:semicolon
multiline_comment|/* Try to get unumber if relevant. */
DECL|macro|ESYND_ERRORS
mdefine_line|#define ESYND_ERRORS&t;(CHAFSR_IVC | CHAFSR_IVU | &bslash;&n;&t;&t;&t; CHAFSR_CPC | CHAFSR_CPU | &bslash;&n;&t;&t;&t; CHAFSR_UE  | CHAFSR_CE  | &bslash;&n;&t;&t;&t; CHAFSR_EDC | CHAFSR_EDU  | &bslash;&n;&t;&t;&t; CHAFSR_UCC | CHAFSR_UCU  | &bslash;&n;&t;&t;&t; CHAFSR_WDU | CHAFSR_WDC)
DECL|macro|MSYND_ERRORS
mdefine_line|#define MSYND_ERRORS&t;(CHAFSR_EMC | CHAFSR_EMU)
r_if
c_cond
(paren
id|afsr
op_amp
id|ESYND_ERRORS
)paren
(brace
r_int
id|syndrome
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|syndrome
op_assign
(paren
id|afsr
op_amp
id|CHAFSR_E_SYNDROME
)paren
op_rshift
id|CHAFSR_E_SYNDROME_SHIFT
suffix:semicolon
id|syndrome
op_assign
id|cheetah_ecc_syntab
(braket
id|syndrome
)braket
suffix:semicolon
id|ret
op_assign
id|chmc_getunumber
c_func
(paren
id|syndrome
comma
id|afar
comma
id|unum
comma
r_sizeof
(paren
id|unum
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
op_minus
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;%s&quot;
l_string|&quot;ERROR(%d): AFAR E-syndrome [%s]&bslash;n&quot;
comma
(paren
id|recoverable
ques
c_cond
id|KERN_WARNING
suffix:colon
id|KERN_CRIT
)paren
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|unum
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|afsr
op_amp
id|MSYND_ERRORS
)paren
(brace
r_int
id|syndrome
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|syndrome
op_assign
(paren
id|afsr
op_amp
id|CHAFSR_M_SYNDROME
)paren
op_rshift
id|CHAFSR_M_SYNDROME_SHIFT
suffix:semicolon
id|syndrome
op_assign
id|cheetah_mtag_syntab
(braket
id|syndrome
)braket
suffix:semicolon
id|ret
op_assign
id|chmc_getunumber
c_func
(paren
id|syndrome
comma
id|afar
comma
id|unum
comma
r_sizeof
(paren
id|unum
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
op_minus
l_int|1
)paren
id|printk
c_func
(paren
l_string|&quot;%s&quot;
l_string|&quot;ERROR(%d): AFAR M-syndrome [%s]&bslash;n&quot;
comma
(paren
id|recoverable
ques
c_cond
id|KERN_WARNING
suffix:colon
id|KERN_CRIT
)paren
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|unum
)paren
suffix:semicolon
)brace
multiline_comment|/* Now dump the cache snapshots. */
id|printk
c_func
(paren
l_string|&quot;%s&quot;
l_string|&quot;ERROR(%d): D-cache idx[%x] tag[%016lx] utag[%016lx] stag[%016lx]&bslash;n&quot;
comma
(paren
id|recoverable
ques
c_cond
id|KERN_WARNING
suffix:colon
id|KERN_CRIT
)paren
comma
id|smp_processor_id
c_func
(paren
)paren
comma
(paren
r_int
)paren
id|info-&gt;dcache_index
comma
id|info-&gt;dcache_tag
comma
id|info-&gt;dcache_utag
comma
id|info-&gt;dcache_stag
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&quot;
l_string|&quot;ERROR(%d): D-cache data0[%016lx] data1[%016lx] data2[%016lx] data3[%016lx]&bslash;n&quot;
comma
(paren
id|recoverable
ques
c_cond
id|KERN_WARNING
suffix:colon
id|KERN_CRIT
)paren
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|info-&gt;dcache_data
(braket
l_int|0
)braket
comma
id|info-&gt;dcache_data
(braket
l_int|1
)braket
comma
id|info-&gt;dcache_data
(braket
l_int|2
)braket
comma
id|info-&gt;dcache_data
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&quot;
l_string|&quot;ERROR(%d): I-cache idx[%x] tag[%016lx] utag[%016lx] stag[%016lx] &quot;
l_string|&quot;u[%016lx] l[%016lx]&bslash;n&quot;
comma
(paren
id|recoverable
ques
c_cond
id|KERN_WARNING
suffix:colon
id|KERN_CRIT
)paren
comma
id|smp_processor_id
c_func
(paren
)paren
comma
(paren
r_int
)paren
id|info-&gt;icache_index
comma
id|info-&gt;icache_tag
comma
id|info-&gt;icache_utag
comma
id|info-&gt;icache_stag
comma
id|info-&gt;icache_upper
comma
id|info-&gt;icache_lower
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&quot;
l_string|&quot;ERROR(%d): I-cache INSN0[%016lx] INSN1[%016lx] INSN2[%016lx] INSN3[%016lx]&bslash;n&quot;
comma
(paren
id|recoverable
ques
c_cond
id|KERN_WARNING
suffix:colon
id|KERN_CRIT
)paren
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|info-&gt;icache_data
(braket
l_int|0
)braket
comma
id|info-&gt;icache_data
(braket
l_int|1
)braket
comma
id|info-&gt;icache_data
(braket
l_int|2
)braket
comma
id|info-&gt;icache_data
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&quot;
l_string|&quot;ERROR(%d): I-cache INSN4[%016lx] INSN5[%016lx] INSN6[%016lx] INSN7[%016lx]&bslash;n&quot;
comma
(paren
id|recoverable
ques
c_cond
id|KERN_WARNING
suffix:colon
id|KERN_CRIT
)paren
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|info-&gt;icache_data
(braket
l_int|4
)braket
comma
id|info-&gt;icache_data
(braket
l_int|5
)braket
comma
id|info-&gt;icache_data
(braket
l_int|6
)braket
comma
id|info-&gt;icache_data
(braket
l_int|7
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&quot;
l_string|&quot;ERROR(%d): E-cache idx[%x] tag[%016lx]&bslash;n&quot;
comma
(paren
id|recoverable
ques
c_cond
id|KERN_WARNING
suffix:colon
id|KERN_CRIT
)paren
comma
id|smp_processor_id
c_func
(paren
)paren
comma
(paren
r_int
)paren
id|info-&gt;ecache_index
comma
id|info-&gt;ecache_tag
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&quot;
l_string|&quot;ERROR(%d): E-cache data0[%016lx] data1[%016lx] data2[%016lx] data3[%016lx]&bslash;n&quot;
comma
(paren
id|recoverable
ques
c_cond
id|KERN_WARNING
suffix:colon
id|KERN_CRIT
)paren
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|info-&gt;ecache_data
(braket
l_int|0
)braket
comma
id|info-&gt;ecache_data
(braket
l_int|1
)braket
comma
id|info-&gt;ecache_data
(braket
l_int|2
)braket
comma
id|info-&gt;ecache_data
(braket
l_int|3
)braket
)paren
suffix:semicolon
id|afsr
op_assign
(paren
id|afsr
op_amp
op_complement
id|hipri
)paren
op_amp
id|CHAFSR_ERRORS
suffix:semicolon
r_while
c_loop
(paren
id|afsr
op_ne
l_int|0UL
)paren
(brace
r_int
r_int
id|bit
op_assign
id|cheetah_get_hipri
c_func
(paren
id|afsr
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&quot;
l_string|&quot;ERROR: Multiple-error (%016lx) &bslash;&quot;%s&bslash;&quot;&bslash;n&quot;
comma
(paren
id|recoverable
ques
c_cond
id|KERN_WARNING
suffix:colon
id|KERN_CRIT
)paren
comma
id|bit
comma
id|cheetah_get_string
c_func
(paren
id|bit
)paren
)paren
suffix:semicolon
id|afsr
op_and_assign
op_complement
id|bit
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|recoverable
)paren
id|printk
c_func
(paren
id|KERN_CRIT
l_string|&quot;ERROR: This condition is not recoverable.&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|cheetah_recheck_errors
r_static
r_int
id|cheetah_recheck_errors
c_func
(paren
r_struct
id|cheetah_err_info
op_star
id|logp
)paren
(brace
r_int
r_int
id|afsr
comma
id|afar
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ldxa [%%g0] %1, %0&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|afsr
)paren
suffix:colon
l_string|&quot;i&quot;
(paren
id|ASI_AFSR
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|afsr
op_amp
id|CHAFSR_ERRORS
)paren
op_ne
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|logp
op_ne
l_int|NULL
)paren
(brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ldxa [%%g0] %1, %0&bslash;n&bslash;t&quot;
suffix:colon
l_string|&quot;=r&quot;
(paren
id|afar
)paren
suffix:colon
l_string|&quot;i&quot;
(paren
id|ASI_AFAR
)paren
)paren
suffix:semicolon
id|logp-&gt;afsr
op_assign
id|afsr
suffix:semicolon
id|logp-&gt;afar
op_assign
id|afar
suffix:semicolon
)brace
id|ret
op_assign
l_int|1
suffix:semicolon
)brace
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;stxa %0, [%%g0] %1&bslash;n&bslash;t&quot;
l_string|&quot;membar #Sync&bslash;n&bslash;t&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|afsr
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_AFSR
)paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|cheetah_fecc_handler
r_void
id|cheetah_fecc_handler
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
r_int
id|afsr
comma
r_int
r_int
id|afar
)paren
(brace
r_struct
id|cheetah_err_info
id|local_snapshot
comma
op_star
id|p
suffix:semicolon
r_int
id|recoverable
suffix:semicolon
multiline_comment|/* Flush E-cache */
id|cheetah_flush_ecache
c_func
(paren
)paren
suffix:semicolon
id|p
op_assign
id|cheetah_get_error_log
c_func
(paren
id|afsr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;ERROR: Early Fast-ECC error afsr[%016lx] afar[%016lx]&bslash;n&quot;
comma
id|afsr
comma
id|afar
)paren
suffix:semicolon
id|prom_printf
c_func
(paren
l_string|&quot;ERROR: CPU(%d) TPC[%016lx] TNPC[%016lx] TSTATE[%016lx]&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|regs-&gt;tpc
comma
id|regs-&gt;tnpc
comma
id|regs-&gt;tstate
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Grab snapshot of logged error. */
id|memcpy
c_func
(paren
op_amp
id|local_snapshot
comma
id|p
comma
r_sizeof
(paren
id|local_snapshot
)paren
)paren
suffix:semicolon
multiline_comment|/* If the current trap snapshot does not match what the&n;&t; * trap handler passed along into our args, big trouble.&n;&t; * In such a case, mark the local copy as invalid.&n;&t; *&n;&t; * Else, it matches and we mark the afsr in the non-local&n;&t; * copy as invalid so we may log new error traps there.&n;&t; */
r_if
c_cond
(paren
id|p-&gt;afsr
op_ne
id|afsr
op_logical_or
id|p-&gt;afar
op_ne
id|afar
)paren
id|local_snapshot.afsr
op_assign
id|CHAFSR_INVALID
suffix:semicolon
r_else
id|p-&gt;afsr
op_assign
id|CHAFSR_INVALID
suffix:semicolon
id|cheetah_flush_icache
c_func
(paren
)paren
suffix:semicolon
id|cheetah_flush_dcache
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Re-enable I-cache/D-cache */
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ldxa [%%g0] %0, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;or %%g1, %1, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;stxa %%g1, [%%g0] %0&bslash;n&bslash;t&quot;
l_string|&quot;membar #Sync&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;i&quot;
(paren
id|ASI_DCU_CONTROL_REG
)paren
comma
l_string|&quot;i&quot;
(paren
id|DCU_DC
op_or
id|DCU_IC
)paren
suffix:colon
l_string|&quot;g1&quot;
)paren
suffix:semicolon
multiline_comment|/* Re-enable error reporting */
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ldxa [%%g0] %0, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;or %%g1, %1, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;stxa %%g1, [%%g0] %0&bslash;n&bslash;t&quot;
l_string|&quot;membar #Sync&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;i&quot;
(paren
id|ASI_ESTATE_ERROR_EN
)paren
comma
l_string|&quot;i&quot;
(paren
id|ESTATE_ERROR_NCEEN
op_or
id|ESTATE_ERROR_CEEN
)paren
suffix:colon
l_string|&quot;g1&quot;
)paren
suffix:semicolon
multiline_comment|/* Decide if we can continue after handling this trap and&n;&t; * logging the error.&n;&t; */
id|recoverable
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|afsr
op_amp
(paren
id|CHAFSR_PERR
op_or
id|CHAFSR_IERR
op_or
id|CHAFSR_ISAP
)paren
)paren
id|recoverable
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Re-check AFSR/AFAR.  What we are looking for here is whether a new&n;&t; * error was logged while we had error reporting traps disabled.&n;&t; */
r_if
c_cond
(paren
id|cheetah_recheck_errors
c_func
(paren
op_amp
id|local_snapshot
)paren
)paren
(brace
r_int
r_int
id|new_afsr
op_assign
id|local_snapshot.afsr
suffix:semicolon
multiline_comment|/* If we got a new asynchronous error, die... */
r_if
c_cond
(paren
id|new_afsr
op_amp
(paren
id|CHAFSR_EMU
op_or
id|CHAFSR_EDU
op_or
id|CHAFSR_WDU
op_or
id|CHAFSR_CPU
op_or
id|CHAFSR_IVU
op_or
id|CHAFSR_UE
op_or
id|CHAFSR_BERR
op_or
id|CHAFSR_TO
)paren
)paren
id|recoverable
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Log errors. */
id|cheetah_log_errors
c_func
(paren
id|regs
comma
op_amp
id|local_snapshot
comma
id|afsr
comma
id|afar
comma
id|recoverable
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|recoverable
)paren
id|panic
c_func
(paren
l_string|&quot;Irrecoverable Fast-ECC error trap.&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Flush E-cache to kick the error trap handlers out. */
id|cheetah_flush_ecache
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Try to fix a correctable error by pushing the line out from&n; * the E-cache.  Recheck error reporting registers to see if the&n; * problem is intermittent.&n; */
DECL|function|cheetah_fix_ce
r_static
r_int
id|cheetah_fix_ce
c_func
(paren
r_int
r_int
id|physaddr
)paren
(brace
r_int
r_int
id|orig_estate
suffix:semicolon
r_int
r_int
id|alias1
comma
id|alias2
suffix:semicolon
r_int
id|ret
suffix:semicolon
multiline_comment|/* Make sure correctable error traps are disabled. */
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ldxa&t;[%%g0] %2, %0&bslash;n&bslash;t&quot;
l_string|&quot;andn&t;%0, %1, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;stxa&t;%%g1, [%%g0] %2&bslash;n&bslash;t&quot;
l_string|&quot;membar&t;#Sync&quot;
suffix:colon
l_string|&quot;=&amp;r&quot;
(paren
id|orig_estate
)paren
suffix:colon
l_string|&quot;i&quot;
(paren
id|ESTATE_ERROR_CEEN
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_ESTATE_ERROR_EN
)paren
suffix:colon
l_string|&quot;g1&quot;
)paren
suffix:semicolon
multiline_comment|/* We calculate alias addresses that will force the&n;&t; * cache line in question out of the E-cache.  Then&n;&t; * we bring it back in with an atomic instruction so&n;&t; * that we get it in some modified/exclusive state,&n;&t; * then we displace it again to try and get proper ECC&n;&t; * pushed back into the system.&n;&t; */
id|physaddr
op_and_assign
op_complement
(paren
l_int|8UL
op_minus
l_int|1UL
)paren
suffix:semicolon
id|alias1
op_assign
(paren
id|ecache_flush_physbase
op_plus
(paren
id|physaddr
op_amp
(paren
(paren
id|ecache_flush_size
op_rshift
l_int|1
)paren
op_minus
l_int|1
)paren
)paren
)paren
suffix:semicolon
id|alias2
op_assign
id|alias1
op_plus
(paren
id|ecache_flush_size
op_rshift
l_int|1
)paren
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ldxa&t;[%0] %3, %%g0&bslash;n&bslash;t&quot;
l_string|&quot;ldxa&t;[%1] %3, %%g0&bslash;n&bslash;t&quot;
l_string|&quot;casxa&t;[%2] %3, %%g0, %%g0&bslash;n&bslash;t&quot;
l_string|&quot;membar&t;#StoreLoad | #StoreStore&bslash;n&bslash;t&quot;
l_string|&quot;ldxa&t;[%0] %3, %%g0&bslash;n&bslash;t&quot;
l_string|&quot;ldxa&t;[%1] %3, %%g0&bslash;n&bslash;t&quot;
l_string|&quot;membar&t;#Sync&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;r&quot;
(paren
id|alias1
)paren
comma
l_string|&quot;r&quot;
(paren
id|alias2
)paren
comma
l_string|&quot;r&quot;
(paren
id|physaddr
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_PHYS_USE_EC
)paren
)paren
suffix:semicolon
multiline_comment|/* Did that trigger another error? */
r_if
c_cond
(paren
id|cheetah_recheck_errors
c_func
(paren
l_int|NULL
)paren
)paren
(brace
multiline_comment|/* Try one more time. */
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ldxa [%0] %1, %%g0&bslash;n&bslash;t&quot;
l_string|&quot;membar #Sync&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|physaddr
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_PHYS_USE_EC
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cheetah_recheck_errors
c_func
(paren
l_int|NULL
)paren
)paren
id|ret
op_assign
l_int|2
suffix:semicolon
r_else
id|ret
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* No new error, intermittent problem. */
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Restore error enables. */
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;stxa&t;%0, [%%g0] %1&bslash;n&bslash;t&quot;
l_string|&quot;membar&t;#Sync&quot;
suffix:colon
suffix:colon
l_string|&quot;r&quot;
(paren
id|orig_estate
)paren
comma
l_string|&quot;i&quot;
(paren
id|ASI_ESTATE_ERROR_EN
)paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* Return non-zero if PADDR is a valid physical memory address. */
DECL|function|cheetah_check_main_memory
r_static
r_int
id|cheetah_check_main_memory
c_func
(paren
r_int
r_int
id|paddr
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|sp_banks
(braket
id|i
)braket
dot
id|num_bytes
op_eq
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|paddr
op_ge
id|sp_banks
(braket
id|i
)braket
dot
id|base_addr
op_logical_and
id|paddr
OL
(paren
id|sp_banks
(braket
id|i
)braket
dot
id|base_addr
op_plus
id|sp_banks
(braket
id|i
)braket
dot
id|num_bytes
)paren
)paren
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cheetah_cee_handler
r_void
id|cheetah_cee_handler
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
r_int
id|afsr
comma
r_int
r_int
id|afar
)paren
(brace
r_struct
id|cheetah_err_info
id|local_snapshot
comma
op_star
id|p
suffix:semicolon
r_int
id|recoverable
comma
id|is_memory
suffix:semicolon
id|p
op_assign
id|cheetah_get_error_log
c_func
(paren
id|afsr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;ERROR: Early CEE error afsr[%016lx] afar[%016lx]&bslash;n&quot;
comma
id|afsr
comma
id|afar
)paren
suffix:semicolon
id|prom_printf
c_func
(paren
l_string|&quot;ERROR: CPU(%d) TPC[%016lx] TNPC[%016lx] TSTATE[%016lx]&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|regs-&gt;tpc
comma
id|regs-&gt;tnpc
comma
id|regs-&gt;tstate
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Grab snapshot of logged error. */
id|memcpy
c_func
(paren
op_amp
id|local_snapshot
comma
id|p
comma
r_sizeof
(paren
id|local_snapshot
)paren
)paren
suffix:semicolon
multiline_comment|/* If the current trap snapshot does not match what the&n;&t; * trap handler passed along into our args, big trouble.&n;&t; * In such a case, mark the local copy as invalid.&n;&t; *&n;&t; * Else, it matches and we mark the afsr in the non-local&n;&t; * copy as invalid so we may log new error traps there.&n;&t; */
r_if
c_cond
(paren
id|p-&gt;afsr
op_ne
id|afsr
op_logical_or
id|p-&gt;afar
op_ne
id|afar
)paren
id|local_snapshot.afsr
op_assign
id|CHAFSR_INVALID
suffix:semicolon
r_else
id|p-&gt;afsr
op_assign
id|CHAFSR_INVALID
suffix:semicolon
id|is_memory
op_assign
id|cheetah_check_main_memory
c_func
(paren
id|afar
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is_memory
op_logical_and
(paren
id|afsr
op_amp
id|CHAFSR_CE
)paren
op_ne
l_int|0UL
)paren
(brace
multiline_comment|/* XXX Might want to log the results of this operation&n;&t;&t; * XXX somewhere... -DaveM&n;&t;&t; */
id|cheetah_fix_ce
c_func
(paren
id|afar
)paren
suffix:semicolon
)brace
(brace
r_int
id|flush_all
comma
id|flush_line
suffix:semicolon
id|flush_all
op_assign
id|flush_line
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|afsr
op_amp
id|CHAFSR_EDC
)paren
op_ne
l_int|0UL
)paren
(brace
r_if
c_cond
(paren
(paren
id|afsr
op_amp
id|CHAFSR_ERRORS
)paren
op_eq
id|CHAFSR_EDC
)paren
id|flush_line
op_assign
l_int|1
suffix:semicolon
r_else
id|flush_all
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|afsr
op_amp
id|CHAFSR_CPC
)paren
op_ne
l_int|0UL
)paren
(brace
r_if
c_cond
(paren
(paren
id|afsr
op_amp
id|CHAFSR_ERRORS
)paren
op_eq
id|CHAFSR_CPC
)paren
id|flush_line
op_assign
l_int|1
suffix:semicolon
r_else
id|flush_all
op_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Trap handler only disabled I-cache, flush it. */
id|cheetah_flush_icache
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Re-enable I-cache */
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ldxa [%%g0] %0, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;or %%g1, %1, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;stxa %%g1, [%%g0] %0&bslash;n&bslash;t&quot;
l_string|&quot;membar #Sync&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;i&quot;
(paren
id|ASI_DCU_CONTROL_REG
)paren
comma
l_string|&quot;i&quot;
(paren
id|DCU_IC
)paren
suffix:colon
l_string|&quot;g1&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flush_all
)paren
id|cheetah_flush_ecache
c_func
(paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|flush_line
)paren
id|cheetah_flush_ecache_line
c_func
(paren
id|afar
)paren
suffix:semicolon
)brace
multiline_comment|/* Re-enable error reporting */
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ldxa [%%g0] %0, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;or %%g1, %1, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;stxa %%g1, [%%g0] %0&bslash;n&bslash;t&quot;
l_string|&quot;membar #Sync&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;i&quot;
(paren
id|ASI_ESTATE_ERROR_EN
)paren
comma
l_string|&quot;i&quot;
(paren
id|ESTATE_ERROR_CEEN
)paren
suffix:colon
l_string|&quot;g1&quot;
)paren
suffix:semicolon
multiline_comment|/* Decide if we can continue after handling this trap and&n;&t; * logging the error.&n;&t; */
id|recoverable
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|afsr
op_amp
(paren
id|CHAFSR_PERR
op_or
id|CHAFSR_IERR
op_or
id|CHAFSR_ISAP
)paren
)paren
id|recoverable
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Re-check AFSR/AFAR */
(paren
r_void
)paren
id|cheetah_recheck_errors
c_func
(paren
op_amp
id|local_snapshot
)paren
suffix:semicolon
multiline_comment|/* Log errors. */
id|cheetah_log_errors
c_func
(paren
id|regs
comma
op_amp
id|local_snapshot
comma
id|afsr
comma
id|afar
comma
id|recoverable
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|recoverable
)paren
id|panic
c_func
(paren
l_string|&quot;Irrecoverable Correctable-ECC error trap.&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|cheetah_deferred_handler
r_void
id|cheetah_deferred_handler
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
r_int
id|afsr
comma
r_int
r_int
id|afar
)paren
(brace
r_struct
id|cheetah_err_info
id|local_snapshot
comma
op_star
id|p
suffix:semicolon
r_int
id|recoverable
comma
id|is_memory
suffix:semicolon
macro_line|#ifdef CONFIG_PCI
multiline_comment|/* Check for the special PCI poke sequence. */
r_if
c_cond
(paren
id|pci_poke_in_progress
op_logical_and
id|pci_poke_cpu
op_eq
id|smp_processor_id
c_func
(paren
)paren
)paren
(brace
id|cheetah_flush_icache
c_func
(paren
)paren
suffix:semicolon
id|cheetah_flush_dcache
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Re-enable I-cache/D-cache */
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ldxa [%%g0] %0, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;or %%g1, %1, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;stxa %%g1, [%%g0] %0&bslash;n&bslash;t&quot;
l_string|&quot;membar #Sync&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;i&quot;
(paren
id|ASI_DCU_CONTROL_REG
)paren
comma
l_string|&quot;i&quot;
(paren
id|DCU_DC
op_or
id|DCU_IC
)paren
suffix:colon
l_string|&quot;g1&quot;
)paren
suffix:semicolon
multiline_comment|/* Re-enable error reporting */
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ldxa [%%g0] %0, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;or %%g1, %1, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;stxa %%g1, [%%g0] %0&bslash;n&bslash;t&quot;
l_string|&quot;membar #Sync&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;i&quot;
(paren
id|ASI_ESTATE_ERROR_EN
)paren
comma
l_string|&quot;i&quot;
(paren
id|ESTATE_ERROR_NCEEN
op_or
id|ESTATE_ERROR_CEEN
)paren
suffix:colon
l_string|&quot;g1&quot;
)paren
suffix:semicolon
(paren
r_void
)paren
id|cheetah_recheck_errors
c_func
(paren
l_int|NULL
)paren
suffix:semicolon
id|pci_poke_faulted
op_assign
l_int|1
suffix:semicolon
id|regs-&gt;tpc
op_add_assign
l_int|4
suffix:semicolon
id|regs-&gt;tnpc
op_assign
id|regs-&gt;tpc
op_plus
l_int|4
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#endif
id|p
op_assign
id|cheetah_get_error_log
c_func
(paren
id|afsr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|p
)paren
(brace
id|prom_printf
c_func
(paren
l_string|&quot;ERROR: Early deferred error afsr[%016lx] afar[%016lx]&bslash;n&quot;
comma
id|afsr
comma
id|afar
)paren
suffix:semicolon
id|prom_printf
c_func
(paren
l_string|&quot;ERROR: CPU(%d) TPC[%016lx] TNPC[%016lx] TSTATE[%016lx]&bslash;n&quot;
comma
id|smp_processor_id
c_func
(paren
)paren
comma
id|regs-&gt;tpc
comma
id|regs-&gt;tnpc
comma
id|regs-&gt;tstate
)paren
suffix:semicolon
id|prom_halt
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Grab snapshot of logged error. */
id|memcpy
c_func
(paren
op_amp
id|local_snapshot
comma
id|p
comma
r_sizeof
(paren
id|local_snapshot
)paren
)paren
suffix:semicolon
multiline_comment|/* If the current trap snapshot does not match what the&n;&t; * trap handler passed along into our args, big trouble.&n;&t; * In such a case, mark the local copy as invalid.&n;&t; *&n;&t; * Else, it matches and we mark the afsr in the non-local&n;&t; * copy as invalid so we may log new error traps there.&n;&t; */
r_if
c_cond
(paren
id|p-&gt;afsr
op_ne
id|afsr
op_logical_or
id|p-&gt;afar
op_ne
id|afar
)paren
id|local_snapshot.afsr
op_assign
id|CHAFSR_INVALID
suffix:semicolon
r_else
id|p-&gt;afsr
op_assign
id|CHAFSR_INVALID
suffix:semicolon
id|is_memory
op_assign
id|cheetah_check_main_memory
c_func
(paren
id|afar
)paren
suffix:semicolon
(brace
r_int
id|flush_all
comma
id|flush_line
suffix:semicolon
id|flush_all
op_assign
id|flush_line
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|afsr
op_amp
id|CHAFSR_EDU
)paren
op_ne
l_int|0UL
)paren
(brace
r_if
c_cond
(paren
(paren
id|afsr
op_amp
id|CHAFSR_ERRORS
)paren
op_eq
id|CHAFSR_EDU
)paren
id|flush_line
op_assign
l_int|1
suffix:semicolon
r_else
id|flush_all
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|afsr
op_amp
id|CHAFSR_BERR
)paren
op_ne
l_int|0UL
)paren
(brace
r_if
c_cond
(paren
(paren
id|afsr
op_amp
id|CHAFSR_ERRORS
)paren
op_eq
id|CHAFSR_BERR
)paren
id|flush_line
op_assign
l_int|1
suffix:semicolon
r_else
id|flush_all
op_assign
l_int|1
suffix:semicolon
)brace
id|cheetah_flush_icache
c_func
(paren
)paren
suffix:semicolon
id|cheetah_flush_dcache
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Re-enable I/D caches */
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ldxa [%%g0] %0, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;or %%g1, %1, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;stxa %%g1, [%%g0] %0&bslash;n&bslash;t&quot;
l_string|&quot;membar #Sync&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;i&quot;
(paren
id|ASI_DCU_CONTROL_REG
)paren
comma
l_string|&quot;i&quot;
(paren
id|DCU_IC
op_or
id|DCU_DC
)paren
suffix:colon
l_string|&quot;g1&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|flush_all
)paren
id|cheetah_flush_ecache
c_func
(paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|flush_line
)paren
id|cheetah_flush_ecache_line
c_func
(paren
id|afar
)paren
suffix:semicolon
)brace
multiline_comment|/* Re-enable error reporting */
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;ldxa [%%g0] %0, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;or %%g1, %1, %%g1&bslash;n&bslash;t&quot;
l_string|&quot;stxa %%g1, [%%g0] %0&bslash;n&bslash;t&quot;
l_string|&quot;membar #Sync&quot;
suffix:colon
multiline_comment|/* no outputs */
suffix:colon
l_string|&quot;i&quot;
(paren
id|ASI_ESTATE_ERROR_EN
)paren
comma
l_string|&quot;i&quot;
(paren
id|ESTATE_ERROR_NCEEN
op_or
id|ESTATE_ERROR_CEEN
)paren
suffix:colon
l_string|&quot;g1&quot;
)paren
suffix:semicolon
multiline_comment|/* Decide if we can continue after handling this trap and&n;&t; * logging the error.&n;&t; */
id|recoverable
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|afsr
op_amp
(paren
id|CHAFSR_PERR
op_or
id|CHAFSR_IERR
op_or
id|CHAFSR_ISAP
)paren
)paren
id|recoverable
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Re-check AFSR/AFAR.  What we are looking for here is whether a new&n;&t; * error was logged while we had error reporting traps disabled.&n;&t; */
r_if
c_cond
(paren
id|cheetah_recheck_errors
c_func
(paren
op_amp
id|local_snapshot
)paren
)paren
(brace
r_int
r_int
id|new_afsr
op_assign
id|local_snapshot.afsr
suffix:semicolon
multiline_comment|/* If we got a new asynchronous error, die... */
r_if
c_cond
(paren
id|new_afsr
op_amp
(paren
id|CHAFSR_EMU
op_or
id|CHAFSR_EDU
op_or
id|CHAFSR_WDU
op_or
id|CHAFSR_CPU
op_or
id|CHAFSR_IVU
op_or
id|CHAFSR_UE
op_or
id|CHAFSR_BERR
op_or
id|CHAFSR_TO
)paren
)paren
id|recoverable
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Log errors. */
id|cheetah_log_errors
c_func
(paren
id|regs
comma
op_amp
id|local_snapshot
comma
id|afsr
comma
id|afar
comma
id|recoverable
)paren
suffix:semicolon
multiline_comment|/* &quot;Recoverable&quot; here means we try to yank the page from ever&n;&t; * being newly used again.  This depends upon a few things:&n;&t; * 1) Must be main memory, and AFAR must be valid.&n;&t; * 2) If we trapped from use, OK.&n;&t; * 3) Else, if we trapped from kernel we must find exception&n;&t; *    table entry (ie. we have to have been accessing user&n;&t; *    space).&n;&t; *&n;&t; * If AFAR is not in main memory, or we trapped from kernel&n;&t; * and cannot find an exception table entry, it is unacceptable&n;&t; * to try and continue.&n;&t; */
r_if
c_cond
(paren
id|recoverable
op_logical_and
id|is_memory
)paren
(brace
r_if
c_cond
(paren
(paren
id|regs-&gt;tstate
op_amp
id|TSTATE_PRIV
)paren
op_eq
l_int|0UL
)paren
(brace
multiline_comment|/* OK, usermode access. */
id|recoverable
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_int
r_int
id|g2
op_assign
id|regs-&gt;u_regs
(braket
id|UREG_G2
)braket
suffix:semicolon
r_int
r_int
id|fixup
op_assign
id|search_exception_table
c_func
(paren
id|regs-&gt;tpc
comma
op_amp
id|g2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fixup
op_ne
l_int|0UL
)paren
(brace
multiline_comment|/* OK, kernel access to userspace. */
id|recoverable
op_assign
l_int|1
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* BAD, privileged state is corrupted. */
id|recoverable
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|recoverable
)paren
(brace
r_struct
id|page
op_star
id|page
op_assign
id|virt_to_page
c_func
(paren
id|__va
c_func
(paren
id|afar
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|VALID_PAGE
c_func
(paren
id|page
)paren
)paren
id|get_page
c_func
(paren
id|page
)paren
suffix:semicolon
r_else
id|recoverable
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Only perform fixup if we still have a&n;&t;&t;&t;&t; * recoverable condition.&n;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|fixup
op_ne
l_int|0UL
op_logical_and
id|recoverable
)paren
(brace
id|regs-&gt;tpc
op_assign
id|fixup
suffix:semicolon
id|regs-&gt;tnpc
op_assign
id|regs-&gt;tpc
op_plus
l_int|4
suffix:semicolon
id|regs-&gt;u_regs
(braket
id|UREG_G2
)braket
op_assign
id|g2
suffix:semicolon
)brace
)brace
)brace
)brace
r_else
(brace
id|recoverable
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|recoverable
)paren
id|panic
c_func
(paren
l_string|&quot;Irrecoverable deferred error trap.&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|do_fpe_common
r_void
id|do_fpe_common
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_if
c_cond
(paren
id|regs-&gt;tstate
op_amp
id|TSTATE_PRIV
)paren
(brace
id|regs-&gt;tpc
op_assign
id|regs-&gt;tnpc
suffix:semicolon
id|regs-&gt;tnpc
op_add_assign
l_int|4
suffix:semicolon
)brace
r_else
(brace
r_int
r_int
id|fsr
op_assign
id|current-&gt;thread.xfsr
(braket
l_int|0
)braket
suffix:semicolon
id|siginfo_t
id|info
suffix:semicolon
r_if
c_cond
(paren
(paren
id|current-&gt;thread.flags
op_amp
id|SPARC_FLAG_32BIT
)paren
op_ne
l_int|0
)paren
(brace
id|regs-&gt;tpc
op_and_assign
l_int|0xffffffff
suffix:semicolon
id|regs-&gt;tnpc
op_and_assign
l_int|0xffffffff
suffix:semicolon
)brace
id|info.si_signo
op_assign
id|SIGFPE
suffix:semicolon
id|info.si_errno
op_assign
l_int|0
suffix:semicolon
id|info.si_addr
op_assign
(paren
r_void
op_star
)paren
id|regs-&gt;tpc
suffix:semicolon
id|info.si_trapno
op_assign
l_int|0
suffix:semicolon
id|info.si_code
op_assign
id|__SI_FAULT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fsr
op_amp
l_int|0x1c000
)paren
op_eq
(paren
l_int|1
op_lshift
l_int|14
)paren
)paren
(brace
r_if
c_cond
(paren
id|fsr
op_amp
l_int|0x10
)paren
id|info.si_code
op_assign
id|FPE_FLTINV
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fsr
op_amp
l_int|0x08
)paren
id|info.si_code
op_assign
id|FPE_FLTOVF
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fsr
op_amp
l_int|0x04
)paren
id|info.si_code
op_assign
id|FPE_FLTUND
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fsr
op_amp
l_int|0x02
)paren
id|info.si_code
op_assign
id|FPE_FLTDIV
suffix:semicolon
r_else
r_if
c_cond
(paren
id|fsr
op_amp
l_int|0x01
)paren
id|info.si_code
op_assign
id|FPE_FLTRES
suffix:semicolon
)brace
id|force_sig_info
c_func
(paren
id|SIGFPE
comma
op_amp
id|info
comma
id|current
)paren
suffix:semicolon
)brace
)brace
DECL|function|do_fpieee
r_void
id|do_fpieee
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|do_fpe_common
c_func
(paren
id|regs
)paren
suffix:semicolon
)brace
r_extern
r_int
id|do_mathemu
c_func
(paren
r_struct
id|pt_regs
op_star
comma
r_struct
id|fpustate
op_star
)paren
suffix:semicolon
DECL|function|do_fpother
r_void
id|do_fpother
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_struct
id|fpustate
op_star
id|f
op_assign
id|FPUSTATE
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
(paren
id|current-&gt;thread.xfsr
(braket
l_int|0
)braket
op_amp
l_int|0x1c000
)paren
)paren
(brace
r_case
(paren
l_int|2
op_lshift
l_int|14
)paren
suffix:colon
multiline_comment|/* unfinished_FPop */
r_case
(paren
l_int|3
op_lshift
l_int|14
)paren
suffix:colon
multiline_comment|/* unimplemented_FPop */
id|ret
op_assign
id|do_mathemu
c_func
(paren
id|regs
comma
id|f
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ret
)paren
r_return
suffix:semicolon
id|do_fpe_common
c_func
(paren
id|regs
)paren
suffix:semicolon
)brace
DECL|function|do_tof
r_void
id|do_tof
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|siginfo_t
id|info
suffix:semicolon
r_if
c_cond
(paren
id|regs-&gt;tstate
op_amp
id|TSTATE_PRIV
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;Penguin overflow trap from kernel mode&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|current-&gt;thread.flags
op_amp
id|SPARC_FLAG_32BIT
)paren
op_ne
l_int|0
)paren
(brace
id|regs-&gt;tpc
op_and_assign
l_int|0xffffffff
suffix:semicolon
id|regs-&gt;tnpc
op_and_assign
l_int|0xffffffff
suffix:semicolon
)brace
id|info.si_signo
op_assign
id|SIGEMT
suffix:semicolon
id|info.si_errno
op_assign
l_int|0
suffix:semicolon
id|info.si_code
op_assign
id|EMT_TAGOVF
suffix:semicolon
id|info.si_addr
op_assign
(paren
r_void
op_star
)paren
id|regs-&gt;tpc
suffix:semicolon
id|info.si_trapno
op_assign
l_int|0
suffix:semicolon
id|force_sig_info
c_func
(paren
id|SIGEMT
comma
op_amp
id|info
comma
id|current
)paren
suffix:semicolon
)brace
DECL|function|do_div0
r_void
id|do_div0
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|siginfo_t
id|info
suffix:semicolon
r_if
c_cond
(paren
(paren
id|current-&gt;thread.flags
op_amp
id|SPARC_FLAG_32BIT
)paren
op_ne
l_int|0
)paren
(brace
id|regs-&gt;tpc
op_and_assign
l_int|0xffffffff
suffix:semicolon
id|regs-&gt;tnpc
op_and_assign
l_int|0xffffffff
suffix:semicolon
)brace
id|info.si_signo
op_assign
id|SIGFPE
suffix:semicolon
id|info.si_errno
op_assign
l_int|0
suffix:semicolon
id|info.si_code
op_assign
id|FPE_INTDIV
suffix:semicolon
id|info.si_addr
op_assign
(paren
r_void
op_star
)paren
id|regs-&gt;tpc
suffix:semicolon
id|info.si_trapno
op_assign
l_int|0
suffix:semicolon
id|force_sig_info
c_func
(paren
id|SIGFPE
comma
op_amp
id|info
comma
id|current
)paren
suffix:semicolon
)brace
DECL|function|instruction_dump
r_void
id|instruction_dump
(paren
r_int
r_int
op_star
id|pc
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
(paren
r_int
r_int
)paren
id|pc
)paren
op_amp
l_int|3
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;Instruction DUMP:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
op_minus
l_int|3
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%c%08x%c&quot;
comma
id|i
ques
c_cond
l_char|&squot; &squot;
suffix:colon
l_char|&squot;&lt;&squot;
comma
id|pc
(braket
id|i
)braket
comma
id|i
ques
c_cond
l_char|&squot; &squot;
suffix:colon
l_char|&squot;&gt;&squot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|user_instruction_dump
r_void
id|user_instruction_dump
(paren
r_int
r_int
op_star
id|pc
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_int
id|buf
(braket
l_int|9
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
(paren
(paren
r_int
r_int
)paren
id|pc
)paren
op_amp
l_int|3
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|buf
comma
id|pc
op_minus
l_int|3
comma
r_sizeof
(paren
id|buf
)paren
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;Instruction DUMP:&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|9
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%c%08x%c&quot;
comma
id|i
op_eq
l_int|3
ques
c_cond
l_char|&squot; &squot;
suffix:colon
l_char|&squot;&lt;&squot;
comma
id|buf
(braket
id|i
)braket
comma
id|i
op_eq
l_int|3
ques
c_cond
l_char|&squot; &squot;
suffix:colon
l_char|&squot;&gt;&squot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|show_trace_task
r_void
id|show_trace_task
c_func
(paren
r_struct
id|task_struct
op_star
id|tsk
)paren
(brace
r_int
r_int
id|pc
comma
id|fp
suffix:semicolon
r_int
r_int
id|task_base
op_assign
(paren
r_int
r_int
)paren
id|tsk
suffix:semicolon
r_struct
id|reg_window
op_star
id|rw
suffix:semicolon
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tsk
)paren
r_return
suffix:semicolon
id|fp
op_assign
id|tsk-&gt;thread.ksp
op_plus
id|STACK_BIAS
suffix:semicolon
r_do
(brace
multiline_comment|/* Bogus frame pointer? */
r_if
c_cond
(paren
id|fp
OL
(paren
id|task_base
op_plus
r_sizeof
(paren
r_struct
id|task_struct
)paren
)paren
op_logical_or
id|fp
op_ge
(paren
id|task_base
op_plus
id|THREAD_SIZE
)paren
)paren
r_break
suffix:semicolon
id|rw
op_assign
(paren
r_struct
id|reg_window
op_star
)paren
id|fp
suffix:semicolon
id|pc
op_assign
id|rw-&gt;ins
(braket
l_int|7
)braket
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;[%016lx] &quot;
comma
id|pc
)paren
suffix:semicolon
id|fp
op_assign
id|rw-&gt;ins
(braket
l_int|6
)braket
op_plus
id|STACK_BIAS
suffix:semicolon
)brace
r_while
c_loop
(paren
op_increment
id|count
OL
l_int|16
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|die_if_kernel
r_void
id|die_if_kernel
c_func
(paren
r_char
op_star
id|str
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_extern
r_void
id|__show_regs
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_extern
r_void
id|smp_report_regs
c_func
(paren
r_void
)paren
suffix:semicolon
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_struct
id|reg_window
op_star
id|lastrw
suffix:semicolon
multiline_comment|/* Amuse the user. */
id|printk
c_func
(paren
l_string|&quot;              &bslash;&bslash;|/ ____ &bslash;&bslash;|/&bslash;n&quot;
l_string|&quot;              &bslash;&quot;@&squot;/ .. &bslash;&bslash;`@&bslash;&quot;&bslash;n&quot;
l_string|&quot;              /_| &bslash;&bslash;__/ |_&bslash;&bslash;&bslash;n&quot;
l_string|&quot;                 &bslash;&bslash;__U_/&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s(%d): %s&bslash;n&quot;
comma
id|current-&gt;comm
comma
id|current-&gt;pid
comma
id|str
)paren
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;flushw&quot;
)paren
suffix:semicolon
id|__show_regs
c_func
(paren
id|regs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|regs-&gt;tstate
op_amp
id|TSTATE_PRIV
)paren
(brace
r_struct
id|reg_window
op_star
id|rw
op_assign
(paren
r_struct
id|reg_window
op_star
)paren
(paren
id|regs-&gt;u_regs
(braket
id|UREG_FP
)braket
op_plus
id|STACK_BIAS
)paren
suffix:semicolon
multiline_comment|/* Stop the back trace when we hit userland or we&n;&t;&t; * find some badly aligned kernel stack.&n;&t;&t; */
id|lastrw
op_assign
(paren
r_struct
id|reg_window
op_star
)paren
id|current
suffix:semicolon
r_while
c_loop
(paren
id|rw
op_logical_and
id|count
op_increment
OL
l_int|30
op_logical_and
id|rw
op_ge
id|lastrw
op_logical_and
(paren
r_char
op_star
)paren
id|rw
OL
(paren
(paren
r_char
op_star
)paren
id|current
)paren
op_plus
r_sizeof
(paren
r_union
id|task_union
)paren
op_logical_and
op_logical_neg
(paren
(paren
(paren
r_int
r_int
)paren
id|rw
)paren
op_amp
l_int|0x7
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Caller[%016lx]&bslash;n&quot;
comma
id|rw-&gt;ins
(braket
l_int|7
)braket
)paren
suffix:semicolon
id|lastrw
op_assign
id|rw
suffix:semicolon
id|rw
op_assign
(paren
r_struct
id|reg_window
op_star
)paren
(paren
id|rw-&gt;ins
(braket
l_int|6
)braket
op_plus
id|STACK_BIAS
)paren
suffix:semicolon
)brace
id|instruction_dump
(paren
(paren
r_int
r_int
op_star
)paren
id|regs-&gt;tpc
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|current-&gt;thread.flags
op_amp
id|SPARC_FLAG_32BIT
)paren
op_ne
l_int|0
)paren
(brace
id|regs-&gt;tpc
op_and_assign
l_int|0xffffffff
suffix:semicolon
id|regs-&gt;tnpc
op_and_assign
l_int|0xffffffff
suffix:semicolon
)brace
id|user_instruction_dump
(paren
(paren
r_int
r_int
op_star
)paren
id|regs-&gt;tpc
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_SMP
id|smp_report_regs
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|regs-&gt;tstate
op_amp
id|TSTATE_PRIV
)paren
(brace
id|do_exit
c_func
(paren
id|SIGKILL
)paren
suffix:semicolon
)brace
id|do_exit
c_func
(paren
id|SIGSEGV
)paren
suffix:semicolon
)brace
r_extern
r_int
id|handle_popc
c_func
(paren
id|u32
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_extern
r_int
id|handle_ldf_stq
c_func
(paren
id|u32
id|insn
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
DECL|function|do_illegal_instruction
r_void
id|do_illegal_instruction
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|pc
op_assign
id|regs-&gt;tpc
suffix:semicolon
r_int
r_int
id|tstate
op_assign
id|regs-&gt;tstate
suffix:semicolon
id|u32
id|insn
suffix:semicolon
id|siginfo_t
id|info
suffix:semicolon
r_if
c_cond
(paren
id|tstate
op_amp
id|TSTATE_PRIV
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;Kernel illegal instruction&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|current-&gt;thread.flags
op_amp
id|SPARC_FLAG_32BIT
)paren
(brace
id|pc
op_assign
(paren
id|u32
)paren
id|pc
suffix:semicolon
)brace
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|insn
comma
(paren
id|u32
op_star
)paren
id|pc
)paren
op_ne
op_minus
id|EFAULT
)paren
(brace
r_if
c_cond
(paren
(paren
id|insn
op_amp
l_int|0xc1ffc000
)paren
op_eq
l_int|0x81700000
)paren
multiline_comment|/* POPC */
(brace
r_if
c_cond
(paren
id|handle_popc
c_func
(paren
id|insn
comma
id|regs
)paren
)paren
r_return
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
(paren
id|insn
op_amp
l_int|0xc1580000
)paren
op_eq
l_int|0xc1100000
)paren
multiline_comment|/* LDQ/STQ */
(brace
r_if
c_cond
(paren
id|handle_ldf_stq
c_func
(paren
id|insn
comma
id|regs
)paren
)paren
r_return
suffix:semicolon
)brace
)brace
id|info.si_signo
op_assign
id|SIGILL
suffix:semicolon
id|info.si_errno
op_assign
l_int|0
suffix:semicolon
id|info.si_code
op_assign
id|ILL_ILLOPC
suffix:semicolon
id|info.si_addr
op_assign
(paren
r_void
op_star
)paren
id|pc
suffix:semicolon
id|info.si_trapno
op_assign
l_int|0
suffix:semicolon
id|force_sig_info
c_func
(paren
id|SIGILL
comma
op_amp
id|info
comma
id|current
)paren
suffix:semicolon
)brace
DECL|function|mem_address_unaligned
r_void
id|mem_address_unaligned
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
r_int
id|sfar
comma
r_int
r_int
id|sfsr
)paren
(brace
id|siginfo_t
id|info
suffix:semicolon
r_if
c_cond
(paren
id|regs-&gt;tstate
op_amp
id|TSTATE_PRIV
)paren
(brace
r_extern
r_void
id|kernel_unaligned_trap
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
comma
r_int
r_int
id|insn
comma
r_int
r_int
id|sfar
comma
r_int
r_int
id|sfsr
)paren
suffix:semicolon
r_return
id|kernel_unaligned_trap
c_func
(paren
id|regs
comma
op_star
(paren
(paren
r_int
r_int
op_star
)paren
id|regs-&gt;tpc
)paren
comma
id|sfar
comma
id|sfsr
)paren
suffix:semicolon
)brace
id|info.si_signo
op_assign
id|SIGBUS
suffix:semicolon
id|info.si_errno
op_assign
l_int|0
suffix:semicolon
id|info.si_code
op_assign
id|BUS_ADRALN
suffix:semicolon
id|info.si_addr
op_assign
(paren
r_void
op_star
)paren
id|sfar
suffix:semicolon
id|info.si_trapno
op_assign
l_int|0
suffix:semicolon
id|force_sig_info
c_func
(paren
id|SIGBUS
comma
op_amp
id|info
comma
id|current
)paren
suffix:semicolon
)brace
DECL|function|do_privop
r_void
id|do_privop
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|siginfo_t
id|info
suffix:semicolon
r_if
c_cond
(paren
(paren
id|current-&gt;thread.flags
op_amp
id|SPARC_FLAG_32BIT
)paren
op_ne
l_int|0
)paren
(brace
id|regs-&gt;tpc
op_and_assign
l_int|0xffffffff
suffix:semicolon
id|regs-&gt;tnpc
op_and_assign
l_int|0xffffffff
suffix:semicolon
)brace
id|info.si_signo
op_assign
id|SIGILL
suffix:semicolon
id|info.si_errno
op_assign
l_int|0
suffix:semicolon
id|info.si_code
op_assign
id|ILL_PRVOPC
suffix:semicolon
id|info.si_addr
op_assign
(paren
r_void
op_star
)paren
id|regs-&gt;tpc
suffix:semicolon
id|info.si_trapno
op_assign
l_int|0
suffix:semicolon
id|force_sig_info
c_func
(paren
id|SIGILL
comma
op_amp
id|info
comma
id|current
)paren
suffix:semicolon
)brace
DECL|function|do_privact
r_void
id|do_privact
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|do_privop
c_func
(paren
id|regs
)paren
suffix:semicolon
)brace
multiline_comment|/* Trap level 1 stuff or other traps we should never see... */
DECL|function|do_cee
r_void
id|do_cee
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;TL0: Cache Error Exception&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|do_cee_tl1
r_void
id|do_cee_tl1
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;TL1: Cache Error Exception&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|do_dae_tl1
r_void
id|do_dae_tl1
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;TL1: Data Access Exception&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|do_iae_tl1
r_void
id|do_iae_tl1
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;TL1: Instruction Access Exception&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|do_div0_tl1
r_void
id|do_div0_tl1
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;TL1: DIV0 Exception&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|do_fpdis_tl1
r_void
id|do_fpdis_tl1
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;TL1: FPU Disabled&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|do_fpieee_tl1
r_void
id|do_fpieee_tl1
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;TL1: FPU IEEE Exception&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|do_fpother_tl1
r_void
id|do_fpother_tl1
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;TL1: FPU Other Exception&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|do_ill_tl1
r_void
id|do_ill_tl1
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;TL1: Illegal Instruction Exception&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|do_irq_tl1
r_void
id|do_irq_tl1
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;TL1: IRQ Exception&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|do_lddfmna_tl1
r_void
id|do_lddfmna_tl1
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;TL1: LDDF Exception&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|do_stdfmna_tl1
r_void
id|do_stdfmna_tl1
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;TL1: STDF Exception&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|do_paw
r_void
id|do_paw
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;TL0: Phys Watchpoint Exception&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|do_paw_tl1
r_void
id|do_paw_tl1
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;TL1: Phys Watchpoint Exception&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|do_vaw
r_void
id|do_vaw
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;TL0: Virt Watchpoint Exception&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|do_vaw_tl1
r_void
id|do_vaw_tl1
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;TL1: Virt Watchpoint Exception&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|do_tof_tl1
r_void
id|do_tof_tl1
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|die_if_kernel
c_func
(paren
l_string|&quot;TL1: Tag Overflow Exception&quot;
comma
id|regs
)paren
suffix:semicolon
)brace
DECL|function|do_getpsr
r_void
id|do_getpsr
c_func
(paren
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|regs-&gt;u_regs
(braket
id|UREG_I0
)braket
op_assign
id|tstate_to_psr
c_func
(paren
id|regs-&gt;tstate
)paren
suffix:semicolon
id|regs-&gt;tpc
op_assign
id|regs-&gt;tnpc
suffix:semicolon
id|regs-&gt;tnpc
op_add_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
(paren
id|current-&gt;thread.flags
op_amp
id|SPARC_FLAG_32BIT
)paren
op_ne
l_int|0
)paren
(brace
id|regs-&gt;tpc
op_and_assign
l_int|0xffffffff
suffix:semicolon
id|regs-&gt;tnpc
op_and_assign
l_int|0xffffffff
suffix:semicolon
)brace
)brace
multiline_comment|/* Only invoked on boot processor. */
DECL|function|trap_init
r_void
id|trap_init
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* Attach to the address space of init_task.  On SMP we&n;&t; * do this in smp.c:smp_callin for other cpus.&n;&t; */
id|atomic_inc
c_func
(paren
op_amp
id|init_mm.mm_count
)paren
suffix:semicolon
id|current-&gt;active_mm
op_assign
op_amp
id|init_mm
suffix:semicolon
macro_line|#ifdef CONFIG_SMP
id|current-&gt;cpu
op_assign
id|hard_smp_processor_id
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
)brace
eof
