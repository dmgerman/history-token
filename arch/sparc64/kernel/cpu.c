multiline_comment|/* cpu.c: Dinky routines to look for the kind of Sparc cpu&n; *        we are on.&n; *&n; * Copyright (C) 1996 David S. Miller (davem@caip.rutgers.edu)&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;asm/asi.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/fpumacro.h&gt;
macro_line|#include &lt;asm/cpudata.h&gt;
id|DEFINE_PER_CPU
c_func
(paren
id|cpuinfo_sparc
comma
id|__cpu_data
)paren
op_assign
(brace
l_int|0
)brace
suffix:semicolon
DECL|struct|cpu_iu_info
r_struct
id|cpu_iu_info
(brace
DECL|member|manuf
r_int
id|manuf
suffix:semicolon
DECL|member|impl
r_int
id|impl
suffix:semicolon
DECL|member|cpu_name
r_char
op_star
id|cpu_name
suffix:semicolon
multiline_comment|/* should be enough I hope... */
)brace
suffix:semicolon
DECL|struct|cpu_fp_info
r_struct
id|cpu_fp_info
(brace
DECL|member|manuf
r_int
id|manuf
suffix:semicolon
DECL|member|impl
r_int
id|impl
suffix:semicolon
DECL|member|fpu_vers
r_char
id|fpu_vers
suffix:semicolon
DECL|member|fp_name
r_char
op_star
id|fp_name
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|linux_sparc_fpu
r_struct
id|cpu_fp_info
id|linux_sparc_fpu
(braket
)braket
op_assign
(brace
(brace
l_int|0x17
comma
l_int|0x10
comma
l_int|0
comma
l_string|&quot;UltraSparc I integrated FPU&quot;
)brace
comma
(brace
l_int|0x22
comma
l_int|0x10
comma
l_int|0
comma
l_string|&quot;UltraSparc I integrated FPU&quot;
)brace
comma
(brace
l_int|0x17
comma
l_int|0x11
comma
l_int|0
comma
l_string|&quot;UltraSparc II integrated FPU&quot;
)brace
comma
(brace
l_int|0x17
comma
l_int|0x12
comma
l_int|0
comma
l_string|&quot;UltraSparc IIi integrated FPU&quot;
)brace
comma
(brace
l_int|0x17
comma
l_int|0x13
comma
l_int|0
comma
l_string|&quot;UltraSparc IIe integrated FPU&quot;
)brace
comma
(brace
l_int|0x3e
comma
l_int|0x14
comma
l_int|0
comma
l_string|&quot;UltraSparc III integrated FPU&quot;
)brace
comma
(brace
l_int|0x3e
comma
l_int|0x15
comma
l_int|0
comma
l_string|&quot;UltraSparc III+ integrated FPU&quot;
)brace
comma
(brace
l_int|0x3e
comma
l_int|0x16
comma
l_int|0
comma
l_string|&quot;UltraSparc IIIi integrated FPU&quot;
)brace
comma
)brace
suffix:semicolon
DECL|macro|NSPARCFPU
mdefine_line|#define NSPARCFPU  (sizeof(linux_sparc_fpu)/sizeof(struct cpu_fp_info))
DECL|variable|linux_sparc_chips
r_struct
id|cpu_iu_info
id|linux_sparc_chips
(braket
)braket
op_assign
(brace
(brace
l_int|0x17
comma
l_int|0x10
comma
l_string|&quot;TI UltraSparc I   (SpitFire)&quot;
)brace
comma
(brace
l_int|0x22
comma
l_int|0x10
comma
l_string|&quot;TI UltraSparc I   (SpitFire)&quot;
)brace
comma
(brace
l_int|0x17
comma
l_int|0x11
comma
l_string|&quot;TI UltraSparc II  (BlackBird)&quot;
)brace
comma
(brace
l_int|0x17
comma
l_int|0x12
comma
l_string|&quot;TI UltraSparc IIi (Sabre)&quot;
)brace
comma
(brace
l_int|0x17
comma
l_int|0x13
comma
l_string|&quot;TI UltraSparc IIe (Hummingbird)&quot;
)brace
comma
(brace
l_int|0x3e
comma
l_int|0x14
comma
l_string|&quot;TI UltraSparc III (Cheetah)&quot;
)brace
comma
(brace
l_int|0x3e
comma
l_int|0x15
comma
l_string|&quot;TI UltraSparc III+ (Cheetah+)&quot;
)brace
comma
(brace
l_int|0x3e
comma
l_int|0x16
comma
l_string|&quot;TI UltraSparc IIIi (Jalapeno)&quot;
)brace
comma
)brace
suffix:semicolon
DECL|macro|NSPARCCHIPS
mdefine_line|#define NSPARCCHIPS  (sizeof(linux_sparc_chips)/sizeof(struct cpu_iu_info))
DECL|variable|sparc_cpu_type
r_char
op_star
id|sparc_cpu_type
op_assign
l_string|&quot;cpu-oops&quot;
suffix:semicolon
DECL|variable|sparc_fpu_type
r_char
op_star
id|sparc_fpu_type
op_assign
l_string|&quot;fpu-oops&quot;
suffix:semicolon
DECL|variable|fsr_storage
r_int
r_int
id|fsr_storage
suffix:semicolon
DECL|function|cpu_probe
r_void
id|__init
id|cpu_probe
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|ver
comma
id|fpu_vers
comma
id|manuf
comma
id|impl
comma
id|fprs
suffix:semicolon
r_int
id|i
suffix:semicolon
id|fprs
op_assign
id|fprs_read
c_func
(paren
)paren
suffix:semicolon
id|fprs_write
c_func
(paren
id|FPRS_FEF
)paren
suffix:semicolon
id|__asm__
id|__volatile__
(paren
l_string|&quot;rdpr %%ver, %0; stx %%fsr, [%1]&quot;
suffix:colon
l_string|&quot;=&amp;r&quot;
(paren
id|ver
)paren
suffix:colon
l_string|&quot;r&quot;
(paren
op_amp
id|fpu_vers
)paren
)paren
suffix:semicolon
id|fprs_write
c_func
(paren
id|fprs
)paren
suffix:semicolon
id|manuf
op_assign
(paren
(paren
id|ver
op_rshift
l_int|48
)paren
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|impl
op_assign
(paren
(paren
id|ver
op_rshift
l_int|32
)paren
op_amp
l_int|0xffff
)paren
suffix:semicolon
id|fpu_vers
op_assign
(paren
(paren
id|fpu_vers
op_rshift
l_int|17
)paren
op_amp
l_int|0x7
)paren
suffix:semicolon
id|retry
suffix:colon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NSPARCCHIPS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|linux_sparc_chips
(braket
id|i
)braket
dot
id|manuf
op_eq
id|manuf
)paren
(brace
r_if
c_cond
(paren
id|linux_sparc_chips
(braket
id|i
)braket
dot
id|impl
op_eq
id|impl
)paren
(brace
id|sparc_cpu_type
op_assign
id|linux_sparc_chips
(braket
id|i
)braket
dot
id|cpu_name
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|i
op_eq
id|NSPARCCHIPS
)paren
(brace
multiline_comment|/* Maybe it is a cheetah+ derivative, report it as cheetah+&n; &t;&t; * in that case until we learn the real names.&n; &t;&t; */
r_if
c_cond
(paren
id|manuf
op_eq
l_int|0x3e
op_logical_and
id|impl
OG
l_int|0x15
)paren
(brace
id|impl
op_assign
l_int|0x15
suffix:semicolon
r_goto
id|retry
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot;DEBUG: manuf[%lx] impl[%lx]&bslash;n&quot;
comma
id|manuf
comma
id|impl
)paren
suffix:semicolon
)brace
id|sparc_cpu_type
op_assign
l_string|&quot;Unknown CPU&quot;
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NSPARCFPU
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|linux_sparc_fpu
(braket
id|i
)braket
dot
id|manuf
op_eq
id|manuf
op_logical_and
id|linux_sparc_fpu
(braket
id|i
)braket
dot
id|impl
op_eq
id|impl
)paren
(brace
r_if
c_cond
(paren
id|linux_sparc_fpu
(braket
id|i
)braket
dot
id|fpu_vers
op_eq
id|fpu_vers
)paren
(brace
id|sparc_fpu_type
op_assign
id|linux_sparc_fpu
(braket
id|i
)braket
dot
id|fp_name
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|i
op_eq
id|NSPARCFPU
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;DEBUG: manuf[%lx] impl[%lx] fsr.vers[%lx]&bslash;n&quot;
comma
id|manuf
comma
id|impl
comma
id|fpu_vers
)paren
suffix:semicolon
id|sparc_fpu_type
op_assign
l_string|&quot;Unknown FPU&quot;
suffix:semicolon
)brace
)brace
eof
