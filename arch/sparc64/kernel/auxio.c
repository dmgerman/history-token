multiline_comment|/* auxio.c: Probing for the Sparc AUXIO register at boot time.&n; *&n; * Copyright (C) 1996 David S. Miller (davem@caip.rutgers.edu)&n; *&n; * Refactoring for unified NCR/PCIO support 2002 Eric Brower (ebrower@usa.net)&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/ioport.h&gt;
macro_line|#include &lt;asm/oplib.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/sbus.h&gt;
macro_line|#include &lt;asm/ebus.h&gt;
macro_line|#include &lt;asm/auxio.h&gt;
multiline_comment|/* This cannot be static, as it is referenced in entry.S */
DECL|variable|auxio_register
r_void
id|__iomem
op_star
id|auxio_register
op_assign
l_int|NULL
suffix:semicolon
DECL|enum|auxio_type
r_enum
id|auxio_type
(brace
DECL|enumerator|AUXIO_TYPE_NODEV
id|AUXIO_TYPE_NODEV
comma
DECL|enumerator|AUXIO_TYPE_SBUS
id|AUXIO_TYPE_SBUS
comma
DECL|enumerator|AUXIO_TYPE_EBUS
id|AUXIO_TYPE_EBUS
)brace
suffix:semicolon
DECL|variable|auxio_devtype
r_static
r_enum
id|auxio_type
id|auxio_devtype
op_assign
id|AUXIO_TYPE_NODEV
suffix:semicolon
r_static
id|DEFINE_SPINLOCK
c_func
(paren
id|auxio_lock
)paren
suffix:semicolon
DECL|function|__auxio_sbus_set
r_static
r_void
id|__auxio_sbus_set
c_func
(paren
id|u8
id|bits_on
comma
id|u8
id|bits_off
)paren
(brace
r_if
c_cond
(paren
id|auxio_register
)paren
(brace
r_int
r_char
id|regval
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|newval
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|auxio_lock
comma
id|flags
)paren
suffix:semicolon
id|regval
op_assign
id|sbus_readb
c_func
(paren
id|auxio_register
)paren
suffix:semicolon
id|newval
op_assign
id|regval
op_or
id|bits_on
suffix:semicolon
id|newval
op_and_assign
op_complement
id|bits_off
suffix:semicolon
id|newval
op_and_assign
op_complement
id|AUXIO_AUX1_MASK
suffix:semicolon
id|sbus_writeb
c_func
(paren
id|newval
comma
id|auxio_register
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|auxio_lock
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
DECL|function|__auxio_ebus_set
r_static
r_void
id|__auxio_ebus_set
c_func
(paren
id|u8
id|bits_on
comma
id|u8
id|bits_off
)paren
(brace
r_if
c_cond
(paren
id|auxio_register
)paren
(brace
r_int
r_char
id|regval
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_char
id|newval
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|auxio_lock
comma
id|flags
)paren
suffix:semicolon
id|regval
op_assign
(paren
id|u8
)paren
id|readl
c_func
(paren
id|auxio_register
)paren
suffix:semicolon
id|newval
op_assign
id|regval
op_or
id|bits_on
suffix:semicolon
id|newval
op_and_assign
op_complement
id|bits_off
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
id|newval
comma
id|auxio_register
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|auxio_lock
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
DECL|function|__auxio_ebus_set_led
r_static
r_inline
r_void
id|__auxio_ebus_set_led
c_func
(paren
r_int
id|on
)paren
(brace
(paren
id|on
)paren
ques
c_cond
id|__auxio_ebus_set
c_func
(paren
id|AUXIO_PCIO_LED
comma
l_int|0
)paren
suffix:colon
id|__auxio_ebus_set
c_func
(paren
l_int|0
comma
id|AUXIO_PCIO_LED
)paren
suffix:semicolon
)brace
DECL|function|__auxio_sbus_set_led
r_static
r_inline
r_void
id|__auxio_sbus_set_led
c_func
(paren
r_int
id|on
)paren
(brace
(paren
id|on
)paren
ques
c_cond
id|__auxio_sbus_set
c_func
(paren
id|AUXIO_AUX1_LED
comma
l_int|0
)paren
suffix:colon
id|__auxio_sbus_set
c_func
(paren
l_int|0
comma
id|AUXIO_AUX1_LED
)paren
suffix:semicolon
)brace
DECL|function|auxio_set_led
r_void
id|auxio_set_led
c_func
(paren
r_int
id|on
)paren
(brace
r_switch
c_cond
(paren
id|auxio_devtype
)paren
(brace
r_case
id|AUXIO_TYPE_SBUS
suffix:colon
id|__auxio_sbus_set_led
c_func
(paren
id|on
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUXIO_TYPE_EBUS
suffix:colon
id|__auxio_ebus_set_led
c_func
(paren
id|on
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
DECL|function|__auxio_sbus_set_lte
r_static
r_inline
r_void
id|__auxio_sbus_set_lte
c_func
(paren
r_int
id|on
)paren
(brace
(paren
id|on
)paren
ques
c_cond
id|__auxio_sbus_set
c_func
(paren
id|AUXIO_AUX1_LTE
comma
l_int|0
)paren
suffix:colon
id|__auxio_sbus_set
c_func
(paren
l_int|0
comma
id|AUXIO_AUX1_LTE
)paren
suffix:semicolon
)brace
DECL|function|auxio_set_lte
r_void
id|auxio_set_lte
c_func
(paren
r_int
id|on
)paren
(brace
r_switch
c_cond
(paren
id|auxio_devtype
)paren
(brace
r_case
id|AUXIO_TYPE_SBUS
suffix:colon
id|__auxio_sbus_set_lte
c_func
(paren
id|on
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AUXIO_TYPE_EBUS
suffix:colon
multiline_comment|/* FALL-THROUGH */
r_default
suffix:colon
r_break
suffix:semicolon
)brace
)brace
DECL|function|auxio_probe
r_void
id|__init
id|auxio_probe
c_func
(paren
r_void
)paren
(brace
r_struct
id|sbus_bus
op_star
id|sbus
suffix:semicolon
r_struct
id|sbus_dev
op_star
id|sdev
op_assign
l_int|NULL
suffix:semicolon
id|for_each_sbus
c_func
(paren
id|sbus
)paren
(brace
id|for_each_sbusdev
c_func
(paren
id|sdev
comma
id|sbus
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|sdev-&gt;prom_name
comma
l_string|&quot;auxio&quot;
)paren
)paren
(brace
r_goto
id|found_sdev
suffix:semicolon
)brace
)brace
)brace
id|found_sdev
suffix:colon
r_if
c_cond
(paren
id|sdev
)paren
(brace
id|auxio_devtype
op_assign
id|AUXIO_TYPE_SBUS
suffix:semicolon
id|auxio_register
op_assign
id|sbus_ioremap
c_func
(paren
op_amp
id|sdev-&gt;resource
(braket
l_int|0
)braket
comma
l_int|0
comma
id|sdev-&gt;reg_addrs
(braket
l_int|0
)braket
dot
id|reg_size
comma
l_string|&quot;auxiliaryIO&quot;
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PCI
r_else
(brace
r_struct
id|linux_ebus
op_star
id|ebus
suffix:semicolon
r_struct
id|linux_ebus_device
op_star
id|edev
op_assign
l_int|NULL
suffix:semicolon
id|for_each_ebus
c_func
(paren
id|ebus
)paren
(brace
id|for_each_ebusdev
c_func
(paren
id|edev
comma
id|ebus
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|edev-&gt;prom_name
comma
l_string|&quot;auxio&quot;
)paren
)paren
r_goto
id|ebus_done
suffix:semicolon
)brace
)brace
id|ebus_done
suffix:colon
r_if
c_cond
(paren
id|edev
)paren
(brace
id|auxio_devtype
op_assign
id|AUXIO_TYPE_EBUS
suffix:semicolon
id|auxio_register
op_assign
id|ioremap
c_func
(paren
id|edev-&gt;resource
(braket
l_int|0
)braket
dot
id|start
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
)brace
)brace
id|auxio_set_led
c_func
(paren
id|AUXIO_LED_ON
)paren
suffix:semicolon
macro_line|#endif
)brace
eof
