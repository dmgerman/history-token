macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/platform.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &quot;piix4.h&quot;
DECL|variable|pm_power_off
r_void
(paren
op_star
id|pm_power_off
)paren
(paren
r_void
)paren
suffix:semicolon
DECL|variable|reboot_thru_bios
r_int
id|reboot_thru_bios
suffix:semicolon
DECL|variable|reboot_smp
r_int
id|reboot_smp
suffix:semicolon
DECL|function|machine_restart
r_void
id|machine_restart
c_func
(paren
r_char
op_star
id|__unused
)paren
(brace
macro_line|#ifdef CONFIG_SMP
id|smp_send_stop
c_func
(paren
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/*&n;&t; * Visual Workstations restart after this&n;&t; * register is poked on the PIIX4&n;&t; */
id|outb
c_func
(paren
id|PIIX4_RESET_VAL
comma
id|PIIX4_RESET_PORT
)paren
suffix:semicolon
)brace
DECL|function|machine_power_off
r_void
id|machine_power_off
c_func
(paren
r_void
)paren
(brace
r_int
r_int
id|pm_status
suffix:semicolon
r_extern
r_int
r_int
id|pci_bus0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|pm_status
op_assign
id|inw
c_func
(paren
id|PMSTS_PORT
)paren
)paren
op_amp
l_int|0x100
)paren
id|outw
c_func
(paren
id|pm_status
comma
id|PMSTS_PORT
)paren
suffix:semicolon
id|outw
c_func
(paren
id|PM_SUSPEND_ENABLE
comma
id|PMCNTRL_PORT
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
DECL|macro|PCI_CONF1_ADDRESS
mdefine_line|#define PCI_CONF1_ADDRESS(bus, devfn, reg) &bslash;&n;&t;(0x80000000 | (bus &lt;&lt; 16) | (devfn &lt;&lt; 8) | (reg &amp; ~3))
id|outl
c_func
(paren
id|PCI_CONF1_ADDRESS
c_func
(paren
id|pci_bus0
comma
id|SPECIAL_DEV
comma
id|SPECIAL_REG
)paren
comma
l_int|0xCF8
)paren
suffix:semicolon
id|outl
c_func
(paren
id|PIIX_SPECIAL_STOP
comma
l_int|0xCFC
)paren
suffix:semicolon
)brace
DECL|function|machine_halt
r_void
id|machine_halt
c_func
(paren
r_void
)paren
(brace
)brace
eof
