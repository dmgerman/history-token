multiline_comment|/*&n; * This file contains work-arounds for x86 and x86_64 platform bugs.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/irq.h&gt;
macro_line|#if defined(CONFIG_X86_IO_APIC) &amp;&amp; defined(CONFIG_SMP) &amp;&amp; defined(CONFIG_PCI)
DECL|function|quirk_intel_irqbalance
r_static
r_void
id|__devinit
id|quirk_intel_irqbalance
c_func
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
id|u8
id|config
comma
id|rev
suffix:semicolon
id|u32
id|word
suffix:semicolon
multiline_comment|/* BIOS may enable hardware IRQ balancing for&n;&t; * E7520/E7320/E7525(revision ID 0x9 and below)&n;&t; * based platforms.&n;&t; * Disable SW irqbalance/affinity on those platforms.&n;&t; */
id|pci_read_config_byte
c_func
(paren
id|dev
comma
id|PCI_CLASS_REVISION
comma
op_amp
id|rev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rev
OG
l_int|0x9
)paren
r_return
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Intel E7520/7320/7525 detected.&quot;
)paren
suffix:semicolon
multiline_comment|/* enable access to config space*/
id|pci_read_config_byte
c_func
(paren
id|dev
comma
l_int|0xf4
comma
op_amp
id|config
)paren
suffix:semicolon
id|config
op_or_assign
l_int|0x2
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|dev
comma
l_int|0xf4
comma
id|config
)paren
suffix:semicolon
multiline_comment|/* read xTPR register */
id|raw_pci_ops
op_member_access_from_pointer
id|read
c_func
(paren
l_int|0
comma
l_int|0
comma
l_int|0x40
comma
l_int|0x4c
comma
l_int|2
comma
op_amp
id|word
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|word
op_amp
(paren
l_int|1
op_lshift
l_int|13
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Disabling irq balancing and affinity&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_IRQBALANCE
id|irqbalance_disable
c_func
(paren
l_string|&quot;&quot;
)paren
suffix:semicolon
macro_line|#endif
id|noirqdebug_setup
c_func
(paren
l_string|&quot;&quot;
)paren
suffix:semicolon
id|no_irq_affinity
op_assign
l_int|1
suffix:semicolon
)brace
id|config
op_and_assign
op_complement
l_int|0x2
suffix:semicolon
multiline_comment|/* disable access to config space*/
id|pci_write_config_byte
c_func
(paren
id|dev
comma
l_int|0xf4
comma
id|config
)paren
suffix:semicolon
)brace
id|DECLARE_PCI_FIXUP_FINAL
c_func
(paren
id|PCI_VENDOR_ID_INTEL
comma
id|PCI_DEVICE_ID_INTEL_E7320_MCH
comma
id|quirk_intel_irqbalance
)paren
suffix:semicolon
id|DECLARE_PCI_FIXUP_FINAL
c_func
(paren
id|PCI_VENDOR_ID_INTEL
comma
id|PCI_DEVICE_ID_INTEL_E7525_MCH
comma
id|quirk_intel_irqbalance
)paren
suffix:semicolon
id|DECLARE_PCI_FIXUP_FINAL
c_func
(paren
id|PCI_VENDOR_ID_INTEL
comma
id|PCI_DEVICE_ID_INTEL_E7520_MCH
comma
id|quirk_intel_irqbalance
)paren
suffix:semicolon
macro_line|#endif
eof
