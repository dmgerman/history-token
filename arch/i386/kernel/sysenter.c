multiline_comment|/*&n; * linux/arch/i386/kernel/sysenter.c&n; *&n; * (C) Copyright 2002 Linus Torvalds&n; *&n; * This file contains the needed initializations to support sysenter.&n; */
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/smp.h&gt;
macro_line|#include &lt;linux/thread_info.h&gt;
macro_line|#include &lt;linux/gfp.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;asm/cpufeature.h&gt;
macro_line|#include &lt;asm/msr.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
r_extern
id|asmlinkage
r_void
id|sysenter_entry
c_func
(paren
r_void
)paren
suffix:semicolon
DECL|function|enable_sep_cpu
r_static
r_void
id|__init
id|enable_sep_cpu
c_func
(paren
r_void
op_star
id|info
)paren
(brace
r_int
r_int
id|page
op_assign
id|__get_free_page
c_func
(paren
id|GFP_ATOMIC
)paren
suffix:semicolon
r_int
id|cpu
op_assign
id|get_cpu
c_func
(paren
)paren
suffix:semicolon
r_int
r_int
op_star
id|esp0_ptr
op_assign
op_amp
(paren
id|init_tss
op_plus
id|cpu
)paren
op_member_access_from_pointer
id|esp0
suffix:semicolon
r_int
r_int
id|rel32
suffix:semicolon
id|rel32
op_assign
(paren
r_int
r_int
)paren
id|sysenter_entry
op_minus
(paren
id|page
op_plus
l_int|11
)paren
suffix:semicolon
op_star
(paren
r_int
op_star
)paren
(paren
id|page
op_plus
l_int|0
)paren
op_assign
l_int|0x258b
suffix:semicolon
multiline_comment|/* movl xxxxx,%esp */
op_star
(paren
r_int
op_star
op_star
)paren
(paren
id|page
op_plus
l_int|2
)paren
op_assign
id|esp0_ptr
suffix:semicolon
op_star
(paren
r_char
op_star
)paren
(paren
id|page
op_plus
l_int|6
)paren
op_assign
l_int|0xe9
suffix:semicolon
multiline_comment|/* jmp rl32 */
op_star
(paren
r_int
op_star
)paren
(paren
id|page
op_plus
l_int|7
)paren
op_assign
id|rel32
suffix:semicolon
id|wrmsr
c_func
(paren
l_int|0x174
comma
id|__KERNEL_CS
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* SYSENTER_CS_MSR */
id|wrmsr
c_func
(paren
l_int|0x175
comma
id|page
op_plus
id|PAGE_SIZE
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* SYSENTER_ESP_MSR */
id|wrmsr
c_func
(paren
l_int|0x176
comma
id|page
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* SYSENTER_EIP_MSR */
id|printk
c_func
(paren
l_string|&quot;Enabling SEP on CPU %d&bslash;n&quot;
comma
id|cpu
)paren
suffix:semicolon
id|put_cpu
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|sysenter_setup
r_static
r_int
id|__init
id|sysenter_setup
c_func
(paren
r_void
)paren
(brace
r_static
r_const
r_char
id|int80
(braket
)braket
op_assign
(brace
l_int|0xcd
comma
l_int|0x80
comma
multiline_comment|/* int $0x80 */
l_int|0xc3
multiline_comment|/* ret */
)brace
suffix:semicolon
r_static
r_const
r_char
id|sysent
(braket
)braket
op_assign
(brace
l_int|0x55
comma
multiline_comment|/* push %ebp */
l_int|0x51
comma
multiline_comment|/* push %ecx */
l_int|0x52
comma
multiline_comment|/* push %edx */
l_int|0x89
comma
l_int|0xe5
comma
multiline_comment|/* movl %esp,%ebp */
l_int|0x0f
comma
l_int|0x34
comma
multiline_comment|/* sysenter */
l_int|0x5a
comma
multiline_comment|/* pop %edx */
l_int|0x59
comma
multiline_comment|/* pop %ecx */
l_int|0x5d
comma
multiline_comment|/* pop %ebp */
l_int|0xc3
multiline_comment|/* ret */
)brace
suffix:semicolon
r_int
r_int
id|page
op_assign
id|get_zeroed_page
c_func
(paren
id|GFP_ATOMIC
)paren
suffix:semicolon
id|__set_fixmap
c_func
(paren
id|FIX_VSYSCALL
comma
id|__pa
c_func
(paren
id|page
)paren
comma
id|PAGE_READONLY
)paren
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|page
comma
id|int80
comma
r_sizeof
(paren
id|int80
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|boot_cpu_has
c_func
(paren
id|X86_FEATURE_SEP
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
(paren
r_void
op_star
)paren
id|page
comma
id|sysent
comma
r_sizeof
(paren
id|sysent
)paren
)paren
suffix:semicolon
id|enable_sep_cpu
c_func
(paren
l_int|NULL
)paren
suffix:semicolon
id|smp_call_function
c_func
(paren
id|enable_sep_cpu
comma
l_int|NULL
comma
l_int|1
comma
l_int|1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|sysenter_setup
id|__initcall
c_func
(paren
id|sysenter_setup
)paren
suffix:semicolon
eof
