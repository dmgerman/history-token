multiline_comment|/*&n; * acpi-cpufreq.c - ACPI Processor P-States Driver ($Revision: 1.3 $)&n; *&n; *  Copyright (C) 2001, 2002 Andy Grover &lt;andrew.grover@intel.com&gt;&n; *  Copyright (C) 2001, 2002 Paul Diefenbaugh &lt;paul.s.diefenbaugh@intel.com&gt;&n; *  Copyright (C) 2002 - 2004 Dominik Brodowski &lt;linux@brodo.de&gt;&n; *&n; * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or (at&n; *  your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful, but&n; *  WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU&n; *  General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License along&n; *  with this program; if not, write to the Free Software Foundation, Inc.,&n; *  59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.&n; *&n; * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/cpufreq.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/delay.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/acpi.h&gt;
macro_line|#include &lt;acpi/processor.h&gt;
macro_line|#include &quot;speedstep-est-common.h&quot;
DECL|macro|dprintk
mdefine_line|#define dprintk(msg...) cpufreq_debug_printk(CPUFREQ_DEBUG_DRIVER, &quot;acpi-cpufreq&quot;, msg)
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Paul Diefenbaugh, Dominik Brodowski&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;ACPI Processor P-States Driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|struct|cpufreq_acpi_io
r_struct
id|cpufreq_acpi_io
(brace
DECL|member|acpi_data
r_struct
id|acpi_processor_performance
id|acpi_data
suffix:semicolon
DECL|member|freq_table
r_struct
id|cpufreq_frequency_table
op_star
id|freq_table
suffix:semicolon
DECL|member|resume
r_int
r_int
id|resume
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|acpi_io_data
r_static
r_struct
id|cpufreq_acpi_io
op_star
id|acpi_io_data
(braket
id|NR_CPUS
)braket
suffix:semicolon
DECL|variable|acpi_cpufreq_driver
r_static
r_struct
id|cpufreq_driver
id|acpi_cpufreq_driver
suffix:semicolon
r_static
r_int
DECL|function|acpi_processor_write_port
id|acpi_processor_write_port
c_func
(paren
id|u16
id|port
comma
id|u8
id|bit_width
comma
id|u32
id|value
)paren
(brace
r_if
c_cond
(paren
id|bit_width
op_le
l_int|8
)paren
(brace
id|outb
c_func
(paren
id|value
comma
id|port
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bit_width
op_le
l_int|16
)paren
(brace
id|outw
c_func
(paren
id|value
comma
id|port
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bit_width
op_le
l_int|32
)paren
(brace
id|outl
c_func
(paren
id|value
comma
id|port
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|acpi_processor_read_port
id|acpi_processor_read_port
c_func
(paren
id|u16
id|port
comma
id|u8
id|bit_width
comma
id|u32
op_star
id|ret
)paren
(brace
op_star
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|bit_width
op_le
l_int|8
)paren
(brace
op_star
id|ret
op_assign
id|inb
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bit_width
op_le
l_int|16
)paren
(brace
op_star
id|ret
op_assign
id|inw
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|bit_width
op_le
l_int|32
)paren
(brace
op_star
id|ret
op_assign
id|inl
c_func
(paren
id|port
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|acpi_processor_set_performance
id|acpi_processor_set_performance
(paren
r_struct
id|cpufreq_acpi_io
op_star
id|data
comma
r_int
r_int
id|cpu
comma
r_int
id|state
)paren
(brace
id|u16
id|port
op_assign
l_int|0
suffix:semicolon
id|u8
id|bit_width
op_assign
l_int|0
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
id|u32
id|value
op_assign
l_int|0
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
r_struct
id|cpufreq_freqs
id|cpufreq_freqs
suffix:semicolon
id|cpumask_t
id|saved_mask
suffix:semicolon
r_int
id|retval
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;acpi_processor_set_performance&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * TBD: Use something other than set_cpus_allowed.&n;&t; * As set_cpus_allowed is a bit racy, &n;&t; * with any other set_cpus_allowed for this process.&n;&t; */
id|saved_mask
op_assign
id|current-&gt;cpus_allowed
suffix:semicolon
id|set_cpus_allowed
c_func
(paren
id|current
comma
id|cpumask_of_cpu
c_func
(paren
id|cpu
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|smp_processor_id
c_func
(paren
)paren
op_ne
id|cpu
)paren
(brace
r_return
(paren
op_minus
id|EAGAIN
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|state
op_eq
id|data-&gt;acpi_data.state
)paren
(brace
r_if
c_cond
(paren
id|unlikely
c_func
(paren
id|data-&gt;resume
)paren
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;Called after resume, resetting to P%d&bslash;n&quot;
comma
id|state
)paren
suffix:semicolon
id|data-&gt;resume
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|dprintk
c_func
(paren
l_string|&quot;Already at target state (P%d)&bslash;n&quot;
comma
id|state
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
r_goto
id|migrate_end
suffix:semicolon
)brace
)brace
id|dprintk
c_func
(paren
l_string|&quot;Transitioning from P%d to P%d&bslash;n&quot;
comma
id|data-&gt;acpi_data.state
comma
id|state
)paren
suffix:semicolon
multiline_comment|/* cpufreq frequency struct */
id|cpufreq_freqs.cpu
op_assign
id|cpu
suffix:semicolon
id|cpufreq_freqs.old
op_assign
id|data-&gt;freq_table
(braket
id|data-&gt;acpi_data.state
)braket
dot
id|frequency
suffix:semicolon
id|cpufreq_freqs
dot
r_new
op_assign
id|data-&gt;freq_table
(braket
id|state
)braket
dot
id|frequency
suffix:semicolon
multiline_comment|/* notify cpufreq */
id|cpufreq_notify_transition
c_func
(paren
op_amp
id|cpufreq_freqs
comma
id|CPUFREQ_PRECHANGE
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * First we write the target state&squot;s &squot;control&squot; value to the&n;&t; * control_register.&n;&t; */
id|port
op_assign
id|data-&gt;acpi_data.control_register.address
suffix:semicolon
id|bit_width
op_assign
id|data-&gt;acpi_data.control_register.bit_width
suffix:semicolon
id|value
op_assign
(paren
id|u32
)paren
id|data-&gt;acpi_data.states
(braket
id|state
)braket
dot
id|control
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;Writing 0x%08x to port 0x%04x&bslash;n&quot;
comma
id|value
comma
id|port
)paren
suffix:semicolon
id|ret
op_assign
id|acpi_processor_write_port
c_func
(paren
id|port
comma
id|bit_width
comma
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;Invalid port width 0x%04x&bslash;n&quot;
comma
id|bit_width
)paren
suffix:semicolon
id|retval
op_assign
id|ret
suffix:semicolon
r_goto
id|migrate_end
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Then we read the &squot;status_register&squot; and compare the value with the&n;&t; * target state&squot;s &squot;status&squot; to make sure the transition was successful.&n;&t; * Note that we&squot;ll poll for up to 1ms (100 cycles of 10us) before&n;&t; * giving up.&n;&t; */
id|port
op_assign
id|data-&gt;acpi_data.status_register.address
suffix:semicolon
id|bit_width
op_assign
id|data-&gt;acpi_data.status_register.bit_width
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;Looking for 0x%08x from port 0x%04x&bslash;n&quot;
comma
(paren
id|u32
)paren
id|data-&gt;acpi_data.states
(braket
id|state
)braket
dot
id|status
comma
id|port
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|100
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ret
op_assign
id|acpi_processor_read_port
c_func
(paren
id|port
comma
id|bit_width
comma
op_amp
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;Invalid port width 0x%04x&bslash;n&quot;
comma
id|bit_width
)paren
suffix:semicolon
id|retval
op_assign
id|ret
suffix:semicolon
r_goto
id|migrate_end
suffix:semicolon
)brace
r_if
c_cond
(paren
id|value
op_eq
(paren
id|u32
)paren
id|data-&gt;acpi_data.states
(braket
id|state
)braket
dot
id|status
)paren
r_break
suffix:semicolon
id|udelay
c_func
(paren
l_int|10
)paren
suffix:semicolon
)brace
multiline_comment|/* notify cpufreq */
id|cpufreq_notify_transition
c_func
(paren
op_amp
id|cpufreq_freqs
comma
id|CPUFREQ_POSTCHANGE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|value
op_ne
(paren
id|u32
)paren
id|data-&gt;acpi_data.states
(braket
id|state
)braket
dot
id|status
)paren
(brace
r_int
r_int
id|tmp
op_assign
id|cpufreq_freqs
dot
r_new
suffix:semicolon
id|cpufreq_freqs
dot
r_new
op_assign
id|cpufreq_freqs.old
suffix:semicolon
id|cpufreq_freqs.old
op_assign
id|tmp
suffix:semicolon
id|cpufreq_notify_transition
c_func
(paren
op_amp
id|cpufreq_freqs
comma
id|CPUFREQ_PRECHANGE
)paren
suffix:semicolon
id|cpufreq_notify_transition
c_func
(paren
op_amp
id|cpufreq_freqs
comma
id|CPUFREQ_POSTCHANGE
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;acpi-cpufreq: Transition failed&bslash;n&quot;
)paren
suffix:semicolon
id|retval
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|migrate_end
suffix:semicolon
)brace
id|dprintk
c_func
(paren
l_string|&quot;Transition successful after %d microseconds&bslash;n&quot;
comma
id|i
op_star
l_int|10
)paren
suffix:semicolon
id|data-&gt;acpi_data.state
op_assign
id|state
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
id|migrate_end
suffix:colon
id|set_cpus_allowed
c_func
(paren
id|current
comma
id|saved_mask
)paren
suffix:semicolon
r_return
(paren
id|retval
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|acpi_cpufreq_target
id|acpi_cpufreq_target
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
comma
r_int
r_int
id|target_freq
comma
r_int
r_int
id|relation
)paren
(brace
r_struct
id|cpufreq_acpi_io
op_star
id|data
op_assign
id|acpi_io_data
(braket
id|policy-&gt;cpu
)braket
suffix:semicolon
r_int
r_int
id|next_state
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|result
op_assign
l_int|0
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;acpi_cpufreq_setpolicy&bslash;n&quot;
)paren
suffix:semicolon
id|result
op_assign
id|cpufreq_frequency_table_target
c_func
(paren
id|policy
comma
id|data-&gt;freq_table
comma
id|target_freq
comma
id|relation
comma
op_amp
id|next_state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
r_return
(paren
id|result
)paren
suffix:semicolon
id|result
op_assign
id|acpi_processor_set_performance
(paren
id|data
comma
id|policy-&gt;cpu
comma
id|next_state
)paren
suffix:semicolon
r_return
(paren
id|result
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|acpi_cpufreq_verify
id|acpi_cpufreq_verify
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
)paren
(brace
r_int
r_int
id|result
op_assign
l_int|0
suffix:semicolon
r_struct
id|cpufreq_acpi_io
op_star
id|data
op_assign
id|acpi_io_data
(braket
id|policy-&gt;cpu
)braket
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;acpi_cpufreq_verify&bslash;n&quot;
)paren
suffix:semicolon
id|result
op_assign
id|cpufreq_frequency_table_verify
c_func
(paren
id|policy
comma
id|data-&gt;freq_table
)paren
suffix:semicolon
r_return
(paren
id|result
)paren
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|acpi_cpufreq_guess_freq
id|acpi_cpufreq_guess_freq
(paren
r_struct
id|cpufreq_acpi_io
op_star
id|data
comma
r_int
r_int
id|cpu
)paren
(brace
r_if
c_cond
(paren
id|cpu_khz
)paren
(brace
multiline_comment|/* search the closest match to cpu_khz */
r_int
r_int
id|i
suffix:semicolon
r_int
r_int
id|freq
suffix:semicolon
r_int
r_int
id|freqn
op_assign
id|data-&gt;acpi_data.states
(braket
l_int|0
)braket
dot
id|core_frequency
op_star
l_int|1000
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|data-&gt;acpi_data.state_count
op_minus
l_int|1
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|freq
op_assign
id|freqn
suffix:semicolon
id|freqn
op_assign
id|data-&gt;acpi_data.states
(braket
id|i
op_plus
l_int|1
)braket
dot
id|core_frequency
op_star
l_int|1000
suffix:semicolon
r_if
c_cond
(paren
(paren
l_int|2
op_star
id|cpu_khz
)paren
OG
(paren
id|freqn
op_plus
id|freq
)paren
)paren
(brace
id|data-&gt;acpi_data.state
op_assign
id|i
suffix:semicolon
r_return
(paren
id|freq
)paren
suffix:semicolon
)brace
)brace
id|data-&gt;acpi_data.state
op_assign
id|data-&gt;acpi_data.state_count
op_minus
l_int|1
suffix:semicolon
r_return
(paren
id|freqn
)paren
suffix:semicolon
)brace
r_else
multiline_comment|/* assume CPU is at P0... */
id|data-&gt;acpi_data.state
op_assign
l_int|0
suffix:semicolon
r_return
id|data-&gt;acpi_data.states
(braket
l_int|0
)braket
dot
id|core_frequency
op_star
l_int|1000
suffix:semicolon
)brace
multiline_comment|/* &n; * acpi_processor_cpu_init_pdc_est - let BIOS know about the SMP capabilities&n; * of this driver&n; * @perf: processor-specific acpi_io_data struct&n; * @cpu: CPU being initialized&n; *&n; * To avoid issues with legacy OSes, some BIOSes require to be informed of&n; * the SMP capabilities of OS P-state driver. Here we set the bits in _PDC &n; * accordingly, for Enhanced Speedstep. Actual call to _PDC is done in&n; * driver/acpi/processor.c&n; */
r_static
r_void
DECL|function|acpi_processor_cpu_init_pdc_est
id|acpi_processor_cpu_init_pdc_est
c_func
(paren
r_struct
id|acpi_processor_performance
op_star
id|perf
comma
r_int
r_int
id|cpu
comma
r_struct
id|acpi_object_list
op_star
id|obj_list
)paren
(brace
r_union
id|acpi_object
op_star
id|obj
suffix:semicolon
id|u32
op_star
id|buf
suffix:semicolon
r_struct
id|cpuinfo_x86
op_star
id|c
op_assign
id|cpu_data
op_plus
id|cpu
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;acpi_processor_cpu_init_pdc_est&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cpu_has
c_func
(paren
id|c
comma
id|X86_FEATURE_EST
)paren
)paren
r_return
suffix:semicolon
multiline_comment|/* Initialize pdc. It will be used later. */
r_if
c_cond
(paren
op_logical_neg
id|obj_list
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|obj_list-&gt;count
op_logical_and
id|obj_list-&gt;pointer
)paren
)paren
r_return
suffix:semicolon
id|obj
op_assign
id|obj_list-&gt;pointer
suffix:semicolon
r_if
c_cond
(paren
(paren
id|obj-&gt;buffer.length
op_eq
l_int|12
)paren
op_logical_and
id|obj-&gt;buffer.pointer
)paren
(brace
id|buf
op_assign
(paren
id|u32
op_star
)paren
id|obj-&gt;buffer.pointer
suffix:semicolon
id|buf
(braket
l_int|0
)braket
op_assign
id|ACPI_PDC_REVISION_ID
suffix:semicolon
id|buf
(braket
l_int|1
)braket
op_assign
l_int|1
suffix:semicolon
id|buf
(braket
l_int|2
)braket
op_assign
id|ACPI_PDC_EST_CAPABILITY_SMP
suffix:semicolon
id|perf-&gt;pdc
op_assign
id|obj_list
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/* CPU specific PDC initialization */
r_static
r_void
DECL|function|acpi_processor_cpu_init_pdc
id|acpi_processor_cpu_init_pdc
c_func
(paren
r_struct
id|acpi_processor_performance
op_star
id|perf
comma
r_int
r_int
id|cpu
comma
r_struct
id|acpi_object_list
op_star
id|obj_list
)paren
(brace
r_struct
id|cpuinfo_x86
op_star
id|c
op_assign
id|cpu_data
op_plus
id|cpu
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;acpi_processor_cpu_init_pdc&bslash;n&quot;
)paren
suffix:semicolon
id|perf-&gt;pdc
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|cpu_has
c_func
(paren
id|c
comma
id|X86_FEATURE_EST
)paren
)paren
id|acpi_processor_cpu_init_pdc_est
c_func
(paren
id|perf
comma
id|cpu
comma
id|obj_list
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_int
DECL|function|acpi_cpufreq_cpu_init
id|acpi_cpufreq_cpu_init
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_int
r_int
id|cpu
op_assign
id|policy-&gt;cpu
suffix:semicolon
r_struct
id|cpufreq_acpi_io
op_star
id|data
suffix:semicolon
r_int
r_int
id|result
op_assign
l_int|0
suffix:semicolon
r_union
id|acpi_object
id|arg0
op_assign
(brace
id|ACPI_TYPE_BUFFER
)brace
suffix:semicolon
id|u32
id|arg0_buf
(braket
l_int|3
)braket
suffix:semicolon
r_struct
id|acpi_object_list
id|arg_list
op_assign
(brace
l_int|1
comma
op_amp
id|arg0
)brace
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;acpi_cpufreq_cpu_init&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* setup arg_list for _PDC settings */
id|arg0.buffer.length
op_assign
l_int|12
suffix:semicolon
id|arg0.buffer.pointer
op_assign
(paren
id|u8
op_star
)paren
id|arg0_buf
suffix:semicolon
id|data
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|cpufreq_acpi_io
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data
)paren
r_return
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
id|memset
c_func
(paren
id|data
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|cpufreq_acpi_io
)paren
)paren
suffix:semicolon
id|acpi_io_data
(braket
id|cpu
)braket
op_assign
id|data
suffix:semicolon
id|acpi_processor_cpu_init_pdc
c_func
(paren
op_amp
id|data-&gt;acpi_data
comma
id|cpu
comma
op_amp
id|arg_list
)paren
suffix:semicolon
id|result
op_assign
id|acpi_processor_register_performance
c_func
(paren
op_amp
id|data-&gt;acpi_data
comma
id|cpu
)paren
suffix:semicolon
id|data-&gt;acpi_data.pdc
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
r_goto
id|err_free
suffix:semicolon
r_if
c_cond
(paren
id|is_const_loops_cpu
c_func
(paren
id|cpu
)paren
)paren
(brace
id|acpi_cpufreq_driver.flags
op_or_assign
id|CPUFREQ_CONST_LOOPS
suffix:semicolon
)brace
multiline_comment|/* capability check */
r_if
c_cond
(paren
id|data-&gt;acpi_data.state_count
op_le
l_int|1
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;No P-States&bslash;n&quot;
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_unreg
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|data-&gt;acpi_data.control_register.space_id
op_ne
id|ACPI_ADR_SPACE_SYSTEM_IO
)paren
op_logical_or
(paren
id|data-&gt;acpi_data.status_register.space_id
op_ne
id|ACPI_ADR_SPACE_SYSTEM_IO
)paren
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;Unsupported address space [%d, %d]&bslash;n&quot;
comma
(paren
id|u32
)paren
(paren
id|data-&gt;acpi_data.control_register.space_id
)paren
comma
(paren
id|u32
)paren
(paren
id|data-&gt;acpi_data.status_register.space_id
)paren
)paren
suffix:semicolon
id|result
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|err_unreg
suffix:semicolon
)brace
multiline_comment|/* alloc freq_table */
id|data-&gt;freq_table
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|cpufreq_frequency_table
)paren
op_star
(paren
id|data-&gt;acpi_data.state_count
op_plus
l_int|1
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|data-&gt;freq_table
)paren
(brace
id|result
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|err_unreg
suffix:semicolon
)brace
multiline_comment|/* detect transition latency */
id|policy-&gt;cpuinfo.transition_latency
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|data-&gt;acpi_data.state_count
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
(paren
id|data-&gt;acpi_data.states
(braket
id|i
)braket
dot
id|transition_latency
op_star
l_int|1000
)paren
OG
id|policy-&gt;cpuinfo.transition_latency
)paren
id|policy-&gt;cpuinfo.transition_latency
op_assign
id|data-&gt;acpi_data.states
(braket
id|i
)braket
dot
id|transition_latency
op_star
l_int|1000
suffix:semicolon
)brace
id|policy-&gt;governor
op_assign
id|CPUFREQ_DEFAULT_GOVERNOR
suffix:semicolon
multiline_comment|/* The current speed is unknown and not detectable by ACPI...  */
id|policy-&gt;cur
op_assign
id|acpi_cpufreq_guess_freq
c_func
(paren
id|data
comma
id|policy-&gt;cpu
)paren
suffix:semicolon
multiline_comment|/* table init */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
op_le
id|data-&gt;acpi_data.state_count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|data-&gt;freq_table
(braket
id|i
)braket
dot
id|index
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|data-&gt;acpi_data.state_count
)paren
id|data-&gt;freq_table
(braket
id|i
)braket
dot
id|frequency
op_assign
id|data-&gt;acpi_data.states
(braket
id|i
)braket
dot
id|core_frequency
op_star
l_int|1000
suffix:semicolon
r_else
id|data-&gt;freq_table
(braket
id|i
)braket
dot
id|frequency
op_assign
id|CPUFREQ_TABLE_END
suffix:semicolon
)brace
id|result
op_assign
id|cpufreq_frequency_table_cpuinfo
c_func
(paren
id|policy
comma
id|data-&gt;freq_table
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
r_goto
id|err_freqfree
suffix:semicolon
)brace
multiline_comment|/* notify BIOS that we exist */
id|acpi_processor_notify_smm
c_func
(paren
id|THIS_MODULE
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;acpi-cpufreq: CPU%u - ACPI performance management activated.&bslash;n&quot;
comma
id|cpu
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|data-&gt;acpi_data.state_count
suffix:semicolon
id|i
op_increment
)paren
id|dprintk
c_func
(paren
l_string|&quot;     %cP%d: %d MHz, %d mW, %d uS&bslash;n&quot;
comma
(paren
id|i
op_eq
id|data-&gt;acpi_data.state
ques
c_cond
l_char|&squot;*&squot;
suffix:colon
l_char|&squot; &squot;
)paren
comma
id|i
comma
(paren
id|u32
)paren
id|data-&gt;acpi_data.states
(braket
id|i
)braket
dot
id|core_frequency
comma
(paren
id|u32
)paren
id|data-&gt;acpi_data.states
(braket
id|i
)braket
dot
id|power
comma
(paren
id|u32
)paren
id|data-&gt;acpi_data.states
(braket
id|i
)braket
dot
id|transition_latency
)paren
suffix:semicolon
id|cpufreq_frequency_table_get_attr
c_func
(paren
id|data-&gt;freq_table
comma
id|policy-&gt;cpu
)paren
suffix:semicolon
r_return
(paren
id|result
)paren
suffix:semicolon
id|err_freqfree
suffix:colon
id|kfree
c_func
(paren
id|data-&gt;freq_table
)paren
suffix:semicolon
id|err_unreg
suffix:colon
id|acpi_processor_unregister_performance
c_func
(paren
op_amp
id|data-&gt;acpi_data
comma
id|cpu
)paren
suffix:semicolon
id|err_free
suffix:colon
id|kfree
c_func
(paren
id|data
)paren
suffix:semicolon
id|acpi_io_data
(braket
id|cpu
)braket
op_assign
l_int|NULL
suffix:semicolon
r_return
(paren
id|result
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|acpi_cpufreq_cpu_exit
id|acpi_cpufreq_cpu_exit
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
)paren
(brace
r_struct
id|cpufreq_acpi_io
op_star
id|data
op_assign
id|acpi_io_data
(braket
id|policy-&gt;cpu
)braket
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;acpi_cpufreq_cpu_exit&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
)paren
(brace
id|cpufreq_frequency_table_put_attr
c_func
(paren
id|policy-&gt;cpu
)paren
suffix:semicolon
id|acpi_io_data
(braket
id|policy-&gt;cpu
)braket
op_assign
l_int|NULL
suffix:semicolon
id|acpi_processor_unregister_performance
c_func
(paren
op_amp
id|data-&gt;acpi_data
comma
id|policy-&gt;cpu
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|data
)paren
suffix:semicolon
)brace
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|acpi_cpufreq_resume
id|acpi_cpufreq_resume
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
)paren
(brace
r_struct
id|cpufreq_acpi_io
op_star
id|data
op_assign
id|acpi_io_data
(braket
id|policy-&gt;cpu
)braket
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;acpi_cpufreq_resume&bslash;n&quot;
)paren
suffix:semicolon
id|data-&gt;resume
op_assign
l_int|1
suffix:semicolon
r_return
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|variable|acpi_cpufreq_attr
r_static
r_struct
id|freq_attr
op_star
id|acpi_cpufreq_attr
(braket
)braket
op_assign
(brace
op_amp
id|cpufreq_freq_attr_scaling_available_freqs
comma
l_int|NULL
comma
)brace
suffix:semicolon
DECL|variable|acpi_cpufreq_driver
r_static
r_struct
id|cpufreq_driver
id|acpi_cpufreq_driver
op_assign
(brace
dot
id|verify
op_assign
id|acpi_cpufreq_verify
comma
dot
id|target
op_assign
id|acpi_cpufreq_target
comma
dot
id|init
op_assign
id|acpi_cpufreq_cpu_init
comma
dot
m_exit
op_assign
id|acpi_cpufreq_cpu_exit
comma
dot
id|resume
op_assign
id|acpi_cpufreq_resume
comma
dot
id|name
op_assign
l_string|&quot;acpi-cpufreq&quot;
comma
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|attr
op_assign
id|acpi_cpufreq_attr
comma
)brace
suffix:semicolon
r_static
r_int
id|__init
DECL|function|acpi_cpufreq_init
id|acpi_cpufreq_init
(paren
r_void
)paren
(brace
r_int
id|result
op_assign
l_int|0
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;acpi_cpufreq_init&bslash;n&quot;
)paren
suffix:semicolon
id|result
op_assign
id|cpufreq_register_driver
c_func
(paren
op_amp
id|acpi_cpufreq_driver
)paren
suffix:semicolon
r_return
(paren
id|result
)paren
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|acpi_cpufreq_exit
id|acpi_cpufreq_exit
(paren
r_void
)paren
(brace
id|dprintk
c_func
(paren
l_string|&quot;acpi_cpufreq_exit&bslash;n&quot;
)paren
suffix:semicolon
id|cpufreq_unregister_driver
c_func
(paren
op_amp
id|acpi_cpufreq_driver
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|variable|acpi_cpufreq_init
id|late_initcall
c_func
(paren
id|acpi_cpufreq_init
)paren
suffix:semicolon
DECL|variable|acpi_cpufreq_exit
id|module_exit
c_func
(paren
id|acpi_cpufreq_exit
)paren
suffix:semicolon
id|MODULE_ALIAS
c_func
(paren
l_string|&quot;acpi&quot;
)paren
suffix:semicolon
eof
