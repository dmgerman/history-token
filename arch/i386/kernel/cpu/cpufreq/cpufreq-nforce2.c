multiline_comment|/*&n; * (C) 2004  Sebastian Witt &lt;se.witt@gmx.net&gt;&n; *&n; *  Licensed under the terms of the GNU GPL License version 2.&n; *  Based upon reverse engineered information&n; *&n; *  BIG FAT DISCLAIMER: Work in progress code. Possibly *dangerous*&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/cpufreq.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
DECL|macro|NFORCE2_XTAL
mdefine_line|#define NFORCE2_XTAL 25
DECL|macro|NFORCE2_BOOTFSB
mdefine_line|#define NFORCE2_BOOTFSB 0x48
DECL|macro|NFORCE2_PLLENABLE
mdefine_line|#define NFORCE2_PLLENABLE 0xa8
DECL|macro|NFORCE2_PLLREG
mdefine_line|#define NFORCE2_PLLREG 0xa4
DECL|macro|NFORCE2_PLLADR
mdefine_line|#define NFORCE2_PLLADR 0xa0
DECL|macro|NFORCE2_PLL
mdefine_line|#define NFORCE2_PLL(mul, div) (0x100000 | (mul &lt;&lt; 8) | div)
DECL|macro|NFORCE2_MIN_FSB
mdefine_line|#define NFORCE2_MIN_FSB 50
DECL|macro|NFORCE2_SAFE_DISTANCE
mdefine_line|#define NFORCE2_SAFE_DISTANCE 50
multiline_comment|/* Delay in ms between FSB changes */
singleline_comment|//#define NFORCE2_DELAY 10
multiline_comment|/* nforce2_chipset:&n; * FSB is changed using the chipset&n; */
DECL|variable|nforce2_chipset_dev
r_static
r_struct
id|pci_dev
op_star
id|nforce2_chipset_dev
suffix:semicolon
multiline_comment|/* fid:&n; * multiplier * 10&n; */
DECL|variable|fid
r_static
r_int
id|fid
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* min_fsb, max_fsb:&n; * minimum and maximum FSB (= FSB at boot time) &n; */
DECL|variable|min_fsb
r_static
r_int
id|min_fsb
op_assign
l_int|0
suffix:semicolon
DECL|variable|max_fsb
r_static
r_int
id|max_fsb
op_assign
l_int|0
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Sebastian Witt &lt;se.witt@gmx.net&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;nForce2 FSB changing cpufreq driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|fid
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|min_fsb
comma
r_int
comma
l_int|0444
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|fid
comma
l_string|&quot;CPU multiplier to use (11.5 = 115)&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|min_fsb
comma
l_string|&quot;Minimum FSB to use, if not defined: current FSB - 50&quot;
)paren
suffix:semicolon
DECL|macro|dprintk
mdefine_line|#define dprintk(msg...) cpufreq_debug_printk(CPUFREQ_DEBUG_DRIVER, &quot;cpufreq-nforce2&quot;, msg)
multiline_comment|/*&n; * nforce2_calc_fsb - calculate FSB&n; * @pll: PLL value&n; * &n; *   Calculates FSB from PLL value&n; */
DECL|function|nforce2_calc_fsb
r_static
r_int
id|nforce2_calc_fsb
c_func
(paren
r_int
id|pll
)paren
(brace
r_int
r_char
id|mul
comma
id|div
suffix:semicolon
id|mul
op_assign
(paren
id|pll
op_rshift
l_int|8
)paren
op_amp
l_int|0xff
suffix:semicolon
id|div
op_assign
id|pll
op_amp
l_int|0xff
suffix:semicolon
r_if
c_cond
(paren
id|div
OG
l_int|0
)paren
r_return
id|NFORCE2_XTAL
op_star
id|mul
op_div
id|div
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * nforce2_calc_pll - calculate PLL value&n; * @fsb: FSB&n; * &n; *   Calculate PLL value for given FSB&n; */
DECL|function|nforce2_calc_pll
r_static
r_int
id|nforce2_calc_pll
c_func
(paren
r_int
r_int
id|fsb
)paren
(brace
r_int
r_char
id|xmul
comma
id|xdiv
suffix:semicolon
r_int
r_char
id|mul
op_assign
l_int|0
comma
id|div
op_assign
l_int|0
suffix:semicolon
r_int
id|tried
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Try to calculate multiplier and divider up to 4 times */
r_while
c_loop
(paren
(paren
(paren
id|mul
op_eq
l_int|0
)paren
op_logical_or
(paren
id|div
op_eq
l_int|0
)paren
)paren
op_logical_and
(paren
id|tried
op_le
l_int|3
)paren
)paren
(brace
r_for
c_loop
(paren
id|xdiv
op_assign
l_int|1
suffix:semicolon
id|xdiv
op_le
l_int|0x80
suffix:semicolon
id|xdiv
op_increment
)paren
r_for
c_loop
(paren
id|xmul
op_assign
l_int|1
suffix:semicolon
id|xmul
op_le
l_int|0xfe
suffix:semicolon
id|xmul
op_increment
)paren
r_if
c_cond
(paren
id|nforce2_calc_fsb
c_func
(paren
id|NFORCE2_PLL
c_func
(paren
id|xmul
comma
id|xdiv
)paren
)paren
op_eq
id|fsb
op_plus
id|tried
)paren
(brace
id|mul
op_assign
id|xmul
suffix:semicolon
id|div
op_assign
id|xdiv
suffix:semicolon
)brace
id|tried
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|mul
op_eq
l_int|0
)paren
op_logical_or
(paren
id|div
op_eq
l_int|0
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_return
id|NFORCE2_PLL
c_func
(paren
id|mul
comma
id|div
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * nforce2_write_pll - write PLL value to chipset&n; * @pll: PLL value&n; * &n; *   Writes new FSB PLL value to chipset&n; */
DECL|function|nforce2_write_pll
r_static
r_void
id|nforce2_write_pll
c_func
(paren
r_int
id|pll
)paren
(brace
r_int
id|temp
suffix:semicolon
multiline_comment|/* Set the pll addr. to 0x00 */
id|temp
op_assign
l_int|0x00
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|nforce2_chipset_dev
comma
id|NFORCE2_PLLADR
comma
id|temp
)paren
suffix:semicolon
multiline_comment|/* Now write the value in all 64 registers */
r_for
c_loop
(paren
id|temp
op_assign
l_int|0
suffix:semicolon
id|temp
op_le
l_int|0x3f
suffix:semicolon
id|temp
op_increment
)paren
(brace
id|pci_write_config_dword
c_func
(paren
id|nforce2_chipset_dev
comma
id|NFORCE2_PLLREG
comma
id|pll
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/*&n; * nforce2_fsb_read - Read FSB&n; *&n; *   Read FSB from chipset&n; *   If bootfsb != 0, return FSB at boot-time&n; */
DECL|function|nforce2_fsb_read
r_static
r_int
r_int
id|nforce2_fsb_read
c_func
(paren
r_int
id|bootfsb
)paren
(brace
r_struct
id|pci_dev
op_star
id|nforce2_sub5
suffix:semicolon
id|u32
id|fsb
comma
id|temp
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Get chipset boot FSB from subdevice 5 (FSB at boot-time) */
id|nforce2_sub5
op_assign
id|pci_get_subsys
c_func
(paren
id|PCI_VENDOR_ID_NVIDIA
comma
l_int|0x01EF
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nforce2_sub5
)paren
r_return
l_int|0
suffix:semicolon
id|pci_read_config_dword
c_func
(paren
id|nforce2_sub5
comma
id|NFORCE2_BOOTFSB
comma
op_amp
id|fsb
)paren
suffix:semicolon
id|fsb
op_div_assign
l_int|1000000
suffix:semicolon
multiline_comment|/* Check if PLL register is already set */
id|pci_read_config_byte
c_func
(paren
id|nforce2_chipset_dev
comma
id|NFORCE2_PLLENABLE
comma
(paren
id|u8
op_star
)paren
op_amp
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bootfsb
op_logical_or
op_logical_neg
id|temp
)paren
(brace
r_return
id|fsb
suffix:semicolon
)brace
multiline_comment|/* Use PLL register FSB value */
id|pci_read_config_dword
c_func
(paren
id|nforce2_chipset_dev
comma
id|NFORCE2_PLLREG
comma
op_amp
id|temp
)paren
suffix:semicolon
id|fsb
op_assign
id|nforce2_calc_fsb
c_func
(paren
id|temp
)paren
suffix:semicolon
r_return
id|fsb
suffix:semicolon
)brace
multiline_comment|/*&n; * nforce2_set_fsb - set new FSB&n; * @fsb: New FSB&n; * &n; *   Sets new FSB&n; */
DECL|function|nforce2_set_fsb
r_static
r_int
id|nforce2_set_fsb
c_func
(paren
r_int
r_int
id|fsb
)paren
(brace
id|u32
id|pll
comma
id|temp
op_assign
l_int|0
suffix:semicolon
r_int
r_int
id|tfsb
suffix:semicolon
r_int
id|diff
suffix:semicolon
r_if
c_cond
(paren
(paren
id|fsb
OG
id|max_fsb
)paren
op_logical_or
(paren
id|fsb
OL
id|NFORCE2_MIN_FSB
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cpufreq: FSB %d is out of range!&bslash;n&quot;
comma
id|fsb
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|tfsb
op_assign
id|nforce2_fsb_read
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tfsb
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cpufreq: Error while reading the FSB&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* First write? Then set actual value */
id|pci_read_config_byte
c_func
(paren
id|nforce2_chipset_dev
comma
id|NFORCE2_PLLENABLE
comma
(paren
id|u8
op_star
)paren
op_amp
id|temp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|temp
)paren
(brace
id|pll
op_assign
id|nforce2_calc_pll
c_func
(paren
id|tfsb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pll
OL
l_int|0
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|nforce2_write_pll
c_func
(paren
id|pll
)paren
suffix:semicolon
)brace
multiline_comment|/* Enable write access */
id|temp
op_assign
l_int|0x01
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|nforce2_chipset_dev
comma
id|NFORCE2_PLLENABLE
comma
(paren
id|u8
)paren
id|temp
)paren
suffix:semicolon
id|diff
op_assign
id|tfsb
op_minus
id|fsb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|diff
)paren
r_return
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|tfsb
op_ne
id|fsb
)paren
op_logical_and
(paren
id|tfsb
op_le
id|max_fsb
)paren
op_logical_and
(paren
id|tfsb
op_ge
id|min_fsb
)paren
)paren
(brace
r_if
c_cond
(paren
id|diff
OL
l_int|0
)paren
id|tfsb
op_increment
suffix:semicolon
r_else
id|tfsb
op_decrement
suffix:semicolon
multiline_comment|/* Calculate the PLL reg. value */
r_if
c_cond
(paren
(paren
id|pll
op_assign
id|nforce2_calc_pll
c_func
(paren
id|tfsb
)paren
)paren
op_eq
op_minus
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|nforce2_write_pll
c_func
(paren
id|pll
)paren
suffix:semicolon
macro_line|#ifdef NFORCE2_DELAY
id|mdelay
c_func
(paren
id|NFORCE2_DELAY
)paren
suffix:semicolon
macro_line|#endif
)brace
id|temp
op_assign
l_int|0x40
suffix:semicolon
id|pci_write_config_byte
c_func
(paren
id|nforce2_chipset_dev
comma
id|NFORCE2_PLLADR
comma
(paren
id|u8
)paren
id|temp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * nforce2_get - get the CPU frequency&n; * @cpu: CPU number&n; * &n; * Returns the CPU frequency&n; */
DECL|function|nforce2_get
r_static
r_int
r_int
id|nforce2_get
c_func
(paren
r_int
r_int
id|cpu
)paren
(brace
r_if
c_cond
(paren
id|cpu
)paren
r_return
l_int|0
suffix:semicolon
r_return
id|nforce2_fsb_read
c_func
(paren
l_int|0
)paren
op_star
id|fid
op_star
l_int|100
suffix:semicolon
)brace
multiline_comment|/**&n; * nforce2_target - set a new CPUFreq policy&n; * @policy: new policy&n; * @target_freq: the target frequency&n; * @relation: how that frequency relates to achieved frequency (CPUFREQ_RELATION_L or CPUFREQ_RELATION_H)&n; *&n; * Sets a new CPUFreq policy.&n; */
DECL|function|nforce2_target
r_static
r_int
id|nforce2_target
c_func
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
comma
r_int
r_int
id|target_freq
comma
r_int
r_int
id|relation
)paren
(brace
singleline_comment|//        unsigned long         flags;
r_struct
id|cpufreq_freqs
id|freqs
suffix:semicolon
r_int
r_int
id|target_fsb
suffix:semicolon
r_if
c_cond
(paren
(paren
id|target_freq
OG
id|policy-&gt;max
)paren
op_logical_or
(paren
id|target_freq
OL
id|policy-&gt;min
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|target_fsb
op_assign
id|target_freq
op_div
(paren
id|fid
op_star
l_int|100
)paren
suffix:semicolon
id|freqs.old
op_assign
id|nforce2_get
c_func
(paren
id|policy-&gt;cpu
)paren
suffix:semicolon
id|freqs
dot
r_new
op_assign
id|target_fsb
op_star
id|fid
op_star
l_int|100
suffix:semicolon
id|freqs.cpu
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Only one CPU on nForce2 plattforms */
r_if
c_cond
(paren
id|freqs.old
op_eq
id|freqs
dot
r_new
)paren
r_return
l_int|0
suffix:semicolon
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;cpufreq: Old CPU frequency %d kHz, new %d kHz&bslash;n&quot;
comma
id|freqs.old
comma
id|freqs
dot
r_new
)paren
suffix:semicolon
id|cpufreq_notify_transition
c_func
(paren
op_amp
id|freqs
comma
id|CPUFREQ_PRECHANGE
)paren
suffix:semicolon
multiline_comment|/* Disable IRQs */
singleline_comment|//local_irq_save(flags);
r_if
c_cond
(paren
id|nforce2_set_fsb
c_func
(paren
id|target_fsb
)paren
OL
l_int|0
)paren
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cpufreq: Changing FSB to %d failed&bslash;n&quot;
comma
id|target_fsb
)paren
suffix:semicolon
r_else
id|dprintk
c_func
(paren
id|KERN_INFO
l_string|&quot;cpufreq: Changed FSB successfully to %d&bslash;n&quot;
comma
id|target_fsb
)paren
suffix:semicolon
multiline_comment|/* Enable IRQs */
singleline_comment|//local_irq_restore(flags);
id|cpufreq_notify_transition
c_func
(paren
op_amp
id|freqs
comma
id|CPUFREQ_POSTCHANGE
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * nforce2_verify - verifies a new CPUFreq policy&n; * @policy: new policy&n; */
DECL|function|nforce2_verify
r_static
r_int
id|nforce2_verify
c_func
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
)paren
(brace
r_int
r_int
id|fsb_pol_max
suffix:semicolon
id|fsb_pol_max
op_assign
id|policy-&gt;max
op_div
(paren
id|fid
op_star
l_int|100
)paren
suffix:semicolon
r_if
c_cond
(paren
id|policy-&gt;min
OL
(paren
id|fsb_pol_max
op_star
id|fid
op_star
l_int|100
)paren
)paren
id|policy-&gt;max
op_assign
(paren
id|fsb_pol_max
op_plus
l_int|1
)paren
op_star
id|fid
op_star
l_int|100
suffix:semicolon
id|cpufreq_verify_within_limits
c_func
(paren
id|policy
comma
id|policy-&gt;cpuinfo.min_freq
comma
id|policy-&gt;cpuinfo.max_freq
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|nforce2_cpu_init
r_static
r_int
id|nforce2_cpu_init
c_func
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
)paren
(brace
r_int
r_int
id|fsb
suffix:semicolon
r_int
r_int
id|rfid
suffix:semicolon
multiline_comment|/* capability check */
r_if
c_cond
(paren
id|policy-&gt;cpu
op_ne
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/* Get current FSB */
id|fsb
op_assign
id|nforce2_fsb_read
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fsb
)paren
r_return
op_minus
id|EIO
suffix:semicolon
multiline_comment|/* FIX: Get FID from CPU */
r_if
c_cond
(paren
op_logical_neg
id|fid
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|cpu_khz
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;cpufreq: cpu_khz not set, can&squot;t calculate multiplier!&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|fid
op_assign
id|cpu_khz
op_div
(paren
id|fsb
op_star
l_int|100
)paren
suffix:semicolon
id|rfid
op_assign
id|fid
op_mod
l_int|5
suffix:semicolon
r_if
c_cond
(paren
id|rfid
)paren
(brace
r_if
c_cond
(paren
id|rfid
OG
l_int|2
)paren
id|fid
op_add_assign
l_int|5
op_minus
id|rfid
suffix:semicolon
r_else
id|fid
op_sub_assign
id|rfid
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;cpufreq: FSB currently at %i MHz, FID %d.%d&bslash;n&quot;
comma
id|fsb
comma
id|fid
op_div
l_int|10
comma
id|fid
op_mod
l_int|10
)paren
suffix:semicolon
multiline_comment|/* Set maximum FSB to FSB at boot time */
id|max_fsb
op_assign
id|nforce2_fsb_read
c_func
(paren
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|max_fsb
)paren
(brace
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|min_fsb
)paren
id|min_fsb
op_assign
id|max_fsb
op_minus
id|NFORCE2_SAFE_DISTANCE
suffix:semicolon
r_if
c_cond
(paren
id|min_fsb
OL
id|NFORCE2_MIN_FSB
)paren
id|min_fsb
op_assign
id|NFORCE2_MIN_FSB
suffix:semicolon
multiline_comment|/* cpuinfo and default policy values */
id|policy-&gt;cpuinfo.min_freq
op_assign
id|min_fsb
op_star
id|fid
op_star
l_int|100
suffix:semicolon
id|policy-&gt;cpuinfo.max_freq
op_assign
id|max_fsb
op_star
id|fid
op_star
l_int|100
suffix:semicolon
id|policy-&gt;cpuinfo.transition_latency
op_assign
id|CPUFREQ_ETERNAL
suffix:semicolon
id|policy-&gt;cur
op_assign
id|nforce2_get
c_func
(paren
id|policy-&gt;cpu
)paren
suffix:semicolon
id|policy-&gt;min
op_assign
id|policy-&gt;cpuinfo.min_freq
suffix:semicolon
id|policy-&gt;max
op_assign
id|policy-&gt;cpuinfo.max_freq
suffix:semicolon
id|policy-&gt;governor
op_assign
id|CPUFREQ_DEFAULT_GOVERNOR
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|nforce2_cpu_exit
r_static
r_int
id|nforce2_cpu_exit
c_func
(paren
r_struct
id|cpufreq_policy
op_star
id|policy
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|nforce2_driver
r_static
r_struct
id|cpufreq_driver
id|nforce2_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;nforce2&quot;
comma
dot
id|verify
op_assign
id|nforce2_verify
comma
dot
id|target
op_assign
id|nforce2_target
comma
dot
id|get
op_assign
id|nforce2_get
comma
dot
id|init
op_assign
id|nforce2_cpu_init
comma
dot
m_exit
op_assign
id|nforce2_cpu_exit
comma
dot
id|owner
op_assign
id|THIS_MODULE
comma
)brace
suffix:semicolon
multiline_comment|/**&n; * nforce2_detect_chipset - detect the Southbridge which contains FSB PLL logic&n; *&n; * Detects nForce2 A2 and C1 stepping&n; * &n; */
DECL|function|nforce2_detect_chipset
r_static
r_int
r_int
id|nforce2_detect_chipset
c_func
(paren
r_void
)paren
(brace
id|u8
id|revision
suffix:semicolon
id|nforce2_chipset_dev
op_assign
id|pci_get_subsys
c_func
(paren
id|PCI_VENDOR_ID_NVIDIA
comma
id|PCI_DEVICE_ID_NVIDIA_NFORCE2
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nforce2_chipset_dev
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|nforce2_chipset_dev
comma
id|PCI_REVISION_ID
comma
op_amp
id|revision
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;cpufreq: Detected nForce2 chipset revision %X&bslash;n&quot;
comma
id|revision
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;cpufreq: FSB changing is maybe unstable and can lead to crashes and data loss.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * nforce2_init - initializes the nForce2 CPUFreq driver&n; *&n; * Initializes the nForce2 FSB support. Returns -ENODEV on unsupported&n; * devices, -EINVAL on problems during initiatization, and zero on&n; * success.&n; */
DECL|function|nforce2_init
r_static
r_int
id|__init
id|nforce2_init
c_func
(paren
r_void
)paren
(brace
multiline_comment|/* TODO: do we need to detect the processor? */
multiline_comment|/* detect chipset */
r_if
c_cond
(paren
id|nforce2_detect_chipset
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;cpufreq: No nForce2 chipset.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_return
id|cpufreq_register_driver
c_func
(paren
op_amp
id|nforce2_driver
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * nforce2_exit - unregisters cpufreq module&n; *&n; *   Unregisters nForce2 FSB change support.&n; */
DECL|function|nforce2_exit
r_static
r_void
id|__exit
id|nforce2_exit
c_func
(paren
r_void
)paren
(brace
id|cpufreq_unregister_driver
c_func
(paren
op_amp
id|nforce2_driver
)paren
suffix:semicolon
)brace
DECL|variable|nforce2_init
id|module_init
c_func
(paren
id|nforce2_init
)paren
suffix:semicolon
DECL|variable|nforce2_exit
id|module_exit
c_func
(paren
id|nforce2_exit
)paren
suffix:semicolon
eof
