multiline_comment|/*&n; *  acpitable.c - IA32-specific ACPI boot-time initialization (Revision: 1)&n; *&n; *  Copyright (C) 1999 Andrew Henroid&n; *  Copyright (C) 2001 Richard Schaal&n; *  Copyright (C) 2001 Paul Diefenbaugh &lt;paul.s.diefenbaugh@intel.com&gt;&n; *  Copyright (C) 2001 Jun Nakajima &lt;jun.nakajima@intel.com&gt;&n; *  Copyright (C) 2001 Arjan van de Ven &lt;arjanv@redhat.com&gt;&n; *&n; * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or&n; *  (at your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; *&n; * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&n; *&n; * $Id: acpitable.c,v 1.7 2001/11/04 12:21:18 fenrus Exp $&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/stddef.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;asm/mpspec.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/apic.h&gt;
macro_line|#include &lt;asm/apicdef.h&gt;
macro_line|#include &lt;asm/page.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &quot;acpitable.h&quot;
DECL|variable|acpi_boot_ops
r_static
id|acpi_table_handler
id|acpi_boot_ops
(braket
id|ACPI_TABLE_COUNT
)braket
suffix:semicolon
r_static
r_int
r_char
id|__init
DECL|function|acpi_checksum
id|acpi_checksum
c_func
(paren
r_void
op_star
id|buffer
comma
r_int
id|length
)paren
(brace
r_int
id|i
suffix:semicolon
r_int
r_char
op_star
id|bytebuffer
suffix:semicolon
r_int
r_char
id|sum
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
op_logical_or
id|length
op_le
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|bytebuffer
op_assign
(paren
r_int
r_char
op_star
)paren
id|buffer
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|length
suffix:semicolon
id|i
op_increment
)paren
id|sum
op_add_assign
op_star
(paren
id|bytebuffer
op_increment
)paren
suffix:semicolon
r_return
id|sum
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|acpi_print_table_header
id|acpi_print_table_header
c_func
(paren
id|acpi_table_header
op_star
id|header
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|header
)paren
r_return
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ACPI table found: %.4s v%d [%.6s %.8s %d.%d]&bslash;n&quot;
comma
id|header-&gt;signature
comma
id|header-&gt;revision
comma
id|header-&gt;oem_id
comma
id|header-&gt;oem_table_id
comma
id|header-&gt;oem_revision
op_rshift
l_int|16
comma
id|header-&gt;oem_revision
op_amp
l_int|0xffff
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_tb_scan_memory_for_rsdp&n; *&n; * PARAMETERS:  address       - Starting pointer for search&n; *              length        - Maximum length to search&n; *&n; * RETURN:      Pointer to the RSDP if found and valid, otherwise NULL.&n; *&n; * DESCRIPTION: Search a block of memory for the RSDP signature&n; *&n; ******************************************************************************/
r_static
r_void
op_star
id|__init
DECL|function|acpi_tb_scan_memory_for_rsdp
id|acpi_tb_scan_memory_for_rsdp
c_func
(paren
r_void
op_star
id|address
comma
r_int
id|length
)paren
(brace
id|u32
id|offset
suffix:semicolon
r_if
c_cond
(paren
id|length
op_le
l_int|0
)paren
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* Search from given start addr for the requested length  */
id|offset
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|offset
OL
id|length
)paren
(brace
multiline_comment|/* The signature must match and the checksum must be correct */
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|address
comma
id|RSDP_SIG
comma
r_sizeof
(paren
id|RSDP_SIG
)paren
op_minus
l_int|1
)paren
op_eq
l_int|0
op_logical_and
id|acpi_checksum
c_func
(paren
id|address
comma
id|RSDP_CHECKSUM_LENGTH
)paren
op_eq
l_int|0
)paren
(brace
multiline_comment|/* If so, we have found the RSDP */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ACPI: RSDP located at physical address %p&bslash;n&quot;
comma
id|address
)paren
suffix:semicolon
r_return
id|address
suffix:semicolon
)brace
id|offset
op_add_assign
id|RSDP_SCAN_STEP
suffix:semicolon
id|address
op_add_assign
id|RSDP_SCAN_STEP
suffix:semicolon
)brace
multiline_comment|/* Searched entire block, no RSDP was found */
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;ACPI: Searched entire block, no RSDP was found.&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_find_root_pointer&n; *&n; * PARAMETERS:  none&n; *&n; * RETURN:      physical address of the RSDP &n; *&n; * DESCRIPTION: Search lower 1_mbyte of memory for the root system descriptor&n; *              pointer structure.  If it is found, set *RSDP to point to it.&n; *&n; *              NOTE: The RSDP must be either in the first 1_k of the Extended&n; *              BIOS Data Area or between E0000 and FFFFF (ACPI 1.0 section&n; *              5.2.2; assertion #421).&n; *&n; ******************************************************************************/
r_static
r_struct
id|acpi_table_rsdp
op_star
id|__init
DECL|function|acpi_find_root_pointer
id|acpi_find_root_pointer
c_func
(paren
r_void
)paren
(brace
r_struct
id|acpi_table_rsdp
op_star
id|rsdp
suffix:semicolon
multiline_comment|/*&n;&t; * Physical address is given&n;&t; */
multiline_comment|/*&n;&t; * Region 1) Search EBDA (low memory) paragraphs&n;&t; */
id|rsdp
op_assign
id|acpi_tb_scan_memory_for_rsdp
c_func
(paren
id|__va
c_func
(paren
id|LO_RSDP_WINDOW_BASE
)paren
comma
id|LO_RSDP_WINDOW_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rsdp
)paren
r_return
id|rsdp
suffix:semicolon
multiline_comment|/*&n;&t; * Region 2) Search upper memory: 16-byte boundaries in E0000h-F0000h&n;&t; */
id|rsdp
op_assign
id|acpi_tb_scan_memory_for_rsdp
c_func
(paren
id|__va
c_func
(paren
id|HI_RSDP_WINDOW_BASE
)paren
comma
id|HI_RSDP_WINDOW_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rsdp
)paren
r_return
id|rsdp
suffix:semicolon
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;ACPI: System description tables not found&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/*&n; * Temporarily use the virtual area starting from FIX_IO_APIC_BASE_0,&n; * to map the target physical address. The problem is that set_fixmap()&n; * provides a single page, and it is possible that the page is not&n; * sufficient.&n; * By using this area, we can map up to MAX_IO_APICS pages temporarily,&n; * i.e. until the next __va_range() call.&n; */
r_static
id|__inline__
r_char
op_star
DECL|function|__va_range
id|__va_range
c_func
(paren
r_int
r_int
id|phys
comma
r_int
r_int
id|size
)paren
(brace
r_int
r_int
id|base
comma
id|offset
comma
id|mapped_size
comma
id|mapped_phys
op_assign
id|phys
suffix:semicolon
r_int
id|idx
op_assign
id|FIX_IO_APIC_BASE_0
suffix:semicolon
id|offset
op_assign
id|phys
op_amp
(paren
id|PAGE_SIZE
op_minus
l_int|1
)paren
suffix:semicolon
id|mapped_size
op_assign
id|PAGE_SIZE
op_minus
id|offset
suffix:semicolon
id|set_fixmap
c_func
(paren
id|idx
comma
id|mapped_phys
)paren
suffix:semicolon
id|base
op_assign
id|fix_to_virt
c_func
(paren
id|FIX_IO_APIC_BASE_0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Most cases can be covered by the below.&n;&t; */
r_if
c_cond
(paren
id|mapped_size
op_ge
id|size
)paren
r_return
(paren
(paren
r_int
r_char
op_star
)paren
id|base
op_plus
id|offset
)paren
suffix:semicolon
id|dprintk
c_func
(paren
l_string|&quot;__va_range: mapping more than a single page, size = 0x%lx&bslash;n&quot;
comma
id|size
)paren
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
id|idx
op_increment
op_eq
id|FIX_IO_APIC_BASE_END
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* cannot handle this */
id|mapped_phys
op_assign
id|mapped_phys
op_plus
id|PAGE_SIZE
suffix:semicolon
id|set_fixmap
c_func
(paren
id|idx
comma
id|mapped_phys
)paren
suffix:semicolon
id|mapped_size
op_assign
id|mapped_size
op_plus
id|PAGE_SIZE
suffix:semicolon
)brace
r_while
c_loop
(paren
id|mapped_size
OL
id|size
)paren
suffix:semicolon
r_return
(paren
(paren
r_int
r_char
op_star
)paren
id|base
op_plus
id|offset
)paren
suffix:semicolon
)brace
DECL|function|acpi_tables_init
r_static
r_int
id|__init
id|acpi_tables_init
c_func
(paren
r_void
)paren
(brace
r_int
id|result
op_assign
op_minus
id|ENODEV
suffix:semicolon
id|acpi_table_header
op_star
id|header
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|acpi_table_rsdp
op_star
id|rsdp
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|acpi_table_rsdt
op_star
id|rsdt
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|acpi_table_rsdt
id|saved_rsdt
suffix:semicolon
r_int
id|tables
op_assign
l_int|0
suffix:semicolon
r_int
id|type
op_assign
l_int|0
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|rsdp
op_assign
(paren
r_struct
id|acpi_table_rsdp
op_star
)paren
id|acpi_find_root_pointer
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rsdp
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%.8s v%d [%.6s]&bslash;n&quot;
comma
id|rsdp-&gt;signature
comma
id|rsdp-&gt;revision
comma
id|rsdp-&gt;oem_id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|rsdp-&gt;signature
comma
id|RSDP_SIG
comma
id|strlen
c_func
(paren
id|RSDP_SIG
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;RSDP table signature incorrect&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|rsdt
op_assign
(paren
r_struct
id|acpi_table_rsdt
op_star
)paren
id|__va_range
c_func
(paren
id|rsdp-&gt;rsdt_address
comma
r_sizeof
(paren
r_struct
id|acpi_table_rsdt
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rsdt
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ACPI: Invalid root system description tables (RSDT)&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|header
op_assign
op_amp
id|rsdt-&gt;header
suffix:semicolon
id|acpi_print_table_header
c_func
(paren
id|header
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|header-&gt;signature
comma
id|RSDT_SIG
comma
id|strlen
c_func
(paren
id|RSDT_SIG
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ACPI: RSDT signature incorrect&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* &n;&t; * The number of tables is computed by taking the &n;&t; * size of all entries (header size minus total &n;&t; * size of RSDT) divided by the size of each entry&n;&t; * (4-byte table pointers).&n;&t; */
id|tables
op_assign
(paren
id|header-&gt;length
op_minus
r_sizeof
(paren
id|acpi_table_header
)paren
)paren
op_div
l_int|4
suffix:semicolon
id|memcpy
c_func
(paren
op_amp
id|saved_rsdt
comma
id|rsdt
comma
r_sizeof
(paren
id|saved_rsdt
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|saved_rsdt.header.length
OG
r_sizeof
(paren
id|saved_rsdt
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ACPI: Too big length in RSDT: %d&bslash;n&quot;
comma
id|saved_rsdt.header.length
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|tables
suffix:semicolon
id|i
op_increment
)paren
(brace
id|header
op_assign
(paren
id|acpi_table_header
op_star
)paren
id|__va_range
c_func
(paren
id|saved_rsdt.entry
(braket
id|i
)braket
comma
r_sizeof
(paren
id|acpi_table_header
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|header
)paren
r_break
suffix:semicolon
id|acpi_print_table_header
c_func
(paren
id|header
)paren
suffix:semicolon
r_if
c_cond
(paren
id|acpi_checksum
c_func
(paren
id|header
comma
id|header-&gt;length
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ACPI %s has invalid checksum&bslash;n&quot;
comma
id|acpi_table_signatures
(braket
id|i
)braket
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_for
c_loop
(paren
id|type
op_assign
l_int|0
suffix:semicolon
id|type
OL
id|ACPI_TABLE_COUNT
suffix:semicolon
id|type
op_increment
)paren
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
(paren
r_char
op_star
)paren
op_amp
id|header-&gt;signature
comma
id|acpi_table_signatures
(braket
id|type
)braket
comma
id|strlen
c_func
(paren
id|acpi_table_signatures
(braket
id|type
)braket
)paren
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|type
op_ge
id|ACPI_TABLE_COUNT
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;ACPI: Unsupported table %.4s&bslash;n&quot;
comma
id|header-&gt;signature
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|acpi_boot_ops
(braket
id|type
)braket
)paren
r_continue
suffix:semicolon
id|result
op_assign
id|acpi_boot_ops
(braket
id|type
)braket
(paren
id|header
comma
(paren
r_int
r_int
)paren
id|saved_rsdt
dot
id|entry
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_return
id|result
suffix:semicolon
)brace
DECL|variable|__initdata
r_static
r_int
id|total_cpus
id|__initdata
op_assign
l_int|0
suffix:semicolon
DECL|variable|have_acpi_tables
r_int
id|have_acpi_tables
suffix:semicolon
r_extern
r_void
id|__init
id|MP_processor_info
c_func
(paren
r_struct
id|mpc_config_processor
op_star
)paren
suffix:semicolon
r_static
r_void
id|__init
DECL|function|acpi_parse_lapic
id|acpi_parse_lapic
c_func
(paren
r_struct
id|acpi_table_lapic
op_star
id|local_apic
)paren
(brace
r_struct
id|mpc_config_processor
id|proc_entry
suffix:semicolon
r_int
id|ix
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|local_apic
)paren
r_return
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;LAPIC (acpi_id[0x%04x] id[0x%x] enabled[%d])&bslash;n&quot;
comma
id|local_apic-&gt;acpi_id
comma
id|local_apic-&gt;id
comma
id|local_apic-&gt;flags.enabled
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;CPU %d (0x%02x00)&quot;
comma
id|total_cpus
comma
id|local_apic-&gt;id
)paren
suffix:semicolon
r_if
c_cond
(paren
id|local_apic-&gt;flags.enabled
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; enabled&quot;
)paren
suffix:semicolon
id|ix
op_assign
id|local_apic-&gt;id
suffix:semicolon
r_if
c_cond
(paren
id|ix
op_ge
id|MAX_APICS
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Processor #%d INVALID - (Max ID: %d).&bslash;n&quot;
comma
id|ix
comma
id|MAX_APICS
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/* &n;&t;&t; * Fill in the info we want to save.  Not concerned about &n;&t;&t; * the processor ID.  Processor features aren&squot;t present in &n;&t;&t; * the table.&n;&t;&t; */
id|proc_entry.mpc_type
op_assign
id|MP_PROCESSOR
suffix:semicolon
id|proc_entry.mpc_apicid
op_assign
id|local_apic-&gt;id
suffix:semicolon
id|proc_entry.mpc_cpuflag
op_assign
id|CPU_ENABLED
suffix:semicolon
r_if
c_cond
(paren
id|proc_entry.mpc_apicid
op_eq
id|boot_cpu_physical_apicid
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; (BSP)&quot;
)paren
suffix:semicolon
id|proc_entry.mpc_cpuflag
op_or_assign
id|CPU_BOOTPROCESSOR
suffix:semicolon
)brace
id|proc_entry.mpc_cpufeature
op_assign
(paren
id|boot_cpu_data.x86
op_lshift
l_int|8
)paren
op_or
(paren
id|boot_cpu_data.x86_model
op_lshift
l_int|4
)paren
op_or
id|boot_cpu_data.x86_mask
suffix:semicolon
id|proc_entry.mpc_featureflag
op_assign
id|boot_cpu_data.x86_capability
(braket
l_int|0
)braket
suffix:semicolon
id|proc_entry.mpc_reserved
(braket
l_int|0
)braket
op_assign
l_int|0
suffix:semicolon
id|proc_entry.mpc_reserved
(braket
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|proc_entry.mpc_apicver
op_assign
l_int|0x10
suffix:semicolon
multiline_comment|/* integrated APIC */
id|MP_processor_info
c_func
(paren
op_amp
id|proc_entry
)paren
suffix:semicolon
)brace
r_else
(brace
id|printk
c_func
(paren
l_string|&quot; disabled&quot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|total_cpus
op_increment
suffix:semicolon
r_return
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|acpi_parse_ioapic
id|acpi_parse_ioapic
c_func
(paren
r_struct
id|acpi_table_ioapic
op_star
id|ioapic
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ioapic
)paren
r_return
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;IOAPIC (id[0x%x] address[0x%x] global_irq_base[0x%x])&bslash;n&quot;
comma
id|ioapic-&gt;id
comma
id|ioapic-&gt;address
comma
id|ioapic-&gt;global_irq_base
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nr_ioapics
op_ge
id|MAX_IO_APICS
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Max # of I/O APICs (%d) exceeded (found %d).&bslash;n&quot;
comma
id|MAX_IO_APICS
comma
id|nr_ioapics
)paren
suffix:semicolon
multiline_comment|/*&t;&t;panic(&quot;Recompile kernel with bigger MAX_IO_APICS!&bslash;n&quot;);   */
)brace
)brace
multiline_comment|/* Interrupt source overrides inform the machine about exceptions&n;   to the normal &quot;PIC&quot; mode interrupt routing */
r_static
r_void
id|__init
DECL|function|acpi_parse_int_src_ovr
id|acpi_parse_int_src_ovr
c_func
(paren
r_struct
id|acpi_table_int_src_ovr
op_star
id|intsrc
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|intsrc
)paren
r_return
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;INT_SRC_OVR (bus[%d] irq[0x%x] global_irq[0x%x] polarity[0x%x] trigger[0x%x])&bslash;n&quot;
comma
id|intsrc-&gt;bus
comma
id|intsrc-&gt;bus_irq
comma
id|intsrc-&gt;global_irq
comma
id|intsrc-&gt;flags.polarity
comma
id|intsrc-&gt;flags.trigger
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * At this point, we look at the interrupt assignment entries in the MPS&n; * table.&n; */
DECL|function|acpi_parse_nmi_src
r_static
r_void
id|__init
id|acpi_parse_nmi_src
c_func
(paren
r_struct
id|acpi_table_nmi_src
op_star
id|nmisrc
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|nmisrc
)paren
r_return
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;NMI_SRC (polarity[0x%x] trigger[0x%x] global_irq[0x%x])&bslash;n&quot;
comma
id|nmisrc-&gt;flags.polarity
comma
id|nmisrc-&gt;flags.trigger
comma
id|nmisrc-&gt;global_irq
)paren
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|acpi_parse_lapic_nmi
id|acpi_parse_lapic_nmi
c_func
(paren
r_struct
id|acpi_table_lapic_nmi
op_star
id|localnmi
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|localnmi
)paren
r_return
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;LAPIC_NMI (acpi_id[0x%04x] polarity[0x%x] trigger[0x%x] lint[0x%x])&bslash;n&quot;
comma
id|localnmi-&gt;acpi_id
comma
id|localnmi-&gt;flags.polarity
comma
id|localnmi-&gt;flags.trigger
comma
id|localnmi-&gt;lint
)paren
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|acpi_parse_lapic_addr_ovr
id|acpi_parse_lapic_addr_ovr
c_func
(paren
r_struct
id|acpi_table_lapic_addr_ovr
op_star
id|lapic_addr_ovr
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|lapic_addr_ovr
)paren
r_return
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;LAPIC_ADDR_OVR (address[0x%lx])&bslash;n&quot;
comma
(paren
r_int
r_int
)paren
id|lapic_addr_ovr-&gt;address
)paren
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|acpi_parse_plat_int_src
id|acpi_parse_plat_int_src
c_func
(paren
r_struct
id|acpi_table_plat_int_src
op_star
id|plintsrc
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|plintsrc
)paren
r_return
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;PLAT_INT_SRC (polarity[0x%x] trigger[0x%x] type[0x%x] id[0x%04x] eid[0x%x] iosapic_vector[0x%x] global_irq[0x%x]&bslash;n&quot;
comma
id|plintsrc-&gt;flags.polarity
comma
id|plintsrc-&gt;flags.trigger
comma
id|plintsrc-&gt;type
comma
id|plintsrc-&gt;id
comma
id|plintsrc-&gt;eid
comma
id|plintsrc-&gt;iosapic_vector
comma
id|plintsrc-&gt;global_irq
)paren
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|acpi_parse_madt
id|acpi_parse_madt
c_func
(paren
id|acpi_table_header
op_star
id|header
comma
r_int
r_int
id|phys
)paren
(brace
r_struct
id|acpi_table_madt
op_star
id|madt
suffix:semicolon
id|acpi_madt_entry_header
op_star
id|entry_header
suffix:semicolon
r_int
id|table_size
suffix:semicolon
id|madt
op_assign
(paren
r_struct
id|acpi_table_madt
op_star
)paren
id|__va_range
c_func
(paren
id|phys
comma
id|header-&gt;length
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|madt
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|table_size
op_assign
(paren
r_int
)paren
(paren
id|header-&gt;length
op_minus
r_sizeof
(paren
op_star
id|madt
)paren
)paren
suffix:semicolon
id|entry_header
op_assign
(paren
id|acpi_madt_entry_header
op_star
)paren
(paren
(paren
r_void
op_star
)paren
id|madt
op_plus
r_sizeof
(paren
op_star
id|madt
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|entry_header
op_logical_and
(paren
id|table_size
OG
l_int|0
)paren
)paren
(brace
r_switch
c_cond
(paren
id|entry_header-&gt;type
)paren
(brace
r_case
id|ACPI_MADT_LAPIC
suffix:colon
id|acpi_parse_lapic
c_func
(paren
(paren
r_struct
id|acpi_table_lapic
op_star
)paren
id|entry_header
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_MADT_IOAPIC
suffix:colon
id|acpi_parse_ioapic
c_func
(paren
(paren
r_struct
id|acpi_table_ioapic
op_star
)paren
id|entry_header
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_MADT_INT_SRC_OVR
suffix:colon
id|acpi_parse_int_src_ovr
c_func
(paren
(paren
r_struct
id|acpi_table_int_src_ovr
op_star
)paren
id|entry_header
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_MADT_NMI_SRC
suffix:colon
id|acpi_parse_nmi_src
c_func
(paren
(paren
r_struct
id|acpi_table_nmi_src
op_star
)paren
id|entry_header
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_MADT_LAPIC_NMI
suffix:colon
id|acpi_parse_lapic_nmi
c_func
(paren
(paren
r_struct
id|acpi_table_lapic_nmi
op_star
)paren
id|entry_header
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_MADT_LAPIC_ADDR_OVR
suffix:colon
id|acpi_parse_lapic_addr_ovr
c_func
(paren
(paren
r_struct
id|acpi_table_lapic_addr_ovr
op_star
)paren
id|entry_header
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_MADT_PLAT_INT_SRC
suffix:colon
id|acpi_parse_plat_int_src
c_func
(paren
(paren
r_struct
id|acpi_table_plat_int_src
op_star
)paren
id|entry_header
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;Unsupported MADT entry type 0x%x&bslash;n&quot;
comma
id|entry_header-&gt;type
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|table_size
op_sub_assign
id|entry_header-&gt;length
suffix:semicolon
id|entry_header
op_assign
(paren
id|acpi_madt_entry_header
op_star
)paren
(paren
(paren
r_void
op_star
)paren
id|entry_header
op_plus
id|entry_header-&gt;length
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|total_cpus
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;ACPI: No Processors found in the APCI table.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;%d CPUs total&bslash;n&quot;
comma
id|total_cpus
)paren
suffix:semicolon
r_if
c_cond
(paren
id|madt-&gt;lapic_address
)paren
id|mp_lapic_addr
op_assign
id|madt-&gt;lapic_address
suffix:semicolon
r_else
id|mp_lapic_addr
op_assign
id|APIC_DEFAULT_PHYS_BASE
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;Local APIC address %x&bslash;n&quot;
comma
id|madt-&gt;lapic_address
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_extern
r_int
id|enable_acpi_smp_table
suffix:semicolon
multiline_comment|/*&n; * Configure the processor info using MADT in the ACPI tables. If we fail to&n; * configure that, then we use the MPS tables.&n; */
r_void
id|__init
DECL|function|config_acpi_tables
id|config_acpi_tables
c_func
(paren
r_void
)paren
(brace
id|memset
c_func
(paren
op_amp
id|acpi_boot_ops
comma
l_int|0
comma
r_sizeof
(paren
id|acpi_boot_ops
)paren
)paren
suffix:semicolon
id|acpi_boot_ops
(braket
id|ACPI_APIC
)braket
op_assign
id|acpi_parse_madt
suffix:semicolon
multiline_comment|/*&n;&t; * Only do this when requested, either because of CPU/Bios type or from the command line&n;&t; */
r_if
c_cond
(paren
id|enable_acpi_smp_table
op_logical_and
op_logical_neg
id|acpi_tables_init
c_func
(paren
)paren
)paren
(brace
id|have_acpi_tables
op_assign
l_int|1
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;Enabling the CPU&squot;s according to the ACPI table&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
eof
