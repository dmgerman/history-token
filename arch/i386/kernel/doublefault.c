macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/init_task.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/pgtable.h&gt;
macro_line|#include &lt;asm/desc.h&gt;
DECL|macro|DOUBLEFAULT_STACKSIZE
mdefine_line|#define DOUBLEFAULT_STACKSIZE (1024)
DECL|variable|doublefault_stack
r_static
r_int
r_int
id|doublefault_stack
(braket
id|DOUBLEFAULT_STACKSIZE
)braket
suffix:semicolon
DECL|macro|STACK_START
mdefine_line|#define STACK_START (unsigned long)(doublefault_stack+DOUBLEFAULT_STACKSIZE)
DECL|macro|ptr_ok
mdefine_line|#define ptr_ok(x) ((x) &gt; 0xc0000000 &amp;&amp; (x) &lt; 0xc1000000)
DECL|function|doublefault_fn
r_static
r_void
id|doublefault_fn
c_func
(paren
r_void
)paren
(brace
r_struct
id|Xgt_desc_struct
id|gdt_desc
op_assign
(brace
l_int|0
comma
l_int|0
)brace
suffix:semicolon
r_int
r_int
id|gdt
comma
id|tss
suffix:semicolon
id|__asm__
id|__volatile__
c_func
(paren
l_string|&quot;sgdt %0&quot;
suffix:colon
l_string|&quot;=m&quot;
(paren
id|gdt_desc
)paren
suffix:colon
suffix:colon
l_string|&quot;memory&quot;
)paren
suffix:semicolon
id|gdt
op_assign
id|gdt_desc.address
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;double fault, gdt at %08lx [%d bytes]&bslash;n&quot;
comma
id|gdt
comma
id|gdt_desc.size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr_ok
c_func
(paren
id|gdt
)paren
)paren
(brace
id|gdt
op_add_assign
id|GDT_ENTRY_TSS
op_lshift
l_int|3
suffix:semicolon
id|tss
op_assign
op_star
(paren
id|u16
op_star
)paren
(paren
id|gdt
op_plus
l_int|2
)paren
suffix:semicolon
id|tss
op_add_assign
op_star
(paren
id|u8
op_star
)paren
(paren
id|gdt
op_plus
l_int|4
)paren
op_lshift
l_int|16
suffix:semicolon
id|tss
op_add_assign
op_star
(paren
id|u8
op_star
)paren
(paren
id|gdt
op_plus
l_int|7
)paren
op_lshift
l_int|24
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;double fault, tss at %08lx&bslash;n&quot;
comma
id|tss
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr_ok
c_func
(paren
id|tss
)paren
)paren
(brace
r_struct
id|tss_struct
op_star
id|t
op_assign
(paren
r_struct
id|tss_struct
op_star
)paren
id|tss
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;eip = %08lx, esp = %08lx&bslash;n&quot;
comma
id|t-&gt;eip
comma
id|t-&gt;esp
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;eax = %08lx, ebx = %08lx, ecx = %08lx, edx = %08lx&bslash;n&quot;
comma
id|t-&gt;eax
comma
id|t-&gt;ebx
comma
id|t-&gt;ecx
comma
id|t-&gt;edx
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;esi = %08lx, edi = %08lx&bslash;n&quot;
comma
id|t-&gt;esi
comma
id|t-&gt;edi
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
multiline_comment|/* nothing */
suffix:semicolon
)brace
DECL|variable|__cacheline_aligned
r_struct
id|tss_struct
id|doublefault_tss
id|__cacheline_aligned
op_assign
(brace
dot
id|esp0
op_assign
id|STACK_START
comma
dot
id|ss0
op_assign
id|__KERNEL_DS
comma
dot
id|ldt
op_assign
l_int|0
comma
dot
id|bitmap
op_assign
id|INVALID_IO_BITMAP_OFFSET
comma
dot
id|io_bitmap
op_assign
(brace
(braket
l_int|0
dot
dot
dot
id|IO_BITMAP_SIZE
)braket
op_assign
op_complement
l_int|0
)brace
comma
dot
id|eip
op_assign
(paren
r_int
r_int
)paren
id|doublefault_fn
comma
dot
id|eflags
op_assign
l_int|0x00000082
comma
dot
id|esp
op_assign
id|STACK_START
comma
dot
id|es
op_assign
id|__USER_DS
comma
dot
id|cs
op_assign
id|__KERNEL_CS
comma
dot
id|ss
op_assign
id|__KERNEL_DS
comma
dot
id|ds
op_assign
id|__USER_DS
comma
dot
id|__cr3
op_assign
id|__pa
c_func
(paren
id|swapper_pg_dir
)paren
)brace
suffix:semicolon
eof
