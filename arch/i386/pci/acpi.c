macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/acpi.h&gt;
macro_line|#include &quot;pci.h&quot;
r_extern
r_void
id|eisa_set_level_irq
c_func
(paren
r_int
id|irq
)paren
suffix:semicolon
DECL|function|acpi_lookup_irq
r_static
r_int
id|acpi_lookup_irq
(paren
r_struct
id|pci_dev
op_star
id|dev
comma
r_int
id|assign
)paren
(brace
r_int
id|result
op_assign
l_int|0
suffix:semicolon
r_int
id|irq
op_assign
l_int|0
suffix:semicolon
id|u8
id|pin
suffix:semicolon
multiline_comment|/* TBD: Select IRQ from possible to improve routing performance. */
multiline_comment|/* Find IRQ pin */
id|pci_read_config_byte
c_func
(paren
id|dev
comma
id|PCI_INTERRUPT_PIN
comma
op_amp
id|pin
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pin
)paren
(brace
id|DBG
c_func
(paren
l_string|&quot; -&gt; no interrupt pin&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|pin
op_assign
id|pin
op_minus
l_int|1
suffix:semicolon
id|result
op_assign
id|acpi_prt_get_irq
c_func
(paren
id|dev
comma
id|pin
comma
op_amp
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|irq
)paren
id|result
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|result
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;PCI: No IRQ known for interrupt pin %c of device %s&bslash;n&quot;
comma
l_char|&squot;A&squot;
op_plus
id|pin
comma
id|dev-&gt;slot_name
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
multiline_comment|/* only check for the IRQ */
r_if
c_cond
(paren
op_logical_neg
id|assign
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;PCI: Found IRQ %d for device %s&bslash;n&quot;
comma
id|irq
comma
id|dev-&gt;slot_name
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|dev-&gt;irq
op_assign
id|irq
suffix:semicolon
multiline_comment|/* also assign an IRQ */
r_if
c_cond
(paren
id|irq
op_logical_and
(paren
id|dev
op_member_access_from_pointer
r_class
op_rshift
l_int|8
)paren
op_ne
id|PCI_CLASS_DISPLAY_VGA
)paren
(brace
id|result
op_assign
id|acpi_prt_set_irq
c_func
(paren
id|dev
comma
id|pin
comma
id|irq
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_ne
id|result
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;PCI: Could not assign IRQ %d to device %s&bslash;n&quot;
comma
id|irq
comma
id|dev-&gt;slot_name
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
id|eisa_set_level_irq
c_func
(paren
id|irq
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;PCI: Assigned IRQ %d for device %s&bslash;n&quot;
comma
id|irq
comma
id|dev-&gt;slot_name
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|pci_acpi_init
r_static
r_int
id|__init
id|pci_acpi_init
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|pci_probe
op_amp
id|PCI_NO_ACPI_ROUTING
)paren
)paren
(brace
r_if
c_cond
(paren
id|acpi_prts.count
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;PCI: Using ACPI for IRQ routing&bslash;n&quot;
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;PCI: if you experience problems, try using option &squot;pci=noacpi&squot;&bslash;n&quot;
)paren
suffix:semicolon
id|pci_use_acpi_routing
op_assign
l_int|1
suffix:semicolon
id|pci_lookup_irq
op_assign
id|acpi_lookup_irq
suffix:semicolon
)brace
r_else
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;PCI: Invalid ACPI-PCI IRQ routing table&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|pci_acpi_init
id|arch_initcall
c_func
(paren
id|pci_acpi_init
)paren
suffix:semicolon
eof
