macro_line|#include &lt;linux/input.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/delay.h&gt;
macro_line|#include &lt;asm/adc.h&gt;
macro_line|#include &lt;asm/hp6xx/hp6xx.h&gt;
DECL|macro|MODNAME
mdefine_line|#define MODNAME &quot;hp680_ts_input&quot;
DECL|macro|HP680_TS_ABS_X_MIN
mdefine_line|#define HP680_TS_ABS_X_MIN&t;40
DECL|macro|HP680_TS_ABS_X_MAX
mdefine_line|#define HP680_TS_ABS_X_MAX&t;950
DECL|macro|HP680_TS_ABS_Y_MIN
mdefine_line|#define HP680_TS_ABS_Y_MIN&t;80
DECL|macro|HP680_TS_ABS_Y_MAX
mdefine_line|#define HP680_TS_ABS_Y_MAX&t;910
DECL|macro|SCPCR
mdefine_line|#define&t;SCPCR&t;0xa4000116
DECL|macro|PHDR
mdefine_line|#define&t;PHDR&t;0xa400012e
DECL|macro|SCPDR
mdefine_line|#define SCPDR&t;0xa4000136
r_static
r_void
id|do_softint
c_func
(paren
r_void
op_star
id|data
)paren
suffix:semicolon
DECL|variable|hp680_ts_dev
r_static
r_struct
id|input_dev
id|hp680_ts_dev
suffix:semicolon
r_static
id|DECLARE_WORK
c_func
(paren
id|work
comma
id|do_softint
comma
l_int|0
)paren
suffix:semicolon
DECL|variable|hp680_ts_name
r_static
r_char
op_star
id|hp680_ts_name
op_assign
l_string|&quot;HP Jornada touchscreen&quot;
suffix:semicolon
DECL|variable|hp680_ts_phys
r_static
r_char
op_star
id|hp680_ts_phys
op_assign
l_string|&quot;input0&quot;
suffix:semicolon
DECL|function|do_softint
r_static
r_void
id|do_softint
c_func
(paren
r_void
op_star
id|data
)paren
(brace
r_int
id|absx
op_assign
l_int|0
comma
id|absy
op_assign
l_int|0
suffix:semicolon
id|u8
id|scpdr
suffix:semicolon
r_int
id|touched
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ctrl_inb
c_func
(paren
id|PHDR
)paren
op_amp
id|PHDR_TS_PEN_DOWN
)paren
(brace
id|scpdr
op_assign
id|ctrl_inb
c_func
(paren
id|SCPDR
)paren
suffix:semicolon
id|scpdr
op_or_assign
id|SCPDR_TS_SCAN_ENABLE
suffix:semicolon
id|scpdr
op_and_assign
op_complement
id|SCPDR_TS_SCAN_Y
suffix:semicolon
id|ctrl_outb
c_func
(paren
id|scpdr
comma
id|SCPDR
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|30
)paren
suffix:semicolon
id|absy
op_assign
id|adc_single
c_func
(paren
id|ADC_CHANNEL_TS_Y
)paren
suffix:semicolon
id|scpdr
op_assign
id|ctrl_inb
c_func
(paren
id|SCPDR
)paren
suffix:semicolon
id|scpdr
op_or_assign
id|SCPDR_TS_SCAN_Y
suffix:semicolon
id|scpdr
op_and_assign
op_complement
id|SCPDR_TS_SCAN_X
suffix:semicolon
id|ctrl_outb
c_func
(paren
id|scpdr
comma
id|SCPDR
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|30
)paren
suffix:semicolon
id|absx
op_assign
id|adc_single
c_func
(paren
id|ADC_CHANNEL_TS_X
)paren
suffix:semicolon
id|scpdr
op_assign
id|ctrl_inb
c_func
(paren
id|SCPDR
)paren
suffix:semicolon
id|scpdr
op_or_assign
id|SCPDR_TS_SCAN_X
suffix:semicolon
id|scpdr
op_and_assign
op_complement
id|SCPDR_TS_SCAN_ENABLE
suffix:semicolon
id|ctrl_outb
c_func
(paren
id|scpdr
comma
id|SCPDR
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|100
)paren
suffix:semicolon
id|touched
op_assign
id|ctrl_inb
c_func
(paren
id|PHDR
)paren
op_amp
id|PHDR_TS_PEN_DOWN
suffix:semicolon
)brace
r_if
c_cond
(paren
id|touched
)paren
(brace
id|input_report_key
c_func
(paren
op_amp
id|hp680_ts_dev
comma
id|BTN_TOUCH
comma
l_int|1
)paren
suffix:semicolon
id|input_report_abs
c_func
(paren
op_amp
id|hp680_ts_dev
comma
id|ABS_X
comma
id|absx
)paren
suffix:semicolon
id|input_report_abs
c_func
(paren
op_amp
id|hp680_ts_dev
comma
id|ABS_Y
comma
id|absy
)paren
suffix:semicolon
)brace
r_else
(brace
id|input_report_key
c_func
(paren
op_amp
id|hp680_ts_dev
comma
id|BTN_TOUCH
comma
l_int|0
)paren
suffix:semicolon
)brace
id|input_sync
c_func
(paren
op_amp
id|hp680_ts_dev
)paren
suffix:semicolon
id|enable_irq
c_func
(paren
id|HP680_TS_IRQ
)paren
suffix:semicolon
)brace
DECL|function|hp680_ts_interrupt
r_static
id|irqreturn_t
id|hp680_ts_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
id|disable_irq_nosync
c_func
(paren
id|irq
)paren
suffix:semicolon
id|schedule_delayed_work
c_func
(paren
op_amp
id|work
comma
id|HZ
op_div
l_int|20
)paren
suffix:semicolon
r_return
id|IRQ_HANDLED
suffix:semicolon
)brace
DECL|function|hp680_ts_init
r_static
r_int
id|__init
id|hp680_ts_init
c_func
(paren
r_void
)paren
(brace
id|u8
id|scpdr
suffix:semicolon
id|u16
id|scpcr
suffix:semicolon
id|scpdr
op_assign
id|ctrl_inb
c_func
(paren
id|SCPDR
)paren
suffix:semicolon
id|scpdr
op_or_assign
id|SCPDR_TS_SCAN_X
op_or
id|SCPDR_TS_SCAN_Y
suffix:semicolon
id|scpdr
op_and_assign
op_complement
id|SCPDR_TS_SCAN_ENABLE
suffix:semicolon
id|ctrl_outb
c_func
(paren
id|scpdr
comma
id|SCPDR
)paren
suffix:semicolon
id|scpcr
op_assign
id|ctrl_inw
c_func
(paren
id|SCPCR
)paren
suffix:semicolon
id|scpcr
op_and_assign
op_complement
id|SCPCR_TS_MASK
suffix:semicolon
id|scpcr
op_or_assign
id|SCPCR_TS_ENABLE
suffix:semicolon
id|ctrl_outw
c_func
(paren
id|scpcr
comma
id|SCPCR
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|hp680_ts_dev
comma
l_int|0
comma
r_sizeof
(paren
id|hp680_ts_dev
)paren
)paren
suffix:semicolon
id|init_input_dev
c_func
(paren
op_amp
id|hp680_ts_dev
)paren
suffix:semicolon
id|hp680_ts_dev.evbit
(braket
l_int|0
)braket
op_assign
id|BIT
c_func
(paren
id|EV_ABS
)paren
op_or
id|BIT
c_func
(paren
id|EV_KEY
)paren
suffix:semicolon
id|hp680_ts_dev.absbit
(braket
l_int|0
)braket
op_assign
id|BIT
c_func
(paren
id|ABS_X
)paren
op_or
id|BIT
c_func
(paren
id|ABS_Y
)paren
suffix:semicolon
id|hp680_ts_dev.keybit
(braket
id|LONG
c_func
(paren
id|BTN_TOUCH
)paren
)braket
op_assign
id|BIT
c_func
(paren
id|BTN_TOUCH
)paren
suffix:semicolon
id|hp680_ts_dev.absmin
(braket
id|ABS_X
)braket
op_assign
id|HP680_TS_ABS_X_MIN
suffix:semicolon
id|hp680_ts_dev.absmin
(braket
id|ABS_Y
)braket
op_assign
id|HP680_TS_ABS_Y_MIN
suffix:semicolon
id|hp680_ts_dev.absmax
(braket
id|ABS_X
)braket
op_assign
id|HP680_TS_ABS_X_MAX
suffix:semicolon
id|hp680_ts_dev.absmax
(braket
id|ABS_Y
)braket
op_assign
id|HP680_TS_ABS_Y_MAX
suffix:semicolon
id|hp680_ts_dev.name
op_assign
id|hp680_ts_name
suffix:semicolon
id|hp680_ts_dev.phys
op_assign
id|hp680_ts_phys
suffix:semicolon
id|input_register_device
c_func
(paren
op_amp
id|hp680_ts_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
(paren
id|HP680_TS_IRQ
comma
id|hp680_ts_interrupt
comma
id|SA_INTERRUPT
comma
id|MODNAME
comma
l_int|0
)paren
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_ERR
l_string|&quot;hp680_touchscreen.c : Can&squot;t allocate irq %d&bslash;n&quot;
comma
id|HP680_TS_IRQ
)paren
suffix:semicolon
id|input_unregister_device
c_func
(paren
op_amp
id|hp680_ts_dev
)paren
suffix:semicolon
r_return
op_minus
id|EBUSY
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hp680_ts_exit
r_static
r_void
id|__exit
id|hp680_ts_exit
c_func
(paren
r_void
)paren
(brace
id|free_irq
c_func
(paren
id|HP680_TS_IRQ
comma
l_int|0
)paren
suffix:semicolon
id|cancel_delayed_work
c_func
(paren
op_amp
id|work
)paren
suffix:semicolon
id|flush_scheduled_work
c_func
(paren
)paren
suffix:semicolon
id|input_unregister_device
c_func
(paren
op_amp
id|hp680_ts_dev
)paren
suffix:semicolon
)brace
DECL|variable|hp680_ts_init
id|module_init
c_func
(paren
id|hp680_ts_init
)paren
suffix:semicolon
DECL|variable|hp680_ts_exit
id|module_exit
c_func
(paren
id|hp680_ts_exit
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Andriy Skulysh, askulysh@image.kiev.ua&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;HP Jornada 680 touchscreen driver&quot;
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
eof
