multiline_comment|/******************************************************************************&n; *&n; * Module Name: dsobject - Dispatcher object management routines&n; *&n; *****************************************************************************/
multiline_comment|/*&n; * Copyright (C) 2000 - 2005, R. Byron Moore&n; * All rights reserved.&n; *&n; * Redistribution and use in source and binary forms, with or without&n; * modification, are permitted provided that the following conditions&n; * are met:&n; * 1. Redistributions of source code must retain the above copyright&n; *    notice, this list of conditions, and the following disclaimer,&n; *    without modification.&n; * 2. Redistributions in binary form must reproduce at minimum a disclaimer&n; *    substantially similar to the &quot;NO WARRANTY&quot; disclaimer below&n; *    (&quot;Disclaimer&quot;) and any redistribution must be conditioned upon&n; *    including a substantially similar Disclaimer requirement for further&n; *    binary redistribution.&n; * 3. Neither the names of the above-listed copyright holders nor the names&n; *    of any contributors may be used to endorse or promote products derived&n; *    from this software without specific prior written permission.&n; *&n; * Alternatively, this software may be distributed under the terms of the&n; * GNU General Public License (&quot;GPL&quot;) version 2 as published by the Free&n; * Software Foundation.&n; *&n; * NO WARRANTY&n; * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS&n; * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT&n; * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR&n; * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT&n; * HOLDERS OR CONTRIBUTORS BE LIABLE FOR SPECIAL, EXEMPLARY, OR CONSEQUENTIAL&n; * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS&n; * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)&n; * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,&n; * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING&n; * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE&n; * POSSIBILITY OF SUCH DAMAGES.&n; */
macro_line|#include &lt;acpi/acpi.h&gt;
macro_line|#include &lt;acpi/acparser.h&gt;
macro_line|#include &lt;acpi/amlcode.h&gt;
macro_line|#include &lt;acpi/acdispat.h&gt;
macro_line|#include &lt;acpi/acnamesp.h&gt;
macro_line|#include &lt;acpi/acinterp.h&gt;
DECL|macro|_COMPONENT
mdefine_line|#define _COMPONENT          ACPI_DISPATCHER
id|ACPI_MODULE_NAME
(paren
l_string|&quot;dsobject&quot;
)paren
macro_line|#ifndef ACPI_NO_METHOD_EXECUTION
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    acpi_ds_build_internal_object&n; *&n; * PARAMETERS:  walk_state      - Current walk state&n; *              Op              - Parser object to be translated&n; *              obj_desc_ptr    - Where the ACPI internal object is returned&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Translate a parser Op object to the equivalent namespace object&n; *              Simple objects are any objects other than a package object!&n; *&n; ****************************************************************************/
id|acpi_status
DECL|function|acpi_ds_build_internal_object
id|acpi_ds_build_internal_object
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
comma
r_union
id|acpi_parse_object
op_star
id|op
comma
r_union
id|acpi_operand_object
op_star
op_star
id|obj_desc_ptr
)paren
(brace
r_union
id|acpi_operand_object
op_star
id|obj_desc
suffix:semicolon
id|acpi_status
id|status
suffix:semicolon
id|ACPI_FUNCTION_TRACE
(paren
l_string|&quot;ds_build_internal_object&quot;
)paren
suffix:semicolon
op_star
id|obj_desc_ptr
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|op-&gt;common.aml_opcode
op_eq
id|AML_INT_NAMEPATH_OP
)paren
(brace
multiline_comment|/*&n;&t;&t; * This is an named object reference.  If this name was&n;&t;&t; * previously looked up in the namespace, it was stored in this op.&n;&t;&t; * Otherwise, go ahead and look it up now&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|op-&gt;common.node
)paren
(brace
id|status
op_assign
id|acpi_ns_lookup
(paren
id|walk_state-&gt;scope_info
comma
id|op-&gt;common.value.string
comma
id|ACPI_TYPE_ANY
comma
id|ACPI_IMODE_EXECUTE
comma
id|ACPI_NS_SEARCH_PARENT
op_or
id|ACPI_NS_DONT_OPEN_SCOPE
comma
l_int|NULL
comma
(paren
r_struct
id|acpi_namespace_node
op_star
op_star
)paren
op_amp
(paren
id|op-&gt;common.node
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
id|ACPI_REPORT_NSERROR
(paren
id|op-&gt;common.value.string
comma
id|status
)paren
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* Create and init the internal ACPI object */
id|obj_desc
op_assign
id|acpi_ut_create_internal_object
(paren
(paren
id|acpi_ps_get_opcode_info
(paren
id|op-&gt;common.aml_opcode
)paren
)paren
op_member_access_from_pointer
id|object_type
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|obj_desc
)paren
(brace
id|return_ACPI_STATUS
(paren
id|AE_NO_MEMORY
)paren
suffix:semicolon
)brace
id|status
op_assign
id|acpi_ds_init_object_from_op
(paren
id|walk_state
comma
id|op
comma
id|op-&gt;common.aml_opcode
comma
op_amp
id|obj_desc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
id|acpi_ut_remove_reference
(paren
id|obj_desc
)paren
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
op_star
id|obj_desc_ptr
op_assign
id|obj_desc
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    acpi_ds_build_internal_buffer_obj&n; *&n; * PARAMETERS:  walk_state      - Current walk state&n; *              Op              - Parser object to be translated&n; *              buffer_length   - Length of the buffer&n; *              obj_desc_ptr    - Where the ACPI internal object is returned&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Translate a parser Op package object to the equivalent&n; *              namespace object&n; *&n; ****************************************************************************/
id|acpi_status
DECL|function|acpi_ds_build_internal_buffer_obj
id|acpi_ds_build_internal_buffer_obj
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
comma
r_union
id|acpi_parse_object
op_star
id|op
comma
id|u32
id|buffer_length
comma
r_union
id|acpi_operand_object
op_star
op_star
id|obj_desc_ptr
)paren
(brace
r_union
id|acpi_parse_object
op_star
id|arg
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|obj_desc
suffix:semicolon
r_union
id|acpi_parse_object
op_star
id|byte_list
suffix:semicolon
id|u32
id|byte_list_length
op_assign
l_int|0
suffix:semicolon
id|ACPI_FUNCTION_TRACE
(paren
l_string|&quot;ds_build_internal_buffer_obj&quot;
)paren
suffix:semicolon
id|obj_desc
op_assign
op_star
id|obj_desc_ptr
suffix:semicolon
r_if
c_cond
(paren
id|obj_desc
)paren
(brace
multiline_comment|/*&n;&t;&t; * We are evaluating a Named buffer object &quot;Name (xxxx, Buffer)&quot;.&n;&t;&t; * The buffer object already exists (from the NS node)&n;&t;&t; */
)brace
r_else
(brace
multiline_comment|/* Create a new buffer object */
id|obj_desc
op_assign
id|acpi_ut_create_internal_object
(paren
id|ACPI_TYPE_BUFFER
)paren
suffix:semicolon
op_star
id|obj_desc_ptr
op_assign
id|obj_desc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|obj_desc
)paren
(brace
id|return_ACPI_STATUS
(paren
id|AE_NO_MEMORY
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; * Second arg is the buffer data (optional) byte_list can be either&n;&t; * individual bytes or a string initializer.  In either case, a&n;&t; * byte_list appears in the AML.&n;&t; */
id|arg
op_assign
id|op-&gt;common.value.arg
suffix:semicolon
multiline_comment|/* skip first arg */
id|byte_list
op_assign
id|arg-&gt;named.next
suffix:semicolon
r_if
c_cond
(paren
id|byte_list
)paren
(brace
r_if
c_cond
(paren
id|byte_list-&gt;common.aml_opcode
op_ne
id|AML_INT_BYTELIST_OP
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Expecting bytelist, got AML opcode %X in op %p&bslash;n&quot;
comma
id|byte_list-&gt;common.aml_opcode
comma
id|byte_list
)paren
)paren
suffix:semicolon
id|acpi_ut_remove_reference
(paren
id|obj_desc
)paren
suffix:semicolon
r_return
(paren
id|AE_TYPE
)paren
suffix:semicolon
)brace
id|byte_list_length
op_assign
(paren
id|u32
)paren
id|byte_list-&gt;common.value.integer
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * The buffer length (number of bytes) will be the larger of:&n;&t; * 1) The specified buffer length and&n;&t; * 2) The length of the initializer byte list&n;&t; */
id|obj_desc-&gt;buffer.length
op_assign
id|buffer_length
suffix:semicolon
r_if
c_cond
(paren
id|byte_list_length
OG
id|buffer_length
)paren
(brace
id|obj_desc-&gt;buffer.length
op_assign
id|byte_list_length
suffix:semicolon
)brace
multiline_comment|/* Allocate the buffer */
r_if
c_cond
(paren
id|obj_desc-&gt;buffer.length
op_eq
l_int|0
)paren
(brace
id|obj_desc-&gt;buffer.pointer
op_assign
l_int|NULL
suffix:semicolon
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_EXEC
comma
l_string|&quot;Buffer defined with zero length in AML, creating&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|obj_desc-&gt;buffer.pointer
op_assign
id|ACPI_MEM_CALLOCATE
(paren
id|obj_desc-&gt;buffer.length
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|obj_desc-&gt;buffer.pointer
)paren
(brace
id|acpi_ut_delete_object_desc
(paren
id|obj_desc
)paren
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|AE_NO_MEMORY
)paren
suffix:semicolon
)brace
multiline_comment|/* Initialize buffer from the byte_list (if present) */
r_if
c_cond
(paren
id|byte_list
)paren
(brace
id|ACPI_MEMCPY
(paren
id|obj_desc-&gt;buffer.pointer
comma
id|byte_list-&gt;named.data
comma
id|byte_list_length
)paren
suffix:semicolon
)brace
)brace
id|obj_desc-&gt;buffer.flags
op_or_assign
id|AOPOBJ_DATA_VALID
suffix:semicolon
id|op-&gt;common.node
op_assign
(paren
r_struct
id|acpi_namespace_node
op_star
)paren
id|obj_desc
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    acpi_ds_build_internal_package_obj&n; *&n; * PARAMETERS:  walk_state      - Current walk state&n; *              Op              - Parser object to be translated&n; *              package_length  - Number of elements in the package&n; *              obj_desc_ptr    - Where the ACPI internal object is returned&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Translate a parser Op package object to the equivalent&n; *              namespace object&n; *&n; ****************************************************************************/
id|acpi_status
DECL|function|acpi_ds_build_internal_package_obj
id|acpi_ds_build_internal_package_obj
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
comma
r_union
id|acpi_parse_object
op_star
id|op
comma
id|u32
id|package_length
comma
r_union
id|acpi_operand_object
op_star
op_star
id|obj_desc_ptr
)paren
(brace
r_union
id|acpi_parse_object
op_star
id|arg
suffix:semicolon
r_union
id|acpi_parse_object
op_star
id|parent
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|obj_desc
op_assign
l_int|NULL
suffix:semicolon
id|u32
id|package_list_length
suffix:semicolon
id|acpi_status
id|status
op_assign
id|AE_OK
suffix:semicolon
id|u32
id|i
suffix:semicolon
id|ACPI_FUNCTION_TRACE
(paren
l_string|&quot;ds_build_internal_package_obj&quot;
)paren
suffix:semicolon
multiline_comment|/* Find the parent of a possibly nested package */
id|parent
op_assign
id|op-&gt;common.parent
suffix:semicolon
r_while
c_loop
(paren
(paren
id|parent-&gt;common.aml_opcode
op_eq
id|AML_PACKAGE_OP
)paren
op_logical_or
(paren
id|parent-&gt;common.aml_opcode
op_eq
id|AML_VAR_PACKAGE_OP
)paren
)paren
(brace
id|parent
op_assign
id|parent-&gt;common.parent
suffix:semicolon
)brace
id|obj_desc
op_assign
op_star
id|obj_desc_ptr
suffix:semicolon
r_if
c_cond
(paren
id|obj_desc
)paren
(brace
multiline_comment|/*&n;&t;&t; * We are evaluating a Named package object &quot;Name (xxxx, Package)&quot;.&n;&t;&t; * Get the existing package object from the NS node&n;&t;&t; */
)brace
r_else
(brace
id|obj_desc
op_assign
id|acpi_ut_create_internal_object
(paren
id|ACPI_TYPE_PACKAGE
)paren
suffix:semicolon
op_star
id|obj_desc_ptr
op_assign
id|obj_desc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|obj_desc
)paren
(brace
id|return_ACPI_STATUS
(paren
id|AE_NO_MEMORY
)paren
suffix:semicolon
)brace
id|obj_desc-&gt;package.node
op_assign
id|parent-&gt;common.node
suffix:semicolon
)brace
id|obj_desc-&gt;package.count
op_assign
id|package_length
suffix:semicolon
multiline_comment|/* Count the number of items in the package list */
id|package_list_length
op_assign
l_int|0
suffix:semicolon
id|arg
op_assign
id|op-&gt;common.value.arg
suffix:semicolon
id|arg
op_assign
id|arg-&gt;common.next
suffix:semicolon
r_while
c_loop
(paren
id|arg
)paren
(brace
id|package_list_length
op_increment
suffix:semicolon
id|arg
op_assign
id|arg-&gt;common.next
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * The package length (number of elements) will be the greater&n;&t; * of the specified length and the length of the initializer list&n;&t; */
r_if
c_cond
(paren
id|package_list_length
OG
id|package_length
)paren
(brace
id|obj_desc-&gt;package.count
op_assign
id|package_list_length
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Allocate the pointer array (array of pointers to the&n;&t; * individual objects). Add an extra pointer slot so&n;&t; * that the list is always null terminated.&n;&t; */
id|obj_desc-&gt;package.elements
op_assign
id|ACPI_MEM_CALLOCATE
(paren
(paren
(paren
id|acpi_size
)paren
id|obj_desc-&gt;package.count
op_plus
l_int|1
)paren
op_star
r_sizeof
(paren
r_void
op_star
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|obj_desc-&gt;package.elements
)paren
(brace
id|acpi_ut_delete_object_desc
(paren
id|obj_desc
)paren
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|AE_NO_MEMORY
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Now init the elements of the package&n;&t; */
id|i
op_assign
l_int|0
suffix:semicolon
id|arg
op_assign
id|op-&gt;common.value.arg
suffix:semicolon
id|arg
op_assign
id|arg-&gt;common.next
suffix:semicolon
r_while
c_loop
(paren
id|arg
)paren
(brace
r_if
c_cond
(paren
id|arg-&gt;common.aml_opcode
op_eq
id|AML_INT_RETURN_VALUE_OP
)paren
(brace
multiline_comment|/* Object (package or buffer) is already built */
id|obj_desc-&gt;package.elements
(braket
id|i
)braket
op_assign
id|ACPI_CAST_PTR
(paren
r_union
id|acpi_operand_object
comma
id|arg-&gt;common.node
)paren
suffix:semicolon
)brace
r_else
(brace
id|status
op_assign
id|acpi_ds_build_internal_object
(paren
id|walk_state
comma
id|arg
comma
op_amp
id|obj_desc-&gt;package.elements
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|i
op_increment
suffix:semicolon
id|arg
op_assign
id|arg-&gt;common.next
suffix:semicolon
)brace
id|obj_desc-&gt;package.flags
op_or_assign
id|AOPOBJ_DATA_VALID
suffix:semicolon
id|op-&gt;common.node
op_assign
(paren
r_struct
id|acpi_namespace_node
op_star
)paren
id|obj_desc
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    acpi_ds_create_node&n; *&n; * PARAMETERS:  walk_state      - Current walk state&n; *              Node            - NS Node to be initialized&n; *              Op              - Parser object to be translated&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Create the object to be associated with a namespace node&n; *&n; ****************************************************************************/
id|acpi_status
DECL|function|acpi_ds_create_node
id|acpi_ds_create_node
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
comma
r_struct
id|acpi_namespace_node
op_star
id|node
comma
r_union
id|acpi_parse_object
op_star
id|op
)paren
(brace
id|acpi_status
id|status
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|obj_desc
suffix:semicolon
id|ACPI_FUNCTION_TRACE_PTR
(paren
l_string|&quot;ds_create_node&quot;
comma
id|op
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Because of the execution pass through the non-control-method&n;&t; * parts of the table, we can arrive here twice.  Only init&n;&t; * the named object node the first time through&n;&t; */
r_if
c_cond
(paren
id|acpi_ns_get_attached_object
(paren
id|node
)paren
)paren
(brace
id|return_ACPI_STATUS
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|op-&gt;common.value.arg
)paren
(brace
multiline_comment|/* No arguments, there is nothing to do */
id|return_ACPI_STATUS
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/* Build an internal object for the argument(s) */
id|status
op_assign
id|acpi_ds_build_internal_object
(paren
id|walk_state
comma
id|op-&gt;common.value.arg
comma
op_amp
id|obj_desc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/* Re-type the object according to its argument */
id|node-&gt;type
op_assign
id|ACPI_GET_OBJECT_TYPE
(paren
id|obj_desc
)paren
suffix:semicolon
multiline_comment|/* Attach obj to node */
id|status
op_assign
id|acpi_ns_attach_object
(paren
id|node
comma
id|obj_desc
comma
id|node-&gt;type
)paren
suffix:semicolon
multiline_comment|/* Remove local reference to the object */
id|acpi_ut_remove_reference
(paren
id|obj_desc
)paren
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
macro_line|#endif /* ACPI_NO_METHOD_EXECUTION */
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    acpi_ds_init_object_from_op&n; *&n; * PARAMETERS:  walk_state      - Current walk state&n; *              Op              - Parser op used to init the internal object&n; *              Opcode          - AML opcode associated with the object&n; *              ret_obj_desc    - Namespace object to be initialized&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Initialize a namespace object from a parser Op and its&n; *              associated arguments.  The namespace object is a more compact&n; *              representation of the Op and its arguments.&n; *&n; ****************************************************************************/
id|acpi_status
DECL|function|acpi_ds_init_object_from_op
id|acpi_ds_init_object_from_op
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
comma
r_union
id|acpi_parse_object
op_star
id|op
comma
id|u16
id|opcode
comma
r_union
id|acpi_operand_object
op_star
op_star
id|ret_obj_desc
)paren
(brace
r_const
r_struct
id|acpi_opcode_info
op_star
id|op_info
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|obj_desc
suffix:semicolon
id|acpi_status
id|status
op_assign
id|AE_OK
suffix:semicolon
id|ACPI_FUNCTION_TRACE
(paren
l_string|&quot;ds_init_object_from_op&quot;
)paren
suffix:semicolon
id|obj_desc
op_assign
op_star
id|ret_obj_desc
suffix:semicolon
id|op_info
op_assign
id|acpi_ps_get_opcode_info
(paren
id|opcode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|op_info
op_member_access_from_pointer
r_class
op_eq
id|AML_CLASS_UNKNOWN
)paren
(brace
multiline_comment|/* Unknown opcode */
id|return_ACPI_STATUS
(paren
id|AE_TYPE
)paren
suffix:semicolon
)brace
multiline_comment|/* Perform per-object initialization */
r_switch
c_cond
(paren
id|ACPI_GET_OBJECT_TYPE
(paren
id|obj_desc
)paren
)paren
(brace
r_case
id|ACPI_TYPE_BUFFER
suffix:colon
multiline_comment|/*&n;&t;&t; * Defer evaluation of Buffer term_arg operand&n;&t;&t; */
id|obj_desc-&gt;buffer.node
op_assign
(paren
r_struct
id|acpi_namespace_node
op_star
)paren
id|walk_state-&gt;operands
(braket
l_int|0
)braket
suffix:semicolon
id|obj_desc-&gt;buffer.aml_start
op_assign
id|op-&gt;named.data
suffix:semicolon
id|obj_desc-&gt;buffer.aml_length
op_assign
id|op-&gt;named.length
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_TYPE_PACKAGE
suffix:colon
multiline_comment|/*&n;&t;&t; * Defer evaluation of Package term_arg operand&n;&t;&t; */
id|obj_desc-&gt;package.node
op_assign
(paren
r_struct
id|acpi_namespace_node
op_star
)paren
id|walk_state-&gt;operands
(braket
l_int|0
)braket
suffix:semicolon
id|obj_desc-&gt;package.aml_start
op_assign
id|op-&gt;named.data
suffix:semicolon
id|obj_desc-&gt;package.aml_length
op_assign
id|op-&gt;named.length
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_TYPE_INTEGER
suffix:colon
r_switch
c_cond
(paren
id|op_info-&gt;type
)paren
(brace
r_case
id|AML_TYPE_CONSTANT
suffix:colon
multiline_comment|/*&n;&t;&t;&t; * Resolve AML Constants here - AND ONLY HERE!&n;&t;&t;&t; * All constants are integers.&n;&t;&t;&t; * We mark the integer with a flag that indicates that it started life&n;&t;&t;&t; * as a constant -- so that stores to constants will perform as expected (noop).&n;&t;&t;&t; * (zero_op is used as a placeholder for optional target operands.)&n;&t;&t;&t; */
id|obj_desc-&gt;common.flags
op_assign
id|AOPOBJ_AML_CONSTANT
suffix:semicolon
r_switch
c_cond
(paren
id|opcode
)paren
(brace
r_case
id|AML_ZERO_OP
suffix:colon
id|obj_desc-&gt;integer.value
op_assign
l_int|0
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AML_ONE_OP
suffix:colon
id|obj_desc-&gt;integer.value
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AML_ONES_OP
suffix:colon
id|obj_desc-&gt;integer.value
op_assign
id|ACPI_INTEGER_MAX
suffix:semicolon
multiline_comment|/* Truncate value if we are executing from a 32-bit ACPI table */
macro_line|#ifndef ACPI_NO_METHOD_EXECUTION
id|acpi_ex_truncate_for32bit_table
(paren
id|obj_desc
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|AML_REVISION_OP
suffix:colon
id|obj_desc-&gt;integer.value
op_assign
id|ACPI_CA_VERSION
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Unknown constant opcode %X&bslash;n&quot;
comma
id|opcode
)paren
)paren
suffix:semicolon
id|status
op_assign
id|AE_AML_OPERAND_TYPE
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AML_TYPE_LITERAL
suffix:colon
id|obj_desc-&gt;integer.value
op_assign
id|op-&gt;common.value.integer
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Unknown Integer type %X&bslash;n&quot;
comma
id|op_info-&gt;type
)paren
)paren
suffix:semicolon
id|status
op_assign
id|AE_AML_OPERAND_TYPE
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ACPI_TYPE_STRING
suffix:colon
id|obj_desc-&gt;string.pointer
op_assign
id|op-&gt;common.value.string
suffix:semicolon
id|obj_desc-&gt;string.length
op_assign
(paren
id|u32
)paren
id|ACPI_STRLEN
(paren
id|op-&gt;common.value.string
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * The string is contained in the ACPI table, don&squot;t ever try&n;&t;&t; * to delete it&n;&t;&t; */
id|obj_desc-&gt;common.flags
op_or_assign
id|AOPOBJ_STATIC_POINTER
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_TYPE_METHOD
suffix:colon
r_break
suffix:semicolon
r_case
id|ACPI_TYPE_LOCAL_REFERENCE
suffix:colon
r_switch
c_cond
(paren
id|op_info-&gt;type
)paren
(brace
r_case
id|AML_TYPE_LOCAL_VARIABLE
suffix:colon
multiline_comment|/* Split the opcode into a base opcode + offset */
id|obj_desc-&gt;reference.opcode
op_assign
id|AML_LOCAL_OP
suffix:semicolon
id|obj_desc-&gt;reference.offset
op_assign
id|opcode
op_minus
id|AML_LOCAL_OP
suffix:semicolon
macro_line|#ifndef ACPI_NO_METHOD_EXECUTION
id|status
op_assign
id|acpi_ds_method_data_get_node
(paren
id|AML_LOCAL_OP
comma
id|obj_desc-&gt;reference.offset
comma
id|walk_state
comma
(paren
r_struct
id|acpi_namespace_node
op_star
op_star
)paren
op_amp
id|obj_desc-&gt;reference.object
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|AML_TYPE_METHOD_ARGUMENT
suffix:colon
multiline_comment|/* Split the opcode into a base opcode + offset */
id|obj_desc-&gt;reference.opcode
op_assign
id|AML_ARG_OP
suffix:semicolon
id|obj_desc-&gt;reference.offset
op_assign
id|opcode
op_minus
id|AML_ARG_OP
suffix:semicolon
macro_line|#ifndef ACPI_NO_METHOD_EXECUTION
id|status
op_assign
id|acpi_ds_method_data_get_node
(paren
id|AML_ARG_OP
comma
id|obj_desc-&gt;reference.offset
comma
id|walk_state
comma
(paren
r_struct
id|acpi_namespace_node
op_star
op_star
)paren
op_amp
id|obj_desc-&gt;reference.object
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
multiline_comment|/* Other literals, etc.. */
r_if
c_cond
(paren
id|op-&gt;common.aml_opcode
op_eq
id|AML_INT_NAMEPATH_OP
)paren
(brace
multiline_comment|/* Node was saved in Op */
id|obj_desc-&gt;reference.node
op_assign
id|op-&gt;common.node
suffix:semicolon
)brace
id|obj_desc-&gt;reference.opcode
op_assign
id|opcode
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Unimplemented data type: %X&bslash;n&quot;
comma
id|ACPI_GET_OBJECT_TYPE
(paren
id|obj_desc
)paren
)paren
)paren
suffix:semicolon
id|status
op_assign
id|AE_AML_OPERAND_TYPE
suffix:semicolon
r_break
suffix:semicolon
)brace
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
eof
