multiline_comment|/******************************************************************************&n; *&n; * Module Name: dswstate - Dispatcher parse tree walk management routines&n; *&n; *****************************************************************************/
multiline_comment|/*&n; * Copyright (C) 2000 - 2003, R. Byron Moore&n; * All rights reserved.&n; *&n; * Redistribution and use in source and binary forms, with or without&n; * modification, are permitted provided that the following conditions&n; * are met:&n; * 1. Redistributions of source code must retain the above copyright&n; *    notice, this list of conditions, and the following disclaimer,&n; *    without modification.&n; * 2. Redistributions in binary form must reproduce at minimum a disclaimer&n; *    substantially similar to the &quot;NO WARRANTY&quot; disclaimer below&n; *    (&quot;Disclaimer&quot;) and any redistribution must be conditioned upon&n; *    including a substantially similar Disclaimer requirement for further&n; *    binary redistribution.&n; * 3. Neither the names of the above-listed copyright holders nor the names&n; *    of any contributors may be used to endorse or promote products derived&n; *    from this software without specific prior written permission.&n; *&n; * Alternatively, this software may be distributed under the terms of the&n; * GNU General Public License (&quot;GPL&quot;) version 2 as published by the Free&n; * Software Foundation.&n; *&n; * NO WARRANTY&n; * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS&n; * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT&n; * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR&n; * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT&n; * HOLDERS OR CONTRIBUTORS BE LIABLE FOR SPECIAL, EXEMPLARY, OR CONSEQUENTIAL&n; * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS&n; * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)&n; * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,&n; * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING&n; * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE&n; * POSSIBILITY OF SUCH DAMAGES.&n; */
macro_line|#include &lt;acpi/acpi.h&gt;
macro_line|#include &lt;acpi/acparser.h&gt;
macro_line|#include &lt;acpi/acdispat.h&gt;
macro_line|#include &lt;acpi/acnamesp.h&gt;
DECL|macro|_COMPONENT
mdefine_line|#define _COMPONENT          ACPI_DISPATCHER
id|ACPI_MODULE_NAME
(paren
l_string|&quot;dswstate&quot;
)paren
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ds_result_insert&n; *&n; * PARAMETERS:  Object              - Object to push&n; *              walk_state          - Current Walk state&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Push an object onto this walk&squot;s result stack&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ds_result_insert
id|acpi_ds_result_insert
(paren
r_void
op_star
id|object
comma
id|u32
id|index
comma
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
r_union
id|acpi_generic_state
op_star
id|state
suffix:semicolon
id|ACPI_FUNCTION_NAME
(paren
l_string|&quot;ds_result_insert&quot;
)paren
suffix:semicolon
id|state
op_assign
id|walk_state-&gt;results
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|state
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;No result object pushed! State=%p&bslash;n&quot;
comma
id|walk_state
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_NOT_EXIST
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|index
op_ge
id|ACPI_OBJ_NUM_OPERANDS
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Index out of range: %X Obj=%p State=%p Num=%X&bslash;n&quot;
comma
id|index
comma
id|object
comma
id|walk_state
comma
id|state-&gt;results.num_results
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_BAD_PARAMETER
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|object
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Null Object! Index=%X Obj=%p State=%p Num=%X&bslash;n&quot;
comma
id|index
comma
id|object
comma
id|walk_state
comma
id|state-&gt;results.num_results
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_BAD_PARAMETER
)paren
suffix:semicolon
)brace
id|state-&gt;results.obj_desc
(braket
id|index
)braket
op_assign
id|object
suffix:semicolon
id|state-&gt;results.num_results
op_increment
suffix:semicolon
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_EXEC
comma
l_string|&quot;Obj=%p [%s] State=%p Num=%X Cur=%X&bslash;n&quot;
comma
id|object
comma
id|object
ques
c_cond
id|acpi_ut_get_object_type_name
(paren
(paren
r_union
id|acpi_operand_object
op_star
)paren
id|object
)paren
suffix:colon
l_string|&quot;NULL&quot;
comma
id|walk_state
comma
id|state-&gt;results.num_results
comma
id|walk_state-&gt;current_result
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ds_result_remove&n; *&n; * PARAMETERS:  Object              - Where to return the popped object&n; *              walk_state          - Current Walk state&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Pop an object off the bottom of this walk&squot;s result stack.  In&n; *              other words, this is a FIFO.&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ds_result_remove
id|acpi_ds_result_remove
(paren
r_union
id|acpi_operand_object
op_star
op_star
id|object
comma
id|u32
id|index
comma
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
r_union
id|acpi_generic_state
op_star
id|state
suffix:semicolon
id|ACPI_FUNCTION_NAME
(paren
l_string|&quot;ds_result_remove&quot;
)paren
suffix:semicolon
id|state
op_assign
id|walk_state-&gt;results
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|state
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;No result object pushed! State=%p&bslash;n&quot;
comma
id|walk_state
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_NOT_EXIST
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|index
op_ge
id|ACPI_OBJ_MAX_OPERAND
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Index out of range: %X State=%p Num=%X&bslash;n&quot;
comma
id|index
comma
id|walk_state
comma
id|state-&gt;results.num_results
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Check for a valid result object */
r_if
c_cond
(paren
op_logical_neg
id|state-&gt;results.obj_desc
(braket
id|index
)braket
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Null operand! State=%p #Ops=%X, Index=%X&bslash;n&quot;
comma
id|walk_state
comma
id|state-&gt;results.num_results
comma
id|index
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_AML_NO_RETURN_VALUE
)paren
suffix:semicolon
)brace
multiline_comment|/* Remove the object */
id|state-&gt;results.num_results
op_decrement
suffix:semicolon
op_star
id|object
op_assign
id|state-&gt;results.obj_desc
(braket
id|index
)braket
suffix:semicolon
id|state-&gt;results.obj_desc
(braket
id|index
)braket
op_assign
l_int|NULL
suffix:semicolon
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_EXEC
comma
l_string|&quot;Obj=%p [%s] Index=%X State=%p Num=%X&bslash;n&quot;
comma
op_star
id|object
comma
(paren
op_star
id|object
)paren
ques
c_cond
id|acpi_ut_get_object_type_name
(paren
op_star
id|object
)paren
suffix:colon
l_string|&quot;NULL&quot;
comma
id|index
comma
id|walk_state
comma
id|state-&gt;results.num_results
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ds_result_pop&n; *&n; * PARAMETERS:  Object              - Where to return the popped object&n; *              walk_state          - Current Walk state&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Pop an object off the bottom of this walk&squot;s result stack.  In&n; *              other words, this is a FIFO.&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ds_result_pop
id|acpi_ds_result_pop
(paren
r_union
id|acpi_operand_object
op_star
op_star
id|object
comma
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
id|acpi_native_uint
id|index
suffix:semicolon
r_union
id|acpi_generic_state
op_star
id|state
suffix:semicolon
id|ACPI_FUNCTION_NAME
(paren
l_string|&quot;ds_result_pop&quot;
)paren
suffix:semicolon
id|state
op_assign
id|walk_state-&gt;results
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|state
)paren
(brace
r_return
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|state-&gt;results.num_results
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Result stack is empty! State=%p&bslash;n&quot;
comma
id|walk_state
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_AML_NO_RETURN_VALUE
)paren
suffix:semicolon
)brace
multiline_comment|/* Remove top element */
id|state-&gt;results.num_results
op_decrement
suffix:semicolon
r_for
c_loop
(paren
id|index
op_assign
id|ACPI_OBJ_NUM_OPERANDS
suffix:semicolon
id|index
suffix:semicolon
id|index
op_decrement
)paren
(brace
multiline_comment|/* Check for a valid result object */
r_if
c_cond
(paren
id|state-&gt;results.obj_desc
(braket
id|index
op_minus
l_int|1
)braket
)paren
(brace
op_star
id|object
op_assign
id|state-&gt;results.obj_desc
(braket
id|index
op_minus
l_int|1
)braket
suffix:semicolon
id|state-&gt;results.obj_desc
(braket
id|index
op_minus
l_int|1
)braket
op_assign
l_int|NULL
suffix:semicolon
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_EXEC
comma
l_string|&quot;Obj=%p [%s] Index=%X State=%p Num=%X&bslash;n&quot;
comma
op_star
id|object
comma
(paren
op_star
id|object
)paren
ques
c_cond
id|acpi_ut_get_object_type_name
(paren
op_star
id|object
)paren
suffix:colon
l_string|&quot;NULL&quot;
comma
(paren
id|u32
)paren
id|index
op_minus
l_int|1
comma
id|walk_state
comma
id|state-&gt;results.num_results
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
)brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;No result objects! State=%p&bslash;n&quot;
comma
id|walk_state
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_AML_NO_RETURN_VALUE
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ds_result_pop_from_bottom&n; *&n; * PARAMETERS:  Object              - Where to return the popped object&n; *              walk_state          - Current Walk state&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Pop an object off the bottom of this walk&squot;s result stack.  In&n; *              other words, this is a FIFO.&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ds_result_pop_from_bottom
id|acpi_ds_result_pop_from_bottom
(paren
r_union
id|acpi_operand_object
op_star
op_star
id|object
comma
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
id|acpi_native_uint
id|index
suffix:semicolon
r_union
id|acpi_generic_state
op_star
id|state
suffix:semicolon
id|ACPI_FUNCTION_NAME
(paren
l_string|&quot;ds_result_pop_from_bottom&quot;
)paren
suffix:semicolon
id|state
op_assign
id|walk_state-&gt;results
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|state
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Warning: No result object pushed! State=%p&bslash;n&quot;
comma
id|walk_state
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_NOT_EXIST
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|state-&gt;results.num_results
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;No result objects! State=%p&bslash;n&quot;
comma
id|walk_state
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_AML_NO_RETURN_VALUE
)paren
suffix:semicolon
)brace
multiline_comment|/* Remove Bottom element */
op_star
id|object
op_assign
id|state-&gt;results.obj_desc
(braket
l_int|0
)braket
suffix:semicolon
multiline_comment|/* Push entire stack down one element */
r_for
c_loop
(paren
id|index
op_assign
l_int|0
suffix:semicolon
id|index
OL
id|state-&gt;results.num_results
suffix:semicolon
id|index
op_increment
)paren
(brace
id|state-&gt;results.obj_desc
(braket
id|index
)braket
op_assign
id|state-&gt;results.obj_desc
(braket
id|index
op_plus
l_int|1
)braket
suffix:semicolon
)brace
id|state-&gt;results.num_results
op_decrement
suffix:semicolon
multiline_comment|/* Check for a valid result object */
r_if
c_cond
(paren
op_logical_neg
op_star
id|object
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Null operand! State=%p #Ops=%X, Index=%X&bslash;n&quot;
comma
id|walk_state
comma
id|state-&gt;results.num_results
comma
(paren
id|u32
)paren
id|index
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_AML_NO_RETURN_VALUE
)paren
suffix:semicolon
)brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_EXEC
comma
l_string|&quot;Obj=%p [%s], Results=%p State=%p&bslash;n&quot;
comma
op_star
id|object
comma
(paren
op_star
id|object
)paren
ques
c_cond
id|acpi_ut_get_object_type_name
(paren
op_star
id|object
)paren
suffix:colon
l_string|&quot;NULL&quot;
comma
id|state
comma
id|walk_state
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ds_result_push&n; *&n; * PARAMETERS:  Object              - Where to return the popped object&n; *              walk_state          - Current Walk state&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Push an object onto the current result stack&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ds_result_push
id|acpi_ds_result_push
(paren
r_union
id|acpi_operand_object
op_star
id|object
comma
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
r_union
id|acpi_generic_state
op_star
id|state
suffix:semicolon
id|ACPI_FUNCTION_NAME
(paren
l_string|&quot;ds_result_push&quot;
)paren
suffix:semicolon
id|state
op_assign
id|walk_state-&gt;results
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|state
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;No result stack frame&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_AML_INTERNAL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|state-&gt;results.num_results
op_eq
id|ACPI_OBJ_NUM_OPERANDS
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Result stack overflow: Obj=%p State=%p Num=%X&bslash;n&quot;
comma
id|object
comma
id|walk_state
comma
id|state-&gt;results.num_results
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_STACK_OVERFLOW
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|object
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Null Object! Obj=%p State=%p Num=%X&bslash;n&quot;
comma
id|object
comma
id|walk_state
comma
id|state-&gt;results.num_results
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_BAD_PARAMETER
)paren
suffix:semicolon
)brace
id|state-&gt;results.obj_desc
(braket
id|state-&gt;results.num_results
)braket
op_assign
id|object
suffix:semicolon
id|state-&gt;results.num_results
op_increment
suffix:semicolon
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_EXEC
comma
l_string|&quot;Obj=%p [%s] State=%p Num=%X Cur=%X&bslash;n&quot;
comma
id|object
comma
id|object
ques
c_cond
id|acpi_ut_get_object_type_name
(paren
(paren
r_union
id|acpi_operand_object
op_star
)paren
id|object
)paren
suffix:colon
l_string|&quot;NULL&quot;
comma
id|walk_state
comma
id|state-&gt;results.num_results
comma
id|walk_state-&gt;current_result
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ds_result_stack_push&n; *&n; * PARAMETERS:  Object              - Object to push&n; *              walk_state          - Current Walk state&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Push an object onto the walk_state result stack.&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ds_result_stack_push
id|acpi_ds_result_stack_push
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
r_union
id|acpi_generic_state
op_star
id|state
suffix:semicolon
id|ACPI_FUNCTION_NAME
(paren
l_string|&quot;ds_result_stack_push&quot;
)paren
suffix:semicolon
id|state
op_assign
id|acpi_ut_create_generic_state
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|state
)paren
(brace
r_return
(paren
id|AE_NO_MEMORY
)paren
suffix:semicolon
)brace
id|state-&gt;common.data_type
op_assign
id|ACPI_DESC_TYPE_STATE_RESULT
suffix:semicolon
id|acpi_ut_push_generic_state
(paren
op_amp
id|walk_state-&gt;results
comma
id|state
)paren
suffix:semicolon
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_EXEC
comma
l_string|&quot;Results=%p State=%p&bslash;n&quot;
comma
id|state
comma
id|walk_state
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ds_result_stack_pop&n; *&n; * PARAMETERS:  walk_state          - Current Walk state&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Pop an object off of the walk_state result stack.&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ds_result_stack_pop
id|acpi_ds_result_stack_pop
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
r_union
id|acpi_generic_state
op_star
id|state
suffix:semicolon
id|ACPI_FUNCTION_NAME
(paren
l_string|&quot;ds_result_stack_pop&quot;
)paren
suffix:semicolon
multiline_comment|/* Check for stack underflow */
r_if
c_cond
(paren
id|walk_state-&gt;results
op_eq
l_int|NULL
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_EXEC
comma
l_string|&quot;Underflow - State=%p&bslash;n&quot;
comma
id|walk_state
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_AML_NO_OPERAND
)paren
suffix:semicolon
)brace
id|state
op_assign
id|acpi_ut_pop_generic_state
(paren
op_amp
id|walk_state-&gt;results
)paren
suffix:semicolon
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_EXEC
comma
l_string|&quot;Result=%p remaining_results=%X State=%p&bslash;n&quot;
comma
id|state
comma
id|state-&gt;results.num_results
comma
id|walk_state
)paren
)paren
suffix:semicolon
id|acpi_ut_delete_generic_state
(paren
id|state
)paren
suffix:semicolon
r_return
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ds_obj_stack_delete_all&n; *&n; * PARAMETERS:  walk_state          - Current Walk state&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Clear the object stack by deleting all objects that are on it.&n; *              Should be used with great care, if at all!&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ds_obj_stack_delete_all
id|acpi_ds_obj_stack_delete_all
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
id|u32
id|i
suffix:semicolon
id|ACPI_FUNCTION_TRACE_PTR
(paren
l_string|&quot;ds_obj_stack_delete_all&quot;
comma
id|walk_state
)paren
suffix:semicolon
multiline_comment|/* The stack size is configurable, but fixed */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ACPI_OBJ_NUM_OPERANDS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|walk_state-&gt;operands
(braket
id|i
)braket
)paren
(brace
id|acpi_ut_remove_reference
(paren
id|walk_state-&gt;operands
(braket
id|i
)braket
)paren
suffix:semicolon
id|walk_state-&gt;operands
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|return_ACPI_STATUS
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ds_obj_stack_push&n; *&n; * PARAMETERS:  Object              - Object to push&n; *              walk_state          - Current Walk state&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Push an object onto this walk&squot;s object/operand stack&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ds_obj_stack_push
id|acpi_ds_obj_stack_push
(paren
r_void
op_star
id|object
comma
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
id|ACPI_FUNCTION_NAME
(paren
l_string|&quot;ds_obj_stack_push&quot;
)paren
suffix:semicolon
multiline_comment|/* Check for stack overflow */
r_if
c_cond
(paren
id|walk_state-&gt;num_operands
op_ge
id|ACPI_OBJ_NUM_OPERANDS
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;overflow! Obj=%p State=%p #Ops=%X&bslash;n&quot;
comma
id|object
comma
id|walk_state
comma
id|walk_state-&gt;num_operands
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_STACK_OVERFLOW
)paren
suffix:semicolon
)brace
multiline_comment|/* Put the object onto the stack */
id|walk_state-&gt;operands
(braket
id|walk_state-&gt;num_operands
)braket
op_assign
id|object
suffix:semicolon
id|walk_state-&gt;num_operands
op_increment
suffix:semicolon
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_EXEC
comma
l_string|&quot;Obj=%p [%s] State=%p #Ops=%X&bslash;n&quot;
comma
id|object
comma
id|acpi_ut_get_object_type_name
(paren
(paren
r_union
id|acpi_operand_object
op_star
)paren
id|object
)paren
comma
id|walk_state
comma
id|walk_state-&gt;num_operands
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
macro_line|#if 0
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ds_obj_stack_pop_object&n; *&n; * PARAMETERS:  pop_count           - Number of objects/entries to pop&n; *              walk_state          - Current Walk state&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Pop this walk&squot;s object stack.  Objects on the stack are NOT&n; *              deleted by this routine.&n; *&n; ******************************************************************************/
id|acpi_status
id|acpi_ds_obj_stack_pop_object
(paren
r_union
id|acpi_operand_object
op_star
op_star
id|object
comma
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
id|ACPI_FUNCTION_NAME
(paren
l_string|&quot;ds_obj_stack_pop_object&quot;
)paren
suffix:semicolon
multiline_comment|/* Check for stack underflow */
r_if
c_cond
(paren
id|walk_state-&gt;num_operands
op_eq
l_int|0
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Missing operand/stack empty! State=%p #Ops=%X&bslash;n&quot;
comma
id|walk_state
comma
id|walk_state-&gt;num_operands
)paren
)paren
suffix:semicolon
op_star
id|object
op_assign
l_int|NULL
suffix:semicolon
r_return
(paren
id|AE_AML_NO_OPERAND
)paren
suffix:semicolon
)brace
multiline_comment|/* Pop the stack */
id|walk_state-&gt;num_operands
op_decrement
suffix:semicolon
multiline_comment|/* Check for a valid operand */
r_if
c_cond
(paren
op_logical_neg
id|walk_state-&gt;operands
(braket
id|walk_state-&gt;num_operands
)braket
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Null operand! State=%p #Ops=%X&bslash;n&quot;
comma
id|walk_state
comma
id|walk_state-&gt;num_operands
)paren
)paren
suffix:semicolon
op_star
id|object
op_assign
l_int|NULL
suffix:semicolon
r_return
(paren
id|AE_AML_NO_OPERAND
)paren
suffix:semicolon
)brace
multiline_comment|/* Get operand and set stack entry to null */
op_star
id|object
op_assign
id|walk_state-&gt;operands
(braket
id|walk_state-&gt;num_operands
)braket
suffix:semicolon
id|walk_state-&gt;operands
(braket
id|walk_state-&gt;num_operands
)braket
op_assign
l_int|NULL
suffix:semicolon
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_EXEC
comma
l_string|&quot;Obj=%p [%s] State=%p #Ops=%X&bslash;n&quot;
comma
op_star
id|object
comma
id|acpi_ut_get_object_type_name
(paren
op_star
id|object
)paren
comma
id|walk_state
comma
id|walk_state-&gt;num_operands
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ds_obj_stack_pop&n; *&n; * PARAMETERS:  pop_count           - Number of objects/entries to pop&n; *              walk_state          - Current Walk state&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Pop this walk&squot;s object stack.  Objects on the stack are NOT&n; *              deleted by this routine.&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ds_obj_stack_pop
id|acpi_ds_obj_stack_pop
(paren
id|u32
id|pop_count
comma
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
id|u32
id|i
suffix:semicolon
id|ACPI_FUNCTION_NAME
(paren
l_string|&quot;ds_obj_stack_pop&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pop_count
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Check for stack underflow */
r_if
c_cond
(paren
id|walk_state-&gt;num_operands
op_eq
l_int|0
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Underflow! Count=%X State=%p #Ops=%X&bslash;n&quot;
comma
id|pop_count
comma
id|walk_state
comma
id|walk_state-&gt;num_operands
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_STACK_UNDERFLOW
)paren
suffix:semicolon
)brace
multiline_comment|/* Just set the stack entry to null */
id|walk_state-&gt;num_operands
op_decrement
suffix:semicolon
id|walk_state-&gt;operands
(braket
id|walk_state-&gt;num_operands
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_EXEC
comma
l_string|&quot;Count=%X State=%p #Ops=%X&bslash;n&quot;
comma
id|pop_count
comma
id|walk_state
comma
id|walk_state-&gt;num_operands
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ds_obj_stack_pop_and_delete&n; *&n; * PARAMETERS:  pop_count           - Number of objects/entries to pop&n; *              walk_state          - Current Walk state&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Pop this walk&squot;s object stack and delete each object that is&n; *              popped off.&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ds_obj_stack_pop_and_delete
id|acpi_ds_obj_stack_pop_and_delete
(paren
id|u32
id|pop_count
comma
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
id|u32
id|i
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|obj_desc
suffix:semicolon
id|ACPI_FUNCTION_NAME
(paren
l_string|&quot;ds_obj_stack_pop_and_delete&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|pop_count
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Check for stack underflow */
r_if
c_cond
(paren
id|walk_state-&gt;num_operands
op_eq
l_int|0
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Underflow! Count=%X State=%p #Ops=%X&bslash;n&quot;
comma
id|pop_count
comma
id|walk_state
comma
id|walk_state-&gt;num_operands
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_STACK_UNDERFLOW
)paren
suffix:semicolon
)brace
multiline_comment|/* Pop the stack and delete an object if present in this stack entry */
id|walk_state-&gt;num_operands
op_decrement
suffix:semicolon
id|obj_desc
op_assign
id|walk_state-&gt;operands
(braket
id|walk_state-&gt;num_operands
)braket
suffix:semicolon
r_if
c_cond
(paren
id|obj_desc
)paren
(brace
id|acpi_ut_remove_reference
(paren
id|walk_state-&gt;operands
(braket
id|walk_state-&gt;num_operands
)braket
)paren
suffix:semicolon
id|walk_state-&gt;operands
(braket
id|walk_state-&gt;num_operands
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
)brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_EXEC
comma
l_string|&quot;Count=%X State=%p #Ops=%X&bslash;n&quot;
comma
id|pop_count
comma
id|walk_state
comma
id|walk_state-&gt;num_operands
)paren
)paren
suffix:semicolon
r_return
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ds_obj_stack_get_value&n; *&n; * PARAMETERS:  Index               - Stack index whose value is desired.  Based&n; *                                    on the top of the stack (index=0 == top)&n; *              walk_state          - Current Walk state&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Retrieve an object from this walk&squot;s object stack.  Index must&n; *              be within the range of the current stack pointer.&n; *&n; ******************************************************************************/
r_void
op_star
DECL|function|acpi_ds_obj_stack_get_value
id|acpi_ds_obj_stack_get_value
(paren
id|u32
id|index
comma
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
id|ACPI_FUNCTION_TRACE_PTR
(paren
l_string|&quot;ds_obj_stack_get_value&quot;
comma
id|walk_state
)paren
suffix:semicolon
multiline_comment|/* Can&squot;t do it if the stack is empty */
r_if
c_cond
(paren
id|walk_state-&gt;num_operands
op_eq
l_int|0
)paren
(brace
id|return_PTR
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/* or if the index is past the top of the stack */
r_if
c_cond
(paren
id|index
OG
(paren
id|walk_state-&gt;num_operands
op_minus
(paren
id|u32
)paren
l_int|1
)paren
)paren
(brace
id|return_PTR
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
id|return_PTR
(paren
id|walk_state-&gt;operands
(braket
(paren
id|acpi_native_uint
)paren
(paren
id|walk_state-&gt;num_operands
op_minus
l_int|1
)paren
op_minus
id|index
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ds_get_current_walk_state&n; *&n; * PARAMETERS:  Thread          - Get current active state for this Thread&n; *&n; * RETURN:      Pointer to the current walk state&n; *&n; * DESCRIPTION: Get the walk state that is at the head of the list (the &quot;current&quot;&n; *              walk state.)&n; *&n; ******************************************************************************/
r_struct
id|acpi_walk_state
op_star
DECL|function|acpi_ds_get_current_walk_state
id|acpi_ds_get_current_walk_state
(paren
r_struct
id|acpi_thread_state
op_star
id|thread
)paren
(brace
id|ACPI_FUNCTION_NAME
(paren
l_string|&quot;ds_get_current_walk_state&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|thread
)paren
(brace
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_PARSE
comma
l_string|&quot;Current walk_state %p&bslash;n&quot;
comma
id|thread-&gt;walk_state_list
)paren
)paren
suffix:semicolon
r_return
(paren
id|thread-&gt;walk_state_list
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ds_push_walk_state&n; *&n; * PARAMETERS:  walk_state      - State to push&n; *              walk_list       - The list that owns the walk stack&n; *&n; * RETURN:      None&n; *&n; * DESCRIPTION: Place the walk_state at the head of the state list.&n; *&n; ******************************************************************************/
r_void
DECL|function|acpi_ds_push_walk_state
id|acpi_ds_push_walk_state
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
comma
r_struct
id|acpi_thread_state
op_star
id|thread
)paren
(brace
id|ACPI_FUNCTION_TRACE
(paren
l_string|&quot;ds_push_walk_state&quot;
)paren
suffix:semicolon
id|walk_state-&gt;next
op_assign
id|thread-&gt;walk_state_list
suffix:semicolon
id|thread-&gt;walk_state_list
op_assign
id|walk_state
suffix:semicolon
id|return_VOID
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ds_pop_walk_state&n; *&n; * PARAMETERS:  walk_list       - The list that owns the walk stack&n; *&n; * RETURN:      A walk_state object popped from the stack&n; *&n; * DESCRIPTION: Remove and return the walkstate object that is at the head of&n; *              the walk stack for the given walk list.  NULL indicates that&n; *              the list is empty.&n; *&n; ******************************************************************************/
r_struct
id|acpi_walk_state
op_star
DECL|function|acpi_ds_pop_walk_state
id|acpi_ds_pop_walk_state
(paren
r_struct
id|acpi_thread_state
op_star
id|thread
)paren
(brace
r_struct
id|acpi_walk_state
op_star
id|walk_state
suffix:semicolon
id|ACPI_FUNCTION_TRACE
(paren
l_string|&quot;ds_pop_walk_state&quot;
)paren
suffix:semicolon
id|walk_state
op_assign
id|thread-&gt;walk_state_list
suffix:semicolon
r_if
c_cond
(paren
id|walk_state
)paren
(brace
multiline_comment|/* Next walk state becomes the current walk state */
id|thread-&gt;walk_state_list
op_assign
id|walk_state-&gt;next
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Don&squot;t clear the NEXT field, this serves as an indicator&n;&t;&t; * that there is a parent WALK STATE&n;&t;&t; *     NO: walk_state-&gt;Next = NULL;&n;&t;&t; */
)brace
id|return_PTR
(paren
id|walk_state
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ds_create_walk_state&n; *&n; * PARAMETERS:  Origin          - Starting point for this walk&n; *              Thread          - Current thread state&n; *&n; * RETURN:      Pointer to the new walk state.&n; *&n; * DESCRIPTION: Allocate and initialize a new walk state.  The current walk&n; *              state is set to this new state.&n; *&n; ******************************************************************************/
r_struct
id|acpi_walk_state
op_star
DECL|function|acpi_ds_create_walk_state
id|acpi_ds_create_walk_state
(paren
id|acpi_owner_id
id|owner_id
comma
r_union
id|acpi_parse_object
op_star
id|origin
comma
r_union
id|acpi_operand_object
op_star
id|mth_desc
comma
r_struct
id|acpi_thread_state
op_star
id|thread
)paren
(brace
r_struct
id|acpi_walk_state
op_star
id|walk_state
suffix:semicolon
id|acpi_status
id|status
suffix:semicolon
id|ACPI_FUNCTION_TRACE
(paren
l_string|&quot;ds_create_walk_state&quot;
)paren
suffix:semicolon
id|walk_state
op_assign
id|acpi_ut_acquire_from_cache
(paren
id|ACPI_MEM_LIST_WALK
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|walk_state
)paren
(brace
id|return_PTR
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
id|walk_state-&gt;data_type
op_assign
id|ACPI_DESC_TYPE_WALK
suffix:semicolon
id|walk_state-&gt;owner_id
op_assign
id|owner_id
suffix:semicolon
id|walk_state-&gt;origin
op_assign
id|origin
suffix:semicolon
id|walk_state-&gt;method_desc
op_assign
id|mth_desc
suffix:semicolon
id|walk_state-&gt;thread
op_assign
id|thread
suffix:semicolon
id|walk_state-&gt;parser_state.start_op
op_assign
id|origin
suffix:semicolon
multiline_comment|/* Init the method args/local */
macro_line|#if (!defined (ACPI_NO_METHOD_EXECUTION) &amp;&amp; !defined (ACPI_CONSTANT_EVAL_ONLY))
id|acpi_ds_method_data_init
(paren
id|walk_state
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* Create an initial result stack entry */
id|status
op_assign
id|acpi_ds_result_stack_push
(paren
id|walk_state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
id|return_PTR
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/* Put the new state at the head of the walk list */
r_if
c_cond
(paren
id|thread
)paren
(brace
id|acpi_ds_push_walk_state
(paren
id|walk_state
comma
id|thread
)paren
suffix:semicolon
)brace
id|return_PTR
(paren
id|walk_state
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ds_init_aml_walk&n; *&n; * PARAMETERS:  walk_state      - New state to be initialized&n; *&n; * RETURN:      None&n; *&n; * DESCRIPTION: Initialize a walk state for a pass 1 or 2 parse tree walk&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ds_init_aml_walk
id|acpi_ds_init_aml_walk
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
comma
r_union
id|acpi_parse_object
op_star
id|op
comma
r_struct
id|acpi_namespace_node
op_star
id|method_node
comma
id|u8
op_star
id|aml_start
comma
id|u32
id|aml_length
comma
r_union
id|acpi_operand_object
op_star
op_star
id|params
comma
r_union
id|acpi_operand_object
op_star
op_star
id|return_obj_desc
comma
id|u32
id|pass_number
)paren
(brace
id|acpi_status
id|status
suffix:semicolon
r_struct
id|acpi_parse_state
op_star
id|parser_state
op_assign
op_amp
id|walk_state-&gt;parser_state
suffix:semicolon
r_union
id|acpi_parse_object
op_star
id|extra_op
suffix:semicolon
id|ACPI_FUNCTION_TRACE
(paren
l_string|&quot;ds_init_aml_walk&quot;
)paren
suffix:semicolon
id|walk_state-&gt;parser_state.aml
op_assign
id|walk_state-&gt;parser_state.aml_start
op_assign
id|aml_start
suffix:semicolon
id|walk_state-&gt;parser_state.aml_end
op_assign
id|walk_state-&gt;parser_state.pkg_end
op_assign
id|aml_start
op_plus
id|aml_length
suffix:semicolon
multiline_comment|/* The next_op of the next_walk will be the beginning of the method */
id|walk_state-&gt;next_op
op_assign
l_int|NULL
suffix:semicolon
id|walk_state-&gt;params
op_assign
id|params
suffix:semicolon
id|walk_state-&gt;caller_return_desc
op_assign
id|return_obj_desc
suffix:semicolon
id|status
op_assign
id|acpi_ps_init_scope
(paren
op_amp
id|walk_state-&gt;parser_state
comma
id|op
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|method_node
)paren
(brace
id|walk_state-&gt;parser_state.start_node
op_assign
id|method_node
suffix:semicolon
id|walk_state-&gt;walk_type
op_assign
id|ACPI_WALK_METHOD
suffix:semicolon
id|walk_state-&gt;method_node
op_assign
id|method_node
suffix:semicolon
id|walk_state-&gt;method_desc
op_assign
id|acpi_ns_get_attached_object
(paren
id|method_node
)paren
suffix:semicolon
multiline_comment|/* Push start scope on scope stack and make it current  */
id|status
op_assign
id|acpi_ds_scope_stack_push
(paren
id|method_node
comma
id|ACPI_TYPE_METHOD
comma
id|walk_state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/* Init the method arguments */
id|status
op_assign
id|acpi_ds_method_data_init_args
(paren
id|params
comma
id|ACPI_METHOD_NUM_ARGS
comma
id|walk_state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t; * Setup the current scope.&n;&t;&t; * Find a Named Op that has a namespace node associated with it.&n;&t;&t; * search upwards from this Op.  Current scope is the first&n;&t;&t; * Op with a namespace node.&n;&t;&t; */
id|extra_op
op_assign
id|parser_state-&gt;start_op
suffix:semicolon
r_while
c_loop
(paren
id|extra_op
op_logical_and
op_logical_neg
id|extra_op-&gt;common.node
)paren
(brace
id|extra_op
op_assign
id|extra_op-&gt;common.parent
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|extra_op
)paren
(brace
id|parser_state-&gt;start_node
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|parser_state-&gt;start_node
op_assign
id|extra_op-&gt;common.node
suffix:semicolon
)brace
r_if
c_cond
(paren
id|parser_state-&gt;start_node
)paren
(brace
multiline_comment|/* Push start scope on scope stack and make it current  */
id|status
op_assign
id|acpi_ds_scope_stack_push
(paren
id|parser_state-&gt;start_node
comma
id|parser_state-&gt;start_node-&gt;type
comma
id|walk_state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
)brace
)brace
id|status
op_assign
id|acpi_ds_init_callbacks
(paren
id|walk_state
comma
id|pass_number
)paren
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ds_delete_walk_state&n; *&n; * PARAMETERS:  walk_state      - State to delete&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Delete a walk state including all internal data structures&n; *&n; ******************************************************************************/
r_void
DECL|function|acpi_ds_delete_walk_state
id|acpi_ds_delete_walk_state
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
r_union
id|acpi_generic_state
op_star
id|state
suffix:semicolon
id|ACPI_FUNCTION_TRACE_PTR
(paren
l_string|&quot;ds_delete_walk_state&quot;
comma
id|walk_state
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|walk_state
)paren
(brace
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|walk_state-&gt;data_type
op_ne
id|ACPI_DESC_TYPE_WALK
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;%p is not a valid walk state&bslash;n&quot;
comma
id|walk_state
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|walk_state-&gt;parser_state.scope
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;%p walk still has a scope list&bslash;n&quot;
comma
id|walk_state
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Always must free any linked control states */
r_while
c_loop
(paren
id|walk_state-&gt;control_state
)paren
(brace
id|state
op_assign
id|walk_state-&gt;control_state
suffix:semicolon
id|walk_state-&gt;control_state
op_assign
id|state-&gt;common.next
suffix:semicolon
id|acpi_ut_delete_generic_state
(paren
id|state
)paren
suffix:semicolon
)brace
multiline_comment|/* Always must free any linked parse states */
r_while
c_loop
(paren
id|walk_state-&gt;scope_info
)paren
(brace
id|state
op_assign
id|walk_state-&gt;scope_info
suffix:semicolon
id|walk_state-&gt;scope_info
op_assign
id|state-&gt;common.next
suffix:semicolon
id|acpi_ut_delete_generic_state
(paren
id|state
)paren
suffix:semicolon
)brace
multiline_comment|/* Always must free any stacked result states */
r_while
c_loop
(paren
id|walk_state-&gt;results
)paren
(brace
id|state
op_assign
id|walk_state-&gt;results
suffix:semicolon
id|walk_state-&gt;results
op_assign
id|state-&gt;common.next
suffix:semicolon
id|acpi_ut_delete_generic_state
(paren
id|state
)paren
suffix:semicolon
)brace
id|acpi_ut_release_to_cache
(paren
id|ACPI_MEM_LIST_WALK
comma
id|walk_state
)paren
suffix:semicolon
id|return_VOID
suffix:semicolon
)brace
multiline_comment|/******************************************************************************&n; *&n; * FUNCTION:    acpi_ds_delete_walk_state_cache&n; *&n; * PARAMETERS:  None&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Purge the global state object cache.  Used during subsystem&n; *              termination.&n; *&n; ******************************************************************************/
r_void
DECL|function|acpi_ds_delete_walk_state_cache
id|acpi_ds_delete_walk_state_cache
(paren
r_void
)paren
(brace
id|ACPI_FUNCTION_TRACE
(paren
l_string|&quot;ds_delete_walk_state_cache&quot;
)paren
suffix:semicolon
id|acpi_ut_delete_generic_cache
(paren
id|ACPI_MEM_LIST_WALK
)paren
suffix:semicolon
id|return_VOID
suffix:semicolon
)brace
eof
