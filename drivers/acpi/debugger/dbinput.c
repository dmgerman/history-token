multiline_comment|/*******************************************************************************&n; *&n; * Module Name: dbinput - user front-end to the AML debugger&n; *              $Revision: 68 $&n; *&n; ******************************************************************************/
multiline_comment|/*&n; *  Copyright (C) 2000, 2001 R. Byron Moore&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or&n; *  (at your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; */
macro_line|#include &quot;acpi.h&quot;
macro_line|#include &quot;acparser.h&quot;
macro_line|#include &quot;actables.h&quot;
macro_line|#include &quot;acnamesp.h&quot;
macro_line|#include &quot;acinterp.h&quot;
macro_line|#include &quot;acdebug.h&quot;
macro_line|#ifdef ENABLE_DEBUGGER
DECL|macro|_COMPONENT
mdefine_line|#define _COMPONENT          ACPI_DEBUGGER
id|MODULE_NAME
(paren
l_string|&quot;dbinput&quot;
)paren
multiline_comment|/*&n; * Globals that are specific to the debugger&n; */
DECL|variable|acpi_gbl_db_line_buf
id|NATIVE_CHAR
id|acpi_gbl_db_line_buf
(braket
l_int|80
)braket
suffix:semicolon
DECL|variable|acpi_gbl_db_parsed_buf
id|NATIVE_CHAR
id|acpi_gbl_db_parsed_buf
(braket
l_int|80
)braket
suffix:semicolon
DECL|variable|acpi_gbl_db_scope_buf
id|NATIVE_CHAR
id|acpi_gbl_db_scope_buf
(braket
l_int|40
)braket
suffix:semicolon
DECL|variable|acpi_gbl_db_debug_filename
id|NATIVE_CHAR
id|acpi_gbl_db_debug_filename
(braket
l_int|40
)braket
suffix:semicolon
DECL|variable|acpi_gbl_db_args
id|NATIVE_CHAR
op_star
id|acpi_gbl_db_args
(braket
id|DB_MAX_ARGS
)braket
suffix:semicolon
DECL|variable|acpi_gbl_db_buffer
id|NATIVE_CHAR
op_star
id|acpi_gbl_db_buffer
suffix:semicolon
DECL|variable|acpi_gbl_db_filename
id|NATIVE_CHAR
op_star
id|acpi_gbl_db_filename
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|acpi_gbl_db_output_to_file
id|u8
id|acpi_gbl_db_output_to_file
op_assign
id|FALSE
suffix:semicolon
DECL|variable|acpi_gbl_db_debug_level
id|u32
id|acpi_gbl_db_debug_level
op_assign
id|ACPI_LV_VERBOSITY2
suffix:semicolon
DECL|variable|acpi_gbl_db_console_debug_level
id|u32
id|acpi_gbl_db_console_debug_level
op_assign
id|NORMAL_DEFAULT
op_or
id|ACPI_LV_TABLES
suffix:semicolon
DECL|variable|acpi_gbl_db_output_flags
id|u8
id|acpi_gbl_db_output_flags
op_assign
id|DB_CONSOLE_OUTPUT
suffix:semicolon
DECL|variable|acpi_gbl_db_opt_tables
id|u8
id|acpi_gbl_db_opt_tables
op_assign
id|FALSE
suffix:semicolon
DECL|variable|acpi_gbl_db_opt_disasm
id|u8
id|acpi_gbl_db_opt_disasm
op_assign
id|FALSE
suffix:semicolon
DECL|variable|acpi_gbl_db_opt_stats
id|u8
id|acpi_gbl_db_opt_stats
op_assign
id|FALSE
suffix:semicolon
DECL|variable|acpi_gbl_db_opt_parse_jit
id|u8
id|acpi_gbl_db_opt_parse_jit
op_assign
id|FALSE
suffix:semicolon
DECL|variable|acpi_gbl_db_opt_verbose
id|u8
id|acpi_gbl_db_opt_verbose
op_assign
id|TRUE
suffix:semicolon
DECL|variable|acpi_gbl_db_opt_ini_methods
id|u8
id|acpi_gbl_db_opt_ini_methods
op_assign
id|TRUE
suffix:semicolon
multiline_comment|/*&n; * Statistic globals&n; */
DECL|variable|acpi_gbl_obj_type_count
id|u16
id|acpi_gbl_obj_type_count
(braket
id|INTERNAL_TYPE_NODE_MAX
op_plus
l_int|1
)braket
suffix:semicolon
DECL|variable|acpi_gbl_node_type_count
id|u16
id|acpi_gbl_node_type_count
(braket
id|INTERNAL_TYPE_NODE_MAX
op_plus
l_int|1
)braket
suffix:semicolon
DECL|variable|acpi_gbl_obj_type_count_misc
id|u16
id|acpi_gbl_obj_type_count_misc
suffix:semicolon
DECL|variable|acpi_gbl_node_type_count_misc
id|u16
id|acpi_gbl_node_type_count_misc
suffix:semicolon
DECL|variable|acpi_gbl_num_nodes
id|u32
id|acpi_gbl_num_nodes
suffix:semicolon
DECL|variable|acpi_gbl_num_objects
id|u32
id|acpi_gbl_num_objects
suffix:semicolon
DECL|variable|acpi_gbl_size_of_parse_tree
id|u32
id|acpi_gbl_size_of_parse_tree
suffix:semicolon
DECL|variable|acpi_gbl_size_of_method_trees
id|u32
id|acpi_gbl_size_of_method_trees
suffix:semicolon
DECL|variable|acpi_gbl_size_of_node_entries
id|u32
id|acpi_gbl_size_of_node_entries
suffix:semicolon
DECL|variable|acpi_gbl_size_of_acpi_objects
id|u32
id|acpi_gbl_size_of_acpi_objects
suffix:semicolon
multiline_comment|/*&n; * Top-level debugger commands.&n; *&n; * This list of commands must match the string table below it&n; */
DECL|enum|acpi_ex_debugger_commands
r_enum
id|acpi_ex_debugger_commands
(brace
DECL|enumerator|CMD_NOT_FOUND
id|CMD_NOT_FOUND
op_assign
l_int|0
comma
DECL|enumerator|CMD_NULL
id|CMD_NULL
comma
DECL|enumerator|CMD_ALLOCATIONS
id|CMD_ALLOCATIONS
comma
DECL|enumerator|CMD_ARGS
id|CMD_ARGS
comma
DECL|enumerator|CMD_ARGUMENTS
id|CMD_ARGUMENTS
comma
DECL|enumerator|CMD_BREAKPOINT
id|CMD_BREAKPOINT
comma
DECL|enumerator|CMD_CALL
id|CMD_CALL
comma
DECL|enumerator|CMD_CLOSE
id|CMD_CLOSE
comma
DECL|enumerator|CMD_DEBUG
id|CMD_DEBUG
comma
DECL|enumerator|CMD_DUMP
id|CMD_DUMP
comma
DECL|enumerator|CMD_ENABLEACPI
id|CMD_ENABLEACPI
comma
DECL|enumerator|CMD_EVENT
id|CMD_EVENT
comma
DECL|enumerator|CMD_EXECUTE
id|CMD_EXECUTE
comma
DECL|enumerator|CMD_EXIT
id|CMD_EXIT
comma
DECL|enumerator|CMD_FIND
id|CMD_FIND
comma
DECL|enumerator|CMD_GO
id|CMD_GO
comma
DECL|enumerator|CMD_HELP
id|CMD_HELP
comma
DECL|enumerator|CMD_HELP2
id|CMD_HELP2
comma
DECL|enumerator|CMD_HISTORY
id|CMD_HISTORY
comma
DECL|enumerator|CMD_HISTORY_EXE
id|CMD_HISTORY_EXE
comma
DECL|enumerator|CMD_HISTORY_LAST
id|CMD_HISTORY_LAST
comma
DECL|enumerator|CMD_INFORMATION
id|CMD_INFORMATION
comma
DECL|enumerator|CMD_INTO
id|CMD_INTO
comma
DECL|enumerator|CMD_LEVEL
id|CMD_LEVEL
comma
DECL|enumerator|CMD_LIST
id|CMD_LIST
comma
DECL|enumerator|CMD_LOAD
id|CMD_LOAD
comma
DECL|enumerator|CMD_LOCALS
id|CMD_LOCALS
comma
DECL|enumerator|CMD_LOCKS
id|CMD_LOCKS
comma
DECL|enumerator|CMD_METHODS
id|CMD_METHODS
comma
DECL|enumerator|CMD_NAMESPACE
id|CMD_NAMESPACE
comma
DECL|enumerator|CMD_NOTIFY
id|CMD_NOTIFY
comma
DECL|enumerator|CMD_OBJECT
id|CMD_OBJECT
comma
DECL|enumerator|CMD_OPEN
id|CMD_OPEN
comma
DECL|enumerator|CMD_OWNER
id|CMD_OWNER
comma
DECL|enumerator|CMD_PREFIX
id|CMD_PREFIX
comma
DECL|enumerator|CMD_QUIT
id|CMD_QUIT
comma
DECL|enumerator|CMD_REFERENCES
id|CMD_REFERENCES
comma
DECL|enumerator|CMD_RESOURCES
id|CMD_RESOURCES
comma
DECL|enumerator|CMD_RESULTS
id|CMD_RESULTS
comma
DECL|enumerator|CMD_SET
id|CMD_SET
comma
DECL|enumerator|CMD_STATS
id|CMD_STATS
comma
DECL|enumerator|CMD_STOP
id|CMD_STOP
comma
DECL|enumerator|CMD_TABLES
id|CMD_TABLES
comma
DECL|enumerator|CMD_TERMINATE
id|CMD_TERMINATE
comma
DECL|enumerator|CMD_THREADS
id|CMD_THREADS
comma
DECL|enumerator|CMD_TREE
id|CMD_TREE
comma
DECL|enumerator|CMD_UNLOAD
id|CMD_UNLOAD
)brace
suffix:semicolon
DECL|macro|CMD_FIRST_VALID
mdefine_line|#define CMD_FIRST_VALID     2
DECL|variable|acpi_gbl_db_commands
r_const
id|COMMAND_INFO
id|acpi_gbl_db_commands
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;&lt;NOT FOUND&gt;&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;&lt;NULL&gt;&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;ALLOCATIONS&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;ARGS&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;ARGUMENTS&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;BREAKPOINT&quot;
comma
l_int|1
)brace
comma
(brace
l_string|&quot;CALL&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;CLOSE&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;DEBUG&quot;
comma
l_int|1
)brace
comma
(brace
l_string|&quot;DUMP&quot;
comma
l_int|1
)brace
comma
(brace
l_string|&quot;ENABLEACPI&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;EVENT&quot;
comma
l_int|1
)brace
comma
(brace
l_string|&quot;EXECUTE&quot;
comma
l_int|1
)brace
comma
(brace
l_string|&quot;EXIT&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;FIND&quot;
comma
l_int|1
)brace
comma
(brace
l_string|&quot;GO&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;HELP&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;?&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;HISTORY&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;!&quot;
comma
l_int|1
)brace
comma
(brace
l_string|&quot;!!&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;INFORMATION&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;INTO&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;LEVEL&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;LIST&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;LOAD&quot;
comma
l_int|1
)brace
comma
(brace
l_string|&quot;LOCALS&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;LOCKS&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;METHODS&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;NAMESPACE&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;NOTIFY&quot;
comma
l_int|2
)brace
comma
(brace
l_string|&quot;OBJECT&quot;
comma
l_int|1
)brace
comma
(brace
l_string|&quot;OPEN&quot;
comma
l_int|1
)brace
comma
(brace
l_string|&quot;OWNER&quot;
comma
l_int|1
)brace
comma
(brace
l_string|&quot;PREFIX&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;QUIT&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;REFERENCES&quot;
comma
l_int|1
)brace
comma
(brace
l_string|&quot;RESOURCES&quot;
comma
l_int|1
)brace
comma
(brace
l_string|&quot;RESULTS&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;SET&quot;
comma
l_int|3
)brace
comma
(brace
l_string|&quot;STATS&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;STOP&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;TABLES&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;TERMINATE&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;THREADS&quot;
comma
l_int|3
)brace
comma
(brace
l_string|&quot;TREE&quot;
comma
l_int|0
)brace
comma
(brace
l_string|&quot;UNLOAD&quot;
comma
l_int|1
)brace
comma
(brace
l_int|NULL
comma
l_int|0
)brace
)brace
suffix:semicolon
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    Acpi_db_display_help&n; *&n; * PARAMETERS:  Help_type       - Subcommand (optional)&n; *&n; * RETURN:      None&n; *&n; * DESCRIPTION: Print a usage message.&n; *&n; ******************************************************************************/
r_void
DECL|function|acpi_db_display_help
id|acpi_db_display_help
(paren
id|NATIVE_CHAR
op_star
id|help_type
)paren
(brace
multiline_comment|/* No parameter, just give the overview */
r_if
c_cond
(paren
op_logical_neg
id|help_type
)paren
(brace
id|acpi_os_printf
(paren
l_string|&quot;ACPI CA Debugger Commands&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;The following classes of commands are available. Help is available for&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;each class by entering &bslash;&quot;Help &lt;Class_name&gt;&bslash;&quot;&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;  [GENERAL]       General-Purpose Commands&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;  [NAMESPACE]     Namespace Access Commands&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;  [METHOD]        Control Method Execution Commands&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;  [FILE]          File I/O Commands&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Parameter is the command class&n;&t; *&n;&t; * The idea here is to keep each class of commands smaller than a screenful&n;&t; */
r_switch
c_cond
(paren
id|help_type
(braket
l_int|0
)braket
)paren
(brace
r_case
l_char|&squot;G&squot;
suffix:colon
id|acpi_os_printf
(paren
l_string|&quot;&bslash;n_general-Purpose Commands&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Allocations                       Display list of current memory allocations&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Dump &lt;Address&gt;|&lt;Namepath&gt;&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;   [Byte|Word|Dword|Qword]        Display ACPI objects or memory&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Enable_acpi                       Enable ACPI (hardware) mode&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Help                              This help screen&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;History                           Display command history buffer&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Level [&lt;Debug_level&gt;] [console]   Get/Set debug level for file or console&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Locks                             Current status of internal mutexes&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Quit or Exit                      Exit this command&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Stats [Allocations|Memory|Misc&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;     |Objects|Tables]             Display namespace and memory statistics&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Tables                            Display info about loaded ACPI tables&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Unload &lt;Table_sig&gt; [Instance]     Unload an ACPI table&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;! &lt;Command_number&gt;                Execute command from history buffer&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;!!                                Execute last command again&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;N&squot;
suffix:colon
id|acpi_os_printf
(paren
l_string|&quot;&bslash;n_namespace Access Commands&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Debug &lt;Namepath&gt; [Arguments]      Single Step a control method&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Event &lt;F|G&gt; &lt;Value&gt;               Generate Acpi_event (Fixed/GPE)&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Execute &lt;Namepath&gt; [Arguments]    Execute control method&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Find &lt;Name&gt; (? is wildcard)       Find ACPI name(s) with wildcards&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Method                            Display list of loaded control methods&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Namespace [&lt;Addr&gt;|&lt;Path&gt;] [Depth] Display loaded namespace tree/subtree&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Notify &lt;Name_path&gt; &lt;Value&gt;        Send a notification&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Objects &lt;Object_type&gt;             Display all objects of the given type&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Owner &lt;Owner_id&gt; [Depth]          Display loaded namespace by object owner&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Prefix [&lt;Name_path&gt;]              Set or Get current execution prefix&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;References &lt;Addr&gt;                 Find all references to object at addr&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Resources xxx                     Get and display resources&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Terminate                         Delete namespace and all internal objects&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Thread &lt;Threads&gt;&lt;Loops&gt;&lt;Name_path&gt; Spawn threads to execute method(s)&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;M&squot;
suffix:colon
id|acpi_os_printf
(paren
l_string|&quot;&bslash;n_control Method Execution Commands&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Arguments (or Args)               Display method arguments&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Breakpoint &lt;Aml_offset&gt;           Set an AML execution breakpoint&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Call                              Run to next control method invocation&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Go                                Allow method to run to completion&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Information                       Display info about the current method&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Into                              Step into (not over) a method call&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;List [# of Aml Opcodes]           Display method ASL statements&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Locals                            Display method local variables&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Results                           Display method result stack&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Set &lt;A|L&gt; &lt;#&gt; &lt;Value&gt;             Set method data (Arguments/Locals)&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Stop                              Terminate control method&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Tree                              Display control method calling tree&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;&lt;Enter&gt;                           Single step next AML opcode (over calls)&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
r_case
l_char|&squot;F&squot;
suffix:colon
id|acpi_os_printf
(paren
l_string|&quot;&bslash;n_file I/O Commands&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Close                             Close debug output file&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Open &lt;Output Filename&gt;            Open a file for debug output&bslash;n&quot;
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Load &lt;Input Filename&gt;             Load ACPI table from a file&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
r_default
suffix:colon
id|acpi_os_printf
(paren
l_string|&quot;Unrecognized Command Class: %x&bslash;n&quot;
comma
id|help_type
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    Acpi_db_get_next_token&n; *&n; * PARAMETERS:  String          - Command buffer&n; *              Next            - Return value, end of next token&n; *&n; * RETURN:      Pointer to the start of the next token.&n; *&n; * DESCRIPTION: Command line parsing.  Get the next token on the command line&n; *&n; ******************************************************************************/
id|NATIVE_CHAR
op_star
DECL|function|acpi_db_get_next_token
id|acpi_db_get_next_token
(paren
id|NATIVE_CHAR
op_star
id|string
comma
id|NATIVE_CHAR
op_star
op_star
id|next
)paren
(brace
id|NATIVE_CHAR
op_star
id|start
suffix:semicolon
multiline_comment|/* At end of buffer? */
r_if
c_cond
(paren
op_logical_neg
id|string
op_logical_or
op_logical_neg
(paren
op_star
id|string
)paren
)paren
(brace
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/* Get rid of any spaces at the beginning */
r_if
c_cond
(paren
op_star
id|string
op_eq
l_char|&squot; &squot;
)paren
(brace
r_while
c_loop
(paren
op_star
id|string
op_logical_and
(paren
op_star
id|string
op_eq
l_char|&squot; &squot;
)paren
)paren
(brace
id|string
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|string
)paren
)paren
(brace
r_return
(paren
l_int|NULL
)paren
suffix:semicolon
)brace
)brace
id|start
op_assign
id|string
suffix:semicolon
multiline_comment|/* Find end of token */
r_while
c_loop
(paren
op_star
id|string
op_logical_and
(paren
op_star
id|string
op_ne
l_char|&squot; &squot;
)paren
)paren
(brace
id|string
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
op_star
id|string
)paren
)paren
(brace
op_star
id|next
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
op_star
id|string
op_assign
l_int|0
suffix:semicolon
op_star
id|next
op_assign
id|string
op_plus
l_int|1
suffix:semicolon
)brace
r_return
(paren
id|start
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    Acpi_db_get_line&n; *&n; * PARAMETERS:  Input_buffer        - Command line buffer&n; *&n; * RETURN:      None&n; *&n; * DESCRIPTION: Get the next command line from the user.  Gets entire line&n; *              up to the next newline&n; *&n; ******************************************************************************/
id|u32
DECL|function|acpi_db_get_line
id|acpi_db_get_line
(paren
id|NATIVE_CHAR
op_star
id|input_buffer
)paren
(brace
id|u32
id|i
suffix:semicolon
id|u32
id|count
suffix:semicolon
id|NATIVE_CHAR
op_star
id|next
suffix:semicolon
id|NATIVE_CHAR
op_star
id|this
suffix:semicolon
id|STRCPY
(paren
id|acpi_gbl_db_parsed_buf
comma
id|input_buffer
)paren
suffix:semicolon
id|STRUPR
(paren
id|acpi_gbl_db_parsed_buf
)paren
suffix:semicolon
id|this
op_assign
id|acpi_gbl_db_parsed_buf
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|DB_MAX_ARGS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|acpi_gbl_db_args
(braket
id|i
)braket
op_assign
id|acpi_db_get_next_token
(paren
id|this
comma
op_amp
id|next
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_gbl_db_args
(braket
id|i
)braket
)paren
(brace
r_break
suffix:semicolon
)brace
id|this
op_assign
id|next
suffix:semicolon
)brace
multiline_comment|/* Uppercase the actual command */
r_if
c_cond
(paren
id|acpi_gbl_db_args
(braket
l_int|0
)braket
)paren
(brace
id|STRUPR
(paren
id|acpi_gbl_db_args
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
id|count
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|count
)paren
(brace
id|count
op_decrement
suffix:semicolon
multiline_comment|/* Number of args only */
)brace
r_return
(paren
id|count
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    Acpi_db_match_command&n; *&n; * PARAMETERS:  User_command            - User command line&n; *&n; * RETURN:      Index into command array, -1 if not found&n; *&n; * DESCRIPTION: Search command array for a command match&n; *&n; ******************************************************************************/
id|u32
DECL|function|acpi_db_match_command
id|acpi_db_match_command
(paren
id|NATIVE_CHAR
op_star
id|user_command
)paren
(brace
id|u32
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|user_command
op_logical_or
id|user_command
(braket
l_int|0
)braket
op_eq
l_int|0
)paren
(brace
r_return
(paren
id|CMD_NULL
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
id|CMD_FIRST_VALID
suffix:semicolon
id|acpi_gbl_db_commands
(braket
id|i
)braket
dot
id|name
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|STRSTR
(paren
id|acpi_gbl_db_commands
(braket
id|i
)braket
dot
id|name
comma
id|user_command
)paren
op_eq
id|acpi_gbl_db_commands
(braket
id|i
)braket
dot
id|name
)paren
(brace
r_return
(paren
id|i
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Command not recognized */
r_return
(paren
id|CMD_NOT_FOUND
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    Acpi_db_command_dispatch&n; *&n; * PARAMETERS:  Input_buffer        - Command line buffer&n; *              Walk_state          - Current walk&n; *              Op                  - Current (executing) parse op&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Command dispatcher.  Called from two places:&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_db_command_dispatch
id|acpi_db_command_dispatch
(paren
id|NATIVE_CHAR
op_star
id|input_buffer
comma
id|acpi_walk_state
op_star
id|walk_state
comma
id|acpi_parse_object
op_star
id|op
)paren
(brace
id|u32
id|temp
suffix:semicolon
id|u32
id|command_index
suffix:semicolon
id|u32
id|param_count
suffix:semicolon
id|NATIVE_CHAR
op_star
id|command_line
suffix:semicolon
id|acpi_status
id|status
op_assign
id|AE_CTRL_TRUE
suffix:semicolon
multiline_comment|/* If Acpi_terminate has been called, terminate this thread */
r_if
c_cond
(paren
id|acpi_gbl_db_terminate_threads
)paren
(brace
r_return
(paren
id|AE_CTRL_TERMINATE
)paren
suffix:semicolon
)brace
id|param_count
op_assign
id|acpi_db_get_line
(paren
id|input_buffer
)paren
suffix:semicolon
id|command_index
op_assign
id|acpi_db_match_command
(paren
id|acpi_gbl_db_args
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|temp
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Verify that we have the minimum number of params */
r_if
c_cond
(paren
id|param_count
OL
id|acpi_gbl_db_commands
(braket
id|command_index
)braket
dot
id|min_args
)paren
(brace
id|acpi_os_printf
(paren
l_string|&quot;%d parameters entered, [%s] requires %d parameters&bslash;n&quot;
comma
id|param_count
comma
id|acpi_gbl_db_commands
(braket
id|command_index
)braket
dot
id|name
comma
id|acpi_gbl_db_commands
(braket
id|command_index
)braket
dot
id|min_args
)paren
suffix:semicolon
r_return
(paren
id|AE_CTRL_TRUE
)paren
suffix:semicolon
)brace
multiline_comment|/* Decode and dispatch the command */
r_switch
c_cond
(paren
id|command_index
)paren
(brace
r_case
id|CMD_NULL
suffix:colon
r_if
c_cond
(paren
id|op
)paren
(brace
r_return
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CMD_ALLOCATIONS
suffix:colon
macro_line|#ifdef ACPI_DBG_TRACK_ALLOCATIONS
id|acpi_ut_dump_current_allocations
(paren
(paren
id|u32
)paren
op_minus
l_int|1
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|CMD_ARGS
suffix:colon
r_case
id|CMD_ARGUMENTS
suffix:colon
id|acpi_db_display_arguments
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_BREAKPOINT
suffix:colon
id|acpi_db_set_method_breakpoint
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
comma
id|walk_state
comma
id|op
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_CALL
suffix:colon
id|acpi_db_set_method_call_breakpoint
(paren
id|op
)paren
suffix:semicolon
id|status
op_assign
id|AE_OK
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_CLOSE
suffix:colon
id|acpi_db_close_debug_file
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_DEBUG
suffix:colon
id|acpi_db_execute
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
comma
op_amp
id|acpi_gbl_db_args
(braket
l_int|2
)braket
comma
id|EX_SINGLE_STEP
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_DUMP
suffix:colon
id|acpi_db_decode_and_display_object
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
comma
id|acpi_gbl_db_args
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_ENABLEACPI
suffix:colon
id|status
op_assign
id|acpi_enable
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
c_func
(paren
id|status
)paren
)paren
(brace
id|acpi_os_printf
c_func
(paren
l_string|&quot;Acpi_enable failed (Status=%X)&bslash;n&quot;
comma
id|status
)paren
suffix:semicolon
r_return
(paren
id|status
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CMD_EVENT
suffix:colon
id|acpi_os_printf
(paren
l_string|&quot;Event command not implemented&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_EXECUTE
suffix:colon
id|acpi_db_execute
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
comma
op_amp
id|acpi_gbl_db_args
(braket
l_int|2
)braket
comma
id|EX_NO_SINGLE_STEP
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_FIND
suffix:colon
id|acpi_db_find_name_in_namespace
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_GO
suffix:colon
id|acpi_gbl_cm_single_step
op_assign
id|FALSE
suffix:semicolon
r_return
(paren
id|AE_OK
)paren
suffix:semicolon
r_case
id|CMD_HELP
suffix:colon
r_case
id|CMD_HELP2
suffix:colon
id|acpi_db_display_help
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_HISTORY
suffix:colon
id|acpi_db_display_history
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_HISTORY_EXE
suffix:colon
id|command_line
op_assign
id|acpi_db_get_from_history
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|command_line
)paren
(brace
r_return
(paren
id|AE_CTRL_TRUE
)paren
suffix:semicolon
)brace
id|status
op_assign
id|acpi_db_command_dispatch
(paren
id|command_line
comma
id|walk_state
comma
id|op
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_SUCCESS
(paren
id|status
)paren
)paren
(brace
id|status
op_assign
id|AE_CTRL_TRUE
suffix:semicolon
)brace
r_return
(paren
id|status
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_HISTORY_LAST
suffix:colon
id|command_line
op_assign
id|acpi_db_get_from_history
(paren
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|command_line
)paren
(brace
r_return
(paren
id|AE_CTRL_TRUE
)paren
suffix:semicolon
)brace
id|status
op_assign
id|acpi_db_command_dispatch
(paren
id|command_line
comma
id|walk_state
comma
id|op
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_SUCCESS
(paren
id|status
)paren
)paren
(brace
id|status
op_assign
id|AE_CTRL_TRUE
suffix:semicolon
)brace
r_return
(paren
id|status
)paren
suffix:semicolon
r_case
id|CMD_INFORMATION
suffix:colon
id|acpi_db_display_method_info
(paren
id|op
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_INTO
suffix:colon
r_if
c_cond
(paren
id|op
)paren
(brace
id|acpi_gbl_cm_single_step
op_assign
id|TRUE
suffix:semicolon
multiline_comment|/* TBD: Must get current walk state */
multiline_comment|/* Acpi_gbl_Method_breakpoint = 0; */
r_return
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CMD_LEVEL
suffix:colon
r_if
c_cond
(paren
id|param_count
op_eq
l_int|0
)paren
(brace
id|acpi_os_printf
(paren
l_string|&quot;Current debug level for file output is:  %8.8lX&bslash;n&quot;
comma
id|acpi_gbl_db_debug_level
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Current debug level for console output is: %8.8lX&bslash;n&quot;
comma
id|acpi_gbl_db_console_debug_level
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|param_count
op_eq
l_int|2
)paren
(brace
id|temp
op_assign
id|acpi_gbl_db_console_debug_level
suffix:semicolon
id|acpi_gbl_db_console_debug_level
op_assign
id|STRTOUL
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
comma
l_int|NULL
comma
l_int|16
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Debug Level for console output was %8.8lX, now %8.8lX&bslash;n&quot;
comma
id|temp
comma
id|acpi_gbl_db_console_debug_level
)paren
suffix:semicolon
)brace
r_else
(brace
id|temp
op_assign
id|acpi_gbl_db_debug_level
suffix:semicolon
id|acpi_gbl_db_debug_level
op_assign
id|STRTOUL
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
comma
l_int|NULL
comma
l_int|16
)paren
suffix:semicolon
id|acpi_os_printf
(paren
l_string|&quot;Debug Level for file output was %8.8lX, now %8.8lX&bslash;n&quot;
comma
id|temp
comma
id|acpi_gbl_db_debug_level
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CMD_LIST
suffix:colon
id|acpi_db_disassemble_aml
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
comma
id|op
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_LOAD
suffix:colon
id|status
op_assign
id|acpi_db_load_acpi_table
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
r_return
(paren
id|status
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|CMD_LOCKS
suffix:colon
id|acpi_db_display_locks
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_LOCALS
suffix:colon
id|acpi_db_display_locals
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_METHODS
suffix:colon
id|acpi_db_display_objects
(paren
l_string|&quot;METHOD&quot;
comma
id|acpi_gbl_db_args
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_NAMESPACE
suffix:colon
id|acpi_db_dump_namespace
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
comma
id|acpi_gbl_db_args
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_NOTIFY
suffix:colon
id|temp
op_assign
id|STRTOUL
(paren
id|acpi_gbl_db_args
(braket
l_int|2
)braket
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|acpi_db_send_notify
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
comma
id|temp
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_OBJECT
suffix:colon
id|acpi_db_display_objects
(paren
id|STRUPR
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
)paren
comma
id|acpi_gbl_db_args
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_OPEN
suffix:colon
id|acpi_db_open_debug_file
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_OWNER
suffix:colon
id|acpi_db_dump_namespace_by_owner
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
comma
id|acpi_gbl_db_args
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_PREFIX
suffix:colon
id|acpi_db_set_scope
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_REFERENCES
suffix:colon
id|acpi_db_find_references
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_RESOURCES
suffix:colon
id|acpi_db_display_resources
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_RESULTS
suffix:colon
id|acpi_db_display_results
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_SET
suffix:colon
id|acpi_db_set_method_data
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
comma
id|acpi_gbl_db_args
(braket
l_int|2
)braket
comma
id|acpi_gbl_db_args
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_STATS
suffix:colon
id|acpi_db_display_statistics
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_STOP
suffix:colon
r_return
(paren
id|AE_AML_ERROR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_TABLES
suffix:colon
id|acpi_db_display_table_info
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_TERMINATE
suffix:colon
id|acpi_db_set_output_destination
(paren
id|DB_REDIRECTABLE_OUTPUT
)paren
suffix:semicolon
id|acpi_ut_subsystem_shutdown
(paren
)paren
suffix:semicolon
multiline_comment|/* TBD: [Restructure] Need some way to re-initialize without re-creating the semaphores! */
multiline_comment|/*  Acpi_initialize (NULL); */
r_break
suffix:semicolon
r_case
id|CMD_THREADS
suffix:colon
id|acpi_db_create_execution_threads
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
comma
id|acpi_gbl_db_args
(braket
l_int|2
)braket
comma
id|acpi_gbl_db_args
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_TREE
suffix:colon
id|acpi_db_display_calling_tree
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_UNLOAD
suffix:colon
id|acpi_db_unload_acpi_table
(paren
id|acpi_gbl_db_args
(braket
l_int|1
)braket
comma
id|acpi_gbl_db_args
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|CMD_EXIT
suffix:colon
r_case
id|CMD_QUIT
suffix:colon
r_if
c_cond
(paren
id|op
)paren
(brace
id|acpi_os_printf
(paren
l_string|&quot;Method execution terminated&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
id|AE_CTRL_TERMINATE
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|acpi_gbl_db_output_to_file
)paren
(brace
id|acpi_dbg_level
op_assign
id|DEBUG_DEFAULT
suffix:semicolon
)brace
multiline_comment|/* Shutdown */
multiline_comment|/* Acpi_ut_subsystem_shutdown (); */
id|acpi_db_close_debug_file
(paren
)paren
suffix:semicolon
id|acpi_gbl_db_terminate_threads
op_assign
id|TRUE
suffix:semicolon
r_return
(paren
id|AE_CTRL_TERMINATE
)paren
suffix:semicolon
r_case
id|CMD_NOT_FOUND
suffix:colon
id|acpi_os_printf
(paren
l_string|&quot;Unknown Command&bslash;n&quot;
)paren
suffix:semicolon
r_return
(paren
id|AE_CTRL_TRUE
)paren
suffix:semicolon
)brace
multiline_comment|/* Add all commands that come here to the history buffer */
id|acpi_db_add_to_history
(paren
id|input_buffer
)paren
suffix:semicolon
r_return
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    Acpi_db_execute_thread&n; *&n; * PARAMETERS:  Context         - Not used&n; *&n; * RETURN:      None&n; *&n; * DESCRIPTION: Debugger execute thread.  Waits for a command line, then&n; *              simply dispatches it.&n; *&n; ******************************************************************************/
r_void
DECL|function|acpi_db_execute_thread
id|acpi_db_execute_thread
(paren
r_void
op_star
id|context
)paren
(brace
id|acpi_status
id|status
op_assign
id|AE_OK
suffix:semicolon
r_while
c_loop
(paren
id|status
op_ne
id|AE_CTRL_TERMINATE
)paren
(brace
id|acpi_gbl_method_executing
op_assign
id|FALSE
suffix:semicolon
id|acpi_gbl_step_to_next_call
op_assign
id|FALSE
suffix:semicolon
id|acpi_ut_acquire_mutex
(paren
id|ACPI_MTX_DEBUG_CMD_READY
)paren
suffix:semicolon
id|status
op_assign
id|acpi_db_command_dispatch
(paren
id|acpi_gbl_db_line_buf
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|acpi_ut_release_mutex
(paren
id|ACPI_MTX_DEBUG_CMD_COMPLETE
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    Acpi_db_single_thread&n; *&n; * PARAMETERS:  None&n; *&n; * RETURN:      None&n; *&n; * DESCRIPTION: Debugger execute thread.  Waits for a command line, then&n; *              simply dispatches it.&n; *&n; ******************************************************************************/
r_void
DECL|function|acpi_db_single_thread
id|acpi_db_single_thread
(paren
r_void
)paren
(brace
id|acpi_status
id|status
op_assign
id|AE_OK
suffix:semicolon
id|acpi_gbl_method_executing
op_assign
id|FALSE
suffix:semicolon
id|acpi_gbl_step_to_next_call
op_assign
id|FALSE
suffix:semicolon
id|status
op_assign
id|acpi_db_command_dispatch
(paren
id|acpi_gbl_db_line_buf
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    Acpi_db_user_commands&n; *&n; * PARAMETERS:  Prompt              - User prompt (depends on mode)&n; *              Op                  - Current executing parse op&n; *&n; * RETURN:      None&n; *&n; * DESCRIPTION: Command line execution for the AML debugger.  Commands are&n; *              matched and dispatched here.&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_db_user_commands
id|acpi_db_user_commands
(paren
id|NATIVE_CHAR
id|prompt
comma
id|acpi_parse_object
op_star
id|op
)paren
(brace
id|acpi_status
id|status
op_assign
id|AE_OK
suffix:semicolon
multiline_comment|/* TBD: [Restructure] Need a separate command line buffer for step mode */
r_while
c_loop
(paren
op_logical_neg
id|acpi_gbl_db_terminate_threads
)paren
(brace
multiline_comment|/* Force output to console until a command is entered */
id|acpi_db_set_output_destination
(paren
id|DB_CONSOLE_OUTPUT
)paren
suffix:semicolon
multiline_comment|/* Different prompt if method is executing */
r_if
c_cond
(paren
op_logical_neg
id|acpi_gbl_method_executing
)paren
(brace
id|acpi_os_printf
(paren
l_string|&quot;%1c &quot;
comma
id|DB_COMMAND_PROMPT
)paren
suffix:semicolon
)brace
r_else
(brace
id|acpi_os_printf
(paren
l_string|&quot;%1c &quot;
comma
id|DB_EXECUTE_PROMPT
)paren
suffix:semicolon
)brace
multiline_comment|/* Get the user input line */
id|acpi_os_get_line
(paren
id|acpi_gbl_db_line_buf
)paren
suffix:semicolon
multiline_comment|/* Check for single or multithreaded debug */
r_if
c_cond
(paren
id|acpi_gbl_debugger_configuration
op_amp
id|DEBUGGER_MULTI_THREADED
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Signal the debug thread that we have a command to execute,&n;&t;&t;&t; * and wait for the command to complete.&n;&t;&t;&t; */
id|acpi_ut_release_mutex
(paren
id|ACPI_MTX_DEBUG_CMD_READY
)paren
suffix:semicolon
id|acpi_ut_acquire_mutex
(paren
id|ACPI_MTX_DEBUG_CMD_COMPLETE
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Just call to the command line interpreter */
id|acpi_db_single_thread
(paren
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t; * Only this thread (the original thread) should actually terminate the subsystem,&n;&t; * because all the semaphores are deleted during termination&n;&t; */
id|acpi_terminate
(paren
)paren
suffix:semicolon
r_return
(paren
id|status
)paren
suffix:semicolon
)brace
macro_line|#endif  /* ENABLE_DEBUGGER */
eof
