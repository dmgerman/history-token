multiline_comment|/******************************************************************************&n; *&n; * Module Name: excreate - Named object creation&n; *&n; *****************************************************************************/
multiline_comment|/*&n; * Copyright (C) 2000 - 2004, R. Byron Moore&n; * All rights reserved.&n; *&n; * Redistribution and use in source and binary forms, with or without&n; * modification, are permitted provided that the following conditions&n; * are met:&n; * 1. Redistributions of source code must retain the above copyright&n; *    notice, this list of conditions, and the following disclaimer,&n; *    without modification.&n; * 2. Redistributions in binary form must reproduce at minimum a disclaimer&n; *    substantially similar to the &quot;NO WARRANTY&quot; disclaimer below&n; *    (&quot;Disclaimer&quot;) and any redistribution must be conditioned upon&n; *    including a substantially similar Disclaimer requirement for further&n; *    binary redistribution.&n; * 3. Neither the names of the above-listed copyright holders nor the names&n; *    of any contributors may be used to endorse or promote products derived&n; *    from this software without specific prior written permission.&n; *&n; * Alternatively, this software may be distributed under the terms of the&n; * GNU General Public License (&quot;GPL&quot;) version 2 as published by the Free&n; * Software Foundation.&n; *&n; * NO WARRANTY&n; * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS&n; * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT&n; * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR&n; * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT&n; * HOLDERS OR CONTRIBUTORS BE LIABLE FOR SPECIAL, EXEMPLARY, OR CONSEQUENTIAL&n; * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS&n; * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)&n; * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,&n; * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING&n; * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE&n; * POSSIBILITY OF SUCH DAMAGES.&n; */
macro_line|#include &lt;acpi/acpi.h&gt;
macro_line|#include &lt;acpi/acinterp.h&gt;
macro_line|#include &lt;acpi/amlcode.h&gt;
macro_line|#include &lt;acpi/acnamesp.h&gt;
macro_line|#include &lt;acpi/acevents.h&gt;
macro_line|#include &lt;acpi/actables.h&gt;
DECL|macro|_COMPONENT
mdefine_line|#define _COMPONENT          ACPI_EXECUTER
id|ACPI_MODULE_NAME
(paren
l_string|&quot;excreate&quot;
)paren
macro_line|#ifndef ACPI_NO_METHOD_EXECUTION
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    acpi_ex_create_alias&n; *&n; * PARAMETERS:  walk_state           - Current state, contains operands&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Create a new named alias&n; *&n; ****************************************************************************/
id|acpi_status
DECL|function|acpi_ex_create_alias
id|acpi_ex_create_alias
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
r_struct
id|acpi_namespace_node
op_star
id|target_node
suffix:semicolon
r_struct
id|acpi_namespace_node
op_star
id|alias_node
suffix:semicolon
id|acpi_status
id|status
op_assign
id|AE_OK
suffix:semicolon
id|ACPI_FUNCTION_TRACE
(paren
l_string|&quot;ex_create_alias&quot;
)paren
suffix:semicolon
multiline_comment|/* Get the source/alias operands (both namespace nodes) */
id|alias_node
op_assign
(paren
r_struct
id|acpi_namespace_node
op_star
)paren
id|walk_state-&gt;operands
(braket
l_int|0
)braket
suffix:semicolon
id|target_node
op_assign
(paren
r_struct
id|acpi_namespace_node
op_star
)paren
id|walk_state-&gt;operands
(braket
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|target_node-&gt;type
op_eq
id|ACPI_TYPE_LOCAL_ALIAS
)paren
op_logical_or
(paren
id|target_node-&gt;type
op_eq
id|ACPI_TYPE_LOCAL_METHOD_ALIAS
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * Dereference an existing alias so that we don&squot;t create a chain&n;&t;&t; * of aliases.  With this code, we guarantee that an alias is&n;&t;&t; * always exactly one level of indirection away from the&n;&t;&t; * actual aliased name.&n;&t;&t; */
id|target_node
op_assign
id|ACPI_CAST_PTR
(paren
r_struct
id|acpi_namespace_node
comma
id|target_node-&gt;object
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * For objects that can never change (i.e., the NS node will&n;&t; * permanently point to the same object), we can simply attach&n;&t; * the object to the new NS node.  For other objects (such as&n;&t; * Integers, buffers, etc.), we have to point the Alias node&n;&t; * to the original Node.&n;&t; */
r_switch
c_cond
(paren
id|target_node-&gt;type
)paren
(brace
r_case
id|ACPI_TYPE_INTEGER
suffix:colon
r_case
id|ACPI_TYPE_STRING
suffix:colon
r_case
id|ACPI_TYPE_BUFFER
suffix:colon
r_case
id|ACPI_TYPE_PACKAGE
suffix:colon
r_case
id|ACPI_TYPE_BUFFER_FIELD
suffix:colon
multiline_comment|/*&n;&t;&t; * The new alias has the type ALIAS and points to the original&n;&t;&t; * NS node, not the object itself.  This is because for these&n;&t;&t; * types, the object can change dynamically via a Store.&n;&t;&t; */
id|alias_node-&gt;type
op_assign
id|ACPI_TYPE_LOCAL_ALIAS
suffix:semicolon
id|alias_node-&gt;object
op_assign
id|ACPI_CAST_PTR
(paren
r_union
id|acpi_operand_object
comma
id|target_node
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_TYPE_METHOD
suffix:colon
multiline_comment|/*&n;&t;&t; * The new alias has the type ALIAS and points to the original&n;&t;&t; * NS node, not the object itself.  This is because for these&n;&t;&t; * types, the object can change dynamically via a Store.&n;&t;&t; */
id|alias_node-&gt;type
op_assign
id|ACPI_TYPE_LOCAL_METHOD_ALIAS
suffix:semicolon
id|alias_node-&gt;object
op_assign
id|ACPI_CAST_PTR
(paren
r_union
id|acpi_operand_object
comma
id|target_node
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* Attach the original source object to the new Alias Node */
multiline_comment|/*&n;&t;&t; * The new alias assumes the type of the target, and it points&n;&t;&t; * to the same object.  The reference count of the object has an&n;&t;&t; * additional reference to prevent deletion out from under either the&n;&t;&t; * target node or the alias Node&n;&t;&t; */
id|status
op_assign
id|acpi_ns_attach_object
(paren
id|alias_node
comma
id|acpi_ns_get_attached_object
(paren
id|target_node
)paren
comma
id|target_node-&gt;type
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
multiline_comment|/* Since both operands are Nodes, we don&squot;t need to delete them */
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    acpi_ex_create_event&n; *&n; * PARAMETERS:  walk_state          - Current state&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Create a new event object&n; *&n; ****************************************************************************/
id|acpi_status
DECL|function|acpi_ex_create_event
id|acpi_ex_create_event
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
id|acpi_status
id|status
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|obj_desc
suffix:semicolon
id|ACPI_FUNCTION_TRACE
(paren
l_string|&quot;ex_create_event&quot;
)paren
suffix:semicolon
id|obj_desc
op_assign
id|acpi_ut_create_internal_object
(paren
id|ACPI_TYPE_EVENT
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|obj_desc
)paren
(brace
id|status
op_assign
id|AE_NO_MEMORY
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Create the actual OS semaphore, with zero initial units -- meaning&n;&t; * that the event is created in an unsignalled state&n;&t; */
id|status
op_assign
id|acpi_os_create_semaphore
(paren
id|ACPI_NO_UNIT_LIMIT
comma
l_int|0
comma
op_amp
id|obj_desc-&gt;event.semaphore
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
r_goto
id|cleanup
suffix:semicolon
)brace
multiline_comment|/* Attach object to the Node */
id|status
op_assign
id|acpi_ns_attach_object
(paren
(paren
r_struct
id|acpi_namespace_node
op_star
)paren
id|walk_state-&gt;operands
(braket
l_int|0
)braket
comma
id|obj_desc
comma
id|ACPI_TYPE_EVENT
)paren
suffix:semicolon
id|cleanup
suffix:colon
multiline_comment|/*&n;&t; * Remove local reference to the object (on error, will cause deletion&n;&t; * of both object and semaphore if present.)&n;&t; */
id|acpi_ut_remove_reference
(paren
id|obj_desc
)paren
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    acpi_ex_create_mutex&n; *&n; * PARAMETERS:  walk_state          - Current state&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Create a new mutex object&n; *&n; *              Mutex (Name[0], sync_level[1])&n; *&n; ****************************************************************************/
id|acpi_status
DECL|function|acpi_ex_create_mutex
id|acpi_ex_create_mutex
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
id|acpi_status
id|status
op_assign
id|AE_OK
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|obj_desc
suffix:semicolon
id|ACPI_FUNCTION_TRACE_PTR
(paren
l_string|&quot;ex_create_mutex&quot;
comma
id|ACPI_WALK_OPERANDS
)paren
suffix:semicolon
multiline_comment|/* Create the new mutex object */
id|obj_desc
op_assign
id|acpi_ut_create_internal_object
(paren
id|ACPI_TYPE_MUTEX
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|obj_desc
)paren
(brace
id|status
op_assign
id|AE_NO_MEMORY
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Create the actual OS semaphore.&n;&t; * One unit max to make it a mutex, with one initial unit to allow&n;&t; * the mutex to be acquired.&n;&t; */
id|status
op_assign
id|acpi_os_create_semaphore
(paren
l_int|1
comma
l_int|1
comma
op_amp
id|obj_desc-&gt;mutex.semaphore
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
r_goto
id|cleanup
suffix:semicolon
)brace
multiline_comment|/* Init object and attach to NS node */
id|obj_desc-&gt;mutex.sync_level
op_assign
(paren
id|u8
)paren
id|walk_state-&gt;operands
(braket
l_int|1
)braket
op_member_access_from_pointer
id|integer.value
suffix:semicolon
id|obj_desc-&gt;mutex.node
op_assign
(paren
r_struct
id|acpi_namespace_node
op_star
)paren
id|walk_state-&gt;operands
(braket
l_int|0
)braket
suffix:semicolon
id|status
op_assign
id|acpi_ns_attach_object
(paren
id|obj_desc-&gt;mutex.node
comma
id|obj_desc
comma
id|ACPI_TYPE_MUTEX
)paren
suffix:semicolon
id|cleanup
suffix:colon
multiline_comment|/*&n;&t; * Remove local reference to the object (on error, will cause deletion&n;&t; * of both object and semaphore if present.)&n;&t; */
id|acpi_ut_remove_reference
(paren
id|obj_desc
)paren
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    acpi_ex_create_region&n; *&n; * PARAMETERS:  aml_start           - Pointer to the region declaration AML&n; *              aml_length          - Max length of the declaration AML&n; *              Operands            - List of operands for the opcode&n; *              walk_state          - Current state&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Create a new operation region object&n; *&n; ****************************************************************************/
id|acpi_status
DECL|function|acpi_ex_create_region
id|acpi_ex_create_region
(paren
id|u8
op_star
id|aml_start
comma
id|u32
id|aml_length
comma
id|u8
id|region_space
comma
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
id|acpi_status
id|status
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|obj_desc
suffix:semicolon
r_struct
id|acpi_namespace_node
op_star
id|node
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|region_obj2
suffix:semicolon
id|ACPI_FUNCTION_TRACE
(paren
l_string|&quot;ex_create_region&quot;
)paren
suffix:semicolon
multiline_comment|/* Get the Namespace Node */
id|node
op_assign
id|walk_state-&gt;op-&gt;common.node
suffix:semicolon
multiline_comment|/*&n;&t; * If the region object is already attached to this node,&n;&t; * just return&n;&t; */
r_if
c_cond
(paren
id|acpi_ns_get_attached_object
(paren
id|node
)paren
)paren
(brace
id|return_ACPI_STATUS
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Space ID must be one of the predefined IDs, or in the user-defined&n;&t; * range&n;&t; */
r_if
c_cond
(paren
(paren
id|region_space
op_ge
id|ACPI_NUM_PREDEFINED_REGIONS
)paren
op_logical_and
(paren
id|region_space
OL
id|ACPI_USER_REGION_BEGIN
)paren
)paren
(brace
id|ACPI_REPORT_ERROR
(paren
(paren
l_string|&quot;Invalid address_space type %X&bslash;n&quot;
comma
id|region_space
)paren
)paren
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|AE_AML_INVALID_SPACE_ID
)paren
suffix:semicolon
)brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_LOAD
comma
l_string|&quot;Region Type - %s (%X)&bslash;n&quot;
comma
id|acpi_ut_get_region_name
(paren
id|region_space
)paren
comma
id|region_space
)paren
)paren
suffix:semicolon
multiline_comment|/* Create the region descriptor */
id|obj_desc
op_assign
id|acpi_ut_create_internal_object
(paren
id|ACPI_TYPE_REGION
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|obj_desc
)paren
(brace
id|status
op_assign
id|AE_NO_MEMORY
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Remember location in AML stream of address &amp; length&n;&t; * operands since they need to be evaluated at run time.&n;&t; */
id|region_obj2
op_assign
id|obj_desc-&gt;common.next_object
suffix:semicolon
id|region_obj2-&gt;extra.aml_start
op_assign
id|aml_start
suffix:semicolon
id|region_obj2-&gt;extra.aml_length
op_assign
id|aml_length
suffix:semicolon
multiline_comment|/* Init the region from the operands */
id|obj_desc-&gt;region.space_id
op_assign
id|region_space
suffix:semicolon
id|obj_desc-&gt;region.address
op_assign
l_int|0
suffix:semicolon
id|obj_desc-&gt;region.length
op_assign
l_int|0
suffix:semicolon
id|obj_desc-&gt;region.node
op_assign
id|node
suffix:semicolon
multiline_comment|/* Install the new region object in the parent Node */
id|status
op_assign
id|acpi_ns_attach_object
(paren
id|node
comma
id|obj_desc
comma
id|ACPI_TYPE_REGION
)paren
suffix:semicolon
id|cleanup
suffix:colon
multiline_comment|/* Remove local reference to the object */
id|acpi_ut_remove_reference
(paren
id|obj_desc
)paren
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    acpi_ex_create_table_region&n; *&n; * PARAMETERS:  walk_state          - Current state&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Create a new data_table_region object&n; *&n; ****************************************************************************/
id|acpi_status
DECL|function|acpi_ex_create_table_region
id|acpi_ex_create_table_region
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
id|acpi_status
id|status
suffix:semicolon
r_union
id|acpi_operand_object
op_star
op_star
id|operand
op_assign
op_amp
id|walk_state-&gt;operands
(braket
l_int|0
)braket
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|obj_desc
suffix:semicolon
r_struct
id|acpi_namespace_node
op_star
id|node
suffix:semicolon
r_struct
id|acpi_table_header
op_star
id|table
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|region_obj2
suffix:semicolon
id|ACPI_FUNCTION_TRACE
(paren
l_string|&quot;ex_create_table_region&quot;
)paren
suffix:semicolon
multiline_comment|/* Get the Node from the object stack  */
id|node
op_assign
id|walk_state-&gt;op-&gt;common.node
suffix:semicolon
multiline_comment|/*&n;&t; * If the region object is already attached to this node,&n;&t; * just return&n;&t; */
r_if
c_cond
(paren
id|acpi_ns_get_attached_object
(paren
id|node
)paren
)paren
(brace
id|return_ACPI_STATUS
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/* Find the ACPI table */
id|status
op_assign
id|acpi_tb_find_table
(paren
id|operand
(braket
l_int|1
)braket
op_member_access_from_pointer
id|string.pointer
comma
id|operand
(braket
l_int|2
)braket
op_member_access_from_pointer
id|string.pointer
comma
id|operand
(braket
l_int|3
)braket
op_member_access_from_pointer
id|string.pointer
comma
op_amp
id|table
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/* Create the region descriptor */
id|obj_desc
op_assign
id|acpi_ut_create_internal_object
(paren
id|ACPI_TYPE_REGION
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|obj_desc
)paren
(brace
id|return_ACPI_STATUS
(paren
id|AE_NO_MEMORY
)paren
suffix:semicolon
)brace
id|region_obj2
op_assign
id|obj_desc-&gt;common.next_object
suffix:semicolon
id|region_obj2-&gt;extra.region_context
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Init the region from the operands */
id|obj_desc-&gt;region.space_id
op_assign
id|REGION_DATA_TABLE
suffix:semicolon
id|obj_desc-&gt;region.address
op_assign
(paren
id|acpi_physical_address
)paren
id|ACPI_TO_INTEGER
(paren
id|table
)paren
suffix:semicolon
id|obj_desc-&gt;region.length
op_assign
id|table-&gt;length
suffix:semicolon
id|obj_desc-&gt;region.node
op_assign
id|node
suffix:semicolon
id|obj_desc-&gt;region.flags
op_assign
id|AOPOBJ_DATA_VALID
suffix:semicolon
multiline_comment|/* Install the new region object in the parent Node */
id|status
op_assign
id|acpi_ns_attach_object
(paren
id|node
comma
id|obj_desc
comma
id|ACPI_TYPE_REGION
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
r_goto
id|cleanup
suffix:semicolon
)brace
id|status
op_assign
id|acpi_ev_initialize_region
(paren
id|obj_desc
comma
id|FALSE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
r_if
c_cond
(paren
id|status
op_eq
id|AE_NOT_EXIST
)paren
(brace
id|status
op_assign
id|AE_OK
suffix:semicolon
)brace
r_else
(brace
r_goto
id|cleanup
suffix:semicolon
)brace
)brace
id|obj_desc-&gt;region.flags
op_or_assign
id|AOPOBJ_SETUP_COMPLETE
suffix:semicolon
id|cleanup
suffix:colon
multiline_comment|/* Remove local reference to the object */
id|acpi_ut_remove_reference
(paren
id|obj_desc
)paren
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    acpi_ex_create_processor&n; *&n; * PARAMETERS:  walk_state          - Current state&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Create a new processor object and populate the fields&n; *&n; *              Processor (Name[0], cpu_iD[1], pblock_addr[2], pblock_length[3])&n; *&n; ****************************************************************************/
id|acpi_status
DECL|function|acpi_ex_create_processor
id|acpi_ex_create_processor
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
r_union
id|acpi_operand_object
op_star
op_star
id|operand
op_assign
op_amp
id|walk_state-&gt;operands
(braket
l_int|0
)braket
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|obj_desc
suffix:semicolon
id|acpi_status
id|status
suffix:semicolon
id|ACPI_FUNCTION_TRACE_PTR
(paren
l_string|&quot;ex_create_processor&quot;
comma
id|walk_state
)paren
suffix:semicolon
multiline_comment|/* Create the processor object */
id|obj_desc
op_assign
id|acpi_ut_create_internal_object
(paren
id|ACPI_TYPE_PROCESSOR
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|obj_desc
)paren
(brace
id|return_ACPI_STATUS
(paren
id|AE_NO_MEMORY
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Initialize the processor object from the operands&n;&t; */
id|obj_desc-&gt;processor.proc_id
op_assign
(paren
id|u8
)paren
id|operand
(braket
l_int|1
)braket
op_member_access_from_pointer
id|integer.value
suffix:semicolon
id|obj_desc-&gt;processor.address
op_assign
(paren
id|acpi_io_address
)paren
id|operand
(braket
l_int|2
)braket
op_member_access_from_pointer
id|integer.value
suffix:semicolon
id|obj_desc-&gt;processor.length
op_assign
(paren
id|u8
)paren
id|operand
(braket
l_int|3
)braket
op_member_access_from_pointer
id|integer.value
suffix:semicolon
multiline_comment|/* Install the processor object in the parent Node */
id|status
op_assign
id|acpi_ns_attach_object
(paren
(paren
r_struct
id|acpi_namespace_node
op_star
)paren
id|operand
(braket
l_int|0
)braket
comma
id|obj_desc
comma
id|ACPI_TYPE_PROCESSOR
)paren
suffix:semicolon
multiline_comment|/* Remove local reference to the object */
id|acpi_ut_remove_reference
(paren
id|obj_desc
)paren
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    acpi_ex_create_power_resource&n; *&n; * PARAMETERS:  walk_state          - Current state&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Create a new power_resource object and populate the fields&n; *&n; *              power_resource (Name[0], system_level[1], resource_order[2])&n; *&n; ****************************************************************************/
id|acpi_status
DECL|function|acpi_ex_create_power_resource
id|acpi_ex_create_power_resource
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
r_union
id|acpi_operand_object
op_star
op_star
id|operand
op_assign
op_amp
id|walk_state-&gt;operands
(braket
l_int|0
)braket
suffix:semicolon
id|acpi_status
id|status
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|obj_desc
suffix:semicolon
id|ACPI_FUNCTION_TRACE_PTR
(paren
l_string|&quot;ex_create_power_resource&quot;
comma
id|walk_state
)paren
suffix:semicolon
multiline_comment|/* Create the power resource object */
id|obj_desc
op_assign
id|acpi_ut_create_internal_object
(paren
id|ACPI_TYPE_POWER
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|obj_desc
)paren
(brace
id|return_ACPI_STATUS
(paren
id|AE_NO_MEMORY
)paren
suffix:semicolon
)brace
multiline_comment|/* Initialize the power object from the operands */
id|obj_desc-&gt;power_resource.system_level
op_assign
(paren
id|u8
)paren
id|operand
(braket
l_int|1
)braket
op_member_access_from_pointer
id|integer.value
suffix:semicolon
id|obj_desc-&gt;power_resource.resource_order
op_assign
(paren
id|u16
)paren
id|operand
(braket
l_int|2
)braket
op_member_access_from_pointer
id|integer.value
suffix:semicolon
multiline_comment|/* Install the  power resource object in the parent Node */
id|status
op_assign
id|acpi_ns_attach_object
(paren
(paren
r_struct
id|acpi_namespace_node
op_star
)paren
id|operand
(braket
l_int|0
)braket
comma
id|obj_desc
comma
id|ACPI_TYPE_POWER
)paren
suffix:semicolon
multiline_comment|/* Remove local reference to the object */
id|acpi_ut_remove_reference
(paren
id|obj_desc
)paren
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/*****************************************************************************&n; *&n; * FUNCTION:    acpi_ex_create_method&n; *&n; * PARAMETERS:  aml_start       - First byte of the method&squot;s AML&n; *              aml_length      - AML byte count for this method&n; *              walk_state      - Current state&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Create a new method object&n; *&n; ****************************************************************************/
id|acpi_status
DECL|function|acpi_ex_create_method
id|acpi_ex_create_method
(paren
id|u8
op_star
id|aml_start
comma
id|u32
id|aml_length
comma
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
r_union
id|acpi_operand_object
op_star
op_star
id|operand
op_assign
op_amp
id|walk_state-&gt;operands
(braket
l_int|0
)braket
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|obj_desc
suffix:semicolon
id|acpi_status
id|status
suffix:semicolon
id|u8
id|method_flags
suffix:semicolon
id|ACPI_FUNCTION_TRACE_PTR
(paren
l_string|&quot;ex_create_method&quot;
comma
id|walk_state
)paren
suffix:semicolon
multiline_comment|/* Create a new method object */
id|obj_desc
op_assign
id|acpi_ut_create_internal_object
(paren
id|ACPI_TYPE_METHOD
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|obj_desc
)paren
(brace
id|return_ACPI_STATUS
(paren
id|AE_NO_MEMORY
)paren
suffix:semicolon
)brace
multiline_comment|/* Save the method&squot;s AML pointer and length  */
id|obj_desc-&gt;method.aml_start
op_assign
id|aml_start
suffix:semicolon
id|obj_desc-&gt;method.aml_length
op_assign
id|aml_length
suffix:semicolon
multiline_comment|/*&n;&t; * Disassemble the method flags.  Split off the Arg Count&n;&t; * for efficiency&n;&t; */
id|method_flags
op_assign
(paren
id|u8
)paren
id|operand
(braket
l_int|1
)braket
op_member_access_from_pointer
id|integer.value
suffix:semicolon
id|obj_desc-&gt;method.method_flags
op_assign
(paren
id|u8
)paren
(paren
id|method_flags
op_amp
op_complement
id|AML_METHOD_ARG_COUNT
)paren
suffix:semicolon
id|obj_desc-&gt;method.param_count
op_assign
(paren
id|u8
)paren
(paren
id|method_flags
op_amp
id|AML_METHOD_ARG_COUNT
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Get the concurrency count.  If required, a semaphore will be&n;&t; * created for this method when it is parsed.&n;&t; */
r_if
c_cond
(paren
id|acpi_gbl_all_methods_serialized
)paren
(brace
id|obj_desc-&gt;method.concurrency
op_assign
l_int|1
suffix:semicolon
id|obj_desc-&gt;method.method_flags
op_or_assign
id|AML_METHOD_SERIALIZED
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|method_flags
op_amp
id|AML_METHOD_SERIALIZED
)paren
(brace
multiline_comment|/*&n;&t;&t; * ACPI 1.0: Concurrency = 1&n;&t;&t; * ACPI 2.0: Concurrency = (sync_level (in method declaration) + 1)&n;&t;&t; */
id|obj_desc-&gt;method.concurrency
op_assign
(paren
id|u8
)paren
(paren
(paren
(paren
id|method_flags
op_amp
id|AML_METHOD_SYNCH_LEVEL
)paren
op_rshift
l_int|4
)paren
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
id|obj_desc-&gt;method.concurrency
op_assign
id|ACPI_INFINITE_CONCURRENCY
suffix:semicolon
)brace
multiline_comment|/* Attach the new object to the method Node */
id|status
op_assign
id|acpi_ns_attach_object
(paren
(paren
r_struct
id|acpi_namespace_node
op_star
)paren
id|operand
(braket
l_int|0
)braket
comma
id|obj_desc
comma
id|ACPI_TYPE_METHOD
)paren
suffix:semicolon
multiline_comment|/* Remove local reference to the object */
id|acpi_ut_remove_reference
(paren
id|obj_desc
)paren
suffix:semicolon
multiline_comment|/* Remove a reference to the operand */
id|acpi_ut_remove_reference
(paren
id|operand
(braket
l_int|1
)braket
)paren
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
eof
