multiline_comment|/******************************************************************************&n; *&n; * Module Name: exoparg1 - AML execution - opcodes with 1 argument&n; *&n; *****************************************************************************/
multiline_comment|/*&n; * Copyright (C) 2000 - 2004, R. Byron Moore&n; * All rights reserved.&n; *&n; * Redistribution and use in source and binary forms, with or without&n; * modification, are permitted provided that the following conditions&n; * are met:&n; * 1. Redistributions of source code must retain the above copyright&n; *    notice, this list of conditions, and the following disclaimer,&n; *    without modification.&n; * 2. Redistributions in binary form must reproduce at minimum a disclaimer&n; *    substantially similar to the &quot;NO WARRANTY&quot; disclaimer below&n; *    (&quot;Disclaimer&quot;) and any redistribution must be conditioned upon&n; *    including a substantially similar Disclaimer requirement for further&n; *    binary redistribution.&n; * 3. Neither the names of the above-listed copyright holders nor the names&n; *    of any contributors may be used to endorse or promote products derived&n; *    from this software without specific prior written permission.&n; *&n; * Alternatively, this software may be distributed under the terms of the&n; * GNU General Public License (&quot;GPL&quot;) version 2 as published by the Free&n; * Software Foundation.&n; *&n; * NO WARRANTY&n; * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS&n; * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT&n; * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR&n; * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT&n; * HOLDERS OR CONTRIBUTORS BE LIABLE FOR SPECIAL, EXEMPLARY, OR CONSEQUENTIAL&n; * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS&n; * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)&n; * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,&n; * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING&n; * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE&n; * POSSIBILITY OF SUCH DAMAGES.&n; */
macro_line|#include &lt;acpi/acpi.h&gt;
macro_line|#include &lt;acpi/acparser.h&gt;
macro_line|#include &lt;acpi/acdispat.h&gt;
macro_line|#include &lt;acpi/acinterp.h&gt;
macro_line|#include &lt;acpi/amlcode.h&gt;
macro_line|#include &lt;acpi/acnamesp.h&gt;
DECL|macro|_COMPONENT
mdefine_line|#define _COMPONENT          ACPI_EXECUTER
id|ACPI_MODULE_NAME
(paren
l_string|&quot;exoparg1&quot;
)paren
multiline_comment|/*!&n; * Naming convention for AML interpreter execution routines.&n; *&n; * The routines that begin execution of AML opcodes are named with a common&n; * convention based upon the number of arguments, the number of target operands,&n; * and whether or not a value is returned:&n; *&n; *      AcpiExOpcode_xA_yT_zR&n; *&n; * Where:&n; *&n; * xA - ARGUMENTS:    The number of arguments (input operands) that are&n; *                    required for this opcode type (0 through 6 args).&n; * yT - TARGETS:      The number of targets (output operands) that are required&n; *                    for this opcode type (0, 1, or 2 targets).&n; * zR - RETURN VALUE: Indicates whether this opcode type returns a value&n; *                    as the function return (0 or 1).&n; *&n; * The AcpiExOpcode* functions are called via the Dispatcher component with&n; * fully resolved operands.&n;!*/
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ex_opcode_0A_0T_1R&n; *&n; * PARAMETERS:  walk_state          - Current state (contains AML opcode)&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Execute operator with no operands, one return value&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ex_opcode_0A_0T_1R
id|acpi_ex_opcode_0A_0T_1R
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
id|acpi_status
id|status
op_assign
id|AE_OK
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|return_desc
op_assign
l_int|NULL
suffix:semicolon
id|ACPI_FUNCTION_TRACE_STR
(paren
l_string|&quot;ex_opcode_0A_0T_1R&quot;
comma
id|acpi_ps_get_opcode_name
(paren
id|walk_state-&gt;opcode
)paren
)paren
suffix:semicolon
multiline_comment|/* Examine the AML opcode */
r_switch
c_cond
(paren
id|walk_state-&gt;opcode
)paren
(brace
r_case
id|AML_TIMER_OP
suffix:colon
multiline_comment|/*  Timer () */
multiline_comment|/* Create a return object of type Integer */
id|return_desc
op_assign
id|acpi_ut_create_internal_object
(paren
id|ACPI_TYPE_INTEGER
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|return_desc
)paren
(brace
id|status
op_assign
id|AE_NO_MEMORY
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
id|return_desc-&gt;integer.value
op_assign
id|acpi_os_get_timer
(paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/*  Unknown opcode  */
id|ACPI_REPORT_ERROR
(paren
(paren
l_string|&quot;acpi_ex_opcode_0A_0T_1R: Unknown opcode %X&bslash;n&quot;
comma
id|walk_state-&gt;opcode
)paren
)paren
suffix:semicolon
id|status
op_assign
id|AE_AML_BAD_OPCODE
suffix:semicolon
r_break
suffix:semicolon
)brace
id|cleanup
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|walk_state-&gt;result_obj
)paren
(brace
id|walk_state-&gt;result_obj
op_assign
id|return_desc
suffix:semicolon
)brace
multiline_comment|/* Delete return object on error */
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
id|acpi_ut_remove_reference
(paren
id|return_desc
)paren
suffix:semicolon
)brace
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ex_opcode_1A_0T_0R&n; *&n; * PARAMETERS:  walk_state          - Current state (contains AML opcode)&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Execute Type 1 monadic operator with numeric operand on&n; *              object stack&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ex_opcode_1A_0T_0R
id|acpi_ex_opcode_1A_0T_0R
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
r_union
id|acpi_operand_object
op_star
op_star
id|operand
op_assign
op_amp
id|walk_state-&gt;operands
(braket
l_int|0
)braket
suffix:semicolon
id|acpi_status
id|status
op_assign
id|AE_OK
suffix:semicolon
id|ACPI_FUNCTION_TRACE_STR
(paren
l_string|&quot;ex_opcode_1A_0T_0R&quot;
comma
id|acpi_ps_get_opcode_name
(paren
id|walk_state-&gt;opcode
)paren
)paren
suffix:semicolon
multiline_comment|/* Examine the AML opcode */
r_switch
c_cond
(paren
id|walk_state-&gt;opcode
)paren
(brace
r_case
id|AML_RELEASE_OP
suffix:colon
multiline_comment|/*  Release (mutex_object) */
id|status
op_assign
id|acpi_ex_release_mutex
(paren
id|operand
(braket
l_int|0
)braket
comma
id|walk_state
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AML_RESET_OP
suffix:colon
multiline_comment|/*  Reset (event_object) */
id|status
op_assign
id|acpi_ex_system_reset_event
(paren
id|operand
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AML_SIGNAL_OP
suffix:colon
multiline_comment|/*  Signal (event_object) */
id|status
op_assign
id|acpi_ex_system_signal_event
(paren
id|operand
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AML_SLEEP_OP
suffix:colon
multiline_comment|/*  Sleep (msec_time) */
id|status
op_assign
id|acpi_ex_system_do_suspend
(paren
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|integer.value
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AML_STALL_OP
suffix:colon
multiline_comment|/*  Stall (usec_time) */
id|status
op_assign
id|acpi_ex_system_do_stall
(paren
(paren
id|u32
)paren
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|integer.value
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AML_UNLOAD_OP
suffix:colon
multiline_comment|/*  Unload (Handle) */
id|status
op_assign
id|acpi_ex_unload_table
(paren
id|operand
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/*  Unknown opcode  */
id|ACPI_REPORT_ERROR
(paren
(paren
l_string|&quot;acpi_ex_opcode_1A_0T_0R: Unknown opcode %X&bslash;n&quot;
comma
id|walk_state-&gt;opcode
)paren
)paren
suffix:semicolon
id|status
op_assign
id|AE_AML_BAD_OPCODE
suffix:semicolon
r_break
suffix:semicolon
)brace
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ex_opcode_1A_1T_0R&n; *&n; * PARAMETERS:  walk_state          - Current state (contains AML opcode)&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Execute opcode with one argument, one target, and no&n; *              return value.&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ex_opcode_1A_1T_0R
id|acpi_ex_opcode_1A_1T_0R
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
id|acpi_status
id|status
op_assign
id|AE_OK
suffix:semicolon
r_union
id|acpi_operand_object
op_star
op_star
id|operand
op_assign
op_amp
id|walk_state-&gt;operands
(braket
l_int|0
)braket
suffix:semicolon
id|ACPI_FUNCTION_TRACE_STR
(paren
l_string|&quot;ex_opcode_1A_1T_0R&quot;
comma
id|acpi_ps_get_opcode_name
(paren
id|walk_state-&gt;opcode
)paren
)paren
suffix:semicolon
multiline_comment|/* Examine the AML opcode */
r_switch
c_cond
(paren
id|walk_state-&gt;opcode
)paren
(brace
r_case
id|AML_LOAD_OP
suffix:colon
id|status
op_assign
id|acpi_ex_load_op
(paren
id|operand
(braket
l_int|0
)braket
comma
id|operand
(braket
l_int|1
)braket
comma
id|walk_state
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* Unknown opcode */
id|ACPI_REPORT_ERROR
(paren
(paren
l_string|&quot;acpi_ex_opcode_1A_1T_0R: Unknown opcode %X&bslash;n&quot;
comma
id|walk_state-&gt;opcode
)paren
)paren
suffix:semicolon
id|status
op_assign
id|AE_AML_BAD_OPCODE
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
id|cleanup
suffix:colon
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ex_opcode_1A_1T_1R&n; *&n; * PARAMETERS:  walk_state          - Current state (contains AML opcode)&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Execute opcode with one argument, one target, and a&n; *              return value.&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ex_opcode_1A_1T_1R
id|acpi_ex_opcode_1A_1T_1R
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
id|acpi_status
id|status
op_assign
id|AE_OK
suffix:semicolon
r_union
id|acpi_operand_object
op_star
op_star
id|operand
op_assign
op_amp
id|walk_state-&gt;operands
(braket
l_int|0
)braket
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|return_desc
op_assign
l_int|NULL
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|return_desc2
op_assign
l_int|NULL
suffix:semicolon
id|u32
id|temp32
suffix:semicolon
id|u32
id|i
suffix:semicolon
id|acpi_integer
id|power_of_ten
suffix:semicolon
id|acpi_integer
id|digit
suffix:semicolon
id|ACPI_FUNCTION_TRACE_STR
(paren
l_string|&quot;ex_opcode_1A_1T_1R&quot;
comma
id|acpi_ps_get_opcode_name
(paren
id|walk_state-&gt;opcode
)paren
)paren
suffix:semicolon
multiline_comment|/* Examine the AML opcode */
r_switch
c_cond
(paren
id|walk_state-&gt;opcode
)paren
(brace
r_case
id|AML_BIT_NOT_OP
suffix:colon
r_case
id|AML_FIND_SET_LEFT_BIT_OP
suffix:colon
r_case
id|AML_FIND_SET_RIGHT_BIT_OP
suffix:colon
r_case
id|AML_FROM_BCD_OP
suffix:colon
r_case
id|AML_TO_BCD_OP
suffix:colon
r_case
id|AML_COND_REF_OF_OP
suffix:colon
multiline_comment|/* Create a return object of type Integer for these opcodes */
id|return_desc
op_assign
id|acpi_ut_create_internal_object
(paren
id|ACPI_TYPE_INTEGER
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|return_desc
)paren
(brace
id|status
op_assign
id|AE_NO_MEMORY
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|walk_state-&gt;opcode
)paren
(brace
r_case
id|AML_BIT_NOT_OP
suffix:colon
multiline_comment|/* Not (Operand, Result)  */
id|return_desc-&gt;integer.value
op_assign
op_complement
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|integer.value
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AML_FIND_SET_LEFT_BIT_OP
suffix:colon
multiline_comment|/* find_set_left_bit (Operand, Result) */
id|return_desc-&gt;integer.value
op_assign
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|integer.value
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * Acpi specification describes Integer type as a little&n;&t;&t;&t; * endian unsigned value, so this boundary condition is valid.&n;&t;&t;&t; */
r_for
c_loop
(paren
id|temp32
op_assign
l_int|0
suffix:semicolon
id|return_desc-&gt;integer.value
op_logical_and
id|temp32
OL
id|ACPI_INTEGER_BIT_SIZE
suffix:semicolon
op_increment
id|temp32
)paren
(brace
id|return_desc-&gt;integer.value
op_rshift_assign
l_int|1
suffix:semicolon
)brace
id|return_desc-&gt;integer.value
op_assign
id|temp32
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AML_FIND_SET_RIGHT_BIT_OP
suffix:colon
multiline_comment|/* find_set_right_bit (Operand, Result) */
id|return_desc-&gt;integer.value
op_assign
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|integer.value
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * The Acpi specification describes Integer type as a little&n;&t;&t;&t; * endian unsigned value, so this boundary condition is valid.&n;&t;&t;&t; */
r_for
c_loop
(paren
id|temp32
op_assign
l_int|0
suffix:semicolon
id|return_desc-&gt;integer.value
op_logical_and
id|temp32
OL
id|ACPI_INTEGER_BIT_SIZE
suffix:semicolon
op_increment
id|temp32
)paren
(brace
id|return_desc-&gt;integer.value
op_lshift_assign
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Since the bit position is one-based, subtract from 33 (65) */
id|return_desc-&gt;integer.value
op_assign
id|temp32
op_eq
l_int|0
ques
c_cond
l_int|0
suffix:colon
(paren
id|ACPI_INTEGER_BIT_SIZE
op_plus
l_int|1
)paren
op_minus
id|temp32
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AML_FROM_BCD_OP
suffix:colon
multiline_comment|/* from_bcd (BCDValue, Result) */
multiline_comment|/*&n;&t;&t;&t; * The 64-bit ACPI integer can hold 16 4-bit BCD characters&n;&t;&t;&t; * (if table is 32-bit, integer can hold 8 BCD characters)&n;&t;&t;&t; * Convert each 4-bit BCD value&n;&t;&t;&t; */
id|power_of_ten
op_assign
l_int|1
suffix:semicolon
id|return_desc-&gt;integer.value
op_assign
l_int|0
suffix:semicolon
id|digit
op_assign
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|integer.value
suffix:semicolon
multiline_comment|/* Convert each BCD digit (each is one nybble wide) */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|i
OL
id|acpi_gbl_integer_nybble_width
)paren
op_logical_and
(paren
id|digit
OG
l_int|0
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
multiline_comment|/* Get the least significant 4-bit BCD digit */
id|temp32
op_assign
(paren
(paren
id|u32
)paren
id|digit
)paren
op_amp
l_int|0xF
suffix:semicolon
multiline_comment|/* Check the range of the digit */
r_if
c_cond
(paren
id|temp32
OG
l_int|9
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;BCD digit too large (not decimal): 0x%X&bslash;n&quot;
comma
id|temp32
)paren
)paren
suffix:semicolon
id|status
op_assign
id|AE_AML_NUMERIC_OVERFLOW
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
multiline_comment|/* Sum the digit into the result with the current power of 10 */
id|return_desc-&gt;integer.value
op_add_assign
(paren
(paren
(paren
id|acpi_integer
)paren
id|temp32
)paren
op_star
id|power_of_ten
)paren
suffix:semicolon
multiline_comment|/* Shift to next BCD digit */
id|digit
op_rshift_assign
l_int|4
suffix:semicolon
multiline_comment|/* Next power of 10 */
id|power_of_ten
op_mul_assign
l_int|10
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AML_TO_BCD_OP
suffix:colon
multiline_comment|/* to_bcd (Operand, Result) */
id|return_desc-&gt;integer.value
op_assign
l_int|0
suffix:semicolon
id|digit
op_assign
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|integer.value
suffix:semicolon
multiline_comment|/* Each BCD digit is one nybble wide */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
(paren
id|i
OL
id|acpi_gbl_integer_nybble_width
)paren
op_logical_and
(paren
id|digit
OG
l_int|0
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
(paren
r_void
)paren
id|acpi_ut_short_divide
(paren
id|digit
comma
l_int|10
comma
op_amp
id|digit
comma
op_amp
id|temp32
)paren
suffix:semicolon
multiline_comment|/* Insert the BCD digit that resides in the remainder from above */
id|return_desc-&gt;integer.value
op_or_assign
(paren
(paren
(paren
id|acpi_integer
)paren
id|temp32
)paren
op_lshift
id|ACPI_MUL_4
(paren
id|i
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Overflow if there is any data left in Digit */
r_if
c_cond
(paren
id|digit
OG
l_int|0
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Integer too large to convert to BCD: %8.8X%8.8X&bslash;n&quot;
comma
id|ACPI_FORMAT_UINT64
(paren
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|integer.value
)paren
)paren
)paren
suffix:semicolon
id|status
op_assign
id|AE_AML_NUMERIC_OVERFLOW
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AML_COND_REF_OF_OP
suffix:colon
multiline_comment|/* cond_ref_of (source_object, Result) */
multiline_comment|/*&n;&t;&t;&t; * This op is a little strange because the internal return value is&n;&t;&t;&t; * different than the return value stored in the result descriptor&n;&t;&t;&t; * (There are really two return values)&n;&t;&t;&t; */
r_if
c_cond
(paren
(paren
r_struct
id|acpi_namespace_node
op_star
)paren
id|operand
(braket
l_int|0
)braket
op_eq
id|acpi_gbl_root_node
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * This means that the object does not exist in the namespace,&n;&t;&t;&t;&t; * return FALSE&n;&t;&t;&t;&t; */
id|return_desc-&gt;integer.value
op_assign
l_int|0
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
multiline_comment|/* Get the object reference, store it, and remove our reference */
id|status
op_assign
id|acpi_ex_get_object_reference
(paren
id|operand
(braket
l_int|0
)braket
comma
op_amp
id|return_desc2
comma
id|walk_state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
r_goto
id|cleanup
suffix:semicolon
)brace
id|status
op_assign
id|acpi_ex_store
(paren
id|return_desc2
comma
id|operand
(braket
l_int|1
)braket
comma
id|walk_state
)paren
suffix:semicolon
id|acpi_ut_remove_reference
(paren
id|return_desc2
)paren
suffix:semicolon
multiline_comment|/* The object exists in the namespace, return TRUE */
id|return_desc-&gt;integer.value
op_assign
id|ACPI_INTEGER_MAX
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* No other opcodes get here */
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AML_STORE_OP
suffix:colon
multiline_comment|/* Store (Source, Target) */
multiline_comment|/*&n;&t;&t; * A store operand is typically a number, string, buffer or lvalue&n;&t;&t; * Be careful about deleting the source object,&n;&t;&t; * since the object itself may have been stored.&n;&t;&t; */
id|status
op_assign
id|acpi_ex_store
(paren
id|operand
(braket
l_int|0
)braket
comma
id|operand
(braket
l_int|1
)braket
comma
id|walk_state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/* It is possible that the Store already produced a return object */
r_if
c_cond
(paren
op_logical_neg
id|walk_state-&gt;result_obj
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * Normally, we would remove a reference on the Operand[0] parameter;&n;&t;&t;&t; * But since it is being used as the internal return object&n;&t;&t;&t; * (meaning we would normally increment it), the two cancel out,&n;&t;&t;&t; * and we simply don&squot;t do anything.&n;&t;&t;&t; */
id|walk_state-&gt;result_obj
op_assign
id|operand
(braket
l_int|0
)braket
suffix:semicolon
id|walk_state-&gt;operands
(braket
l_int|0
)braket
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* Prevent deletion */
)brace
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * ACPI 2.0 Opcodes&n;&t; */
r_case
id|AML_COPY_OP
suffix:colon
multiline_comment|/* Copy (Source, Target) */
id|status
op_assign
id|acpi_ut_copy_iobject_to_iobject
(paren
id|operand
(braket
l_int|0
)braket
comma
op_amp
id|return_desc
comma
id|walk_state
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AML_TO_DECSTRING_OP
suffix:colon
multiline_comment|/* to_decimal_string (Data, Result) */
id|status
op_assign
id|acpi_ex_convert_to_string
(paren
id|operand
(braket
l_int|0
)braket
comma
op_amp
id|return_desc
comma
id|ACPI_EXPLICIT_CONVERT_DECIMAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|return_desc
op_eq
id|operand
(braket
l_int|0
)braket
)paren
(brace
multiline_comment|/* No conversion performed, add ref to handle return value */
id|acpi_ut_add_reference
(paren
id|return_desc
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AML_TO_HEXSTRING_OP
suffix:colon
multiline_comment|/* to_hex_string (Data, Result) */
id|status
op_assign
id|acpi_ex_convert_to_string
(paren
id|operand
(braket
l_int|0
)braket
comma
op_amp
id|return_desc
comma
id|ACPI_EXPLICIT_CONVERT_HEX
)paren
suffix:semicolon
r_if
c_cond
(paren
id|return_desc
op_eq
id|operand
(braket
l_int|0
)braket
)paren
(brace
multiline_comment|/* No conversion performed, add ref to handle return value */
id|acpi_ut_add_reference
(paren
id|return_desc
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AML_TO_BUFFER_OP
suffix:colon
multiline_comment|/* to_buffer (Data, Result) */
id|status
op_assign
id|acpi_ex_convert_to_buffer
(paren
id|operand
(braket
l_int|0
)braket
comma
op_amp
id|return_desc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|return_desc
op_eq
id|operand
(braket
l_int|0
)braket
)paren
(brace
multiline_comment|/* No conversion performed, add ref to handle return value */
id|acpi_ut_add_reference
(paren
id|return_desc
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AML_TO_INTEGER_OP
suffix:colon
multiline_comment|/* to_integer (Data, Result) */
id|status
op_assign
id|acpi_ex_convert_to_integer
(paren
id|operand
(braket
l_int|0
)braket
comma
op_amp
id|return_desc
comma
id|ACPI_ANY_BASE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|return_desc
op_eq
id|operand
(braket
l_int|0
)braket
)paren
(brace
multiline_comment|/* No conversion performed, add ref to handle return value */
id|acpi_ut_add_reference
(paren
id|return_desc
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AML_SHIFT_LEFT_BIT_OP
suffix:colon
multiline_comment|/* shift_left_bit (Source, bit_num) */
r_case
id|AML_SHIFT_RIGHT_BIT_OP
suffix:colon
multiline_comment|/* shift_right_bit (Source, bit_num) */
multiline_comment|/*&n;&t;&t; * These are two obsolete opcodes&n;&t;&t; */
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;%s is obsolete and not implemented&bslash;n&quot;
comma
id|acpi_ps_get_opcode_name
(paren
id|walk_state-&gt;opcode
)paren
)paren
)paren
suffix:semicolon
id|status
op_assign
id|AE_SUPPORT
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* Unknown opcode */
id|ACPI_REPORT_ERROR
(paren
(paren
l_string|&quot;acpi_ex_opcode_1A_1T_1R: Unknown opcode %X&bslash;n&quot;
comma
id|walk_state-&gt;opcode
)paren
)paren
suffix:semicolon
id|status
op_assign
id|AE_AML_BAD_OPCODE
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ACPI_SUCCESS
(paren
id|status
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * Store the return value computed above into the target object&n;&t;&t; */
id|status
op_assign
id|acpi_ex_store
(paren
id|return_desc
comma
id|operand
(braket
l_int|1
)braket
comma
id|walk_state
)paren
suffix:semicolon
)brace
id|cleanup
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|walk_state-&gt;result_obj
)paren
(brace
id|walk_state-&gt;result_obj
op_assign
id|return_desc
suffix:semicolon
)brace
multiline_comment|/* Delete return object on error */
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
id|acpi_ut_remove_reference
(paren
id|return_desc
)paren
suffix:semicolon
)brace
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ex_opcode_1A_0T_1R&n; *&n; * PARAMETERS:  walk_state          - Current state (contains AML opcode)&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Execute opcode with one argument, no target, and a return value&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ex_opcode_1A_0T_1R
id|acpi_ex_opcode_1A_0T_1R
(paren
r_struct
id|acpi_walk_state
op_star
id|walk_state
)paren
(brace
r_union
id|acpi_operand_object
op_star
op_star
id|operand
op_assign
op_amp
id|walk_state-&gt;operands
(braket
l_int|0
)braket
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|temp_desc
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|return_desc
op_assign
l_int|NULL
suffix:semicolon
id|acpi_status
id|status
op_assign
id|AE_OK
suffix:semicolon
id|u32
id|type
suffix:semicolon
id|acpi_integer
id|value
suffix:semicolon
id|ACPI_FUNCTION_TRACE_STR
(paren
l_string|&quot;ex_opcode_1A_0T_1R&quot;
comma
id|acpi_ps_get_opcode_name
(paren
id|walk_state-&gt;opcode
)paren
)paren
suffix:semicolon
multiline_comment|/* Examine the AML opcode */
r_switch
c_cond
(paren
id|walk_state-&gt;opcode
)paren
(brace
r_case
id|AML_LNOT_OP
suffix:colon
multiline_comment|/* LNot (Operand) */
id|return_desc
op_assign
id|acpi_ut_create_internal_object
(paren
id|ACPI_TYPE_INTEGER
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|return_desc
)paren
(brace
id|status
op_assign
id|AE_NO_MEMORY
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Set result to ONES (TRUE) if Value == 0.  Note:&n;&t;&t; * return_desc-&gt;Integer.Value is initially == 0 (FALSE) from above.&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|integer.value
)paren
(brace
id|return_desc-&gt;integer.value
op_assign
id|ACPI_INTEGER_MAX
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AML_DECREMENT_OP
suffix:colon
multiline_comment|/* Decrement (Operand)  */
r_case
id|AML_INCREMENT_OP
suffix:colon
multiline_comment|/* Increment (Operand)  */
multiline_comment|/*&n;&t;&t; * Create a new integer.  Can&squot;t just get the base integer and&n;&t;&t; * increment it because it may be an Arg or Field.&n;&t;&t; */
id|return_desc
op_assign
id|acpi_ut_create_internal_object
(paren
id|ACPI_TYPE_INTEGER
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|return_desc
)paren
(brace
id|status
op_assign
id|AE_NO_MEMORY
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Since we are expecting a Reference operand, it can be either a&n;&t;&t; * NS Node or an internal object.&n;&t;&t; */
id|temp_desc
op_assign
id|operand
(braket
l_int|0
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_GET_DESCRIPTOR_TYPE
(paren
id|temp_desc
)paren
op_eq
id|ACPI_DESC_TYPE_OPERAND
)paren
(brace
multiline_comment|/* Internal reference object - prevent deletion */
id|acpi_ut_add_reference
(paren
id|temp_desc
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Convert the Reference operand to an Integer (This removes a&n;&t;&t; * reference on the Operand[0] object)&n;&t;&t; *&n;&t;&t; * NOTE:  We use LNOT_OP here in order to force resolution of the&n;&t;&t; * reference operand to an actual integer.&n;&t;&t; */
id|status
op_assign
id|acpi_ex_resolve_operands
(paren
id|AML_LNOT_OP
comma
op_amp
id|temp_desc
comma
id|walk_state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;%s: bad operand(s) %s&bslash;n&quot;
comma
id|acpi_ps_get_opcode_name
(paren
id|walk_state-&gt;opcode
)paren
comma
id|acpi_format_exception
c_func
(paren
id|status
)paren
)paren
)paren
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * temp_desc is now guaranteed to be an Integer object --&n;&t;&t; * Perform the actual increment or decrement&n;&t;&t; */
r_if
c_cond
(paren
id|walk_state-&gt;opcode
op_eq
id|AML_INCREMENT_OP
)paren
(brace
id|return_desc-&gt;integer.value
op_assign
id|temp_desc-&gt;integer.value
op_plus
l_int|1
suffix:semicolon
)brace
r_else
(brace
id|return_desc-&gt;integer.value
op_assign
id|temp_desc-&gt;integer.value
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Finished with this Integer object */
id|acpi_ut_remove_reference
(paren
id|temp_desc
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Store the result back (indirectly) through the original&n;&t;&t; * Reference object&n;&t;&t; */
id|status
op_assign
id|acpi_ex_store
(paren
id|return_desc
comma
id|operand
(braket
l_int|0
)braket
comma
id|walk_state
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AML_TYPE_OP
suffix:colon
multiline_comment|/* object_type (source_object) */
multiline_comment|/*&n;&t;&t; * Note: The operand is not resolved at this point because we want to&n;&t;&t; * get the associated object, not its value.  For example, we don&squot;t want&n;&t;&t; * to resolve a field_unit to its value, we want the actual field_unit&n;&t;&t; * object.&n;&t;&t; */
multiline_comment|/* Get the type of the base object */
id|status
op_assign
id|acpi_ex_resolve_multiple
(paren
id|walk_state
comma
id|operand
(braket
l_int|0
)braket
comma
op_amp
id|type
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
r_goto
id|cleanup
suffix:semicolon
)brace
multiline_comment|/* Allocate a descriptor to hold the type. */
id|return_desc
op_assign
id|acpi_ut_create_internal_object
(paren
id|ACPI_TYPE_INTEGER
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|return_desc
)paren
(brace
id|status
op_assign
id|AE_NO_MEMORY
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
id|return_desc-&gt;integer.value
op_assign
id|type
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AML_SIZE_OF_OP
suffix:colon
multiline_comment|/* size_of (source_object) */
multiline_comment|/*&n;&t;&t; * Note: The operand is not resolved at this point because we want to&n;&t;&t; * get the associated object, not its value.&n;&t;&t; */
multiline_comment|/* Get the base object */
id|status
op_assign
id|acpi_ex_resolve_multiple
(paren
id|walk_state
comma
id|operand
(braket
l_int|0
)braket
comma
op_amp
id|type
comma
op_amp
id|temp_desc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
r_goto
id|cleanup
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * The type of the base object must be integer, buffer, string, or&n;&t;&t; * package.  All others are not supported.&n;&t;&t; *&n;&t;&t; * NOTE: Integer is not specifically supported by the ACPI spec,&n;&t;&t; * but is supported implicitly via implicit operand conversion.&n;&t;&t; * rather than bother with conversion, we just use the byte width&n;&t;&t; * global (4 or 8 bytes).&n;&t;&t; */
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|ACPI_TYPE_INTEGER
suffix:colon
id|value
op_assign
id|acpi_gbl_integer_byte_width
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_TYPE_BUFFER
suffix:colon
id|value
op_assign
id|temp_desc-&gt;buffer.length
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_TYPE_STRING
suffix:colon
id|value
op_assign
id|temp_desc-&gt;string.length
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_TYPE_PACKAGE
suffix:colon
id|value
op_assign
id|temp_desc-&gt;package.count
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;size_of - Operand is not Buf/Int/Str/Pkg - found type %s&bslash;n&quot;
comma
id|acpi_ut_get_type_name
(paren
id|type
)paren
)paren
)paren
suffix:semicolon
id|status
op_assign
id|AE_AML_OPERAND_TYPE
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Now that we have the size of the object, create a result&n;&t;&t; * object to hold the value&n;&t;&t; */
id|return_desc
op_assign
id|acpi_ut_create_internal_object
(paren
id|ACPI_TYPE_INTEGER
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|return_desc
)paren
(brace
id|status
op_assign
id|AE_NO_MEMORY
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
id|return_desc-&gt;integer.value
op_assign
id|value
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AML_REF_OF_OP
suffix:colon
multiline_comment|/* ref_of (source_object) */
id|status
op_assign
id|acpi_ex_get_object_reference
(paren
id|operand
(braket
l_int|0
)braket
comma
op_amp
id|return_desc
comma
id|walk_state
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
r_goto
id|cleanup
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AML_DEREF_OF_OP
suffix:colon
multiline_comment|/* deref_of (obj_reference | String) */
multiline_comment|/* Check for a method local or argument, or standalone String */
r_if
c_cond
(paren
id|ACPI_GET_DESCRIPTOR_TYPE
(paren
id|operand
(braket
l_int|0
)braket
)paren
op_ne
id|ACPI_DESC_TYPE_NAMED
)paren
(brace
r_switch
c_cond
(paren
id|ACPI_GET_OBJECT_TYPE
(paren
id|operand
(braket
l_int|0
)braket
)paren
)paren
(brace
r_case
id|ACPI_TYPE_LOCAL_REFERENCE
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * This is a deref_of (local_x | arg_x)&n;&t;&t;&t;&t; *&n;&t;&t;&t;&t; * Must resolve/dereference the local/arg reference first&n;&t;&t;&t;&t; */
r_switch
c_cond
(paren
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|reference.opcode
)paren
(brace
r_case
id|AML_LOCAL_OP
suffix:colon
r_case
id|AML_ARG_OP
suffix:colon
multiline_comment|/* Set Operand[0] to the value of the local/arg */
id|status
op_assign
id|acpi_ds_method_data_get_value
(paren
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|reference.opcode
comma
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|reference.offset
comma
id|walk_state
comma
op_amp
id|temp_desc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
r_goto
id|cleanup
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t;&t;&t; * Delete our reference to the input object and&n;&t;&t;&t;&t;&t; * point to the object just retrieved&n;&t;&t;&t;&t;&t; */
id|acpi_ut_remove_reference
(paren
id|operand
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|operand
(braket
l_int|0
)braket
op_assign
id|temp_desc
suffix:semicolon
r_break
suffix:semicolon
r_case
id|AML_REF_OF_OP
suffix:colon
multiline_comment|/* Get the object to which the reference refers */
id|temp_desc
op_assign
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|reference.object
suffix:semicolon
id|acpi_ut_remove_reference
(paren
id|operand
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|operand
(braket
l_int|0
)braket
op_assign
id|temp_desc
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* Must be an Index op - handled below */
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ACPI_TYPE_STRING
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * This is a deref_of (String). The string is a reference to a named ACPI object.&n;&t;&t;&t;&t; *&n;&t;&t;&t;&t; * 1) Find the owning Node&n;&t;&t;&t;&t; * 2) Dereference the node to an actual object.  Could be a Field, so we nee&n;&t;&t;&t;&t; *    to resolve the node to a value.&n;&t;&t;&t;&t; */
id|status
op_assign
id|acpi_ns_get_node_by_path
(paren
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|string.pointer
comma
id|walk_state-&gt;scope_info-&gt;scope.node
comma
id|ACPI_NS_SEARCH_PARENT
comma
id|ACPI_CAST_INDIRECT_PTR
(paren
r_struct
id|acpi_namespace_node
comma
op_amp
id|return_desc
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
r_goto
id|cleanup
suffix:semicolon
)brace
id|status
op_assign
id|acpi_ex_resolve_node_to_value
(paren
id|ACPI_CAST_INDIRECT_PTR
(paren
r_struct
id|acpi_namespace_node
comma
op_amp
id|return_desc
)paren
comma
id|walk_state
)paren
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
r_default
suffix:colon
id|status
op_assign
id|AE_AML_OPERAND_TYPE
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
)brace
multiline_comment|/* Operand[0] may have changed from the code above */
r_if
c_cond
(paren
id|ACPI_GET_DESCRIPTOR_TYPE
(paren
id|operand
(braket
l_int|0
)braket
)paren
op_eq
id|ACPI_DESC_TYPE_NAMED
)paren
(brace
multiline_comment|/*&n;&t;&t;&t; * This is a deref_of (object_reference)&n;&t;&t;&t; * Get the actual object from the Node (This is the dereference).&n;&t;&t;&t; * -- This case may only happen when a local_x or arg_x is dereferenced above.&n;&t;&t;&t; */
id|return_desc
op_assign
id|acpi_ns_get_attached_object
(paren
(paren
r_struct
id|acpi_namespace_node
op_star
)paren
id|operand
(braket
l_int|0
)braket
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/*&n;&t;&t;&t; * This must be a reference object produced by either the Index() or&n;&t;&t;&t; * ref_of() operator&n;&t;&t;&t; */
r_switch
c_cond
(paren
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|reference.opcode
)paren
(brace
r_case
id|AML_INDEX_OP
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t; * The target type for the Index operator must be&n;&t;&t;&t;&t; * either a Buffer or a Package&n;&t;&t;&t;&t; */
r_switch
c_cond
(paren
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|reference.target_type
)paren
(brace
r_case
id|ACPI_TYPE_BUFFER_FIELD
suffix:colon
id|temp_desc
op_assign
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|reference.object
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;&t; * Create a new object that contains one element of the&n;&t;&t;&t;&t;&t; * buffer -- the element pointed to by the index.&n;&t;&t;&t;&t;&t; *&n;&t;&t;&t;&t;&t; * NOTE: index into a buffer is NOT a pointer to a&n;&t;&t;&t;&t;&t; * sub-buffer of the main buffer, it is only a pointer to a&n;&t;&t;&t;&t;&t; * single element (byte) of the buffer!&n;&t;&t;&t;&t;&t; */
id|return_desc
op_assign
id|acpi_ut_create_internal_object
(paren
id|ACPI_TYPE_INTEGER
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|return_desc
)paren
(brace
id|status
op_assign
id|AE_NO_MEMORY
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t;&t;&t;&t; * Since we are returning the value of the buffer at the&n;&t;&t;&t;&t;&t; * indexed location, we don&squot;t need to add an additional&n;&t;&t;&t;&t;&t; * reference to the buffer itself.&n;&t;&t;&t;&t;&t; */
id|return_desc-&gt;integer.value
op_assign
id|temp_desc-&gt;buffer.pointer
(braket
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|reference.offset
)braket
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_TYPE_PACKAGE
suffix:colon
multiline_comment|/*&n;&t;&t;&t;&t;&t; * Return the referenced element of the package.  We must add&n;&t;&t;&t;&t;&t; * another reference to the referenced object, however.&n;&t;&t;&t;&t;&t; */
id|return_desc
op_assign
op_star
(paren
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|reference.where
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|return_desc
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t;&t;&t; * We can&squot;t return a NULL dereferenced value.  This is&n;&t;&t;&t;&t;&t;&t; * an uninitialized package element and is thus a&n;&t;&t;&t;&t;&t;&t; * severe error.&n;&t;&t;&t;&t;&t;&t; */
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;NULL package element obj %p&bslash;n&quot;
comma
id|operand
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|status
op_assign
id|AE_AML_UNINITIALIZED_ELEMENT
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
id|acpi_ut_add_reference
(paren
id|return_desc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Unknown Index target_type %X in obj %p&bslash;n&quot;
comma
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|reference.target_type
comma
id|operand
(braket
l_int|0
)braket
)paren
)paren
suffix:semicolon
id|status
op_assign
id|AE_AML_OPERAND_TYPE
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|AML_REF_OF_OP
suffix:colon
id|return_desc
op_assign
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|reference.object
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_GET_DESCRIPTOR_TYPE
(paren
id|return_desc
)paren
op_eq
id|ACPI_DESC_TYPE_NAMED
)paren
(brace
id|return_desc
op_assign
id|acpi_ns_get_attached_object
(paren
(paren
r_struct
id|acpi_namespace_node
op_star
)paren
id|return_desc
)paren
suffix:semicolon
)brace
multiline_comment|/* Add another reference to the object! */
id|acpi_ut_add_reference
(paren
id|return_desc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Unknown opcode in ref(%p) - %X&bslash;n&quot;
comma
id|operand
(braket
l_int|0
)braket
comma
id|operand
(braket
l_int|0
)braket
op_member_access_from_pointer
id|reference.opcode
)paren
)paren
suffix:semicolon
id|status
op_assign
id|AE_TYPE
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|ACPI_REPORT_ERROR
(paren
(paren
l_string|&quot;acpi_ex_opcode_1A_0T_1R: Unknown opcode %X&bslash;n&quot;
comma
id|walk_state-&gt;opcode
)paren
)paren
suffix:semicolon
id|status
op_assign
id|AE_AML_BAD_OPCODE
suffix:semicolon
r_goto
id|cleanup
suffix:semicolon
)brace
id|cleanup
suffix:colon
multiline_comment|/* Delete return object on error */
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
id|acpi_ut_remove_reference
(paren
id|return_desc
)paren
suffix:semicolon
)brace
id|walk_state-&gt;result_obj
op_assign
id|return_desc
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
eof
