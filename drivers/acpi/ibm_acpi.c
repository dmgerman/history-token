multiline_comment|/*&n; *  ibm_acpi.c - IBM ThinkPad ACPI Extras&n; *&n; *&n; *  Copyright (C) 2004 Borislav Deianov&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or&n; *  (at your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; *&n; *  Changelog:&n; *&n; *  2004-08-09&t;0.1&t;initial release, support for X series&n; *  2004-08-14&t;0.2&t;support for T series, X20&n; *&t;&t;&t;bluetooth enable/disable&n; *&t;&t;&t;hotkey events disabled by default&n; *&t;&t;&t;removed fan control, currently useless&n; *  2004-08-17&t;0.3&t;support for R40&n; *&t;&t;&t;lcd off, brightness control&n; *&t;&t;&t;thinklight on/off&n; *  2004-09-16&t;0.4&t;support for module parameters&n; *&t;&t;&t;hotkey mask can be prefixed by 0x&n; *&t;&t;&t;video output switching&n; *&t;&t;&t;video expansion control&n; *&t;&t;&t;ultrabay eject support&n; *&t;&t;&t;removed lcd brightness/on/off control, didn&squot;t work&n; *  2004-10-18&t;0.5&t;thinklight support on A21e, G40, R32, T20, T21, X20&n; *&t;&t;&t;proc file format changed&n; *&t;&t;&t;video_switch command&n; *&t;&t;&t;experimental cmos control&n; *&t;&t;&t;experimental led control&n; *&t;&t;&t;experimental acpi sounds&n; *  2004-10-19&t;0.6&t;use acpi_bus_register_driver() to claim HKEY device&n; *  2004-10-23&t;0.7&t;fix module loading on A21e, A22p, T20, T21, X20&n; *&t;&t;&t;fix LED control on A21e&n; *  2004-11-08&t;0.8&t;fix init error case, don&squot;t return from a macro&n; *&t;&t;&t;&t;thanks to Chris Wright &lt;chrisw@osdl.org&gt;&n; */
DECL|macro|IBM_VERSION
mdefine_line|#define IBM_VERSION &quot;0.8&quot;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;acpi/acpi_drivers.h&gt;
macro_line|#include &lt;acpi/acnamesp.h&gt;
DECL|macro|IBM_NAME
mdefine_line|#define IBM_NAME &quot;ibm&quot;
DECL|macro|IBM_DESC
mdefine_line|#define IBM_DESC &quot;IBM ThinkPad ACPI Extras&quot;
DECL|macro|IBM_FILE
mdefine_line|#define IBM_FILE &quot;ibm_acpi&quot;
DECL|macro|IBM_URL
mdefine_line|#define IBM_URL &quot;http:
singleline_comment|//ibm-acpi.sf.net/&quot;
DECL|macro|IBM_DIR
mdefine_line|#define IBM_DIR IBM_NAME
DECL|macro|IBM_LOG
mdefine_line|#define IBM_LOG IBM_FILE &quot;: &quot;
DECL|macro|IBM_ERR
mdefine_line|#define IBM_ERR&t;   KERN_ERR    IBM_LOG
DECL|macro|IBM_NOTICE
mdefine_line|#define IBM_NOTICE KERN_NOTICE IBM_LOG
DECL|macro|IBM_INFO
mdefine_line|#define IBM_INFO   KERN_INFO   IBM_LOG
DECL|macro|IBM_DEBUG
mdefine_line|#define IBM_DEBUG  KERN_DEBUG  IBM_LOG
DECL|macro|IBM_MAX_ACPI_ARGS
mdefine_line|#define IBM_MAX_ACPI_ARGS 3
DECL|macro|__unused
mdefine_line|#define __unused __attribute__ ((unused))
DECL|variable|experimental
r_static
r_int
id|experimental
suffix:semicolon
id|module_param
c_func
(paren
id|experimental
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
DECL|variable|root_handle
r_static
id|acpi_handle
id|root_handle
op_assign
l_int|NULL
suffix:semicolon
DECL|macro|IBM_HANDLE
mdefine_line|#define IBM_HANDLE(object, parent, paths...)&t;&t;&t;&bslash;&n;&t;static acpi_handle  object##_handle;&t;&t;&t;&bslash;&n;&t;static acpi_handle *object##_parent = &amp;parent##_handle;&t;&bslash;&n;&t;static char        *object##_paths[] = { paths }
id|IBM_HANDLE
c_func
(paren
id|ec
comma
id|root
comma
l_string|&quot;&bslash;&bslash;_SB.PCI0.ISA.EC&quot;
comma
multiline_comment|/* A21e, A22p, T20, T21, X20 */
l_string|&quot;&bslash;&bslash;_SB.PCI0.LPC.EC&quot;
comma
multiline_comment|/* all others */
)paren
suffix:semicolon
id|IBM_HANDLE
c_func
(paren
id|vid
comma
id|root
comma
l_string|&quot;&bslash;&bslash;_SB.PCI0.VID&quot;
comma
multiline_comment|/* A21e, G40, X30, X40 */
l_string|&quot;&bslash;&bslash;_SB.PCI0.AGP.VID&quot;
comma
multiline_comment|/* all others */
)paren
suffix:semicolon
id|IBM_HANDLE
c_func
(paren
id|cmos
comma
id|root
comma
l_string|&quot;&bslash;&bslash;UCMS&quot;
comma
multiline_comment|/* R50, R50p, R51, T4x, X31, X40 */
l_string|&quot;&bslash;&bslash;CMOS&quot;
comma
multiline_comment|/* A3x, G40, R32, T23, T30, X22, X24, X30 */
l_string|&quot;&bslash;&bslash;CMS&quot;
comma
multiline_comment|/* R40, R40e */
)paren
suffix:semicolon
multiline_comment|/* A21e, A22p, T20, T21, X20 */
id|IBM_HANDLE
c_func
(paren
id|dock
comma
id|root
comma
l_string|&quot;&bslash;&bslash;_SB.GDCK&quot;
comma
multiline_comment|/* X30, X31, X40 */
l_string|&quot;&bslash;&bslash;_SB.PCI0.DOCK&quot;
comma
multiline_comment|/* A22p, T20, T21, X20 */
l_string|&quot;&bslash;&bslash;_SB.PCI0.PCI1.DOCK&quot;
comma
multiline_comment|/* all others */
)paren
suffix:semicolon
multiline_comment|/* A21e, G40, R32, R40, R40e */
id|IBM_HANDLE
c_func
(paren
id|bay
comma
id|root
comma
l_string|&quot;&bslash;&bslash;_SB.PCI0.IDE0.SCND.MSTR&quot;
)paren
suffix:semicolon
multiline_comment|/* all except A21e */
id|IBM_HANDLE
c_func
(paren
id|bayej
comma
id|root
comma
l_string|&quot;&bslash;&bslash;_SB.PCI0.IDE0.SCND.MSTR._EJ0&quot;
)paren
suffix:semicolon
multiline_comment|/* all except A2x, A3x */
id|IBM_HANDLE
c_func
(paren
id|lght
comma
id|root
comma
l_string|&quot;&bslash;&bslash;LGHT&quot;
)paren
suffix:semicolon
multiline_comment|/* A21e, A22p, T20, T21, X20 */
id|IBM_HANDLE
c_func
(paren
id|hkey
comma
id|ec
comma
l_string|&quot;HKEY&quot;
)paren
suffix:semicolon
multiline_comment|/* all */
id|IBM_HANDLE
c_func
(paren
id|led
comma
id|ec
comma
l_string|&quot;LED&quot;
)paren
suffix:semicolon
multiline_comment|/* all except A21e, A22p, T20, T21, X20 */
id|IBM_HANDLE
c_func
(paren
id|sysl
comma
id|ec
comma
l_string|&quot;SYSL&quot;
)paren
suffix:semicolon
multiline_comment|/* A21e, A22p, T20, T21, X20 */
id|IBM_HANDLE
c_func
(paren
id|bled
comma
id|ec
comma
l_string|&quot;BLED&quot;
)paren
suffix:semicolon
multiline_comment|/* A22p, T20, T21, X20 */
id|IBM_HANDLE
c_func
(paren
id|beep
comma
id|ec
comma
l_string|&quot;BEEP&quot;
)paren
suffix:semicolon
multiline_comment|/* all models */
DECL|struct|ibm_struct
r_struct
id|ibm_struct
(brace
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|hid
r_char
op_star
id|hid
suffix:semicolon
DECL|member|driver
r_struct
id|acpi_driver
op_star
id|driver
suffix:semicolon
DECL|member|init
r_int
(paren
op_star
id|init
)paren
(paren
r_struct
id|ibm_struct
op_star
)paren
suffix:semicolon
DECL|member|read
r_int
(paren
op_star
id|read
)paren
(paren
r_struct
id|ibm_struct
op_star
comma
r_char
op_star
)paren
suffix:semicolon
DECL|member|write
r_int
(paren
op_star
id|write
)paren
(paren
r_struct
id|ibm_struct
op_star
comma
r_char
op_star
)paren
suffix:semicolon
DECL|member|exit
r_void
(paren
op_star
m_exit
)paren
(paren
r_struct
id|ibm_struct
op_star
)paren
suffix:semicolon
DECL|member|notify
r_void
(paren
op_star
id|notify
)paren
(paren
r_struct
id|ibm_struct
op_star
comma
id|u32
)paren
suffix:semicolon
DECL|member|handle
id|acpi_handle
op_star
id|handle
suffix:semicolon
DECL|member|type
r_int
id|type
suffix:semicolon
DECL|member|device
r_struct
id|acpi_device
op_star
id|device
suffix:semicolon
DECL|member|driver_registered
r_int
id|driver_registered
suffix:semicolon
DECL|member|proc_created
r_int
id|proc_created
suffix:semicolon
DECL|member|init_called
r_int
id|init_called
suffix:semicolon
DECL|member|notify_installed
r_int
id|notify_installed
suffix:semicolon
DECL|member|supported
r_int
id|supported
suffix:semicolon
r_union
(brace
r_struct
(brace
DECL|member|status
r_int
id|status
suffix:semicolon
DECL|member|mask
r_int
id|mask
suffix:semicolon
DECL|member|hotkey
)brace
id|hotkey
suffix:semicolon
r_struct
(brace
DECL|member|autoswitch
r_int
id|autoswitch
suffix:semicolon
DECL|member|video
)brace
id|video
suffix:semicolon
DECL|member|state
)brace
id|state
suffix:semicolon
DECL|member|experimental
r_int
id|experimental
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|proc_dir
r_struct
id|proc_dir_entry
op_star
id|proc_dir
op_assign
l_int|NULL
suffix:semicolon
DECL|macro|onoff
mdefine_line|#define onoff(status,bit) ((status) &amp; (1 &lt;&lt; (bit)) ? &quot;on&quot; : &quot;off&quot;)
DECL|macro|enabled
mdefine_line|#define enabled(status,bit) ((status) &amp; (1 &lt;&lt; (bit)) ? &quot;enabled&quot; : &quot;disabled&quot;)
DECL|macro|strlencmp
mdefine_line|#define strlencmp(a,b) (strncmp((a), (b), strlen(b)))
DECL|function|acpi_evalf
r_static
r_int
id|acpi_evalf
c_func
(paren
id|acpi_handle
id|handle
comma
r_void
op_star
id|res
comma
r_char
op_star
id|method
comma
r_char
op_star
id|fmt
comma
dot
dot
dot
)paren
(brace
r_char
op_star
id|fmt0
op_assign
id|fmt
suffix:semicolon
r_struct
id|acpi_object_list
id|params
suffix:semicolon
r_union
id|acpi_object
id|in_objs
(braket
id|IBM_MAX_ACPI_ARGS
)braket
suffix:semicolon
r_struct
id|acpi_buffer
id|result
suffix:semicolon
r_union
id|acpi_object
id|out_obj
suffix:semicolon
id|acpi_status
id|status
suffix:semicolon
id|va_list
id|ap
suffix:semicolon
r_char
id|res_type
suffix:semicolon
r_int
id|success
suffix:semicolon
r_int
id|quiet
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|fmt
)paren
(brace
id|printk
c_func
(paren
id|IBM_ERR
l_string|&quot;acpi_evalf() called with empty format&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_star
id|fmt
op_eq
l_char|&squot;q&squot;
)paren
(brace
id|quiet
op_assign
l_int|1
suffix:semicolon
id|fmt
op_increment
suffix:semicolon
)brace
r_else
id|quiet
op_assign
l_int|0
suffix:semicolon
id|res_type
op_assign
op_star
(paren
id|fmt
op_increment
)paren
suffix:semicolon
id|params.count
op_assign
l_int|0
suffix:semicolon
id|params.pointer
op_assign
op_amp
id|in_objs
(braket
l_int|0
)braket
suffix:semicolon
id|va_start
c_func
(paren
id|ap
comma
id|fmt
)paren
suffix:semicolon
r_while
c_loop
(paren
op_star
id|fmt
)paren
(brace
r_char
id|c
op_assign
op_star
(paren
id|fmt
op_increment
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|c
)paren
(brace
r_case
l_char|&squot;d&squot;
suffix:colon
multiline_comment|/* int */
id|in_objs
(braket
id|params.count
)braket
dot
id|integer.value
op_assign
id|va_arg
c_func
(paren
id|ap
comma
r_int
)paren
suffix:semicolon
id|in_objs
(braket
id|params.count
op_increment
)braket
dot
id|type
op_assign
id|ACPI_TYPE_INTEGER
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* add more types as needed */
r_default
suffix:colon
id|printk
c_func
(paren
id|IBM_ERR
l_string|&quot;acpi_evalf() called &quot;
l_string|&quot;with invalid format character &squot;%c&squot;&bslash;n&quot;
comma
id|c
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|va_end
c_func
(paren
id|ap
)paren
suffix:semicolon
id|result.length
op_assign
r_sizeof
(paren
id|out_obj
)paren
suffix:semicolon
id|result.pointer
op_assign
op_amp
id|out_obj
suffix:semicolon
id|status
op_assign
id|acpi_evaluate_object
c_func
(paren
id|handle
comma
id|method
comma
op_amp
id|params
comma
op_amp
id|result
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|res_type
)paren
(brace
r_case
l_char|&squot;d&squot;
suffix:colon
multiline_comment|/* int */
r_if
c_cond
(paren
id|res
)paren
op_star
(paren
r_int
op_star
)paren
id|res
op_assign
id|out_obj.integer.value
suffix:semicolon
id|success
op_assign
id|status
op_eq
id|AE_OK
op_logical_and
id|out_obj.type
op_eq
id|ACPI_TYPE_INTEGER
suffix:semicolon
r_break
suffix:semicolon
r_case
l_char|&squot;v&squot;
suffix:colon
multiline_comment|/* void */
id|success
op_assign
id|status
op_eq
id|AE_OK
suffix:semicolon
r_break
suffix:semicolon
multiline_comment|/* add more types as needed */
r_default
suffix:colon
id|printk
c_func
(paren
id|IBM_ERR
l_string|&quot;acpi_evalf() called &quot;
l_string|&quot;with invalid format character &squot;%c&squot;&bslash;n&quot;
comma
id|res_type
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|success
op_logical_and
op_logical_neg
id|quiet
)paren
id|printk
c_func
(paren
id|IBM_ERR
l_string|&quot;acpi_evalf(%s, %s, ...) failed: %d&bslash;n&quot;
comma
id|method
comma
id|fmt0
comma
id|status
)paren
suffix:semicolon
r_return
id|success
suffix:semicolon
)brace
DECL|function|acpi_print_int
r_static
r_void
id|__unused
id|acpi_print_int
c_func
(paren
id|acpi_handle
id|handle
comma
r_char
op_star
id|method
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|acpi_evalf
c_func
(paren
id|handle
comma
op_amp
id|i
comma
id|method
comma
l_string|&quot;d&quot;
)paren
)paren
id|printk
c_func
(paren
id|IBM_INFO
l_string|&quot;%s = 0x%x&bslash;n&quot;
comma
id|method
comma
id|i
)paren
suffix:semicolon
r_else
id|printk
c_func
(paren
id|IBM_ERR
l_string|&quot;error calling %s&bslash;n&quot;
comma
id|method
)paren
suffix:semicolon
)brace
DECL|function|next_cmd
r_static
r_char
op_star
id|next_cmd
c_func
(paren
r_char
op_star
op_star
id|cmds
)paren
(brace
r_char
op_star
id|start
op_assign
op_star
id|cmds
suffix:semicolon
r_char
op_star
id|end
suffix:semicolon
r_while
c_loop
(paren
(paren
id|end
op_assign
id|strchr
c_func
(paren
id|start
comma
l_char|&squot;,&squot;
)paren
)paren
op_logical_and
id|end
op_eq
id|start
)paren
id|start
op_assign
id|end
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|end
)paren
r_return
l_int|NULL
suffix:semicolon
op_star
id|end
op_assign
l_int|0
suffix:semicolon
op_star
id|cmds
op_assign
id|end
op_plus
l_int|1
suffix:semicolon
r_return
id|start
suffix:semicolon
)brace
DECL|function|driver_init
r_static
r_int
id|driver_init
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
)paren
(brace
id|printk
c_func
(paren
id|IBM_INFO
l_string|&quot;%s v%s&bslash;n&quot;
comma
id|IBM_DESC
comma
id|IBM_VERSION
)paren
suffix:semicolon
id|printk
c_func
(paren
id|IBM_INFO
l_string|&quot;%s&bslash;n&quot;
comma
id|IBM_URL
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|driver_read
r_static
r_int
id|driver_read
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
r_char
op_star
id|p
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;driver:&bslash;t&bslash;t%s&bslash;n&quot;
comma
id|IBM_DESC
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;version:&bslash;t%s&bslash;n&quot;
comma
id|IBM_VERSION
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|hotkey_get
r_static
r_int
id|hotkey_get
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
r_int
op_star
id|status
comma
r_int
op_star
id|mask
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|acpi_evalf
c_func
(paren
id|hkey_handle
comma
id|status
comma
l_string|&quot;DHKC&quot;
comma
l_string|&quot;d&quot;
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|ibm-&gt;supported
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|acpi_evalf
c_func
(paren
id|hkey_handle
comma
id|mask
comma
l_string|&quot;DHKN&quot;
comma
l_string|&quot;qd&quot;
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_else
(brace
op_star
id|mask
op_assign
id|ibm-&gt;state.hotkey.mask
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hotkey_set
r_static
r_int
id|hotkey_set
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
r_int
id|status
comma
r_int
id|mask
)paren
(brace
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_evalf
c_func
(paren
id|hkey_handle
comma
l_int|NULL
comma
l_string|&quot;MHKC&quot;
comma
l_string|&quot;vd&quot;
comma
id|status
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ibm-&gt;supported
)paren
r_return
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|32
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|bit
op_assign
(paren
(paren
l_int|1
op_lshift
id|i
)paren
op_amp
id|mask
)paren
op_ne
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_evalf
c_func
(paren
id|hkey_handle
comma
l_int|NULL
comma
l_string|&quot;MHKM&quot;
comma
l_string|&quot;vdd&quot;
comma
id|i
op_plus
l_int|1
comma
id|bit
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hotkey_init
r_static
r_int
id|hotkey_init
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
)paren
(brace
r_int
id|ret
suffix:semicolon
id|ibm-&gt;supported
op_assign
l_int|1
suffix:semicolon
id|ret
op_assign
id|hotkey_get
c_func
(paren
id|ibm
comma
op_amp
id|ibm-&gt;state.hotkey.status
comma
op_amp
id|ibm-&gt;state.hotkey.mask
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
multiline_comment|/* mask not supported on A21e, A22p, T20, T21, X20, X22, X24 */
id|ibm-&gt;supported
op_assign
l_int|0
suffix:semicolon
id|ret
op_assign
id|hotkey_get
c_func
(paren
id|ibm
comma
op_amp
id|ibm-&gt;state.hotkey.status
comma
op_amp
id|ibm-&gt;state.hotkey.mask
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|hotkey_read
r_static
r_int
id|hotkey_read
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
r_char
op_star
id|p
)paren
(brace
r_int
id|status
comma
id|mask
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|hotkey_get
c_func
(paren
id|ibm
comma
op_amp
id|status
comma
op_amp
id|mask
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;status:&bslash;t&bslash;t%s&bslash;n&quot;
comma
id|enabled
c_func
(paren
id|status
comma
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ibm-&gt;supported
)paren
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;mask:&bslash;t&bslash;t0x%04x&bslash;n&quot;
comma
id|mask
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;commands:&bslash;tenable, disable, reset, &lt;mask&gt;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;mask:&bslash;t&bslash;tnot supported&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;commands:&bslash;tenable, disable, reset&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
DECL|function|hotkey_write
r_static
r_int
id|hotkey_write
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
r_char
op_star
id|buf
)paren
(brace
r_int
id|status
comma
id|mask
suffix:semicolon
r_char
op_star
id|cmd
suffix:semicolon
r_int
id|do_cmd
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|hotkey_get
c_func
(paren
id|ibm
comma
op_amp
id|status
comma
op_amp
id|mask
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_while
c_loop
(paren
(paren
id|cmd
op_assign
id|next_cmd
c_func
(paren
op_amp
id|buf
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|strlencmp
c_func
(paren
id|cmd
comma
l_string|&quot;enable&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|status
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strlencmp
c_func
(paren
id|cmd
comma
l_string|&quot;disable&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|status
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strlencmp
c_func
(paren
id|cmd
comma
l_string|&quot;reset&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|status
op_assign
id|ibm-&gt;state.hotkey.status
suffix:semicolon
id|mask
op_assign
id|ibm-&gt;state.hotkey.mask
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|sscanf
c_func
(paren
id|cmd
comma
l_string|&quot;0x%x&quot;
comma
op_amp
id|mask
)paren
op_eq
l_int|1
)paren
(brace
multiline_comment|/* mask set */
)brace
r_else
r_if
c_cond
(paren
id|sscanf
c_func
(paren
id|cmd
comma
l_string|&quot;%x&quot;
comma
op_amp
id|mask
)paren
op_eq
l_int|1
)paren
(brace
multiline_comment|/* mask set */
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
id|do_cmd
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|do_cmd
op_logical_and
id|hotkey_set
c_func
(paren
id|ibm
comma
id|status
comma
id|mask
)paren
OL
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hotkey_exit
r_static
r_void
id|hotkey_exit
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
)paren
(brace
id|hotkey_set
c_func
(paren
id|ibm
comma
id|ibm-&gt;state.hotkey.status
comma
id|ibm-&gt;state.hotkey.mask
)paren
suffix:semicolon
)brace
DECL|function|hotkey_notify
r_static
r_void
id|hotkey_notify
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
id|u32
id|event
)paren
(brace
r_int
id|hkey
suffix:semicolon
r_if
c_cond
(paren
id|acpi_evalf
c_func
(paren
id|hkey_handle
comma
op_amp
id|hkey
comma
l_string|&quot;MHKP&quot;
comma
l_string|&quot;d&quot;
)paren
)paren
id|acpi_bus_generate_event
c_func
(paren
id|ibm-&gt;device
comma
id|event
comma
id|hkey
)paren
suffix:semicolon
r_else
(brace
id|printk
c_func
(paren
id|IBM_ERR
l_string|&quot;unknown hotkey event %d&bslash;n&quot;
comma
id|event
)paren
suffix:semicolon
id|acpi_bus_generate_event
c_func
(paren
id|ibm-&gt;device
comma
id|event
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
DECL|function|bluetooth_init
r_static
r_int
id|bluetooth_init
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
)paren
(brace
multiline_comment|/* bluetooth not supported on A21e, G40, T20, T21, X20 */
id|ibm-&gt;supported
op_assign
id|acpi_evalf
c_func
(paren
id|hkey_handle
comma
l_int|NULL
comma
l_string|&quot;GBDC&quot;
comma
l_string|&quot;qv&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bluetooth_status
r_static
r_int
id|bluetooth_status
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
)paren
(brace
r_int
id|status
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ibm-&gt;supported
op_logical_or
op_logical_neg
id|acpi_evalf
c_func
(paren
id|hkey_handle
comma
op_amp
id|status
comma
l_string|&quot;GBDC&quot;
comma
l_string|&quot;d&quot;
)paren
)paren
id|status
op_assign
l_int|0
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
DECL|function|bluetooth_read
r_static
r_int
id|bluetooth_read
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
r_char
op_star
id|p
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_int
id|status
op_assign
id|bluetooth_status
c_func
(paren
id|ibm
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ibm-&gt;supported
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;status:&bslash;t&bslash;tnot supported&bslash;n&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|status
op_amp
l_int|1
)paren
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;status:&bslash;t&bslash;tnot installed&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;status:&bslash;t&bslash;t%s&bslash;n&quot;
comma
id|enabled
c_func
(paren
id|status
comma
l_int|1
)paren
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;commands:&bslash;tenable, disable&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
DECL|function|bluetooth_write
r_static
r_int
id|bluetooth_write
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
r_char
op_star
id|buf
)paren
(brace
r_int
id|status
op_assign
id|bluetooth_status
c_func
(paren
id|ibm
)paren
suffix:semicolon
r_char
op_star
id|cmd
suffix:semicolon
r_int
id|do_cmd
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ibm-&gt;supported
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_while
c_loop
(paren
(paren
id|cmd
op_assign
id|next_cmd
c_func
(paren
op_amp
id|buf
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|strlencmp
c_func
(paren
id|cmd
comma
l_string|&quot;enable&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|status
op_or_assign
l_int|2
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strlencmp
c_func
(paren
id|cmd
comma
l_string|&quot;disable&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|status
op_and_assign
op_complement
l_int|2
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
id|do_cmd
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|do_cmd
op_logical_and
op_logical_neg
id|acpi_evalf
c_func
(paren
id|hkey_handle
comma
l_int|NULL
comma
l_string|&quot;SBDC&quot;
comma
l_string|&quot;vd&quot;
comma
id|status
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|video_init
r_static
r_int
id|video_init
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|acpi_evalf
c_func
(paren
id|vid_handle
comma
op_amp
id|ibm-&gt;state.video.autoswitch
comma
l_string|&quot;^VDEE&quot;
comma
l_string|&quot;d&quot;
)paren
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|video_status
r_static
r_int
id|video_status
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
)paren
(brace
r_int
id|status
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
id|acpi_evalf
c_func
(paren
l_int|NULL
comma
l_int|NULL
comma
l_string|&quot;&bslash;&bslash;VUPS&quot;
comma
l_string|&quot;vd&quot;
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|acpi_evalf
c_func
(paren
l_int|NULL
comma
op_amp
id|i
comma
l_string|&quot;&bslash;&bslash;VCDC&quot;
comma
l_string|&quot;d&quot;
)paren
)paren
id|status
op_or_assign
l_int|0x02
op_star
id|i
suffix:semicolon
id|acpi_evalf
c_func
(paren
l_int|NULL
comma
l_int|NULL
comma
l_string|&quot;&bslash;&bslash;VUPS&quot;
comma
l_string|&quot;vd&quot;
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|acpi_evalf
c_func
(paren
l_int|NULL
comma
op_amp
id|i
comma
l_string|&quot;&bslash;&bslash;VCDL&quot;
comma
l_string|&quot;d&quot;
)paren
)paren
id|status
op_or_assign
l_int|0x01
op_star
id|i
suffix:semicolon
r_if
c_cond
(paren
id|acpi_evalf
c_func
(paren
l_int|NULL
comma
op_amp
id|i
comma
l_string|&quot;&bslash;&bslash;VCDD&quot;
comma
l_string|&quot;d&quot;
)paren
)paren
id|status
op_or_assign
l_int|0x08
op_star
id|i
suffix:semicolon
r_if
c_cond
(paren
id|acpi_evalf
c_func
(paren
id|vid_handle
comma
op_amp
id|i
comma
l_string|&quot;^VDEE&quot;
comma
l_string|&quot;d&quot;
)paren
)paren
id|status
op_or_assign
l_int|0x10
op_star
(paren
id|i
op_amp
l_int|1
)paren
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
DECL|function|video_read
r_static
r_int
id|video_read
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
r_char
op_star
id|p
)paren
(brace
r_int
id|status
op_assign
id|video_status
c_func
(paren
id|ibm
)paren
suffix:semicolon
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;lcd:&bslash;t&bslash;t%s&bslash;n&quot;
comma
id|enabled
c_func
(paren
id|status
comma
l_int|0
)paren
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;crt:&bslash;t&bslash;t%s&bslash;n&quot;
comma
id|enabled
c_func
(paren
id|status
comma
l_int|1
)paren
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;dvi:&bslash;t&bslash;t%s&bslash;n&quot;
comma
id|enabled
c_func
(paren
id|status
comma
l_int|3
)paren
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;auto:&bslash;t&bslash;t%s&bslash;n&quot;
comma
id|enabled
c_func
(paren
id|status
comma
l_int|4
)paren
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;commands:&bslash;tlcd_enable, lcd_disable, &quot;
l_string|&quot;crt_enable, crt_disable&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;commands:&bslash;tdvi_enable, dvi_disable, &quot;
l_string|&quot;auto_enable, auto_disable&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;commands:&bslash;tvideo_switch, expand_toggle&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|video_write
r_static
r_int
id|video_write
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
r_char
op_star
id|buf
)paren
(brace
r_char
op_star
id|cmd
suffix:semicolon
r_int
id|enable
comma
id|disable
comma
id|status
suffix:semicolon
id|enable
op_assign
id|disable
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
(paren
id|cmd
op_assign
id|next_cmd
c_func
(paren
op_amp
id|buf
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|strlencmp
c_func
(paren
id|cmd
comma
l_string|&quot;lcd_enable&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|enable
op_or_assign
l_int|0x01
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strlencmp
c_func
(paren
id|cmd
comma
l_string|&quot;lcd_disable&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|disable
op_or_assign
l_int|0x01
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strlencmp
c_func
(paren
id|cmd
comma
l_string|&quot;crt_enable&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|enable
op_or_assign
l_int|0x02
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strlencmp
c_func
(paren
id|cmd
comma
l_string|&quot;crt_disable&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|disable
op_or_assign
l_int|0x02
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strlencmp
c_func
(paren
id|cmd
comma
l_string|&quot;dvi_enable&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|enable
op_or_assign
l_int|0x08
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strlencmp
c_func
(paren
id|cmd
comma
l_string|&quot;dvi_disable&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|disable
op_or_assign
l_int|0x08
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strlencmp
c_func
(paren
id|cmd
comma
l_string|&quot;auto_enable&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|acpi_evalf
c_func
(paren
id|vid_handle
comma
l_int|NULL
comma
l_string|&quot;_DOS&quot;
comma
l_string|&quot;vd&quot;
comma
l_int|1
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strlencmp
c_func
(paren
id|cmd
comma
l_string|&quot;auto_disable&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|acpi_evalf
c_func
(paren
id|vid_handle
comma
l_int|NULL
comma
l_string|&quot;_DOS&quot;
comma
l_string|&quot;vd&quot;
comma
l_int|0
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strlencmp
c_func
(paren
id|cmd
comma
l_string|&quot;video_switch&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_int
id|autoswitch
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_evalf
c_func
(paren
id|vid_handle
comma
op_amp
id|autoswitch
comma
l_string|&quot;^VDEE&quot;
comma
l_string|&quot;d&quot;
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_evalf
c_func
(paren
id|vid_handle
comma
l_int|NULL
comma
l_string|&quot;_DOS&quot;
comma
l_string|&quot;vd&quot;
comma
l_int|1
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_evalf
c_func
(paren
id|vid_handle
comma
l_int|NULL
comma
l_string|&quot;VSWT&quot;
comma
l_string|&quot;v&quot;
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_evalf
c_func
(paren
id|vid_handle
comma
l_int|NULL
comma
l_string|&quot;_DOS&quot;
comma
l_string|&quot;vd&quot;
comma
id|autoswitch
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strlencmp
c_func
(paren
id|cmd
comma
l_string|&quot;expand_toggle&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|acpi_evalf
c_func
(paren
l_int|NULL
comma
l_int|NULL
comma
l_string|&quot;&bslash;&bslash;VEXP&quot;
comma
l_string|&quot;v&quot;
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|enable
op_logical_or
id|disable
)paren
(brace
id|status
op_assign
(paren
id|video_status
c_func
(paren
id|ibm
)paren
op_amp
l_int|0x0f
op_amp
op_complement
id|disable
)paren
op_or
id|enable
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_evalf
c_func
(paren
l_int|NULL
comma
l_int|NULL
comma
l_string|&quot;&bslash;&bslash;VUPS&quot;
comma
l_string|&quot;vd&quot;
comma
l_int|0x80
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_evalf
c_func
(paren
l_int|NULL
comma
l_int|NULL
comma
l_string|&quot;&bslash;&bslash;VSDS&quot;
comma
l_string|&quot;vdd&quot;
comma
id|status
comma
l_int|1
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|video_exit
r_static
r_void
id|video_exit
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
)paren
(brace
id|acpi_evalf
c_func
(paren
id|vid_handle
comma
l_int|NULL
comma
l_string|&quot;_DOS&quot;
comma
l_string|&quot;vd&quot;
comma
id|ibm-&gt;state.video.autoswitch
)paren
suffix:semicolon
)brace
DECL|function|light_init
r_static
r_int
id|light_init
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
)paren
(brace
multiline_comment|/* kblt not supported on G40, R32, X20 */
id|ibm-&gt;supported
op_assign
id|acpi_evalf
c_func
(paren
id|ec_handle
comma
l_int|NULL
comma
l_string|&quot;KBLT&quot;
comma
l_string|&quot;qv&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|light_read
r_static
r_int
id|light_read
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
r_char
op_star
id|p
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_int
id|status
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ibm-&gt;supported
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|acpi_evalf
c_func
(paren
id|ec_handle
comma
op_amp
id|status
comma
l_string|&quot;KBLT&quot;
comma
l_string|&quot;d&quot;
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;status:&bslash;t&bslash;t%s&bslash;n&quot;
comma
id|onoff
c_func
(paren
id|status
comma
l_int|0
)paren
)paren
suffix:semicolon
)brace
r_else
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;status:&bslash;t&bslash;tunknown&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;commands:&bslash;ton, off&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|light_write
r_static
r_int
id|light_write
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
r_char
op_star
id|buf
)paren
(brace
r_int
id|cmos_cmd
comma
id|lght_cmd
suffix:semicolon
r_char
op_star
id|cmd
suffix:semicolon
r_int
id|success
suffix:semicolon
r_while
c_loop
(paren
(paren
id|cmd
op_assign
id|next_cmd
c_func
(paren
op_amp
id|buf
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|strlencmp
c_func
(paren
id|cmd
comma
l_string|&quot;on&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|cmos_cmd
op_assign
l_int|0x0c
suffix:semicolon
id|lght_cmd
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strlencmp
c_func
(paren
id|cmd
comma
l_string|&quot;off&quot;
)paren
op_eq
l_int|0
)paren
(brace
id|cmos_cmd
op_assign
l_int|0x0d
suffix:semicolon
id|lght_cmd
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
id|success
op_assign
id|cmos_handle
ques
c_cond
id|acpi_evalf
c_func
(paren
id|cmos_handle
comma
l_int|NULL
comma
l_int|NULL
comma
l_string|&quot;vd&quot;
comma
id|cmos_cmd
)paren
suffix:colon
id|acpi_evalf
c_func
(paren
id|lght_handle
comma
l_int|NULL
comma
l_int|NULL
comma
l_string|&quot;vd&quot;
comma
id|lght_cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|success
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|_sta
r_static
r_int
id|_sta
c_func
(paren
id|acpi_handle
id|handle
)paren
(brace
r_int
id|status
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|handle
op_logical_or
op_logical_neg
id|acpi_evalf
c_func
(paren
id|handle
comma
op_amp
id|status
comma
l_string|&quot;_STA&quot;
comma
l_string|&quot;d&quot;
)paren
)paren
id|status
op_assign
l_int|0
suffix:semicolon
r_return
id|status
suffix:semicolon
)brace
DECL|macro|dock_docked
mdefine_line|#define dock_docked() (_sta(dock_handle) &amp; 1)
DECL|function|dock_read
r_static
r_int
id|dock_read
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
r_char
op_star
id|p
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_int
id|docked
op_assign
id|dock_docked
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dock_handle
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;status:&bslash;t&bslash;tnot supported&bslash;n&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|docked
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;status:&bslash;t&bslash;tundocked&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;status:&bslash;t&bslash;tdocked&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;commands:&bslash;tdock, undock&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
DECL|function|dock_write
r_static
r_int
id|dock_write
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
r_char
op_star
id|buf
)paren
(brace
r_char
op_star
id|cmd
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dock_docked
c_func
(paren
)paren
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_while
c_loop
(paren
(paren
id|cmd
op_assign
id|next_cmd
c_func
(paren
op_amp
id|buf
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|strlencmp
c_func
(paren
id|cmd
comma
l_string|&quot;undock&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|acpi_evalf
c_func
(paren
id|dock_handle
comma
l_int|NULL
comma
l_string|&quot;_DCK&quot;
comma
l_string|&quot;vd&quot;
comma
l_int|0
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_evalf
c_func
(paren
id|dock_handle
comma
l_int|NULL
comma
l_string|&quot;_EJ0&quot;
comma
l_string|&quot;vd&quot;
comma
l_int|1
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strlencmp
c_func
(paren
id|cmd
comma
l_string|&quot;dock&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|acpi_evalf
c_func
(paren
id|dock_handle
comma
l_int|NULL
comma
l_string|&quot;_DCK&quot;
comma
l_string|&quot;vd&quot;
comma
l_int|1
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|dock_notify
r_static
r_void
id|dock_notify
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
id|u32
id|event
)paren
(brace
r_int
id|docked
op_assign
id|dock_docked
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|event
op_eq
l_int|3
op_logical_and
id|docked
)paren
id|acpi_bus_generate_event
c_func
(paren
id|ibm-&gt;device
comma
id|event
comma
l_int|1
)paren
suffix:semicolon
multiline_comment|/* button */
r_else
r_if
c_cond
(paren
id|event
op_eq
l_int|3
op_logical_and
op_logical_neg
id|docked
)paren
id|acpi_bus_generate_event
c_func
(paren
id|ibm-&gt;device
comma
id|event
comma
l_int|2
)paren
suffix:semicolon
multiline_comment|/* undock */
r_else
r_if
c_cond
(paren
id|event
op_eq
l_int|0
op_logical_and
id|docked
)paren
id|acpi_bus_generate_event
c_func
(paren
id|ibm-&gt;device
comma
id|event
comma
l_int|3
)paren
suffix:semicolon
multiline_comment|/* dock */
r_else
(brace
id|printk
c_func
(paren
id|IBM_ERR
l_string|&quot;unknown dock event %d, status %d&bslash;n&quot;
comma
id|event
comma
id|_sta
c_func
(paren
id|dock_handle
)paren
)paren
suffix:semicolon
id|acpi_bus_generate_event
c_func
(paren
id|ibm-&gt;device
comma
id|event
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* unknown */
)brace
)brace
DECL|macro|bay_occupied
mdefine_line|#define bay_occupied() (_sta(bay_handle) &amp; 1)
DECL|function|bay_init
r_static
r_int
id|bay_init
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
)paren
(brace
multiline_comment|/* bay not supported on A21e, A22p, A31, A31p, G40, R32, R40e */
id|ibm-&gt;supported
op_assign
id|bay_handle
op_logical_and
id|bayej_handle
op_logical_and
id|acpi_evalf
c_func
(paren
id|bay_handle
comma
l_int|NULL
comma
l_string|&quot;_STA&quot;
comma
l_string|&quot;qv&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bay_read
r_static
r_int
id|bay_read
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
r_char
op_star
id|p
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
r_int
id|occupied
op_assign
id|bay_occupied
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ibm-&gt;supported
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;status:&bslash;t&bslash;tnot supported&bslash;n&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|occupied
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;status:&bslash;t&bslash;tunoccupied&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;status:&bslash;t&bslash;toccupied&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;commands:&bslash;teject&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
DECL|function|bay_write
r_static
r_int
id|bay_write
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
r_char
op_star
id|buf
)paren
(brace
r_char
op_star
id|cmd
suffix:semicolon
r_while
c_loop
(paren
(paren
id|cmd
op_assign
id|next_cmd
c_func
(paren
op_amp
id|buf
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|strlencmp
c_func
(paren
id|cmd
comma
l_string|&quot;eject&quot;
)paren
op_eq
l_int|0
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|ibm-&gt;supported
op_logical_or
op_logical_neg
id|acpi_evalf
c_func
(paren
id|bay_handle
comma
l_int|NULL
comma
l_string|&quot;_EJ0&quot;
comma
l_string|&quot;vd&quot;
comma
l_int|1
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|bay_notify
r_static
r_void
id|bay_notify
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
id|u32
id|event
)paren
(brace
id|acpi_bus_generate_event
c_func
(paren
id|ibm-&gt;device
comma
id|event
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|cmos_read
r_static
r_int
id|cmos_read
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
r_char
op_star
id|p
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* cmos not supported on A21e, A22p, T20, T21, X20 */
r_if
c_cond
(paren
op_logical_neg
id|cmos_handle
)paren
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;status:&bslash;t&bslash;tnot supported&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;status:&bslash;t&bslash;tsupported&bslash;n&quot;
)paren
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;commands:&bslash;t&lt;int&gt;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
id|len
suffix:semicolon
)brace
DECL|function|cmos_write
r_static
r_int
id|cmos_write
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
r_char
op_star
id|buf
)paren
(brace
r_char
op_star
id|cmd
suffix:semicolon
r_int
id|cmos_cmd
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cmos_handle
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_while
c_loop
(paren
(paren
id|cmd
op_assign
id|next_cmd
c_func
(paren
op_amp
id|buf
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|sscanf
c_func
(paren
id|cmd
comma
l_string|&quot;%u&quot;
comma
op_amp
id|cmos_cmd
)paren
op_eq
l_int|1
)paren
(brace
multiline_comment|/* cmos_cmd set */
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_evalf
c_func
(paren
id|cmos_handle
comma
l_int|NULL
comma
l_int|NULL
comma
l_string|&quot;vd&quot;
comma
id|cmos_cmd
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|led_read
r_static
r_int
id|led_read
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
r_char
op_star
id|p
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;commands:&bslash;t&quot;
l_string|&quot;&lt;int&gt; on, &lt;int&gt; off, &lt;int&gt; blink&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|led_write
r_static
r_int
id|led_write
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
r_char
op_star
id|buf
)paren
(brace
r_char
op_star
id|cmd
suffix:semicolon
r_int
r_int
id|led
suffix:semicolon
r_int
id|led_cmd
comma
id|sysl_cmd
comma
id|bled_a
comma
id|bled_b
suffix:semicolon
r_while
c_loop
(paren
(paren
id|cmd
op_assign
id|next_cmd
c_func
(paren
op_amp
id|buf
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|sscanf
c_func
(paren
id|cmd
comma
l_string|&quot;%u&quot;
comma
op_amp
id|led
)paren
op_ne
l_int|1
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|strstr
c_func
(paren
id|cmd
comma
l_string|&quot;blink&quot;
)paren
)paren
(brace
id|led_cmd
op_assign
l_int|0xc0
suffix:semicolon
id|sysl_cmd
op_assign
l_int|2
suffix:semicolon
id|bled_a
op_assign
l_int|2
suffix:semicolon
id|bled_b
op_assign
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strstr
c_func
(paren
id|cmd
comma
l_string|&quot;on&quot;
)paren
)paren
(brace
id|led_cmd
op_assign
l_int|0x80
suffix:semicolon
id|sysl_cmd
op_assign
l_int|1
suffix:semicolon
id|bled_a
op_assign
l_int|2
suffix:semicolon
id|bled_b
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strstr
c_func
(paren
id|cmd
comma
l_string|&quot;off&quot;
)paren
)paren
(brace
id|led_cmd
op_assign
id|sysl_cmd
op_assign
id|bled_a
op_assign
id|bled_b
op_assign
l_int|0
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|led_handle
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|acpi_evalf
c_func
(paren
id|led_handle
comma
l_int|NULL
comma
l_int|NULL
comma
l_string|&quot;vdd&quot;
comma
id|led
comma
id|led_cmd
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|led
OL
l_int|2
)paren
(brace
r_if
c_cond
(paren
id|acpi_evalf
c_func
(paren
id|sysl_handle
comma
l_int|NULL
comma
l_int|NULL
comma
l_string|&quot;vdd&quot;
comma
id|led
comma
id|sysl_cmd
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|led
op_eq
l_int|2
op_logical_and
id|bled_handle
)paren
(brace
r_if
c_cond
(paren
id|acpi_evalf
c_func
(paren
id|bled_handle
comma
l_int|NULL
comma
l_int|NULL
comma
l_string|&quot;vdd&quot;
comma
id|bled_a
comma
id|bled_b
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|beep_read
r_static
r_int
id|beep_read
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
r_char
op_star
id|p
)paren
(brace
r_int
id|len
op_assign
l_int|0
suffix:semicolon
id|len
op_add_assign
id|sprintf
c_func
(paren
id|p
op_plus
id|len
comma
l_string|&quot;commands:&bslash;t&lt;int&gt;&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|beep_write
r_static
r_int
id|beep_write
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
comma
r_char
op_star
id|buf
)paren
(brace
r_char
op_star
id|cmd
suffix:semicolon
r_int
id|beep_cmd
suffix:semicolon
r_while
c_loop
(paren
(paren
id|cmd
op_assign
id|next_cmd
c_func
(paren
op_amp
id|buf
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|sscanf
c_func
(paren
id|cmd
comma
l_string|&quot;%u&quot;
comma
op_amp
id|beep_cmd
)paren
op_eq
l_int|1
)paren
(brace
multiline_comment|/* beep_cmd set */
)brace
r_else
r_return
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_evalf
c_func
(paren
id|beep_handle
comma
l_int|NULL
comma
l_int|NULL
comma
l_string|&quot;vd&quot;
comma
id|beep_cmd
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|ibms
r_struct
id|ibm_struct
id|ibms
(braket
)braket
op_assign
(brace
(brace
dot
id|name
op_assign
l_string|&quot;driver&quot;
comma
dot
id|init
op_assign
id|driver_init
comma
dot
id|read
op_assign
id|driver_read
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;hotkey&quot;
comma
dot
id|hid
op_assign
l_string|&quot;IBM0068&quot;
comma
dot
id|init
op_assign
id|hotkey_init
comma
dot
id|read
op_assign
id|hotkey_read
comma
dot
id|write
op_assign
id|hotkey_write
comma
dot
m_exit
op_assign
id|hotkey_exit
comma
dot
id|notify
op_assign
id|hotkey_notify
comma
dot
id|handle
op_assign
op_amp
id|hkey_handle
comma
dot
id|type
op_assign
id|ACPI_DEVICE_NOTIFY
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;bluetooth&quot;
comma
dot
id|init
op_assign
id|bluetooth_init
comma
dot
id|read
op_assign
id|bluetooth_read
comma
dot
id|write
op_assign
id|bluetooth_write
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;video&quot;
comma
dot
id|init
op_assign
id|video_init
comma
dot
id|read
op_assign
id|video_read
comma
dot
id|write
op_assign
id|video_write
comma
dot
m_exit
op_assign
id|video_exit
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;light&quot;
comma
dot
id|init
op_assign
id|light_init
comma
dot
id|read
op_assign
id|light_read
comma
dot
id|write
op_assign
id|light_write
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;dock&quot;
comma
dot
id|read
op_assign
id|dock_read
comma
dot
id|write
op_assign
id|dock_write
comma
dot
id|notify
op_assign
id|dock_notify
comma
dot
id|handle
op_assign
op_amp
id|dock_handle
comma
dot
id|type
op_assign
id|ACPI_SYSTEM_NOTIFY
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;bay&quot;
comma
dot
id|init
op_assign
id|bay_init
comma
dot
id|read
op_assign
id|bay_read
comma
dot
id|write
op_assign
id|bay_write
comma
dot
id|notify
op_assign
id|bay_notify
comma
dot
id|handle
op_assign
op_amp
id|bay_handle
comma
dot
id|type
op_assign
id|ACPI_SYSTEM_NOTIFY
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;cmos&quot;
comma
dot
id|read
op_assign
id|cmos_read
comma
dot
id|write
op_assign
id|cmos_write
comma
dot
id|experimental
op_assign
l_int|1
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;led&quot;
comma
dot
id|read
op_assign
id|led_read
comma
dot
id|write
op_assign
id|led_write
comma
dot
id|experimental
op_assign
l_int|1
comma
)brace
comma
(brace
dot
id|name
op_assign
l_string|&quot;beep&quot;
comma
dot
id|read
op_assign
id|beep_read
comma
dot
id|write
op_assign
id|beep_write
comma
dot
id|experimental
op_assign
l_int|1
comma
)brace
comma
)brace
suffix:semicolon
DECL|macro|NUM_IBMS
mdefine_line|#define NUM_IBMS (sizeof(ibms)/sizeof(ibms[0]))
DECL|function|dispatch_read
r_static
r_int
id|dispatch_read
c_func
(paren
r_char
op_star
id|page
comma
r_char
op_star
op_star
id|start
comma
id|off_t
id|off
comma
r_int
id|count
comma
r_int
op_star
id|eof
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|ibm_struct
op_star
id|ibm
op_assign
(paren
r_struct
id|ibm_struct
op_star
)paren
id|data
suffix:semicolon
r_int
id|len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ibm
op_logical_or
op_logical_neg
id|ibm-&gt;read
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|len
op_assign
id|ibm
op_member_access_from_pointer
id|read
c_func
(paren
id|ibm
comma
id|page
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
r_return
id|len
suffix:semicolon
r_if
c_cond
(paren
id|len
op_le
id|off
op_plus
id|count
)paren
op_star
id|eof
op_assign
l_int|1
suffix:semicolon
op_star
id|start
op_assign
id|page
op_plus
id|off
suffix:semicolon
id|len
op_sub_assign
id|off
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
id|count
)paren
id|len
op_assign
id|count
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|0
)paren
id|len
op_assign
l_int|0
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|dispatch_write
r_static
r_int
id|dispatch_write
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_const
r_char
id|__user
op_star
id|userbuf
comma
r_int
r_int
id|count
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|ibm_struct
op_star
id|ibm
op_assign
(paren
r_struct
id|ibm_struct
op_star
)paren
id|data
suffix:semicolon
r_char
op_star
id|kernbuf
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ibm
op_logical_or
op_logical_neg
id|ibm-&gt;write
)paren
r_return
op_minus
id|EINVAL
suffix:semicolon
id|kernbuf
op_assign
id|kmalloc
c_func
(paren
id|count
op_plus
l_int|2
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|kernbuf
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|kernbuf
comma
id|userbuf
comma
id|count
)paren
)paren
(brace
id|kfree
c_func
(paren
id|kernbuf
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|kernbuf
(braket
id|count
)braket
op_assign
l_int|0
suffix:semicolon
id|strcat
c_func
(paren
id|kernbuf
comma
l_string|&quot;,&quot;
)paren
suffix:semicolon
id|ret
op_assign
id|ibm
op_member_access_from_pointer
id|write
c_func
(paren
id|ibm
comma
id|kernbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_eq
l_int|0
)paren
id|ret
op_assign
id|count
suffix:semicolon
id|kfree
c_func
(paren
id|kernbuf
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|dispatch_notify
r_static
r_void
id|dispatch_notify
c_func
(paren
id|acpi_handle
id|handle
comma
id|u32
id|event
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|ibm_struct
op_star
id|ibm
op_assign
(paren
r_struct
id|ibm_struct
op_star
)paren
id|data
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ibm
op_logical_or
op_logical_neg
id|ibm-&gt;notify
)paren
r_return
suffix:semicolon
id|ibm
op_member_access_from_pointer
id|notify
c_func
(paren
id|ibm
comma
id|event
)paren
suffix:semicolon
)brace
DECL|function|setup_notify
r_static
r_int
id|setup_notify
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
)paren
(brace
id|acpi_status
id|status
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|ibm-&gt;handle
)paren
r_return
l_int|0
suffix:semicolon
id|ret
op_assign
id|acpi_bus_get_device
c_func
(paren
op_star
id|ibm-&gt;handle
comma
op_amp
id|ibm-&gt;device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|IBM_ERR
l_string|&quot;%s device not present&bslash;n&quot;
comma
id|ibm-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|acpi_driver_data
c_func
(paren
id|ibm-&gt;device
)paren
op_assign
id|ibm
suffix:semicolon
id|sprintf
c_func
(paren
id|acpi_device_class
c_func
(paren
id|ibm-&gt;device
)paren
comma
l_string|&quot;%s/%s&quot;
comma
id|IBM_NAME
comma
id|ibm-&gt;name
)paren
suffix:semicolon
id|status
op_assign
id|acpi_install_notify_handler
c_func
(paren
op_star
id|ibm-&gt;handle
comma
id|ibm-&gt;type
comma
id|dispatch_notify
comma
id|ibm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
c_func
(paren
id|status
)paren
)paren
(brace
id|printk
c_func
(paren
id|IBM_ERR
l_string|&quot;acpi_install_notify_handler(%s) failed: %d&bslash;n&quot;
comma
id|ibm-&gt;name
comma
id|status
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|ibm-&gt;notify_installed
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|device_add
r_static
r_int
id|device_add
c_func
(paren
r_struct
id|acpi_device
op_star
id|device
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|register_driver
r_static
r_int
id|register_driver
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
)paren
(brace
r_int
id|ret
suffix:semicolon
id|ibm-&gt;driver
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|acpi_driver
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ibm-&gt;driver
)paren
(brace
id|printk
c_func
(paren
id|IBM_ERR
l_string|&quot;kmalloc(ibm-&gt;driver) failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|memset
c_func
(paren
id|ibm-&gt;driver
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|acpi_driver
)paren
)paren
suffix:semicolon
id|sprintf
c_func
(paren
id|ibm-&gt;driver-&gt;name
comma
l_string|&quot;%s/%s&quot;
comma
id|IBM_NAME
comma
id|ibm-&gt;name
)paren
suffix:semicolon
id|ibm-&gt;driver-&gt;ids
op_assign
id|ibm-&gt;hid
suffix:semicolon
id|ibm-&gt;driver-&gt;ops.add
op_assign
op_amp
id|device_add
suffix:semicolon
id|ret
op_assign
id|acpi_bus_register_driver
c_func
(paren
id|ibm-&gt;driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|IBM_ERR
l_string|&quot;acpi_bus_register_driver(%s) failed: %d&bslash;n&quot;
comma
id|ibm-&gt;hid
comma
id|ret
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ibm-&gt;driver
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|ibm_init
r_static
r_int
id|ibm_init
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
)paren
(brace
r_int
id|ret
suffix:semicolon
r_struct
id|proc_dir_entry
op_star
id|entry
suffix:semicolon
r_if
c_cond
(paren
id|ibm-&gt;experimental
op_logical_and
op_logical_neg
id|experimental
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|ibm-&gt;hid
)paren
(brace
id|ret
op_assign
id|register_driver
c_func
(paren
id|ibm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|ibm-&gt;driver_registered
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ibm-&gt;init
)paren
(brace
id|ret
op_assign
id|ibm
op_member_access_from_pointer
id|init
c_func
(paren
id|ibm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
op_ne
l_int|0
)paren
r_return
id|ret
suffix:semicolon
id|ibm-&gt;init_called
op_assign
l_int|1
suffix:semicolon
)brace
id|entry
op_assign
id|create_proc_entry
c_func
(paren
id|ibm-&gt;name
comma
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|proc_dir
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|entry
)paren
(brace
id|printk
c_func
(paren
id|IBM_ERR
l_string|&quot;unable to create proc entry %s&bslash;n&quot;
comma
id|ibm-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|entry-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
id|ibm-&gt;proc_created
op_assign
l_int|1
suffix:semicolon
id|entry-&gt;data
op_assign
id|ibm
suffix:semicolon
r_if
c_cond
(paren
id|ibm-&gt;read
)paren
id|entry-&gt;read_proc
op_assign
op_amp
id|dispatch_read
suffix:semicolon
r_if
c_cond
(paren
id|ibm-&gt;write
)paren
id|entry-&gt;write_proc
op_assign
op_amp
id|dispatch_write
suffix:semicolon
r_if
c_cond
(paren
id|ibm-&gt;notify
)paren
(brace
id|ret
op_assign
id|setup_notify
c_func
(paren
id|ibm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
r_return
id|ret
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ibm_exit
r_static
r_void
id|ibm_exit
c_func
(paren
r_struct
id|ibm_struct
op_star
id|ibm
)paren
(brace
r_if
c_cond
(paren
id|ibm-&gt;notify_installed
)paren
id|acpi_remove_notify_handler
c_func
(paren
op_star
id|ibm-&gt;handle
comma
id|ibm-&gt;type
comma
id|dispatch_notify
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ibm-&gt;proc_created
)paren
id|remove_proc_entry
c_func
(paren
id|ibm-&gt;name
comma
id|proc_dir
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ibm-&gt;init_called
op_logical_and
id|ibm
op_member_access_from_pointer
m_exit
)paren
id|ibm
op_member_access_from_pointer
m_exit
(paren
id|ibm
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ibm-&gt;driver_registered
)paren
(brace
id|acpi_bus_unregister_driver
c_func
(paren
id|ibm-&gt;driver
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|ibm-&gt;driver
)paren
suffix:semicolon
)brace
)brace
DECL|function|ibm_handle_init
r_static
r_int
id|ibm_handle_init
c_func
(paren
r_char
op_star
id|name
comma
id|acpi_handle
op_star
id|handle
comma
id|acpi_handle
id|parent
comma
r_char
op_star
op_star
id|paths
comma
r_int
id|num_paths
comma
r_int
id|required
)paren
(brace
r_int
id|i
suffix:semicolon
id|acpi_status
id|status
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_paths
suffix:semicolon
id|i
op_increment
)paren
(brace
id|status
op_assign
id|acpi_get_handle
c_func
(paren
id|parent
comma
id|paths
(braket
id|i
)braket
comma
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_SUCCESS
c_func
(paren
id|status
)paren
)paren
r_return
l_int|0
suffix:semicolon
)brace
op_star
id|handle
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|required
)paren
(brace
id|printk
c_func
(paren
id|IBM_ERR
l_string|&quot;%s object not found&bslash;n&quot;
comma
id|name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|macro|IBM_HANDLE_INIT
mdefine_line|#define IBM_HANDLE_INIT(object, required)&t;&t;&t;&t;&bslash;&n;&t;ibm_handle_init(#object, &amp;object##_handle, *object##_parent,&t;&bslash;&n;&t;&t;object##_paths, sizeof(object##_paths)/sizeof(char*), required)
DECL|function|set_ibm_param
r_static
r_int
id|set_ibm_param
c_func
(paren
r_const
r_char
op_star
id|val
comma
r_struct
id|kernel_param
op_star
id|kp
)paren
(brace
r_int
r_int
id|i
suffix:semicolon
r_char
id|arg_with_comma
(braket
l_int|32
)braket
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|val
)paren
OG
l_int|30
)paren
r_return
op_minus
id|ENOSPC
suffix:semicolon
id|strcpy
c_func
(paren
id|arg_with_comma
comma
id|val
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|arg_with_comma
comma
l_string|&quot;,&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_IBMS
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|ibms
(braket
id|i
)braket
dot
id|name
comma
id|kp-&gt;name
)paren
op_eq
l_int|0
)paren
r_return
id|ibms
(braket
id|i
)braket
dot
id|write
c_func
(paren
op_amp
id|ibms
(braket
id|i
)braket
comma
id|arg_with_comma
)paren
suffix:semicolon
id|BUG
c_func
(paren
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
DECL|macro|IBM_PARAM
mdefine_line|#define IBM_PARAM(feature) &bslash;&n;&t;module_param_call(feature, set_ibm_param, NULL, NULL, 0)
DECL|function|acpi_ibm_exit
r_static
r_void
id|__exit
id|acpi_ibm_exit
c_func
(paren
r_void
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|NUM_IBMS
op_minus
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
id|ibm_exit
c_func
(paren
op_amp
id|ibms
(braket
id|i
)braket
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|IBM_DIR
comma
id|acpi_root_dir
)paren
suffix:semicolon
)brace
DECL|function|acpi_ibm_init
r_static
r_int
id|__init
id|acpi_ibm_init
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
id|acpi_disabled
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/* these handles are required */
r_if
c_cond
(paren
id|IBM_HANDLE_INIT
c_func
(paren
id|ec
comma
l_int|1
)paren
OL
l_int|0
op_logical_or
id|IBM_HANDLE_INIT
c_func
(paren
id|hkey
comma
l_int|1
)paren
OL
l_int|0
op_logical_or
id|IBM_HANDLE_INIT
c_func
(paren
id|vid
comma
l_int|1
)paren
OL
l_int|0
op_logical_or
id|IBM_HANDLE_INIT
c_func
(paren
id|beep
comma
l_int|1
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/* these handles have alternatives */
id|IBM_HANDLE_INIT
c_func
(paren
id|lght
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IBM_HANDLE_INIT
c_func
(paren
id|cmos
comma
op_logical_neg
id|lght_handle
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
id|IBM_HANDLE_INIT
c_func
(paren
id|sysl
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|IBM_HANDLE_INIT
c_func
(paren
id|led
comma
op_logical_neg
id|sysl_handle
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENODEV
suffix:semicolon
multiline_comment|/* these handles are not required */
id|IBM_HANDLE_INIT
c_func
(paren
id|dock
comma
l_int|0
)paren
suffix:semicolon
id|IBM_HANDLE_INIT
c_func
(paren
id|bay
comma
l_int|0
)paren
suffix:semicolon
id|IBM_HANDLE_INIT
c_func
(paren
id|bayej
comma
l_int|0
)paren
suffix:semicolon
id|IBM_HANDLE_INIT
c_func
(paren
id|bled
comma
l_int|0
)paren
suffix:semicolon
id|proc_dir
op_assign
id|proc_mkdir
c_func
(paren
id|IBM_DIR
comma
id|acpi_root_dir
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|proc_dir
)paren
(brace
id|printk
c_func
(paren
id|IBM_ERR
l_string|&quot;unable to create proc dir %s&quot;
comma
id|IBM_DIR
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
id|proc_dir-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NUM_IBMS
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ret
op_assign
id|ibm_init
c_func
(paren
op_amp
id|ibms
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
)paren
(brace
id|acpi_ibm_exit
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|acpi_ibm_init
id|module_init
c_func
(paren
id|acpi_ibm_init
)paren
suffix:semicolon
DECL|variable|acpi_ibm_exit
id|module_exit
c_func
(paren
id|acpi_ibm_exit
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Borislav Deianov&quot;
)paren
suffix:semicolon
DECL|variable|IBM_DESC
id|MODULE_DESCRIPTION
c_func
(paren
id|IBM_DESC
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|hotkey
id|IBM_PARAM
c_func
(paren
id|hotkey
)paren
suffix:semicolon
DECL|variable|bluetooth
id|IBM_PARAM
c_func
(paren
id|bluetooth
)paren
suffix:semicolon
DECL|variable|video
id|IBM_PARAM
c_func
(paren
id|video
)paren
suffix:semicolon
DECL|variable|light
id|IBM_PARAM
c_func
(paren
id|light
)paren
suffix:semicolon
DECL|variable|dock
id|IBM_PARAM
c_func
(paren
id|dock
)paren
suffix:semicolon
DECL|variable|bay
id|IBM_PARAM
c_func
(paren
id|bay
)paren
suffix:semicolon
DECL|variable|cmos
id|IBM_PARAM
c_func
(paren
id|cmos
)paren
suffix:semicolon
DECL|variable|led
id|IBM_PARAM
c_func
(paren
id|led
)paren
suffix:semicolon
DECL|variable|beep
id|IBM_PARAM
c_func
(paren
id|beep
)paren
suffix:semicolon
eof
