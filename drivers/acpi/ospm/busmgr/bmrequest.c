multiline_comment|/******************************************************************************&n; *&n; * Module Name: bmrequest.c&n; *   $Revision: 12 $&n; *&n; *****************************************************************************/
multiline_comment|/*&n; *  Copyright (C) 2000, 2001 Andrew Grover&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or&n; *  (at your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; */
macro_line|#include &lt;acpi.h&gt;
macro_line|#include &quot;bm.h&quot;
DECL|macro|_COMPONENT
mdefine_line|#define _COMPONENT&t;&t;ACPI_BUS
id|MODULE_NAME
(paren
l_string|&quot;bmrequest&quot;
)paren
multiline_comment|/****************************************************************************&n; *                            External Functions&n; ****************************************************************************/
multiline_comment|/****************************************************************************&n; *&n; * FUNCTION:    bm_generate_request&n; *&n; * PARAMETERS:  &n; *&n; * RETURN:      &n; *&n; * DESCRIPTION: &n; *&n; ****************************************************************************/
id|ACPI_STATUS
DECL|function|bm_generate_request
id|bm_generate_request
(paren
id|BM_NODE
op_star
id|node
comma
id|BM_REQUEST
op_star
id|request
)paren
(brace
id|ACPI_STATUS
id|status
op_assign
id|AE_OK
suffix:semicolon
id|BM_DEVICE
op_star
id|device
op_assign
l_int|NULL
suffix:semicolon
id|FUNCTION_TRACE
c_func
(paren
l_string|&quot;bm_generate_request&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|node
op_logical_or
op_logical_neg
id|request
)paren
(brace
id|return_ACPI_STATUS
c_func
(paren
id|AE_BAD_PARAMETER
)paren
suffix:semicolon
)brace
id|device
op_assign
op_amp
(paren
id|node-&gt;device
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|BM_IS_DRIVER_CONTROL
c_func
(paren
id|device
)paren
)paren
(brace
id|DEBUG_PRINT
c_func
(paren
id|ACPI_WARN
comma
(paren
l_string|&quot;No driver installed for device [%02x].&bslash;n&quot;
comma
id|device-&gt;handle
)paren
)paren
suffix:semicolon
id|return_ACPI_STATUS
c_func
(paren
id|AE_NOT_EXIST
)paren
suffix:semicolon
)brace
id|status
op_assign
id|node-&gt;driver
dot
id|request
c_func
(paren
id|request
comma
id|node-&gt;driver.context
)paren
suffix:semicolon
id|return_ACPI_STATUS
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/****************************************************************************&n; *&n; * FUNCTION:    bm_request&n; *&n; * PARAMETERS:  &n; *&n; * RETURN:      &n; *&n; * DESCRIPTION: &n; *&n; ****************************************************************************/
id|ACPI_STATUS
DECL|function|bm_request
id|bm_request
(paren
id|BM_REQUEST
op_star
id|request
)paren
(brace
id|ACPI_STATUS
id|status
op_assign
id|AE_OK
suffix:semicolon
id|BM_NODE
op_star
id|node
op_assign
l_int|NULL
suffix:semicolon
id|BM_DEVICE
op_star
id|device
op_assign
l_int|NULL
suffix:semicolon
id|FUNCTION_TRACE
c_func
(paren
l_string|&quot;bm_request&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Must have a valid request structure.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|request
)paren
(brace
id|return_ACPI_STATUS
c_func
(paren
id|AE_BAD_PARAMETER
)paren
suffix:semicolon
)brace
id|DEBUG_PRINT
c_func
(paren
id|ACPI_INFO
comma
(paren
l_string|&quot;Received request for device [%02x] command [%02x].&bslash;n&quot;
comma
id|request-&gt;handle
comma
id|request-&gt;command
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Resolve the node.&n;&t; */
id|status
op_assign
id|bm_get_node
c_func
(paren
id|request-&gt;handle
comma
l_int|0
comma
op_amp
id|node
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
c_func
(paren
id|status
)paren
)paren
(brace
id|return_ACPI_STATUS
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
id|device
op_assign
op_amp
(paren
id|node-&gt;device
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Device-Specific Request?&n;&t; * ------------------------&n;&t; * If a device-specific command (&gt;=0x80) forward this request to&n;&t; * the appropriate driver.&n;&t; */
r_if
c_cond
(paren
id|request-&gt;command
op_amp
id|BM_COMMAND_DEVICE_SPECIFIC
)paren
(brace
id|status
op_assign
id|bm_generate_request
c_func
(paren
id|node
comma
id|request
)paren
suffix:semicolon
id|return_ACPI_STATUS
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Bus-Specific Requests:&n;&t; * ----------------------&n;&t; */
r_switch
c_cond
(paren
id|request-&gt;command
)paren
(brace
r_case
id|BM_COMMAND_GET_POWER_STATE
suffix:colon
id|status
op_assign
id|bm_get_power_state
c_func
(paren
id|node
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
c_func
(paren
id|status
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
id|status
op_assign
id|bm_copy_to_buffer
c_func
(paren
op_amp
(paren
id|request-&gt;buffer
)paren
comma
op_amp
(paren
id|device-&gt;power.state
)paren
comma
r_sizeof
(paren
id|BM_POWER_STATE
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|BM_COMMAND_SET_POWER_STATE
suffix:colon
(brace
id|BM_POWER_STATE
op_star
id|power_state
op_assign
l_int|NULL
suffix:semicolon
id|status
op_assign
id|bm_cast_buffer
c_func
(paren
op_amp
(paren
id|request-&gt;buffer
)paren
comma
(paren
r_void
op_star
op_star
)paren
op_amp
id|power_state
comma
r_sizeof
(paren
id|BM_POWER_STATE
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
c_func
(paren
id|status
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
id|status
op_assign
id|bm_set_power_state
c_func
(paren
id|node
comma
op_star
id|power_state
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_default
suffix:colon
id|status
op_assign
id|AE_SUPPORT
suffix:semicolon
id|request-&gt;status
op_assign
id|AE_SUPPORT
suffix:semicolon
r_break
suffix:semicolon
)brace
id|return_ACPI_STATUS
c_func
(paren
id|status
)paren
suffix:semicolon
)brace
eof
