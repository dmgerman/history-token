multiline_comment|/******************************************************************************&n; *&n; * Module Name: evrgnini- ACPI address_space (op_region) init&n; *&n; *****************************************************************************/
multiline_comment|/*&n; * Copyright (C) 2000 - 2004, R. Byron Moore&n; * All rights reserved.&n; *&n; * Redistribution and use in source and binary forms, with or without&n; * modification, are permitted provided that the following conditions&n; * are met:&n; * 1. Redistributions of source code must retain the above copyright&n; *    notice, this list of conditions, and the following disclaimer,&n; *    without modification.&n; * 2. Redistributions in binary form must reproduce at minimum a disclaimer&n; *    substantially similar to the &quot;NO WARRANTY&quot; disclaimer below&n; *    (&quot;Disclaimer&quot;) and any redistribution must be conditioned upon&n; *    including a substantially similar Disclaimer requirement for further&n; *    binary redistribution.&n; * 3. Neither the names of the above-listed copyright holders nor the names&n; *    of any contributors may be used to endorse or promote products derived&n; *    from this software without specific prior written permission.&n; *&n; * Alternatively, this software may be distributed under the terms of the&n; * GNU General Public License (&quot;GPL&quot;) version 2 as published by the Free&n; * Software Foundation.&n; *&n; * NO WARRANTY&n; * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS&n; * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT&n; * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR&n; * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT&n; * HOLDERS OR CONTRIBUTORS BE LIABLE FOR SPECIAL, EXEMPLARY, OR CONSEQUENTIAL&n; * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS&n; * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)&n; * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,&n; * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING&n; * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE&n; * POSSIBILITY OF SUCH DAMAGES.&n; */
macro_line|#include &lt;acpi/acpi.h&gt;
macro_line|#include &lt;acpi/acevents.h&gt;
macro_line|#include &lt;acpi/acnamesp.h&gt;
DECL|macro|_COMPONENT
mdefine_line|#define _COMPONENT          ACPI_EVENTS
id|ACPI_MODULE_NAME
(paren
l_string|&quot;evrgnini&quot;
)paren
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ev_system_memory_region_setup&n; *&n; * PARAMETERS:  Handle              - Region we are interested in&n; *              Function            - Start or stop&n; *              handler_context     - Address space handler context&n; *              region_context      - Region specific context&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Do any prep work for region handling, a nop for now&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ev_system_memory_region_setup
id|acpi_ev_system_memory_region_setup
(paren
id|acpi_handle
id|handle
comma
id|u32
id|function
comma
r_void
op_star
id|handler_context
comma
r_void
op_star
op_star
id|region_context
)paren
(brace
r_union
id|acpi_operand_object
op_star
id|region_desc
op_assign
(paren
r_union
id|acpi_operand_object
op_star
)paren
id|handle
suffix:semicolon
r_struct
id|acpi_mem_space_context
op_star
id|local_region_context
suffix:semicolon
id|ACPI_FUNCTION_TRACE
(paren
l_string|&quot;ev_system_memory_region_setup&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|function
op_eq
id|ACPI_REGION_DEACTIVATE
)paren
(brace
r_if
c_cond
(paren
op_star
id|region_context
)paren
(brace
id|ACPI_MEM_FREE
(paren
op_star
id|region_context
)paren
suffix:semicolon
op_star
id|region_context
op_assign
l_int|NULL
suffix:semicolon
)brace
id|return_ACPI_STATUS
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/* Create a new context */
id|local_region_context
op_assign
id|ACPI_MEM_CALLOCATE
(paren
r_sizeof
(paren
r_struct
id|acpi_mem_space_context
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|local_region_context
)paren
)paren
(brace
id|return_ACPI_STATUS
(paren
id|AE_NO_MEMORY
)paren
suffix:semicolon
)brace
multiline_comment|/* Save the region length and address for use in the handler */
id|local_region_context-&gt;length
op_assign
id|region_desc-&gt;region.length
suffix:semicolon
id|local_region_context-&gt;address
op_assign
id|region_desc-&gt;region.address
suffix:semicolon
op_star
id|region_context
op_assign
id|local_region_context
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ev_io_space_region_setup&n; *&n; * PARAMETERS:  Handle              - Region we are interested in&n; *              Function            - Start or stop&n; *              handler_context     - Address space handler context&n; *              region_context      - Region specific context&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Do any prep work for region handling&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ev_io_space_region_setup
id|acpi_ev_io_space_region_setup
(paren
id|acpi_handle
id|handle
comma
id|u32
id|function
comma
r_void
op_star
id|handler_context
comma
r_void
op_star
op_star
id|region_context
)paren
(brace
id|ACPI_FUNCTION_TRACE
(paren
l_string|&quot;ev_io_space_region_setup&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|function
op_eq
id|ACPI_REGION_DEACTIVATE
)paren
(brace
op_star
id|region_context
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
op_star
id|region_context
op_assign
id|handler_context
suffix:semicolon
)brace
id|return_ACPI_STATUS
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ev_pci_config_region_setup&n; *&n; * PARAMETERS:  Handle             - Region we are interested in&n; *              Function            - Start or stop&n; *              handler_context     - Address space handler context&n; *              region_context      - Region specific context&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Do any prep work for region handling&n; *&n; * MUTEX:       Assumes namespace is not locked&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ev_pci_config_region_setup
id|acpi_ev_pci_config_region_setup
(paren
id|acpi_handle
id|handle
comma
id|u32
id|function
comma
r_void
op_star
id|handler_context
comma
r_void
op_star
op_star
id|region_context
)paren
(brace
id|acpi_status
id|status
op_assign
id|AE_OK
suffix:semicolon
id|acpi_integer
id|pci_value
suffix:semicolon
r_struct
id|acpi_pci_id
op_star
id|pci_id
op_assign
op_star
id|region_context
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|handler_obj
suffix:semicolon
r_struct
id|acpi_namespace_node
op_star
id|parent_node
suffix:semicolon
r_struct
id|acpi_namespace_node
op_star
id|pci_root_node
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|region_obj
op_assign
(paren
r_union
id|acpi_operand_object
op_star
)paren
id|handle
suffix:semicolon
r_struct
id|acpi_device_id
id|object_hID
suffix:semicolon
id|ACPI_FUNCTION_TRACE
(paren
l_string|&quot;ev_pci_config_region_setup&quot;
)paren
suffix:semicolon
id|handler_obj
op_assign
id|region_obj-&gt;region.handler
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|handler_obj
)paren
(brace
multiline_comment|/*&n;&t;&t; * No installed handler. This shouldn&squot;t happen because the dispatch&n;&t;&t; * routine checks before we get here, but we check again just in case.&n;&t;&t; */
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_OPREGION
comma
l_string|&quot;Attempting to init a region %p, with no handler&bslash;n&quot;
comma
id|region_obj
)paren
)paren
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|AE_NOT_EXIST
)paren
suffix:semicolon
)brace
op_star
id|region_context
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|function
op_eq
id|ACPI_REGION_DEACTIVATE
)paren
(brace
r_if
c_cond
(paren
id|pci_id
)paren
(brace
id|ACPI_MEM_FREE
(paren
id|pci_id
)paren
suffix:semicolon
)brace
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
id|parent_node
op_assign
id|acpi_ns_get_parent_node
(paren
id|region_obj-&gt;region.node
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Get the _SEG and _BBN values from the device upon which the handler&n;&t; * is installed.&n;&t; *&n;&t; * We need to get the _SEG and _BBN objects relative to the PCI BUS device.&n;&t; * This is the device the handler has been registered to handle.&n;&t; */
multiline_comment|/*&n;&t; * If the address_space.Node is still pointing to the root, we need&n;&t; * to scan upward for a PCI Root bridge and re-associate the op_region&n;&t; * handlers with that device.&n;&t; */
r_if
c_cond
(paren
id|handler_obj-&gt;address_space.node
op_eq
id|acpi_gbl_root_node
)paren
(brace
multiline_comment|/* Start search from the parent object */
id|pci_root_node
op_assign
id|parent_node
suffix:semicolon
r_while
c_loop
(paren
id|pci_root_node
op_ne
id|acpi_gbl_root_node
)paren
(brace
id|status
op_assign
id|acpi_ut_execute_HID
(paren
id|pci_root_node
comma
op_amp
id|object_hID
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_SUCCESS
(paren
id|status
)paren
)paren
(brace
multiline_comment|/* Got a valid _HID, check if this is a PCI root */
r_if
c_cond
(paren
op_logical_neg
(paren
id|ACPI_STRNCMP
(paren
id|object_hID.value
comma
id|PCI_ROOT_HID_STRING
comma
r_sizeof
(paren
id|PCI_ROOT_HID_STRING
)paren
)paren
)paren
)paren
(brace
multiline_comment|/* Install a handler for this PCI root bridge */
id|status
op_assign
id|acpi_install_address_space_handler
(paren
(paren
id|acpi_handle
)paren
id|pci_root_node
comma
id|ACPI_ADR_SPACE_PCI_CONFIG
comma
id|ACPI_DEFAULT_HANDLER
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
r_if
c_cond
(paren
id|status
op_eq
id|AE_SAME_HANDLER
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t;&t;&t;&t; * It is OK if the handler is already installed on the root&n;&t;&t;&t;&t;&t;&t;&t; * bridge.  Still need to return a context object for the&n;&t;&t;&t;&t;&t;&t;&t; * new PCI_Config operation region, however.&n;&t;&t;&t;&t;&t;&t;&t; */
id|status
op_assign
id|AE_OK
suffix:semicolon
)brace
r_else
(brace
id|ACPI_REPORT_ERROR
(paren
(paren
l_string|&quot;Could not install pci_config handler for Root Bridge %4.4s, %s&bslash;n&quot;
comma
id|acpi_ut_get_node_name
(paren
id|pci_root_node
)paren
comma
id|acpi_format_exception
(paren
id|status
)paren
)paren
)paren
suffix:semicolon
)brace
)brace
r_break
suffix:semicolon
)brace
)brace
id|pci_root_node
op_assign
id|acpi_ns_get_parent_node
(paren
id|pci_root_node
)paren
suffix:semicolon
)brace
multiline_comment|/* PCI root bridge not found, use namespace root node */
)brace
r_else
(brace
id|pci_root_node
op_assign
id|handler_obj-&gt;address_space.node
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * If this region is now initialized, we are done.&n;&t; * (install_address_space_handler could have initialized it)&n;&t; */
r_if
c_cond
(paren
id|region_obj-&gt;region.flags
op_amp
id|AOPOBJ_SETUP_COMPLETE
)paren
(brace
id|return_ACPI_STATUS
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/* Region is still not initialized. Create a new context */
id|pci_id
op_assign
id|ACPI_MEM_CALLOCATE
(paren
r_sizeof
(paren
r_struct
id|acpi_pci_id
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pci_id
)paren
(brace
id|return_ACPI_STATUS
(paren
id|AE_NO_MEMORY
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * For PCI_Config space access, we need the segment, bus,&n;&t; * device and function numbers.  Acquire them here.&n;&t; */
multiline_comment|/*&n;&t; * Get the PCI device and function numbers from the _ADR object&n;&t; * contained in the parent&squot;s scope.&n;&t; */
id|status
op_assign
id|acpi_ut_evaluate_numeric_object
(paren
id|METHOD_NAME__ADR
comma
id|parent_node
comma
op_amp
id|pci_value
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * The default is zero, and since the allocation above zeroed&n;&t; * the data, just do nothing on failure.&n;&t; */
r_if
c_cond
(paren
id|ACPI_SUCCESS
(paren
id|status
)paren
)paren
(brace
id|pci_id-&gt;device
op_assign
id|ACPI_HIWORD
(paren
id|ACPI_LODWORD
(paren
id|pci_value
)paren
)paren
suffix:semicolon
id|pci_id-&gt;function
op_assign
id|ACPI_LOWORD
(paren
id|ACPI_LODWORD
(paren
id|pci_value
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* The PCI segment number comes from the _SEG method */
id|status
op_assign
id|acpi_ut_evaluate_numeric_object
(paren
id|METHOD_NAME__SEG
comma
id|pci_root_node
comma
op_amp
id|pci_value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_SUCCESS
(paren
id|status
)paren
)paren
(brace
id|pci_id-&gt;segment
op_assign
id|ACPI_LOWORD
(paren
id|pci_value
)paren
suffix:semicolon
)brace
multiline_comment|/* The PCI bus number comes from the _BBN method */
id|status
op_assign
id|acpi_ut_evaluate_numeric_object
(paren
id|METHOD_NAME__BBN
comma
id|pci_root_node
comma
op_amp
id|pci_value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_SUCCESS
(paren
id|status
)paren
)paren
(brace
id|pci_id-&gt;bus
op_assign
id|ACPI_LOWORD
(paren
id|pci_value
)paren
suffix:semicolon
)brace
multiline_comment|/* Complete this device&squot;s pci_id */
id|acpi_os_derive_pci_id
(paren
id|pci_root_node
comma
id|region_obj-&gt;region.node
comma
op_amp
id|pci_id
)paren
suffix:semicolon
op_star
id|region_context
op_assign
id|pci_id
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ev_pci_bar_region_setup&n; *&n; * PARAMETERS:  Handle              - Region we are interested in&n; *              Function            - Start or stop&n; *              handler_context     - Address space handler context&n; *              region_context      - Region specific context&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Do any prep work for region handling&n; *&n; * MUTEX:       Assumes namespace is not locked&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ev_pci_bar_region_setup
id|acpi_ev_pci_bar_region_setup
(paren
id|acpi_handle
id|handle
comma
id|u32
id|function
comma
r_void
op_star
id|handler_context
comma
r_void
op_star
op_star
id|region_context
)paren
(brace
id|ACPI_FUNCTION_TRACE
(paren
l_string|&quot;ev_pci_bar_region_setup&quot;
)paren
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ev_cmos_region_setup&n; *&n; * PARAMETERS:  Handle              - Region we are interested in&n; *              Function            - Start or stop&n; *              handler_context     - Address space handler context&n; *              region_context      - Region specific context&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Do any prep work for region handling&n; *&n; * MUTEX:       Assumes namespace is not locked&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ev_cmos_region_setup
id|acpi_ev_cmos_region_setup
(paren
id|acpi_handle
id|handle
comma
id|u32
id|function
comma
r_void
op_star
id|handler_context
comma
r_void
op_star
op_star
id|region_context
)paren
(brace
id|ACPI_FUNCTION_TRACE
(paren
l_string|&quot;ev_cmos_region_setup&quot;
)paren
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ev_default_region_setup&n; *&n; * PARAMETERS:  Handle              - Region we are interested in&n; *              Function            - Start or stop&n; *              handler_context     - Address space handler context&n; *              region_context      - Region specific context&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Do any prep work for region handling&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ev_default_region_setup
id|acpi_ev_default_region_setup
(paren
id|acpi_handle
id|handle
comma
id|u32
id|function
comma
r_void
op_star
id|handler_context
comma
r_void
op_star
op_star
id|region_context
)paren
(brace
id|ACPI_FUNCTION_TRACE
(paren
l_string|&quot;ev_default_region_setup&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|function
op_eq
id|ACPI_REGION_DEACTIVATE
)paren
(brace
op_star
id|region_context
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
op_star
id|region_context
op_assign
id|handler_context
suffix:semicolon
)brace
id|return_ACPI_STATUS
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    acpi_ev_initialize_region&n; *&n; * PARAMETERS:  region_obj      - Region we are initializing&n; *              acpi_ns_locked  - Is namespace locked?&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Initializes the region, finds any _REG methods and saves them&n; *              for execution at a later time&n; *&n; *              Get the appropriate address space handler for a newly&n; *              created region.&n; *&n; *              This also performs address space specific initialization.  For&n; *              example, PCI regions must have an _ADR object that contains&n; *              a PCI address in the scope of the definition.  This address is&n; *              required to perform an access to PCI config space.&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ev_initialize_region
id|acpi_ev_initialize_region
(paren
r_union
id|acpi_operand_object
op_star
id|region_obj
comma
id|u8
id|acpi_ns_locked
)paren
(brace
r_union
id|acpi_operand_object
op_star
id|handler_obj
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|obj_desc
suffix:semicolon
id|acpi_adr_space_type
id|space_id
suffix:semicolon
r_struct
id|acpi_namespace_node
op_star
id|node
suffix:semicolon
id|acpi_status
id|status
suffix:semicolon
r_struct
id|acpi_namespace_node
op_star
id|method_node
suffix:semicolon
id|acpi_name
op_star
id|reg_name_ptr
op_assign
(paren
id|acpi_name
op_star
)paren
id|METHOD_NAME__REG
suffix:semicolon
r_union
id|acpi_operand_object
op_star
id|region_obj2
suffix:semicolon
id|ACPI_FUNCTION_TRACE_U32
(paren
l_string|&quot;ev_initialize_region&quot;
comma
id|acpi_ns_locked
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|region_obj
)paren
(brace
id|return_ACPI_STATUS
(paren
id|AE_BAD_PARAMETER
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|region_obj-&gt;common.flags
op_amp
id|AOPOBJ_OBJECT_INITIALIZED
)paren
(brace
id|return_ACPI_STATUS
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
id|region_obj2
op_assign
id|acpi_ns_get_secondary_object
(paren
id|region_obj
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|region_obj2
)paren
(brace
id|return_ACPI_STATUS
(paren
id|AE_NOT_EXIST
)paren
suffix:semicolon
)brace
id|node
op_assign
id|acpi_ns_get_parent_node
(paren
id|region_obj-&gt;region.node
)paren
suffix:semicolon
id|space_id
op_assign
id|region_obj-&gt;region.space_id
suffix:semicolon
multiline_comment|/* Setup defaults */
id|region_obj-&gt;region.handler
op_assign
l_int|NULL
suffix:semicolon
id|region_obj2-&gt;extra.method_REG
op_assign
l_int|NULL
suffix:semicolon
id|region_obj-&gt;common.flags
op_and_assign
op_complement
(paren
id|AOPOBJ_SETUP_COMPLETE
)paren
suffix:semicolon
id|region_obj-&gt;common.flags
op_or_assign
id|AOPOBJ_OBJECT_INITIALIZED
suffix:semicolon
multiline_comment|/* Find any &quot;_REG&quot; method associated with this region definition */
id|status
op_assign
id|acpi_ns_search_node
(paren
op_star
id|reg_name_ptr
comma
id|node
comma
id|ACPI_TYPE_METHOD
comma
op_amp
id|method_node
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_SUCCESS
(paren
id|status
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * The _REG method is optional and there can be only one per region&n;&t;&t; * definition.  This will be executed when the handler is attached&n;&t;&t; * or removed&n;&t;&t; */
id|region_obj2-&gt;extra.method_REG
op_assign
id|method_node
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * The following loop depends upon the root Node having no parent&n;&t; * ie: acpi_gbl_root_node-&gt;parent_entry being set to NULL&n;&t; */
r_while
c_loop
(paren
id|node
)paren
(brace
multiline_comment|/* Check to see if a handler exists */
id|handler_obj
op_assign
l_int|NULL
suffix:semicolon
id|obj_desc
op_assign
id|acpi_ns_get_attached_object
(paren
id|node
)paren
suffix:semicolon
r_if
c_cond
(paren
id|obj_desc
)paren
(brace
multiline_comment|/* Can only be a handler if the object exists */
r_switch
c_cond
(paren
id|node-&gt;type
)paren
(brace
r_case
id|ACPI_TYPE_DEVICE
suffix:colon
id|handler_obj
op_assign
id|obj_desc-&gt;device.handler
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_TYPE_PROCESSOR
suffix:colon
id|handler_obj
op_assign
id|obj_desc-&gt;processor.handler
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_TYPE_THERMAL
suffix:colon
id|handler_obj
op_assign
id|obj_desc-&gt;thermal_zone.handler
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
multiline_comment|/* Ignore other objects */
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
id|handler_obj
)paren
(brace
multiline_comment|/* Is this handler of the correct type? */
r_if
c_cond
(paren
id|handler_obj-&gt;address_space.space_id
op_eq
id|space_id
)paren
(brace
multiline_comment|/* Found correct handler */
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_OPREGION
comma
l_string|&quot;Found handler %p for region %p in obj %p&bslash;n&quot;
comma
id|handler_obj
comma
id|region_obj
comma
id|obj_desc
)paren
)paren
suffix:semicolon
id|status
op_assign
id|acpi_ev_attach_region
(paren
id|handler_obj
comma
id|region_obj
comma
id|acpi_ns_locked
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t;&t;&t; * Tell all users that this region is usable by running the _REG&n;&t;&t;&t;&t;&t; * method&n;&t;&t;&t;&t;&t; */
r_if
c_cond
(paren
id|acpi_ns_locked
)paren
(brace
id|status
op_assign
id|acpi_ut_release_mutex
(paren
id|ACPI_MTX_NAMESPACE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
)brace
id|status
op_assign
id|acpi_ev_execute_reg_method
(paren
id|region_obj
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|acpi_ns_locked
)paren
(brace
id|status
op_assign
id|acpi_ut_acquire_mutex
(paren
id|ACPI_MTX_NAMESPACE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
)brace
id|return_ACPI_STATUS
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
multiline_comment|/* Try next handler in the list */
id|handler_obj
op_assign
id|handler_obj-&gt;address_space.next
suffix:semicolon
)brace
)brace
multiline_comment|/*&n;&t;&t; * This node does not have the handler we need;&n;&t;&t; * Pop up one level&n;&t;&t; */
id|node
op_assign
id|acpi_ns_get_parent_node
(paren
id|node
)paren
suffix:semicolon
)brace
multiline_comment|/* If we get here, there is no handler for this region */
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_OPREGION
comma
l_string|&quot;No handler for region_type %s(%X) (region_obj %p)&bslash;n&quot;
comma
id|acpi_ut_get_region_name
(paren
id|space_id
)paren
comma
id|space_id
comma
id|region_obj
)paren
)paren
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|AE_NOT_EXIST
)paren
suffix:semicolon
)brace
eof
