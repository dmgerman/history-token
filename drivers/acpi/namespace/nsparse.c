multiline_comment|/******************************************************************************&n; *&n; * Module Name: nsparse - namespace interface to AML parser&n; *&n; *****************************************************************************/
multiline_comment|/*&n; *  Copyright (C) 2000 - 2002, R. Byron Moore&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or&n; *  (at your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful,&n; *  but WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; *  GNU General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License&n; *  along with this program; if not, write to the Free Software&n; *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n; */
macro_line|#include &quot;acpi.h&quot;
macro_line|#include &quot;acnamesp.h&quot;
macro_line|#include &quot;acparser.h&quot;
macro_line|#include &quot;acdispat.h&quot;
DECL|macro|_COMPONENT
mdefine_line|#define _COMPONENT          ACPI_NAMESPACE
id|ACPI_MODULE_NAME
(paren
l_string|&quot;nsparse&quot;
)paren
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    Ns_one_complete_parse&n; *&n; * PARAMETERS:  Pass_number             - 1 or 2&n; *              Table_desc              - The table to be parsed.&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Perform one complete parse of an ACPI/AML table.&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ns_one_complete_parse
id|acpi_ns_one_complete_parse
(paren
id|u32
id|pass_number
comma
id|acpi_table_desc
op_star
id|table_desc
)paren
(brace
id|acpi_parse_object
op_star
id|parse_root
suffix:semicolon
id|acpi_status
id|status
suffix:semicolon
id|acpi_walk_state
op_star
id|walk_state
suffix:semicolon
id|ACPI_FUNCTION_TRACE
(paren
l_string|&quot;Ns_one_complete_parse&quot;
)paren
suffix:semicolon
multiline_comment|/* Create and init a Root Node */
id|parse_root
op_assign
id|acpi_ps_create_scope_op
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|parse_root
)paren
(brace
id|return_ACPI_STATUS
(paren
id|AE_NO_MEMORY
)paren
suffix:semicolon
)brace
multiline_comment|/* Create and initialize a new walk state */
id|walk_state
op_assign
id|acpi_ds_create_walk_state
(paren
id|TABLE_ID_DSDT
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|walk_state
)paren
(brace
id|acpi_ps_free_op
(paren
id|parse_root
)paren
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|AE_NO_MEMORY
)paren
suffix:semicolon
)brace
id|status
op_assign
id|acpi_ds_init_aml_walk
(paren
id|walk_state
comma
id|parse_root
comma
l_int|NULL
comma
id|table_desc-&gt;aml_start
comma
id|table_desc-&gt;aml_length
comma
l_int|NULL
comma
l_int|NULL
comma
id|pass_number
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
id|acpi_ds_delete_walk_state
(paren
id|walk_state
)paren
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/* Parse the AML */
id|ACPI_DEBUG_PRINT
(paren
(paren
id|ACPI_DB_PARSE
comma
l_string|&quot;*PARSE* pass %d parse&bslash;n&quot;
comma
id|pass_number
)paren
)paren
suffix:semicolon
id|status
op_assign
id|acpi_ps_parse_aml
(paren
id|walk_state
)paren
suffix:semicolon
id|acpi_ps_delete_parse_tree
(paren
id|parse_root
)paren
suffix:semicolon
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/*******************************************************************************&n; *&n; * FUNCTION:    Acpi_ns_parse_table&n; *&n; * PARAMETERS:  Table_desc      - An ACPI table descriptor for table to parse&n; *              Start_node      - Where to enter the table into the namespace&n; *&n; * RETURN:      Status&n; *&n; * DESCRIPTION: Parse AML within an ACPI table and return a tree of ops&n; *&n; ******************************************************************************/
id|acpi_status
DECL|function|acpi_ns_parse_table
id|acpi_ns_parse_table
(paren
id|acpi_table_desc
op_star
id|table_desc
comma
id|acpi_namespace_node
op_star
id|start_node
)paren
(brace
id|acpi_status
id|status
suffix:semicolon
id|ACPI_FUNCTION_TRACE
(paren
l_string|&quot;Ns_parse_table&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * AML Parse, pass 1&n;&t; *&n;&t; * In this pass, we load most of the namespace.  Control methods&n;&t; * are not parsed until later.  A parse tree is not created.  Instead,&n;&t; * each Parser Op subtree is deleted when it is finished.  This saves&n;&t; * a great deal of memory, and allows a small cache of parse objects&n;&t; * to service the entire parse.  The second pass of the parse then&n;&t; * performs another complete parse of the AML..&n;&t; */
id|status
op_assign
id|acpi_ns_one_complete_parse
(paren
l_int|1
comma
id|table_desc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * AML Parse, pass 2&n;&t; *&n;&t; * In this pass, we resolve forward references and other things&n;&t; * that could not be completed during the first pass.&n;&t; * Another complete parse of the AML is performed, but the&n;&t; * overhead of this is compensated for by the fact that the&n;&t; * parse objects are all cached.&n;&t; */
id|status
op_assign
id|acpi_ns_one_complete_parse
(paren
l_int|2
comma
id|table_desc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
(paren
id|status
)paren
)paren
(brace
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
id|return_ACPI_STATUS
(paren
id|status
)paren
suffix:semicolon
)brace
eof
