multiline_comment|/*&n; * acpi_processor.c - ACPI Processor Driver ($Revision: 71 $)&n; *&n; *  Copyright (C) 2001, 2002 Andy Grover &lt;andrew.grover@intel.com&gt;&n; *  Copyright (C) 2001, 2002 Paul Diefenbaugh &lt;paul.s.diefenbaugh@intel.com&gt;&n; *  Copyright (C) 2004       Dominik Brodowski &lt;linux@brodo.de&gt;&n; *  Copyright (C) 2004  Anil S Keshavamurthy &lt;anil.s.keshavamurthy@intel.com&gt;&n; *  &t;&t;&t;- Added processor hotplug support&n; *&n; * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&n; *&n; *  This program is free software; you can redistribute it and/or modify&n; *  it under the terms of the GNU General Public License as published by&n; *  the Free Software Foundation; either version 2 of the License, or (at&n; *  your option) any later version.&n; *&n; *  This program is distributed in the hope that it will be useful, but&n; *  WITHOUT ANY WARRANTY; without even the implied warranty of&n; *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU&n; *  General Public License for more details.&n; *&n; *  You should have received a copy of the GNU General Public License along&n; *  with this program; if not, write to the Free Software Foundation, Inc.,&n; *  59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.&n; *&n; * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&n; *  TBD:&n; *&t;1. Make # power states dynamic.&n; *&t;2. Support duty_cycle values that span bit 4.&n; *&t;3. Optimize by having scheduler determine business instead of&n; *&t;   having us try to calculate it here.&n; *&t;4. Need C1 timing -- must modify kernel (IRQ handler) to get this.&n; */
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/pm.h&gt;
macro_line|#include &lt;linux/cpufreq.h&gt;
macro_line|#include &lt;linux/cpu.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/seq_file.h&gt;
macro_line|#include &lt;linux/dmi.h&gt;
macro_line|#include &lt;linux/moduleparam.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/system.h&gt;
macro_line|#include &lt;asm/cpu.h&gt;
macro_line|#include &lt;asm/delay.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/processor.h&gt;
macro_line|#include &lt;asm/smp.h&gt;
macro_line|#include &lt;asm/acpi.h&gt;
macro_line|#include &lt;acpi/acpi_bus.h&gt;
macro_line|#include &lt;acpi/acpi_drivers.h&gt;
macro_line|#include &lt;acpi/processor.h&gt;
DECL|macro|ACPI_PROCESSOR_COMPONENT
mdefine_line|#define ACPI_PROCESSOR_COMPONENT&t;0x01000000
DECL|macro|ACPI_PROCESSOR_CLASS
mdefine_line|#define ACPI_PROCESSOR_CLASS&t;&t;&quot;processor&quot;
DECL|macro|ACPI_PROCESSOR_DRIVER_NAME
mdefine_line|#define ACPI_PROCESSOR_DRIVER_NAME&t;&quot;ACPI Processor Driver&quot;
DECL|macro|ACPI_PROCESSOR_DEVICE_NAME
mdefine_line|#define ACPI_PROCESSOR_DEVICE_NAME&t;&quot;Processor&quot;
DECL|macro|ACPI_PROCESSOR_FILE_INFO
mdefine_line|#define ACPI_PROCESSOR_FILE_INFO&t;&quot;info&quot;
DECL|macro|ACPI_PROCESSOR_FILE_THROTTLING
mdefine_line|#define ACPI_PROCESSOR_FILE_THROTTLING&t;&quot;throttling&quot;
DECL|macro|ACPI_PROCESSOR_FILE_LIMIT
mdefine_line|#define ACPI_PROCESSOR_FILE_LIMIT&t;&quot;limit&quot;
DECL|macro|ACPI_PROCESSOR_NOTIFY_PERFORMANCE
mdefine_line|#define ACPI_PROCESSOR_NOTIFY_PERFORMANCE 0x80
DECL|macro|ACPI_PROCESSOR_NOTIFY_POWER
mdefine_line|#define ACPI_PROCESSOR_NOTIFY_POWER&t;0x81
DECL|macro|ACPI_PROCESSOR_LIMIT_USER
mdefine_line|#define ACPI_PROCESSOR_LIMIT_USER&t;0
DECL|macro|ACPI_PROCESSOR_LIMIT_THERMAL
mdefine_line|#define ACPI_PROCESSOR_LIMIT_THERMAL&t;1
DECL|macro|ACPI_STA_PRESENT
mdefine_line|#define ACPI_STA_PRESENT 0x00000001
DECL|macro|_COMPONENT
mdefine_line|#define _COMPONENT&t;&t;ACPI_PROCESSOR_COMPONENT
id|ACPI_MODULE_NAME
(paren
l_string|&quot;acpi_processor&quot;
)paren
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Paul Diefenbaugh&quot;
)paren
suffix:semicolon
DECL|variable|ACPI_PROCESSOR_DRIVER_NAME
id|MODULE_DESCRIPTION
c_func
(paren
id|ACPI_PROCESSOR_DRIVER_NAME
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
r_static
r_int
id|acpi_processor_add
(paren
r_struct
id|acpi_device
op_star
id|device
)paren
suffix:semicolon
r_static
r_int
id|acpi_processor_start
(paren
r_struct
id|acpi_device
op_star
id|device
)paren
suffix:semicolon
r_static
r_int
id|acpi_processor_remove
(paren
r_struct
id|acpi_device
op_star
id|device
comma
r_int
id|type
)paren
suffix:semicolon
r_static
r_int
id|acpi_processor_info_open_fs
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
suffix:semicolon
r_static
r_void
id|acpi_processor_notify
(paren
id|acpi_handle
id|handle
comma
id|u32
id|event
comma
r_void
op_star
id|data
)paren
suffix:semicolon
r_static
id|acpi_status
id|acpi_processor_hotadd_init
c_func
(paren
id|acpi_handle
id|handle
comma
r_int
op_star
id|p_cpu
)paren
suffix:semicolon
r_static
r_int
id|acpi_processor_handle_eject
c_func
(paren
r_struct
id|acpi_processor
op_star
id|pr
)paren
suffix:semicolon
DECL|variable|acpi_processor_driver
r_static
r_struct
id|acpi_driver
id|acpi_processor_driver
op_assign
(brace
dot
id|name
op_assign
id|ACPI_PROCESSOR_DRIVER_NAME
comma
dot
r_class
op_assign
id|ACPI_PROCESSOR_CLASS
comma
dot
id|ids
op_assign
id|ACPI_PROCESSOR_HID
comma
dot
id|ops
op_assign
(brace
dot
id|add
op_assign
id|acpi_processor_add
comma
dot
id|remove
op_assign
id|acpi_processor_remove
comma
dot
id|start
op_assign
id|acpi_processor_start
comma
)brace
comma
)brace
suffix:semicolon
DECL|macro|INSTALL_NOTIFY_HANDLER
mdefine_line|#define INSTALL_NOTIFY_HANDLER&t;&t;1
DECL|macro|UNINSTALL_NOTIFY_HANDLER
mdefine_line|#define UNINSTALL_NOTIFY_HANDLER&t;2
DECL|variable|acpi_processor_info_fops
r_static
r_struct
id|file_operations
id|acpi_processor_info_fops
op_assign
(brace
dot
id|open
op_assign
id|acpi_processor_info_open_fs
comma
dot
id|read
op_assign
id|seq_read
comma
dot
id|llseek
op_assign
id|seq_lseek
comma
dot
id|release
op_assign
id|single_release
comma
)brace
suffix:semicolon
DECL|variable|processors
r_struct
id|acpi_processor
op_star
id|processors
(braket
id|NR_CPUS
)braket
suffix:semicolon
DECL|variable|errata
r_struct
id|acpi_processor_errata
id|errata
suffix:semicolon
multiline_comment|/* --------------------------------------------------------------------------&n;                                Errata Handling&n;   -------------------------------------------------------------------------- */
r_static
r_int
DECL|function|acpi_processor_errata_piix4
id|acpi_processor_errata_piix4
(paren
r_struct
id|pci_dev
op_star
id|dev
)paren
(brace
id|u8
id|rev
op_assign
l_int|0
suffix:semicolon
id|u8
id|value1
op_assign
l_int|0
suffix:semicolon
id|u8
id|value2
op_assign
l_int|0
suffix:semicolon
id|ACPI_FUNCTION_TRACE
c_func
(paren
l_string|&quot;acpi_processor_errata_piix4&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
id|return_VALUE
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Note that &squot;dev&squot; references the PIIX4 ACPI Controller.&n;&t; */
id|pci_read_config_byte
c_func
(paren
id|dev
comma
id|PCI_REVISION_ID
comma
op_amp
id|rev
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|rev
)paren
(brace
r_case
l_int|0
suffix:colon
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_INFO
comma
l_string|&quot;Found PIIX4 A-step&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_INFO
comma
l_string|&quot;Found PIIX4 B-step&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_INFO
comma
l_string|&quot;Found PIIX4E&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_INFO
comma
l_string|&quot;Found PIIX4M&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_INFO
comma
l_string|&quot;Found unknown PIIX4&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|rev
)paren
(brace
r_case
l_int|0
suffix:colon
multiline_comment|/* PIIX4 A-step */
r_case
l_int|1
suffix:colon
multiline_comment|/* PIIX4 B-step */
multiline_comment|/*&n;&t;&t; * See specification changes #13 (&quot;Manual Throttle Duty Cycle&quot;)&n;&t;&t; * and #14 (&quot;Enabling and Disabling Manual Throttle&quot;), plus&n;&t;&t; * erratum #5 (&quot;STPCLK# Deassertion Time&quot;) from the January&n;&t;&t; * 2002 PIIX4 specification update.  Applies to only older&n;&t;&t; * PIIX4 models.&n;&t;&t; */
id|errata.piix4.throttle
op_assign
l_int|1
suffix:semicolon
r_case
l_int|2
suffix:colon
multiline_comment|/* PIIX4E */
r_case
l_int|3
suffix:colon
multiline_comment|/* PIIX4M */
multiline_comment|/*&n;&t;&t; * See erratum #18 (&quot;C3 Power State/BMIDE and Type-F DMA&n;&t;&t; * Livelock&quot;) from the January 2002 PIIX4 specification update.&n;&t;&t; * Applies to all PIIX4 models.&n;&t;&t; */
multiline_comment|/*&n;&t;&t; * BM-IDE&n;&t;&t; * ------&n;&t;&t; * Find the PIIX4 IDE Controller and get the Bus Master IDE&n;&t;&t; * Status register address.  We&squot;ll use this later to read&n;&t;&t; * each IDE controller&squot;s DMA status to make sure we catch all&n;&t;&t; * DMA activity.&n;&t;&t; */
id|dev
op_assign
id|pci_get_subsys
c_func
(paren
id|PCI_VENDOR_ID_INTEL
comma
id|PCI_DEVICE_ID_INTEL_82371AB
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
id|errata.piix4.bmisx
op_assign
id|pci_resource_start
c_func
(paren
id|dev
comma
l_int|4
)paren
suffix:semicolon
id|pci_dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * Type-F DMA&n;&t;&t; * ----------&n;&t;&t; * Find the PIIX4 ISA Controller and read the Motherboard&n;&t;&t; * DMA controller&squot;s status to see if Type-F (Fast) DMA mode&n;&t;&t; * is enabled (bit 7) on either channel.  Note that we&squot;ll&n;&t;&t; * disable C3 support if this is enabled, as some legacy&n;&t;&t; * devices won&squot;t operate well if fast DMA is disabled.&n;&t;&t; */
id|dev
op_assign
id|pci_get_subsys
c_func
(paren
id|PCI_VENDOR_ID_INTEL
comma
id|PCI_DEVICE_ID_INTEL_82371AB_0
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
id|pci_read_config_byte
c_func
(paren
id|dev
comma
l_int|0x76
comma
op_amp
id|value1
)paren
suffix:semicolon
id|pci_read_config_byte
c_func
(paren
id|dev
comma
l_int|0x77
comma
op_amp
id|value2
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|value1
op_amp
l_int|0x80
)paren
op_logical_or
(paren
id|value2
op_amp
l_int|0x80
)paren
)paren
id|errata.piix4.fdma
op_assign
l_int|1
suffix:semicolon
id|pci_dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|errata.piix4.bmisx
)paren
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_INFO
comma
l_string|&quot;Bus master activity detection (BM-IDE) erratum enabled&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|errata.piix4.fdma
)paren
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_INFO
comma
l_string|&quot;Type-F DMA livelock erratum (C3 disabled)&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|return_VALUE
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_int
DECL|function|acpi_processor_errata
id|acpi_processor_errata
(paren
r_struct
id|acpi_processor
op_star
id|pr
)paren
(brace
r_int
id|result
op_assign
l_int|0
suffix:semicolon
r_struct
id|pci_dev
op_star
id|dev
op_assign
l_int|NULL
suffix:semicolon
id|ACPI_FUNCTION_TRACE
c_func
(paren
l_string|&quot;acpi_processor_errata&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pr
)paren
id|return_VALUE
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * PIIX4&n;&t; */
id|dev
op_assign
id|pci_get_subsys
c_func
(paren
id|PCI_VENDOR_ID_INTEL
comma
id|PCI_DEVICE_ID_INTEL_82371AB_3
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev
)paren
(brace
id|result
op_assign
id|acpi_processor_errata_piix4
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pci_dev_put
c_func
(paren
id|dev
)paren
suffix:semicolon
)brace
id|return_VALUE
c_func
(paren
id|result
)paren
suffix:semicolon
)brace
multiline_comment|/* --------------------------------------------------------------------------&n;                              FS Interface (/proc)&n;   -------------------------------------------------------------------------- */
DECL|variable|acpi_processor_dir
r_static
r_struct
id|proc_dir_entry
op_star
id|acpi_processor_dir
op_assign
l_int|NULL
suffix:semicolon
DECL|function|acpi_processor_info_seq_show
r_static
r_int
id|acpi_processor_info_seq_show
c_func
(paren
r_struct
id|seq_file
op_star
id|seq
comma
r_void
op_star
id|offset
)paren
(brace
r_struct
id|acpi_processor
op_star
id|pr
op_assign
(paren
r_struct
id|acpi_processor
op_star
)paren
id|seq
op_member_access_from_pointer
r_private
suffix:semicolon
id|ACPI_FUNCTION_TRACE
c_func
(paren
l_string|&quot;acpi_processor_info_seq_show&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pr
)paren
r_goto
id|end
suffix:semicolon
id|seq_printf
c_func
(paren
id|seq
comma
l_string|&quot;processor id:            %d&bslash;n&quot;
l_string|&quot;acpi id:                 %d&bslash;n&quot;
l_string|&quot;bus mastering control:   %s&bslash;n&quot;
l_string|&quot;power management:        %s&bslash;n&quot;
l_string|&quot;throttling control:      %s&bslash;n&quot;
l_string|&quot;limit interface:         %s&bslash;n&quot;
comma
id|pr-&gt;id
comma
id|pr-&gt;acpi_id
comma
id|pr-&gt;flags.bm_control
ques
c_cond
l_string|&quot;yes&quot;
suffix:colon
l_string|&quot;no&quot;
comma
id|pr-&gt;flags.power
ques
c_cond
l_string|&quot;yes&quot;
suffix:colon
l_string|&quot;no&quot;
comma
id|pr-&gt;flags.throttling
ques
c_cond
l_string|&quot;yes&quot;
suffix:colon
l_string|&quot;no&quot;
comma
id|pr-&gt;flags.limit
ques
c_cond
l_string|&quot;yes&quot;
suffix:colon
l_string|&quot;no&quot;
)paren
suffix:semicolon
id|end
suffix:colon
id|return_VALUE
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|acpi_processor_info_open_fs
r_static
r_int
id|acpi_processor_info_open_fs
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_return
id|single_open
c_func
(paren
id|file
comma
id|acpi_processor_info_seq_show
comma
id|PDE
c_func
(paren
id|inode
)paren
op_member_access_from_pointer
id|data
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|acpi_processor_add_fs
id|acpi_processor_add_fs
(paren
r_struct
id|acpi_device
op_star
id|device
)paren
(brace
r_struct
id|proc_dir_entry
op_star
id|entry
op_assign
l_int|NULL
suffix:semicolon
id|ACPI_FUNCTION_TRACE
c_func
(paren
l_string|&quot;acpi_processor_add_fs&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_device_dir
c_func
(paren
id|device
)paren
)paren
(brace
id|acpi_device_dir
c_func
(paren
id|device
)paren
op_assign
id|proc_mkdir
c_func
(paren
id|acpi_device_bid
c_func
(paren
id|device
)paren
comma
id|acpi_processor_dir
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_device_dir
c_func
(paren
id|device
)paren
)paren
id|return_VALUE
c_func
(paren
op_minus
id|ENODEV
)paren
suffix:semicolon
)brace
id|acpi_device_dir
c_func
(paren
id|device
)paren
op_member_access_from_pointer
id|owner
op_assign
id|THIS_MODULE
suffix:semicolon
multiline_comment|/* &squot;info&squot; [R] */
id|entry
op_assign
id|create_proc_entry
c_func
(paren
id|ACPI_PROCESSOR_FILE_INFO
comma
id|S_IRUGO
comma
id|acpi_device_dir
c_func
(paren
id|device
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|entry
)paren
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Unable to create &squot;%s&squot; fs entry&bslash;n&quot;
comma
id|ACPI_PROCESSOR_FILE_INFO
)paren
)paren
suffix:semicolon
r_else
(brace
id|entry-&gt;proc_fops
op_assign
op_amp
id|acpi_processor_info_fops
suffix:semicolon
id|entry-&gt;data
op_assign
id|acpi_driver_data
c_func
(paren
id|device
)paren
suffix:semicolon
id|entry-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
)brace
multiline_comment|/* &squot;throttling&squot; [R/W] */
id|entry
op_assign
id|create_proc_entry
c_func
(paren
id|ACPI_PROCESSOR_FILE_THROTTLING
comma
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|acpi_device_dir
c_func
(paren
id|device
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|entry
)paren
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Unable to create &squot;%s&squot; fs entry&bslash;n&quot;
comma
id|ACPI_PROCESSOR_FILE_THROTTLING
)paren
)paren
suffix:semicolon
r_else
(brace
id|entry-&gt;proc_fops
op_assign
op_amp
id|acpi_processor_throttling_fops
suffix:semicolon
id|entry-&gt;proc_fops-&gt;write
op_assign
id|acpi_processor_write_throttling
suffix:semicolon
id|entry-&gt;data
op_assign
id|acpi_driver_data
c_func
(paren
id|device
)paren
suffix:semicolon
id|entry-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
)brace
multiline_comment|/* &squot;limit&squot; [R/W] */
id|entry
op_assign
id|create_proc_entry
c_func
(paren
id|ACPI_PROCESSOR_FILE_LIMIT
comma
id|S_IFREG
op_or
id|S_IRUGO
op_or
id|S_IWUSR
comma
id|acpi_device_dir
c_func
(paren
id|device
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|entry
)paren
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Unable to create &squot;%s&squot; fs entry&bslash;n&quot;
comma
id|ACPI_PROCESSOR_FILE_LIMIT
)paren
)paren
suffix:semicolon
r_else
(brace
id|entry-&gt;proc_fops
op_assign
op_amp
id|acpi_processor_limit_fops
suffix:semicolon
id|entry-&gt;proc_fops-&gt;write
op_assign
id|acpi_processor_write_limit
suffix:semicolon
id|entry-&gt;data
op_assign
id|acpi_driver_data
c_func
(paren
id|device
)paren
suffix:semicolon
id|entry-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
)brace
id|return_VALUE
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|acpi_processor_remove_fs
id|acpi_processor_remove_fs
(paren
r_struct
id|acpi_device
op_star
id|device
)paren
(brace
id|ACPI_FUNCTION_TRACE
c_func
(paren
l_string|&quot;acpi_processor_remove_fs&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|acpi_device_dir
c_func
(paren
id|device
)paren
)paren
(brace
id|remove_proc_entry
c_func
(paren
id|ACPI_PROCESSOR_FILE_INFO
comma
id|acpi_device_dir
c_func
(paren
id|device
)paren
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|ACPI_PROCESSOR_FILE_THROTTLING
comma
id|acpi_device_dir
c_func
(paren
id|device
)paren
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|ACPI_PROCESSOR_FILE_LIMIT
comma
id|acpi_device_dir
c_func
(paren
id|device
)paren
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|acpi_device_bid
c_func
(paren
id|device
)paren
comma
id|acpi_processor_dir
)paren
suffix:semicolon
id|acpi_device_dir
c_func
(paren
id|device
)paren
op_assign
l_int|NULL
suffix:semicolon
)brace
id|return_VALUE
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Use the acpiid in MADT to map cpus in case of SMP */
macro_line|#ifndef CONFIG_SMP
DECL|macro|convert_acpiid_to_cpu
mdefine_line|#define convert_acpiid_to_cpu(acpi_id) (0xff)
macro_line|#else
macro_line|#ifdef CONFIG_IA64
DECL|macro|arch_acpiid_to_apicid
mdefine_line|#define arch_acpiid_to_apicid &t;ia64_acpiid_to_sapicid
DECL|macro|arch_cpu_to_apicid
mdefine_line|#define arch_cpu_to_apicid &t;ia64_cpu_to_sapicid
DECL|macro|ARCH_BAD_APICID
mdefine_line|#define ARCH_BAD_APICID&t;&t;(0xffff)
macro_line|#else
DECL|macro|arch_acpiid_to_apicid
mdefine_line|#define arch_acpiid_to_apicid &t;x86_acpiid_to_apicid
DECL|macro|arch_cpu_to_apicid
mdefine_line|#define arch_cpu_to_apicid &t;x86_cpu_to_apicid
DECL|macro|ARCH_BAD_APICID
mdefine_line|#define ARCH_BAD_APICID&t;&t;(0xff)
macro_line|#endif
DECL|function|convert_acpiid_to_cpu
r_static
id|u8
id|convert_acpiid_to_cpu
c_func
(paren
id|u8
id|acpi_id
)paren
(brace
id|u16
id|apic_id
suffix:semicolon
r_int
id|i
suffix:semicolon
id|apic_id
op_assign
id|arch_acpiid_to_apicid
(braket
id|acpi_id
)braket
suffix:semicolon
r_if
c_cond
(paren
id|apic_id
op_eq
id|ARCH_BAD_APICID
)paren
r_return
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|NR_CPUS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|arch_cpu_to_apicid
(braket
id|i
)braket
op_eq
id|apic_id
)paren
r_return
id|i
suffix:semicolon
)brace
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#endif
multiline_comment|/* --------------------------------------------------------------------------&n;                                 Driver Interface&n;   -------------------------------------------------------------------------- */
r_static
r_int
DECL|function|acpi_processor_get_info
id|acpi_processor_get_info
(paren
r_struct
id|acpi_processor
op_star
id|pr
)paren
(brace
id|acpi_status
id|status
op_assign
l_int|0
suffix:semicolon
r_union
id|acpi_object
id|object
op_assign
(brace
l_int|0
)brace
suffix:semicolon
r_struct
id|acpi_buffer
id|buffer
op_assign
(brace
r_sizeof
(paren
r_union
id|acpi_object
)paren
comma
op_amp
id|object
)brace
suffix:semicolon
id|u8
id|cpu_index
suffix:semicolon
r_static
r_int
id|cpu0_initialized
suffix:semicolon
id|ACPI_FUNCTION_TRACE
c_func
(paren
l_string|&quot;acpi_processor_get_info&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pr
)paren
id|return_VALUE
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|num_online_cpus
c_func
(paren
)paren
OG
l_int|1
)paren
id|errata.smp
op_assign
id|TRUE
suffix:semicolon
id|acpi_processor_errata
c_func
(paren
id|pr
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Check to see if we have bus mastering arbitration control.  This&n;&t; * is required for proper C3 usage (to maintain cache coherency).&n;&t; */
r_if
c_cond
(paren
id|acpi_fadt.V1_pm2_cnt_blk
op_logical_and
id|acpi_fadt.pm2_cnt_len
)paren
(brace
id|pr-&gt;flags.bm_control
op_assign
l_int|1
suffix:semicolon
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_INFO
comma
l_string|&quot;Bus mastering arbitration control present&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_INFO
comma
l_string|&quot;No bus mastering arbitration control&bslash;n&quot;
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Evalute the processor object.  Note that it is common on SMP to&n;&t; * have the first (boot) processor with a valid PBLK address while&n;&t; * all others have a NULL address.&n;&t; */
id|status
op_assign
id|acpi_evaluate_object
c_func
(paren
id|pr-&gt;handle
comma
l_int|NULL
comma
l_int|NULL
comma
op_amp
id|buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
c_func
(paren
id|status
)paren
)paren
(brace
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Error evaluating processor object&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|return_VALUE
c_func
(paren
op_minus
id|ENODEV
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * TBD: Synch processor ID (via LAPIC/LSAPIC structures) on SMP.&n;&t; *&t;&gt;&gt;&gt; &squot;acpi_get_processor_id(acpi_id, &amp;id)&squot; in arch/xxx/acpi.c&n;&t; */
id|pr-&gt;acpi_id
op_assign
id|object.processor.proc_id
suffix:semicolon
id|cpu_index
op_assign
id|convert_acpiid_to_cpu
c_func
(paren
id|pr-&gt;acpi_id
)paren
suffix:semicolon
multiline_comment|/* Handle UP system running SMP kernel, with no LAPIC in MADT */
r_if
c_cond
(paren
op_logical_neg
id|cpu0_initialized
op_logical_and
(paren
id|cpu_index
op_eq
l_int|0xff
)paren
op_logical_and
(paren
id|num_online_cpus
c_func
(paren
)paren
op_eq
l_int|1
)paren
)paren
(brace
id|cpu_index
op_assign
l_int|0
suffix:semicolon
)brace
id|cpu0_initialized
op_assign
l_int|1
suffix:semicolon
id|pr-&gt;id
op_assign
id|cpu_index
suffix:semicolon
multiline_comment|/*&n;  &t; *  Extra Processor objects may be enumerated on MP systems with&n;  &t; *  less than the max # of CPUs. They should be ignored _iff&n;  &t; *  they are physically not present.&n;  &t; */
r_if
c_cond
(paren
id|cpu_index
op_ge
id|NR_CPUS
)paren
(brace
r_if
c_cond
(paren
id|ACPI_FAILURE
c_func
(paren
id|acpi_processor_hotadd_init
c_func
(paren
id|pr-&gt;handle
comma
op_amp
id|pr-&gt;id
)paren
)paren
)paren
(brace
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Error getting cpuindex for acpiid 0x%x&bslash;n&quot;
comma
id|pr-&gt;acpi_id
)paren
)paren
suffix:semicolon
id|return_VALUE
c_func
(paren
op_minus
id|ENODEV
)paren
suffix:semicolon
)brace
)brace
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_INFO
comma
l_string|&quot;Processor [%d:%d]&bslash;n&quot;
comma
id|pr-&gt;id
comma
id|pr-&gt;acpi_id
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|object.processor.pblk_address
)paren
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_INFO
comma
l_string|&quot;No PBLK (NULL address)&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|object.processor.pblk_length
op_ne
l_int|6
)paren
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Invalid PBLK length [%d]&bslash;n&quot;
comma
id|object.processor.pblk_length
)paren
)paren
suffix:semicolon
r_else
(brace
id|pr-&gt;throttling.address
op_assign
id|object.processor.pblk_address
suffix:semicolon
id|pr-&gt;throttling.duty_offset
op_assign
id|acpi_fadt.duty_offset
suffix:semicolon
id|pr-&gt;throttling.duty_width
op_assign
id|acpi_fadt.duty_width
suffix:semicolon
id|pr-&gt;pblk
op_assign
id|object.processor.pblk_address
suffix:semicolon
multiline_comment|/*&n;&t;&t; * We don&squot;t care about error returns - we just try to mark&n;&t;&t; * these reserved so that nobody else is confused into thinking&n;&t;&t; * that this region might be unused..&n;&t;&t; *&n;&t;&t; * (In particular, allocating the IO range for Cardbus)&n;&t;&t; */
id|request_region
c_func
(paren
id|pr-&gt;throttling.address
comma
l_int|6
comma
l_string|&quot;ACPI CPU throttle&quot;
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_CPU_FREQ
id|acpi_processor_ppc_has_changed
c_func
(paren
id|pr
)paren
suffix:semicolon
macro_line|#endif
id|acpi_processor_get_throttling_info
c_func
(paren
id|pr
)paren
suffix:semicolon
id|acpi_processor_get_limit_info
c_func
(paren
id|pr
)paren
suffix:semicolon
id|return_VALUE
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|acpi_processor_start
id|acpi_processor_start
c_func
(paren
r_struct
id|acpi_device
op_star
id|device
)paren
(brace
r_int
id|result
op_assign
l_int|0
suffix:semicolon
id|acpi_status
id|status
op_assign
id|AE_OK
suffix:semicolon
r_struct
id|acpi_processor
op_star
id|pr
suffix:semicolon
id|ACPI_FUNCTION_TRACE
c_func
(paren
l_string|&quot;acpi_processor_start&quot;
)paren
suffix:semicolon
id|pr
op_assign
id|acpi_driver_data
c_func
(paren
id|device
)paren
suffix:semicolon
id|result
op_assign
id|acpi_processor_get_info
c_func
(paren
id|pr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
(brace
multiline_comment|/* Processor is physically not present */
id|return_VALUE
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|BUG_ON
c_func
(paren
(paren
id|pr-&gt;id
op_ge
id|NR_CPUS
)paren
op_logical_or
(paren
id|pr-&gt;id
OL
l_int|0
)paren
)paren
suffix:semicolon
id|processors
(braket
id|pr-&gt;id
)braket
op_assign
id|pr
suffix:semicolon
id|result
op_assign
id|acpi_processor_add_fs
c_func
(paren
id|device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
r_goto
id|end
suffix:semicolon
id|status
op_assign
id|acpi_install_notify_handler
c_func
(paren
id|pr-&gt;handle
comma
id|ACPI_DEVICE_NOTIFY
comma
id|acpi_processor_notify
comma
id|pr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
c_func
(paren
id|status
)paren
)paren
(brace
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Error installing device notify handler&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
id|acpi_processor_power_init
c_func
(paren
id|pr
comma
id|device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pr-&gt;flags.throttling
)paren
(brace
id|printk
c_func
(paren
id|KERN_INFO
id|PREFIX
l_string|&quot;%s [%s] (supports&quot;
comma
id|acpi_device_name
c_func
(paren
id|device
)paren
comma
id|acpi_device_bid
c_func
(paren
id|device
)paren
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; %d throttling states&quot;
comma
id|pr-&gt;throttling.state_count
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;)&bslash;n&quot;
)paren
suffix:semicolon
)brace
id|end
suffix:colon
id|return_VALUE
c_func
(paren
id|result
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|acpi_processor_notify
id|acpi_processor_notify
(paren
id|acpi_handle
id|handle
comma
id|u32
id|event
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|acpi_processor
op_star
id|pr
op_assign
(paren
r_struct
id|acpi_processor
op_star
)paren
id|data
suffix:semicolon
r_struct
id|acpi_device
op_star
id|device
op_assign
l_int|NULL
suffix:semicolon
id|ACPI_FUNCTION_TRACE
c_func
(paren
l_string|&quot;acpi_processor_notify&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pr
)paren
id|return_VOID
suffix:semicolon
r_if
c_cond
(paren
id|acpi_bus_get_device
c_func
(paren
id|pr-&gt;handle
comma
op_amp
id|device
)paren
)paren
id|return_VOID
suffix:semicolon
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|ACPI_PROCESSOR_NOTIFY_PERFORMANCE
suffix:colon
id|acpi_processor_ppc_has_changed
c_func
(paren
id|pr
)paren
suffix:semicolon
id|acpi_bus_generate_event
c_func
(paren
id|device
comma
id|event
comma
id|pr-&gt;performance_platform_limit
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ACPI_PROCESSOR_NOTIFY_POWER
suffix:colon
id|acpi_processor_cst_has_changed
c_func
(paren
id|pr
)paren
suffix:semicolon
id|acpi_bus_generate_event
c_func
(paren
id|device
comma
id|event
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_INFO
comma
l_string|&quot;Unsupported event [0x%x]&bslash;n&quot;
comma
id|event
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|return_VOID
suffix:semicolon
)brace
r_static
r_int
DECL|function|acpi_processor_add
id|acpi_processor_add
(paren
r_struct
id|acpi_device
op_star
id|device
)paren
(brace
r_struct
id|acpi_processor
op_star
id|pr
op_assign
l_int|NULL
suffix:semicolon
id|ACPI_FUNCTION_TRACE
c_func
(paren
l_string|&quot;acpi_processor_add&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|device
)paren
id|return_VALUE
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
id|pr
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|acpi_processor
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pr
)paren
id|return_VALUE
c_func
(paren
op_minus
id|ENOMEM
)paren
suffix:semicolon
id|memset
c_func
(paren
id|pr
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|acpi_processor
)paren
)paren
suffix:semicolon
id|pr-&gt;handle
op_assign
id|device-&gt;handle
suffix:semicolon
id|strcpy
c_func
(paren
id|acpi_device_name
c_func
(paren
id|device
)paren
comma
id|ACPI_PROCESSOR_DEVICE_NAME
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|acpi_device_class
c_func
(paren
id|device
)paren
comma
id|ACPI_PROCESSOR_CLASS
)paren
suffix:semicolon
id|acpi_driver_data
c_func
(paren
id|device
)paren
op_assign
id|pr
suffix:semicolon
id|return_VALUE
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|acpi_processor_remove
id|acpi_processor_remove
(paren
r_struct
id|acpi_device
op_star
id|device
comma
r_int
id|type
)paren
(brace
id|acpi_status
id|status
op_assign
id|AE_OK
suffix:semicolon
r_struct
id|acpi_processor
op_star
id|pr
op_assign
l_int|NULL
suffix:semicolon
id|ACPI_FUNCTION_TRACE
c_func
(paren
l_string|&quot;acpi_processor_remove&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|device
op_logical_or
op_logical_neg
id|acpi_driver_data
c_func
(paren
id|device
)paren
)paren
id|return_VALUE
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
id|pr
op_assign
(paren
r_struct
id|acpi_processor
op_star
)paren
id|acpi_driver_data
c_func
(paren
id|device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pr-&gt;id
op_ge
id|NR_CPUS
)paren
(brace
id|kfree
c_func
(paren
id|pr
)paren
suffix:semicolon
id|return_VALUE
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|type
op_eq
id|ACPI_BUS_REMOVAL_EJECT
)paren
(brace
r_if
c_cond
(paren
id|acpi_processor_handle_eject
c_func
(paren
id|pr
)paren
)paren
id|return_VALUE
c_func
(paren
op_minus
id|EINVAL
)paren
suffix:semicolon
)brace
id|acpi_processor_power_exit
c_func
(paren
id|pr
comma
id|device
)paren
suffix:semicolon
id|status
op_assign
id|acpi_remove_notify_handler
c_func
(paren
id|pr-&gt;handle
comma
id|ACPI_DEVICE_NOTIFY
comma
id|acpi_processor_notify
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
c_func
(paren
id|status
)paren
)paren
(brace
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Error removing notify handler&bslash;n&quot;
)paren
)paren
suffix:semicolon
)brace
id|acpi_processor_remove_fs
c_func
(paren
id|device
)paren
suffix:semicolon
id|processors
(braket
id|pr-&gt;id
)braket
op_assign
l_int|NULL
suffix:semicolon
id|kfree
c_func
(paren
id|pr
)paren
suffix:semicolon
id|return_VALUE
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ACPI_HOTPLUG_CPU
multiline_comment|/****************************************************************************&n; * &t;Acpi processor hotplug support &t;&t;&t;&t;       &t;    *&n; ****************************************************************************/
r_static
r_int
id|is_processor_present
c_func
(paren
id|acpi_handle
id|handle
)paren
suffix:semicolon
r_static
r_int
DECL|function|is_processor_present
id|is_processor_present
c_func
(paren
id|acpi_handle
id|handle
)paren
(brace
id|acpi_status
id|status
suffix:semicolon
r_int
r_int
id|sta
op_assign
l_int|0
suffix:semicolon
id|ACPI_FUNCTION_TRACE
c_func
(paren
l_string|&quot;is_processor_present&quot;
)paren
suffix:semicolon
id|status
op_assign
id|acpi_evaluate_integer
c_func
(paren
id|handle
comma
l_string|&quot;_STA&quot;
comma
l_int|NULL
comma
op_amp
id|sta
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
c_func
(paren
id|status
)paren
op_logical_or
op_logical_neg
(paren
id|sta
op_amp
id|ACPI_STA_PRESENT
)paren
)paren
(brace
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Processor Device is not present&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|return_VALUE
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|return_VALUE
c_func
(paren
l_int|1
)paren
suffix:semicolon
)brace
r_static
DECL|function|acpi_processor_device_add
r_int
id|acpi_processor_device_add
c_func
(paren
id|acpi_handle
id|handle
comma
r_struct
id|acpi_device
op_star
op_star
id|device
)paren
(brace
id|acpi_handle
id|phandle
suffix:semicolon
r_struct
id|acpi_device
op_star
id|pdev
suffix:semicolon
r_struct
id|acpi_processor
op_star
id|pr
suffix:semicolon
id|ACPI_FUNCTION_TRACE
c_func
(paren
l_string|&quot;acpi_processor_device_add&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|acpi_get_parent
c_func
(paren
id|handle
comma
op_amp
id|phandle
)paren
)paren
(brace
id|return_VALUE
c_func
(paren
op_minus
id|ENODEV
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|acpi_bus_get_device
c_func
(paren
id|phandle
comma
op_amp
id|pdev
)paren
)paren
(brace
id|return_VALUE
c_func
(paren
op_minus
id|ENODEV
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|acpi_bus_add
c_func
(paren
id|device
comma
id|pdev
comma
id|handle
comma
id|ACPI_BUS_TYPE_PROCESSOR
)paren
)paren
(brace
id|return_VALUE
c_func
(paren
op_minus
id|ENODEV
)paren
suffix:semicolon
)brace
id|acpi_bus_scan
c_func
(paren
op_star
id|device
)paren
suffix:semicolon
id|pr
op_assign
id|acpi_driver_data
c_func
(paren
op_star
id|device
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pr
)paren
id|return_VALUE
c_func
(paren
op_minus
id|ENODEV
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pr-&gt;id
op_ge
l_int|0
)paren
op_logical_and
(paren
id|pr-&gt;id
OL
id|NR_CPUS
)paren
)paren
(brace
id|kobject_hotplug
c_func
(paren
op_amp
(paren
op_star
id|device
)paren
op_member_access_from_pointer
id|kobj
comma
id|KOBJ_ONLINE
)paren
suffix:semicolon
)brace
id|return_VALUE
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|acpi_processor_hotplug_notify
id|acpi_processor_hotplug_notify
(paren
id|acpi_handle
id|handle
comma
id|u32
id|event
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|acpi_processor
op_star
id|pr
suffix:semicolon
r_struct
id|acpi_device
op_star
id|device
op_assign
l_int|NULL
suffix:semicolon
r_int
id|result
suffix:semicolon
id|ACPI_FUNCTION_TRACE
c_func
(paren
l_string|&quot;acpi_processor_hotplug_notify&quot;
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|event
)paren
(brace
r_case
id|ACPI_NOTIFY_BUS_CHECK
suffix:colon
r_case
id|ACPI_NOTIFY_DEVICE_CHECK
suffix:colon
id|printk
c_func
(paren
l_string|&quot;Processor driver received %s event&bslash;n&quot;
comma
(paren
id|event
op_eq
id|ACPI_NOTIFY_BUS_CHECK
)paren
ques
c_cond
l_string|&quot;ACPI_NOTIFY_BUS_CHECK&quot;
suffix:colon
l_string|&quot;ACPI_NOTIFY_DEVICE_CHECK&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_processor_present
c_func
(paren
id|handle
)paren
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|acpi_bus_get_device
c_func
(paren
id|handle
comma
op_amp
id|device
)paren
)paren
(brace
id|result
op_assign
id|acpi_processor_device_add
c_func
(paren
id|handle
comma
op_amp
id|device
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
)paren
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Unable to add the device&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pr
op_assign
id|acpi_driver_data
c_func
(paren
id|device
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pr
)paren
(brace
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Driver data is NULL&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pr-&gt;id
op_ge
l_int|0
op_logical_and
(paren
id|pr-&gt;id
OL
id|NR_CPUS
)paren
)paren
(brace
id|kobject_hotplug
c_func
(paren
op_amp
id|device-&gt;kobj
comma
id|KOBJ_OFFLINE
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|result
op_assign
id|acpi_processor_start
c_func
(paren
id|device
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
op_logical_neg
id|result
)paren
op_logical_and
(paren
(paren
id|pr-&gt;id
op_ge
l_int|0
)paren
op_logical_and
(paren
id|pr-&gt;id
OL
id|NR_CPUS
)paren
)paren
)paren
(brace
id|kobject_hotplug
c_func
(paren
op_amp
id|device-&gt;kobj
comma
id|KOBJ_ONLINE
)paren
suffix:semicolon
)brace
r_else
(brace
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Device [%s] failed to start&bslash;n&quot;
comma
id|acpi_device_bid
c_func
(paren
id|device
)paren
)paren
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ACPI_NOTIFY_EJECT_REQUEST
suffix:colon
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_INFO
comma
l_string|&quot;received ACPI_NOTIFY_EJECT_REQUEST&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|acpi_bus_get_device
c_func
(paren
id|handle
comma
op_amp
id|device
)paren
)paren
(brace
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Device don&squot;t exist, dropping EJECT&bslash;n&quot;
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|pr
op_assign
id|acpi_driver_data
c_func
(paren
id|device
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pr
)paren
(brace
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_ERROR
comma
l_string|&quot;Driver data is NULL, dropping EJECT&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|return_VOID
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|pr-&gt;id
OL
id|NR_CPUS
)paren
op_logical_and
(paren
id|cpu_present
c_func
(paren
id|pr-&gt;id
)paren
)paren
)paren
id|kobject_hotplug
c_func
(paren
op_amp
id|device-&gt;kobj
comma
id|KOBJ_OFFLINE
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|ACPI_DEBUG_PRINT
c_func
(paren
(paren
id|ACPI_DB_INFO
comma
l_string|&quot;Unsupported event [0x%x]&bslash;n&quot;
comma
id|event
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|return_VOID
suffix:semicolon
)brace
r_static
id|acpi_status
DECL|function|processor_walk_namespace_cb
id|processor_walk_namespace_cb
c_func
(paren
id|acpi_handle
id|handle
comma
id|u32
id|lvl
comma
r_void
op_star
id|context
comma
r_void
op_star
op_star
id|rv
)paren
(brace
id|acpi_status
id|status
suffix:semicolon
r_int
op_star
id|action
op_assign
id|context
suffix:semicolon
id|acpi_object_type
id|type
op_assign
l_int|0
suffix:semicolon
id|status
op_assign
id|acpi_get_type
c_func
(paren
id|handle
comma
op_amp
id|type
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ACPI_FAILURE
c_func
(paren
id|status
)paren
)paren
r_return
id|AE_OK
suffix:semicolon
r_if
c_cond
(paren
id|type
op_ne
id|ACPI_TYPE_PROCESSOR
)paren
r_return
id|AE_OK
suffix:semicolon
r_switch
c_cond
(paren
op_star
id|action
)paren
(brace
r_case
id|INSTALL_NOTIFY_HANDLER
suffix:colon
id|acpi_install_notify_handler
c_func
(paren
id|handle
comma
id|ACPI_SYSTEM_NOTIFY
comma
id|acpi_processor_hotplug_notify
comma
l_int|NULL
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|UNINSTALL_NOTIFY_HANDLER
suffix:colon
id|acpi_remove_notify_handler
c_func
(paren
id|handle
comma
id|ACPI_SYSTEM_NOTIFY
comma
id|acpi_processor_hotplug_notify
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_return
id|AE_OK
suffix:semicolon
)brace
r_static
id|acpi_status
DECL|function|acpi_processor_hotadd_init
id|acpi_processor_hotadd_init
c_func
(paren
id|acpi_handle
id|handle
comma
r_int
op_star
id|p_cpu
)paren
(brace
id|ACPI_FUNCTION_TRACE
c_func
(paren
l_string|&quot;acpi_processor_hotadd_init&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_processor_present
c_func
(paren
id|handle
)paren
)paren
(brace
id|return_VALUE
c_func
(paren
id|AE_ERROR
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|acpi_map_lsapic
c_func
(paren
id|handle
comma
id|p_cpu
)paren
)paren
id|return_VALUE
c_func
(paren
id|AE_ERROR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|arch_register_cpu
c_func
(paren
op_star
id|p_cpu
)paren
)paren
(brace
id|acpi_unmap_lsapic
c_func
(paren
op_star
id|p_cpu
)paren
suffix:semicolon
id|return_VALUE
c_func
(paren
id|AE_ERROR
)paren
suffix:semicolon
)brace
id|return_VALUE
c_func
(paren
id|AE_OK
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|acpi_processor_handle_eject
id|acpi_processor_handle_eject
c_func
(paren
r_struct
id|acpi_processor
op_star
id|pr
)paren
(brace
r_if
c_cond
(paren
id|cpu_online
c_func
(paren
id|pr-&gt;id
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|arch_unregister_cpu
c_func
(paren
id|pr-&gt;id
)paren
suffix:semicolon
id|acpi_unmap_lsapic
c_func
(paren
id|pr-&gt;id
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#else
r_static
id|acpi_status
DECL|function|acpi_processor_hotadd_init
id|acpi_processor_hotadd_init
c_func
(paren
id|acpi_handle
id|handle
comma
r_int
op_star
id|p_cpu
)paren
(brace
r_return
id|AE_ERROR
suffix:semicolon
)brace
r_static
r_int
DECL|function|acpi_processor_handle_eject
id|acpi_processor_handle_eject
c_func
(paren
r_struct
id|acpi_processor
op_star
id|pr
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
macro_line|#endif
r_static
DECL|function|acpi_processor_install_hotplug_notify
r_void
id|acpi_processor_install_hotplug_notify
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_ACPI_HOTPLUG_CPU
r_int
id|action
op_assign
id|INSTALL_NOTIFY_HANDLER
suffix:semicolon
id|acpi_walk_namespace
c_func
(paren
id|ACPI_TYPE_PROCESSOR
comma
id|ACPI_ROOT_OBJECT
comma
id|ACPI_UINT32_MAX
comma
id|processor_walk_namespace_cb
comma
op_amp
id|action
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
)brace
r_static
DECL|function|acpi_processor_uninstall_hotplug_notify
r_void
id|acpi_processor_uninstall_hotplug_notify
c_func
(paren
r_void
)paren
(brace
macro_line|#ifdef CONFIG_ACPI_HOTPLUG_CPU
r_int
id|action
op_assign
id|UNINSTALL_NOTIFY_HANDLER
suffix:semicolon
id|acpi_walk_namespace
c_func
(paren
id|ACPI_TYPE_PROCESSOR
comma
id|ACPI_ROOT_OBJECT
comma
id|ACPI_UINT32_MAX
comma
id|processor_walk_namespace_cb
comma
op_amp
id|action
comma
l_int|NULL
)paren
suffix:semicolon
macro_line|#endif
)brace
multiline_comment|/*&n; * We keep the driver loaded even when ACPI is not running.&n; * This is needed for the powernow-k8 driver, that works even without&n; * ACPI, but needs symbols from this driver&n; */
r_static
r_int
id|__init
DECL|function|acpi_processor_init
id|acpi_processor_init
(paren
r_void
)paren
(brace
r_int
id|result
op_assign
l_int|0
suffix:semicolon
id|ACPI_FUNCTION_TRACE
c_func
(paren
l_string|&quot;acpi_processor_init&quot;
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|processors
comma
l_int|0
comma
r_sizeof
(paren
id|processors
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|errata
comma
l_int|0
comma
r_sizeof
(paren
id|errata
)paren
)paren
suffix:semicolon
id|acpi_processor_dir
op_assign
id|proc_mkdir
c_func
(paren
id|ACPI_PROCESSOR_CLASS
comma
id|acpi_root_dir
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|acpi_processor_dir
)paren
id|return_VALUE
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|acpi_processor_dir-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
id|result
op_assign
id|acpi_bus_register_driver
c_func
(paren
op_amp
id|acpi_processor_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
OL
l_int|0
)paren
(brace
id|remove_proc_entry
c_func
(paren
id|ACPI_PROCESSOR_CLASS
comma
id|acpi_root_dir
)paren
suffix:semicolon
id|return_VALUE
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
id|acpi_processor_install_hotplug_notify
c_func
(paren
)paren
suffix:semicolon
id|acpi_thermal_cpufreq_init
c_func
(paren
)paren
suffix:semicolon
id|acpi_processor_ppc_init
c_func
(paren
)paren
suffix:semicolon
id|return_VALUE
c_func
(paren
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_void
id|__exit
DECL|function|acpi_processor_exit
id|acpi_processor_exit
(paren
r_void
)paren
(brace
id|ACPI_FUNCTION_TRACE
c_func
(paren
l_string|&quot;acpi_processor_exit&quot;
)paren
suffix:semicolon
id|acpi_processor_ppc_exit
c_func
(paren
)paren
suffix:semicolon
id|acpi_thermal_cpufreq_exit
c_func
(paren
)paren
suffix:semicolon
id|acpi_processor_uninstall_hotplug_notify
c_func
(paren
)paren
suffix:semicolon
id|acpi_bus_unregister_driver
c_func
(paren
op_amp
id|acpi_processor_driver
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
id|ACPI_PROCESSOR_CLASS
comma
id|acpi_root_dir
)paren
suffix:semicolon
id|return_VOID
suffix:semicolon
)brace
DECL|variable|acpi_processor_init
id|module_init
c_func
(paren
id|acpi_processor_init
)paren
suffix:semicolon
DECL|variable|acpi_processor_exit
id|module_exit
c_func
(paren
id|acpi_processor_exit
)paren
suffix:semicolon
DECL|variable|acpi_processor_set_thermal_limit
id|EXPORT_SYMBOL
c_func
(paren
id|acpi_processor_set_thermal_limit
)paren
suffix:semicolon
id|MODULE_ALIAS
c_func
(paren
l_string|&quot;processor&quot;
)paren
suffix:semicolon
eof
