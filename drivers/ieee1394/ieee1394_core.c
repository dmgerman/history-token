multiline_comment|/*&n; * IEEE 1394 for Linux&n; *&n; * Core support: hpsb_packet management, packet handling and forwarding to&n; *               highlevel or lowlevel code&n; *&n; * Copyright (C) 1999, 2000 Andreas E. Bombe&n; *&n; * This code is licensed under the GPL.  See the file COPYING in the root&n; * directory of the kernel sources for details.&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/proc_fs.h&gt;
macro_line|#include &lt;linux/tqueue.h&gt;
macro_line|#include &lt;asm/bitops.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;asm/semaphore.h&gt;
macro_line|#include &quot;ieee1394_types.h&quot;
macro_line|#include &quot;ieee1394.h&quot;
macro_line|#include &quot;hosts.h&quot;
macro_line|#include &quot;ieee1394_core.h&quot;
macro_line|#include &quot;highlevel.h&quot;
macro_line|#include &quot;ieee1394_transactions.h&quot;
macro_line|#include &quot;csr.h&quot;
macro_line|#include &quot;nodemgr.h&quot;
macro_line|#include &quot;ieee1394_hotplug.h&quot;
multiline_comment|/*&n; * Disable the nodemgr detection and config rom reading functionality.&n; */
id|MODULE_PARM
c_func
(paren
id|disable_nodemgr
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|disable_nodemgr
comma
l_string|&quot;Disable nodemgr functionality.&quot;
)paren
suffix:semicolon
DECL|variable|disable_nodemgr
r_static
r_int
id|disable_nodemgr
op_assign
l_int|0
suffix:semicolon
id|MODULE_PARM
c_func
(paren
id|disable_hotplug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|disable_hotplug
comma
l_string|&quot;Disable hotplug for detected nodes.&quot;
)paren
suffix:semicolon
DECL|variable|disable_hotplug
r_static
r_int
id|disable_hotplug
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* We are GPL, so treat us special */
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
DECL|variable|hpsb_packet_cache
r_static
id|kmem_cache_t
op_star
id|hpsb_packet_cache
suffix:semicolon
multiline_comment|/* Some globals used */
DECL|variable|hpsb_speedto_str
r_const
r_char
op_star
id|hpsb_speedto_str
(braket
)braket
op_assign
(brace
l_string|&quot;S100&quot;
comma
l_string|&quot;S200&quot;
comma
l_string|&quot;S400&quot;
)brace
suffix:semicolon
DECL|function|dump_packet
r_static
r_void
id|dump_packet
c_func
(paren
r_const
r_char
op_star
id|text
comma
id|quadlet_t
op_star
id|data
comma
r_int
id|size
)paren
(brace
r_int
id|i
suffix:semicolon
id|size
op_div_assign
l_int|4
suffix:semicolon
id|size
op_assign
(paren
id|size
OG
l_int|4
ques
c_cond
l_int|4
suffix:colon
id|size
)paren
suffix:semicolon
id|printk
c_func
(paren
id|KERN_DEBUG
l_string|&quot;ieee1394: %s&quot;
comma
id|text
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; %8.8x&quot;
comma
id|data
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|process_complete_tasks
r_static
r_void
id|process_complete_tasks
c_func
(paren
r_struct
id|hpsb_packet
op_star
id|packet
)paren
(brace
r_struct
id|list_head
op_star
id|lh
comma
op_star
id|next
suffix:semicolon
id|list_for_each_safe
c_func
(paren
id|lh
comma
id|next
comma
op_amp
id|packet-&gt;complete_tq
)paren
(brace
r_struct
id|tq_struct
op_star
id|tq
op_assign
id|list_entry
c_func
(paren
id|lh
comma
r_struct
id|tq_struct
comma
id|list
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|tq-&gt;list
)paren
suffix:semicolon
id|schedule_task
c_func
(paren
id|tq
)paren
suffix:semicolon
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/**&n; * hpsb_add_packet_complete_task - add a new task for when a packet completes&n; * @packet: the packet whose completion we want the task added to&n; * @tq: the tq_struct describing the task to add&n; */
DECL|function|hpsb_add_packet_complete_task
r_void
id|hpsb_add_packet_complete_task
c_func
(paren
r_struct
id|hpsb_packet
op_star
id|packet
comma
r_struct
id|tq_struct
op_star
id|tq
)paren
(brace
id|list_add_tail
c_func
(paren
op_amp
id|tq-&gt;list
comma
op_amp
id|packet-&gt;complete_tq
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
multiline_comment|/**&n; * alloc_hpsb_packet - allocate new packet structure&n; * @data_size: size of the data block to be allocated&n; *&n; * This function allocates, initializes and returns a new &amp;struct hpsb_packet.&n; * It can be used in interrupt context.  A header block is always included, its&n; * size is big enough to contain all possible 1394 headers.  The data block is&n; * only allocated when @data_size is not zero.&n; *&n; * For packets for which responses will be received the @data_size has to be big&n; * enough to contain the response&squot;s data block since no further allocation&n; * occurs at response matching time.&n; *&n; * The packet&squot;s generation value will be set to the current generation number&n; * for ease of use.  Remember to overwrite it with your own recorded generation&n; * number if you can not be sure that your code will not race with a bus reset.&n; *&n; * Return value: A pointer to a &amp;struct hpsb_packet or NULL on allocation&n; * failure.&n; */
DECL|function|alloc_hpsb_packet
r_struct
id|hpsb_packet
op_star
id|alloc_hpsb_packet
c_func
(paren
r_int
id|data_size
)paren
(brace
r_struct
id|hpsb_packet
op_star
id|packet
op_assign
l_int|NULL
suffix:semicolon
r_void
op_star
id|data
op_assign
l_int|NULL
suffix:semicolon
r_int
id|kmflags
op_assign
id|in_interrupt
c_func
(paren
)paren
ques
c_cond
id|GFP_ATOMIC
suffix:colon
id|GFP_KERNEL
suffix:semicolon
id|packet
op_assign
id|kmem_cache_alloc
c_func
(paren
id|hpsb_packet_cache
comma
id|kmflags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|packet
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|packet
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|hpsb_packet
)paren
)paren
suffix:semicolon
id|packet-&gt;header
op_assign
id|packet-&gt;embedded_header
suffix:semicolon
r_if
c_cond
(paren
id|data_size
)paren
(brace
id|data
op_assign
id|kmalloc
c_func
(paren
id|data_size
op_plus
l_int|8
comma
id|kmflags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_eq
l_int|NULL
)paren
(brace
id|kmem_cache_free
c_func
(paren
id|hpsb_packet_cache
comma
id|packet
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|packet-&gt;data
op_assign
id|data
suffix:semicolon
id|packet-&gt;data_size
op_assign
id|data_size
suffix:semicolon
)brace
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|packet-&gt;complete_tq
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|packet-&gt;list
)paren
suffix:semicolon
id|sema_init
c_func
(paren
op_amp
id|packet-&gt;state_change
comma
l_int|0
)paren
suffix:semicolon
id|packet-&gt;state
op_assign
id|hpsb_unused
suffix:semicolon
id|packet-&gt;generation
op_assign
op_minus
l_int|1
suffix:semicolon
id|packet-&gt;data_be
op_assign
l_int|1
suffix:semicolon
r_return
id|packet
suffix:semicolon
)brace
multiline_comment|/**&n; * free_hpsb_packet - free packet and data associated with it&n; * @packet: packet to free (is NULL safe)&n; *&n; * This function will free packet-&gt;data, packet-&gt;header and finally the packet&n; * itself.&n; */
DECL|function|free_hpsb_packet
r_void
id|free_hpsb_packet
c_func
(paren
r_struct
id|hpsb_packet
op_star
id|packet
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|packet
)paren
r_return
suffix:semicolon
id|kfree
c_func
(paren
id|packet-&gt;data
)paren
suffix:semicolon
id|kmem_cache_free
c_func
(paren
id|hpsb_packet_cache
comma
id|packet
)paren
suffix:semicolon
)brace
DECL|function|hpsb_reset_bus
r_int
id|hpsb_reset_bus
c_func
(paren
r_struct
id|hpsb_host
op_star
id|host
comma
r_int
id|type
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|host-&gt;in_bus_reset
)paren
(brace
id|host-&gt;driver
op_member_access_from_pointer
id|devctl
c_func
(paren
id|host
comma
id|RESET_BUS
comma
id|type
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
r_return
l_int|1
suffix:semicolon
)brace
)brace
DECL|function|hpsb_bus_reset
r_int
id|hpsb_bus_reset
c_func
(paren
r_struct
id|hpsb_host
op_star
id|host
)paren
(brace
r_if
c_cond
(paren
id|host-&gt;in_bus_reset
)paren
(brace
id|HPSB_NOTICE
c_func
(paren
l_string|&quot;%s called while bus reset already in progress&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|abort_requests
c_func
(paren
id|host
)paren
suffix:semicolon
id|host-&gt;in_bus_reset
op_assign
l_int|1
suffix:semicolon
id|host-&gt;irm_id
op_assign
op_minus
l_int|1
suffix:semicolon
id|host-&gt;is_irm
op_assign
l_int|0
suffix:semicolon
id|host-&gt;busmgr_id
op_assign
op_minus
l_int|1
suffix:semicolon
id|host-&gt;is_busmgr
op_assign
l_int|0
suffix:semicolon
id|host-&gt;is_cycmst
op_assign
l_int|0
suffix:semicolon
id|host-&gt;node_count
op_assign
l_int|0
suffix:semicolon
id|host-&gt;selfid_count
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Verify num_of_selfids SelfIDs and return number of nodes.  Return zero in&n; * case verification failed.&n; */
DECL|function|check_selfids
r_static
r_int
id|check_selfids
c_func
(paren
r_struct
id|hpsb_host
op_star
id|host
)paren
(brace
r_int
id|nodeid
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
id|rest_of_selfids
op_assign
id|host-&gt;selfid_count
suffix:semicolon
r_struct
id|selfid
op_star
id|sid
op_assign
(paren
r_struct
id|selfid
op_star
)paren
id|host-&gt;topology_map
suffix:semicolon
r_struct
id|ext_selfid
op_star
id|esid
suffix:semicolon
r_int
id|esid_seq
op_assign
l_int|23
suffix:semicolon
id|host-&gt;nodes_active
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|rest_of_selfids
op_decrement
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|sid-&gt;extended
)paren
(brace
id|nodeid
op_increment
suffix:semicolon
id|esid_seq
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|sid-&gt;phy_id
op_ne
id|nodeid
)paren
(brace
id|HPSB_INFO
c_func
(paren
l_string|&quot;SelfIDs failed monotony check with &quot;
l_string|&quot;%d&quot;
comma
id|sid-&gt;phy_id
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|sid-&gt;link_active
)paren
(brace
id|host-&gt;nodes_active
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|sid-&gt;contender
)paren
id|host-&gt;irm_id
op_assign
id|LOCAL_BUS
op_or
id|sid-&gt;phy_id
suffix:semicolon
)brace
)brace
r_else
(brace
id|esid
op_assign
(paren
r_struct
id|ext_selfid
op_star
)paren
id|sid
suffix:semicolon
r_if
c_cond
(paren
(paren
id|esid-&gt;phy_id
op_ne
id|nodeid
)paren
op_logical_or
(paren
id|esid-&gt;seq_nr
op_ne
id|esid_seq
)paren
)paren
(brace
id|HPSB_INFO
c_func
(paren
l_string|&quot;SelfIDs failed monotony check with &quot;
l_string|&quot;%d/%d&quot;
comma
id|esid-&gt;phy_id
comma
id|esid-&gt;seq_nr
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|esid_seq
op_increment
suffix:semicolon
)brace
id|sid
op_increment
suffix:semicolon
)brace
id|esid
op_assign
(paren
r_struct
id|ext_selfid
op_star
)paren
(paren
id|sid
op_minus
l_int|1
)paren
suffix:semicolon
r_while
c_loop
(paren
id|esid-&gt;extended
)paren
(brace
r_if
c_cond
(paren
(paren
id|esid-&gt;porta
op_eq
l_int|0x2
)paren
op_logical_or
(paren
id|esid-&gt;portb
op_eq
l_int|0x2
)paren
op_logical_or
(paren
id|esid-&gt;portc
op_eq
l_int|0x2
)paren
op_logical_or
(paren
id|esid-&gt;portd
op_eq
l_int|0x2
)paren
op_logical_or
(paren
id|esid-&gt;porte
op_eq
l_int|0x2
)paren
op_logical_or
(paren
id|esid-&gt;portf
op_eq
l_int|0x2
)paren
op_logical_or
(paren
id|esid-&gt;portg
op_eq
l_int|0x2
)paren
op_logical_or
(paren
id|esid-&gt;porth
op_eq
l_int|0x2
)paren
)paren
(brace
id|HPSB_INFO
c_func
(paren
l_string|&quot;SelfIDs failed root check on &quot;
l_string|&quot;extended SelfID&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|esid
op_decrement
suffix:semicolon
)brace
id|sid
op_assign
(paren
r_struct
id|selfid
op_star
)paren
id|esid
suffix:semicolon
r_if
c_cond
(paren
(paren
id|sid-&gt;port0
op_eq
l_int|0x2
)paren
op_logical_or
(paren
id|sid-&gt;port1
op_eq
l_int|0x2
)paren
op_logical_or
(paren
id|sid-&gt;port2
op_eq
l_int|0x2
)paren
)paren
(brace
id|HPSB_INFO
c_func
(paren
l_string|&quot;SelfIDs failed root check&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|host-&gt;node_count
op_assign
id|nodeid
op_plus
l_int|1
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|build_speed_map
r_static
r_void
id|build_speed_map
c_func
(paren
r_struct
id|hpsb_host
op_star
id|host
comma
r_int
id|nodecount
)paren
(brace
r_char
id|speedcap
(braket
id|nodecount
)braket
suffix:semicolon
r_char
id|cldcnt
(braket
id|nodecount
)braket
suffix:semicolon
id|u8
op_star
id|map
op_assign
id|host-&gt;speed_map
suffix:semicolon
r_struct
id|selfid
op_star
id|sid
suffix:semicolon
r_struct
id|ext_selfid
op_star
id|esid
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|n
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
(paren
id|nodecount
op_star
l_int|64
)paren
suffix:semicolon
id|i
op_add_assign
l_int|64
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|nodecount
suffix:semicolon
id|j
op_increment
)paren
(brace
id|map
(braket
id|i
op_plus
id|j
)braket
op_assign
id|SPEED_400
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nodecount
suffix:semicolon
id|i
op_increment
)paren
(brace
id|cldcnt
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
multiline_comment|/* find direct children count and speed */
r_for
c_loop
(paren
id|sid
op_assign
(paren
r_struct
id|selfid
op_star
)paren
op_amp
id|host-&gt;topology_map
(braket
id|host-&gt;selfid_count
op_minus
l_int|1
)braket
comma
id|n
op_assign
id|nodecount
op_minus
l_int|1
suffix:semicolon
(paren
r_void
op_star
)paren
id|sid
op_ge
(paren
r_void
op_star
)paren
id|host-&gt;topology_map
suffix:semicolon
id|sid
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|sid-&gt;extended
)paren
(brace
id|esid
op_assign
(paren
r_struct
id|ext_selfid
op_star
)paren
id|sid
suffix:semicolon
r_if
c_cond
(paren
id|esid-&gt;porta
op_eq
l_int|0x3
)paren
id|cldcnt
(braket
id|n
)braket
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|esid-&gt;portb
op_eq
l_int|0x3
)paren
id|cldcnt
(braket
id|n
)braket
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|esid-&gt;portc
op_eq
l_int|0x3
)paren
id|cldcnt
(braket
id|n
)braket
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|esid-&gt;portd
op_eq
l_int|0x3
)paren
id|cldcnt
(braket
id|n
)braket
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|esid-&gt;porte
op_eq
l_int|0x3
)paren
id|cldcnt
(braket
id|n
)braket
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|esid-&gt;portf
op_eq
l_int|0x3
)paren
id|cldcnt
(braket
id|n
)braket
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|esid-&gt;portg
op_eq
l_int|0x3
)paren
id|cldcnt
(braket
id|n
)braket
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|esid-&gt;porth
op_eq
l_int|0x3
)paren
id|cldcnt
(braket
id|n
)braket
op_increment
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|sid-&gt;port0
op_eq
l_int|0x3
)paren
id|cldcnt
(braket
id|n
)braket
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|sid-&gt;port1
op_eq
l_int|0x3
)paren
id|cldcnt
(braket
id|n
)braket
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|sid-&gt;port2
op_eq
l_int|0x3
)paren
id|cldcnt
(braket
id|n
)braket
op_increment
suffix:semicolon
id|speedcap
(braket
id|n
)braket
op_assign
id|sid-&gt;speed
suffix:semicolon
id|n
op_decrement
suffix:semicolon
)brace
)brace
multiline_comment|/* set self mapping */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nodecount
suffix:semicolon
id|i
op_increment
)paren
(brace
id|map
(braket
l_int|64
op_star
id|i
op_plus
id|i
)braket
op_assign
id|speedcap
(braket
id|i
)braket
suffix:semicolon
)brace
multiline_comment|/* fix up direct children count to total children count;&n;         * also fix up speedcaps for sibling and parent communication */
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|nodecount
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
id|cldcnt
(braket
id|i
)braket
comma
id|n
op_assign
id|i
op_minus
l_int|1
suffix:semicolon
id|j
OG
l_int|0
suffix:semicolon
id|j
op_decrement
)paren
(brace
id|cldcnt
(braket
id|i
)braket
op_add_assign
id|cldcnt
(braket
id|n
)braket
suffix:semicolon
id|speedcap
(braket
id|n
)braket
op_assign
id|MIN
c_func
(paren
id|speedcap
(braket
id|n
)braket
comma
id|speedcap
(braket
id|i
)braket
)paren
suffix:semicolon
id|n
op_sub_assign
id|cldcnt
(braket
id|n
)braket
op_plus
l_int|1
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|n
op_assign
l_int|0
suffix:semicolon
id|n
OL
id|nodecount
suffix:semicolon
id|n
op_increment
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
id|n
op_minus
id|cldcnt
(braket
id|n
)braket
suffix:semicolon
id|i
op_le
id|n
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
(paren
id|n
op_minus
id|cldcnt
(braket
id|n
)braket
)paren
suffix:semicolon
id|j
op_increment
)paren
(brace
id|map
(braket
id|j
op_star
l_int|64
op_plus
id|i
)braket
op_assign
id|map
(braket
id|i
op_star
l_int|64
op_plus
id|j
)braket
op_assign
id|MIN
c_func
(paren
id|map
(braket
id|i
op_star
l_int|64
op_plus
id|j
)braket
comma
id|speedcap
(braket
id|n
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|j
op_assign
id|n
op_plus
l_int|1
suffix:semicolon
id|j
OL
id|nodecount
suffix:semicolon
id|j
op_increment
)paren
(brace
id|map
(braket
id|j
op_star
l_int|64
op_plus
id|i
)braket
op_assign
id|map
(braket
id|i
op_star
l_int|64
op_plus
id|j
)braket
op_assign
id|MIN
c_func
(paren
id|map
(braket
id|i
op_star
l_int|64
op_plus
id|j
)braket
comma
id|speedcap
(braket
id|n
)braket
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
DECL|function|hpsb_selfid_received
r_void
id|hpsb_selfid_received
c_func
(paren
r_struct
id|hpsb_host
op_star
id|host
comma
id|quadlet_t
id|sid
)paren
(brace
r_if
c_cond
(paren
id|host-&gt;in_bus_reset
)paren
(brace
macro_line|#ifdef CONFIG_IEEE1394_VERBOSEDEBUG
id|HPSB_INFO
c_func
(paren
l_string|&quot;Including SelfID 0x%x&quot;
comma
id|sid
)paren
suffix:semicolon
macro_line|#endif
id|host-&gt;topology_map
(braket
id|host-&gt;selfid_count
op_increment
)braket
op_assign
id|sid
suffix:semicolon
)brace
r_else
(brace
id|HPSB_NOTICE
c_func
(paren
l_string|&quot;Spurious SelfID packet (0x%08x) received from bus %d&quot;
comma
id|sid
comma
(paren
id|host-&gt;node_id
op_amp
id|BUS_MASK
)paren
op_rshift
l_int|6
)paren
suffix:semicolon
)brace
)brace
DECL|function|hpsb_selfid_complete
r_void
id|hpsb_selfid_complete
c_func
(paren
r_struct
id|hpsb_host
op_star
id|host
comma
r_int
id|phyid
comma
r_int
id|isroot
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|host-&gt;in_bus_reset
)paren
id|HPSB_NOTICE
c_func
(paren
l_string|&quot;SelfID completion called outside of bus reset!&quot;
)paren
suffix:semicolon
id|host-&gt;node_id
op_assign
id|LOCAL_BUS
op_or
id|phyid
suffix:semicolon
id|host-&gt;is_root
op_assign
id|isroot
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|check_selfids
c_func
(paren
id|host
)paren
)paren
(brace
r_if
c_cond
(paren
id|host-&gt;reset_retries
op_increment
OL
l_int|20
)paren
(brace
multiline_comment|/* selfid stage did not complete without error */
id|HPSB_NOTICE
c_func
(paren
l_string|&quot;Error in SelfID stage, resetting&quot;
)paren
suffix:semicolon
id|host-&gt;in_bus_reset
op_assign
l_int|0
suffix:semicolon
id|hpsb_reset_bus
c_func
(paren
id|host
comma
id|LONG_RESET
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_else
(brace
id|HPSB_NOTICE
c_func
(paren
l_string|&quot;Stopping out-of-control reset loop&quot;
)paren
suffix:semicolon
id|HPSB_NOTICE
c_func
(paren
l_string|&quot;Warning - topology map and speed map will not be valid&quot;
)paren
suffix:semicolon
)brace
)brace
r_else
(brace
id|build_speed_map
c_func
(paren
id|host
comma
id|host-&gt;node_count
)paren
suffix:semicolon
)brace
multiline_comment|/* irm_id is kept up to date by check_selfids() */
r_if
c_cond
(paren
id|host-&gt;irm_id
op_eq
id|host-&gt;node_id
)paren
(brace
id|host-&gt;is_irm
op_assign
l_int|1
suffix:semicolon
id|host-&gt;is_busmgr
op_assign
l_int|1
suffix:semicolon
id|host-&gt;busmgr_id
op_assign
id|host-&gt;node_id
suffix:semicolon
id|host-&gt;csr.bus_manager_id
op_assign
id|host-&gt;node_id
suffix:semicolon
)brace
id|host-&gt;reset_retries
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|isroot
)paren
(brace
id|host-&gt;driver
op_member_access_from_pointer
id|devctl
c_func
(paren
id|host
comma
id|ACT_CYCLE_MASTER
comma
l_int|1
)paren
suffix:semicolon
id|host-&gt;is_cycmst
op_assign
l_int|1
suffix:semicolon
)brace
id|atomic_inc
c_func
(paren
op_amp
id|host-&gt;generation
)paren
suffix:semicolon
id|host-&gt;in_bus_reset
op_assign
l_int|0
suffix:semicolon
id|highlevel_host_reset
c_func
(paren
id|host
)paren
suffix:semicolon
)brace
DECL|function|hpsb_packet_sent
r_void
id|hpsb_packet_sent
c_func
(paren
r_struct
id|hpsb_host
op_star
id|host
comma
r_struct
id|hpsb_packet
op_star
id|packet
comma
r_int
id|ackcode
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|packet-&gt;ack_code
op_assign
id|ackcode
suffix:semicolon
r_if
c_cond
(paren
id|packet-&gt;no_waiter
)paren
(brace
multiline_comment|/* must not have a tlabel allocated */
id|free_hpsb_packet
c_func
(paren
id|packet
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ackcode
op_ne
id|ACK_PENDING
op_logical_or
op_logical_neg
id|packet-&gt;expect_response
)paren
(brace
id|packet-&gt;state
op_assign
id|hpsb_complete
suffix:semicolon
id|up
c_func
(paren
op_amp
id|packet-&gt;state_change
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|packet-&gt;state_change
)paren
suffix:semicolon
id|process_complete_tasks
c_func
(paren
id|packet
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|packet-&gt;state
op_assign
id|hpsb_pending
suffix:semicolon
id|packet-&gt;sendtime
op_assign
id|jiffies
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|host-&gt;pending_pkt_lock
comma
id|flags
)paren
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|packet-&gt;list
comma
op_amp
id|host-&gt;pending_packets
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|host-&gt;pending_pkt_lock
comma
id|flags
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|packet-&gt;state_change
)paren
suffix:semicolon
id|schedule_task
c_func
(paren
op_amp
id|host-&gt;timeout_tq
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * hpsb_send_packet - transmit a packet on the bus&n; * @packet: packet to send&n; *&n; * The packet is sent through the host specified in the packet-&gt;host field.&n; * Before sending, the packet&squot;s transmit speed is automatically determined using&n; * the local speed map when it is an async, non-broadcast packet.&n; *&n; * Possibilities for failure are that host is either not initialized, in bus&n; * reset, the packet&squot;s generation number doesn&squot;t match the current generation&n; * number or the host reports a transmit error.&n; *&n; * Return value: False (0) on failure, true (1) otherwise.&n; */
DECL|function|hpsb_send_packet
r_int
id|hpsb_send_packet
c_func
(paren
r_struct
id|hpsb_packet
op_star
id|packet
)paren
(brace
r_struct
id|hpsb_host
op_star
id|host
op_assign
id|packet-&gt;host
suffix:semicolon
r_if
c_cond
(paren
id|host-&gt;is_shutdown
op_logical_or
id|host-&gt;in_bus_reset
op_logical_or
(paren
id|packet-&gt;generation
op_ne
id|get_hpsb_generation
c_func
(paren
id|host
)paren
)paren
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
id|packet-&gt;state
op_assign
id|hpsb_queued
suffix:semicolon
r_if
c_cond
(paren
id|packet-&gt;type
op_eq
id|hpsb_async
op_logical_and
id|packet-&gt;node_id
op_ne
id|ALL_NODES
)paren
(brace
id|packet-&gt;speed_code
op_assign
id|host-&gt;speed_map
(braket
(paren
id|host-&gt;node_id
op_amp
id|NODE_MASK
)paren
op_star
l_int|64
op_plus
(paren
id|packet-&gt;node_id
op_amp
id|NODE_MASK
)paren
)braket
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_IEEE1394_VERBOSEDEBUG
r_switch
c_cond
(paren
id|packet-&gt;speed_code
)paren
(brace
r_case
l_int|2
suffix:colon
id|dump_packet
c_func
(paren
l_string|&quot;send packet 400:&quot;
comma
id|packet-&gt;header
comma
id|packet-&gt;header_size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|dump_packet
c_func
(paren
l_string|&quot;send packet 200:&quot;
comma
id|packet-&gt;header
comma
id|packet-&gt;header_size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|dump_packet
c_func
(paren
l_string|&quot;send packet 100:&quot;
comma
id|packet-&gt;header
comma
id|packet-&gt;header_size
)paren
suffix:semicolon
)brace
macro_line|#endif
r_return
id|host-&gt;driver
op_member_access_from_pointer
id|transmit_packet
c_func
(paren
id|host
comma
id|packet
)paren
suffix:semicolon
)brace
DECL|function|send_packet_nocare
r_static
r_void
id|send_packet_nocare
c_func
(paren
r_struct
id|hpsb_packet
op_star
id|packet
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|hpsb_send_packet
c_func
(paren
id|packet
)paren
)paren
(brace
id|free_hpsb_packet
c_func
(paren
id|packet
)paren
suffix:semicolon
)brace
)brace
DECL|function|handle_packet_response
r_void
id|handle_packet_response
c_func
(paren
r_struct
id|hpsb_host
op_star
id|host
comma
r_int
id|tcode
comma
id|quadlet_t
op_star
id|data
comma
r_int
id|size
)paren
(brace
r_struct
id|hpsb_packet
op_star
id|packet
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|list_head
op_star
id|lh
suffix:semicolon
r_int
id|tcode_match
op_assign
l_int|0
suffix:semicolon
r_int
id|tlabel
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|tlabel
op_assign
(paren
id|data
(braket
l_int|0
)braket
op_rshift
l_int|10
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|host-&gt;pending_pkt_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|lh
comma
op_amp
id|host-&gt;pending_packets
)paren
(brace
id|packet
op_assign
id|list_entry
c_func
(paren
id|lh
comma
r_struct
id|hpsb_packet
comma
id|list
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|packet-&gt;tlabel
op_eq
id|tlabel
)paren
op_logical_and
(paren
id|packet-&gt;node_id
op_eq
(paren
id|data
(braket
l_int|1
)braket
op_rshift
l_int|16
)paren
)paren
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|lh
op_eq
op_amp
id|host-&gt;pending_packets
)paren
(brace
id|HPSB_DEBUG
c_func
(paren
l_string|&quot;unsolicited response packet received - np&quot;
)paren
suffix:semicolon
id|dump_packet
c_func
(paren
l_string|&quot;contents:&quot;
comma
id|data
comma
l_int|16
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|host-&gt;pending_pkt_lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|packet-&gt;tcode
)paren
(brace
r_case
id|TCODE_WRITEQ
suffix:colon
r_case
id|TCODE_WRITEB
suffix:colon
r_if
c_cond
(paren
id|tcode
op_eq
id|TCODE_WRITE_RESPONSE
)paren
id|tcode_match
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TCODE_READQ
suffix:colon
r_if
c_cond
(paren
id|tcode
op_eq
id|TCODE_READQ_RESPONSE
)paren
id|tcode_match
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TCODE_READB
suffix:colon
r_if
c_cond
(paren
id|tcode
op_eq
id|TCODE_READB_RESPONSE
)paren
id|tcode_match
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TCODE_LOCK_REQUEST
suffix:colon
r_if
c_cond
(paren
id|tcode
op_eq
id|TCODE_LOCK_RESPONSE
)paren
id|tcode_match
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|tcode_match
op_logical_or
(paren
id|packet-&gt;tlabel
op_ne
id|tlabel
)paren
op_logical_or
(paren
id|packet-&gt;node_id
op_ne
(paren
id|data
(braket
l_int|1
)braket
op_rshift
l_int|16
)paren
)paren
)paren
(brace
id|HPSB_INFO
c_func
(paren
l_string|&quot;unsolicited response packet received&quot;
)paren
suffix:semicolon
id|dump_packet
c_func
(paren
l_string|&quot;contents:&quot;
comma
id|data
comma
l_int|16
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|host-&gt;pending_pkt_lock
comma
id|flags
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|list_del
c_func
(paren
op_amp
id|packet-&gt;list
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|host-&gt;pending_pkt_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* FIXME - update size fields? */
r_switch
c_cond
(paren
id|tcode
)paren
(brace
r_case
id|TCODE_WRITE_RESPONSE
suffix:colon
id|memcpy
c_func
(paren
id|packet-&gt;header
comma
id|data
comma
l_int|12
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TCODE_READQ_RESPONSE
suffix:colon
id|memcpy
c_func
(paren
id|packet-&gt;header
comma
id|data
comma
l_int|16
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TCODE_READB_RESPONSE
suffix:colon
id|memcpy
c_func
(paren
id|packet-&gt;header
comma
id|data
comma
l_int|16
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|packet-&gt;data
comma
id|data
op_plus
l_int|4
comma
id|size
op_minus
l_int|16
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TCODE_LOCK_RESPONSE
suffix:colon
id|memcpy
c_func
(paren
id|packet-&gt;header
comma
id|data
comma
l_int|16
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|packet-&gt;data
comma
id|data
op_plus
l_int|4
comma
(paren
id|size
op_minus
l_int|16
)paren
OG
l_int|8
ques
c_cond
l_int|8
suffix:colon
id|size
op_minus
l_int|16
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|packet-&gt;state
op_assign
id|hpsb_complete
suffix:semicolon
id|up
c_func
(paren
op_amp
id|packet-&gt;state_change
)paren
suffix:semicolon
id|process_complete_tasks
c_func
(paren
id|packet
)paren
suffix:semicolon
)brace
DECL|function|create_reply_packet
r_static
r_struct
id|hpsb_packet
op_star
id|create_reply_packet
c_func
(paren
r_struct
id|hpsb_host
op_star
id|host
comma
id|quadlet_t
op_star
id|data
comma
r_int
id|dsize
)paren
(brace
r_struct
id|hpsb_packet
op_star
id|p
suffix:semicolon
id|dsize
op_add_assign
(paren
id|dsize
op_mod
l_int|4
ques
c_cond
l_int|4
op_minus
(paren
id|dsize
op_mod
l_int|4
)paren
suffix:colon
l_int|0
)paren
suffix:semicolon
id|p
op_assign
id|alloc_hpsb_packet
c_func
(paren
id|dsize
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* FIXME - send data_error response */
r_return
l_int|NULL
suffix:semicolon
)brace
id|p-&gt;type
op_assign
id|hpsb_async
suffix:semicolon
id|p-&gt;state
op_assign
id|hpsb_unused
suffix:semicolon
id|p-&gt;host
op_assign
id|host
suffix:semicolon
id|p-&gt;node_id
op_assign
id|data
(braket
l_int|1
)braket
op_rshift
l_int|16
suffix:semicolon
id|p-&gt;tlabel
op_assign
(paren
id|data
(braket
l_int|0
)braket
op_rshift
l_int|10
)paren
op_amp
l_int|0x3f
suffix:semicolon
id|p-&gt;no_waiter
op_assign
l_int|1
suffix:semicolon
id|p-&gt;generation
op_assign
id|get_hpsb_generation
c_func
(paren
id|host
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dsize
op_mod
l_int|4
)paren
(brace
id|p-&gt;data
(braket
id|dsize
op_div
l_int|4
)braket
op_assign
l_int|0
suffix:semicolon
)brace
r_return
id|p
suffix:semicolon
)brace
DECL|macro|PREP_REPLY_PACKET
mdefine_line|#define PREP_REPLY_PACKET(length) &bslash;&n;                packet = create_reply_packet(host, data, length); &bslash;&n;                if (packet == NULL) break
DECL|function|handle_incoming_packet
r_static
r_void
id|handle_incoming_packet
c_func
(paren
r_struct
id|hpsb_host
op_star
id|host
comma
r_int
id|tcode
comma
id|quadlet_t
op_star
id|data
comma
r_int
id|size
comma
r_int
id|write_acked
)paren
(brace
r_struct
id|hpsb_packet
op_star
id|packet
suffix:semicolon
r_int
id|length
comma
id|rcode
comma
id|extcode
suffix:semicolon
id|nodeid_t
id|source
op_assign
id|data
(braket
l_int|1
)braket
op_rshift
l_int|16
suffix:semicolon
id|nodeid_t
id|dest
op_assign
id|data
(braket
l_int|0
)braket
op_rshift
l_int|16
suffix:semicolon
id|u64
id|addr
suffix:semicolon
multiline_comment|/* big FIXME - no error checking is done for an out of bounds length */
r_switch
c_cond
(paren
id|tcode
)paren
(brace
r_case
id|TCODE_WRITEQ
suffix:colon
id|addr
op_assign
(paren
(paren
(paren
id|u64
)paren
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0xffff
)paren
)paren
op_lshift
l_int|32
)paren
op_or
id|data
(braket
l_int|2
)braket
suffix:semicolon
id|rcode
op_assign
id|highlevel_write
c_func
(paren
id|host
comma
id|source
comma
id|dest
comma
id|data
op_plus
l_int|3
comma
id|addr
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|write_acked
op_logical_and
(paren
(paren
id|data
(braket
l_int|0
)braket
op_rshift
l_int|16
)paren
op_amp
id|NODE_MASK
)paren
op_ne
id|NODE_MASK
)paren
(brace
multiline_comment|/* not a broadcast write, reply */
id|PREP_REPLY_PACKET
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fill_async_write_resp
c_func
(paren
id|packet
comma
id|rcode
)paren
suffix:semicolon
id|send_packet_nocare
c_func
(paren
id|packet
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|TCODE_WRITEB
suffix:colon
id|addr
op_assign
(paren
(paren
(paren
id|u64
)paren
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0xffff
)paren
)paren
op_lshift
l_int|32
)paren
op_or
id|data
(braket
l_int|2
)braket
suffix:semicolon
id|rcode
op_assign
id|highlevel_write
c_func
(paren
id|host
comma
id|source
comma
id|dest
comma
id|data
op_plus
l_int|4
comma
id|addr
comma
id|data
(braket
l_int|3
)braket
op_rshift
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|write_acked
op_logical_and
(paren
(paren
id|data
(braket
l_int|0
)braket
op_rshift
l_int|16
)paren
op_amp
id|NODE_MASK
)paren
op_ne
id|NODE_MASK
)paren
(brace
multiline_comment|/* not a broadcast write, reply */
id|PREP_REPLY_PACKET
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|fill_async_write_resp
c_func
(paren
id|packet
comma
id|rcode
)paren
suffix:semicolon
id|send_packet_nocare
c_func
(paren
id|packet
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|TCODE_READQ
suffix:colon
id|PREP_REPLY_PACKET
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|addr
op_assign
(paren
(paren
(paren
id|u64
)paren
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0xffff
)paren
)paren
op_lshift
l_int|32
)paren
op_or
id|data
(braket
l_int|2
)braket
suffix:semicolon
id|rcode
op_assign
id|highlevel_read
c_func
(paren
id|host
comma
id|source
comma
id|data
comma
id|addr
comma
l_int|4
)paren
suffix:semicolon
id|fill_async_readquad_resp
c_func
(paren
id|packet
comma
id|rcode
comma
op_star
id|data
)paren
suffix:semicolon
id|send_packet_nocare
c_func
(paren
id|packet
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TCODE_READB
suffix:colon
id|length
op_assign
id|data
(braket
l_int|3
)braket
op_rshift
l_int|16
suffix:semicolon
id|PREP_REPLY_PACKET
c_func
(paren
id|length
)paren
suffix:semicolon
id|addr
op_assign
(paren
(paren
(paren
id|u64
)paren
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0xffff
)paren
)paren
op_lshift
l_int|32
)paren
op_or
id|data
(braket
l_int|2
)braket
suffix:semicolon
id|rcode
op_assign
id|highlevel_read
c_func
(paren
id|host
comma
id|source
comma
id|packet-&gt;data
comma
id|addr
comma
id|length
)paren
suffix:semicolon
id|fill_async_readblock_resp
c_func
(paren
id|packet
comma
id|rcode
comma
id|length
)paren
suffix:semicolon
id|send_packet_nocare
c_func
(paren
id|packet
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TCODE_LOCK_REQUEST
suffix:colon
id|length
op_assign
id|data
(braket
l_int|3
)braket
op_rshift
l_int|16
suffix:semicolon
id|extcode
op_assign
id|data
(braket
l_int|3
)braket
op_amp
l_int|0xffff
suffix:semicolon
id|addr
op_assign
(paren
(paren
(paren
id|u64
)paren
(paren
id|data
(braket
l_int|1
)braket
op_amp
l_int|0xffff
)paren
)paren
op_lshift
l_int|32
)paren
op_or
id|data
(braket
l_int|2
)braket
suffix:semicolon
id|PREP_REPLY_PACKET
c_func
(paren
l_int|8
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|extcode
op_eq
l_int|0
)paren
op_logical_or
(paren
id|extcode
op_ge
l_int|7
)paren
)paren
(brace
multiline_comment|/* let switch default handle error */
id|length
op_assign
l_int|0
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|length
)paren
(brace
r_case
l_int|4
suffix:colon
id|rcode
op_assign
id|highlevel_lock
c_func
(paren
id|host
comma
id|source
comma
id|packet-&gt;data
comma
id|addr
comma
id|data
(braket
l_int|4
)braket
comma
l_int|0
comma
id|extcode
)paren
suffix:semicolon
id|fill_async_lock_resp
c_func
(paren
id|packet
comma
id|rcode
comma
id|extcode
comma
l_int|4
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
r_if
c_cond
(paren
(paren
id|extcode
op_ne
id|EXTCODE_FETCH_ADD
)paren
op_logical_and
(paren
id|extcode
op_ne
id|EXTCODE_LITTLE_ADD
)paren
)paren
(brace
id|rcode
op_assign
id|highlevel_lock
c_func
(paren
id|host
comma
id|source
comma
id|packet-&gt;data
comma
id|addr
comma
id|data
(braket
l_int|5
)braket
comma
id|data
(braket
l_int|4
)braket
comma
id|extcode
)paren
suffix:semicolon
id|fill_async_lock_resp
c_func
(paren
id|packet
comma
id|rcode
comma
id|extcode
comma
l_int|4
)paren
suffix:semicolon
)brace
r_else
(brace
id|rcode
op_assign
id|highlevel_lock64
c_func
(paren
id|host
comma
id|source
comma
(paren
id|octlet_t
op_star
)paren
id|packet-&gt;data
comma
id|addr
comma
op_star
(paren
id|octlet_t
op_star
)paren
(paren
id|data
op_plus
l_int|4
)paren
comma
l_int|0ULL
comma
id|extcode
)paren
suffix:semicolon
id|fill_async_lock_resp
c_func
(paren
id|packet
comma
id|rcode
comma
id|extcode
comma
l_int|8
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
l_int|16
suffix:colon
id|rcode
op_assign
id|highlevel_lock64
c_func
(paren
id|host
comma
id|source
comma
(paren
id|octlet_t
op_star
)paren
id|packet-&gt;data
comma
id|addr
comma
op_star
(paren
id|octlet_t
op_star
)paren
(paren
id|data
op_plus
l_int|6
)paren
comma
op_star
(paren
id|octlet_t
op_star
)paren
(paren
id|data
op_plus
l_int|4
)paren
comma
id|extcode
)paren
suffix:semicolon
id|fill_async_lock_resp
c_func
(paren
id|packet
comma
id|rcode
comma
id|extcode
comma
l_int|8
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|fill_async_lock_resp
c_func
(paren
id|packet
comma
id|RCODE_TYPE_ERROR
comma
id|extcode
comma
l_int|0
)paren
suffix:semicolon
)brace
id|send_packet_nocare
c_func
(paren
id|packet
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|macro|PREP_REPLY_PACKET
macro_line|#undef PREP_REPLY_PACKET
DECL|function|hpsb_packet_received
r_void
id|hpsb_packet_received
c_func
(paren
r_struct
id|hpsb_host
op_star
id|host
comma
id|quadlet_t
op_star
id|data
comma
r_int
id|size
comma
r_int
id|write_acked
)paren
(brace
r_int
id|tcode
suffix:semicolon
r_if
c_cond
(paren
id|host-&gt;in_bus_reset
)paren
(brace
id|HPSB_INFO
c_func
(paren
l_string|&quot;received packet during reset; ignoring&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_IEEE1394_VERBOSEDEBUG
id|dump_packet
c_func
(paren
l_string|&quot;received packet:&quot;
comma
id|data
comma
id|size
)paren
suffix:semicolon
macro_line|#endif
id|tcode
op_assign
(paren
id|data
(braket
l_int|0
)braket
op_rshift
l_int|4
)paren
op_amp
l_int|0xf
suffix:semicolon
r_switch
c_cond
(paren
id|tcode
)paren
(brace
r_case
id|TCODE_WRITE_RESPONSE
suffix:colon
r_case
id|TCODE_READQ_RESPONSE
suffix:colon
r_case
id|TCODE_READB_RESPONSE
suffix:colon
r_case
id|TCODE_LOCK_RESPONSE
suffix:colon
id|handle_packet_response
c_func
(paren
id|host
comma
id|tcode
comma
id|data
comma
id|size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TCODE_WRITEQ
suffix:colon
r_case
id|TCODE_WRITEB
suffix:colon
r_case
id|TCODE_READQ
suffix:colon
r_case
id|TCODE_READB
suffix:colon
r_case
id|TCODE_LOCK_REQUEST
suffix:colon
id|handle_incoming_packet
c_func
(paren
id|host
comma
id|tcode
comma
id|data
comma
id|size
comma
id|write_acked
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TCODE_ISO_DATA
suffix:colon
id|highlevel_iso_receive
c_func
(paren
id|host
comma
id|data
comma
id|size
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TCODE_CYCLE_START
suffix:colon
multiline_comment|/* simply ignore this packet if it is passed on */
r_break
suffix:semicolon
r_default
suffix:colon
id|HPSB_NOTICE
c_func
(paren
l_string|&quot;received packet with bogus transaction code %d&quot;
comma
id|tcode
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|abort_requests
r_void
id|abort_requests
c_func
(paren
r_struct
id|hpsb_host
op_star
id|host
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|hpsb_packet
op_star
id|packet
suffix:semicolon
r_struct
id|list_head
op_star
id|lh
suffix:semicolon
id|LIST_HEAD
c_func
(paren
id|llist
)paren
suffix:semicolon
id|host-&gt;driver
op_member_access_from_pointer
id|devctl
c_func
(paren
id|host
comma
id|CANCEL_REQUESTS
comma
l_int|0
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|host-&gt;pending_pkt_lock
comma
id|flags
)paren
suffix:semicolon
id|list_splice
c_func
(paren
op_amp
id|host-&gt;pending_packets
comma
op_amp
id|llist
)paren
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|host-&gt;pending_packets
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|host-&gt;pending_pkt_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|lh
comma
op_amp
id|llist
)paren
(brace
id|packet
op_assign
id|list_entry
c_func
(paren
id|lh
comma
r_struct
id|hpsb_packet
comma
id|list
)paren
suffix:semicolon
id|packet-&gt;state
op_assign
id|hpsb_complete
suffix:semicolon
id|packet-&gt;ack_code
op_assign
id|ACKX_ABORTED
suffix:semicolon
id|up
c_func
(paren
op_amp
id|packet-&gt;state_change
)paren
suffix:semicolon
id|process_complete_tasks
c_func
(paren
id|packet
)paren
suffix:semicolon
)brace
)brace
DECL|function|abort_timedouts
r_void
id|abort_timedouts
c_func
(paren
r_struct
id|hpsb_host
op_star
id|host
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|hpsb_packet
op_star
id|packet
suffix:semicolon
r_int
r_int
id|expire
suffix:semicolon
r_struct
id|list_head
op_star
id|lh
comma
op_star
id|next
suffix:semicolon
id|LIST_HEAD
c_func
(paren
id|expiredlist
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|host-&gt;csr.lock
comma
id|flags
)paren
suffix:semicolon
id|expire
op_assign
(paren
id|host-&gt;csr.split_timeout_hi
op_star
l_int|8000
op_plus
(paren
id|host-&gt;csr.split_timeout_lo
op_rshift
l_int|19
)paren
)paren
op_star
id|HZ
op_div
l_int|8000
suffix:semicolon
multiline_comment|/* Avoid shortening of timeout due to rounding errors: */
id|expire
op_increment
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|host-&gt;csr.lock
comma
id|flags
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|host-&gt;pending_pkt_lock
comma
id|flags
)paren
suffix:semicolon
r_for
c_loop
(paren
id|lh
op_assign
id|host-&gt;pending_packets.next
suffix:semicolon
id|lh
op_ne
op_amp
id|host-&gt;pending_packets
suffix:semicolon
id|lh
op_assign
id|next
)paren
(brace
id|packet
op_assign
id|list_entry
c_func
(paren
id|lh
comma
r_struct
id|hpsb_packet
comma
id|list
)paren
suffix:semicolon
id|next
op_assign
id|lh-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|time_before
c_func
(paren
id|packet-&gt;sendtime
op_plus
id|expire
comma
id|jiffies
)paren
)paren
(brace
id|list_del
c_func
(paren
op_amp
id|packet-&gt;list
)paren
suffix:semicolon
id|list_add
c_func
(paren
op_amp
id|packet-&gt;list
comma
op_amp
id|expiredlist
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|list_empty
c_func
(paren
op_amp
id|host-&gt;pending_packets
)paren
)paren
id|schedule_task
c_func
(paren
op_amp
id|host-&gt;timeout_tq
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|host-&gt;pending_pkt_lock
comma
id|flags
)paren
suffix:semicolon
id|list_for_each
c_func
(paren
id|lh
comma
op_amp
id|expiredlist
)paren
(brace
id|packet
op_assign
id|list_entry
c_func
(paren
id|lh
comma
r_struct
id|hpsb_packet
comma
id|list
)paren
suffix:semicolon
id|packet-&gt;state
op_assign
id|hpsb_complete
suffix:semicolon
id|packet-&gt;ack_code
op_assign
id|ACKX_TIMEOUT
suffix:semicolon
id|up
c_func
(paren
op_amp
id|packet-&gt;state_change
)paren
suffix:semicolon
id|process_complete_tasks
c_func
(paren
id|packet
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/*&n; * character device dispatching (see ieee1394_core.h)&n; * Dan Maas &lt;dmaas@dcine.com&gt;&n; */
r_static
r_struct
(brace
DECL|member|file_ops
r_struct
id|file_operations
op_star
id|file_ops
suffix:semicolon
DECL|member|module
r_struct
id|module
op_star
id|module
suffix:semicolon
DECL|variable|ieee1394_chardevs
)brace
id|ieee1394_chardevs
(braket
l_int|16
)braket
suffix:semicolon
DECL|variable|ieee1394_chardevs_lock
r_static
id|rwlock_t
id|ieee1394_chardevs_lock
op_assign
id|RW_LOCK_UNLOCKED
suffix:semicolon
r_static
r_int
id|ieee1394_dispatch_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
suffix:semicolon
DECL|variable|ieee1394_chardev_ops
r_static
r_struct
id|file_operations
id|ieee1394_chardev_ops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|open
op_assign
id|ieee1394_dispatch_open
comma
)brace
suffix:semicolon
DECL|variable|ieee1394_devfs_handle
id|devfs_handle_t
id|ieee1394_devfs_handle
suffix:semicolon
multiline_comment|/* claim a block of minor numbers */
DECL|function|ieee1394_register_chardev
r_int
id|ieee1394_register_chardev
c_func
(paren
r_int
id|blocknum
comma
r_struct
id|module
op_star
id|module
comma
r_struct
id|file_operations
op_star
id|file_ops
)paren
(brace
r_int
id|retval
suffix:semicolon
r_if
c_cond
(paren
(paren
id|blocknum
OL
l_int|0
)paren
op_logical_or
(paren
id|blocknum
OG
l_int|15
)paren
)paren
(brace
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|write_lock
c_func
(paren
op_amp
id|ieee1394_chardevs_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ieee1394_chardevs
(braket
id|blocknum
)braket
dot
id|file_ops
op_eq
l_int|NULL
)paren
(brace
multiline_comment|/* grab the minor block */
id|ieee1394_chardevs
(braket
id|blocknum
)braket
dot
id|file_ops
op_assign
id|file_ops
suffix:semicolon
id|ieee1394_chardevs
(braket
id|blocknum
)braket
dot
id|module
op_assign
id|module
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* block already taken */
id|retval
op_assign
op_minus
id|EBUSY
suffix:semicolon
)brace
id|write_unlock
c_func
(paren
op_amp
id|ieee1394_chardevs_lock
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
multiline_comment|/* release a block of minor numbers */
DECL|function|ieee1394_unregister_chardev
r_void
id|ieee1394_unregister_chardev
c_func
(paren
r_int
id|blocknum
)paren
(brace
r_if
c_cond
(paren
(paren
id|blocknum
OL
l_int|0
)paren
op_logical_or
(paren
id|blocknum
OG
l_int|15
)paren
)paren
(brace
r_return
suffix:semicolon
)brace
id|write_lock
c_func
(paren
op_amp
id|ieee1394_chardevs_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ieee1394_chardevs
(braket
id|blocknum
)braket
dot
id|file_ops
)paren
(brace
id|ieee1394_chardevs
(braket
id|blocknum
)braket
dot
id|file_ops
op_assign
l_int|NULL
suffix:semicolon
id|ieee1394_chardevs
(braket
id|blocknum
)braket
dot
id|module
op_assign
l_int|NULL
suffix:semicolon
)brace
id|write_unlock
c_func
(paren
op_amp
id|ieee1394_chardevs_lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;  ieee1394_get_chardev() - look up and acquire a character device&n;  driver that has previously registered using ieee1394_register_chardev()&n;  &n;  On success, returns 1 and sets module and file_ops to the driver.&n;  The module will have an incremented reference count.&n;   &n;  On failure, returns 0.&n;  The module will NOT have an incremented reference count.&n;*/
DECL|function|ieee1394_get_chardev
r_static
r_int
id|ieee1394_get_chardev
c_func
(paren
r_int
id|blocknum
comma
r_struct
id|module
op_star
op_star
id|module
comma
r_struct
id|file_operations
op_star
op_star
id|file_ops
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
(paren
id|blocknum
OL
l_int|0
)paren
op_logical_or
(paren
id|blocknum
OG
l_int|15
)paren
)paren
(brace
r_return
id|ret
suffix:semicolon
)brace
id|read_lock
c_func
(paren
op_amp
id|ieee1394_chardevs_lock
)paren
suffix:semicolon
op_star
id|module
op_assign
id|ieee1394_chardevs
(braket
id|blocknum
)braket
dot
id|module
suffix:semicolon
op_star
id|file_ops
op_assign
id|ieee1394_chardevs
(braket
id|blocknum
)braket
dot
id|file_ops
suffix:semicolon
r_if
c_cond
(paren
op_star
id|file_ops
op_eq
l_int|NULL
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* don&squot;t need try_inc_mod_count if the driver is non-modular */
r_if
c_cond
(paren
op_star
id|module
op_logical_and
(paren
id|try_inc_mod_count
c_func
(paren
op_star
id|module
)paren
op_eq
l_int|0
)paren
)paren
(brace
r_goto
id|out
suffix:semicolon
)brace
multiline_comment|/* success! */
id|ret
op_assign
l_int|1
suffix:semicolon
id|out
suffix:colon
id|read_unlock
c_func
(paren
op_amp
id|ieee1394_chardevs_lock
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/* the point of entry for open() on any ieee1394 character device */
DECL|function|ieee1394_dispatch_open
r_static
r_int
id|ieee1394_dispatch_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|file_operations
op_star
id|file_ops
suffix:semicolon
r_struct
id|module
op_star
id|module
suffix:semicolon
r_int
id|blocknum
suffix:semicolon
r_int
id|retval
suffix:semicolon
multiline_comment|/*&n;&t;  Maintaining correct module reference counts is tricky here!&n;&n;&t;  The key thing to remember is that the VFS increments the&n;&t;  reference count of ieee1394 before it calls&n;&t;  ieee1394_dispatch_open().&n;&n;&t;  If the open() succeeds, then we need to transfer this extra&n;&t;  reference to the task-specific driver module (e.g. raw1394).&n;&t;  The VFS will deref the driver module automatically when the&n;&t;  file is later released.&n;&n;&t;  If the open() fails, then the VFS will drop the&n;&t;  reference count of whatever module file-&gt;f_op-&gt;owner points&n;&t;  to, immediately after this function returns.&n;&t;*/
multiline_comment|/* shift away lower four bits of the minor&n;&t;   to get the index of the ieee1394_driver&n;&t;   we want */
id|blocknum
op_assign
(paren
id|minor
c_func
(paren
id|inode-&gt;i_rdev
)paren
op_rshift
l_int|4
)paren
op_amp
l_int|0xF
suffix:semicolon
multiline_comment|/* look up the driver */
r_if
c_cond
(paren
id|ieee1394_get_chardev
c_func
(paren
id|blocknum
comma
op_amp
id|module
comma
op_amp
id|file_ops
)paren
op_eq
l_int|0
)paren
(brace
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
multiline_comment|/* redirect all subsequent requests to the driver&squot;s&n;&t;   own file_operations */
id|file-&gt;f_op
op_assign
id|file_ops
suffix:semicolon
multiline_comment|/* at this point BOTH ieee1394 and the task-specific driver have&n;&t;   an extra reference */
multiline_comment|/* follow through with the open() */
id|retval
op_assign
id|file_ops
op_member_access_from_pointer
id|open
c_func
(paren
id|inode
comma
id|file
)paren
suffix:semicolon
r_if
c_cond
(paren
id|retval
op_eq
l_int|0
)paren
(brace
multiline_comment|/* If the open() succeeded, then ieee1394 will be left&n;&t;&t;   with an extra module reference, so we discard it here.&n;&n;&t;&t;   The task-specific driver still has the extra&n;&t;&t;   reference given to it by ieee1394_get_chardev().&n;&t;&t;   This extra reference prevents the module from&n;&t;&t;   unloading while the file is open, and will be&n;&t;&t;   dropped by the VFS when the file is released.&n;&t;&t;*/
r_if
c_cond
(paren
id|THIS_MODULE
)paren
(brace
id|__MOD_DEC_USE_COUNT
c_func
(paren
(paren
r_struct
id|module
op_star
)paren
id|THIS_MODULE
)paren
suffix:semicolon
)brace
multiline_comment|/* note that if ieee1394 is compiled into the kernel,&n;&t;&t;   THIS_MODULE will be (void*) NULL, hence the if and&n;&t;&t;   the cast are necessary */
)brace
r_else
(brace
multiline_comment|/* if the open() failed, then we need to drop the&n;&t;&t;   extra reference we gave to the task-specific&n;&t;&t;   driver */
r_if
c_cond
(paren
id|module
)paren
(brace
id|__MOD_DEC_USE_COUNT
c_func
(paren
id|module
)paren
suffix:semicolon
)brace
multiline_comment|/* point the file&squot;s f_ops back to ieee1394. The VFS will then&n;&t;&t;   decrement ieee1394&squot;s reference count immediately after this&n;&t;&t;   function returns. */
id|file-&gt;f_op
op_assign
op_amp
id|ieee1394_chardev_ops
suffix:semicolon
)brace
r_return
id|retval
suffix:semicolon
)brace
DECL|variable|ieee1394_procfs_entry
r_struct
id|proc_dir_entry
op_star
id|ieee1394_procfs_entry
suffix:semicolon
DECL|function|ieee1394_init
r_static
r_int
id|__init
id|ieee1394_init
c_func
(paren
r_void
)paren
(brace
id|hpsb_packet_cache
op_assign
id|kmem_cache_create
c_func
(paren
l_string|&quot;hpsb_packet&quot;
comma
r_sizeof
(paren
r_struct
id|hpsb_packet
)paren
comma
l_int|0
comma
l_int|0
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|ieee1394_devfs_handle
op_assign
id|devfs_mk_dir
c_func
(paren
l_int|NULL
comma
l_string|&quot;ieee1394&quot;
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|register_chrdev
c_func
(paren
id|IEEE1394_MAJOR
comma
l_string|&quot;ieee1394&quot;
comma
op_amp
id|ieee1394_chardev_ops
)paren
)paren
(brace
id|HPSB_ERR
c_func
(paren
l_string|&quot;unable to register character device major %d!&bslash;n&quot;
comma
id|IEEE1394_MAJOR
)paren
suffix:semicolon
id|devfs_unregister
c_func
(paren
id|ieee1394_devfs_handle
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_PROC_FS
multiline_comment|/* Must be done before we start everything else, since the drivers&n;&t; * may use it.  */
id|ieee1394_procfs_entry
op_assign
id|proc_mkdir
c_func
(paren
l_string|&quot;ieee1394&quot;
comma
id|proc_bus
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ieee1394_procfs_entry
op_eq
l_int|NULL
)paren
(brace
id|HPSB_ERR
c_func
(paren
l_string|&quot;unable to create /proc/bus/ieee1394&bslash;n&quot;
)paren
suffix:semicolon
id|unregister_chrdev
c_func
(paren
id|IEEE1394_MAJOR
comma
l_string|&quot;ieee1394&quot;
)paren
suffix:semicolon
id|devfs_unregister
c_func
(paren
id|ieee1394_devfs_handle
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|ieee1394_procfs_entry-&gt;owner
op_assign
id|THIS_MODULE
suffix:semicolon
macro_line|#endif
id|init_hpsb_highlevel
c_func
(paren
)paren
suffix:semicolon
id|init_csr
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|disable_nodemgr
)paren
id|init_ieee1394_nodemgr
c_func
(paren
id|disable_hotplug
)paren
suffix:semicolon
r_else
id|HPSB_INFO
c_func
(paren
l_string|&quot;nodemgr functionality disabled&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|ieee1394_cleanup
r_static
r_void
id|__exit
id|ieee1394_cleanup
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|disable_nodemgr
)paren
id|cleanup_ieee1394_nodemgr
c_func
(paren
)paren
suffix:semicolon
id|cleanup_csr
c_func
(paren
)paren
suffix:semicolon
id|kmem_cache_destroy
c_func
(paren
id|hpsb_packet_cache
)paren
suffix:semicolon
id|unregister_chrdev
c_func
(paren
id|IEEE1394_MAJOR
comma
l_string|&quot;ieee1394&quot;
)paren
suffix:semicolon
multiline_comment|/* it&squot;s ok to pass a NULL devfs_handle to devfs_unregister */
id|devfs_unregister
c_func
(paren
id|ieee1394_devfs_handle
)paren
suffix:semicolon
id|remove_proc_entry
c_func
(paren
l_string|&quot;ieee1394&quot;
comma
id|proc_bus
)paren
suffix:semicolon
)brace
DECL|variable|ieee1394_init
id|module_init
c_func
(paren
id|ieee1394_init
)paren
suffix:semicolon
DECL|variable|ieee1394_cleanup
id|module_exit
c_func
(paren
id|ieee1394_cleanup
)paren
suffix:semicolon
multiline_comment|/* Exported symbols */
DECL|variable|hpsb_alloc_host
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_alloc_host
)paren
suffix:semicolon
DECL|variable|hpsb_add_host
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_add_host
)paren
suffix:semicolon
DECL|variable|hpsb_remove_host
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_remove_host
)paren
suffix:semicolon
DECL|variable|hpsb_ref_host
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_ref_host
)paren
suffix:semicolon
DECL|variable|hpsb_unref_host
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_unref_host
)paren
suffix:semicolon
DECL|variable|hpsb_speedto_str
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_speedto_str
)paren
suffix:semicolon
DECL|variable|hpsb_add_packet_complete_task
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_add_packet_complete_task
)paren
suffix:semicolon
DECL|variable|alloc_hpsb_packet
id|EXPORT_SYMBOL
c_func
(paren
id|alloc_hpsb_packet
)paren
suffix:semicolon
DECL|variable|free_hpsb_packet
id|EXPORT_SYMBOL
c_func
(paren
id|free_hpsb_packet
)paren
suffix:semicolon
DECL|variable|hpsb_send_packet
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_send_packet
)paren
suffix:semicolon
DECL|variable|hpsb_reset_bus
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_reset_bus
)paren
suffix:semicolon
DECL|variable|hpsb_bus_reset
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_bus_reset
)paren
suffix:semicolon
DECL|variable|hpsb_selfid_received
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_selfid_received
)paren
suffix:semicolon
DECL|variable|hpsb_selfid_complete
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_selfid_complete
)paren
suffix:semicolon
DECL|variable|hpsb_packet_sent
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_packet_sent
)paren
suffix:semicolon
DECL|variable|hpsb_packet_received
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_packet_received
)paren
suffix:semicolon
DECL|variable|get_tlabel
id|EXPORT_SYMBOL
c_func
(paren
id|get_tlabel
)paren
suffix:semicolon
DECL|variable|free_tlabel
id|EXPORT_SYMBOL
c_func
(paren
id|free_tlabel
)paren
suffix:semicolon
DECL|variable|fill_async_readquad
id|EXPORT_SYMBOL
c_func
(paren
id|fill_async_readquad
)paren
suffix:semicolon
DECL|variable|fill_async_readquad_resp
id|EXPORT_SYMBOL
c_func
(paren
id|fill_async_readquad_resp
)paren
suffix:semicolon
DECL|variable|fill_async_readblock
id|EXPORT_SYMBOL
c_func
(paren
id|fill_async_readblock
)paren
suffix:semicolon
DECL|variable|fill_async_readblock_resp
id|EXPORT_SYMBOL
c_func
(paren
id|fill_async_readblock_resp
)paren
suffix:semicolon
DECL|variable|fill_async_writequad
id|EXPORT_SYMBOL
c_func
(paren
id|fill_async_writequad
)paren
suffix:semicolon
DECL|variable|fill_async_writeblock
id|EXPORT_SYMBOL
c_func
(paren
id|fill_async_writeblock
)paren
suffix:semicolon
DECL|variable|fill_async_write_resp
id|EXPORT_SYMBOL
c_func
(paren
id|fill_async_write_resp
)paren
suffix:semicolon
DECL|variable|fill_async_lock
id|EXPORT_SYMBOL
c_func
(paren
id|fill_async_lock
)paren
suffix:semicolon
DECL|variable|fill_async_lock_resp
id|EXPORT_SYMBOL
c_func
(paren
id|fill_async_lock_resp
)paren
suffix:semicolon
DECL|variable|fill_iso_packet
id|EXPORT_SYMBOL
c_func
(paren
id|fill_iso_packet
)paren
suffix:semicolon
DECL|variable|fill_phy_packet
id|EXPORT_SYMBOL
c_func
(paren
id|fill_phy_packet
)paren
suffix:semicolon
DECL|variable|hpsb_make_readqpacket
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_make_readqpacket
)paren
suffix:semicolon
DECL|variable|hpsb_make_readbpacket
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_make_readbpacket
)paren
suffix:semicolon
DECL|variable|hpsb_make_writeqpacket
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_make_writeqpacket
)paren
suffix:semicolon
DECL|variable|hpsb_make_writebpacket
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_make_writebpacket
)paren
suffix:semicolon
DECL|variable|hpsb_make_lockpacket
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_make_lockpacket
)paren
suffix:semicolon
DECL|variable|hpsb_make_phypacket
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_make_phypacket
)paren
suffix:semicolon
DECL|variable|hpsb_packet_success
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_packet_success
)paren
suffix:semicolon
DECL|variable|hpsb_make_packet
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_make_packet
)paren
suffix:semicolon
DECL|variable|hpsb_read
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_read
)paren
suffix:semicolon
DECL|variable|hpsb_write
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_write
)paren
suffix:semicolon
DECL|variable|hpsb_lock
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_lock
)paren
suffix:semicolon
DECL|variable|hpsb_register_highlevel
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_register_highlevel
)paren
suffix:semicolon
DECL|variable|hpsb_unregister_highlevel
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_unregister_highlevel
)paren
suffix:semicolon
DECL|variable|hpsb_register_addrspace
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_register_addrspace
)paren
suffix:semicolon
DECL|variable|hpsb_listen_channel
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_listen_channel
)paren
suffix:semicolon
DECL|variable|hpsb_unlisten_channel
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_unlisten_channel
)paren
suffix:semicolon
DECL|variable|highlevel_read
id|EXPORT_SYMBOL
c_func
(paren
id|highlevel_read
)paren
suffix:semicolon
DECL|variable|highlevel_write
id|EXPORT_SYMBOL
c_func
(paren
id|highlevel_write
)paren
suffix:semicolon
DECL|variable|highlevel_lock
id|EXPORT_SYMBOL
c_func
(paren
id|highlevel_lock
)paren
suffix:semicolon
DECL|variable|highlevel_lock64
id|EXPORT_SYMBOL
c_func
(paren
id|highlevel_lock64
)paren
suffix:semicolon
DECL|variable|highlevel_add_host
id|EXPORT_SYMBOL
c_func
(paren
id|highlevel_add_host
)paren
suffix:semicolon
DECL|variable|highlevel_remove_host
id|EXPORT_SYMBOL
c_func
(paren
id|highlevel_remove_host
)paren
suffix:semicolon
DECL|variable|highlevel_host_reset
id|EXPORT_SYMBOL
c_func
(paren
id|highlevel_host_reset
)paren
suffix:semicolon
DECL|variable|hpsb_guid_get_entry
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_guid_get_entry
)paren
suffix:semicolon
DECL|variable|hpsb_nodeid_get_entry
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_nodeid_get_entry
)paren
suffix:semicolon
DECL|variable|hpsb_node_fill_packet
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_node_fill_packet
)paren
suffix:semicolon
DECL|variable|hpsb_node_read
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_node_read
)paren
suffix:semicolon
DECL|variable|hpsb_node_write
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_node_write
)paren
suffix:semicolon
DECL|variable|hpsb_node_lock
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_node_lock
)paren
suffix:semicolon
DECL|variable|hpsb_register_protocol
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_register_protocol
)paren
suffix:semicolon
DECL|variable|hpsb_unregister_protocol
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_unregister_protocol
)paren
suffix:semicolon
DECL|variable|hpsb_release_unit_directory
id|EXPORT_SYMBOL
c_func
(paren
id|hpsb_release_unit_directory
)paren
suffix:semicolon
DECL|variable|ieee1394_register_chardev
id|EXPORT_SYMBOL
c_func
(paren
id|ieee1394_register_chardev
)paren
suffix:semicolon
DECL|variable|ieee1394_unregister_chardev
id|EXPORT_SYMBOL
c_func
(paren
id|ieee1394_unregister_chardev
)paren
suffix:semicolon
DECL|variable|ieee1394_devfs_handle
id|EXPORT_SYMBOL
c_func
(paren
id|ieee1394_devfs_handle
)paren
suffix:semicolon
DECL|variable|ieee1394_procfs_entry
id|EXPORT_SYMBOL
c_func
(paren
id|ieee1394_procfs_entry
)paren
suffix:semicolon
eof
