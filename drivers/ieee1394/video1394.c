multiline_comment|/*&n; * video1394.c - video driver for OHCI 1394 boards&n; * Copyright (C)1999,2000 Sebastien Rougeaux &lt;sebastien.rougeaux@anu.edu.au&gt;&n; *                        Peter Schlaile &lt;udbz@rz.uni-karlsruhe.de&gt;&n; *&n; * This program is free software; you can redistribute it and/or modify&n; * it under the terms of the GNU General Public License as published by&n; * the Free Software Foundation; either version 2 of the License, or&n; * (at your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful,&n; * but WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the&n; * GNU General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software Foundation,&n; * Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.&n; */
multiline_comment|/* jds -- add private data to file to keep track of iso contexts associated&n;   with each open -- so release won&squot;t kill all iso transfers */
multiline_comment|/* Damien Douxchamps: Fix failure when the number of DMA pages per frame is&n;   one */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/list.h&gt;
macro_line|#include &lt;linux/slab.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;linux/wait.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/fs.h&gt;
macro_line|#include &lt;linux/poll.h&gt;
macro_line|#include &lt;linux/smp_lock.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/devfs_fs_kernel.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/timex.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/ioctl32.h&gt;
macro_line|#include &lt;linux/compat.h&gt;
macro_line|#include &lt;linux/cdev.h&gt;
macro_line|#include &quot;ieee1394.h&quot;
macro_line|#include &quot;ieee1394_types.h&quot;
macro_line|#include &quot;hosts.h&quot;
macro_line|#include &quot;ieee1394_core.h&quot;
macro_line|#include &quot;highlevel.h&quot;
macro_line|#include &quot;video1394.h&quot;
macro_line|#include &quot;nodemgr.h&quot;
macro_line|#include &quot;dma.h&quot;
macro_line|#include &quot;ohci1394.h&quot;
DECL|macro|ISO_CHANNELS
mdefine_line|#define ISO_CHANNELS 64
macro_line|#ifndef virt_to_page
DECL|macro|virt_to_page
mdefine_line|#define virt_to_page(x) MAP_NR(x)
macro_line|#endif
macro_line|#ifndef vmalloc_32
DECL|macro|vmalloc_32
mdefine_line|#define vmalloc_32(x) vmalloc(x)
macro_line|#endif
DECL|struct|it_dma_prg
r_struct
id|it_dma_prg
(brace
DECL|member|begin
r_struct
id|dma_cmd
id|begin
suffix:semicolon
DECL|member|data
id|quadlet_t
id|data
(braket
l_int|4
)braket
suffix:semicolon
DECL|member|end
r_struct
id|dma_cmd
id|end
suffix:semicolon
DECL|member|pad
id|quadlet_t
id|pad
(braket
l_int|4
)braket
suffix:semicolon
multiline_comment|/* FIXME: quick hack for memory alignment */
)brace
suffix:semicolon
DECL|struct|dma_iso_ctx
r_struct
id|dma_iso_ctx
(brace
DECL|member|ohci
r_struct
id|ti_ohci
op_star
id|ohci
suffix:semicolon
DECL|member|type
r_int
id|type
suffix:semicolon
multiline_comment|/* OHCI_ISO_TRANSMIT or OHCI_ISO_RECEIVE */
DECL|member|iso_tasklet
r_struct
id|ohci1394_iso_tasklet
id|iso_tasklet
suffix:semicolon
DECL|member|channel
r_int
id|channel
suffix:semicolon
DECL|member|ctx
r_int
id|ctx
suffix:semicolon
DECL|member|last_buffer
r_int
id|last_buffer
suffix:semicolon
DECL|member|next_buffer
r_int
op_star
id|next_buffer
suffix:semicolon
multiline_comment|/* For ISO Transmit of video packets&n;&t;&t;&t;       to write the correct SYT field&n;&t;&t;&t;       into the next block */
DECL|member|num_desc
r_int
r_int
id|num_desc
suffix:semicolon
DECL|member|buf_size
r_int
r_int
id|buf_size
suffix:semicolon
DECL|member|frame_size
r_int
r_int
id|frame_size
suffix:semicolon
DECL|member|packet_size
r_int
r_int
id|packet_size
suffix:semicolon
DECL|member|left_size
r_int
r_int
id|left_size
suffix:semicolon
DECL|member|nb_cmd
r_int
r_int
id|nb_cmd
suffix:semicolon
DECL|member|dma
r_struct
id|dma_region
id|dma
suffix:semicolon
DECL|member|prg_reg
r_struct
id|dma_prog_region
op_star
id|prg_reg
suffix:semicolon
DECL|member|ir_prg
r_struct
id|dma_cmd
op_star
op_star
id|ir_prg
suffix:semicolon
DECL|member|it_prg
r_struct
id|it_dma_prg
op_star
op_star
id|it_prg
suffix:semicolon
DECL|member|buffer_status
r_int
r_int
op_star
id|buffer_status
suffix:semicolon
DECL|member|buffer_time
r_struct
id|timeval
op_star
id|buffer_time
suffix:semicolon
multiline_comment|/* time when the buffer was received */
DECL|member|last_used_cmd
r_int
r_int
op_star
id|last_used_cmd
suffix:semicolon
multiline_comment|/* For ISO Transmit with&n;&t;&t;&t;&t;&t;variable sized packets only ! */
DECL|member|ctrlClear
r_int
id|ctrlClear
suffix:semicolon
DECL|member|ctrlSet
r_int
id|ctrlSet
suffix:semicolon
DECL|member|cmdPtr
r_int
id|cmdPtr
suffix:semicolon
DECL|member|ctxMatch
r_int
id|ctxMatch
suffix:semicolon
DECL|member|waitq
id|wait_queue_head_t
id|waitq
suffix:semicolon
DECL|member|lock
id|spinlock_t
id|lock
suffix:semicolon
DECL|member|syt_offset
r_int
r_int
id|syt_offset
suffix:semicolon
DECL|member|flags
r_int
id|flags
suffix:semicolon
DECL|member|link
r_struct
id|list_head
id|link
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|file_ctx
r_struct
id|file_ctx
(brace
DECL|member|ohci
r_struct
id|ti_ohci
op_star
id|ohci
suffix:semicolon
DECL|member|context_list
r_struct
id|list_head
id|context_list
suffix:semicolon
DECL|member|current_ctx
r_struct
id|dma_iso_ctx
op_star
id|current_ctx
suffix:semicolon
)brace
suffix:semicolon
macro_line|#ifdef CONFIG_IEEE1394_VERBOSEDEBUG
DECL|macro|VIDEO1394_DEBUG
mdefine_line|#define VIDEO1394_DEBUG
macro_line|#endif
macro_line|#ifdef DBGMSG
DECL|macro|DBGMSG
macro_line|#undef DBGMSG
macro_line|#endif
macro_line|#ifdef VIDEO1394_DEBUG
DECL|macro|DBGMSG
mdefine_line|#define DBGMSG(card, fmt, args...) &bslash;&n;printk(KERN_INFO &quot;video1394_%d: &quot; fmt &quot;&bslash;n&quot; , card , ## args)
macro_line|#else
DECL|macro|DBGMSG
mdefine_line|#define DBGMSG(card, fmt, args...)
macro_line|#endif
multiline_comment|/* print general (card independent) information */
DECL|macro|PRINT_G
mdefine_line|#define PRINT_G(level, fmt, args...) &bslash;&n;printk(level &quot;video1394: &quot; fmt &quot;&bslash;n&quot; , ## args)
multiline_comment|/* print card specific information */
DECL|macro|PRINT
mdefine_line|#define PRINT(level, card, fmt, args...) &bslash;&n;printk(level &quot;video1394_%d: &quot; fmt &quot;&bslash;n&quot; , card , ## args)
r_void
id|wakeup_dma_ir_ctx
c_func
(paren
r_int
r_int
id|l
)paren
suffix:semicolon
r_void
id|wakeup_dma_it_ctx
c_func
(paren
r_int
r_int
id|l
)paren
suffix:semicolon
DECL|variable|video1394_highlevel
r_static
r_struct
id|hpsb_highlevel
id|video1394_highlevel
suffix:semicolon
DECL|function|free_dma_iso_ctx
r_static
r_int
id|free_dma_iso_ctx
c_func
(paren
r_struct
id|dma_iso_ctx
op_star
id|d
)paren
(brace
r_int
id|i
suffix:semicolon
id|DBGMSG
c_func
(paren
id|d-&gt;ohci-&gt;host-&gt;id
comma
l_string|&quot;Freeing dma_iso_ctx %d&quot;
comma
id|d-&gt;ctx
)paren
suffix:semicolon
id|ohci1394_stop_context
c_func
(paren
id|d-&gt;ohci
comma
id|d-&gt;ctrlClear
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;iso_tasklet.link.next
op_ne
l_int|NULL
)paren
id|ohci1394_unregister_iso_tasklet
c_func
(paren
id|d-&gt;ohci
comma
op_amp
id|d-&gt;iso_tasklet
)paren
suffix:semicolon
id|dma_region_free
c_func
(paren
op_amp
id|d-&gt;dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;prg_reg
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|d-&gt;num_desc
suffix:semicolon
id|i
op_increment
)paren
id|dma_prog_region_free
c_func
(paren
op_amp
id|d-&gt;prg_reg
(braket
id|i
)braket
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d-&gt;prg_reg
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|d-&gt;ir_prg
)paren
id|kfree
c_func
(paren
id|d-&gt;ir_prg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;it_prg
)paren
id|kfree
c_func
(paren
id|d-&gt;it_prg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;buffer_status
)paren
id|kfree
c_func
(paren
id|d-&gt;buffer_status
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;buffer_time
)paren
id|kfree
c_func
(paren
id|d-&gt;buffer_time
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;last_used_cmd
)paren
id|kfree
c_func
(paren
id|d-&gt;last_used_cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;next_buffer
)paren
id|kfree
c_func
(paren
id|d-&gt;next_buffer
)paren
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|d-&gt;link
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|d
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_struct
id|dma_iso_ctx
op_star
DECL|function|alloc_dma_iso_ctx
id|alloc_dma_iso_ctx
c_func
(paren
r_struct
id|ti_ohci
op_star
id|ohci
comma
r_int
id|type
comma
r_int
id|num_desc
comma
r_int
id|buf_size
comma
r_int
id|channel
comma
r_int
r_int
id|packet_size
)paren
(brace
r_struct
id|dma_iso_ctx
op_star
id|d
suffix:semicolon
r_int
id|i
suffix:semicolon
id|d
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|dma_iso_ctx
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d
op_eq
l_int|NULL
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Failed to allocate dma_iso_ctx&quot;
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|d
comma
l_int|0
comma
r_sizeof
op_star
id|d
)paren
suffix:semicolon
id|d-&gt;ohci
op_assign
id|ohci
suffix:semicolon
id|d-&gt;type
op_assign
id|type
suffix:semicolon
id|d-&gt;channel
op_assign
id|channel
suffix:semicolon
id|d-&gt;num_desc
op_assign
id|num_desc
suffix:semicolon
id|d-&gt;frame_size
op_assign
id|buf_size
suffix:semicolon
id|d-&gt;buf_size
op_assign
id|PAGE_ALIGN
c_func
(paren
id|buf_size
)paren
suffix:semicolon
id|d-&gt;last_buffer
op_assign
op_minus
l_int|1
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|d-&gt;link
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|d-&gt;waitq
)paren
suffix:semicolon
multiline_comment|/* Init the regions for easy cleanup */
id|dma_region_init
c_func
(paren
op_amp
id|d-&gt;dma
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dma_region_alloc
c_func
(paren
op_amp
id|d-&gt;dma
comma
id|d-&gt;num_desc
op_star
id|d-&gt;buf_size
comma
id|ohci-&gt;dev
comma
id|PCI_DMA_BIDIRECTIONAL
)paren
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Failed to allocate dma buffer&quot;
)paren
suffix:semicolon
id|free_dma_iso_ctx
c_func
(paren
id|d
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|type
op_eq
id|OHCI_ISO_RECEIVE
)paren
id|ohci1394_init_iso_tasklet
c_func
(paren
op_amp
id|d-&gt;iso_tasklet
comma
id|type
comma
id|wakeup_dma_ir_ctx
comma
(paren
r_int
r_int
)paren
id|d
)paren
suffix:semicolon
r_else
id|ohci1394_init_iso_tasklet
c_func
(paren
op_amp
id|d-&gt;iso_tasklet
comma
id|type
comma
id|wakeup_dma_it_ctx
comma
(paren
r_int
r_int
)paren
id|d
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ohci1394_register_iso_tasklet
c_func
(paren
id|ohci
comma
op_amp
id|d-&gt;iso_tasklet
)paren
OL
l_int|0
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;no free iso %s contexts&quot;
comma
id|type
op_eq
id|OHCI_ISO_RECEIVE
ques
c_cond
l_string|&quot;receive&quot;
suffix:colon
l_string|&quot;transmit&quot;
)paren
suffix:semicolon
id|free_dma_iso_ctx
c_func
(paren
id|d
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|d-&gt;ctx
op_assign
id|d-&gt;iso_tasklet.context
suffix:semicolon
id|d-&gt;prg_reg
op_assign
id|kmalloc
c_func
(paren
id|d-&gt;num_desc
op_star
r_sizeof
(paren
r_struct
id|dma_prog_region
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;prg_reg
op_eq
l_int|NULL
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Failed to allocate ir prg regs&quot;
)paren
suffix:semicolon
id|free_dma_iso_ctx
c_func
(paren
id|d
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
multiline_comment|/* Makes for easier cleanup */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|d-&gt;num_desc
suffix:semicolon
id|i
op_increment
)paren
id|dma_prog_region_init
c_func
(paren
op_amp
id|d-&gt;prg_reg
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|type
op_eq
id|OHCI_ISO_RECEIVE
)paren
(brace
id|d-&gt;ctrlSet
op_assign
id|OHCI1394_IsoRcvContextControlSet
op_plus
l_int|32
op_star
id|d-&gt;ctx
suffix:semicolon
id|d-&gt;ctrlClear
op_assign
id|OHCI1394_IsoRcvContextControlClear
op_plus
l_int|32
op_star
id|d-&gt;ctx
suffix:semicolon
id|d-&gt;cmdPtr
op_assign
id|OHCI1394_IsoRcvCommandPtr
op_plus
l_int|32
op_star
id|d-&gt;ctx
suffix:semicolon
id|d-&gt;ctxMatch
op_assign
id|OHCI1394_IsoRcvContextMatch
op_plus
l_int|32
op_star
id|d-&gt;ctx
suffix:semicolon
id|d-&gt;ir_prg
op_assign
id|kmalloc
c_func
(paren
id|d-&gt;num_desc
op_star
r_sizeof
(paren
r_struct
id|dma_cmd
op_star
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;ir_prg
op_eq
l_int|NULL
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Failed to allocate dma ir prg&quot;
)paren
suffix:semicolon
id|free_dma_iso_ctx
c_func
(paren
id|d
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|d-&gt;ir_prg
comma
l_int|0
comma
id|d-&gt;num_desc
op_star
r_sizeof
(paren
r_struct
id|dma_cmd
op_star
)paren
)paren
suffix:semicolon
id|d-&gt;nb_cmd
op_assign
id|d-&gt;buf_size
op_div
id|PAGE_SIZE
op_plus
l_int|1
suffix:semicolon
id|d-&gt;left_size
op_assign
(paren
id|d-&gt;frame_size
op_mod
id|PAGE_SIZE
)paren
ques
c_cond
id|d-&gt;frame_size
op_mod
id|PAGE_SIZE
suffix:colon
id|PAGE_SIZE
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|d-&gt;num_desc
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dma_prog_region_alloc
c_func
(paren
op_amp
id|d-&gt;prg_reg
(braket
id|i
)braket
comma
id|d-&gt;nb_cmd
op_star
r_sizeof
(paren
r_struct
id|dma_cmd
)paren
comma
id|ohci-&gt;dev
)paren
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Failed to allocate dma ir prg&quot;
)paren
suffix:semicolon
id|free_dma_iso_ctx
c_func
(paren
id|d
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|d-&gt;ir_prg
(braket
id|i
)braket
op_assign
(paren
r_struct
id|dma_cmd
op_star
)paren
id|d-&gt;prg_reg
(braket
id|i
)braket
dot
id|kvirt
suffix:semicolon
)brace
)brace
r_else
(brace
multiline_comment|/* OHCI_ISO_TRANSMIT */
id|d-&gt;ctrlSet
op_assign
id|OHCI1394_IsoXmitContextControlSet
op_plus
l_int|16
op_star
id|d-&gt;ctx
suffix:semicolon
id|d-&gt;ctrlClear
op_assign
id|OHCI1394_IsoXmitContextControlClear
op_plus
l_int|16
op_star
id|d-&gt;ctx
suffix:semicolon
id|d-&gt;cmdPtr
op_assign
id|OHCI1394_IsoXmitCommandPtr
op_plus
l_int|16
op_star
id|d-&gt;ctx
suffix:semicolon
id|d-&gt;it_prg
op_assign
id|kmalloc
c_func
(paren
id|d-&gt;num_desc
op_star
r_sizeof
(paren
r_struct
id|it_dma_prg
op_star
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;it_prg
op_eq
l_int|NULL
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Failed to allocate dma it prg&quot;
)paren
suffix:semicolon
id|free_dma_iso_ctx
c_func
(paren
id|d
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|d-&gt;it_prg
comma
l_int|0
comma
id|d-&gt;num_desc
op_star
r_sizeof
(paren
r_struct
id|it_dma_prg
op_star
)paren
)paren
suffix:semicolon
id|d-&gt;packet_size
op_assign
id|packet_size
suffix:semicolon
r_if
c_cond
(paren
id|PAGE_SIZE
op_mod
id|packet_size
op_logical_or
id|packet_size
OG
l_int|4096
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Packet size %d (page_size: %ld) &quot;
l_string|&quot;not yet supported&bslash;n&quot;
comma
id|packet_size
comma
id|PAGE_SIZE
)paren
suffix:semicolon
id|free_dma_iso_ctx
c_func
(paren
id|d
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|d-&gt;nb_cmd
op_assign
id|d-&gt;frame_size
op_div
id|d-&gt;packet_size
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;frame_size
op_mod
id|d-&gt;packet_size
)paren
(brace
id|d-&gt;nb_cmd
op_increment
suffix:semicolon
id|d-&gt;left_size
op_assign
id|d-&gt;frame_size
op_mod
id|d-&gt;packet_size
suffix:semicolon
)brace
r_else
id|d-&gt;left_size
op_assign
id|d-&gt;packet_size
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|d-&gt;num_desc
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|dma_prog_region_alloc
c_func
(paren
op_amp
id|d-&gt;prg_reg
(braket
id|i
)braket
comma
id|d-&gt;nb_cmd
op_star
r_sizeof
(paren
r_struct
id|it_dma_prg
)paren
comma
id|ohci-&gt;dev
)paren
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Failed to allocate dma it prg&quot;
)paren
suffix:semicolon
id|free_dma_iso_ctx
c_func
(paren
id|d
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|d-&gt;it_prg
(braket
id|i
)braket
op_assign
(paren
r_struct
id|it_dma_prg
op_star
)paren
id|d-&gt;prg_reg
(braket
id|i
)braket
dot
id|kvirt
suffix:semicolon
)brace
)brace
id|d-&gt;buffer_status
op_assign
id|kmalloc
c_func
(paren
id|d-&gt;num_desc
op_star
r_sizeof
(paren
r_int
r_int
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|d-&gt;buffer_time
op_assign
id|kmalloc
c_func
(paren
id|d-&gt;num_desc
op_star
r_sizeof
(paren
r_struct
id|timeval
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|d-&gt;last_used_cmd
op_assign
id|kmalloc
c_func
(paren
id|d-&gt;num_desc
op_star
r_sizeof
(paren
r_int
r_int
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
id|d-&gt;next_buffer
op_assign
id|kmalloc
c_func
(paren
id|d-&gt;num_desc
op_star
r_sizeof
(paren
r_int
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;buffer_status
op_eq
l_int|NULL
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Failed to allocate buffer_status&quot;
)paren
suffix:semicolon
id|free_dma_iso_ctx
c_func
(paren
id|d
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|d-&gt;buffer_time
op_eq
l_int|NULL
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Failed to allocate buffer_time&quot;
)paren
suffix:semicolon
id|free_dma_iso_ctx
c_func
(paren
id|d
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|d-&gt;last_used_cmd
op_eq
l_int|NULL
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Failed to allocate last_used_cmd&quot;
)paren
suffix:semicolon
id|free_dma_iso_ctx
c_func
(paren
id|d
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|d-&gt;next_buffer
op_eq
l_int|NULL
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Failed to allocate next_buffer&quot;
)paren
suffix:semicolon
id|free_dma_iso_ctx
c_func
(paren
id|d
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|d-&gt;buffer_status
comma
l_int|0
comma
id|d-&gt;num_desc
op_star
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|d-&gt;buffer_time
comma
l_int|0
comma
id|d-&gt;num_desc
op_star
r_sizeof
(paren
r_struct
id|timeval
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|d-&gt;last_used_cmd
comma
l_int|0
comma
id|d-&gt;num_desc
op_star
r_sizeof
(paren
r_int
r_int
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
id|d-&gt;next_buffer
comma
op_minus
l_int|1
comma
id|d-&gt;num_desc
op_star
r_sizeof
(paren
r_int
)paren
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|d-&gt;lock
)paren
suffix:semicolon
id|PRINT
c_func
(paren
id|KERN_INFO
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Iso %s DMA: %d buffers &quot;
l_string|&quot;of size %d allocated for a frame size %d, each with %d prgs&quot;
comma
(paren
id|type
op_eq
id|OHCI_ISO_RECEIVE
)paren
ques
c_cond
l_string|&quot;receive&quot;
suffix:colon
l_string|&quot;transmit&quot;
comma
id|d-&gt;num_desc
comma
id|d-&gt;buf_size
comma
id|d-&gt;frame_size
comma
id|d-&gt;nb_cmd
)paren
suffix:semicolon
r_return
id|d
suffix:semicolon
)brace
DECL|function|reset_ir_status
r_static
r_void
id|reset_ir_status
c_func
(paren
r_struct
id|dma_iso_ctx
op_star
id|d
comma
r_int
id|n
)paren
(brace
r_int
id|i
suffix:semicolon
id|d-&gt;ir_prg
(braket
id|n
)braket
(braket
l_int|0
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
l_int|4
)paren
suffix:semicolon
id|d-&gt;ir_prg
(braket
id|n
)braket
(braket
l_int|1
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|PAGE_SIZE
op_minus
l_int|4
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|2
suffix:semicolon
id|i
OL
id|d-&gt;nb_cmd
op_minus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
id|d-&gt;ir_prg
(braket
id|n
)braket
(braket
id|i
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|PAGE_SIZE
)paren
suffix:semicolon
id|d-&gt;ir_prg
(braket
id|n
)braket
(braket
id|i
)braket
dot
id|status
op_assign
id|cpu_to_le32
c_func
(paren
id|d-&gt;left_size
)paren
suffix:semicolon
)brace
DECL|function|initialize_dma_ir_prg
r_static
r_void
id|initialize_dma_ir_prg
c_func
(paren
r_struct
id|dma_iso_ctx
op_star
id|d
comma
r_int
id|n
comma
r_int
id|flags
)paren
(brace
r_struct
id|dma_cmd
op_star
id|ir_prg
op_assign
id|d-&gt;ir_prg
(braket
id|n
)braket
suffix:semicolon
r_struct
id|dma_prog_region
op_star
id|ir_reg
op_assign
op_amp
id|d-&gt;prg_reg
(braket
id|n
)braket
suffix:semicolon
r_int
r_int
id|buf
op_assign
(paren
r_int
r_int
)paren
id|d-&gt;dma.kvirt
op_plus
id|n
op_star
id|d-&gt;buf_size
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* the first descriptor will read only 4 bytes */
id|ir_prg
(braket
l_int|0
)braket
dot
id|control
op_assign
id|cpu_to_le32
c_func
(paren
id|DMA_CTL_INPUT_MORE
op_or
id|DMA_CTL_UPDATE
op_or
id|DMA_CTL_BRANCH
op_or
l_int|4
)paren
suffix:semicolon
multiline_comment|/* set the sync flag */
r_if
c_cond
(paren
id|flags
op_amp
id|VIDEO1394_SYNC_FRAMES
)paren
id|ir_prg
(braket
l_int|0
)braket
dot
id|control
op_or_assign
id|cpu_to_le32
c_func
(paren
id|DMA_CTL_WAIT
)paren
suffix:semicolon
id|ir_prg
(braket
l_int|0
)braket
dot
id|address
op_assign
id|cpu_to_le32
c_func
(paren
id|dma_region_offset_to_bus
c_func
(paren
op_amp
id|d-&gt;dma
comma
id|buf
op_minus
(paren
r_int
r_int
)paren
id|d-&gt;dma.kvirt
)paren
)paren
suffix:semicolon
id|ir_prg
(braket
l_int|0
)braket
dot
id|branchAddress
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|dma_prog_region_offset_to_bus
c_func
(paren
id|ir_reg
comma
l_int|1
op_star
r_sizeof
(paren
r_struct
id|dma_cmd
)paren
)paren
op_amp
l_int|0xfffffff0
)paren
op_or
l_int|0x1
)paren
suffix:semicolon
multiline_comment|/* If there is *not* only one DMA page per frame (hence, d-&gt;nb_cmd==2) */
r_if
c_cond
(paren
id|d-&gt;nb_cmd
OG
l_int|2
)paren
(brace
multiline_comment|/* The second descriptor will read PAGE_SIZE-4 bytes */
id|ir_prg
(braket
l_int|1
)braket
dot
id|control
op_assign
id|cpu_to_le32
c_func
(paren
id|DMA_CTL_INPUT_MORE
op_or
id|DMA_CTL_UPDATE
op_or
id|DMA_CTL_BRANCH
op_or
(paren
id|PAGE_SIZE
op_minus
l_int|4
)paren
)paren
suffix:semicolon
id|ir_prg
(braket
l_int|1
)braket
dot
id|address
op_assign
id|cpu_to_le32
c_func
(paren
id|dma_region_offset_to_bus
c_func
(paren
op_amp
id|d-&gt;dma
comma
(paren
id|buf
op_plus
l_int|4
)paren
op_minus
(paren
r_int
r_int
)paren
id|d-&gt;dma.kvirt
)paren
)paren
suffix:semicolon
id|ir_prg
(braket
l_int|1
)braket
dot
id|branchAddress
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|dma_prog_region_offset_to_bus
c_func
(paren
id|ir_reg
comma
l_int|2
op_star
r_sizeof
(paren
r_struct
id|dma_cmd
)paren
)paren
op_amp
l_int|0xfffffff0
)paren
op_or
l_int|0x1
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|2
suffix:semicolon
id|i
OL
id|d-&gt;nb_cmd
op_minus
l_int|1
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ir_prg
(braket
id|i
)braket
dot
id|control
op_assign
id|cpu_to_le32
c_func
(paren
id|DMA_CTL_INPUT_MORE
op_or
id|DMA_CTL_UPDATE
op_or
id|DMA_CTL_BRANCH
op_or
id|PAGE_SIZE
)paren
suffix:semicolon
id|ir_prg
(braket
id|i
)braket
dot
id|address
op_assign
id|cpu_to_le32
c_func
(paren
id|dma_region_offset_to_bus
c_func
(paren
op_amp
id|d-&gt;dma
comma
(paren
id|buf
op_plus
(paren
id|i
op_minus
l_int|1
)paren
op_star
id|PAGE_SIZE
)paren
op_minus
(paren
r_int
r_int
)paren
id|d-&gt;dma.kvirt
)paren
)paren
suffix:semicolon
id|ir_prg
(braket
id|i
)braket
dot
id|branchAddress
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|dma_prog_region_offset_to_bus
c_func
(paren
id|ir_reg
comma
(paren
id|i
op_plus
l_int|1
)paren
op_star
r_sizeof
(paren
r_struct
id|dma_cmd
)paren
)paren
op_amp
l_int|0xfffffff0
)paren
op_or
l_int|0x1
)paren
suffix:semicolon
)brace
multiline_comment|/* The last descriptor will generate an interrupt */
id|ir_prg
(braket
id|i
)braket
dot
id|control
op_assign
id|cpu_to_le32
c_func
(paren
id|DMA_CTL_INPUT_MORE
op_or
id|DMA_CTL_UPDATE
op_or
id|DMA_CTL_IRQ
op_or
id|DMA_CTL_BRANCH
op_or
id|d-&gt;left_size
)paren
suffix:semicolon
id|ir_prg
(braket
id|i
)braket
dot
id|address
op_assign
id|cpu_to_le32
c_func
(paren
id|dma_region_offset_to_bus
c_func
(paren
op_amp
id|d-&gt;dma
comma
(paren
id|buf
op_plus
(paren
id|i
op_minus
l_int|1
)paren
op_star
id|PAGE_SIZE
)paren
op_minus
(paren
r_int
r_int
)paren
id|d-&gt;dma.kvirt
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Only one DMA page is used. Read d-&gt;left_size immediately and */
multiline_comment|/* generate an interrupt as this is also the last page. */
id|ir_prg
(braket
l_int|1
)braket
dot
id|control
op_assign
id|cpu_to_le32
c_func
(paren
id|DMA_CTL_INPUT_MORE
op_or
id|DMA_CTL_UPDATE
op_or
id|DMA_CTL_IRQ
op_or
id|DMA_CTL_BRANCH
op_or
(paren
id|d-&gt;left_size
op_minus
l_int|4
)paren
)paren
suffix:semicolon
id|ir_prg
(braket
l_int|1
)braket
dot
id|address
op_assign
id|cpu_to_le32
c_func
(paren
id|dma_region_offset_to_bus
c_func
(paren
op_amp
id|d-&gt;dma
comma
(paren
id|buf
op_plus
l_int|4
)paren
op_minus
(paren
r_int
r_int
)paren
id|d-&gt;dma.kvirt
)paren
)paren
suffix:semicolon
)brace
)brace
DECL|function|initialize_dma_ir_ctx
r_static
r_void
id|initialize_dma_ir_ctx
c_func
(paren
r_struct
id|dma_iso_ctx
op_star
id|d
comma
r_int
id|tag
comma
r_int
id|flags
)paren
(brace
r_struct
id|ti_ohci
op_star
id|ohci
op_assign
(paren
r_struct
id|ti_ohci
op_star
)paren
id|d-&gt;ohci
suffix:semicolon
r_int
id|i
suffix:semicolon
id|d-&gt;flags
op_assign
id|flags
suffix:semicolon
id|ohci1394_stop_context
c_func
(paren
id|ohci
comma
id|d-&gt;ctrlClear
comma
l_int|NULL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|d-&gt;num_desc
suffix:semicolon
id|i
op_increment
)paren
(brace
id|initialize_dma_ir_prg
c_func
(paren
id|d
comma
id|i
comma
id|flags
)paren
suffix:semicolon
id|reset_ir_status
c_func
(paren
id|d
comma
id|i
)paren
suffix:semicolon
)brace
multiline_comment|/* reset the ctrl register */
id|reg_write
c_func
(paren
id|ohci
comma
id|d-&gt;ctrlClear
comma
l_int|0xf0000000
)paren
suffix:semicolon
multiline_comment|/* Set bufferFill */
id|reg_write
c_func
(paren
id|ohci
comma
id|d-&gt;ctrlSet
comma
l_int|0x80000000
)paren
suffix:semicolon
multiline_comment|/* Set isoch header */
r_if
c_cond
(paren
id|flags
op_amp
id|VIDEO1394_INCLUDE_ISO_HEADERS
)paren
id|reg_write
c_func
(paren
id|ohci
comma
id|d-&gt;ctrlSet
comma
l_int|0x40000000
)paren
suffix:semicolon
multiline_comment|/* Set the context match register to match on all tags,&n;&t;   sync for sync tag, and listen to d-&gt;channel */
id|reg_write
c_func
(paren
id|ohci
comma
id|d-&gt;ctxMatch
comma
l_int|0xf0000000
op_or
(paren
(paren
id|tag
op_amp
l_int|0xf
)paren
op_lshift
l_int|8
)paren
op_or
id|d-&gt;channel
)paren
suffix:semicolon
multiline_comment|/* Set up isoRecvIntMask to generate interrupts */
id|reg_write
c_func
(paren
id|ohci
comma
id|OHCI1394_IsoRecvIntMaskSet
comma
l_int|1
op_lshift
id|d-&gt;ctx
)paren
suffix:semicolon
)brace
multiline_comment|/* find which context is listening to this channel */
r_static
r_struct
id|dma_iso_ctx
op_star
DECL|function|find_ctx
id|find_ctx
c_func
(paren
r_struct
id|list_head
op_star
id|list
comma
r_int
id|type
comma
r_int
id|channel
)paren
(brace
r_struct
id|dma_iso_ctx
op_star
id|ctx
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|ctx
comma
id|list
comma
id|link
)paren
(brace
r_if
c_cond
(paren
id|ctx-&gt;type
op_eq
id|type
op_logical_and
id|ctx-&gt;channel
op_eq
id|channel
)paren
r_return
id|ctx
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|wakeup_dma_ir_ctx
r_void
id|wakeup_dma_ir_ctx
c_func
(paren
r_int
r_int
id|l
)paren
(brace
r_struct
id|dma_iso_ctx
op_star
id|d
op_assign
(paren
r_struct
id|dma_iso_ctx
op_star
)paren
id|l
suffix:semicolon
r_int
id|i
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|d-&gt;lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|d-&gt;num_desc
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|d-&gt;ir_prg
(braket
id|i
)braket
(braket
id|d-&gt;nb_cmd
op_minus
l_int|1
)braket
dot
id|status
op_amp
id|cpu_to_le32
c_func
(paren
l_int|0xFFFF0000
)paren
)paren
(brace
id|reset_ir_status
c_func
(paren
id|d
comma
id|i
)paren
suffix:semicolon
id|d-&gt;buffer_status
(braket
id|i
)braket
op_assign
id|VIDEO1394_BUFFER_READY
suffix:semicolon
id|do_gettimeofday
c_func
(paren
op_amp
id|d-&gt;buffer_time
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
)brace
id|spin_unlock
c_func
(paren
op_amp
id|d-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waitqueue_active
c_func
(paren
op_amp
id|d-&gt;waitq
)paren
)paren
id|wake_up_interruptible
c_func
(paren
op_amp
id|d-&gt;waitq
)paren
suffix:semicolon
)brace
DECL|function|put_timestamp
r_static
r_inline
r_void
id|put_timestamp
c_func
(paren
r_struct
id|ti_ohci
op_star
id|ohci
comma
r_struct
id|dma_iso_ctx
op_star
id|d
comma
r_int
id|n
)paren
(brace
r_int
r_char
op_star
id|buf
op_assign
id|d-&gt;dma.kvirt
op_plus
id|n
op_star
id|d-&gt;buf_size
suffix:semicolon
id|u32
id|cycleTimer
suffix:semicolon
id|u32
id|timeStamp
suffix:semicolon
r_if
c_cond
(paren
id|n
op_eq
op_minus
l_int|1
)paren
(brace
r_return
suffix:semicolon
)brace
id|cycleTimer
op_assign
id|reg_read
c_func
(paren
id|ohci
comma
id|OHCI1394_IsochronousCycleTimer
)paren
suffix:semicolon
id|timeStamp
op_assign
(paren
(paren
id|cycleTimer
op_amp
l_int|0x0fff
)paren
op_plus
id|d-&gt;syt_offset
)paren
suffix:semicolon
multiline_comment|/* 11059 = 450 us */
id|timeStamp
op_assign
(paren
id|timeStamp
op_mod
l_int|3072
op_plus
(paren
(paren
id|timeStamp
op_div
l_int|3072
)paren
op_lshift
l_int|12
)paren
op_plus
(paren
id|cycleTimer
op_amp
l_int|0xf000
)paren
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|buf
(braket
l_int|6
)braket
op_assign
id|timeStamp
op_rshift
l_int|8
suffix:semicolon
id|buf
(braket
l_int|7
)braket
op_assign
id|timeStamp
op_amp
l_int|0xff
suffix:semicolon
multiline_comment|/* if first packet is empty packet, then put timestamp into the next full one too */
r_if
c_cond
(paren
(paren
id|le32_to_cpu
c_func
(paren
id|d-&gt;it_prg
(braket
id|n
)braket
(braket
l_int|0
)braket
dot
id|data
(braket
l_int|1
)braket
)paren
op_rshift
l_int|16
)paren
op_eq
l_int|0x008
)paren
(brace
id|buf
op_add_assign
id|d-&gt;packet_size
suffix:semicolon
id|buf
(braket
l_int|6
)braket
op_assign
id|timeStamp
op_rshift
l_int|8
suffix:semicolon
id|buf
(braket
l_int|7
)braket
op_assign
id|timeStamp
op_amp
l_int|0xff
suffix:semicolon
)brace
multiline_comment|/* do the next buffer frame too in case of irq latency */
id|n
op_assign
id|d-&gt;next_buffer
(braket
id|n
)braket
suffix:semicolon
r_if
c_cond
(paren
id|n
op_eq
op_minus
l_int|1
)paren
(brace
r_return
suffix:semicolon
)brace
id|buf
op_assign
id|d-&gt;dma.kvirt
op_plus
id|n
op_star
id|d-&gt;buf_size
suffix:semicolon
id|timeStamp
op_add_assign
(paren
id|d-&gt;last_used_cmd
(braket
id|n
)braket
op_lshift
l_int|12
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|buf
(braket
l_int|6
)braket
op_assign
id|timeStamp
op_rshift
l_int|8
suffix:semicolon
id|buf
(braket
l_int|7
)braket
op_assign
id|timeStamp
op_amp
l_int|0xff
suffix:semicolon
multiline_comment|/* if first packet is empty packet, then put timestamp into the next full one too */
r_if
c_cond
(paren
(paren
id|le32_to_cpu
c_func
(paren
id|d-&gt;it_prg
(braket
id|n
)braket
(braket
l_int|0
)braket
dot
id|data
(braket
l_int|1
)braket
)paren
op_rshift
l_int|16
)paren
op_eq
l_int|0x008
)paren
(brace
id|buf
op_add_assign
id|d-&gt;packet_size
suffix:semicolon
id|buf
(braket
l_int|6
)braket
op_assign
id|timeStamp
op_rshift
l_int|8
suffix:semicolon
id|buf
(braket
l_int|7
)braket
op_assign
id|timeStamp
op_amp
l_int|0xff
suffix:semicolon
)brace
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;curr: %d, next: %d, cycleTimer: %08x timeStamp: %08x&bslash;n&quot;
comma
id|curr
comma
id|n
comma
id|cycleTimer
comma
id|timeStamp
)paren
suffix:semicolon
macro_line|#endif
)brace
DECL|function|wakeup_dma_it_ctx
r_void
id|wakeup_dma_it_ctx
c_func
(paren
r_int
r_int
id|l
)paren
(brace
r_struct
id|dma_iso_ctx
op_star
id|d
op_assign
(paren
r_struct
id|dma_iso_ctx
op_star
)paren
id|l
suffix:semicolon
r_struct
id|ti_ohci
op_star
id|ohci
op_assign
id|d-&gt;ohci
suffix:semicolon
r_int
id|i
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|d-&gt;lock
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|d-&gt;num_desc
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|d-&gt;it_prg
(braket
id|i
)braket
(braket
id|d-&gt;last_used_cmd
(braket
id|i
)braket
)braket
dot
id|end.status
op_amp
id|cpu_to_le32
c_func
(paren
l_int|0xFFFF0000
)paren
)paren
(brace
r_int
id|next
op_assign
id|d-&gt;next_buffer
(braket
id|i
)braket
suffix:semicolon
id|put_timestamp
c_func
(paren
id|ohci
comma
id|d
comma
id|next
)paren
suffix:semicolon
id|d-&gt;it_prg
(braket
id|i
)braket
(braket
id|d-&gt;last_used_cmd
(braket
id|i
)braket
)braket
dot
id|end.status
op_assign
l_int|0
suffix:semicolon
id|d-&gt;buffer_status
(braket
id|i
)braket
op_assign
id|VIDEO1394_BUFFER_READY
suffix:semicolon
)brace
)brace
id|spin_unlock
c_func
(paren
op_amp
id|d-&gt;lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|waitqueue_active
c_func
(paren
op_amp
id|d-&gt;waitq
)paren
)paren
id|wake_up_interruptible
c_func
(paren
op_amp
id|d-&gt;waitq
)paren
suffix:semicolon
)brace
DECL|function|initialize_dma_it_prg
r_static
r_void
id|initialize_dma_it_prg
c_func
(paren
r_struct
id|dma_iso_ctx
op_star
id|d
comma
r_int
id|n
comma
r_int
id|sync_tag
)paren
(brace
r_struct
id|it_dma_prg
op_star
id|it_prg
op_assign
id|d-&gt;it_prg
(braket
id|n
)braket
suffix:semicolon
r_struct
id|dma_prog_region
op_star
id|it_reg
op_assign
op_amp
id|d-&gt;prg_reg
(braket
id|n
)braket
suffix:semicolon
r_int
r_int
id|buf
op_assign
(paren
r_int
r_int
)paren
id|d-&gt;dma.kvirt
op_plus
id|n
op_star
id|d-&gt;buf_size
suffix:semicolon
r_int
id|i
suffix:semicolon
id|d-&gt;last_used_cmd
(braket
id|n
)braket
op_assign
id|d-&gt;nb_cmd
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|d-&gt;nb_cmd
suffix:semicolon
id|i
op_increment
)paren
(brace
id|it_prg
(braket
id|i
)braket
dot
id|begin.control
op_assign
id|cpu_to_le32
c_func
(paren
id|DMA_CTL_OUTPUT_MORE
op_or
id|DMA_CTL_IMMEDIATE
op_or
l_int|8
)paren
suffix:semicolon
id|it_prg
(braket
id|i
)braket
dot
id|begin.address
op_assign
l_int|0
suffix:semicolon
id|it_prg
(braket
id|i
)braket
dot
id|begin.status
op_assign
l_int|0
suffix:semicolon
id|it_prg
(braket
id|i
)braket
dot
id|data
(braket
l_int|0
)braket
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|IEEE1394_SPEED_100
op_lshift
l_int|16
)paren
op_or
(paren
multiline_comment|/* tag */
l_int|1
op_lshift
l_int|14
)paren
op_or
(paren
id|d-&gt;channel
op_lshift
l_int|8
)paren
op_or
(paren
id|TCODE_ISO_DATA
op_lshift
l_int|4
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
op_eq
l_int|0
)paren
id|it_prg
(braket
id|i
)braket
dot
id|data
(braket
l_int|0
)braket
op_or_assign
id|cpu_to_le32
c_func
(paren
id|sync_tag
)paren
suffix:semicolon
id|it_prg
(braket
id|i
)braket
dot
id|data
(braket
l_int|1
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|d-&gt;packet_size
op_lshift
l_int|16
)paren
suffix:semicolon
id|it_prg
(braket
id|i
)braket
dot
id|data
(braket
l_int|2
)braket
op_assign
l_int|0
suffix:semicolon
id|it_prg
(braket
id|i
)braket
dot
id|data
(braket
l_int|3
)braket
op_assign
l_int|0
suffix:semicolon
id|it_prg
(braket
id|i
)braket
dot
id|end.control
op_assign
id|cpu_to_le32
c_func
(paren
id|DMA_CTL_OUTPUT_LAST
op_or
id|DMA_CTL_BRANCH
)paren
suffix:semicolon
id|it_prg
(braket
id|i
)braket
dot
id|end.address
op_assign
id|cpu_to_le32
c_func
(paren
id|dma_region_offset_to_bus
c_func
(paren
op_amp
id|d-&gt;dma
comma
(paren
id|buf
op_plus
id|i
op_star
id|d-&gt;packet_size
)paren
op_minus
(paren
r_int
r_int
)paren
id|d-&gt;dma.kvirt
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|d-&gt;nb_cmd
op_minus
l_int|1
)paren
(brace
id|it_prg
(braket
id|i
)braket
dot
id|end.control
op_or_assign
id|cpu_to_le32
c_func
(paren
id|d-&gt;packet_size
)paren
suffix:semicolon
id|it_prg
(braket
id|i
)braket
dot
id|begin.branchAddress
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|dma_prog_region_offset_to_bus
c_func
(paren
id|it_reg
comma
(paren
id|i
op_plus
l_int|1
)paren
op_star
r_sizeof
(paren
r_struct
id|it_dma_prg
)paren
)paren
op_amp
l_int|0xfffffff0
)paren
op_or
l_int|0x3
)paren
suffix:semicolon
id|it_prg
(braket
id|i
)braket
dot
id|end.branchAddress
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|dma_prog_region_offset_to_bus
c_func
(paren
id|it_reg
comma
(paren
id|i
op_plus
l_int|1
)paren
op_star
r_sizeof
(paren
r_struct
id|it_dma_prg
)paren
)paren
op_amp
l_int|0xfffffff0
)paren
op_or
l_int|0x3
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* the last prg generates an interrupt */
id|it_prg
(braket
id|i
)braket
dot
id|end.control
op_or_assign
id|cpu_to_le32
c_func
(paren
id|DMA_CTL_UPDATE
op_or
id|DMA_CTL_IRQ
op_or
id|d-&gt;left_size
)paren
suffix:semicolon
multiline_comment|/* the last prg doesn&squot;t branch */
id|it_prg
(braket
id|i
)braket
dot
id|begin.branchAddress
op_assign
l_int|0
suffix:semicolon
id|it_prg
(braket
id|i
)braket
dot
id|end.branchAddress
op_assign
l_int|0
suffix:semicolon
)brace
id|it_prg
(braket
id|i
)braket
dot
id|end.status
op_assign
l_int|0
suffix:semicolon
)brace
)brace
DECL|function|initialize_dma_it_prg_var_packet_queue
r_static
r_void
id|initialize_dma_it_prg_var_packet_queue
c_func
(paren
r_struct
id|dma_iso_ctx
op_star
id|d
comma
r_int
id|n
comma
r_int
r_int
op_star
id|packet_sizes
comma
r_struct
id|ti_ohci
op_star
id|ohci
)paren
(brace
r_struct
id|it_dma_prg
op_star
id|it_prg
op_assign
id|d-&gt;it_prg
(braket
id|n
)braket
suffix:semicolon
r_struct
id|dma_prog_region
op_star
id|it_reg
op_assign
op_amp
id|d-&gt;prg_reg
(braket
id|n
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
macro_line|#if 0
r_if
c_cond
(paren
id|n
op_ne
op_minus
l_int|1
)paren
(brace
id|put_timestamp
c_func
(paren
id|ohci
comma
id|d
comma
id|n
)paren
suffix:semicolon
)brace
macro_line|#endif
id|d-&gt;last_used_cmd
(braket
id|n
)braket
op_assign
id|d-&gt;nb_cmd
op_minus
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|d-&gt;nb_cmd
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|size
suffix:semicolon
r_if
c_cond
(paren
id|packet_sizes
(braket
id|i
)braket
OG
id|d-&gt;packet_size
)paren
(brace
id|size
op_assign
id|d-&gt;packet_size
suffix:semicolon
)brace
r_else
(brace
id|size
op_assign
id|packet_sizes
(braket
id|i
)braket
suffix:semicolon
)brace
id|it_prg
(braket
id|i
)braket
dot
id|data
(braket
l_int|1
)braket
op_assign
id|cpu_to_le32
c_func
(paren
id|size
op_lshift
l_int|16
)paren
suffix:semicolon
id|it_prg
(braket
id|i
)braket
dot
id|end.control
op_assign
id|cpu_to_le32
c_func
(paren
id|DMA_CTL_OUTPUT_LAST
op_or
id|DMA_CTL_BRANCH
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|d-&gt;nb_cmd
op_minus
l_int|1
op_logical_and
id|packet_sizes
(braket
id|i
op_plus
l_int|1
)braket
op_ne
l_int|0
)paren
(brace
id|it_prg
(braket
id|i
)braket
dot
id|end.control
op_or_assign
id|cpu_to_le32
c_func
(paren
id|size
)paren
suffix:semicolon
id|it_prg
(braket
id|i
)braket
dot
id|begin.branchAddress
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|dma_prog_region_offset_to_bus
c_func
(paren
id|it_reg
comma
(paren
id|i
op_plus
l_int|1
)paren
op_star
r_sizeof
(paren
r_struct
id|it_dma_prg
)paren
)paren
op_amp
l_int|0xfffffff0
)paren
op_or
l_int|0x3
)paren
suffix:semicolon
id|it_prg
(braket
id|i
)braket
dot
id|end.branchAddress
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|dma_prog_region_offset_to_bus
c_func
(paren
id|it_reg
comma
(paren
id|i
op_plus
l_int|1
)paren
op_star
r_sizeof
(paren
r_struct
id|it_dma_prg
)paren
)paren
op_amp
l_int|0xfffffff0
)paren
op_or
l_int|0x3
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* the last prg generates an interrupt */
id|it_prg
(braket
id|i
)braket
dot
id|end.control
op_or_assign
id|cpu_to_le32
c_func
(paren
id|DMA_CTL_UPDATE
op_or
id|DMA_CTL_IRQ
op_or
id|size
)paren
suffix:semicolon
multiline_comment|/* the last prg doesn&squot;t branch */
id|it_prg
(braket
id|i
)braket
dot
id|begin.branchAddress
op_assign
l_int|0
suffix:semicolon
id|it_prg
(braket
id|i
)braket
dot
id|end.branchAddress
op_assign
l_int|0
suffix:semicolon
id|d-&gt;last_used_cmd
(braket
id|n
)braket
op_assign
id|i
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
DECL|function|initialize_dma_it_ctx
r_static
r_void
id|initialize_dma_it_ctx
c_func
(paren
r_struct
id|dma_iso_ctx
op_star
id|d
comma
r_int
id|sync_tag
comma
r_int
r_int
id|syt_offset
comma
r_int
id|flags
)paren
(brace
r_struct
id|ti_ohci
op_star
id|ohci
op_assign
(paren
r_struct
id|ti_ohci
op_star
)paren
id|d-&gt;ohci
suffix:semicolon
r_int
id|i
suffix:semicolon
id|d-&gt;flags
op_assign
id|flags
suffix:semicolon
id|d-&gt;syt_offset
op_assign
(paren
id|syt_offset
op_eq
l_int|0
ques
c_cond
l_int|11000
suffix:colon
id|syt_offset
)paren
suffix:semicolon
id|ohci1394_stop_context
c_func
(paren
id|ohci
comma
id|d-&gt;ctrlClear
comma
l_int|NULL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|d-&gt;num_desc
suffix:semicolon
id|i
op_increment
)paren
id|initialize_dma_it_prg
c_func
(paren
id|d
comma
id|i
comma
id|sync_tag
)paren
suffix:semicolon
multiline_comment|/* Set up isoRecvIntMask to generate interrupts */
id|reg_write
c_func
(paren
id|ohci
comma
id|OHCI1394_IsoXmitIntMaskSet
comma
l_int|1
op_lshift
id|d-&gt;ctx
)paren
suffix:semicolon
)brace
DECL|function|__video1394_ioctl
r_static
r_int
id|__video1394_ioctl
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|file_ctx
op_star
id|ctx
op_assign
(paren
r_struct
id|file_ctx
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|ti_ohci
op_star
id|ohci
op_assign
id|ctx-&gt;ohci
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_void
id|__user
op_star
id|argp
op_assign
(paren
r_void
id|__user
op_star
)paren
id|arg
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|VIDEO1394_IOC_LISTEN_CHANNEL
suffix:colon
r_case
id|VIDEO1394_IOC_TALK_CHANNEL
suffix:colon
(brace
r_struct
id|video1394_mmap
id|v
suffix:semicolon
id|u64
id|mask
suffix:semicolon
r_struct
id|dma_iso_ctx
op_star
id|d
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|v
comma
id|argp
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
multiline_comment|/* if channel &lt; 0, find lowest available one */
r_if
c_cond
(paren
id|v.channel
OL
l_int|0
)paren
(brace
id|mask
op_assign
(paren
id|u64
)paren
l_int|0x1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ISO_CHANNELS
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|ohci-&gt;ISO_channel_usage
op_amp
id|mask
)paren
)paren
(brace
id|v.channel
op_assign
id|i
suffix:semicolon
id|PRINT
c_func
(paren
id|KERN_INFO
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Found free channel %d&quot;
comma
id|i
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|mask
op_assign
id|mask
op_lshift
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|v.channel
c_func
(paren
id|ISO_CHANNELS
op_minus
l_int|1
)paren
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Iso channel %d out of bounds&quot;
comma
id|v.channel
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|mask
op_assign
(paren
id|u64
)paren
l_int|0x1
op_lshift
id|v.channel
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;mask: %08X%08X usage: %08X%08X&bslash;n&quot;
comma
(paren
id|u32
)paren
(paren
id|mask
op_rshift
l_int|32
)paren
comma
(paren
id|u32
)paren
(paren
id|mask
op_amp
l_int|0xffffffff
)paren
comma
(paren
id|u32
)paren
(paren
id|ohci-&gt;ISO_channel_usage
op_rshift
l_int|32
)paren
comma
(paren
id|u32
)paren
(paren
id|ohci-&gt;ISO_channel_usage
op_amp
l_int|0xffffffff
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ohci-&gt;ISO_channel_usage
op_amp
id|mask
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Channel %d is already taken&quot;
comma
id|v.channel
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|ohci-&gt;ISO_channel_usage
op_or_assign
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|v.buf_size
op_eq
l_int|0
op_logical_or
id|v.buf_size
OG
id|VIDEO1394_MAX_SIZE
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Invalid %d length buffer requested&quot;
comma
id|v.buf_size
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|v.nb_buffers
op_eq
l_int|0
op_logical_or
id|v.nb_buffers
OG
id|VIDEO1394_MAX_SIZE
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Invalid %d buffers requested&quot;
comma
id|v.nb_buffers
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|v.nb_buffers
op_star
id|v.buf_size
OG
id|VIDEO1394_MAX_SIZE
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;%d buffers of size %d bytes is too big&quot;
comma
id|v.nb_buffers
comma
id|v.buf_size
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmd
op_eq
id|VIDEO1394_IOC_LISTEN_CHANNEL
)paren
(brace
id|d
op_assign
id|alloc_dma_iso_ctx
c_func
(paren
id|ohci
comma
id|OHCI_ISO_RECEIVE
comma
id|v.nb_buffers
comma
id|v.buf_size
comma
id|v.channel
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d
op_eq
l_int|NULL
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Couldn&squot;t allocate ir context&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|initialize_dma_ir_ctx
c_func
(paren
id|d
comma
id|v.sync_tag
comma
id|v.flags
)paren
suffix:semicolon
id|ctx-&gt;current_ctx
op_assign
id|d
suffix:semicolon
id|v.buf_size
op_assign
id|d-&gt;buf_size
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|d-&gt;link
comma
op_amp
id|ctx-&gt;context_list
)paren
suffix:semicolon
id|PRINT
c_func
(paren
id|KERN_INFO
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;iso context %d listen on channel %d&quot;
comma
id|d-&gt;ctx
comma
id|v.channel
)paren
suffix:semicolon
)brace
r_else
(brace
id|d
op_assign
id|alloc_dma_iso_ctx
c_func
(paren
id|ohci
comma
id|OHCI_ISO_TRANSMIT
comma
id|v.nb_buffers
comma
id|v.buf_size
comma
id|v.channel
comma
id|v.packet_size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d
op_eq
l_int|NULL
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Couldn&squot;t allocate it context&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|initialize_dma_it_ctx
c_func
(paren
id|d
comma
id|v.sync_tag
comma
id|v.syt_offset
comma
id|v.flags
)paren
suffix:semicolon
id|ctx-&gt;current_ctx
op_assign
id|d
suffix:semicolon
id|v.buf_size
op_assign
id|d-&gt;buf_size
suffix:semicolon
id|list_add_tail
c_func
(paren
op_amp
id|d-&gt;link
comma
op_amp
id|ctx-&gt;context_list
)paren
suffix:semicolon
id|PRINT
c_func
(paren
id|KERN_INFO
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Iso context %d talk on channel %d&quot;
comma
id|d-&gt;ctx
comma
id|v.channel
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|v
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDEO1394_IOC_UNLISTEN_CHANNEL
suffix:colon
r_case
id|VIDEO1394_IOC_UNTALK_CHANNEL
suffix:colon
(brace
r_int
id|channel
suffix:semicolon
id|u64
id|mask
suffix:semicolon
r_struct
id|dma_iso_ctx
op_star
id|d
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|channel
comma
id|argp
comma
r_sizeof
(paren
r_int
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
id|channel
c_func
(paren
id|ISO_CHANNELS
op_minus
l_int|1
)paren
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Iso channel %d out of bound&quot;
comma
id|channel
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|mask
op_assign
(paren
id|u64
)paren
l_int|0x1
op_lshift
id|channel
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ohci-&gt;ISO_channel_usage
op_amp
id|mask
)paren
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Channel %d is not being used&quot;
comma
id|channel
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
multiline_comment|/* Mark this channel as unused */
id|ohci-&gt;ISO_channel_usage
op_and_assign
op_complement
id|mask
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|VIDEO1394_IOC_UNLISTEN_CHANNEL
)paren
id|d
op_assign
id|find_ctx
c_func
(paren
op_amp
id|ctx-&gt;context_list
comma
id|OHCI_ISO_RECEIVE
comma
id|channel
)paren
suffix:semicolon
r_else
id|d
op_assign
id|find_ctx
c_func
(paren
op_amp
id|ctx-&gt;context_list
comma
id|OHCI_ISO_TRANSMIT
comma
id|channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|PRINT
c_func
(paren
id|KERN_INFO
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Iso context %d &quot;
l_string|&quot;stop talking on channel %d&quot;
comma
id|d-&gt;ctx
comma
id|channel
)paren
suffix:semicolon
id|free_dma_iso_ctx
c_func
(paren
id|d
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDEO1394_IOC_LISTEN_QUEUE_BUFFER
suffix:colon
(brace
r_struct
id|video1394_wait
id|v
suffix:semicolon
r_struct
id|dma_iso_ctx
op_star
id|d
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|v
comma
id|argp
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|d
op_assign
id|find_ctx
c_func
(paren
op_amp
id|ctx-&gt;context_list
comma
id|OHCI_ISO_RECEIVE
comma
id|v.channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|v.buffer
OL
l_int|0
)paren
op_logical_or
(paren
id|v.buffer
OG
id|d-&gt;num_desc
)paren
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Buffer %d out of range&quot;
comma
id|v.buffer
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|d-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;buffer_status
(braket
id|v.buffer
)braket
op_eq
id|VIDEO1394_BUFFER_QUEUED
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Buffer %d is already used&quot;
comma
id|v.buffer
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|d-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
id|d-&gt;buffer_status
(braket
id|v.buffer
)braket
op_assign
id|VIDEO1394_BUFFER_QUEUED
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;last_buffer
op_ge
l_int|0
)paren
id|d-&gt;ir_prg
(braket
id|d-&gt;last_buffer
)braket
(braket
id|d-&gt;nb_cmd
op_minus
l_int|1
)braket
dot
id|branchAddress
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|dma_prog_region_offset_to_bus
c_func
(paren
op_amp
id|d-&gt;prg_reg
(braket
id|v.buffer
)braket
comma
l_int|0
)paren
op_amp
l_int|0xfffffff0
)paren
op_or
l_int|0x1
)paren
suffix:semicolon
id|d-&gt;last_buffer
op_assign
id|v.buffer
suffix:semicolon
id|d-&gt;ir_prg
(braket
id|d-&gt;last_buffer
)braket
(braket
id|d-&gt;nb_cmd
op_minus
l_int|1
)braket
dot
id|branchAddress
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|d-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|reg_read
c_func
(paren
id|ohci
comma
id|d-&gt;ctrlSet
)paren
op_amp
l_int|0x8000
)paren
)paren
(brace
id|DBGMSG
c_func
(paren
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Starting iso DMA ctx=%d&quot;
comma
id|d-&gt;ctx
)paren
suffix:semicolon
multiline_comment|/* Tell the controller where the first program is */
id|reg_write
c_func
(paren
id|ohci
comma
id|d-&gt;cmdPtr
comma
id|dma_prog_region_offset_to_bus
c_func
(paren
op_amp
id|d-&gt;prg_reg
(braket
id|v.buffer
)braket
comma
l_int|0
)paren
op_or
l_int|0x1
)paren
suffix:semicolon
multiline_comment|/* Run IR context */
id|reg_write
c_func
(paren
id|ohci
comma
id|d-&gt;ctrlSet
comma
l_int|0x8000
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Wake up dma context if necessary */
r_if
c_cond
(paren
op_logical_neg
(paren
id|reg_read
c_func
(paren
id|ohci
comma
id|d-&gt;ctrlSet
)paren
op_amp
l_int|0x400
)paren
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_INFO
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Waking up iso dma ctx=%d&quot;
comma
id|d-&gt;ctx
)paren
suffix:semicolon
id|reg_write
c_func
(paren
id|ohci
comma
id|d-&gt;ctrlSet
comma
l_int|0x1000
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDEO1394_IOC_LISTEN_WAIT_BUFFER
suffix:colon
r_case
id|VIDEO1394_IOC_LISTEN_POLL_BUFFER
suffix:colon
(brace
r_struct
id|video1394_wait
id|v
suffix:semicolon
r_struct
id|dma_iso_ctx
op_star
id|d
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|v
comma
id|argp
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|d
op_assign
id|find_ctx
c_func
(paren
op_amp
id|ctx-&gt;context_list
comma
id|OHCI_ISO_RECEIVE
comma
id|v.channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|v.buffer
OL
l_int|0
)paren
op_logical_or
(paren
id|v.buffer
OG
id|d-&gt;num_desc
)paren
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Buffer %d out of range&quot;
comma
id|v.buffer
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
multiline_comment|/*&n;&t;&t; * I change the way it works so that it returns&n;&t;&t; * the last received frame.&n;&t;&t; */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|d-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|d-&gt;buffer_status
(braket
id|v.buffer
)braket
)paren
(brace
r_case
id|VIDEO1394_BUFFER_READY
suffix:colon
id|d-&gt;buffer_status
(braket
id|v.buffer
)braket
op_assign
id|VIDEO1394_BUFFER_FREE
suffix:semicolon
r_break
suffix:semicolon
r_case
id|VIDEO1394_BUFFER_QUEUED
suffix:colon
r_if
c_cond
(paren
id|cmd
op_eq
id|VIDEO1394_IOC_LISTEN_POLL_BUFFER
)paren
(brace
multiline_comment|/* for polling, return error code EINTR */
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|d-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EINTR
suffix:semicolon
)brace
macro_line|#if 1
r_while
c_loop
(paren
id|d-&gt;buffer_status
(braket
id|v.buffer
)braket
op_ne
id|VIDEO1394_BUFFER_READY
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|d-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|interruptible_sleep_on
c_func
(paren
op_amp
id|d-&gt;waitq
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|d-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|d-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EINTR
suffix:semicolon
)brace
)brace
macro_line|#else
r_if
c_cond
(paren
id|wait_event_interruptible
c_func
(paren
id|d-&gt;waitq
comma
id|d-&gt;buffer_status
(braket
id|v.buffer
)braket
op_eq
id|VIDEO1394_BUFFER_READY
)paren
op_eq
op_minus
id|ERESTARTSYS
)paren
r_return
op_minus
id|EINTR
suffix:semicolon
macro_line|#endif
id|d-&gt;buffer_status
(braket
id|v.buffer
)braket
op_assign
id|VIDEO1394_BUFFER_FREE
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Buffer %d is not queued&quot;
comma
id|v.buffer
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|d-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
multiline_comment|/* set time of buffer */
id|v.filltime
op_assign
id|d-&gt;buffer_time
(braket
id|v.buffer
)braket
suffix:semicolon
singleline_comment|//&t;&t;printk(&quot;Buffer %d time %d&bslash;n&quot;, v.buffer, (d-&gt;buffer_time[v.buffer]).tv_usec);
multiline_comment|/*&n;&t;&t; * Look ahead to see how many more buffers have been received&n;&t;&t; */
id|i
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|d-&gt;buffer_status
(braket
(paren
id|v.buffer
op_plus
l_int|1
)paren
op_mod
id|d-&gt;num_desc
)braket
op_eq
id|VIDEO1394_BUFFER_READY
)paren
(brace
id|v.buffer
op_assign
(paren
id|v.buffer
op_plus
l_int|1
)paren
op_mod
id|d-&gt;num_desc
suffix:semicolon
id|i
op_increment
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|d-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|v.buffer
op_assign
id|i
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|v
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDEO1394_IOC_TALK_QUEUE_BUFFER
suffix:colon
(brace
r_struct
id|video1394_wait
id|v
suffix:semicolon
r_int
r_int
op_star
id|psizes
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|dma_iso_ctx
op_star
id|d
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|v
comma
id|argp
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|d
op_assign
id|find_ctx
c_func
(paren
op_amp
id|ctx-&gt;context_list
comma
id|OHCI_ISO_TRANSMIT
comma
id|v.channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|v.buffer
OL
l_int|0
)paren
op_logical_or
(paren
id|v.buffer
OG
id|d-&gt;num_desc
)paren
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Buffer %d out of range&quot;
comma
id|v.buffer
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|d-&gt;flags
op_amp
id|VIDEO1394_VARIABLE_PACKET_SIZE
)paren
(brace
r_int
id|buf_size
op_assign
id|d-&gt;nb_cmd
op_star
r_sizeof
(paren
r_int
r_int
)paren
suffix:semicolon
r_struct
id|video1394_queue_variable
id|__user
op_star
id|p
op_assign
id|argp
suffix:semicolon
r_int
r_int
id|__user
op_star
id|qv
suffix:semicolon
r_if
c_cond
(paren
id|get_user
c_func
(paren
id|qv
comma
op_amp
id|p-&gt;packet_sizes
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|psizes
op_assign
id|kmalloc
c_func
(paren
id|buf_size
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|psizes
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
id|psizes
comma
id|qv
comma
id|buf_size
)paren
)paren
(brace
id|kfree
c_func
(paren
id|psizes
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|d-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;buffer_status
(braket
id|v.buffer
)braket
op_ne
id|VIDEO1394_BUFFER_FREE
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Buffer %d is already used&quot;
comma
id|v.buffer
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|d-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|psizes
)paren
id|kfree
c_func
(paren
id|psizes
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_if
c_cond
(paren
id|d-&gt;flags
op_amp
id|VIDEO1394_VARIABLE_PACKET_SIZE
)paren
(brace
id|initialize_dma_it_prg_var_packet_queue
c_func
(paren
id|d
comma
id|v.buffer
comma
id|psizes
comma
id|ohci
)paren
suffix:semicolon
)brace
id|d-&gt;buffer_status
(braket
id|v.buffer
)braket
op_assign
id|VIDEO1394_BUFFER_QUEUED
suffix:semicolon
r_if
c_cond
(paren
id|d-&gt;last_buffer
op_ge
l_int|0
)paren
(brace
id|d-&gt;it_prg
(braket
id|d-&gt;last_buffer
)braket
(braket
id|d-&gt;last_used_cmd
(braket
id|d-&gt;last_buffer
)braket
)braket
dot
id|end.branchAddress
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|dma_prog_region_offset_to_bus
c_func
(paren
op_amp
id|d-&gt;prg_reg
(braket
id|v.buffer
)braket
comma
l_int|0
)paren
op_amp
l_int|0xfffffff0
)paren
op_or
l_int|0x3
)paren
suffix:semicolon
id|d-&gt;it_prg
(braket
id|d-&gt;last_buffer
)braket
(braket
id|d-&gt;last_used_cmd
(braket
id|d-&gt;last_buffer
)braket
)braket
dot
id|begin.branchAddress
op_assign
id|cpu_to_le32
c_func
(paren
(paren
id|dma_prog_region_offset_to_bus
c_func
(paren
op_amp
id|d-&gt;prg_reg
(braket
id|v.buffer
)braket
comma
l_int|0
)paren
op_amp
l_int|0xfffffff0
)paren
op_or
l_int|0x3
)paren
suffix:semicolon
id|d-&gt;next_buffer
(braket
id|d-&gt;last_buffer
)braket
op_assign
id|v.buffer
suffix:semicolon
)brace
id|d-&gt;last_buffer
op_assign
id|v.buffer
suffix:semicolon
id|d-&gt;next_buffer
(braket
id|d-&gt;last_buffer
)braket
op_assign
op_minus
l_int|1
suffix:semicolon
id|d-&gt;it_prg
(braket
id|d-&gt;last_buffer
)braket
(braket
id|d-&gt;last_used_cmd
(braket
id|d-&gt;last_buffer
)braket
)braket
dot
id|end.branchAddress
op_assign
l_int|0
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|d-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|reg_read
c_func
(paren
id|ohci
comma
id|d-&gt;ctrlSet
)paren
op_amp
l_int|0x8000
)paren
)paren
(brace
id|DBGMSG
c_func
(paren
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Starting iso transmit DMA ctx=%d&quot;
comma
id|d-&gt;ctx
)paren
suffix:semicolon
id|put_timestamp
c_func
(paren
id|ohci
comma
id|d
comma
id|d-&gt;last_buffer
)paren
suffix:semicolon
multiline_comment|/* Tell the controller where the first program is */
id|reg_write
c_func
(paren
id|ohci
comma
id|d-&gt;cmdPtr
comma
id|dma_prog_region_offset_to_bus
c_func
(paren
op_amp
id|d-&gt;prg_reg
(braket
id|v.buffer
)braket
comma
l_int|0
)paren
op_or
l_int|0x3
)paren
suffix:semicolon
multiline_comment|/* Run IT context */
id|reg_write
c_func
(paren
id|ohci
comma
id|d-&gt;ctrlSet
comma
l_int|0x8000
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Wake up dma context if necessary */
r_if
c_cond
(paren
op_logical_neg
(paren
id|reg_read
c_func
(paren
id|ohci
comma
id|d-&gt;ctrlSet
)paren
op_amp
l_int|0x400
)paren
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_INFO
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Waking up iso transmit dma ctx=%d&quot;
comma
id|d-&gt;ctx
)paren
suffix:semicolon
id|put_timestamp
c_func
(paren
id|ohci
comma
id|d
comma
id|d-&gt;last_buffer
)paren
suffix:semicolon
id|reg_write
c_func
(paren
id|ohci
comma
id|d-&gt;ctrlSet
comma
l_int|0x1000
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|psizes
)paren
id|kfree
c_func
(paren
id|psizes
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_case
id|VIDEO1394_IOC_TALK_WAIT_BUFFER
suffix:colon
(brace
r_struct
id|video1394_wait
id|v
suffix:semicolon
r_struct
id|dma_iso_ctx
op_star
id|d
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|v
comma
id|argp
comma
r_sizeof
(paren
id|v
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|d
op_assign
id|find_ctx
c_func
(paren
op_amp
id|ctx-&gt;context_list
comma
id|OHCI_ISO_TRANSMIT
comma
id|v.channel
)paren
suffix:semicolon
r_if
c_cond
(paren
id|d
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_if
c_cond
(paren
(paren
id|v.buffer
OL
l_int|0
)paren
op_logical_or
(paren
id|v.buffer
OG
id|d-&gt;num_desc
)paren
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Buffer %d out of range&quot;
comma
id|v.buffer
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|d-&gt;buffer_status
(braket
id|v.buffer
)braket
)paren
(brace
r_case
id|VIDEO1394_BUFFER_READY
suffix:colon
id|d-&gt;buffer_status
(braket
id|v.buffer
)braket
op_assign
id|VIDEO1394_BUFFER_FREE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_case
id|VIDEO1394_BUFFER_QUEUED
suffix:colon
macro_line|#if 1
r_while
c_loop
(paren
id|d-&gt;buffer_status
(braket
id|v.buffer
)braket
op_ne
id|VIDEO1394_BUFFER_READY
)paren
(brace
id|interruptible_sleep_on
c_func
(paren
op_amp
id|d-&gt;waitq
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signal_pending
c_func
(paren
id|current
)paren
)paren
r_return
op_minus
id|EINTR
suffix:semicolon
)brace
macro_line|#else
r_if
c_cond
(paren
id|wait_event_interruptible
c_func
(paren
id|d-&gt;waitq
comma
id|d-&gt;buffer_status
(braket
id|v.buffer
)braket
op_eq
id|VIDEO1394_BUFFER_READY
)paren
op_eq
op_minus
id|ERESTARTSYS
)paren
r_return
op_minus
id|EINTR
suffix:semicolon
macro_line|#endif
id|d-&gt;buffer_status
(braket
id|v.buffer
)braket
op_assign
id|VIDEO1394_BUFFER_FREE
suffix:semicolon
r_return
l_int|0
suffix:semicolon
r_default
suffix:colon
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Buffer %d is not queued&quot;
comma
id|v.buffer
)paren
suffix:semicolon
r_return
op_minus
id|EFAULT
suffix:semicolon
)brace
)brace
r_default
suffix:colon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
)brace
DECL|function|video1394_ioctl
r_static
r_int
id|video1394_ioctl
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_int
id|err
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|err
op_assign
id|__video1394_ioctl
c_func
(paren
id|file
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; *&t;This maps the vmalloced and reserved buffer to user space.&n; *&n; *  FIXME:&n; *  - PAGE_READONLY should suffice!?&n; *  - remap_pfn_range is kind of inefficient for page by page remapping.&n; *    But e.g. pte_alloc() does not work in modules ... :-(&n; */
DECL|function|video1394_mmap
r_int
id|video1394_mmap
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_struct
id|vm_area_struct
op_star
id|vma
)paren
(brace
r_struct
id|file_ctx
op_star
id|ctx
op_assign
(paren
r_struct
id|file_ctx
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_int
id|res
op_assign
op_minus
id|EINVAL
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctx-&gt;current_ctx
op_eq
l_int|NULL
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ctx-&gt;ohci-&gt;host-&gt;id
comma
l_string|&quot;Current iso context not set&quot;
)paren
suffix:semicolon
)brace
r_else
id|res
op_assign
id|dma_region_mmap
c_func
(paren
op_amp
id|ctx-&gt;current_ctx-&gt;dma
comma
id|file
comma
id|vma
)paren
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|video1394_open
r_static
r_int
id|video1394_open
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_int
id|i
op_assign
id|ieee1394_file_to_instance
c_func
(paren
id|file
)paren
suffix:semicolon
r_struct
id|ti_ohci
op_star
id|ohci
suffix:semicolon
r_struct
id|file_ctx
op_star
id|ctx
suffix:semicolon
id|ohci
op_assign
id|hpsb_get_hostinfo_bykey
c_func
(paren
op_amp
id|video1394_highlevel
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ohci
op_eq
l_int|NULL
)paren
r_return
op_minus
id|EIO
suffix:semicolon
id|ctx
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|file_ctx
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ctx
op_eq
l_int|NULL
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Cannot malloc file_ctx&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|ctx
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|file_ctx
)paren
)paren
suffix:semicolon
id|ctx-&gt;ohci
op_assign
id|ohci
suffix:semicolon
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|ctx-&gt;context_list
)paren
suffix:semicolon
id|ctx-&gt;current_ctx
op_assign
l_int|NULL
suffix:semicolon
id|file-&gt;private_data
op_assign
id|ctx
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|video1394_release
r_static
r_int
id|video1394_release
c_func
(paren
r_struct
id|inode
op_star
id|inode
comma
r_struct
id|file
op_star
id|file
)paren
(brace
r_struct
id|file_ctx
op_star
id|ctx
op_assign
(paren
r_struct
id|file_ctx
op_star
)paren
id|file-&gt;private_data
suffix:semicolon
r_struct
id|ti_ohci
op_star
id|ohci
op_assign
id|ctx-&gt;ohci
suffix:semicolon
r_struct
id|list_head
op_star
id|lh
comma
op_star
id|next
suffix:semicolon
id|u64
id|mask
suffix:semicolon
id|lock_kernel
c_func
(paren
)paren
suffix:semicolon
id|list_for_each_safe
c_func
(paren
id|lh
comma
id|next
comma
op_amp
id|ctx-&gt;context_list
)paren
(brace
r_struct
id|dma_iso_ctx
op_star
id|d
suffix:semicolon
id|d
op_assign
id|list_entry
c_func
(paren
id|lh
comma
r_struct
id|dma_iso_ctx
comma
id|link
)paren
suffix:semicolon
id|mask
op_assign
(paren
id|u64
)paren
l_int|1
op_lshift
id|d-&gt;channel
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|ohci-&gt;ISO_channel_usage
op_amp
id|mask
)paren
)paren
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;On release: Channel %d &quot;
l_string|&quot;is not being used&quot;
comma
id|d-&gt;channel
)paren
suffix:semicolon
r_else
id|ohci-&gt;ISO_channel_usage
op_and_assign
op_complement
id|mask
suffix:semicolon
id|PRINT
c_func
(paren
id|KERN_INFO
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;On release: Iso %s context &quot;
l_string|&quot;%d stop listening on channel %d&quot;
comma
id|d-&gt;type
op_eq
id|OHCI_ISO_RECEIVE
ques
c_cond
l_string|&quot;receive&quot;
suffix:colon
l_string|&quot;transmit&quot;
comma
id|d-&gt;ctx
comma
id|d-&gt;channel
)paren
suffix:semicolon
id|free_dma_iso_ctx
c_func
(paren
id|d
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|ctx
)paren
suffix:semicolon
id|file-&gt;private_data
op_assign
l_int|NULL
suffix:semicolon
id|unlock_kernel
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_COMPAT
r_static
r_int
id|video1394_compat_ioctl
c_func
(paren
r_struct
id|file
op_star
id|f
comma
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
suffix:semicolon
macro_line|#endif
DECL|variable|video1394_cdev
r_static
r_struct
id|cdev
id|video1394_cdev
suffix:semicolon
DECL|variable|video1394_fops
r_static
r_struct
id|file_operations
id|video1394_fops
op_assign
(brace
dot
id|owner
op_assign
id|THIS_MODULE
comma
dot
id|unlocked_ioctl
op_assign
id|video1394_ioctl
comma
macro_line|#ifdef CONFIG_COMPAT
dot
id|compat_ioctl
op_assign
id|video1394_compat_ioctl
comma
macro_line|#endif
dot
id|mmap
op_assign
id|video1394_mmap
comma
dot
id|open
op_assign
id|video1394_open
comma
dot
id|release
op_assign
id|video1394_release
)brace
suffix:semicolon
multiline_comment|/*** HOTPLUG STUFF **********************************************************/
multiline_comment|/*&n; * Export information about protocols/devices supported by this driver.&n; */
DECL|variable|video1394_id_table
r_static
r_struct
id|ieee1394_device_id
id|video1394_id_table
(braket
)braket
op_assign
(brace
(brace
dot
id|match_flags
op_assign
id|IEEE1394_MATCH_SPECIFIER_ID
op_or
id|IEEE1394_MATCH_VERSION
comma
dot
id|specifier_id
op_assign
id|CAMERA_UNIT_SPEC_ID_ENTRY
op_amp
l_int|0xffffff
comma
dot
id|version
op_assign
id|CAMERA_SW_VERSION_ENTRY
op_amp
l_int|0xffffff
)brace
comma
(brace
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|ieee1394
comma
id|video1394_id_table
)paren
suffix:semicolon
DECL|variable|video1394_driver
r_static
r_struct
id|hpsb_protocol_driver
id|video1394_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;1394 Digital Camera Driver&quot;
comma
dot
id|id_table
op_assign
id|video1394_id_table
comma
dot
id|driver
op_assign
(brace
dot
id|name
op_assign
id|VIDEO1394_DRIVER_NAME
comma
dot
id|bus
op_assign
op_amp
id|ieee1394_bus_type
comma
)brace
comma
)brace
suffix:semicolon
DECL|function|video1394_add_host
r_static
r_void
id|video1394_add_host
(paren
r_struct
id|hpsb_host
op_star
id|host
)paren
(brace
r_struct
id|ti_ohci
op_star
id|ohci
suffix:semicolon
r_int
id|minor
suffix:semicolon
multiline_comment|/* We only work with the OHCI-1394 driver */
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|host-&gt;driver-&gt;name
comma
id|OHCI1394_DRIVER_NAME
)paren
)paren
r_return
suffix:semicolon
id|ohci
op_assign
(paren
r_struct
id|ti_ohci
op_star
)paren
id|host-&gt;hostdata
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hpsb_create_hostinfo
c_func
(paren
op_amp
id|video1394_highlevel
comma
id|host
comma
l_int|0
)paren
)paren
(brace
id|PRINT
c_func
(paren
id|KERN_ERR
comma
id|ohci-&gt;host-&gt;id
comma
l_string|&quot;Cannot allocate hostinfo&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|hpsb_set_hostinfo
c_func
(paren
op_amp
id|video1394_highlevel
comma
id|host
comma
id|ohci
)paren
suffix:semicolon
id|hpsb_set_hostinfo_key
c_func
(paren
op_amp
id|video1394_highlevel
comma
id|host
comma
id|ohci-&gt;host-&gt;id
)paren
suffix:semicolon
id|minor
op_assign
id|IEEE1394_MINOR_BLOCK_VIDEO1394
op_star
l_int|16
op_plus
id|ohci-&gt;host-&gt;id
suffix:semicolon
id|devfs_mk_cdev
c_func
(paren
id|MKDEV
c_func
(paren
id|IEEE1394_MAJOR
comma
id|minor
)paren
comma
id|S_IFCHR
op_or
id|S_IRUSR
op_or
id|S_IWUSR
comma
l_string|&quot;%s/%d&quot;
comma
id|VIDEO1394_DRIVER_NAME
comma
id|ohci-&gt;host-&gt;id
)paren
suffix:semicolon
)brace
DECL|function|video1394_remove_host
r_static
r_void
id|video1394_remove_host
(paren
r_struct
id|hpsb_host
op_star
id|host
)paren
(brace
r_struct
id|ti_ohci
op_star
id|ohci
op_assign
id|hpsb_get_hostinfo
c_func
(paren
op_amp
id|video1394_highlevel
comma
id|host
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ohci
)paren
id|devfs_remove
c_func
(paren
l_string|&quot;%s/%d&quot;
comma
id|VIDEO1394_DRIVER_NAME
comma
id|ohci-&gt;host-&gt;id
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
DECL|variable|video1394_highlevel
r_static
r_struct
id|hpsb_highlevel
id|video1394_highlevel
op_assign
(brace
dot
id|name
op_assign
id|VIDEO1394_DRIVER_NAME
comma
dot
id|add_host
op_assign
id|video1394_add_host
comma
dot
id|remove_host
op_assign
id|video1394_remove_host
comma
)brace
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Sebastien Rougeaux &lt;sebastien.rougeaux@anu.edu.au&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;driver for digital video on OHCI board&quot;
)paren
suffix:semicolon
DECL|variable|VIDEO1394_DRIVER_NAME
id|MODULE_SUPPORTED_DEVICE
c_func
(paren
id|VIDEO1394_DRIVER_NAME
)paren
suffix:semicolon
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_COMPAT
DECL|macro|VIDEO1394_IOC32_LISTEN_QUEUE_BUFFER
mdefine_line|#define VIDEO1394_IOC32_LISTEN_QUEUE_BUFFER     &bslash;&n;&t;_IOW (&squot;#&squot;, 0x12, struct video1394_wait32)
DECL|macro|VIDEO1394_IOC32_LISTEN_WAIT_BUFFER
mdefine_line|#define VIDEO1394_IOC32_LISTEN_WAIT_BUFFER      &bslash;&n;&t;_IOWR(&squot;#&squot;, 0x13, struct video1394_wait32)
DECL|macro|VIDEO1394_IOC32_TALK_WAIT_BUFFER
mdefine_line|#define VIDEO1394_IOC32_TALK_WAIT_BUFFER        &bslash;&n;&t;_IOW (&squot;#&squot;, 0x17, struct video1394_wait32)
DECL|macro|VIDEO1394_IOC32_LISTEN_POLL_BUFFER
mdefine_line|#define VIDEO1394_IOC32_LISTEN_POLL_BUFFER      &bslash;&n;&t;_IOWR(&squot;#&squot;, 0x18, struct video1394_wait32)
DECL|struct|video1394_wait32
r_struct
id|video1394_wait32
(brace
DECL|member|channel
id|u32
id|channel
suffix:semicolon
DECL|member|buffer
id|u32
id|buffer
suffix:semicolon
DECL|member|filltime
r_struct
id|compat_timeval
id|filltime
suffix:semicolon
)brace
suffix:semicolon
DECL|function|video1394_wr_wait32
r_static
r_int
id|video1394_wr_wait32
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|video1394_wait32
id|__user
op_star
id|argp
op_assign
(paren
r_void
id|__user
op_star
)paren
id|arg
suffix:semicolon
r_struct
id|video1394_wait32
id|wait32
suffix:semicolon
r_struct
id|video1394_wait
id|wait
suffix:semicolon
id|mm_segment_t
id|old_fs
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|wait32
comma
id|argp
comma
r_sizeof
(paren
id|wait32
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|wait.channel
op_assign
id|wait32.channel
suffix:semicolon
id|wait.buffer
op_assign
id|wait32.buffer
suffix:semicolon
id|wait.filltime.tv_sec
op_assign
(paren
id|time_t
)paren
id|wait32.filltime.tv_sec
suffix:semicolon
id|wait.filltime.tv_usec
op_assign
(paren
id|suseconds_t
)paren
id|wait32.filltime.tv_usec
suffix:semicolon
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|VIDEO1394_IOC32_LISTEN_WAIT_BUFFER
)paren
id|ret
op_assign
id|video1394_ioctl
c_func
(paren
id|file
comma
id|VIDEO1394_IOC_LISTEN_WAIT_BUFFER
comma
(paren
r_int
r_int
)paren
op_amp
id|wait
)paren
suffix:semicolon
r_else
id|ret
op_assign
id|video1394_ioctl
c_func
(paren
id|file
comma
id|VIDEO1394_IOC_LISTEN_POLL_BUFFER
comma
(paren
r_int
r_int
)paren
op_amp
id|wait
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
id|wait32.channel
op_assign
id|wait.channel
suffix:semicolon
id|wait32.buffer
op_assign
id|wait.buffer
suffix:semicolon
id|wait32.filltime.tv_sec
op_assign
(paren
r_int
)paren
id|wait.filltime.tv_sec
suffix:semicolon
id|wait32.filltime.tv_usec
op_assign
(paren
r_int
)paren
id|wait.filltime.tv_usec
suffix:semicolon
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|argp
comma
op_amp
id|wait32
comma
r_sizeof
(paren
id|wait32
)paren
)paren
)paren
id|ret
op_assign
op_minus
id|EFAULT
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|video1394_w_wait32
r_static
r_int
id|video1394_w_wait32
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_struct
id|video1394_wait32
id|wait32
suffix:semicolon
r_struct
id|video1394_wait
id|wait
suffix:semicolon
id|mm_segment_t
id|old_fs
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|wait32
comma
(paren
r_void
id|__user
op_star
)paren
id|arg
comma
r_sizeof
(paren
id|wait32
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|wait.channel
op_assign
id|wait32.channel
suffix:semicolon
id|wait.buffer
op_assign
id|wait32.buffer
suffix:semicolon
id|wait.filltime.tv_sec
op_assign
(paren
id|time_t
)paren
id|wait32.filltime.tv_sec
suffix:semicolon
id|wait.filltime.tv_usec
op_assign
(paren
id|suseconds_t
)paren
id|wait32.filltime.tv_usec
suffix:semicolon
id|old_fs
op_assign
id|get_fs
c_func
(paren
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|KERNEL_DS
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmd
op_eq
id|VIDEO1394_IOC32_LISTEN_QUEUE_BUFFER
)paren
id|ret
op_assign
id|video1394_ioctl
c_func
(paren
id|file
comma
id|VIDEO1394_IOC_LISTEN_QUEUE_BUFFER
comma
(paren
r_int
r_int
)paren
op_amp
id|wait
)paren
suffix:semicolon
r_else
id|ret
op_assign
id|video1394_ioctl
c_func
(paren
id|file
comma
id|VIDEO1394_IOC_TALK_WAIT_BUFFER
comma
(paren
r_int
r_int
)paren
op_amp
id|wait
)paren
suffix:semicolon
id|set_fs
c_func
(paren
id|old_fs
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|video1394_queue_buf32
r_static
r_int
id|video1394_queue_buf32
c_func
(paren
r_struct
id|file
op_star
id|file
comma
r_int
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_return
op_minus
id|EFAULT
suffix:semicolon
multiline_comment|/* ??? was there before. */
r_return
id|video1394_ioctl
c_func
(paren
id|file
comma
id|VIDEO1394_IOC_TALK_QUEUE_BUFFER
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|function|video1394_compat_ioctl
r_static
r_int
id|video1394_compat_ioctl
c_func
(paren
r_struct
id|file
op_star
id|f
comma
r_int
id|cmd
comma
r_int
r_int
id|arg
)paren
(brace
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|VIDEO1394_IOC_LISTEN_CHANNEL
suffix:colon
r_case
id|VIDEO1394_IOC_UNLISTEN_CHANNEL
suffix:colon
r_case
id|VIDEO1394_IOC_TALK_CHANNEL
suffix:colon
r_case
id|VIDEO1394_IOC_UNTALK_CHANNEL
suffix:colon
r_return
id|video1394_ioctl
c_func
(paren
id|f
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_case
id|VIDEO1394_IOC32_LISTEN_QUEUE_BUFFER
suffix:colon
r_return
id|video1394_w_wait32
c_func
(paren
id|f
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_case
id|VIDEO1394_IOC32_LISTEN_WAIT_BUFFER
suffix:colon
r_return
id|video1394_wr_wait32
c_func
(paren
id|f
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_case
id|VIDEO1394_IOC_TALK_QUEUE_BUFFER
suffix:colon
r_return
id|video1394_queue_buf32
c_func
(paren
id|f
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_case
id|VIDEO1394_IOC32_TALK_WAIT_BUFFER
suffix:colon
r_return
id|video1394_w_wait32
c_func
(paren
id|f
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_case
id|VIDEO1394_IOC32_LISTEN_POLL_BUFFER
suffix:colon
r_return
id|video1394_wr_wait32
c_func
(paren
id|f
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
r_default
suffix:colon
r_return
op_minus
id|ENOIOCTLCMD
suffix:semicolon
)brace
)brace
macro_line|#endif /* CONFIG_COMPAT */
DECL|function|video1394_exit_module
r_static
r_void
id|__exit
id|video1394_exit_module
(paren
r_void
)paren
(brace
id|hpsb_unregister_protocol
c_func
(paren
op_amp
id|video1394_driver
)paren
suffix:semicolon
id|hpsb_unregister_highlevel
c_func
(paren
op_amp
id|video1394_highlevel
)paren
suffix:semicolon
id|devfs_remove
c_func
(paren
id|VIDEO1394_DRIVER_NAME
)paren
suffix:semicolon
id|cdev_del
c_func
(paren
op_amp
id|video1394_cdev
)paren
suffix:semicolon
id|PRINT_G
c_func
(paren
id|KERN_INFO
comma
l_string|&quot;Removed &quot;
id|VIDEO1394_DRIVER_NAME
l_string|&quot; module&quot;
)paren
suffix:semicolon
)brace
DECL|function|video1394_init_module
r_static
r_int
id|__init
id|video1394_init_module
(paren
r_void
)paren
(brace
r_int
id|ret
suffix:semicolon
id|cdev_init
c_func
(paren
op_amp
id|video1394_cdev
comma
op_amp
id|video1394_fops
)paren
suffix:semicolon
id|video1394_cdev.owner
op_assign
id|THIS_MODULE
suffix:semicolon
id|kobject_set_name
c_func
(paren
op_amp
id|video1394_cdev.kobj
comma
id|VIDEO1394_DRIVER_NAME
)paren
suffix:semicolon
id|ret
op_assign
id|cdev_add
c_func
(paren
op_amp
id|video1394_cdev
comma
id|IEEE1394_VIDEO1394_DEV
comma
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|PRINT_G
c_func
(paren
id|KERN_ERR
comma
l_string|&quot;video1394: unable to get minor device block&quot;
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|devfs_mk_dir
c_func
(paren
id|VIDEO1394_DRIVER_NAME
)paren
suffix:semicolon
id|hpsb_register_highlevel
c_func
(paren
op_amp
id|video1394_highlevel
)paren
suffix:semicolon
id|ret
op_assign
id|hpsb_register_protocol
c_func
(paren
op_amp
id|video1394_driver
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
(brace
id|PRINT_G
c_func
(paren
id|KERN_ERR
comma
l_string|&quot;video1394: failed to register protocol&quot;
)paren
suffix:semicolon
id|hpsb_unregister_highlevel
c_func
(paren
op_amp
id|video1394_highlevel
)paren
suffix:semicolon
id|devfs_remove
c_func
(paren
id|VIDEO1394_DRIVER_NAME
)paren
suffix:semicolon
id|cdev_del
c_func
(paren
op_amp
id|video1394_cdev
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
id|PRINT_G
c_func
(paren
id|KERN_INFO
comma
l_string|&quot;Installed &quot;
id|VIDEO1394_DRIVER_NAME
l_string|&quot; module&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|video1394_init_module
id|module_init
c_func
(paren
id|video1394_init_module
)paren
suffix:semicolon
DECL|variable|video1394_exit_module
id|module_exit
c_func
(paren
id|video1394_exit_module
)paren
suffix:semicolon
id|MODULE_ALIAS_CHARDEV
c_func
(paren
id|IEEE1394_MAJOR
comma
id|IEEE1394_MINOR_BLOCK_VIDEO1394
op_star
l_int|16
)paren
suffix:semicolon
eof
