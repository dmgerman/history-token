multiline_comment|/* $Id: he.c,v 1.18 2003/05/06 22:57:15 chas Exp $ */
multiline_comment|/*&n;&n;  he.c&n;&n;  ForeRunnerHE ATM Adapter driver for ATM on Linux&n;  Copyright (C) 1999-2001  Naval Research Laboratory&n;&n;  This library is free software; you can redistribute it and/or&n;  modify it under the terms of the GNU Lesser General Public&n;  License as published by the Free Software Foundation; either&n;  version 2.1 of the License, or (at your option) any later version.&n;&n;  This library is distributed in the hope that it will be useful,&n;  but WITHOUT ANY WARRANTY; without even the implied warranty of&n;  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU&n;  Lesser General Public License for more details.&n;&n;  You should have received a copy of the GNU Lesser General Public&n;  License along with this library; if not, write to the Free Software&n;  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA&n;&n;*/
multiline_comment|/*&n;&n;  he.c&n;&n;  ForeRunnerHE ATM Adapter driver for ATM on Linux&n;  Copyright (C) 1999-2001  Naval Research Laboratory&n;&n;  Permission to use, copy, modify and distribute this software and its&n;  documentation is hereby granted, provided that both the copyright&n;  notice and this permission notice appear in all copies of the software,&n;  derivative works or modified versions, and any portions thereof, and&n;  that both notices appear in supporting documentation.&n;&n;  NRL ALLOWS FREE USE OF THIS SOFTWARE IN ITS &quot;AS IS&quot; CONDITION AND&n;  DISCLAIMS ANY LIABILITY OF ANY KIND FOR ANY DAMAGES WHATSOEVER&n;  RESULTING FROM THE USE OF THIS SOFTWARE.&n;&n;  This driver was written using the &quot;Programmer&squot;s Reference Manual for&n;  ForeRunnerHE(tm)&quot;, MANU0361-01 - Rev. A, 08/21/98.&n;&n;  AUTHORS:&n;&t;chas williams &lt;chas@cmf.nrl.navy.mil&gt;&n;&t;eric kinzie &lt;ekinzie@cmf.nrl.navy.mil&gt;&n;&n;  NOTES:&n;&t;4096 supported &squot;connections&squot;&n;&t;group 0 is used for all traffic&n;&t;interrupt queue 0 is used for all interrupts&n;&t;aal0 support (based on work from ulrich.u.muller@nokia.com)&n;&n; */
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/version.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/errno.h&gt;
macro_line|#include &lt;linux/types.h&gt;
macro_line|#include &lt;linux/string.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/mm.h&gt;
macro_line|#include &lt;linux/sched.h&gt;
macro_line|#include &lt;linux/timer.h&gt;
macro_line|#include &lt;linux/interrupt.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;linux/atmdev.h&gt;
macro_line|#include &lt;linux/atm.h&gt;
macro_line|#include &lt;linux/sonet.h&gt;
DECL|macro|USE_TASKLET
mdefine_line|#define USE_TASKLET
DECL|macro|USE_SCATTERGATHER
macro_line|#undef USE_SCATTERGATHER
DECL|macro|USE_CHECKSUM_HW
macro_line|#undef USE_CHECKSUM_HW&t;&t;&t;/* still confused about this */
DECL|macro|USE_RBPS
mdefine_line|#define USE_RBPS
DECL|macro|USE_RBPS_POOL
macro_line|#undef USE_RBPS_POOL&t;&t;&t;/* if memory is tight try this */
DECL|macro|USE_RBPL_POOL
macro_line|#undef USE_RBPL_POOL&t;&t;&t;/* if memory is tight try this */
DECL|macro|USE_TPD_POOL
mdefine_line|#define USE_TPD_POOL
multiline_comment|/* #undef CONFIG_ATM_HE_USE_SUNI */
multiline_comment|/* compatibility */
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,5,69)
DECL|typedef|irqreturn_t
r_typedef
r_void
id|irqreturn_t
suffix:semicolon
DECL|macro|IRQ_NONE
mdefine_line|#define IRQ_NONE
DECL|macro|IRQ_HANDLED
mdefine_line|#define IRQ_HANDLED
DECL|macro|IRQ_RETVAL
mdefine_line|#define IRQ_RETVAL(x)
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,4,9)
DECL|macro|__devexit_p
mdefine_line|#define __devexit_p(func)&t;&t;func
macro_line|#endif
macro_line|#ifndef MODULE_LICENSE
DECL|macro|MODULE_LICENSE
mdefine_line|#define MODULE_LICENSE(x)
macro_line|#endif
macro_line|#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,4,3)
DECL|macro|pci_set_drvdata
mdefine_line|#define pci_set_drvdata(pci_dev, data)&t;(pci_dev)-&gt;driver_data = (data)
DECL|macro|pci_get_drvdata
mdefine_line|#define pci_get_drvdata(pci_dev)&t;(pci_dev)-&gt;driver_data
macro_line|#endif
macro_line|#include &quot;he.h&quot;
macro_line|#include &quot;suni.h&quot;
macro_line|#include &lt;linux/atm_he.h&gt;
DECL|macro|hprintk
mdefine_line|#define hprintk(fmt,args...)&t;printk(KERN_ERR DEV_LABEL &quot;%d: &quot; fmt, he_dev-&gt;number , ##args)
DECL|macro|DEBUG
macro_line|#undef DEBUG
macro_line|#ifdef DEBUG
DECL|macro|HPRINTK
mdefine_line|#define HPRINTK(fmt,args...)&t;printk(KERN_DEBUG DEV_LABEL &quot;%d: &quot; fmt, he_dev-&gt;number , ##args)
macro_line|#else
DECL|macro|HPRINTK
mdefine_line|#define HPRINTK(fmt,args...)&t;do { } while (0)
macro_line|#endif /* DEBUG */
multiline_comment|/* version definition */
DECL|variable|version
r_static
r_char
op_star
id|version
op_assign
l_string|&quot;$Id: he.c,v 1.18 2003/05/06 22:57:15 chas Exp $&quot;
suffix:semicolon
multiline_comment|/* declarations */
r_static
r_int
id|he_open
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
suffix:semicolon
r_static
r_void
id|he_close
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
suffix:semicolon
r_static
r_int
id|he_send
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_int
id|he_ioctl
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
comma
r_int
r_int
id|cmd
comma
r_void
id|__user
op_star
id|arg
)paren
suffix:semicolon
r_static
id|irqreturn_t
id|he_irq_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|he_tasklet
c_func
(paren
r_int
r_int
id|data
)paren
suffix:semicolon
r_static
r_int
id|he_proc_read
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
comma
id|loff_t
op_star
id|pos
comma
r_char
op_star
id|page
)paren
suffix:semicolon
r_static
r_int
id|he_start
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|he_stop
c_func
(paren
r_struct
id|he_dev
op_star
id|dev
)paren
suffix:semicolon
r_static
r_void
id|he_phy_put
c_func
(paren
r_struct
id|atm_dev
op_star
comma
r_int
r_char
comma
r_int
r_int
)paren
suffix:semicolon
r_static
r_int
r_char
id|he_phy_get
c_func
(paren
r_struct
id|atm_dev
op_star
comma
r_int
r_int
)paren
suffix:semicolon
r_static
id|u8
id|read_prom_byte
c_func
(paren
r_struct
id|he_dev
op_star
id|he_dev
comma
r_int
id|addr
)paren
suffix:semicolon
multiline_comment|/* globals */
DECL|variable|he_devs
r_static
r_struct
id|he_dev
op_star
id|he_devs
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|disable64
r_static
r_int
id|disable64
op_assign
l_int|0
suffix:semicolon
DECL|variable|nvpibits
r_static
r_int
id|nvpibits
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|nvcibits
r_static
r_int
id|nvcibits
op_assign
op_minus
l_int|1
suffix:semicolon
DECL|variable|rx_skb_reserve
r_static
r_int
id|rx_skb_reserve
op_assign
l_int|16
suffix:semicolon
DECL|variable|irq_coalesce
r_static
r_int
id|irq_coalesce
op_assign
l_int|1
suffix:semicolon
DECL|variable|sdh
r_static
r_int
id|sdh
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Read from EEPROM = 0000 0011b */
DECL|variable|readtab
r_static
r_int
r_int
id|readtab
(braket
)braket
op_assign
(brace
id|CS_HIGH
op_or
id|CLK_HIGH
comma
id|CS_LOW
op_or
id|CLK_LOW
comma
id|CLK_HIGH
comma
multiline_comment|/* 0 */
id|CLK_LOW
comma
id|CLK_HIGH
comma
multiline_comment|/* 0 */
id|CLK_LOW
comma
id|CLK_HIGH
comma
multiline_comment|/* 0 */
id|CLK_LOW
comma
id|CLK_HIGH
comma
multiline_comment|/* 0 */
id|CLK_LOW
comma
id|CLK_HIGH
comma
multiline_comment|/* 0 */
id|CLK_LOW
comma
id|CLK_HIGH
comma
multiline_comment|/* 0 */
id|CLK_LOW
op_or
id|SI_HIGH
comma
id|CLK_HIGH
op_or
id|SI_HIGH
comma
multiline_comment|/* 1 */
id|CLK_LOW
op_or
id|SI_HIGH
comma
id|CLK_HIGH
op_or
id|SI_HIGH
multiline_comment|/* 1 */
)brace
suffix:semicolon
multiline_comment|/* Clock to read from/write to the EEPROM */
DECL|variable|clocktab
r_static
r_int
r_int
id|clocktab
(braket
)braket
op_assign
(brace
id|CLK_LOW
comma
id|CLK_HIGH
comma
id|CLK_LOW
comma
id|CLK_HIGH
comma
id|CLK_LOW
comma
id|CLK_HIGH
comma
id|CLK_LOW
comma
id|CLK_HIGH
comma
id|CLK_LOW
comma
id|CLK_HIGH
comma
id|CLK_LOW
comma
id|CLK_HIGH
comma
id|CLK_LOW
comma
id|CLK_HIGH
comma
id|CLK_LOW
comma
id|CLK_HIGH
comma
id|CLK_LOW
)brace
suffix:semicolon
DECL|variable|he_ops
r_static
r_struct
id|atmdev_ops
id|he_ops
op_assign
(brace
dot
id|open
op_assign
id|he_open
comma
dot
id|close
op_assign
id|he_close
comma
dot
id|ioctl
op_assign
id|he_ioctl
comma
dot
id|send
op_assign
id|he_send
comma
dot
id|phy_put
op_assign
id|he_phy_put
comma
dot
id|phy_get
op_assign
id|he_phy_get
comma
dot
id|proc_read
op_assign
id|he_proc_read
comma
dot
id|owner
op_assign
id|THIS_MODULE
)brace
suffix:semicolon
DECL|macro|he_writel
mdefine_line|#define he_writel(dev, val, reg)&t;do { writel(val, (dev)-&gt;membase + (reg)); wmb(); } while (0)
DECL|macro|he_readl
mdefine_line|#define he_readl(dev, reg)&t;&t;readl((dev)-&gt;membase + (reg))
multiline_comment|/* section 2.12 connection memory access */
r_static
id|__inline__
r_void
DECL|function|he_writel_internal
id|he_writel_internal
c_func
(paren
r_struct
id|he_dev
op_star
id|he_dev
comma
r_int
id|val
comma
r_int
id|addr
comma
r_int
id|flags
)paren
(brace
id|he_writel
c_func
(paren
id|he_dev
comma
id|val
comma
id|CON_DAT
)paren
suffix:semicolon
(paren
r_void
)paren
id|he_readl
c_func
(paren
id|he_dev
comma
id|CON_DAT
)paren
suffix:semicolon
multiline_comment|/* flush posted writes */
id|he_writel
c_func
(paren
id|he_dev
comma
id|flags
op_or
id|CON_CTL_WRITE
op_or
id|CON_CTL_ADDR
c_func
(paren
id|addr
)paren
comma
id|CON_CTL
)paren
suffix:semicolon
r_while
c_loop
(paren
id|he_readl
c_func
(paren
id|he_dev
comma
id|CON_CTL
)paren
op_amp
id|CON_CTL_BUSY
)paren
suffix:semicolon
)brace
DECL|macro|he_writel_rcm
mdefine_line|#define he_writel_rcm(dev, val, reg) &t;&t;&t;&t;&bslash;&n;&t;&t;&t;he_writel_internal(dev, val, reg, CON_CTL_RCM)
DECL|macro|he_writel_tcm
mdefine_line|#define he_writel_tcm(dev, val, reg) &t;&t;&t;&t;&bslash;&n;&t;&t;&t;he_writel_internal(dev, val, reg, CON_CTL_TCM)
DECL|macro|he_writel_mbox
mdefine_line|#define he_writel_mbox(dev, val, reg) &t;&t;&t;&t;&bslash;&n;&t;&t;&t;he_writel_internal(dev, val, reg, CON_CTL_MBOX)
r_static
r_int
DECL|function|he_readl_internal
id|he_readl_internal
c_func
(paren
r_struct
id|he_dev
op_star
id|he_dev
comma
r_int
id|addr
comma
r_int
id|flags
)paren
(brace
id|he_writel
c_func
(paren
id|he_dev
comma
id|flags
op_or
id|CON_CTL_READ
op_or
id|CON_CTL_ADDR
c_func
(paren
id|addr
)paren
comma
id|CON_CTL
)paren
suffix:semicolon
r_while
c_loop
(paren
id|he_readl
c_func
(paren
id|he_dev
comma
id|CON_CTL
)paren
op_amp
id|CON_CTL_BUSY
)paren
suffix:semicolon
r_return
id|he_readl
c_func
(paren
id|he_dev
comma
id|CON_DAT
)paren
suffix:semicolon
)brace
DECL|macro|he_readl_rcm
mdefine_line|#define he_readl_rcm(dev, reg) &bslash;&n;&t;&t;&t;he_readl_internal(dev, reg, CON_CTL_RCM)
DECL|macro|he_readl_tcm
mdefine_line|#define he_readl_tcm(dev, reg) &bslash;&n;&t;&t;&t;he_readl_internal(dev, reg, CON_CTL_TCM)
DECL|macro|he_readl_mbox
mdefine_line|#define he_readl_mbox(dev, reg) &bslash;&n;&t;&t;&t;he_readl_internal(dev, reg, CON_CTL_MBOX)
multiline_comment|/* figure 2.2 connection id */
DECL|macro|he_mkcid
mdefine_line|#define he_mkcid(dev, vpi, vci)&t;&t;(((vpi &lt;&lt; (dev)-&gt;vcibits) | vci) &amp; 0x1fff)
multiline_comment|/* 2.5.1 per connection transmit state registers */
DECL|macro|he_writel_tsr0
mdefine_line|#define he_writel_tsr0(dev, val, cid) &bslash;&n;&t;&t;he_writel_tcm(dev, val, CONFIG_TSRA | (cid &lt;&lt; 3) | 0)
DECL|macro|he_readl_tsr0
mdefine_line|#define he_readl_tsr0(dev, cid) &bslash;&n;&t;&t;he_readl_tcm(dev, CONFIG_TSRA | (cid &lt;&lt; 3) | 0)
DECL|macro|he_writel_tsr1
mdefine_line|#define he_writel_tsr1(dev, val, cid) &bslash;&n;&t;&t;he_writel_tcm(dev, val, CONFIG_TSRA | (cid &lt;&lt; 3) | 1)
DECL|macro|he_writel_tsr2
mdefine_line|#define he_writel_tsr2(dev, val, cid) &bslash;&n;&t;&t;he_writel_tcm(dev, val, CONFIG_TSRA | (cid &lt;&lt; 3) | 2)
DECL|macro|he_writel_tsr3
mdefine_line|#define he_writel_tsr3(dev, val, cid) &bslash;&n;&t;&t;he_writel_tcm(dev, val, CONFIG_TSRA | (cid &lt;&lt; 3) | 3)
DECL|macro|he_writel_tsr4
mdefine_line|#define he_writel_tsr4(dev, val, cid) &bslash;&n;&t;&t;he_writel_tcm(dev, val, CONFIG_TSRA | (cid &lt;&lt; 3) | 4)
multiline_comment|/* from page 2-20&n;&t; *&n;&t; * NOTE While the transmit connection is active, bits 23 through 0&n;&t; *      of this register must not be written by the host.  Byte&n;&t; *      enables should be used during normal operation when writing&n;&t; *      the most significant byte.&n;&t; */
DECL|macro|he_writel_tsr4_upper
mdefine_line|#define he_writel_tsr4_upper(dev, val, cid) &bslash;&n;&t;&t;he_writel_internal(dev, val, CONFIG_TSRA | (cid &lt;&lt; 3) | 4, &bslash;&n;&t;&t;&t;&t;&t;&t;&t;CON_CTL_TCM &bslash;&n;&t;&t;&t;&t;&t;&t;&t;| CON_BYTE_DISABLE_2 &bslash;&n;&t;&t;&t;&t;&t;&t;&t;| CON_BYTE_DISABLE_1 &bslash;&n;&t;&t;&t;&t;&t;&t;&t;| CON_BYTE_DISABLE_0)
DECL|macro|he_readl_tsr4
mdefine_line|#define he_readl_tsr4(dev, cid) &bslash;&n;&t;&t;he_readl_tcm(dev, CONFIG_TSRA | (cid &lt;&lt; 3) | 4)
DECL|macro|he_writel_tsr5
mdefine_line|#define he_writel_tsr5(dev, val, cid) &bslash;&n;&t;&t;he_writel_tcm(dev, val, CONFIG_TSRA | (cid &lt;&lt; 3) | 5)
DECL|macro|he_writel_tsr6
mdefine_line|#define he_writel_tsr6(dev, val, cid) &bslash;&n;&t;&t;he_writel_tcm(dev, val, CONFIG_TSRA | (cid &lt;&lt; 3) | 6)
DECL|macro|he_writel_tsr7
mdefine_line|#define he_writel_tsr7(dev, val, cid) &bslash;&n;&t;&t;he_writel_tcm(dev, val, CONFIG_TSRA | (cid &lt;&lt; 3) | 7)
DECL|macro|he_writel_tsr8
mdefine_line|#define he_writel_tsr8(dev, val, cid) &bslash;&n;&t;&t;he_writel_tcm(dev, val, CONFIG_TSRB | (cid &lt;&lt; 2) | 0)
DECL|macro|he_writel_tsr9
mdefine_line|#define he_writel_tsr9(dev, val, cid) &bslash;&n;&t;&t;he_writel_tcm(dev, val, CONFIG_TSRB | (cid &lt;&lt; 2) | 1)
DECL|macro|he_writel_tsr10
mdefine_line|#define he_writel_tsr10(dev, val, cid) &bslash;&n;&t;&t;he_writel_tcm(dev, val, CONFIG_TSRB | (cid &lt;&lt; 2) | 2)
DECL|macro|he_writel_tsr11
mdefine_line|#define he_writel_tsr11(dev, val, cid) &bslash;&n;&t;&t;he_writel_tcm(dev, val, CONFIG_TSRB | (cid &lt;&lt; 2) | 3)
DECL|macro|he_writel_tsr12
mdefine_line|#define he_writel_tsr12(dev, val, cid) &bslash;&n;&t;&t;he_writel_tcm(dev, val, CONFIG_TSRC | (cid &lt;&lt; 1) | 0)
DECL|macro|he_writel_tsr13
mdefine_line|#define he_writel_tsr13(dev, val, cid) &bslash;&n;&t;&t;he_writel_tcm(dev, val, CONFIG_TSRC | (cid &lt;&lt; 1) | 1)
DECL|macro|he_writel_tsr14
mdefine_line|#define he_writel_tsr14(dev, val, cid) &bslash;&n;&t;&t;he_writel_tcm(dev, val, CONFIG_TSRD | cid)
DECL|macro|he_writel_tsr14_upper
mdefine_line|#define he_writel_tsr14_upper(dev, val, cid) &bslash;&n;&t;&t;he_writel_internal(dev, val, CONFIG_TSRD | cid, &bslash;&n;&t;&t;&t;&t;&t;&t;&t;CON_CTL_TCM &bslash;&n;&t;&t;&t;&t;&t;&t;&t;| CON_BYTE_DISABLE_2 &bslash;&n;&t;&t;&t;&t;&t;&t;&t;| CON_BYTE_DISABLE_1 &bslash;&n;&t;&t;&t;&t;&t;&t;&t;| CON_BYTE_DISABLE_0)
multiline_comment|/* 2.7.1 per connection receive state registers */
DECL|macro|he_writel_rsr0
mdefine_line|#define he_writel_rsr0(dev, val, cid) &bslash;&n;&t;&t;he_writel_rcm(dev, val, 0x00000 | (cid &lt;&lt; 3) | 0)
DECL|macro|he_readl_rsr0
mdefine_line|#define he_readl_rsr0(dev, cid) &bslash;&n;&t;&t;he_readl_rcm(dev, 0x00000 | (cid &lt;&lt; 3) | 0)
DECL|macro|he_writel_rsr1
mdefine_line|#define he_writel_rsr1(dev, val, cid) &bslash;&n;&t;&t;he_writel_rcm(dev, val, 0x00000 | (cid &lt;&lt; 3) | 1)
DECL|macro|he_writel_rsr2
mdefine_line|#define he_writel_rsr2(dev, val, cid) &bslash;&n;&t;&t;he_writel_rcm(dev, val, 0x00000 | (cid &lt;&lt; 3) | 2)
DECL|macro|he_writel_rsr3
mdefine_line|#define he_writel_rsr3(dev, val, cid) &bslash;&n;&t;&t;he_writel_rcm(dev, val, 0x00000 | (cid &lt;&lt; 3) | 3)
DECL|macro|he_writel_rsr4
mdefine_line|#define he_writel_rsr4(dev, val, cid) &bslash;&n;&t;&t;he_writel_rcm(dev, val, 0x00000 | (cid &lt;&lt; 3) | 4)
DECL|macro|he_writel_rsr5
mdefine_line|#define he_writel_rsr5(dev, val, cid) &bslash;&n;&t;&t;he_writel_rcm(dev, val, 0x00000 | (cid &lt;&lt; 3) | 5)
DECL|macro|he_writel_rsr6
mdefine_line|#define he_writel_rsr6(dev, val, cid) &bslash;&n;&t;&t;he_writel_rcm(dev, val, 0x00000 | (cid &lt;&lt; 3) | 6)
DECL|macro|he_writel_rsr7
mdefine_line|#define he_writel_rsr7(dev, val, cid) &bslash;&n;&t;&t;he_writel_rcm(dev, val, 0x00000 | (cid &lt;&lt; 3) | 7)
r_static
id|__inline__
r_struct
id|atm_vcc
op_star
DECL|function|__find_vcc
id|__find_vcc
c_func
(paren
r_struct
id|he_dev
op_star
id|he_dev
comma
r_int
id|cid
)paren
(brace
r_struct
id|hlist_head
op_star
id|head
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_struct
id|hlist_node
op_star
id|node
suffix:semicolon
r_struct
id|sock
op_star
id|s
suffix:semicolon
r_int
id|vpi
suffix:semicolon
r_int
id|vci
suffix:semicolon
id|vpi
op_assign
id|cid
op_rshift
id|he_dev-&gt;vcibits
suffix:semicolon
id|vci
op_assign
id|cid
op_amp
(paren
(paren
l_int|1
op_lshift
id|he_dev-&gt;vcibits
)paren
op_minus
l_int|1
)paren
suffix:semicolon
id|head
op_assign
op_amp
id|vcc_hash
(braket
id|vci
op_amp
(paren
id|VCC_HTABLE_SIZE
op_minus
l_int|1
)paren
)braket
suffix:semicolon
id|sk_for_each
c_func
(paren
id|s
comma
id|node
comma
id|head
)paren
(brace
id|vcc
op_assign
id|atm_sk
c_func
(paren
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;dev
op_eq
id|he_dev-&gt;atm_dev
op_logical_and
id|vcc-&gt;vci
op_eq
id|vci
op_logical_and
id|vcc-&gt;vpi
op_eq
id|vpi
op_logical_and
id|vcc-&gt;qos.rxtp.traffic_class
op_ne
id|ATM_NONE
)paren
(brace
r_return
id|vcc
suffix:semicolon
)brace
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
r_static
r_int
id|__devinit
DECL|function|he_init_one
id|he_init_one
c_func
(paren
r_struct
id|pci_dev
op_star
id|pci_dev
comma
r_const
r_struct
id|pci_device_id
op_star
id|pci_ent
)paren
(brace
r_struct
id|atm_dev
op_star
id|atm_dev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|he_dev
op_star
id|he_dev
op_assign
l_int|NULL
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
id|printk
c_func
(paren
id|KERN_INFO
l_string|&quot;he: %s&bslash;n&quot;
comma
id|version
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_enable_device
c_func
(paren
id|pci_dev
)paren
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_if
c_cond
(paren
id|pci_set_dma_mask
c_func
(paren
id|pci_dev
comma
id|HE_DMA_MASK
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
id|KERN_WARNING
l_string|&quot;he: no suitable dma available&bslash;n&quot;
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EIO
suffix:semicolon
r_goto
id|init_one_failure
suffix:semicolon
)brace
id|atm_dev
op_assign
id|atm_dev_register
c_func
(paren
id|DEV_LABEL
comma
op_amp
id|he_ops
comma
op_minus
l_int|1
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|atm_dev
)paren
(brace
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|init_one_failure
suffix:semicolon
)brace
id|pci_set_drvdata
c_func
(paren
id|pci_dev
comma
id|atm_dev
)paren
suffix:semicolon
id|he_dev
op_assign
(paren
r_struct
id|he_dev
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|he_dev
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|he_dev
)paren
(brace
id|err
op_assign
op_minus
id|ENOMEM
suffix:semicolon
r_goto
id|init_one_failure
suffix:semicolon
)brace
id|memset
c_func
(paren
id|he_dev
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|he_dev
)paren
)paren
suffix:semicolon
id|he_dev-&gt;pci_dev
op_assign
id|pci_dev
suffix:semicolon
id|he_dev-&gt;atm_dev
op_assign
id|atm_dev
suffix:semicolon
id|he_dev-&gt;atm_dev-&gt;dev_data
op_assign
id|he_dev
suffix:semicolon
id|atm_dev-&gt;dev_data
op_assign
id|he_dev
suffix:semicolon
id|he_dev-&gt;number
op_assign
id|atm_dev-&gt;number
suffix:semicolon
r_if
c_cond
(paren
id|he_start
c_func
(paren
id|atm_dev
)paren
)paren
(brace
id|he_stop
c_func
(paren
id|he_dev
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|ENODEV
suffix:semicolon
r_goto
id|init_one_failure
suffix:semicolon
)brace
id|he_dev-&gt;next
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|he_devs
)paren
id|he_dev-&gt;next
op_assign
id|he_devs
suffix:semicolon
id|he_devs
op_assign
id|he_dev
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|init_one_failure
suffix:colon
r_if
c_cond
(paren
id|atm_dev
)paren
id|atm_dev_deregister
c_func
(paren
id|atm_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev
)paren
id|kfree
c_func
(paren
id|he_dev
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_static
r_void
id|__devexit
DECL|function|he_remove_one
id|he_remove_one
(paren
r_struct
id|pci_dev
op_star
id|pci_dev
)paren
(brace
r_struct
id|atm_dev
op_star
id|atm_dev
suffix:semicolon
r_struct
id|he_dev
op_star
id|he_dev
suffix:semicolon
id|atm_dev
op_assign
id|pci_get_drvdata
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
id|he_dev
op_assign
id|HE_DEV
c_func
(paren
id|atm_dev
)paren
suffix:semicolon
multiline_comment|/* need to remove from he_devs */
id|he_stop
c_func
(paren
id|he_dev
)paren
suffix:semicolon
id|atm_dev_deregister
c_func
(paren
id|atm_dev
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|he_dev
)paren
suffix:semicolon
id|pci_set_drvdata
c_func
(paren
id|pci_dev
comma
l_int|NULL
)paren
suffix:semicolon
id|pci_disable_device
c_func
(paren
id|pci_dev
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|rate_to_atmf
id|rate_to_atmf
c_func
(paren
r_int
id|rate
)paren
multiline_comment|/* cps to atm forum format */
(brace
DECL|macro|NONZERO
mdefine_line|#define NONZERO (1 &lt;&lt; 14)
r_int
id|exp
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rate
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|rate
op_lshift_assign
l_int|9
suffix:semicolon
r_while
c_loop
(paren
id|rate
OG
l_int|0x3ff
)paren
(brace
op_increment
id|exp
suffix:semicolon
id|rate
op_rshift_assign
l_int|1
suffix:semicolon
)brace
r_return
(paren
id|NONZERO
op_or
(paren
id|exp
op_lshift
l_int|9
)paren
op_or
(paren
id|rate
op_amp
l_int|0x1ff
)paren
)paren
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|he_init_rx_lbfp0
id|he_init_rx_lbfp0
c_func
(paren
r_struct
id|he_dev
op_star
id|he_dev
)paren
(brace
r_int
id|i
comma
id|lbm_offset
comma
id|lbufd_index
comma
id|lbuf_addr
comma
id|lbuf_count
suffix:semicolon
r_int
id|lbufs_per_row
op_assign
id|he_dev-&gt;cells_per_row
op_div
id|he_dev-&gt;cells_per_lbuf
suffix:semicolon
r_int
id|lbuf_bufsize
op_assign
id|he_dev-&gt;cells_per_lbuf
op_star
id|ATM_CELL_PAYLOAD
suffix:semicolon
r_int
id|row_offset
op_assign
id|he_dev-&gt;r0_startrow
op_star
id|he_dev-&gt;bytes_per_row
suffix:semicolon
id|lbufd_index
op_assign
l_int|0
suffix:semicolon
id|lbm_offset
op_assign
id|he_readl
c_func
(paren
id|he_dev
comma
id|RCMLBM_BA
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|lbufd_index
comma
id|RLBF0_H
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|lbuf_count
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|he_dev-&gt;r0_numbuffs
suffix:semicolon
op_increment
id|i
)paren
(brace
id|lbufd_index
op_add_assign
l_int|2
suffix:semicolon
id|lbuf_addr
op_assign
(paren
id|row_offset
op_plus
(paren
id|lbuf_count
op_star
id|lbuf_bufsize
)paren
)paren
op_div
l_int|32
suffix:semicolon
id|he_writel_rcm
c_func
(paren
id|he_dev
comma
id|lbuf_addr
comma
id|lbm_offset
)paren
suffix:semicolon
id|he_writel_rcm
c_func
(paren
id|he_dev
comma
id|lbufd_index
comma
id|lbm_offset
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|lbuf_count
op_eq
id|lbufs_per_row
)paren
(brace
id|lbuf_count
op_assign
l_int|0
suffix:semicolon
id|row_offset
op_add_assign
id|he_dev-&gt;bytes_per_row
suffix:semicolon
)brace
id|lbm_offset
op_add_assign
l_int|4
suffix:semicolon
)brace
id|he_writel
c_func
(paren
id|he_dev
comma
id|lbufd_index
op_minus
l_int|2
comma
id|RLBF0_T
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|he_dev-&gt;r0_numbuffs
comma
id|RLBF0_C
)paren
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|he_init_rx_lbfp1
id|he_init_rx_lbfp1
c_func
(paren
r_struct
id|he_dev
op_star
id|he_dev
)paren
(brace
r_int
id|i
comma
id|lbm_offset
comma
id|lbufd_index
comma
id|lbuf_addr
comma
id|lbuf_count
suffix:semicolon
r_int
id|lbufs_per_row
op_assign
id|he_dev-&gt;cells_per_row
op_div
id|he_dev-&gt;cells_per_lbuf
suffix:semicolon
r_int
id|lbuf_bufsize
op_assign
id|he_dev-&gt;cells_per_lbuf
op_star
id|ATM_CELL_PAYLOAD
suffix:semicolon
r_int
id|row_offset
op_assign
id|he_dev-&gt;r1_startrow
op_star
id|he_dev-&gt;bytes_per_row
suffix:semicolon
id|lbufd_index
op_assign
l_int|1
suffix:semicolon
id|lbm_offset
op_assign
id|he_readl
c_func
(paren
id|he_dev
comma
id|RCMLBM_BA
)paren
op_plus
(paren
l_int|2
op_star
id|lbufd_index
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|lbufd_index
comma
id|RLBF1_H
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|lbuf_count
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|he_dev-&gt;r1_numbuffs
suffix:semicolon
op_increment
id|i
)paren
(brace
id|lbufd_index
op_add_assign
l_int|2
suffix:semicolon
id|lbuf_addr
op_assign
(paren
id|row_offset
op_plus
(paren
id|lbuf_count
op_star
id|lbuf_bufsize
)paren
)paren
op_div
l_int|32
suffix:semicolon
id|he_writel_rcm
c_func
(paren
id|he_dev
comma
id|lbuf_addr
comma
id|lbm_offset
)paren
suffix:semicolon
id|he_writel_rcm
c_func
(paren
id|he_dev
comma
id|lbufd_index
comma
id|lbm_offset
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|lbuf_count
op_eq
id|lbufs_per_row
)paren
(brace
id|lbuf_count
op_assign
l_int|0
suffix:semicolon
id|row_offset
op_add_assign
id|he_dev-&gt;bytes_per_row
suffix:semicolon
)brace
id|lbm_offset
op_add_assign
l_int|4
suffix:semicolon
)brace
id|he_writel
c_func
(paren
id|he_dev
comma
id|lbufd_index
op_minus
l_int|2
comma
id|RLBF1_T
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|he_dev-&gt;r1_numbuffs
comma
id|RLBF1_C
)paren
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|he_init_tx_lbfp
id|he_init_tx_lbfp
c_func
(paren
r_struct
id|he_dev
op_star
id|he_dev
)paren
(brace
r_int
id|i
comma
id|lbm_offset
comma
id|lbufd_index
comma
id|lbuf_addr
comma
id|lbuf_count
suffix:semicolon
r_int
id|lbufs_per_row
op_assign
id|he_dev-&gt;cells_per_row
op_div
id|he_dev-&gt;cells_per_lbuf
suffix:semicolon
r_int
id|lbuf_bufsize
op_assign
id|he_dev-&gt;cells_per_lbuf
op_star
id|ATM_CELL_PAYLOAD
suffix:semicolon
r_int
id|row_offset
op_assign
id|he_dev-&gt;tx_startrow
op_star
id|he_dev-&gt;bytes_per_row
suffix:semicolon
id|lbufd_index
op_assign
id|he_dev-&gt;r0_numbuffs
op_plus
id|he_dev-&gt;r1_numbuffs
suffix:semicolon
id|lbm_offset
op_assign
id|he_readl
c_func
(paren
id|he_dev
comma
id|RCMLBM_BA
)paren
op_plus
(paren
l_int|2
op_star
id|lbufd_index
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|lbufd_index
comma
id|TLBF_H
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|lbuf_count
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|he_dev-&gt;tx_numbuffs
suffix:semicolon
op_increment
id|i
)paren
(brace
id|lbufd_index
op_add_assign
l_int|1
suffix:semicolon
id|lbuf_addr
op_assign
(paren
id|row_offset
op_plus
(paren
id|lbuf_count
op_star
id|lbuf_bufsize
)paren
)paren
op_div
l_int|32
suffix:semicolon
id|he_writel_rcm
c_func
(paren
id|he_dev
comma
id|lbuf_addr
comma
id|lbm_offset
)paren
suffix:semicolon
id|he_writel_rcm
c_func
(paren
id|he_dev
comma
id|lbufd_index
comma
id|lbm_offset
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|lbuf_count
op_eq
id|lbufs_per_row
)paren
(brace
id|lbuf_count
op_assign
l_int|0
suffix:semicolon
id|row_offset
op_add_assign
id|he_dev-&gt;bytes_per_row
suffix:semicolon
)brace
id|lbm_offset
op_add_assign
l_int|2
suffix:semicolon
)brace
id|he_writel
c_func
(paren
id|he_dev
comma
id|lbufd_index
op_minus
l_int|1
comma
id|TLBF_T
)paren
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|he_init_tpdrq
id|he_init_tpdrq
c_func
(paren
r_struct
id|he_dev
op_star
id|he_dev
)paren
(brace
id|he_dev-&gt;tpdrq_base
op_assign
id|pci_alloc_consistent
c_func
(paren
id|he_dev-&gt;pci_dev
comma
id|CONFIG_TPDRQ_SIZE
op_star
r_sizeof
(paren
r_struct
id|he_tpdrq
)paren
comma
op_amp
id|he_dev-&gt;tpdrq_phys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;tpdrq_base
op_eq
l_int|NULL
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;failed to alloc tpdrq&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|he_dev-&gt;tpdrq_base
comma
l_int|0
comma
id|CONFIG_TPDRQ_SIZE
op_star
r_sizeof
(paren
r_struct
id|he_tpdrq
)paren
)paren
suffix:semicolon
id|he_dev-&gt;tpdrq_tail
op_assign
id|he_dev-&gt;tpdrq_base
suffix:semicolon
id|he_dev-&gt;tpdrq_head
op_assign
id|he_dev-&gt;tpdrq_base
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|he_dev-&gt;tpdrq_phys
comma
id|TPDRQ_B_H
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0
comma
id|TPDRQ_T
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|CONFIG_TPDRQ_SIZE
op_minus
l_int|1
comma
id|TPDRQ_S
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
id|__init
DECL|function|he_init_cs_block
id|he_init_cs_block
c_func
(paren
r_struct
id|he_dev
op_star
id|he_dev
)paren
(brace
r_int
id|clock
comma
id|rate
comma
id|delta
suffix:semicolon
r_int
id|reg
suffix:semicolon
multiline_comment|/* 5.1.7 cs block initialization */
r_for
c_loop
(paren
id|reg
op_assign
l_int|0
suffix:semicolon
id|reg
OL
l_int|0x20
suffix:semicolon
op_increment
id|reg
)paren
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|CS_STTIM0
op_plus
id|reg
)paren
suffix:semicolon
multiline_comment|/* rate grid timer reload values */
id|clock
op_assign
id|he_is622
c_func
(paren
id|he_dev
)paren
ques
c_cond
l_int|66667000
suffix:colon
l_int|50000000
suffix:semicolon
id|rate
op_assign
id|he_dev-&gt;atm_dev-&gt;link_rate
suffix:semicolon
id|delta
op_assign
id|rate
op_div
l_int|16
op_div
l_int|2
suffix:semicolon
r_for
c_loop
(paren
id|reg
op_assign
l_int|0
suffix:semicolon
id|reg
OL
l_int|0x10
suffix:semicolon
op_increment
id|reg
)paren
(brace
multiline_comment|/* 2.4 internal transmit function&n;&t;&t; *&n;&t; &t; * we initialize the first row in the rate grid.&n;&t;&t; * values are period (in clock cycles) of timer&n;&t;&t; */
r_int
id|period
op_assign
id|clock
op_div
id|rate
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
id|period
comma
id|CS_TGRLD0
op_plus
id|reg
)paren
suffix:semicolon
id|rate
op_sub_assign
id|delta
suffix:semicolon
)brace
r_if
c_cond
(paren
id|he_is622
c_func
(paren
id|he_dev
)paren
)paren
(brace
multiline_comment|/* table 5.2 (4 cells per lbuf) */
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x000800fa
comma
id|CS_ERTHR0
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x000c33cb
comma
id|CS_ERTHR1
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x0010101b
comma
id|CS_ERTHR2
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x00181dac
comma
id|CS_ERTHR3
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x00280600
comma
id|CS_ERTHR4
)paren
suffix:semicolon
multiline_comment|/* table 5.3, 5.4, 5.5, 5.6, 5.7 */
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x023de8b3
comma
id|CS_ERCTL0
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x1801
comma
id|CS_ERCTL1
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x68b3
comma
id|CS_ERCTL2
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x1280
comma
id|CS_ERSTAT0
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x68b3
comma
id|CS_ERSTAT1
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x14585
comma
id|CS_RTFWR
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x4680
comma
id|CS_RTATR
)paren
suffix:semicolon
multiline_comment|/* table 5.8 */
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x00159ece
comma
id|CS_TFBSET
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x68b3
comma
id|CS_WCRMAX
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x5eb3
comma
id|CS_WCRMIN
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0xe8b3
comma
id|CS_WCRINC
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0xdeb3
comma
id|CS_WCRDEC
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x68b3
comma
id|CS_WCRCEIL
)paren
suffix:semicolon
multiline_comment|/* table 5.9 */
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x5
comma
id|CS_OTPPER
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x14
comma
id|CS_OTWPER
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* table 5.1 (4 cells per lbuf) */
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x000400ea
comma
id|CS_ERTHR0
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x00063388
comma
id|CS_ERTHR1
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x00081018
comma
id|CS_ERTHR2
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x000c1dac
comma
id|CS_ERTHR3
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x0014051a
comma
id|CS_ERTHR4
)paren
suffix:semicolon
multiline_comment|/* table 5.3, 5.4, 5.5, 5.6, 5.7 */
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x0235e4b1
comma
id|CS_ERCTL0
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x4701
comma
id|CS_ERCTL1
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x64b1
comma
id|CS_ERCTL2
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x1280
comma
id|CS_ERSTAT0
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x64b1
comma
id|CS_ERSTAT1
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0xf424
comma
id|CS_RTFWR
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x4680
comma
id|CS_RTATR
)paren
suffix:semicolon
multiline_comment|/* table 5.8 */
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x000563b7
comma
id|CS_TFBSET
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x64b1
comma
id|CS_WCRMAX
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x5ab1
comma
id|CS_WCRMIN
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0xe4b1
comma
id|CS_WCRINC
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0xdab1
comma
id|CS_WCRDEC
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x64b1
comma
id|CS_WCRCEIL
)paren
suffix:semicolon
multiline_comment|/* table 5.9 */
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x6
comma
id|CS_OTPPER
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x1e
comma
id|CS_OTWPER
)paren
suffix:semicolon
)brace
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x8
comma
id|CS_OTTLIM
)paren
suffix:semicolon
r_for
c_loop
(paren
id|reg
op_assign
l_int|0
suffix:semicolon
id|reg
OL
l_int|0x8
suffix:semicolon
op_increment
id|reg
)paren
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|CS_HGRRT0
op_plus
id|reg
)paren
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|he_init_cs_block_rcm
id|he_init_cs_block_rcm
c_func
(paren
r_struct
id|he_dev
op_star
id|he_dev
)paren
(brace
r_int
(paren
op_star
id|rategrid
)paren
(braket
l_int|16
)braket
(braket
l_int|16
)braket
suffix:semicolon
r_int
id|rate
comma
id|delta
suffix:semicolon
r_int
id|i
comma
id|j
comma
id|reg
suffix:semicolon
r_int
id|rate_atmf
comma
id|exp
comma
id|man
suffix:semicolon
r_int
r_int
r_int
id|rate_cps
suffix:semicolon
r_int
id|mult
comma
id|buf
comma
id|buf_limit
op_assign
l_int|4
suffix:semicolon
id|rategrid
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_int
)paren
op_star
l_int|16
op_star
l_int|16
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rategrid
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/* initialize rate grid group table */
r_for
c_loop
(paren
id|reg
op_assign
l_int|0x0
suffix:semicolon
id|reg
OL
l_int|0xff
suffix:semicolon
op_increment
id|reg
)paren
id|he_writel_rcm
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|CONFIG_RCMABR
op_plus
id|reg
)paren
suffix:semicolon
multiline_comment|/* initialize rate controller groups */
r_for
c_loop
(paren
id|reg
op_assign
l_int|0x100
suffix:semicolon
id|reg
OL
l_int|0x1ff
suffix:semicolon
op_increment
id|reg
)paren
id|he_writel_rcm
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|CONFIG_RCMABR
op_plus
id|reg
)paren
suffix:semicolon
multiline_comment|/* initialize tNrm lookup table */
multiline_comment|/* the manual makes reference to a routine in a sample driver&n;&t;   for proper configuration; fortunately, we only need this&n;&t;   in order to support abr connection */
multiline_comment|/* initialize rate to group table */
id|rate
op_assign
id|he_dev-&gt;atm_dev-&gt;link_rate
suffix:semicolon
id|delta
op_assign
id|rate
op_div
l_int|32
suffix:semicolon
multiline_comment|/*&n;&t; * 2.4 transmit internal functions&n;&t; * &n;&t; * we construct a copy of the rate grid used by the scheduler&n;&t; * in order to construct the rate to group table below&n;&t; */
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|16
suffix:semicolon
id|j
op_increment
)paren
(brace
(paren
op_star
id|rategrid
)paren
(braket
l_int|0
)braket
(braket
id|j
)braket
op_assign
id|rate
suffix:semicolon
id|rate
op_sub_assign
id|delta
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
l_int|16
suffix:semicolon
id|i
op_increment
)paren
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|16
suffix:semicolon
id|j
op_increment
)paren
r_if
c_cond
(paren
id|i
OG
l_int|14
)paren
(paren
op_star
id|rategrid
)paren
(braket
id|i
)braket
(braket
id|j
)braket
op_assign
(paren
op_star
id|rategrid
)paren
(braket
id|i
op_minus
l_int|1
)braket
(braket
id|j
)braket
op_div
l_int|4
suffix:semicolon
r_else
(paren
op_star
id|rategrid
)paren
(braket
id|i
)braket
(braket
id|j
)braket
op_assign
(paren
op_star
id|rategrid
)paren
(braket
id|i
op_minus
l_int|1
)braket
(braket
id|j
)braket
op_div
l_int|2
suffix:semicolon
multiline_comment|/*&n;&t; * 2.4 transmit internal function&n;&t; *&n;&t; * this table maps the upper 5 bits of exponent and mantissa&n;&t; * of the atm forum representation of the rate into an index&n;&t; * on rate grid  &n;&t; */
id|rate_atmf
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|rate_atmf
OL
l_int|0x400
)paren
(brace
id|man
op_assign
(paren
id|rate_atmf
op_amp
l_int|0x1f
)paren
op_lshift
l_int|4
suffix:semicolon
id|exp
op_assign
id|rate_atmf
op_rshift
l_int|5
suffix:semicolon
multiline_comment|/* &n;&t;&t;&t;instead of &squot;/ 512&squot;, use &squot;&gt;&gt; 9&squot; to prevent a call&n;&t;&t;&t;to divdu3 on x86 platforms&n;&t;&t;*/
id|rate_cps
op_assign
(paren
r_int
r_int
r_int
)paren
(paren
l_int|1
op_lshift
id|exp
)paren
op_star
(paren
id|man
op_plus
l_int|512
)paren
op_rshift
l_int|9
suffix:semicolon
r_if
c_cond
(paren
id|rate_cps
OL
l_int|10
)paren
id|rate_cps
op_assign
l_int|10
suffix:semicolon
multiline_comment|/* 2.2.1 minimum payload rate is 10 cps */
r_for
c_loop
(paren
id|i
op_assign
l_int|255
suffix:semicolon
id|i
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
r_if
c_cond
(paren
(paren
op_star
id|rategrid
)paren
(braket
id|i
op_div
l_int|16
)braket
(braket
id|i
op_mod
l_int|16
)braket
op_ge
id|rate_cps
)paren
r_break
suffix:semicolon
multiline_comment|/* pick nearest rate instead? */
multiline_comment|/*&n;&t;&t; * each table entry is 16 bits: (rate grid index (8 bits)&n;&t;&t; * and a buffer limit (8 bits)&n;&t;&t; * there are two table entries in each 32-bit register&n;&t;&t; */
macro_line|#ifdef notdef
id|buf
op_assign
id|rate_cps
op_star
id|he_dev-&gt;tx_numbuffs
op_div
(paren
id|he_dev-&gt;atm_dev-&gt;link_rate
op_star
l_int|2
)paren
suffix:semicolon
macro_line|#else
multiline_comment|/* this is pretty, but avoids _divdu3 and is mostly correct */
id|mult
op_assign
id|he_dev-&gt;atm_dev-&gt;link_rate
op_div
id|ATM_OC3_PCR
suffix:semicolon
r_if
c_cond
(paren
id|rate_cps
OG
(paren
l_int|272
op_star
id|mult
)paren
)paren
id|buf
op_assign
l_int|4
suffix:semicolon
r_else
r_if
c_cond
(paren
id|rate_cps
OG
(paren
l_int|204
op_star
id|mult
)paren
)paren
id|buf
op_assign
l_int|3
suffix:semicolon
r_else
r_if
c_cond
(paren
id|rate_cps
OG
(paren
l_int|136
op_star
id|mult
)paren
)paren
id|buf
op_assign
l_int|2
suffix:semicolon
r_else
r_if
c_cond
(paren
id|rate_cps
OG
(paren
l_int|68
op_star
id|mult
)paren
)paren
id|buf
op_assign
l_int|1
suffix:semicolon
r_else
id|buf
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|buf
OG
id|buf_limit
)paren
id|buf
op_assign
id|buf_limit
suffix:semicolon
id|reg
op_assign
(paren
id|reg
op_lshift
l_int|16
)paren
op_or
(paren
(paren
id|i
op_lshift
l_int|8
)paren
op_or
id|buf
)paren
suffix:semicolon
DECL|macro|RTGTBL_OFFSET
mdefine_line|#define RTGTBL_OFFSET 0x400
r_if
c_cond
(paren
id|rate_atmf
op_amp
l_int|0x1
)paren
id|he_writel_rcm
c_func
(paren
id|he_dev
comma
id|reg
comma
id|CONFIG_RCMABR
op_plus
id|RTGTBL_OFFSET
op_plus
(paren
id|rate_atmf
op_rshift
l_int|1
)paren
)paren
suffix:semicolon
op_increment
id|rate_atmf
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|rategrid
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|he_init_group
id|he_init_group
c_func
(paren
r_struct
id|he_dev
op_star
id|he_dev
comma
r_int
id|group
)paren
(brace
r_int
id|i
suffix:semicolon
macro_line|#ifdef USE_RBPS
multiline_comment|/* small buffer pool */
macro_line|#ifdef USE_RBPS_POOL
id|he_dev-&gt;rbps_pool
op_assign
id|pci_pool_create
c_func
(paren
l_string|&quot;rbps&quot;
comma
id|he_dev-&gt;pci_dev
comma
id|CONFIG_RBPS_BUFSIZE
comma
l_int|8
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;rbps_pool
op_eq
l_int|NULL
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;unable to create rbps pages&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
macro_line|#else /* !USE_RBPS_POOL */
id|he_dev-&gt;rbps_pages
op_assign
id|pci_alloc_consistent
c_func
(paren
id|he_dev-&gt;pci_dev
comma
id|CONFIG_RBPS_SIZE
op_star
id|CONFIG_RBPS_BUFSIZE
comma
op_amp
id|he_dev-&gt;rbps_pages_phys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;rbps_pages
op_eq
l_int|NULL
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;unable to create rbps page pool&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
macro_line|#endif /* USE_RBPS_POOL */
id|he_dev-&gt;rbps_base
op_assign
id|pci_alloc_consistent
c_func
(paren
id|he_dev-&gt;pci_dev
comma
id|CONFIG_RBPS_SIZE
op_star
r_sizeof
(paren
r_struct
id|he_rbp
)paren
comma
op_amp
id|he_dev-&gt;rbps_phys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;rbps_base
op_eq
l_int|NULL
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;failed to alloc rbps&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|he_dev-&gt;rbps_base
comma
l_int|0
comma
id|CONFIG_RBPS_SIZE
op_star
r_sizeof
(paren
r_struct
id|he_rbp
)paren
)paren
suffix:semicolon
id|he_dev-&gt;rbps_virt
op_assign
id|kmalloc
c_func
(paren
id|CONFIG_RBPS_SIZE
op_star
r_sizeof
(paren
r_struct
id|he_virt
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CONFIG_RBPS_SIZE
suffix:semicolon
op_increment
id|i
)paren
(brace
id|dma_addr_t
id|dma_handle
suffix:semicolon
r_void
op_star
id|cpuaddr
suffix:semicolon
macro_line|#ifdef USE_RBPS_POOL 
id|cpuaddr
op_assign
id|pci_pool_alloc
c_func
(paren
id|he_dev-&gt;rbps_pool
comma
id|SLAB_KERNEL
op_or
id|SLAB_DMA
comma
op_amp
id|dma_handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpuaddr
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
macro_line|#else
id|cpuaddr
op_assign
id|he_dev-&gt;rbps_pages
op_plus
(paren
id|i
op_star
id|CONFIG_RBPS_BUFSIZE
)paren
suffix:semicolon
id|dma_handle
op_assign
id|he_dev-&gt;rbps_pages_phys
op_plus
(paren
id|i
op_star
id|CONFIG_RBPS_BUFSIZE
)paren
suffix:semicolon
macro_line|#endif
id|he_dev-&gt;rbps_virt
(braket
id|i
)braket
dot
id|virt
op_assign
id|cpuaddr
suffix:semicolon
id|he_dev-&gt;rbps_base
(braket
id|i
)braket
dot
id|status
op_assign
id|RBP_LOANED
op_or
id|RBP_SMALLBUF
op_or
(paren
id|i
op_lshift
id|RBP_INDEX_OFF
)paren
suffix:semicolon
id|he_dev-&gt;rbps_base
(braket
id|i
)braket
dot
id|phys
op_assign
id|dma_handle
suffix:semicolon
)brace
id|he_dev-&gt;rbps_tail
op_assign
op_amp
id|he_dev-&gt;rbps_base
(braket
id|CONFIG_RBPS_SIZE
op_minus
l_int|1
)braket
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|he_dev-&gt;rbps_phys
comma
id|G0_RBPS_S
op_plus
(paren
id|group
op_star
l_int|32
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|RBPS_MASK
c_func
(paren
id|he_dev-&gt;rbps_tail
)paren
comma
id|G0_RBPS_T
op_plus
(paren
id|group
op_star
l_int|32
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|CONFIG_RBPS_BUFSIZE
op_div
l_int|4
comma
id|G0_RBPS_BS
op_plus
(paren
id|group
op_star
l_int|32
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|RBP_THRESH
c_func
(paren
id|CONFIG_RBPS_THRESH
)paren
op_or
id|RBP_QSIZE
c_func
(paren
id|CONFIG_RBPS_SIZE
op_minus
l_int|1
)paren
op_or
id|RBP_INT_ENB
comma
id|G0_RBPS_QI
op_plus
(paren
id|group
op_star
l_int|32
)paren
)paren
suffix:semicolon
macro_line|#else /* !USE_RBPS */
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|G0_RBPS_S
op_plus
(paren
id|group
op_star
l_int|32
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|G0_RBPS_T
op_plus
(paren
id|group
op_star
l_int|32
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|G0_RBPS_QI
op_plus
(paren
id|group
op_star
l_int|32
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|RBP_THRESH
c_func
(paren
l_int|0x1
)paren
op_or
id|RBP_QSIZE
c_func
(paren
l_int|0x0
)paren
comma
id|G0_RBPS_BS
op_plus
(paren
id|group
op_star
l_int|32
)paren
)paren
suffix:semicolon
macro_line|#endif /* USE_RBPS */
multiline_comment|/* large buffer pool */
macro_line|#ifdef USE_RBPL_POOL
id|he_dev-&gt;rbpl_pool
op_assign
id|pci_pool_create
c_func
(paren
l_string|&quot;rbpl&quot;
comma
id|he_dev-&gt;pci_dev
comma
id|CONFIG_RBPL_BUFSIZE
comma
l_int|8
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;rbpl_pool
op_eq
l_int|NULL
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;unable to create rbpl pool&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
macro_line|#else /* !USE_RBPL_POOL */
id|he_dev-&gt;rbpl_pages
op_assign
(paren
r_void
op_star
)paren
id|pci_alloc_consistent
c_func
(paren
id|he_dev-&gt;pci_dev
comma
id|CONFIG_RBPL_SIZE
op_star
id|CONFIG_RBPL_BUFSIZE
comma
op_amp
id|he_dev-&gt;rbpl_pages_phys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;rbpl_pages
op_eq
l_int|NULL
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;unable to create rbpl pages&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
macro_line|#endif /* USE_RBPL_POOL */
id|he_dev-&gt;rbpl_base
op_assign
id|pci_alloc_consistent
c_func
(paren
id|he_dev-&gt;pci_dev
comma
id|CONFIG_RBPL_SIZE
op_star
r_sizeof
(paren
r_struct
id|he_rbp
)paren
comma
op_amp
id|he_dev-&gt;rbpl_phys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;rbpl_base
op_eq
l_int|NULL
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;failed to alloc rbpl&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|he_dev-&gt;rbpl_base
comma
l_int|0
comma
id|CONFIG_RBPL_SIZE
op_star
r_sizeof
(paren
r_struct
id|he_rbp
)paren
)paren
suffix:semicolon
id|he_dev-&gt;rbpl_virt
op_assign
id|kmalloc
c_func
(paren
id|CONFIG_RBPL_SIZE
op_star
r_sizeof
(paren
r_struct
id|he_virt
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CONFIG_RBPL_SIZE
suffix:semicolon
op_increment
id|i
)paren
(brace
id|dma_addr_t
id|dma_handle
suffix:semicolon
r_void
op_star
id|cpuaddr
suffix:semicolon
macro_line|#ifdef USE_RBPL_POOL
id|cpuaddr
op_assign
id|pci_pool_alloc
c_func
(paren
id|he_dev-&gt;rbpl_pool
comma
id|SLAB_KERNEL
op_or
id|SLAB_DMA
comma
op_amp
id|dma_handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cpuaddr
op_eq
l_int|NULL
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
macro_line|#else
id|cpuaddr
op_assign
id|he_dev-&gt;rbpl_pages
op_plus
(paren
id|i
op_star
id|CONFIG_RBPL_BUFSIZE
)paren
suffix:semicolon
id|dma_handle
op_assign
id|he_dev-&gt;rbpl_pages_phys
op_plus
(paren
id|i
op_star
id|CONFIG_RBPL_BUFSIZE
)paren
suffix:semicolon
macro_line|#endif
id|he_dev-&gt;rbpl_virt
(braket
id|i
)braket
dot
id|virt
op_assign
id|cpuaddr
suffix:semicolon
id|he_dev-&gt;rbpl_base
(braket
id|i
)braket
dot
id|status
op_assign
id|RBP_LOANED
op_or
(paren
id|i
op_lshift
id|RBP_INDEX_OFF
)paren
suffix:semicolon
id|he_dev-&gt;rbpl_base
(braket
id|i
)braket
dot
id|phys
op_assign
id|dma_handle
suffix:semicolon
)brace
id|he_dev-&gt;rbpl_tail
op_assign
op_amp
id|he_dev-&gt;rbpl_base
(braket
id|CONFIG_RBPL_SIZE
op_minus
l_int|1
)braket
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|he_dev-&gt;rbpl_phys
comma
id|G0_RBPL_S
op_plus
(paren
id|group
op_star
l_int|32
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|RBPL_MASK
c_func
(paren
id|he_dev-&gt;rbpl_tail
)paren
comma
id|G0_RBPL_T
op_plus
(paren
id|group
op_star
l_int|32
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|CONFIG_RBPL_BUFSIZE
op_div
l_int|4
comma
id|G0_RBPL_BS
op_plus
(paren
id|group
op_star
l_int|32
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|RBP_THRESH
c_func
(paren
id|CONFIG_RBPL_THRESH
)paren
op_or
id|RBP_QSIZE
c_func
(paren
id|CONFIG_RBPL_SIZE
op_minus
l_int|1
)paren
op_or
id|RBP_INT_ENB
comma
id|G0_RBPL_QI
op_plus
(paren
id|group
op_star
l_int|32
)paren
)paren
suffix:semicolon
multiline_comment|/* rx buffer ready queue */
id|he_dev-&gt;rbrq_base
op_assign
id|pci_alloc_consistent
c_func
(paren
id|he_dev-&gt;pci_dev
comma
id|CONFIG_RBRQ_SIZE
op_star
r_sizeof
(paren
r_struct
id|he_rbrq
)paren
comma
op_amp
id|he_dev-&gt;rbrq_phys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;rbrq_base
op_eq
l_int|NULL
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;failed to allocate rbrq&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|he_dev-&gt;rbrq_base
comma
l_int|0
comma
id|CONFIG_RBRQ_SIZE
op_star
r_sizeof
(paren
r_struct
id|he_rbrq
)paren
)paren
suffix:semicolon
id|he_dev-&gt;rbrq_head
op_assign
id|he_dev-&gt;rbrq_base
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|he_dev-&gt;rbrq_phys
comma
id|G0_RBRQ_ST
op_plus
(paren
id|group
op_star
l_int|16
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0
comma
id|G0_RBRQ_H
op_plus
(paren
id|group
op_star
l_int|16
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|RBRQ_THRESH
c_func
(paren
id|CONFIG_RBRQ_THRESH
)paren
op_or
id|RBRQ_SIZE
c_func
(paren
id|CONFIG_RBRQ_SIZE
op_minus
l_int|1
)paren
comma
id|G0_RBRQ_Q
op_plus
(paren
id|group
op_star
l_int|16
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|irq_coalesce
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;coalescing interrupts&bslash;n&quot;
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|RBRQ_TIME
c_func
(paren
l_int|768
)paren
op_or
id|RBRQ_COUNT
c_func
(paren
l_int|7
)paren
comma
id|G0_RBRQ_I
op_plus
(paren
id|group
op_star
l_int|16
)paren
)paren
suffix:semicolon
)brace
r_else
id|he_writel
c_func
(paren
id|he_dev
comma
id|RBRQ_TIME
c_func
(paren
l_int|0
)paren
op_or
id|RBRQ_COUNT
c_func
(paren
l_int|1
)paren
comma
id|G0_RBRQ_I
op_plus
(paren
id|group
op_star
l_int|16
)paren
)paren
suffix:semicolon
multiline_comment|/* tx buffer ready queue */
id|he_dev-&gt;tbrq_base
op_assign
id|pci_alloc_consistent
c_func
(paren
id|he_dev-&gt;pci_dev
comma
id|CONFIG_TBRQ_SIZE
op_star
r_sizeof
(paren
r_struct
id|he_tbrq
)paren
comma
op_amp
id|he_dev-&gt;tbrq_phys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;tbrq_base
op_eq
l_int|NULL
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;failed to allocate tbrq&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|he_dev-&gt;tbrq_base
comma
l_int|0
comma
id|CONFIG_TBRQ_SIZE
op_star
r_sizeof
(paren
r_struct
id|he_tbrq
)paren
)paren
suffix:semicolon
id|he_dev-&gt;tbrq_head
op_assign
id|he_dev-&gt;tbrq_base
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|he_dev-&gt;tbrq_phys
comma
id|G0_TBRQ_B_T
op_plus
(paren
id|group
op_star
l_int|16
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0
comma
id|G0_TBRQ_H
op_plus
(paren
id|group
op_star
l_int|16
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|CONFIG_TBRQ_SIZE
op_minus
l_int|1
comma
id|G0_TBRQ_S
op_plus
(paren
id|group
op_star
l_int|16
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|CONFIG_TBRQ_THRESH
comma
id|G0_TBRQ_THRESH
op_plus
(paren
id|group
op_star
l_int|16
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|he_init_irq
id|he_init_irq
c_func
(paren
r_struct
id|he_dev
op_star
id|he_dev
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* 2.9.3.5  tail offset for each interrupt queue is located after the&n;&t;&t;    end of the interrupt queue */
id|he_dev-&gt;irq_base
op_assign
id|pci_alloc_consistent
c_func
(paren
id|he_dev-&gt;pci_dev
comma
(paren
id|CONFIG_IRQ_SIZE
op_plus
l_int|1
)paren
op_star
r_sizeof
(paren
r_struct
id|he_irq
)paren
comma
op_amp
id|he_dev-&gt;irq_phys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;irq_base
op_eq
l_int|NULL
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;failed to allocate irq&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|he_dev-&gt;irq_tailoffset
op_assign
(paren
r_int
op_star
)paren
op_amp
id|he_dev-&gt;irq_base
(braket
id|CONFIG_IRQ_SIZE
)braket
suffix:semicolon
op_star
id|he_dev-&gt;irq_tailoffset
op_assign
l_int|0
suffix:semicolon
id|he_dev-&gt;irq_head
op_assign
id|he_dev-&gt;irq_base
suffix:semicolon
id|he_dev-&gt;irq_tail
op_assign
id|he_dev-&gt;irq_base
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CONFIG_IRQ_SIZE
suffix:semicolon
op_increment
id|i
)paren
id|he_dev-&gt;irq_base
(braket
id|i
)braket
dot
id|isw
op_assign
id|ITYPE_INVALID
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|he_dev-&gt;irq_phys
comma
id|IRQ0_BASE
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|IRQ_SIZE
c_func
(paren
id|CONFIG_IRQ_SIZE
)paren
op_or
id|IRQ_THRESH
c_func
(paren
id|CONFIG_IRQ_THRESH
)paren
comma
id|IRQ0_HEAD
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|IRQ_INT_A
op_or
id|IRQ_TYPE_LINE
comma
id|IRQ0_CNTL
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|IRQ0_DATA
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|IRQ1_BASE
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|IRQ1_HEAD
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|IRQ1_CNTL
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|IRQ1_DATA
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|IRQ2_BASE
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|IRQ2_HEAD
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|IRQ2_CNTL
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|IRQ2_DATA
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|IRQ3_BASE
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|IRQ3_HEAD
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|IRQ3_CNTL
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|IRQ3_DATA
)paren
suffix:semicolon
multiline_comment|/* 2.9.3.2 interrupt queue mapping registers */
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|GRP_10_MAP
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|GRP_32_MAP
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|GRP_54_MAP
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|GRP_76_MAP
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|he_dev-&gt;pci_dev-&gt;irq
comma
id|he_irq_handler
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
id|DEV_LABEL
comma
id|he_dev
)paren
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;irq %d already in use&bslash;n&quot;
comma
id|he_dev-&gt;pci_dev-&gt;irq
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|he_dev-&gt;irq
op_assign
id|he_dev-&gt;pci_dev-&gt;irq
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
id|__init
DECL|function|he_start
id|he_start
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
)paren
(brace
r_struct
id|he_dev
op_star
id|he_dev
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pci_dev
suffix:semicolon
r_int
r_int
id|membase
suffix:semicolon
id|u16
id|command
suffix:semicolon
id|u32
id|gen_cntl_0
comma
id|host_cntl
comma
id|lb_swap
suffix:semicolon
id|u8
id|cache_size
comma
id|timer
suffix:semicolon
r_int
id|err
suffix:semicolon
r_int
r_int
id|status
comma
id|reg
suffix:semicolon
r_int
id|i
comma
id|group
suffix:semicolon
id|he_dev
op_assign
id|HE_DEV
c_func
(paren
id|dev
)paren
suffix:semicolon
id|pci_dev
op_assign
id|he_dev-&gt;pci_dev
suffix:semicolon
id|membase
op_assign
id|pci_resource_start
c_func
(paren
id|pci_dev
comma
l_int|0
)paren
suffix:semicolon
id|HPRINTK
c_func
(paren
l_string|&quot;membase = 0x%lx  irq = %d.&bslash;n&quot;
comma
id|membase
comma
id|pci_dev-&gt;irq
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * pci bus controller initialization &n;&t; */
multiline_comment|/* 4.3 pci bus controller-specific initialization */
r_if
c_cond
(paren
id|pci_read_config_dword
c_func
(paren
id|pci_dev
comma
id|GEN_CNTL_0
comma
op_amp
id|gen_cntl_0
)paren
op_ne
l_int|0
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;can&squot;t read GEN_CNTL_0&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|gen_cntl_0
op_or_assign
(paren
id|MRL_ENB
op_or
id|MRM_ENB
op_or
id|IGNORE_TIMEOUT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_write_config_dword
c_func
(paren
id|pci_dev
comma
id|GEN_CNTL_0
comma
id|gen_cntl_0
)paren
op_ne
l_int|0
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;can&squot;t write GEN_CNTL_0.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_read_config_word
c_func
(paren
id|pci_dev
comma
id|PCI_COMMAND
comma
op_amp
id|command
)paren
op_ne
l_int|0
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;can&squot;t read PCI_COMMAND.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|command
op_or_assign
(paren
id|PCI_COMMAND_MEMORY
op_or
id|PCI_COMMAND_MASTER
op_or
id|PCI_COMMAND_INVALIDATE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_write_config_word
c_func
(paren
id|pci_dev
comma
id|PCI_COMMAND
comma
id|command
)paren
op_ne
l_int|0
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;can&squot;t enable memory.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_read_config_byte
c_func
(paren
id|pci_dev
comma
id|PCI_CACHE_LINE_SIZE
comma
op_amp
id|cache_size
)paren
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;can&squot;t read cache line size?&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cache_size
OL
l_int|16
)paren
(brace
id|cache_size
op_assign
l_int|16
suffix:semicolon
r_if
c_cond
(paren
id|pci_write_config_byte
c_func
(paren
id|pci_dev
comma
id|PCI_CACHE_LINE_SIZE
comma
id|cache_size
)paren
)paren
id|hprintk
c_func
(paren
l_string|&quot;can&squot;t set cache line size to %d&bslash;n&quot;
comma
id|cache_size
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_read_config_byte
c_func
(paren
id|pci_dev
comma
id|PCI_LATENCY_TIMER
comma
op_amp
id|timer
)paren
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;can&squot;t read latency timer?&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* from table 3.9&n;&t; *&n;&t; * LAT_TIMER = 1 + AVG_LAT + BURST_SIZE/BUS_SIZE&n;&t; * &n;&t; * AVG_LAT: The average first data read/write latency [maximum 16 clock cycles]&n;&t; * BURST_SIZE: 1536 bytes (read) for 622, 768 bytes (read) for 155 [192 clock cycles]&n;&t; *&n;&t; */
DECL|macro|LAT_TIMER
mdefine_line|#define LAT_TIMER 209
r_if
c_cond
(paren
id|timer
OL
id|LAT_TIMER
)paren
(brace
id|HPRINTK
c_func
(paren
l_string|&quot;latency timer was %d, setting to %d&bslash;n&quot;
comma
id|timer
comma
id|LAT_TIMER
)paren
suffix:semicolon
id|timer
op_assign
id|LAT_TIMER
suffix:semicolon
r_if
c_cond
(paren
id|pci_write_config_byte
c_func
(paren
id|pci_dev
comma
id|PCI_LATENCY_TIMER
comma
id|timer
)paren
)paren
id|hprintk
c_func
(paren
l_string|&quot;can&squot;t set latency timer to %d&bslash;n&quot;
comma
id|timer
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|he_dev-&gt;membase
op_assign
id|ioremap
c_func
(paren
id|membase
comma
id|HE_REGMAP_SIZE
)paren
)paren
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;can&squot;t set up page mapping&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* 4.4 card reset */
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|RESET_CNTL
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0xff
comma
id|RESET_CNTL
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|16
op_star
l_int|1000
)paren
suffix:semicolon
multiline_comment|/* 16 ms */
id|status
op_assign
id|he_readl
c_func
(paren
id|he_dev
comma
id|RESET_CNTL
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|status
op_amp
id|BOARD_RST_STATUS
)paren
op_eq
l_int|0
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;reset failed&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
multiline_comment|/* 4.5 set bus width */
id|host_cntl
op_assign
id|he_readl
c_func
(paren
id|he_dev
comma
id|HOST_CNTL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|host_cntl
op_amp
id|PCI_BUS_SIZE64
)paren
id|gen_cntl_0
op_or_assign
id|ENBL_64
suffix:semicolon
r_else
id|gen_cntl_0
op_and_assign
op_complement
id|ENBL_64
suffix:semicolon
r_if
c_cond
(paren
id|disable64
op_eq
l_int|1
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;disabling 64-bit pci bus transfers&bslash;n&quot;
)paren
suffix:semicolon
id|gen_cntl_0
op_and_assign
op_complement
id|ENBL_64
suffix:semicolon
)brace
r_if
c_cond
(paren
id|gen_cntl_0
op_amp
id|ENBL_64
)paren
id|hprintk
c_func
(paren
l_string|&quot;64-bit transfers enabled&bslash;n&quot;
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pci_dev
comma
id|GEN_CNTL_0
comma
id|gen_cntl_0
)paren
suffix:semicolon
multiline_comment|/* 4.7 read prom contents */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|PROD_ID_LEN
suffix:semicolon
op_increment
id|i
)paren
id|he_dev-&gt;prod_id
(braket
id|i
)braket
op_assign
id|read_prom_byte
c_func
(paren
id|he_dev
comma
id|PROD_ID
op_plus
id|i
)paren
suffix:semicolon
id|he_dev-&gt;media
op_assign
id|read_prom_byte
c_func
(paren
id|he_dev
comma
id|MEDIA
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|6
suffix:semicolon
op_increment
id|i
)paren
id|dev-&gt;esi
(braket
id|i
)braket
op_assign
id|read_prom_byte
c_func
(paren
id|he_dev
comma
id|MAC_ADDR
op_plus
id|i
)paren
suffix:semicolon
id|hprintk
c_func
(paren
l_string|&quot;%s%s, %x:%x:%x:%x:%x:%x&bslash;n&quot;
comma
id|he_dev-&gt;prod_id
comma
id|he_dev-&gt;media
op_amp
l_int|0x40
ques
c_cond
l_string|&quot;SM&quot;
suffix:colon
l_string|&quot;MM&quot;
comma
id|dev-&gt;esi
(braket
l_int|0
)braket
comma
id|dev-&gt;esi
(braket
l_int|1
)braket
comma
id|dev-&gt;esi
(braket
l_int|2
)braket
comma
id|dev-&gt;esi
(braket
l_int|3
)braket
comma
id|dev-&gt;esi
(braket
l_int|4
)braket
comma
id|dev-&gt;esi
(braket
l_int|5
)braket
)paren
suffix:semicolon
id|he_dev-&gt;atm_dev-&gt;link_rate
op_assign
id|he_is622
c_func
(paren
id|he_dev
)paren
ques
c_cond
id|ATM_OC12_PCR
suffix:colon
id|ATM_OC3_PCR
suffix:semicolon
multiline_comment|/* 4.6 set host endianess */
id|lb_swap
op_assign
id|he_readl
c_func
(paren
id|he_dev
comma
id|LB_SWAP
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_is622
c_func
(paren
id|he_dev
)paren
)paren
id|lb_swap
op_and_assign
op_complement
id|XFER_SIZE
suffix:semicolon
multiline_comment|/* 4 cells */
r_else
id|lb_swap
op_or_assign
id|XFER_SIZE
suffix:semicolon
multiline_comment|/* 8 cells */
macro_line|#ifdef __BIG_ENDIAN
id|lb_swap
op_or_assign
id|DESC_WR_SWAP
op_or
id|INTR_SWAP
op_or
id|BIG_ENDIAN_HOST
suffix:semicolon
macro_line|#else
id|lb_swap
op_and_assign
op_complement
(paren
id|DESC_WR_SWAP
op_or
id|INTR_SWAP
op_or
id|BIG_ENDIAN_HOST
op_or
id|DATA_WR_SWAP
op_or
id|DATA_RD_SWAP
op_or
id|DESC_RD_SWAP
)paren
suffix:semicolon
macro_line|#endif /* __BIG_ENDIAN */
id|he_writel
c_func
(paren
id|he_dev
comma
id|lb_swap
comma
id|LB_SWAP
)paren
suffix:semicolon
multiline_comment|/* 4.8 sdram controller initialization */
id|he_writel
c_func
(paren
id|he_dev
comma
id|he_is622
c_func
(paren
id|he_dev
)paren
ques
c_cond
id|LB_64_ENB
suffix:colon
l_int|0x0
comma
id|SDRAM_CTL
)paren
suffix:semicolon
multiline_comment|/* 4.9 initialize rnum value */
id|lb_swap
op_or_assign
id|SWAP_RNUM_MAX
c_func
(paren
l_int|0xf
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|lb_swap
comma
id|LB_SWAP
)paren
suffix:semicolon
multiline_comment|/* 4.10 initialize the interrupt queues */
r_if
c_cond
(paren
(paren
id|err
op_assign
id|he_init_irq
c_func
(paren
id|he_dev
)paren
)paren
op_ne
l_int|0
)paren
r_return
id|err
suffix:semicolon
macro_line|#ifdef USE_TASKLET
id|tasklet_init
c_func
(paren
op_amp
id|he_dev-&gt;tasklet
comma
id|he_tasklet
comma
(paren
r_int
r_int
)paren
id|he_dev
)paren
suffix:semicolon
macro_line|#endif
id|spin_lock_init
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
)paren
suffix:semicolon
multiline_comment|/* 4.11 enable pci bus controller state machines */
id|host_cntl
op_or_assign
(paren
id|OUTFF_ENB
op_or
id|CMDFF_ENB
op_or
id|QUICK_RD_RETRY
op_or
id|QUICK_WR_RETRY
op_or
id|PERR_INT_ENB
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|host_cntl
comma
id|HOST_CNTL
)paren
suffix:semicolon
id|gen_cntl_0
op_or_assign
id|INT_PROC_ENBL
op_or
id|INIT_ENB
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pci_dev
comma
id|GEN_CNTL_0
comma
id|gen_cntl_0
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * atm network controller initialization&n;&t; */
multiline_comment|/* 5.1.1 generic configuration state */
multiline_comment|/*&n;&t; *&t;&t;local (cell) buffer memory map&n;&t; *                    &n;&t; *             HE155                          HE622&n;&t; *                                                      &n;&t; *        0 ____________1023 bytes  0 _______________________2047 bytes&n;&t; *         |            |            |                   |   |&n;&t; *         |  utility   |            |        rx0        |   |&n;&t; *        5|____________|         255|___________________| u |&n;&t; *        6|            |         256|                   | t |&n;&t; *         |            |            |                   | i |&n;&t; *         |    rx0     |     row    |        tx         | l |&n;&t; *         |            |            |                   | i |&n;&t; *         |            |         767|___________________| t |&n;&t; *      517|____________|         768|                   | y |&n;&t; * row  518|            |            |        rx1        |   |&n;&t; *         |            |        1023|___________________|___|&n;&t; *         |            |&n;&t; *         |    tx      |&n;&t; *         |            |&n;&t; *         |            |&n;&t; *     1535|____________|&n;&t; *     1536|            |&n;&t; *         |    rx1     |&n;&t; *     2047|____________|&n;&t; *&n;&t; */
multiline_comment|/* total 4096 connections */
id|he_dev-&gt;vcibits
op_assign
id|CONFIG_DEFAULT_VCIBITS
suffix:semicolon
id|he_dev-&gt;vpibits
op_assign
id|CONFIG_DEFAULT_VPIBITS
suffix:semicolon
r_if
c_cond
(paren
id|nvpibits
op_ne
op_minus
l_int|1
op_logical_and
id|nvcibits
op_ne
op_minus
l_int|1
op_logical_and
id|nvpibits
op_plus
id|nvcibits
op_ne
id|HE_MAXCIDBITS
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;nvpibits + nvcibits != %d&bslash;n&quot;
comma
id|HE_MAXCIDBITS
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nvpibits
op_ne
op_minus
l_int|1
)paren
(brace
id|he_dev-&gt;vpibits
op_assign
id|nvpibits
suffix:semicolon
id|he_dev-&gt;vcibits
op_assign
id|HE_MAXCIDBITS
op_minus
id|nvpibits
suffix:semicolon
)brace
r_if
c_cond
(paren
id|nvcibits
op_ne
op_minus
l_int|1
)paren
(brace
id|he_dev-&gt;vcibits
op_assign
id|nvcibits
suffix:semicolon
id|he_dev-&gt;vpibits
op_assign
id|HE_MAXCIDBITS
op_minus
id|nvcibits
suffix:semicolon
)brace
r_if
c_cond
(paren
id|he_is622
c_func
(paren
id|he_dev
)paren
)paren
(brace
id|he_dev-&gt;cells_per_row
op_assign
l_int|40
suffix:semicolon
id|he_dev-&gt;bytes_per_row
op_assign
l_int|2048
suffix:semicolon
id|he_dev-&gt;r0_numrows
op_assign
l_int|256
suffix:semicolon
id|he_dev-&gt;tx_numrows
op_assign
l_int|512
suffix:semicolon
id|he_dev-&gt;r1_numrows
op_assign
l_int|256
suffix:semicolon
id|he_dev-&gt;r0_startrow
op_assign
l_int|0
suffix:semicolon
id|he_dev-&gt;tx_startrow
op_assign
l_int|256
suffix:semicolon
id|he_dev-&gt;r1_startrow
op_assign
l_int|768
suffix:semicolon
)brace
r_else
(brace
id|he_dev-&gt;cells_per_row
op_assign
l_int|20
suffix:semicolon
id|he_dev-&gt;bytes_per_row
op_assign
l_int|1024
suffix:semicolon
id|he_dev-&gt;r0_numrows
op_assign
l_int|512
suffix:semicolon
id|he_dev-&gt;tx_numrows
op_assign
l_int|1018
suffix:semicolon
id|he_dev-&gt;r1_numrows
op_assign
l_int|512
suffix:semicolon
id|he_dev-&gt;r0_startrow
op_assign
l_int|6
suffix:semicolon
id|he_dev-&gt;tx_startrow
op_assign
l_int|518
suffix:semicolon
id|he_dev-&gt;r1_startrow
op_assign
l_int|1536
suffix:semicolon
)brace
id|he_dev-&gt;cells_per_lbuf
op_assign
l_int|4
suffix:semicolon
id|he_dev-&gt;buffer_limit
op_assign
l_int|4
suffix:semicolon
id|he_dev-&gt;r0_numbuffs
op_assign
id|he_dev-&gt;r0_numrows
op_star
id|he_dev-&gt;cells_per_row
op_div
id|he_dev-&gt;cells_per_lbuf
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;r0_numbuffs
OG
l_int|2560
)paren
id|he_dev-&gt;r0_numbuffs
op_assign
l_int|2560
suffix:semicolon
id|he_dev-&gt;r1_numbuffs
op_assign
id|he_dev-&gt;r1_numrows
op_star
id|he_dev-&gt;cells_per_row
op_div
id|he_dev-&gt;cells_per_lbuf
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;r1_numbuffs
OG
l_int|2560
)paren
id|he_dev-&gt;r1_numbuffs
op_assign
l_int|2560
suffix:semicolon
id|he_dev-&gt;tx_numbuffs
op_assign
id|he_dev-&gt;tx_numrows
op_star
id|he_dev-&gt;cells_per_row
op_div
id|he_dev-&gt;cells_per_lbuf
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;tx_numbuffs
OG
l_int|5120
)paren
id|he_dev-&gt;tx_numbuffs
op_assign
l_int|5120
suffix:semicolon
multiline_comment|/* 5.1.2 configure hardware dependent registers */
id|he_writel
c_func
(paren
id|he_dev
comma
id|SLICE_X
c_func
(paren
l_int|0x2
)paren
op_or
id|ARB_RNUM_MAX
c_func
(paren
l_int|0xf
)paren
op_or
id|TH_PRTY
c_func
(paren
l_int|0x3
)paren
op_or
id|RH_PRTY
c_func
(paren
l_int|0x3
)paren
op_or
id|TL_PRTY
c_func
(paren
l_int|0x2
)paren
op_or
id|RL_PRTY
c_func
(paren
l_int|0x1
)paren
op_or
(paren
id|he_is622
c_func
(paren
id|he_dev
)paren
ques
c_cond
id|BUS_MULTI
c_func
(paren
l_int|0x28
)paren
suffix:colon
id|BUS_MULTI
c_func
(paren
l_int|0x46
)paren
)paren
op_or
(paren
id|he_is622
c_func
(paren
id|he_dev
)paren
ques
c_cond
id|NET_PREF
c_func
(paren
l_int|0x50
)paren
suffix:colon
id|NET_PREF
c_func
(paren
l_int|0x8c
)paren
)paren
comma
id|LBARB
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|BANK_ON
op_or
(paren
id|he_is622
c_func
(paren
id|he_dev
)paren
ques
c_cond
(paren
id|REF_RATE
c_func
(paren
l_int|0x384
)paren
op_or
id|WIDE_DATA
)paren
suffix:colon
id|REF_RATE
c_func
(paren
l_int|0x150
)paren
)paren
comma
id|SDRAMCON
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
(paren
id|he_is622
c_func
(paren
id|he_dev
)paren
ques
c_cond
id|RM_BANK_WAIT
c_func
(paren
l_int|1
)paren
suffix:colon
id|RM_BANK_WAIT
c_func
(paren
l_int|0
)paren
)paren
op_or
id|RM_RW_WAIT
c_func
(paren
l_int|1
)paren
comma
id|RCMCONFIG
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
(paren
id|he_is622
c_func
(paren
id|he_dev
)paren
ques
c_cond
id|TM_BANK_WAIT
c_func
(paren
l_int|2
)paren
suffix:colon
id|TM_BANK_WAIT
c_func
(paren
l_int|1
)paren
)paren
op_or
id|TM_RW_WAIT
c_func
(paren
l_int|1
)paren
comma
id|TCMCONFIG
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|he_dev-&gt;cells_per_lbuf
op_star
id|ATM_CELL_PAYLOAD
comma
id|LB_CONFIG
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
(paren
id|he_is622
c_func
(paren
id|he_dev
)paren
ques
c_cond
id|UT_RD_DELAY
c_func
(paren
l_int|8
)paren
suffix:colon
id|UT_RD_DELAY
c_func
(paren
l_int|0
)paren
)paren
op_or
(paren
id|he_is622
c_func
(paren
id|he_dev
)paren
ques
c_cond
id|RC_UT_MODE
c_func
(paren
l_int|0
)paren
suffix:colon
id|RC_UT_MODE
c_func
(paren
l_int|1
)paren
)paren
op_or
id|RX_VALVP
c_func
(paren
id|he_dev-&gt;vpibits
)paren
op_or
id|RX_VALVC
c_func
(paren
id|he_dev-&gt;vcibits
)paren
comma
id|RC_CONFIG
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|DRF_THRESH
c_func
(paren
l_int|0x20
)paren
op_or
(paren
id|he_is622
c_func
(paren
id|he_dev
)paren
ques
c_cond
id|TX_UT_MODE
c_func
(paren
l_int|0
)paren
suffix:colon
id|TX_UT_MODE
c_func
(paren
l_int|1
)paren
)paren
op_or
id|TX_VCI_MASK
c_func
(paren
id|he_dev-&gt;vcibits
)paren
op_or
id|LBFREE_CNT
c_func
(paren
id|he_dev-&gt;tx_numbuffs
)paren
comma
id|TX_CONFIG
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|TXAAL5_PROTO
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|PHY_INT_ENB
op_or
(paren
id|he_is622
c_func
(paren
id|he_dev
)paren
ques
c_cond
id|PTMR_PRE
c_func
(paren
l_int|67
op_minus
l_int|1
)paren
suffix:colon
id|PTMR_PRE
c_func
(paren
l_int|50
op_minus
l_int|1
)paren
)paren
comma
id|RH_CONFIG
)paren
suffix:semicolon
multiline_comment|/* 5.1.3 initialize connection memory */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|TCM_MEM_SIZE
suffix:semicolon
op_increment
id|i
)paren
id|he_writel_tcm
c_func
(paren
id|he_dev
comma
l_int|0
comma
id|i
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|RCM_MEM_SIZE
suffix:semicolon
op_increment
id|i
)paren
id|he_writel_rcm
c_func
(paren
id|he_dev
comma
l_int|0
comma
id|i
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;transmit connection memory map&n;&t; *&n;&t; *                  tx memory&n;&t; *          0x0 ___________________&n;&t; *             |                   |&n;&t; *             |                   |&n;&t; *             |       TSRa        |&n;&t; *             |                   |&n;&t; *             |                   |&n;&t; *       0x8000|___________________|&n;&t; *             |                   |&n;&t; *             |       TSRb        |&n;&t; *       0xc000|___________________|&n;&t; *             |                   |&n;&t; *             |       TSRc        |&n;&t; *       0xe000|___________________|&n;&t; *             |       TSRd        |&n;&t; *       0xf000|___________________|&n;&t; *             |       tmABR       |&n;&t; *      0x10000|___________________|&n;&t; *             |                   |&n;&t; *             |       tmTPD       |&n;&t; *             |___________________|&n;&t; *             |                   |&n;&t; *                      ....&n;&t; *      0x1ffff|___________________|&n;&t; *&n;&t; *&n;&t; */
id|he_writel
c_func
(paren
id|he_dev
comma
id|CONFIG_TSRB
comma
id|TSRB_BA
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|CONFIG_TSRC
comma
id|TSRC_BA
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|CONFIG_TSRD
comma
id|TSRD_BA
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|CONFIG_TMABR
comma
id|TMABR_BA
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|CONFIG_TPDBA
comma
id|TPD_BA
)paren
suffix:semicolon
multiline_comment|/*&n;&t; *&t;receive connection memory map&n;&t; *&n;&t; *          0x0 ___________________&n;&t; *             |                   |&n;&t; *             |                   |&n;&t; *             |       RSRa        |&n;&t; *             |                   |&n;&t; *             |                   |&n;&t; *       0x8000|___________________|&n;&t; *             |                   |&n;&t; *             |             rx0/1 |&n;&t; *             |       LBM         |   link lists of local&n;&t; *             |             tx    |   buffer memory &n;&t; *             |                   |&n;&t; *       0xd000|___________________|&n;&t; *             |                   |&n;&t; *             |      rmABR        |&n;&t; *       0xe000|___________________|&n;&t; *             |                   |&n;&t; *             |       RSRb        |&n;&t; *             |___________________|&n;&t; *             |                   |&n;&t; *                      ....&n;&t; *       0xffff|___________________|&n;&t; */
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x08000
comma
id|RCMLBM_BA
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0e000
comma
id|RCMRSRB_BA
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0d800
comma
id|RCMABR_BA
)paren
suffix:semicolon
multiline_comment|/* 5.1.4 initialize local buffer free pools linked lists */
id|he_init_rx_lbfp0
c_func
(paren
id|he_dev
)paren
suffix:semicolon
id|he_init_rx_lbfp1
c_func
(paren
id|he_dev
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|RLBC_H
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|RLBC_T
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|RLBC_H2
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|512
comma
id|RXTHRSH
)paren
suffix:semicolon
multiline_comment|/* 10% of r0+r1 buffers */
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|256
comma
id|LITHRSH
)paren
suffix:semicolon
multiline_comment|/* 5% of r0+r1 buffers */
id|he_init_tx_lbfp
c_func
(paren
id|he_dev
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|he_is622
c_func
(paren
id|he_dev
)paren
ques
c_cond
l_int|0x104780
suffix:colon
l_int|0x800
comma
id|UBUFF_BA
)paren
suffix:semicolon
multiline_comment|/* 5.1.5 initialize intermediate receive queues */
r_if
c_cond
(paren
id|he_is622
c_func
(paren
id|he_dev
)paren
)paren
(brace
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x000f
comma
id|G0_INMQ_S
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x200f
comma
id|G0_INMQ_L
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x001f
comma
id|G1_INMQ_S
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x201f
comma
id|G1_INMQ_L
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x002f
comma
id|G2_INMQ_S
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x202f
comma
id|G2_INMQ_L
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x003f
comma
id|G3_INMQ_S
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x203f
comma
id|G3_INMQ_L
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x004f
comma
id|G4_INMQ_S
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x204f
comma
id|G4_INMQ_L
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x005f
comma
id|G5_INMQ_S
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x205f
comma
id|G5_INMQ_L
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x006f
comma
id|G6_INMQ_S
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x206f
comma
id|G6_INMQ_L
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x007f
comma
id|G7_INMQ_S
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x207f
comma
id|G7_INMQ_L
)paren
suffix:semicolon
)brace
r_else
(brace
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0000
comma
id|G0_INMQ_S
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0008
comma
id|G0_INMQ_L
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0001
comma
id|G1_INMQ_S
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0009
comma
id|G1_INMQ_L
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0002
comma
id|G2_INMQ_S
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x000a
comma
id|G2_INMQ_L
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0003
comma
id|G3_INMQ_S
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x000b
comma
id|G3_INMQ_L
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0004
comma
id|G4_INMQ_S
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x000c
comma
id|G4_INMQ_L
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0005
comma
id|G5_INMQ_S
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x000d
comma
id|G5_INMQ_L
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0006
comma
id|G6_INMQ_S
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x000e
comma
id|G6_INMQ_L
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0007
comma
id|G7_INMQ_S
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x000f
comma
id|G7_INMQ_L
)paren
suffix:semicolon
)brace
multiline_comment|/* 5.1.6 application tunable parameters */
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|MCC
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|OEC
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|DCC
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|CEC
)paren
suffix:semicolon
multiline_comment|/* 5.1.7 cs block initialization */
id|he_init_cs_block
c_func
(paren
id|he_dev
)paren
suffix:semicolon
multiline_comment|/* 5.1.8 cs block connection memory initialization */
r_if
c_cond
(paren
id|he_init_cs_block_rcm
c_func
(paren
id|he_dev
)paren
OL
l_int|0
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
multiline_comment|/* 5.1.10 initialize host structures */
id|he_init_tpdrq
c_func
(paren
id|he_dev
)paren
suffix:semicolon
macro_line|#ifdef USE_TPD_POOL
id|he_dev-&gt;tpd_pool
op_assign
id|pci_pool_create
c_func
(paren
l_string|&quot;tpd&quot;
comma
id|he_dev-&gt;pci_dev
comma
r_sizeof
(paren
r_struct
id|he_tpd
)paren
comma
id|TPD_ALIGNMENT
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;tpd_pool
op_eq
l_int|NULL
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;unable to create tpd pci_pool&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|INIT_LIST_HEAD
c_func
(paren
op_amp
id|he_dev-&gt;outstanding_tpds
)paren
suffix:semicolon
macro_line|#else
id|he_dev-&gt;tpd_base
op_assign
(paren
r_void
op_star
)paren
id|pci_alloc_consistent
c_func
(paren
id|he_dev-&gt;pci_dev
comma
id|CONFIG_NUMTPDS
op_star
r_sizeof
(paren
r_struct
id|he_tpd
)paren
comma
op_amp
id|he_dev-&gt;tpd_base_phys
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|he_dev-&gt;tpd_base
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CONFIG_NUMTPDS
suffix:semicolon
op_increment
id|i
)paren
(brace
id|he_dev-&gt;tpd_base
(braket
id|i
)braket
dot
id|status
op_assign
(paren
id|i
op_lshift
id|TPD_ADDR_SHIFT
)paren
suffix:semicolon
id|he_dev-&gt;tpd_base
(braket
id|i
)braket
dot
id|inuse
op_assign
l_int|0
suffix:semicolon
)brace
id|he_dev-&gt;tpd_head
op_assign
id|he_dev-&gt;tpd_base
suffix:semicolon
id|he_dev-&gt;tpd_end
op_assign
op_amp
id|he_dev-&gt;tpd_base
(braket
id|CONFIG_NUMTPDS
op_minus
l_int|1
)braket
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|he_init_group
c_func
(paren
id|he_dev
comma
l_int|0
)paren
op_ne
l_int|0
)paren
r_return
op_minus
id|ENOMEM
suffix:semicolon
r_for
c_loop
(paren
id|group
op_assign
l_int|1
suffix:semicolon
id|group
OL
id|HE_NUM_GROUPS
suffix:semicolon
op_increment
id|group
)paren
(brace
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|G0_RBPS_S
op_plus
(paren
id|group
op_star
l_int|32
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|G0_RBPS_T
op_plus
(paren
id|group
op_star
l_int|32
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|G0_RBPS_QI
op_plus
(paren
id|group
op_star
l_int|32
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|RBP_THRESH
c_func
(paren
l_int|0x1
)paren
op_or
id|RBP_QSIZE
c_func
(paren
l_int|0x0
)paren
comma
id|G0_RBPS_BS
op_plus
(paren
id|group
op_star
l_int|32
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|G0_RBPL_S
op_plus
(paren
id|group
op_star
l_int|32
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|G0_RBPL_T
op_plus
(paren
id|group
op_star
l_int|32
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|RBP_THRESH
c_func
(paren
l_int|0x1
)paren
op_or
id|RBP_QSIZE
c_func
(paren
l_int|0x0
)paren
comma
id|G0_RBPL_QI
op_plus
(paren
id|group
op_star
l_int|32
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|G0_RBPL_BS
op_plus
(paren
id|group
op_star
l_int|32
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|G0_RBRQ_ST
op_plus
(paren
id|group
op_star
l_int|16
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|G0_RBRQ_H
op_plus
(paren
id|group
op_star
l_int|16
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|RBRQ_THRESH
c_func
(paren
l_int|0x1
)paren
op_or
id|RBRQ_SIZE
c_func
(paren
l_int|0x0
)paren
comma
id|G0_RBRQ_Q
op_plus
(paren
id|group
op_star
l_int|16
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|G0_RBRQ_I
op_plus
(paren
id|group
op_star
l_int|16
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|G0_TBRQ_B_T
op_plus
(paren
id|group
op_star
l_int|16
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|G0_TBRQ_H
op_plus
(paren
id|group
op_star
l_int|16
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|TBRQ_THRESH
c_func
(paren
l_int|0x1
)paren
comma
id|G0_TBRQ_THRESH
op_plus
(paren
id|group
op_star
l_int|16
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|G0_TBRQ_S
op_plus
(paren
id|group
op_star
l_int|16
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* host status page */
id|he_dev-&gt;hsp
op_assign
id|pci_alloc_consistent
c_func
(paren
id|he_dev-&gt;pci_dev
comma
r_sizeof
(paren
r_struct
id|he_hsp
)paren
comma
op_amp
id|he_dev-&gt;hsp_phys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;hsp
op_eq
l_int|NULL
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;failed to allocate host status page&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|he_dev-&gt;hsp
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|he_hsp
)paren
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|he_dev-&gt;hsp_phys
comma
id|HSP_BA
)paren
suffix:semicolon
multiline_comment|/* initialize framer */
macro_line|#ifdef CONFIG_ATM_HE_USE_SUNI
id|suni_init
c_func
(paren
id|he_dev-&gt;atm_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;atm_dev-&gt;phy
op_logical_and
id|he_dev-&gt;atm_dev-&gt;phy-&gt;start
)paren
id|he_dev-&gt;atm_dev-&gt;phy
op_member_access_from_pointer
id|start
c_func
(paren
id|he_dev-&gt;atm_dev
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_ATM_HE_USE_SUNI */
r_if
c_cond
(paren
id|sdh
)paren
(brace
multiline_comment|/* this really should be in suni.c but for now... */
r_int
id|val
suffix:semicolon
id|val
op_assign
id|he_phy_get
c_func
(paren
id|he_dev-&gt;atm_dev
comma
id|SUNI_TPOP_APM
)paren
suffix:semicolon
id|val
op_assign
(paren
id|val
op_amp
op_complement
id|SUNI_TPOP_APM_S
)paren
op_or
(paren
id|SUNI_TPOP_S_SDH
op_lshift
id|SUNI_TPOP_APM_S_SHIFT
)paren
suffix:semicolon
id|he_phy_put
c_func
(paren
id|he_dev-&gt;atm_dev
comma
id|val
comma
id|SUNI_TPOP_APM
)paren
suffix:semicolon
)brace
multiline_comment|/* 5.1.12 enable transmit and receive */
id|reg
op_assign
id|he_readl_mbox
c_func
(paren
id|he_dev
comma
id|CS_ERCTL0
)paren
suffix:semicolon
id|reg
op_or_assign
id|TX_ENABLE
op_or
id|ER_ENABLE
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
id|reg
comma
id|CS_ERCTL0
)paren
suffix:semicolon
id|reg
op_assign
id|he_readl
c_func
(paren
id|he_dev
comma
id|RC_CONFIG
)paren
suffix:semicolon
id|reg
op_or_assign
id|RX_ENABLE
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|reg
comma
id|RC_CONFIG
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HE_NUM_CS_STPER
suffix:semicolon
op_increment
id|i
)paren
(brace
id|he_dev-&gt;cs_stper
(braket
id|i
)braket
dot
id|inuse
op_assign
l_int|0
suffix:semicolon
id|he_dev-&gt;cs_stper
(braket
id|i
)braket
dot
id|pcr
op_assign
op_minus
l_int|1
suffix:semicolon
)brace
id|he_dev-&gt;total_bw
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* atm linux initialization */
id|he_dev-&gt;atm_dev-&gt;ci_range.vpi_bits
op_assign
id|he_dev-&gt;vpibits
suffix:semicolon
id|he_dev-&gt;atm_dev-&gt;ci_range.vci_bits
op_assign
id|he_dev-&gt;vcibits
suffix:semicolon
id|he_dev-&gt;irq_peak
op_assign
l_int|0
suffix:semicolon
id|he_dev-&gt;rbrq_peak
op_assign
l_int|0
suffix:semicolon
id|he_dev-&gt;rbpl_peak
op_assign
l_int|0
suffix:semicolon
id|he_dev-&gt;tbrq_peak
op_assign
l_int|0
suffix:semicolon
id|HPRINTK
c_func
(paren
l_string|&quot;hell bent for leather!&bslash;n&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|he_stop
id|he_stop
c_func
(paren
r_struct
id|he_dev
op_star
id|he_dev
)paren
(brace
id|u16
id|command
suffix:semicolon
id|u32
id|gen_cntl_0
comma
id|reg
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pci_dev
suffix:semicolon
id|pci_dev
op_assign
id|he_dev-&gt;pci_dev
suffix:semicolon
multiline_comment|/* disable interrupts */
r_if
c_cond
(paren
id|he_dev-&gt;membase
)paren
(brace
id|pci_read_config_dword
c_func
(paren
id|pci_dev
comma
id|GEN_CNTL_0
comma
op_amp
id|gen_cntl_0
)paren
suffix:semicolon
id|gen_cntl_0
op_and_assign
op_complement
(paren
id|INT_PROC_ENBL
op_or
id|INIT_ENB
)paren
suffix:semicolon
id|pci_write_config_dword
c_func
(paren
id|pci_dev
comma
id|GEN_CNTL_0
comma
id|gen_cntl_0
)paren
suffix:semicolon
macro_line|#ifdef USE_TASKLET
id|tasklet_disable
c_func
(paren
op_amp
id|he_dev-&gt;tasklet
)paren
suffix:semicolon
macro_line|#endif
multiline_comment|/* disable recv and transmit */
id|reg
op_assign
id|he_readl_mbox
c_func
(paren
id|he_dev
comma
id|CS_ERCTL0
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
(paren
id|TX_ENABLE
op_or
id|ER_ENABLE
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
id|reg
comma
id|CS_ERCTL0
)paren
suffix:semicolon
id|reg
op_assign
id|he_readl
c_func
(paren
id|he_dev
comma
id|RC_CONFIG
)paren
suffix:semicolon
id|reg
op_and_assign
op_complement
(paren
id|RX_ENABLE
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|reg
comma
id|RC_CONFIG
)paren
suffix:semicolon
)brace
macro_line|#ifdef CONFIG_ATM_HE_USE_SUNI
r_if
c_cond
(paren
id|he_dev-&gt;atm_dev-&gt;phy
op_logical_and
id|he_dev-&gt;atm_dev-&gt;phy-&gt;stop
)paren
id|he_dev-&gt;atm_dev-&gt;phy
op_member_access_from_pointer
id|stop
c_func
(paren
id|he_dev-&gt;atm_dev
)paren
suffix:semicolon
macro_line|#endif /* CONFIG_ATM_HE_USE_SUNI */
r_if
c_cond
(paren
id|he_dev-&gt;irq
)paren
id|free_irq
c_func
(paren
id|he_dev-&gt;irq
comma
id|he_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;irq_base
)paren
id|pci_free_consistent
c_func
(paren
id|he_dev-&gt;pci_dev
comma
(paren
id|CONFIG_IRQ_SIZE
op_plus
l_int|1
)paren
op_star
r_sizeof
(paren
r_struct
id|he_irq
)paren
comma
id|he_dev-&gt;irq_base
comma
id|he_dev-&gt;irq_phys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;hsp
)paren
id|pci_free_consistent
c_func
(paren
id|he_dev-&gt;pci_dev
comma
r_sizeof
(paren
r_struct
id|he_hsp
)paren
comma
id|he_dev-&gt;hsp
comma
id|he_dev-&gt;hsp_phys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;rbpl_base
)paren
(brace
macro_line|#ifdef USE_RBPL_POOL
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CONFIG_RBPL_SIZE
suffix:semicolon
op_increment
id|i
)paren
(brace
r_void
op_star
id|cpuaddr
op_assign
id|he_dev-&gt;rbpl_virt
(braket
id|i
)braket
dot
id|virt
suffix:semicolon
id|dma_addr_t
id|dma_handle
op_assign
id|he_dev-&gt;rbpl_base
(braket
id|i
)braket
dot
id|phys
suffix:semicolon
id|pci_pool_free
c_func
(paren
id|he_dev-&gt;rbpl_pool
comma
id|cpuaddr
comma
id|dma_handle
)paren
suffix:semicolon
)brace
macro_line|#else
id|pci_free_consistent
c_func
(paren
id|he_dev-&gt;pci_dev
comma
id|CONFIG_RBPL_SIZE
op_star
id|CONFIG_RBPL_BUFSIZE
comma
id|he_dev-&gt;rbpl_pages
comma
id|he_dev-&gt;rbpl_pages_phys
)paren
suffix:semicolon
macro_line|#endif
id|pci_free_consistent
c_func
(paren
id|he_dev-&gt;pci_dev
comma
id|CONFIG_RBPL_SIZE
op_star
r_sizeof
(paren
r_struct
id|he_rbp
)paren
comma
id|he_dev-&gt;rbpl_base
comma
id|he_dev-&gt;rbpl_phys
)paren
suffix:semicolon
)brace
macro_line|#ifdef USE_RBPL_POOL
r_if
c_cond
(paren
id|he_dev-&gt;rbpl_pool
)paren
id|pci_pool_destroy
c_func
(paren
id|he_dev-&gt;rbpl_pool
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef USE_RBPS
r_if
c_cond
(paren
id|he_dev-&gt;rbps_base
)paren
(brace
macro_line|#ifdef USE_RBPS_POOL
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CONFIG_RBPS_SIZE
suffix:semicolon
op_increment
id|i
)paren
(brace
r_void
op_star
id|cpuaddr
op_assign
id|he_dev-&gt;rbps_virt
(braket
id|i
)braket
dot
id|virt
suffix:semicolon
id|dma_addr_t
id|dma_handle
op_assign
id|he_dev-&gt;rbps_base
(braket
id|i
)braket
dot
id|phys
suffix:semicolon
id|pci_pool_free
c_func
(paren
id|he_dev-&gt;rbps_pool
comma
id|cpuaddr
comma
id|dma_handle
)paren
suffix:semicolon
)brace
macro_line|#else
id|pci_free_consistent
c_func
(paren
id|he_dev-&gt;pci_dev
comma
id|CONFIG_RBPS_SIZE
op_star
id|CONFIG_RBPS_BUFSIZE
comma
id|he_dev-&gt;rbps_pages
comma
id|he_dev-&gt;rbps_pages_phys
)paren
suffix:semicolon
macro_line|#endif
id|pci_free_consistent
c_func
(paren
id|he_dev-&gt;pci_dev
comma
id|CONFIG_RBPS_SIZE
op_star
r_sizeof
(paren
r_struct
id|he_rbp
)paren
comma
id|he_dev-&gt;rbps_base
comma
id|he_dev-&gt;rbps_phys
)paren
suffix:semicolon
)brace
macro_line|#ifdef USE_RBPS_POOL
r_if
c_cond
(paren
id|he_dev-&gt;rbps_pool
)paren
id|pci_pool_destroy
c_func
(paren
id|he_dev-&gt;rbps_pool
)paren
suffix:semicolon
macro_line|#endif
macro_line|#endif /* USE_RBPS */
r_if
c_cond
(paren
id|he_dev-&gt;rbrq_base
)paren
id|pci_free_consistent
c_func
(paren
id|he_dev-&gt;pci_dev
comma
id|CONFIG_RBRQ_SIZE
op_star
r_sizeof
(paren
r_struct
id|he_rbrq
)paren
comma
id|he_dev-&gt;rbrq_base
comma
id|he_dev-&gt;rbrq_phys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;tbrq_base
)paren
id|pci_free_consistent
c_func
(paren
id|he_dev-&gt;pci_dev
comma
id|CONFIG_TBRQ_SIZE
op_star
r_sizeof
(paren
r_struct
id|he_tbrq
)paren
comma
id|he_dev-&gt;tbrq_base
comma
id|he_dev-&gt;tbrq_phys
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;tpdrq_base
)paren
id|pci_free_consistent
c_func
(paren
id|he_dev-&gt;pci_dev
comma
id|CONFIG_TBRQ_SIZE
op_star
r_sizeof
(paren
r_struct
id|he_tbrq
)paren
comma
id|he_dev-&gt;tpdrq_base
comma
id|he_dev-&gt;tpdrq_phys
)paren
suffix:semicolon
macro_line|#ifdef USE_TPD_POOL
r_if
c_cond
(paren
id|he_dev-&gt;tpd_pool
)paren
id|pci_pool_destroy
c_func
(paren
id|he_dev-&gt;tpd_pool
)paren
suffix:semicolon
macro_line|#else
r_if
c_cond
(paren
id|he_dev-&gt;tpd_base
)paren
id|pci_free_consistent
c_func
(paren
id|he_dev-&gt;pci_dev
comma
id|CONFIG_NUMTPDS
op_star
r_sizeof
(paren
r_struct
id|he_tpd
)paren
comma
id|he_dev-&gt;tpd_base
comma
id|he_dev-&gt;tpd_base_phys
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|he_dev-&gt;pci_dev
)paren
(brace
id|pci_read_config_word
c_func
(paren
id|he_dev-&gt;pci_dev
comma
id|PCI_COMMAND
comma
op_amp
id|command
)paren
suffix:semicolon
id|command
op_and_assign
op_complement
(paren
id|PCI_COMMAND_MEMORY
op_or
id|PCI_COMMAND_MASTER
)paren
suffix:semicolon
id|pci_write_config_word
c_func
(paren
id|he_dev-&gt;pci_dev
comma
id|PCI_COMMAND
comma
id|command
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|he_dev-&gt;membase
)paren
id|iounmap
c_func
(paren
id|he_dev-&gt;membase
)paren
suffix:semicolon
)brace
r_static
r_struct
id|he_tpd
op_star
DECL|function|__alloc_tpd
id|__alloc_tpd
c_func
(paren
r_struct
id|he_dev
op_star
id|he_dev
)paren
(brace
macro_line|#ifdef USE_TPD_POOL
r_struct
id|he_tpd
op_star
id|tpd
suffix:semicolon
id|dma_addr_t
id|dma_handle
suffix:semicolon
id|tpd
op_assign
id|pci_pool_alloc
c_func
(paren
id|he_dev-&gt;tpd_pool
comma
id|SLAB_ATOMIC
op_or
id|SLAB_DMA
comma
op_amp
id|dma_handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tpd
op_eq
l_int|NULL
)paren
r_return
l_int|NULL
suffix:semicolon
id|tpd-&gt;status
op_assign
id|TPD_ADDR
c_func
(paren
id|dma_handle
)paren
suffix:semicolon
id|tpd-&gt;reserved
op_assign
l_int|0
suffix:semicolon
id|tpd-&gt;iovec
(braket
l_int|0
)braket
dot
id|addr
op_assign
l_int|0
suffix:semicolon
id|tpd-&gt;iovec
(braket
l_int|0
)braket
dot
id|len
op_assign
l_int|0
suffix:semicolon
id|tpd-&gt;iovec
(braket
l_int|1
)braket
dot
id|addr
op_assign
l_int|0
suffix:semicolon
id|tpd-&gt;iovec
(braket
l_int|1
)braket
dot
id|len
op_assign
l_int|0
suffix:semicolon
id|tpd-&gt;iovec
(braket
l_int|2
)braket
dot
id|addr
op_assign
l_int|0
suffix:semicolon
id|tpd-&gt;iovec
(braket
l_int|2
)braket
dot
id|len
op_assign
l_int|0
suffix:semicolon
r_return
id|tpd
suffix:semicolon
macro_line|#else
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|CONFIG_NUMTPDS
suffix:semicolon
op_increment
id|i
)paren
(brace
op_increment
id|he_dev-&gt;tpd_head
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;tpd_head
OG
id|he_dev-&gt;tpd_end
)paren
(brace
id|he_dev-&gt;tpd_head
op_assign
id|he_dev-&gt;tpd_base
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|he_dev-&gt;tpd_head-&gt;inuse
)paren
(brace
id|he_dev-&gt;tpd_head-&gt;inuse
op_assign
l_int|1
suffix:semicolon
id|he_dev-&gt;tpd_head-&gt;status
op_and_assign
id|TPD_MASK
suffix:semicolon
id|he_dev-&gt;tpd_head-&gt;iovec
(braket
l_int|0
)braket
dot
id|addr
op_assign
l_int|0
suffix:semicolon
id|he_dev-&gt;tpd_head-&gt;iovec
(braket
l_int|0
)braket
dot
id|len
op_assign
l_int|0
suffix:semicolon
id|he_dev-&gt;tpd_head-&gt;iovec
(braket
l_int|1
)braket
dot
id|addr
op_assign
l_int|0
suffix:semicolon
id|he_dev-&gt;tpd_head-&gt;iovec
(braket
l_int|1
)braket
dot
id|len
op_assign
l_int|0
suffix:semicolon
id|he_dev-&gt;tpd_head-&gt;iovec
(braket
l_int|2
)braket
dot
id|addr
op_assign
l_int|0
suffix:semicolon
id|he_dev-&gt;tpd_head-&gt;iovec
(braket
l_int|2
)braket
dot
id|len
op_assign
l_int|0
suffix:semicolon
r_return
id|he_dev-&gt;tpd_head
suffix:semicolon
)brace
)brace
id|hprintk
c_func
(paren
l_string|&quot;out of tpds -- increase CONFIG_NUMTPDS (%d)&bslash;n&quot;
comma
id|CONFIG_NUMTPDS
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
macro_line|#endif
)brace
DECL|macro|AAL5_LEN
mdefine_line|#define AAL5_LEN(buf,len) &t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;((((unsigned char *)(buf))[(len)-6] &lt;&lt; 8) |&t;&bslash;&n;&t;&t;&t;&t;(((unsigned char *)(buf))[(len)-5]))
multiline_comment|/* 2.10.1.2 receive&n; *&n; * aal5 packets can optionally return the tcp checksum in the lower&n; * 16 bits of the crc (RSR0_TCP_CKSUM)&n; */
DECL|macro|TCP_CKSUM
mdefine_line|#define TCP_CKSUM(buf,len) &t;&t;&t;&t;&t;&t;&bslash;&n;&t;&t;&t;((((unsigned char *)(buf))[(len)-2] &lt;&lt; 8) |&t;&bslash;&n;&t;&t;&t;&t;(((unsigned char *)(buf))[(len-1)]))
r_static
r_int
DECL|function|he_service_rbrq
id|he_service_rbrq
c_func
(paren
r_struct
id|he_dev
op_star
id|he_dev
comma
r_int
id|group
)paren
(brace
r_struct
id|he_rbrq
op_star
id|rbrq_tail
op_assign
(paren
r_struct
id|he_rbrq
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|he_dev-&gt;rbrq_base
op_or
id|he_dev-&gt;hsp-&gt;group
(braket
id|group
)braket
dot
id|rbrq_tail
)paren
suffix:semicolon
r_struct
id|he_rbp
op_star
id|rbp
op_assign
l_int|NULL
suffix:semicolon
r_int
id|cid
comma
id|lastcid
op_assign
op_minus
l_int|1
suffix:semicolon
r_int
id|buf_len
op_assign
l_int|0
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|vcc
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|he_vcc
op_star
id|he_vcc
suffix:semicolon
r_struct
id|he_iovec
op_star
id|iov
suffix:semicolon
r_int
id|pdus_assembled
op_assign
l_int|0
suffix:semicolon
r_int
id|updated
op_assign
l_int|0
suffix:semicolon
id|read_lock
c_func
(paren
op_amp
id|vcc_sklist_lock
)paren
suffix:semicolon
r_while
c_loop
(paren
id|he_dev-&gt;rbrq_head
op_ne
id|rbrq_tail
)paren
(brace
op_increment
id|updated
suffix:semicolon
id|HPRINTK
c_func
(paren
l_string|&quot;%p rbrq%d 0x%x len=%d cid=0x%x %s%s%s%s%s%s&bslash;n&quot;
comma
id|he_dev-&gt;rbrq_head
comma
id|group
comma
id|RBRQ_ADDR
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
comma
id|RBRQ_BUFLEN
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
comma
id|RBRQ_CID
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
comma
id|RBRQ_CRC_ERR
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
ques
c_cond
l_string|&quot; CRC_ERR&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|RBRQ_LEN_ERR
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
ques
c_cond
l_string|&quot; LEN_ERR&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|RBRQ_END_PDU
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
ques
c_cond
l_string|&quot; END_PDU&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|RBRQ_AAL5_PROT
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
ques
c_cond
l_string|&quot; AAL5_PROT&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|RBRQ_CON_CLOSED
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
ques
c_cond
l_string|&quot; CON_CLOSED&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|RBRQ_HBUF_ERR
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
ques
c_cond
l_string|&quot; HBUF_ERR&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
macro_line|#ifdef USE_RBPS
r_if
c_cond
(paren
id|RBRQ_ADDR
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
op_amp
id|RBP_SMALLBUF
)paren
id|rbp
op_assign
op_amp
id|he_dev-&gt;rbps_base
(braket
id|RBP_INDEX
c_func
(paren
id|RBRQ_ADDR
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
)paren
)braket
suffix:semicolon
r_else
macro_line|#endif
id|rbp
op_assign
op_amp
id|he_dev-&gt;rbpl_base
(braket
id|RBP_INDEX
c_func
(paren
id|RBRQ_ADDR
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
)paren
)braket
suffix:semicolon
id|buf_len
op_assign
id|RBRQ_BUFLEN
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
op_star
l_int|4
suffix:semicolon
id|cid
op_assign
id|RBRQ_CID
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cid
op_ne
id|lastcid
)paren
id|vcc
op_assign
id|__find_vcc
c_func
(paren
id|he_dev
comma
id|cid
)paren
suffix:semicolon
id|lastcid
op_assign
id|cid
suffix:semicolon
r_if
c_cond
(paren
id|vcc
op_eq
l_int|NULL
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;vcc == NULL  (cid 0x%x)&bslash;n&quot;
comma
id|cid
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|RBRQ_HBUF_ERR
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
)paren
id|rbp-&gt;status
op_and_assign
op_complement
id|RBP_LOANED
suffix:semicolon
r_goto
id|next_rbrq_entry
suffix:semicolon
)brace
id|he_vcc
op_assign
id|HE_VCC
c_func
(paren
id|vcc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_vcc
op_eq
l_int|NULL
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;he_vcc == NULL  (cid 0x%x)&bslash;n&quot;
comma
id|cid
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|RBRQ_HBUF_ERR
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
)paren
id|rbp-&gt;status
op_and_assign
op_complement
id|RBP_LOANED
suffix:semicolon
r_goto
id|next_rbrq_entry
suffix:semicolon
)brace
r_if
c_cond
(paren
id|RBRQ_HBUF_ERR
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;HBUF_ERR!  (cid 0x%x)&bslash;n&quot;
comma
id|cid
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;rx_drop
)paren
suffix:semicolon
r_goto
id|return_host_buffers
suffix:semicolon
)brace
id|he_vcc-&gt;iov_tail-&gt;iov_base
op_assign
id|RBRQ_ADDR
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
suffix:semicolon
id|he_vcc-&gt;iov_tail-&gt;iov_len
op_assign
id|buf_len
suffix:semicolon
id|he_vcc-&gt;pdu_len
op_add_assign
id|buf_len
suffix:semicolon
op_increment
id|he_vcc-&gt;iov_tail
suffix:semicolon
r_if
c_cond
(paren
id|RBRQ_CON_CLOSED
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
)paren
(brace
id|lastcid
op_assign
op_minus
l_int|1
suffix:semicolon
id|HPRINTK
c_func
(paren
l_string|&quot;wake_up rx_waitq  (cid 0x%x)&bslash;n&quot;
comma
id|cid
)paren
suffix:semicolon
id|wake_up
c_func
(paren
op_amp
id|he_vcc-&gt;rx_waitq
)paren
suffix:semicolon
r_goto
id|return_host_buffers
suffix:semicolon
)brace
macro_line|#ifdef notdef
r_if
c_cond
(paren
(paren
id|he_vcc-&gt;iov_tail
op_minus
id|he_vcc-&gt;iov_head
)paren
OG
id|HE_MAXIOV
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;iovec full!  cid 0x%x&bslash;n&quot;
comma
id|cid
)paren
suffix:semicolon
r_goto
id|return_host_buffers
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|RBRQ_END_PDU
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
)paren
r_goto
id|next_rbrq_entry
suffix:semicolon
r_if
c_cond
(paren
id|RBRQ_LEN_ERR
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
op_logical_or
id|RBRQ_CRC_ERR
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
)paren
(brace
id|HPRINTK
c_func
(paren
l_string|&quot;%s%s (%d.%d)&bslash;n&quot;
comma
id|RBRQ_CRC_ERR
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
ques
c_cond
l_string|&quot;CRC_ERR &quot;
suffix:colon
l_string|&quot;&quot;
comma
id|RBRQ_LEN_ERR
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
ques
c_cond
l_string|&quot;LEN_ERR&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;rx_err
)paren
suffix:semicolon
r_goto
id|return_host_buffers
suffix:semicolon
)brace
id|skb
op_assign
id|atm_alloc_charge
c_func
(paren
id|vcc
comma
id|he_vcc-&gt;pdu_len
op_plus
id|rx_skb_reserve
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|HPRINTK
c_func
(paren
l_string|&quot;charge failed (%d.%d)&bslash;n&quot;
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
)paren
suffix:semicolon
r_goto
id|return_host_buffers
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rx_skb_reserve
OG
l_int|0
)paren
id|skb_reserve
c_func
(paren
id|skb
comma
id|rx_skb_reserve
)paren
suffix:semicolon
id|do_gettimeofday
c_func
(paren
op_amp
id|skb-&gt;stamp
)paren
suffix:semicolon
r_for
c_loop
(paren
id|iov
op_assign
id|he_vcc-&gt;iov_head
suffix:semicolon
id|iov
OL
id|he_vcc-&gt;iov_tail
suffix:semicolon
op_increment
id|iov
)paren
(brace
macro_line|#ifdef USE_RBPS
r_if
c_cond
(paren
id|iov-&gt;iov_base
op_amp
id|RBP_SMALLBUF
)paren
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|iov-&gt;iov_len
)paren
comma
id|he_dev-&gt;rbps_virt
(braket
id|RBP_INDEX
c_func
(paren
id|iov-&gt;iov_base
)paren
)braket
dot
id|virt
comma
id|iov-&gt;iov_len
)paren
suffix:semicolon
r_else
macro_line|#endif
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|iov-&gt;iov_len
)paren
comma
id|he_dev-&gt;rbpl_virt
(braket
id|RBP_INDEX
c_func
(paren
id|iov-&gt;iov_base
)paren
)braket
dot
id|virt
comma
id|iov-&gt;iov_len
)paren
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|vcc-&gt;qos.aal
)paren
(brace
r_case
id|ATM_AAL0
suffix:colon
multiline_comment|/* 2.10.1.5 raw cell receive */
id|skb-&gt;len
op_assign
id|ATM_AAL0_SDU
suffix:semicolon
id|skb-&gt;tail
op_assign
id|skb-&gt;data
op_plus
id|skb-&gt;len
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_AAL5
suffix:colon
multiline_comment|/* 2.10.1.2 aal5 receive */
id|skb-&gt;len
op_assign
id|AAL5_LEN
c_func
(paren
id|skb-&gt;data
comma
id|he_vcc-&gt;pdu_len
)paren
suffix:semicolon
id|skb-&gt;tail
op_assign
id|skb-&gt;data
op_plus
id|skb-&gt;len
suffix:semicolon
macro_line|#ifdef USE_CHECKSUM_HW
r_if
c_cond
(paren
id|vcc-&gt;vpi
op_eq
l_int|0
op_logical_and
id|vcc-&gt;vci
op_ge
id|ATM_NOT_RSV_VCI
)paren
(brace
id|skb-&gt;ip_summed
op_assign
id|CHECKSUM_HW
suffix:semicolon
id|skb-&gt;csum
op_assign
id|TCP_CKSUM
c_func
(paren
id|skb-&gt;data
comma
id|he_vcc-&gt;pdu_len
)paren
suffix:semicolon
)brace
macro_line|#endif
r_break
suffix:semicolon
)brace
macro_line|#ifdef should_never_happen
r_if
c_cond
(paren
id|skb-&gt;len
OG
id|vcc-&gt;qos.rxtp.max_sdu
)paren
id|hprintk
c_func
(paren
l_string|&quot;pdu_len (%d) &gt; vcc-&gt;qos.rxtp.max_sdu (%d)!  cid 0x%x&bslash;n&quot;
comma
id|skb-&gt;len
comma
id|vcc-&gt;qos.rxtp.max_sdu
comma
id|cid
)paren
suffix:semicolon
macro_line|#endif
macro_line|#ifdef notdef
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|vcc
op_assign
id|vcc
suffix:semicolon
macro_line|#endif
id|vcc
op_member_access_from_pointer
id|push
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;rx
)paren
suffix:semicolon
id|return_host_buffers
suffix:colon
op_increment
id|pdus_assembled
suffix:semicolon
r_for
c_loop
(paren
id|iov
op_assign
id|he_vcc-&gt;iov_head
suffix:semicolon
id|iov
OL
id|he_vcc-&gt;iov_tail
suffix:semicolon
op_increment
id|iov
)paren
(brace
macro_line|#ifdef USE_RBPS
r_if
c_cond
(paren
id|iov-&gt;iov_base
op_amp
id|RBP_SMALLBUF
)paren
id|rbp
op_assign
op_amp
id|he_dev-&gt;rbps_base
(braket
id|RBP_INDEX
c_func
(paren
id|iov-&gt;iov_base
)paren
)braket
suffix:semicolon
r_else
macro_line|#endif
id|rbp
op_assign
op_amp
id|he_dev-&gt;rbpl_base
(braket
id|RBP_INDEX
c_func
(paren
id|iov-&gt;iov_base
)paren
)braket
suffix:semicolon
id|rbp-&gt;status
op_and_assign
op_complement
id|RBP_LOANED
suffix:semicolon
)brace
id|he_vcc-&gt;iov_tail
op_assign
id|he_vcc-&gt;iov_head
suffix:semicolon
id|he_vcc-&gt;pdu_len
op_assign
l_int|0
suffix:semicolon
id|next_rbrq_entry
suffix:colon
id|he_dev-&gt;rbrq_head
op_assign
(paren
r_struct
id|he_rbrq
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|he_dev-&gt;rbrq_base
op_or
id|RBRQ_MASK
c_func
(paren
op_increment
id|he_dev-&gt;rbrq_head
)paren
)paren
suffix:semicolon
)brace
id|read_unlock
c_func
(paren
op_amp
id|vcc_sklist_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
id|updated
)paren
(brace
r_if
c_cond
(paren
id|updated
OG
id|he_dev-&gt;rbrq_peak
)paren
id|he_dev-&gt;rbrq_peak
op_assign
id|updated
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|RBRQ_MASK
c_func
(paren
id|he_dev-&gt;rbrq_head
)paren
comma
id|G0_RBRQ_H
op_plus
(paren
id|group
op_star
l_int|16
)paren
)paren
suffix:semicolon
)brace
r_return
id|pdus_assembled
suffix:semicolon
)brace
r_static
r_void
DECL|function|he_service_tbrq
id|he_service_tbrq
c_func
(paren
r_struct
id|he_dev
op_star
id|he_dev
comma
r_int
id|group
)paren
(brace
r_struct
id|he_tbrq
op_star
id|tbrq_tail
op_assign
(paren
r_struct
id|he_tbrq
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|he_dev-&gt;tbrq_base
op_or
id|he_dev-&gt;hsp-&gt;group
(braket
id|group
)braket
dot
id|tbrq_tail
)paren
suffix:semicolon
r_struct
id|he_tpd
op_star
id|tpd
suffix:semicolon
r_int
id|slot
comma
id|updated
op_assign
l_int|0
suffix:semicolon
macro_line|#ifdef USE_TPD_POOL
r_struct
id|he_tpd
op_star
id|__tpd
suffix:semicolon
macro_line|#endif
multiline_comment|/* 2.1.6 transmit buffer return queue */
r_while
c_loop
(paren
id|he_dev-&gt;tbrq_head
op_ne
id|tbrq_tail
)paren
(brace
op_increment
id|updated
suffix:semicolon
id|HPRINTK
c_func
(paren
l_string|&quot;tbrq%d 0x%x%s%s&bslash;n&quot;
comma
id|group
comma
id|TBRQ_TPD
c_func
(paren
id|he_dev-&gt;tbrq_head
)paren
comma
id|TBRQ_EOS
c_func
(paren
id|he_dev-&gt;tbrq_head
)paren
ques
c_cond
l_string|&quot; EOS&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|TBRQ_MULTIPLE
c_func
(paren
id|he_dev-&gt;tbrq_head
)paren
ques
c_cond
l_string|&quot; MULTIPLE&quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
macro_line|#ifdef USE_TPD_POOL
id|tpd
op_assign
l_int|NULL
suffix:semicolon
id|list_for_each_entry
c_func
(paren
id|__tpd
comma
op_amp
id|he_dev-&gt;outstanding_tpds
comma
id|entry
)paren
(brace
r_if
c_cond
(paren
id|TPD_ADDR
c_func
(paren
id|__tpd-&gt;status
)paren
op_eq
id|TBRQ_TPD
c_func
(paren
id|he_dev-&gt;tbrq_head
)paren
)paren
(brace
id|tpd
op_assign
id|__tpd
suffix:semicolon
id|list_del
c_func
(paren
op_amp
id|__tpd-&gt;entry
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|tpd
op_eq
l_int|NULL
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;unable to locate tpd for dma buffer %x&bslash;n&quot;
comma
id|TBRQ_TPD
c_func
(paren
id|he_dev-&gt;tbrq_head
)paren
)paren
suffix:semicolon
r_goto
id|next_tbrq_entry
suffix:semicolon
)brace
macro_line|#else
id|tpd
op_assign
op_amp
id|he_dev-&gt;tpd_base
(braket
id|TPD_INDEX
c_func
(paren
id|TBRQ_TPD
c_func
(paren
id|he_dev-&gt;tbrq_head
)paren
)paren
)braket
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|TBRQ_EOS
c_func
(paren
id|he_dev-&gt;tbrq_head
)paren
)paren
(brace
id|HPRINTK
c_func
(paren
l_string|&quot;wake_up(tx_waitq) cid 0x%x&bslash;n&quot;
comma
id|he_mkcid
c_func
(paren
id|he_dev
comma
id|tpd-&gt;vcc-&gt;vpi
comma
id|tpd-&gt;vcc-&gt;vci
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tpd-&gt;vcc
)paren
id|wake_up
c_func
(paren
op_amp
id|HE_VCC
c_func
(paren
id|tpd-&gt;vcc
)paren
op_member_access_from_pointer
id|tx_waitq
)paren
suffix:semicolon
r_goto
id|next_tbrq_entry
suffix:semicolon
)brace
r_for
c_loop
(paren
id|slot
op_assign
l_int|0
suffix:semicolon
id|slot
OL
id|TPD_MAXIOV
suffix:semicolon
op_increment
id|slot
)paren
(brace
r_if
c_cond
(paren
id|tpd-&gt;iovec
(braket
id|slot
)braket
dot
id|addr
)paren
id|pci_unmap_single
c_func
(paren
id|he_dev-&gt;pci_dev
comma
id|tpd-&gt;iovec
(braket
id|slot
)braket
dot
id|addr
comma
id|tpd-&gt;iovec
(braket
id|slot
)braket
dot
id|len
op_amp
id|TPD_LEN_MASK
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tpd-&gt;iovec
(braket
id|slot
)braket
dot
id|len
op_amp
id|TPD_LST
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tpd-&gt;skb
)paren
(brace
multiline_comment|/* &amp;&amp; !TBRQ_MULTIPLE(he_dev-&gt;tbrq_head) */
r_if
c_cond
(paren
id|tpd-&gt;vcc
op_logical_and
id|tpd-&gt;vcc-&gt;pop
)paren
id|tpd-&gt;vcc
op_member_access_from_pointer
id|pop
c_func
(paren
id|tpd-&gt;vcc
comma
id|tpd-&gt;skb
)paren
suffix:semicolon
r_else
id|dev_kfree_skb_any
c_func
(paren
id|tpd-&gt;skb
)paren
suffix:semicolon
)brace
id|next_tbrq_entry
suffix:colon
macro_line|#ifdef USE_TPD_POOL
r_if
c_cond
(paren
id|tpd
)paren
id|pci_pool_free
c_func
(paren
id|he_dev-&gt;tpd_pool
comma
id|tpd
comma
id|TPD_ADDR
c_func
(paren
id|tpd-&gt;status
)paren
)paren
suffix:semicolon
macro_line|#else
id|tpd-&gt;inuse
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
id|he_dev-&gt;tbrq_head
op_assign
(paren
r_struct
id|he_tbrq
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|he_dev-&gt;tbrq_base
op_or
id|TBRQ_MASK
c_func
(paren
op_increment
id|he_dev-&gt;tbrq_head
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|updated
)paren
(brace
r_if
c_cond
(paren
id|updated
OG
id|he_dev-&gt;tbrq_peak
)paren
id|he_dev-&gt;tbrq_peak
op_assign
id|updated
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|TBRQ_MASK
c_func
(paren
id|he_dev-&gt;tbrq_head
)paren
comma
id|G0_TBRQ_H
op_plus
(paren
id|group
op_star
l_int|16
)paren
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|he_service_rbpl
id|he_service_rbpl
c_func
(paren
r_struct
id|he_dev
op_star
id|he_dev
comma
r_int
id|group
)paren
(brace
r_struct
id|he_rbp
op_star
id|newtail
suffix:semicolon
r_struct
id|he_rbp
op_star
id|rbpl_head
suffix:semicolon
r_int
id|moved
op_assign
l_int|0
suffix:semicolon
id|rbpl_head
op_assign
(paren
r_struct
id|he_rbp
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|he_dev-&gt;rbpl_base
op_or
id|RBPL_MASK
c_func
(paren
id|he_readl
c_func
(paren
id|he_dev
comma
id|G0_RBPL_S
)paren
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|newtail
op_assign
(paren
r_struct
id|he_rbp
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|he_dev-&gt;rbpl_base
op_or
id|RBPL_MASK
c_func
(paren
id|he_dev-&gt;rbpl_tail
op_plus
l_int|1
)paren
)paren
suffix:semicolon
multiline_comment|/* table 3.42 -- rbpl_tail should never be set to rbpl_head */
r_if
c_cond
(paren
(paren
id|newtail
op_eq
id|rbpl_head
)paren
op_logical_or
(paren
id|newtail-&gt;status
op_amp
id|RBP_LOANED
)paren
)paren
r_break
suffix:semicolon
id|newtail-&gt;status
op_or_assign
id|RBP_LOANED
suffix:semicolon
id|he_dev-&gt;rbpl_tail
op_assign
id|newtail
suffix:semicolon
op_increment
id|moved
suffix:semicolon
)brace
r_if
c_cond
(paren
id|moved
)paren
id|he_writel
c_func
(paren
id|he_dev
comma
id|RBPL_MASK
c_func
(paren
id|he_dev-&gt;rbpl_tail
)paren
comma
id|G0_RBPL_T
)paren
suffix:semicolon
)brace
macro_line|#ifdef USE_RBPS
r_static
r_void
DECL|function|he_service_rbps
id|he_service_rbps
c_func
(paren
r_struct
id|he_dev
op_star
id|he_dev
comma
r_int
id|group
)paren
(brace
r_struct
id|he_rbp
op_star
id|newtail
suffix:semicolon
r_struct
id|he_rbp
op_star
id|rbps_head
suffix:semicolon
r_int
id|moved
op_assign
l_int|0
suffix:semicolon
id|rbps_head
op_assign
(paren
r_struct
id|he_rbp
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|he_dev-&gt;rbps_base
op_or
id|RBPS_MASK
c_func
(paren
id|he_readl
c_func
(paren
id|he_dev
comma
id|G0_RBPS_S
)paren
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
id|newtail
op_assign
(paren
r_struct
id|he_rbp
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|he_dev-&gt;rbps_base
op_or
id|RBPS_MASK
c_func
(paren
id|he_dev-&gt;rbps_tail
op_plus
l_int|1
)paren
)paren
suffix:semicolon
multiline_comment|/* table 3.42 -- rbps_tail should never be set to rbps_head */
r_if
c_cond
(paren
(paren
id|newtail
op_eq
id|rbps_head
)paren
op_logical_or
(paren
id|newtail-&gt;status
op_amp
id|RBP_LOANED
)paren
)paren
r_break
suffix:semicolon
id|newtail-&gt;status
op_or_assign
id|RBP_LOANED
suffix:semicolon
id|he_dev-&gt;rbps_tail
op_assign
id|newtail
suffix:semicolon
op_increment
id|moved
suffix:semicolon
)brace
r_if
c_cond
(paren
id|moved
)paren
id|he_writel
c_func
(paren
id|he_dev
comma
id|RBPS_MASK
c_func
(paren
id|he_dev-&gt;rbps_tail
)paren
comma
id|G0_RBPS_T
)paren
suffix:semicolon
)brace
macro_line|#endif /* USE_RBPS */
r_static
r_void
DECL|function|he_tasklet
id|he_tasklet
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|he_dev
op_star
id|he_dev
op_assign
(paren
r_struct
id|he_dev
op_star
)paren
id|data
suffix:semicolon
r_int
id|group
comma
id|type
suffix:semicolon
r_int
id|updated
op_assign
l_int|0
suffix:semicolon
id|HPRINTK
c_func
(paren
l_string|&quot;tasklet (0x%lx)&bslash;n&quot;
comma
id|data
)paren
suffix:semicolon
macro_line|#ifdef USE_TASKLET
id|spin_lock_irqsave
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
macro_line|#endif
r_while
c_loop
(paren
id|he_dev-&gt;irq_head
op_ne
id|he_dev-&gt;irq_tail
)paren
(brace
op_increment
id|updated
suffix:semicolon
id|type
op_assign
id|ITYPE_TYPE
c_func
(paren
id|he_dev-&gt;irq_head-&gt;isw
)paren
suffix:semicolon
id|group
op_assign
id|ITYPE_GROUP
c_func
(paren
id|he_dev-&gt;irq_head-&gt;isw
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|ITYPE_RBRQ_THRESH
suffix:colon
id|HPRINTK
c_func
(paren
l_string|&quot;rbrq%d threshold&bslash;n&quot;
comma
id|group
)paren
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|ITYPE_RBRQ_TIMER
suffix:colon
r_if
c_cond
(paren
id|he_service_rbrq
c_func
(paren
id|he_dev
comma
id|group
)paren
)paren
(brace
id|he_service_rbpl
c_func
(paren
id|he_dev
comma
id|group
)paren
suffix:semicolon
macro_line|#ifdef USE_RBPS
id|he_service_rbps
c_func
(paren
id|he_dev
comma
id|group
)paren
suffix:semicolon
macro_line|#endif /* USE_RBPS */
)brace
r_break
suffix:semicolon
r_case
id|ITYPE_TBRQ_THRESH
suffix:colon
id|HPRINTK
c_func
(paren
l_string|&quot;tbrq%d threshold&bslash;n&quot;
comma
id|group
)paren
suffix:semicolon
multiline_comment|/* fall through */
r_case
id|ITYPE_TPD_COMPLETE
suffix:colon
id|he_service_tbrq
c_func
(paren
id|he_dev
comma
id|group
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITYPE_RBPL_THRESH
suffix:colon
id|he_service_rbpl
c_func
(paren
id|he_dev
comma
id|group
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITYPE_RBPS_THRESH
suffix:colon
macro_line|#ifdef USE_RBPS
id|he_service_rbps
c_func
(paren
id|he_dev
comma
id|group
)paren
suffix:semicolon
macro_line|#endif /* USE_RBPS */
r_break
suffix:semicolon
r_case
id|ITYPE_PHY
suffix:colon
id|HPRINTK
c_func
(paren
l_string|&quot;phy interrupt&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ATM_HE_USE_SUNI
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;atm_dev-&gt;phy
op_logical_and
id|he_dev-&gt;atm_dev-&gt;phy-&gt;interrupt
)paren
id|he_dev-&gt;atm_dev-&gt;phy
op_member_access_from_pointer
id|interrupt
c_func
(paren
id|he_dev-&gt;atm_dev
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
r_case
id|ITYPE_OTHER
suffix:colon
r_switch
c_cond
(paren
id|type
op_or
id|group
)paren
(brace
r_case
id|ITYPE_PARITY
suffix:colon
id|hprintk
c_func
(paren
l_string|&quot;parity error&bslash;n&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ITYPE_ABORT
suffix:colon
id|hprintk
c_func
(paren
l_string|&quot;abort 0x%x&bslash;n&quot;
comma
id|he_readl
c_func
(paren
id|he_dev
comma
id|ABORT_ADDR
)paren
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ITYPE_TYPE
c_func
(paren
id|ITYPE_INVALID
)paren
suffix:colon
multiline_comment|/* see 8.1.1 -- check all queues */
id|HPRINTK
c_func
(paren
l_string|&quot;isw not updated 0x%x&bslash;n&quot;
comma
id|he_dev-&gt;irq_head-&gt;isw
)paren
suffix:semicolon
id|he_service_rbrq
c_func
(paren
id|he_dev
comma
l_int|0
)paren
suffix:semicolon
id|he_service_rbpl
c_func
(paren
id|he_dev
comma
l_int|0
)paren
suffix:semicolon
macro_line|#ifdef USE_RBPS
id|he_service_rbps
c_func
(paren
id|he_dev
comma
l_int|0
)paren
suffix:semicolon
macro_line|#endif /* USE_RBPS */
id|he_service_tbrq
c_func
(paren
id|he_dev
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|hprintk
c_func
(paren
l_string|&quot;bad isw 0x%x?&bslash;n&quot;
comma
id|he_dev-&gt;irq_head-&gt;isw
)paren
suffix:semicolon
)brace
id|he_dev-&gt;irq_head-&gt;isw
op_assign
id|ITYPE_INVALID
suffix:semicolon
id|he_dev-&gt;irq_head
op_assign
(paren
r_struct
id|he_irq
op_star
)paren
id|NEXT_ENTRY
c_func
(paren
id|he_dev-&gt;irq_base
comma
id|he_dev-&gt;irq_head
comma
id|IRQ_MASK
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|updated
)paren
(brace
r_if
c_cond
(paren
id|updated
OG
id|he_dev-&gt;irq_peak
)paren
id|he_dev-&gt;irq_peak
op_assign
id|updated
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|IRQ_SIZE
c_func
(paren
id|CONFIG_IRQ_SIZE
)paren
op_or
id|IRQ_THRESH
c_func
(paren
id|CONFIG_IRQ_THRESH
)paren
op_or
id|IRQ_TAIL
c_func
(paren
id|he_dev-&gt;irq_tail
)paren
comma
id|IRQ0_HEAD
)paren
suffix:semicolon
(paren
r_void
)paren
id|he_readl
c_func
(paren
id|he_dev
comma
id|INT_FIFO
)paren
suffix:semicolon
multiline_comment|/* 8.1.2 controller errata; flush posted writes */
)brace
macro_line|#ifdef USE_TASKLET
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
macro_line|#endif
)brace
r_static
id|irqreturn_t
DECL|function|he_irq_handler
id|he_irq_handler
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|he_dev
op_star
id|he_dev
op_assign
(paren
r_struct
id|he_dev
op_star
)paren
id|dev_id
suffix:semicolon
r_int
id|handled
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|he_dev
op_eq
l_int|NULL
)paren
r_return
id|IRQ_NONE
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
id|he_dev-&gt;irq_tail
op_assign
(paren
r_struct
id|he_irq
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|he_dev-&gt;irq_base
)paren
op_or
(paren
op_star
id|he_dev-&gt;irq_tailoffset
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;irq_tail
op_eq
id|he_dev-&gt;irq_head
)paren
(brace
id|HPRINTK
c_func
(paren
l_string|&quot;tailoffset not updated?&bslash;n&quot;
)paren
suffix:semicolon
id|he_dev-&gt;irq_tail
op_assign
(paren
r_struct
id|he_irq
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|he_dev-&gt;irq_base
op_or
(paren
(paren
id|he_readl
c_func
(paren
id|he_dev
comma
id|IRQ0_BASE
)paren
op_amp
id|IRQ_MASK
)paren
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
(paren
r_void
)paren
id|he_readl
c_func
(paren
id|he_dev
comma
id|INT_FIFO
)paren
suffix:semicolon
multiline_comment|/* 8.1.2 controller errata */
)brace
macro_line|#ifdef DEBUG
r_if
c_cond
(paren
id|he_dev-&gt;irq_head
op_eq
id|he_dev-&gt;irq_tail
multiline_comment|/* &amp;&amp; !IRQ_PENDING */
)paren
id|hprintk
c_func
(paren
l_string|&quot;spurious (or shared) interrupt?&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
id|he_dev-&gt;irq_head
op_ne
id|he_dev-&gt;irq_tail
)paren
(brace
id|handled
op_assign
l_int|1
suffix:semicolon
macro_line|#ifdef USE_TASKLET
id|tasklet_schedule
c_func
(paren
op_amp
id|he_dev-&gt;tasklet
)paren
suffix:semicolon
macro_line|#else
id|he_tasklet
c_func
(paren
(paren
r_int
r_int
)paren
id|he_dev
)paren
suffix:semicolon
macro_line|#endif
id|he_writel
c_func
(paren
id|he_dev
comma
id|INT_CLEAR_A
comma
id|INT_FIFO
)paren
suffix:semicolon
multiline_comment|/* clear interrupt */
(paren
r_void
)paren
id|he_readl
c_func
(paren
id|he_dev
comma
id|INT_FIFO
)paren
suffix:semicolon
multiline_comment|/* flush posted writes */
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|IRQ_RETVAL
c_func
(paren
id|handled
)paren
suffix:semicolon
)brace
r_static
id|__inline__
r_void
DECL|function|__enqueue_tpd
id|__enqueue_tpd
c_func
(paren
r_struct
id|he_dev
op_star
id|he_dev
comma
r_struct
id|he_tpd
op_star
id|tpd
comma
r_int
id|cid
)paren
(brace
r_struct
id|he_tpdrq
op_star
id|new_tail
suffix:semicolon
id|HPRINTK
c_func
(paren
l_string|&quot;tpdrq %p cid 0x%x -&gt; tpdrq_tail %p&bslash;n&quot;
comma
id|tpd
comma
id|cid
comma
id|he_dev-&gt;tpdrq_tail
)paren
suffix:semicolon
multiline_comment|/* new_tail = he_dev-&gt;tpdrq_tail; */
id|new_tail
op_assign
(paren
r_struct
id|he_tpdrq
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|he_dev-&gt;tpdrq_base
op_or
id|TPDRQ_MASK
c_func
(paren
id|he_dev-&gt;tpdrq_tail
op_plus
l_int|1
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * check to see if we are about to set the tail == head&n;&t; * if true, update the head pointer from the adapter&n;&t; * to see if this is really the case (reading the queue&n;&t; * head for every enqueue would be unnecessarily slow)&n;&t; */
r_if
c_cond
(paren
id|new_tail
op_eq
id|he_dev-&gt;tpdrq_head
)paren
(brace
id|he_dev-&gt;tpdrq_head
op_assign
(paren
r_struct
id|he_tpdrq
op_star
)paren
(paren
(paren
(paren
r_int
r_int
)paren
id|he_dev-&gt;tpdrq_base
)paren
op_or
id|TPDRQ_MASK
c_func
(paren
id|he_readl
c_func
(paren
id|he_dev
comma
id|TPDRQ_B_H
)paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_tail
op_eq
id|he_dev-&gt;tpdrq_head
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;tpdrq full (cid 0x%x)&bslash;n&quot;
comma
id|cid
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t;&t; * FIXME&n;&t;&t;&t; * push tpd onto a transmit backlog queue&n;&t;&t;&t; * after service_tbrq, service the backlog&n;&t;&t;&t; * for now, we just drop the pdu&n;&t;&t;&t; */
r_if
c_cond
(paren
id|tpd-&gt;skb
)paren
(brace
r_if
c_cond
(paren
id|tpd-&gt;vcc-&gt;pop
)paren
id|tpd-&gt;vcc
op_member_access_from_pointer
id|pop
c_func
(paren
id|tpd-&gt;vcc
comma
id|tpd-&gt;skb
)paren
suffix:semicolon
r_else
id|dev_kfree_skb_any
c_func
(paren
id|tpd-&gt;skb
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|tpd-&gt;vcc-&gt;stats-&gt;tx_err
)paren
suffix:semicolon
)brace
macro_line|#ifdef USE_TPD_POOL
id|pci_pool_free
c_func
(paren
id|he_dev-&gt;tpd_pool
comma
id|tpd
comma
id|TPD_ADDR
c_func
(paren
id|tpd-&gt;status
)paren
)paren
suffix:semicolon
macro_line|#else
id|tpd-&gt;inuse
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
r_return
suffix:semicolon
)brace
)brace
multiline_comment|/* 2.1.5 transmit packet descriptor ready queue */
macro_line|#ifdef USE_TPD_POOL
id|list_add_tail
c_func
(paren
op_amp
id|tpd-&gt;entry
comma
op_amp
id|he_dev-&gt;outstanding_tpds
)paren
suffix:semicolon
id|he_dev-&gt;tpdrq_tail-&gt;tpd
op_assign
id|TPD_ADDR
c_func
(paren
id|tpd-&gt;status
)paren
suffix:semicolon
macro_line|#else
id|he_dev-&gt;tpdrq_tail-&gt;tpd
op_assign
id|he_dev-&gt;tpd_base_phys
op_plus
(paren
id|TPD_INDEX
c_func
(paren
id|tpd-&gt;status
)paren
op_star
r_sizeof
(paren
r_struct
id|he_tpd
)paren
)paren
suffix:semicolon
macro_line|#endif
id|he_dev-&gt;tpdrq_tail-&gt;cid
op_assign
id|cid
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|he_dev-&gt;tpdrq_tail
op_assign
id|new_tail
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|TPDRQ_MASK
c_func
(paren
id|he_dev-&gt;tpdrq_tail
)paren
comma
id|TPDRQ_T
)paren
suffix:semicolon
(paren
r_void
)paren
id|he_readl
c_func
(paren
id|he_dev
comma
id|TPDRQ_T
)paren
suffix:semicolon
multiline_comment|/* flush posted writes */
)brace
r_static
r_int
DECL|function|he_open
id|he_open
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|he_dev
op_star
id|he_dev
op_assign
id|HE_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
suffix:semicolon
r_struct
id|he_vcc
op_star
id|he_vcc
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_int
id|cid
comma
id|rsr0
comma
id|rsr1
comma
id|rsr4
comma
id|tsr0
comma
id|tsr0_aal
comma
id|tsr4
comma
id|period
comma
id|reg
comma
id|clock
suffix:semicolon
r_int
id|vpi
op_assign
id|vcc-&gt;vpi
suffix:semicolon
r_int
id|vci
op_assign
id|vcc-&gt;vci
suffix:semicolon
r_if
c_cond
(paren
id|vci
op_eq
id|ATM_VCI_UNSPEC
op_logical_or
id|vpi
op_eq
id|ATM_VPI_UNSPEC
)paren
r_return
l_int|0
suffix:semicolon
id|HPRINTK
c_func
(paren
l_string|&quot;open vcc %p %d.%d&bslash;n&quot;
comma
id|vcc
comma
id|vpi
comma
id|vci
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|ATM_VF_ADDR
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
id|cid
op_assign
id|he_mkcid
c_func
(paren
id|he_dev
comma
id|vpi
comma
id|vci
)paren
suffix:semicolon
id|he_vcc
op_assign
(paren
r_struct
id|he_vcc
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|he_vcc
)paren
comma
id|GFP_ATOMIC
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_vcc
op_eq
l_int|NULL
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;unable to allocate he_vcc during open&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|he_vcc-&gt;iov_tail
op_assign
id|he_vcc-&gt;iov_head
suffix:semicolon
id|he_vcc-&gt;pdu_len
op_assign
l_int|0
suffix:semicolon
id|he_vcc-&gt;rc_index
op_assign
op_minus
l_int|1
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|he_vcc-&gt;rx_waitq
)paren
suffix:semicolon
id|init_waitqueue_head
c_func
(paren
op_amp
id|he_vcc-&gt;tx_waitq
)paren
suffix:semicolon
id|vcc-&gt;dev_data
op_assign
id|he_vcc
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;qos.txtp.traffic_class
op_ne
id|ATM_NONE
)paren
(brace
r_int
id|pcr_goal
suffix:semicolon
id|pcr_goal
op_assign
id|atm_pcr_goal
c_func
(paren
op_amp
id|vcc-&gt;qos.txtp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcr_goal
op_eq
l_int|0
)paren
id|pcr_goal
op_assign
id|he_dev-&gt;atm_dev-&gt;link_rate
suffix:semicolon
r_if
c_cond
(paren
id|pcr_goal
OL
l_int|0
)paren
multiline_comment|/* means round down, technically */
id|pcr_goal
op_assign
op_minus
id|pcr_goal
suffix:semicolon
id|HPRINTK
c_func
(paren
l_string|&quot;open tx cid 0x%x pcr_goal %d&bslash;n&quot;
comma
id|cid
comma
id|pcr_goal
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|vcc-&gt;qos.aal
)paren
(brace
r_case
id|ATM_AAL5
suffix:colon
id|tsr0_aal
op_assign
id|TSR0_AAL5
suffix:semicolon
id|tsr4
op_assign
id|TSR4_AAL5
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_AAL0
suffix:colon
id|tsr0_aal
op_assign
id|TSR0_AAL0_SDU
suffix:semicolon
id|tsr4
op_assign
id|TSR4_AAL0_SDU
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|open_failed
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
id|tsr0
op_assign
id|he_readl_tsr0
c_func
(paren
id|he_dev
comma
id|cid
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|TSR0_CONN_STATE
c_func
(paren
id|tsr0
)paren
op_ne
l_int|0
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;cid 0x%x not idle (tsr0 = 0x%x)&bslash;n&quot;
comma
id|cid
comma
id|tsr0
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|open_failed
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|vcc-&gt;qos.txtp.traffic_class
)paren
(brace
r_case
id|ATM_UBR
suffix:colon
multiline_comment|/* 2.3.3.1 open connection ubr */
id|tsr0
op_assign
id|TSR0_UBR
op_or
id|TSR0_GROUP
c_func
(paren
l_int|0
)paren
op_or
id|tsr0_aal
op_or
id|TSR0_USE_WMIN
op_or
id|TSR0_UPDATE_GER
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_CBR
suffix:colon
multiline_comment|/* 2.3.3.2 open connection cbr */
multiline_comment|/* 8.2.3 cbr scheduler wrap problem -- limit to 90% total link rate */
r_if
c_cond
(paren
(paren
id|he_dev-&gt;total_bw
op_plus
id|pcr_goal
)paren
OG
(paren
id|he_dev-&gt;atm_dev-&gt;link_rate
op_star
l_int|9
op_div
l_int|10
)paren
)paren
(brace
id|err
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|open_failed
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
multiline_comment|/* also protects he_dev-&gt;cs_stper[] */
multiline_comment|/* find an unused cs_stper register */
r_for
c_loop
(paren
id|reg
op_assign
l_int|0
suffix:semicolon
id|reg
OL
id|HE_NUM_CS_STPER
suffix:semicolon
op_increment
id|reg
)paren
r_if
c_cond
(paren
id|he_dev-&gt;cs_stper
(braket
id|reg
)braket
dot
id|inuse
op_eq
l_int|0
op_logical_or
id|he_dev-&gt;cs_stper
(braket
id|reg
)braket
dot
id|pcr
op_eq
id|pcr_goal
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|reg
op_eq
id|HE_NUM_CS_STPER
)paren
(brace
id|err
op_assign
op_minus
id|EBUSY
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
r_goto
id|open_failed
suffix:semicolon
)brace
id|he_dev-&gt;total_bw
op_add_assign
id|pcr_goal
suffix:semicolon
id|he_vcc-&gt;rc_index
op_assign
id|reg
suffix:semicolon
op_increment
id|he_dev-&gt;cs_stper
(braket
id|reg
)braket
dot
id|inuse
suffix:semicolon
id|he_dev-&gt;cs_stper
(braket
id|reg
)braket
dot
id|pcr
op_assign
id|pcr_goal
suffix:semicolon
id|clock
op_assign
id|he_is622
c_func
(paren
id|he_dev
)paren
ques
c_cond
l_int|66667000
suffix:colon
l_int|50000000
suffix:semicolon
id|period
op_assign
id|clock
op_div
id|pcr_goal
suffix:semicolon
id|HPRINTK
c_func
(paren
l_string|&quot;rc_index = %d period = %d&bslash;n&quot;
comma
id|reg
comma
id|period
)paren
suffix:semicolon
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
id|rate_to_atmf
c_func
(paren
id|period
op_div
l_int|2
)paren
comma
id|CS_STPER0
op_plus
id|reg
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
id|tsr0
op_assign
id|TSR0_CBR
op_or
id|TSR0_GROUP
c_func
(paren
l_int|0
)paren
op_or
id|tsr0_aal
op_or
id|TSR0_RC_INDEX
c_func
(paren
id|reg
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|open_failed
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
id|he_writel_tsr0
c_func
(paren
id|he_dev
comma
id|tsr0
comma
id|cid
)paren
suffix:semicolon
id|he_writel_tsr4
c_func
(paren
id|he_dev
comma
id|tsr4
op_or
l_int|1
comma
id|cid
)paren
suffix:semicolon
id|he_writel_tsr1
c_func
(paren
id|he_dev
comma
id|TSR1_MCR
c_func
(paren
id|rate_to_atmf
c_func
(paren
l_int|0
)paren
)paren
op_or
id|TSR1_PCR
c_func
(paren
id|rate_to_atmf
c_func
(paren
id|pcr_goal
)paren
)paren
comma
id|cid
)paren
suffix:semicolon
id|he_writel_tsr2
c_func
(paren
id|he_dev
comma
id|TSR2_ACR
c_func
(paren
id|rate_to_atmf
c_func
(paren
id|pcr_goal
)paren
)paren
comma
id|cid
)paren
suffix:semicolon
id|he_writel_tsr9
c_func
(paren
id|he_dev
comma
id|TSR9_OPEN_CONN
comma
id|cid
)paren
suffix:semicolon
id|he_writel_tsr3
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|cid
)paren
suffix:semicolon
id|he_writel_tsr5
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|cid
)paren
suffix:semicolon
id|he_writel_tsr6
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|cid
)paren
suffix:semicolon
id|he_writel_tsr7
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|cid
)paren
suffix:semicolon
id|he_writel_tsr8
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|cid
)paren
suffix:semicolon
id|he_writel_tsr10
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|cid
)paren
suffix:semicolon
id|he_writel_tsr11
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|cid
)paren
suffix:semicolon
id|he_writel_tsr12
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|cid
)paren
suffix:semicolon
id|he_writel_tsr13
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|cid
)paren
suffix:semicolon
id|he_writel_tsr14
c_func
(paren
id|he_dev
comma
l_int|0x0
comma
id|cid
)paren
suffix:semicolon
(paren
r_void
)paren
id|he_readl_tsr0
c_func
(paren
id|he_dev
comma
id|cid
)paren
suffix:semicolon
multiline_comment|/* flush posted writes */
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vcc-&gt;qos.rxtp.traffic_class
op_ne
id|ATM_NONE
)paren
(brace
r_int
id|aal
suffix:semicolon
id|HPRINTK
c_func
(paren
l_string|&quot;open rx cid 0x%x (rx_waitq %p)&bslash;n&quot;
comma
id|cid
comma
op_amp
id|HE_VCC
c_func
(paren
id|vcc
)paren
op_member_access_from_pointer
id|rx_waitq
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|vcc-&gt;qos.aal
)paren
(brace
r_case
id|ATM_AAL5
suffix:colon
id|aal
op_assign
id|RSR0_AAL5
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_AAL0
suffix:colon
id|aal
op_assign
id|RSR0_RAWCELL
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_goto
id|open_failed
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
id|rsr0
op_assign
id|he_readl_rsr0
c_func
(paren
id|he_dev
comma
id|cid
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rsr0
op_amp
id|RSR0_OPEN_CONN
)paren
(brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
id|hprintk
c_func
(paren
l_string|&quot;cid 0x%x not idle (rsr0 = 0x%x)&bslash;n&quot;
comma
id|cid
comma
id|rsr0
)paren
suffix:semicolon
id|err
op_assign
op_minus
id|EBUSY
suffix:semicolon
r_goto
id|open_failed
suffix:semicolon
)brace
macro_line|#ifdef USE_RBPS
id|rsr1
op_assign
id|RSR1_GROUP
c_func
(paren
l_int|0
)paren
suffix:semicolon
id|rsr4
op_assign
id|RSR4_GROUP
c_func
(paren
l_int|0
)paren
suffix:semicolon
macro_line|#else /* !USE_RBPS */
id|rsr1
op_assign
id|RSR1_GROUP
c_func
(paren
l_int|0
)paren
op_or
id|RSR1_RBPL_ONLY
suffix:semicolon
id|rsr4
op_assign
id|RSR4_GROUP
c_func
(paren
l_int|0
)paren
op_or
id|RSR4_RBPL_ONLY
suffix:semicolon
macro_line|#endif /* USE_RBPS */
id|rsr0
op_assign
id|vcc-&gt;qos.rxtp.traffic_class
op_eq
id|ATM_UBR
ques
c_cond
(paren
id|RSR0_EPD_ENABLE
op_or
id|RSR0_PPD_ENABLE
)paren
suffix:colon
l_int|0
suffix:semicolon
macro_line|#ifdef USE_CHECKSUM_HW
r_if
c_cond
(paren
id|vpi
op_eq
l_int|0
op_logical_and
id|vci
op_ge
id|ATM_NOT_RSV_VCI
)paren
id|rsr0
op_or_assign
id|RSR0_TCP_CKSUM
suffix:semicolon
macro_line|#endif
id|he_writel_rsr4
c_func
(paren
id|he_dev
comma
id|rsr4
comma
id|cid
)paren
suffix:semicolon
id|he_writel_rsr1
c_func
(paren
id|he_dev
comma
id|rsr1
comma
id|cid
)paren
suffix:semicolon
multiline_comment|/* 5.1.11 last parameter initialized should be&n;&t;&t;&t;  the open/closed indication in rsr0 */
id|he_writel_rsr0
c_func
(paren
id|he_dev
comma
id|rsr0
op_or
id|RSR0_START_PDU
op_or
id|RSR0_OPEN_CONN
op_or
id|aal
comma
id|cid
)paren
suffix:semicolon
(paren
r_void
)paren
id|he_readl_rsr0
c_func
(paren
id|he_dev
comma
id|cid
)paren
suffix:semicolon
multiline_comment|/* flush posted writes */
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
)brace
id|open_failed
suffix:colon
r_if
c_cond
(paren
id|err
)paren
(brace
r_if
c_cond
(paren
id|he_vcc
)paren
id|kfree
c_func
(paren
id|he_vcc
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|ATM_VF_ADDR
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
)brace
r_else
id|set_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_static
r_void
DECL|function|he_close
id|he_close
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|DECLARE_WAITQUEUE
c_func
(paren
id|wait
comma
id|current
)paren
suffix:semicolon
r_struct
id|he_dev
op_star
id|he_dev
op_assign
id|HE_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
suffix:semicolon
r_struct
id|he_tpd
op_star
id|tpd
suffix:semicolon
r_int
id|cid
suffix:semicolon
r_struct
id|he_vcc
op_star
id|he_vcc
op_assign
id|HE_VCC
c_func
(paren
id|vcc
)paren
suffix:semicolon
DECL|macro|MAX_RETRY
mdefine_line|#define MAX_RETRY 30
r_int
id|retry
op_assign
l_int|0
comma
id|sleep
op_assign
l_int|1
comma
id|tx_inuse
suffix:semicolon
id|HPRINTK
c_func
(paren
l_string|&quot;close vcc %p %d.%d&bslash;n&quot;
comma
id|vcc
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
id|cid
op_assign
id|he_mkcid
c_func
(paren
id|he_dev
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;qos.rxtp.traffic_class
op_ne
id|ATM_NONE
)paren
(brace
r_int
id|timeout
suffix:semicolon
id|HPRINTK
c_func
(paren
l_string|&quot;close rx cid 0x%x&bslash;n&quot;
comma
id|cid
)paren
suffix:semicolon
multiline_comment|/* 2.7.2.2 close receive operation */
multiline_comment|/* wait for previous close (if any) to finish */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
r_while
c_loop
(paren
id|he_readl
c_func
(paren
id|he_dev
comma
id|RCC_STAT
)paren
op_amp
id|RCC_BUSY
)paren
(brace
id|HPRINTK
c_func
(paren
l_string|&quot;close cid 0x%x RCC_BUSY&bslash;n&quot;
comma
id|cid
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|250
)paren
suffix:semicolon
)brace
id|add_wait_queue
c_func
(paren
op_amp
id|he_vcc-&gt;rx_waitq
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|he_writel_rsr0
c_func
(paren
id|he_dev
comma
id|RSR0_CLOSE_CONN
comma
id|cid
)paren
suffix:semicolon
(paren
r_void
)paren
id|he_readl_rsr0
c_func
(paren
id|he_dev
comma
id|cid
)paren
suffix:semicolon
multiline_comment|/* flush posted writes */
id|he_writel_mbox
c_func
(paren
id|he_dev
comma
id|cid
comma
id|RXCON_CLOSE
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
id|timeout
op_assign
id|schedule_timeout
c_func
(paren
l_int|30
op_star
id|HZ
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|he_vcc-&gt;rx_waitq
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
r_if
c_cond
(paren
id|timeout
op_eq
l_int|0
)paren
id|hprintk
c_func
(paren
l_string|&quot;close rx timeout cid 0x%x&bslash;n&quot;
comma
id|cid
)paren
suffix:semicolon
id|HPRINTK
c_func
(paren
l_string|&quot;close rx cid 0x%x complete&bslash;n&quot;
comma
id|cid
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vcc-&gt;qos.txtp.traffic_class
op_ne
id|ATM_NONE
)paren
(brace
r_volatile
r_int
id|tsr4
comma
id|tsr0
suffix:semicolon
r_int
id|timeout
suffix:semicolon
id|HPRINTK
c_func
(paren
l_string|&quot;close tx cid 0x%x&bslash;n&quot;
comma
id|cid
)paren
suffix:semicolon
multiline_comment|/* 2.1.2&n;&t;&t; *&n;&t;&t; * ... the host must first stop queueing packets to the TPDRQ&n;&t;&t; * on the connection to be closed, then wait for all outstanding&n;&t;&t; * packets to be transmitted and their buffers returned to the&n;&t;&t; * TBRQ. When the last packet on the connection arrives in the&n;&t;&t; * TBRQ, the host issues the close command to the adapter.&n;&t;&t; */
r_while
c_loop
(paren
(paren
(paren
id|tx_inuse
op_assign
id|atomic_read
c_func
(paren
op_amp
id|vcc-&gt;sk-&gt;sk_wmem_alloc
)paren
)paren
OG
l_int|0
)paren
op_logical_and
(paren
id|retry
OL
id|MAX_RETRY
)paren
)paren
(brace
id|msleep
c_func
(paren
id|sleep
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sleep
OL
l_int|250
)paren
id|sleep
op_assign
id|sleep
op_star
l_int|2
suffix:semicolon
op_increment
id|retry
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tx_inuse
)paren
id|hprintk
c_func
(paren
l_string|&quot;close tx cid 0x%x tx_inuse = %d&bslash;n&quot;
comma
id|cid
comma
id|tx_inuse
)paren
suffix:semicolon
multiline_comment|/* 2.3.1.1 generic close operations with flush */
id|spin_lock_irqsave
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
id|he_writel_tsr4_upper
c_func
(paren
id|he_dev
comma
id|TSR4_FLUSH_CONN
comma
id|cid
)paren
suffix:semicolon
multiline_comment|/* also clears TSR4_SESSION_ENDED */
r_switch
c_cond
(paren
id|vcc-&gt;qos.txtp.traffic_class
)paren
(brace
r_case
id|ATM_UBR
suffix:colon
id|he_writel_tsr1
c_func
(paren
id|he_dev
comma
id|TSR1_MCR
c_func
(paren
id|rate_to_atmf
c_func
(paren
l_int|200000
)paren
)paren
op_or
id|TSR1_PCR
c_func
(paren
l_int|0
)paren
comma
id|cid
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_CBR
suffix:colon
id|he_writel_tsr14_upper
c_func
(paren
id|he_dev
comma
id|TSR14_DELETE
comma
id|cid
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
(paren
r_void
)paren
id|he_readl_tsr4
c_func
(paren
id|he_dev
comma
id|cid
)paren
suffix:semicolon
multiline_comment|/* flush posted writes */
id|tpd
op_assign
id|__alloc_tpd
c_func
(paren
id|he_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tpd
op_eq
l_int|NULL
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;close tx he_alloc_tpd failed cid 0x%x&bslash;n&quot;
comma
id|cid
)paren
suffix:semicolon
r_goto
id|close_tx_incomplete
suffix:semicolon
)brace
id|tpd-&gt;status
op_or_assign
id|TPD_EOS
op_or
id|TPD_INT
suffix:semicolon
id|tpd-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
id|tpd-&gt;vcc
op_assign
id|vcc
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|add_wait_queue
c_func
(paren
op_amp
id|he_vcc-&gt;tx_waitq
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_UNINTERRUPTIBLE
)paren
suffix:semicolon
id|__enqueue_tpd
c_func
(paren
id|he_dev
comma
id|tpd
comma
id|cid
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
id|timeout
op_assign
id|schedule_timeout
c_func
(paren
l_int|30
op_star
id|HZ
)paren
suffix:semicolon
id|remove_wait_queue
c_func
(paren
op_amp
id|he_vcc-&gt;tx_waitq
comma
op_amp
id|wait
)paren
suffix:semicolon
id|set_current_state
c_func
(paren
id|TASK_RUNNING
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|timeout
op_eq
l_int|0
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;close tx timeout cid 0x%x&bslash;n&quot;
comma
id|cid
)paren
suffix:semicolon
r_goto
id|close_tx_incomplete
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
(paren
(paren
id|tsr4
op_assign
id|he_readl_tsr4
c_func
(paren
id|he_dev
comma
id|cid
)paren
)paren
op_amp
id|TSR4_SESSION_ENDED
)paren
)paren
(brace
id|HPRINTK
c_func
(paren
l_string|&quot;close tx cid 0x%x !TSR4_SESSION_ENDED (tsr4 = 0x%x)&bslash;n&quot;
comma
id|cid
comma
id|tsr4
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|250
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|TSR0_CONN_STATE
c_func
(paren
id|tsr0
op_assign
id|he_readl_tsr0
c_func
(paren
id|he_dev
comma
id|cid
)paren
)paren
op_ne
l_int|0
)paren
(brace
id|HPRINTK
c_func
(paren
l_string|&quot;close tx cid 0x%x TSR0_CONN_STATE != 0 (tsr0 = 0x%x)&bslash;n&quot;
comma
id|cid
comma
id|tsr0
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|250
)paren
suffix:semicolon
)brace
id|close_tx_incomplete
suffix:colon
r_if
c_cond
(paren
id|vcc-&gt;qos.txtp.traffic_class
op_eq
id|ATM_CBR
)paren
(brace
r_int
id|reg
op_assign
id|he_vcc-&gt;rc_index
suffix:semicolon
id|HPRINTK
c_func
(paren
l_string|&quot;cs_stper reg = %d&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|he_dev-&gt;cs_stper
(braket
id|reg
)braket
dot
id|inuse
op_eq
l_int|0
)paren
id|hprintk
c_func
(paren
l_string|&quot;cs_stper[%d].inuse = 0!&bslash;n&quot;
comma
id|reg
)paren
suffix:semicolon
r_else
op_decrement
id|he_dev-&gt;cs_stper
(braket
id|reg
)braket
dot
id|inuse
suffix:semicolon
id|he_dev-&gt;total_bw
op_sub_assign
id|he_dev-&gt;cs_stper
(braket
id|reg
)braket
dot
id|pcr
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
id|HPRINTK
c_func
(paren
l_string|&quot;close tx cid 0x%x complete&bslash;n&quot;
comma
id|cid
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|he_vcc
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|ATM_VF_ADDR
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|he_send
id|he_send
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|he_dev
op_star
id|he_dev
op_assign
id|HE_DEV
c_func
(paren
id|vcc-&gt;dev
)paren
suffix:semicolon
r_int
id|cid
op_assign
id|he_mkcid
c_func
(paren
id|he_dev
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
)paren
suffix:semicolon
r_struct
id|he_tpd
op_star
id|tpd
suffix:semicolon
macro_line|#ifdef USE_SCATTERGATHER
r_int
id|i
comma
id|slot
op_assign
l_int|0
suffix:semicolon
macro_line|#endif
DECL|macro|HE_TPD_BUFSIZE
mdefine_line|#define HE_TPD_BUFSIZE 0xffff
id|HPRINTK
c_func
(paren
l_string|&quot;send %d.%d&bslash;n&quot;
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|skb-&gt;len
OG
id|HE_TPD_BUFSIZE
)paren
op_logical_or
(paren
(paren
id|vcc-&gt;qos.aal
op_eq
id|ATM_AAL0
)paren
op_logical_and
(paren
id|skb-&gt;len
op_ne
id|ATM_AAL0_SDU
)paren
)paren
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;buffer too large (or small) -- %d bytes&bslash;n&quot;
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;pop
)paren
id|vcc
op_member_access_from_pointer
id|pop
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
r_else
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;tx_err
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
macro_line|#ifndef USE_SCATTERGATHER
r_if
c_cond
(paren
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
)paren
(brace
id|hprintk
c_func
(paren
l_string|&quot;no scatter/gather support&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;pop
)paren
id|vcc
op_member_access_from_pointer
id|pop
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
r_else
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;tx_err
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
macro_line|#endif
id|spin_lock_irqsave
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
id|tpd
op_assign
id|__alloc_tpd
c_func
(paren
id|he_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tpd
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|vcc-&gt;pop
)paren
id|vcc
op_member_access_from_pointer
id|pop
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
r_else
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;tx_err
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vcc-&gt;qos.aal
op_eq
id|ATM_AAL5
)paren
id|tpd-&gt;status
op_or_assign
id|TPD_CELLTYPE
c_func
(paren
id|TPD_USERCELL
)paren
suffix:semicolon
r_else
(brace
r_char
op_star
id|pti_clp
op_assign
(paren
r_void
op_star
)paren
(paren
id|skb-&gt;data
op_plus
l_int|3
)paren
suffix:semicolon
r_int
id|clp
comma
id|pti
suffix:semicolon
id|pti
op_assign
(paren
op_star
id|pti_clp
op_amp
id|ATM_HDR_PTI_MASK
)paren
op_rshift
id|ATM_HDR_PTI_SHIFT
suffix:semicolon
id|clp
op_assign
(paren
op_star
id|pti_clp
op_amp
id|ATM_HDR_CLP
)paren
suffix:semicolon
id|tpd-&gt;status
op_or_assign
id|TPD_CELLTYPE
c_func
(paren
id|pti
)paren
suffix:semicolon
r_if
c_cond
(paren
id|clp
)paren
id|tpd-&gt;status
op_or_assign
id|TPD_CLP
suffix:semicolon
id|skb_pull
c_func
(paren
id|skb
comma
id|ATM_AAL0_SDU
op_minus
id|ATM_CELL_PAYLOAD
)paren
suffix:semicolon
)brace
macro_line|#ifdef USE_SCATTERGATHER
id|tpd-&gt;iovec
(braket
id|slot
)braket
dot
id|addr
op_assign
id|pci_map_single
c_func
(paren
id|he_dev-&gt;pci_dev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
op_minus
id|skb-&gt;data_len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|tpd-&gt;iovec
(braket
id|slot
)braket
dot
id|len
op_assign
id|skb-&gt;len
op_minus
id|skb-&gt;data_len
suffix:semicolon
op_increment
id|slot
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|nr_frags
suffix:semicolon
id|i
op_increment
)paren
(brace
id|skb_frag_t
op_star
id|frag
op_assign
op_amp
id|skb_shinfo
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|frags
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|slot
op_eq
id|TPD_MAXIOV
)paren
(brace
multiline_comment|/* queue tpd; start new tpd */
id|tpd-&gt;vcc
op_assign
id|vcc
suffix:semicolon
id|tpd-&gt;skb
op_assign
l_int|NULL
suffix:semicolon
multiline_comment|/* not the last fragment&n;&t;&t;&t;&t;&t;&t;   so dont -&gt;push() yet */
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|__enqueue_tpd
c_func
(paren
id|he_dev
comma
id|tpd
comma
id|cid
)paren
suffix:semicolon
id|tpd
op_assign
id|__alloc_tpd
c_func
(paren
id|he_dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tpd
op_eq
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
id|vcc-&gt;pop
)paren
id|vcc
op_member_access_from_pointer
id|pop
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
r_else
id|dev_kfree_skb_any
c_func
(paren
id|skb
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;tx_err
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|tpd-&gt;status
op_or_assign
id|TPD_USERCELL
suffix:semicolon
id|slot
op_assign
l_int|0
suffix:semicolon
)brace
id|tpd-&gt;iovec
(braket
id|slot
)braket
dot
id|addr
op_assign
id|pci_map_single
c_func
(paren
id|he_dev-&gt;pci_dev
comma
(paren
r_void
op_star
)paren
id|page_address
c_func
(paren
id|frag-&gt;page
)paren
op_plus
id|frag-&gt;page_offset
comma
id|frag-&gt;size
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|tpd-&gt;iovec
(braket
id|slot
)braket
dot
id|len
op_assign
id|frag-&gt;size
suffix:semicolon
op_increment
id|slot
suffix:semicolon
)brace
id|tpd-&gt;iovec
(braket
id|slot
op_minus
l_int|1
)braket
dot
id|len
op_or_assign
id|TPD_LST
suffix:semicolon
macro_line|#else
id|tpd-&gt;address0
op_assign
id|pci_map_single
c_func
(paren
id|he_dev-&gt;pci_dev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|tpd-&gt;length0
op_assign
id|skb-&gt;len
op_or
id|TPD_LST
suffix:semicolon
macro_line|#endif
id|tpd-&gt;status
op_or_assign
id|TPD_INT
suffix:semicolon
id|tpd-&gt;vcc
op_assign
id|vcc
suffix:semicolon
id|tpd-&gt;skb
op_assign
id|skb
suffix:semicolon
id|wmb
c_func
(paren
)paren
suffix:semicolon
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|vcc
op_assign
id|vcc
suffix:semicolon
id|__enqueue_tpd
c_func
(paren
id|he_dev
comma
id|tpd
comma
id|cid
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;tx
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|he_ioctl
id|he_ioctl
c_func
(paren
r_struct
id|atm_dev
op_star
id|atm_dev
comma
r_int
r_int
id|cmd
comma
r_void
id|__user
op_star
id|arg
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|he_dev
op_star
id|he_dev
op_assign
id|HE_DEV
c_func
(paren
id|atm_dev
)paren
suffix:semicolon
r_struct
id|he_ioctl_reg
id|reg
suffix:semicolon
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|cmd
)paren
(brace
r_case
id|HE_GET_REG
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|capable
c_func
(paren
id|CAP_NET_ADMIN
)paren
)paren
r_return
op_minus
id|EPERM
suffix:semicolon
r_if
c_cond
(paren
id|copy_from_user
c_func
(paren
op_amp
id|reg
comma
id|arg
comma
r_sizeof
(paren
r_struct
id|he_ioctl_reg
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|reg.type
)paren
(brace
r_case
id|HE_REGTYPE_PCI
suffix:colon
id|reg.val
op_assign
id|he_readl
c_func
(paren
id|he_dev
comma
id|reg.addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HE_REGTYPE_RCM
suffix:colon
id|reg.val
op_assign
id|he_readl_rcm
c_func
(paren
id|he_dev
comma
id|reg.addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HE_REGTYPE_TCM
suffix:colon
id|reg.val
op_assign
id|he_readl_tcm
c_func
(paren
id|he_dev
comma
id|reg.addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|HE_REGTYPE_MBOX
suffix:colon
id|reg.val
op_assign
id|he_readl_mbox
c_func
(paren
id|he_dev
comma
id|reg.addr
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_break
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
op_eq
l_int|0
)paren
r_if
c_cond
(paren
id|copy_to_user
c_func
(paren
id|arg
comma
op_amp
id|reg
comma
r_sizeof
(paren
r_struct
id|he_ioctl_reg
)paren
)paren
)paren
r_return
op_minus
id|EFAULT
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
(brace
)brace
macro_line|#ifdef CONFIG_ATM_HE_USE_SUNI
r_if
c_cond
(paren
id|atm_dev-&gt;phy
op_logical_and
id|atm_dev-&gt;phy-&gt;ioctl
)paren
id|err
op_assign
id|atm_dev-&gt;phy
op_member_access_from_pointer
id|ioctl
c_func
(paren
id|atm_dev
comma
id|cmd
comma
id|arg
)paren
suffix:semicolon
macro_line|#else /* CONFIG_ATM_HE_USE_SUNI */
id|err
op_assign
op_minus
id|EINVAL
suffix:semicolon
macro_line|#endif /* CONFIG_ATM_HE_USE_SUNI */
r_break
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
r_static
r_void
DECL|function|he_phy_put
id|he_phy_put
c_func
(paren
r_struct
id|atm_dev
op_star
id|atm_dev
comma
r_int
r_char
id|val
comma
r_int
r_int
id|addr
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|he_dev
op_star
id|he_dev
op_assign
id|HE_DEV
c_func
(paren
id|atm_dev
)paren
suffix:semicolon
id|HPRINTK
c_func
(paren
l_string|&quot;phy_put(val 0x%x, addr 0x%lx)&bslash;n&quot;
comma
id|val
comma
id|addr
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|val
comma
id|FRAMER
op_plus
(paren
id|addr
op_star
l_int|4
)paren
)paren
suffix:semicolon
(paren
r_void
)paren
id|he_readl
c_func
(paren
id|he_dev
comma
id|FRAMER
op_plus
(paren
id|addr
op_star
l_int|4
)paren
)paren
suffix:semicolon
multiline_comment|/* flush posted writes */
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_int
r_char
DECL|function|he_phy_get
id|he_phy_get
c_func
(paren
r_struct
id|atm_dev
op_star
id|atm_dev
comma
r_int
r_int
id|addr
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|he_dev
op_star
id|he_dev
op_assign
id|HE_DEV
c_func
(paren
id|atm_dev
)paren
suffix:semicolon
r_int
id|reg
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
id|reg
op_assign
id|he_readl
c_func
(paren
id|he_dev
comma
id|FRAMER
op_plus
(paren
id|addr
op_star
l_int|4
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
id|HPRINTK
c_func
(paren
l_string|&quot;phy_get(addr 0x%lx) =0x%x&bslash;n&quot;
comma
id|addr
comma
id|reg
)paren
suffix:semicolon
r_return
id|reg
suffix:semicolon
)brace
r_static
r_int
DECL|function|he_proc_read
id|he_proc_read
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
comma
id|loff_t
op_star
id|pos
comma
r_char
op_star
id|page
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|he_dev
op_star
id|he_dev
op_assign
id|HE_DEV
c_func
(paren
id|dev
)paren
suffix:semicolon
r_int
id|left
comma
id|i
suffix:semicolon
macro_line|#ifdef notdef
r_struct
id|he_rbrq
op_star
id|rbrq_tail
suffix:semicolon
r_struct
id|he_tpdrq
op_star
id|tpdrq_head
suffix:semicolon
r_int
id|rbpl_head
comma
id|rbpl_tail
suffix:semicolon
macro_line|#endif
r_static
r_int
id|mcc
op_assign
l_int|0
comma
id|oec
op_assign
l_int|0
comma
id|dcc
op_assign
l_int|0
comma
id|cec
op_assign
l_int|0
suffix:semicolon
id|left
op_assign
op_star
id|pos
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|version
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%s%s&bslash;n&bslash;n&quot;
comma
id|he_dev-&gt;prod_id
comma
id|he_dev-&gt;media
op_amp
l_int|0x40
ques
c_cond
l_string|&quot;SM&quot;
suffix:colon
l_string|&quot;MM&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;Mismatched Cells  VPI/VCI Not Open  Dropped Cells  RCM Dropped Cells&bslash;n&quot;
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
id|mcc
op_add_assign
id|he_readl
c_func
(paren
id|he_dev
comma
id|MCC
)paren
suffix:semicolon
id|oec
op_add_assign
id|he_readl
c_func
(paren
id|he_dev
comma
id|OEC
)paren
suffix:semicolon
id|dcc
op_add_assign
id|he_readl
c_func
(paren
id|he_dev
comma
id|DCC
)paren
suffix:semicolon
id|cec
op_add_assign
id|he_readl
c_func
(paren
id|he_dev
comma
id|CEC
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|he_dev-&gt;global_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;%16ld  %16ld  %13ld  %17ld&bslash;n&bslash;n&quot;
comma
id|mcc
comma
id|oec
comma
id|dcc
comma
id|cec
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;irq_size = %d  inuse = ?  peak = %d&bslash;n&quot;
comma
id|CONFIG_IRQ_SIZE
comma
id|he_dev-&gt;irq_peak
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;tpdrq_size = %d  inuse = ?&bslash;n&quot;
comma
id|CONFIG_TPDRQ_SIZE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;rbrq_size = %d  inuse = ?  peak = %d&bslash;n&quot;
comma
id|CONFIG_RBRQ_SIZE
comma
id|he_dev-&gt;rbrq_peak
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;tbrq_size = %d  peak = %d&bslash;n&quot;
comma
id|CONFIG_TBRQ_SIZE
comma
id|he_dev-&gt;tbrq_peak
)paren
suffix:semicolon
macro_line|#ifdef notdef
id|rbpl_head
op_assign
id|RBPL_MASK
c_func
(paren
id|he_readl
c_func
(paren
id|he_dev
comma
id|G0_RBPL_S
)paren
)paren
suffix:semicolon
id|rbpl_tail
op_assign
id|RBPL_MASK
c_func
(paren
id|he_readl
c_func
(paren
id|he_dev
comma
id|G0_RBPL_T
)paren
)paren
suffix:semicolon
id|inuse
op_assign
id|rbpl_head
op_minus
id|rbpl_tail
suffix:semicolon
r_if
c_cond
(paren
id|inuse
OL
l_int|0
)paren
id|inuse
op_add_assign
id|CONFIG_RBPL_SIZE
op_star
r_sizeof
(paren
r_struct
id|he_rbp
)paren
suffix:semicolon
id|inuse
op_div_assign
r_sizeof
(paren
r_struct
id|he_rbp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;rbpl_size = %d  inuse = %d&bslash;n&bslash;n&quot;
comma
id|CONFIG_RBPL_SIZE
comma
id|inuse
)paren
suffix:semicolon
macro_line|#endif
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;rate controller periods (cbr)&bslash;n                 pcr  #vc&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|HE_NUM_CS_STPER
suffix:semicolon
op_increment
id|i
)paren
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;cs_stper%-2d  %8ld  %3d&bslash;n&quot;
comma
id|i
comma
id|he_dev-&gt;cs_stper
(braket
id|i
)braket
dot
id|pcr
comma
id|he_dev-&gt;cs_stper
(braket
id|i
)braket
dot
id|inuse
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;total bw (cbr): %d  (limit %d)&bslash;n&quot;
comma
id|he_dev-&gt;total_bw
comma
id|he_dev-&gt;atm_dev-&gt;link_rate
op_star
l_int|10
op_div
l_int|9
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* eeprom routines  -- see 4.7 */
id|u8
DECL|function|read_prom_byte
id|read_prom_byte
c_func
(paren
r_struct
id|he_dev
op_star
id|he_dev
comma
r_int
id|addr
)paren
(brace
id|u32
id|val
op_assign
l_int|0
comma
id|tmp_read
op_assign
l_int|0
suffix:semicolon
r_int
id|i
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|u8
id|byte_read
op_assign
l_int|0
suffix:semicolon
id|val
op_assign
id|readl
c_func
(paren
id|he_dev-&gt;membase
op_plus
id|HOST_CNTL
)paren
suffix:semicolon
id|val
op_and_assign
l_int|0xFFFFE0FF
suffix:semicolon
multiline_comment|/* Turn on write enable */
id|val
op_or_assign
l_int|0x800
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|val
comma
id|HOST_CNTL
)paren
suffix:semicolon
multiline_comment|/* Send READ instruction */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|readtab
)paren
op_div
r_sizeof
(paren
id|readtab
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|he_writel
c_func
(paren
id|he_dev
comma
id|val
op_or
id|readtab
(braket
id|i
)braket
comma
id|HOST_CNTL
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|EEPROM_DELAY
)paren
suffix:semicolon
)brace
multiline_comment|/* Next, we need to send the byte address to read from */
r_for
c_loop
(paren
id|i
op_assign
l_int|7
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|he_writel
c_func
(paren
id|he_dev
comma
id|val
op_or
id|clocktab
(braket
id|j
op_increment
)braket
op_or
(paren
(paren
(paren
id|addr
op_rshift
id|i
)paren
op_amp
l_int|1
)paren
op_lshift
l_int|9
)paren
comma
id|HOST_CNTL
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|EEPROM_DELAY
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|val
op_or
id|clocktab
(braket
id|j
op_increment
)braket
op_or
(paren
(paren
(paren
id|addr
op_rshift
id|i
)paren
op_amp
l_int|1
)paren
op_lshift
l_int|9
)paren
comma
id|HOST_CNTL
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|EEPROM_DELAY
)paren
suffix:semicolon
)brace
id|j
op_assign
l_int|0
suffix:semicolon
id|val
op_and_assign
l_int|0xFFFFF7FF
suffix:semicolon
multiline_comment|/* Turn off write enable */
id|he_writel
c_func
(paren
id|he_dev
comma
id|val
comma
id|HOST_CNTL
)paren
suffix:semicolon
multiline_comment|/* Now, we can read data from the EEPROM by clocking it in */
r_for
c_loop
(paren
id|i
op_assign
l_int|7
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
(brace
id|he_writel
c_func
(paren
id|he_dev
comma
id|val
op_or
id|clocktab
(braket
id|j
op_increment
)braket
comma
id|HOST_CNTL
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|EEPROM_DELAY
)paren
suffix:semicolon
id|tmp_read
op_assign
id|he_readl
c_func
(paren
id|he_dev
comma
id|HOST_CNTL
)paren
suffix:semicolon
id|byte_read
op_or_assign
(paren
r_int
r_char
)paren
(paren
(paren
id|tmp_read
op_amp
id|ID_DOUT
)paren
op_rshift
id|ID_DOFFSET
op_lshift
id|i
)paren
suffix:semicolon
id|he_writel
c_func
(paren
id|he_dev
comma
id|val
op_or
id|clocktab
(braket
id|j
op_increment
)braket
comma
id|HOST_CNTL
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|EEPROM_DELAY
)paren
suffix:semicolon
)brace
id|he_writel
c_func
(paren
id|he_dev
comma
id|val
op_or
id|ID_CS
comma
id|HOST_CNTL
)paren
suffix:semicolon
id|udelay
c_func
(paren
id|EEPROM_DELAY
)paren
suffix:semicolon
r_return
id|byte_read
suffix:semicolon
)brace
id|MODULE_LICENSE
c_func
(paren
l_string|&quot;GPL&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;chas williams &lt;chas@cmf.nrl.navy.mil&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;ForeRunnerHE ATM Adapter driver&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|disable64
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|disable64
comma
l_string|&quot;disable 64-bit pci bus transfers&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|nvpibits
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|nvpibits
comma
l_string|&quot;numbers of bits for vpi (default 0)&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|nvcibits
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|nvcibits
comma
l_string|&quot;numbers of bits for vci (default 12)&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|rx_skb_reserve
comma
r_int
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|rx_skb_reserve
comma
l_string|&quot;padding for receive skb (default 16)&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|irq_coalesce
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|irq_coalesce
comma
l_string|&quot;use interrupt coalescing (default 1)&quot;
)paren
suffix:semicolon
id|module_param
c_func
(paren
id|sdh
comma
r_bool
comma
l_int|0
)paren
suffix:semicolon
id|MODULE_PARM_DESC
c_func
(paren
id|sdh
comma
l_string|&quot;use SDH framing (default 0)&quot;
)paren
suffix:semicolon
DECL|variable|he_pci_tbl
r_static
r_struct
id|pci_device_id
id|he_pci_tbl
(braket
)braket
op_assign
(brace
(brace
id|PCI_VENDOR_ID_FORE
comma
id|PCI_DEVICE_ID_FORE_HE
comma
id|PCI_ANY_ID
comma
id|PCI_ANY_ID
comma
l_int|0
comma
l_int|0
comma
l_int|0
)brace
comma
(brace
l_int|0
comma
)brace
)brace
suffix:semicolon
id|MODULE_DEVICE_TABLE
c_func
(paren
id|pci
comma
id|he_pci_tbl
)paren
suffix:semicolon
DECL|variable|he_driver
r_static
r_struct
id|pci_driver
id|he_driver
op_assign
(brace
dot
id|name
op_assign
l_string|&quot;he&quot;
comma
dot
id|probe
op_assign
id|he_init_one
comma
dot
id|remove
op_assign
id|__devexit_p
c_func
(paren
id|he_remove_one
)paren
comma
dot
id|id_table
op_assign
id|he_pci_tbl
comma
)brace
suffix:semicolon
DECL|function|he_init
r_static
r_int
id|__init
id|he_init
c_func
(paren
r_void
)paren
(brace
r_return
id|pci_module_init
c_func
(paren
op_amp
id|he_driver
)paren
suffix:semicolon
)brace
DECL|function|he_cleanup
r_static
r_void
id|__exit
id|he_cleanup
c_func
(paren
r_void
)paren
(brace
id|pci_unregister_driver
c_func
(paren
op_amp
id|he_driver
)paren
suffix:semicolon
)brace
DECL|variable|he_init
id|module_init
c_func
(paren
id|he_init
)paren
suffix:semicolon
DECL|variable|he_cleanup
id|module_exit
c_func
(paren
id|he_cleanup
)paren
suffix:semicolon
eof
