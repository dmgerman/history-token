multiline_comment|/******************************************************************* &n; * ident &quot;$Id: idt77252.c,v 1.1 2001/11/05 21:52:22 ecd Exp $&quot;&n; *&n; * $Author: ecd $&n; * $Date: 2001/11/05 21:52:22 $&n; *&n; * Copyright (c) 2000 ATecoM GmbH &n; *&n; * The author may be reached at ecd@atecom.com.&n; *&n; * This program is free software; you can redistribute  it and/or modify it&n; * under  the terms of  the GNU General  Public License as published by the&n; * Free Software Foundation;  either version 2 of the  License, or (at your&n; * option) any later version.&n; *&n; * THIS  SOFTWARE  IS PROVIDED   ``AS  IS&squot;&squot; AND   ANY  EXPRESS OR   IMPLIED&n; * WARRANTIES,   INCLUDING, BUT NOT  LIMITED  TO, THE IMPLIED WARRANTIES OF&n; * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  IN&n; * NO  EVENT  SHALL   THE AUTHOR  BE    LIABLE FOR ANY   DIRECT,  INDIRECT,&n; * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT&n; * NOT LIMITED   TO, PROCUREMENT OF  SUBSTITUTE GOODS  OR SERVICES; LOSS OF&n; * USE, DATA,  OR PROFITS; OR  BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON&n; * ANY THEORY OF LIABILITY, WHETHER IN  CONTRACT, STRICT LIABILITY, OR TORT&n; * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF&n; * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.&n; *&n; * You should have received a copy of the  GNU General Public License along&n; * with this program; if not, write  to the Free Software Foundation, Inc.,&n; * 675 Mass Ave, Cambridge, MA 02139, USA.&n; *&n; *******************************************************************/
DECL|variable|rcsid
r_static
r_char
r_const
id|rcsid
(braket
)braket
op_assign
l_string|&quot;$Id: idt77252.c,v 1.1 2001/11/05 21:52:22 ecd Exp $&quot;
suffix:semicolon
macro_line|#include &lt;linux/module.h&gt;
macro_line|#include &lt;linux/config.h&gt;
macro_line|#include &lt;linux/pci.h&gt;
macro_line|#include &lt;linux/skbuff.h&gt;
macro_line|#include &lt;linux/kernel.h&gt;
macro_line|#include &lt;linux/vmalloc.h&gt;
macro_line|#include &lt;linux/netdevice.h&gt;
macro_line|#include &lt;linux/atmdev.h&gt;
macro_line|#include &lt;linux/atm.h&gt;
macro_line|#include &lt;linux/delay.h&gt;
macro_line|#include &lt;linux/init.h&gt;
macro_line|#include &lt;linux/bitops.h&gt;
macro_line|#include &lt;linux/wait.h&gt;
macro_line|#include &lt;asm/semaphore.h&gt;
macro_line|#include &lt;asm/io.h&gt;
macro_line|#include &lt;asm/uaccess.h&gt;
macro_line|#include &lt;asm/atomic.h&gt;
macro_line|#include &lt;asm/byteorder.h&gt;
macro_line|#ifdef CONFIG_ATM_IDT77252_USE_SUNI
macro_line|#include &quot;suni.h&quot;
macro_line|#endif /* CONFIG_ATM_IDT77252_USE_SUNI */
DECL|macro|DEBUG
mdefine_line|#define DEBUG 1
macro_line|#include &quot;idt77252.h&quot;
macro_line|#include &quot;idt77252_tables.h&quot;
DECL|variable|vpibits
r_static
r_int
r_int
id|vpibits
op_assign
l_int|1
suffix:semicolon
DECL|macro|CONFIG_ATM_IDT77252_SEND_IDLE
mdefine_line|#define CONFIG_ATM_IDT77252_SEND_IDLE 1
multiline_comment|/*&n; * Debug HACKs.&n; */
DECL|macro|DEBUG_MODULE
mdefine_line|#define DEBUG_MODULE 1
DECL|macro|DEBUG_RAW_CELLS
macro_line|#undef DEBUG_RAW_CELLS
DECL|macro|HAVE_EEPROM
macro_line|#undef HAVE_EEPROM&t;/* does not work, yet. */
macro_line|#ifdef DEBUG
DECL|variable|debug
r_static
r_int
r_int
id|debug
op_assign
id|DBG_GENERAL
suffix:semicolon
macro_line|#endif
DECL|macro|SAR_RX_DELAY
mdefine_line|#define SAR_RX_DELAY&t;(SAR_CFG_RXINT_NODELAY)
multiline_comment|/*&n; * SCQ Handling.&n; */
r_static
r_struct
id|scq_info
op_star
id|alloc_scq
c_func
(paren
r_struct
id|idt77252_dev
op_star
comma
r_int
)paren
suffix:semicolon
r_static
r_void
id|free_scq
c_func
(paren
r_struct
id|idt77252_dev
op_star
comma
r_struct
id|scq_info
op_star
)paren
suffix:semicolon
r_static
r_int
id|queue_skb
c_func
(paren
r_struct
id|idt77252_dev
op_star
comma
r_struct
id|vc_map
op_star
comma
r_struct
id|sk_buff
op_star
comma
r_int
id|oam
)paren
suffix:semicolon
r_static
r_void
id|drain_scq
c_func
(paren
r_struct
id|idt77252_dev
op_star
comma
r_struct
id|vc_map
op_star
)paren
suffix:semicolon
r_static
r_int
r_int
id|get_free_scd
c_func
(paren
r_struct
id|idt77252_dev
op_star
comma
r_struct
id|vc_map
op_star
)paren
suffix:semicolon
r_static
r_void
id|fill_scd
c_func
(paren
r_struct
id|idt77252_dev
op_star
comma
r_struct
id|scq_info
op_star
comma
r_int
)paren
suffix:semicolon
multiline_comment|/*&n; * FBQ Handling.&n; */
r_static
r_int
id|push_rx_skb
c_func
(paren
r_struct
id|idt77252_dev
op_star
comma
r_struct
id|sk_buff
op_star
comma
r_int
id|queue
)paren
suffix:semicolon
r_static
r_void
id|recycle_rx_skb
c_func
(paren
r_struct
id|idt77252_dev
op_star
comma
r_struct
id|sk_buff
op_star
)paren
suffix:semicolon
r_static
r_void
id|flush_rx_pool
c_func
(paren
r_struct
id|idt77252_dev
op_star
comma
r_struct
id|rx_pool
op_star
)paren
suffix:semicolon
r_static
r_void
id|recycle_rx_pool_skb
c_func
(paren
r_struct
id|idt77252_dev
op_star
comma
r_struct
id|rx_pool
op_star
)paren
suffix:semicolon
r_static
r_void
id|add_rx_skb
c_func
(paren
r_struct
id|idt77252_dev
op_star
comma
r_int
id|queue
comma
r_int
r_int
id|size
comma
r_int
r_int
id|count
)paren
suffix:semicolon
multiline_comment|/*&n; * RSQ Handling.&n; */
r_static
r_int
id|init_rsq
c_func
(paren
r_struct
id|idt77252_dev
op_star
)paren
suffix:semicolon
r_static
r_void
id|deinit_rsq
c_func
(paren
r_struct
id|idt77252_dev
op_star
)paren
suffix:semicolon
r_static
r_void
id|idt77252_rx
c_func
(paren
r_struct
id|idt77252_dev
op_star
)paren
suffix:semicolon
multiline_comment|/*&n; * TSQ handling.&n; */
r_static
r_int
id|init_tsq
c_func
(paren
r_struct
id|idt77252_dev
op_star
)paren
suffix:semicolon
r_static
r_void
id|deinit_tsq
c_func
(paren
r_struct
id|idt77252_dev
op_star
)paren
suffix:semicolon
r_static
r_void
id|idt77252_tx
c_func
(paren
r_struct
id|idt77252_dev
op_star
)paren
suffix:semicolon
multiline_comment|/*&n; * ATM Interface.&n; */
r_static
r_void
id|idt77252_dev_close
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
)paren
suffix:semicolon
r_static
r_int
id|idt77252_open
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
id|vpi
comma
r_int
id|vci
)paren
suffix:semicolon
r_static
r_void
id|idt77252_close
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
suffix:semicolon
r_static
r_int
id|idt77252_send
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
suffix:semicolon
r_static
r_int
id|idt77252_send_oam
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_void
op_star
id|cell
comma
r_int
id|flags
)paren
suffix:semicolon
r_static
r_void
id|idt77252_phy_put
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
comma
r_int
r_char
id|value
comma
r_int
r_int
id|addr
)paren
suffix:semicolon
r_static
r_int
r_char
id|idt77252_phy_get
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
comma
r_int
r_int
id|addr
)paren
suffix:semicolon
r_static
r_int
id|idt77252_change_qos
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|atm_qos
op_star
id|qos
comma
r_int
id|flags
)paren
suffix:semicolon
r_static
r_int
id|idt77252_proc_read
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
comma
id|loff_t
op_star
id|pos
comma
r_char
op_star
id|page
)paren
suffix:semicolon
r_static
r_void
id|idt77252_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|regs
)paren
suffix:semicolon
r_static
r_void
id|idt77252_softint
c_func
(paren
r_void
op_star
id|dev_id
)paren
suffix:semicolon
DECL|variable|idt77252_ops
r_static
r_struct
id|atmdev_ops
id|idt77252_ops
op_assign
(brace
id|idt77252_dev_close
comma
multiline_comment|/* dev_close */
id|idt77252_open
comma
multiline_comment|/* open */
id|idt77252_close
comma
multiline_comment|/* close */
l_int|NULL
comma
multiline_comment|/* ioctl */
l_int|NULL
comma
multiline_comment|/* getsockopt */
l_int|NULL
comma
multiline_comment|/* setsockopt */
id|idt77252_send
comma
multiline_comment|/* send */
l_int|NULL
comma
multiline_comment|/* sg_send */
id|idt77252_send_oam
comma
multiline_comment|/* send_oam */
id|idt77252_phy_put
comma
id|idt77252_phy_get
comma
l_int|NULL
comma
multiline_comment|/* feedback */
id|idt77252_change_qos
comma
l_int|NULL
comma
multiline_comment|/* free_rx_skb */
id|idt77252_proc_read
multiline_comment|/* proc_read */
)brace
suffix:semicolon
DECL|variable|idt77252_chain
r_static
r_struct
id|idt77252_dev
op_star
id|idt77252_chain
op_assign
l_int|NULL
suffix:semicolon
DECL|variable|idt77252_sram_write_errors
r_static
r_int
r_int
id|idt77252_sram_write_errors
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*****************************************************************************/
multiline_comment|/*                                                                           */
multiline_comment|/* I/O and Utility Bus                                                       */
multiline_comment|/*                                                                           */
multiline_comment|/*****************************************************************************/
r_static
r_void
DECL|function|waitfor_idle
id|waitfor_idle
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
)paren
(brace
id|u32
id|stat
suffix:semicolon
id|stat
op_assign
id|readl
c_func
(paren
id|SAR_REG_STAT
)paren
suffix:semicolon
r_while
c_loop
(paren
id|stat
op_amp
id|SAR_STAT_CMDBZ
)paren
id|stat
op_assign
id|readl
c_func
(paren
id|SAR_REG_STAT
)paren
suffix:semicolon
)brace
r_static
id|u32
DECL|function|read_sram
id|read_sram
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_int
r_int
id|addr
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|u32
id|value
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
id|writel
c_func
(paren
id|SAR_CMD_READ_SRAM
op_or
(paren
id|addr
op_lshift
l_int|2
)paren
comma
id|SAR_REG_CMD
)paren
suffix:semicolon
id|waitfor_idle
c_func
(paren
id|card
)paren
suffix:semicolon
id|value
op_assign
id|readl
c_func
(paren
id|SAR_REG_DR0
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
r_static
r_void
DECL|function|write_sram
id|write_sram
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_int
r_int
id|addr
comma
id|u32
id|value
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
(paren
id|idt77252_sram_write_errors
op_eq
l_int|0
)paren
op_logical_and
(paren
(paren
(paren
id|addr
OG
id|card-&gt;tst
(braket
l_int|0
)braket
op_plus
id|card-&gt;tst_size
op_minus
l_int|2
)paren
op_logical_and
(paren
id|addr
OL
id|card-&gt;tst
(braket
l_int|0
)braket
op_plus
id|card-&gt;tst_size
)paren
)paren
op_logical_or
(paren
(paren
id|addr
OG
id|card-&gt;tst
(braket
l_int|1
)braket
op_plus
id|card-&gt;tst_size
op_minus
l_int|2
)paren
op_logical_and
(paren
id|addr
OL
id|card-&gt;tst
(braket
l_int|1
)braket
op_plus
id|card-&gt;tst_size
)paren
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: ERROR: TST JMP section at %08lx written: %08x&bslash;n&quot;
comma
id|card-&gt;name
comma
id|addr
comma
id|value
)paren
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
id|writel
c_func
(paren
id|value
comma
id|SAR_REG_DR0
)paren
suffix:semicolon
id|writel
c_func
(paren
id|SAR_CMD_WRITE_SRAM
op_or
(paren
id|addr
op_lshift
l_int|2
)paren
comma
id|SAR_REG_CMD
)paren
suffix:semicolon
id|waitfor_idle
c_func
(paren
id|card
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
id|u8
DECL|function|read_utility
id|read_utility
c_func
(paren
r_void
op_star
id|dev
comma
r_int
r_int
id|ubus_addr
)paren
(brace
r_struct
id|idt77252_dev
op_star
id|card
op_assign
id|dev
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u8
id|value
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Error: No such device.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
id|writel
c_func
(paren
id|SAR_CMD_READ_UTILITY
op_plus
id|ubus_addr
comma
id|SAR_REG_CMD
)paren
suffix:semicolon
id|waitfor_idle
c_func
(paren
id|card
)paren
suffix:semicolon
id|value
op_assign
id|readl
c_func
(paren
id|SAR_REG_DR0
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|value
suffix:semicolon
)brace
r_static
r_void
DECL|function|write_utility
id|write_utility
c_func
(paren
r_void
op_star
id|dev
comma
r_int
r_int
id|ubus_addr
comma
id|u8
id|value
)paren
(brace
r_struct
id|idt77252_dev
op_star
id|card
op_assign
id|dev
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Error: No such device.&bslash;n&quot;
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
id|u32
)paren
id|value
comma
id|SAR_REG_DR0
)paren
suffix:semicolon
id|writel
c_func
(paren
id|SAR_CMD_WRITE_UTILITY
op_plus
id|ubus_addr
comma
id|SAR_REG_CMD
)paren
suffix:semicolon
id|waitfor_idle
c_func
(paren
id|card
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
)brace
macro_line|#ifdef HAVE_EEPROM
DECL|variable|rdsrtab
r_static
id|u32
id|rdsrtab
(braket
)braket
op_assign
(brace
id|SAR_GP_EECS
op_or
id|SAR_GP_EESCLK
comma
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
id|SAR_GP_EEDO
comma
id|SAR_GP_EESCLK
op_or
id|SAR_GP_EEDO
comma
multiline_comment|/* 1 */
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
id|SAR_GP_EEDO
comma
id|SAR_GP_EESCLK
op_or
id|SAR_GP_EEDO
multiline_comment|/* 1 */
)brace
suffix:semicolon
DECL|variable|wrentab
r_static
id|u32
id|wrentab
(braket
)braket
op_assign
(brace
id|SAR_GP_EECS
op_or
id|SAR_GP_EESCLK
comma
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
id|SAR_GP_EEDO
comma
id|SAR_GP_EESCLK
op_or
id|SAR_GP_EEDO
comma
multiline_comment|/* 1 */
id|SAR_GP_EEDO
comma
id|SAR_GP_EESCLK
op_or
id|SAR_GP_EEDO
comma
multiline_comment|/* 1 */
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
l_int|0
comma
id|SAR_GP_EESCLK
multiline_comment|/* 0 */
)brace
suffix:semicolon
DECL|variable|rdtab
r_static
id|u32
id|rdtab
(braket
)braket
op_assign
(brace
id|SAR_GP_EECS
op_or
id|SAR_GP_EESCLK
comma
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
id|SAR_GP_EEDO
comma
id|SAR_GP_EESCLK
op_or
id|SAR_GP_EEDO
comma
multiline_comment|/* 1 */
id|SAR_GP_EEDO
comma
id|SAR_GP_EESCLK
op_or
id|SAR_GP_EEDO
multiline_comment|/* 1 */
)brace
suffix:semicolon
DECL|variable|wrtab
r_static
id|u32
id|wrtab
(braket
)braket
op_assign
(brace
id|SAR_GP_EECS
op_or
id|SAR_GP_EESCLK
comma
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
l_int|0
comma
id|SAR_GP_EESCLK
comma
multiline_comment|/* 0 */
id|SAR_GP_EEDO
comma
id|SAR_GP_EESCLK
op_or
id|SAR_GP_EEDO
comma
multiline_comment|/* 1 */
l_int|0
comma
id|SAR_GP_EESCLK
multiline_comment|/* 0 */
)brace
suffix:semicolon
DECL|variable|clktab
r_static
id|u32
id|clktab
(braket
)braket
op_assign
(brace
l_int|0
comma
id|SAR_GP_EESCLK
comma
l_int|0
comma
id|SAR_GP_EESCLK
comma
l_int|0
comma
id|SAR_GP_EESCLK
comma
l_int|0
comma
id|SAR_GP_EESCLK
comma
l_int|0
comma
id|SAR_GP_EESCLK
comma
l_int|0
comma
id|SAR_GP_EESCLK
comma
l_int|0
comma
id|SAR_GP_EESCLK
comma
l_int|0
comma
id|SAR_GP_EESCLK
comma
l_int|0
)brace
suffix:semicolon
r_static
id|u32
DECL|function|idt77252_read_gp
id|idt77252_read_gp
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
)paren
(brace
id|u32
id|gp
suffix:semicolon
id|gp
op_assign
id|readl
c_func
(paren
id|SAR_REG_GP
)paren
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;RD: %s&bslash;n&quot;
comma
id|gp
op_amp
id|SAR_GP_EEDI
ques
c_cond
l_string|&quot;1&quot;
suffix:colon
l_string|&quot;0&quot;
)paren
suffix:semicolon
macro_line|#endif
r_return
id|gp
suffix:semicolon
)brace
r_static
r_void
DECL|function|idt77252_write_gp
id|idt77252_write_gp
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
id|u32
id|value
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
macro_line|#if 0
id|printk
c_func
(paren
l_string|&quot;WR: %s %s %s&bslash;n&quot;
comma
id|value
op_amp
id|SAR_GP_EECS
ques
c_cond
l_string|&quot;   &quot;
suffix:colon
l_string|&quot;/CS&quot;
comma
id|value
op_amp
id|SAR_GP_EESCLK
ques
c_cond
l_string|&quot;HIGH&quot;
suffix:colon
l_string|&quot;LOW &quot;
comma
id|value
op_amp
id|SAR_GP_EEDO
ques
c_cond
l_string|&quot;1&quot;
suffix:colon
l_string|&quot;0&quot;
)paren
suffix:semicolon
macro_line|#endif
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
id|waitfor_idle
c_func
(paren
id|card
)paren
suffix:semicolon
id|writel
c_func
(paren
id|value
comma
id|SAR_REG_GP
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
id|u8
DECL|function|idt77252_eeprom_read_status
id|idt77252_eeprom_read_status
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
)paren
(brace
id|u8
id|byte
suffix:semicolon
id|u32
id|gp
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|gp
op_assign
id|idt77252_read_gp
c_func
(paren
id|card
)paren
op_amp
op_complement
(paren
id|SAR_GP_EESCLK
op_or
id|SAR_GP_EECS
op_or
id|SAR_GP_EEDO
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|rdsrtab
)paren
op_div
r_sizeof
(paren
id|rdsrtab
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|rdsrtab
(braket
id|i
)braket
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
)brace
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|SAR_GP_EECS
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|byte
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|byte
op_lshift_assign
l_int|1
suffix:semicolon
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|clktab
(braket
id|j
op_increment
)braket
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|byte
op_or_assign
id|idt77252_read_gp
c_func
(paren
id|card
)paren
op_amp
id|SAR_GP_EEDI
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|clktab
(braket
id|j
op_increment
)braket
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
)brace
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|SAR_GP_EECS
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
r_return
id|byte
suffix:semicolon
)brace
r_static
id|u8
DECL|function|idt77252_eeprom_read_byte
id|idt77252_eeprom_read_byte
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
id|u8
id|offset
)paren
(brace
id|u8
id|byte
suffix:semicolon
id|u32
id|gp
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|gp
op_assign
id|idt77252_read_gp
c_func
(paren
id|card
)paren
op_amp
op_complement
(paren
id|SAR_GP_EESCLK
op_or
id|SAR_GP_EECS
op_or
id|SAR_GP_EEDO
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|rdtab
)paren
op_div
r_sizeof
(paren
id|rdtab
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|rdtab
(braket
id|i
)braket
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
)brace
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|SAR_GP_EECS
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|clktab
(braket
id|j
op_increment
)braket
op_or
(paren
id|offset
op_amp
l_int|1
ques
c_cond
id|SAR_GP_EEDO
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|clktab
(braket
id|j
op_increment
)braket
op_or
(paren
id|offset
op_amp
l_int|1
ques
c_cond
id|SAR_GP_EEDO
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|offset
op_rshift_assign
l_int|1
suffix:semicolon
)brace
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|SAR_GP_EECS
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|byte
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|byte
op_lshift_assign
l_int|1
suffix:semicolon
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|clktab
(braket
id|j
op_increment
)braket
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|byte
op_or_assign
id|idt77252_read_gp
c_func
(paren
id|card
)paren
op_amp
id|SAR_GP_EEDI
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|clktab
(braket
id|j
op_increment
)braket
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
)brace
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|SAR_GP_EECS
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
r_return
id|byte
suffix:semicolon
)brace
r_static
r_void
DECL|function|idt77252_eeprom_write_byte
id|idt77252_eeprom_write_byte
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
id|u8
id|offset
comma
id|u8
id|data
)paren
(brace
id|u32
id|gp
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
id|gp
op_assign
id|idt77252_read_gp
c_func
(paren
id|card
)paren
op_amp
op_complement
(paren
id|SAR_GP_EESCLK
op_or
id|SAR_GP_EECS
op_or
id|SAR_GP_EEDO
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|wrentab
)paren
op_div
r_sizeof
(paren
id|wrentab
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|wrentab
(braket
id|i
)braket
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
)brace
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|SAR_GP_EECS
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
r_sizeof
(paren
id|wrtab
)paren
op_div
r_sizeof
(paren
id|wrtab
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|wrtab
(braket
id|i
)braket
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
)brace
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|SAR_GP_EECS
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|clktab
(braket
id|j
op_increment
)braket
op_or
(paren
id|offset
op_amp
l_int|1
ques
c_cond
id|SAR_GP_EEDO
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|clktab
(braket
id|j
op_increment
)braket
op_or
(paren
id|offset
op_amp
l_int|1
ques
c_cond
id|SAR_GP_EEDO
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|offset
op_rshift_assign
l_int|1
suffix:semicolon
)brace
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|SAR_GP_EECS
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
comma
id|j
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|clktab
(braket
id|j
op_increment
)braket
op_or
(paren
id|data
op_amp
l_int|1
ques
c_cond
id|SAR_GP_EEDO
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|clktab
(braket
id|j
op_increment
)braket
op_or
(paren
id|data
op_amp
l_int|1
ques
c_cond
id|SAR_GP_EEDO
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|data
op_rshift_assign
l_int|1
suffix:semicolon
)brace
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|SAR_GP_EECS
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|idt77252_eeprom_init
id|idt77252_eeprom_init
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
)paren
(brace
id|u32
id|gp
suffix:semicolon
id|gp
op_assign
id|idt77252_read_gp
c_func
(paren
id|card
)paren
op_amp
op_complement
(paren
id|SAR_GP_EESCLK
op_or
id|SAR_GP_EECS
op_or
id|SAR_GP_EEDO
)paren
suffix:semicolon
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|SAR_GP_EECS
op_or
id|SAR_GP_EESCLK
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|SAR_GP_EECS
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|SAR_GP_EECS
op_or
id|SAR_GP_EESCLK
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
id|idt77252_write_gp
c_func
(paren
id|card
comma
id|gp
op_or
id|SAR_GP_EECS
)paren
suffix:semicolon
id|udelay
c_func
(paren
l_int|5
)paren
suffix:semicolon
)brace
macro_line|#endif /* HAVE_EEPROM */
macro_line|#ifdef DEBUG
r_static
r_void
DECL|function|dump_tct
id|dump_tct
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_int
id|index
)paren
(brace
r_int
r_int
id|tct
suffix:semicolon
r_int
id|i
suffix:semicolon
id|tct
op_assign
(paren
r_int
r_int
)paren
(paren
id|card-&gt;tct_base
op_plus
id|index
op_star
id|SAR_SRAM_TCT_SIZE
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: TCT %x:&quot;
comma
id|card-&gt;name
comma
id|index
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; %08x&quot;
comma
id|read_sram
c_func
(paren
id|card
comma
id|tct
op_plus
id|i
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|idt77252_tx_dump
id|idt77252_tx_dump
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
)paren
(brace
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_struct
id|vc_map
op_star
id|vc
suffix:semicolon
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|card-&gt;tct_size
suffix:semicolon
id|i
op_increment
)paren
(brace
id|vc
op_assign
id|card-&gt;vcs
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc
)paren
r_continue
suffix:semicolon
id|vcc
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;rx_vcc
)paren
id|vcc
op_assign
id|vc-&gt;rx_vcc
suffix:semicolon
r_else
r_if
c_cond
(paren
id|vc-&gt;tx_vcc
)paren
id|vcc
op_assign
id|vc-&gt;tx_vcc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vcc
)paren
r_continue
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: Connection %d:&bslash;n&quot;
comma
id|card-&gt;name
comma
id|vc-&gt;index
)paren
suffix:semicolon
id|dump_tct
c_func
(paren
id|card
comma
id|vc-&gt;index
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/*****************************************************************************/
multiline_comment|/*                                                                           */
multiline_comment|/* SCQ Handling                                                              */
multiline_comment|/*                                                                           */
multiline_comment|/*****************************************************************************/
r_static
r_int
DECL|function|sb_pool_add
id|sb_pool_add
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|queue
)paren
(brace
r_struct
id|sb_pool
op_star
id|pool
op_assign
op_amp
id|card-&gt;sbpool
(braket
id|queue
)braket
suffix:semicolon
r_int
id|index
suffix:semicolon
id|index
op_assign
id|pool-&gt;index
suffix:semicolon
r_while
c_loop
(paren
id|pool-&gt;skb
(braket
id|index
)braket
)paren
(brace
id|index
op_assign
(paren
id|index
op_plus
l_int|1
)paren
op_amp
id|FBQ_MASK
suffix:semicolon
r_if
c_cond
(paren
id|index
op_eq
id|pool-&gt;index
)paren
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
id|pool-&gt;skb
(braket
id|index
)braket
op_assign
id|skb
suffix:semicolon
id|IDT77252_PRV_POOL
c_func
(paren
id|skb
)paren
op_assign
id|POOL_HANDLE
c_func
(paren
id|queue
comma
id|index
)paren
suffix:semicolon
id|pool-&gt;index
op_assign
(paren
id|index
op_plus
l_int|1
)paren
op_amp
id|FBQ_MASK
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|sb_pool_remove
id|sb_pool_remove
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_int
r_int
id|queue
comma
id|index
suffix:semicolon
id|u32
id|handle
suffix:semicolon
id|handle
op_assign
id|IDT77252_PRV_POOL
c_func
(paren
id|skb
)paren
suffix:semicolon
id|queue
op_assign
id|POOL_QUEUE
c_func
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|queue
OG
l_int|3
)paren
r_return
suffix:semicolon
id|index
op_assign
id|POOL_INDEX
c_func
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|index
OG
id|FBQ_SIZE
op_minus
l_int|1
)paren
r_return
suffix:semicolon
id|card-&gt;sbpool
(braket
id|queue
)braket
dot
id|skb
(braket
id|index
)braket
op_assign
l_int|NULL
suffix:semicolon
)brace
r_static
r_struct
id|sk_buff
op_star
DECL|function|sb_pool_skb
id|sb_pool_skb
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
id|u32
id|handle
)paren
(brace
r_int
r_int
id|queue
comma
id|index
suffix:semicolon
id|queue
op_assign
id|POOL_QUEUE
c_func
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|queue
OG
l_int|3
)paren
r_return
l_int|NULL
suffix:semicolon
id|index
op_assign
id|POOL_INDEX
c_func
(paren
id|handle
)paren
suffix:semicolon
r_if
c_cond
(paren
id|index
OG
id|FBQ_SIZE
op_minus
l_int|1
)paren
r_return
l_int|NULL
suffix:semicolon
r_return
id|card-&gt;sbpool
(braket
id|queue
)braket
dot
id|skb
(braket
id|index
)braket
suffix:semicolon
)brace
r_static
r_struct
id|scq_info
op_star
DECL|function|alloc_scq
id|alloc_scq
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_int
r_class
)paren
(brace
r_struct
id|scq_info
op_star
id|scq
suffix:semicolon
id|scq
op_assign
(paren
r_struct
id|scq_info
op_star
)paren
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|scq_info
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|scq
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|scq
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|scq_info
)paren
)paren
suffix:semicolon
id|scq-&gt;base
op_assign
id|pci_alloc_consistent
c_func
(paren
id|card-&gt;pcidev
comma
id|SCQ_SIZE
comma
op_amp
id|scq-&gt;paddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scq-&gt;base
op_eq
l_int|NULL
)paren
(brace
id|kfree
c_func
(paren
id|scq
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|memset
c_func
(paren
id|scq-&gt;base
comma
l_int|0
comma
id|SCQ_SIZE
)paren
suffix:semicolon
id|scq-&gt;next
op_assign
id|scq-&gt;base
suffix:semicolon
id|scq-&gt;last
op_assign
id|scq-&gt;base
op_plus
(paren
id|SCQ_ENTRIES
op_minus
l_int|1
)paren
suffix:semicolon
id|atomic_set
c_func
(paren
op_amp
id|scq-&gt;used
comma
l_int|0
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|scq-&gt;lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|scq-&gt;skblock
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|scq-&gt;transmit
)paren
suffix:semicolon
id|skb_queue_head_init
c_func
(paren
op_amp
id|scq-&gt;pending
)paren
suffix:semicolon
id|TXPRINTK
c_func
(paren
l_string|&quot;idt77252: SCQ: base 0x%p, next 0x%p, last 0x%p, paddr %08x&bslash;n&quot;
comma
id|scq-&gt;base
comma
id|scq-&gt;next
comma
id|scq-&gt;last
comma
id|scq-&gt;paddr
)paren
suffix:semicolon
r_return
id|scq
suffix:semicolon
)brace
r_static
r_void
DECL|function|free_scq
id|free_scq
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|scq_info
op_star
id|scq
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
id|pci_free_consistent
c_func
(paren
id|card-&gt;pcidev
comma
id|SCQ_SIZE
comma
id|scq-&gt;base
comma
id|scq-&gt;paddr
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|scq-&gt;transmit
)paren
)paren
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|card-&gt;pcidev
comma
id|IDT77252_PRV_PADDR
c_func
(paren
id|skb
)paren
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|vcc
op_assign
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|vcc
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;pop
)paren
id|vcc
op_member_access_from_pointer
id|pop
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
r_else
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|scq-&gt;pending
)paren
)paren
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|card-&gt;pcidev
comma
id|IDT77252_PRV_PADDR
c_func
(paren
id|skb
)paren
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|vcc
op_assign
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|vcc
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;pop
)paren
id|vcc
op_member_access_from_pointer
id|pop
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
r_else
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
id|kfree
c_func
(paren
id|scq
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|push_on_scq
id|push_on_scq
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|vc_map
op_star
id|vc
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_struct
id|scq_info
op_star
id|scq
op_assign
id|vc-&gt;scq
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_struct
id|scqe
op_star
id|tbd
suffix:semicolon
r_int
id|entries
suffix:semicolon
id|TXPRINTK
c_func
(paren
l_string|&quot;%s: SCQ: next 0x%p&bslash;n&quot;
comma
id|card-&gt;name
comma
id|scq-&gt;next
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|scq-&gt;used
)paren
suffix:semicolon
id|entries
op_assign
id|atomic_read
c_func
(paren
op_amp
id|scq-&gt;used
)paren
suffix:semicolon
r_if
c_cond
(paren
id|entries
OG
(paren
id|SCQ_ENTRIES
op_minus
l_int|1
)paren
)paren
(brace
id|atomic_dec
c_func
(paren
op_amp
id|scq-&gt;used
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|skb_queue_tail
c_func
(paren
op_amp
id|scq-&gt;transmit
comma
id|skb
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|vc-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;estimator
)paren
(brace
r_struct
id|atm_vcc
op_star
id|vcc
op_assign
id|vc-&gt;tx_vcc
suffix:semicolon
id|vc-&gt;estimator-&gt;cells
op_add_assign
(paren
id|skb-&gt;len
op_plus
l_int|47
)paren
op_div
l_int|48
suffix:semicolon
r_if
c_cond
(paren
id|atomic_read
c_func
(paren
op_amp
id|vcc-&gt;tx_inuse
)paren
OG
(paren
id|vcc-&gt;sk-&gt;sndbuf
op_rshift
l_int|1
)paren
)paren
(brace
id|u32
id|cps
op_assign
id|vc-&gt;estimator-&gt;maxcps
suffix:semicolon
id|vc-&gt;estimator-&gt;cps
op_assign
id|cps
suffix:semicolon
id|vc-&gt;estimator-&gt;avcps
op_assign
id|cps
op_lshift
l_int|5
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;lacr
OL
id|vc-&gt;init_er
)paren
(brace
id|vc-&gt;lacr
op_assign
id|vc-&gt;init_er
suffix:semicolon
id|writel
c_func
(paren
id|TCMDQ_LACR
op_or
(paren
id|vc-&gt;lacr
op_lshift
l_int|16
)paren
op_or
id|vc-&gt;index
comma
id|SAR_REG_TCMDQ
)paren
suffix:semicolon
)brace
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|vc-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|tbd
op_assign
op_amp
id|IDT77252_PRV_TBD
c_func
(paren
id|skb
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|scq-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|scq-&gt;next-&gt;word_1
op_assign
id|cpu_to_le32
c_func
(paren
id|tbd-&gt;word_1
op_or
id|SAR_TBD_TSIF
op_or
id|SAR_TBD_GTSI
)paren
suffix:semicolon
id|scq-&gt;next-&gt;word_2
op_assign
id|cpu_to_le32
c_func
(paren
id|tbd-&gt;word_2
)paren
suffix:semicolon
id|scq-&gt;next-&gt;word_3
op_assign
id|cpu_to_le32
c_func
(paren
id|tbd-&gt;word_3
)paren
suffix:semicolon
id|scq-&gt;next-&gt;word_4
op_assign
id|cpu_to_le32
c_func
(paren
id|tbd-&gt;word_4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|scq-&gt;next
op_eq
id|scq-&gt;last
)paren
id|scq-&gt;next
op_assign
id|scq-&gt;base
suffix:semicolon
r_else
id|scq-&gt;next
op_increment
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|scq-&gt;scd
comma
id|scq-&gt;paddr
op_plus
(paren
id|u32
)paren
(paren
(paren
r_int
r_int
)paren
id|scq-&gt;next
op_minus
(paren
r_int
r_int
)paren
id|scq-&gt;base
)paren
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|scq-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|scq-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|VCF_IDLE
comma
op_amp
id|vc-&gt;flags
)paren
)paren
(brace
id|writel
c_func
(paren
id|TCMDQ_START_LACR
op_or
(paren
id|vc-&gt;lacr
op_lshift
l_int|16
)paren
op_or
id|vc-&gt;index
comma
id|SAR_REG_TCMDQ
)paren
suffix:semicolon
)brace
id|TXPRINTK
c_func
(paren
l_string|&quot;%d entries in SCQ used (push).&bslash;n&quot;
comma
id|atomic_read
c_func
(paren
op_amp
id|scq-&gt;used
)paren
)paren
suffix:semicolon
id|XPRINTK
c_func
(paren
l_string|&quot;%s: SCQ (after push %2d) head = 0x%x, next = 0x%p.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|atomic_read
c_func
(paren
op_amp
id|scq-&gt;used
)paren
comma
id|read_sram
c_func
(paren
id|card
comma
id|scq-&gt;scd
op_plus
l_int|1
)paren
comma
id|scq-&gt;next
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|out
suffix:colon
r_if
c_cond
(paren
id|jiffies
op_minus
id|scq-&gt;trans_start
OG
id|HZ
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Error pushing TBD for %d.%d&bslash;n&quot;
comma
id|card-&gt;name
comma
id|vc-&gt;tx_vcc-&gt;vpi
comma
id|vc-&gt;tx_vcc-&gt;vci
)paren
suffix:semicolon
id|idt77252_tx_dump
c_func
(paren
id|card
)paren
suffix:semicolon
id|scq-&gt;trans_start
op_assign
id|jiffies
suffix:semicolon
)brace
r_return
op_minus
id|ENOBUFS
suffix:semicolon
)brace
r_static
r_void
DECL|function|drain_scq
id|drain_scq
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|vc_map
op_star
id|vc
)paren
(brace
r_struct
id|scq_info
op_star
id|scq
op_assign
id|vc-&gt;scq
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
id|TXPRINTK
c_func
(paren
l_string|&quot;%s: SCQ (before drain %2d) next = 0x%p.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|atomic_read
c_func
(paren
op_amp
id|scq-&gt;used
)paren
comma
id|scq-&gt;next
)paren
suffix:semicolon
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|scq-&gt;transmit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
id|TXPRINTK
c_func
(paren
l_string|&quot;%s: freeing skb at %p.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|skb
)paren
suffix:semicolon
id|pci_unmap_single
c_func
(paren
id|card-&gt;pcidev
comma
id|IDT77252_PRV_PADDR
c_func
(paren
id|skb
)paren
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|vcc
op_assign
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|vcc
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;pop
)paren
id|vcc
op_member_access_from_pointer
id|pop
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
r_else
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;tx
)paren
suffix:semicolon
)brace
id|atomic_dec
c_func
(paren
op_amp
id|scq-&gt;used
)paren
suffix:semicolon
id|spin_lock
c_func
(paren
op_amp
id|scq-&gt;skblock
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|scq-&gt;pending
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|push_on_scq
c_func
(paren
id|card
comma
id|vc
comma
id|skb
)paren
)paren
(brace
id|skb_queue_head
c_func
(paren
op_amp
id|vc-&gt;scq-&gt;pending
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|spin_unlock
c_func
(paren
op_amp
id|scq-&gt;skblock
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|queue_skb
id|queue_skb
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|vc_map
op_star
id|vc
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|oam
)paren
(brace
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_struct
id|scqe
op_star
id|tbd
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
id|error
suffix:semicolon
r_int
id|aal
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;len
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: invalid skb-&gt;len (%d)&bslash;n&quot;
comma
id|card-&gt;name
comma
id|skb-&gt;len
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|TXPRINTK
c_func
(paren
l_string|&quot;%s: Sending %d bytes of data.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|skb-&gt;len
)paren
suffix:semicolon
id|tbd
op_assign
op_amp
id|IDT77252_PRV_TBD
c_func
(paren
id|skb
)paren
suffix:semicolon
id|vcc
op_assign
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|vcc
suffix:semicolon
id|IDT77252_PRV_PADDR
c_func
(paren
id|skb
)paren
op_assign
id|pci_map_single
c_func
(paren
id|card-&gt;pcidev
comma
id|skb-&gt;data
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
id|error
op_assign
op_minus
id|EINVAL
suffix:semicolon
r_if
c_cond
(paren
id|oam
)paren
(brace
r_if
c_cond
(paren
id|skb-&gt;len
op_ne
l_int|52
)paren
r_goto
id|errout
suffix:semicolon
id|tbd-&gt;word_1
op_assign
id|SAR_TBD_OAM
op_or
id|ATM_CELL_PAYLOAD
op_or
id|SAR_TBD_EPDU
suffix:semicolon
id|tbd-&gt;word_2
op_assign
id|IDT77252_PRV_PADDR
c_func
(paren
id|skb
)paren
op_plus
l_int|4
suffix:semicolon
id|tbd-&gt;word_3
op_assign
l_int|0x00000000
suffix:semicolon
id|tbd-&gt;word_4
op_assign
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|skb-&gt;data
(braket
l_int|1
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|skb-&gt;data
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|skb-&gt;data
(braket
l_int|3
)braket
op_lshift
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|VCF_RSV
comma
op_amp
id|vc-&gt;flags
)paren
)paren
id|vc
op_assign
id|card-&gt;vcs
(braket
l_int|0
)braket
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|VCF_RSV
comma
op_amp
id|vc-&gt;flags
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Trying to transmit on reserved VC&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_goto
id|errout
suffix:semicolon
)brace
id|aal
op_assign
id|vcc-&gt;qos.aal
suffix:semicolon
r_switch
c_cond
(paren
id|aal
)paren
(brace
r_case
id|ATM_AAL0
suffix:colon
r_case
id|ATM_AAL34
suffix:colon
r_if
c_cond
(paren
id|skb-&gt;len
OG
l_int|52
)paren
r_goto
id|errout
suffix:semicolon
r_if
c_cond
(paren
id|aal
op_eq
id|ATM_AAL0
)paren
id|tbd-&gt;word_1
op_assign
id|SAR_TBD_EPDU
op_or
id|SAR_TBD_AAL0
op_or
id|ATM_CELL_PAYLOAD
suffix:semicolon
r_else
id|tbd-&gt;word_1
op_assign
id|SAR_TBD_EPDU
op_or
id|SAR_TBD_AAL34
op_or
id|ATM_CELL_PAYLOAD
suffix:semicolon
id|tbd-&gt;word_2
op_assign
id|IDT77252_PRV_PADDR
c_func
(paren
id|skb
)paren
op_plus
l_int|4
suffix:semicolon
id|tbd-&gt;word_3
op_assign
l_int|0x00000000
suffix:semicolon
id|tbd-&gt;word_4
op_assign
(paren
id|skb-&gt;data
(braket
l_int|0
)braket
op_lshift
l_int|24
)paren
op_or
(paren
id|skb-&gt;data
(braket
l_int|1
)braket
op_lshift
l_int|16
)paren
op_or
(paren
id|skb-&gt;data
(braket
l_int|2
)braket
op_lshift
l_int|8
)paren
op_or
(paren
id|skb-&gt;data
(braket
l_int|3
)braket
op_lshift
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_AAL5
suffix:colon
id|tbd-&gt;word_1
op_assign
id|SAR_TBD_EPDU
op_or
id|SAR_TBD_AAL5
op_or
id|skb-&gt;len
suffix:semicolon
id|tbd-&gt;word_2
op_assign
id|IDT77252_PRV_PADDR
c_func
(paren
id|skb
)paren
suffix:semicolon
id|tbd-&gt;word_3
op_assign
id|skb-&gt;len
suffix:semicolon
id|tbd-&gt;word_4
op_assign
(paren
id|vcc-&gt;vpi
op_lshift
id|SAR_TBD_VPI_SHIFT
)paren
op_or
(paren
id|vcc-&gt;vci
op_lshift
id|SAR_TBD_VCI_SHIFT
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_AAL1
suffix:colon
r_case
id|ATM_AAL2
suffix:colon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;%s: Traffic type not supported.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|error
op_assign
op_minus
id|EPROTONOSUPPORT
suffix:semicolon
r_goto
id|errout
suffix:semicolon
)brace
id|done
suffix:colon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|vc-&gt;scq-&gt;skblock
comma
id|flags
)paren
suffix:semicolon
id|skb_queue_tail
c_func
(paren
op_amp
id|vc-&gt;scq-&gt;pending
comma
id|skb
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|skb
op_assign
id|skb_dequeue
c_func
(paren
op_amp
id|vc-&gt;scq-&gt;pending
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|push_on_scq
c_func
(paren
id|card
comma
id|vc
comma
id|skb
)paren
)paren
(brace
id|skb_queue_head
c_func
(paren
op_amp
id|vc-&gt;scq-&gt;pending
comma
id|skb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|vc-&gt;scq-&gt;skblock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|errout
suffix:colon
id|pci_unmap_single
c_func
(paren
id|card-&gt;pcidev
comma
id|IDT77252_PRV_PADDR
c_func
(paren
id|skb
)paren
comma
id|skb-&gt;len
comma
id|PCI_DMA_TODEVICE
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_static
r_int
r_int
DECL|function|get_free_scd
id|get_free_scd
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|vc_map
op_star
id|vc
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|card-&gt;scd_size
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;scd2vc
(braket
id|i
)braket
)paren
(brace
id|card-&gt;scd2vc
(braket
id|i
)braket
op_assign
id|vc
suffix:semicolon
id|vc-&gt;scd_index
op_assign
id|i
suffix:semicolon
r_return
id|card-&gt;scd_base
op_plus
id|i
op_star
id|SAR_SRAM_SCD_SIZE
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|fill_scd
id|fill_scd
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|scq_info
op_star
id|scq
comma
r_int
r_class
)paren
(brace
id|write_sram
c_func
(paren
id|card
comma
id|scq-&gt;scd
comma
id|scq-&gt;paddr
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|scq-&gt;scd
op_plus
l_int|1
comma
l_int|0x00000000
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|scq-&gt;scd
op_plus
l_int|2
comma
l_int|0xffffffff
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|scq-&gt;scd
op_plus
l_int|3
comma
l_int|0x00000000
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|clear_scd
id|clear_scd
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|scq_info
op_star
id|scq
comma
r_int
r_class
)paren
(brace
r_return
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************/
multiline_comment|/*                                                                           */
multiline_comment|/* RSQ Handling                                                              */
multiline_comment|/*                                                                           */
multiline_comment|/*****************************************************************************/
r_static
r_int
DECL|function|init_rsq
id|init_rsq
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
)paren
(brace
r_struct
id|rsq_entry
op_star
id|rsqe
suffix:semicolon
id|card-&gt;rsq.base
op_assign
id|pci_alloc_consistent
c_func
(paren
id|card-&gt;pcidev
comma
id|RSQSIZE
comma
op_amp
id|card-&gt;rsq.paddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;rsq.base
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: can&squot;t allocate RSQ.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|memset
c_func
(paren
id|card-&gt;rsq.base
comma
l_int|0
comma
id|RSQSIZE
)paren
suffix:semicolon
id|card-&gt;rsq.last
op_assign
id|card-&gt;rsq.base
op_plus
id|RSQ_NUM_ENTRIES
op_minus
l_int|1
suffix:semicolon
id|card-&gt;rsq.next
op_assign
id|card-&gt;rsq.last
suffix:semicolon
r_for
c_loop
(paren
id|rsqe
op_assign
id|card-&gt;rsq.base
suffix:semicolon
id|rsqe
op_le
id|card-&gt;rsq.last
suffix:semicolon
id|rsqe
op_increment
)paren
id|rsqe-&gt;word_4
op_assign
l_int|0
suffix:semicolon
id|writel
c_func
(paren
(paren
r_int
r_int
)paren
id|card-&gt;rsq.last
op_minus
(paren
r_int
r_int
)paren
id|card-&gt;rsq.base
comma
id|SAR_REG_RSQH
)paren
suffix:semicolon
id|writel
c_func
(paren
id|card-&gt;rsq.paddr
comma
id|SAR_REG_RSQB
)paren
suffix:semicolon
id|IPRINTK
c_func
(paren
l_string|&quot;%s: RSQ base at 0x%lx (0x%x).&bslash;n&quot;
comma
id|card-&gt;name
comma
(paren
r_int
r_int
)paren
id|card-&gt;rsq.base
comma
id|readl
c_func
(paren
id|SAR_REG_RSQB
)paren
)paren
suffix:semicolon
id|IPRINTK
c_func
(paren
l_string|&quot;%s: RSQ head = 0x%x, base = 0x%x, tail = 0x%x.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|readl
c_func
(paren
id|SAR_REG_RSQH
)paren
comma
id|readl
c_func
(paren
id|SAR_REG_RSQB
)paren
comma
id|readl
c_func
(paren
id|SAR_REG_RSQT
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|deinit_rsq
id|deinit_rsq
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|card-&gt;pcidev
comma
id|RSQSIZE
comma
id|card-&gt;rsq.base
comma
id|card-&gt;rsq.paddr
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|dequeue_rx
id|dequeue_rx
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|rsq_entry
op_star
id|rsqe
)paren
(brace
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_struct
id|rx_pool
op_star
id|rpp
suffix:semicolon
r_struct
id|vc_map
op_star
id|vc
suffix:semicolon
id|u32
id|header
comma
id|vpi
comma
id|vci
suffix:semicolon
id|u32
id|stat
suffix:semicolon
r_int
id|i
suffix:semicolon
id|stat
op_assign
id|le32_to_cpu
c_func
(paren
id|rsqe-&gt;word_4
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|SAR_RSQE_IDLE
)paren
(brace
id|RXPRINTK
c_func
(paren
l_string|&quot;%s: message about inactive connection.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb
op_assign
id|sb_pool_skb
c_func
(paren
id|card
comma
id|le32_to_cpu
c_func
(paren
id|rsqe-&gt;word_2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: NULL skb in %s, rsqe: %08x %08x %08x %08x&bslash;n&quot;
comma
id|card-&gt;name
comma
id|__FUNCTION__
comma
id|le32_to_cpu
c_func
(paren
id|rsqe-&gt;word_1
)paren
comma
id|le32_to_cpu
c_func
(paren
id|rsqe-&gt;word_2
)paren
comma
id|le32_to_cpu
c_func
(paren
id|rsqe-&gt;word_3
)paren
comma
id|le32_to_cpu
c_func
(paren
id|rsqe-&gt;word_4
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|header
op_assign
id|le32_to_cpu
c_func
(paren
id|rsqe-&gt;word_1
)paren
suffix:semicolon
id|vpi
op_assign
(paren
id|header
op_rshift
l_int|16
)paren
op_amp
l_int|0x00ff
suffix:semicolon
id|vci
op_assign
(paren
id|header
op_rshift
l_int|0
)paren
op_amp
l_int|0xffff
suffix:semicolon
id|RXPRINTK
c_func
(paren
l_string|&quot;%s: SDU for %d.%d received in buffer 0x%p (data 0x%p).&bslash;n&quot;
comma
id|card-&gt;name
comma
id|vpi
comma
id|vci
comma
id|skb
comma
id|skb-&gt;data
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vpi
op_ge
(paren
l_int|1
op_lshift
id|card-&gt;vpibits
)paren
)paren
op_logical_or
(paren
id|vci
op_ne
(paren
id|vci
op_amp
id|card-&gt;vcimask
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: SDU received for out-of-range vc %u.%u&bslash;n&quot;
comma
id|card-&gt;name
comma
id|vpi
comma
id|vci
)paren
suffix:semicolon
id|recycle_rx_skb
c_func
(paren
id|card
comma
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|vc
op_assign
id|card-&gt;vcs
(braket
id|VPCI2VC
c_func
(paren
id|card
comma
id|vpi
comma
id|vci
)paren
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc
op_logical_or
op_logical_neg
id|test_bit
c_func
(paren
id|VCF_RX
comma
op_amp
id|vc-&gt;flags
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: SDU received on non RX vc %u.%u&bslash;n&quot;
comma
id|card-&gt;name
comma
id|vpi
comma
id|vci
)paren
suffix:semicolon
id|recycle_rx_skb
c_func
(paren
id|card
comma
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|vcc
op_assign
id|vc-&gt;rx_vcc
suffix:semicolon
id|pci_dma_sync_single
c_func
(paren
id|card-&gt;pcidev
comma
id|IDT77252_PRV_PADDR
c_func
(paren
id|skb
)paren
comma
id|skb-&gt;end
op_minus
id|skb-&gt;data
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vcc-&gt;qos.aal
op_eq
id|ATM_AAL0
)paren
op_logical_or
(paren
id|vcc-&gt;qos.aal
op_eq
id|ATM_AAL34
)paren
)paren
(brace
r_struct
id|sk_buff
op_star
id|sb
suffix:semicolon
r_int
r_char
op_star
id|cell
suffix:semicolon
id|u32
id|aal0
suffix:semicolon
id|cell
op_assign
id|skb-&gt;data
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
(paren
id|stat
op_amp
id|SAR_RSQE_CELLCNT
)paren
suffix:semicolon
id|i
suffix:semicolon
id|i
op_decrement
)paren
(brace
r_if
c_cond
(paren
(paren
id|sb
op_assign
id|dev_alloc_skb
c_func
(paren
l_int|64
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Can&squot;t allocate buffers for aal0.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|atomic_add
c_func
(paren
id|i
comma
op_amp
id|vcc-&gt;stats-&gt;rx_drop
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|atm_charge
c_func
(paren
id|vcc
comma
id|sb-&gt;truesize
)paren
)paren
(brace
id|RXPRINTK
c_func
(paren
l_string|&quot;%s: atm_charge() dropped aal0 packets.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|atomic_add
c_func
(paren
id|i
op_minus
l_int|1
comma
op_amp
id|vcc-&gt;stats-&gt;rx_drop
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|sb
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|aal0
op_assign
(paren
id|vpi
op_lshift
id|ATM_HDR_VPI_SHIFT
)paren
op_or
(paren
id|vci
op_lshift
id|ATM_HDR_VCI_SHIFT
)paren
suffix:semicolon
id|aal0
op_or_assign
(paren
id|stat
op_amp
id|SAR_RSQE_EPDU
)paren
ques
c_cond
l_int|0x00000002
suffix:colon
l_int|0
suffix:semicolon
id|aal0
op_or_assign
(paren
id|stat
op_amp
id|SAR_RSQE_CLP
)paren
ques
c_cond
l_int|0x00000001
suffix:colon
l_int|0
suffix:semicolon
op_star
(paren
(paren
id|u32
op_star
)paren
id|sb-&gt;data
)paren
op_assign
id|aal0
suffix:semicolon
id|skb_put
c_func
(paren
id|sb
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|sb
comma
id|ATM_CELL_PAYLOAD
)paren
comma
id|cell
comma
id|ATM_CELL_PAYLOAD
)paren
suffix:semicolon
id|ATM_SKB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|vcc
op_assign
id|vcc
suffix:semicolon
id|sb-&gt;stamp
op_assign
id|xtime
suffix:semicolon
id|vcc
op_member_access_from_pointer
id|push
c_func
(paren
id|vcc
comma
id|sb
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;rx
)paren
suffix:semicolon
id|cell
op_add_assign
id|ATM_CELL_PAYLOAD
suffix:semicolon
)brace
id|recycle_rx_skb
c_func
(paren
id|card
comma
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vcc-&gt;qos.aal
op_ne
id|ATM_AAL5
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Unexpected AAL type in dequeue_rx(): %d.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|vcc-&gt;qos.aal
)paren
suffix:semicolon
id|recycle_rx_skb
c_func
(paren
id|card
comma
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|skb-&gt;len
op_assign
(paren
id|stat
op_amp
id|SAR_RSQE_CELLCNT
)paren
op_star
id|ATM_CELL_PAYLOAD
suffix:semicolon
id|rpp
op_assign
op_amp
id|vc-&gt;rcv.rx_pool
suffix:semicolon
id|rpp-&gt;len
op_add_assign
id|skb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|rpp-&gt;count
op_increment
)paren
id|rpp-&gt;first
op_assign
id|skb
suffix:semicolon
op_star
id|rpp-&gt;last
op_assign
id|skb
suffix:semicolon
id|rpp-&gt;last
op_assign
op_amp
id|IDT77252_PRV_NEXT
c_func
(paren
id|skb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|SAR_RSQE_EPDU
)paren
(brace
r_int
r_char
op_star
id|l1l2
suffix:semicolon
r_int
r_int
id|len
suffix:semicolon
id|l1l2
op_assign
(paren
r_int
r_char
op_star
)paren
(paren
(paren
r_int
r_int
)paren
id|skb-&gt;data
op_plus
id|skb-&gt;len
op_minus
l_int|6
)paren
suffix:semicolon
id|len
op_assign
(paren
id|l1l2
(braket
l_int|0
)braket
op_lshift
l_int|8
)paren
op_or
id|l1l2
(braket
l_int|1
)braket
suffix:semicolon
id|len
op_assign
id|len
ques
c_cond
id|len
suffix:colon
l_int|0x10000
suffix:semicolon
id|RXPRINTK
c_func
(paren
l_string|&quot;%s: PDU has %d bytes.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|len
op_plus
l_int|8
OG
id|rpp-&gt;len
)paren
op_logical_or
(paren
id|len
op_plus
(paren
l_int|47
op_plus
l_int|8
)paren
OL
id|rpp-&gt;len
)paren
)paren
(brace
id|RXPRINTK
c_func
(paren
l_string|&quot;%s: AAL5 PDU size mismatch: %d != %d. &quot;
l_string|&quot;(CDC: %08x)&bslash;n&quot;
comma
id|card-&gt;name
comma
id|len
comma
id|rpp-&gt;len
comma
id|readl
c_func
(paren
id|SAR_REG_CDC
)paren
)paren
suffix:semicolon
id|recycle_rx_pool_skb
c_func
(paren
id|card
comma
id|rpp
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;rx_err
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stat
op_amp
id|SAR_RSQE_CRC
)paren
(brace
id|RXPRINTK
c_func
(paren
l_string|&quot;%s: AAL5 CRC error.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|recycle_rx_pool_skb
c_func
(paren
id|card
comma
id|rpp
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;rx_err
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rpp-&gt;count
OG
l_int|1
)paren
(brace
r_struct
id|sk_buff
op_star
id|sb
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|rpp-&gt;len
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|RXPRINTK
c_func
(paren
l_string|&quot;%s: Can&squot;t alloc RX skb.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|recycle_rx_pool_skb
c_func
(paren
id|card
comma
id|rpp
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;rx_err
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|atm_charge
c_func
(paren
id|vcc
comma
id|skb-&gt;truesize
)paren
)paren
(brace
id|recycle_rx_pool_skb
c_func
(paren
id|card
comma
id|rpp
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|sb
op_assign
id|rpp-&gt;first
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|rpp-&gt;count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
id|sb-&gt;len
)paren
comma
id|sb-&gt;data
comma
id|sb-&gt;len
)paren
suffix:semicolon
id|sb
op_assign
id|IDT77252_PRV_NEXT
c_func
(paren
id|sb
)paren
suffix:semicolon
)brace
id|recycle_rx_pool_skb
c_func
(paren
id|card
comma
id|rpp
)paren
suffix:semicolon
id|skb_trim
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|vcc
op_assign
id|vcc
suffix:semicolon
id|skb-&gt;stamp
op_assign
id|xtime
suffix:semicolon
id|vcc
op_member_access_from_pointer
id|push
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;rx
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|flush_rx_pool
c_func
(paren
id|card
comma
id|rpp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|atm_charge
c_func
(paren
id|vcc
comma
id|skb-&gt;truesize
)paren
)paren
(brace
id|recycle_rx_skb
c_func
(paren
id|card
comma
id|skb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|pci_unmap_single
c_func
(paren
id|card-&gt;pcidev
comma
id|IDT77252_PRV_PADDR
c_func
(paren
id|skb
)paren
comma
id|skb-&gt;end
op_minus
id|skb-&gt;data
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|sb_pool_remove
c_func
(paren
id|card
comma
id|skb
)paren
suffix:semicolon
id|skb_trim
c_func
(paren
id|skb
comma
id|len
)paren
suffix:semicolon
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|vcc
op_assign
id|vcc
suffix:semicolon
id|skb-&gt;stamp
op_assign
id|xtime
suffix:semicolon
id|vcc
op_member_access_from_pointer
id|push
c_func
(paren
id|vcc
comma
id|skb
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;rx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|skb-&gt;truesize
OG
id|SAR_FB_SIZE_3
)paren
id|add_rx_skb
c_func
(paren
id|card
comma
l_int|3
comma
id|SAR_FB_SIZE_3
comma
l_int|1
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|skb-&gt;truesize
OG
id|SAR_FB_SIZE_2
)paren
id|add_rx_skb
c_func
(paren
id|card
comma
l_int|2
comma
id|SAR_FB_SIZE_2
comma
l_int|1
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|skb-&gt;truesize
OG
id|SAR_FB_SIZE_1
)paren
id|add_rx_skb
c_func
(paren
id|card
comma
l_int|1
comma
id|SAR_FB_SIZE_1
comma
l_int|1
)paren
suffix:semicolon
r_else
id|add_rx_skb
c_func
(paren
id|card
comma
l_int|0
comma
id|SAR_FB_SIZE_0
comma
l_int|1
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|idt77252_rx
id|idt77252_rx
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
)paren
(brace
r_struct
id|rsq_entry
op_star
id|rsqe
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;rsq.next
op_eq
id|card-&gt;rsq.last
)paren
id|rsqe
op_assign
id|card-&gt;rsq.base
suffix:semicolon
r_else
id|rsqe
op_assign
id|card-&gt;rsq.next
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|le32_to_cpu
c_func
(paren
id|rsqe-&gt;word_4
)paren
op_amp
id|SAR_RSQE_VALID
)paren
)paren
(brace
id|RXPRINTK
c_func
(paren
l_string|&quot;%s: no entry in RSQ.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_do
(brace
id|dequeue_rx
c_func
(paren
id|card
comma
id|rsqe
)paren
suffix:semicolon
id|rsqe-&gt;word_4
op_assign
l_int|0
suffix:semicolon
id|card-&gt;rsq.next
op_assign
id|rsqe
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;rsq.next
op_eq
id|card-&gt;rsq.last
)paren
id|rsqe
op_assign
id|card-&gt;rsq.base
suffix:semicolon
r_else
id|rsqe
op_assign
id|card-&gt;rsq.next
op_plus
l_int|1
suffix:semicolon
)brace
r_while
c_loop
(paren
id|le32_to_cpu
c_func
(paren
id|rsqe-&gt;word_4
)paren
op_amp
id|SAR_RSQE_VALID
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
r_int
r_int
)paren
id|card-&gt;rsq.next
op_minus
(paren
r_int
r_int
)paren
id|card-&gt;rsq.base
comma
id|SAR_REG_RSQH
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|idt77252_rx_raw
id|idt77252_rx_raw
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
)paren
(brace
r_struct
id|sk_buff
op_star
id|queue
suffix:semicolon
id|u32
id|head
comma
id|tail
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_struct
id|vc_map
op_star
id|vc
suffix:semicolon
r_struct
id|sk_buff
op_star
id|sb
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;raw_cell_head
op_eq
l_int|NULL
)paren
(brace
id|u32
id|handle
op_assign
id|le32_to_cpu
c_func
(paren
op_star
(paren
id|card-&gt;raw_cell_hnd
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|card-&gt;raw_cell_head
op_assign
id|sb_pool_skb
c_func
(paren
id|card
comma
id|handle
)paren
suffix:semicolon
)brace
id|queue
op_assign
id|card-&gt;raw_cell_head
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|queue
)paren
r_return
suffix:semicolon
id|head
op_assign
id|IDT77252_PRV_PADDR
c_func
(paren
id|queue
)paren
op_plus
(paren
id|queue-&gt;data
op_minus
id|queue-&gt;head
op_minus
l_int|16
)paren
suffix:semicolon
id|tail
op_assign
id|readl
c_func
(paren
id|SAR_REG_RAWCT
)paren
suffix:semicolon
id|pci_dma_sync_single
c_func
(paren
id|card-&gt;pcidev
comma
id|IDT77252_PRV_PADDR
c_func
(paren
id|queue
)paren
comma
id|queue-&gt;end
op_minus
id|queue-&gt;head
op_minus
l_int|16
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
r_while
c_loop
(paren
id|head
op_ne
id|tail
)paren
(brace
r_int
r_int
id|vpi
comma
id|vci
comma
id|pti
suffix:semicolon
id|u32
id|header
suffix:semicolon
id|header
op_assign
id|le32_to_cpu
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
op_amp
id|queue-&gt;data
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|vpi
op_assign
(paren
id|header
op_amp
id|ATM_HDR_VPI_MASK
)paren
op_rshift
id|ATM_HDR_VPI_SHIFT
suffix:semicolon
id|vci
op_assign
(paren
id|header
op_amp
id|ATM_HDR_VCI_MASK
)paren
op_rshift
id|ATM_HDR_VCI_SHIFT
suffix:semicolon
id|pti
op_assign
(paren
id|header
op_amp
id|ATM_HDR_PTI_MASK
)paren
op_rshift
id|ATM_HDR_PTI_SHIFT
suffix:semicolon
macro_line|#ifdef DEBUG_RAW_CELLS
(brace
r_int
id|i
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: raw cell %x.%02x.%04x.%x.%x&bslash;n&quot;
comma
id|card-&gt;name
comma
(paren
id|header
op_rshift
l_int|28
)paren
op_amp
l_int|0x000f
comma
(paren
id|header
op_rshift
l_int|20
)paren
op_amp
l_int|0x00ff
comma
(paren
id|header
op_rshift
l_int|4
)paren
op_amp
l_int|0xffff
comma
(paren
id|header
op_rshift
l_int|1
)paren
op_amp
l_int|0x0007
comma
(paren
id|header
op_rshift
l_int|0
)paren
op_amp
l_int|0x0001
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|16
suffix:semicolon
id|i
OL
l_int|64
suffix:semicolon
id|i
op_increment
)paren
id|printk
c_func
(paren
l_string|&quot; %02x&quot;
comma
id|queue-&gt;data
(braket
id|i
)braket
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#endif
r_if
c_cond
(paren
id|vpi
op_ge
(paren
l_int|1
op_lshift
id|card-&gt;vpibits
)paren
op_logical_or
id|vci
op_ge
(paren
l_int|1
op_lshift
id|card-&gt;vcibits
)paren
)paren
(brace
macro_line|#ifdef DEBUG_RAW_CELLS
id|printk
c_func
(paren
l_string|&quot;%s: SDU received for out-of-range vc %u.%u&bslash;n&quot;
comma
id|card-&gt;name
comma
id|vpi
comma
id|vci
)paren
suffix:semicolon
macro_line|#endif
r_goto
id|drop
suffix:semicolon
)brace
id|vc
op_assign
id|card-&gt;vcs
(braket
id|VPCI2VC
c_func
(paren
id|card
comma
id|vpi
comma
id|vci
)paren
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc
op_logical_or
op_logical_neg
id|test_bit
c_func
(paren
id|VCF_RX
comma
op_amp
id|vc-&gt;flags
)paren
)paren
(brace
macro_line|#ifdef DEBUG_RAW_CELLS
id|printk
c_func
(paren
l_string|&quot;%s: SDU received on non RX vc %u.%u&bslash;n&quot;
comma
id|card-&gt;name
comma
id|vpi
comma
id|vci
)paren
suffix:semicolon
macro_line|#endif
r_goto
id|drop
suffix:semicolon
)brace
id|vcc
op_assign
id|vc-&gt;rx_vcc
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;qos.aal
op_ne
id|ATM_AAL0
)paren
(brace
macro_line|#ifdef DEBUG_RAW_CELLS
id|printk
c_func
(paren
l_string|&quot;%s: raw cell for non AAL0 vc %u.%u&bslash;n&quot;
comma
id|card-&gt;name
comma
id|vpi
comma
id|vci
)paren
suffix:semicolon
macro_line|#endif
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;rx_drop
)paren
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|sb
op_assign
id|dev_alloc_skb
c_func
(paren
l_int|64
)paren
)paren
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Can&squot;t allocate buffers for AAL0.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;rx_err
)paren
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
r_if
c_cond
(paren
(paren
id|vcc-&gt;sk
op_ne
l_int|NULL
)paren
op_logical_and
op_logical_neg
id|atm_charge
c_func
(paren
id|vcc
comma
id|sb-&gt;truesize
)paren
)paren
(brace
id|RXPRINTK
c_func
(paren
l_string|&quot;%s: atm_charge() dropped AAL0 packets.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|sb
)paren
suffix:semicolon
r_goto
id|drop
suffix:semicolon
)brace
op_star
(paren
(paren
id|u32
op_star
)paren
id|sb-&gt;data
)paren
op_assign
id|header
suffix:semicolon
id|skb_put
c_func
(paren
id|sb
comma
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|sb
comma
id|ATM_CELL_PAYLOAD
)paren
comma
op_amp
(paren
id|queue-&gt;data
(braket
l_int|16
)braket
)paren
comma
id|ATM_CELL_PAYLOAD
)paren
suffix:semicolon
id|ATM_SKB
c_func
(paren
id|sb
)paren
op_member_access_from_pointer
id|vcc
op_assign
id|vcc
suffix:semicolon
id|sb-&gt;stamp
op_assign
id|xtime
suffix:semicolon
id|vcc
op_member_access_from_pointer
id|push
c_func
(paren
id|vcc
comma
id|sb
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;rx
)paren
suffix:semicolon
id|drop
suffix:colon
id|skb_pull
c_func
(paren
id|queue
comma
l_int|64
)paren
suffix:semicolon
id|head
op_assign
id|IDT77252_PRV_PADDR
c_func
(paren
id|queue
)paren
op_plus
(paren
id|queue-&gt;data
op_minus
id|queue-&gt;head
op_minus
l_int|16
)paren
suffix:semicolon
r_if
c_cond
(paren
id|queue-&gt;len
OL
l_int|128
)paren
(brace
r_struct
id|sk_buff
op_star
id|next
suffix:semicolon
id|u32
id|handle
suffix:semicolon
id|head
op_assign
id|le32_to_cpu
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
op_amp
id|queue-&gt;data
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|handle
op_assign
id|le32_to_cpu
c_func
(paren
op_star
(paren
id|u32
op_star
)paren
op_amp
id|queue-&gt;data
(braket
l_int|4
)braket
)paren
suffix:semicolon
id|next
op_assign
id|sb_pool_skb
c_func
(paren
id|card
comma
id|handle
)paren
suffix:semicolon
id|recycle_rx_skb
c_func
(paren
id|card
comma
id|queue
)paren
suffix:semicolon
r_if
c_cond
(paren
id|next
)paren
(brace
id|card-&gt;raw_cell_head
op_assign
id|next
suffix:semicolon
id|queue
op_assign
id|card-&gt;raw_cell_head
suffix:semicolon
id|pci_dma_sync_single
c_func
(paren
id|card-&gt;pcidev
comma
id|IDT77252_PRV_PADDR
c_func
(paren
id|queue
)paren
comma
id|queue-&gt;end
op_minus
id|queue-&gt;data
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
)brace
r_else
(brace
id|card-&gt;raw_cell_head
op_assign
l_int|NULL
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: raw cell queue overrun&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
)brace
)brace
multiline_comment|/*****************************************************************************/
multiline_comment|/*                                                                           */
multiline_comment|/* TSQ Handling                                                              */
multiline_comment|/*                                                                           */
multiline_comment|/*****************************************************************************/
r_static
r_int
DECL|function|init_tsq
id|init_tsq
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
)paren
(brace
r_struct
id|tsq_entry
op_star
id|tsqe
suffix:semicolon
id|card-&gt;tsq.base
op_assign
id|pci_alloc_consistent
c_func
(paren
id|card-&gt;pcidev
comma
id|RSQSIZE
comma
op_amp
id|card-&gt;tsq.paddr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;tsq.base
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: can&squot;t allocate TSQ.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|memset
c_func
(paren
id|card-&gt;tsq.base
comma
l_int|0
comma
id|TSQSIZE
)paren
suffix:semicolon
id|card-&gt;tsq.last
op_assign
id|card-&gt;tsq.base
op_plus
id|TSQ_NUM_ENTRIES
op_minus
l_int|1
suffix:semicolon
id|card-&gt;tsq.next
op_assign
id|card-&gt;tsq.last
suffix:semicolon
r_for
c_loop
(paren
id|tsqe
op_assign
id|card-&gt;tsq.base
suffix:semicolon
id|tsqe
op_le
id|card-&gt;tsq.last
suffix:semicolon
id|tsqe
op_increment
)paren
id|tsqe-&gt;word_2
op_assign
id|cpu_to_le32
c_func
(paren
id|SAR_TSQE_INVALID
)paren
suffix:semicolon
id|writel
c_func
(paren
id|card-&gt;tsq.paddr
comma
id|SAR_REG_TSQB
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
r_int
r_int
)paren
id|card-&gt;tsq.next
op_minus
(paren
r_int
r_int
)paren
id|card-&gt;tsq.base
comma
id|SAR_REG_TSQH
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|deinit_tsq
id|deinit_tsq
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|card-&gt;pcidev
comma
id|TSQSIZE
comma
id|card-&gt;tsq.base
comma
id|card-&gt;tsq.paddr
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|idt77252_tx
id|idt77252_tx
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
)paren
(brace
r_struct
id|tsq_entry
op_star
id|tsqe
suffix:semicolon
r_int
r_int
id|vpi
comma
id|vci
suffix:semicolon
r_struct
id|vc_map
op_star
id|vc
suffix:semicolon
id|u32
id|conn
comma
id|stat
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;tsq.next
op_eq
id|card-&gt;tsq.last
)paren
id|tsqe
op_assign
id|card-&gt;tsq.base
suffix:semicolon
r_else
id|tsqe
op_assign
id|card-&gt;tsq.next
op_plus
l_int|1
suffix:semicolon
id|TXPRINTK
c_func
(paren
l_string|&quot;idt77252_tx: tsq  %p: base %p, next %p, last %p&bslash;n&quot;
comma
id|tsqe
comma
id|card-&gt;tsq.base
comma
id|card-&gt;tsq.next
comma
id|card-&gt;tsq.last
)paren
suffix:semicolon
id|TXPRINTK
c_func
(paren
l_string|&quot;idt77252_tx: tsqb %08x, tsqt %08x, tsqh %08x, &bslash;n&quot;
comma
id|readl
c_func
(paren
id|SAR_REG_TSQB
)paren
comma
id|readl
c_func
(paren
id|SAR_REG_TSQT
)paren
comma
id|readl
c_func
(paren
id|SAR_REG_TSQH
)paren
)paren
suffix:semicolon
id|stat
op_assign
id|le32_to_cpu
c_func
(paren
id|tsqe-&gt;word_2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|SAR_TSQE_INVALID
)paren
r_return
suffix:semicolon
r_do
(brace
id|TXPRINTK
c_func
(paren
l_string|&quot;tsqe: 0x%p [0x%08x 0x%08x]&bslash;n&quot;
comma
id|tsqe
comma
id|le32_to_cpu
c_func
(paren
id|tsqe-&gt;word_1
)paren
comma
id|le32_to_cpu
c_func
(paren
id|tsqe-&gt;word_2
)paren
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|stat
op_amp
id|SAR_TSQE_TYPE
)paren
(brace
r_case
id|SAR_TSQE_TYPE_TIMER
suffix:colon
id|TXPRINTK
c_func
(paren
l_string|&quot;%s: Timer RollOver detected.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SAR_TSQE_TYPE_IDLE
suffix:colon
id|conn
op_assign
id|le32_to_cpu
c_func
(paren
id|tsqe-&gt;word_1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|SAR_TSQE_TAG
c_func
(paren
id|stat
)paren
op_eq
l_int|0x10
)paren
(brace
macro_line|#ifdef&t;NOTDEF
id|printk
c_func
(paren
l_string|&quot;%s: Connection %d halted.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|le32_to_cpu
c_func
(paren
id|tsqe-&gt;word_1
)paren
op_amp
l_int|0x1fff
)paren
suffix:semicolon
macro_line|#endif
r_break
suffix:semicolon
)brace
id|vc
op_assign
id|card-&gt;vcs
(braket
id|conn
op_amp
l_int|0x1fff
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: could not find VC from conn %d&bslash;n&quot;
comma
id|card-&gt;name
comma
id|conn
op_amp
l_int|0x1fff
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;%s: Connection %d IDLE.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|vc-&gt;index
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|VCF_IDLE
comma
op_amp
id|vc-&gt;flags
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SAR_TSQE_TYPE_TSR
suffix:colon
id|conn
op_assign
id|le32_to_cpu
c_func
(paren
id|tsqe-&gt;word_1
)paren
suffix:semicolon
id|vc
op_assign
id|card-&gt;vcs
(braket
id|conn
op_amp
l_int|0x1fff
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: no VC at index %d&bslash;n&quot;
comma
id|card-&gt;name
comma
id|le32_to_cpu
c_func
(paren
id|tsqe-&gt;word_1
)paren
op_amp
l_int|0x1fff
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|drain_scq
c_func
(paren
id|card
comma
id|vc
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SAR_TSQE_TYPE_TBD_COMP
suffix:colon
id|conn
op_assign
id|le32_to_cpu
c_func
(paren
id|tsqe-&gt;word_1
)paren
suffix:semicolon
id|vpi
op_assign
(paren
id|conn
op_rshift
id|SAR_TBD_VPI_SHIFT
)paren
op_amp
l_int|0x00ff
suffix:semicolon
id|vci
op_assign
(paren
id|conn
op_rshift
id|SAR_TBD_VCI_SHIFT
)paren
op_amp
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
id|vpi
op_ge
(paren
l_int|1
op_lshift
id|card-&gt;vpibits
)paren
op_logical_or
id|vci
op_ge
(paren
l_int|1
op_lshift
id|card-&gt;vcibits
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: TBD complete: &quot;
l_string|&quot;out of range VPI.VCI %u.%u&bslash;n&quot;
comma
id|card-&gt;name
comma
id|vpi
comma
id|vci
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|vc
op_assign
id|card-&gt;vcs
(braket
id|VPCI2VC
c_func
(paren
id|card
comma
id|vpi
comma
id|vci
)paren
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: TBD complete: &quot;
l_string|&quot;no VC at VPI.VCI %u.%u&bslash;n&quot;
comma
id|card-&gt;name
comma
id|vpi
comma
id|vci
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|drain_scq
c_func
(paren
id|card
comma
id|vc
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|tsqe-&gt;word_2
op_assign
id|cpu_to_le32
c_func
(paren
id|SAR_TSQE_INVALID
)paren
suffix:semicolon
id|card-&gt;tsq.next
op_assign
id|tsqe
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;tsq.next
op_eq
id|card-&gt;tsq.last
)paren
id|tsqe
op_assign
id|card-&gt;tsq.base
suffix:semicolon
r_else
id|tsqe
op_assign
id|card-&gt;tsq.next
op_plus
l_int|1
suffix:semicolon
id|TXPRINTK
c_func
(paren
l_string|&quot;tsqe: %p: base %p, next %p, last %p&bslash;n&quot;
comma
id|tsqe
comma
id|card-&gt;tsq.base
comma
id|card-&gt;tsq.next
comma
id|card-&gt;tsq.last
)paren
suffix:semicolon
id|stat
op_assign
id|le32_to_cpu
c_func
(paren
id|tsqe-&gt;word_2
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
op_logical_neg
(paren
id|stat
op_amp
id|SAR_TSQE_INVALID
)paren
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
r_int
r_int
)paren
id|card-&gt;tsq.next
op_minus
(paren
r_int
r_int
)paren
id|card-&gt;tsq.base
comma
id|SAR_REG_TSQH
)paren
suffix:semicolon
id|XPRINTK
c_func
(paren
l_string|&quot;idt77252_tx-after writel%d: TSQ head = 0x%x, tail = 0x%x, next = 0x%p.&bslash;n&quot;
comma
id|card-&gt;index
comma
id|readl
c_func
(paren
id|SAR_REG_TSQH
)paren
comma
id|readl
c_func
(paren
id|SAR_REG_TSQT
)paren
comma
id|card-&gt;tsq.next
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|tst_timer
id|tst_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|idt77252_dev
op_star
id|card
op_assign
(paren
r_struct
id|idt77252_dev
op_star
)paren
id|data
suffix:semicolon
r_int
r_int
id|base
comma
id|idle
comma
id|jump
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u32
id|pc
suffix:semicolon
r_int
id|e
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;tst_lock
comma
id|flags
)paren
suffix:semicolon
id|base
op_assign
id|card-&gt;tst
(braket
id|card-&gt;tst_index
)braket
suffix:semicolon
id|idle
op_assign
id|card-&gt;tst
(braket
id|card-&gt;tst_index
op_xor
l_int|1
)braket
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|TST_SWITCH_WAIT
comma
op_amp
id|card-&gt;tst_state
)paren
)paren
(brace
id|jump
op_assign
id|base
op_plus
id|card-&gt;tst_size
op_minus
l_int|2
suffix:semicolon
id|pc
op_assign
id|readl
c_func
(paren
id|SAR_REG_NOW
)paren
op_rshift
l_int|2
suffix:semicolon
r_if
c_cond
(paren
(paren
id|pc
op_xor
id|idle
)paren
op_amp
op_complement
(paren
id|card-&gt;tst_size
op_minus
l_int|1
)paren
)paren
(brace
id|mod_timer
c_func
(paren
op_amp
id|card-&gt;tst_timer
comma
id|jiffies
op_plus
l_int|1
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|clear_bit
c_func
(paren
id|TST_SWITCH_WAIT
comma
op_amp
id|card-&gt;tst_state
)paren
suffix:semicolon
id|card-&gt;tst_index
op_xor_assign
l_int|1
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|jump
comma
id|TSTE_OPC_JMP
op_or
(paren
id|base
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|base
op_assign
id|card-&gt;tst
(braket
id|card-&gt;tst_index
)braket
suffix:semicolon
id|idle
op_assign
id|card-&gt;tst
(braket
id|card-&gt;tst_index
op_xor
l_int|1
)braket
suffix:semicolon
r_for
c_loop
(paren
id|e
op_assign
l_int|0
suffix:semicolon
id|e
OL
id|card-&gt;tst_size
op_minus
l_int|2
suffix:semicolon
id|e
op_increment
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;soft_tst
(braket
id|e
)braket
dot
id|tste
op_amp
id|TSTE_PUSH_IDLE
)paren
(brace
id|write_sram
c_func
(paren
id|card
comma
id|idle
op_plus
id|e
comma
id|card-&gt;soft_tst
(braket
id|e
)braket
dot
id|tste
op_amp
id|TSTE_MASK
)paren
suffix:semicolon
id|card-&gt;soft_tst
(braket
id|e
)braket
dot
id|tste
op_and_assign
op_complement
(paren
id|TSTE_PUSH_IDLE
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|test_and_clear_bit
c_func
(paren
id|TST_SWITCH_PENDING
comma
op_amp
id|card-&gt;tst_state
)paren
)paren
(brace
r_for
c_loop
(paren
id|e
op_assign
l_int|0
suffix:semicolon
id|e
OL
id|card-&gt;tst_size
op_minus
l_int|2
suffix:semicolon
id|e
op_increment
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;soft_tst
(braket
id|e
)braket
dot
id|tste
op_amp
id|TSTE_PUSH_ACTIVE
)paren
(brace
id|write_sram
c_func
(paren
id|card
comma
id|idle
op_plus
id|e
comma
id|card-&gt;soft_tst
(braket
id|e
)braket
dot
id|tste
op_amp
id|TSTE_MASK
)paren
suffix:semicolon
id|card-&gt;soft_tst
(braket
id|e
)braket
dot
id|tste
op_and_assign
op_complement
(paren
id|TSTE_PUSH_ACTIVE
)paren
suffix:semicolon
id|card-&gt;soft_tst
(braket
id|e
)braket
dot
id|tste
op_or_assign
id|TSTE_PUSH_IDLE
suffix:semicolon
)brace
)brace
id|jump
op_assign
id|base
op_plus
id|card-&gt;tst_size
op_minus
l_int|2
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|jump
comma
id|TSTE_OPC_NULL
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|TST_SWITCH_WAIT
comma
op_amp
id|card-&gt;tst_state
)paren
suffix:semicolon
id|mod_timer
c_func
(paren
op_amp
id|card-&gt;tst_timer
comma
id|jiffies
op_plus
l_int|1
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;tst_lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|__fill_tst
id|__fill_tst
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|vc_map
op_star
id|vc
comma
r_int
id|n
comma
r_int
r_int
id|opc
)paren
(brace
r_int
r_int
id|cl
comma
id|avail
suffix:semicolon
r_int
r_int
id|idle
suffix:semicolon
r_int
id|e
comma
id|r
suffix:semicolon
id|u32
id|data
suffix:semicolon
id|avail
op_assign
id|card-&gt;tst_size
op_minus
l_int|2
suffix:semicolon
r_for
c_loop
(paren
id|e
op_assign
l_int|0
suffix:semicolon
id|e
OL
id|avail
suffix:semicolon
id|e
op_increment
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;soft_tst
(braket
id|e
)braket
dot
id|vc
op_eq
l_int|NULL
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|e
op_ge
id|avail
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: No free TST entries found&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|NPRINTK
c_func
(paren
l_string|&quot;%s: conn %d: first TST entry at %d.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|vc
ques
c_cond
id|vc-&gt;index
suffix:colon
op_minus
l_int|1
comma
id|e
)paren
suffix:semicolon
id|r
op_assign
id|n
suffix:semicolon
id|cl
op_assign
id|avail
suffix:semicolon
id|data
op_assign
id|opc
op_amp
id|TSTE_OPC_MASK
suffix:semicolon
r_if
c_cond
(paren
id|vc
op_logical_and
(paren
id|opc
op_ne
id|TSTE_OPC_NULL
)paren
)paren
id|data
op_assign
id|opc
op_or
id|vc-&gt;index
suffix:semicolon
id|idle
op_assign
id|card-&gt;tst
(braket
id|card-&gt;tst_index
op_xor
l_int|1
)braket
suffix:semicolon
multiline_comment|/*&n;&t; * Fill Soft TST.&n;&t; */
r_while
c_loop
(paren
id|r
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
(paren
id|cl
op_ge
id|avail
)paren
op_logical_and
(paren
id|card-&gt;soft_tst
(braket
id|e
)braket
dot
id|vc
op_eq
l_int|NULL
)paren
)paren
(brace
r_if
c_cond
(paren
id|vc
)paren
id|card-&gt;soft_tst
(braket
id|e
)braket
dot
id|vc
op_assign
id|vc
suffix:semicolon
r_else
id|card-&gt;soft_tst
(braket
id|e
)braket
dot
id|vc
op_assign
(paren
r_void
op_star
)paren
op_minus
l_int|1
suffix:semicolon
id|card-&gt;soft_tst
(braket
id|e
)braket
dot
id|tste
op_assign
id|data
suffix:semicolon
r_if
c_cond
(paren
id|timer_pending
c_func
(paren
op_amp
id|card-&gt;tst_timer
)paren
)paren
id|card-&gt;soft_tst
(braket
id|e
)braket
dot
id|tste
op_or_assign
id|TSTE_PUSH_ACTIVE
suffix:semicolon
r_else
(brace
id|write_sram
c_func
(paren
id|card
comma
id|idle
op_plus
id|e
comma
id|data
)paren
suffix:semicolon
id|card-&gt;soft_tst
(braket
id|e
)braket
dot
id|tste
op_or_assign
id|TSTE_PUSH_IDLE
suffix:semicolon
)brace
id|cl
op_sub_assign
id|card-&gt;tst_size
suffix:semicolon
id|r
op_decrement
suffix:semicolon
)brace
r_if
c_cond
(paren
op_increment
id|e
op_eq
id|avail
)paren
id|e
op_assign
l_int|0
suffix:semicolon
id|cl
op_add_assign
id|n
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|fill_tst
id|fill_tst
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|vc_map
op_star
id|vc
comma
r_int
id|n
comma
r_int
r_int
id|opc
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|res
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;tst_lock
comma
id|flags
)paren
suffix:semicolon
id|res
op_assign
id|__fill_tst
c_func
(paren
id|card
comma
id|vc
comma
id|n
comma
id|opc
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|TST_SWITCH_PENDING
comma
op_amp
id|card-&gt;tst_state
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|timer_pending
c_func
(paren
op_amp
id|card-&gt;tst_timer
)paren
)paren
id|mod_timer
c_func
(paren
op_amp
id|card-&gt;tst_timer
comma
id|jiffies
op_plus
l_int|1
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;tst_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
r_static
r_int
DECL|function|__clear_tst
id|__clear_tst
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|vc_map
op_star
id|vc
)paren
(brace
r_int
r_int
id|idle
suffix:semicolon
r_int
id|e
suffix:semicolon
id|idle
op_assign
id|card-&gt;tst
(braket
id|card-&gt;tst_index
op_xor
l_int|1
)braket
suffix:semicolon
r_for
c_loop
(paren
id|e
op_assign
l_int|0
suffix:semicolon
id|e
OL
id|card-&gt;tst_size
op_minus
l_int|2
suffix:semicolon
id|e
op_increment
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;soft_tst
(braket
id|e
)braket
dot
id|vc
op_eq
id|vc
)paren
(brace
id|card-&gt;soft_tst
(braket
id|e
)braket
dot
id|vc
op_assign
l_int|NULL
suffix:semicolon
id|card-&gt;soft_tst
(braket
id|e
)braket
dot
id|tste
op_assign
id|TSTE_OPC_VAR
suffix:semicolon
r_if
c_cond
(paren
id|timer_pending
c_func
(paren
op_amp
id|card-&gt;tst_timer
)paren
)paren
id|card-&gt;soft_tst
(braket
id|e
)braket
dot
id|tste
op_or_assign
id|TSTE_PUSH_ACTIVE
suffix:semicolon
r_else
(brace
id|write_sram
c_func
(paren
id|card
comma
id|idle
op_plus
id|e
comma
id|TSTE_OPC_VAR
)paren
suffix:semicolon
id|card-&gt;soft_tst
(braket
id|e
)braket
dot
id|tste
op_or_assign
id|TSTE_PUSH_IDLE
suffix:semicolon
)brace
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|clear_tst
id|clear_tst
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|vc_map
op_star
id|vc
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|res
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;tst_lock
comma
id|flags
)paren
suffix:semicolon
id|res
op_assign
id|__clear_tst
c_func
(paren
id|card
comma
id|vc
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|TST_SWITCH_PENDING
comma
op_amp
id|card-&gt;tst_state
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|timer_pending
c_func
(paren
op_amp
id|card-&gt;tst_timer
)paren
)paren
id|mod_timer
c_func
(paren
op_amp
id|card-&gt;tst_timer
comma
id|jiffies
op_plus
l_int|1
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;tst_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
r_static
r_int
DECL|function|change_tst
id|change_tst
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|vc_map
op_star
id|vc
comma
r_int
id|n
comma
r_int
r_int
id|opc
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|res
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;tst_lock
comma
id|flags
)paren
suffix:semicolon
id|__clear_tst
c_func
(paren
id|card
comma
id|vc
)paren
suffix:semicolon
id|res
op_assign
id|__fill_tst
c_func
(paren
id|card
comma
id|vc
comma
id|n
comma
id|opc
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|TST_SWITCH_PENDING
comma
op_amp
id|card-&gt;tst_state
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|timer_pending
c_func
(paren
op_amp
id|card-&gt;tst_timer
)paren
)paren
id|mod_timer
c_func
(paren
op_amp
id|card-&gt;tst_timer
comma
id|jiffies
op_plus
l_int|1
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;tst_lock
comma
id|flags
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
r_static
r_int
DECL|function|set_tct
id|set_tct
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|vc_map
op_star
id|vc
)paren
(brace
r_int
r_int
id|tct
suffix:semicolon
id|tct
op_assign
(paren
r_int
r_int
)paren
(paren
id|card-&gt;tct_base
op_plus
id|vc-&gt;index
op_star
id|SAR_SRAM_TCT_SIZE
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|vc
op_member_access_from_pointer
r_class
)paren
(brace
r_case
id|SCHED_CBR
suffix:colon
id|OPRINTK
c_func
(paren
l_string|&quot;%s: writing TCT at 0x%lx, SCD 0x%lx.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|tct
comma
id|vc-&gt;scq-&gt;scd
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|tct
op_plus
l_int|0
comma
id|TCT_CBR
op_or
id|vc-&gt;scq-&gt;scd
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|tct
op_plus
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|tct
op_plus
l_int|2
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|tct
op_plus
l_int|3
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|tct
op_plus
l_int|4
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|tct
op_plus
l_int|5
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|tct
op_plus
l_int|6
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|tct
op_plus
l_int|7
comma
l_int|0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SCHED_UBR
suffix:colon
id|OPRINTK
c_func
(paren
l_string|&quot;%s: writing TCT at 0x%lx, SCD 0x%lx.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|tct
comma
id|vc-&gt;scq-&gt;scd
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|tct
op_plus
l_int|0
comma
id|TCT_UBR
op_or
id|vc-&gt;scq-&gt;scd
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|tct
op_plus
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|tct
op_plus
l_int|2
comma
id|TCT_TSIF
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|tct
op_plus
l_int|3
comma
id|TCT_HALT
op_or
id|TCT_IDLE
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|tct
op_plus
l_int|4
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|tct
op_plus
l_int|5
comma
id|vc-&gt;init_er
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|tct
op_plus
l_int|6
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|tct
op_plus
l_int|7
comma
id|TCT_FLAG_UBR
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SCHED_VBR
suffix:colon
r_case
id|SCHED_ABR
suffix:colon
r_default
suffix:colon
r_return
op_minus
id|ENOSYS
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************/
multiline_comment|/*                                                                           */
multiline_comment|/* FBQ Handling                                                              */
multiline_comment|/*                                                                           */
multiline_comment|/*****************************************************************************/
r_static
id|__inline__
r_int
DECL|function|idt77252_fbq_level
id|idt77252_fbq_level
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_int
id|queue
)paren
(brace
r_return
(paren
id|readl
c_func
(paren
id|SAR_REG_STAT
)paren
op_rshift
(paren
l_int|16
op_plus
(paren
id|queue
op_lshift
l_int|2
)paren
)paren
)paren
op_amp
l_int|0x0f
suffix:semicolon
)brace
r_static
id|__inline__
r_int
DECL|function|idt77252_fbq_full
id|idt77252_fbq_full
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_int
id|queue
)paren
(brace
r_return
(paren
id|readl
c_func
(paren
id|SAR_REG_STAT
)paren
op_rshift
(paren
l_int|16
op_plus
(paren
id|queue
op_lshift
l_int|2
)paren
)paren
)paren
op_eq
l_int|0x0f
suffix:semicolon
)brace
r_static
r_int
DECL|function|push_rx_skb
id|push_rx_skb
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|queue
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
id|u32
id|handle
suffix:semicolon
id|u32
id|addr
suffix:semicolon
id|skb-&gt;data
op_assign
id|skb-&gt;tail
op_assign
id|skb-&gt;head
suffix:semicolon
id|skb-&gt;len
op_assign
l_int|0
suffix:semicolon
id|skb_reserve
c_func
(paren
id|skb
comma
l_int|16
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|queue
)paren
(brace
r_case
l_int|0
suffix:colon
id|skb_put
c_func
(paren
id|skb
comma
id|SAR_FB_SIZE_0
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|skb_put
c_func
(paren
id|skb
comma
id|SAR_FB_SIZE_1
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|skb_put
c_func
(paren
id|skb
comma
id|SAR_FB_SIZE_2
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|3
suffix:colon
id|skb_put
c_func
(paren
id|skb
comma
id|SAR_FB_SIZE_3
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|idt77252_fbq_full
c_func
(paren
id|card
comma
id|queue
)paren
)paren
r_return
op_minus
l_int|1
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|skb-&gt;data
(braket
(paren
id|skb-&gt;len
op_amp
op_complement
(paren
l_int|0x3f
)paren
)paren
op_minus
l_int|64
)braket
comma
l_int|0
comma
l_int|2
op_star
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
id|handle
op_assign
id|IDT77252_PRV_POOL
c_func
(paren
id|skb
)paren
suffix:semicolon
id|addr
op_assign
id|IDT77252_PRV_PADDR
c_func
(paren
id|skb
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
id|writel
c_func
(paren
id|handle
comma
id|card-&gt;fbq
(braket
id|queue
)braket
)paren
suffix:semicolon
id|writel
c_func
(paren
id|addr
comma
id|card-&gt;fbq
(braket
id|queue
)braket
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|add_rx_skb
id|add_rx_skb
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_int
id|queue
comma
r_int
r_int
id|size
comma
r_int
r_int
id|count
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|dma_addr_t
id|paddr
suffix:semicolon
id|u32
id|handle
suffix:semicolon
r_while
c_loop
(paren
id|count
op_decrement
)paren
(brace
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|sb_pool_add
c_func
(paren
id|card
comma
id|skb
comma
id|queue
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: SB POOL full&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_goto
id|outfree
suffix:semicolon
)brace
id|paddr
op_assign
id|pci_map_single
c_func
(paren
id|card-&gt;pcidev
comma
id|skb-&gt;data
comma
id|skb-&gt;end
op_minus
id|skb-&gt;data
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|IDT77252_PRV_PADDR
c_func
(paren
id|skb
)paren
op_assign
id|paddr
suffix:semicolon
r_if
c_cond
(paren
id|push_rx_skb
c_func
(paren
id|card
comma
id|skb
comma
id|queue
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: FB QUEUE full&bslash;n&quot;
comma
id|__FUNCTION__
)paren
suffix:semicolon
r_goto
id|outunmap
suffix:semicolon
)brace
)brace
r_return
suffix:semicolon
id|outunmap
suffix:colon
id|pci_unmap_single
c_func
(paren
id|card-&gt;pcidev
comma
id|IDT77252_PRV_PADDR
c_func
(paren
id|skb
)paren
comma
id|skb-&gt;end
op_minus
id|skb-&gt;data
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|handle
op_assign
id|IDT77252_PRV_POOL
c_func
(paren
id|skb
)paren
suffix:semicolon
id|card-&gt;sbpool
(braket
id|POOL_QUEUE
c_func
(paren
id|handle
)paren
)braket
dot
id|skb
(braket
id|POOL_INDEX
c_func
(paren
id|handle
)paren
)braket
op_assign
l_int|NULL
suffix:semicolon
id|outfree
suffix:colon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|recycle_rx_skb
id|recycle_rx_skb
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
id|u32
id|handle
op_assign
id|IDT77252_PRV_POOL
c_func
(paren
id|skb
)paren
suffix:semicolon
r_int
id|err
suffix:semicolon
id|err
op_assign
id|push_rx_skb
c_func
(paren
id|card
comma
id|skb
comma
id|POOL_QUEUE
c_func
(paren
id|handle
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|card-&gt;pcidev
comma
id|IDT77252_PRV_PADDR
c_func
(paren
id|skb
)paren
comma
id|skb-&gt;end
op_minus
id|skb-&gt;data
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|sb_pool_remove
c_func
(paren
id|card
comma
id|skb
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
r_static
r_void
DECL|function|flush_rx_pool
id|flush_rx_pool
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|rx_pool
op_star
id|rpp
)paren
(brace
id|rpp-&gt;len
op_assign
l_int|0
suffix:semicolon
id|rpp-&gt;count
op_assign
l_int|0
suffix:semicolon
id|rpp-&gt;first
op_assign
l_int|NULL
suffix:semicolon
id|rpp-&gt;last
op_assign
op_amp
id|rpp-&gt;first
suffix:semicolon
)brace
r_static
r_void
DECL|function|recycle_rx_pool_skb
id|recycle_rx_pool_skb
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|rx_pool
op_star
id|rpp
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
comma
op_star
id|next
suffix:semicolon
r_int
id|i
suffix:semicolon
id|skb
op_assign
id|rpp-&gt;first
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|rpp-&gt;count
suffix:semicolon
id|i
op_increment
)paren
(brace
id|next
op_assign
id|IDT77252_PRV_NEXT
c_func
(paren
id|skb
)paren
suffix:semicolon
id|recycle_rx_skb
c_func
(paren
id|card
comma
id|skb
)paren
suffix:semicolon
id|skb
op_assign
id|next
suffix:semicolon
)brace
id|flush_rx_pool
c_func
(paren
id|card
comma
id|rpp
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************/
multiline_comment|/*                                                                           */
multiline_comment|/* ATM Interface                                                             */
multiline_comment|/*                                                                           */
multiline_comment|/*****************************************************************************/
r_static
r_void
DECL|function|idt77252_phy_put
id|idt77252_phy_put
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
comma
r_int
r_char
id|value
comma
r_int
r_int
id|addr
)paren
(brace
id|write_utility
c_func
(paren
id|dev-&gt;dev_data
comma
l_int|0x100
op_plus
(paren
id|addr
op_amp
l_int|0x1ff
)paren
comma
id|value
)paren
suffix:semicolon
)brace
r_static
r_int
r_char
DECL|function|idt77252_phy_get
id|idt77252_phy_get
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
comma
r_int
r_int
id|addr
)paren
(brace
r_return
id|read_utility
c_func
(paren
id|dev-&gt;dev_data
comma
l_int|0x100
op_plus
(paren
id|addr
op_amp
l_int|0x1ff
)paren
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|idt77252_send_skb
id|idt77252_send_skb
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|sk_buff
op_star
id|skb
comma
r_int
id|oam
)paren
(brace
r_struct
id|atm_dev
op_star
id|dev
op_assign
id|vcc-&gt;dev
suffix:semicolon
r_struct
id|idt77252_dev
op_star
id|card
op_assign
id|dev-&gt;dev_data
suffix:semicolon
r_struct
id|vc_map
op_star
id|vc
op_assign
id|vcc-&gt;dev_data
suffix:semicolon
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
id|vc
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: NULL connection in send().&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;tx_err
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|VCF_TX
comma
op_amp
id|vc-&gt;flags
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Trying to transmit on a non-tx VC.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;tx_err
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|vcc-&gt;qos.aal
)paren
(brace
r_case
id|ATM_AAL0
suffix:colon
r_case
id|ATM_AAL1
suffix:colon
r_case
id|ATM_AAL5
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;%s: Unsupported AAL: %d&bslash;n&quot;
comma
id|card-&gt;name
comma
id|vcc-&gt;qos.aal
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;tx_err
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|iovcnt
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: No scatter-gather yet.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;tx_err
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|vcc
op_assign
id|vcc
suffix:semicolon
id|err
op_assign
id|queue_skb
c_func
(paren
id|card
comma
id|vc
comma
id|skb
comma
id|oam
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;tx_err
)paren
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
r_return
id|err
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_int
DECL|function|idt77252_send
id|idt77252_send
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|sk_buff
op_star
id|skb
)paren
(brace
r_return
id|idt77252_send_skb
c_func
(paren
id|vcc
comma
id|skb
comma
l_int|0
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|idt77252_send_oam
id|idt77252_send_oam
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_void
op_star
id|cell
comma
r_int
id|flags
)paren
(brace
r_struct
id|atm_dev
op_star
id|dev
op_assign
id|vcc-&gt;dev
suffix:semicolon
r_struct
id|idt77252_dev
op_star
id|card
op_assign
id|dev-&gt;dev_data
suffix:semicolon
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
id|skb
op_assign
id|dev_alloc_skb
c_func
(paren
l_int|64
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skb
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Out of memory in send_oam().&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|atomic_inc
c_func
(paren
op_amp
id|vcc-&gt;stats-&gt;tx_err
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|atomic_add
c_func
(paren
id|skb-&gt;truesize
op_plus
id|ATM_PDU_OVHD
comma
op_amp
id|vcc-&gt;tx_inuse
)paren
suffix:semicolon
id|ATM_SKB
c_func
(paren
id|skb
)paren
op_member_access_from_pointer
id|iovcnt
op_assign
l_int|0
suffix:semicolon
id|memcpy
c_func
(paren
id|skb_put
c_func
(paren
id|skb
comma
l_int|52
)paren
comma
id|cell
comma
l_int|52
)paren
suffix:semicolon
r_return
id|idt77252_send_skb
c_func
(paren
id|vcc
comma
id|skb
comma
l_int|1
)paren
suffix:semicolon
)brace
r_static
id|__inline__
r_int
r_int
DECL|function|idt77252_fls
id|idt77252_fls
c_func
(paren
r_int
r_int
id|x
)paren
(brace
r_int
id|r
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|x
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|x
op_amp
l_int|0xffff0000
)paren
(brace
id|x
op_rshift_assign
l_int|16
suffix:semicolon
id|r
op_add_assign
l_int|16
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_amp
l_int|0xff00
)paren
(brace
id|x
op_rshift_assign
l_int|8
suffix:semicolon
id|r
op_add_assign
l_int|8
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_amp
l_int|0xf0
)paren
(brace
id|x
op_rshift_assign
l_int|4
suffix:semicolon
id|r
op_add_assign
l_int|4
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_amp
l_int|0xc
)paren
(brace
id|x
op_rshift_assign
l_int|2
suffix:semicolon
id|r
op_add_assign
l_int|2
suffix:semicolon
)brace
r_if
c_cond
(paren
id|x
op_amp
l_int|0x2
)paren
id|r
op_add_assign
l_int|1
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
r_static
id|u16
DECL|function|idt77252_int_to_atmfp
id|idt77252_int_to_atmfp
c_func
(paren
r_int
r_int
id|rate
)paren
(brace
id|u16
id|m
comma
id|e
suffix:semicolon
r_if
c_cond
(paren
id|rate
op_eq
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|e
op_assign
id|idt77252_fls
c_func
(paren
id|rate
)paren
op_minus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|e
OL
l_int|9
)paren
id|m
op_assign
(paren
id|rate
op_minus
(paren
l_int|1
op_lshift
id|e
)paren
)paren
op_lshift
(paren
l_int|9
op_minus
id|e
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|e
op_eq
l_int|9
)paren
id|m
op_assign
(paren
id|rate
op_minus
(paren
l_int|1
op_lshift
id|e
)paren
)paren
suffix:semicolon
r_else
multiline_comment|/* e &gt; 9 */
id|m
op_assign
(paren
id|rate
op_minus
(paren
l_int|1
op_lshift
id|e
)paren
)paren
op_rshift
(paren
id|e
op_minus
l_int|9
)paren
suffix:semicolon
r_return
l_int|0x4000
op_or
(paren
id|e
op_lshift
l_int|9
)paren
op_or
id|m
suffix:semicolon
)brace
r_static
id|u8
DECL|function|idt77252_rate_logindex
id|idt77252_rate_logindex
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_int
id|pcr
)paren
(brace
id|u16
id|afp
suffix:semicolon
id|afp
op_assign
id|idt77252_int_to_atmfp
c_func
(paren
id|pcr
OL
l_int|0
ques
c_cond
op_minus
id|pcr
suffix:colon
id|pcr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pcr
OL
l_int|0
)paren
r_return
id|rate_to_log
(braket
(paren
id|afp
op_rshift
l_int|5
)paren
op_amp
l_int|0x1ff
)braket
suffix:semicolon
r_return
id|rate_to_log
(braket
(paren
(paren
id|afp
op_rshift
l_int|5
)paren
op_plus
l_int|1
)paren
op_amp
l_int|0x1ff
)braket
suffix:semicolon
)brace
r_static
r_void
DECL|function|idt77252_est_timer
id|idt77252_est_timer
c_func
(paren
r_int
r_int
id|data
)paren
(brace
r_struct
id|vc_map
op_star
id|vc
op_assign
(paren
r_struct
id|vc_map
op_star
)paren
id|data
suffix:semicolon
r_struct
id|idt77252_dev
op_star
id|card
op_assign
id|vc-&gt;card
suffix:semicolon
r_struct
id|rate_estimator
op_star
id|est
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
id|u32
id|rate
comma
id|cps
suffix:semicolon
id|u64
id|ncells
suffix:semicolon
id|u8
id|lacr
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|vc-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|est
op_assign
id|vc-&gt;estimator
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|est
)paren
r_goto
id|out
suffix:semicolon
id|ncells
op_assign
id|est-&gt;cells
suffix:semicolon
id|rate
op_assign
(paren
(paren
id|u32
)paren
(paren
id|ncells
op_minus
id|est-&gt;last_cells
)paren
)paren
op_lshift
(paren
l_int|7
op_minus
id|est-&gt;interval
)paren
suffix:semicolon
id|est-&gt;last_cells
op_assign
id|ncells
suffix:semicolon
id|est-&gt;avcps
op_add_assign
(paren
(paren
r_int
)paren
id|rate
op_minus
(paren
r_int
)paren
id|est-&gt;avcps
)paren
op_rshift
id|est-&gt;ewma_log
suffix:semicolon
id|est-&gt;cps
op_assign
(paren
id|est-&gt;avcps
op_plus
l_int|0x1f
)paren
op_rshift
l_int|5
suffix:semicolon
id|cps
op_assign
id|est-&gt;cps
suffix:semicolon
r_if
c_cond
(paren
id|cps
OL
(paren
id|est-&gt;maxcps
op_rshift
l_int|4
)paren
)paren
id|cps
op_assign
id|est-&gt;maxcps
op_rshift
l_int|4
suffix:semicolon
id|lacr
op_assign
id|idt77252_rate_logindex
c_func
(paren
id|card
comma
id|cps
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lacr
OG
id|vc-&gt;max_er
)paren
id|lacr
op_assign
id|vc-&gt;max_er
suffix:semicolon
r_if
c_cond
(paren
id|lacr
op_ne
id|vc-&gt;lacr
)paren
(brace
id|vc-&gt;lacr
op_assign
id|lacr
suffix:semicolon
id|writel
c_func
(paren
id|TCMDQ_LACR
op_or
(paren
id|vc-&gt;lacr
op_lshift
l_int|16
)paren
op_or
id|vc-&gt;index
comma
id|SAR_REG_TCMDQ
)paren
suffix:semicolon
)brace
id|est-&gt;timer.expires
op_assign
id|jiffies
op_plus
(paren
(paren
id|HZ
op_div
l_int|4
)paren
op_lshift
id|est-&gt;interval
)paren
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|est-&gt;timer
)paren
suffix:semicolon
id|out
suffix:colon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|vc-&gt;lock
comma
id|flags
)paren
suffix:semicolon
)brace
r_static
r_struct
id|rate_estimator
op_star
DECL|function|idt77252_init_est
id|idt77252_init_est
c_func
(paren
r_struct
id|vc_map
op_star
id|vc
comma
r_int
id|pcr
)paren
(brace
r_struct
id|rate_estimator
op_star
id|est
suffix:semicolon
id|est
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|rate_estimator
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|est
)paren
r_return
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|est
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|est
)paren
)paren
suffix:semicolon
id|est-&gt;maxcps
op_assign
id|pcr
OL
l_int|0
ques
c_cond
op_minus
id|pcr
suffix:colon
id|pcr
suffix:semicolon
id|est-&gt;cps
op_assign
id|est-&gt;maxcps
suffix:semicolon
id|est-&gt;avcps
op_assign
id|est-&gt;cps
op_lshift
l_int|5
suffix:semicolon
id|est-&gt;interval
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* XXX: make this configurable */
id|est-&gt;ewma_log
op_assign
l_int|2
suffix:semicolon
multiline_comment|/* XXX: make this configurable */
id|est-&gt;timer.data
op_assign
(paren
r_int
r_int
)paren
id|vc
suffix:semicolon
id|est-&gt;timer.function
op_assign
id|idt77252_est_timer
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|est-&gt;timer
)paren
suffix:semicolon
id|est-&gt;timer.expires
op_assign
id|jiffies
op_plus
(paren
(paren
id|HZ
op_div
l_int|4
)paren
op_lshift
id|est-&gt;interval
)paren
suffix:semicolon
id|add_timer
c_func
(paren
op_amp
id|est-&gt;timer
)paren
suffix:semicolon
r_return
id|est
suffix:semicolon
)brace
r_static
r_int
DECL|function|idt77252_init_cbr
id|idt77252_init_cbr
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|vc_map
op_star
id|vc
comma
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|atm_qos
op_star
id|qos
)paren
(brace
r_int
id|tst_free
comma
id|tst_used
comma
id|tst_entries
suffix:semicolon
r_int
r_int
id|tmpl
comma
id|modl
suffix:semicolon
r_int
id|tcr
comma
id|tcra
suffix:semicolon
r_if
c_cond
(paren
(paren
id|qos-&gt;txtp.max_pcr
op_eq
l_int|0
)paren
op_logical_and
(paren
id|qos-&gt;txtp.pcr
op_eq
l_int|0
)paren
op_logical_and
(paren
id|qos-&gt;txtp.min_pcr
op_eq
l_int|0
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: trying to open a CBR VC with cell rate = 0&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|tst_used
op_assign
l_int|0
suffix:semicolon
id|tst_free
op_assign
id|card-&gt;tst_free
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|VCF_TX
comma
op_amp
id|vc-&gt;flags
)paren
)paren
id|tst_used
op_assign
id|vc-&gt;ntste
suffix:semicolon
id|tst_free
op_add_assign
id|tst_used
suffix:semicolon
id|tcr
op_assign
id|atm_pcr_goal
c_func
(paren
op_amp
id|qos-&gt;txtp
)paren
suffix:semicolon
id|tcra
op_assign
id|tcr
op_ge
l_int|0
ques
c_cond
id|tcr
suffix:colon
op_minus
id|tcr
suffix:semicolon
id|TXPRINTK
c_func
(paren
l_string|&quot;%s: CBR target cell rate = %d&bslash;n&quot;
comma
id|card-&gt;name
comma
id|tcra
)paren
suffix:semicolon
id|tmpl
op_assign
(paren
r_int
r_int
)paren
id|tcra
op_star
(paren
(paren
r_int
r_int
)paren
id|card-&gt;tst_size
op_minus
l_int|2
)paren
suffix:semicolon
id|modl
op_assign
id|tmpl
op_mod
(paren
r_int
r_int
)paren
id|card-&gt;utopia_pcr
suffix:semicolon
id|tst_entries
op_assign
(paren
r_int
)paren
(paren
id|tmpl
op_div
id|card-&gt;utopia_pcr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tcr
OG
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|modl
OG
l_int|0
)paren
id|tst_entries
op_increment
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|tcr
op_eq
l_int|0
)paren
(brace
id|tst_entries
op_assign
id|tst_free
op_minus
id|SAR_TST_RESERVED
suffix:semicolon
r_if
c_cond
(paren
id|tst_entries
op_le
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: no CBR bandwidth free.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENOSR
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|tst_entries
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: selected CBR bandwidth &lt; granularity.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|tst_entries
OG
(paren
id|tst_free
op_minus
id|SAR_TST_RESERVED
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: not enough CBR bandwidth free.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENOSR
suffix:semicolon
)brace
id|vc-&gt;ntste
op_assign
id|tst_entries
suffix:semicolon
id|card-&gt;tst_free
op_assign
id|tst_free
op_minus
id|tst_entries
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|VCF_TX
comma
op_amp
id|vc-&gt;flags
)paren
)paren
(brace
r_if
c_cond
(paren
id|tst_used
op_eq
id|tst_entries
)paren
r_return
l_int|0
suffix:semicolon
id|OPRINTK
c_func
(paren
l_string|&quot;%s: modify %d -&gt; %d entries in TST.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|tst_used
comma
id|tst_entries
)paren
suffix:semicolon
id|change_tst
c_func
(paren
id|card
comma
id|vc
comma
id|tst_entries
comma
id|TSTE_OPC_CBR
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|OPRINTK
c_func
(paren
l_string|&quot;%s: setting %d entries in TST.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|tst_entries
)paren
suffix:semicolon
id|fill_tst
c_func
(paren
id|card
comma
id|vc
comma
id|tst_entries
comma
id|TSTE_OPC_CBR
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|idt77252_init_ubr
id|idt77252_init_ubr
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|vc_map
op_star
id|vc
comma
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|atm_qos
op_star
id|qos
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
id|tcr
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|vc-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;estimator
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|vc-&gt;estimator-&gt;timer
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|vc-&gt;estimator
)paren
suffix:semicolon
id|vc-&gt;estimator
op_assign
l_int|NULL
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|vc-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|tcr
op_assign
id|atm_pcr_goal
c_func
(paren
op_amp
id|qos-&gt;txtp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tcr
op_eq
l_int|0
)paren
id|tcr
op_assign
id|card-&gt;link_pcr
suffix:semicolon
id|vc-&gt;estimator
op_assign
id|idt77252_init_est
c_func
(paren
id|vc
comma
id|tcr
)paren
suffix:semicolon
id|vc
op_member_access_from_pointer
r_class
op_assign
id|SCHED_UBR
suffix:semicolon
id|vc-&gt;init_er
op_assign
id|idt77252_rate_logindex
c_func
(paren
id|card
comma
id|tcr
)paren
suffix:semicolon
id|vc-&gt;lacr
op_assign
id|vc-&gt;init_er
suffix:semicolon
r_if
c_cond
(paren
id|tcr
OL
l_int|0
)paren
id|vc-&gt;max_er
op_assign
id|vc-&gt;init_er
suffix:semicolon
r_else
id|vc-&gt;max_er
op_assign
l_int|0xff
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|idt77252_init_tx
id|idt77252_init_tx
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|vc_map
op_star
id|vc
comma
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|atm_qos
op_star
id|qos
)paren
(brace
r_int
id|error
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|VCF_TX
comma
op_amp
id|vc-&gt;flags
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
r_switch
c_cond
(paren
id|qos-&gt;txtp.traffic_class
)paren
(brace
r_case
id|ATM_CBR
suffix:colon
id|vc
op_member_access_from_pointer
r_class
op_assign
id|SCHED_CBR
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_UBR
suffix:colon
id|vc
op_member_access_from_pointer
r_class
op_assign
id|SCHED_UBR
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_VBR
suffix:colon
r_case
id|ATM_ABR
suffix:colon
r_default
suffix:colon
r_return
op_minus
id|EPROTONOSUPPORT
suffix:semicolon
)brace
id|vc-&gt;scq
op_assign
id|alloc_scq
c_func
(paren
id|card
comma
id|vc
op_member_access_from_pointer
r_class
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc-&gt;scq
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: can&squot;t get SCQ.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|vc-&gt;scq-&gt;scd
op_assign
id|get_free_scd
c_func
(paren
id|card
comma
id|vc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;scq-&gt;scd
op_eq
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: no SCD available.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|free_scq
c_func
(paren
id|card
comma
id|vc-&gt;scq
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|fill_scd
c_func
(paren
id|card
comma
id|vc-&gt;scq
comma
id|vc
op_member_access_from_pointer
r_class
)paren
suffix:semicolon
r_if
c_cond
(paren
id|set_tct
c_func
(paren
id|card
comma
id|vc
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: class %d not supported.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|qos-&gt;txtp.traffic_class
)paren
suffix:semicolon
id|card-&gt;scd2vc
(braket
id|vc-&gt;scd_index
)braket
op_assign
l_int|NULL
suffix:semicolon
id|free_scq
c_func
(paren
id|card
comma
id|vc-&gt;scq
)paren
suffix:semicolon
r_return
op_minus
id|EPROTONOSUPPORT
suffix:semicolon
)brace
r_switch
c_cond
(paren
id|vc
op_member_access_from_pointer
r_class
)paren
(brace
r_case
id|SCHED_CBR
suffix:colon
id|error
op_assign
id|idt77252_init_cbr
c_func
(paren
id|card
comma
id|vc
comma
id|vcc
comma
id|qos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
id|card-&gt;scd2vc
(braket
id|vc-&gt;scd_index
)braket
op_assign
l_int|NULL
suffix:semicolon
id|free_scq
c_func
(paren
id|card
comma
id|vc-&gt;scq
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|clear_bit
c_func
(paren
id|VCF_IDLE
comma
op_amp
id|vc-&gt;flags
)paren
suffix:semicolon
id|writel
c_func
(paren
id|TCMDQ_START
op_or
id|vc-&gt;index
comma
id|SAR_REG_TCMDQ
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|SCHED_UBR
suffix:colon
id|error
op_assign
id|idt77252_init_ubr
c_func
(paren
id|card
comma
id|vc
comma
id|vcc
comma
id|qos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
id|card-&gt;scd2vc
(braket
id|vc-&gt;scd_index
)braket
op_assign
l_int|NULL
suffix:semicolon
id|free_scq
c_func
(paren
id|card
comma
id|vc-&gt;scq
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
id|set_bit
c_func
(paren
id|VCF_IDLE
comma
op_amp
id|vc-&gt;flags
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
id|vc-&gt;tx_vcc
op_assign
id|vcc
suffix:semicolon
id|set_bit
c_func
(paren
id|VCF_TX
comma
op_amp
id|vc-&gt;flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|idt77252_init_rx
id|idt77252_init_rx
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
comma
r_struct
id|vc_map
op_star
id|vc
comma
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|atm_qos
op_star
id|qos
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|addr
suffix:semicolon
id|u32
id|rcte
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|VCF_RX
comma
op_amp
id|vc-&gt;flags
)paren
)paren
r_return
op_minus
id|EBUSY
suffix:semicolon
id|vc-&gt;rx_vcc
op_assign
id|vcc
suffix:semicolon
id|set_bit
c_func
(paren
id|VCF_RX
comma
op_amp
id|vc-&gt;flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vcc-&gt;vci
op_eq
l_int|3
)paren
op_logical_or
(paren
id|vcc-&gt;vci
op_eq
l_int|4
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|flush_rx_pool
c_func
(paren
id|card
comma
op_amp
id|vc-&gt;rcv.rx_pool
)paren
suffix:semicolon
id|rcte
op_or_assign
id|SAR_RCTE_CONNECTOPEN
suffix:semicolon
id|rcte
op_or_assign
id|SAR_RCTE_RAWCELLINTEN
suffix:semicolon
r_switch
c_cond
(paren
id|qos-&gt;aal
)paren
(brace
r_case
id|ATM_AAL0
suffix:colon
id|rcte
op_or_assign
id|SAR_RCTE_RCQ
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_AAL1
suffix:colon
id|rcte
op_or_assign
id|SAR_RCTE_OAM
suffix:semicolon
multiline_comment|/* Let SAR drop Video */
r_break
suffix:semicolon
r_case
id|ATM_AAL34
suffix:colon
id|rcte
op_or_assign
id|SAR_RCTE_AAL34
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_AAL5
suffix:colon
id|rcte
op_or_assign
id|SAR_RCTE_AAL5
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|rcte
op_or_assign
id|SAR_RCTE_RCQ
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|qos-&gt;aal
op_ne
id|ATM_AAL5
)paren
id|rcte
op_or_assign
id|SAR_RCTE_FBP_1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|qos-&gt;rxtp.max_sdu
OG
id|SAR_FB_SIZE_2
)paren
id|rcte
op_or_assign
id|SAR_RCTE_FBP_3
suffix:semicolon
r_else
r_if
c_cond
(paren
id|qos-&gt;rxtp.max_sdu
OG
id|SAR_FB_SIZE_1
)paren
id|rcte
op_or_assign
id|SAR_RCTE_FBP_2
suffix:semicolon
r_else
r_if
c_cond
(paren
id|qos-&gt;rxtp.max_sdu
OG
id|SAR_FB_SIZE_0
)paren
id|rcte
op_or_assign
id|SAR_RCTE_FBP_1
suffix:semicolon
r_else
id|rcte
op_or_assign
id|SAR_RCTE_FBP_01
suffix:semicolon
id|addr
op_assign
id|card-&gt;rct_base
op_plus
(paren
id|vc-&gt;index
op_lshift
l_int|2
)paren
suffix:semicolon
id|OPRINTK
c_func
(paren
l_string|&quot;%s: writing RCT at 0x%lx&bslash;n&quot;
comma
id|card-&gt;name
comma
id|addr
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|addr
comma
id|rcte
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
id|writel
c_func
(paren
id|SAR_CMD_OPEN_CONNECTION
op_or
(paren
id|addr
op_lshift
l_int|2
)paren
comma
id|SAR_REG_CMD
)paren
suffix:semicolon
id|waitfor_idle
c_func
(paren
id|card
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|idt77252_find_vcc
id|idt77252_find_vcc
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
op_star
id|vpi
comma
r_int
op_star
id|vci
)paren
(brace
r_struct
id|atm_vcc
op_star
id|walk
suffix:semicolon
r_if
c_cond
(paren
op_star
id|vpi
op_eq
id|ATM_VPI_ANY
)paren
(brace
op_star
id|vpi
op_assign
l_int|0
suffix:semicolon
id|walk
op_assign
id|vcc-&gt;dev-&gt;vccs
suffix:semicolon
r_while
c_loop
(paren
id|walk
)paren
(brace
r_if
c_cond
(paren
(paren
id|walk-&gt;vci
op_eq
op_star
id|vci
)paren
op_logical_and
(paren
id|walk-&gt;vpi
op_eq
op_star
id|vpi
)paren
)paren
(brace
(paren
op_star
id|vpi
)paren
op_increment
suffix:semicolon
id|walk
op_assign
id|vcc-&gt;dev-&gt;vccs
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|walk
op_assign
id|walk-&gt;next
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_star
id|vci
op_eq
id|ATM_VCI_ANY
)paren
(brace
op_star
id|vci
op_assign
id|ATM_NOT_RSV_VCI
suffix:semicolon
id|walk
op_assign
id|vcc-&gt;dev-&gt;vccs
suffix:semicolon
r_while
c_loop
(paren
id|walk
)paren
(brace
r_if
c_cond
(paren
(paren
id|walk-&gt;vci
op_eq
op_star
id|vci
)paren
op_logical_and
(paren
id|walk-&gt;vpi
op_eq
op_star
id|vpi
)paren
)paren
(brace
(paren
op_star
id|vci
)paren
op_increment
suffix:semicolon
id|walk
op_assign
id|vcc-&gt;dev-&gt;vccs
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|walk
op_assign
id|walk-&gt;next
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|idt77252_open
id|idt77252_open
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_int
id|vpi
comma
r_int
id|vci
)paren
(brace
r_struct
id|atm_dev
op_star
id|dev
op_assign
id|vcc-&gt;dev
suffix:semicolon
r_struct
id|idt77252_dev
op_star
id|card
op_assign
id|dev-&gt;dev_data
suffix:semicolon
r_struct
id|vc_map
op_star
id|vc
suffix:semicolon
r_int
r_int
id|index
suffix:semicolon
r_int
r_int
id|inuse
suffix:semicolon
r_int
id|error
suffix:semicolon
id|idt77252_find_vcc
c_func
(paren
id|vcc
comma
op_amp
id|vpi
comma
op_amp
id|vci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vpi
op_eq
id|ATM_VPI_UNSPEC
op_logical_or
id|vci
op_eq
id|ATM_VCI_UNSPEC
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|vpi
op_ge
(paren
l_int|1
op_lshift
id|card-&gt;vpibits
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: unsupported VPI: %d&bslash;n&quot;
comma
id|card-&gt;name
comma
id|vpi
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vci
op_ge
(paren
l_int|1
op_lshift
id|card-&gt;vcibits
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: unsupported VCI: %d&bslash;n&quot;
comma
id|card-&gt;name
comma
id|vci
)paren
suffix:semicolon
r_return
op_minus
id|EINVAL
suffix:semicolon
)brace
id|vcc-&gt;vpi
op_assign
id|vpi
suffix:semicolon
id|vcc-&gt;vci
op_assign
id|vci
suffix:semicolon
id|set_bit
c_func
(paren
id|ATM_VF_ADDR
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
id|down
c_func
(paren
op_amp
id|card-&gt;mutex
)paren
suffix:semicolon
id|OPRINTK
c_func
(paren
l_string|&quot;%s: opening vpi.vci: %d.%d&bslash;n&quot;
comma
id|card-&gt;name
comma
id|vpi
comma
id|vci
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|vcc-&gt;qos.aal
)paren
(brace
r_case
id|ATM_AAL0
suffix:colon
r_case
id|ATM_AAL1
suffix:colon
r_case
id|ATM_AAL5
suffix:colon
r_break
suffix:semicolon
r_default
suffix:colon
id|printk
c_func
(paren
l_string|&quot;%s: Unsupported AAL: %d&bslash;n&quot;
comma
id|card-&gt;name
comma
id|vcc-&gt;qos.aal
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|card-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|EPROTONOSUPPORT
suffix:semicolon
)brace
id|index
op_assign
id|VPCI2VC
c_func
(paren
id|card
comma
id|vpi
comma
id|vci
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;vcs
(braket
id|index
)braket
)paren
(brace
id|card-&gt;vcs
(braket
id|index
)braket
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|vc_map
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;vcs
(braket
id|index
)braket
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: can&squot;t alloc vc in open()&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|card-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|card-&gt;vcs
(braket
id|index
)braket
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|vc_map
)paren
)paren
suffix:semicolon
id|card-&gt;vcs
(braket
id|index
)braket
op_member_access_from_pointer
id|card
op_assign
id|card
suffix:semicolon
id|card-&gt;vcs
(braket
id|index
)braket
op_member_access_from_pointer
id|index
op_assign
id|index
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|card-&gt;vcs
(braket
id|index
)braket
op_member_access_from_pointer
id|lock
)paren
suffix:semicolon
)brace
id|vc
op_assign
id|card-&gt;vcs
(braket
id|index
)braket
suffix:semicolon
id|vcc-&gt;dev_data
op_assign
id|vc
suffix:semicolon
id|IPRINTK
c_func
(paren
l_string|&quot;%s: idt77252_open: vc = %d (%d.%d) %s/%s (max RX SDU: %u)&bslash;n&quot;
comma
id|card-&gt;name
comma
id|vc-&gt;index
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
comma
id|vcc-&gt;qos.rxtp.traffic_class
op_ne
id|ATM_NONE
ques
c_cond
l_string|&quot;rx&quot;
suffix:colon
l_string|&quot;--&quot;
comma
id|vcc-&gt;qos.txtp.traffic_class
op_ne
id|ATM_NONE
ques
c_cond
l_string|&quot;tx&quot;
suffix:colon
l_string|&quot;--&quot;
comma
id|vcc-&gt;qos.rxtp.max_sdu
)paren
suffix:semicolon
id|inuse
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;qos.txtp.traffic_class
op_ne
id|ATM_NONE
op_logical_and
id|test_bit
c_func
(paren
id|VCF_TX
comma
op_amp
id|vc-&gt;flags
)paren
)paren
id|inuse
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;qos.rxtp.traffic_class
op_ne
id|ATM_NONE
op_logical_and
id|test_bit
c_func
(paren
id|VCF_RX
comma
op_amp
id|vc-&gt;flags
)paren
)paren
id|inuse
op_add_assign
l_int|2
suffix:semicolon
r_if
c_cond
(paren
id|inuse
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: %s vci already in use.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|inuse
op_eq
l_int|1
ques
c_cond
l_string|&quot;tx&quot;
suffix:colon
id|inuse
op_eq
l_int|2
ques
c_cond
l_string|&quot;rx&quot;
suffix:colon
l_string|&quot;tx and rx&quot;
)paren
suffix:semicolon
id|up
c_func
(paren
op_amp
id|card-&gt;mutex
)paren
suffix:semicolon
r_return
op_minus
id|EADDRINUSE
suffix:semicolon
)brace
r_if
c_cond
(paren
id|vcc-&gt;qos.txtp.traffic_class
op_ne
id|ATM_NONE
)paren
(brace
id|error
op_assign
id|idt77252_init_tx
c_func
(paren
id|card
comma
id|vc
comma
id|vcc
comma
op_amp
id|vcc-&gt;qos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
id|up
c_func
(paren
op_amp
id|card-&gt;mutex
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|vcc-&gt;qos.rxtp.traffic_class
op_ne
id|ATM_NONE
)paren
(brace
id|error
op_assign
id|idt77252_init_rx
c_func
(paren
id|card
comma
id|vc
comma
id|vcc
comma
op_amp
id|vcc-&gt;qos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
(brace
id|up
c_func
(paren
op_amp
id|card-&gt;mutex
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
)brace
id|set_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
id|MOD_INC_USE_COUNT
suffix:semicolon
id|up
c_func
(paren
op_amp
id|card-&gt;mutex
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|idt77252_close
id|idt77252_close
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
)paren
(brace
r_struct
id|atm_dev
op_star
id|dev
op_assign
id|vcc-&gt;dev
suffix:semicolon
r_struct
id|idt77252_dev
op_star
id|card
op_assign
id|dev-&gt;dev_data
suffix:semicolon
r_struct
id|vc_map
op_star
id|vc
op_assign
id|vcc-&gt;dev_data
suffix:semicolon
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|addr
suffix:semicolon
r_int
id|timeout
suffix:semicolon
id|down
c_func
(paren
op_amp
id|card-&gt;mutex
)paren
suffix:semicolon
id|IPRINTK
c_func
(paren
l_string|&quot;%s: idt77252_close: vc = %d (%d.%d)&bslash;n&quot;
comma
id|card-&gt;name
comma
id|vc-&gt;index
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|ATM_VF_READY
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vcc-&gt;qos.rxtp.traffic_class
op_ne
id|ATM_NONE
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|vc-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|VCF_RX
comma
op_amp
id|vc-&gt;flags
)paren
suffix:semicolon
id|vc-&gt;rx_vcc
op_assign
l_int|NULL
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|vc-&gt;lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|vcc-&gt;vci
op_eq
l_int|3
)paren
op_logical_or
(paren
id|vcc-&gt;vci
op_eq
l_int|4
)paren
)paren
r_goto
id|done
suffix:semicolon
id|addr
op_assign
id|card-&gt;rct_base
op_plus
id|vc-&gt;index
op_star
id|SAR_SRAM_RCT_SIZE
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
id|writel
c_func
(paren
id|SAR_CMD_CLOSE_CONNECTION
op_or
(paren
id|addr
op_lshift
l_int|2
)paren
comma
id|SAR_REG_CMD
)paren
suffix:semicolon
id|waitfor_idle
c_func
(paren
id|card
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;rcv.rx_pool.count
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;%s: closing a VC with pending rx buffers.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|recycle_rx_pool_skb
c_func
(paren
id|card
comma
op_amp
id|vc-&gt;rcv.rx_pool
)paren
suffix:semicolon
)brace
)brace
id|done
suffix:colon
r_if
c_cond
(paren
id|vcc-&gt;qos.txtp.traffic_class
op_ne
id|ATM_NONE
)paren
(brace
id|spin_lock_irqsave
c_func
(paren
op_amp
id|vc-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|VCF_TX
comma
op_amp
id|vc-&gt;flags
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|VCF_IDLE
comma
op_amp
id|vc-&gt;flags
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|VCF_RSV
comma
op_amp
id|vc-&gt;flags
)paren
suffix:semicolon
id|vc-&gt;tx_vcc
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;estimator
)paren
(brace
id|del_timer
c_func
(paren
op_amp
id|vc-&gt;estimator-&gt;timer
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|vc-&gt;estimator
)paren
suffix:semicolon
id|vc-&gt;estimator
op_assign
l_int|NULL
suffix:semicolon
)brace
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|vc-&gt;lock
comma
id|flags
)paren
suffix:semicolon
id|timeout
op_assign
l_int|5
op_star
id|HZ
suffix:semicolon
r_while
c_loop
(paren
id|atomic_read
c_func
(paren
op_amp
id|vc-&gt;scq-&gt;used
)paren
OG
l_int|0
)paren
(brace
id|timeout
op_assign
id|schedule_timeout
c_func
(paren
id|timeout
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|timeout
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|timeout
)paren
id|printk
c_func
(paren
l_string|&quot;%s: SCQ drain timeout: %u used&bslash;n&quot;
comma
id|card-&gt;name
comma
id|atomic_read
c_func
(paren
op_amp
id|vc-&gt;scq-&gt;used
)paren
)paren
suffix:semicolon
id|writel
c_func
(paren
id|TCMDQ_HALT
op_or
id|vc-&gt;index
comma
id|SAR_REG_TCMDQ
)paren
suffix:semicolon
id|clear_scd
c_func
(paren
id|card
comma
id|vc-&gt;scq
comma
id|vc
op_member_access_from_pointer
r_class
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vc
op_member_access_from_pointer
r_class
op_eq
id|SCHED_CBR
)paren
(brace
id|clear_tst
c_func
(paren
id|card
comma
id|vc
)paren
suffix:semicolon
id|card-&gt;tst_free
op_add_assign
id|vc-&gt;ntste
suffix:semicolon
id|vc-&gt;ntste
op_assign
l_int|0
suffix:semicolon
)brace
id|card-&gt;scd2vc
(braket
id|vc-&gt;scd_index
)braket
op_assign
l_int|NULL
suffix:semicolon
id|free_scq
c_func
(paren
id|card
comma
id|vc-&gt;scq
)paren
suffix:semicolon
)brace
id|MOD_DEC_USE_COUNT
suffix:semicolon
id|up
c_func
(paren
op_amp
id|card-&gt;mutex
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|idt77252_change_qos
id|idt77252_change_qos
c_func
(paren
r_struct
id|atm_vcc
op_star
id|vcc
comma
r_struct
id|atm_qos
op_star
id|qos
comma
r_int
id|flags
)paren
(brace
r_struct
id|atm_dev
op_star
id|dev
op_assign
id|vcc-&gt;dev
suffix:semicolon
r_struct
id|idt77252_dev
op_star
id|card
op_assign
id|dev-&gt;dev_data
suffix:semicolon
r_struct
id|vc_map
op_star
id|vc
op_assign
id|vcc-&gt;dev_data
suffix:semicolon
r_int
id|error
op_assign
l_int|0
suffix:semicolon
id|down
c_func
(paren
op_amp
id|card-&gt;mutex
)paren
suffix:semicolon
r_if
c_cond
(paren
id|qos-&gt;txtp.traffic_class
op_ne
id|ATM_NONE
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|VCF_TX
comma
op_amp
id|vc-&gt;flags
)paren
)paren
(brace
id|error
op_assign
id|idt77252_init_tx
c_func
(paren
id|card
comma
id|vc
comma
id|vcc
comma
id|qos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|out
suffix:semicolon
)brace
r_else
(brace
r_switch
c_cond
(paren
id|qos-&gt;txtp.traffic_class
)paren
(brace
r_case
id|ATM_CBR
suffix:colon
id|error
op_assign
id|idt77252_init_cbr
c_func
(paren
id|card
comma
id|vc
comma
id|vcc
comma
id|qos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|out
suffix:semicolon
r_break
suffix:semicolon
r_case
id|ATM_UBR
suffix:colon
id|error
op_assign
id|idt77252_init_ubr
c_func
(paren
id|card
comma
id|vc
comma
id|vcc
comma
id|qos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|VCF_IDLE
comma
op_amp
id|vc-&gt;flags
)paren
)paren
(brace
id|writel
c_func
(paren
id|TCMDQ_LACR
op_or
(paren
id|vc-&gt;lacr
op_lshift
l_int|16
)paren
op_or
id|vc-&gt;index
comma
id|SAR_REG_TCMDQ
)paren
suffix:semicolon
)brace
r_break
suffix:semicolon
r_case
id|ATM_VBR
suffix:colon
r_case
id|ATM_ABR
suffix:colon
id|error
op_assign
op_minus
id|EOPNOTSUPP
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
(paren
id|qos-&gt;rxtp.traffic_class
op_ne
id|ATM_NONE
)paren
op_logical_and
op_logical_neg
id|test_bit
c_func
(paren
id|VCF_RX
comma
op_amp
id|vc-&gt;flags
)paren
)paren
(brace
id|error
op_assign
id|idt77252_init_rx
c_func
(paren
id|card
comma
id|vc
comma
id|vcc
comma
id|qos
)paren
suffix:semicolon
r_if
c_cond
(paren
id|error
)paren
r_goto
id|out
suffix:semicolon
)brace
id|memcpy
c_func
(paren
op_amp
id|vcc-&gt;qos
comma
id|qos
comma
r_sizeof
(paren
r_struct
id|atm_qos
)paren
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|ATM_VF_HASQOS
comma
op_amp
id|vcc-&gt;flags
)paren
suffix:semicolon
id|out
suffix:colon
id|up
c_func
(paren
op_amp
id|card-&gt;mutex
)paren
suffix:semicolon
r_return
id|error
suffix:semicolon
)brace
r_static
r_int
DECL|function|idt77252_proc_read
id|idt77252_proc_read
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
comma
id|loff_t
op_star
id|pos
comma
r_char
op_star
id|page
)paren
(brace
r_struct
id|idt77252_dev
op_star
id|card
op_assign
id|dev-&gt;dev_data
suffix:semicolon
r_int
id|i
comma
id|left
suffix:semicolon
id|left
op_assign
(paren
r_int
)paren
op_star
id|pos
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;IDT77252 Interrupts:&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;TSIF:  %u&bslash;n&quot;
comma
id|card-&gt;irqstat
(braket
l_int|15
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;TXICP: %u&bslash;n&quot;
comma
id|card-&gt;irqstat
(braket
l_int|14
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;TSQF:  %u&bslash;n&quot;
comma
id|card-&gt;irqstat
(braket
l_int|12
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;TMROF: %u&bslash;n&quot;
comma
id|card-&gt;irqstat
(braket
l_int|11
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;PHYI:  %u&bslash;n&quot;
comma
id|card-&gt;irqstat
(braket
l_int|10
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;FBQ3A: %u&bslash;n&quot;
comma
id|card-&gt;irqstat
(braket
l_int|8
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;FBQ2A: %u&bslash;n&quot;
comma
id|card-&gt;irqstat
(braket
l_int|7
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;RSQF:  %u&bslash;n&quot;
comma
id|card-&gt;irqstat
(braket
l_int|6
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;EPDU:  %u&bslash;n&quot;
comma
id|card-&gt;irqstat
(braket
l_int|5
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;RAWCF: %u&bslash;n&quot;
comma
id|card-&gt;irqstat
(braket
l_int|4
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;FBQ1A: %u&bslash;n&quot;
comma
id|card-&gt;irqstat
(braket
l_int|3
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;FBQ0A: %u&bslash;n&quot;
comma
id|card-&gt;irqstat
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;RSQAF: %u&bslash;n&quot;
comma
id|card-&gt;irqstat
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|left
op_decrement
)paren
r_return
id|sprintf
c_func
(paren
id|page
comma
l_string|&quot;IDT77252 Transmit Connection Table:&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|card-&gt;tct_size
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|tct
suffix:semicolon
r_struct
id|atm_vcc
op_star
id|vcc
suffix:semicolon
r_struct
id|vc_map
op_star
id|vc
suffix:semicolon
r_char
op_star
id|p
suffix:semicolon
id|vc
op_assign
id|card-&gt;vcs
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc
)paren
r_continue
suffix:semicolon
id|vcc
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;tx_vcc
)paren
id|vcc
op_assign
id|vc-&gt;tx_vcc
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vcc
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|left
op_decrement
)paren
r_continue
suffix:semicolon
id|p
op_assign
id|page
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;  %4u: %u.%u: &quot;
comma
id|i
comma
id|vcc-&gt;vpi
comma
id|vcc-&gt;vci
)paren
suffix:semicolon
id|tct
op_assign
(paren
r_int
r_int
)paren
(paren
id|card-&gt;tct_base
op_plus
id|i
op_star
id|SAR_SRAM_TCT_SIZE
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|8
suffix:semicolon
id|i
op_increment
)paren
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot; %08x&quot;
comma
id|read_sram
c_func
(paren
id|card
comma
id|tct
op_plus
id|i
)paren
)paren
suffix:semicolon
id|p
op_add_assign
id|sprintf
c_func
(paren
id|p
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|p
op_minus
id|page
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************/
multiline_comment|/*                                                                           */
multiline_comment|/* Interrupt handler                                                         */
multiline_comment|/*                                                                           */
multiline_comment|/*****************************************************************************/
r_static
r_void
DECL|function|idt77252_collect_stat
id|idt77252_collect_stat
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
)paren
(brace
id|u32
id|cdc
comma
id|vpec
comma
id|icc
suffix:semicolon
id|cdc
op_assign
id|readl
c_func
(paren
id|SAR_REG_CDC
)paren
suffix:semicolon
id|vpec
op_assign
id|readl
c_func
(paren
id|SAR_REG_VPEC
)paren
suffix:semicolon
id|icc
op_assign
id|readl
c_func
(paren
id|SAR_REG_ICC
)paren
suffix:semicolon
macro_line|#ifdef&t;NOTDEF
id|printk
c_func
(paren
l_string|&quot;%s:&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cdc
op_amp
l_int|0x7f0000
)paren
(brace
r_char
op_star
id|s
op_assign
l_string|&quot;&quot;
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot; [&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cdc
op_amp
(paren
l_int|1
op_lshift
l_int|22
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%sRM ID&quot;
comma
id|s
)paren
suffix:semicolon
id|s
op_assign
l_string|&quot; | &quot;
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cdc
op_amp
(paren
l_int|1
op_lshift
l_int|21
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%sCON TAB&quot;
comma
id|s
)paren
suffix:semicolon
id|s
op_assign
l_string|&quot; | &quot;
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cdc
op_amp
(paren
l_int|1
op_lshift
l_int|20
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%sNO FB&quot;
comma
id|s
)paren
suffix:semicolon
id|s
op_assign
l_string|&quot; | &quot;
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cdc
op_amp
(paren
l_int|1
op_lshift
l_int|19
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%sOAM CRC&quot;
comma
id|s
)paren
suffix:semicolon
id|s
op_assign
l_string|&quot; | &quot;
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cdc
op_amp
(paren
l_int|1
op_lshift
l_int|18
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%sRM CRC&quot;
comma
id|s
)paren
suffix:semicolon
id|s
op_assign
l_string|&quot; | &quot;
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cdc
op_amp
(paren
l_int|1
op_lshift
l_int|17
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%sRM FIFO&quot;
comma
id|s
)paren
suffix:semicolon
id|s
op_assign
l_string|&quot; | &quot;
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cdc
op_amp
(paren
l_int|1
op_lshift
l_int|16
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%sRX FIFO&quot;
comma
id|s
)paren
suffix:semicolon
id|s
op_assign
l_string|&quot; | &quot;
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;]&quot;
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot; CDC %04x, VPEC %04x, ICC: %04x&bslash;n&quot;
comma
id|cdc
op_amp
l_int|0xffff
comma
id|vpec
op_amp
l_int|0xffff
comma
id|icc
op_amp
l_int|0xffff
)paren
suffix:semicolon
macro_line|#endif
)brace
r_static
r_void
DECL|function|idt77252_interrupt
id|idt77252_interrupt
c_func
(paren
r_int
id|irq
comma
r_void
op_star
id|dev_id
comma
r_struct
id|pt_regs
op_star
id|ptregs
)paren
(brace
r_struct
id|idt77252_dev
op_star
id|card
op_assign
id|dev_id
suffix:semicolon
id|u32
id|stat
suffix:semicolon
id|stat
op_assign
id|readl
c_func
(paren
id|SAR_REG_STAT
)paren
op_amp
l_int|0xffff
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|stat
)paren
multiline_comment|/* no interrupt for us */
r_return
suffix:semicolon
r_if
c_cond
(paren
id|test_and_set_bit
c_func
(paren
id|IDT77252_BIT_INTERRUPT
comma
op_amp
id|card-&gt;flags
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Re-entering irq_handler()&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|writel
c_func
(paren
id|stat
comma
id|SAR_REG_STAT
)paren
suffix:semicolon
multiline_comment|/* reset interrupt */
r_if
c_cond
(paren
id|stat
op_amp
id|SAR_STAT_TSIF
)paren
(brace
multiline_comment|/* entry written to TSQ  */
id|INTPRINTK
c_func
(paren
l_string|&quot;%s: TSIF&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|card-&gt;irqstat
(braket
l_int|15
)braket
op_increment
suffix:semicolon
id|idt77252_tx
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stat
op_amp
id|SAR_STAT_TXICP
)paren
(brace
multiline_comment|/* Incomplete CS-PDU has  */
id|INTPRINTK
c_func
(paren
l_string|&quot;%s: TXICP&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|card-&gt;irqstat
(braket
l_int|14
)braket
op_increment
suffix:semicolon
macro_line|#ifdef DEBUG
id|idt77252_tx_dump
c_func
(paren
id|card
)paren
suffix:semicolon
macro_line|#endif
)brace
r_if
c_cond
(paren
id|stat
op_amp
id|SAR_STAT_TSQF
)paren
(brace
multiline_comment|/* TSQ 7/8 full           */
id|INTPRINTK
c_func
(paren
l_string|&quot;%s: TSQF&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|card-&gt;irqstat
(braket
l_int|12
)braket
op_increment
suffix:semicolon
id|idt77252_tx
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stat
op_amp
id|SAR_STAT_TMROF
)paren
(brace
multiline_comment|/* Timer overflow         */
id|INTPRINTK
c_func
(paren
l_string|&quot;%s: TMROF&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|card-&gt;irqstat
(braket
l_int|11
)braket
op_increment
suffix:semicolon
id|idt77252_collect_stat
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stat
op_amp
id|SAR_STAT_EPDU
)paren
(brace
multiline_comment|/* Got complete CS-PDU    */
id|INTPRINTK
c_func
(paren
l_string|&quot;%s: EPDU&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|card-&gt;irqstat
(braket
l_int|5
)braket
op_increment
suffix:semicolon
id|idt77252_rx
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stat
op_amp
id|SAR_STAT_RSQAF
)paren
(brace
multiline_comment|/* RSQ is 7/8 full        */
id|INTPRINTK
c_func
(paren
l_string|&quot;%s: RSQAF&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|card-&gt;irqstat
(braket
l_int|1
)braket
op_increment
suffix:semicolon
id|idt77252_rx
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stat
op_amp
id|SAR_STAT_RSQF
)paren
(brace
multiline_comment|/* RSQ is full            */
id|INTPRINTK
c_func
(paren
l_string|&quot;%s: RSQF&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|card-&gt;irqstat
(braket
l_int|6
)braket
op_increment
suffix:semicolon
id|idt77252_rx
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stat
op_amp
id|SAR_STAT_RAWCF
)paren
(brace
multiline_comment|/* Raw cell received      */
id|INTPRINTK
c_func
(paren
l_string|&quot;%s: RAWCF&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|card-&gt;irqstat
(braket
l_int|4
)braket
op_increment
suffix:semicolon
id|idt77252_rx_raw
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stat
op_amp
id|SAR_STAT_PHYI
)paren
(brace
multiline_comment|/* PHY device interrupt   */
id|INTPRINTK
c_func
(paren
l_string|&quot;%s: PHYI&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|card-&gt;irqstat
(braket
l_int|10
)braket
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;atmdev-&gt;phy
op_logical_and
id|card-&gt;atmdev-&gt;phy-&gt;interrupt
)paren
id|card-&gt;atmdev-&gt;phy
op_member_access_from_pointer
id|interrupt
c_func
(paren
id|card-&gt;atmdev
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|stat
op_amp
(paren
id|SAR_STAT_FBQ0A
op_or
id|SAR_STAT_FBQ1A
op_or
id|SAR_STAT_FBQ2A
op_or
id|SAR_STAT_FBQ3A
)paren
)paren
(brace
id|writel
c_func
(paren
id|readl
c_func
(paren
id|SAR_REG_CFG
)paren
op_amp
op_complement
(paren
id|SAR_CFG_FBIE
)paren
comma
id|SAR_REG_CFG
)paren
suffix:semicolon
id|INTPRINTK
c_func
(paren
l_string|&quot;%s: FBQA: %04x&bslash;n&quot;
comma
id|card-&gt;name
comma
id|stat
)paren
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|SAR_STAT_FBQ0A
)paren
id|card-&gt;irqstat
(braket
l_int|2
)braket
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|SAR_STAT_FBQ1A
)paren
id|card-&gt;irqstat
(braket
l_int|3
)braket
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|SAR_STAT_FBQ2A
)paren
id|card-&gt;irqstat
(braket
l_int|7
)braket
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|stat
op_amp
id|SAR_STAT_FBQ3A
)paren
id|card-&gt;irqstat
(braket
l_int|8
)braket
op_increment
suffix:semicolon
id|queue_task
c_func
(paren
op_amp
id|card-&gt;tqueue
comma
op_amp
id|tq_immediate
)paren
suffix:semicolon
id|mark_bh
c_func
(paren
id|IMMEDIATE_BH
)paren
suffix:semicolon
)brace
id|out
suffix:colon
id|clear_bit
c_func
(paren
id|IDT77252_BIT_INTERRUPT
comma
op_amp
id|card-&gt;flags
)paren
suffix:semicolon
)brace
r_static
r_void
DECL|function|idt77252_softint
id|idt77252_softint
c_func
(paren
r_void
op_star
id|dev_id
)paren
(brace
r_struct
id|idt77252_dev
op_star
id|card
op_assign
id|dev_id
suffix:semicolon
id|u32
id|stat
suffix:semicolon
r_int
id|done
suffix:semicolon
r_for
c_loop
(paren
id|done
op_assign
l_int|1
suffix:semicolon
suffix:semicolon
id|done
op_assign
l_int|1
)paren
(brace
id|stat
op_assign
id|readl
c_func
(paren
id|SAR_REG_STAT
)paren
op_rshift
l_int|16
suffix:semicolon
r_if
c_cond
(paren
(paren
id|stat
op_amp
l_int|0x0f
)paren
OL
id|SAR_FBQ0_HIGH
)paren
(brace
id|add_rx_skb
c_func
(paren
id|card
comma
l_int|0
comma
id|SAR_FB_SIZE_0
comma
l_int|32
)paren
suffix:semicolon
id|done
op_assign
l_int|0
suffix:semicolon
)brace
id|stat
op_rshift_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
(paren
id|stat
op_amp
l_int|0x0f
)paren
OL
id|SAR_FBQ1_HIGH
)paren
(brace
id|add_rx_skb
c_func
(paren
id|card
comma
l_int|1
comma
id|SAR_FB_SIZE_1
comma
l_int|32
)paren
suffix:semicolon
id|done
op_assign
l_int|0
suffix:semicolon
)brace
id|stat
op_rshift_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
(paren
id|stat
op_amp
l_int|0x0f
)paren
OL
id|SAR_FBQ2_HIGH
)paren
(brace
id|add_rx_skb
c_func
(paren
id|card
comma
l_int|2
comma
id|SAR_FB_SIZE_2
comma
l_int|32
)paren
suffix:semicolon
id|done
op_assign
l_int|0
suffix:semicolon
)brace
id|stat
op_rshift_assign
l_int|4
suffix:semicolon
r_if
c_cond
(paren
(paren
id|stat
op_amp
l_int|0x0f
)paren
OL
id|SAR_FBQ3_HIGH
)paren
(brace
id|add_rx_skb
c_func
(paren
id|card
comma
l_int|3
comma
id|SAR_FB_SIZE_3
comma
l_int|32
)paren
suffix:semicolon
id|done
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|done
)paren
r_break
suffix:semicolon
)brace
id|writel
c_func
(paren
id|readl
c_func
(paren
id|SAR_REG_CFG
)paren
op_or
id|SAR_CFG_FBIE
comma
id|SAR_REG_CFG
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|open_card_oam
id|open_card_oam
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|addr
suffix:semicolon
r_struct
id|vc_map
op_star
id|vc
suffix:semicolon
r_int
id|vpi
comma
id|vci
suffix:semicolon
r_int
id|index
suffix:semicolon
id|u32
id|rcte
suffix:semicolon
r_for
c_loop
(paren
id|vpi
op_assign
l_int|0
suffix:semicolon
id|vpi
OL
(paren
l_int|1
op_lshift
id|card-&gt;vpibits
)paren
suffix:semicolon
id|vpi
op_increment
)paren
(brace
r_for
c_loop
(paren
id|vci
op_assign
l_int|3
suffix:semicolon
id|vci
OL
l_int|5
suffix:semicolon
id|vci
op_increment
)paren
(brace
id|index
op_assign
id|VPCI2VC
c_func
(paren
id|card
comma
id|vpi
comma
id|vci
)paren
suffix:semicolon
id|vc
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|vc_map
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: can&squot;t alloc vc&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|vc
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|vc_map
)paren
)paren
suffix:semicolon
id|vc-&gt;index
op_assign
id|index
suffix:semicolon
id|card-&gt;vcs
(braket
id|index
)braket
op_assign
id|vc
suffix:semicolon
id|flush_rx_pool
c_func
(paren
id|card
comma
op_amp
id|vc-&gt;rcv.rx_pool
)paren
suffix:semicolon
id|rcte
op_assign
id|SAR_RCTE_CONNECTOPEN
op_or
id|SAR_RCTE_RAWCELLINTEN
op_or
id|SAR_RCTE_RCQ
op_or
id|SAR_RCTE_FBP_1
suffix:semicolon
id|addr
op_assign
id|card-&gt;rct_base
op_plus
(paren
id|vc-&gt;index
op_lshift
l_int|2
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|addr
comma
id|rcte
)paren
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
id|writel
c_func
(paren
id|SAR_CMD_OPEN_CONNECTION
op_or
(paren
id|addr
op_lshift
l_int|2
)paren
comma
id|SAR_REG_CMD
)paren
suffix:semicolon
id|waitfor_idle
c_func
(paren
id|card
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_void
DECL|function|close_card_oam
id|close_card_oam
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
)paren
(brace
r_int
r_int
id|flags
suffix:semicolon
r_int
r_int
id|addr
suffix:semicolon
r_struct
id|vc_map
op_star
id|vc
suffix:semicolon
r_int
id|vpi
comma
id|vci
suffix:semicolon
r_int
id|index
suffix:semicolon
r_for
c_loop
(paren
id|vpi
op_assign
l_int|0
suffix:semicolon
id|vpi
OL
(paren
l_int|1
op_lshift
id|card-&gt;vpibits
)paren
suffix:semicolon
id|vpi
op_increment
)paren
(brace
r_for
c_loop
(paren
id|vci
op_assign
l_int|3
suffix:semicolon
id|vci
OL
l_int|5
suffix:semicolon
id|vci
op_increment
)paren
(brace
id|index
op_assign
id|VPCI2VC
c_func
(paren
id|card
comma
id|vpi
comma
id|vci
)paren
suffix:semicolon
id|vc
op_assign
id|card-&gt;vcs
(braket
id|index
)braket
suffix:semicolon
id|addr
op_assign
id|card-&gt;rct_base
op_plus
id|vc-&gt;index
op_star
id|SAR_SRAM_RCT_SIZE
suffix:semicolon
id|spin_lock_irqsave
c_func
(paren
op_amp
id|card-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
id|writel
c_func
(paren
id|SAR_CMD_CLOSE_CONNECTION
op_or
(paren
id|addr
op_lshift
l_int|2
)paren
comma
id|SAR_REG_CMD
)paren
suffix:semicolon
id|waitfor_idle
c_func
(paren
id|card
)paren
suffix:semicolon
id|spin_unlock_irqrestore
c_func
(paren
op_amp
id|card-&gt;cmd_lock
comma
id|flags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|vc-&gt;rcv.rx_pool.count
)paren
(brace
id|DPRINTK
c_func
(paren
l_string|&quot;%s: closing a VC &quot;
l_string|&quot;with pending rx buffers.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|recycle_rx_pool_skb
c_func
(paren
id|card
comma
op_amp
id|vc-&gt;rcv.rx_pool
)paren
suffix:semicolon
)brace
)brace
)brace
)brace
r_static
r_int
DECL|function|open_card_ubr0
id|open_card_ubr0
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
)paren
(brace
r_struct
id|vc_map
op_star
id|vc
suffix:semicolon
id|vc
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|vc_map
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: can&squot;t alloc vc&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|memset
c_func
(paren
id|vc
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|vc_map
)paren
)paren
suffix:semicolon
id|card-&gt;vcs
(braket
l_int|0
)braket
op_assign
id|vc
suffix:semicolon
id|vc
op_member_access_from_pointer
r_class
op_assign
id|SCHED_UBR0
suffix:semicolon
id|vc-&gt;scq
op_assign
id|alloc_scq
c_func
(paren
id|card
comma
id|vc
op_member_access_from_pointer
r_class
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|vc-&gt;scq
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: can&squot;t get SCQ.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
id|ENOMEM
suffix:semicolon
)brace
id|card-&gt;scd2vc
(braket
l_int|0
)braket
op_assign
id|vc
suffix:semicolon
id|vc-&gt;scd_index
op_assign
l_int|0
suffix:semicolon
id|vc-&gt;scq-&gt;scd
op_assign
id|card-&gt;scd_base
suffix:semicolon
id|fill_scd
c_func
(paren
id|card
comma
id|vc-&gt;scq
comma
id|vc
op_member_access_from_pointer
r_class
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|card-&gt;tct_base
op_plus
l_int|0
comma
id|TCT_UBR
op_or
id|card-&gt;scd_base
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|card-&gt;tct_base
op_plus
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|card-&gt;tct_base
op_plus
l_int|2
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|card-&gt;tct_base
op_plus
l_int|3
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|card-&gt;tct_base
op_plus
l_int|4
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|card-&gt;tct_base
op_plus
l_int|5
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|card-&gt;tct_base
op_plus
l_int|6
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|card-&gt;tct_base
op_plus
l_int|7
comma
id|TCT_FLAG_UBR
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|VCF_IDLE
comma
op_amp
id|vc-&gt;flags
)paren
suffix:semicolon
id|writel
c_func
(paren
id|TCMDQ_START
op_or
l_int|0
comma
id|SAR_REG_TCMDQ
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|idt77252_dev_open
id|idt77252_dev_open
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
)paren
(brace
id|u32
id|conf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|IDT77252_BIT_INIT
comma
op_amp
id|card-&gt;flags
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: SAR not yet initialized.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|conf
op_assign
id|SAR_CFG_RXPTH
op_or
multiline_comment|/* enable receive path                  */
id|SAR_RX_DELAY
op_or
multiline_comment|/* interrupt on complete PDU&t;&t;*/
id|SAR_CFG_RAWIE
op_or
multiline_comment|/* interrupt enable on raw cells        */
id|SAR_CFG_RQFIE
op_or
multiline_comment|/* interrupt on RSQ almost full         */
id|SAR_CFG_TMOIE
op_or
multiline_comment|/* interrupt on timer overflow          */
id|SAR_CFG_FBIE
op_or
multiline_comment|/* interrupt on low free buffers        */
id|SAR_CFG_TXEN
op_or
multiline_comment|/* transmit operation enable            */
id|SAR_CFG_TXINT
op_or
multiline_comment|/* interrupt on transmit status         */
id|SAR_CFG_TXUIE
op_or
multiline_comment|/* interrupt on transmit underrun       */
id|SAR_CFG_TXSFI
op_or
multiline_comment|/* interrupt on TSQ almost full         */
id|SAR_CFG_PHYIE
multiline_comment|/* enable PHY interrupts&t;&t;*/
suffix:semicolon
macro_line|#ifdef CONFIG_ATM_IDT77252_RCV_ALL
multiline_comment|/* Test RAW cell receive. */
id|conf
op_or_assign
id|SAR_CFG_VPECA
suffix:semicolon
macro_line|#endif
id|writel
c_func
(paren
id|readl
c_func
(paren
id|SAR_REG_CFG
)paren
op_or
id|conf
comma
id|SAR_REG_CFG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|open_card_oam
c_func
(paren
id|card
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Error initializing OAM.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|open_card_ubr0
c_func
(paren
id|card
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: Error initializing UBR0.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|IPRINTK
c_func
(paren
l_string|&quot;%s: opened IDT77252 ABR SAR.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|idt77252_dev_close
id|idt77252_dev_close
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
)paren
(brace
r_struct
id|idt77252_dev
op_star
id|card
op_assign
id|dev-&gt;dev_data
suffix:semicolon
id|u32
id|conf
suffix:semicolon
id|close_card_oam
c_func
(paren
id|card
)paren
suffix:semicolon
id|conf
op_assign
id|SAR_CFG_RXPTH
op_or
multiline_comment|/* enable receive path           */
id|SAR_RX_DELAY
op_or
multiline_comment|/* interrupt on complete PDU     */
id|SAR_CFG_RAWIE
op_or
multiline_comment|/* interrupt enable on raw cells */
id|SAR_CFG_RQFIE
op_or
multiline_comment|/* interrupt on RSQ almost full  */
id|SAR_CFG_TMOIE
op_or
multiline_comment|/* interrupt on timer overflow   */
id|SAR_CFG_FBIE
op_or
multiline_comment|/* interrupt on low free buffers */
id|SAR_CFG_TXEN
op_or
multiline_comment|/* transmit operation enable     */
id|SAR_CFG_TXINT
op_or
multiline_comment|/* interrupt on transmit status  */
id|SAR_CFG_TXUIE
op_or
multiline_comment|/* interrupt on xmit underrun    */
id|SAR_CFG_TXSFI
multiline_comment|/* interrupt on TSQ almost full  */
suffix:semicolon
id|writel
c_func
(paren
id|readl
c_func
(paren
id|SAR_REG_CFG
)paren
op_amp
op_complement
(paren
id|conf
)paren
comma
id|SAR_REG_CFG
)paren
suffix:semicolon
id|DIPRINTK
c_func
(paren
l_string|&quot;%s: closed IDT77252 ABR SAR.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************/
multiline_comment|/*                                                                           */
multiline_comment|/* Initialisation and Deinitialization of IDT77252                           */
multiline_comment|/*                                                                           */
multiline_comment|/*****************************************************************************/
r_static
r_void
DECL|function|deinit_card
id|deinit_card
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
)paren
(brace
r_struct
id|sk_buff
op_star
id|skb
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|test_bit
c_func
(paren
id|IDT77252_BIT_INIT
comma
op_amp
id|card-&gt;flags
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: SAR not yet initialized.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|DIPRINTK
c_func
(paren
l_string|&quot;idt77252: deinitialize card %u&bslash;n&quot;
comma
id|card-&gt;index
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|SAR_REG_CFG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;atmdev
)paren
id|atm_dev_deregister
c_func
(paren
id|card-&gt;atmdev
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|FBQ_SIZE
suffix:semicolon
id|j
op_increment
)paren
(brace
id|skb
op_assign
id|card-&gt;sbpool
(braket
id|i
)braket
dot
id|skb
(braket
id|j
)braket
suffix:semicolon
r_if
c_cond
(paren
id|skb
)paren
(brace
id|pci_unmap_single
c_func
(paren
id|card-&gt;pcidev
comma
id|IDT77252_PRV_PADDR
c_func
(paren
id|skb
)paren
comma
id|skb-&gt;end
op_minus
id|skb-&gt;data
comma
id|PCI_DMA_FROMDEVICE
)paren
suffix:semicolon
id|card-&gt;sbpool
(braket
id|i
)braket
dot
id|skb
(braket
id|j
)braket
op_assign
l_int|NULL
suffix:semicolon
id|dev_kfree_skb
c_func
(paren
id|skb
)paren
suffix:semicolon
)brace
)brace
)brace
r_if
c_cond
(paren
id|card-&gt;soft_tst
)paren
id|vfree
c_func
(paren
id|card-&gt;soft_tst
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;scd2vc
)paren
id|vfree
c_func
(paren
id|card-&gt;scd2vc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;vcs
)paren
id|vfree
c_func
(paren
id|card-&gt;vcs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;raw_cell_hnd
)paren
(brace
id|pci_free_consistent
c_func
(paren
id|card-&gt;pcidev
comma
l_int|2
op_star
r_sizeof
(paren
id|u32
)paren
comma
id|card-&gt;raw_cell_hnd
comma
id|card-&gt;raw_cell_paddr
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;rsq.base
)paren
(brace
id|DIPRINTK
c_func
(paren
l_string|&quot;%s: Release RSQ ...&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|deinit_rsq
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;tsq.base
)paren
(brace
id|DIPRINTK
c_func
(paren
l_string|&quot;%s: Release TSQ ...&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|deinit_tsq
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
id|DIPRINTK
c_func
(paren
l_string|&quot;idt77252: Release IRQ.&bslash;n&quot;
)paren
suffix:semicolon
id|free_irq
c_func
(paren
id|card-&gt;pcidev-&gt;irq
comma
id|card
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|card-&gt;fbq
(braket
id|i
)braket
)paren
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|card-&gt;fbq
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|card-&gt;membase
)paren
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|card-&gt;membase
)paren
suffix:semicolon
id|clear_bit
c_func
(paren
id|IDT77252_BIT_INIT
comma
op_amp
id|card-&gt;flags
)paren
suffix:semicolon
id|DIPRINTK
c_func
(paren
l_string|&quot;%s: Card deinitialized.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
)brace
r_static
r_int
DECL|function|init_sram
id|init_sram
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|card-&gt;sramsize
suffix:semicolon
id|i
op_add_assign
l_int|4
)paren
id|write_sram
c_func
(paren
id|card
comma
(paren
id|i
op_rshift
l_int|2
)paren
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* set SRAM layout for THIS card */
r_if
c_cond
(paren
id|card-&gt;sramsize
op_eq
(paren
l_int|512
op_star
l_int|1024
)paren
)paren
(brace
id|card-&gt;tct_base
op_assign
id|SAR_SRAM_TCT_128_BASE
suffix:semicolon
id|card-&gt;tct_size
op_assign
(paren
id|SAR_SRAM_TCT_128_TOP
op_minus
id|card-&gt;tct_base
op_plus
l_int|1
)paren
op_div
id|SAR_SRAM_TCT_SIZE
suffix:semicolon
id|card-&gt;rct_base
op_assign
id|SAR_SRAM_RCT_128_BASE
suffix:semicolon
id|card-&gt;rct_size
op_assign
(paren
id|SAR_SRAM_RCT_128_TOP
op_minus
id|card-&gt;rct_base
op_plus
l_int|1
)paren
op_div
id|SAR_SRAM_RCT_SIZE
suffix:semicolon
id|card-&gt;rt_base
op_assign
id|SAR_SRAM_RT_128_BASE
suffix:semicolon
id|card-&gt;scd_base
op_assign
id|SAR_SRAM_SCD_128_BASE
suffix:semicolon
id|card-&gt;scd_size
op_assign
(paren
id|SAR_SRAM_SCD_128_TOP
op_minus
id|card-&gt;scd_base
op_plus
l_int|1
)paren
op_div
id|SAR_SRAM_SCD_SIZE
suffix:semicolon
id|card-&gt;tst
(braket
l_int|0
)braket
op_assign
id|SAR_SRAM_TST1_128_BASE
suffix:semicolon
id|card-&gt;tst
(braket
l_int|1
)braket
op_assign
id|SAR_SRAM_TST2_128_BASE
suffix:semicolon
id|card-&gt;tst_size
op_assign
id|SAR_SRAM_TST1_128_TOP
op_minus
id|card-&gt;tst
(braket
l_int|0
)braket
op_plus
l_int|1
suffix:semicolon
id|card-&gt;abrst_base
op_assign
id|SAR_SRAM_ABRSTD_128_BASE
suffix:semicolon
id|card-&gt;abrst_size
op_assign
id|SAR_ABRSTD_SIZE_8K
suffix:semicolon
id|card-&gt;fifo_base
op_assign
id|SAR_SRAM_FIFO_128_BASE
suffix:semicolon
id|card-&gt;fifo_size
op_assign
id|SAR_RXFD_SIZE_32K
suffix:semicolon
)brace
r_else
(brace
id|card-&gt;tct_base
op_assign
id|SAR_SRAM_TCT_32_BASE
suffix:semicolon
id|card-&gt;tct_size
op_assign
(paren
id|SAR_SRAM_TCT_32_TOP
op_minus
id|card-&gt;tct_base
op_plus
l_int|1
)paren
op_div
id|SAR_SRAM_TCT_SIZE
suffix:semicolon
id|card-&gt;rct_base
op_assign
id|SAR_SRAM_RCT_32_BASE
suffix:semicolon
id|card-&gt;rct_size
op_assign
(paren
id|SAR_SRAM_RCT_32_TOP
op_minus
id|card-&gt;rct_base
op_plus
l_int|1
)paren
op_div
id|SAR_SRAM_RCT_SIZE
suffix:semicolon
id|card-&gt;rt_base
op_assign
id|SAR_SRAM_RT_32_BASE
suffix:semicolon
id|card-&gt;scd_base
op_assign
id|SAR_SRAM_SCD_32_BASE
suffix:semicolon
id|card-&gt;scd_size
op_assign
(paren
id|SAR_SRAM_SCD_32_TOP
op_minus
id|card-&gt;scd_base
op_plus
l_int|1
)paren
op_div
id|SAR_SRAM_SCD_SIZE
suffix:semicolon
id|card-&gt;tst
(braket
l_int|0
)braket
op_assign
id|SAR_SRAM_TST1_32_BASE
suffix:semicolon
id|card-&gt;tst
(braket
l_int|1
)braket
op_assign
id|SAR_SRAM_TST2_32_BASE
suffix:semicolon
id|card-&gt;tst_size
op_assign
(paren
id|SAR_SRAM_TST1_32_TOP
op_minus
id|card-&gt;tst
(braket
l_int|0
)braket
op_plus
l_int|1
)paren
suffix:semicolon
id|card-&gt;abrst_base
op_assign
id|SAR_SRAM_ABRSTD_32_BASE
suffix:semicolon
id|card-&gt;abrst_size
op_assign
id|SAR_ABRSTD_SIZE_1K
suffix:semicolon
id|card-&gt;fifo_base
op_assign
id|SAR_SRAM_FIFO_32_BASE
suffix:semicolon
id|card-&gt;fifo_size
op_assign
id|SAR_RXFD_SIZE_4K
suffix:semicolon
)brace
multiline_comment|/* Initialize TCT */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|card-&gt;tct_size
suffix:semicolon
id|i
op_increment
)paren
(brace
id|write_sram
c_func
(paren
id|card
comma
id|i
op_star
id|SAR_SRAM_TCT_SIZE
op_plus
l_int|0
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|i
op_star
id|SAR_SRAM_TCT_SIZE
op_plus
l_int|1
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|i
op_star
id|SAR_SRAM_TCT_SIZE
op_plus
l_int|2
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|i
op_star
id|SAR_SRAM_TCT_SIZE
op_plus
l_int|3
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|i
op_star
id|SAR_SRAM_TCT_SIZE
op_plus
l_int|4
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|i
op_star
id|SAR_SRAM_TCT_SIZE
op_plus
l_int|5
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|i
op_star
id|SAR_SRAM_TCT_SIZE
op_plus
l_int|6
comma
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|i
op_star
id|SAR_SRAM_TCT_SIZE
op_plus
l_int|7
comma
l_int|0
)paren
suffix:semicolon
)brace
multiline_comment|/* Initialize RCT */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|card-&gt;rct_size
suffix:semicolon
id|i
op_increment
)paren
(brace
id|write_sram
c_func
(paren
id|card
comma
id|card-&gt;rct_base
op_plus
id|i
op_star
id|SAR_SRAM_RCT_SIZE
comma
(paren
id|u32
)paren
id|SAR_RCTE_RAWCELLINTEN
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|card-&gt;rct_base
op_plus
id|i
op_star
id|SAR_SRAM_RCT_SIZE
op_plus
l_int|1
comma
(paren
id|u32
)paren
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|card-&gt;rct_base
op_plus
id|i
op_star
id|SAR_SRAM_RCT_SIZE
op_plus
l_int|2
comma
(paren
id|u32
)paren
l_int|0
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|card-&gt;rct_base
op_plus
id|i
op_star
id|SAR_SRAM_RCT_SIZE
op_plus
l_int|3
comma
(paren
id|u32
)paren
l_int|0xffffffff
)paren
suffix:semicolon
)brace
id|writel
c_func
(paren
(paren
id|SAR_FBQ0_LOW
op_lshift
l_int|28
)paren
op_or
l_int|0x00000000
op_or
l_int|0x00000000
op_or
(paren
id|SAR_FB_SIZE_0
op_div
l_int|48
)paren
comma
id|SAR_REG_FBQS0
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
id|SAR_FBQ1_LOW
op_lshift
l_int|28
)paren
op_or
l_int|0x00000000
op_or
l_int|0x00000000
op_or
(paren
id|SAR_FB_SIZE_1
op_div
l_int|48
)paren
comma
id|SAR_REG_FBQS1
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
id|SAR_FBQ2_LOW
op_lshift
l_int|28
)paren
op_or
l_int|0x00000000
op_or
l_int|0x00000000
op_or
(paren
id|SAR_FB_SIZE_2
op_div
l_int|48
)paren
comma
id|SAR_REG_FBQS2
)paren
suffix:semicolon
id|writel
c_func
(paren
(paren
id|SAR_FBQ3_LOW
op_lshift
l_int|28
)paren
op_or
l_int|0x00000000
op_or
l_int|0x00000000
op_or
(paren
id|SAR_FB_SIZE_3
op_div
l_int|48
)paren
comma
id|SAR_REG_FBQS3
)paren
suffix:semicolon
multiline_comment|/* Initialize rate table  */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
(brace
id|write_sram
c_func
(paren
id|card
comma
id|card-&gt;rt_base
op_plus
id|i
comma
id|log_to_rate
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|128
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
id|tmp
op_assign
id|rate_to_log
(braket
(paren
id|i
op_lshift
l_int|2
)paren
op_plus
l_int|0
)braket
op_lshift
l_int|0
suffix:semicolon
id|tmp
op_or_assign
id|rate_to_log
(braket
(paren
id|i
op_lshift
l_int|2
)paren
op_plus
l_int|1
)braket
op_lshift
l_int|8
suffix:semicolon
id|tmp
op_or_assign
id|rate_to_log
(braket
(paren
id|i
op_lshift
l_int|2
)paren
op_plus
l_int|2
)braket
op_lshift
l_int|16
suffix:semicolon
id|tmp
op_or_assign
id|rate_to_log
(braket
(paren
id|i
op_lshift
l_int|2
)paren
op_plus
l_int|3
)braket
op_lshift
l_int|24
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|card-&gt;rt_base
op_plus
l_int|256
op_plus
id|i
comma
id|tmp
)paren
suffix:semicolon
)brace
macro_line|#if 0 /* Fill RDF and AIR tables. */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|128
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
id|tmp
op_assign
id|RDF
(braket
l_int|0
)braket
(braket
(paren
id|i
op_lshift
l_int|1
)paren
op_plus
l_int|0
)braket
op_lshift
l_int|16
suffix:semicolon
id|tmp
op_or_assign
id|RDF
(braket
l_int|0
)braket
(braket
(paren
id|i
op_lshift
l_int|1
)paren
op_plus
l_int|1
)braket
op_lshift
l_int|0
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|card-&gt;rt_base
op_plus
l_int|512
op_plus
id|i
comma
id|tmp
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|128
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
r_int
id|tmp
suffix:semicolon
id|tmp
op_assign
id|AIR
(braket
l_int|0
)braket
(braket
(paren
id|i
op_lshift
l_int|1
)paren
op_plus
l_int|0
)braket
op_lshift
l_int|16
suffix:semicolon
id|tmp
op_or_assign
id|AIR
(braket
l_int|0
)braket
(braket
(paren
id|i
op_lshift
l_int|1
)paren
op_plus
l_int|1
)braket
op_lshift
l_int|0
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|card-&gt;rt_base
op_plus
l_int|640
op_plus
id|i
comma
id|tmp
)paren
suffix:semicolon
)brace
macro_line|#endif
id|IPRINTK
c_func
(paren
l_string|&quot;%s: initialize rate table ...&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|writel
c_func
(paren
id|card-&gt;rt_base
op_lshift
l_int|2
comma
id|SAR_REG_RTBL
)paren
suffix:semicolon
multiline_comment|/* Initialize TSTs */
id|IPRINTK
c_func
(paren
l_string|&quot;%s: initialize TST ...&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|card-&gt;tst_free
op_assign
id|card-&gt;tst_size
op_minus
l_int|2
suffix:semicolon
multiline_comment|/* last two are jumps */
r_for
c_loop
(paren
id|i
op_assign
id|card-&gt;tst
(braket
l_int|0
)braket
suffix:semicolon
id|i
OL
id|card-&gt;tst
(braket
l_int|0
)braket
op_plus
id|card-&gt;tst_size
op_minus
l_int|2
suffix:semicolon
id|i
op_increment
)paren
id|write_sram
c_func
(paren
id|card
comma
id|i
comma
id|TSTE_OPC_VAR
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|i
op_increment
comma
id|TSTE_OPC_JMP
op_or
(paren
id|card-&gt;tst
(braket
l_int|0
)braket
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|idt77252_sram_write_errors
op_assign
l_int|1
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|i
op_increment
comma
id|TSTE_OPC_JMP
op_or
(paren
id|card-&gt;tst
(braket
l_int|1
)braket
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|idt77252_sram_write_errors
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|card-&gt;tst
(braket
l_int|1
)braket
suffix:semicolon
id|i
OL
id|card-&gt;tst
(braket
l_int|1
)braket
op_plus
id|card-&gt;tst_size
op_minus
l_int|2
suffix:semicolon
id|i
op_increment
)paren
id|write_sram
c_func
(paren
id|card
comma
id|i
comma
id|TSTE_OPC_VAR
)paren
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|i
op_increment
comma
id|TSTE_OPC_JMP
op_or
(paren
id|card-&gt;tst
(braket
l_int|1
)braket
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|idt77252_sram_write_errors
op_assign
l_int|1
suffix:semicolon
id|write_sram
c_func
(paren
id|card
comma
id|i
op_increment
comma
id|TSTE_OPC_JMP
op_or
(paren
id|card-&gt;tst
(braket
l_int|0
)braket
op_lshift
l_int|2
)paren
)paren
suffix:semicolon
id|idt77252_sram_write_errors
op_assign
l_int|0
suffix:semicolon
id|card-&gt;tst_index
op_assign
l_int|0
suffix:semicolon
id|writel
c_func
(paren
id|card-&gt;tst
(braket
l_int|0
)braket
op_lshift
l_int|2
comma
id|SAR_REG_TSTB
)paren
suffix:semicolon
multiline_comment|/* Initialize ABRSTD and Receive FIFO */
id|IPRINTK
c_func
(paren
l_string|&quot;%s: initialize ABRSTD ...&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|writel
c_func
(paren
id|card-&gt;abrst_size
op_or
(paren
id|card-&gt;abrst_base
op_lshift
l_int|2
)paren
comma
id|SAR_REG_ABRSTD
)paren
suffix:semicolon
id|IPRINTK
c_func
(paren
l_string|&quot;%s: initialize receive fifo ...&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|writel
c_func
(paren
id|card-&gt;fifo_size
op_or
(paren
id|card-&gt;fifo_base
op_lshift
l_int|2
)paren
comma
id|SAR_REG_RXFD
)paren
suffix:semicolon
id|IPRINTK
c_func
(paren
l_string|&quot;%s: SRAM initialization complete.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_static
r_int
DECL|function|init_card
id|init_card
c_func
(paren
r_struct
id|atm_dev
op_star
id|dev
)paren
(brace
r_struct
id|idt77252_dev
op_star
id|card
op_assign
id|dev-&gt;dev_data
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pcidev
op_assign
id|card-&gt;pcidev
suffix:semicolon
r_int
r_int
id|tmpl
comma
id|modl
suffix:semicolon
r_int
r_int
id|linkrate
comma
id|rsvdcr
suffix:semicolon
r_int
r_int
id|tst_entries
suffix:semicolon
r_struct
id|net_device
op_star
id|tmp
suffix:semicolon
r_char
id|tname
(braket
l_int|10
)braket
suffix:semicolon
id|u32
id|size
suffix:semicolon
id|u_char
id|pci_byte
suffix:semicolon
id|u32
id|conf
suffix:semicolon
r_int
id|i
comma
id|k
suffix:semicolon
r_if
c_cond
(paren
id|test_bit
c_func
(paren
id|IDT77252_BIT_INIT
comma
op_amp
id|card-&gt;flags
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;Error: SAR already initialized.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*****************************************************************/
multiline_comment|/*   P C I   C O N F I G U R A T I O N                           */
multiline_comment|/*****************************************************************/
multiline_comment|/* Set PCI Retry-Timeout and TRDY timeout */
id|IPRINTK
c_func
(paren
l_string|&quot;%s: Checking PCI retries.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_read_config_byte
c_func
(paren
id|pcidev
comma
l_int|0x40
comma
op_amp
id|pci_byte
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: can&squot;t read PCI retry timeout.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|deinit_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_byte
op_ne
l_int|0
)paren
(brace
id|IPRINTK
c_func
(paren
l_string|&quot;%s: PCI retry timeout: %d, set to 0.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|pci_byte
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_write_config_byte
c_func
(paren
id|pcidev
comma
l_int|0x40
comma
l_int|0
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: can&squot;t set PCI retry timeout.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|deinit_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
id|IPRINTK
c_func
(paren
l_string|&quot;%s: Checking PCI TRDY.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_read_config_byte
c_func
(paren
id|pcidev
comma
l_int|0x41
comma
op_amp
id|pci_byte
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: can&squot;t read PCI TRDY timeout.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|deinit_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|pci_byte
op_ne
l_int|0
)paren
(brace
id|IPRINTK
c_func
(paren
l_string|&quot;%s: PCI TRDY timeout: %d, set to 0.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|pci_byte
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_write_config_byte
c_func
(paren
id|pcidev
comma
l_int|0x41
comma
l_int|0
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: can&squot;t set PCI TRDY timeout.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|deinit_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
)brace
multiline_comment|/* Reset Timer register */
r_if
c_cond
(paren
id|readl
c_func
(paren
id|SAR_REG_STAT
)paren
op_amp
id|SAR_STAT_TMROF
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: resetting timer overflow.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|writel
c_func
(paren
id|SAR_STAT_TMROF
comma
id|SAR_REG_STAT
)paren
suffix:semicolon
)brace
id|IPRINTK
c_func
(paren
l_string|&quot;%s: Request IRQ ... &quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|request_irq
c_func
(paren
id|pcidev-&gt;irq
comma
id|idt77252_interrupt
comma
id|SA_INTERRUPT
op_or
id|SA_SHIRQ
comma
id|card-&gt;name
comma
id|card
)paren
op_ne
l_int|0
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: can&squot;t allocate IRQ.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|deinit_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|IPRINTK
c_func
(paren
l_string|&quot;got %d.&bslash;n&quot;
comma
id|pcidev-&gt;irq
)paren
suffix:semicolon
multiline_comment|/*****************************************************************/
multiline_comment|/*   C H E C K   A N D   I N I T   S R A M                       */
multiline_comment|/*****************************************************************/
id|IPRINTK
c_func
(paren
l_string|&quot;%s: Initializing SRAM&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
multiline_comment|/* preset size of connecton table, so that init_sram() knows about it */
id|conf
op_assign
id|SAR_CFG_TX_FIFO_SIZE_9
op_or
multiline_comment|/* Use maximum fifo size */
id|SAR_CFG_RXSTQ_SIZE_8k
op_or
multiline_comment|/* Receive Status Queue is 8k */
id|SAR_CFG_IDLE_CLP
op_or
multiline_comment|/* Set CLP on idle cells */
macro_line|#ifndef CONFIG_ATM_IDT77252_SEND_IDLE
id|SAR_CFG_NO_IDLE
op_or
multiline_comment|/* Do not send idle cells */
macro_line|#endif
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;sramsize
op_eq
(paren
l_int|512
op_star
l_int|1024
)paren
)paren
id|conf
op_or_assign
id|SAR_CFG_CNTBL_1k
suffix:semicolon
r_else
id|conf
op_or_assign
id|SAR_CFG_CNTBL_512
suffix:semicolon
r_switch
c_cond
(paren
id|vpibits
)paren
(brace
r_case
l_int|0
suffix:colon
id|conf
op_or_assign
id|SAR_CFG_VPVCS_0
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
r_case
l_int|1
suffix:colon
id|conf
op_or_assign
id|SAR_CFG_VPVCS_1
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|2
suffix:colon
id|conf
op_or_assign
id|SAR_CFG_VPVCS_2
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|8
suffix:colon
id|conf
op_or_assign
id|SAR_CFG_VPVCS_8
suffix:semicolon
r_break
suffix:semicolon
)brace
id|writel
c_func
(paren
id|readl
c_func
(paren
id|SAR_REG_CFG
)paren
op_or
id|conf
comma
id|SAR_REG_CFG
)paren
suffix:semicolon
r_if
c_cond
(paren
id|init_sram
c_func
(paren
id|card
)paren
OL
l_int|0
)paren
r_return
op_minus
l_int|1
suffix:semicolon
multiline_comment|/********************************************************************/
multiline_comment|/*  A L L O C   R A M   A N D   S E T   V A R I O U S   T H I N G S */
multiline_comment|/********************************************************************/
multiline_comment|/* Initialize TSQ */
r_if
c_cond
(paren
l_int|0
op_ne
id|init_tsq
c_func
(paren
id|card
)paren
)paren
(brace
id|deinit_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/* Initialize RSQ */
r_if
c_cond
(paren
l_int|0
op_ne
id|init_rsq
c_func
(paren
id|card
)paren
)paren
(brace
id|deinit_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|card-&gt;vpibits
op_assign
id|vpibits
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;sramsize
op_eq
(paren
l_int|512
op_star
l_int|1024
)paren
)paren
(brace
id|card-&gt;vcibits
op_assign
l_int|10
op_minus
id|card-&gt;vpibits
suffix:semicolon
)brace
r_else
(brace
id|card-&gt;vcibits
op_assign
l_int|9
op_minus
id|card-&gt;vpibits
suffix:semicolon
)brace
id|card-&gt;vcimask
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|k
op_assign
l_int|0
comma
id|i
op_assign
l_int|1
suffix:semicolon
id|k
OL
id|card-&gt;vcibits
suffix:semicolon
id|k
op_increment
)paren
(brace
id|card-&gt;vcimask
op_or_assign
id|i
suffix:semicolon
id|i
op_lshift_assign
l_int|1
suffix:semicolon
)brace
id|IPRINTK
c_func
(paren
l_string|&quot;%s: Setting VPI/VCI mask to zero.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|SAR_REG_VPM
)paren
suffix:semicolon
multiline_comment|/* Little Endian Order   */
id|writel
c_func
(paren
l_int|0
comma
id|SAR_REG_GP
)paren
suffix:semicolon
multiline_comment|/* Initialize RAW Cell Handle Register  */
id|card-&gt;raw_cell_hnd
op_assign
id|pci_alloc_consistent
c_func
(paren
id|card-&gt;pcidev
comma
l_int|2
op_star
r_sizeof
(paren
id|u32
)paren
comma
op_amp
id|card-&gt;raw_cell_paddr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;raw_cell_hnd
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: memory allocation failure.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|deinit_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|memset
c_func
(paren
id|card-&gt;raw_cell_hnd
comma
l_int|0
comma
l_int|2
op_star
r_sizeof
(paren
id|u32
)paren
)paren
suffix:semicolon
id|writel
c_func
(paren
id|card-&gt;raw_cell_paddr
comma
id|SAR_REG_RAWHND
)paren
suffix:semicolon
id|IPRINTK
c_func
(paren
l_string|&quot;%s: raw cell handle is at 0x%p.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|card-&gt;raw_cell_hnd
)paren
suffix:semicolon
id|size
op_assign
r_sizeof
(paren
r_struct
id|vc_map
op_star
)paren
op_star
id|card-&gt;tct_size
suffix:semicolon
id|IPRINTK
c_func
(paren
l_string|&quot;%s: allocate %d byte for VC map.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
(paren
id|card-&gt;vcs
op_assign
id|vmalloc
c_func
(paren
id|size
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: memory allocation failure.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|deinit_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|memset
c_func
(paren
id|card-&gt;vcs
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
r_sizeof
(paren
r_struct
id|vc_map
op_star
)paren
op_star
id|card-&gt;scd_size
suffix:semicolon
id|IPRINTK
c_func
(paren
l_string|&quot;%s: allocate %d byte for SCD to VC mapping.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
(paren
id|card-&gt;scd2vc
op_assign
id|vmalloc
c_func
(paren
id|size
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: memory allocation failure.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|deinit_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
id|memset
c_func
(paren
id|card-&gt;scd2vc
comma
l_int|0
comma
id|size
)paren
suffix:semicolon
id|size
op_assign
r_sizeof
(paren
r_struct
id|tst_info
)paren
op_star
(paren
id|card-&gt;tst_size
op_minus
l_int|2
)paren
suffix:semicolon
id|IPRINTK
c_func
(paren
l_string|&quot;%s: allocate %d byte for TST to VC mapping.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|NULL
op_eq
(paren
id|card-&gt;soft_tst
op_assign
id|vmalloc
c_func
(paren
id|size
)paren
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: memory allocation failure.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|deinit_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|card-&gt;tst_size
op_minus
l_int|2
suffix:semicolon
id|i
op_increment
)paren
(brace
id|card-&gt;soft_tst
(braket
id|i
)braket
dot
id|tste
op_assign
id|TSTE_OPC_VAR
suffix:semicolon
id|card-&gt;soft_tst
(braket
id|i
)braket
dot
id|vc
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;phy
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: No LT device defined.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|deinit_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|dev-&gt;phy-&gt;ioctl
op_eq
l_int|NULL
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: LT had no IOCTL funtion defined.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|deinit_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
macro_line|#ifdef&t;CONFIG_ATM_IDT77252_USE_SUNI
multiline_comment|/*&n;&t; * this is a jhs hack to get around special functionality in the&n;&t; * phy driver for the atecom hardware; the functionality doesn&squot;t&n;&t; * exist in the linux atm suni driver&n;&t; *&n;&t; * it isn&squot;t the right way to do things, but as the guy from NIST&n;&t; * said, talking about their measurement of the fine structure&n;&t; * constant, &quot;it&squot;s good enough for government work.&quot;&n;&t; */
id|linkrate
op_assign
l_int|149760000
suffix:semicolon
macro_line|#endif
id|card-&gt;link_pcr
op_assign
(paren
id|linkrate
op_div
l_int|8
op_div
l_int|53
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: Linkrate on ATM line : %u bit/s, %u cell/s.&bslash;n&quot;
comma
id|card-&gt;name
comma
id|linkrate
comma
id|card-&gt;link_pcr
)paren
suffix:semicolon
macro_line|#ifdef CONFIG_ATM_IDT77252_SEND_IDLE
id|card-&gt;utopia_pcr
op_assign
id|card-&gt;link_pcr
suffix:semicolon
macro_line|#else
id|card-&gt;utopia_pcr
op_assign
(paren
l_int|160000000
op_div
l_int|8
op_div
l_int|54
)paren
suffix:semicolon
macro_line|#endif
id|rsvdcr
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|card-&gt;utopia_pcr
OG
id|card-&gt;link_pcr
)paren
id|rsvdcr
op_assign
id|card-&gt;utopia_pcr
op_minus
id|card-&gt;link_pcr
suffix:semicolon
id|tmpl
op_assign
(paren
r_int
r_int
)paren
id|rsvdcr
op_star
(paren
(paren
r_int
r_int
)paren
id|card-&gt;tst_size
op_minus
l_int|2
)paren
suffix:semicolon
id|modl
op_assign
id|tmpl
op_mod
(paren
r_int
r_int
)paren
id|card-&gt;utopia_pcr
suffix:semicolon
id|tst_entries
op_assign
(paren
r_int
)paren
(paren
id|tmpl
op_div
(paren
r_int
r_int
)paren
id|card-&gt;utopia_pcr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|modl
)paren
id|tst_entries
op_increment
suffix:semicolon
id|card-&gt;tst_free
op_sub_assign
id|tst_entries
suffix:semicolon
id|fill_tst
c_func
(paren
id|card
comma
l_int|NULL
comma
id|tst_entries
comma
id|TSTE_OPC_NULL
)paren
suffix:semicolon
macro_line|#ifdef HAVE_EEPROM
id|idt77252_eeprom_init
c_func
(paren
id|card
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: EEPROM: %02x:&quot;
comma
id|card-&gt;name
comma
id|idt77252_eeprom_read_status
c_func
(paren
id|card
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|0x80
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printk
c_func
(paren
l_string|&quot; %02x&quot;
comma
id|idt77252_eeprom_read_byte
c_func
(paren
id|card
comma
id|i
)paren
)paren
suffix:semicolon
)brace
id|printk
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
macro_line|#endif /* HAVE_EEPROM */
multiline_comment|/*&n;&t; * XXX: &lt;hack&gt;&n;&t; */
id|sprintf
c_func
(paren
id|tname
comma
l_string|&quot;eth%d&quot;
comma
id|card-&gt;index
)paren
suffix:semicolon
id|tmp
op_assign
id|dev_get_by_name
c_func
(paren
id|tname
)paren
suffix:semicolon
multiline_comment|/* jhs: was &quot;tmp = dev_get(tname);&quot; */
r_if
c_cond
(paren
id|tmp
)paren
(brace
id|memcpy
c_func
(paren
id|card-&gt;atmdev-&gt;esi
comma
id|tmp-&gt;dev_addr
comma
l_int|6
)paren
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;%s: ESI %02x:%02x:%02x:%02x:%02x:%02x&bslash;n&quot;
comma
id|card-&gt;name
comma
id|card-&gt;atmdev-&gt;esi
(braket
l_int|0
)braket
comma
id|card-&gt;atmdev-&gt;esi
(braket
l_int|1
)braket
comma
id|card-&gt;atmdev-&gt;esi
(braket
l_int|2
)braket
comma
id|card-&gt;atmdev-&gt;esi
(braket
l_int|3
)braket
comma
id|card-&gt;atmdev-&gt;esi
(braket
l_int|4
)braket
comma
id|card-&gt;atmdev-&gt;esi
(braket
l_int|5
)braket
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * XXX: &lt;/hack&gt;&n;&t; */
multiline_comment|/* Set Maximum Deficit Count for now. */
id|writel
c_func
(paren
l_int|0xffff
comma
id|SAR_REG_MDFCT
)paren
suffix:semicolon
id|set_bit
c_func
(paren
id|IDT77252_BIT_INIT
comma
op_amp
id|card-&gt;flags
)paren
suffix:semicolon
id|XPRINTK
c_func
(paren
l_string|&quot;%s: IDT77252 ABR SAR initialization complete.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*****************************************************************************/
multiline_comment|/*                                                                           */
multiline_comment|/* Probing of IDT77252 ABR SAR                                               */
multiline_comment|/*                                                                           */
multiline_comment|/*****************************************************************************/
r_static
r_int
DECL|function|preset_idt77252
id|preset_idt77252
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
)paren
(brace
id|u16
id|pci_command
suffix:semicolon
multiline_comment|/*****************************************************************/
multiline_comment|/*   P C I   C O N F I G U R A T I O N                           */
multiline_comment|/*****************************************************************/
id|XPRINTK
c_func
(paren
l_string|&quot;%s: Enable PCI master and memory access for SAR.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_read_config_word
c_func
(paren
id|card-&gt;pcidev
comma
id|PCI_COMMAND
comma
op_amp
id|pci_command
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: can&squot;t read PCI_COMMAND.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|deinit_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|pci_command
op_amp
id|PCI_COMMAND_IO
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: PCI_COMMAND: %04x (???)&bslash;n&quot;
comma
id|card-&gt;name
comma
id|pci_command
)paren
suffix:semicolon
id|deinit_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
(paren
op_minus
l_int|1
)paren
suffix:semicolon
)brace
id|pci_command
op_or_assign
(paren
id|PCI_COMMAND_MEMORY
op_or
id|PCI_COMMAND_MASTER
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pci_write_config_word
c_func
(paren
id|card-&gt;pcidev
comma
id|PCI_COMMAND
comma
id|pci_command
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: can&squot;t write PCI_COMMAND.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|deinit_card
c_func
(paren
id|card
)paren
suffix:semicolon
r_return
op_minus
l_int|1
suffix:semicolon
)brace
multiline_comment|/*****************************************************************/
multiline_comment|/*   G E N E R I C   R E S E T                                   */
multiline_comment|/*****************************************************************/
multiline_comment|/* Software reset */
id|writel
c_func
(paren
id|SAR_CFG_SWRST
comma
id|SAR_REG_CFG
)paren
suffix:semicolon
id|mdelay
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|SAR_REG_CFG
)paren
suffix:semicolon
id|IPRINTK
c_func
(paren
l_string|&quot;%s: Software resetted.&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_int
r_int
DECL|function|probe_sram
id|probe_sram
c_func
(paren
r_struct
id|idt77252_dev
op_star
id|card
)paren
(brace
id|u32
id|data
comma
id|addr
suffix:semicolon
id|writel
c_func
(paren
l_int|0
comma
id|SAR_REG_DR0
)paren
suffix:semicolon
id|writel
c_func
(paren
id|SAR_CMD_WRITE_SRAM
op_or
(paren
l_int|0
op_lshift
l_int|2
)paren
comma
id|SAR_REG_CMD
)paren
suffix:semicolon
r_for
c_loop
(paren
id|addr
op_assign
l_int|0x4000
suffix:semicolon
id|addr
OL
l_int|0x80000
suffix:semicolon
id|addr
op_add_assign
l_int|0x4000
)paren
(brace
id|writel
c_func
(paren
l_int|0xdeadbeef
comma
id|SAR_REG_DR0
)paren
suffix:semicolon
id|writel
c_func
(paren
id|SAR_CMD_WRITE_SRAM
op_or
(paren
id|addr
op_lshift
l_int|2
)paren
comma
id|SAR_REG_CMD
)paren
suffix:semicolon
id|writel
c_func
(paren
id|SAR_CMD_READ_SRAM
op_or
(paren
l_int|0
op_lshift
l_int|2
)paren
comma
id|SAR_REG_CMD
)paren
suffix:semicolon
id|data
op_assign
id|readl
c_func
(paren
id|SAR_REG_DR0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|data
op_ne
l_int|0
)paren
r_break
suffix:semicolon
)brace
r_return
id|addr
op_star
r_sizeof
(paren
id|u32
)paren
suffix:semicolon
)brace
r_int
DECL|function|idt77252_probe
id|idt77252_probe
c_func
(paren
r_void
)paren
(brace
r_struct
id|idt77252_dev
op_star
op_star
id|last
comma
op_star
id|card
suffix:semicolon
r_struct
id|pci_dev
op_star
id|pcidev
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|atm_dev
op_star
id|dev
suffix:semicolon
id|ushort
id|revision
op_assign
l_int|0
suffix:semicolon
r_int
id|i
comma
id|index
op_assign
l_int|0
suffix:semicolon
id|last
op_assign
op_amp
id|idt77252_chain
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pci_present
c_func
(paren
)paren
)paren
(brace
id|printk
c_func
(paren
id|KERN_NOTICE
l_string|&quot;idt77252: no PCI subsystem found.&bslash;n&quot;
)paren
suffix:semicolon
r_return
op_minus
id|ENODEV
suffix:semicolon
)brace
r_while
c_loop
(paren
(paren
id|pcidev
op_assign
id|pci_find_device
c_func
(paren
id|PCI_VENDOR_ID_IDT
comma
id|PCI_DEVICE_ID_IDT_IDT77252
comma
id|pcidev
)paren
)paren
)paren
(brace
r_int
r_int
id|membase
comma
id|srambase
suffix:semicolon
r_if
c_cond
(paren
id|pci_read_config_word
c_func
(paren
id|pcidev
comma
id|PCI_REVISION_ID
comma
op_amp
id|revision
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;idt77252-%d: can&squot;t read PCI_REVISION_ID&bslash;n&quot;
comma
id|index
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|card
op_assign
id|kmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|idt77252_dev
)paren
comma
id|GFP_KERNEL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;idt77252-%d: can&squot;t allocate private data&bslash;n&quot;
comma
id|index
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|memset
c_func
(paren
id|card
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|idt77252_dev
)paren
)paren
suffix:semicolon
id|card-&gt;revision
op_assign
id|revision
suffix:semicolon
id|card-&gt;index
op_assign
id|index
suffix:semicolon
id|card-&gt;pcidev
op_assign
id|pcidev
suffix:semicolon
id|sprintf
c_func
(paren
id|card-&gt;name
comma
l_string|&quot;idt77252-%d&quot;
comma
id|card-&gt;index
)paren
suffix:semicolon
id|card-&gt;tqueue.routine
op_assign
id|idt77252_softint
suffix:semicolon
id|card-&gt;tqueue.data
op_assign
(paren
r_void
op_star
)paren
id|card
suffix:semicolon
id|membase
op_assign
id|pci_resource_start
c_func
(paren
id|pcidev
comma
l_int|1
)paren
suffix:semicolon
id|srambase
op_assign
id|pci_resource_start
c_func
(paren
id|pcidev
comma
l_int|2
)paren
suffix:semicolon
id|init_MUTEX
c_func
(paren
op_amp
id|card-&gt;mutex
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|card-&gt;cmd_lock
)paren
suffix:semicolon
id|spin_lock_init
c_func
(paren
op_amp
id|card-&gt;tst_lock
)paren
suffix:semicolon
id|card-&gt;tst_timer.data
op_assign
(paren
r_int
r_int
)paren
id|card
suffix:semicolon
id|card-&gt;tst_timer.function
op_assign
id|tst_timer
suffix:semicolon
id|init_timer
c_func
(paren
op_amp
id|card-&gt;tst_timer
)paren
suffix:semicolon
multiline_comment|/* Do the I/O remapping... */
id|card-&gt;membase
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|membase
comma
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;membase
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: can&squot;t ioremap() membase&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|preset_idt77252
c_func
(paren
id|card
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: preset failed&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|card-&gt;membase
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|dev
op_assign
id|atm_dev_register
c_func
(paren
l_string|&quot;idt77252&quot;
comma
op_amp
id|idt77252_ops
comma
op_minus
l_int|1
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: can&squot;t register atm device&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|iounmap
c_func
(paren
(paren
r_void
op_star
)paren
id|card-&gt;membase
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|dev-&gt;dev_data
op_assign
id|card
suffix:semicolon
id|card-&gt;atmdev
op_assign
id|dev
suffix:semicolon
macro_line|#ifdef&t;CONFIG_ATM_IDT77252_USE_SUNI
id|suni_init
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dev-&gt;phy
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: can&squot;t init SUNI&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|deinit_card
c_func
(paren
id|card
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
macro_line|#endif&t;/* CONFIG_ATM_IDT77252_USE_SUNI */
id|card-&gt;sramsize
op_assign
id|probe_sram
c_func
(paren
id|card
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|4
suffix:semicolon
id|i
op_increment
)paren
(brace
id|card-&gt;fbq
(braket
id|i
)braket
op_assign
(paren
r_int
r_int
)paren
id|ioremap
c_func
(paren
id|srambase
op_or
l_int|0x200000
op_or
(paren
id|i
op_lshift
l_int|18
)paren
comma
l_int|4
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|card-&gt;fbq
(braket
id|i
)braket
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: can&squot;t ioremap() FBQ%d&bslash;n&quot;
comma
id|card-&gt;name
comma
id|i
)paren
suffix:semicolon
id|deinit_card
c_func
(paren
id|card
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_goto
id|next
suffix:semicolon
)brace
)brace
id|printk
c_func
(paren
l_string|&quot;%s: ABR SAR (Rev %c): MEM %08lx SRAM %08lx [%u KB]&bslash;n&quot;
comma
id|card-&gt;name
comma
(paren
(paren
id|revision
OG
l_int|1
)paren
op_logical_and
(paren
id|revision
OL
l_int|25
)paren
)paren
ques
c_cond
l_char|&squot;A&squot;
op_plus
id|revision
op_minus
l_int|1
suffix:colon
l_char|&squot;?&squot;
comma
id|membase
comma
id|srambase
comma
id|card-&gt;sramsize
op_div
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|init_card
c_func
(paren
id|dev
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: init_card failed&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
id|deinit_card
c_func
(paren
id|card
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|dev-&gt;ci_range.vpi_bits
op_assign
id|card-&gt;vpibits
suffix:semicolon
id|dev-&gt;ci_range.vci_bits
op_assign
id|card-&gt;vcibits
suffix:semicolon
id|dev-&gt;link_rate
op_assign
id|card-&gt;link_pcr
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;phy-&gt;start
)paren
id|dev-&gt;phy
op_member_access_from_pointer
id|start
c_func
(paren
id|dev
)paren
suffix:semicolon
r_if
c_cond
(paren
id|idt77252_dev_open
c_func
(paren
id|card
)paren
)paren
(brace
id|printk
c_func
(paren
l_string|&quot;%s: dev_open failed&bslash;n&quot;
comma
id|card-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;phy-&gt;stop
)paren
id|dev-&gt;phy
op_member_access_from_pointer
id|stop
c_func
(paren
id|dev
)paren
suffix:semicolon
id|deinit_card
c_func
(paren
id|card
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
r_continue
suffix:semicolon
)brace
op_star
id|last
op_assign
id|card
suffix:semicolon
id|last
op_assign
op_amp
id|card-&gt;next
suffix:semicolon
id|index
op_increment
suffix:semicolon
id|next
suffix:colon
)brace
r_return
id|index
suffix:semicolon
)brace
macro_line|#ifdef MODULE
id|MODULE_PARM
c_func
(paren
id|vpibits
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
id|MODULE_AUTHOR
c_func
(paren
l_string|&quot;Eddie C. Dost &lt;ecd@atecom.com&gt;&quot;
)paren
suffix:semicolon
id|MODULE_DESCRIPTION
c_func
(paren
l_string|&quot;IDT77252 ABR SAR Driver&quot;
)paren
suffix:semicolon
macro_line|#ifdef DEBUG
id|MODULE_PARM
c_func
(paren
id|debug
comma
l_string|&quot;i&quot;
)paren
suffix:semicolon
macro_line|#endif
r_int
DECL|function|init_module
id|init_module
c_func
(paren
r_void
)paren
(brace
r_int
id|v
suffix:semicolon
id|printk
c_func
(paren
l_string|&quot;idt77252 init_module: %s at %p&bslash;n&quot;
comma
id|__FUNCTION__
comma
id|init_module
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * this modification is somewhat silly, as atmdev_init.c doesn&squot;t&n;&t; * check for EIO, it only accumulates the return value in the sum&n;&t; * of atm adaptors found.&n;&t; */
id|v
op_assign
id|idt77252_probe
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|v
OL
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_void
DECL|function|cleanup_module
id|cleanup_module
c_func
(paren
r_void
)paren
(brace
r_struct
id|idt77252_dev
op_star
id|card
suffix:semicolon
r_struct
id|atm_dev
op_star
id|dev
suffix:semicolon
r_while
c_loop
(paren
id|idt77252_chain
)paren
(brace
id|card
op_assign
id|idt77252_chain
suffix:semicolon
id|dev
op_assign
id|card-&gt;atmdev
suffix:semicolon
id|idt77252_chain
op_assign
id|card-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|dev-&gt;phy-&gt;stop
)paren
id|dev-&gt;phy
op_member_access_from_pointer
id|stop
c_func
(paren
id|dev
)paren
suffix:semicolon
id|deinit_card
c_func
(paren
id|card
)paren
suffix:semicolon
id|kfree
c_func
(paren
id|card
)paren
suffix:semicolon
)brace
id|DIPRINTK
c_func
(paren
l_string|&quot;idt77252: finished cleanup-module().&bslash;n&quot;
)paren
suffix:semicolon
)brace
macro_line|#else
DECL|function|idt77252_detect
r_int
id|__init
id|idt77252_detect
c_func
(paren
r_void
)paren
(brace
r_int
id|v
suffix:semicolon
id|v
op_assign
id|idt77252_probe
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|v
OL
l_int|0
)paren
r_return
op_minus
id|EIO
suffix:semicolon
r_else
r_return
id|v
suffix:semicolon
)brace
macro_line|#endif&t;/* MODULE */
eof
